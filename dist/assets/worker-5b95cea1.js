import"https://cdnjs.cloudflare.com/ajax/libs/jimp/0.22.8/jimp.min.js";const bitMethods={getBit(e){return this.data[getSlot(e)]&1<<getShift(e)?1:0},setBit(e){this.data[getSlot(e)]|=1<<getShift(e)},clearBit(e){this.data[getSlot(e)]&=~(1<<getShift(e))},toggleBit(e){this.data[getSlot(e)]^=1<<getShift(e)},getBitXY(e,t){return e>=this.width||t>=this.height?0:this.getBit(t*this.width+e)},setBitXY(e,t){this.setBit(t*this.width+e)},clearBitXY(e,t){this.clearBit(t*this.width+e)},toggleBitXY(e,t){this.toggleBit(t*this.width+e)}};function getSlot(e){return e>>3}function getShift(e){return 7-(e&7)}function setBitMethods(e){for(const t in bitMethods)e.prototype[t]=bitMethods[t]}function checkProcessable(e,t={}){let{bitDepth:r,alpha:n,colorModel:a,components:s,channels:o}=t;if(typeof e!="string"||e.length===0)throw new TypeError("processName must be a string");if(r&&(Array.isArray(r)||(r=[r]),!r.includes(this.bitDepth)))throw new TypeError(`The process: ${e} can only be applied if bit depth is in: ${r}`);if(n&&(Array.isArray(n)||(n=[n]),!n.includes(this.alpha)))throw new TypeError(`The process: ${e} can only be applied if alpha is in: ${n}`);if(a&&(Array.isArray(a)||(a=[a]),!a.includes(this.colorModel)))throw new TypeError(`The process: ${e} can only be applied if color model is in: ${a}`);if(s&&(Array.isArray(s)||(s=[s]),!s.includes(this.components))){let l=`The process: ${e} can only be applied if the number of components is in: ${s}`;throw s.length===1&&s[0]===1?new TypeError(`${l}.\rYou should transform your image using "image.grey()" before applying the algorithm.`):new TypeError(l)}if(o&&(Array.isArray(o)||(o=[o]),!o.includes(this.channels)))throw new TypeError(`The process: ${e} can only be applied if the number of channels is in: ${o}`)}function createBlob(e,t){e=e||[],t=t||{},typeof t=="string"&&(t={type:t});try{return new Blob(e,t)}catch(s){if(s.name!=="TypeError")throw s;for(var r=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,n=new r,a=0;a<e.length;a+=1)n.append(e[a]);return n.getBlob(t.type)}}function dataURLToBlob(e){var t=e.match(/data:([^;]+)/)[1],r=e.replace(/^[^,]+,/,""),n=binaryStringToArrayBuffer(atob(r));return createBlob([n],{type:t})}function canvasToBlob(e,t,r){return typeof e.toBlob=="function"?new Promise(function(n){e.toBlob(n,t,r)}):Promise.resolve(dataURLToBlob(e.toDataURL(t,r)))}function binaryStringToArrayBuffer(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),a=-1;++a<t;)n[a]=e.charCodeAt(a);return r}var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function getAugmentedNamespace(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var a=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,a.get?a:{enumerable:!0,get:function(){return e[n]}})}),r}(function(e){if(e.TextEncoder&&e.TextDecoder)return!1;function t(n="utf-8"){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${n}') is invalid.`)}Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),t.prototype.encode=function(n,a={stream:!1}){if(a.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let s=0;const o=n.length;let l=0,f=Math.max(32,o+(o>>1)+7),h=new Uint8Array(f>>3<<3);for(;s<o;){let c=n.charCodeAt(s++);if(c>=55296&&c<=56319){if(s<o){const u=n.charCodeAt(s);(u&64512)===56320&&(++s,c=((c&1023)<<10)+(u&1023)+65536)}if(c>=55296&&c<=56319)continue}if(l+4>h.length){f+=8,f*=1+s/n.length*2,f=f>>3<<3;const u=new Uint8Array(f);u.set(h),h=u}if(c&4294967168)if(!(c&4294965248))h[l++]=c>>6&31|192;else if(!(c&4294901760))h[l++]=c>>12&15|224,h[l++]=c>>6&63|128;else if(!(c&4292870144))h[l++]=c>>18&7|240,h[l++]=c>>12&63|128,h[l++]=c>>6&63|128;else continue;else{h[l++]=c;continue}h[l++]=c&63|128}return h.slice(0,l)};function r(n="utf-8",a={fatal:!1}){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${n}') is invalid.`);if(a.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(r.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(r.prototype,"fatal",{value:!1}),Object.defineProperty(r.prototype,"ignoreBOM",{value:!1}),r.prototype.decode=function(n,a={stream:!1}){if(a.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const s=new Uint8Array(n);let o=0;const l=s.length,f=[];for(;o<l;){const h=s[o++];if(h===0)break;if(!(h&128))f.push(h);else if((h&224)===192){const c=s[o++]&63;f.push((h&31)<<6|c)}else if((h&240)===224){const c=s[o++]&63,u=s[o++]&63;f.push((h&31)<<12|c<<6|u)}else if((h&248)===240){const c=s[o++]&63,u=s[o++]&63,d=s[o++]&63;let g=(h&7)<<18|c<<12|u<<6|d;g>65535&&(g-=65536,f.push(g>>>10&1023|55296),g=56320|g&1023),f.push(g)}}return String.fromCharCode.apply(null,f)},e.TextEncoder=t,e.TextDecoder=r})(typeof window<"u"?window:typeof self<"u"?self:void 0);function decode$5(e,t="utf8"){return new TextDecoder(t).decode(e)}const encoder$1=new TextEncoder;function encode$3(e){return encoder$1.encode(e)}const defaultByteLength$1=1024*8,hostBigEndian=(()=>{const e=new Uint8Array(4),t=new Uint32Array(e.buffer);return!((t[0]=1)&e[0])})(),typedArrays={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};let IOBuffer$4=class rt{constructor(t=defaultByteLength$1,r={}){let n=!1;typeof t=="number"?t=new ArrayBuffer(t):(n=!0,this.lastWrittenByte=t.byteLength);const a=r.offset?r.offset>>>0:0,s=t.byteLength-a;let o=a;(ArrayBuffer.isView(t)||t instanceof rt)&&(t.byteLength!==t.buffer.byteLength&&(o=t.byteOffset+a),t=t.buffer),n?this.lastWrittenByte=s:this.lastWrittenByte=0,this.buffer=t,this.length=s,this.byteLength=s,this.byteOffset=o,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,o,s),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}back(t=1){return this.offset-=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(t===void 0)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){const n=(this.offset+t)*2,a=new Uint8Array(n);a.set(new Uint8Array(this.buffer)),this.buffer=a.buffer,this.length=this.byteLength=n,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){return this.readArray(t,"uint8")}readArray(t,r){const n=typedArrays[r].BYTES_PER_ELEMENT*t,a=this.byteOffset+this.offset,s=this.buffer.slice(a,a+n);if(this.littleEndian===hostBigEndian&&r!=="uint8"&&r!=="int8"){const l=new Uint8Array(this.buffer.slice(a,a+n));l.reverse();const f=new typedArrays[r](l.buffer);return this.offset+=n,f.reverse(),f}const o=new typedArrays[r](s);return this.offset+=n,o}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readBigInt64(){const t=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,t}readBigUint64(){const t=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let r="";for(let n=0;n<t;n++)r+=this.readChar();return r}readUtf8(t=1){return decode$5(this.readBytes(t))}decodeText(t=1,r="utf-8"){return decode$5(this.readBytes(t),r)}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let r=0;r<t.length;r++)this._data.setUint8(this.offset++,t[r]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(t){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(t){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let r=0;r<t.length;r++)this.writeUint8(t.charCodeAt(r));return this}writeUtf8(t){return this.writeBytes(encode$3(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}};var IOBuffer$5=Object.freeze({__proto__:null,IOBuffer:IOBuffer$4}),require$$0$3=getAugmentedNamespace(IOBuffer$5),constants$4={BITMAPV5HEADER:{LogicalColorSpace:{LCS_CALIBRATED_RGB:0,LCS_sRGB:1934772034,LCS_WINDOWS_COLOR_SPACE:1466527264},Compression:{BI_RGB:0,BI_RLE8:1,BI_RLE4:2,BI_BITFIELDS:3,BI_JPEG:4,BI_PNG:5,BI_CMYK:11,BI_CMYKRLE8:12,BI_CMYKRLE4:13},GamutMappingIntent:{LCS_GM_ABS_COLORIMETRIC:8,LCS_GM_BUSINESS:1,LCS_GM_GRAPHICS:2,LCS_GM_IMAGES:4}}};const{IOBuffer:IOBuffer$3}=require$$0$3,constants$3=constants$4,tableLeft=[];for(let e=0;e<=8;e++)tableLeft.push(255<<e);class BMPEncoder extends IOBuffer$3{constructor(t){if(t.bitDepth!==1)throw new Error("Only bitDepth of 1 is supported");if(!t.height||!t.width)throw new Error("ImageData width and height are required");super(t.data),this.width=t.width,this.height=t.height,this.bitDepth=t.bitDepth,this.channels=t.channels,this.components=t.components}encode(){this.encoded=new IOBuffer$3,this.encoded.skip(14),this.writeBitmapV5Header(),this.writeColorTable();const t=this.encoded.offset;return this.writePixelArray(),this.encoded.rewind(),this.writeBitmapFileHeader(t),this.encoded.toArray()}writePixelArray(){let t=this.encoded;const r=Math.floor((this.bitDepth*this.width+31)/32)*4,n=Math.ceil(this.bitDepth*this.width/8),a=r-n,s=this.bitDepth*this.width%8,o=s===0?0:8-s,l=r*this.height;let f,h,c=0,u=0,d=8;t.mark(),h=this.readUint8();for(let g=this.height-1;g>=0;g--){const p=g===0;t.reset(),t.skip(g*r);for(let m=0;m<n;m++){const y=m===n-1;u<=o&&y?(t.writeByte(h<<u),(o===0||o===u)&&!p&&(f=h,h=this.readByte())):u===0?(f=h,h=this.readUint8(),t.writeByte(f)):(f=h,h=this.readUint8(),t.writeByte(f<<u&tableLeft[u]|h>>d)),y&&(c+=s||0,t.skip(a),u=c%8,d=8-u)}}r>n&&(t.reset(),t.skip(l-1),t.writeUint8(0))}writeColorTable(){this.encoded.writeUint32(0).writeUint32(16777215)}writeBitmapFileHeader(t){this.encoded.writeChars("BM").writeInt32(this.encoded.lastWrittenByte).writeUint16(0).writeUint16(0).writeUint32(t)}writeBitmapV5Header(){const r=Math.floor((this.bitDepth*this.width+31)/32)*4*this.height;this.encoded.writeUint32(124).writeInt32(this.width).writeInt32(this.height).writeUint16(1).writeUint16(this.bitDepth).writeUint32(constants$3.BITMAPV5HEADER.Compression.BI_RGB).writeUint32(r).writeInt32(0).writeInt32(0).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(4278190080).writeUint32(16711680).writeUint32(65280).writeUint32(255).writeUint32(constants$3.BITMAPV5HEADER.LogicalColorSpace.LCS_sRGB).skip(36).skip(12).writeUint32(constants$3.BITMAPV5HEADER.GamutMappingIntent.LCS_GM_IMAGES).skip(12)}}var BMPEncoder_1=BMPEncoder;const Encoder=BMPEncoder_1;var encode$2=function(t){return new Encoder(t).encode()};/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Z_FIXED$1=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN$1=2;function zero$1(e){let t=e.length;for(;--t>=0;)e[t]=0}const STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH$1=3,MAX_MATCH$1=258,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),extra_dbits=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),extra_blbits=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bl_order=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DIST_CODE_LEN=512,static_ltree=new Array((L_CODES$1+2)*2);zero$1(static_ltree);const static_dtree=new Array(D_CODES$1*2);zero$1(static_dtree);const _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);const _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);const base_length=new Array(LENGTH_CODES$1);zero$1(base_length);const base_dist=new Array(D_CODES$1);zero$1(base_dist);function StaticTreeDesc(e,t,r,n,a){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=a,this.has_stree=e&&e.length}let static_l_desc,static_d_desc,static_bl_desc;function TreeDesc(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}const d_code=e=>e<256?_dist_code[e]:_dist_code[256+(e>>>7)],put_short=(e,t)=>{e.pending_buf[e.pending++]=t&255,e.pending_buf[e.pending++]=t>>>8&255},send_bits=(e,t,r)=>{e.bi_valid>Buf_size-r?(e.bi_buf|=t<<e.bi_valid&65535,put_short(e,e.bi_buf),e.bi_buf=t>>Buf_size-e.bi_valid,e.bi_valid+=r-Buf_size):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},send_code=(e,t,r)=>{send_bits(e,r[t*2],r[t*2+1])},bi_reverse=(e,t)=>{let r=0;do r|=e&1,e>>>=1,r<<=1;while(--t>0);return r>>>1},bi_flush=e=>{e.bi_valid===16?(put_short(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)},gen_bitlen=(e,t)=>{const r=t.dyn_tree,n=t.max_code,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,l=t.stat_desc.extra_base,f=t.stat_desc.max_length;let h,c,u,d,g,p,m=0;for(d=0;d<=MAX_BITS$1;d++)e.bl_count[d]=0;for(r[e.heap[e.heap_max]*2+1]=0,h=e.heap_max+1;h<HEAP_SIZE$1;h++)c=e.heap[h],d=r[r[c*2+1]*2+1]+1,d>f&&(d=f,m++),r[c*2+1]=d,!(c>n)&&(e.bl_count[d]++,g=0,c>=l&&(g=o[c-l]),p=r[c*2],e.opt_len+=p*(d+g),s&&(e.static_len+=p*(a[c*2+1]+g)));if(m!==0){do{for(d=f-1;e.bl_count[d]===0;)d--;e.bl_count[d]--,e.bl_count[d+1]+=2,e.bl_count[f]--,m-=2}while(m>0);for(d=f;d!==0;d--)for(c=e.bl_count[d];c!==0;)u=e.heap[--h],!(u>n)&&(r[u*2+1]!==d&&(e.opt_len+=(d-r[u*2+1])*r[u*2],r[u*2+1]=d),c--)}},gen_codes=(e,t,r)=>{const n=new Array(MAX_BITS$1+1);let a=0,s,o;for(s=1;s<=MAX_BITS$1;s++)a=a+r[s-1]<<1,n[s]=a;for(o=0;o<=t;o++){let l=e[o*2+1];l!==0&&(e[o*2]=bi_reverse(n[l]++,l))}},tr_static_init=()=>{let e,t,r,n,a;const s=new Array(MAX_BITS$1+1);for(r=0,n=0;n<LENGTH_CODES$1-1;n++)for(base_length[n]=r,e=0;e<1<<extra_lbits[n];e++)_length_code[r++]=n;for(_length_code[r-1]=n,a=0,n=0;n<16;n++)for(base_dist[n]=a,e=0;e<1<<extra_dbits[n];e++)_dist_code[a++]=n;for(a>>=7;n<D_CODES$1;n++)for(base_dist[n]=a<<7,e=0;e<1<<extra_dbits[n]-7;e++)_dist_code[256+a++]=n;for(t=0;t<=MAX_BITS$1;t++)s[t]=0;for(e=0;e<=143;)static_ltree[e*2+1]=8,e++,s[8]++;for(;e<=255;)static_ltree[e*2+1]=9,e++,s[9]++;for(;e<=279;)static_ltree[e*2+1]=7,e++,s[7]++;for(;e<=287;)static_ltree[e*2+1]=8,e++,s[8]++;for(gen_codes(static_ltree,L_CODES$1+1,s),e=0;e<D_CODES$1;e++)static_dtree[e*2+1]=5,static_dtree[e*2]=bi_reverse(e,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS$1+1,L_CODES$1,MAX_BITS$1),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES$1,MAX_BITS$1),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES$1,MAX_BL_BITS)},init_block=e=>{let t;for(t=0;t<L_CODES$1;t++)e.dyn_ltree[t*2]=0;for(t=0;t<D_CODES$1;t++)e.dyn_dtree[t*2]=0;for(t=0;t<BL_CODES$1;t++)e.bl_tree[t*2]=0;e.dyn_ltree[END_BLOCK*2]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},bi_windup=e=>{e.bi_valid>8?put_short(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},smaller=(e,t,r,n)=>{const a=t*2,s=r*2;return e[a]<e[s]||e[a]===e[s]&&n[t]<=n[r]},pqdownheap=(e,t,r)=>{const n=e.heap[r];let a=r<<1;for(;a<=e.heap_len&&(a<e.heap_len&&smaller(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!smaller(t,n,e.heap[a],e.depth));)e.heap[r]=e.heap[a],r=a,a<<=1;e.heap[r]=n},compress_block=(e,t,r)=>{let n,a,s=0,o,l;if(e.sym_next!==0)do n=e.pending_buf[e.sym_buf+s++]&255,n+=(e.pending_buf[e.sym_buf+s++]&255)<<8,a=e.pending_buf[e.sym_buf+s++],n===0?send_code(e,a,t):(o=_length_code[a],send_code(e,o+LITERALS$1+1,t),l=extra_lbits[o],l!==0&&(a-=base_length[o],send_bits(e,a,l)),n--,o=d_code(n),send_code(e,o,r),l=extra_dbits[o],l!==0&&(n-=base_dist[o],send_bits(e,n,l)));while(s<e.sym_next);send_code(e,END_BLOCK,t)},build_tree=(e,t)=>{const r=t.dyn_tree,n=t.stat_desc.static_tree,a=t.stat_desc.has_stree,s=t.stat_desc.elems;let o,l,f=-1,h;for(e.heap_len=0,e.heap_max=HEAP_SIZE$1,o=0;o<s;o++)r[o*2]!==0?(e.heap[++e.heap_len]=f=o,e.depth[o]=0):r[o*2+1]=0;for(;e.heap_len<2;)h=e.heap[++e.heap_len]=f<2?++f:0,r[h*2]=1,e.depth[h]=0,e.opt_len--,a&&(e.static_len-=n[h*2+1]);for(t.max_code=f,o=e.heap_len>>1;o>=1;o--)pqdownheap(e,r,o);h=s;do o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],pqdownheap(e,r,1),l=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=l,r[h*2]=r[o*2]+r[l*2],e.depth[h]=(e.depth[o]>=e.depth[l]?e.depth[o]:e.depth[l])+1,r[o*2+1]=r[l*2+1]=h,e.heap[1]=h++,pqdownheap(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],gen_bitlen(e,t),gen_codes(r,f,e.bl_count)},scan_tree=(e,t,r)=>{let n,a=-1,s,o=t[0*2+1],l=0,f=7,h=4;for(o===0&&(f=138,h=3),t[(r+1)*2+1]=65535,n=0;n<=r;n++)s=o,o=t[(n+1)*2+1],!(++l<f&&s===o)&&(l<h?e.bl_tree[s*2]+=l:s!==0?(s!==a&&e.bl_tree[s*2]++,e.bl_tree[REP_3_6*2]++):l<=10?e.bl_tree[REPZ_3_10*2]++:e.bl_tree[REPZ_11_138*2]++,l=0,a=s,o===0?(f=138,h=3):s===o?(f=6,h=3):(f=7,h=4))},send_tree=(e,t,r)=>{let n,a=-1,s,o=t[0*2+1],l=0,f=7,h=4;for(o===0&&(f=138,h=3),n=0;n<=r;n++)if(s=o,o=t[(n+1)*2+1],!(++l<f&&s===o)){if(l<h)do send_code(e,s,e.bl_tree);while(--l!==0);else s!==0?(s!==a&&(send_code(e,s,e.bl_tree),l--),send_code(e,REP_3_6,e.bl_tree),send_bits(e,l-3,2)):l<=10?(send_code(e,REPZ_3_10,e.bl_tree),send_bits(e,l-3,3)):(send_code(e,REPZ_11_138,e.bl_tree),send_bits(e,l-11,7));l=0,a=s,o===0?(f=138,h=3):s===o?(f=6,h=3):(f=7,h=4)}},build_bl_tree=e=>{let t;for(scan_tree(e,e.dyn_ltree,e.l_desc.max_code),scan_tree(e,e.dyn_dtree,e.d_desc.max_code),build_tree(e,e.bl_desc),t=BL_CODES$1-1;t>=3&&e.bl_tree[bl_order[t]*2+1]===0;t--);return e.opt_len+=3*(t+1)+5+5+4,t},send_all_trees=(e,t,r,n)=>{let a;for(send_bits(e,t-257,5),send_bits(e,r-1,5),send_bits(e,n-4,4),a=0;a<n;a++)send_bits(e,e.bl_tree[bl_order[a]*2+1],3);send_tree(e,e.dyn_ltree,t-1),send_tree(e,e.dyn_dtree,r-1)},detect_data_type=e=>{let t=4093624447,r;for(r=0;r<=31;r++,t>>>=1)if(t&1&&e.dyn_ltree[r*2]!==0)return Z_BINARY;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return Z_TEXT;for(r=32;r<LITERALS$1;r++)if(e.dyn_ltree[r*2]!==0)return Z_TEXT;return Z_BINARY};let static_init_done=!1;const _tr_init$1=e=>{static_init_done||(tr_static_init(),static_init_done=!0),e.l_desc=new TreeDesc(e.dyn_ltree,static_l_desc),e.d_desc=new TreeDesc(e.dyn_dtree,static_d_desc),e.bl_desc=new TreeDesc(e.bl_tree,static_bl_desc),e.bi_buf=0,e.bi_valid=0,init_block(e)},_tr_stored_block$1=(e,t,r,n)=>{send_bits(e,(STORED_BLOCK<<1)+(n?1:0),3),bi_windup(e),put_short(e,r),put_short(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r},_tr_align$1=e=>{send_bits(e,STATIC_TREES<<1,3),send_code(e,END_BLOCK,static_ltree),bi_flush(e)},_tr_flush_block$1=(e,t,r,n)=>{let a,s,o=0;e.level>0?(e.strm.data_type===Z_UNKNOWN$1&&(e.strm.data_type=detect_data_type(e)),build_tree(e,e.l_desc),build_tree(e,e.d_desc),o=build_bl_tree(e),a=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=a&&(a=s)):a=s=r+5,r+4<=a&&t!==-1?_tr_stored_block$1(e,t,r,n):e.strategy===Z_FIXED$1||s===a?(send_bits(e,(STATIC_TREES<<1)+(n?1:0),3),compress_block(e,static_ltree,static_dtree)):(send_bits(e,(DYN_TREES<<1)+(n?1:0),3),send_all_trees(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),compress_block(e,e.dyn_ltree,e.dyn_dtree)),init_block(e),n&&bi_windup(e)},_tr_tally$1=(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,t===0?e.dyn_ltree[r*2]++:(e.matches++,t--,e.dyn_ltree[(_length_code[r]+LITERALS$1+1)*2]++,e.dyn_dtree[d_code(t)*2]++),e.sym_next===e.sym_end);var _tr_init_1=_tr_init$1,_tr_stored_block_1=_tr_stored_block$1,_tr_flush_block_1=_tr_flush_block$1,_tr_tally_1=_tr_tally$1,_tr_align_1=_tr_align$1,trees={_tr_init:_tr_init_1,_tr_stored_block:_tr_stored_block_1,_tr_flush_block:_tr_flush_block_1,_tr_tally:_tr_tally_1,_tr_align:_tr_align_1};const adler32=(e,t,r,n)=>{let a=e&65535|0,s=e>>>16&65535|0,o=0;for(;r!==0;){o=r>2e3?2e3:r,r-=o;do a=a+t[n++]|0,s=s+a|0;while(--o);a%=65521,s%=65521}return a|s<<16|0};var adler32_1=adler32;const makeTable=()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=e&1?3988292384^e>>>1:e>>>1;t[r]=e}return t},crcTable$1=new Uint32Array(makeTable()),crc32=(e,t,r,n)=>{const a=crcTable$1,s=n+r;e^=-1;for(let o=n;o<s;o++)e=e>>>8^a[(e^t[o])&255];return e^-1};var crc32_1=crc32,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},constants$2={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init,_tr_stored_block,_tr_flush_block,_tr_tally,_tr_align}=trees,{Z_NO_FLUSH:Z_NO_FLUSH$2,Z_PARTIAL_FLUSH,Z_FULL_FLUSH:Z_FULL_FLUSH$1,Z_FINISH:Z_FINISH$3,Z_BLOCK:Z_BLOCK$1,Z_OK:Z_OK$3,Z_STREAM_END:Z_STREAM_END$3,Z_STREAM_ERROR:Z_STREAM_ERROR$2,Z_DATA_ERROR:Z_DATA_ERROR$2,Z_BUF_ERROR:Z_BUF_ERROR$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$1,Z_FILTERED,Z_HUFFMAN_ONLY,Z_RLE,Z_FIXED,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$1,Z_UNKNOWN,Z_DEFLATED:Z_DEFLATED$2}=constants$2,MAX_MEM_LEVEL=9,MAX_WBITS$1=15,DEF_MEM_LEVEL=8,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,MIN_MATCH=3,MAX_MATCH=258,MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1,PRESET_DICT=32,INIT_STATE=42,GZIP_STATE=57,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,err=(e,t)=>(e.msg=messages[t],t),rank=e=>e*2-(e>4?9:0),zero=e=>{let t=e.length;for(;--t>=0;)e[t]=0},slide_hash=e=>{let t,r,n,a=e.w_size;t=e.hash_size,n=t;do r=e.head[--n],e.head[n]=r>=a?r-a:0;while(--t);t=a,n=t;do r=e.prev[--n],e.prev[n]=r>=a?r-a:0;while(--t)};let HASH_ZLIB=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask,HASH=HASH_ZLIB;const flush_pending=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),r!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,t.pending===0&&(t.pending_out=0))},flush_block_only=(e,t)=>{_tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,flush_pending(e.strm)},put_byte=(e,t)=>{e.pending_buf[e.pending++]=t},putShortMSB=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=t&255},read_buf=(e,t,r,n)=>{let a=e.avail_in;return a>n&&(a=n),a===0?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),r),e.state.wrap===1?e.adler=adler32_1(e.adler,t,a,r):e.state.wrap===2&&(e.adler=crc32_1(e.adler,t,a,r)),e.next_in+=a,e.total_in+=a,a)},longest_match=(e,t)=>{let r=e.max_chain_length,n=e.strstart,a,s,o=e.prev_length,l=e.nice_match;const f=e.strstart>e.w_size-MIN_LOOKAHEAD?e.strstart-(e.w_size-MIN_LOOKAHEAD):0,h=e.window,c=e.w_mask,u=e.prev,d=e.strstart+MAX_MATCH;let g=h[n+o-1],p=h[n+o];e.prev_length>=e.good_match&&(r>>=2),l>e.lookahead&&(l=e.lookahead);do if(a=t,!(h[a+o]!==p||h[a+o-1]!==g||h[a]!==h[n]||h[++a]!==h[n+1])){n+=2,a++;do;while(h[++n]===h[++a]&&h[++n]===h[++a]&&h[++n]===h[++a]&&h[++n]===h[++a]&&h[++n]===h[++a]&&h[++n]===h[++a]&&h[++n]===h[++a]&&h[++n]===h[++a]&&n<d);if(s=MAX_MATCH-(d-n),n=d-MAX_MATCH,s>o){if(e.match_start=t,o=s,s>=l)break;g=h[n+o-1],p=h[n+o]}}while((t=u[t&c])>f&&--r!==0);return o<=e.lookahead?o:e.lookahead},fill_window=e=>{const t=e.w_size;let r,n,a;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-MIN_LOOKAHEAD)&&(e.window.set(e.window.subarray(t,t+t-n),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),slide_hash(e),n+=t),e.strm.avail_in===0)break;if(r=read_buf(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=r,e.lookahead+e.insert>=MIN_MATCH)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=HASH(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=HASH(e,e.ins_h,e.window[a+MIN_MATCH-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<MIN_MATCH)););}while(e.lookahead<MIN_LOOKAHEAD&&e.strm.avail_in!==0)},deflate_stored=(e,t)=>{let r=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,n,a,s,o=0,l=e.strm.avail_in;do{if(n=65535,s=e.bi_valid+42>>3,e.strm.avail_out<s||(s=e.strm.avail_out-s,a=e.strstart-e.block_start,n>a+e.strm.avail_in&&(n=a+e.strm.avail_in),n>s&&(n=s),n<r&&(n===0&&t!==Z_FINISH$3||t===Z_NO_FLUSH$2||n!==a+e.strm.avail_in)))break;o=t===Z_FINISH$3&&n===a+e.strm.avail_in?1:0,_tr_stored_block(e,0,0,o),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,flush_pending(e.strm),a&&(a>n&&(a=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+a),e.strm.next_out),e.strm.next_out+=a,e.strm.avail_out-=a,e.strm.total_out+=a,e.block_start+=a,n-=a),n&&(read_buf(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(o===0);return l-=e.strm.avail_in,l&&(l>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=l&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-l,e.strm.next_in),e.strstart),e.strstart+=l,e.insert+=l>e.w_size-e.insert?e.w_size-e.insert:l),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?BS_FINISH_DONE:t!==Z_NO_FLUSH$2&&t!==Z_FINISH$3&&e.strm.avail_in===0&&e.strstart===e.block_start?BS_BLOCK_DONE:(s=e.window_size-e.strstart,e.strm.avail_in>s&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,s+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),s>e.strm.avail_in&&(s=e.strm.avail_in),s&&(read_buf(e.strm,e.window,e.strstart,s),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.high_water<e.strstart&&(e.high_water=e.strstart),s=e.bi_valid+42>>3,s=e.pending_buf_size-s>65535?65535:e.pending_buf_size-s,r=s>e.w_size?e.w_size:s,a=e.strstart-e.block_start,(a>=r||(a||t===Z_FINISH$3)&&t!==Z_NO_FLUSH$2&&e.strm.avail_in===0&&a<=s)&&(n=a>s?s:a,o=t===Z_FINISH$3&&e.strm.avail_in===0&&n===a?1:0,_tr_stored_block(e,e.block_start,n,o),e.block_start+=n,flush_pending(e.strm)),o?BS_FINISH_STARTED:BS_NEED_MORE)},deflate_fast=(e,t)=>{let r,n;for(;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(e.lookahead===0)break}if(r=0,e.lookahead>=MIN_MATCH&&(e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,r)),e.match_length>=MIN_MATCH)if(n=_tr_tally(e,e.strstart-e.match_start,e.match_length-MIN_MATCH),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=MIN_MATCH){e.match_length--;do e.strstart++,e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+1]);else n=_tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}return e.insert=e.strstart<MIN_MATCH-1?e.strstart:MIN_MATCH-1,t===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_slow=(e,t)=>{let r,n,a;for(;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(e.lookahead===0)break}if(r=0,e.lookahead>=MIN_MATCH&&(e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=MIN_MATCH-1,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,r),e.match_length<=5&&(e.strategy===Z_FILTERED||e.match_length===MIN_MATCH&&e.strstart-e.match_start>4096)&&(e.match_length=MIN_MATCH-1)),e.prev_length>=MIN_MATCH&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-MIN_MATCH,n=_tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-MIN_MATCH),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=a&&(e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=MIN_MATCH-1,e.strstart++,n&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}else if(e.match_available){if(n=_tr_tally(e,0,e.window[e.strstart-1]),n&&flush_block_only(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return BS_NEED_MORE}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=_tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<MIN_MATCH-1?e.strstart:MIN_MATCH-1,t===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_rle=(e,t)=>{let r,n,a,s;const o=e.window;for(;;){if(e.lookahead<=MAX_MATCH){if(fill_window(e),e.lookahead<=MAX_MATCH&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=MIN_MATCH&&e.strstart>0&&(a=e.strstart-1,n=o[a],n===o[++a]&&n===o[++a]&&n===o[++a])){s=e.strstart+MAX_MATCH;do;while(n===o[++a]&&n===o[++a]&&n===o[++a]&&n===o[++a]&&n===o[++a]&&n===o[++a]&&n===o[++a]&&n===o[++a]&&a<s);e.match_length=MAX_MATCH-(s-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=MIN_MATCH?(r=_tr_tally(e,1,e.match_length-MIN_MATCH),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=_tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_huff=(e,t)=>{let r;for(;;){if(e.lookahead===0&&(fill_window(e),e.lookahead===0)){if(t===Z_NO_FLUSH$2)return BS_NEED_MORE;break}if(e.match_length=0,r=_tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE};function Config(e,t,r,n,a){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=a}const configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],lm_init=e=>{e.window_size=2*e.w_size,zero(e.head),e.max_lazy_match=configuration_table[e.level].max_lazy,e.good_match=configuration_table[e.level].good_length,e.nice_match=configuration_table[e.level].nice_length,e.max_chain_length=configuration_table[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=MIN_MATCH-1,e.match_available=0,e.ins_h=0};function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED$2,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(HEAP_SIZE*2),this.dyn_dtree=new Uint16Array((2*D_CODES+1)*2),this.bl_tree=new Uint16Array((2*BL_CODES+1)*2),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(MAX_BITS+1),this.heap=new Uint16Array(2*L_CODES+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*L_CODES+1),zero(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const deflateStateCheck=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==INIT_STATE&&t.status!==GZIP_STATE&&t.status!==EXTRA_STATE&&t.status!==NAME_STATE&&t.status!==COMMENT_STATE&&t.status!==HCRC_STATE&&t.status!==BUSY_STATE&&t.status!==FINISH_STATE?1:0},deflateResetKeep=e=>{if(deflateStateCheck(e))return err(e,Z_STREAM_ERROR$2);e.total_in=e.total_out=0,e.data_type=Z_UNKNOWN;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?GZIP_STATE:t.wrap?INIT_STATE:BUSY_STATE,e.adler=t.wrap===2?0:1,t.last_flush=-2,_tr_init(t),Z_OK$3},deflateReset=e=>{const t=deflateResetKeep(e);return t===Z_OK$3&&lm_init(e.state),t},deflateSetHeader=(e,t)=>deflateStateCheck(e)||e.state.wrap!==2?Z_STREAM_ERROR$2:(e.state.gzhead=t,Z_OK$3),deflateInit2=(e,t,r,n,a,s)=>{if(!e)return Z_STREAM_ERROR$2;let o=1;if(t===Z_DEFAULT_COMPRESSION$1&&(t=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),a<1||a>MAX_MEM_LEVEL||r!==Z_DEFLATED$2||n<8||n>15||t<0||t>9||s<0||s>Z_FIXED||n===8&&o!==1)return err(e,Z_STREAM_ERROR$2);n===8&&(n=9);const l=new DeflateState;return e.state=l,l.strm=e,l.status=INIT_STATE,l.wrap=o,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+MIN_MATCH-1)/MIN_MATCH),l.window=new Uint8Array(l.w_size*2),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=l.lit_bufsize*4,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=(l.lit_bufsize-1)*3,l.level=t,l.strategy=s,l.method=r,deflateReset(e)},deflateInit=(e,t)=>deflateInit2(e,t,Z_DEFLATED$2,MAX_WBITS$1,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY$1),deflate$2=(e,t)=>{if(deflateStateCheck(e)||t>Z_BLOCK$1||t<0)return e?err(e,Z_STREAM_ERROR$2):Z_STREAM_ERROR$2;const r=e.state;if(!e.output||e.avail_in!==0&&!e.input||r.status===FINISH_STATE&&t!==Z_FINISH$3)return err(e,e.avail_out===0?Z_BUF_ERROR$1:Z_STREAM_ERROR$2);const n=r.last_flush;if(r.last_flush=t,r.pending!==0){if(flush_pending(e),e.avail_out===0)return r.last_flush=-1,Z_OK$3}else if(e.avail_in===0&&rank(t)<=rank(n)&&t!==Z_FINISH$3)return err(e,Z_BUF_ERROR$1);if(r.status===FINISH_STATE&&e.avail_in!==0)return err(e,Z_BUF_ERROR$1);if(r.status===INIT_STATE&&r.wrap===0&&(r.status=BUSY_STATE),r.status===INIT_STATE){let a=Z_DEFLATED$2+(r.w_bits-8<<4)<<8,s=-1;if(r.strategy>=Z_HUFFMAN_ONLY||r.level<2?s=0:r.level<6?s=1:r.level===6?s=2:s=3,a|=s<<6,r.strstart!==0&&(a|=PRESET_DICT),a+=31-a%31,putShortMSB(r,a),r.strstart!==0&&(putShortMSB(r,e.adler>>>16),putShortMSB(r,e.adler&65535)),e.adler=1,r.status=BUSY_STATE,flush_pending(e),r.pending!==0)return r.last_flush=-1,Z_OK$3}if(r.status===GZIP_STATE){if(e.adler=0,put_byte(r,31),put_byte(r,139),put_byte(r,8),r.gzhead)put_byte(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),put_byte(r,r.gzhead.time&255),put_byte(r,r.gzhead.time>>8&255),put_byte(r,r.gzhead.time>>16&255),put_byte(r,r.gzhead.time>>24&255),put_byte(r,r.level===9?2:r.strategy>=Z_HUFFMAN_ONLY||r.level<2?4:0),put_byte(r,r.gzhead.os&255),r.gzhead.extra&&r.gzhead.extra.length&&(put_byte(r,r.gzhead.extra.length&255),put_byte(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=crc32_1(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=EXTRA_STATE;else if(put_byte(r,0),put_byte(r,0),put_byte(r,0),put_byte(r,0),put_byte(r,0),put_byte(r,r.level===9?2:r.strategy>=Z_HUFFMAN_ONLY||r.level<2?4:0),put_byte(r,OS_CODE),r.status=BUSY_STATE,flush_pending(e),r.pending!==0)return r.last_flush=-1,Z_OK$3}if(r.status===EXTRA_STATE){if(r.gzhead.extra){let a=r.pending,s=(r.gzhead.extra.length&65535)-r.gzindex;for(;r.pending+s>r.pending_buf_size;){let l=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+l),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex+=l,flush_pending(e),r.pending!==0)return r.last_flush=-1,Z_OK$3;a=0,s-=l}let o=new Uint8Array(r.gzhead.extra);r.pending_buf.set(o.subarray(r.gzindex,r.gzindex+s),r.pending),r.pending+=s,r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex=0}r.status=NAME_STATE}if(r.status===NAME_STATE){if(r.gzhead.name){let a=r.pending,s;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1(e.adler,r.pending_buf,r.pending-a,a)),flush_pending(e),r.pending!==0)return r.last_flush=-1,Z_OK$3;a=0}r.gzindex<r.gzhead.name.length?s=r.gzhead.name.charCodeAt(r.gzindex++)&255:s=0,put_byte(r,s)}while(s!==0);r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex=0}r.status=COMMENT_STATE}if(r.status===COMMENT_STATE){if(r.gzhead.comment){let a=r.pending,s;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1(e.adler,r.pending_buf,r.pending-a,a)),flush_pending(e),r.pending!==0)return r.last_flush=-1,Z_OK$3;a=0}r.gzindex<r.gzhead.comment.length?s=r.gzhead.comment.charCodeAt(r.gzindex++)&255:s=0,put_byte(r,s)}while(s!==0);r.gzhead.hcrc&&r.pending>a&&(e.adler=crc32_1(e.adler,r.pending_buf,r.pending-a,a))}r.status=HCRC_STATE}if(r.status===HCRC_STATE){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(flush_pending(e),r.pending!==0))return r.last_flush=-1,Z_OK$3;put_byte(r,e.adler&255),put_byte(r,e.adler>>8&255),e.adler=0}if(r.status=BUSY_STATE,flush_pending(e),r.pending!==0)return r.last_flush=-1,Z_OK$3}if(e.avail_in!==0||r.lookahead!==0||t!==Z_NO_FLUSH$2&&r.status!==FINISH_STATE){let a=r.level===0?deflate_stored(r,t):r.strategy===Z_HUFFMAN_ONLY?deflate_huff(r,t):r.strategy===Z_RLE?deflate_rle(r,t):configuration_table[r.level].func(r,t);if((a===BS_FINISH_STARTED||a===BS_FINISH_DONE)&&(r.status=FINISH_STATE),a===BS_NEED_MORE||a===BS_FINISH_STARTED)return e.avail_out===0&&(r.last_flush=-1),Z_OK$3;if(a===BS_BLOCK_DONE&&(t===Z_PARTIAL_FLUSH?_tr_align(r):t!==Z_BLOCK$1&&(_tr_stored_block(r,0,0,!1),t===Z_FULL_FLUSH$1&&(zero(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),flush_pending(e),e.avail_out===0))return r.last_flush=-1,Z_OK$3}return t!==Z_FINISH$3?Z_OK$3:r.wrap<=0?Z_STREAM_END$3:(r.wrap===2?(put_byte(r,e.adler&255),put_byte(r,e.adler>>8&255),put_byte(r,e.adler>>16&255),put_byte(r,e.adler>>24&255),put_byte(r,e.total_in&255),put_byte(r,e.total_in>>8&255),put_byte(r,e.total_in>>16&255),put_byte(r,e.total_in>>24&255)):(putShortMSB(r,e.adler>>>16),putShortMSB(r,e.adler&65535)),flush_pending(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?Z_OK$3:Z_STREAM_END$3)},deflateEnd=e=>{if(deflateStateCheck(e))return Z_STREAM_ERROR$2;const t=e.state.status;return e.state=null,t===BUSY_STATE?err(e,Z_DATA_ERROR$2):Z_OK$3},deflateSetDictionary=(e,t)=>{let r=t.length;if(deflateStateCheck(e))return Z_STREAM_ERROR$2;const n=e.state,a=n.wrap;if(a===2||a===1&&n.status!==INIT_STATE||n.lookahead)return Z_STREAM_ERROR$2;if(a===1&&(e.adler=adler32_1(e.adler,t,r,0)),n.wrap=0,r>=n.w_size){a===0&&(zero(n.head),n.strstart=0,n.block_start=0,n.insert=0);let f=new Uint8Array(n.w_size);f.set(t.subarray(r-n.w_size,r),0),t=f,r=n.w_size}const s=e.avail_in,o=e.next_in,l=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,fill_window(n);n.lookahead>=MIN_MATCH;){let f=n.strstart,h=n.lookahead-(MIN_MATCH-1);do n.ins_h=HASH(n,n.ins_h,n.window[f+MIN_MATCH-1]),n.prev[f&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=f,f++;while(--h);n.strstart=f,n.lookahead=MIN_MATCH-1,fill_window(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=MIN_MATCH-1,n.match_available=0,e.next_in=o,e.input=l,e.avail_in=s,n.wrap=a,Z_OK$3};var deflateInit_1=deflateInit,deflateInit2_1=deflateInit2,deflateReset_1=deflateReset,deflateResetKeep_1=deflateResetKeep,deflateSetHeader_1=deflateSetHeader,deflate_2$1=deflate$2,deflateEnd_1=deflateEnd,deflateSetDictionary_1=deflateSetDictionary,deflateInfo="pako deflate (from Nodeca project)",deflate_1$2={deflateInit:deflateInit_1,deflateInit2:deflateInit2_1,deflateReset:deflateReset_1,deflateResetKeep:deflateResetKeep_1,deflateSetHeader:deflateSetHeader_1,deflate:deflate_2$1,deflateEnd:deflateEnd_1,deflateSetDictionary:deflateSetDictionary_1,deflateInfo};const _has=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var assign=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(const n in r)_has(r,n)&&(e[n]=r[n])}}return e},flattenChunks=e=>{let t=0;for(let n=0,a=e.length;n<a;n++)t+=e[n].length;const r=new Uint8Array(t);for(let n=0,a=0,s=e.length;n<s;n++){let o=e[n];r.set(o,a),a+=o.length}return r},common={assign,flattenChunks};let STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{STR_APPLY_UIA_OK=!1}const _utf8len=new Uint8Array(256);for(let e=0;e<256;e++)_utf8len[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;_utf8len[254]=_utf8len[254]=1;var string2buf=e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,r,n,a,s,o=e.length,l=0;for(a=0;a<o;a++)r=e.charCodeAt(a),(r&64512)===55296&&a+1<o&&(n=e.charCodeAt(a+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),a++)),l+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(l),s=0,a=0;s<l;a++)r=e.charCodeAt(a),(r&64512)===55296&&a+1<o&&(n=e.charCodeAt(a+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),a++)),r<128?t[s++]=r:r<2048?(t[s++]=192|r>>>6,t[s++]=128|r&63):r<65536?(t[s++]=224|r>>>12,t[s++]=128|r>>>6&63,t[s++]=128|r&63):(t[s++]=240|r>>>18,t[s++]=128|r>>>12&63,t[s++]=128|r>>>6&63,t[s++]=128|r&63);return t};const buf2binstring=(e,t)=>{if(t<65534&&e.subarray&&STR_APPLY_UIA_OK)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let r="";for(let n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r};var buf2string=(e,t)=>{const r=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let n,a;const s=new Array(r*2);for(a=0,n=0;n<r;){let o=e[n++];if(o<128){s[a++]=o;continue}let l=_utf8len[o];if(l>4){s[a++]=65533,n+=l-1;continue}for(o&=l===2?31:l===3?15:7;l>1&&n<r;)o=o<<6|e[n++]&63,l--;if(l>1){s[a++]=65533;continue}o<65536?s[a++]=o:(o-=65536,s[a++]=55296|o>>10&1023,s[a++]=56320|o&1023)}return buf2binstring(s,a)},utf8border=(e,t)=>{t=t||e.length,t>e.length&&(t=e.length);let r=t-1;for(;r>=0&&(e[r]&192)===128;)r--;return r<0||r===0?t:r+_utf8len[e[r]]>t?r:t},strings={string2buf,buf2string,utf8border};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream=ZStream;const toString$1$1=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$1,Z_SYNC_FLUSH,Z_FULL_FLUSH,Z_FINISH:Z_FINISH$2,Z_OK:Z_OK$2,Z_STREAM_END:Z_STREAM_END$2,Z_DEFAULT_COMPRESSION,Z_DEFAULT_STRATEGY,Z_DEFLATED:Z_DEFLATED$1}=constants$2;function Deflate$1(e){this.options=common.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let r=deflate_1$2.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==Z_OK$2)throw new Error(messages[r]);if(t.header&&deflate_1$2.deflateSetHeader(this.strm,t.header),t.dictionary){let n;if(typeof t.dictionary=="string"?n=strings.string2buf(t.dictionary):toString$1$1.call(t.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(t.dictionary):n=t.dictionary,r=deflate_1$2.deflateSetDictionary(this.strm,n),r!==Z_OK$2)throw new Error(messages[r]);this._dict_set=!0}}Deflate$1.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize;let a,s;if(this.ended)return!1;for(t===~~t?s=t:s=t===!0?Z_FINISH$2:Z_NO_FLUSH$1,typeof e=="string"?r.input=strings.string2buf(e):toString$1$1.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){if(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(s===Z_SYNC_FLUSH||s===Z_FULL_FLUSH)&&r.avail_out<=6){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(a=deflate_1$2.deflate(r,s),a===Z_STREAM_END$2)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),a=deflate_1$2.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===Z_OK$2;if(r.avail_out===0){this.onData(r.output);continue}if(s>0&&r.next_out>0){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(r.avail_in===0)break}return!0};Deflate$1.prototype.onData=function(e){this.chunks.push(e)};Deflate$1.prototype.onEnd=function(e){e===Z_OK$2&&(this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function deflate$1(e,t){const r=new Deflate$1(t);if(r.push(e,!0),r.err)throw r.msg||messages[r.err];return r.result}function deflateRaw$1(e,t){return t=t||{},t.raw=!0,deflate$1(e,t)}function gzip$1(e,t){return t=t||{},t.gzip=!0,deflate$1(e,t)}var Deflate_1$1=Deflate$1,deflate_2=deflate$1,deflateRaw_1$1=deflateRaw$1,gzip_1$1=gzip$1,constants$1=constants$2,deflate_1$1={Deflate:Deflate_1$1,deflate:deflate_2,deflateRaw:deflateRaw_1$1,gzip:gzip_1$1,constants:constants$1};const BAD$1=16209,TYPE$1=16191;var inffast=function(t,r){let n,a,s,o,l,f,h,c,u,d,g,p,m,y,x,E,_,w,M,I,k,v,S,b;const A=t.state;n=t.next_in,S=t.input,a=n+(t.avail_in-5),s=t.next_out,b=t.output,o=s-(r-t.avail_out),l=s+(t.avail_out-257),f=A.dmax,h=A.wsize,c=A.whave,u=A.wnext,d=A.window,g=A.hold,p=A.bits,m=A.lencode,y=A.distcode,x=(1<<A.lenbits)-1,E=(1<<A.distbits)-1;e:do{p<15&&(g+=S[n++]<<p,p+=8,g+=S[n++]<<p,p+=8),_=m[g&x];t:for(;;){if(w=_>>>24,g>>>=w,p-=w,w=_>>>16&255,w===0)b[s++]=_&65535;else if(w&16){M=_&65535,w&=15,w&&(p<w&&(g+=S[n++]<<p,p+=8),M+=g&(1<<w)-1,g>>>=w,p-=w),p<15&&(g+=S[n++]<<p,p+=8,g+=S[n++]<<p,p+=8),_=y[g&E];r:for(;;){if(w=_>>>24,g>>>=w,p-=w,w=_>>>16&255,w&16){if(I=_&65535,w&=15,p<w&&(g+=S[n++]<<p,p+=8,p<w&&(g+=S[n++]<<p,p+=8)),I+=g&(1<<w)-1,I>f){t.msg="invalid distance too far back",A.mode=BAD$1;break e}if(g>>>=w,p-=w,w=s-o,I>w){if(w=I-w,w>c&&A.sane){t.msg="invalid distance too far back",A.mode=BAD$1;break e}if(k=0,v=d,u===0){if(k+=h-w,w<M){M-=w;do b[s++]=d[k++];while(--w);k=s-I,v=b}}else if(u<w){if(k+=h+u-w,w-=u,w<M){M-=w;do b[s++]=d[k++];while(--w);if(k=0,u<M){w=u,M-=w;do b[s++]=d[k++];while(--w);k=s-I,v=b}}}else if(k+=u-w,w<M){M-=w;do b[s++]=d[k++];while(--w);k=s-I,v=b}for(;M>2;)b[s++]=v[k++],b[s++]=v[k++],b[s++]=v[k++],M-=3;M&&(b[s++]=v[k++],M>1&&(b[s++]=v[k++]))}else{k=s-I;do b[s++]=b[k++],b[s++]=b[k++],b[s++]=b[k++],M-=3;while(M>2);M&&(b[s++]=b[k++],M>1&&(b[s++]=b[k++]))}}else if(w&64){t.msg="invalid distance code",A.mode=BAD$1;break e}else{_=y[(_&65535)+(g&(1<<w)-1)];continue r}break}}else if(w&64)if(w&32){A.mode=TYPE$1;break e}else{t.msg="invalid literal/length code",A.mode=BAD$1;break e}else{_=m[(_&65535)+(g&(1<<w)-1)];continue t}break}}while(n<a&&s<l);M=p>>3,n-=M,p-=M<<3,g&=(1<<p)-1,t.next_in=n,t.next_out=s,t.avail_in=n<a?5+(a-n):5-(n-a),t.avail_out=s<l?257+(l-s):257-(s-l),A.hold=g,A.bits=p};const MAXBITS=15,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,CODES$1=0,LENS$1=1,DISTS$1=2,lbase=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lext=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dbase=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dext=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),inflate_table=(e,t,r,n,a,s,o,l)=>{const f=l.bits;let h=0,c=0,u=0,d=0,g=0,p=0,m=0,y=0,x=0,E=0,_,w,M,I,k,v=null,S;const b=new Uint16Array(MAXBITS+1),A=new Uint16Array(MAXBITS+1);let T=null,D,P,F;for(h=0;h<=MAXBITS;h++)b[h]=0;for(c=0;c<n;c++)b[t[r+c]]++;for(g=f,d=MAXBITS;d>=1&&b[d]===0;d--);if(g>d&&(g=d),d===0)return a[s++]=1<<24|64<<16|0,a[s++]=1<<24|64<<16|0,l.bits=1,0;for(u=1;u<d&&b[u]===0;u++);for(g<u&&(g=u),y=1,h=1;h<=MAXBITS;h++)if(y<<=1,y-=b[h],y<0)return-1;if(y>0&&(e===CODES$1||d!==1))return-1;for(A[1]=0,h=1;h<MAXBITS;h++)A[h+1]=A[h]+b[h];for(c=0;c<n;c++)t[r+c]!==0&&(o[A[t[r+c]]++]=c);if(e===CODES$1?(v=T=o,S=20):e===LENS$1?(v=lbase,T=lext,S=257):(v=dbase,T=dext,S=0),E=0,c=0,h=u,k=s,p=g,m=0,M=-1,x=1<<g,I=x-1,e===LENS$1&&x>ENOUGH_LENS$1||e===DISTS$1&&x>ENOUGH_DISTS$1)return 1;for(;;){D=h-m,o[c]+1<S?(P=0,F=o[c]):o[c]>=S?(P=T[o[c]-S],F=v[o[c]-S]):(P=32+64,F=0),_=1<<h-m,w=1<<p,u=w;do w-=_,a[k+(E>>m)+w]=D<<24|P<<16|F|0;while(w!==0);for(_=1<<h-1;E&_;)_>>=1;if(_!==0?(E&=_-1,E+=_):E=0,c++,--b[h]===0){if(h===d)break;h=t[r+o[c]]}if(h>g&&(E&I)!==M){for(m===0&&(m=g),k+=u,p=h-m,y=1<<p;p+m<d&&(y-=b[p+m],!(y<=0));)p++,y<<=1;if(x+=1<<p,e===LENS$1&&x>ENOUGH_LENS$1||e===DISTS$1&&x>ENOUGH_DISTS$1)return 1;M=E&I,a[M]=g<<24|p<<16|k-s|0}}return E!==0&&(a[k+E]=h-m<<24|64<<16|0),l.bits=g,0};var inftrees=inflate_table;const CODES=0,LENS=1,DISTS=2,{Z_FINISH:Z_FINISH$1,Z_BLOCK,Z_TREES,Z_OK:Z_OK$1,Z_STREAM_END:Z_STREAM_END$1,Z_NEED_DICT:Z_NEED_DICT$1,Z_STREAM_ERROR:Z_STREAM_ERROR$1,Z_DATA_ERROR:Z_DATA_ERROR$1,Z_MEM_ERROR:Z_MEM_ERROR$1,Z_BUF_ERROR,Z_DEFLATED}=constants$2,HEAD=16180,FLAGS=16181,TIME=16182,OS=16183,EXLEN=16184,EXTRA=16185,NAME=16186,COMMENT=16187,HCRC=16188,DICTID=16189,DICT=16190,TYPE=16191,TYPEDO=16192,STORED=16193,COPY_=16194,COPY=16195,TABLE=16196,LENLENS=16197,CODELENS=16198,LEN_=16199,LEN=16200,LENEXT=16201,DIST=16202,DISTEXT=16203,MATCH=16204,LIT=16205,CHECK=16206,LENGTH=16207,DONE=16208,BAD=16209,MEM=16210,SYNC=16211,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS,zswap32=e=>(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24);function InflateState(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const inflateStateCheck=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<HEAD||t.mode>SYNC?1:0},inflateResetKeep=e=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=t.wrap&1),t.mode=HEAD,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(ENOUGH_LENS),t.distcode=t.distdyn=new Int32Array(ENOUGH_DISTS),t.sane=1,t.back=-1,Z_OK$1},inflateReset=e=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,inflateResetKeep(e)},inflateReset2=(e,t)=>{let r;if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const n=e.state;return t<0?(r=0,t=-t):(r=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?Z_STREAM_ERROR$1:(n.window!==null&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,inflateReset(e))},inflateInit2=(e,t)=>{if(!e)return Z_STREAM_ERROR$1;const r=new InflateState;e.state=r,r.strm=e,r.window=null,r.mode=HEAD;const n=inflateReset2(e,t);return n!==Z_OK$1&&(e.state=null),n},inflateInit=e=>inflateInit2(e,DEF_WBITS);let virgin=!0,lenfix,distfix;const fixedtables=e=>{if(virgin){lenfix=new Int32Array(512),distfix=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(inftrees(LENS,e.lens,0,288,lenfix,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;inftrees(DISTS,e.lens,0,32,distfix,0,e.work,{bits:5}),virgin=!1}e.lencode=lenfix,e.lenbits=9,e.distcode=distfix,e.distbits=5},updatewindow=(e,t,r,n)=>{let a;const s=e.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(s.window.set(t.subarray(r-s.wsize,r),0),s.wnext=0,s.whave=s.wsize):(a=s.wsize-s.wnext,a>n&&(a=n),s.window.set(t.subarray(r-n,r-n+a),s.wnext),n-=a,n?(s.window.set(t.subarray(r-n,r),0),s.wnext=n,s.whave=s.wsize):(s.wnext+=a,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=a))),0},inflate$2=(e,t)=>{let r,n,a,s,o,l,f,h,c,u,d,g,p,m,y=0,x,E,_,w,M,I,k,v;const S=new Uint8Array(4);let b,A;const T=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(inflateStateCheck(e)||!e.output||!e.input&&e.avail_in!==0)return Z_STREAM_ERROR$1;r=e.state,r.mode===TYPE&&(r.mode=TYPEDO),o=e.next_out,a=e.output,f=e.avail_out,s=e.next_in,n=e.input,l=e.avail_in,h=r.hold,c=r.bits,u=l,d=f,v=Z_OK$1;e:for(;;)switch(r.mode){case HEAD:if(r.wrap===0){r.mode=TYPEDO;break}for(;c<16;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}if(r.wrap&2&&h===35615){r.wbits===0&&(r.wbits=15),r.check=0,S[0]=h&255,S[1]=h>>>8&255,r.check=crc32_1(r.check,S,2,0),h=0,c=0,r.mode=FLAGS;break}if(r.head&&(r.head.done=!1),!(r.wrap&1)||(((h&255)<<8)+(h>>8))%31){e.msg="incorrect header check",r.mode=BAD;break}if((h&15)!==Z_DEFLATED){e.msg="unknown compression method",r.mode=BAD;break}if(h>>>=4,c-=4,k=(h&15)+8,r.wbits===0&&(r.wbits=k),k>15||k>r.wbits){e.msg="invalid window size",r.mode=BAD;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=h&512?DICTID:TYPE,h=0,c=0;break;case FLAGS:for(;c<16;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}if(r.flags=h,(r.flags&255)!==Z_DEFLATED){e.msg="unknown compression method",r.mode=BAD;break}if(r.flags&57344){e.msg="unknown header flags set",r.mode=BAD;break}r.head&&(r.head.text=h>>8&1),r.flags&512&&r.wrap&4&&(S[0]=h&255,S[1]=h>>>8&255,r.check=crc32_1(r.check,S,2,0)),h=0,c=0,r.mode=TIME;case TIME:for(;c<32;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}r.head&&(r.head.time=h),r.flags&512&&r.wrap&4&&(S[0]=h&255,S[1]=h>>>8&255,S[2]=h>>>16&255,S[3]=h>>>24&255,r.check=crc32_1(r.check,S,4,0)),h=0,c=0,r.mode=OS;case OS:for(;c<16;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}r.head&&(r.head.xflags=h&255,r.head.os=h>>8),r.flags&512&&r.wrap&4&&(S[0]=h&255,S[1]=h>>>8&255,r.check=crc32_1(r.check,S,2,0)),h=0,c=0,r.mode=EXLEN;case EXLEN:if(r.flags&1024){for(;c<16;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}r.length=h,r.head&&(r.head.extra_len=h),r.flags&512&&r.wrap&4&&(S[0]=h&255,S[1]=h>>>8&255,r.check=crc32_1(r.check,S,2,0)),h=0,c=0}else r.head&&(r.head.extra=null);r.mode=EXTRA;case EXTRA:if(r.flags&1024&&(g=r.length,g>l&&(g=l),g&&(r.head&&(k=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(s,s+g),k)),r.flags&512&&r.wrap&4&&(r.check=crc32_1(r.check,n,g,s)),l-=g,s+=g,r.length-=g),r.length))break e;r.length=0,r.mode=NAME;case NAME:if(r.flags&2048){if(l===0)break e;g=0;do k=n[s+g++],r.head&&k&&r.length<65536&&(r.head.name+=String.fromCharCode(k));while(k&&g<l);if(r.flags&512&&r.wrap&4&&(r.check=crc32_1(r.check,n,g,s)),l-=g,s+=g,k)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=COMMENT;case COMMENT:if(r.flags&4096){if(l===0)break e;g=0;do k=n[s+g++],r.head&&k&&r.length<65536&&(r.head.comment+=String.fromCharCode(k));while(k&&g<l);if(r.flags&512&&r.wrap&4&&(r.check=crc32_1(r.check,n,g,s)),l-=g,s+=g,k)break e}else r.head&&(r.head.comment=null);r.mode=HCRC;case HCRC:if(r.flags&512){for(;c<16;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}if(r.wrap&4&&h!==(r.check&65535)){e.msg="header crc mismatch",r.mode=BAD;break}h=0,c=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=TYPE;break;case DICTID:for(;c<32;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}e.adler=r.check=zswap32(h),h=0,c=0,r.mode=DICT;case DICT:if(r.havedict===0)return e.next_out=o,e.avail_out=f,e.next_in=s,e.avail_in=l,r.hold=h,r.bits=c,Z_NEED_DICT$1;e.adler=r.check=1,r.mode=TYPE;case TYPE:if(t===Z_BLOCK||t===Z_TREES)break e;case TYPEDO:if(r.last){h>>>=c&7,c-=c&7,r.mode=CHECK;break}for(;c<3;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}switch(r.last=h&1,h>>>=1,c-=1,h&3){case 0:r.mode=STORED;break;case 1:if(fixedtables(r),r.mode=LEN_,t===Z_TREES){h>>>=2,c-=2;break e}break;case 2:r.mode=TABLE;break;case 3:e.msg="invalid block type",r.mode=BAD}h>>>=2,c-=2;break;case STORED:for(h>>>=c&7,c-=c&7;c<32;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}if((h&65535)!==(h>>>16^65535)){e.msg="invalid stored block lengths",r.mode=BAD;break}if(r.length=h&65535,h=0,c=0,r.mode=COPY_,t===Z_TREES)break e;case COPY_:r.mode=COPY;case COPY:if(g=r.length,g){if(g>l&&(g=l),g>f&&(g=f),g===0)break e;a.set(n.subarray(s,s+g),o),l-=g,s+=g,f-=g,o+=g,r.length-=g;break}r.mode=TYPE;break;case TABLE:for(;c<14;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}if(r.nlen=(h&31)+257,h>>>=5,c-=5,r.ndist=(h&31)+1,h>>>=5,c-=5,r.ncode=(h&15)+4,h>>>=4,c-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=BAD;break}r.have=0,r.mode=LENLENS;case LENLENS:for(;r.have<r.ncode;){for(;c<3;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}r.lens[T[r.have++]]=h&7,h>>>=3,c-=3}for(;r.have<19;)r.lens[T[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,b={bits:r.lenbits},v=inftrees(CODES,r.lens,0,19,r.lencode,0,r.work,b),r.lenbits=b.bits,v){e.msg="invalid code lengths set",r.mode=BAD;break}r.have=0,r.mode=CODELENS;case CODELENS:for(;r.have<r.nlen+r.ndist;){for(;y=r.lencode[h&(1<<r.lenbits)-1],x=y>>>24,E=y>>>16&255,_=y&65535,!(x<=c);){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}if(_<16)h>>>=x,c-=x,r.lens[r.have++]=_;else{if(_===16){for(A=x+2;c<A;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}if(h>>>=x,c-=x,r.have===0){e.msg="invalid bit length repeat",r.mode=BAD;break}k=r.lens[r.have-1],g=3+(h&3),h>>>=2,c-=2}else if(_===17){for(A=x+3;c<A;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}h>>>=x,c-=x,k=0,g=3+(h&7),h>>>=3,c-=3}else{for(A=x+7;c<A;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}h>>>=x,c-=x,k=0,g=11+(h&127),h>>>=7,c-=7}if(r.have+g>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=BAD;break}for(;g--;)r.lens[r.have++]=k}}if(r.mode===BAD)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=BAD;break}if(r.lenbits=9,b={bits:r.lenbits},v=inftrees(LENS,r.lens,0,r.nlen,r.lencode,0,r.work,b),r.lenbits=b.bits,v){e.msg="invalid literal/lengths set",r.mode=BAD;break}if(r.distbits=6,r.distcode=r.distdyn,b={bits:r.distbits},v=inftrees(DISTS,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,b),r.distbits=b.bits,v){e.msg="invalid distances set",r.mode=BAD;break}if(r.mode=LEN_,t===Z_TREES)break e;case LEN_:r.mode=LEN;case LEN:if(l>=6&&f>=258){e.next_out=o,e.avail_out=f,e.next_in=s,e.avail_in=l,r.hold=h,r.bits=c,inffast(e,d),o=e.next_out,a=e.output,f=e.avail_out,s=e.next_in,n=e.input,l=e.avail_in,h=r.hold,c=r.bits,r.mode===TYPE&&(r.back=-1);break}for(r.back=0;y=r.lencode[h&(1<<r.lenbits)-1],x=y>>>24,E=y>>>16&255,_=y&65535,!(x<=c);){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}if(E&&!(E&240)){for(w=x,M=E,I=_;y=r.lencode[I+((h&(1<<w+M)-1)>>w)],x=y>>>24,E=y>>>16&255,_=y&65535,!(w+x<=c);){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}h>>>=w,c-=w,r.back+=w}if(h>>>=x,c-=x,r.back+=x,r.length=_,E===0){r.mode=LIT;break}if(E&32){r.back=-1,r.mode=TYPE;break}if(E&64){e.msg="invalid literal/length code",r.mode=BAD;break}r.extra=E&15,r.mode=LENEXT;case LENEXT:if(r.extra){for(A=r.extra;c<A;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}r.length+=h&(1<<r.extra)-1,h>>>=r.extra,c-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=DIST;case DIST:for(;y=r.distcode[h&(1<<r.distbits)-1],x=y>>>24,E=y>>>16&255,_=y&65535,!(x<=c);){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}if(!(E&240)){for(w=x,M=E,I=_;y=r.distcode[I+((h&(1<<w+M)-1)>>w)],x=y>>>24,E=y>>>16&255,_=y&65535,!(w+x<=c);){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}h>>>=w,c-=w,r.back+=w}if(h>>>=x,c-=x,r.back+=x,E&64){e.msg="invalid distance code",r.mode=BAD;break}r.offset=_,r.extra=E&15,r.mode=DISTEXT;case DISTEXT:if(r.extra){for(A=r.extra;c<A;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}r.offset+=h&(1<<r.extra)-1,h>>>=r.extra,c-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=BAD;break}r.mode=MATCH;case MATCH:if(f===0)break e;if(g=d-f,r.offset>g){if(g=r.offset-g,g>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=BAD;break}g>r.wnext?(g-=r.wnext,p=r.wsize-g):p=r.wnext-g,g>r.length&&(g=r.length),m=r.window}else m=a,p=o-r.offset,g=r.length;g>f&&(g=f),f-=g,r.length-=g;do a[o++]=m[p++];while(--g);r.length===0&&(r.mode=LEN);break;case LIT:if(f===0)break e;a[o++]=r.length,f--,r.mode=LEN;break;case CHECK:if(r.wrap){for(;c<32;){if(l===0)break e;l--,h|=n[s++]<<c,c+=8}if(d-=f,e.total_out+=d,r.total+=d,r.wrap&4&&d&&(e.adler=r.check=r.flags?crc32_1(r.check,a,d,o-d):adler32_1(r.check,a,d,o-d)),d=f,r.wrap&4&&(r.flags?h:zswap32(h))!==r.check){e.msg="incorrect data check",r.mode=BAD;break}h=0,c=0}r.mode=LENGTH;case LENGTH:if(r.wrap&&r.flags){for(;c<32;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}if(r.wrap&4&&h!==(r.total&4294967295)){e.msg="incorrect length check",r.mode=BAD;break}h=0,c=0}r.mode=DONE;case DONE:v=Z_STREAM_END$1;break e;case BAD:v=Z_DATA_ERROR$1;break e;case MEM:return Z_MEM_ERROR$1;case SYNC:default:return Z_STREAM_ERROR$1}return e.next_out=o,e.avail_out=f,e.next_in=s,e.avail_in=l,r.hold=h,r.bits=c,(r.wsize||d!==e.avail_out&&r.mode<BAD&&(r.mode<CHECK||t!==Z_FINISH$1))&&updatewindow(e,e.output,e.next_out,d-e.avail_out),u-=e.avail_in,d-=e.avail_out,e.total_in+=u,e.total_out+=d,r.total+=d,r.wrap&4&&d&&(e.adler=r.check=r.flags?crc32_1(r.check,a,d,e.next_out-d):adler32_1(r.check,a,d,e.next_out-d)),e.data_type=r.bits+(r.last?64:0)+(r.mode===TYPE?128:0)+(r.mode===LEN_||r.mode===COPY_?256:0),(u===0&&d===0||t===Z_FINISH$1)&&v===Z_OK$1&&(v=Z_BUF_ERROR),v},inflateEnd=e=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;let t=e.state;return t.window&&(t.window=null),e.state=null,Z_OK$1},inflateGetHeader=(e,t)=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const r=e.state;return r.wrap&2?(r.head=t,t.done=!1,Z_OK$1):Z_STREAM_ERROR$1},inflateSetDictionary=(e,t)=>{const r=t.length;let n,a,s;return inflateStateCheck(e)||(n=e.state,n.wrap!==0&&n.mode!==DICT)?Z_STREAM_ERROR$1:n.mode===DICT&&(a=1,a=adler32_1(a,t,r,0),a!==n.check)?Z_DATA_ERROR$1:(s=updatewindow(e,t,r,r),s?(n.mode=MEM,Z_MEM_ERROR$1):(n.havedict=1,Z_OK$1))};var inflateReset_1=inflateReset,inflateReset2_1=inflateReset2,inflateResetKeep_1=inflateResetKeep,inflateInit_1=inflateInit,inflateInit2_1=inflateInit2,inflate_2$1=inflate$2,inflateEnd_1=inflateEnd,inflateGetHeader_1=inflateGetHeader,inflateSetDictionary_1=inflateSetDictionary,inflateInfo="pako inflate (from Nodeca project)",inflate_1$2={inflateReset:inflateReset_1,inflateReset2:inflateReset2_1,inflateResetKeep:inflateResetKeep_1,inflateInit:inflateInit_1,inflateInit2:inflateInit2_1,inflate:inflate_2$1,inflateEnd:inflateEnd_1,inflateGetHeader:inflateGetHeader_1,inflateSetDictionary:inflateSetDictionary_1,inflateInfo};function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader;const toString$4=Object.prototype.toString,{Z_NO_FLUSH,Z_FINISH,Z_OK,Z_STREAM_END,Z_NEED_DICT,Z_STREAM_ERROR,Z_DATA_ERROR,Z_MEM_ERROR}=constants$2;function Inflate$1(e){this.options=common.assign({chunkSize:1024*64,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let r=inflate_1$2.inflateInit2(this.strm,t.windowBits);if(r!==Z_OK)throw new Error(messages[r]);if(this.header=new gzheader,inflate_1$2.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=strings.string2buf(t.dictionary):toString$4.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=inflate_1$2.inflateSetDictionary(this.strm,t.dictionary),r!==Z_OK)))throw new Error(messages[r])}Inflate$1.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize,a=this.options.dictionary;let s,o,l;if(this.ended)return!1;for(t===~~t?o=t:o=t===!0?Z_FINISH:Z_NO_FLUSH,toString$4.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),s=inflate_1$2.inflate(r,o),s===Z_NEED_DICT&&a&&(s=inflate_1$2.inflateSetDictionary(r,a),s===Z_OK?s=inflate_1$2.inflate(r,o):s===Z_DATA_ERROR&&(s=Z_NEED_DICT));r.avail_in>0&&s===Z_STREAM_END&&r.state.wrap>0&&e[r.next_in]!==0;)inflate_1$2.inflateReset(r),s=inflate_1$2.inflate(r,o);switch(s){case Z_STREAM_ERROR:case Z_DATA_ERROR:case Z_NEED_DICT:case Z_MEM_ERROR:return this.onEnd(s),this.ended=!0,!1}if(l=r.avail_out,r.next_out&&(r.avail_out===0||s===Z_STREAM_END))if(this.options.to==="string"){let f=strings.utf8border(r.output,r.next_out),h=r.next_out-f,c=strings.buf2string(r.output,f);r.next_out=h,r.avail_out=n-h,h&&r.output.set(r.output.subarray(f,f+h),0),this.onData(c)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(!(s===Z_OK&&l===0)){if(s===Z_STREAM_END)return s=inflate_1$2.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(r.avail_in===0)break}}return!0};Inflate$1.prototype.onData=function(e){this.chunks.push(e)};Inflate$1.prototype.onEnd=function(e){e===Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function inflate$1(e,t){const r=new Inflate$1(t);if(r.push(e),r.err)throw r.msg||messages[r.err];return r.result}function inflateRaw$1(e,t){return t=t||{},t.raw=!0,inflate$1(e,t)}var Inflate_1$1=Inflate$1,inflate_2=inflate$1,inflateRaw_1$1=inflateRaw$1,ungzip$1=inflate$1,constants=constants$2,inflate_1$1={Inflate:Inflate_1$1,inflate:inflate_2,inflateRaw:inflateRaw_1$1,ungzip:ungzip$1,constants};const{Deflate,deflate,deflateRaw,gzip}=deflate_1$1,{Inflate,inflate,inflateRaw,ungzip}=inflate_1$1;var deflate_1=deflate,Inflate_1=Inflate,inflate_1=inflate;const pngSignature=[137,80,78,71,13,10,26,10],crcTable=[];for(let e=0;e<256;e++){let t=e;for(let r=0;r<8;r++)t&1?t=3988292384^t>>>1:t=t>>>1;crcTable[e]=t}const initialCrc=4294967295;function updateCrc(e,t,r){let n=e;for(let a=0;a<r;a++)n=crcTable[(n^t[a])&255]^n>>>8;return n}function crc(e,t){return(updateCrc(initialCrc,e,t)^initialCrc)>>>0}var ColorType;(function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.GREYSCALE=0]="GREYSCALE",e[e.TRUECOLOUR=2]="TRUECOLOUR",e[e.INDEXED_COLOUR=3]="INDEXED_COLOUR",e[e.GREYSCALE_ALPHA=4]="GREYSCALE_ALPHA",e[e.TRUECOLOUR_ALPHA=6]="TRUECOLOUR_ALPHA"})(ColorType||(ColorType={}));var CompressionMethod;(function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.DEFLATE=0]="DEFLATE"})(CompressionMethod||(CompressionMethod={}));var FilterMethod;(function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.ADAPTIVE=0]="ADAPTIVE"})(FilterMethod||(FilterMethod={}));var InterlaceMethod;(function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.NO_INTERLACE=0]="NO_INTERLACE",e[e.ADAM7=1]="ADAM7"})(InterlaceMethod||(InterlaceMethod={}));const empty=new Uint8Array(0),NULL="\0",uint16=new Uint16Array([255]),uint8=new Uint8Array(uint16.buffer),osIsLittleEndian=uint8[0]===255;class PngDecoder extends IOBuffer$4{constructor(t,r={}){super(t);const{checkCrc:n=!1}=r;this._checkCrc=n,this._inflator=new Inflate_1,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._compressionMethod=CompressionMethod.UNKNOWN,this._filterMethod=FilterMethod.UNKNOWN,this._interlaceMethod=InterlaceMethod.UNKNOWN,this._colorType=-1,this.setBigEndian()}decode(){for(this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(let t=0;t<pngSignature.length;t++)if(this.readUint8()!==pngSignature[t])throw new Error(`wrong PNG signature. Byte at ${t} should be ${pngSignature[t]}.`)}decodeChunk(){const t=this.readUint32(),r=this.readChars(4),n=this.offset;switch(r){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(t);break;case"IDAT":this.decodeIDAT(t);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(t);break;case"iCCP":this.decodeiCCP(t);break;case"tEXt":this.decodetEXt(t);break;case"pHYs":this.decodepHYs();break;default:this.skip(t);break}if(this.offset-n!==t)throw new Error(`Length mismatch while decoding chunk ${r}`);if(this._checkCrc){const a=this.readUint32(),s=t+4,o=crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-s-4,s),s);if(o!==a)throw new Error(`CRC mismatch for chunk ${r}. Expected ${a}, found ${o}`)}else this.skip(4)}decodeIHDR(){const t=this._png;t.width=this.readUint32(),t.height=this.readUint32(),t.depth=checkBitDepth(this.readUint8());const r=this.readUint8();this._colorType=r;let n;switch(r){case ColorType.GREYSCALE:n=1;break;case ColorType.TRUECOLOUR:n=3;break;case ColorType.INDEXED_COLOUR:n=1;break;case ColorType.GREYSCALE_ALPHA:n=2;break;case ColorType.TRUECOLOUR_ALPHA:n=4;break;default:throw new Error(`Unknown color type: ${r}`)}if(this._png.channels=n,this._compressionMethod=this.readUint8(),this._compressionMethod!==CompressionMethod.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(t){if(t%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${t}`);const r=t/3;this._hasPalette=!0;const n=[];this._palette=n;for(let a=0;a<r;a++)n.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(t){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,t)),this.skip(t)}decodetRNS(t){if(this._colorType===3){if(t>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${t} vs ${this._palette.length})`);let r=0;for(;r<t;r++){const n=this.readByte();this._palette[r].push(n)}for(;r<this._palette.length;r++)this._palette[r].push(255)}}decodeiCCP(t){let r="",n;for(;(n=this.readChar())!==NULL;)r+=n;const a=this.readUint8();if(a!==CompressionMethod.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${a}`);const s=this.readBytes(t-r.length-2);this._png.iccEmbeddedProfile={name:r,profile:inflate_1(s)}}decodetEXt(t){let r="",n;for(;(n=this.readChar())!==NULL;)r+=n;this._png.text[r]=this.readChars(t-r.length-1)}decodepHYs(){const t=this.readUint32(),r=this.readUint32(),n=this.readByte();this._png.resolution={x:t,y:r,unit:n}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const t=this._inflator.result;if(this._filterMethod!==FilterMethod.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===InterlaceMethod.NO_INTERLACE)this.decodeInterlaceNull(t);else throw new Error(`Interlace method ${this._interlaceMethod} not supported`)}decodeInterlaceNull(t){const r=this._png.height,n=this._png.channels*this._png.depth/8,a=this._png.width*n,s=new Uint8Array(this._png.height*a);let o=empty,l=0,f,h;for(let c=0;c<r;c++){switch(f=t.subarray(l+1,l+1+a),h=s.subarray(c*a,(c+1)*a),t[l]){case 0:unfilterNone(f,h,a);break;case 1:unfilterSub(f,h,a,n);break;case 2:unfilterUp(f,h,o,a);break;case 3:unfilterAverage(f,h,o,a,n);break;case 4:unfilterPaeth(f,h,o,a,n);break;default:throw new Error(`Unsupported filter: ${t[l]}`)}o=h,l+=a+1}if(this._hasPalette&&(this._png.palette=this._palette),this._png.depth===16){const c=new Uint16Array(s.buffer);if(osIsLittleEndian)for(let u=0;u<c.length;u++)c[u]=swap16(c[u]);this._png.data=c}else this._png.data=s}}function unfilterNone(e,t,r){for(let n=0;n<r;n++)t[n]=e[n]}function unfilterSub(e,t,r,n){let a=0;for(;a<n;a++)t[a]=e[a];for(;a<r;a++)t[a]=e[a]+t[a-n]&255}function unfilterUp(e,t,r,n){let a=0;if(r.length===0)for(;a<n;a++)t[a]=e[a];else for(;a<n;a++)t[a]=e[a]+r[a]&255}function unfilterAverage(e,t,r,n,a){let s=0;if(r.length===0){for(;s<a;s++)t[s]=e[s];for(;s<n;s++)t[s]=e[s]+(t[s-a]>>1)&255}else{for(;s<a;s++)t[s]=e[s]+(r[s]>>1)&255;for(;s<n;s++)t[s]=e[s]+(t[s-a]+r[s]>>1)&255}}function unfilterPaeth(e,t,r,n,a){let s=0;if(r.length===0){for(;s<a;s++)t[s]=e[s];for(;s<n;s++)t[s]=e[s]+t[s-a]&255}else{for(;s<a;s++)t[s]=e[s]+r[s]&255;for(;s<n;s++)t[s]=e[s]+paethPredictor(t[s-a],r[s],r[s-a])&255}}function paethPredictor(e,t,r){const n=e+t-r,a=Math.abs(n-e),s=Math.abs(n-t),o=Math.abs(n-r);return a<=s&&a<=o?e:s<=o?t:r}function swap16(e){return(e&255)<<8|e>>8&255}function checkBitDepth(e){if(e!==1&&e!==2&&e!==4&&e!==8&&e!==16)throw new Error(`invalid bit depth: ${e}`);return e}const defaultZlibOptions={level:3};class PngEncoder extends IOBuffer$4{constructor(t,r={}){super(),this._colorType=ColorType.UNKNOWN,this._zlibOptions=Object.assign({},defaultZlibOptions,r.zlib),this._png=this._checkData(t),this.setBigEndian()}encode(){return this.encodeSignature(),this.encodeIHDR(),this.encodeData(),this.encodeIEND(),this.toArray()}encodeSignature(){this.writeBytes(pngSignature)}encodeIHDR(){this.writeUint32(13),this.writeChars("IHDR"),this.writeUint32(this._png.width),this.writeUint32(this._png.height),this.writeByte(this._png.depth),this.writeByte(this._colorType),this.writeByte(CompressionMethod.DEFLATE),this.writeByte(FilterMethod.ADAPTIVE),this.writeByte(InterlaceMethod.NO_INTERLACE),this.writeCrc(17)}encodeIEND(){this.writeUint32(0),this.writeChars("IEND"),this.writeCrc(4)}encodeIDAT(t){this.writeUint32(t.length),this.writeChars("IDAT"),this.writeBytes(t),this.writeCrc(t.length+4)}encodeData(){const{width:t,height:r,channels:n,depth:a,data:s}=this._png,o=n*t,l=new IOBuffer$4().setBigEndian();let f=0;for(let u=0;u<r;u++)if(l.writeByte(0),a===8)f=writeDataBytes(s,l,o,f);else if(a===16)f=writeDataUint16(s,l,o,f);else throw new Error("unreachable");const h=l.toArray(),c=deflate_1(h,this._zlibOptions);this.encodeIDAT(c)}_checkData(t){const{colorType:r,channels:n,depth:a}=getColorType(t),s={width:checkInteger(t.width,"width"),height:checkInteger(t.height,"height"),channels:n,data:t.data,depth:a,text:{}};this._colorType=r;const o=s.width*s.height*n;if(s.data.length!==o)throw new RangeError(`wrong data size. Found ${s.data.length}, expected ${o}`);return s}writeCrc(t){this.writeUint32(crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-t,t),t))}}function checkInteger(e,t){if(Number.isInteger(e)&&e>0)return e;throw new TypeError(`${t} must be a positive integer`)}function getColorType(e){const{channels:t=4,depth:r=8}=e;if(t!==4&&t!==3&&t!==2&&t!==1)throw new RangeError(`unsupported number of channels: ${t}`);if(r!==8&&r!==16)throw new RangeError(`unsupported bit depth: ${r}`);const n={channels:t,depth:r,colorType:ColorType.UNKNOWN};switch(t){case 4:n.colorType=ColorType.TRUECOLOUR_ALPHA;break;case 3:n.colorType=ColorType.TRUECOLOUR;break;case 1:n.colorType=ColorType.GREYSCALE;break;case 2:n.colorType=ColorType.GREYSCALE_ALPHA;break;default:throw new Error("unsupported number of channels")}return n}function writeDataBytes(e,t,r,n){for(let a=0;a<r;a++)t.writeByte(e[n++]);return n}function writeDataUint16(e,t,r,n){for(let a=0;a<r;a++)t.writeUint16(e[n++]);return n}var ResolutionUnitSpecifier;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.METRE=1]="METRE"})(ResolutionUnitSpecifier||(ResolutionUnitSpecifier={}));function decodePng(e,t){return new PngDecoder(e,t).decode()}function encodePng$1(e,t){return new PngEncoder(e,t).encode()}var encoder={exports:{}};(function(e){function t(n){var a=Math.floor,s=new Array(64),o=new Array(64),l=new Array(64),f=new Array(64),h,c,u,d,g=new Array(65535),p=new Array(65535),m=new Array(64),y=new Array(64),x=[],E=0,_=7,w=new Array(64),M=new Array(64),I=new Array(64),k=new Array(256),v=new Array(2048),S,b=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],A=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],T=[0,1,2,3,4,5,6,7,8,9,10,11],D=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],P=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],F=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],V=[0,1,2,3,4,5,6,7,8,9,10,11],q=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Y=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function ee(B){for(var re=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],ne=0;ne<64;ne++){var se=a((re[ne]*B+50)/100);se<1?se=1:se>255&&(se=255),s[b[ne]]=se}for(var L=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Me=0;Me<64;Me++){var we=a((L[Me]*B+50)/100);we<1?we=1:we>255&&(we=255),o[b[Me]]=we}for(var Z=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],te=0,le=0;le<8;le++)for(var W=0;W<8;W++)l[te]=1/(s[b[te]]*Z[le]*Z[W]*8),f[te]=1/(o[b[te]]*Z[le]*Z[W]*8),te++}function z(B,re){for(var ne=0,se=0,L=new Array,Me=1;Me<=16;Me++){for(var we=1;we<=B[Me];we++)L[re[se]]=[],L[re[se]][0]=ne,L[re[se]][1]=Me,se++,ne++;ne*=2}return L}function ae(){h=z(A,T),c=z(F,V),u=z(D,P),d=z(q,Y)}function ie(){for(var B=1,re=2,ne=1;ne<=15;ne++){for(var se=B;se<re;se++)p[32767+se]=ne,g[32767+se]=[],g[32767+se][1]=ne,g[32767+se][0]=se;for(var L=-(re-1);L<=-B;L++)p[32767+L]=ne,g[32767+L]=[],g[32767+L][1]=ne,g[32767+L][0]=re-1+L;B<<=1,re<<=1}}function j(){for(var B=0;B<256;B++)v[B]=19595*B,v[B+256>>0]=38470*B,v[B+512>>0]=7471*B+32768,v[B+768>>0]=-11059*B,v[B+1024>>0]=-21709*B,v[B+1280>>0]=32768*B+8421375,v[B+1536>>0]=-27439*B,v[B+1792>>0]=-5329*B}function G(B){for(var re=B[0],ne=B[1]-1;ne>=0;)re&1<<ne&&(E|=1<<_),ne--,_--,_<0&&(E==255?(N(255),N(0)):N(E),_=7,E=0)}function N(B){x.push(B)}function X(B){N(B>>8&255),N(B&255)}function J(B,re){var ne,se,L,Me,we,Z,te,le,W=0,de,be=8,fe=64;for(de=0;de<be;++de){ne=B[W],se=B[W+1],L=B[W+2],Me=B[W+3],we=B[W+4],Z=B[W+5],te=B[W+6],le=B[W+7];var ye=ne+le,_e=ne-le,Ee=se+te,Te=se-te,$e=L+Z,Be=L-Z,He=Me+we,Ve=Me-we,Pe=ye+He,je=ye-He,Le=Ee+$e,Oe=Ee-$e;B[W]=Pe+Le,B[W+4]=Pe-Le;var Ge=(Oe+je)*.707106781;B[W+2]=je+Ge,B[W+6]=je-Ge,Pe=Ve+Be,Le=Be+Te,Oe=Te+_e;var ze=(Pe-Oe)*.382683433,$=.5411961*Pe+ze,C=1.306562965*Oe+ze,R=Le*.707106781,O=_e+R,H=_e-R;B[W+5]=H+$,B[W+3]=H-$,B[W+1]=O+C,B[W+7]=O-C,W+=8}for(W=0,de=0;de<be;++de){ne=B[W],se=B[W+8],L=B[W+16],Me=B[W+24],we=B[W+32],Z=B[W+40],te=B[W+48],le=B[W+56];var Q=ne+le,Se=ne-le,Ae=se+te,ke=se-te,Ce=L+Z,Ze=L-Z,Ie=Me+we,Ye=Me-we,De=Q+Ie,Fe=Q-Ie,Re=Ae+Ce,Ue=Ae-Ce;B[W]=De+Re,B[W+32]=De-Re;var Ke=(Ue+Fe)*.707106781;B[W+16]=Fe+Ke,B[W+48]=Fe-Ke,De=Ye+Ze,Re=Ze+ke,Ue=ke+Se;var Ne=(De-Ue)*.382683433,qe=.5411961*De+Ne,Je=1.306562965*Ue+Ne,Qe=Re*.707106781,et=Se+Qe,tt=Se-Qe;B[W+40]=tt+qe,B[W+24]=tt-qe,B[W+8]=et+Je,B[W+56]=et-Je,W++}var We;for(de=0;de<fe;++de)We=B[de]*re[de],m[de]=We>0?We+.5|0:We-.5|0;return m}function ge(){X(65504),X(16),N(74),N(70),N(73),N(70),N(0),N(1),N(1),N(0),X(1),X(1),N(0),N(0)}function oe(B){if(B){X(65505),B[0]===69&&B[1]===120&&B[2]===105&&B[3]===102?X(B.length+2):(X(B.length+5+2),N(69),N(120),N(105),N(102),N(0));for(var re=0;re<B.length;re++)N(B[re])}}function ue(B,re){X(65472),X(17),N(8),X(re),X(B),N(3),N(1),N(17),N(0),N(2),N(17),N(1),N(3),N(17),N(1)}function pe(){X(65499),X(132),N(0);for(var B=0;B<64;B++)N(s[B]);N(1);for(var re=0;re<64;re++)N(o[re])}function ve(){X(65476),X(418),N(0);for(var B=0;B<16;B++)N(A[B+1]);for(var re=0;re<=11;re++)N(T[re]);N(16);for(var ne=0;ne<16;ne++)N(D[ne+1]);for(var se=0;se<=161;se++)N(P[se]);N(1);for(var L=0;L<16;L++)N(F[L+1]);for(var Me=0;Me<=11;Me++)N(V[Me]);N(17);for(var we=0;we<16;we++)N(q[we+1]);for(var Z=0;Z<=161;Z++)N(Y[Z])}function me(B){typeof B>"u"||B.constructor!==Array||B.forEach(re=>{if(typeof re=="string"){X(65534);var ne=re.length;X(ne+2);var se;for(se=0;se<ne;se++)N(re.charCodeAt(se))}})}function K(){X(65498),X(12),N(3),N(1),N(0),N(2),N(17),N(3),N(17),N(0),N(63),N(0)}function U(B,re,ne,se,L){for(var Me=L[0],we=L[240],Z,te=16,le=63,W=64,de=J(B,re),be=0;be<W;++be)y[b[be]]=de[be];var fe=y[0]-ne;ne=y[0],fe==0?G(se[0]):(Z=32767+fe,G(se[p[Z]]),G(g[Z]));for(var ye=63;ye>0&&y[ye]==0;ye--);if(ye==0)return G(Me),ne;for(var _e=1,Ee;_e<=ye;){for(var Te=_e;y[_e]==0&&_e<=ye;++_e);var $e=_e-Te;if($e>=te){Ee=$e>>4;for(var Be=1;Be<=Ee;++Be)G(we);$e=$e&15}Z=32767+y[_e],G(L[($e<<4)+p[Z]]),G(g[Z]),_e++}return ye!=le&&G(Me),ne}function xe(){for(var B=String.fromCharCode,re=0;re<256;re++)k[re]=B(re)}this.encode=function(B,re){new Date().getTime(),re&&he(re),x=new Array,E=0,_=7,X(65496),ge(),me(B.comments),oe(B.exifBuffer),pe(),ue(B.width,B.height),ve(),K();var ne=0,se=0,L=0;E=0,_=7,this.encode.displayName="_encode_";for(var Me=B.data,we=B.width,Z=B.height,te=we*4,le,W=0,de,be,fe,ye,_e,Ee,Te,$e;W<Z;){for(le=0;le<te;){for(ye=te*W+le,_e=ye,Ee=-1,Te=0,$e=0;$e<64;$e++)Te=$e>>3,Ee=($e&7)*4,_e=ye+Te*te+Ee,W+Te>=Z&&(_e-=te*(W+1+Te-Z)),le+Ee>=te&&(_e-=le+Ee-te+4),de=Me[_e++],be=Me[_e++],fe=Me[_e++],w[$e]=(v[de]+v[be+256>>0]+v[fe+512>>0]>>16)-128,M[$e]=(v[de+768>>0]+v[be+1024>>0]+v[fe+1280>>0]>>16)-128,I[$e]=(v[de+1280>>0]+v[be+1536>>0]+v[fe+1792>>0]>>16)-128;ne=U(w,l,ne,h,u),se=U(M,f,se,c,d),L=U(I,f,L,c,d),le+=32}W+=8}if(_>=0){var Be=[];Be[1]=_+1,Be[0]=(1<<_+1)-1,G(Be)}return X(65497),Buffer.from(x)};function he(B){if(B<=0&&(B=1),B>100&&(B=100),S!=B){var re=0;B<50?re=Math.floor(5e3/B):re=Math.floor(200-B*2),ee(re),S=B}}function ce(){var B=new Date().getTime();n||(n=50),xe(),ae(),ie(),j(),he(n),new Date().getTime()-B}ce()}e.exports=r;function r(n,a){typeof a>"u"&&(a=50);var s=new t(a),o=s.encode(n,a);return{data:o,width:n.width,height:n.height}}})(encoder);var encoderExports=encoder.exports,decoder={exports:{}};(function(e){var t=function(){var a=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),s=4017,o=799,l=3406,f=2276,h=1567,c=3784,u=5793,d=2896;function g(){}function p(M,I){for(var k=0,v=[],S,b,A=16;A>0&&!M[A-1];)A--;v.push({children:[],index:0});var T=v[0],D;for(S=0;S<A;S++){for(b=0;b<M[S];b++){for(T=v.pop(),T.children[T.index]=I[k];T.index>0;){if(v.length===0)throw new Error("Could not recreate Huffman Table");T=v.pop()}for(T.index++,v.push(T);v.length<=S;)v.push(D={children:[],index:0}),T.children[T.index]=D.children,T=D;k++}S+1<A&&(v.push(D={children:[],index:0}),T.children[T.index]=D.children,T=D)}return v[0].children}function m(M,I,k,v,S,b,A,T,D,P){k.precision,k.samplesPerLine,k.scanLines;var F=k.mcusPerLine,V=k.progressive;k.maxH,k.maxV;var q=I,Y=0,ee=0;function z(){if(ee>0)return ee--,Y>>ee&1;if(Y=M[I++],Y==255){var Z=M[I++];if(Z)throw new Error("unexpected marker: "+(Y<<8|Z).toString(16))}return ee=7,Y>>>7}function ae(Z){for(var te=Z,le;(le=z())!==null;){if(te=te[le],typeof te=="number")return te;if(typeof te!="object")throw new Error("invalid huffman sequence")}return null}function ie(Z){for(var te=0;Z>0;){var le=z();if(le===null)return;te=te<<1|le,Z--}return te}function j(Z){var te=ie(Z);return te>=1<<Z-1?te:te+(-1<<Z)+1}function G(Z,te){var le=ae(Z.huffmanTableDC),W=le===0?0:j(le);te[0]=Z.pred+=W;for(var de=1;de<64;){var be=ae(Z.huffmanTableAC),fe=be&15,ye=be>>4;if(fe===0){if(ye<15)break;de+=16;continue}de+=ye;var _e=a[de];te[_e]=j(fe),de++}}function N(Z,te){var le=ae(Z.huffmanTableDC),W=le===0?0:j(le)<<D;te[0]=Z.pred+=W}function X(Z,te){te[0]|=z()<<D}var J=0;function ge(Z,te){if(J>0){J--;return}for(var le=b,W=A;le<=W;){var de=ae(Z.huffmanTableAC),be=de&15,fe=de>>4;if(be===0){if(fe<15){J=ie(fe)+(1<<fe)-1;break}le+=16;continue}le+=fe;var ye=a[le];te[ye]=j(be)*(1<<D),le++}}var oe=0,ue;function pe(Z,te){for(var le=b,W=A,de=0;le<=W;){var be=a[le],fe=te[be]<0?-1:1;switch(oe){case 0:var ye=ae(Z.huffmanTableAC),_e=ye&15,de=ye>>4;if(_e===0)de<15?(J=ie(de)+(1<<de),oe=4):(de=16,oe=1);else{if(_e!==1)throw new Error("invalid ACn encoding");ue=j(_e),oe=de?2:3}continue;case 1:case 2:te[be]?te[be]+=(z()<<D)*fe:(de--,de===0&&(oe=oe==2?3:0));break;case 3:te[be]?te[be]+=(z()<<D)*fe:(te[be]=ue<<D,oe=0);break;case 4:te[be]&&(te[be]+=(z()<<D)*fe);break}le++}oe===4&&(J--,J===0&&(oe=0))}function ve(Z,te,le,W,de){var be=le/F|0,fe=le%F,ye=be*Z.v+W,_e=fe*Z.h+de;Z.blocks[ye]===void 0&&P.tolerantDecoding||te(Z,Z.blocks[ye][_e])}function me(Z,te,le){var W=le/Z.blocksPerLine|0,de=le%Z.blocksPerLine;Z.blocks[W]===void 0&&P.tolerantDecoding||te(Z,Z.blocks[W][de])}var K=v.length,U,xe,he,ce,B,re;V?b===0?re=T===0?N:X:re=T===0?ge:pe:re=G;var ne=0,se,L;K==1?L=v[0].blocksPerLine*v[0].blocksPerColumn:L=F*k.mcusPerColumn,S||(S=L);for(var Me,we;ne<L;){for(xe=0;xe<K;xe++)v[xe].pred=0;if(J=0,K==1)for(U=v[0],B=0;B<S;B++)me(U,re,ne),ne++;else for(B=0;B<S;B++){for(xe=0;xe<K;xe++)for(U=v[xe],Me=U.h,we=U.v,he=0;he<we;he++)for(ce=0;ce<Me;ce++)ve(U,re,ne,he,ce);if(ne++,ne===L)break}if(ne===L)do{if(M[I]===255&&M[I+1]!==0)break;I+=1}while(I<M.length-2);if(ee=0,se=M[I]<<8|M[I+1],se<65280)throw new Error("marker was not found");if(se>=65488&&se<=65495)I+=2;else break}return I-q}function y(M,I){var k=[],v=I.blocksPerLine,S=I.blocksPerColumn,b=v<<3,A=new Int32Array(64),T=new Uint8Array(64);function D(ie,j,G){var N=I.quantizationTable,X,J,ge,oe,ue,pe,ve,me,K,U=G,xe;for(xe=0;xe<64;xe++)U[xe]=ie[xe]*N[xe];for(xe=0;xe<8;++xe){var he=8*xe;if(U[1+he]==0&&U[2+he]==0&&U[3+he]==0&&U[4+he]==0&&U[5+he]==0&&U[6+he]==0&&U[7+he]==0){K=u*U[0+he]+512>>10,U[0+he]=K,U[1+he]=K,U[2+he]=K,U[3+he]=K,U[4+he]=K,U[5+he]=K,U[6+he]=K,U[7+he]=K;continue}X=u*U[0+he]+128>>8,J=u*U[4+he]+128>>8,ge=U[2+he],oe=U[6+he],ue=d*(U[1+he]-U[7+he])+128>>8,me=d*(U[1+he]+U[7+he])+128>>8,pe=U[3+he]<<4,ve=U[5+he]<<4,K=X-J+1>>1,X=X+J+1>>1,J=K,K=ge*c+oe*h+128>>8,ge=ge*h-oe*c+128>>8,oe=K,K=ue-ve+1>>1,ue=ue+ve+1>>1,ve=K,K=me+pe+1>>1,pe=me-pe+1>>1,me=K,K=X-oe+1>>1,X=X+oe+1>>1,oe=K,K=J-ge+1>>1,J=J+ge+1>>1,ge=K,K=ue*f+me*l+2048>>12,ue=ue*l-me*f+2048>>12,me=K,K=pe*o+ve*s+2048>>12,pe=pe*s-ve*o+2048>>12,ve=K,U[0+he]=X+me,U[7+he]=X-me,U[1+he]=J+ve,U[6+he]=J-ve,U[2+he]=ge+pe,U[5+he]=ge-pe,U[3+he]=oe+ue,U[4+he]=oe-ue}for(xe=0;xe<8;++xe){var ce=xe;if(U[8+ce]==0&&U[16+ce]==0&&U[24+ce]==0&&U[32+ce]==0&&U[40+ce]==0&&U[48+ce]==0&&U[56+ce]==0){K=u*G[xe+0]+8192>>14,U[0+ce]=K,U[8+ce]=K,U[16+ce]=K,U[24+ce]=K,U[32+ce]=K,U[40+ce]=K,U[48+ce]=K,U[56+ce]=K;continue}X=u*U[0+ce]+2048>>12,J=u*U[32+ce]+2048>>12,ge=U[16+ce],oe=U[48+ce],ue=d*(U[8+ce]-U[56+ce])+2048>>12,me=d*(U[8+ce]+U[56+ce])+2048>>12,pe=U[24+ce],ve=U[40+ce],K=X-J+1>>1,X=X+J+1>>1,J=K,K=ge*c+oe*h+2048>>12,ge=ge*h-oe*c+2048>>12,oe=K,K=ue-ve+1>>1,ue=ue+ve+1>>1,ve=K,K=me+pe+1>>1,pe=me-pe+1>>1,me=K,K=X-oe+1>>1,X=X+oe+1>>1,oe=K,K=J-ge+1>>1,J=J+ge+1>>1,ge=K,K=ue*f+me*l+2048>>12,ue=ue*l-me*f+2048>>12,me=K,K=pe*o+ve*s+2048>>12,pe=pe*s-ve*o+2048>>12,ve=K,U[0+ce]=X+me,U[56+ce]=X-me,U[8+ce]=J+ve,U[48+ce]=J-ve,U[16+ce]=ge+pe,U[40+ce]=ge-pe,U[24+ce]=oe+ue,U[32+ce]=oe-ue}for(xe=0;xe<64;++xe){var B=128+(U[xe]+8>>4);j[xe]=B<0?0:B>255?255:B}}w(b*S*8);for(var P,F,V=0;V<S;V++){var q=V<<3;for(P=0;P<8;P++)k.push(new Uint8Array(b));for(var Y=0;Y<v;Y++){D(I.blocks[V][Y],T,A);var ee=0,z=Y<<3;for(F=0;F<8;F++){var ae=k[q+F];for(P=0;P<8;P++)ae[z+P]=T[ee++]}}}return k}function x(M){return M<0?0:M>255?255:M}g.prototype={load:function(I){var k=new XMLHttpRequest;k.open("GET",I,!0),k.responseType="arraybuffer",k.onload=(function(){var v=new Uint8Array(k.response||k.mozResponseArrayBuffer);this.parse(v),this.onload&&this.onload()}).bind(this),k.send(null)},parse:function(I){var k=this.opts.maxResolutionInMP*1e3*1e3,v=0;I.length;function S(){var fe=I[v]<<8|I[v+1];return v+=2,fe}function b(){var fe=S(),ye=I.subarray(v,v+fe-2);return v+=ye.length,ye}function A(fe){var ye=1,_e=1,Ee,Te;for(Te in fe.components)fe.components.hasOwnProperty(Te)&&(Ee=fe.components[Te],ye<Ee.h&&(ye=Ee.h),_e<Ee.v&&(_e=Ee.v));var $e=Math.ceil(fe.samplesPerLine/8/ye),Be=Math.ceil(fe.scanLines/8/_e);for(Te in fe.components)if(fe.components.hasOwnProperty(Te)){Ee=fe.components[Te];var He=Math.ceil(Math.ceil(fe.samplesPerLine/8)*Ee.h/ye),Ve=Math.ceil(Math.ceil(fe.scanLines/8)*Ee.v/_e),Pe=$e*Ee.h,je=Be*Ee.v,Le=je*Pe,Oe=[];w(Le*256);for(var Ge=0;Ge<je;Ge++){for(var ze=[],$=0;$<Pe;$++)ze.push(new Int32Array(64));Oe.push(ze)}Ee.blocksPerLine=He,Ee.blocksPerColumn=Ve,Ee.blocks=Oe}fe.maxH=ye,fe.maxV=_e,fe.mcusPerLine=$e,fe.mcusPerColumn=Be}var T=null,D=null,P,F,V=[],q=[],Y=[],ee=[],z=S(),ae=-1;if(this.comments=[],z!=65496)throw new Error("SOI not found");for(z=S();z!=65497;){var ie,j;switch(z){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var G=b();if(z===65534){var N=String.fromCharCode.apply(null,G);this.comments.push(N)}z===65504&&G[0]===74&&G[1]===70&&G[2]===73&&G[3]===70&&G[4]===0&&(T={version:{major:G[5],minor:G[6]},densityUnits:G[7],xDensity:G[8]<<8|G[9],yDensity:G[10]<<8|G[11],thumbWidth:G[12],thumbHeight:G[13],thumbData:G.subarray(14,14+3*G[12]*G[13])}),z===65505&&G[0]===69&&G[1]===120&&G[2]===105&&G[3]===102&&G[4]===0&&(this.exifBuffer=G.subarray(5,G.length)),z===65518&&G[0]===65&&G[1]===100&&G[2]===111&&G[3]===98&&G[4]===101&&G[5]===0&&(D={version:G[6],flags0:G[7]<<8|G[8],flags1:G[9]<<8|G[10],transformCode:G[11]});break;case 65499:for(var X=S(),J=X+v-2;v<J;){var ge=I[v++];w(256);var oe=new Int32Array(64);if(ge>>4)if(ge>>4===1)for(j=0;j<64;j++){var ue=a[j];oe[ue]=S()}else throw new Error("DQT: invalid table spec");else for(j=0;j<64;j++){var ue=a[j];oe[ue]=I[v++]}V[ge&15]=oe}break;case 65472:case 65473:case 65474:S(),P={},P.extended=z===65473,P.progressive=z===65474,P.precision=I[v++],P.scanLines=S(),P.samplesPerLine=S(),P.components={},P.componentsOrder=[];var pe=P.scanLines*P.samplesPerLine;if(pe>k){var ve=Math.ceil((pe-k)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${ve}MP`)}var me=I[v++],K;for(ie=0;ie<me;ie++){K=I[v];var U=I[v+1]>>4,xe=I[v+1]&15,he=I[v+2];if(U<=0||xe<=0)throw new Error("Invalid sampling factor, expected values above 0");P.componentsOrder.push(K),P.components[K]={h:U,v:xe,quantizationIdx:he},v+=3}A(P),q.push(P);break;case 65476:var ce=S();for(ie=2;ie<ce;){var B=I[v++],re=new Uint8Array(16),ne=0;for(j=0;j<16;j++,v++)ne+=re[j]=I[v];w(16+ne);var se=new Uint8Array(ne);for(j=0;j<ne;j++,v++)se[j]=I[v];ie+=17+ne,(B>>4?Y:ee)[B&15]=p(re,se)}break;case 65501:S(),F=S();break;case 65500:S(),S();break;case 65498:S();var L=I[v++],Me=[],we;for(ie=0;ie<L;ie++){we=P.components[I[v++]];var Z=I[v++];we.huffmanTableDC=ee[Z>>4],we.huffmanTableAC=Y[Z&15],Me.push(we)}var te=I[v++],le=I[v++],W=I[v++],de=m(I,v,P,Me,F,te,le,W>>4,W&15,this.opts);v+=de;break;case 65535:I[v]!==255&&v--;break;default:if(I[v-3]==255&&I[v-2]>=192&&I[v-2]<=254){v-=3;break}else if(z===224||z==225){if(ae!==-1)throw new Error(`first unknown JPEG marker at offset ${ae.toString(16)}, second unknown JPEG marker ${z.toString(16)} at offset ${(v-1).toString(16)}`);ae=v-1;const fe=S();if(I[v+fe-2]===255){v+=fe-2;break}}throw new Error("unknown JPEG marker "+z.toString(16))}z=S()}if(q.length!=1)throw new Error("only single frame JPEGs supported");for(var ie=0;ie<q.length;ie++){var be=q[ie].components;for(var j in be)be[j].quantizationTable=V[be[j].quantizationIdx],delete be[j].quantizationIdx}this.width=P.samplesPerLine,this.height=P.scanLines,this.jfif=T,this.adobe=D,this.components=[];for(var ie=0;ie<P.componentsOrder.length;ie++){var we=P.components[P.componentsOrder[ie]];this.components.push({lines:y(P,we),scaleX:we.h/P.maxH,scaleY:we.v/P.maxV})}},getData:function(I,k){var v=this.width/I,S=this.height/k,b,A,T,D,P,F,V,q,Y,ee,z=0,ae,ie,j,G,N,X,J,ge,oe,ue,pe,ve=I*k*this.components.length;w(ve);var me=new Uint8Array(ve);switch(this.components.length){case 1:for(b=this.components[0],ee=0;ee<k;ee++)for(P=b.lines[0|ee*b.scaleY*S],Y=0;Y<I;Y++)ae=P[0|Y*b.scaleX*v],me[z++]=ae;break;case 2:for(b=this.components[0],A=this.components[1],ee=0;ee<k;ee++)for(P=b.lines[0|ee*b.scaleY*S],F=A.lines[0|ee*A.scaleY*S],Y=0;Y<I;Y++)ae=P[0|Y*b.scaleX*v],me[z++]=ae,ae=F[0|Y*A.scaleX*v],me[z++]=ae;break;case 3:for(pe=!0,this.adobe&&this.adobe.transformCode?pe=!0:typeof this.opts.colorTransform<"u"&&(pe=!!this.opts.colorTransform),b=this.components[0],A=this.components[1],T=this.components[2],ee=0;ee<k;ee++)for(P=b.lines[0|ee*b.scaleY*S],F=A.lines[0|ee*A.scaleY*S],V=T.lines[0|ee*T.scaleY*S],Y=0;Y<I;Y++)pe?(ae=P[0|Y*b.scaleX*v],ie=F[0|Y*A.scaleX*v],j=V[0|Y*T.scaleX*v],ge=x(ae+1.402*(j-128)),oe=x(ae-.3441363*(ie-128)-.71413636*(j-128)),ue=x(ae+1.772*(ie-128))):(ge=P[0|Y*b.scaleX*v],oe=F[0|Y*A.scaleX*v],ue=V[0|Y*T.scaleX*v]),me[z++]=ge,me[z++]=oe,me[z++]=ue;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(pe=!1,this.adobe&&this.adobe.transformCode?pe=!0:typeof this.opts.colorTransform<"u"&&(pe=!!this.opts.colorTransform),b=this.components[0],A=this.components[1],T=this.components[2],D=this.components[3],ee=0;ee<k;ee++)for(P=b.lines[0|ee*b.scaleY*S],F=A.lines[0|ee*A.scaleY*S],V=T.lines[0|ee*T.scaleY*S],q=D.lines[0|ee*D.scaleY*S],Y=0;Y<I;Y++)pe?(ae=P[0|Y*b.scaleX*v],ie=F[0|Y*A.scaleX*v],j=V[0|Y*T.scaleX*v],G=q[0|Y*D.scaleX*v],N=255-x(ae+1.402*(j-128)),X=255-x(ae-.3441363*(ie-128)-.71413636*(j-128)),J=255-x(ae+1.772*(ie-128))):(N=P[0|Y*b.scaleX*v],X=F[0|Y*A.scaleX*v],J=V[0|Y*T.scaleX*v],G=q[0|Y*D.scaleX*v]),me[z++]=255-N,me[z++]=255-X,me[z++]=255-J,me[z++]=255-G;break;default:throw new Error("Unsupported color mode")}return me},copyToImageData:function(I,k){var v=I.width,S=I.height,b=I.data,A=this.getData(v,S),T=0,D=0,P,F,V,q,Y,ee,z,ae,ie;switch(this.components.length){case 1:for(F=0;F<S;F++)for(P=0;P<v;P++)V=A[T++],b[D++]=V,b[D++]=V,b[D++]=V,k&&(b[D++]=255);break;case 3:for(F=0;F<S;F++)for(P=0;P<v;P++)z=A[T++],ae=A[T++],ie=A[T++],b[D++]=z,b[D++]=ae,b[D++]=ie,k&&(b[D++]=255);break;case 4:for(F=0;F<S;F++)for(P=0;P<v;P++)Y=A[T++],ee=A[T++],V=A[T++],q=A[T++],z=255-x(Y*(1-q/255)+q),ae=255-x(ee*(1-q/255)+q),ie=255-x(V*(1-q/255)+q),b[D++]=z,b[D++]=ae,b[D++]=ie,k&&(b[D++]=255);break;default:throw new Error("Unsupported color mode")}}};var E=0,_=0;function w(M=0){var I=E+M;if(I>_){var k=Math.ceil((I-_)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${k}MB`)}E=I}return g.resetMaxMemoryUsage=function(M){E=0,_=M},g.getBytesAllocated=function(){return E},g.requestMemoryAllocation=w,g}();e.exports=r;function r(n,a={}){var s={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512},o={...s,...a},l=new Uint8Array(n),f=new t;f.opts=o,t.resetMaxMemoryUsage(o.maxMemoryUsageInMB*1024*1024),f.parse(l);var h=o.formatAsRGBA?4:3,c=f.width*f.height*h;try{t.requestMemoryAllocation(c);var u={width:f.width,height:f.height,exifBuffer:f.exifBuffer,data:o.useTArray?new Uint8Array(c):Buffer.alloc(c)};f.comments.length>0&&(u.comments=f.comments)}catch(d){throw d instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+c):d instanceof ReferenceError&&d.message==="Buffer is not defined"?new Error("Buffer is not globally defined in this environment. Consider setting useTArray to true"):d}return f.copyToImageData(u,o.formatAsRGBA),u}})(decoder);var decoderExports=decoder.exports,encode$1=encoderExports,decode$4=decoderExports,jpegJs={encode:encode$1,decode:decode$4};let chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup=new Uint8Array(256);for(let e=0;e<chars.length;e++)lookup[chars.charCodeAt(e)]=e;function encode(e){let t,r=e.length,n="";for(t=0;t<r;t+=3)n+=chars[e[t]>>2],n+=chars[(e[t]&3)<<4|e[t+1]>>4],n+=chars[(e[t+1]&15)<<2|e[t+2]>>6],n+=chars[e[t+2]&63];return r%3===2?n=`${n.substring(0,n.length-1)}=`:r%3===1&&(n=`${n.substring(0,n.length-2)}==`),n}function decode$3(e){let t=e.length*.75,r=e.length,n=0,a,s,o,l;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const f=new Uint8Array(t);for(let h=0;h<r;h+=4)a=lookup[e.charCodeAt(h)],s=lookup[e.charCodeAt(h+1)],o=lookup[e.charCodeAt(h+2)],l=lookup[e.charCodeAt(h+3)],f[n++]=a<<2|s>>4,f[n++]=(s&15)<<4|o>>2,f[n++]=(o&3)<<6|l&63;return f}function toBase64URL(e,t){const r=encode(e);return`data:${t};base64,${r}`}const ImageData=self.ImageData,DOMImage=self.Image;function createCanvas(e,t){let r=self.document.createElement("canvas");return r.width=e,r.height=t,r}function fetchBinary(e,{withCredentials:t=!1}={}){return new Promise(function(r,n){let a=new self.XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer",a.withCredentials=t,a.onload=function(s){this.status!==200?n(s):r(this.response)},a.onerror=n,a.send()})}function createWriteStream(){throw new Error("createWriteStream does not exist in the browser")}function writeFile(){throw new Error("writeFile does not exist in the browser")}function getType(e){return e.includes("/")||(e=`image/${e}`),e}function encodeJpeg(e,t={}){const r={width:e.width,height:e.height,data:e.getRGBAData()};return jpegJs.encode(r,t.quality).data}function encodePng(e,t){const r={width:e.width,height:e.height,channels:e.channels,depth:e.bitDepth,data:e.data};return(r.depth===1||r.depth===32)&&(r.depth=8,r.channels=4,r.data=e.getRGBAData()),encodePng$1(r,t)}const exportMethods={save(e,t={}){const{useCanvas:r=!1,encoder:n=void 0}=t;let{format:a}=t;if(!a){const s=/\.(?<format>[a-zA-Z]+)$/.exec(e);s&&(a=s.groups.format.toLowerCase())}if(!a)throw new Error("file format not provided");return new Promise((s,o)=>{let l,f;switch(a.toLowerCase()){case"png":{r?l=this.getCanvas().pngStream():f=encodePng(this,n);break}case"jpg":case"jpeg":r?l=this.getCanvas().jpegStream():f=encodeJpeg(this,n);break;case"bmp":f=encode$2(this,n);break;default:throw new RangeError(`invalid output format: ${a}`)}if(l){let h=createWriteStream();h.on("finish",s),h.on("error",o),l.pipe(h)}else f&&writeFile()})},toDataURL(e="image/png",t={}){typeof e=="object"&&(t=e,e="image/png");const{useCanvas:r=!1,encoder:n=void 0}=t;e=getType(e);function a(s,o){const l=s(o,n);return toBase64URL(l,e)}return e==="image/bmp"?a(encode$2,this):e==="image/png"&&!r?a(encodePng,this):e==="image/jpeg"&&!r?a(encodeJpeg,this):this.getCanvas().toDataURL(e)},toBuffer(e={}){const{format:t="png",encoder:r=void 0}=e;switch(t.toLowerCase()){case"png":return encodePng(this,r);case"jpeg":case"jpg":return encodeJpeg(this,r);case"bmp":return encode$2(this,r);default:throw new RangeError(`invalid output format: ${t}`)}},toBase64(e="image/png",t={}){if(t.async)return this.toDataURL(e,t).then(function(r){return r.substring(r.indexOf(",")+1)});{const r=this.toDataURL(e,t);return r.substring(r.indexOf(",")+1)}},toBlob(e="image/png",t=.8){return canvasToBlob(this.getCanvas(),e,t)},getCanvas(){const e=new ImageData(this.getRGBAData({clamped:!0}),this.width,this.height);let t=createCanvas(this.width,this.height);return t.getContext("2d").putImageData(e,0,0),t}};function setExportMethods(e){for(const t in exportMethods)e.prototype[t]=exportMethods[t]}var hasOwn$1={exports:{}};const name="has-own",version="1.0.1",description="A safer .hasOwnProperty() - hasOwn(name, obj)",main="index.js",scripts={test:"make test"},author="Aaron Heckmann <aaron.heckmann+github@gmail.com>",license="MIT",repository={type:"git",url:"git://github.com/aheckmann/has-own.git"},homepage="https://github.com/aheckmann/has-own/",devDependencies={mocha:"^6.2.2"};var require$$0$2={name,version,description,main,scripts,author,license,repository,homepage,devDependencies};(function(e,t){var r=Object.prototype.hasOwnProperty;e.exports=t=function(a,s){return r.call(s,a)},t.version=require$$0$2.version})(hasOwn$1,hasOwn$1.exports);var hasOwnExports=hasOwn$1.exports,hasOwn=getDefaultExportFromCjs(hasOwnExports);let computedPropertyDescriptor$1={configurable:!0,enumerable:!1,get:void 0};function extendMethod(e,t,r={}){let{inPlace:n=!1,returnThis:a=!0,partialArgs:s=[]}=r;return n?Image.prototype[e]=function(...o){this.computed=null;let l=t.apply(this,[...s,...o]);return a?this:l}:Image.prototype[e]=function(...o){return t.apply(this,[...s,...o])},Image}function extendProperty(e,t,r={}){let{partialArgs:n=[]}=r;return computedPropertyDescriptor$1.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(e,this.computed))return this.computed[e];let a=t.apply(this,n);return this.computed[e]=a,a},Object.defineProperty(Image.prototype,e,computedPropertyDescriptor$1),Image}const GREY$1="GREY",RGB$1="RGB",HSL="HSL",HSV="HSV",CMYK$1="CMYK";var ColorModel=Object.freeze({__proto__:null,CMYK:CMYK$1,GREY:GREY$1,HSL,HSV,RGB:RGB$1});function getRGBAData(e={}){const{clamped:t}=e;this.checkProcessable("getRGBAData",{components:[1,3],bitDepth:[1,8,16,32]});const r=this.width*this.height*4;let n=t?new Uint8ClampedArray(r):new Uint8Array(r);return this.bitDepth===1?fillDataFromBinary(this,n):this.bitDepth===32?(this.checkProcessable("getRGBAData",{alpha:0}),this.components===1?fillDataFromGrey32(this,n):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB32(this,n))):this.components===1?fillDataFromGrey(this,n):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB(this,n)),this.alpha===1?(this.checkProcessable("getRGBAData",{bitDepth:[8,16]}),copyAlpha(this,n)):fillAlpha(this,n),n}function fillDataFromBinary(e,t){for(let r=0;r<e.size;r++){const n=e.getBit(r);t[r*4]=n*255,t[r*4+1]=n*255,t[r*4+2]=n*255}}function fillDataFromGrey32(e,t){const r=e.min[0],a=e.max[0]-r;for(let s=0;s<e.size;s++){const o=Math.floor(255*(e.data[s]-r)/a);t[s*4]=o,t[s*4+1]=o,t[s*4+2]=o}}function fillDataFromRGB32(e,t){const r=Math.min(...e.min),a=Math.max(...e.max)-r;for(let s=0;s<e.size;s++){const o=Math.floor(255*(e.data[s*3]-r)/a),l=Math.floor(255*(e.data[s*3+1]-r)/a),f=Math.floor(255*(e.data[s*3+2]-r)/a);t[s*4]=o,t[s*4+1]=l,t[s*4+2]=f}}function fillDataFromGrey(e,t){for(let r=0;r<e.size;r++)t[r*4]=e.data[r*e.channels]>>>e.bitDepth-8,t[r*4+1]=e.data[r*e.channels]>>>e.bitDepth-8,t[r*4+2]=e.data[r*e.channels]>>>e.bitDepth-8}function fillDataFromRGB(e,t){for(let r=0;r<e.size;r++)t[r*4]=e.data[r*e.channels]>>>e.bitDepth-8,t[r*4+1]=e.data[r*e.channels+1]>>>e.bitDepth-8,t[r*4+2]=e.data[r*e.channels+2]>>>e.bitDepth-8}function copyAlpha(e,t){for(let r=0;r<e.size;r++)t[r*4+3]=e.data[r*e.channels+e.components]>>e.bitDepth-8}function fillAlpha(e,t){for(let r=0;r<e.size;r++)t[r*4+3]=255}const BINARY="BINARY",GREY="GREY",GREYA="GREYA",RGB="RGB",RGBA="RGBA",CMYK="CMYK",CMYKA="CMYKA",kinds={};kinds[BINARY]={components:1,alpha:0,bitDepth:1,colorModel:GREY$1};kinds[GREYA]={components:1,alpha:1,bitDepth:8,colorModel:GREY$1};kinds[GREY]={components:1,alpha:0,bitDepth:8,colorModel:GREY$1};kinds[RGBA]={components:3,alpha:1,bitDepth:8,colorModel:RGB$1};kinds[RGB]={components:3,alpha:0,bitDepth:8,colorModel:RGB$1};kinds[CMYK]={components:4,alpha:0,bitDepth:8,colorModel:CMYK$1};kinds[CMYKA]={components:4,alpha:1,bitDepth:8,colorModel:CMYK$1};function getKind(e){const t=kinds[e];if(!t)throw new RangeError(`invalid image kind: ${e}`);return t}const validBitDepth=[1,8,16,32];function verifyKindDefinition(e){const{components:t,alpha:r,bitDepth:n,colorModel:a}=e;if(!Number.isInteger(t)||t<=0)throw new RangeError(`invalid components: ${t}. Must be a positive integer`);if(r!==0&&r!==1&&typeof r!="boolean")throw new TypeError(`invalid alpha: ${r}: must be a boolean, 0 or 1`);if(!validBitDepth.includes(n))throw new RangeError(`invalid bitDepth: ${n}. Must be one of ${validBitDepth.join(", ")}`);if(!ColorModel[a])throw new RangeError(`invalid colorModel: ${a}. Must be one of ${Object.keys(ColorModel).join(", ")}`)}function getTheoreticalPixelArraySize(e,t,r){let n=t*e;return r===1&&(n=Math.ceil(n/8)),n}function createPixelArray(e,t,r,n,a,s){const o=n*e;let l;switch(a){case 1:l=new Uint8Array(Math.ceil(o/8));break;case 8:l=new Uint8Array(o);break;case 16:l=new Uint16Array(o);break;case 32:l=new Float32Array(o);break;default:throw new Error(`Cannot create pixel array for bit depth ${a}`)}if(r)for(let f=t;f<l.length;f+=n)l[f]=s;return l}const defaultByteLength=1024*8,charArray=[];let IOBuffer$2=class{constructor(t,r){r=r||{},t===void 0&&(t=defaultByteLength),typeof t=="number"&&(t=new ArrayBuffer(t));let n=t.byteLength;const a=r.offset?r.offset>>>0:0;t.buffer&&(n=t.byteLength-a,t.byteLength!==t.buffer.byteLength?t=t.buffer.slice(t.byteOffset+a,t.byteOffset+t.byteLength):a?t=t.buffer.slice(a):t=t.buffer),this.buffer=t,this.length=n,this.byteLength=n,this.byteOffset=0,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer),this._increment=n||defaultByteLength,this._mark=0}available(t){return t===void 0&&(t=1),this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){this.littleEndian=!0}isBigEndian(){return!this.littleEndian}setBigEndian(){this.littleEndian=!1}skip(t){t===void 0&&(t=1),this.offset+=t}seek(t){this.offset=t}mark(){this._mark=this.offset}reset(){this.offset=this._mark}rewind(){this.offset=0}ensureAvailable(t){if(t===void 0&&(t=1),!this.available(t)){const r=this._increment+this._increment;this._increment=r;const n=this.length+r,a=new Uint8Array(n);a.set(new Uint8Array(this.buffer)),this.buffer=a.buffer,this.length=n,this._data=new DataView(this.buffer)}}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t){t===void 0&&(t=1);for(var r=new Uint8Array(t),n=0;n<t;n++)r[n]=this.readByte();return r}readInt16(){var t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){var t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){var t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){var t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){var t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){var t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t){t===void 0&&(t=1),charArray.length=t;for(var r=0;r<t;r++)charArray[r]=this.readChar();return charArray.join("")}writeBoolean(t){this.writeUint8(t?255:0)}writeInt8(t){this.ensureAvailable(1),this._data.setInt8(this.offset++,t)}writeUint8(t){this.ensureAvailable(1),this._data.setUint8(this.offset++,t)}writeByte(t){this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(var r=0;r<t.length;r++)this._data.setUint8(this.offset++,t[r])}writeInt16(t){this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2}writeUint16(t){this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2}writeInt32(t){this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4}writeUint32(t){this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4}writeFloat32(t){this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4}writeFloat64(t){this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8}writeChar(t){this.writeUint8(t.charCodeAt(0))}writeChars(t){for(var r=0;r<t.length;r++)this.writeUint8(t.charCodeAt(r))}toArray(){return new Uint8Array(this.buffer,0,this.offset)}};var IOBuffer_1=IOBuffer$2,src$4={};const tagsById$5={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName$5={};for(var i$2 in tagsById$5)tagsByName$5[tagsById$5[i$2]]=i$2;var standard$1={tagsById:tagsById$5,tagsByName:tagsByName$5};const tagsById$4={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$4={};for(var i$1 in tagsById$4)tagsByName$4[tagsById$4[i$1]]=i$1;var exif$1={tagsById:tagsById$4,tagsByName:tagsByName$4};const tagsById$3={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$3={};for(var i in tagsById$3)tagsByName$3[tagsById$3[i]]=i;var gps$1={tagsById:tagsById$3,tagsByName:tagsByName$3};const tags$1={standard:standard$1,exif:exif$1,gps:gps$1};let IFD$2=class{constructor(t){if(!t)throw new Error("missing kind");this.data=null,this.fields=new Map,this.kind=t,this._map=null}get(t){if(typeof t=="number")return this.fields.get(t);if(typeof t=="string")return this.fields.get(tags$1[this.kind].tagsByName[t]);throw new Error("expected a number or string")}get map(){if(!this._map){this._map={};const r=tags$1[this.kind].tagsById;for(var t of this.fields.keys())r[t]&&(this._map[r[t]]=this.fields.get(t))}return this._map}};var ifd=IFD$2;const Ifd=ifd,dateTimeRegex$1=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;let TiffIfd$1=class extends Ifd{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){var t=new Date,r=dateTimeRegex$1.exec(this.dateTime);return t.setFullYear(r[1],r[2]-1,r[3]),t.setHours(r[4],r[5],r[6]),t}get newSubfileType(){return this.get(254)}get imageWidth(){return this.get(256)}get imageLength(){return this.get(257)}get bitsPerSample(){return this.get(258)}get compression(){return this.get(259)||1}get type(){return this.get(262)}get fillOrder(){return this.get(266)||1}get documentName(){return this.get(269)}get imageDescription(){return this.get(270)}get stripOffsets(){return alwaysArray$1(this.get(273))}get orientation(){return this.get(274)}get samplesPerPixel(){return this.get(277)}get rowsPerStrip(){return this.get(278)}get stripByteCounts(){return alwaysArray$1(this.get(279))}get minSampleValue(){return this.get(280)||0}get maxSampleValue(){return this.get(281)||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get(282)}get yResolution(){return this.get(283)}get planarConfiguration(){return this.get(284)||1}get resolutionUnit(){return this.get(296)||2}get dateTime(){return this.get(306)}get predictor(){return this.get(317)||1}get sampleFormat(){return this.get(339)||1}get sMinSampleValue(){return this.get(340)||this.minSampleValue}get sMaxSampleValue(){return this.get(341)||this.maxSampleValue}};function alwaysArray$1(e){return typeof e=="number"?[e]:e}var tiffIfd=TiffIfd$1,ifdValue={},types$1=new Map([[1,[1,readByte$1]],[2,[1,readASCII$1]],[3,[2,readShort$1]],[4,[4,readLong$1]],[5,[8,readRational$1]],[6,[1,readSByte$1]],[7,[1,readByte$1]],[8,[2,readSShort$1]],[9,[4,readSLong$1]],[10,[8,readSRational$1]],[11,[4,readFloat$1]],[12,[8,readDouble$1]]]);ifdValue.getByteLength=function(e,t){return types$1.get(e)[0]*t};ifdValue.readData=function(e,t,r){return types$1.get(t)[1](e,r)};function readByte$1(e,t){if(t===1)return e.readUint8();for(var r=new Uint8Array(t),n=0;n<t;n++)r[n]=e.readUint8();return r}function readASCII$1(e,t){for(var r=[],n="",a=0;a<t;a++){var s=String.fromCharCode(e.readUint8());s==="\0"?(r.push(n),n=""):n+=s}return r.length===1?r[0]:r}function readShort$1(e,t){if(t===1)return e.readUint16();for(var r=new Uint16Array(t),n=0;n<t;n++)r[n]=e.readUint16();return r}function readLong$1(e,t){if(t===1)return e.readUint32();for(var r=new Uint32Array(t),n=0;n<t;n++)r[n]=e.readUint32();return r}function readRational$1(e,t){if(t===1)return e.readUint32()/e.readUint32();for(var r=new Array(t),n=0;n<t;n++)r[n]=e.readUint32()/e.readUint32();return r}function readSByte$1(e,t){if(t===1)return e.readInt8();for(var r=new Int8Array(t),n=0;n<t;n++)r[n]=e.readInt8();return r}function readSShort$1(e,t){if(t===1)return e.readInt16();for(var r=new Int16Array(t),n=0;n<t;n++)r[n]=e.readInt16();return r}function readSLong$1(e,t){if(t===1)return e.readInt32();for(var r=new Int32Array(t),n=0;n<t;n++)r[n]=e.readInt32();return r}function readSRational$1(e,t){if(t===1)return e.readInt32()/e.readInt32();for(var r=new Array(t),n=0;n<t;n++)r[n]=e.readInt32()/e.readInt32();return r}function readFloat$1(e,t){if(t===1)return e.readFloat32();for(var r=new Float32Array(t),n=0;n<t;n++)r[n]=e.readFloat32();return r}function readDouble$1(e,t){if(t===1)return e.readFloat64();for(var r=new Float64Array(t),n=0;n<t;n++)r[n]=e.readFloat64();return r}const IOBuffer$1=IOBuffer_1,IFD$1=ifd,TiffIFD=tiffIfd,IFDValue=ifdValue,defaultOptions$d={ignoreImageData:!1,onlyFirst:!1};let TIFFDecoder$2=class extends IOBuffer$1{constructor(t,r){super(t,r),this._nextIFD=0}decode(t){t=Object.assign({},defaultOptions$d,t);const r=[];for(this.decodeHeader();this._nextIFD;)if(r.push(this.decodeIFD(t)),t.onlyFirst)return r[0];return r}decodeHeader(){let t=this.readUint16();if(t===18761)this.setLittleEndian();else if(t===19789)this.setBigEndian();else throw new Error("invalid byte order: 0x"+t.toString(16));if(t=this.readUint16(),t!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(t){this.seek(this._nextIFD);var r;t.kind?r=new IFD$1(t.kind):r=new TiffIFD;const n=this.readUint16();for(var a=0;a<n;a++)this.decodeIFDEntry(r);return t.ignoreImageData||this.decodeImageData(r),this._nextIFD=this.readUint32(),r}decodeIFDEntry(t){const r=this.offset,n=this.readUint16(),a=this.readUint16(),s=this.readUint32();if(a<1||a>12){this.skip(4);return}IFDValue.getByteLength(a,s)>4&&this.seek(this.readUint32());const l=IFDValue.readData(this,a,s);if(t.fields.set(n,l),n===34665||n===34853){let f=this.offset,h;n===34665?h="exif":n===34853&&(h="gps"),this._nextIFD=l,t[h]=this.decodeIFD({kind:h,ignoreImageData:!0}),this.offset=f}this.seek(r),this.skip(12)}decodeImageData(t){const r=t.orientation;switch(r&&r!==1&&unsupported$1("orientation",r),t.type){case 1:case 2:this.readStripData(t);break;default:unsupported$1("image type",t.type);break}}readStripData(t){const r=t.width,n=t.height,a=validateBitDepth(t.bitsPerSample),s=t.sampleFormat;let o=r*n;const l=getDataArray$1(o,1,a,s),f=t.compression,c=t.rowsPerStrip*r,u=t.stripOffsets,d=t.stripByteCounts;for(var g=0,p=0;p<u.length;p++){var m=this.getStripData(f,u[p],d[p]),y=o>c?c:o;o-=y,a===8?g=fill8bit$1(l,m,g,y):a===16?g=fill16bit$1(l,m,g,y,this.isLittleEndian()):a===32&&s===3?g=fillFloat32$1(l,m,g,y,this.isLittleEndian()):unsupported$1("bitDepth",a)}t.data=l}getStripData(t,r,n){switch(t){case 1:return new DataView(this.buffer,r,n);case 2:case 32773:return unsupported$1("Compression",t);default:throw new Error("invalid compression: "+t)}}};var tiffDecoder=TIFFDecoder$2;function getDataArray$1(e,t,r,n){return r===8?new Uint8Array(e*t):r===16?new Uint16Array(e*t):r===32&&n===3?new Float32Array(e*t):unsupported$1("bit depth / sample format",r+" / "+n)}function fill8bit$1(e,t,r,n){for(var a=0;a<n;a++)e[r++]=t.getUint8(a);return r}function fill16bit$1(e,t,r,n,a){for(var s=0;s<n*2;s+=2)e[r++]=t.getUint16(s,a);return r}function fillFloat32$1(e,t,r,n,a){for(var s=0;s<n*4;s+=4)e[r++]=t.getFloat32(s,a);return r}function unsupported$1(e,t){throw new Error("Unsupported "+e+": "+t)}function validateBitDepth(e){if(e.length){const r=e;e=r[0];for(var t=0;t<r.length;t++)r[t]!==e&&unsupported$1("bit depth",r)}return e}const TIFFDecoder$1=tiffDecoder;var decode$2=function(t,r){return new TIFFDecoder$1(t,r).decode(r)};src$4.decode=decode$2;const IOBuffer=IOBuffer_1,tiff=src$4;function decode$1(e){const t=new IOBuffer(e),r={};if(t.setBigEndian(),t.readUint16()!==65496)throw new Error("SOI marker not found. Not a valid JPEG file");if(t.readUint16()===65505){t.readUint16();const s=t.readBytes(6);if(s[0]===69&&s[1]===120&&s[2]===105&&s[3]===102&&s[4]===0&&s[5]===0){const o=tiff.decode(t,{onlyFirst:!0,ignoreImageData:!0,offset:t.offset});r.exif=o}}return r}var decode_1=decode$1,decode=decode_1,imageType$2={exports:{}},fileType$1={exports:{}};(function(module){const toBytes=e=>[...e].map(t=>t.charCodeAt(0)),xpiZipFilename=toBytes("META-INF/mozilla.rsa"),oxmlContentTypes=toBytes("[Content_Types].xml"),oxmlRels=toBytes("_rels/.rels");function readUInt64LE(e,t=0){let r=e[t],n=1,a=0;for(;++a<8;)n*=256,r+=e[t+a]*n;return r}const fileType=e=>{if(!(e instanceof Uint8Array||e instanceof ArrayBuffer||Buffer.isBuffer(e)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof e}\``);const t=e instanceof Uint8Array?e:new Uint8Array(e);if(!(t&&t.length>1))return null;const r=(a,s)=>{s=Object.assign({offset:0},s);for(let o=0;o<a.length;o++)if(s.mask){if(a[o]!==(s.mask[o]&t[o+s.offset]))return!1}else if(a[o]!==t[o+s.offset])return!1;return!0},n=(a,s)=>r(toBytes(a),s);if(r([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(r([137,80,78,71,13,10,26,10]))return{ext:"png",mime:"image/png"};if(r([71,73,70]))return{ext:"gif",mime:"image/gif"};if(r([87,69,66,80],{offset:8}))return{ext:"webp",mime:"image/webp"};if(r([70,76,73,70]))return{ext:"flif",mime:"image/flif"};if((r([73,73,42,0])||r([77,77,0,42]))&&r([67,82],{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(r([73,73,42,0])||r([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(r([66,77]))return{ext:"bmp",mime:"image/bmp"};if(r([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(r([56,66,80,83]))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(r([80,75,3,4])){if(r([109,105,109,101,116,121,112,101,97,112,112,108,105,99,97,116,105,111,110,47,101,112,117,98,43,122,105,112],{offset:30}))return{ext:"epub",mime:"application/epub+zip"};if(r(xpiZipFilename,{offset:30}))return{ext:"xpi",mime:"application/x-xpinstall"};if(n("mimetypeapplication/vnd.oasis.opendocument.text",{offset:30}))return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};if(n("mimetypeapplication/vnd.oasis.opendocument.spreadsheet",{offset:30}))return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};if(n("mimetypeapplication/vnd.oasis.opendocument.presentation",{offset:30}))return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};const a=(f,h=0)=>f.findIndex((c,u,d)=>u>=h&&d[u]===80&&d[u+1]===75&&d[u+2]===3&&d[u+3]===4);let s=0,o=!1,l=null;do{const f=s+30;if(o||(o=r(oxmlContentTypes,{offset:f})||r(oxmlRels,{offset:f})),l||(n("word/",{offset:f})?l={ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}:n("ppt/",{offset:f})?l={ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}:n("xl/",{offset:f})&&(l={ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),o&&l)return l;s=a(t,f)}while(s>=0);if(l)return l}if(r([80,75])&&(t[2]===3||t[2]===5||t[2]===7)&&(t[3]===4||t[3]===6||t[3]===8))return{ext:"zip",mime:"application/zip"};if(r([117,115,116,97,114],{offset:257}))return{ext:"tar",mime:"application/x-tar"};if(r([82,97,114,33,26,7])&&(t[6]===0||t[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(r([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(r([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(r([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(r([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(r([51,103,112,53])||r([0,0,0])&&r([102,116,121,112],{offset:4})&&(r([109,112,52,49],{offset:8})||r([109,112,52,50],{offset:8})||r([105,115,111,109],{offset:8})||r([105,115,111,50],{offset:8})||r([109,109,112,52],{offset:8})||r([77,52,86],{offset:8})||r([100,97,115,104],{offset:8})))return{ext:"mp4",mime:"video/mp4"};if(r([77,84,104,100]))return{ext:"mid",mime:"audio/midi"};if(r([26,69,223,163])){const a=t.subarray(4,4100),s=a.findIndex((o,l,f)=>f[l]===66&&f[l+1]===130);if(s!==-1){const o=s+3,l=f=>[...f].every((h,c)=>a[o+c]===h.charCodeAt(0));if(l("matroska"))return{ext:"mkv",mime:"video/x-matroska"};if(l("webm"))return{ext:"webm",mime:"video/webm"}}}if(r([0,0,0,20,102,116,121,112,113,116,32,32])||r([102,114,101,101],{offset:4})||r([102,116,121,112,113,116,32,32],{offset:4})||r([109,100,97,116],{offset:4})||r([109,111,111,118],{offset:4})||r([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(r([82,73,70,70])){if(r([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(r([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(r([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(r([48,38,178,117,142,102,207,17,166,217])){let a=30;do{const s=readUInt64LE(t,a+16);if(r([145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101],{offset:a})){if(r([64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43],{offset:a+24}))return{ext:"wma",mime:"audio/x-ms-wma"};if(r([192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43],{offset:a+24}))return{ext:"wmv",mime:"video/x-ms-asf"};break}a+=s}while(a+24<=t.length);return{ext:"asf",mime:"application/vnd.ms-asf"}}if(r([0,0,1,186])||r([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(r([102,116,121,112,51,103],{offset:4}))return{ext:"3gp",mime:"video/3gpp"};for(let a=0;a<2&&a<t.length-16;a++){if(r([73,68,51],{offset:a})||r([255,226],{offset:a,mask:[255,226]}))return{ext:"mp3",mime:"audio/mpeg"};if(r([255,228],{offset:a,mask:[255,228]}))return{ext:"mp2",mime:"audio/mpeg"};if(r([255,248],{offset:a,mask:[255,252]}))return{ext:"mp2",mime:"audio/mpeg"};if(r([255,240],{offset:a,mask:[255,252]}))return{ext:"mp4",mime:"audio/mpeg"}}if(r([102,116,121,112,77,52,65],{offset:4}))return{ext:"m4a",mime:"audio/mp4"};if(r([79,112,117,115,72,101,97,100],{offset:28}))return{ext:"opus",mime:"audio/opus"};if(r([79,103,103,83]))return r([128,116,104,101,111,114,97],{offset:28})?{ext:"ogv",mime:"video/ogg"}:r([1,118,105,100,101,111,0],{offset:28})?{ext:"ogm",mime:"video/ogg"}:r([127,70,76,65,67],{offset:28})?{ext:"oga",mime:"audio/ogg"}:r([83,112,101,101,120,32,32],{offset:28})?{ext:"spx",mime:"audio/ogg"}:r([1,118,111,114,98,105,115],{offset:28})?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"};if(r([102,76,97,67]))return{ext:"flac",mime:"audio/x-flac"};if(r([77,65,67,32]))return{ext:"ape",mime:"audio/ape"};if(r([119,118,112,107]))return{ext:"wv",mime:"audio/wavpack"};if(r([35,33,65,77,82,10]))return{ext:"amr",mime:"audio/amr"};if(r([37,80,68,70]))return{ext:"pdf",mime:"application/pdf"};if(r([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if((t[0]===67||t[0]===70)&&r([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(r([123,92,114,116,102]))return{ext:"rtf",mime:"application/rtf"};if(r([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(r([119,79,70,70])&&(r([0,1,0,0],{offset:4})||r([79,84,84,79],{offset:4})))return{ext:"woff",mime:"font/woff"};if(r([119,79,70,50])&&(r([0,1,0,0],{offset:4})||r([79,84,84,79],{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(r([76,80],{offset:34})&&(r([0,0,1],{offset:8})||r([1,0,2],{offset:8})||r([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(r([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(r([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(r([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(r([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(r([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(r([37,33]))return{ext:"ps",mime:"application/postscript"};if(r([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(r([83,81,76,105]))return{ext:"sqlite",mime:"application/x-sqlite3"};if(r([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(r([67,114,50,52]))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(r([77,83,67,70])||r([73,83,99,40]))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(r([33,60,97,114,99,104,62,10,100,101,98,105,97,110,45,98,105,110,97,114,121]))return{ext:"deb",mime:"application/x-deb"};if(r([33,60,97,114,99,104,62]))return{ext:"ar",mime:"application/x-unix-archive"};if(r([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(r([31,160])||r([31,157]))return{ext:"Z",mime:"application/x-compress"};if(r([76,90,73,80]))return{ext:"lz",mime:"application/x-lzip"};if(r([208,207,17,224,161,177,26,225]))return{ext:"msi",mime:"application/x-msi"};if(r([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(r([71],{offset:4})&&(r([71],{offset:192})||r([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(r([66,76,69,78,68,69,82]))return{ext:"blend",mime:"application/x-blender"};if(r([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(r([0,0,0,12,106,80,32,32,13,10,135,10])){if(r([106,112,50,32],{offset:20}))return{ext:"jp2",mime:"image/jp2"};if(r([106,112,120,32],{offset:20}))return{ext:"jpx",mime:"image/jpx"};if(r([106,112,109,32],{offset:20}))return{ext:"jpm",mime:"image/jpm"};if(r([109,106,112,50],{offset:20}))return{ext:"mj2",mime:"image/mj2"}}if(r([70,79,82,77]))return{ext:"aif",mime:"audio/aiff"};if(n("<?xml "))return{ext:"xml",mime:"application/xml"};if(r([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(r([102,116,121,112],{offset:4})){if(r([109,105,102,49],{offset:8}))return{ext:"heic",mime:"image/heif"};if(r([109,115,102,49],{offset:8}))return{ext:"heic",mime:"image/heif-sequence"};if(r([104,101,105,99],{offset:8})||r([104,101,105,120],{offset:8}))return{ext:"heic",mime:"image/heic"};if(r([104,101,118,99],{offset:8})||r([104,101,118,120],{offset:8}))return{ext:"heic",mime:"image/heic-sequence"}}return r([171,75,84,88,32,49,49,187,13,10,26,10])?{ext:"ktx",mime:"image/ktx"}:r([68,73,67,77],{offset:128})?{ext:"dcm",mime:"application/dicom"}:r([77,80,43])?{ext:"mpc",mime:"audio/x-musepack"}:r([77,80,67,75])?{ext:"mpc",mime:"audio/x-musepack"}:r([66,69,71,73,78,58])?{ext:"ics",mime:"text/calendar"}:r([103,108,84,70,2,0,0,0])?{ext:"glb",mime:"model/gltf-binary"}:r([212,195,178,161])||r([161,178,195,212])?{ext:"pcap",mime:"application/vnd.tcpdump.pcap"}:null};module.exports=fileType,module.exports.default=fileType,Object.defineProperty(fileType,"minimumBytes",{value:4100}),module.exports.stream=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.once("readable",()=>{const e=new stream.PassThrough,t=readableStream.read(module.exports.minimumBytes)||readableStream.read();try{e.fileType=fileType(t)}catch(r){reject(r)}readableStream.unshift(t),stream.pipeline?resolve(stream.pipeline(readableStream,e,()=>{})):resolve(readableStream.pipe(e))})})})(fileType$1);var fileTypeExports=fileType$1.exports;const fileType=fileTypeExports,imageExts=new Set(["jpg","png","gif","webp","flif","cr2","tif","bmp","jxr","psd","ico","bpg","jp2","jpm","jpx","heic","cur","dcm"]),imageType=e=>{const t=fileType(e);return imageExts.has(t&&t.ext)?t:null};imageType$2.exports=imageType;imageType$2.exports.default=imageType;Object.defineProperty(imageType,"minimumBytes",{value:fileType.minimumBytes});var imageTypeExports=imageType$2.exports,imageType$1=getDefaultExportFromCjs(imageTypeExports);function guessStripByteCounts(e){if(e.compression!==1)throw new Error("missing mandatory StripByteCounts field in compressed image");const t=e.rowsPerStrip*e.width*e.samplesPerPixel*(e.bitsPerSample/8);return new Array(e.stripOffsets.length).fill(t)}function applyHorizontalDifferencing8Bit(e,t,r){let n=0;for(;n<e.length;){for(let a=r;a<t*r;a+=r)for(let s=0;s<r;s++)e[n+a+s]=e[n+a+s]+e[n+a-(r-s)]&255;n+=t*r}}function applyHorizontalDifferencing16Bit(e,t,r){let n=0;for(;n<e.length;){for(let a=r;a<t*r;a+=r)for(let s=0;s<r;s++)e[n+a+s]=e[n+a+s]+e[n+a-(r-s)]&65535;n+=t*r}}const tagsById$2={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$2={};for(let e in tagsById$2)tagsByName$2[tagsById$2[e]]=Number(e);var exif=Object.freeze({__proto__:null,tagsById:tagsById$2,tagsByName:tagsByName$2});const tagsById$1={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$1={};for(let e in tagsById$1)tagsByName$1[tagsById$1[e]]=Number(e);var gps=Object.freeze({__proto__:null,tagsById:tagsById$1,tagsByName:tagsByName$1});const tagsById={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName={};for(let e in tagsById)tagsByName[tagsById[e]]=Number(e);var standard=Object.freeze({__proto__:null,tagsById,tagsByName});const tags={standard,exif,gps};class IFD{constructor(t){if(!t)throw new Error("missing kind");this.data=new Uint8Array,this.fields=new Map,this.kind=t,this._hasMap=!1,this._map={}}get(t){if(typeof t=="number")return this.fields.get(t);if(typeof t=="string")return this.fields.get(tags[this.kind].tagsByName[t]);throw new Error("expected a number or string")}get map(){if(!this._hasMap){const t=tags[this.kind].tagsById;for(let r of this.fields.keys())t[r]&&(this._map[t[r]]=this.fields.get(r));this._hasMap=!0}return this._map}}let types=new Map([[1,[1,readByte]],[2,[1,readASCII]],[3,[2,readShort]],[4,[4,readLong]],[5,[8,readRational]],[6,[1,readSByte]],[7,[1,readByte]],[8,[2,readSShort]],[9,[4,readSLong]],[10,[8,readSRational]],[11,[4,readFloat]],[12,[8,readDouble]]]);function getByteLength(e,t){const r=types.get(e);if(!r)throw new Error(`type not found: ${e}`);return r[0]*t}function readData(e,t,r){const n=types.get(t);if(!n)throw new Error(`type not found: ${t}`);return n[1](e,r)}function readByte(e,t){if(t===1)return e.readUint8();let r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.readUint8();return r}function readASCII(e,t){let r=[],n="";for(let a=0;a<t;a++){let s=String.fromCharCode(e.readUint8());s==="\0"?(r.push(n),n=""):n+=s}return r.length===1?r[0]:r}function readShort(e,t){if(t===1)return e.readUint16();let r=new Uint16Array(t);for(let n=0;n<t;n++)r[n]=e.readUint16();return r}function readLong(e,t){if(t===1)return e.readUint32();let r=new Uint32Array(t);for(let n=0;n<t;n++)r[n]=e.readUint32();return r}function readRational(e,t){if(t===1)return e.readUint32()/e.readUint32();let r=new Array(t);for(let n=0;n<t;n++)r[n]=e.readUint32()/e.readUint32();return r}function readSByte(e,t){if(t===1)return e.readInt8();let r=new Int8Array(t);for(let n=0;n<t;n++)r[n]=e.readInt8();return r}function readSShort(e,t){if(t===1)return e.readInt16();let r=new Int16Array(t);for(let n=0;n<t;n++)r[n]=e.readInt16();return r}function readSLong(e,t){if(t===1)return e.readInt32();let r=new Int32Array(t);for(let n=0;n<t;n++)r[n]=e.readInt32();return r}function readSRational(e,t){if(t===1)return e.readInt32()/e.readInt32();let r=new Array(t);for(let n=0;n<t;n++)r[n]=e.readInt32()/e.readInt32();return r}function readFloat(e,t){if(t===1)return e.readFloat32();let r=new Float32Array(t);for(let n=0;n<t;n++)r[n]=e.readFloat32();return r}function readDouble(e,t){if(t===1)return e.readFloat64();let r=new Float64Array(t);for(let n=0;n<t;n++)r[n]=e.readFloat64();return r}const CLEAR_CODE=256,EOI_CODE=257,TABLE_START=258,MIN_BIT_LENGTH=9;let stringTable=[];function initializeStringTable(){if(stringTable.length===0){for(let t=0;t<256;t++)stringTable.push([t]);const e=[];for(let t=256;t<4096;t++)stringTable.push(e)}}const andTable=[511,1023,2047,4095],bitJumps=[0,0,0,0,0,0,0,0,0,511,1023,2047,4095];class LzwDecoder{constructor(t){this.nextData=0,this.nextBits=0,this.bytePointer=0,this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH,this.stripArray=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),this.outData=new IOBuffer$4(t.byteLength),this.initializeTable()}decode(){let t=0,r=0;for(;(t=this.getNextCode())!==EOI_CODE;)if(t===CLEAR_CODE){if(this.initializeTable(),t=this.getNextCode(),t===EOI_CODE)break;this.writeString(this.stringFromCode(t)),r=t}else if(this.isInTable(t))this.writeString(this.stringFromCode(t)),this.addStringToTable(this.stringFromCode(r).concat(this.stringFromCode(t)[0])),r=t;else{const a=this.stringFromCode(r).concat(this.stringFromCode(r)[0]);this.writeString(a),this.addStringToTable(a),r=t}const n=this.outData.toArray();return new DataView(n.buffer,n.byteOffset,n.byteLength)}initializeTable(){initializeStringTable(),this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH}writeString(t){this.outData.writeBytes(t)}stringFromCode(t){return stringTable[t]}isInTable(t){return t<this.tableLength}addStringToTable(t){if(stringTable[this.tableLength++]=t,stringTable.length>4096)throw stringTable=[],new Error("LZW decoding error. Please open an issue at https://github.com/image-js/tiff/issues/new/choose (include a test image).");this.tableLength===bitJumps[this.currentBitLength]&&this.currentBitLength++}getNextCode(){this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8,this.nextBits<this.currentBitLength&&(this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8);const t=this.nextData>>this.nextBits-this.currentBitLength&andTable[this.currentBitLength-9];return this.nextBits-=this.currentBitLength,this.bytePointer>this.stripArray.length?257:t}}function decompressLzw(e){return new LzwDecoder(e).decode()}const dateTimeRegex=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class TiffIfd extends IFD{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){let t=new Date,r=dateTimeRegex.exec(this.dateTime);if(r===null)throw new Error(`invalid dateTime: ${this.dateTime}`);return t.setFullYear(Number(r[1]),Number(r[2])-1,Number(r[3])),t.setHours(Number(r[4]),Number(r[5]),Number(r[6])),t}get newSubfileType(){return this.get("NewSubfileType")}get imageWidth(){return this.get("ImageWidth")}get imageLength(){return this.get("ImageLength")}get bitsPerSample(){const t=this.get("BitsPerSample");return t&&typeof t!="number"?t[0]:t}get alpha(){const t=this.extraSamples;return t?t[0]!==0:!1}get associatedAlpha(){const t=this.extraSamples;return t?t[0]===1:!1}get extraSamples(){return alwaysArray(this.get("ExtraSamples"))}get compression(){return this.get("Compression")||1}get type(){return this.get("PhotometricInterpretation")}get fillOrder(){return this.get("FillOrder")||1}get documentName(){return this.get("DocumentName")}get imageDescription(){return this.get("ImageDescription")}get stripOffsets(){return alwaysArray(this.get("StripOffsets"))}get orientation(){return this.get("Orientation")}get samplesPerPixel(){return this.get("SamplesPerPixel")||1}get rowsPerStrip(){return this.get("RowsPerStrip")}get stripByteCounts(){return alwaysArray(this.get("StripByteCounts"))}get minSampleValue(){return this.get("MinSampleValue")||0}get maxSampleValue(){return this.get("MaxSampleValue")||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get("XResolution")}get yResolution(){return this.get("YResolution")}get planarConfiguration(){return this.get("PlanarConfiguration")||1}get resolutionUnit(){return this.get("ResolutionUnit")||2}get dateTime(){return this.get("DateTime")}get predictor(){return this.get("Predictor")||1}get sampleFormat(){return this.get("SampleFormat")||1}get sMinSampleValue(){return this.get("SMinSampleValue")||this.minSampleValue}get sMaxSampleValue(){return this.get("SMaxSampleValue")||this.maxSampleValue}get palette(){const t=2**this.bitsPerSample,r=this.get("ColorMap");if(!r)return;if(r.length!==3*t)throw new Error(`ColorMap size must be ${t}`);const n=[];for(let a=0;a<t;a++)n.push([r[a],r[a+t],r[a+2*t]]);return n}}function alwaysArray(e){return typeof e=="number"?[e]:e}function decompressZlib(e){const t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),r=inflate_1(t);return new DataView(r.buffer,r.byteOffset,r.byteLength)}const defaultOptions$c={ignoreImageData:!1,onlyFirst:!1};class TIFFDecoder extends IOBuffer$4{constructor(t){super(t),this._nextIFD=0}get isMultiPage(){let t=0;for(this.decodeHeader();this._nextIFD;)if(t++,this.decodeIFD({ignoreImageData:!0},!0),t===2)return!0;if(t===1)return!1;throw unsupported("ifdCount",t)}get pageCount(){let t=0;for(this.decodeHeader();this._nextIFD;)t++,this.decodeIFD({ignoreImageData:!0},!0);if(t>0)return t;throw unsupported("ifdCount",t)}decode(t={}){t=Object.assign({},defaultOptions$c,t);const r=[];for(this.decodeHeader();this._nextIFD;)if(r.push(this.decodeIFD(t,!0)),t.onlyFirst)return[r[0]];return r}decodeHeader(){const t=this.readUint16();if(t===18761)this.setLittleEndian();else if(t===19789)this.setBigEndian();else throw new Error(`invalid byte order: 0x${t.toString(16)}`);if(this.readUint16()!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(t,r){this.seek(this._nextIFD);let n;if(r)n=new TiffIfd;else{if(!t.kind)throw new Error("kind is missing");n=new IFD(t.kind)}const a=this.readUint16();for(let s=0;s<a;s++)this.decodeIFDEntry(n);if(!t.ignoreImageData){if(!(n instanceof TiffIfd))throw new Error("must be a tiff ifd");this.decodeImageData(n)}return this._nextIFD=this.readUint32(),n}decodeIFDEntry(t){const r=this.offset,n=this.readUint16(),a=this.readUint16(),s=this.readUint32();if(a<1||a>12){this.skip(4);return}getByteLength(a,s)>4&&this.seek(this.readUint32());const l=readData(this,a,s);if(t.fields.set(n,l),n===34665||n===34853){let f=this.offset,h="exif";n===34665?h="exif":n===34853&&(h="gps"),this._nextIFD=l,t[h]=this.decodeIFD({kind:h,ignoreImageData:!0},!1),this.offset=f}this.seek(r),this.skip(12)}decodeImageData(t){const r=t.orientation;if(r&&r!==1)throw unsupported("orientation",r);switch(t.type){case 0:case 1:case 2:case 3:this.readStripData(t);break;default:throw unsupported("image type",t.type)}if(this.applyPredictor(t),this.convertAlpha(t),t.type===0){const n=t.bitsPerSample,a=Math.pow(2,n)-1;for(let s=0;s<t.data.length;s++)t.data[s]=a-t.data[s]}}readStripData(t){const r=t.width,n=t.height,a=t.bitsPerSample,s=t.sampleFormat,o=r*n*t.samplesPerPixel,l=getDataArray(o,a,s),h=t.rowsPerStrip*r*t.samplesPerPixel,c=t.stripOffsets,u=t.stripByteCounts||guessStripByteCounts(t);let d=o,g=0;for(let p=0;p<c.length;p++){let m=new DataView(this.buffer,this.byteOffset+c[p],u[p]),y=d>h?h:d;d-=y;let x=m;switch(t.compression){case 1:break;case 5:{x=decompressLzw(m);break}case 8:{x=decompressZlib(m);break}case 2:throw unsupported("Compression","CCITT Group 3");case 32773:throw unsupported("Compression","PackBits");default:throw unsupported("Compression",t.compression)}g=this.fillUncompressed(a,s,l,x,g,y)}t.data=l}fillUncompressed(t,r,n,a,s,o){if(t===8)return fill8bit(n,a,s,o);if(t===16)return fill16bit(n,a,s,o,this.isLittleEndian());if(t===32&&r===3)return fillFloat32(n,a,s,o,this.isLittleEndian());throw unsupported("bitDepth",t)}applyPredictor(t){const r=t.bitsPerSample;switch(t.predictor){case 1:break;case 2:{if(r===8)applyHorizontalDifferencing8Bit(t.data,t.width,t.components);else if(r===16)applyHorizontalDifferencing16Bit(t.data,t.width,t.components);else throw new Error(`Horizontal differencing is only supported for images with a bit depth of ${r}`);break}default:throw new Error(`invalid predictor: ${t.predictor}`)}}convertAlpha(t){if(t.alpha&&t.associatedAlpha){const{data:r,components:n,maxSampleValue:a}=t;for(let s=0;s<r.length;s+=n){const o=r[s+n-1];for(let l=0;l<n-1;l++)r[s+l]=Math.round(r[s+l]*a/o)}}}}function getDataArray(e,t,r){if(t===8)return new Uint8Array(e);if(t===16)return new Uint16Array(e);if(t===32&&r===3)return new Float32Array(e);throw unsupported("bit depth / sample format",`${t} / ${r}`)}function fill8bit(e,t,r,n){for(let a=0;a<n;a++)e[r++]=t.getUint8(a);return r}function fill16bit(e,t,r,n,a){for(let s=0;s<n*2;s+=2)e[r++]=t.getUint16(s,a);return r}function fillFloat32(e,t,r,n,a){for(let s=0;s<n*4;s+=4)e[r++]=t.getFloat32(s,a);return r}function unsupported(e,t){return new Error(`Unsupported ${e}: ${t}`)}function decodeTIFF(e,t){return new TIFFDecoder(e).decode(t)}function matchAndCrop(e={}){let{algorithm:t="matchToPrevious",ignoreBorder:r=[0,0]}=e;this.checkProcessable("matchAndCrop",{bitDepth:[8,16]});let n=t==="matchToPrevious",a=this[0],s=[];s[0]={position:[0,0],image:this[0]};let o=[0,0];for(let d=1;d<this.length;d++){let g=a.getBestMatch(this[d],{border:r});s[d]={position:[g[0]+o[0],g[1]+o[1]],image:this[d]},n&&(o[0]+=g[0],o[1]+=g[1],a=this[d])}let l=0,f=0,h=0,c=0;for(let d=0;d<s.length;d++){let g=s[d];g.position[0]>l&&(l=g.position[0]),g.position[0]<f&&(f=g.position[0]),g.position[1]>h&&(h=g.position[1]),g.position[1]<c&&(c=g.position[1])}f=0-f,c=0-c;for(let d=0;d<s.length;d++){let g=s[d];g.crop=g.image.crop({x:l-g.position[0],y:h-g.position[1],width:a.width-f-l,height:a.height-c-h})}let u=[];for(let d=0;d<s.length;d++)u[d]=s[d].crop;return new Stack$3(u)}function min$2(){this.checkProcessable("min",{bitDepth:[8,16]});let e=this[0].min;for(let t=1;t<this.length;t++)for(let r=0;r<e.length;r++)e[r]=Math.min(e[r],this[t].min[r]);return e}function max$2(){this.checkProcessable("min",{bitDepth:[8,16]});let e=this[0].max;for(let t=1;t<this.length;t++)for(let r=0;r<e.length;r++)e[r]=Math.max(e[r],this[t].max[r]);return e}function median$2(e){let t=e.reduce((o,l)=>o+l);if(t===0)throw new Error("unreachable");let r=0,n=0,a=t/2,s;for(;;){if(e[r]>0){if(s!==void 0)return(s+r)/2;if(n+=e[r],n>a)return r;n===a&&(s=r)}r++}}function mean$2(e){let t=0,r=0;for(let n=0;n<e.length;n++)t+=e[n],r+=e[n]*n;return t===0?0:r/t}function median$1(){this.checkProcessable("median",{bitDepth:[8,16]});let e=this.getHistograms({maxSlots:this[0].maxValue+1}),t=new Array(e.length);for(let r=0;r<e.length;r++){let n=e[r];t[r]=median$2(n)}return t}function histogram(e){this.checkProcessable("min",{bitDepth:[8,16]});let t=this[0].getHistogram(e);for(let r=1;r<this.length;r++){let n=this[r].getHistogram(e);for(let a=0;a<t.length;a++)t[a]+=n[a]}return t}function histograms(e){this.checkProcessable("min",{bitDepth:[8,16]});let t=this[0].getHistograms(e),r=t[0].length;for(let n=1;n<this.length;n++){let a=this[n].getHistograms(e);for(let s=0;s<t.length;s++)for(let o=0;o<r;o++)t[s][o]+=a[s][o]}return t}function averageImage(){this.checkProcessable("averageImage",{bitDepth:[8,16]});let e=new Uint32Array(this[0].data.length);for(let n=0;n<this.length;n++){let a=this[n];for(let s=0;s<this[0].data.length;s++)e[s]+=a.data[s]}let t=Image.createFrom(this[0]),r=t.data;for(let n=0;n<this[0].data.length;n++)r[n]=e[n]/this.length;return t}function maxImage(){this.checkProcessable("max",{bitDepth:[8,16]});let e=Image.createFrom(this[0]);e.data.fill(0);for(const t of this)for(let r=0;r<e.data.length;r++)e.data[r]=Math.max(t.data[r],e.data[r]);return e}function minImage(){this.checkProcessable("max",{bitDepth:[8,16]});let e=Image.createFrom(this[0]);e.data.fill(e.maxValue);for(const t of this)for(let r=0;r<e.data.length;r++)e.data[r]=Math.min(t.data[r],e.data[r]);return e}function extend$2(e){e.extendMethod("matchAndCrop",matchAndCrop),e.extendMethod("getMin",min$2),e.extendMethod("getMax",max$2),e.extendMethod("getMedian",median$1),e.extendMethod("getHistogram",histogram),e.extendMethod("getHistograms",histograms),e.extendMethod("getAverage",averageImage),e.extendMethod("getAverageImage",averageImage),e.extendMethod("getMaxImage",maxImage),e.extendMethod("getMinImage",minImage)}let computedPropertyDescriptor={configurable:!0,enumerable:!1,get:void 0},Stack$3=class Xe extends Array{constructor(t){if(Array.isArray(t)){super(t.length);for(let r=0;r<t.length;r++)this[r]=t[r]}else typeof t=="number"?super(t):super();this.computed=null}static load(t){return Promise.all(t.map(Image.load)).then(r=>new Xe(r))}static extendMethod(t,r,n={}){let{inPlace:a=!1,returnThis:s=!0,partialArgs:o=[]}=n;return a?Xe.prototype[t]=function(...l){this.computed=null;let f=r.apply(this,[...o,...l]);return s?this:f}:Xe.prototype[t]=function(...l){return r.apply(this,[...o,...l])},Xe}static extendProperty(t,r,n={}){let{partialArgs:a=[]}=n;return computedPropertyDescriptor.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(t,this.computed))return this.computed[t];let s=r.apply(this,a);return this.computed[t]=s,s},Object.defineProperty(Xe.prototype,t,computedPropertyDescriptor),Xe}checkProcessable(t,r={}){if(typeof t!="string")throw new TypeError("checkProcessable requires as first parameter the processName (a string)");if(this.size===0)throw new TypeError(`The process: ${t} can not be applied on an empty stack`);this[0].checkProcessable(t,r);for(let n=1;n<this.length;n++){if((r.sameSize===void 0||r.sameSize)&&this[0].width!==this[n].width)throw new TypeError(`The process: ${t} can not be applied if width is not identical in all images`);if((r.sameSize===void 0||r.sameSize)&&this[0].height!==this[n].height)throw new TypeError(`The process: ${t} can not be applied if height is not identical in all images`);if((r.sameAlpha===void 0||r.sameAlpha)&&this[0].alpha!==this[n].alpha)throw new TypeError(`The process: ${t} can not be applied if alpha is not identical in all images`);if((r.sameBitDepth===void 0||r.sameBitDepth)&&this[0].bitDepth!==this[n].bitDepth)throw new TypeError(`The process: ${t} can not be applied if bitDepth is not identical in all images`);if((r.sameColorModel===void 0||r.sameColorModel)&&this[0].colorModel!==this[n].colorModel)throw new TypeError(`The process: ${t} can not be applied if colorModel is not identical in all images`);if((r.sameNumberChannels===void 0||r.sameNumberChannels)&&this[0].channels!==this[n].channels)throw new TypeError(`The process: ${t} can not be applied if channels is not identical in all images`)}}};Array[Symbol.species]||(Stack$3.prototype.map=function(e,t){if(typeof e!="function")throw new TypeError(`${e} is not a function`);let r=new Stack$3(this.length);for(let n=0;n<this.length;n++)r[n]=e.call(t,this[n],n,this);return r});extend$2(Stack$3);const isDataURL=/^data:[a-z]+\/(?:[a-z]+);base64,/;function load(e,t){if(typeof e=="string")return loadURL(e,t);if(e instanceof ArrayBuffer)return Promise.resolve(loadBinary(new Uint8Array(e),void 0,t&&t.ignorePalette));if(e.buffer)return Promise.resolve(loadBinary(e,void 0,t&&t.ignorePalette));throw new Error('argument to "load" must be a string or buffer.')}function loadBinary(e,t,r){const n=imageType$1(e);if(n)switch(n.mime){case"image/png":return loadPNG(e);case"image/jpeg":return loadJPEG(e);case"image/tiff":return loadTIFF(e,r);default:return loadGeneric(a(n.mime))}return loadGeneric(a("application/octet-stream"));function a(s){return t||toBase64URL(e,s)}}function loadURL(e,t){const r=e.slice(0,64).match(isDataURL);let n;return r!==null?n=Promise.resolve(decode$3(e.slice(r[0].length))):n=fetchBinary(e,t),n.then(a=>{const s=new Uint8Array(a);return loadBinary(s,r?e:void 0,t&&t.ignorePalette)})}function loadPNG(e){const t=decodePng(e);let r=t.channels,n,a=0;return r===2||r===4?(n=r-1,a=1):n=r,t.palette?loadPNGFromPalette(t):new Image(t.width,t.height,t.data,{components:n,alpha:a,bitDepth:t.depth})}function loadPNGFromPalette(e){const t=e.width*e.height,r=e.palette[0].length,n=new Uint8Array(t*r),a=8/e.depth,s=e.depth<8?a:1,o=parseInt("1".repeat(e.depth),2),l=r===4;let f=0;for(let h=0;h<t;h++){const c=Math.floor(h/s);let u=e.data[c];e.depth<8&&(u=u>>>e.depth*(a-1-h%a)&o);const d=e.palette[u];n[f++]=d[0],n[f++]=d[1],n[f++]=d[2],l&&(n[f++]=d[3])}return new Image(e.width,e.height,n,{components:3,alpha:l,bitDepth:8})}function loadJPEG(e){const t=decode(e);let r;t.exif&&(r=getMetadata(t.exif));const n=jpegJs.decode(e,{useTArray:!0,maxMemoryUsageInMB:1024});let a=new Image(n.width,n.height,n.data,{meta:r});if(r&&r.tiff.tags.Orientation){const s=r.tiff.tags.Orientation;s>2&&(a=a.rotate({3:180,4:180,5:90,6:90,7:270,8:270}[s])),[2,4,5,7].includes(s)&&(a=a.flipX())}return a}function loadTIFF(e,t){let r=decodeTIFF(e);return r.length===1?getImageFromIFD(r[0],t):new Stack$3(r.map(function(n){return getImageFromIFD(n,t)}))}function getMetadata(e){const t={tiff:{fields:e.fields,tags:e.map}};return e.exif&&(t.exif=e.exif),e.gps&&(t.gps=e.gps),t}function getImageFromIFD(e,t){if(!t&&e.type===3){const r=new Uint16Array(3*e.width*e.height),n=e.palette;let a=0;for(let s=0;s<e.data.length;s++){const o=e.data[s],l=n[o];r[a++]=l[0],r[a++]=l[1],r[a++]=l[2]}return new Image(e.width,e.height,r,{components:3,alpha:e.alpha,colorModel:RGB$1,bitDepth:16,meta:getMetadata(e)})}else return new Image(e.width,e.height,e.data,{components:e.type===2?3:1,alpha:e.alpha,colorModel:e.type===2?RGB$1:GREY$1,bitDepth:e.bitsPerSample.length?e.bitsPerSample[0]:e.bitsPerSample,meta:getMetadata(e)})}function loadGeneric(e,t){return t=t||{},new Promise(function(r,n){let a=new DOMImage;a.onload=function(){let s=a.width,o=a.height,f=createCanvas(s,o).getContext("2d");f.drawImage(a,0,0,s,o);let h=f.getImageData(0,0,s,o).data;r(new Image(s,o,h,t))},a.onerror=function(){n(new Error(`Could not load ${e}`))},a.src=e})}const valueMethods={getValueXY(e,t,r){return this.data[(t*this.width+e)*this.channels+r]},setValueXY(e,t,r,n){return this.data[(t*this.width+e)*this.channels+r]=n,this.computed=null,this},getValue(e,t){return this.data[e*this.channels+t]},setValue(e,t,r){return this.data[e*this.channels+t]=r,this.computed=null,this},getPixelXY(e,t){return this.getPixel(t*this.width+e)},setPixelXY(e,t,r){return this.setPixel(t*this.width+e,r)},getPixel(e){const t=new Array(this.channels),r=e*this.channels;for(let n=0;n<this.channels;n++)t[n]=this.data[r+n];return t},setPixel(e,t){const r=e*this.channels;for(let n=0;n<t.length;n++)this.data[r+n]=t[n];return this.computed=null,this}};function setValueMethods(e){for(const t in valueMethods)e.prototype[t]=valueMethods[t]}function getImageParameters(e){return{width:e.width,height:e.height,components:e.components,alpha:e.alpha,colorModel:e.colorModel,bitDepth:e.bitDepth}}function getOutputImage(e,t,r,n={}){const{out:a}=t;if(a===void 0)return n.copy?e.clone():Image.createFrom(e,r);{if(!Image.isImage(a))throw new TypeError("out must be an Image object");const s=Object.assign(getImageParameters(e),r);for(const o in s)if(a[o]!==s[o])throw new RangeError(`cannot use out. Its ${o} must be "${s[o]}" (found "${a[o]}")`);return a}}function getOutputImageOrInPlace(e,t,r){if(t.inPlace!==void 0&&typeof t.inPlace!="boolean")throw new TypeError("inPlace option must be a boolean");if(t.inPlace){if(t.out!==void 0)throw new TypeError("out option must not be set if inPlace option is true");return e}return getOutputImage(e,t,null,r)}function abs(e={}){this.checkProcessable("abs",{bitDepth:[32]});const t=getOutputImageOrInPlace(this,e);return absolute(this,t),t}function absolute(e,t){for(let r=0;r<e.data.length;r++)t.data[r]=Math.abs(e.data[r])}function copyAlphaChannel(e,t){if(e.alpha===1&&t.alpha===1)for(let r=0;r<e.size;r++)t.data[r*t.channels+t.components]=e.data[r*e.channels+e.components]}function invert(e={}){this.checkProcessable("invert",{bitDepth:[1,8,16]});const t=getOutputImageOrInPlace(this,e);return this.bitDepth===1?invertBinary(this,t):(invertColor(this,t),this!==t&&copyAlphaChannel(this,t)),t}function invertBinary(e,t){for(let r=0;r<e.data.length;r++)t.data[r]=~e.data[r]}function invertColor(e,t){for(let r=0;r<e.data.length;r+=e.channels)for(let n=0;n<e.components;n++)t.data[r+n]=e.maxValue-e.data[r+n]}function flipX(){this.checkProcessable("flipX",{bitDepth:[8,16]});for(let e=0;e<this.height;e++){let t=e*this.width*this.channels;for(let r=0;r<Math.floor(this.width/2);r++){let n=r*this.channels+t,a=(this.width-r-1)*this.channels+t;for(let s=0;s<this.channels;s++){let o=this.data[n+s];this.data[n+s]=this.data[a+s],this.data[a+s]=o}}}return this}function flipY(){this.checkProcessable("flipY",{bitDepth:[8,16]});for(let e=0;e<Math.floor(this.height/2);e++)for(let t=0;t<this.width;t++){let r=t*this.channels+e*this.width*this.channels,n=t*this.channels+(this.height-1-e)*this.channels*this.width;for(let a=0;a<this.channels;a++){let s=this.data[r+a];this.data[r+a]=this.data[n+a],this.data[n+a]=s}}return this}function blurFilter(e={}){const{radius:t=1}=e;if(t<1)throw new Error("radius must be greater than 1");const r=2*t+1,n=new Array(r);for(let a=0;a<r;a++){n[a]=new Array(r);for(let s=0;s<r;s++)n[a][s]=1/(r*r)}return this.convolution(n)}var medianQuickselect_min={exports:{}};(function(e){(function(){function t(a){for(var s=0,o=a.length-1,l=void 0,f=void 0,h=void 0,c=n(s,o);;){if(o<=s)return a[c];if(o==s+1)return a[s]>a[o]&&r(a,s,o),a[c];for(l=n(s,o),a[l]>a[o]&&r(a,l,o),a[s]>a[o]&&r(a,s,o),a[l]>a[s]&&r(a,l,s),r(a,l,s+1),f=s+1,h=o;;){do f++;while(a[s]>a[f]);do h--;while(a[h]>a[s]);if(h<f)break;r(a,f,h)}r(a,s,h),h<=c&&(s=f),h>=c&&(o=h-1)}}var r=function(s,o,l){var f;return f=[s[l],s[o]],s[o]=f[0],s[l]=f[1],f},n=function(s,o){return~~((s+o)/2)};e.exports?e.exports=t:window.median=t})()})(medianQuickselect_min);var medianQuickselect_minExports=medianQuickselect_min.exports,quickSelectMedian=getDefaultExportFromCjs(medianQuickselect_minExports);function validateArrayOfChannels(e,t={}){let{channels:r,allowAlpha:n,defaultAlpha:a}=t;return typeof n!="boolean"&&(n=!0),typeof r>"u"?allChannels(e,a):validateChannels(e,r,n)}function allChannels(e,t){let r=t?e.channels:e.components,n=new Array(r);for(let a=0;a<r;a++)n[a]=a;return n}function validateChannels(e,t,r){Array.isArray(t)||(t=[t]);for(let n=0;n<t.length;n++)t[n]=validateChannel(e,t[n],r);return t}function validateChannel(e,t,r=!0){if(t===void 0)throw new RangeError(`validateChannel : the channel has to be >=0 and <${e.channels}`);if(typeof t=="string"){switch(e.colorModel){case GREY$1:break;case RGB$1:if("rgb".includes(t))switch(t){case"r":t=0;break;case"g":t=1;break;case"b":t=2;break}break;case HSL:if("hsl".includes(t))switch(t){case"h":t=0;break;case"s":t=1;break;case"l":t=2;break}break;case HSV:if("hsv".includes(t))switch(t){case"h":t=0;break;case"s":t=1;break;case"v":t=2;break}break;case CMYK$1:if("cmyk".includes(t))switch(t){case"c":t=0;break;case"m":t=1;break;case"y":t=2;break;case"k":t=3;break}break;default:throw new Error(`Unexpected color model: ${e.colorModel}`)}if(t==="a"){if(!e.alpha)throw new Error("validateChannel : the image does not contain alpha channel");t=e.components}if(typeof t=="string")throw new Error(`validateChannel : undefined channel: ${t}`)}if(t>=e.channels)throw new RangeError(`validateChannel : the channel has to be >=0 and <${e.channels}`);if(!r&&t>=e.components)throw new RangeError("validateChannel : alpha channel may not be selected");return t}function medianFilter(e={}){let{radius:t=1,border:r="copy",channels:n}=e;if(this.checkProcessable("medianFilter",{bitDepth:[8,16]}),t<1)throw new Error("radius must be greater than 0");n=validateArrayOfChannels(this,n);let a=t,s=t,o=Image.createFrom(this),l=(a*2+1)*(s*2+1),f=new Array(l);for(let h=0;h<n.length;h++){let c=n[h];for(let u=s;u<this.height-s;u++)for(let d=a;d<this.width-a;d++){let g=0;for(let m=-s;m<=s;m++)for(let y=-a;y<=a;y++){let x=((u+m)*this.width+d+y)*this.channels+c;f[g++]=this.data[x]}let p=(u*this.width+d)*this.channels+c;o.data[p]=quickSelectMedian(f)}}if(this.alpha&&!n.includes(this.channels))for(let h=this.components;h<this.data.length;h=h+this.channels)o.data[h]=this.data[h];return o.setBorder({size:[a,s],algorithm:r}),o}function gaussianFilter(e={}){let{radius:t=1,sigma:r,channels:n,border:a="copy"}=e;this.checkProcessable("gaussian",{bitDepth:[8,16]});const s=getKernel(t,r);return this.convolution([s,s],{border:a,channels:n,algorithm:"separable"})}function getKernel(e,t){const r=e*2+1,n=new Array(r),a=t||((r-1)*.5-1)*.3+.8,s=-.5/(a*a);let o=0;for(let l=0;l<r;l++){const f=l-e,h=Math.exp(s*f*f);n[l]=h,o+=h}for(let l=0;l<r;l++)n[l]/=o;return n}const SOBEL_X=[[-1,0,1],[-2,0,2],[-1,0,1]],SOBEL_Y=[[-1,-2,-1],[0,0,0],[1,2,1]],SCHARR_X=[[3,0,-3],[10,0,-10],[3,0,-3]],SCHARR_Y=[[3,10,3],[0,0,0],[-3,-10,-3]];var src$3={},fftlib={};(function(e){(function(){var t;t=e;var r={release:"0.3.0",date:"2013-03"};t.toString=function(){return"version "+r.release+", released "+r.date};for(var n=0,a=null,s=null,o={init:function(h){if(h!==0&&!(h&h-1))n=h,o._initArray(),o._makeBitReversalTable(),o._makeCosSinTable();else throw new Error("init: radix-2 required")},fft1d:function(h,c){o.fft(h,c,1)},ifft1d:function(h,c){var u=1/n;o.fft(h,c,-1);for(var d=0;d<n;d++)h[d]*=u,c[d]*=u},bt1d:function(h,c){o.fft(h,c,-1)},fft2d:function(h,c){for(var u=[],d=[],g=0,p=0;p<n;p++){g=p*n;for(var m=0;m<n;m++)u[m]=h[m+g],d[m]=c[m+g];o.fft1d(u,d);for(var y=0;y<n;y++)h[y+g]=u[y],c[y+g]=d[y]}for(var x=0;x<n;x++){for(var E=0;E<n;E++)g=x+E*n,u[E]=h[g],d[E]=c[g];o.fft1d(u,d);for(var _=0;_<n;_++)g=x+_*n,h[g]=u[_],c[g]=d[_]}},ifft2d:function(h,c){for(var u=[],d=[],g=0,p=0;p<n;p++){g=p*n;for(var m=0;m<n;m++)u[m]=h[m+g],d[m]=c[m+g];o.ifft1d(u,d);for(var y=0;y<n;y++)h[y+g]=u[y],c[y+g]=d[y]}for(var x=0;x<n;x++){for(var E=0;E<n;E++)g=x+E*n,u[E]=h[g],d[E]=c[g];o.ifft1d(u,d);for(var _=0;_<n;_++)g=x+_*n,h[g]=u[_],c[g]=d[_]}},fft:function(h,c,u){for(var d,g,p,m,y,x,E,_,w,M=n>>2,I=0;I<n;I++)m=a[I],I<m&&(y=h[I],h[I]=h[m],h[m]=y,y=c[I],c[I]=c[m],c[m]=y);for(var k=1;k<n;k<<=1){g=0,d=n/(k<<1);for(var v=0;v<k;v++){x=s[g+M],E=u*s[g];for(var S=v;S<n;S+=k<<1)p=S+k,_=x*h[p]+E*c[p],w=x*c[p]-E*h[p],h[p]=h[S]-_,h[S]+=_,c[p]=c[S]-w,c[S]+=w;g+=d}}},_initArray:function(){typeof Uint32Array<"u"?a=new Uint32Array(n):a=[],typeof Float64Array<"u"?s=new Float64Array(n*1.25):s=[]},_paddingZero:function(){},_makeBitReversalTable:function(){var h=0,c=0,u=0;for(a[0]=0;++h<n;){for(u=n>>1;u<=c;)c-=u,u>>=1;c+=u,a[h]=c}},_makeCosSinTable:function(){var h=n>>1,c=n>>2,u=n>>3,d=h+c,g=Math.sin(Math.PI/n),p=2*g*g,m=Math.sqrt(p*(2-p)),y=s[c]=1,x=s[0]=0;g=2*p;for(var E=1;E<u;E++)y-=p,p+=g*y,x+=m,m-=g*x,s[E]=x,s[c-E]=y;u!==0&&(s[u]=Math.sqrt(.5));for(var _=0;_<c;_++)s[h-_]=s[_];for(var w=0;w<d;w++)s[w+h]=-s[w]}},l=["init","fft1d","ifft1d","fft2d","ifft2d"],f=0;f<l.length;f++)t[l[f]]=o[l[f]];return t.bt=o.bt1d,t.fft=o.fft1d,t.ifft=o.ifft1d,t}).call(commonjsGlobal)})(fftlib);var FFT$1=fftlib,FFTUtils$1={DEBUG:!1,ifft2DArray:function(e,t,r){var n=new Array(t*r),a=t/2,s=(r-1)*2;FFT$1.init(a);for(var o={re:new Array(a),im:new Array(a)},l=0;l<r;l++){for(var f=a-1;f>=0;f--)o.re[f]=e[f*2*r+l],o.im[f]=e[(f*2+1)*r+l];FFT$1.bt(o.re,o.im);for(var f=a-1;f>=0;f--)n[f*2*r+l]=o.re[f],n[(f*2+1)*r+l]=o.im[f]}var h=new Array(a*s);FFT$1.init(s);for(var c={re:new Array(s),im:new Array(s)},u=s*a,f=0;f<t;f+=2){c.re[0]=n[f*r],c.im[0]=n[(f+1)*r];for(var l=1;l<r;l++)c.re[l]=n[f*r+l],c.im[l]=n[(f+1)*r+l],c.re[s-l]=n[f*r+l],c.im[s-l]=-n[(f+1)*r+l];FFT$1.bt(c.re,c.im);for(var d=f/2*s,l=s-1;l>=0;l--)h[d+l]=c.re[l]/u}return h},fft2DArray:function(e,t,r,n){Object.assign({},{inplace:!0});var a=r/2+1,s=t*2,o=new Array(s*a);FFT$1.init(r);for(var l={re:new Array(r),im:new Array(r)},f={re:new Array(r),im:new Array(r)},h={re:new Array(r),im:new Array(r)},c,u,d,g,p,m=0;m<t/2;m++){c=m*2*r,l.re=e.slice(c,c+r),c=(m*2+1)*r,l.im=e.slice(c,c+r),FFT$1.fft1d(l.re,l.im),this.reconstructTwoRealFFT(l,f,h),u=m*4*a,d=(m*4+1)*a,g=(m*4+2)*a,p=(m*4+3)*a;for(var y=a-1;y>=0;y--)o[u+y]=f.re[y],o[d+y]=f.im[y],o[g+y]=h.re[y],o[p+y]=h.im[y]}f=null,h=null;var x=new Array(s*a);FFT$1.init(t);for(var E={re:new Array(t),im:new Array(t)},_=a-1;_>=0;_--){for(var m=t-1;m>=0;m--)E.re[m]=o[m*2*a+_],E.im[m]=o[(m*2+1)*a+_],isNaN(E.re[m])&&(E.re[m]=0),isNaN(E.im[m])&&(E.im[m]=0);FFT$1.fft1d(E.re,E.im);for(var m=t-1;m>=0;m--)x[m*2*a+_]=E.re[m],x[(m*2+1)*a+_]=E.im[m]}return x},reconstructTwoRealFFT:function(e,t,r){var n=e.re.length;t.re[0]=e.re[0],t.im[0]=0,r.re[0]=e.im[0],r.im[0]=0;for(var a,s,o,l,f,h=n/2;h>0;h--)f=n-h,a=.5*(e.re[h]-e.re[f]),s=.5*(e.re[h]+e.re[f]),o=.5*(e.im[h]-e.im[f]),l=.5*(e.im[h]+e.im[f]),t.re[h]=s,t.im[h]=o,t.re[f]=s,t.im[f]=-o,r.re[h]=l,r.im[h]=-a,r.re[f]=l,r.im[f]=a},convolute2DI:function(e,t,r,n){for(var a,s,o=0;o<r/2;o++)for(var l=0;l<n;l++)a=e[o*2*n+l]*t[o*2*n+l]-e[(o*2+1)*n+l]*t[(o*2+1)*n+l],s=e[o*2*n+l]*t[(o*2+1)*n+l]+e[(o*2+1)*n+l]*t[o*2*n+l],e[o*2*n+l]=a,e[(o*2+1)*n+l]=s},convolute:function(e,t,r,n,a){for(var s=new Array(n*r),o=0;o<r*n;o++)s[o]=e[o];s=this.fft2DArray(s,r,n);for(var l=t.length,f=t[0].length,h=new Array(n*r),o=0;o<n*r;o++)h[o]=0;for(var c,u,d=Math.floor((l-1)/2),g=Math.floor((f-1)/2),p=0;p<l;p++){c=(p-d+r)%r;for(var m=0;m<f;m++)u=(m-g+n)%n,h[c*n+u]=t[p][m]}h=this.fft2DArray(h,r,n);var y=r*2,x=n/2+1;return this.convolute2DI(s,h,y,x),this.ifft2DArray(s,y,x)},toRadix2:function(e,t,r){var n,a,s,o,l=r,f=t;if(!(r!==0&&!(r&r-1))){for(l=0;r>>++l;);l=1<<l}if(!(t!==0&&!(t&t-1))){for(f=0;t>>++f;);f=1<<f}if(f==t&&l==r)return{data:e,rows:t,cols:r};var h=new Array(f*l),c=Math.floor((f-t)/2)-t,u=Math.floor((l-r)/2)-r;for(n=0;n<f;n++)for(s=n*l,o=(n-c)%t*r,a=0;a<l;a++)h[s+a]=e[o+(a-u)%r];return{data:h,rows:f,cols:l}},crop:function(e,t,r,n,a,s){if(t==n&&r==a)return e;Object.assign({},s);var o=new Array(a*n),l=Math.floor((t-n)/2),f=Math.floor((r-a)/2),h,c,u,d;for(u=0;u<n;u++)for(h=u*a,c=(u+l)*r,d=0;d<a;d++)o[h+d]=e[c+(d+f)];return o}},FFTUtils_1=FFTUtils$1;src$3.FFTUtils=FFTUtils_1;src$3.FFT=fftlib;var FFTUtils=src$3.FFTUtils;function convolutionFFT(e,t,r){var n=matrix2Array(e),a=n.data,s=Object.assign({normalize:!1,divisor:1,rows:n.rows,cols:n.cols},r),o,l;if(s.rows&&s.cols)o=s.rows,l=s.cols;else throw new Error("Invalid number of rows or columns "+o+" "+l);var f=s.divisor,h,c,u=t.length,d=t[0].length;if(s.normalize)for(f=0,h=0;h<u;h++)for(c=0;c<d;c++)f+=t[h][c];if(f===0)throw new RangeError("convolution: The divisor is equal to zero");var g=FFTUtils.toRadix2(a,o,l),p=FFTUtils.convolute(g.data,t,g.rows,g.cols);if(p=FFTUtils.crop(p,g.rows,g.cols,o,l),f!=0&&f!=1)for(h=0;h<p.length;h++)p[h]/=f;return p}function convolutionDirect(e,t,r){var n=matrix2Array(e),a=n.data,s=Object.assign({normalize:!1,divisor:1,rows:n.rows,cols:n.cols},r),o,l;if(s.rows&&s.cols)o=s.rows,l=s.cols;else throw new Error("Invalid number of rows or columns "+o+" "+l);var f=s.divisor,h=t.length,c=t[0].length,u,d,g,p,m,y,x,E,_;if(s.normalize)for(f=0,u=0;u<h;u++)for(d=0;d<c;d++)f+=t[u][d];if(f===0)throw new RangeError("convolution: The divisor is equal to zero");var w=new Array(o*l),M=Math.floor(h/2),I=Math.floor(c/2);for(p=0;p<o;p++)for(g=0;g<l;g++){for(y=0,d=0;d<h;d++)for(u=0;u<c;u++)x=t[h-d-1][c-u-1],E=(p+d-M+o)%o,_=(g+u-I+l)%l,m=E*l+_,y+=a[m]*x;m=p*l+g,w[m]=y/f}return w}function LoG(e,t,r){var n=1e3;r&&r.factor&&(n=r.factor);var a=new Array(t),s,o,l,f;n*=-1;var h=(t-1)/2,c=2*e*e;for(s=0;s<t;s++)for(a[s]=new Array(t),f=(s-h)*(s-h),o=0;o<t;o++)l=-((o-h)*(o-h)+f)/c,a[s][o]=Math.round(n*(1+l)*Math.exp(l));return a}function matrix2Array(e){var t=e,r,n;if(typeof e[0]!="number"){r=e.length,n=e[0].length,t=new Array(r*n);for(var a=0;a<r;a++)for(var s=0;s<n;s++)t[a*n+s]=e[a][s]}else{var o=Math.sqrt(e.length);Number.isInteger(o)&&(r=o,n=o)}return{data:t,rows:r,cols:n}}var src$2={fft:convolutionFFT,direct:convolutionDirect,kernelFactory:{LoG},matrix2Array},_isFinite=Number.isFinite||function(e){return!(typeof e!="number"||e!==e||e===1/0||e===-1/0)},isFinite$1=_isFinite,isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite$1(e)&&Math.floor(e)===e},isInteger$1=getDefaultExportFromCjs(isInteger);function validateKernel(e){let t,r;if(Array.isArray(e))if(Array.isArray(e[0])){if(!(e.length&1)||!(e[0].length&1))throw new RangeError("validateKernel: Kernel rows and columns should be odd numbers");t=Math.floor(e.length/2),r=Math.floor(e[0].length/2)}else{let n=Math.sqrt(e.length);if(isInteger$1(n))r=t=Math.floor(Math.sqrt(e.length)/2);else throw new RangeError("validateKernel: Kernel array should be a square");let a=new Array(n);for(let s=0;s<n;s++){a[s]=new Array(n);for(let o=0;o<n;o++)a[s][o]=e[s*n+o]}e=a}else throw new Error(`validateKernel: Invalid Kernel: ${e}`);return{kernel:e,kWidth:r,kHeight:t}}function clamp(e,t){return Math.round(Math.min(Math.max(e,0),t.maxValue))}function directConvolution(e,t,r){if(r===void 0){const s=e.length+t.length-1;r=new Array(s)}fill(r);for(var n=0;n<e.length;n++)for(var a=0;a<t.length;a++)r[n+a]+=e[n]*t[a];return r}function fill(e){for(var t=0;t<e.length;t++)e[t]=0}function FFT(e){if(this.size=e|0,this.size<=1||this.size&this.size-1)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=e<<1;for(var t=new Array(this.size*2),r=0;r<t.length;r+=2){const f=Math.PI*r/this.size;t[r]=Math.cos(f),t[r+1]=-Math.sin(f)}this.table=t;for(var n=0,a=1;this.size>a;a<<=1)n++;this._width=n%2===0?n-1:n,this._bitrev=new Array(1<<this._width);for(var s=0;s<this._bitrev.length;s++){this._bitrev[s]=0;for(var o=0;o<this._width;o+=2){var l=this._width-o-2;this._bitrev[s]|=(s>>>o&3)<<l}}this._out=null,this._data=null,this._inv=0}FFT.prototype.fromComplexArray=function e(t,r){for(var n=r||new Array(t.length>>>1),a=0;a<t.length;a+=2)n[a>>>1]=t[a];return n};FFT.prototype.createComplexArray=function e(){const t=new Array(this._csize);for(var r=0;r<t.length;r++)t[r]=0;return t};FFT.prototype.toComplexArray=function e(t,r){for(var n=r||this.createComplexArray(),a=0;a<n.length;a+=2)n[a]=t[a>>>1],n[a+1]=0;return n};FFT.prototype.completeSpectrum=function e(t){for(var r=this._csize,n=r>>>1,a=2;a<n;a+=2)t[r-a]=t[a],t[r-a+1]=-t[a+1]};FFT.prototype.transform=function e(t,r){if(t===r)throw new Error("Input and output buffers must be different");this._out=t,this._data=r,this._inv=0,this._transform4(),this._out=null,this._data=null};FFT.prototype.realTransform=function e(t,r){if(t===r)throw new Error("Input and output buffers must be different");this._out=t,this._data=r,this._inv=0,this._realTransform4(),this._out=null,this._data=null};FFT.prototype.inverseTransform=function e(t,r){if(t===r)throw new Error("Input and output buffers must be different");this._out=t,this._data=r,this._inv=1,this._transform4();for(var n=0;n<t.length;n++)t[n]/=this.size;this._out=null,this._data=null};FFT.prototype._transform4=function e(){var t=this._out,r=this._csize,n=this._width,a=1<<n,s=r/a<<1,o,l,f=this._bitrev;if(s===4)for(o=0,l=0;o<r;o+=s,l++){const m=f[l];this._singleTransform2(o,m,a)}else for(o=0,l=0;o<r;o+=s,l++){const m=f[l];this._singleTransform4(o,m,a)}var h=this._inv?-1:1,c=this.table;for(a>>=2;a>=2;a>>=2){s=r/a<<1;var u=s>>>2;for(o=0;o<r;o+=s)for(var d=o+u,g=o,p=0;g<d;g+=2,p+=a){const m=g,y=m+u,x=y+u,E=x+u,_=t[m],w=t[m+1],M=t[y],I=t[y+1],k=t[x],v=t[x+1],S=t[E],b=t[E+1],A=_,T=w,D=c[p],P=h*c[p+1],F=M*D-I*P,V=M*P+I*D,q=c[2*p],Y=h*c[2*p+1],ee=k*q-v*Y,z=k*Y+v*q,ae=c[3*p],ie=h*c[3*p+1],j=S*ae-b*ie,G=S*ie+b*ae,N=A+ee,X=T+z,J=A-ee,ge=T-z,oe=F+j,ue=V+G,pe=h*(F-j),ve=h*(V-G),me=N+oe,K=X+ue,U=N-oe,xe=X-ue,he=J+ve,ce=ge-pe,B=J-ve,re=ge+pe;t[m]=me,t[m+1]=K,t[y]=he,t[y+1]=ce,t[x]=U,t[x+1]=xe,t[E]=B,t[E+1]=re}}};FFT.prototype._singleTransform2=function e(t,r,n){const a=this._out,s=this._data,o=s[r],l=s[r+1],f=s[r+n],h=s[r+n+1],c=o+f,u=l+h,d=o-f,g=l-h;a[t]=c,a[t+1]=u,a[t+2]=d,a[t+3]=g};FFT.prototype._singleTransform4=function e(t,r,n){const a=this._out,s=this._data,o=this._inv?-1:1,l=n*2,f=n*3,h=s[r],c=s[r+1],u=s[r+n],d=s[r+n+1],g=s[r+l],p=s[r+l+1],m=s[r+f],y=s[r+f+1],x=h+g,E=c+p,_=h-g,w=c-p,M=u+m,I=d+y,k=o*(u-m),v=o*(d-y),S=x+M,b=E+I,A=_+v,T=w-k,D=x-M,P=E-I,F=_-v,V=w+k;a[t]=S,a[t+1]=b,a[t+2]=A,a[t+3]=T,a[t+4]=D,a[t+5]=P,a[t+6]=F,a[t+7]=V};FFT.prototype._realTransform4=function e(){var t=this._out,r=this._csize,n=this._width,a=1<<n,s=r/a<<1,o,l,f=this._bitrev;if(s===4)for(o=0,l=0;o<r;o+=s,l++){const _e=f[l];this._singleRealTransform2(o,_e>>>1,a>>>1)}else for(o=0,l=0;o<r;o+=s,l++){const _e=f[l];this._singleRealTransform4(o,_e>>>1,a>>>1)}var h=this._inv?-1:1,c=this.table;for(a>>=2;a>=2;a>>=2){s=r/a<<1;var u=s>>>1,d=u>>>1,g=d>>>1;for(o=0;o<r;o+=s)for(var p=0,m=0;p<=g;p+=2,m+=a){var y=o+p,x=y+d,E=x+d,_=E+d,w=t[y],M=t[y+1],I=t[x],k=t[x+1],v=t[E],S=t[E+1],b=t[_],A=t[_+1],T=w,D=M,P=c[m],F=h*c[m+1],V=I*P-k*F,q=I*F+k*P,Y=c[2*m],ee=h*c[2*m+1],z=v*Y-S*ee,ae=v*ee+S*Y,ie=c[3*m],j=h*c[3*m+1],G=b*ie-A*j,N=b*j+A*ie,X=T+z,J=D+ae,ge=T-z,oe=D-ae,ue=V+G,pe=q+N,ve=h*(V-G),me=h*(q-N),K=X+ue,U=J+pe,xe=ge+me,he=oe-ve;if(t[y]=K,t[y+1]=U,t[x]=xe,t[x+1]=he,p===0){var ce=X-ue,B=J-pe;t[E]=ce,t[E+1]=B;continue}if(p!==g){var re=ge,ne=-oe,se=X,L=-J,Me=-h*me,we=-h*ve,Z=-h*pe,te=-h*ue,le=re+Me,W=ne+we,de=se+te,be=L-Z,fe=o+d-p,ye=o+u-p;t[fe]=le,t[fe+1]=W,t[ye]=de,t[ye+1]=be}}}};FFT.prototype._singleRealTransform2=function e(t,r,n){const a=this._out,s=this._data,o=s[r],l=s[r+n],f=o+l,h=o-l;a[t]=f,a[t+1]=0,a[t+2]=h,a[t+3]=0};FFT.prototype._singleRealTransform4=function e(t,r,n){const a=this._out,s=this._data,o=this._inv?-1:1,l=n*2,f=n*3,h=s[r],c=s[r+n],u=s[r+l],d=s[r+f],g=h+u,p=h-u,m=c+d,y=o*(c-d),x=g+m,E=p,_=-y,w=g-m,M=p,I=y;a[t]=x,a[t+1]=0,a[t+2]=E,a[t+3]=_,a[t+4]=w,a[t+5]=0,a[t+6]=M,a[t+7]=I};function convolutionSeparable(e,t,r,n){const a=new Array(e.length);let s,o,l,f;f=t[1],l=(f.length-1)/2,o=new Array(r+f.length-1),s=new Array(r);for(let h=0;h<n;h++){for(let c=0;c<r;c++)s[c]=e[h*r+c];directConvolution(s,f,o);for(let c=0;c<r;c++)a[h*r+c]=o[l+c]}f=t[0],l=(f.length-1)/2,o=new Array(n+f.length-1),s=new Array(n);for(let h=0;h<r;h++){for(let c=0;c<n;c++)s[c]=a[c*r+h];directConvolution(s,f,o);for(let c=0;c<n;c++)a[c*r+h]=o[l+c]}return a}const toString$3=Object.prototype.toString;function isAnyArray(e){const t=toString$3.call(e);return t.endsWith("Array]")&&!t.includes("Big")}function max$1(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(e))throw new TypeError("input must be an array");if(e.length===0)throw new TypeError("input must not be empty");var r=t.fromIndex,n=r===void 0?0:r,a=t.toIndex,s=a===void 0?e.length:a;if(n<0||n>=e.length||!Number.isInteger(n))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=n||s>e.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var o=e[n],l=n+1;l<s;l++)e[l]>o&&(o=e[l]);return o}function min$1(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(e))throw new TypeError("input must be an array");if(e.length===0)throw new TypeError("input must not be empty");var r=t.fromIndex,n=r===void 0?0:r,a=t.toIndex,s=a===void 0?e.length:a;if(n<0||n>=e.length||!Number.isInteger(n))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=n||s>e.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var o=e[n],l=n+1;l<s;l++)e[l]<o&&(o=e[l]);return o}function rescale(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(isAnyArray(e)){if(e.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var r;if(t.output!==void 0){if(!isAnyArray(t.output))throw new TypeError("output option must be an array if specified");r=t.output}else r=new Array(e.length);var n=min$1(e),a=max$1(e);if(n===a)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var s=t.min,o=s===void 0?t.autoMinMax?n:0:s,l=t.max,f=l===void 0?t.autoMinMax?a:1:l;if(o>=f)throw new RangeError("min option must be smaller than max option");for(var h=(f-o)/(a-n),c=0;c<e.length;c++)r[c]=(e[c]-n)*h+o;return r}const indent=" ".repeat(2),indentData=" ".repeat(4);function inspectMatrix(){return inspectMatrixWithOptions(this)}function inspectMatrixWithOptions(e,t={}){const{maxRows:r=15,maxColumns:n=10,maxNumSize:a=8,padMinus:s="auto"}=t;return`${e.constructor.name} {
${indent}[
${indentData}${inspectData(e,r,n,a,s)}
${indent}]
${indent}rows: ${e.rows}
${indent}columns: ${e.columns}
}`}function inspectData(e,t,r,n,a){const{rows:s,columns:o}=e,l=Math.min(s,t),f=Math.min(o,r),h=[];if(a==="auto"){a=!1;e:for(let c=0;c<l;c++)for(let u=0;u<f;u++)if(e.get(c,u)<0){a=!0;break e}}for(let c=0;c<l;c++){let u=[];for(let d=0;d<f;d++)u.push(formatNumber(e.get(c,d),n,a));h.push(`${u.join(" ")}`)}return f!==o&&(h[h.length-1]+=` ... ${o-r} more columns`),l!==s&&h.push(`... ${s-t} more rows`),h.join(`
${indentData}`)}function formatNumber(e,t,r){return(e>=0&&r?` ${formatNumber2(e,t-1)}`:formatNumber2(e,t)).padEnd(t)}function formatNumber2(e,t){let r=e.toString();if(r.length<=t)return r;let n=e.toFixed(t);if(n.length>t&&(n=e.toFixed(Math.max(0,t-(n.length-t)))),n.length<=t&&!n.startsWith("0.000")&&!n.startsWith("-0.000"))return n;let a=e.toExponential(t);return a.length>t&&(a=e.toExponential(Math.max(0,t-(a.length-t)))),a.slice(0)}function installMathOperations(e,t){e.prototype.add=function(n){return typeof n=="number"?this.addS(n):this.addM(n)},e.prototype.addS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)+n);return this},e.prototype.addM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)+n.get(a,s));return this},e.add=function(n,a){return new t(n).add(a)},e.prototype.sub=function(n){return typeof n=="number"?this.subS(n):this.subM(n)},e.prototype.subS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)-n);return this},e.prototype.subM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)-n.get(a,s));return this},e.sub=function(n,a){return new t(n).sub(a)},e.prototype.subtract=e.prototype.sub,e.prototype.subtractS=e.prototype.subS,e.prototype.subtractM=e.prototype.subM,e.subtract=e.sub,e.prototype.mul=function(n){return typeof n=="number"?this.mulS(n):this.mulM(n)},e.prototype.mulS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)*n);return this},e.prototype.mulM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)*n.get(a,s));return this},e.mul=function(n,a){return new t(n).mul(a)},e.prototype.multiply=e.prototype.mul,e.prototype.multiplyS=e.prototype.mulS,e.prototype.multiplyM=e.prototype.mulM,e.multiply=e.mul,e.prototype.div=function(n){return typeof n=="number"?this.divS(n):this.divM(n)},e.prototype.divS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)/n);return this},e.prototype.divM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)/n.get(a,s));return this},e.div=function(n,a){return new t(n).div(a)},e.prototype.divide=e.prototype.div,e.prototype.divideS=e.prototype.divS,e.prototype.divideM=e.prototype.divM,e.divide=e.div,e.prototype.mod=function(n){return typeof n=="number"?this.modS(n):this.modM(n)},e.prototype.modS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)%n);return this},e.prototype.modM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)%n.get(a,s));return this},e.mod=function(n,a){return new t(n).mod(a)},e.prototype.modulus=e.prototype.mod,e.prototype.modulusS=e.prototype.modS,e.prototype.modulusM=e.prototype.modM,e.modulus=e.mod,e.prototype.and=function(n){return typeof n=="number"?this.andS(n):this.andM(n)},e.prototype.andS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)&n);return this},e.prototype.andM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)&n.get(a,s));return this},e.and=function(n,a){return new t(n).and(a)},e.prototype.or=function(n){return typeof n=="number"?this.orS(n):this.orM(n)},e.prototype.orS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)|n);return this},e.prototype.orM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)|n.get(a,s));return this},e.or=function(n,a){return new t(n).or(a)},e.prototype.xor=function(n){return typeof n=="number"?this.xorS(n):this.xorM(n)},e.prototype.xorS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)^n);return this},e.prototype.xorM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)^n.get(a,s));return this},e.xor=function(n,a){return new t(n).xor(a)},e.prototype.leftShift=function(n){return typeof n=="number"?this.leftShiftS(n):this.leftShiftM(n)},e.prototype.leftShiftS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)<<n);return this},e.prototype.leftShiftM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)<<n.get(a,s));return this},e.leftShift=function(n,a){return new t(n).leftShift(a)},e.prototype.signPropagatingRightShift=function(n){return typeof n=="number"?this.signPropagatingRightShiftS(n):this.signPropagatingRightShiftM(n)},e.prototype.signPropagatingRightShiftS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)>>n);return this},e.prototype.signPropagatingRightShiftM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)>>n.get(a,s));return this},e.signPropagatingRightShift=function(n,a){return new t(n).signPropagatingRightShift(a)},e.prototype.rightShift=function(n){return typeof n=="number"?this.rightShiftS(n):this.rightShiftM(n)},e.prototype.rightShiftS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)>>>n);return this},e.prototype.rightShiftM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)>>>n.get(a,s));return this},e.rightShift=function(n,a){return new t(n).rightShift(a)},e.prototype.zeroFillRightShift=e.prototype.rightShift,e.prototype.zeroFillRightShiftS=e.prototype.rightShiftS,e.prototype.zeroFillRightShiftM=e.prototype.rightShiftM,e.zeroFillRightShift=e.rightShift,e.prototype.not=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,~this.get(n,a));return this},e.not=function(n){return new t(n).not()},e.prototype.abs=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.abs(this.get(n,a)));return this},e.abs=function(n){return new t(n).abs()},e.prototype.acos=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.acos(this.get(n,a)));return this},e.acos=function(n){return new t(n).acos()},e.prototype.acosh=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.acosh(this.get(n,a)));return this},e.acosh=function(n){return new t(n).acosh()},e.prototype.asin=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.asin(this.get(n,a)));return this},e.asin=function(n){return new t(n).asin()},e.prototype.asinh=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.asinh(this.get(n,a)));return this},e.asinh=function(n){return new t(n).asinh()},e.prototype.atan=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.atan(this.get(n,a)));return this},e.atan=function(n){return new t(n).atan()},e.prototype.atanh=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.atanh(this.get(n,a)));return this},e.atanh=function(n){return new t(n).atanh()},e.prototype.cbrt=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.cbrt(this.get(n,a)));return this},e.cbrt=function(n){return new t(n).cbrt()},e.prototype.ceil=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.ceil(this.get(n,a)));return this},e.ceil=function(n){return new t(n).ceil()},e.prototype.clz32=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.clz32(this.get(n,a)));return this},e.clz32=function(n){return new t(n).clz32()},e.prototype.cos=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.cos(this.get(n,a)));return this},e.cos=function(n){return new t(n).cos()},e.prototype.cosh=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.cosh(this.get(n,a)));return this},e.cosh=function(n){return new t(n).cosh()},e.prototype.exp=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.exp(this.get(n,a)));return this},e.exp=function(n){return new t(n).exp()},e.prototype.expm1=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.expm1(this.get(n,a)));return this},e.expm1=function(n){return new t(n).expm1()},e.prototype.floor=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.floor(this.get(n,a)));return this},e.floor=function(n){return new t(n).floor()},e.prototype.fround=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.fround(this.get(n,a)));return this},e.fround=function(n){return new t(n).fround()},e.prototype.log=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.log(this.get(n,a)));return this},e.log=function(n){return new t(n).log()},e.prototype.log1p=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.log1p(this.get(n,a)));return this},e.log1p=function(n){return new t(n).log1p()},e.prototype.log10=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.log10(this.get(n,a)));return this},e.log10=function(n){return new t(n).log10()},e.prototype.log2=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.log2(this.get(n,a)));return this},e.log2=function(n){return new t(n).log2()},e.prototype.round=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.round(this.get(n,a)));return this},e.round=function(n){return new t(n).round()},e.prototype.sign=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.sign(this.get(n,a)));return this},e.sign=function(n){return new t(n).sign()},e.prototype.sin=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.sin(this.get(n,a)));return this},e.sin=function(n){return new t(n).sin()},e.prototype.sinh=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.sinh(this.get(n,a)));return this},e.sinh=function(n){return new t(n).sinh()},e.prototype.sqrt=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.sqrt(this.get(n,a)));return this},e.sqrt=function(n){return new t(n).sqrt()},e.prototype.tan=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.tan(this.get(n,a)));return this},e.tan=function(n){return new t(n).tan()},e.prototype.tanh=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.tanh(this.get(n,a)));return this},e.tanh=function(n){return new t(n).tanh()},e.prototype.trunc=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.trunc(this.get(n,a)));return this},e.trunc=function(n){return new t(n).trunc()},e.pow=function(n,a){return new t(n).pow(a)},e.prototype.pow=function(n){return typeof n=="number"?this.powS(n):this.powM(n)},e.prototype.powS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,Math.pow(this.get(a,s),n));return this},e.prototype.powM=function(n){if(n=t.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,Math.pow(this.get(a,s),n.get(a,s)));return this}}function checkRowIndex(e,t,r){let n=r?e.rows:e.rows-1;if(t<0||t>n)throw new RangeError("Row index out of range")}function checkColumnIndex(e,t,r){let n=r?e.columns:e.columns-1;if(t<0||t>n)throw new RangeError("Column index out of range")}function checkRowVector(e,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==e.columns)throw new RangeError("vector size must be the same as the number of columns");return t}function checkColumnVector(e,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==e.rows)throw new RangeError("vector size must be the same as the number of rows");return t}function checkRowIndices(e,t){if(!isAnyArray(t))throw new TypeError("row indices must be an array");for(let r=0;r<t.length;r++)if(t[r]<0||t[r]>=e.rows)throw new RangeError("row indices are out of range")}function checkColumnIndices(e,t){if(!isAnyArray(t))throw new TypeError("column indices must be an array");for(let r=0;r<t.length;r++)if(t[r]<0||t[r]>=e.columns)throw new RangeError("column indices are out of range")}function checkRange(e,t,r,n,a){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(checkNumber("startRow",t),checkNumber("endRow",r),checkNumber("startColumn",n),checkNumber("endColumn",a),t>r||n>a||t<0||t>=e.rows||r<0||r>=e.rows||n<0||n>=e.columns||a<0||a>=e.columns)throw new RangeError("Submatrix indices are out of range")}function newArray$2(e,t=0){let r=[];for(let n=0;n<e;n++)r.push(t);return r}function checkNumber(e,t){if(typeof t!="number")throw new TypeError(`${e} must be a number`)}function checkNonEmpty(e){if(e.isEmpty())throw new Error("Empty matrix has no elements to index")}function sumByRow(e){let t=newArray$2(e.rows);for(let r=0;r<e.rows;++r)for(let n=0;n<e.columns;++n)t[r]+=e.get(r,n);return t}function sumByColumn(e){let t=newArray$2(e.columns);for(let r=0;r<e.rows;++r)for(let n=0;n<e.columns;++n)t[n]+=e.get(r,n);return t}function sumAll(e){let t=0;for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)t+=e.get(r,n);return t}function productByRow(e){let t=newArray$2(e.rows,1);for(let r=0;r<e.rows;++r)for(let n=0;n<e.columns;++n)t[r]*=e.get(r,n);return t}function productByColumn(e){let t=newArray$2(e.columns,1);for(let r=0;r<e.rows;++r)for(let n=0;n<e.columns;++n)t[n]*=e.get(r,n);return t}function productAll(e){let t=1;for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)t*=e.get(r,n);return t}function varianceByRow(e,t,r){const n=e.rows,a=e.columns,s=[];for(let o=0;o<n;o++){let l=0,f=0,h=0;for(let c=0;c<a;c++)h=e.get(o,c)-r[o],l+=h,f+=h*h;t?s.push((f-l*l/a)/(a-1)):s.push((f-l*l/a)/a)}return s}function varianceByColumn(e,t,r){const n=e.rows,a=e.columns,s=[];for(let o=0;o<a;o++){let l=0,f=0,h=0;for(let c=0;c<n;c++)h=e.get(c,o)-r[o],l+=h,f+=h*h;t?s.push((f-l*l/n)/(n-1)):s.push((f-l*l/n)/n)}return s}function varianceAll(e,t,r){const n=e.rows,a=e.columns,s=n*a;let o=0,l=0,f=0;for(let h=0;h<n;h++)for(let c=0;c<a;c++)f=e.get(h,c)-r,o+=f,l+=f*f;return t?(l-o*o/s)/(s-1):(l-o*o/s)/s}function centerByRow(e,t){for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)e.set(r,n,e.get(r,n)-t[r])}function centerByColumn(e,t){for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)e.set(r,n,e.get(r,n)-t[n])}function centerAll(e,t){for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)e.set(r,n,e.get(r,n)-t)}function getScaleByRow(e){const t=[];for(let r=0;r<e.rows;r++){let n=0;for(let a=0;a<e.columns;a++)n+=Math.pow(e.get(r,a),2)/(e.columns-1);t.push(Math.sqrt(n))}return t}function scaleByRow(e,t){for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)e.set(r,n,e.get(r,n)/t[r])}function getScaleByColumn(e){const t=[];for(let r=0;r<e.columns;r++){let n=0;for(let a=0;a<e.rows;a++)n+=Math.pow(e.get(a,r),2)/(e.rows-1);t.push(Math.sqrt(n))}return t}function scaleByColumn(e,t){for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)e.set(r,n,e.get(r,n)/t[n])}function getScaleAll(e){const t=e.size-1;let r=0;for(let n=0;n<e.columns;n++)for(let a=0;a<e.rows;a++)r+=Math.pow(e.get(a,n),2)/t;return Math.sqrt(r)}function scaleAll(e,t){for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)e.set(r,n,e.get(r,n)/t)}class AbstractMatrix{static from1DArray(t,r,n){if(t*r!==n.length)throw new RangeError("data length does not match given dimensions");let s=new Matrix$2(t,r);for(let o=0;o<t;o++)for(let l=0;l<r;l++)s.set(o,l,n[o*r+l]);return s}static rowVector(t){let r=new Matrix$2(1,t.length);for(let n=0;n<t.length;n++)r.set(0,n,t[n]);return r}static columnVector(t){let r=new Matrix$2(t.length,1);for(let n=0;n<t.length;n++)r.set(n,0,t[n]);return r}static zeros(t,r){return new Matrix$2(t,r)}static ones(t,r){return new Matrix$2(t,r).fill(1)}static rand(t,r,n={}){if(typeof n!="object")throw new TypeError("options must be an object");const{random:a=Math.random}=n;let s=new Matrix$2(t,r);for(let o=0;o<t;o++)for(let l=0;l<r;l++)s.set(o,l,a());return s}static randInt(t,r,n={}){if(typeof n!="object")throw new TypeError("options must be an object");const{min:a=0,max:s=1e3,random:o=Math.random}=n;if(!Number.isInteger(a))throw new TypeError("min must be an integer");if(!Number.isInteger(s))throw new TypeError("max must be an integer");if(a>=s)throw new RangeError("min must be smaller than max");let l=s-a,f=new Matrix$2(t,r);for(let h=0;h<t;h++)for(let c=0;c<r;c++){let u=a+Math.round(o()*l);f.set(h,c,u)}return f}static eye(t,r,n){r===void 0&&(r=t),n===void 0&&(n=1);let a=Math.min(t,r),s=this.zeros(t,r);for(let o=0;o<a;o++)s.set(o,o,n);return s}static diag(t,r,n){let a=t.length;r===void 0&&(r=a),n===void 0&&(n=r);let s=Math.min(a,r,n),o=this.zeros(r,n);for(let l=0;l<s;l++)o.set(l,l,t[l]);return o}static min(t,r){t=this.checkMatrix(t),r=this.checkMatrix(r);let n=t.rows,a=t.columns,s=new Matrix$2(n,a);for(let o=0;o<n;o++)for(let l=0;l<a;l++)s.set(o,l,Math.min(t.get(o,l),r.get(o,l)));return s}static max(t,r){t=this.checkMatrix(t),r=this.checkMatrix(r);let n=t.rows,a=t.columns,s=new this(n,a);for(let o=0;o<n;o++)for(let l=0;l<a;l++)s.set(o,l,Math.max(t.get(o,l),r.get(o,l)));return s}static checkMatrix(t){return AbstractMatrix.isMatrix(t)?t:new Matrix$2(t)}static isMatrix(t){return t!=null&&t.klass==="Matrix"}get size(){return this.rows*this.columns}apply(t){if(typeof t!="function")throw new TypeError("callback must be a function");for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)t.call(this,r,n);return this}to1DArray(){let t=[];for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)t.push(this.get(r,n));return t}to2DArray(){let t=[];for(let r=0;r<this.rows;r++){t.push([]);for(let n=0;n<this.columns;n++)t[r].push(this.get(r,n))}return t}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let r=0;r<=t;r++)if(this.get(t,r)!==this.get(r,t))return!1;return!0}return!1}isEchelonForm(){let t=0,r=0,n=-1,a=!0,s=!1;for(;t<this.rows&&a;){for(r=0,s=!1;r<this.columns&&s===!1;)this.get(t,r)===0?r++:this.get(t,r)===1&&r>n?(s=!0,n=r):(a=!1,s=!0);t++}return a}isReducedEchelonForm(){let t=0,r=0,n=-1,a=!0,s=!1;for(;t<this.rows&&a;){for(r=0,s=!1;r<this.columns&&s===!1;)this.get(t,r)===0?r++:this.get(t,r)===1&&r>n?(s=!0,n=r):(a=!1,s=!0);for(let o=r+1;o<this.rows;o++)this.get(t,o)!==0&&(a=!1);t++}return a}echelonForm(){let t=this.clone(),r=0,n=0;for(;r<t.rows&&n<t.columns;){let a=r;for(let s=r;s<t.rows;s++)t.get(s,n)>t.get(a,n)&&(a=s);if(t.get(a,n)===0)n++;else{t.swapRows(r,a);let s=t.get(r,n);for(let o=n;o<t.columns;o++)t.set(r,o,t.get(r,o)/s);for(let o=r+1;o<t.rows;o++){let l=t.get(o,n)/t.get(r,n);t.set(o,n,0);for(let f=n+1;f<t.columns;f++)t.set(o,f,t.get(o,f)-t.get(r,f)*l)}r++,n++}}return t}reducedEchelonForm(){let t=this.echelonForm(),r=t.columns,n=t.rows,a=n-1;for(;a>=0;)if(t.maxRow(a)===0)a--;else{let s=0,o=!1;for(;s<n&&o===!1;)t.get(a,s)===1?o=!0:s++;for(let l=0;l<a;l++){let f=t.get(l,s);for(let h=s;h<r;h++){let c=t.get(l,h)-f*t.get(a,h);t.set(l,h,c)}}a--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{rows:r=1,columns:n=1}=t;if(!Number.isInteger(r)||r<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(n)||n<=0)throw new TypeError("columns must be a positive integer");let a=new Matrix$2(this.rows*r,this.columns*n);for(let s=0;s<r;s++)for(let o=0;o<n;o++)a.setSubMatrix(this,this.rows*s,this.columns*o);return a}fill(t){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,t);return this}neg(){return this.mulS(-1)}getRow(t){checkRowIndex(this,t);let r=[];for(let n=0;n<this.columns;n++)r.push(this.get(t,n));return r}getRowVector(t){return Matrix$2.rowVector(this.getRow(t))}setRow(t,r){checkRowIndex(this,t),r=checkRowVector(this,r);for(let n=0;n<this.columns;n++)this.set(t,n,r[n]);return this}swapRows(t,r){checkRowIndex(this,t),checkRowIndex(this,r);for(let n=0;n<this.columns;n++){let a=this.get(t,n);this.set(t,n,this.get(r,n)),this.set(r,n,a)}return this}getColumn(t){checkColumnIndex(this,t);let r=[];for(let n=0;n<this.rows;n++)r.push(this.get(n,t));return r}getColumnVector(t){return Matrix$2.columnVector(this.getColumn(t))}setColumn(t,r){checkColumnIndex(this,t),r=checkColumnVector(this,r);for(let n=0;n<this.rows;n++)this.set(n,t,r[n]);return this}swapColumns(t,r){checkColumnIndex(this,t),checkColumnIndex(this,r);for(let n=0;n<this.rows;n++){let a=this.get(n,t);this.set(n,t,this.get(n,r)),this.set(n,r,a)}return this}addRowVector(t){t=checkRowVector(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)+t[n]);return this}subRowVector(t){t=checkRowVector(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)-t[n]);return this}mulRowVector(t){t=checkRowVector(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)*t[n]);return this}divRowVector(t){t=checkRowVector(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)/t[n]);return this}addColumnVector(t){t=checkColumnVector(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)+t[r]);return this}subColumnVector(t){t=checkColumnVector(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)-t[r]);return this}mulColumnVector(t){t=checkColumnVector(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)*t[r]);return this}divColumnVector(t){t=checkColumnVector(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)/t[r]);return this}mulRow(t,r){checkRowIndex(this,t);for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)*r);return this}mulColumn(t,r){checkColumnIndex(this,t);for(let n=0;n<this.rows;n++)this.set(n,t,this.get(n,t)*r);return this}max(t){if(this.isEmpty())return NaN;switch(t){case"row":{const r=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)>r[n]&&(r[n]=this.get(n,a));return r}case"column":{const r=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)>r[a]&&(r[a]=this.get(n,a));return r}case void 0:{let r=this.get(0,0);for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)>r&&(r=this.get(n,a));return r}default:throw new Error(`invalid option: ${t}`)}}maxIndex(){checkNonEmpty(this);let t=this.get(0,0),r=[0,0];for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)>t&&(t=this.get(n,a),r[0]=n,r[1]=a);return r}min(t){if(this.isEmpty())return NaN;switch(t){case"row":{const r=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)<r[n]&&(r[n]=this.get(n,a));return r}case"column":{const r=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)<r[a]&&(r[a]=this.get(n,a));return r}case void 0:{let r=this.get(0,0);for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)<r&&(r=this.get(n,a));return r}default:throw new Error(`invalid option: ${t}`)}}minIndex(){checkNonEmpty(this);let t=this.get(0,0),r=[0,0];for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)<t&&(t=this.get(n,a),r[0]=n,r[1]=a);return r}maxRow(t){if(checkRowIndex(this,t),this.isEmpty())return NaN;let r=this.get(t,0);for(let n=1;n<this.columns;n++)this.get(t,n)>r&&(r=this.get(t,n));return r}maxRowIndex(t){checkRowIndex(this,t),checkNonEmpty(this);let r=this.get(t,0),n=[t,0];for(let a=1;a<this.columns;a++)this.get(t,a)>r&&(r=this.get(t,a),n[1]=a);return n}minRow(t){if(checkRowIndex(this,t),this.isEmpty())return NaN;let r=this.get(t,0);for(let n=1;n<this.columns;n++)this.get(t,n)<r&&(r=this.get(t,n));return r}minRowIndex(t){checkRowIndex(this,t),checkNonEmpty(this);let r=this.get(t,0),n=[t,0];for(let a=1;a<this.columns;a++)this.get(t,a)<r&&(r=this.get(t,a),n[1]=a);return n}maxColumn(t){if(checkColumnIndex(this,t),this.isEmpty())return NaN;let r=this.get(0,t);for(let n=1;n<this.rows;n++)this.get(n,t)>r&&(r=this.get(n,t));return r}maxColumnIndex(t){checkColumnIndex(this,t),checkNonEmpty(this);let r=this.get(0,t),n=[0,t];for(let a=1;a<this.rows;a++)this.get(a,t)>r&&(r=this.get(a,t),n[0]=a);return n}minColumn(t){if(checkColumnIndex(this,t),this.isEmpty())return NaN;let r=this.get(0,t);for(let n=1;n<this.rows;n++)this.get(n,t)<r&&(r=this.get(n,t));return r}minColumnIndex(t){checkColumnIndex(this,t),checkNonEmpty(this);let r=this.get(0,t),n=[0,t];for(let a=1;a<this.rows;a++)this.get(a,t)<r&&(r=this.get(a,t),n[0]=a);return n}diag(){let t=Math.min(this.rows,this.columns),r=[];for(let n=0;n<t;n++)r.push(this.get(n,n));return r}norm(t="frobenius"){let r=0;if(t==="max")return this.max();if(t==="frobenius"){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)r=r+this.get(n,a)*this.get(n,a);return Math.sqrt(r)}else throw new RangeError(`unknown norm type: ${t}`)}cumulativeSum(){let t=0;for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)t+=this.get(r,n),this.set(r,n,t);return this}dot(t){AbstractMatrix.isMatrix(t)&&(t=t.to1DArray());let r=this.to1DArray();if(r.length!==t.length)throw new RangeError("vectors do not have the same size");let n=0;for(let a=0;a<r.length;a++)n+=r[a]*t[a];return n}mmul(t){t=Matrix$2.checkMatrix(t);let r=this.rows,n=this.columns,a=t.columns,s=new Matrix$2(r,a),o=new Float64Array(n);for(let l=0;l<a;l++){for(let f=0;f<n;f++)o[f]=t.get(f,l);for(let f=0;f<r;f++){let h=0;for(let c=0;c<n;c++)h+=this.get(f,c)*o[c];s.set(f,l,h)}}return s}strassen2x2(t){t=Matrix$2.checkMatrix(t);let r=new Matrix$2(2,2);const n=this.get(0,0),a=t.get(0,0),s=this.get(0,1),o=t.get(0,1),l=this.get(1,0),f=t.get(1,0),h=this.get(1,1),c=t.get(1,1),u=(n+h)*(a+c),d=(l+h)*a,g=n*(o-c),p=h*(f-a),m=(n+s)*c,y=(l-n)*(a+o),x=(s-h)*(f+c),E=u+p-m+x,_=g+m,w=d+p,M=u-d+g+y;return r.set(0,0,E),r.set(0,1,_),r.set(1,0,w),r.set(1,1,M),r}strassen3x3(t){t=Matrix$2.checkMatrix(t);let r=new Matrix$2(3,3);const n=this.get(0,0),a=this.get(0,1),s=this.get(0,2),o=this.get(1,0),l=this.get(1,1),f=this.get(1,2),h=this.get(2,0),c=this.get(2,1),u=this.get(2,2),d=t.get(0,0),g=t.get(0,1),p=t.get(0,2),m=t.get(1,0),y=t.get(1,1),x=t.get(1,2),E=t.get(2,0),_=t.get(2,1),w=t.get(2,2),M=(n+a+s-o-l-c-u)*y,I=(n-o)*(-g+y),k=l*(-d+g+m-y-x-E+w),v=(-n+o+l)*(d-g+y),S=(o+l)*(-d+g),b=n*d,A=(-n+h+c)*(d-p+x),T=(-n+h)*(p-x),D=(h+c)*(-d+p),P=(n+a+s-l-f-h-c)*x,F=c*(-d+p+m-y-x-E+_),V=(-s+c+u)*(y+E-_),q=(s-u)*(y-_),Y=s*E,ee=(c+u)*(-E+_),z=(-s+l+f)*(x+E-w),ae=(s-f)*(x-w),ie=(l+f)*(-E+w),j=a*m,G=f*_,N=o*p,X=h*g,J=u*w,ge=b+Y+j,oe=M+v+S+b+V+Y+ee,ue=b+A+D+P+Y+z+ie,pe=I+k+v+b+Y+z+ae,ve=I+v+S+b+G,me=Y+z+ae+ie+N,K=b+A+T+F+V+q+Y,U=V+q+Y+ee+X,xe=b+A+T+D+J;return r.set(0,0,ge),r.set(0,1,oe),r.set(0,2,ue),r.set(1,0,pe),r.set(1,1,ve),r.set(1,2,me),r.set(2,0,K),r.set(2,1,U),r.set(2,2,xe),r}mmulStrassen(t){t=Matrix$2.checkMatrix(t);let r=this.clone(),n=r.rows,a=r.columns,s=t.rows,o=t.columns;a!==s&&console.warn(`Multiplying ${n} x ${a} and ${s} x ${o} matrix: dimensions do not match.`);function l(u,d,g){let p=u.rows,m=u.columns;if(p===d&&m===g)return u;{let y=AbstractMatrix.zeros(d,g);return y=y.setSubMatrix(u,0,0),y}}let f=Math.max(n,s),h=Math.max(a,o);r=l(r,f,h),t=l(t,f,h);function c(u,d,g,p){if(g<=512||p<=512)return u.mmul(d);g%2===1&&p%2===1?(u=l(u,g+1,p+1),d=l(d,g+1,p+1)):g%2===1?(u=l(u,g+1,p),d=l(d,g+1,p)):p%2===1&&(u=l(u,g,p+1),d=l(d,g,p+1));let m=parseInt(u.rows/2,10),y=parseInt(u.columns/2,10),x=u.subMatrix(0,m-1,0,y-1),E=d.subMatrix(0,m-1,0,y-1),_=u.subMatrix(0,m-1,y,u.columns-1),w=d.subMatrix(0,m-1,y,d.columns-1),M=u.subMatrix(m,u.rows-1,0,y-1),I=d.subMatrix(m,d.rows-1,0,y-1),k=u.subMatrix(m,u.rows-1,y,u.columns-1),v=d.subMatrix(m,d.rows-1,y,d.columns-1),S=c(AbstractMatrix.add(x,k),AbstractMatrix.add(E,v),m,y),b=c(AbstractMatrix.add(M,k),E,m,y),A=c(x,AbstractMatrix.sub(w,v),m,y),T=c(k,AbstractMatrix.sub(I,E),m,y),D=c(AbstractMatrix.add(x,_),v,m,y),P=c(AbstractMatrix.sub(M,x),AbstractMatrix.add(E,w),m,y),F=c(AbstractMatrix.sub(_,k),AbstractMatrix.add(I,v),m,y),V=AbstractMatrix.add(S,T);V.sub(D),V.add(F);let q=AbstractMatrix.add(A,D),Y=AbstractMatrix.add(b,T),ee=AbstractMatrix.sub(S,b);ee.add(A),ee.add(P);let z=AbstractMatrix.zeros(2*V.rows,2*V.columns);return z=z.setSubMatrix(V,0,0),z=z.setSubMatrix(q,V.rows,0),z=z.setSubMatrix(Y,0,V.columns),z=z.setSubMatrix(ee,V.rows,V.columns),z.subMatrix(0,g-1,0,p-1)}return c(r,t,f,h)}scaleRows(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:r=0,max:n=1}=t;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(r>=n)throw new RangeError("min must be smaller than max");let a=new Matrix$2(this.rows,this.columns);for(let s=0;s<this.rows;s++){const o=this.getRow(s);o.length>0&&rescale(o,{min:r,max:n,output:o}),a.setRow(s,o)}return a}scaleColumns(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:r=0,max:n=1}=t;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(r>=n)throw new RangeError("min must be smaller than max");let a=new Matrix$2(this.rows,this.columns);for(let s=0;s<this.columns;s++){const o=this.getColumn(s);o.length&&rescale(o,{min:r,max:n,output:o}),a.setColumn(s,o)}return a}flipRows(){const t=Math.ceil(this.columns/2);for(let r=0;r<this.rows;r++)for(let n=0;n<t;n++){let a=this.get(r,n),s=this.get(r,this.columns-1-n);this.set(r,n,s),this.set(r,this.columns-1-n,a)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let r=0;r<this.columns;r++)for(let n=0;n<t;n++){let a=this.get(n,r),s=this.get(this.rows-1-n,r);this.set(n,r,s),this.set(this.rows-1-n,r,a)}return this}kroneckerProduct(t){t=Matrix$2.checkMatrix(t);let r=this.rows,n=this.columns,a=t.rows,s=t.columns,o=new Matrix$2(r*a,n*s);for(let l=0;l<r;l++)for(let f=0;f<n;f++)for(let h=0;h<a;h++)for(let c=0;c<s;c++)o.set(a*l+h,s*f+c,this.get(l,f)*t.get(h,c));return o}kroneckerSum(t){if(t=Matrix$2.checkMatrix(t),!this.isSquare()||!t.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let r=this.rows,n=t.rows,a=this.kroneckerProduct(Matrix$2.eye(n,n)),s=Matrix$2.eye(r,r).kroneckerProduct(t);return a.add(s)}transpose(){let t=new Matrix$2(this.columns,this.rows);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)t.set(n,r,this.get(r,n));return t}sortRows(t=compareNumbers){for(let r=0;r<this.rows;r++)this.setRow(r,this.getRow(r).sort(t));return this}sortColumns(t=compareNumbers){for(let r=0;r<this.columns;r++)this.setColumn(r,this.getColumn(r).sort(t));return this}subMatrix(t,r,n,a){checkRange(this,t,r,n,a);let s=new Matrix$2(r-t+1,a-n+1);for(let o=t;o<=r;o++)for(let l=n;l<=a;l++)s.set(o-t,l-n,this.get(o,l));return s}subMatrixRow(t,r,n){if(r===void 0&&(r=0),n===void 0&&(n=this.columns-1),r>n||r<0||r>=this.columns||n<0||n>=this.columns)throw new RangeError("Argument out of range");let a=new Matrix$2(t.length,n-r+1);for(let s=0;s<t.length;s++)for(let o=r;o<=n;o++){if(t[s]<0||t[s]>=this.rows)throw new RangeError(`Row index out of range: ${t[s]}`);a.set(s,o-r,this.get(t[s],o))}return a}subMatrixColumn(t,r,n){if(r===void 0&&(r=0),n===void 0&&(n=this.rows-1),r>n||r<0||r>=this.rows||n<0||n>=this.rows)throw new RangeError("Argument out of range");let a=new Matrix$2(n-r+1,t.length);for(let s=0;s<t.length;s++)for(let o=r;o<=n;o++){if(t[s]<0||t[s]>=this.columns)throw new RangeError(`Column index out of range: ${t[s]}`);a.set(o-r,s,this.get(o,t[s]))}return a}setSubMatrix(t,r,n){if(t=Matrix$2.checkMatrix(t),t.isEmpty())return this;let a=r+t.rows-1,s=n+t.columns-1;checkRange(this,r,a,n,s);for(let o=0;o<t.rows;o++)for(let l=0;l<t.columns;l++)this.set(r+o,n+l,t.get(o,l));return this}selection(t,r){checkRowIndices(this,t),checkColumnIndices(this,r);let n=new Matrix$2(t.length,r.length);for(let a=0;a<t.length;a++){let s=t[a];for(let o=0;o<r.length;o++){let l=r[o];n.set(a,o,this.get(s,l))}}return n}trace(){let t=Math.min(this.rows,this.columns),r=0;for(let n=0;n<t;n++)r+=this.get(n,n);return r}clone(){let t=new Matrix$2(this.rows,this.columns);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)t.set(r,n,this.get(r,n));return t}sum(t){switch(t){case"row":return sumByRow(this);case"column":return sumByColumn(this);case void 0:return sumAll(this);default:throw new Error(`invalid option: ${t}`)}}product(t){switch(t){case"row":return productByRow(this);case"column":return productByColumn(this);case void 0:return productAll(this);default:throw new Error(`invalid option: ${t}`)}}mean(t){const r=this.sum(t);switch(t){case"row":{for(let n=0;n<this.rows;n++)r[n]/=this.columns;return r}case"column":{for(let n=0;n<this.columns;n++)r[n]/=this.rows;return r}case void 0:return r/this.size;default:throw new Error(`invalid option: ${t}`)}}variance(t,r={}){if(typeof t=="object"&&(r=t,t=void 0),typeof r!="object")throw new TypeError("options must be an object");const{unbiased:n=!0,mean:a=this.mean(t)}=r;if(typeof n!="boolean")throw new TypeError("unbiased must be a boolean");switch(t){case"row":{if(!isAnyArray(a))throw new TypeError("mean must be an array");return varianceByRow(this,n,a)}case"column":{if(!isAnyArray(a))throw new TypeError("mean must be an array");return varianceByColumn(this,n,a)}case void 0:{if(typeof a!="number")throw new TypeError("mean must be a number");return varianceAll(this,n,a)}default:throw new Error(`invalid option: ${t}`)}}standardDeviation(t,r){typeof t=="object"&&(r=t,t=void 0);const n=this.variance(t,r);if(t===void 0)return Math.sqrt(n);for(let a=0;a<n.length;a++)n[a]=Math.sqrt(n[a]);return n}center(t,r={}){if(typeof t=="object"&&(r=t,t=void 0),typeof r!="object")throw new TypeError("options must be an object");const{center:n=this.mean(t)}=r;switch(t){case"row":{if(!isAnyArray(n))throw new TypeError("center must be an array");return centerByRow(this,n),this}case"column":{if(!isAnyArray(n))throw new TypeError("center must be an array");return centerByColumn(this,n),this}case void 0:{if(typeof n!="number")throw new TypeError("center must be a number");return centerAll(this,n),this}default:throw new Error(`invalid option: ${t}`)}}scale(t,r={}){if(typeof t=="object"&&(r=t,t=void 0),typeof r!="object")throw new TypeError("options must be an object");let n=r.scale;switch(t){case"row":{if(n===void 0)n=getScaleByRow(this);else if(!isAnyArray(n))throw new TypeError("scale must be an array");return scaleByRow(this,n),this}case"column":{if(n===void 0)n=getScaleByColumn(this);else if(!isAnyArray(n))throw new TypeError("scale must be an array");return scaleByColumn(this,n),this}case void 0:{if(n===void 0)n=getScaleAll(this);else if(typeof n!="number")throw new TypeError("scale must be a number");return scaleAll(this,n),this}default:throw new Error(`invalid option: ${t}`)}}toString(t){return inspectMatrixWithOptions(this,t)}}AbstractMatrix.prototype.klass="Matrix";typeof Symbol<"u"&&(AbstractMatrix.prototype[Symbol.for("nodejs.util.inspect.custom")]=inspectMatrix);function compareNumbers(e,t){return e-t}function isArrayOfNumbers(e){return e.every(t=>typeof t=="number")}AbstractMatrix.random=AbstractMatrix.rand;AbstractMatrix.randomInt=AbstractMatrix.randInt;AbstractMatrix.diagonal=AbstractMatrix.diag;AbstractMatrix.prototype.diagonal=AbstractMatrix.prototype.diag;AbstractMatrix.identity=AbstractMatrix.eye;AbstractMatrix.prototype.negate=AbstractMatrix.prototype.neg;AbstractMatrix.prototype.tensorProduct=AbstractMatrix.prototype.kroneckerProduct;let Matrix$2=class it extends AbstractMatrix{constructor(t,r){if(super(),it.isMatrix(t))return t.clone();if(Number.isInteger(t)&&t>=0)if(this.data=[],Number.isInteger(r)&&r>=0)for(let n=0;n<t;n++)this.data.push(new Float64Array(r));else throw new TypeError("nColumns must be a positive integer");else if(isAnyArray(t)){const n=t;if(t=n.length,r=t?n[0].length:0,typeof r!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let a=0;a<t;a++){if(n[a].length!==r)throw new RangeError("Inconsistent array dimensions");if(!isArrayOfNumbers(n[a]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(n[a]))}}else throw new TypeError("First argument must be a positive number or an array");this.rows=t,this.columns=r}set(t,r,n){return this.data[t][r]=n,this}get(t,r){return this.data[t][r]}removeRow(t){return checkRowIndex(this,t),this.data.splice(t,1),this.rows-=1,this}addRow(t,r){return r===void 0&&(r=t,t=this.rows),checkRowIndex(this,t,!0),r=Float64Array.from(checkRowVector(this,r)),this.data.splice(t,0,r),this.rows+=1,this}removeColumn(t){checkColumnIndex(this,t);for(let r=0;r<this.rows;r++){const n=new Float64Array(this.columns-1);for(let a=0;a<t;a++)n[a]=this.data[r][a];for(let a=t+1;a<this.columns;a++)n[a-1]=this.data[r][a];this.data[r]=n}return this.columns-=1,this}addColumn(t,r){typeof r>"u"&&(r=t,t=this.columns),checkColumnIndex(this,t,!0),r=checkColumnVector(this,r);for(let n=0;n<this.rows;n++){const a=new Float64Array(this.columns+1);let s=0;for(;s<t;s++)a[s]=this.data[n][s];for(a[s++]=r[n];s<this.columns+1;s++)a[s]=this.data[n][s-1];this.data[n]=a}return this.columns+=1,this}};installMathOperations(AbstractMatrix,Matrix$2);class BaseView extends AbstractMatrix{constructor(t,r,n){super(),this.matrix=t,this.rows=r,this.columns=n}}class MatrixColumnView extends BaseView{constructor(t,r){checkColumnIndex(t,r),super(t,t.rows,1),this.column=r}set(t,r,n){return this.matrix.set(t,this.column,n),this}get(t){return this.matrix.get(t,this.column)}}class MatrixColumnSelectionView extends BaseView{constructor(t,r){checkColumnIndices(t,r),super(t,t.rows,r.length),this.columnIndices=r}set(t,r,n){return this.matrix.set(t,this.columnIndices[r],n),this}get(t,r){return this.matrix.get(t,this.columnIndices[r])}}class MatrixFlipColumnView extends BaseView{constructor(t){super(t,t.rows,t.columns)}set(t,r,n){return this.matrix.set(t,this.columns-r-1,n),this}get(t,r){return this.matrix.get(t,this.columns-r-1)}}class MatrixFlipRowView extends BaseView{constructor(t){super(t,t.rows,t.columns)}set(t,r,n){return this.matrix.set(this.rows-t-1,r,n),this}get(t,r){return this.matrix.get(this.rows-t-1,r)}}class MatrixRowView extends BaseView{constructor(t,r){checkRowIndex(t,r),super(t,1,t.columns),this.row=r}set(t,r,n){return this.matrix.set(this.row,r,n),this}get(t,r){return this.matrix.get(this.row,r)}}class MatrixRowSelectionView extends BaseView{constructor(t,r){checkRowIndices(t,r),super(t,r.length,t.columns),this.rowIndices=r}set(t,r,n){return this.matrix.set(this.rowIndices[t],r,n),this}get(t,r){return this.matrix.get(this.rowIndices[t],r)}}class MatrixSelectionView extends BaseView{constructor(t,r,n){checkRowIndices(t,r),checkColumnIndices(t,n),super(t,r.length,n.length),this.rowIndices=r,this.columnIndices=n}set(t,r,n){return this.matrix.set(this.rowIndices[t],this.columnIndices[r],n),this}get(t,r){return this.matrix.get(this.rowIndices[t],this.columnIndices[r])}}class MatrixSubView extends BaseView{constructor(t,r,n,a,s){checkRange(t,r,n,a,s),super(t,n-r+1,s-a+1),this.startRow=r,this.startColumn=a}set(t,r,n){return this.matrix.set(this.startRow+t,this.startColumn+r,n),this}get(t,r){return this.matrix.get(this.startRow+t,this.startColumn+r)}}let MatrixTransposeView$1=class extends BaseView{constructor(t){super(t,t.columns,t.rows)}set(t,r,n){return this.matrix.set(r,t,n),this}get(t,r){return this.matrix.get(r,t)}};class WrapperMatrix1D extends AbstractMatrix{constructor(t,r={}){const{rows:n=1}=r;if(t.length%n!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=n,this.columns=t.length/n,this.data=t}set(t,r,n){let a=this._calculateIndex(t,r);return this.data[a]=n,this}get(t,r){let n=this._calculateIndex(t,r);return this.data[n]}_calculateIndex(t,r){return t*this.columns+r}}class WrapperMatrix2D extends AbstractMatrix{constructor(t){super(),this.data=t,this.rows=t.length,this.columns=t[0].length}set(t,r,n){return this.data[t][r]=n,this}get(t,r){return this.data[t][r]}}function wrap(e,t){if(isAnyArray(e))return e[0]&&isAnyArray(e[0])?new WrapperMatrix2D(e):new WrapperMatrix1D(e,t);throw new Error("the argument is not an array")}class LuDecomposition{constructor(t){t=WrapperMatrix2D.checkMatrix(t);let r=t.clone(),n=r.rows,a=r.columns,s=new Float64Array(n),o=1,l,f,h,c,u,d,g,p,m;for(l=0;l<n;l++)s[l]=l;for(p=new Float64Array(n),f=0;f<a;f++){for(l=0;l<n;l++)p[l]=r.get(l,f);for(l=0;l<n;l++){for(m=Math.min(l,f),u=0,h=0;h<m;h++)u+=r.get(l,h)*p[h];p[l]-=u,r.set(l,f,p[l])}for(c=f,l=f+1;l<n;l++)Math.abs(p[l])>Math.abs(p[c])&&(c=l);if(c!==f){for(h=0;h<a;h++)d=r.get(c,h),r.set(c,h,r.get(f,h)),r.set(f,h,d);g=s[c],s[c]=s[f],s[f]=g,o=-o}if(f<n&&r.get(f,f)!==0)for(l=f+1;l<n;l++)r.set(l,f,r.get(l,f)/r.get(f,f))}this.LU=r,this.pivotVector=s,this.pivotSign=o}isSingular(){let t=this.LU,r=t.columns;for(let n=0;n<r;n++)if(t.get(n,n)===0)return!0;return!1}solve(t){t=Matrix$2.checkMatrix(t);let r=this.LU;if(r.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let a=t.columns,s=t.subMatrixRow(this.pivotVector,0,a-1),o=r.columns,l,f,h;for(h=0;h<o;h++)for(l=h+1;l<o;l++)for(f=0;f<a;f++)s.set(l,f,s.get(l,f)-s.get(h,f)*r.get(l,h));for(h=o-1;h>=0;h--){for(f=0;f<a;f++)s.set(h,f,s.get(h,f)/r.get(h,h));for(l=0;l<h;l++)for(f=0;f<a;f++)s.set(l,f,s.get(l,f)-s.get(h,f)*r.get(l,h))}return s}get determinant(){let t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");let r=this.pivotSign,n=t.columns;for(let a=0;a<n;a++)r*=t.get(a,a);return r}get lowerTriangularMatrix(){let t=this.LU,r=t.rows,n=t.columns,a=new Matrix$2(r,n);for(let s=0;s<r;s++)for(let o=0;o<n;o++)s>o?a.set(s,o,t.get(s,o)):s===o?a.set(s,o,1):a.set(s,o,0);return a}get upperTriangularMatrix(){let t=this.LU,r=t.rows,n=t.columns,a=new Matrix$2(r,n);for(let s=0;s<r;s++)for(let o=0;o<n;o++)s<=o?a.set(s,o,t.get(s,o)):a.set(s,o,0);return a}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function hypotenuse$1(e,t){let r=0;return Math.abs(e)>Math.abs(t)?(r=t/e,Math.abs(e)*Math.sqrt(1+r*r)):t!==0?(r=e/t,Math.abs(t)*Math.sqrt(1+r*r)):0}class QrDecomposition{constructor(t){t=WrapperMatrix2D.checkMatrix(t);let r=t.clone(),n=t.rows,a=t.columns,s=new Float64Array(a),o,l,f,h;for(f=0;f<a;f++){let c=0;for(o=f;o<n;o++)c=hypotenuse$1(c,r.get(o,f));if(c!==0){for(r.get(f,f)<0&&(c=-c),o=f;o<n;o++)r.set(o,f,r.get(o,f)/c);for(r.set(f,f,r.get(f,f)+1),l=f+1;l<a;l++){for(h=0,o=f;o<n;o++)h+=r.get(o,f)*r.get(o,l);for(h=-h/r.get(f,f),o=f;o<n;o++)r.set(o,l,r.get(o,l)+h*r.get(o,f))}}s[f]=-c}this.QR=r,this.Rdiag=s}solve(t){t=Matrix$2.checkMatrix(t);let r=this.QR,n=r.rows;if(t.rows!==n)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let a=t.columns,s=t.clone(),o=r.columns,l,f,h,c;for(h=0;h<o;h++)for(f=0;f<a;f++){for(c=0,l=h;l<n;l++)c+=r.get(l,h)*s.get(l,f);for(c=-c/r.get(h,h),l=h;l<n;l++)s.set(l,f,s.get(l,f)+c*r.get(l,h))}for(h=o-1;h>=0;h--){for(f=0;f<a;f++)s.set(h,f,s.get(h,f)/this.Rdiag[h]);for(l=0;l<h;l++)for(f=0;f<a;f++)s.set(l,f,s.get(l,f)-s.get(h,f)*r.get(l,h))}return s.subMatrix(0,o-1,0,a-1)}isFullRank(){let t=this.QR.columns;for(let r=0;r<t;r++)if(this.Rdiag[r]===0)return!1;return!0}get upperTriangularMatrix(){let t=this.QR,r=t.columns,n=new Matrix$2(r,r),a,s;for(a=0;a<r;a++)for(s=0;s<r;s++)a<s?n.set(a,s,t.get(a,s)):a===s?n.set(a,s,this.Rdiag[a]):n.set(a,s,0);return n}get orthogonalMatrix(){let t=this.QR,r=t.rows,n=t.columns,a=new Matrix$2(r,n),s,o,l,f;for(l=n-1;l>=0;l--){for(s=0;s<r;s++)a.set(s,l,0);for(a.set(l,l,1),o=l;o<n;o++)if(t.get(l,l)!==0){for(f=0,s=l;s<r;s++)f+=t.get(s,l)*a.get(s,o);for(f=-f/t.get(l,l),s=l;s<r;s++)a.set(s,o,a.get(s,o)+f*t.get(s,l))}}return a}}class SingularValueDecomposition{constructor(t,r={}){if(t=WrapperMatrix2D.checkMatrix(t),t.isEmpty())throw new Error("Matrix must be non-empty");let n=t.rows,a=t.columns;const{computeLeftSingularVectors:s=!0,computeRightSingularVectors:o=!0,autoTranspose:l=!1}=r;let f=!!s,h=!!o,c=!1,u;if(n<a)if(!l)u=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{u=t.transpose(),n=u.rows,a=u.columns,c=!0;let b=f;f=h,h=b}else u=t.clone();let d=Math.min(n,a),g=Math.min(n+1,a),p=new Float64Array(g),m=new Matrix$2(n,d),y=new Matrix$2(a,a),x=new Float64Array(a),E=new Float64Array(n),_=new Float64Array(g);for(let b=0;b<g;b++)_[b]=b;let w=Math.min(n-1,a),M=Math.max(0,Math.min(a-2,n)),I=Math.max(w,M);for(let b=0;b<I;b++){if(b<w){p[b]=0;for(let A=b;A<n;A++)p[b]=hypotenuse$1(p[b],u.get(A,b));if(p[b]!==0){u.get(b,b)<0&&(p[b]=-p[b]);for(let A=b;A<n;A++)u.set(A,b,u.get(A,b)/p[b]);u.set(b,b,u.get(b,b)+1)}p[b]=-p[b]}for(let A=b+1;A<a;A++){if(b<w&&p[b]!==0){let T=0;for(let D=b;D<n;D++)T+=u.get(D,b)*u.get(D,A);T=-T/u.get(b,b);for(let D=b;D<n;D++)u.set(D,A,u.get(D,A)+T*u.get(D,b))}x[A]=u.get(b,A)}if(f&&b<w)for(let A=b;A<n;A++)m.set(A,b,u.get(A,b));if(b<M){x[b]=0;for(let A=b+1;A<a;A++)x[b]=hypotenuse$1(x[b],x[A]);if(x[b]!==0){x[b+1]<0&&(x[b]=0-x[b]);for(let A=b+1;A<a;A++)x[A]/=x[b];x[b+1]+=1}if(x[b]=-x[b],b+1<n&&x[b]!==0){for(let A=b+1;A<n;A++)E[A]=0;for(let A=b+1;A<n;A++)for(let T=b+1;T<a;T++)E[A]+=x[T]*u.get(A,T);for(let A=b+1;A<a;A++){let T=-x[A]/x[b+1];for(let D=b+1;D<n;D++)u.set(D,A,u.get(D,A)+T*E[D])}}if(h)for(let A=b+1;A<a;A++)y.set(A,b,x[A])}}let k=Math.min(a,n+1);if(w<a&&(p[w]=u.get(w,w)),n<k&&(p[k-1]=0),M+1<k&&(x[M]=u.get(M,k-1)),x[k-1]=0,f){for(let b=w;b<d;b++){for(let A=0;A<n;A++)m.set(A,b,0);m.set(b,b,1)}for(let b=w-1;b>=0;b--)if(p[b]!==0){for(let A=b+1;A<d;A++){let T=0;for(let D=b;D<n;D++)T+=m.get(D,b)*m.get(D,A);T=-T/m.get(b,b);for(let D=b;D<n;D++)m.set(D,A,m.get(D,A)+T*m.get(D,b))}for(let A=b;A<n;A++)m.set(A,b,-m.get(A,b));m.set(b,b,1+m.get(b,b));for(let A=0;A<b-1;A++)m.set(A,b,0)}else{for(let A=0;A<n;A++)m.set(A,b,0);m.set(b,b,1)}}if(h)for(let b=a-1;b>=0;b--){if(b<M&&x[b]!==0)for(let A=b+1;A<a;A++){let T=0;for(let D=b+1;D<a;D++)T+=y.get(D,b)*y.get(D,A);T=-T/y.get(b+1,b);for(let D=b+1;D<a;D++)y.set(D,A,y.get(D,A)+T*y.get(D,b))}for(let A=0;A<a;A++)y.set(A,b,0);y.set(b,b,1)}let v=k-1,S=Number.EPSILON;for(;k>0;){let b,A;for(b=k-2;b>=-1&&b!==-1;b--){const T=Number.MIN_VALUE+S*Math.abs(p[b]+Math.abs(p[b+1]));if(Math.abs(x[b])<=T||Number.isNaN(x[b])){x[b]=0;break}}if(b===k-2)A=4;else{let T;for(T=k-1;T>=b&&T!==b;T--){let D=(T!==k?Math.abs(x[T]):0)+(T!==b+1?Math.abs(x[T-1]):0);if(Math.abs(p[T])<=S*D){p[T]=0;break}}T===b?A=3:T===k-1?A=1:(A=2,b=T)}switch(b++,A){case 1:{let T=x[k-2];x[k-2]=0;for(let D=k-2;D>=b;D--){let P=hypotenuse$1(p[D],T),F=p[D]/P,V=T/P;if(p[D]=P,D!==b&&(T=-V*x[D-1],x[D-1]=F*x[D-1]),h)for(let q=0;q<a;q++)P=F*y.get(q,D)+V*y.get(q,k-1),y.set(q,k-1,-V*y.get(q,D)+F*y.get(q,k-1)),y.set(q,D,P)}break}case 2:{let T=x[b-1];x[b-1]=0;for(let D=b;D<k;D++){let P=hypotenuse$1(p[D],T),F=p[D]/P,V=T/P;if(p[D]=P,T=-V*x[D],x[D]=F*x[D],f)for(let q=0;q<n;q++)P=F*m.get(q,D)+V*m.get(q,b-1),m.set(q,b-1,-V*m.get(q,D)+F*m.get(q,b-1)),m.set(q,D,P)}break}case 3:{const T=Math.max(Math.abs(p[k-1]),Math.abs(p[k-2]),Math.abs(x[k-2]),Math.abs(p[b]),Math.abs(x[b])),D=p[k-1]/T,P=p[k-2]/T,F=x[k-2]/T,V=p[b]/T,q=x[b]/T,Y=((P+D)*(P-D)+F*F)/2,ee=D*F*(D*F);let z=0;(Y!==0||ee!==0)&&(Y<0?z=0-Math.sqrt(Y*Y+ee):z=Math.sqrt(Y*Y+ee),z=ee/(Y+z));let ae=(V+D)*(V-D)+z,ie=V*q;for(let j=b;j<k-1;j++){let G=hypotenuse$1(ae,ie);G===0&&(G=Number.MIN_VALUE);let N=ae/G,X=ie/G;if(j!==b&&(x[j-1]=G),ae=N*p[j]+X*x[j],x[j]=N*x[j]-X*p[j],ie=X*p[j+1],p[j+1]=N*p[j+1],h)for(let J=0;J<a;J++)G=N*y.get(J,j)+X*y.get(J,j+1),y.set(J,j+1,-X*y.get(J,j)+N*y.get(J,j+1)),y.set(J,j,G);if(G=hypotenuse$1(ae,ie),G===0&&(G=Number.MIN_VALUE),N=ae/G,X=ie/G,p[j]=G,ae=N*x[j]+X*p[j+1],p[j+1]=-X*x[j]+N*p[j+1],ie=X*x[j+1],x[j+1]=N*x[j+1],f&&j<n-1)for(let J=0;J<n;J++)G=N*m.get(J,j)+X*m.get(J,j+1),m.set(J,j+1,-X*m.get(J,j)+N*m.get(J,j+1)),m.set(J,j,G)}x[k-2]=ae;break}case 4:{if(p[b]<=0&&(p[b]=p[b]<0?-p[b]:0,h))for(let T=0;T<=v;T++)y.set(T,b,-y.get(T,b));for(;b<v&&!(p[b]>=p[b+1]);){let T=p[b];if(p[b]=p[b+1],p[b+1]=T,h&&b<a-1)for(let D=0;D<a;D++)T=y.get(D,b+1),y.set(D,b+1,y.get(D,b)),y.set(D,b,T);if(f&&b<n-1)for(let D=0;D<n;D++)T=m.get(D,b+1),m.set(D,b+1,m.get(D,b)),m.set(D,b,T);b++}k--;break}}}if(c){let b=y;y=m,m=b}this.m=n,this.n=a,this.s=p,this.U=m,this.V=y}solve(t){let r=t,n=this.threshold,a=this.s.length,s=Matrix$2.zeros(a,a);for(let d=0;d<a;d++)Math.abs(this.s[d])<=n?s.set(d,d,0):s.set(d,d,1/this.s[d]);let o=this.U,l=this.rightSingularVectors,f=l.mmul(s),h=l.rows,c=o.rows,u=Matrix$2.zeros(h,c);for(let d=0;d<h;d++)for(let g=0;g<c;g++){let p=0;for(let m=0;m<a;m++)p+=f.get(d,m)*o.get(g,m);u.set(d,g,p)}return u.mmul(r)}solveForDiagonal(t){return this.solve(Matrix$2.diag(t))}inverse(){let t=this.V,r=this.threshold,n=t.rows,a=t.columns,s=new Matrix$2(n,this.s.length);for(let c=0;c<n;c++)for(let u=0;u<a;u++)Math.abs(this.s[u])>r&&s.set(c,u,t.get(c,u)/this.s[u]);let o=this.U,l=o.rows,f=o.columns,h=new Matrix$2(n,l);for(let c=0;c<n;c++)for(let u=0;u<l;u++){let d=0;for(let g=0;g<f;g++)d+=s.get(c,g)*o.get(u,g);h.set(c,u,d)}return h}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let t=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,r=0,n=this.s;for(let a=0,s=n.length;a<s;a++)n[a]>t&&r++;return r}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return Matrix$2.diag(this.s)}}function inverse(e,t=!1){return e=WrapperMatrix2D.checkMatrix(e),t?new SingularValueDecomposition(e).inverse():solve(e,Matrix$2.eye(e.rows))}function solve(e,t,r=!1){return e=WrapperMatrix2D.checkMatrix(e),t=WrapperMatrix2D.checkMatrix(t),r?new SingularValueDecomposition(e).solve(t):e.isSquare()?new LuDecomposition(e).solve(t):new QrDecomposition(e).solve(t)}function determinant(e){if(e=Matrix$2.checkMatrix(e),e.isSquare()){if(e.columns===0)return 1;let t,r,n,a;if(e.columns===2)return t=e.get(0,0),r=e.get(0,1),n=e.get(1,0),a=e.get(1,1),t*a-r*n;if(e.columns===3){let s,o,l;return s=new MatrixSelectionView(e,[1,2],[1,2]),o=new MatrixSelectionView(e,[1,2],[0,2]),l=new MatrixSelectionView(e,[1,2],[0,1]),t=e.get(0,0),r=e.get(0,1),n=e.get(0,2),t*determinant(s)-r*determinant(o)+n*determinant(l)}else return new LuDecomposition(e).determinant}else throw Error("determinant can only be calculated for a square matrix")}function xrange(e,t){let r=[];for(let n=0;n<e;n++)n!==t&&r.push(n);return r}function dependenciesOneRow(e,t,r,n=1e-9,a=1e-9){if(e>a)return new Array(t.rows+1).fill(0);{let s=t.addRow(r,[0]);for(let o=0;o<s.rows;o++)Math.abs(s.get(o,0))<n&&s.set(o,0,0);return s.to1DArray()}}function linearDependencies(e,t={}){const{thresholdValue:r=1e-9,thresholdError:n=1e-9}=t;e=Matrix$2.checkMatrix(e);let a=e.rows,s=new Matrix$2(a,a);for(let o=0;o<a;o++){let l=Matrix$2.columnVector(e.getRow(o)),f=e.subMatrixRow(xrange(a,o)).transpose(),c=new SingularValueDecomposition(f).solve(l),u=Matrix$2.sub(l,f.mmul(c)).abs().max();s.setRow(o,dependenciesOneRow(u,c,o,r,n))}return s}function pseudoInverse(e,t=Number.EPSILON){if(e=Matrix$2.checkMatrix(e),e.isEmpty())return e.transpose();let r=new SingularValueDecomposition(e,{autoTranspose:!0}),n=r.leftSingularVectors,a=r.rightSingularVectors,s=r.diagonal;for(let o=0;o<s.length;o++)Math.abs(s[o])>t?s[o]=1/s[o]:s[o]=0;return a.mmul(Matrix$2.diag(s).mmul(n.transpose()))}function covariance(e,t=e,r={}){e=new Matrix$2(e);let n=!1;if(typeof t=="object"&&!Matrix$2.isMatrix(t)&&!isAnyArray(t)?(r=t,t=e,n=!0):t=new Matrix$2(t),e.rows!==t.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:a=!0}=r;a&&(e=e.center("column"),n||(t=t.center("column")));const s=e.transpose().mmul(t);for(let o=0;o<s.rows;o++)for(let l=0;l<s.columns;l++)s.set(o,l,s.get(o,l)*(1/(e.rows-1)));return s}function correlation(e,t=e,r={}){e=new Matrix$2(e);let n=!1;if(typeof t=="object"&&!Matrix$2.isMatrix(t)&&!isAnyArray(t)?(r=t,t=e,n=!0):t=new Matrix$2(t),e.rows!==t.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:a=!0,scale:s=!0}=r;a&&(e.center("column"),n||t.center("column")),s&&(e.scale("column"),n||t.scale("column"));const o=e.standardDeviation("column",{unbiased:!0}),l=n?o:t.standardDeviation("column",{unbiased:!0}),f=e.transpose().mmul(t);for(let h=0;h<f.rows;h++)for(let c=0;c<f.columns;c++)f.set(h,c,f.get(h,c)*(1/(o[h]*l[c]))*(1/(e.rows-1)));return f}class EigenvalueDecomposition{constructor(t,r={}){const{assumeSymmetric:n=!1}=r;if(t=WrapperMatrix2D.checkMatrix(t),!t.isSquare())throw new Error("Matrix is not a square matrix");if(t.isEmpty())throw new Error("Matrix must be non-empty");let a=t.columns,s=new Matrix$2(a,a),o=new Float64Array(a),l=new Float64Array(a),f=t,h,c,u=!1;if(n?u=!0:u=t.isSymmetric(),u){for(h=0;h<a;h++)for(c=0;c<a;c++)s.set(h,c,f.get(h,c));tred2(a,l,o,s),tql2(a,l,o,s)}else{let d=new Matrix$2(a,a),g=new Float64Array(a);for(c=0;c<a;c++)for(h=0;h<a;h++)d.set(h,c,f.get(h,c));orthes(a,d,g,s),hqr2(a,l,o,s,d)}this.n=a,this.e=l,this.d=o,this.V=s}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let t=this.n,r=this.e,n=this.d,a=new Matrix$2(t,t),s,o;for(s=0;s<t;s++){for(o=0;o<t;o++)a.set(s,o,0);a.set(s,s,n[s]),r[s]>0?a.set(s,s+1,r[s]):r[s]<0&&a.set(s,s-1,r[s])}return a}}function tred2(e,t,r,n){let a,s,o,l,f,h,c,u;for(f=0;f<e;f++)r[f]=n.get(e-1,f);for(l=e-1;l>0;l--){for(u=0,o=0,h=0;h<l;h++)u=u+Math.abs(r[h]);if(u===0)for(t[l]=r[l-1],f=0;f<l;f++)r[f]=n.get(l-1,f),n.set(l,f,0),n.set(f,l,0);else{for(h=0;h<l;h++)r[h]/=u,o+=r[h]*r[h];for(a=r[l-1],s=Math.sqrt(o),a>0&&(s=-s),t[l]=u*s,o=o-a*s,r[l-1]=a-s,f=0;f<l;f++)t[f]=0;for(f=0;f<l;f++){for(a=r[f],n.set(f,l,a),s=t[f]+n.get(f,f)*a,h=f+1;h<=l-1;h++)s+=n.get(h,f)*r[h],t[h]+=n.get(h,f)*a;t[f]=s}for(a=0,f=0;f<l;f++)t[f]/=o,a+=t[f]*r[f];for(c=a/(o+o),f=0;f<l;f++)t[f]-=c*r[f];for(f=0;f<l;f++){for(a=r[f],s=t[f],h=f;h<=l-1;h++)n.set(h,f,n.get(h,f)-(a*t[h]+s*r[h]));r[f]=n.get(l-1,f),n.set(l,f,0)}}r[l]=o}for(l=0;l<e-1;l++){if(n.set(e-1,l,n.get(l,l)),n.set(l,l,1),o=r[l+1],o!==0){for(h=0;h<=l;h++)r[h]=n.get(h,l+1)/o;for(f=0;f<=l;f++){for(s=0,h=0;h<=l;h++)s+=n.get(h,l+1)*n.get(h,f);for(h=0;h<=l;h++)n.set(h,f,n.get(h,f)-s*r[h])}}for(h=0;h<=l;h++)n.set(h,l+1,0)}for(f=0;f<e;f++)r[f]=n.get(e-1,f),n.set(e-1,f,0);n.set(e-1,e-1,1),t[0]=0}function tql2(e,t,r,n){let a,s,o,l,f,h,c,u,d,g,p,m,y,x,E,_;for(o=1;o<e;o++)t[o-1]=t[o];t[e-1]=0;let w=0,M=0,I=Number.EPSILON;for(h=0;h<e;h++){for(M=Math.max(M,Math.abs(r[h])+Math.abs(t[h])),c=h;c<e&&!(Math.abs(t[c])<=I*M);)c++;if(c>h)do{for(a=r[h],u=(r[h+1]-a)/(2*t[h]),d=hypotenuse$1(u,1),u<0&&(d=-d),r[h]=t[h]/(u+d),r[h+1]=t[h]*(u+d),g=r[h+1],s=a-r[h],o=h+2;o<e;o++)r[o]-=s;for(w=w+s,u=r[c],p=1,m=p,y=p,x=t[h+1],E=0,_=0,o=c-1;o>=h;o--)for(y=m,m=p,_=E,a=p*t[o],s=p*u,d=hypotenuse$1(u,t[o]),t[o+1]=E*d,E=t[o]/d,p=u/d,u=p*r[o]-E*a,r[o+1]=s+E*(p*a+E*r[o]),f=0;f<e;f++)s=n.get(f,o+1),n.set(f,o+1,E*n.get(f,o)+p*s),n.set(f,o,p*n.get(f,o)-E*s);u=-E*_*y*x*t[h]/g,t[h]=E*u,r[h]=p*u}while(Math.abs(t[h])>I*M);r[h]=r[h]+w,t[h]=0}for(o=0;o<e-1;o++){for(f=o,u=r[o],l=o+1;l<e;l++)r[l]<u&&(f=l,u=r[l]);if(f!==o)for(r[f]=r[o],r[o]=u,l=0;l<e;l++)u=n.get(l,o),n.set(l,o,n.get(l,f)),n.set(l,f,u)}}function orthes(e,t,r,n){let a=0,s=e-1,o,l,f,h,c,u,d;for(u=a+1;u<=s-1;u++){for(d=0,h=u;h<=s;h++)d=d+Math.abs(t.get(h,u-1));if(d!==0){for(f=0,h=s;h>=u;h--)r[h]=t.get(h,u-1)/d,f+=r[h]*r[h];for(l=Math.sqrt(f),r[u]>0&&(l=-l),f=f-r[u]*l,r[u]=r[u]-l,c=u;c<e;c++){for(o=0,h=s;h>=u;h--)o+=r[h]*t.get(h,c);for(o=o/f,h=u;h<=s;h++)t.set(h,c,t.get(h,c)-o*r[h])}for(h=0;h<=s;h++){for(o=0,c=s;c>=u;c--)o+=r[c]*t.get(h,c);for(o=o/f,c=u;c<=s;c++)t.set(h,c,t.get(h,c)-o*r[c])}r[u]=d*r[u],t.set(u,u-1,d*l)}}for(h=0;h<e;h++)for(c=0;c<e;c++)n.set(h,c,h===c?1:0);for(u=s-1;u>=a+1;u--)if(t.get(u,u-1)!==0){for(h=u+1;h<=s;h++)r[h]=t.get(h,u-1);for(c=u;c<=s;c++){for(l=0,h=u;h<=s;h++)l+=r[h]*n.get(h,c);for(l=l/r[u]/t.get(u,u-1),h=u;h<=s;h++)n.set(h,c,n.get(h,c)+l*r[h])}}}function hqr2(e,t,r,n,a){let s=e-1,o=0,l=e-1,f=Number.EPSILON,h=0,c=0,u=0,d=0,g=0,p=0,m=0,y=0,x,E,_,w,M,I,k,v,S,b,A,T,D,P,F;for(x=0;x<e;x++)for((x<o||x>l)&&(r[x]=a.get(x,x),t[x]=0),E=Math.max(x-1,0);E<e;E++)c=c+Math.abs(a.get(x,E));for(;s>=o;){for(w=s;w>o&&(p=Math.abs(a.get(w-1,w-1))+Math.abs(a.get(w,w)),p===0&&(p=c),!(Math.abs(a.get(w,w-1))<f*p));)w--;if(w===s)a.set(s,s,a.get(s,s)+h),r[s]=a.get(s,s),t[s]=0,s--,y=0;else if(w===s-1){if(k=a.get(s,s-1)*a.get(s-1,s),u=(a.get(s-1,s-1)-a.get(s,s))/2,d=u*u+k,m=Math.sqrt(Math.abs(d)),a.set(s,s,a.get(s,s)+h),a.set(s-1,s-1,a.get(s-1,s-1)+h),v=a.get(s,s),d>=0){for(m=u>=0?u+m:u-m,r[s-1]=v+m,r[s]=r[s-1],m!==0&&(r[s]=v-k/m),t[s-1]=0,t[s]=0,v=a.get(s,s-1),p=Math.abs(v)+Math.abs(m),u=v/p,d=m/p,g=Math.sqrt(u*u+d*d),u=u/g,d=d/g,E=s-1;E<e;E++)m=a.get(s-1,E),a.set(s-1,E,d*m+u*a.get(s,E)),a.set(s,E,d*a.get(s,E)-u*m);for(x=0;x<=s;x++)m=a.get(x,s-1),a.set(x,s-1,d*m+u*a.get(x,s)),a.set(x,s,d*a.get(x,s)-u*m);for(x=o;x<=l;x++)m=n.get(x,s-1),n.set(x,s-1,d*m+u*n.get(x,s)),n.set(x,s,d*n.get(x,s)-u*m)}else r[s-1]=v+u,r[s]=v+u,t[s-1]=m,t[s]=-m;s=s-2,y=0}else{if(v=a.get(s,s),S=0,k=0,w<s&&(S=a.get(s-1,s-1),k=a.get(s,s-1)*a.get(s-1,s)),y===10){for(h+=v,x=o;x<=s;x++)a.set(x,x,a.get(x,x)-v);p=Math.abs(a.get(s,s-1))+Math.abs(a.get(s-1,s-2)),v=S=.75*p,k=-.4375*p*p}if(y===30&&(p=(S-v)/2,p=p*p+k,p>0)){for(p=Math.sqrt(p),S<v&&(p=-p),p=v-k/((S-v)/2+p),x=o;x<=s;x++)a.set(x,x,a.get(x,x)-p);h+=p,v=S=k=.964}for(y=y+1,M=s-2;M>=w&&(m=a.get(M,M),g=v-m,p=S-m,u=(g*p-k)/a.get(M+1,M)+a.get(M,M+1),d=a.get(M+1,M+1)-m-g-p,g=a.get(M+2,M+1),p=Math.abs(u)+Math.abs(d)+Math.abs(g),u=u/p,d=d/p,g=g/p,!(M===w||Math.abs(a.get(M,M-1))*(Math.abs(d)+Math.abs(g))<f*(Math.abs(u)*(Math.abs(a.get(M-1,M-1))+Math.abs(m)+Math.abs(a.get(M+1,M+1))))));)M--;for(x=M+2;x<=s;x++)a.set(x,x-2,0),x>M+2&&a.set(x,x-3,0);for(_=M;_<=s-1&&(P=_!==s-1,_!==M&&(u=a.get(_,_-1),d=a.get(_+1,_-1),g=P?a.get(_+2,_-1):0,v=Math.abs(u)+Math.abs(d)+Math.abs(g),v!==0&&(u=u/v,d=d/v,g=g/v)),v!==0);_++)if(p=Math.sqrt(u*u+d*d+g*g),u<0&&(p=-p),p!==0){for(_!==M?a.set(_,_-1,-p*v):w!==M&&a.set(_,_-1,-a.get(_,_-1)),u=u+p,v=u/p,S=d/p,m=g/p,d=d/u,g=g/u,E=_;E<e;E++)u=a.get(_,E)+d*a.get(_+1,E),P&&(u=u+g*a.get(_+2,E),a.set(_+2,E,a.get(_+2,E)-u*m)),a.set(_,E,a.get(_,E)-u*v),a.set(_+1,E,a.get(_+1,E)-u*S);for(x=0;x<=Math.min(s,_+3);x++)u=v*a.get(x,_)+S*a.get(x,_+1),P&&(u=u+m*a.get(x,_+2),a.set(x,_+2,a.get(x,_+2)-u*g)),a.set(x,_,a.get(x,_)-u),a.set(x,_+1,a.get(x,_+1)-u*d);for(x=o;x<=l;x++)u=v*n.get(x,_)+S*n.get(x,_+1),P&&(u=u+m*n.get(x,_+2),n.set(x,_+2,n.get(x,_+2)-u*g)),n.set(x,_,n.get(x,_)-u),n.set(x,_+1,n.get(x,_+1)-u*d)}}}if(c!==0){for(s=e-1;s>=0;s--)if(u=r[s],d=t[s],d===0)for(w=s,a.set(s,s,1),x=s-1;x>=0;x--){for(k=a.get(x,x)-u,g=0,E=w;E<=s;E++)g=g+a.get(x,E)*a.get(E,s);if(t[x]<0)m=k,p=g;else if(w=x,t[x]===0?a.set(x,s,k!==0?-g/k:-g/(f*c)):(v=a.get(x,x+1),S=a.get(x+1,x),d=(r[x]-u)*(r[x]-u)+t[x]*t[x],I=(v*p-m*g)/d,a.set(x,s,I),a.set(x+1,s,Math.abs(v)>Math.abs(m)?(-g-k*I)/v:(-p-S*I)/m)),I=Math.abs(a.get(x,s)),f*I*I>1)for(E=x;E<=s;E++)a.set(E,s,a.get(E,s)/I)}else if(d<0)for(w=s-1,Math.abs(a.get(s,s-1))>Math.abs(a.get(s-1,s))?(a.set(s-1,s-1,d/a.get(s,s-1)),a.set(s-1,s,-(a.get(s,s)-u)/a.get(s,s-1))):(F=cdiv(0,-a.get(s-1,s),a.get(s-1,s-1)-u,d),a.set(s-1,s-1,F[0]),a.set(s-1,s,F[1])),a.set(s,s-1,0),a.set(s,s,1),x=s-2;x>=0;x--){for(b=0,A=0,E=w;E<=s;E++)b=b+a.get(x,E)*a.get(E,s-1),A=A+a.get(x,E)*a.get(E,s);if(k=a.get(x,x)-u,t[x]<0)m=k,g=b,p=A;else if(w=x,t[x]===0?(F=cdiv(-b,-A,k,d),a.set(x,s-1,F[0]),a.set(x,s,F[1])):(v=a.get(x,x+1),S=a.get(x+1,x),T=(r[x]-u)*(r[x]-u)+t[x]*t[x]-d*d,D=(r[x]-u)*2*d,T===0&&D===0&&(T=f*c*(Math.abs(k)+Math.abs(d)+Math.abs(v)+Math.abs(S)+Math.abs(m))),F=cdiv(v*g-m*b+d*A,v*p-m*A-d*b,T,D),a.set(x,s-1,F[0]),a.set(x,s,F[1]),Math.abs(v)>Math.abs(m)+Math.abs(d)?(a.set(x+1,s-1,(-b-k*a.get(x,s-1)+d*a.get(x,s))/v),a.set(x+1,s,(-A-k*a.get(x,s)-d*a.get(x,s-1))/v)):(F=cdiv(-g-S*a.get(x,s-1),-p-S*a.get(x,s),m,d),a.set(x+1,s-1,F[0]),a.set(x+1,s,F[1]))),I=Math.max(Math.abs(a.get(x,s-1)),Math.abs(a.get(x,s))),f*I*I>1)for(E=x;E<=s;E++)a.set(E,s-1,a.get(E,s-1)/I),a.set(E,s,a.get(E,s)/I)}for(x=0;x<e;x++)if(x<o||x>l)for(E=x;E<e;E++)n.set(x,E,a.get(x,E));for(E=e-1;E>=o;E--)for(x=o;x<=l;x++){for(m=0,_=o;_<=Math.min(E,l);_++)m=m+n.get(x,_)*a.get(_,E);n.set(x,E,m)}}}function cdiv(e,t,r,n){let a,s;return Math.abs(r)>Math.abs(n)?(a=n/r,s=r+a*n,[(e+a*t)/s,(t-a*e)/s]):(a=r/n,s=n+a*r,[(a*e+t)/s,(a*t-e)/s])}class CholeskyDecomposition{constructor(t){if(t=WrapperMatrix2D.checkMatrix(t),!t.isSymmetric())throw new Error("Matrix is not symmetric");let r=t,n=r.rows,a=new Matrix$2(n,n),s=!0,o,l,f;for(l=0;l<n;l++){let h=0;for(f=0;f<l;f++){let c=0;for(o=0;o<f;o++)c+=a.get(f,o)*a.get(l,o);c=(r.get(l,f)-c)/a.get(f,f),a.set(l,f,c),h=h+c*c}for(h=r.get(l,l)-h,s&=h>0,a.set(l,l,Math.sqrt(Math.max(h,0))),f=l+1;f<n;f++)a.set(l,f,0)}this.L=a,this.positiveDefinite=!!s}isPositiveDefinite(){return this.positiveDefinite}solve(t){t=WrapperMatrix2D.checkMatrix(t);let r=this.L,n=r.rows;if(t.rows!==n)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let a=t.columns,s=t.clone(),o,l,f;for(f=0;f<n;f++)for(l=0;l<a;l++){for(o=0;o<f;o++)s.set(f,l,s.get(f,l)-s.get(o,l)*r.get(f,o));s.set(f,l,s.get(f,l)/r.get(f,f))}for(f=n-1;f>=0;f--)for(l=0;l<a;l++){for(o=f+1;o<n;o++)s.set(f,l,s.get(f,l)-s.get(o,l)*r.get(o,f));s.set(f,l,s.get(f,l)/r.get(f,f))}return s}get lowerTriangularMatrix(){return this.L}}class nipals{constructor(t,r={}){t=WrapperMatrix2D.checkMatrix(t);let{Y:n}=r;const{scaleScores:a=!1,maxIterations:s=1e3,terminationCriteria:o=1e-10}=r;let l;if(n){if(isAnyArray(n)&&typeof n[0]=="number"?n=Matrix$2.columnVector(n):n=WrapperMatrix2D.checkMatrix(n),n.rows!==t.rows)throw new Error("Y should have the same number of rows as X");l=n.getColumnVector(0)}else l=t.getColumnVector(0);let f=1,h,c,u,d;for(let g=0;g<s&&f>o;g++)u=t.transpose().mmul(l).div(l.transpose().mmul(l).get(0,0)),u=u.div(u.norm()),h=t.mmul(u).div(u.transpose().mmul(u).get(0,0)),g>0&&(f=h.clone().sub(d).pow(2).sum()),d=h.clone(),n?(c=n.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0)),c=c.div(c.norm()),l=n.mmul(c).div(c.transpose().mmul(c).get(0,0))):l=h;if(n){let g=t.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0));g=g.div(g.norm());let p=t.clone().sub(h.clone().mmul(g.transpose())),m=l.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0)),y=n.clone().sub(h.clone().mulS(m.get(0,0)).mmul(c.transpose()));this.t=h,this.p=g.transpose(),this.w=u.transpose(),this.q=c,this.u=l,this.s=h.transpose().mmul(h),this.xResidual=p,this.yResidual=y,this.betas=m}else this.w=u.transpose(),this.s=h.transpose().mmul(h).sqrt(),a?this.t=h.clone().div(this.s.get(0,0)):this.t=h,this.xResidual=t.sub(h.mmul(u.transpose()))}}var src$1=Object.freeze({__proto__:null,AbstractMatrix,CHO:CholeskyDecomposition,CholeskyDecomposition,EVD:EigenvalueDecomposition,EigenvalueDecomposition,LU:LuDecomposition,LuDecomposition,Matrix:Matrix$2,MatrixColumnSelectionView,MatrixColumnView,MatrixFlipColumnView,MatrixFlipRowView,MatrixRowSelectionView,MatrixRowView,MatrixSelectionView,MatrixSubView,MatrixTransposeView:MatrixTransposeView$1,NIPALS:nipals,Nipals:nipals,QR:QrDecomposition,QrDecomposition,SVD:SingularValueDecomposition,SingularValueDecomposition,WrapperMatrix1D,WrapperMatrix2D,correlation,covariance,default:Matrix$2,determinant,inverse,linearDependencies,pseudoInverse,solve,wrap});function getSeparatedKernel(e){const t=new SingularValueDecomposition(e,{autoTranspose:!0});if(t.rank!==1)return null;const r=Math.sqrt(t.s[0]),n=t.U.to2DArray().map(s=>s[0]*r),a=t.V.to2DArray().map(s=>s[0]*r);return[n,a]}function convolution(e,t={}){let{channels:r,bitDepth:n,normalize:a=!1,divisor:s=1,border:o="copy",algorithm:l="auto"}=t,f={};n&&(f.bitDepth=n);let h=Image.createFrom(this,f);if(r=validateArrayOfChannels(this,r),l!=="separable")({kernel:e}=validateKernel(e));else if(!Array.isArray(e)||e.length!==2)throw new RangeError("separable convolution requires two arrays of numbers to represent the kernel");if(l==="auto"){let w=getSeparatedKernel(e);w!==null?(l="separable",e=w):(e.length>9||e[0].length>9)&&this.width<=4096&&this.height<=4096?l="fft":l="direct"}let c,u;l==="separable"?(c=Math.floor(e[0].length/2),u=Math.floor(e[1].length/2)):(c=Math.floor(e.length/2),u=Math.floor(e[0].length/2));let d=h.isClamped,g=new Array(this.height*this.width),p,m,y,x,E,_;for(x=0;x<r.length;x++){for(E=r[x],y=0;y<this.height;y++)for(m=0;m<this.width;m++)p=y*this.width+m,g[p]=this.data[p*this.channels+E];if(l==="direct")_=src$2.direct(g,e,{rows:this.height,cols:this.width,normalize:a,divisor:s});else if(l==="separable"){if(_=convolutionSeparable(g,e,this.width,this.height),a){s=0;for(let w=0;w<e[0].length;w++)for(let M=0;M<e[1].length;M++)s+=e[0][w]*e[1][M]}if(s!==1)for(let w=0;w<_.length;w++)_[w]/=s}else _=src$2.fft(g,e,{rows:this.height,cols:this.width,normalize:a,divisor:s});for(y=0;y<this.height;y++)for(m=0;m<this.width;m++)p=y*this.width+m,d?h.data[p*this.channels+E]=clamp(_[p],h):h.data[p*this.channels+E]=_[p]}if(this.alpha&&!r.includes(this.channels))for(m=this.components;m<this.data.length;m=m+this.channels)h.data[m]=this.data[m];return o!=="periodic"&&h.setBorder({size:[u,c],algorithm:o}),h}function gradientFilter(e={}){let{direction:t="xy",border:r="copy",kernelX:n,kernelY:a,channels:s,bitDepth:o=this.bitDepth}=e;switch(this.checkProcessable("gradientFilter",{bitDepth:[8,16]}),t){case"x":if(!n)throw new Error("kernelX option is missing");return convolution.call(this,n,{channels:s,border:r,bitDepth:o});case"y":if(!a)throw new Error("kernelY option is missing");return convolution.call(this,a,{channels:s,border:r,bitDepth:o});case"xy":{if(!n)throw new Error("kernelX option is missing");if(!a)throw new Error("kernelY option is missing");const l=convolution.call(this,n,{channels:s,border:r,bitDepth:32}),f=convolution.call(this,a,{channels:s,border:r,bitDepth:32});return l.hypotenuse(f,{bitDepth:o,channels:s})}default:throw new Error(`Unknown parameter direction: ${t}`)}}function sobelFilter(e){return gradientFilter.call(this,Object.assign({},e,{kernelX:SOBEL_X,kernelY:SOBEL_Y}))}function scharrFilter(e){return gradientFilter.call(this,Object.assign({},e,{kernelX:SCHARR_X,kernelY:SCHARR_Y}))}var newArray_1=newArray;function newArray(e,t){e=e||0;for(var r=new Array(e),n=0;n<e;n++)r[n]=t;return r}var newArray$1=getDefaultExportFromCjs(newArray_1);function level(e={}){let{algorithm:t="range",channels:r,min:n=this.min,max:a=this.max}=e;switch(this.checkProcessable("level",{bitDepth:[8,16,32]}),r=validateArrayOfChannels(this,{channels:r}),r.length!==this.channel&&(Array.isArray(n)&&n.length===this.channels&&(n=n.filter((s,o)=>r.includes(o))),Array.isArray(a)&&a.length===this.channels&&(a=a.filter((s,o)=>r.includes(o)))),t){case"range":n<0&&(n=0),a>this.maxValue&&(a=this.maxValue),Array.isArray(n)||(n=newArray$1(r.length,n)),Array.isArray(a)||(a=newArray$1(r.length,a)),processImage(this,n,a,r);break;default:throw new Error(`level: algorithm not implement: ${t}`)}return this}function processImage(e,t,r,n){let a=1e-5,s=new Array(n.length);for(let o=0;o<n.length;o++)t[o]===0&&r[o]===e.maxValue||r[o]===t[o]?s[o]=0:s[o]=(e.maxValue+1-a)/(r[o]-t[o]),t[o]+=(.5-a/2)/s[o];for(let o=0;o<n.length;o++){let l=n[o];if(s[o]!==0)for(let f=0;f<e.data.length;f+=e.channels)e.data[f+l]=Math.min(Math.max(0,(e.data[f+l]-t[o])*s[o]+.5|0),e.maxValue)}}var toString$2=Object.prototype.toString,isArrayType=function e(t){return toString$2.call(t).substr(-6,5)==="Array"},isArray$b=getDefaultExportFromCjs(isArrayType);function checkNumberArray(e){if(isNaN(e)){if(e instanceof Image)return e.data;if(!isArray$b(e))throw new Error("checkNumberArray: the value should be either a number, array or Image");return e}else{if(e<=0)throw new Error("checkNumberArray: the value must be greater than 0");return e}}function add(e,t={}){let{channels:r}=t;if(this.checkProcessable("add",{bitDepth:[8,16]}),r=validateArrayOfChannels(this,{channels:r}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("add: the data size is different");for(let n=0;n<r.length;n++){let a=r[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.max(0,Math.min(this.maxValue,this.data[s+a]+e[s+a]>>0))}}else for(let n=0;n<r.length;n++){let a=r[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.min(this.maxValue,this.data[s+a]+e>>0)}return this}function subtract(e,t={}){let{channels:r}=t;if(this.checkProcessable("subtract",{bitDepth:[8,16]}),r=validateArrayOfChannels(this,{channels:r}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("subtract: the data size is different");for(let n=0;n<r.length;n++){let a=r[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.max(0,Math.min(this.maxValue,this.data[s+a]-e[s+a]>>0))}}else for(let n=0;n<r.length;n++){let a=r[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.max(0,this.data[s+a]-e>>0)}return this}function subtractImage(e,t={}){let{channels:r,absolute:n=!1}=t;if(this.checkProcessable("subtractImage",{bitDepth:[8,16]}),this.width!==e.width||this.height!==e.height)throw new Error("subtractImage: both images must have the same size");if(this.alpha!==e.alpha||this.bitDepth!==e.bitDepth)throw new Error("subtractImage: both images must have the same alpha and bitDepth");if(this.channels!==e.channels)throw new Error("subtractImage: both images must have the same number of channels");let a=this.clone();r=validateArrayOfChannels(this,{channels:r});for(let s=0;s<r.length;s++){let o=r[s];for(let l=o;l<this.data.length;l+=this.channels){let f=this.data[l]-e.data[l];n?a.data[l]=Math.abs(f):a.data[l]=Math.max(f,0)}}return a}function hypotenuse(e,t={}){let{bitDepth:r=this.bitDepth,channels:n}=t;if(this.checkProcessable("hypotenuse",{bitDepth:[8,16,32]}),this.width!==e.width||this.height!==e.height)throw new Error("hypotenuse: both images must have the same size");if(this.alpha!==e.alpha||this.bitDepth!==e.bitDepth)throw new Error("hypotenuse: both images must have the same alpha and bitDepth");if(this.channels!==e.channels)throw new Error("hypotenuse: both images must have the same number of channels");let a=Image.createFrom(this,{bitDepth:r});n=validateArrayOfChannels(this,{channels:n});let s=a.isClamped;for(let o=0;o<n.length;o++){let l=n[o];for(let f=l;f<this.data.length;f+=this.channels){let h=Math.hypot(this.data[f],e.data[f]);s?a.data[f]=Math.min(Math.max(Math.round(h),0),a.maxValue):a.data[f]=h}}return a}function multiply(e,t={}){let{channels:r}=t;if(this.checkProcessable("multiply",{bitDepth:[8,16]}),e<=0)throw new Error("multiply: the value must be greater than 0");if(r=validateArrayOfChannels(this,{channels:r}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("multiply: the data size is different");for(let n=0;n<r.length;n++){let a=r[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.max(0,Math.min(this.maxValue,this.data[s+a]*e[s+a]>>0))}}else for(let n=0;n<r.length;n++){let a=r[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.min(this.maxValue,this.data[s+a]*e>>0)}return this}function divide(e,t={}){let{channels:r}=t;if(this.checkProcessable("divide",{bitDepth:[8,16]}),r=validateArrayOfChannels(this,{channels:r}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("divide: the: the data size is different");for(let n=0;n<r.length;n++){let a=r[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.max(0,Math.min(this.maxValue,this.data[s+a]/e[s+a]>>0))}}else for(let n=0;n<r.length;n++){let a=r[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.min(this.maxValue,this.data[s+a]/e>>0)}return this}class BaseRegression{constructor(){if(new.target===BaseRegression)throw new Error("BaseRegression must be subclassed")}predict(t){if(typeof t=="number")return this._predict(t);if(isAnyArray(t)){const r=[];for(let n=0;n<t.length;n++)r.push(this._predict(t[n]));return r}else throw new TypeError("x must be a number or array")}_predict(){throw new Error("_predict must be implemented")}train(){}toString(){return""}toLaTeX(){return""}score(t,r){if(!isAnyArray(t)||!isAnyArray(r)||t.length!==r.length)throw new Error("x and y must be arrays of the same length");const n=t.length,a=new Array(n);for(let g=0;g<n;g++)a[g]=this._predict(t[g]);let s=0,o=0,l=0,f=0,h=0,c=0,u=0;for(let g=0;g<n;g++)s+=a[g],o+=r[g],h+=a[g]*a[g],c+=r[g]*r[g],u+=a[g]*r[g],r[g]!==0&&(l+=(r[g]-a[g])*(r[g]-a[g])/r[g]),f+=(r[g]-a[g])*(r[g]-a[g]);const d=(n*u-s*o)/Math.sqrt((n*h-s*s)*(n*c-o*o));return{r:d,r2:d*d,chi2:l,rmsd:Math.sqrt(f/n)}}}var require$$0$1=getAugmentedNamespace(src$1);function squaredEuclidean$4(e,t){let r=0;for(let n=0;n<e.length;n++)r+=(e[n]-t[n])*(e[n]-t[n]);return r}function euclidean$2(e,t){return Math.sqrt(squaredEuclidean$4(e,t))}var euclidean$3=Object.freeze({__proto__:null,euclidean:euclidean$2,squaredEuclidean:squaredEuclidean$4}),require$$0=getAugmentedNamespace(euclidean$3);const{squaredEuclidean:squaredEuclidean$3}=require$$0,defaultOptions$b={sigma:1};let GaussianKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$b,t),this.sigma=t.sigma,this.divisor=2*t.sigma*t.sigma}compute(t,r){const n=squaredEuclidean$3(t,r);return Math.exp(-n/this.divisor)}};var gaussianKernel=GaussianKernel$1;const defaultOptions$a={degree:1,constant:1,scale:1};let PolynomialKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$a,t),this.degree=t.degree,this.constant=t.constant,this.scale=t.scale}compute(t,r){for(var n=0,a=0;a<t.length;a++)n+=t[a]*r[a];return Math.pow(this.scale*n+this.constant,this.degree)}};var polynomialKernel=PolynomialKernel$1;const defaultOptions$9={alpha:.01,constant:-Math.E};let SigmoidKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$9,t),this.alpha=t.alpha,this.constant=t.constant}compute(t,r){for(var n=0,a=0;a<t.length;a++)n+=t[a]*r[a];return Math.tanh(this.alpha*n+this.constant)}};var sigmoidKernel=SigmoidKernel$1;const defaultOptions$8={sigma:1,degree:1};let ANOVAKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$8,t),this.sigma=t.sigma,this.degree=t.degree}compute(t,r){for(var n=0,a=Math.min(t.length,r.length),s=1;s<=a;++s)n+=Math.pow(Math.exp(-this.sigma*Math.pow(Math.pow(t[s-1],s)-Math.pow(r[s-1],s),2)),this.degree);return n}};var anovaKernel=ANOVAKernel$1;const{squaredEuclidean:squaredEuclidean$2}=require$$0,defaultOptions$7={sigma:1};let CauchyKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$7,t),this.sigma=t.sigma}compute(t,r){return 1/(1+squaredEuclidean$2(t,r)/(this.sigma*this.sigma))}};var cauchyKernel=CauchyKernel$1;const{euclidean:euclidean$1}=require$$0,defaultOptions$6={sigma:1};let ExponentialKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$6,t),this.sigma=t.sigma,this.divisor=2*t.sigma*t.sigma}compute(t,r){const n=euclidean$1(t,r);return Math.exp(-n/this.divisor)}};var exponentialKernel=ExponentialKernel$1;class HistogramIntersectionKernel{compute(t,r){for(var n=Math.min(t.length,r.length),a=0,s=0;s<n;++s)a+=Math.min(t[s],r[s]);return a}}var histogramIntersectionKernel=HistogramIntersectionKernel;const{euclidean}=require$$0,defaultOptions$5={sigma:1};let LaplacianKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$5,t),this.sigma=t.sigma}compute(t,r){const n=euclidean(t,r);return Math.exp(-n/this.sigma)}};var laplacianKernel=LaplacianKernel$1;const{squaredEuclidean:squaredEuclidean$1}=require$$0,defaultOptions$4={constant:1};let MultiquadraticKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$4,t),this.constant=t.constant}compute(t,r){return Math.sqrt(squaredEuclidean$1(t,r)+this.constant*this.constant)}};var multiquadraticKernel=MultiquadraticKernel$1;const{squaredEuclidean}=require$$0,defaultOptions$3={constant:1};class RationalQuadraticKernel{constructor(t){t=Object.assign({},defaultOptions$3,t),this.constant=t.constant}compute(t,r){const n=squaredEuclidean(t,r);return 1-n/(n+this.constant)}}var rationalQuadraticKernel=RationalQuadraticKernel;const{Matrix:Matrix$1,MatrixTransposeView}=require$$0$1,GaussianKernel=gaussianKernel,PolynomialKernel=polynomialKernel,SigmoidKernel=sigmoidKernel,ANOVAKernel=anovaKernel,CauchyKernel=cauchyKernel,ExponentialKernel=exponentialKernel,HistogramKernel=histogramIntersectionKernel,LaplacianKernel=laplacianKernel,MultiquadraticKernel=multiquadraticKernel,RationalKernel=rationalQuadraticKernel,kernelType={gaussian:GaussianKernel,rbf:GaussianKernel,polynomial:PolynomialKernel,poly:PolynomialKernel,anova:ANOVAKernel,cauchy:CauchyKernel,exponential:ExponentialKernel,histogram:HistogramKernel,min:HistogramKernel,laplacian:LaplacianKernel,multiquadratic:MultiquadraticKernel,rational:RationalKernel,sigmoid:SigmoidKernel,mlp:SigmoidKernel};class Kernel{constructor(t,r){if(this.kernelType=t,t!=="linear")if(typeof t=="string"){t=t.toLowerCase();var n=kernelType[t];if(n)this.kernelFunction=new n(r);else throw new Error(`unsupported kernel type: ${t}`)}else if(typeof t=="object"&&typeof t.compute=="function")this.kernelFunction=t;else throw new TypeError("first argument must be a valid kernel type or instance")}compute(t,r){if(t=Matrix$1.checkMatrix(t),r===void 0?r=t:r=Matrix$1.checkMatrix(r),this.kernelType==="linear")return t.mmul(new MatrixTransposeView(r));const n=new Matrix$1(t.rows,r.rows);if(t===r)for(let a=0;a<t.rows;a++)for(let s=a;s<t.rows;s++){const o=this.kernelFunction.compute(t.getRow(a),t.getRow(s));n.set(a,s,o),n.set(s,a,o)}else for(let a=0;a<t.rows;a++)for(let s=0;s<r.rows;s++)n.set(a,s,this.kernelFunction.compute(t.getRow(a),r.getRow(s)));return n}}var kernel=Kernel,Kernel$1=getDefaultExportFromCjs(kernel);const defaultOptions$2={lambda:.1,kernelType:"gaussian",kernelOptions:{},computeCoefficient:!1};class KernelRidgeRegression extends BaseRegression{constructor(t,r,n){if(super(),t===!0)this.alpha=r.alpha,this.inputs=r.inputs,this.kernelType=r.kernelType,this.kernelOptions=r.kernelOptions,this.kernel=new Kernel$1(r.kernelType,r.kernelOptions);else{t=Matrix$2.checkMatrix(t),n=Object.assign({},defaultOptions$2,n);const a=new Kernel$1(n.kernelType,n.kernelOptions),s=a.compute(t),o=t.rows;s.add(Matrix$2.eye(o,o).mul(n.lambda)),this.alpha=solve(s,r),this.inputs=t,this.kernelType=n.kernelType,this.kernelOptions=n.kernelOptions,this.kernel=a}}_predict(t){return this.kernel.compute([t],this.inputs).mmul(this.alpha).getRow(0)}toJSON(){return{name:"kernelRidgeRegression",alpha:this.alpha,inputs:this.inputs,kernelType:this.kernelType,kernelOptions:this.kernelOptions}}static load(t){if(t.name!=="kernelRidgeRegression")throw new TypeError("not a KRR model");return new KernelRidgeRegression(!0,t)}}function background$1(e,t,r){const n=new KernelRidgeRegression(e,t,r),a=new Array(this.size);for(let l=0;l<this.width;l++)for(let f=0;f<this.height;f++)a[f*this.width+l]=[l,f];const s=n.predict(a),o=Image.createFrom(this);for(let l=0;l<this.size;l++)o.data[l]=Math.min(this.maxValue,Math.max(0,s[l][0]));return o}function dilate(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=e;if(this.checkProcessable("dilate",{bitDepth:[1,8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("dilate: The number of rows and columns of the kernel must be odd");let n=!0;e:for(const s of t)for(const o of s)if(o!==1){n=!1;break e}let a=this;for(let s=0;s<r;s++)if(this.bitDepth===1)if(n){const o=a.clone();a=dilateOnceBinaryOnlyOnes(a,o,t.length,t[0].length)}else{const o=Image.createFrom(a);a=dilateOnceBinary(a,o,t)}else if(n){const o=Image.createFrom(a);a=dilateOnceGreyOnlyOnes(a,o,t.length,t[0].length)}else{const o=Image.createFrom(a);a=dilateOnceGrey(a,o,t)}return a}function dilateOnceGrey(e,t,r){const n=r.length,a=r[0].length;let s=(n-1)/2,o=(a-1)/2;for(let l=0;l<e.height;l++)for(let f=0;f<e.width;f++){let h=0;for(let c=0;c<a;c++)for(let u=0;u<n;u++){if(r[u][c]!==1)continue;let d=u-s+f,g=c-o+l;if(d<0||g<0||d>=e.width||g>=e.height)continue;const p=e.getValueXY(d,g,0);p>h&&(h=p)}t.setValueXY(f,l,0,h)}return t}function dilateOnceGreyOnlyOnes(e,t,r,n){const a=(r-1)/2,s=(n-1)/2,o=[];for(let l=0;l<e.width;l++)o.push(0);for(let l=0;l<e.height;l++){for(let f=0;f<e.width;f++){let h=0;for(let c=Math.max(0,l-s);c<Math.min(e.height,l+s+1);c++){const u=e.getValueXY(f,c,0);u>h&&(h=u)}o[f]=h}for(let f=0;f<e.width;f++){let h=0;for(let c=Math.max(0,f-a);c<Math.min(e.width,f+a+1);c++)o[c]>h&&(h=o[c]);t.setValueXY(f,l,0,h)}}return t}function dilateOnceBinary(e,t,r){const n=r.length,a=r[0].length;let s=(n-1)/2,o=(a-1)/2;for(let l=0;l<e.height;l++)for(let f=0;f<e.width;f++){let h=0;e:for(let c=0;c<a;c++)for(let u=0;u<n;u++){if(r[u][c]!==1)continue;let d=u-s+f,g=c-o+l;if(g<0||d<0||d>=e.width||g>=e.height)continue;if(e.getBitXY(d,g)===1){h=1;break e}}h===1&&t.setBitXY(f,l)}return t}function dilateOnceBinaryOnlyOnes(e,t,r,n){const a=(r-1)/2,s=(n-1)/2,o=[];for(let l=0;l<e.width;l++)o.push(1);for(let l=0;l<e.height;l++){for(let f=0;f<e.width;f++){o[f]=0;for(let h=Math.max(0,l-s);h<Math.min(e.height,l+s+1);h++)if(e.getBitXY(f,h)===1){o[f]=1;break}}for(let f=0;f<e.width;f++)if(t.getBitXY(f,l)!==1){for(let h=Math.max(0,f-a);h<Math.min(e.width,f+a+1);h++)if(o[h]===1){t.setBitXY(f,l);break}}}return t}function erode(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=e;if(this.checkProcessable("erode",{bitDepth:[1,8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("erode: The number of rows and columns of the kernel must be odd");let n=!0;e:for(const s of t)for(const o of s)if(o!==1){n=!1;break e}let a=this;for(let s=0;s<r;s++)if(this.bitDepth===1)if(n){const o=a.clone();a=erodeOnceBinaryOnlyOnes(a,o,t.length,t[0].length)}else{const o=Image.createFrom(a);a=erodeOnceBinary(a,o,t)}else if(n){const o=Image.createFrom(a);a=erodeOnceGreyOnlyOnes(a,o,t.length,t[0].length)}else{const o=Image.createFrom(a);a=erodeOnceGrey(a,o,t)}return a}function erodeOnceGrey(e,t,r){const n=r.length,a=r[0].length;let s=(n-1)/2,o=(a-1)/2;for(let l=0;l<e.height;l++)for(let f=0;f<e.width;f++){let h=e.maxValue;for(let c=0;c<a;c++)for(let u=0;u<n;u++){if(r[u][c]!==1)continue;let d=u-s+f,g=c-o+l;if(d<0||g<0||d>=e.width||g>=e.height)continue;const p=e.getValueXY(d,g,0);p<h&&(h=p)}t.setValueXY(f,l,0,h)}return t}function erodeOnceGreyOnlyOnes(e,t,r,n){const a=(r-1)/2,s=(n-1)/2,o=[];for(let l=0;l<e.width;l++)o.push(0);for(let l=0;l<e.height;l++){for(let f=0;f<e.width;f++){let h=e.maxValue;for(let c=Math.max(0,l-s);c<Math.min(e.height,l+s+1);c++){const u=e.getValueXY(f,c,0);u<h&&(h=u)}o[f]=h}for(let f=0;f<e.width;f++){let h=e.maxValue;for(let c=Math.max(0,f-a);c<Math.min(e.width,f+a+1);c++)o[c]<h&&(h=o[c]);t.setValueXY(f,l,0,h)}}return t}function erodeOnceBinary(e,t,r){const n=r.length,a=r[0].length;let s=(n-1)/2,o=(a-1)/2;for(let l=0;l<e.height;l++)for(let f=0;f<e.width;f++){let h=1;e:for(let c=0;c<a;c++)for(let u=0;u<n;u++){if(r[u][c]!==1)continue;let d=u-s+f,g=c-o+l;if(g<0||d<0||d>=e.width||g>=e.height)continue;if(e.getBitXY(d,g)===0){h=0;break e}}h===1&&t.setBitXY(f,l)}return t}function erodeOnceBinaryOnlyOnes(e,t,r,n){const a=(r-1)/2,s=(n-1)/2,o=[];for(let l=0;l<e.width;l++)o.push(0);for(let l=0;l<e.height;l++){for(let f=0;f<e.width;f++){o[f]=1;for(let h=Math.max(0,l-s);h<Math.min(e.height,l+s+1);h++)if(e.getBitXY(f,h)===0){o[f]=0;break}}for(let f=0;f<e.width;f++)if(t.getBitXY(f,l)!==0){for(let h=Math.max(0,f-a);h<Math.min(e.width,f+a+1);h++)if(o[h]===0){t.clearBitXY(f,l);break}}}return t}function open(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=e;if(this.checkProcessable("open",{bitDepth:[8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("open: The number of rows and columns of the kernel must be odd");let n=this;for(let a=0;a<r;a++)n=n.erode({kernel:t}),n=n.dilate({kernel:t});return n}function close(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=e;if(this.checkProcessable("close",{bitDepth:[1,8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("close: The number of rows and columns of the kernel must be odd");let n=this;for(let a=0;a<r;a++)n=n.dilate({kernel:t}).erode({kernel:t});return n}function topHat(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=e;if(this.checkProcessable("topHat",{bitDepth:[8,16],components:1,alpha:0}),t.length%2===0||t[0].length%2===0)throw new TypeError("topHat: The number of rows and columns of the kernel must be odd");let n=this;for(let a=0;a<r;a++)n=n.open({kernel:t}).subtractImage(n,{absolute:!0});return n}function blackHat(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=e;if(this.checkProcessable("blackHat",{bitDepth:[8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("blackHat: The number of rows and columns of the kernel must be odd");let n=this;for(let a=0;a<r;a++)n=n.close({kernel:t}).subtractImage(n,{absolute:!0});return n}function morphologicalGradient(e={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=e;if(this.checkProcessable("morphologicalGradient",{bitDepth:[8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("morphologicalGradient: The number of rows and columns of the kernel must be odd");let n=this;for(let a=0;a<r;a++){let s=n.dilate({kernel:t}),o=n.erode({kernel:t});n=s.subtractImage(o,{absolute:!0})}return n}function order4Points(e){let t=0,r=0,n=0,a=0,s=e[0][0],o=0;for(let h=1;h<e.length;h++)e[h][0]<s&&(s=e[h][0],o=h);let l=e[(o+1)%e.length][0],f=(o+1)%e.length;for(let h=1;h<e.length;h++)e[h][0]<l&&h!==o&&(l=e[h][0],f=h);return e[f][1]<e[o][1]?(t=e[f],a=e[o],o!==(f+1)%4?(r=e[(f+1)%4],n=e[(f+2)%4]):(r=e[(f+2)%4],n=e[(f+3)%4])):(a=e[f],t=e[o],f!==(o+1)%4?(r=e[(o+1)%4],n=e[(o+2)%4]):(r=e[(o+2)%4],n=e[(o+3)%4])),[t,r,n,a]}function distance2Points(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function crossVect(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function dotVect(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function computeWidthAndHeigth(e,t,r,n,a,s){let o=Math.max(distance2Points(e,t),distance2Points(n,r)),l=Math.max(distance2Points(e,n),distance2Points(t,r)),f=0,h=0,c=Math.ceil(a/2),u=Math.ceil(s/2),d=o/l,g=[e[0],e[1],1],p=[t[0],t[1],1],m=[n[0],n[1],1],y=[r[0],r[1],1],x=dotVect(crossVect(g,y),m)/dotVect(crossVect(p,y),m),E=dotVect(crossVect(g,y),p)/dotVect(crossVect(m,y),p),_=[x*p[0]-g[0],x*p[1]-g[1],x*p[2]-g[2]],w=[E*m[0]-g[0],E*m[1]-g[1],E*m[2]-g[2]],M=_[0],I=_[1],k=_[2],v=w[0],S=w[1],b=w[2],A=1/(k*b)*(M*v-(M*b+k*v)*c+k*b*c*c+(I*S-(I*b+k*S)*u+k*b*u*u));A>=0?A=Math.sqrt(A):A=Math.sqrt(-A);let T=new Matrix$2([[A,0,c],[0,A,u],[0,0,1]]),D=T.transpose(),P=inverse(D),F=inverse(T),V=Matrix$2.rowVector(_),q=Matrix$2.rowVector(w),Y=Math.sqrt(dotVect(V.mmul(P).mmul(F).to1DArray(),_)/dotVect(q.mmul(P).mmul(F).to1DArray(),w));return Y===0||d===0?(f=Math.ceil(o),h=Math.ceil(l)):Y<d?(f=Math.ceil(o),h=Math.ceil(f/Y)):(h=Math.ceil(l),f=Math.ceil(Y*h)),[f,h]}function projectionPoint(e,t,r,n,a,s,o,l,f,h,c,u){let[d,g]=[(r*e+n*t+a)/(f*e+h*t+1),(s*e+o*t+l)/(f*e+h*t+1)];return c.getValueXY(Math.floor(d),Math.floor(g),u)}function warpingFourPoints(e,t={}){let{calculateRatio:r=!0}=t;if(e.length!==4)throw new Error(`The array pts must have four elements, which are the four corners. Currently, pts have ${e.length} elements`);let[n,a,s,o]=e,l=[n,a,s,o],[f,h,c,u]=order4Points(l),d,g;r?[d,g]=computeWidthAndHeigth(f,h,c,u,this.width,this.height):(d=Math.ceil(Math.max(distance2Points(f,h),distance2Points(u,c))),g=Math.ceil(Math.max(distance2Points(f,u),distance2Points(h,c))));let p=Image.createFrom(this,{width:d,height:g}),[m,y]=f,[x,E]=h,[_,w]=c,[M,I]=u,[k,v]=[0,0],[S,b]=[0,d-1],[A,T]=[g-1,d-1],[D,P]=[g-1,0],F=new Matrix$2([[k,v,1,0,0,0,-k*m,-v*m],[S,b,1,0,0,0,-S*x,-b*x],[A,T,1,0,0,0,-A*_,-v*_],[D,P,1,0,0,0,-D*M,-P*M],[0,0,0,k,v,1,-k*y,-v*y],[0,0,0,S,b,1,-S*E,-b*E],[0,0,0,A,T,1,-A*w,-T*w],[0,0,0,D,P,1,-D*I,-P*I]]),V=Matrix$2.columnVector([m,x,_,M,y,E,w,I]),Y=new SingularValueDecomposition(F).solve(V),[ee,z,ae,ie,j,G,N,X]=Y.to1DArray(),J=new Matrix$2(g,d);for(let ge=0;ge<this.channels;ge++){for(let oe=0;oe<g;oe++)for(let ue=0;ue<d;ue++)J.set(oe,ue,projectionPoint(oe,ue,ee,z,ae,ie,j,G,N,X,this,ge));p.setMatrix(J,{channel:ge})}return p}function crop(e={}){let{x:t=0,y:r=0,width:n=this.width-t,height:a=this.height-r}=e;if(this.checkProcessable("crop",{bitDepth:[1,8,16]}),t=Math.round(t),r=Math.round(r),n=Math.round(n),a=Math.round(a),t>this.width-1||r>this.height-1)throw new RangeError(`crop: origin (x:${t}, y:${r}) out of range (${this.width-1}; ${this.height-1})`);if(n<=0||a<=0)throw new RangeError(`crop: width and height (width:${n}; height:${a}) must be positive numbers`);if(t<0||r<0)throw new RangeError(`crop: x and y (x:${t}, y:${r}) must be positive numbers`);if(n>this.width-t||a>this.height-r)throw new RangeError(`crop: (x: ${t}, y:${r}, width:${n}, height:${a}) size is out of range`);let s=this;if(this.bitDepth===1){const o=new Image(n,a,{kind:"BINARY",parent:this});s=cropBinary(this,o,t,r,n,a)}else{const o=Image.createFrom(this,{width:n,height:a,position:[t,r]});s=cropDefault(this,o,t,r,n,a)}return s}function cropDefault(e,t,r,n,a,s){let o=a*e.channels,l=n+s,f=0,h=r*e.channels;for(let c=n;c<l;c++){let u=c*e.width*e.channels+h,d=u+o;for(;u<d;u++)t.data[f++]=e.data[u]}return t}function cropBinary(e,t,r,n,a,s){let o=a*e.channels,l=n+s,f=0,h=r*e.channels;for(let c=n;c<l;c++){let u=c*e.width*e.channels+h,d=u+o;for(;u<d;u++)e.getBit(u)&&t.setBit(f),++f}return t}function cropAlpha(e={}){this.checkProcessable("cropAlpha",{alpha:1});const{threshold:t=this.maxValue}=e;let r=findLeft(this,t,this.components);if(r===-1)throw new Error("Could not find new dimensions. Threshold may be too high.");let n=findTop(this,t,this.components,r),a=findBottom(this,t,this.components,r),s=findRight(this,t,this.components,r,n,a);return this.crop({x:r,y:n,width:s-r+1,height:a-n+1})}function findLeft(e,t,r){for(let n=0;n<e.width;n++)for(let a=0;a<e.height;a++)if(e.getValueXY(n,a,r)>=t)return n;return-1}function findTop(e,t,r,n){for(let a=0;a<e.height;a++)for(let s=n;s<e.width;s++)if(e.getValueXY(s,a,r)>=t)return a;return-1}function findBottom(e,t,r,n){for(let a=e.height-1;a>=0;a--)for(let s=n;s<e.width;s++)if(e.getValueXY(s,a,r)>=t)return a;return-1}function findRight(e,t,r,n,a,s){for(let o=e.width-1;o>=n;o--)for(let l=a;l<=s;l++)if(e.getValueXY(o,l,r)>=t)return o;return-1}function getFactor(e){if(typeof e=="string"){const t=e[e.length-1];e=parseFloat(e),t==="%"&&(e/=100)}return e}function getThreshold$1(e,t){if(!t)throw Error("getThreshold : the maxValue should be specified");if(typeof e=="string"){if(e[e.length-1]!=="%")throw Error("getThreshold : if the value is a string it must finish by %");return parseFloat(e)/100*t}else{if(typeof e=="number")return e<1?e*t:e;throw Error("getThreshold : the value is not valid")}}function factorDimensions(e,t,r){e=getFactor(e);let n=Math.round(e*t),a=Math.round(e*r);return n<=0&&(n=1),a<=0&&(a=1),{width:n,height:a}}function checkRow(e,t){if(t<0||t>=e.height)throw new RangeError(`row must be included between 0 and ${e.height-1}. Current value: ${t}`)}function checkColumn(e,t){if(t<0||t>=e.width)throw new RangeError(`column must be included between 0 and ${e.width-1}. Current value: ${t}`)}function checkChannel(e,t){if(t<0||t>=e.channels)throw new RangeError(`channel must be included between 0 and ${e.channels-1}. Current value: ${t}`)}const validInterpolations={nearestneighbor:"nearestNeighbor",nearestneighbour:"nearestNeighbor",bilinear:"bilinear"};function checkInterpolation(e){if(typeof e!="string")throw new TypeError("interpolation must be a string");if(e=e.toLowerCase(),!validInterpolations[e])throw new RangeError(`invalid interpolation algorithm: ${e}`);return validInterpolations[e]}function nearestNeighbor(e,t,r){const n=this.width/t,a=this.height/r;if(this.bitDepth>1)for(let s=0;s<t;s++){const o=Math.floor((s+.5)*n);for(let l=0;l<r;l++){const f=Math.floor((l+.5)*a);for(let h=0;h<this.channels;h++)e.setValueXY(s,l,h,this.getValueXY(o,f,h))}}else for(let s=0;s<t;s++){const o=Math.floor((s+.5)*n);for(let l=0;l<r;l++){const f=Math.floor((l+.5)*a);this.getBitXY(o,f)&&e.setBitXY(s,l)}}}function resize(e={}){const{factor:t=1,interpolation:r=validInterpolations.nearestneighbor,preserveAspectRatio:n=!0}=e,a=checkInterpolation(r);let s=e.width,o=e.height;if(s||(o&&n?s=Math.round(o*(this.width/this.height)):s=this.width),o||(n?o=Math.round(s*(this.height/this.width)):o=this.height),{width:s,height:o}=factorDimensions(t,s,o),s===this.width&&o===this.height){const c=this.clone();return c.position=[0,0],c}let l=Math.round((this.width-s)/2),f=Math.round((this.height-o)/2);const h=Image.createFrom(this,{width:s,height:o,position:[l,f]});switch(a){case validInterpolations.nearestneighbor:nearestNeighbor.call(this,h,s,o);break;default:throw new Error(`unsupported resize interpolation: ${a}`)}return h}function hsv(){this.checkProcessable("hsv",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let e=Image.createFrom(this,{colorModel:HSV}),t=0,r=this.data;for(let n=0;n<r.length;n+=this.channels){let a=r[n],s=r[n+1],o=r[n+2],l=Math.min(a,s,o),f=Math.max(a,s,o),h=f-l,c=0,u=f===0?0:h/f,d=f;if(f!==l){switch(f){case a:c=(s-o)/h+(s<o?6:0);break;case s:c=(o-a)/h+2;break;case o:c=(a-s)/h+4;break;default:throw new Error("unreachable")}c/=6}e.data[t++]=c*this.maxValue,e.data[t++]=u*this.maxValue,e.data[t++]=d,this.alpha&&(e.data[t++]=r[n+3])}return e}function hsl$1(){this.checkProcessable("hsl",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let e=Image.createFrom(this,{colorModel:HSL}),t=Math.floor(this.maxValue/2),r=0,n=this.data;for(let a=0;a<n.length;a+=this.channels){let s=n[a],o=n[a+1],l=n[a+2],f=Math.max(s,o,l),h=Math.min(s,o,l),c=0,u=0,d=(f+h)/2;if(f!==h){let g=f-h;switch(u=d>t?g/(2-f-h):g/(f+h),f){case s:c=(o-l)/g+(o<l?6:0);break;case o:c=(l-s)/g+2;break;case l:c=(s-o)/g+4;break;default:throw new Error("unreachable")}c/=6}e.data[r++]=c*this.maxValue,e.data[r++]=u*this.maxValue,e.data[r++]=d,this.alpha&&(e.data[r++]=n[a+3])}return e}function cmyk(){this.checkProcessable("cmyk",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let e=Image.createFrom(this,{components:4,colorModel:CMYK$1}),t=0,r=this.data;for(let n=0;n<r.length;n+=this.channels){let a=r[n],s=r[n+1],o=r[n+2],l=Math.min(this.maxValue-a,this.maxValue-s,this.maxValue-o),f=(this.maxValue-a-l)/(1-l/this.maxValue),h=(this.maxValue-s-l)/(1-l/this.maxValue),c=(this.maxValue-o-l)/(1-l/this.maxValue);e.data[t++]=Math.round(f),e.data[t++]=Math.round(h),e.data[t++]=Math.round(c),e.data[t++]=Math.round(l),this.alpha&&(e.data[t++]=r[n+3])}return e}function rgba8(){return new Image(this.width,this.height,this.getRGBAData(),{kind:"RGBA",parent:this})}const methods$1={luma709(e,t,r){return e*6966+t*23436+r*2366>>15},luma601(e,t,r){return e*9798+t*19235+r*3735>>15},maximum(e,t,r){return Math.max(e,t,r)},minimum(e,t,r){return Math.min(e,t,r)},average(e,t,r){return(e+t+r)/3>>0},minmax(e,t,r){return(Math.max(e,t,r)+Math.min(e,t,r))/2},red(e){return e},green(e,t){return t},blue(e,t,r){return r},cyan(e,t,r,n){let a=methods$1.black(e,t,r,n);return(n.maxValue-e-a)/(1-a/n.maxValue)>>0},magenta(e,t,r,n){let a=methods$1.black(e,t,r,n);return(n.maxValue-t-a)/(1-a/n.maxValue)>>0},yellow(e,t,r,n){let a=methods$1.black(e,t,r,n);return(n.maxValue-r-a)/(1-a/n.maxValue)>>0},black(e,t,r,n){return Math.min(n.maxValue-e,n.maxValue-t,n.maxValue-r)},hue(e,t,r,n){let a=methods$1.min(e,t,r),s=methods$1.max(e,t,r);if(s===a)return 0;let o=0,l=s-a;switch(s){case e:o=(t-r)/l+(t<r?6:0);break;case t:o=(r-e)/l+2;break;case r:o=(e-t)/l+4;break;default:throw new Error("unreachable")}return o/6*n.maxValue>>0},saturation(e,t,r,n){let a=methods$1.min(e,t,r),s=methods$1.max(e,t,r),o=s-a;return s===0?0:o/s*n.maxValue},lightness(e,t,r){let n=methods$1.min(e,t,r);return(methods$1.max(e,t,r)+n)/2}};Object.defineProperty(methods$1,"luminosity",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"luminance",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"min",{enumerable:!1,value:methods$1.minimum});Object.defineProperty(methods$1,"max",{enumerable:!1,value:methods$1.maximum});Object.defineProperty(methods$1,"brightness",{enumerable:!1,value:methods$1.maximum});Object.keys(methods$1).forEach(e=>{});function grey(e={}){let{algorithm:t="luma709",keepAlpha:r=!1,mergeAlpha:n=!0}=e;if(typeof t!="string"&&typeof t!="function")throw new TypeError("algorithm must be a string or a function");this.checkProcessable("grey",{bitDepth:[8,16],alpha:[0,1]}),this.components===1&&(t="red"),r&=this.alpha,n&=this.alpha,r&&(n=!1);let a=getOutputImage(this,e,{components:1,alpha:r,colorModel:GREY$1}),s;if(typeof t=="function")s=t;else if(s=methods$1[t.toLowerCase()],!s)throw new Error(`unsupported grey algorithm: ${t}`);let o=0;for(let l=0;l<this.data.length;l+=this.channels)n?a.data[o++]=clamp(s(this.data[l],this.data[l+1],this.data[l+2],this)*this.data[l+this.components]/this.maxValue,this):(a.data[o++]=clamp(s(this.data[l],this.data[l+1],this.data[l+2],this),this),a.alpha&&(a.data[o++]=this.data[l+this.components]));return a}function huang(e){let t=0;for(let c=0;c<e.length;c++)if(e[c]!==0){t=c;break}let r=e.length-1;for(let c=e.length-1;c>=t;c--)if(e[c]!==0){r=c;break}let n=1/(r-t),a=new Array(e.length),s=0,o=0;for(let c=t;c<e.length;c++)s+=c*e[c],o+=e[c],a[c]=s/o;let l=new Array(e.length);s=o=0;for(let c=r;c>0;c--)s+=c*e[c],o+=e[c],l[c-1]=s/o;let f=-1,h=Number.MAX_VALUE;for(let c=0;c<e.length;c++){let u=0,d;for(let g=0;g<=c;g++)d=1/(1+n*Math.abs(g-a[c])),d<1e-6||d>.999999||(u+=e[g]*(-d*Math.log(d)-(1-d)*Math.log(1-d)));for(let g=c+1;g<e.length;g++)d=1/(1+n*Math.abs(g-l[c])),d<1e-6||d>.999999||(u+=e[g]*(-d*Math.log(d)-(1-d)*Math.log(1-d)));u<h&&(h=u,f=c)}return f}function intermodes(e){let t=e.slice(),r=0;for(;!bimodalTest$1(t);){let a=0,s=0,o=t[0];for(let l=0;l<e.length-1;l++)a=s,s=o,o=t[l+1],t[l]=(a+s+o)/3;if(t[e.length-1]=(s+o)/3,r++,r>1e4)throw new Error("Intermodes Threshold not found after 10000 iterations")}let n=0;for(let a=1;a<e.length-1;a++)t[a-1]<t[a]&&t[a+1]<t[a]&&(n+=a);return Math.floor(n/2)}function bimodalTest$1(e){let t=!1,r=0;for(let n=1;n<e.length-1;n++)if(e[n-1]<e[n]&&e[n+1]<e[n]&&(r++,r>2))return!1;return r===2&&(t=!0),t}function isodata(e){let t,r,n,a,s=0;for(let o=1;o<e.length;o++)if(e[o]>0){s=o+1;break}for(;;){t=0,n=0;for(let o=0;o<s;o++)n=n+e[o],t=t+e[o]*o;a=0,r=0;for(let o=s+1;o<e.length;o++)r+=e[o],a+=e[o]*o;if(n>0&&r>0&&(t/=n,a/=r,s===Math.round((t+a)/2)))break;if(s++,s>e.length-2)throw new Error("Threshold not found")}return s}function li(e,t){let r,n,a,s,o,l,f,h,c,u,d,g;d=.5,u=0;for(let p=0;p<e.length;p++)u+=p*e[p];u/=t,f=u;do{l=f,r=l+.5|0,n=0,s=0;for(let p=0;p<=r;p++)n+=p*e[p],s+=e[p];h=s===0?0:n/s,a=0,o=0;for(let p=r+1;p<e.length;p++)a+=p*e[p],o+=e[p];c=o===0?0:a/o,g=(h-c)/(Math.log(h)-Math.log(c)),g<-Number.EPSILON?f=g-.5|0:f=g+.5|0}while(Math.abs(f-l)>d);return r}function maxEntropy(e,t){let r=new Array(e.length);for(let d=0;d<e.length;d++)r[d]=e[d]/t;let n=new Array(e.length),a=new Array(e.length);n[0]=r[0],a[0]=1-n[0];for(let d=1;d<e.length;d++)n[d]=n[d-1]+r[d],a[d]=1-n[d];let s=0;for(let d=0;d<e.length;d++)if(Math.abs(n[d])>=Number.EPSILON){s=d;break}let o=e.length-1;for(let d=e.length-1;d>=s;d--)if(Math.abs(a[d])>=Number.EPSILON){o=d;break}let l=-1,f,h=Number.MIN_VALUE,c,u;for(let d=s;d<=o;d++){c=0;for(let g=0;g<=d;g++)e[g]!==0&&(c-=r[g]/n[d]*Math.log(r[g]/n[d]));u=0;for(let g=d+1;g<e.length;g++)e[g]!==0&&(u-=r[g]/a[d]*Math.log(r[g]/a[d]));f=c+u,h<f&&(h=f,l=d)}return l}function mean$1(e,t){let r=0;for(let n=0;n<e.length;n++)r+=n*e[n];return Math.floor(r/t)}function minError(e,t){let r,n=-2,a,s,o,l,f,h,c,u,d,g,p,m=0;for(let y=0;y<e.length;y++)m+=y*e[y];for(m/=t,r=m;r!==n;){let y=sumA(e,r),x=sumA(e,e.length-1),E=sumB(e,r),_=sumB(e,e.length-1),w=sumC(e,r),M=sumC(e,e.length-1);if(a=E/y,s=(_-E)/(x-y),o=y/x,l=(x-y)/x,f=w/y-a*a,h=(M-w)/(x-y)-s*s,c=1/f-1/h,u=a/f-s/h,d=a*a/f-s*s/h+Math.log10(f*(l*l)/(h*(o*o))),g=u*u-c*d,g<0)return r;n=r,p=(u+Math.sqrt(g))/c,isNaN(p)?r=n:r=Math.floor(p)}return r}function sumA(e,t){let r=0;for(let n=0;n<=t;n++)r+=e[n];return r}function sumB(e,t){let r=0;for(let n=0;n<=t;n++)r+=n*e[n];return r}function sumC(e,t){let r=0;for(let n=0;n<=t;n++)r+=n*n*e[n];return r}function minimum(e){if(e.length<2)return 0;let t=0,r=-1,n=-1,a=new Array(e.length);for(let s=0;s<e.length;s++)a[s]=e[s],e[s]>0&&(n=s);for(;!bimodalTest(a);)if(a=smoothed(a),t++,t>1e4)return r;return r=minimumBetweenPeeks(a,n),r}function smoothed(e){let t=new Array(e.length);for(let r=1;r<e.length-1;r++)t[r]=(e[r-1]+e[r]+e[r+1])/3;return t[0]=(e[0]+e[1])/3,t[e.length-1]=(e[e.length-2]+e[e.length-1])/3,t}function minimumBetweenPeeks(e,t){let r;for(let n=1;n<t;n++)if(e[n-1]>e[n]&&e[n+1]>=e[n]){r=n;break}return r}function bimodalTest(e){let t=e.length,r=!1,n=0;for(let a=1;a<t-1;a++)if(e[a-1]<e[a]&&e[a+1]<e[a]&&(n++,n>2))return!1;return n===2&&(r=!0),r}function moments(e,t){let r=1,n=0,a=0,s=0,o=0,l,f,h,c,u,d,g=-1,p=e.length,m=new Array(p);for(let y=0;y<p;y++)m[y]=e[y]/t;for(let y=0;y<p;y++)n+=y*m[y],a+=y*y*m[y],s+=y*y*y*m[y];f=r*a-n*n,h=(-a*a+n*s)/f,c=(r*-s+a*n)/f,u=.5*(-c-Math.sqrt(c*c-4*h)),d=.5*(-c+Math.sqrt(c*c-4*h)),l=(d-n)/(d-u);for(let y=0;y<p;y++)if(o+=m[y],o>l){g=y;break}return g}function otsu(e,t){let r=0,n=0,a=0,s=0,o=0;for(let l=0;l<e.length;l++)o+=l*e[l];for(let l=0;l<e.length;l++){n=n+e[l];const f=t-n;if(n===0||f===0)continue;r=r+l*e[l];const h=(o-r)/f,c=n*f*(r/n-h)*(r/n-h);c>=a&&(s=l,a=c)}return s}function percentile(e){let t=-1,r=.5,n=new Array(e.length),a=partialSum(e,e.length-1),s=1;for(let o=0;o<e.length;o++)n[o]=Math.abs(partialSum(e,o)/a-r),n[o]<s&&(s=n[o],t=o);return t}function partialSum(e,t){let r=0;for(let n=0;n<=t;n++)r+=e[n];return r}function renyiEntropy(e,t){let r,n,a,s=new Array(e.length),o=new Array(e.length),l=new Array(e.length),f=0,h=0,c=0,u=0,d=0,g=0,m=1/(1-.5),x=1/(1-2);for(let M=0;M<e.length;M++)s[M]=e[M]/t;o[0]=s[0],l[0]=1-o[0];for(let M=1;M<e.length;M++)o[M]=o[M-1]+s[M],l[M]=1-o[M];n=0;for(let M=0;M<e.length;M++)if(Math.abs(o[M])>=Number.EPSILON){n=M;break}a=e.length-1;for(let M=e.length-1;M>=n;M--)if(Math.abs(l[M])>=Number.EPSILON){a=M;break}for(let M=n;M<=a;M++){let I=0,k=0,v=0;for(let F=0;F<=M;F++)e[F]!==0&&(I-=s[F]/o[M]*Math.log(s[F]/o[M])),k+=Math.sqrt(s[F]/o[M]),v+=s[F]*s[F]/(o[M]*o[M]);let S=0,b=0,A=0;for(let F=M+1;F<e.length;F++)e[F]!==0&&(S-=s[F]/l[M]*Math.log(s[F]/l[M])),b+=Math.sqrt(s[F]/l[M]),A+=s[F]*s[F]/(l[M]*l[M]);let T=I+S,D=m*(k*b>0?Math.log(k*b):0),P=x*(v*A>0?Math.log(v*A):0);T>u&&(u=T,f=M),D>d&&(d=D,h=M),P>g&&(g=P,c=M)}let E=[f,h,c];E.sort((M,I)=>M-I);let _;Math.abs(E[0]-E[1])<=5?Math.abs(E[1]-E[2])<=5?_=[1,2,1]:_=[0,1,3]:Math.abs(E[1]-E[2])<=5?_=[3,1,0]:_=[1,2,1];let w=o[E[2]]-o[E[0]];return r=Math.round(E[0]*(o[E[0]]+.25*w*_[0])+.25*E[1]*w*_[1]+E[2]*(l[E[2]]+.25*w*_[2])),r}function shanbhag(e,t){let r=new Array(e.length);for(let g=0;g<e.length;g++)r[g]=e[g]/t;let n=new Array(e.length),a=new Array(e.length);n[0]=r[0],a[0]=1-n[0];for(let g=1;g<e.length;g++)n[g]=n[g-1]+r[g],a[g]=1-n[g];let s=0;for(let g=0;g<e.length;g++)if(Math.abs(n[g])>=Number.EPSILON){s=g;break}let o=e.length-1;for(let g=e.length-1;g>=s;g--)if(Math.abs(a[g])>=Number.EPSILON){o=g;break}let l=-1,f=Number.MAX_VALUE,h,c,u,d;for(let g=s;g<=o;g++){u=0,h=.5/n[g];for(let p=1;p<=g;p++)u-=r[p]*Math.log(1-h*n[p-1]);u*=h,d=0,h=.5/a[g];for(let p=g+1;p<e.length;p++)d-=r[p]*Math.log(1-h*a[p]);d*=h,c=Math.abs(u-d),c<f&&(f=c,l=g)}return l}function triangle$1(e){let t=0,r=0,n=0,a=0;for(let u=0;u<e.length;u++)if(e[u]>0){t=u;break}t>0&&t--;for(let u=e.length-1;u>0;u--)if(e[u]>0){a=u;break}a<e.length-1&&a++;for(let u=0;u<e.length;u++)e[u]>r&&(n=u,r=e[u]);let s=!1;if(n-t<a-n){s=!0;let u=0,d=e.length-1;for(;u<d;){let g=e[u];e[u]=e[d],e[d]=g,u++,d--}t=e.length-1-a,n=e.length-1-n}if(t===n)return t;let o,l,f;o=e[n],l=t-n,f=Math.sqrt(o*o+l*l),o/=f,l/=f,f=o*t+l*e[t];let h=t,c=0;for(let u=t+1;u<=n;u++){let d=o*u+l*e[u]-f;d>c&&(h=u,c=d)}if(h--,s){let u=0,d=e.length-1;for(;u<d;){let g=e[u];e[u]=e[d],e[d]=g,u++,d--}return e.length-1-h}else return h}function yen(e,t){let r=new Array(e.length);for(let h=0;h<e.length;h++)r[h]=e[h]/t;let n=new Array(e.length);n[0]=r[0];for(let h=1;h<e.length;h++)n[h]=n[h-1]+r[h];let a=new Array(e.length);a[0]=r[0]*r[0];for(let h=1;h<e.length;h++)a[h]=a[h-1]+r[h]*r[h];let s=new Array(e.length);s[e.length-1]=0;for(let h=e.length-2;h>=0;h--)s[h]=s[h+1]+r[h+1]*r[h+1];let o=-1,l=Number.MIN_VALUE,f;for(let h=0;h<e.length;h++)f=-1*(a[h]*s[h]>0?Math.log(a[h]*s[h]):0)+2*(n[h]*(1-n[h])>0?Math.log(n[h]*(1-n[h])):0),f>l&&(l=f,o=h);return o}const methods={huang,intermodes,isodata,li,maxentropy:maxEntropy,mean:mean$1,minerror:minError,minimum,moments,otsu,percentile,renyientropy:renyiEntropy,shanbhag,triangle:triangle$1,yen},names={};Object.keys(methods).forEach(e=>{names[e]=e});function getThreshold(e={}){let{algorithm:t=names.otsu}=e;this.checkProcessable("getThreshold",{components:1,bitDepth:[8,16]});let r=methods[t.toLowerCase()];if(r){let n=this.getHistogram();return r(n,this.size)}else throw new Error(`unknown thresholding algorithm: ${t}`)}const THRESHOLD="threshold";function mask(e={}){let{algorithm:t=THRESHOLD,threshold:r=.5,useAlpha:n=!0,invert:a=!1}=e;this.checkProcessable("mask",{components:1,bitDepth:[8,16]}),t===THRESHOLD?r=getThreshold$1(r,this.maxValue):r=getThreshold.call(this,e);let s=new Image(this.width,this.height,{kind:"BINARY",parent:this}),o=0;if(this.alpha&&n)for(let l=0;l<this.data.length;l+=this.channels){let f=this.data[l]+(this.maxValue-this.data[l])*(this.maxValue-this.data[l+1])/this.maxValue;(a&&f<=r||!a&&f>=r)&&s.setBit(o),o++}else for(let l=0;l<this.data.length;l+=this.channels)(a&&this.data[l]<=r||!a&&this.data[l]>=r)&&s.setBit(o),o++;return s}function copyImage(e,t,r,n){let a=e.width,s=e.height,o=t.width,l=e.channels;for(let f=0;f<a;f++)for(let h=0;h<s;h++)for(let c=0;c<l;c++){let u=(h*a+f)*l+c,d=((n+h)*o+r+f)*l+c;t.data[d]=e.data[u]}}function pad(e={}){let{size:t=0,algorithm:r="copy",color:n}=e;if(this.checkProcessable("pad",{bitDepth:[8,16]}),r==="set"){if(n.length!==this.channels)throw new Error(`pad: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let f=0;f<n.length;f++)n[f]===0&&(n[f]=.001)}else n=newArray$1(this.channels,null);Array.isArray(t)||(t=[t,t]);let a=this.width+t[0]*2,s=this.height+t[1]*2,o=this.channels,l=Image.createFrom(this,{width:a,height:s});copyImage(this,l,t[0],t[1]);for(let f=t[0];f<a-t[0];f++)for(let h=0;h<o;h++){let c=n[h]||l.data[(t[1]*a+f)*o+h];for(let u=0;u<t[1];u++)l.data[(u*a+f)*o+h]=c;c=n[h]||l.data[((s-t[1]-1)*a+f)*o+h];for(let u=s-t[1];u<s;u++)l.data[(u*a+f)*o+h]=c}for(let f=0;f<s;f++)for(let h=0;h<o;h++){let c=n[h]||l.data[(f*a+t[0])*o+h];for(let u=0;u<t[0];u++)l.data[(f*a+u)*o+h]=c;c=n[h]||l.data[(f*a+a-t[0]-1)*o+h];for(let u=a-t[0];u<a;u++)l.data[(f*a+u)*o+h]=c}return l}function colorDepth(e=8){if(this.checkProcessable("colorDepth",{bitDepth:[1,8,16]}),![8,16].includes(e))throw Error("You need to specify the new colorDepth as 8 or 16");if(this.bitDepth===e)return this.clone();let t=Image.createFrom(this,{bitDepth:e});switch(e){case 8:if(this.bitDepth===1)for(let r=0;r<this.size;r++)this.getBit(r)&&(t.data[r]=255);else for(let r=0;r<this.data.length;r++)t.data[r]=this.data[r]>>8;break;case 16:if(this.bitDepth===1)for(let r=0;r<this.size;r++)this.getBit(r)&&(t.data[r]=65535);else for(let r=0;r<this.data.length;r++)t.data[r]=this.data[r]<<8|this.data[r];break;default:throw new Error("colorDepth conversion unexpected case")}return t}function rotateFree(e,t={}){const{interpolation:r=validInterpolations.nearestneighbor,width:n=this.width,height:a=this.height}=t;if(typeof e!="number")throw new TypeError("degrees must be a number");const s=checkInterpolation(r),o=e*Math.PI/180,l=Math.floor(Math.abs(n*Math.cos(o))+Math.abs(a*Math.sin(o))),f=Math.floor(Math.abs(a*Math.cos(o))+Math.abs(n*Math.sin(o))),h=Math.cos(-o),c=Math.sin(-o);let u=l/2,d=f/2;l%2===0?(u=u-.5,f%2===0?d=d-.5:d=Math.floor(d)):(u=Math.floor(u),f%2===0?d=d-.5:d=Math.floor(d));const g=Math.floor(n/2-u),p=Math.floor(a/2-d);if(this.bitDepth===1){const m=new Image(l,f,{kind:"BINARY",parent:this});switch(s){case validInterpolations.nearestneighbor:return rotateBinaryNearestNeighbor(this,m,g,p,u,d,h,c);case validInterpolations.bilinear:return rotateBinaryBilinear(this,m,g,p,u,d,h,c);default:throw new Error(`unsupported rotate interpolation: ${s}`)}}else{const m=Image.createFrom(this,{width:l,height:f});switch(s){case validInterpolations.nearestneighbor:return rotateNearestNeighbor(this,m,g,p,u,d,h,c);case validInterpolations.bilinear:return rotateBilinear(this,m,g,p,u,d,h,c);default:throw new Error(`unsupported rotate interpolation: ${s}`)}}}function rotateNearestNeighbor(e,t,r,n,a,s,o,l){for(let f=0;f<t.width;f+=1)for(let h=0;h<t.height;h+=1)for(let c=0;c<e.channels;c++){let u=Math.round((f-a)*o-(h-s)*l+a)+r,d=Math.round((h-s)*o+(f-a)*l+s)+n;u<0||u>=e.width||d<0||d>=e.height?e.alpha===1&&c===e.channels-1?t.setValueXY(f,h,c,0):t.setValueXY(f,h,c,e.maxValue):t.setValueXY(f,h,c,e.getValueXY(u,d,c))}return t}function rotateBinaryNearestNeighbor(e,t,r,n,a,s,o,l){for(let f=0;f<t.width;f+=1)for(let h=0;h<t.height;h+=1){let c=Math.round((f-a)*o-(h-s)*l+a)+r,u=Math.round((h-s)*o+(f-a)*l+s)+n;(c<0||c>=e.width||u<0||u>=e.height||e.getBitXY(c,u))&&t.setBitXY(f,h)}return t}function rotateBilinear(e,t,r,n,a,s,o,l){let f=e.width*e.channels;for(let h=0;h<t.height;h++)for(let c=0;c<t.width;c++){let u=(c-a)*o-(h-s)*l+a+r,d=(h-s)*o+(c-a)*l+s+n,g=u|0,p=d|0,m=u-g,y=d-p;for(let x=0;x<e.channels;x++)if(u<0||u>=e.width||d<0||d>=e.height)e.alpha===1&&x===e.channels-1?t.setValueXY(c,h,x,0):t.setValueXY(c,h,x,e.maxValue);else{let E=(p*e.width+g)*e.channels+x,_=e.data[E],w=e.data[E+e.channels],M=e.data[E+f],I=e.data[E+f+e.channels],k=_+m*(w-_)+y*(M-_)+m*y*(_-w-M+I)|0;t.setValueXY(c,h,x,k)}}return t}function rotateBinaryBilinear(e,t,r,n,a,s,o,l){let f=e.width;for(let h=0;h<t.height;h++)for(let c=0;c<t.width;c++){let u=(c-a)*o-(h-s)*l+a+r,d=(h-s)*o+(c-a)*l+s+n,g=u|0,p=d|0,m=u-g,y=d-p;if(u<0||u>=e.width||d<0||d>=e.height)t.setBitXY(c,h);else{let x=p*e.width+g,E=e.getBit(x),_=e.getBit(x+1),w=e.getBit(x+f),M=e.getBit(x+1+f);(E|m&_-E|y&w-E|m&y&E-_-w+M)>0&&t.setBitXY(c,h)}}return t}function rotate$1(e,t){if(this.checkProcessable("rotate",{bitDepth:[1,8,16]}),typeof e!="number")throw new TypeError("angle must be a number");switch(e<0&&(e=Math.ceil(-e/360)*360+e),e%360){case 0:return this.clone();case 90:return rotateRight.call(this);case 180:return rotate180.call(this);case 270:return rotateLeft.call(this);default:return rotateFree.call(this,e,t)}}function rotateLeft(){if(this.bitDepth===1){const e=new Image(this.height,this.width,{kind:"BINARY",parent:this}),t=e.height-1;for(let r=0;r<this.height;r++)for(let n=0;n<this.width;n++)this.getBitXY(n,r)&&e.setBitXY(r,t-n);return e}else{const e=Image.createFrom(this,{width:this.height,height:this.width}),t=e.height-1;for(let r=0;r<this.height;r++)for(let n=0;n<this.width;n++)for(let a=0;a<this.channels;a++)e.setValueXY(r,t-n,a,this.getValueXY(n,r,a));return e}}function rotateRight(){if(this.bitDepth===1){const e=new Image(this.height,this.width,{kind:"BINARY",parent:this}),t=e.width-1;for(let r=0;r<this.height;r++)for(let n=0;n<this.width;n++)this.getBitXY(n,r)&&e.setBitXY(t-r,n);return e}else{const e=Image.createFrom(this,{width:this.height,height:this.width}),t=e.width-1;for(let r=0;r<this.height;r++)for(let n=0;n<this.width;n++)for(let a=0;a<this.channels;a++)e.setValueXY(t-r,n,a,this.getValueXY(n,r,a));return e}}function rotate180(){if(this.bitDepth===1){const e=new Image(this.width,this.height,{kind:"BINARY",parent:this}),t=e.width-1,r=e.height-1;for(let n=0;n<this.height;n++)for(let a=0;a<this.width;a++)this.getBitXY(a,n)&&e.setBitXY(t-a,r-n);return e}else{const e=Image.createFrom(this),t=e.width-1,r=e.height-1;for(let n=0;n<this.height;n++)for(let a=0;a<this.width;a++)for(let s=0;s<this.channels;s++)e.setValueXY(t-a,r-n,s,this.getValueXY(a,n,s));return e}}function insert(e,t={}){const r=getImageParameters(e);this.checkProcessable("insert",r);let{x:n=0,y:a=0}=t;const s=getOutputImageOrInPlace(this,t,{copy:!0}),o=Math.min(s.height,a+e.height),l=Math.min(s.width,n+e.width);if(s.bitDepth===1)for(let f=a;f<o;f++)for(let h=n;h<l;h++)e.getBitXY(h-n,f-a)?s.setBitXY(h,f):s.clearBitXY(h,f);else for(let f=a;f<o;f++)for(let h=n;h<l;h++)s.setPixelXY(h,f,e.getPixelXY(h-n,f-a));return s}function setBorder(e={}){let{size:t=0,algorithm:r="copy",color:n}=e;if(this.checkProcessable("setBorder",{bitDepth:[8,16,32,64]}),r==="set"){if(n.length!==this.channels)throw new Error(`setBorder: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let l=0;l<n.length;l++)n[l]===0&&(n[l]=.001)}else n=newArray$1(this.channels,null);Array.isArray(t)||(t=[t,t]);let a=t[0],s=t[1],o=this.channels;for(let l=a;l<this.width-a;l++)for(let f=0;f<o;f++){let h=n[f]||this.data[(l+this.width*s)*o+f];for(let c=0;c<s;c++)this.data[(c*this.width+l)*o+f]=h;h=n[f]||this.data[(l+this.width*(this.height-s-1))*o+f];for(let c=this.height-s;c<this.height;c++)this.data[(c*this.width+l)*o+f]=h}for(let l=0;l<this.height;l++)for(let f=0;f<o;f++){let h=n[f]||this.data[(l*this.width+a)*o+f];for(let c=0;c<a;c++)this.data[(l*this.width+c)*o+f]=h;h=n[f]||this.data[(l*this.width+this.width-a-1)*o+f];for(let c=this.width-a;c<this.width;c++)this.data[(l*this.width+c)*o+f]=h}return this}function split(e={}){let{preserveAlpha:t=!0}=e;if(this.checkProcessable("split",{bitDepth:[8,16]}),this.components===1)return new Stack$3([this.clone()]);let r=new Stack$3,n=this.data;if(this.alpha&&t)for(let a=0;a<this.components;a++){let s=Image.createFrom(this,{components:1,alpha:!0,colorModel:GREY$1}),o=0;for(let l=0;l<n.length;l+=this.channels)s.data[o++]=n[l+a],s.data[o++]=n[l+this.components];r.push(s)}else for(let a=0;a<this.channels;a++){let s=Image.createFrom(this,{components:1,alpha:!1,colorModel:GREY$1}),o=0;for(let l=0;l<n.length;l+=this.channels)s.data[o++]=n[l+a];r.push(s)}return r}function getChannel(e,t={}){let{keepAlpha:r=!1,mergeAlpha:n=!1}=t;r&=this.alpha,n&=this.alpha,this.checkProcessable("getChannel",{bitDepth:[8,16]}),e=validateChannel(this,e);let a=Image.createFrom(this,{components:1,alpha:r,colorModel:GREY$1}),s=0;for(let o=0;o<this.data.length;o+=this.channels)n?a.data[s++]=this.data[o+e]*this.data[o+this.components]/this.maxValue:(a.data[s++]=this.data[o+e],r&&(a.data[s++]=this.data[o+this.components]));return a}function combineChannels(e=defaultCombineMethod,t={}){let{mergeAlpha:r=!1,keepAlpha:n=!1}=t;r&=this.alpha,n&=this.alpha,this.checkProcessable("combineChannels",{bitDepth:[8,16]});let a=Image.createFrom(this,{components:1,alpha:n,colorModel:GREY$1}),s=0;for(let o=0;o<this.size;o++){let l=e(this.getPixel(o));r?a.data[s++]=l*this.data[o*this.channels+this.components]/this.maxValue:(a.data[s++]=l,n&&(a.data[s++]=this.data[o*this.channels+this.components]))}return a}function defaultCombineMethod(e){return(e[0]+e[1]+e[2])/3}function setChannel(e,t){if(this.checkProcessable("setChannel",{bitDepth:[8,16]}),t.checkProcessable("setChannel (image parameter check)",{bitDepth:[this.bitDepth],alpha:[0],components:[1]}),t.width!==this.width||t.height!==this.height)throw new Error("Images must have exactly the same width and height");e=validateChannel(this,e);let r=e;for(let n=0;n<t.data.length;n++)this.data[r]=t.data[n],r+=this.channels;return this}function getSimilarity(e,t={}){let{shift:r=[0,0],average:n,channels:a,defaultAlpha:s,normalize:o,border:l=[0,0]}=t;if(this.checkProcessable("getSimilarity",{bitDepth:[8,16]}),Array.isArray(l)||(l=[l,l]),a=validateArrayOfChannels(this,{channels:a,defaultAlpha:s}),this.bitDepth!==e.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==e.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==e.colorModel)throw new Error("Both images must have the same colorModel");typeof n>"u"&&(n=!0);let f=Math.max(l[0],-r[0]),h=Math.min(this.width-l[0],this.width-r[0]),c=Math.max(l[1],-r[1]),u=Math.min(this.height-l[1],this.height-r[1]),d=newArray$1(a.length,0);for(let g=0;g<a.length;g++){let p=a[g],m=o?this.sum[p]:Math.max(this.sum[p],e.sum[p]),y=o?e.sum[p]:Math.max(this.sum[p],e.sum[p]);if(m!==0&&y!==0)for(let x=f;x<h;x++)for(let E=c;E<u;E++){let _=x*this.multiplierX+E*this.multiplierY+p,w=_+r[0]*this.multiplierX+r[1]*this.multiplierY;d[g]+=Math.min(this.data[_]/m,e.data[w]/y)}}return n?d.reduce((g,p)=>g+p)/d.length:d}function getPixelsGrid(e={}){let{sampling:t=[10,10],painted:r=!1,mask:n}=e;this.checkProcessable("getPixelsGrid",{bitDepth:[8,16],channels:1}),Array.isArray(t)||(t=[t,t]);const a=t[0],s=t[1],o=[],l=[],f=this.width/a,h=this.height/s;let c=Math.floor(f/2);for(let d=0;d<a;d++){let g=Math.floor(h/2);for(let p=0;p<s;p++){let m=Math.round(c),y=Math.round(g);(!n||n.getBitXY(m,y))&&(o.push([m,y]),l.push(this.getPixelXY(m,y))),g+=h}c+=f}const u={xyS:o,zS:l};return r&&(u.painted=this.rgba8().paintPoints(o)),u}function Matrix(e,t,r){const n=new Array(e);for(let a=0;a<e;a++)n[a]=new Array(t);if(r)for(let a=0;a<e;a++)for(let s=0;s<t;s++)n[a][s]=r;return n.width=e,n.height=t,Object.setPrototypeOf(n,Matrix.prototype),n}Matrix.prototype.localMin=function(e,t){let r=this[e][t],n=[e,t];for(let a=Math.max(0,e-1);a<Math.min(this.length,e+2);a++)for(let s=Math.max(0,t-1);s<Math.min(this[0].length,t+2);s++)this[a][s]<r&&(r=this[a][s],n=[a,s]);return{position:n,value:r}};Matrix.prototype.localMax=function(e,t){let r=this[e][t],n=[e,t];for(let a=Math.max(0,e-1);a<Math.min(this.length,e+2);a++)for(let s=Math.max(0,t-1);s<Math.min(this[0].length,t+2);s++)this[a][s]>r&&(r=this[a][s],n=[a,s]);return{position:n,value:r}};Matrix.prototype.localSearch=function(e,t,r){let n=[];for(let a=Math.max(0,e-1);a<Math.min(this.length,e+2);a++)for(let s=Math.max(0,t-1);s<Math.min(this[0].length,t+2);s++)this[a][s]===r&&n.push([a,s]);return n};function getBestMatch(e,t={}){let{border:r}=t;if(this.checkProcessable("getChannel",{bitDepth:[8,16]}),this.bitDepth!==e.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==e.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==e.colorModel)throw new Error("Both images must have the same colorModel");let n=new Matrix(e.width,e.height,-1/0),a=Math.floor(e.width/2),s=Math.floor(e.height/2),o=a,l=s,f=!1;for(;!f;){let h=n.localSearch(a,s,-1/0);for(let u=0;u<h.length;u++){let d=h[u],g=this.getSimilarity(e,{border:r,shift:[o-d[0],l-d[1]]});n[d[0]][d[1]]=g}let c=n.localMax(a,s);c.position[0]!==a||c.position[1]!==s?(a=c.position[0],s=c.position[1]):f=!0}return[a-o,s-l]}function getRow(e,t=0){this.checkProcessable("getRow",{bitDepth:[8,16]}),checkRow(this,e),checkChannel(this,t);let r=new Array(this.width),n=0,a=e*this.width*this.channels+t,s=a+this.width*this.channels;for(let o=a;o<s;o+=this.channels)r[n++]=this.data[o];return r}function getColumn(e,t=0){this.checkProcessable("getColumn",{bitDepth:[8,16]}),checkColumn(this,e),checkChannel(this,t);let r=new Array(this.height),n=0,a=this.width*this.channels;for(let s=t+e*this.channels;s<this.data.length;s+=a)r[n++]=this.data[s];return r}function getMatrix(e={}){let{channel:t}=e;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),t===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");t=0}let r=new Matrix$2(this.height,this.width);for(let n=0;n<this.height;n++)for(let a=0;a<this.width;a++)r.set(n,a,this.getValueXY(a,n,t));return r}function setMatrix(e,t={}){e=new Matrix$2(e);let{channel:r}=t;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),r===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");r=0}if(this.width!==e.columns||this.height!==e.rows)throw new RangeError("The size of the matrix must be equal to the size of the image");for(let n=0;n<this.height;n++)for(let a=0;a<this.width;a++)this.setValueXY(a,n,r,e.get(n,a));return this}function getPixelsArray(){this.checkProcessable("getPixelsArray",{bitDepth:[8,16,32]});let e=new Array(this.size),t=0;for(let r=0;r<this.data.length;r+=this.channels){let n=new Array(this.components);for(let a=0;a<this.components;a++)n[a]=this.data[r+a];e[t++]=n}return e}function getIntersection(e){let t=this,r=t.getClosestCommonParent(e),n=t.getRelativePosition(r,{defaultFurther:!0}),a=getRelativePositionForAllPixels(t,n),s=e.getRelativePosition(r,{defaultFurther:!0}),o=getRelativePositionForAllPixels(e,s),l=getCommonSurface(a,o),f={whitePixelsMask1:[],whitePixelsMask2:[],commonWhitePixels:[]};for(let h=0;h<l.length;h++){let c=l[h],u=[c[0]-n[0],c[1]-n[1]],d=[c[0]-s[0],c[1]-s[1]],g=t.getBitXY(u[0],u[1]),p=e.getBitXY(d[0],d[1]);g===1&&p===1&&f.commonWhitePixels.push(c)}for(let h=0;h<a.length;h++){let c,u;h!==0&&(c=Math.floor(h/t.width),u=h%t.width),t.getBitXY(c,u)===1&&f.whitePixelsMask1.push(a[h])}for(let h=0;h<o.length;h++){let c=0,u=0;h!==0&&(c=Math.floor(h/e.width),u=h%e.width),e.getBitXY(c,u)===1&&f.whitePixelsMask2.push(o[h])}return f}function getRelativePositionForAllPixels(e,t){let r=[];for(let n=0;n<e.height;n++)for(let a=0;a<e.width;a++){let s=[n,a];r.push([s[0]+t[0],s[1]+t[1]])}return r}function getCommonSurface(e,t){let r=0,n=0,a=[];for(;r<e.length&&n<t.length;)e[r][0]===t[n][0]&&e[r][1]===t[n][1]?(a.push(e[r]),r++,n++):e[r][0]<t[n][0]||e[r][0]===t[n][0]&&e[r][1]<t[n][1]?r++:n++;return a}function getClosestCommonParent(e){let t=getDepth(this),r=getDepth(e),n;if(t>=r?n=getFurthestParent(this,t):n=getFurthestParent(e,r),t===0||r===0)return n;let a=this,s=e;for(;t!==r;)if(t>r){if(a=a.parent,a===null)return n;t=t-1}else{if(s=s.parent,s===null)return n;r=r-1}for(;a!==s&&a!==null&&s!==null;)if(a=a.parent,s=s.parent,a===null||s===null)return n;return a!==s?n:a}function getDepth(e){let t=0,r=e;for(;r.parent!=null;)r=r.parent,t++;return t}function getFurthestParent(e,t){let r=e;for(;t>0;)r=r.parent,t=t-1;return r}const defaultOptions$1={lowThreshold:10,highThreshold:30,gaussianBlur:1.1},Gx=[[-1,0,1],[-2,0,2],[-1,0,1]],Gy=[[-1,-2,-1],[0,0,0],[1,2,1]],convOptions={bitDepth:32,mode:"periodic"};function cannyEdgeDetector(e,t){e.checkProcessable("Canny edge detector",{bitDepth:8,channels:1,components:1}),t=Object.assign({},defaultOptions$1,t);const r=e.width,n=e.height,a=e.maxValue,s={sigma:t.gaussianBlur,radius:3},o=e.gaussianFilter(s),l=o.convolution(Gy,convOptions),f=o.convolution(Gx,convOptions),h=f.hypotenuse(l),c=e.constructor,u=new c(r,n,{kind:"GREY",bitDepth:32}),d=new c(r,n,{kind:"GREY",bitDepth:32}),g=new c(r,n,{kind:"GREY"});for(var p=1;p<r-1;p++)for(var m=1;m<n-1;m++){var y=(Math.round(Math.atan2(f.getValueXY(p,m,0),l.getValueXY(p,m,0))*(5/Math.PI))+5)%5;y===0&&(h.getValueXY(p,m,0)<=h.getValueXY(p,m-1,0)||h.getValueXY(p,m,0)<=h.getValueXY(p,m+1,0))||y===1&&(h.getValueXY(p,m,0)<=h.getValueXY(p-1,m+1,0)||h.getValueXY(p,m,0)<=h.getValueXY(p+1,m-1,0))||y===2&&(h.getValueXY(p,m,0)<=h.getValueXY(p-1,m,0)||h.getValueXY(p,m,0)<=h.getValueXY(p+1,m,0))||y===3&&(h.getValueXY(p,m,0)<=h.getValueXY(p-1,m-1,0)||h.getValueXY(p,m,0)<=h.getValueXY(p+1,m+1,0))||u.setValueXY(p,m,0,h.getValueXY(p,m,0))}for(p=0;p<r*n;++p){var x=u.data[p],E=0;x>t.highThreshold&&(E++,g.data[p]=a),x>t.lowThreshold&&E++,d.data[p]=E}var _=[];for(p=1;p<r-1;++p)for(m=1;m<n-1;++m)if(d.getValueXY(p,m,0)===1){e:for(var w=p-1;w<p+2;++w)for(var M=m-1;M<m+2;++M)if(d.getValueXY(w,M,0)===2){_.push([p,m]),g.setValueXY(p,m,0,a);break e}}for(;_.length>0;){var I=[];for(p=0;p<_.length;++p)for(m=-1;m<2;++m)for(w=-1;w<2;++w)if(!(m===0&&w===0)){var k=_[p][0]+m,v=_[p][1]+w;d.getValueXY(k,v,0)===1&&g.getValueXY(k,v,0)===0&&(I.push([k,v]),g.setValueXY(k,v,0,a))}_=I}return g}function cannyEdge(e){return cannyEdgeDetector(this,e)}function extract(e,t={}){let{position:r}=t;if(this.checkProcessable("extract",{bitDepth:[1,8,16]}),!r&&(r=e.getRelativePosition(this),!r))throw new Error("extract : can not extract an image because the relative position can not be determined, try to specify manually the position as an array of 2 elements [x,y].");if(this.bitDepth>1){let n=Image.createFrom(this,{width:e.width,height:e.height,alpha:1,position:r,parent:this});for(let a=0;a<e.width;a++)for(let s=0;s<e.height;s++){for(let o=0;o<this.channels;o++){let l=this.getValueXY(a+r[0],s+r[1],o);n.setValueXY(a,s,o,l)}e.getBitXY(a,s)||n.setValueXY(a,s,this.components,0)}return n}else{let n=Image.createFrom(this,{width:e.width,height:e.height,position:r,parent:this});for(let a=0;a<e.height;a++)for(let s=0;s<e.width;s++)e.getBitXY(s,a)&&this.getBitXY(s+r[0],a+r[1])&&n.setBitXY(s,a);return n}}var fastList={exports:{}};(function(e,t){(function(){function r(a,s,o){this.next=o,o&&(o.prev=this),this.prev=s,s&&(s.next=this),this.data=a}function n(){if(!(this instanceof n))return new n;this._head=null,this._tail=null,this.length=0}n.prototype={push:function(a){this._tail=new r(a,this._tail,null),this._head||(this._head=this._tail),this.length++},pop:function(){if(this.length!==0){var a=this._tail;return this._tail=a.prev,a.prev&&(a.prev=this._tail.next=null),this.length--,this.length===1?this._head=this._tail:this.length===0&&(this._head=this._tail=null),a.data}},unshift:function(a){this._head=new r(a,null,this._head),this._tail||(this._tail=this._head),this.length++},shift:function(){if(this.length!==0){var a=this._head;return this._head=a.next,a.next&&(a.next=this._head.prev=null),this.length--,this.length===1?this._tail=this._head:this.length===0&&(this._head=this._tail=null),a.data}},item:function(a){a<0&&(a=this.length+a);for(var s=this._head;a-- >0&&s;)s=s.next;return s?s.data:void 0},slice:function(a,s){if(a||(a=0),s||(s=this.length),s<0&&(s=this.length+s),a<0&&(a=this.length+a),s===a)return[];if(s<a)throw new Error("invalid offset: "+a+","+s+" (length="+this.length+")");for(var o=s-a,l=new Array(o),f=0,h=this._head;a-- >0&&h;)h=h.next;for(;f<o&&h;)l[f++]=h.data,h=h.next;return l},drop:function(){n.call(this)},forEach:function(a,s){for(var o=this._head,l=0,f=this.length;l<f&&o;)a.call(s||this,o.data,l,this),o=o.next,l++},map:function(a,s){var o=new n;return this.forEach(function(l,f,h){o.push(a.call(s||h,l,f,h))}),o},filter:function(a,s){var o=new n;return this.forEach(function(l,f,h){a.call(s||h,l,f,h)&&o.push(l)}),o},reduce:function(a,s,o){var l=0,f=this._head,h=this.length;for(s||(l=1,s=f&&f.data,f=f&&f.next);l<h&&f;)s=a.call(o||this,s,f.data,this),l++,f=f.next;return s}},e.exports=n})()})(fastList);var fastListExports=fastList.exports,LinkedList=getDefaultExportFromCjs(fastListExports);function floodFill(e={}){const{x:t=0,y:r=0,inPlace:n=!0}=e,a=n?this:Image.createFrom(this);if(this.checkProcessable("floodFill",{bitDepth:1}),this.getBitXY(t,r))return a;const o=new LinkedList;for(o.push(new Node(t,r));o.length>0;){const l=o.shift();a.setBitXY(l.x,l.y);for(let f=l.x+1;f<this.width&&(!a.getBitXY(f,l.y)&&!this.getBitXY(f,l.y));f++)a.setBitXY(f,l.y),l.y+1<this.height&&!this.getBitXY(f,l.y+1)&&o.push(new Node(f,l.y+1)),l.y-1>=0&&!this.getBitXY(f,l.y-1)&&o.push(new Node(f,l.y-1));for(let f=l.x-1;f>=0&&(!a.getBitXY(f,l.y)&&!this.getBitXY(f,l.y));f++)a.setBitXY(f,l.y),l.y+1<this.height&&!this.getBitXY(f,l.y+1)&&o.push(new Node(f,l.y+1)),l.y-1>=0&&!this.getBitXY(f,l.y-1)&&o.push(new Node(f,l.y-1))}return a}function Node(e,t){this.x=e,this.y=t}function _extends(){return _extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_extends.apply(this,arguments)}function hsv2rgb(e,t,r){t=t/100,r=r/100;var n=[],a=r*t,s=e/60,o=a*(1-Math.abs(s%2-1)),l=r-a;return s>=0&&s<1?n=[a,o,0]:s>=1&&s<2?n=[o,a,0]:s>=2&&s<3?n=[0,a,o]:e>=3&&s<4?n=[0,o,a]:e>=4&&s<5?n=[o,0,a]:e>=5&&s<=6?n=[a,0,o]:n=[0,0,0],{r:Math.round(255*(n[0]+l)),g:Math.round(255*(n[1]+l)),b:Math.round(255*(n[2]+l))}}function hsl2hsv(e,t,r){return t*=(r<50?r:100-r)/100,{h:e,s:2*t/(r+t)*100,v:r+t}}function hsl2rgb$1(e,t,r){var n=hsl2hsv(e,t,r);return hsv2rgb(n.h,n.s,n.v)}var colors={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]};function parse(e){return named(e)||hex3(e)||hex6(e)||rgb(e)||rgba$1(e)||hsl(e)||hsla(e)}function named(e){var t=colors[e.toLowerCase()];if(t)return{r:t[0],g:t[1],b:t[2],a:100}}function rgb(e){var t=e.match(/rgb\(([^)]+)\)/);if(t){var r=t[1].split(/ *, */).map(Number);return{r:r[0],g:r[1],b:r[2],a:100}}}function rgba$1(e){var t=e.match(/rgba\(([^)]+)\)/);if(t){var r=t[1].split(/ *, */).map(Number);return{r:r[0],g:r[1],b:r[2],a:r[3]*100}}}function hex6(e){if(e[0]==="#"&&e.length===7)return{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16),a:100}}function hex3(e){if(e[0]==="#"&&e.length===4)return{r:parseInt(e[1]+e[1],16),g:parseInt(e[2]+e[2],16),b:parseInt(e[3]+e[3],16),a:100}}function hsl(e){var t=e.match(/hsl\(([^)]+)\)/);if(t){var r=t[1].split(/ *, */),n=parseInt(r[0],10),a=parseInt(r[1],10),s=parseInt(r[2],10),o=hsl2rgb$1(n,a,s);return _extends({},o,{a:100})}}function hsla(e){var t=e.match(/hsla\(([^)]+)\)/);if(t){var r=t[1].split(/ *, */),n=parseInt(r[0],10),a=parseInt(r[1],10),s=parseInt(r[2],10),o=parseInt(parseFloat(r[3])*100,10),l=hsl2rgb$1(n,a,s);return _extends({},l,{a:o})}}function css2array(e){let t=parse(e);return[t.r,t.g,t.b,Math.round(t.a*255/100)]}function hue2rgb(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function hsl2rgb(e,t,r){let n,a,s,o,l,f;return t/=100,r/=100,t===0?o=l=f=r*255:(r<=.5?a=r*(t+1):a=r+t-r*t,n=r*2-a,s=e/360,o=hue2rgb(n,a,s+1/3),l=hue2rgb(n,a,s),f=hue2rgb(n,a,s-1/3)),{r:o,g:l,b:f}}function getDistinctColors(e){let t=new Array(e),r=0;for(let n=0;n<360;n+=360/e){r++;let a=hsl2rgb(n,100,30+r%4*15);t[r-1]=[Math.round(a.r*255),Math.round(a.g*255),Math.round(a.b*255)]}return t}function getRandomColor(){return[Math.floor(Math.random()*256),Math.floor(Math.random()*256),Math.floor(Math.random()*256)]}function getColors(e){let{color:t,colors:r,randomColors:n,numberColors:a=50}=e;if(t&&!Array.isArray(t)&&(t=css2array(t)),t)return[t];if(r)return r=r.map(function(s){return Array.isArray(s)?s:css2array(s)}),r;if(n){r=new Array(a);for(let s=0;s<a;s++)r[s]=getRandomColor()}return getDistinctColors(a)}function paintLabels(e,t,r={}){let{color:n="blue",colors:a,font:s="12px Helvetica",rotate:o=0}=r;if(this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1}),!Array.isArray(e))throw Error("paintLabels: labels must be an array");if(!Array.isArray(t))throw Error("paintLabels: positions must be an array");if(n&&!Array.isArray(n)&&(n=css2array(n)),a?a=a.map(function(h){return Array.isArray(h)?h:css2array(h)}):a=[n],e.length!==t.length)throw Error("paintLabels: positions and labels must be arrays from the same size");Array.isArray(s)||(s=[s]),Array.isArray(o)||(o=[o]);let f=this.getCanvas().getContext("2d");for(let h=0;h<e.length;h++){f.save();let c=a[h%a.length];f.fillStyle=`rgba(${c[0]},${c[1]},${c[2]},${c[3]/this.maxValue})`,f.font=s[h%s.length];let u=t[h];f.translate(u[0],u[1]),f.rotate(o[h%o.length]/180*Math.PI),f.fillText(e[h],0,0),f.restore()}return this.data=Uint8Array.from(f.getImageData(0,0,this.width,this.height).data),this}function paintMasks(e,t={}){let{alpha:r=255,labels:n=[],labelsPosition:a=[],labelColor:s="blue",labelFont:o="12px Helvetica"}=t;this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1});let l=getColors(Object.assign({},t,{numberColors:e.length}));Array.isArray(e)||(e=[e]);for(let f=0;f<e.length;f++){let h=e[f],c=l[f%l.length];for(let u=0;u<h.width;u++)for(let d=0;d<h.height;d++)if(h.getBitXY(u,d))for(let g=0;g<Math.min(this.components,c.length);g++)if(r===255)this.setValueXY(u+h.position[0],d+h.position[1],g,c[g]);else{let p=this.getValueXY(u+h.position[0],d+h.position[1],g);p=Math.round((p*(255-r)+c[g]*r)/255),this.setValueXY(u+h.position[0],d+h.position[1],g,p)}}if(Array.isArray(n)&&n.length>0){let h=this.getCanvas().getContext("2d");h.fillStyle=s,h.font=o;for(let c=0;c<Math.min(e.length,n.length);c++){let u=a[c]?a[c]:e[c].position;h.fillText(n[c],u[0],u[1])}this.data=Uint8Array.from(h.getImageData(0,0,this.width,this.height).data)}return this}function zerosMatrix(e,t){let r=new Array(e);for(let n=0;n<e;n++)r[n]=new Array(t).fill(0);return r}const cross=[[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]],smallCross=[[0,1,0],[1,1,1],[0,1,0]];class Shape{constructor(t={}){let{kind:r="cross",shape:n,size:a,width:s,height:o,filled:l=!0}=t;if(a&&(s=a,o=a),n)switch(n.toLowerCase()){case"square":case"rectangle":this.matrix=rectangle(s,o,{filled:l});break;case"circle":case"ellipse":this.matrix=ellipse(s,o,{filled:l});break;case"triangle":this.matrix=triangle(s,o,{filled:l});break;default:throw new Error(`Shape: unexpected shape: ${n}`)}else if(r)switch(r.toLowerCase()){case"cross":this.matrix=cross;break;case"smallcross":this.matrix=smallCross;break;default:throw new Error(`Shape: unexpected kind: ${r}`)}else throw new Error("Shape: expected a kind or a shape option");this.height=this.matrix.length,this.width=this.matrix[0].length,this.halfHeight=this.height/2>>0,this.halfWidth=this.width/2>>0}getPoints(){let t=this.matrix,r=[];for(let n=0;n<t.length;n++)for(let a=0;a<t[0].length;a++)t[n][a]&&r.push([a-this.halfWidth,n-this.halfHeight]);return r}getMask(){let t=new Image(this.width,this.height,{kind:BINARY});for(let r=0;r<this.matrix.length;r++)for(let n=0;n<this.matrix[0].length;n++)this.matrix[r][n]&&t.setBitXY(n,r);return t}}function rectangle(e,t,r){const n=zerosMatrix(t,e);if(r.filled)for(let a=0;a<t;a++)for(let s=0;s<e;s++)n[a][s]=1;else{for(let a of[0,t-1])for(let s=0;s<e;s++)n[a][s]=1;for(let a=0;a<t;a++)for(let s of[0,e-1])n[a][s]=1}return n}function ellipse(e,t,r){const n=zerosMatrix(t,e);let a=1-t%2,s=1-e%2,o=Math.floor((e-1)/2),l=Math.floor((t-1)/2),f=o*o,h=l*l;if(r.filled)for(let c=0;c<=l;c++){let u=Math.floor(Math.sqrt(f-f*c*c/h));for(let d=o-u;d<=o;d++)n[l-c][d]=1,n[l+c+a][d]=1,n[l-c][e-d-1]=1,n[l+c+a][e-d-1]=1}else{for(let c=0;c<=l;c++){let u=Math.floor(Math.sqrt(f-f*c*c/h)),d=o-u;n[l-c][d]=1,n[l+c+a][d]=1,n[l-c][e-d-1]=1,n[l+c+a][e-d-1]=1}for(let c=0;c<=o;c++){let u=Math.floor(Math.sqrt(h-h*c*c/f)),d=l-u;n[d][o-c]=1,n[d][o+c+s]=1,n[t-d-1][o-c]=1,n[t-d-1][o+c+s]=1}}return n}function triangle(e,t,r){if(!r.filled)throw new Error("Non filled triangle is not implemented");const n=zerosMatrix(t,e);for(let a=0;a<t;a++){let s=Math.floor((1-a/t)*e/2);for(let o=s;o<e-s;o++)n[a][o]=1}return n}function paintPoints(e,t={}){let{shape:r}=t;this.checkProcessable("paintPoints",{bitDepth:[8,16]});let n=getColors(Object.assign({},t,{numberColors:e.length})),a=new Shape(r).getPoints(),s=Math.min(this.channels,n[0].length);for(let o=0;o<e.length;o++){let l=n[o%n.length],f=e[o][0],h=e[o][1];for(let c=0;c<a.length;c++){let u=a[c][0],d=a[c][1];if(f+u>=0&&h+d>=0&&f+u<this.width&&h+d<this.height){let g=(f+u+(h+d)*this.width)*this.channels;for(let p=0;p<s;p++)this.data[g+p]=l[p]}}}return this}function paintPolyline(e,t={}){let{color:r=[this.maxValue,0,0],closed:n=!1}=t;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]});let a=Math.min(this.channels,r.length);for(let s=0;s<e.length-1+n;s++){let o=e[s],l=e[(s+1)%e.length],f=l[0]-o[0],h=l[1]-o[1],c=Math.max(Math.abs(f),Math.abs(h)),u=f/c,d=h/c,g=o[0],p=o[1];for(let m=0;m<=c;m++){let y=Math.round(g),x=Math.round(p);if(y>=0&&x>=0&&y<this.width&&x<this.height)if(this.bitDepth===1)this.setBitXY(y,x);else{let E=(y+x*this.width)*this.channels;for(let _=0;_<a;_++)this.data[E+_]=r[_]}g=g+u,p=p+d}}return this}function paintPolylines(e,t={}){let r=Object.assign({},t);this.checkProcessable("paintPolylines",{bitDepth:[8,16]});let n=getColors(Object.assign({},t,{numberColors:e.length}));for(let a=0;a<e.length;a++)r.color=n[a%n.length],this.paintPolyline(e[a],r);return this}function paintPolygon(e,t={}){let{color:r=[this.maxValue,0,0],filled:n=!1}=t;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]}),t.closed=!0;let a=deleteDouble(e);if(n===!1)return this.paintPolyline(e,t);{let s=Array(this.height);for(let o=0;o<this.height;o++){s[o]=[];for(let l=0;l<this.width;l++)s[o].push(0)}for(let o=0;o<a.length;o++){const l=lineBetweenTwoPoints(a[o],a[(o+1)%a.length]);for(let f=0;f<this.height;f++)for(let h=0;h<this.width;h++)isAtTheRightOfTheLine(h,f,l,this.height)&&(s[f][h]=s[f][h]===0?1:0)}for(let o=0;o<this.height;o++)for(let l=0;l<this.width;l++)if(s[o][l]===1)if(this.bitDepth===1)this.setBitXY(l,o);else{let f=Math.min(this.channels,r.length),h=(l+o*this.width)*this.channels;for(let c=0;c<f;c++)this.data[h+c]=r[c]}return this.paintPolyline(e,t)}}function deleteDouble(e){let t=[];for(let r=0;r<e.length;r++)if(!(e[r][0]===e[(r+1)%e.length][0]&&e[r][1]===e[(r+1)%e.length][1])){if(e[r][0]===e[(r-1+e.length)%e.length][0]&&e[r][1]===e[(r-1+e.length)%e.length][1])continue;if(e[(r+1)%e.length][0]===e[(r-1+e.length)%e.length][0]&&e[(r-1+e.length)%e.length][1]===e[(r+1)%e.length][1])continue;t.push(e[r])}return t}function lineBetweenTwoPoints(e,t){if(e[0]===t[0])return{a:0,b:e[0],vertical:!0};{const r=(t[1]-e[1])/(t[0]-e[0]),n=e[1]-r*e[0];return{a:r,b:n,vertical:!1}}}function isAtTheRightOfTheLine(e,t,r,n){if(r.vertical===!0)return r.b<=e;if(r.a===0)return!1;{const a=(t-r.b)/r.a;return a<e&&a>=0&&a<=n}}function paintPolygons(e,t={}){let r=Object.assign({},t);this.checkProcessable("paintPolygons",{bitDepth:[8,16]});let n=getColors(Object.assign({},t,{numberColors:e.length}));for(let a=0;a<e.length;a++)r.color=n[a%n.length],this.paintPolygon(e[a],r);return this}function getHistogram(e={}){let{maxSlots:t=256,channel:r,useAlpha:n=!0}=e;if(this.checkProcessable("getHistogram",{bitDepth:[1,8,16]}),r===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");r=0}return getChannelHistogram.call(this,r,{useAlpha:n,maxSlots:t})}function getHistograms(e={}){const{maxSlots:t=256,useAlpha:r=!0}=e;this.checkProcessable("getHistograms",{bitDepth:[8,16]});let n=new Array(r?this.components:this.channels);for(let a=0;a<n.length;a++)n[a]=getChannelHistogram.call(this,a,{useAlpha:r,maxSlots:t});return n}function getChannelHistogram(e,t){let{useAlpha:r,maxSlots:n}=t;if(this.bitDepth===1){let f=[0,0];for(let h=0;h<this.height;h++)for(let c=0;c<this.width;c++){let u=this.getBitXY(h,c);u===0?f[0]+=1:u===1&&(f[1]+=1)}return f}let a=Math.log2(n);if(!isInteger$1(a))throw new RangeError("maxSlots must be a power of 2, for example: 64, 256, 1024");let s=0;this.bitDepth>a&&(s=this.bitDepth-a);let o=this.data,l=newArray$1(Math.pow(2,Math.min(this.bitDepth,a)),0);if(r&&this.alpha){let f=this.channels-e-1;for(let h=e;h<o.length;h+=this.channels)l[o[h]>>s]+=o[h+f]/this.maxValue}else for(let f=e;f<o.length;f+=this.channels)l[o[f]>>s]++;return l}function getColorHistogram(e={}){let{useAlpha:t=!0,nbSlots:r=512}=e;this.checkProcessable("getColorHistogram",{bitDepth:[8,16],components:[3]});let n=Math.log(r)/Math.log(8);if(n!==Math.floor(n))throw new RangeError("nbSlots must be a power of 8. Usually 8, 64, 512 or 4096");let a=this.bitDepth-n,s=this.data,o=newArray$1(Math.pow(8,n),0),l=Math.pow(2,n*2),f=Math.pow(2,n);for(let h=0;h<s.length;h+=this.channels){let c=(s[h]>>a)*l+(s[h+1]>>a)*f+(s[h+2]>>a);t&&this.alpha?o[c]+=s[h+this.channels-1]/this.maxValue:o[c]++}return o}function min(){this.checkProcessable("min",{bitDepth:[8,16,32]});let e=newArray$1(this.channels,1/0);for(let t=0;t<this.data.length;t+=this.channels)for(let r=0;r<this.channels;r++)this.data[t+r]<e[r]&&(e[r]=this.data[t+r]);return e}function max(){this.checkProcessable("max",{bitDepth:[8,16,32]});let e=newArray$1(this.channels,-1/0);for(let t=0;t<this.data.length;t+=this.channels)for(let r=0;r<this.channels;r++)this.data[t+r]>e[r]&&(e[r]=this.data[t+r]);return e}function sum(){this.checkProcessable("sum",{bitDepth:[8,16]});let e=newArray$1(this.channels,0);for(let t=0;t<this.data.length;t+=this.channels)for(let r=0;r<this.channels;r++)e[r]+=this.data[t+r];return e}function getMoment(e=0,t=0){this.checkProcessable("getMoment",{bitDepth:[1]});let r=0;for(let n=0;n<this.width;n++)for(let a=0;a<this.height;a++)this.getBitXY(n,a)===1&&(r+=n**e*a**t);return r}function localMaxima(e={}){let{mask:t,region:r=3,removeClosePoints:n=0,invert:a=!1,maxEquals:s=2}=e,o=this;this.checkProcessable("localMaxima",{bitDepth:[8,16],components:1}),r*=4;let l=a?0:1,f=[1,0,-1,0,1,1,-1,-1,2,0,-2,0,2,2,-2,-2],h=[0,1,0,-1,1,-1,1,-1,0,2,0,-2,2,-2,2,-2],c=r<=8?1:2,u=[];for(let d=c;d<o.height-c;d++)for(let g=c;g<o.width-c;g++){if(t&&t.getBitXY(g,d)!==l)continue;let p=0,m=0,y=o.data[g+d*o.width];for(let x=0;x<r;x++)a?o.data[g+f[x]+(d+h[x])*o.width]>y&&p++:o.data[g+f[x]+(d+h[x])*o.width]<y&&p++,o.data[g+f[x]+(d+h[x])*o.width]===y&&m++;p+m===r&&m<=s&&u.push([g,d])}if(n>0)for(let d=0;d<u.length;d++)for(let g=d+1;g<u.length;g++)Math.sqrt(Math.pow(u[d][0]-u[g][0],2)+Math.pow(u[d][1]-u[g][1],2))<n&&(u[d][0]=u[d][0]+u[g][0]>>1,u[d][1]=u[d][1]+u[g][1]>>1,u.splice(g,1),g--);return u}function mean(){let e=this.getHistograms({maxSlots:this.maxValue+1}),t=new Array(e.length);for(let r=0;r<e.length;r++){let n=e[r];t[r]=mean$2(n)}return t}function median(){let e=this.getHistograms({maxSlots:this.maxValue+1}),t=new Array(e.length);for(let r=0;r<e.length;r++){let n=e[r];t[r]=median$2(n)}return t}function points(){this.checkProcessable("points",{bitDepth:[1]});const e=[];for(let t=0;t<this.width;t++)for(let r=0;r<this.height;r++)this.getBitXY(t,r)===1&&e.push([t,r]);return e}function extendedPoints(){this.checkProcessable("extendedPoints",{bitDepth:[1]});const e=[];for(let t=0;t<this.height;t++)for(let r=0;r<this.width;r++)if(this.getBitXY(r,t)===1)for(e.push([r,t]),this.getBitXY(r+1,t)!==1?(e.push([r+1,t]),e.push([r+1,t+1]),this.getBitXY(r,t+1)!==1&&e.push([r,t+1])):this.getBitXY(r,t+1)!==1&&(e.push([r,t+1]),e.push([r+1,t+1]));r<this.width-2&&this.getBitXY(r+1,t)===1&&this.getBitXY(r+2,t)===1;)r++;return e}function getRelativePosition(e,t={}){if(this===e)return[0,0];let r=[0,0],n=this;for(;n;){if(n===e)return r;n.position&&(r[0]+=n.position[0],r[1]+=n.position[1]),n=n.parent}return t.defaultFurther?r:!1}function countAlphaPixels(e={}){let{alpha:t=1}=e;this.checkProcessable("countAlphaPixels",{bitDepth:[8,16],alpha:1});let r=0;if(t!==void 0){for(let n=this.components;n<this.data.length;n+=this.channels)this.data[n]===t&&r++;return r}else return this.size}function monotoneChainConvexHull$1(e,t={}){const{sorted:r}=t;r||(e=e.slice().sort(byXThenY));const n=e.length,a=new Array(n*2);let s=0;for(let l=0;l<n;l++){const f=e[l];for(;s>=2&&cw(a[s-2],a[s-1],f)<=0;)s--;a[s++]=f}const o=s+1;for(let l=n-2;l>=0;l--){const f=e[l];for(;s>=o&&cw(a[s-2],a[s-1],f)<=0;)s--;a[s++]=f}return a.slice(0,s-1)}function cw(e,t,r){return(t[1]-e[1])*(r[0]-e[0])-(t[0]-e[0])*(r[1]-e[1])}function byXThenY(e,t){return e[0]===t[0]?e[1]-t[1]:e[0]-t[0]}function monotoneChainConvexHull(){return monotoneChainConvexHull$1(this.extendedPoints,{sorted:!1})}function round(e){for(let t=0;t<e.length;t++)e[t][0]=Math.round(e[t][0]),e[t][1]=Math.round(e[t][1]);return e}function difference(e,t){return[e[0]-t[0],e[1]-t[1]]}function normalize(e){let t=Math.sqrt(e[0]**2+e[1]**2);return[e[0]/t,e[1]/t]}function rotate(e,t,r){r===void 0&&(r=new Array(t.length));let n=Math.cos(e),a=Math.sin(e);for(let s=0;s<r.length;++s)r[s]=[n*t[s][0]-a*t[s][1],a*t[s][0]+n*t[s][1]];return r}function perimeter(e){let t=0;for(let r=0;r<e.length;r++){let n=e[r][0],a=e[r][1],s=e[r===e.length-1?0:r+1][0],o=e[r===e.length-1?0:r+1][1];t+=Math.sqrt((s-n)**2+(o-a)**2)}return t}function surface(e){let t=0;for(let r=0;r<e.length;r++){let n=e[r][0],a=e[r===e.length-1?0:r+1][1],s=e[r===e.length-1?0:r+1][0],o=e[r][1];t+=n*a*.5,t-=s*o*.5}return Math.abs(t)}function minMax(e){let t=1/0,r=1/0,n=-1/0,a=-1/0;for(let s=0;s<e.length;s++)e[s][0]<t&&(t=e[s][0]),e[s][0]>n&&(n=e[s][0]),e[s][1]<r&&(r=e[s][1]),e[s][1]>a&&(a=e[s][1]);return[[t,r],[n,a]]}function moveToZeroZero(e,t){t===void 0&&(t=new Array(e.length).fill(0).map(()=>[]));let r=minMax(e),n=r[0][0],a=r[0][1];for(let s=0;s<e.length;s++)t[s][0]=e[s][0]-n,t[s][1]=e[s][1]-a;return t}function minimalBoundingRectangle(e={}){const{originalPoints:t=monotoneChainConvexHull.call(this)}=e;if(t.length===0)return[];if(t.length===1)return[t[0],t[0],t[0],t[0]];const r=new Array(t.length);let n=1/0,a=0,s;for(let o=0;o<r.length;o++){let l=getAngle$1(t[o],t[(o+1)%r.length]);rotate(-l,t,r);let f=r[o][0],h=r[o][1],c=r[(o+1)%r.length][0],u=r[(o+1)%r.length][1],d=!0,g=0,p=0,m=0;for(let _=0;_<r.length;_++){let w=r[_][0],M=r[_][1],I=(w-f)/(c-f);d===!0?(d=!1,g=I,p=I):(I<g&&(g=I),I>p&&(p=I));let k=(-(c-f)*M+c*h-u*f)/(c-f);Math.abs(k)>Math.abs(m)&&(m=k)}let y=[f+g*(c-f),h],x=[f+p*(c-f),h],E=Math.abs(m*(g-p)*(c-f));E<n&&(a=l,n=E,s=[y,x,[x[0],x[1]-m],[y[0],y[1]-m]])}return rotate(a,s,s),s}function getAngle$1(e,t){let r=difference(t,e),n=normalize(r),a=Math.acos(n[0]);return n[1]<0?-a:a}function extend$1(e){let t={inPlace:!0};e.extendMethod("invert",invert),e.extendMethod("abs",abs),e.extendMethod("level",level,t),e.extendMethod("add",add,t),e.extendMethod("subtract",subtract,t),e.extendMethod("subtractImage",subtractImage),e.extendMethod("multiply",multiply,t),e.extendMethod("divide",divide,t),e.extendMethod("hypotenuse",hypotenuse),e.extendMethod("background",background$1),e.extendMethod("flipX",flipX),e.extendMethod("flipY",flipY),e.extendMethod("blurFilter",blurFilter),e.extendMethod("medianFilter",medianFilter),e.extendMethod("gaussianFilter",gaussianFilter),e.extendMethod("sobelFilter",sobelFilter),e.extendMethod("gradientFilter",gradientFilter),e.extendMethod("scharrFilter",scharrFilter),e.extendMethod("dilate",dilate),e.extendMethod("erode",erode),e.extendMethod("open",open),e.extendMethod("close",close),e.extendMethod("topHat",topHat),e.extendMethod("blackHat",blackHat),e.extendMethod("morphologicalGradient",morphologicalGradient),e.extendMethod("warpingFourPoints",warpingFourPoints),e.extendMethod("crop",crop),e.extendMethod("cropAlpha",cropAlpha),e.extendMethod("resize",resize).extendMethod("scale",resize),e.extendMethod("hsv",hsv),e.extendMethod("hsl",hsl$1),e.extendMethod("cmyk",cmyk),e.extendMethod("rgba8",rgba8),e.extendMethod("grey",grey).extendMethod("gray",grey),e.extendMethod("mask",mask),e.extendMethod("pad",pad),e.extendMethod("colorDepth",colorDepth),e.extendMethod("setBorder",setBorder,t),e.extendMethod("rotate",rotate$1),e.extendMethod("rotateLeft",rotateLeft),e.extendMethod("rotateRight",rotateRight),e.extendMethod("insert",insert),e.extendMethod("getRow",getRow),e.extendMethod("getColumn",getColumn),e.extendMethod("getMatrix",getMatrix),e.extendMethod("setMatrix",setMatrix),e.extendMethod("getPixelsArray",getPixelsArray),e.extendMethod("getIntersection",getIntersection),e.extendMethod("getClosestCommonParent",getClosestCommonParent),e.extendMethod("getThreshold",getThreshold),e.extendMethod("split",split),e.extendMethod("getChannel",getChannel),e.extendMethod("combineChannels",combineChannels),e.extendMethod("setChannel",setChannel),e.extendMethod("getSimilarity",getSimilarity),e.extendMethod("getPixelsGrid",getPixelsGrid),e.extendMethod("getBestMatch",getBestMatch),e.extendMethod("cannyEdge",cannyEdge),e.extendMethod("convolution",convolution),e.extendMethod("extract",extract),e.extendMethod("floodFill",floodFill),e.extendMethod("paintLabels",paintLabels,t),e.extendMethod("paintMasks",paintMasks,t),e.extendMethod("paintPoints",paintPoints,t),e.extendMethod("paintPolyline",paintPolyline,t),e.extendMethod("paintPolylines",paintPolylines,t),e.extendMethod("paintPolygon",paintPolygon,t),e.extendMethod("paintPolygons",paintPolygons,t),e.extendMethod("countAlphaPixels",countAlphaPixels),e.extendMethod("monotoneChainConvexHull",monotoneChainConvexHull),e.extendMethod("minimalBoundingRectangle",minimalBoundingRectangle),e.extendMethod("getHistogram",getHistogram).extendProperty("histogram",getHistogram),e.extendMethod("getHistograms",getHistograms).extendProperty("histograms",getHistograms),e.extendMethod("getColorHistogram",getColorHistogram).extendProperty("colorHistogram",getColorHistogram),e.extendMethod("getMin",min).extendProperty("min",min),e.extendMethod("getMax",max).extendProperty("max",max),e.extendMethod("getSum",sum).extendProperty("sum",sum),e.extendMethod("getMoment",getMoment).extendProperty("moment",getMoment),e.extendMethod("getLocalMaxima",localMaxima),e.extendMethod("getMedian",median).extendProperty("median",median),e.extendMethod("getMean",mean).extendProperty("mean",mean),e.extendMethod("getPoints",points).extendProperty("points",points),e.extendMethod("getExtendedPoints",extendedPoints).extendProperty("extendedPoints",extendedPoints),e.extendMethod("getRelativePosition",getRelativePosition)}var quantities={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(commonjsGlobal,function(){function r($){return typeof $=="string"||$ instanceof String}var n=Number.isFinite||window.isFinite;function a($){return n($)}function s($){return $}function o($){var C={};return $.filter(function(R){return C.hasOwnProperty(R)?!1:C[R]=!0})}function l($,C){if(C.length!==$.length)return!1;for(var R=0;R<$.length;R++)if(C[R].compareArray&&!C[R].compareArray($[R])||C[R]!==$[R])return!1;return!0}function f($,C){Object.keys(C).forEach(function(R){$[R]=C[R]})}function h(){for(var $=1,C=0,R=0;R<arguments.length;R++){var O=arguments[R];C=C+d(O),$*=O}return C!==0?u($,C):$}function c($,C){if(C===0)throw new Error("Divide by zero");var R=Math.pow(10,d(C)),O=R/(R*C);return h($,O)}function u($,C){return Math.round($*Math.pow(10,C))/Math.pow(10,C)}function d($){if(!isFinite($))return 0;for(var C=0;$%1!==0;)$*=10,C++;return C}function g(){var $;if(!this)return $=Object.create(g.prototype),g.apply($,arguments),$;$=Error.apply(this,arguments),this.name="QtyError",this.message=$.message,this.stack=$.stack}g.prototype=Object.create(Error.prototype,{constructor:{value:g}});function p($,C){throw new g("Incompatible units: "+$+" and "+C)}var m={"<googol>":[["googol"],1e100,"prefix"],"<kibi>":[["Ki","Kibi","kibi"],Math.pow(2,10),"prefix"],"<mebi>":[["Mi","Mebi","mebi"],Math.pow(2,20),"prefix"],"<gibi>":[["Gi","Gibi","gibi"],Math.pow(2,30),"prefix"],"<tebi>":[["Ti","Tebi","tebi"],Math.pow(2,40),"prefix"],"<pebi>":[["Pi","Pebi","pebi"],Math.pow(2,50),"prefix"],"<exi>":[["Ei","Exi","exi"],Math.pow(2,60),"prefix"],"<zebi>":[["Zi","Zebi","zebi"],Math.pow(2,70),"prefix"],"<yebi>":[["Yi","Yebi","yebi"],Math.pow(2,80),"prefix"],"<yotta>":[["Y","Yotta","yotta"],1e24,"prefix"],"<zetta>":[["Z","Zetta","zetta"],1e21,"prefix"],"<exa>":[["E","Exa","exa"],1e18,"prefix"],"<peta>":[["P","Peta","peta"],1e15,"prefix"],"<tera>":[["T","Tera","tera"],1e12,"prefix"],"<giga>":[["G","Giga","giga"],1e9,"prefix"],"<mega>":[["M","Mega","mega"],1e6,"prefix"],"<kilo>":[["k","kilo"],1e3,"prefix"],"<hecto>":[["h","Hecto","hecto"],100,"prefix"],"<deca>":[["da","Deca","deca","deka"],10,"prefix"],"<deci>":[["d","Deci","deci"],.1,"prefix"],"<centi>":[["c","Centi","centi"],.01,"prefix"],"<milli>":[["m","Milli","milli"],.001,"prefix"],"<micro>":[["u","","","Micro","mc","micro"],1e-6,"prefix"],"<nano>":[["n","Nano","nano"],1e-9,"prefix"],"<pico>":[["p","Pico","pico"],1e-12,"prefix"],"<femto>":[["f","Femto","femto"],1e-15,"prefix"],"<atto>":[["a","Atto","atto"],1e-18,"prefix"],"<zepto>":[["z","Zepto","zepto"],1e-21,"prefix"],"<yocto>":[["y","Yocto","yocto"],1e-24,"prefix"],"<1>":[["1","<1>"],1,""],"<meter>":[["m","meter","meters","metre","metres"],1,"length",["<meter>"]],"<inch>":[["in","inch","inches",'"'],.0254,"length",["<meter>"]],"<foot>":[["ft","foot","feet","'"],.3048,"length",["<meter>"]],"<yard>":[["yd","yard","yards"],.9144,"length",["<meter>"]],"<mile>":[["mi","mile","miles"],1609.344,"length",["<meter>"]],"<naut-mile>":[["nmi","naut-mile"],1852,"length",["<meter>"]],"<league>":[["league","leagues"],4828,"length",["<meter>"]],"<furlong>":[["furlong","furlongs"],201.2,"length",["<meter>"]],"<rod>":[["rd","rod","rods"],5.029,"length",["<meter>"]],"<mil>":[["mil","mils"],254e-7,"length",["<meter>"]],"<angstrom>":[["ang","angstrom","angstroms"],1e-10,"length",["<meter>"]],"<fathom>":[["fathom","fathoms"],1.829,"length",["<meter>"]],"<pica>":[["pica","picas"],.00423333333,"length",["<meter>"]],"<point>":[["pt","point","points"],.000352777778,"length",["<meter>"]],"<redshift>":[["z","red-shift","redshift"],1302773e20,"length",["<meter>"]],"<AU>":[["AU","astronomical-unit"],1495979e5,"length",["<meter>"]],"<light-second>":[["ls","light-second"],299792500,"length",["<meter>"]],"<light-minute>":[["lmin","light-minute"],1798755e4,"length",["<meter>"]],"<light-year>":[["ly","light-year"],9460528e9,"length",["<meter>"]],"<parsec>":[["pc","parsec","parsecs"],3085678e10,"length",["<meter>"]],"<datamile>":[["DM","datamile"],1828.8,"length",["<meter>"]],"<kilogram>":[["kg","kilogram","kilograms"],1,"mass",["<kilogram>"]],"<AMU>":[["u","AMU","amu"],1660538921e-36,"mass",["<kilogram>"]],"<dalton>":[["Da","Dalton","Daltons","dalton","daltons"],1660538921e-36,"mass",["<kilogram>"]],"<slug>":[["slug","slugs"],14.5939029,"mass",["<kilogram>"]],"<short-ton>":[["tn","ton","short-ton"],907.18474,"mass",["<kilogram>"]],"<metric-ton>":[["tonne","metric-ton"],1e3,"mass",["<kilogram>"]],"<carat>":[["ct","carat","carats"],2e-4,"mass",["<kilogram>"]],"<pound>":[["lbs","lb","pound","pounds","#"],.45359237,"mass",["<kilogram>"]],"<ounce>":[["oz","ounce","ounces"],.0283495231,"mass",["<kilogram>"]],"<gram>":[["g","gram","grams","gramme","grammes"],.001,"mass",["<kilogram>"]],"<grain>":[["grain","grains","gr"],6479891e-11,"mass",["<kilogram>"]],"<dram>":[["dram","drams","dr"],.0017718452,"mass",["<kilogram>"]],"<stone>":[["stone","stones","st"],6.35029318,"mass",["<kilogram>"]],"<hectare>":[["hectare"],1e4,"area",["<meter>","<meter>"]],"<acre>":[["acre","acres"],4046.85642,"area",["<meter>","<meter>"]],"<sqft>":[["sqft"],1,"area",["<foot>","<foot>"]],"<liter>":[["l","L","liter","liters","litre","litres"],.001,"volume",["<meter>","<meter>","<meter>"]],"<gallon>":[["gal","gallon","gallons"],.0037854118,"volume",["<meter>","<meter>","<meter>"]],"<gallon-imp>":[["galimp","gallon-imp","gallons-imp"],.00454609,"volume",["<meter>","<meter>","<meter>"]],"<quart>":[["qt","quart","quarts"],.00094635295,"volume",["<meter>","<meter>","<meter>"]],"<pint>":[["pt","pint","pints"],.000473176475,"volume",["<meter>","<meter>","<meter>"]],"<pint-imp>":[["ptimp","pint-imp","pints-imp"],.00056826125,"volume",["<meter>","<meter>","<meter>"]],"<cup>":[["cu","cup","cups"],.000236588238,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce>":[["floz","fluid-ounce","fluid-ounces"],295735297e-13,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce-imp>":[["flozimp","floz-imp","fluid-ounce-imp","fluid-ounces-imp"],284130625e-13,"volume",["<meter>","<meter>","<meter>"]],"<tablespoon>":[["tb","tbsp","tbs","tablespoon","tablespoons"],147867648e-13,"volume",["<meter>","<meter>","<meter>"]],"<teaspoon>":[["tsp","teaspoon","teaspoons"],492892161e-14,"volume",["<meter>","<meter>","<meter>"]],"<bushel>":[["bu","bsh","bushel","bushels"],.035239072,"volume",["<meter>","<meter>","<meter>"]],"<oilbarrel>":[["bbl","oilbarrel","oilbarrels","oil-barrel","oil-barrels"],.158987294928,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel>":[["bl","bl-us","beerbarrel","beerbarrels","beer-barrel","beer-barrels"],.1173477658,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel-imp>":[["blimp","bl-imp","beerbarrel-imp","beerbarrels-imp","beer-barrel-imp","beer-barrels-imp"],.16365924,"volume",["<meter>","<meter>","<meter>"]],"<kph>":[["kph"],.277777778,"speed",["<meter>"],["<second>"]],"<mph>":[["mph"],.44704,"speed",["<meter>"],["<second>"]],"<knot>":[["kt","kn","kts","knot","knots"],.514444444,"speed",["<meter>"],["<second>"]],"<fps>":[["fps"],.3048,"speed",["<meter>"],["<second>"]],"<gee>":[["gee"],9.80665,"acceleration",["<meter>"],["<second>","<second>"]],"<Gal>":[["Gal"],.01,"acceleration",["<meter>"],["<second>","<second>"]],"<kelvin>":[["degK","kelvin"],1,"temperature",["<kelvin>"]],"<celsius>":[["degC","celsius","celsius","centigrade"],1,"temperature",["<kelvin>"]],"<fahrenheit>":[["degF","fahrenheit"],5/9,"temperature",["<kelvin>"]],"<rankine>":[["degR","rankine"],5/9,"temperature",["<kelvin>"]],"<temp-K>":[["tempK","temp-K"],1,"temperature",["<temp-K>"]],"<temp-C>":[["tempC","temp-C"],1,"temperature",["<temp-K>"]],"<temp-F>":[["tempF","temp-F"],5/9,"temperature",["<temp-K>"]],"<temp-R>":[["tempR","temp-R"],5/9,"temperature",["<temp-K>"]],"<second>":[["s","sec","secs","second","seconds"],1,"time",["<second>"]],"<minute>":[["min","mins","minute","minutes"],60,"time",["<second>"]],"<hour>":[["h","hr","hrs","hour","hours"],3600,"time",["<second>"]],"<day>":[["d","day","days"],3600*24,"time",["<second>"]],"<week>":[["wk","week","weeks"],7*3600*24,"time",["<second>"]],"<fortnight>":[["fortnight","fortnights"],1209600,"time",["<second>"]],"<year>":[["y","yr","year","years","annum"],31556926,"time",["<second>"]],"<decade>":[["decade","decades"],315569260,"time",["<second>"]],"<century>":[["century","centuries"],3155692600,"time",["<second>"]],"<pascal>":[["Pa","pascal","Pascal"],1,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<bar>":[["bar","bars"],1e5,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<mmHg>":[["mmHg"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inHg>":[["inHg"],3386.3881472,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<torr>":[["torr"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<atm>":[["atm","ATM","atmosphere","atmospheres"],101325,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<psi>":[["psi"],6894.76,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<cmh2o>":[["cmH2O","cmh2o"],98.0638,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inh2o>":[["inH2O","inh2o"],249.082052,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<poise>":[["P","poise"],.1,"viscosity",["<kilogram>"],["<meter>","<second>"]],"<stokes>":[["St","stokes"],1e-4,"viscosity",["<meter>","<meter>"],["<second>"]],"<mole>":[["mol","mole"],1,"substance",["<mole>"]],"<molar>":[["M","molar"],1e3,"concentration",["<mole>"],["<meter>","<meter>","<meter>"]],"<wtpercent>":[["wt%","wtpercent"],10,"concentration",["<kilogram>"],["<meter>","<meter>","<meter>"]],"<katal>":[["kat","katal","Katal"],1,"activity",["<mole>"],["<second>"]],"<unit>":[["U","enzUnit","unit"],16667e-19,"activity",["<mole>"],["<second>"]],"<farad>":[["F","farad","Farad"],1,"capacitance",["<second>","<second>","<second>","<second>","<ampere>","<ampere>"],["<meter>","<meter>","<kilogram>"]],"<coulomb>":[["C","coulomb","Coulomb"],1,"charge",["<ampere>","<second>"]],"<Ah>":[["Ah"],3600,"charge",["<ampere>","<second>"]],"<ampere>":[["A","Ampere","ampere","amp","amps"],1,"current",["<ampere>"]],"<siemens>":[["S","Siemens","siemens"],1,"conductance",["<second>","<second>","<second>","<ampere>","<ampere>"],["<kilogram>","<meter>","<meter>"]],"<henry>":[["H","Henry","henry"],1,"inductance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>","<ampere>"]],"<volt>":[["V","Volt","volt","volts"],1,"potential",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>"]],"<ohm>":[["Ohm","ohm","",""],1,"resistance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>","<ampere>"]],"<weber>":[["Wb","weber","webers"],1,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<tesla>":[["T","tesla","teslas"],1,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<gauss>":[["G","gauss"],1e-4,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<maxwell>":[["Mx","maxwell","maxwells"],1e-8,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<oersted>":[["Oe","oersted","oersteds"],250/Math.PI,"magnetism",["<ampere>"],["<meter>"]],"<joule>":[["J","joule","Joule","joules"],1,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<erg>":[["erg","ergs"],1e-7,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<btu>":[["BTU","btu","BTUs"],1055.056,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<calorie>":[["cal","calorie","calories"],4.184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Calorie>":[["Cal","Calorie","Calories"],4184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<therm-US>":[["th","therm","therms","Therm","therm-US"],105480400,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Wh>":[["Wh"],3600,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<newton>":[["N","Newton","newton"],1,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<dyne>":[["dyn","dyne"],1e-5,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<pound-force>":[["lbf","pound-force"],4.448222,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<hertz>":[["Hz","hertz","Hertz"],1,"frequency",["<1>"],["<second>"]],"<radian>":[["rad","radian","radians"],1,"angle",["<radian>"]],"<degree>":[["deg","degree","degrees"],Math.PI/180,"angle",["<radian>"]],"<gradian>":[["gon","grad","gradian","grads"],Math.PI/200,"angle",["<radian>"]],"<steradian>":[["sr","steradian","steradians"],1,"solid_angle",["<steradian>"]],"<rotation>":[["rotation"],2*Math.PI,"angle",["<radian>"]],"<rpm>":[["rpm"],2*Math.PI/60,"angular_velocity",["<radian>"],["<second>"]],"<byte>":[["B","byte","bytes"],1,"information",["<byte>"]],"<bit>":[["b","bit","bits"],.125,"information",["<byte>"]],"<Bps>":[["Bps"],1,"information_rate",["<byte>"],["<second>"]],"<bps>":[["bps"],.125,"information_rate",["<byte>"],["<second>"]],"<dollar>":[["USD","dollar"],1,"currency",["<dollar>"]],"<cents>":[["cents"],.01,"currency",["<dollar>"]],"<candela>":[["cd","candela"],1,"luminosity",["<candela>"]],"<lumen>":[["lm","lumen"],1,"luminous_power",["<candela>","<steradian>"]],"<lux>":[["lux"],1,"illuminance",["<candela>","<steradian>"],["<meter>","<meter>"]],"<watt>":[["W","watt","watts"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere>":[["VA","volt-ampere"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere-reactive>":[["var","Var","VAr","VAR","volt-ampere-reactive"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<horsepower>":[["hp","horsepower"],745.699872,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<gray>":[["Gy","gray","grays"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<roentgen>":[["R","roentgen"],.00933,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<sievert>":[["Sv","sievert","sieverts"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<becquerel>":[["Bq","becquerel","becquerels"],1,"radiation",["<1>"],["<second>"]],"<curie>":[["Ci","curie","curies"],37e9,"radiation",["<1>"],["<second>"]],"<cpm>":[["cpm"],1/60,"rate",["<count>"],["<second>"]],"<dpm>":[["dpm"],1/60,"rate",["<count>"],["<second>"]],"<bpm>":[["bpm"],1/60,"rate",["<count>"],["<second>"]],"<dot>":[["dot","dots"],1,"resolution",["<each>"]],"<pixel>":[["pixel","px"],1,"resolution",["<each>"]],"<ppi>":[["ppi"],1,"resolution",["<pixel>"],["<inch>"]],"<dpi>":[["dpi"],1,"typography",["<dot>"],["<inch>"]],"<cell>":[["cells","cell"],1,"counting",["<each>"]],"<each>":[["each"],1,"counting",["<each>"]],"<count>":[["count"],1,"counting",["<each>"]],"<base-pair>":[["bp","base-pair"],1,"counting",["<each>"]],"<nucleotide>":[["nt","nucleotide"],1,"counting",["<each>"]],"<molecule>":[["molecule","molecules"],1,"counting",["<1>"]],"<dozen>":[["doz","dz","dozen"],12,"prefix_only",["<each>"]],"<percent>":[["%","percent"],.01,"prefix_only",["<1>"]],"<ppm>":[["ppm"],1e-6,"prefix_only",["<1>"]],"<ppt>":[["ppt"],1e-9,"prefix_only",["<1>"]],"<gross>":[["gr","gross"],144,"prefix_only",["<dozen>","<dozen>"]],"<decibel>":[["dB","decibel","decibels"],1,"logarithmic",["<decibel>"]]},y=["<meter>","<kilogram>","<second>","<mole>","<ampere>","<radian>","<kelvin>","<temp-K>","<byte>","<dollar>","<candela>","<each>","<steradian>","<decibel>"],x="<1>",E=[x];function _($,C){var R=C[1],O=C[3]||[],H=C[4]||[];if(!a(R))throw new g($+": Invalid unit definition. 'scalar' must be a number");O.forEach(function(Q){if(m[Q]===void 0)throw new g($+": Invalid unit definition. Unit "+Q+" in 'numerator' is not recognized")}),H.forEach(function(Q){if(m[Q]===void 0)throw new g($+": Invalid unit definition. Unit "+Q+" in 'denominator' is not recognized")})}var w={},M={},I={},k={},v={};for(var S in m)if(m.hasOwnProperty(S)){var b=m[S];if(b[2]==="prefix"){w[S]=b[1];for(var A=0;A<b[0].length;A++)M[b[0][A]]=S}else{_(S,b),I[S]={scalar:b[1],numerator:b[3],denominator:b[4]};for(var T=0;T<b[0].length;T++)k[b[0][T]]=S}v[S]=b[0][0]}function D($){var C,R=[],O=Object.keys(m);if(typeof $>"u")for(C=0;C<O.length;C++)["","prefix"].indexOf(m[O[C]][2])===-1&&R.push(O[C].substr(1,O[C].length-2));else{if(this.getKinds().indexOf($)===-1)throw new g("Kind not recognized");for(C=0;C<O.length;C++)m[O[C]][2]===$&&R.push(O[C].substr(1,O[C].length-2))}return R.sort(function(H,Q){return H.toLowerCase()<Q.toLowerCase()?-1:H.toLowerCase()>Q.toLowerCase()?1:0})}function P($){if(!k[$])throw new g("Unit not recognized");return m[k[$]][0]}var F=["length","time","temperature","mass","current","substance","luminosity","currency","information","angle"];function V(){if(this.signature)return this.signature;for(var $=q.call(this),C=0;C<$.length;C++)$[C]*=Math.pow(20,C);return $.reduce(function(R,O){return R+O},0)}function q(){if(!this.isBase())return q.call(this.toBase());for(var $=new Array(F.length),C=0;C<$.length;C++)$[C]=0;for(var R,O,H=0;H<this.numerator.length;H++)(R=m[this.numerator[H]])&&(O=F.indexOf(R[2]),O>=0&&($[O]=$[O]+1));for(var Q=0;Q<this.denominator.length;Q++)(R=m[this.denominator[Q]])&&(O=F.indexOf(R[2]),O>=0&&($[O]=$[O]-1));return $}var Y="[+-]",ee="\\d+",z=Y+"?"+ee,ae="\\."+ee,ie="(?:"+ee+"(?:"+ae+")?)|(?:"+ae+")",j="[Ee]"+z,G="(?:"+ie+")(?:"+j+")?",N=Y+"?\\s*"+G,X="("+N+")?\\s*([^/]*)(?:/(.+))?",J=new RegExp("^"+X+"$"),ge="\\^|\\*{2}",oe="[01234]",ue=new RegExp("([^ \\*\\d]+?)(?:"+ge+")?(-?"+oe+"(?![a-zA-Z]))"),pe=new RegExp("([^ \\*\\d]+?)(?:"+ge+")?("+oe+"(?![a-zA-Z]))");function ve($){r($)||($=$.toString()),$=$.trim();var C=J.exec($);if(!C)throw new g($+": Quantity not recognized");var R=C[1];R?(R=R.replace(/\s/g,""),this.scalar=parseFloat(R)):this.scalar=1;for(var O=C[2],H=C[3],Q,Se,Ae;C=ue.exec(O);){if(Q=parseFloat(C[2]),isNaN(Q))throw new g("Unit exponent is not a number");if(Q===0&&!he.test(C[1]))throw new g("Unit not recognized");Se=C[1]+" ",Ae="";for(var ke=0;ke<Math.abs(Q);ke++)Ae+=Se;Q>=0?O=O.replace(C[0],Ae):(H=H?H+Ae:Ae,O=O.replace(C[0],""))}for(;C=pe.exec(H);){if(Q=parseFloat(C[2]),isNaN(Q))throw new g("Unit exponent is not a number");if(Q===0&&!he.test(C[1]))throw new g("Unit not recognized");Se=C[1]+" ",Ae="";for(var Ce=0;Ce<Q;Ce++)Ae+=Se;H=H.replace(C[0],Ae)}O&&(this.numerator=re(O.trim())),H&&(this.denominator=re(H.trim()))}var me=Object.keys(M).sort(function($,C){return C.length-$.length}).join("|"),K=Object.keys(k).sort(function($,C){return C.length-$.length}).join("|"),U="\\b|$",xe="("+me+")??("+K+")(?:"+U+")",he=new RegExp("^\\s*("+xe+"[\\s\\*]*)+$"),ce=new RegExp(xe,"g"),B={};function re($){var C=B[$];if(C)return C;var R,O=[];if(!he.test($))throw new g("Unit not recognized");for(;R=ce.exec($);)O.push(R.slice(1));return O=O.map(function(H){return M[H[0]]?[M[H[0]],k[H[1]]]:[k[H[1]]]}),O=O.reduce(function(H,Q){return H.concat(Q)},[]),O=O.filter(function(H){return H}),B[$]=O,O}function ne($){if(!r($))throw new g("Argument should be a string");try{return this($)}catch{return null}}function se($){return $ instanceof L}function L($,C){if(Me.apply(null,arguments),!se(this))return new L($,C);if(this.scalar=null,this.baseScalar=null,this.signature=null,this._conversionCache={},this.numerator=E,this.denominator=E,we($)?(this.scalar=$.scalar,this.numerator=$.numerator&&$.numerator.length!==0?$.numerator:E,this.denominator=$.denominator&&$.denominator.length!==0?$.denominator:E):C?(ve.call(this,C),this.scalar=$):ve.call(this,$),this.denominator.join("*").indexOf("temp")>=0)throw new g("Cannot divide with temperatures");if(this.numerator.join("*").indexOf("temp")>=0){if(this.numerator.length>1)throw new g("Cannot multiply by temperatures");if(!l(this.denominator,E))throw new g("Cannot divide with temperatures")}if(this.initValue=$,Z.call(this),this.isTemperature()&&this.baseScalar<0)throw new g("Temperatures must not be less than absolute zero")}L.prototype={constructor:L};function Me($,C){if(C){if(!(a($)&&r(C)))throw new g("Only number accepted as initialization value when units are explicitly provided")}else if(!(r($)||a($)||se($)||we($)))throw new g("Only string, number or quantity accepted as single initialization value")}function we($){return $&&typeof $=="object"&&$.hasOwnProperty("scalar")}function Z(){if(this.baseScalar)return this.baseScalar;if(this.isBase())this.baseScalar=this.scalar,this.signature=V.call(this);else{var $=this.toBase();this.baseScalar=$.scalar,this.signature=$.signature}}var te={"-312078":"elastance","-312058":"resistance","-312038":"inductance","-152058":"potential","-152040":"magnetism","-152038":"magnetism","-7997":"specific_volume","-79":"snap","-59":"jolt","-39":"acceleration","-38":"radiation","-20":"frequency","-19":"speed","-18":"viscosity","-17":"volumetric_flow","-1":"wavenumber",0:"unitless",1:"length",2:"area",3:"volume",20:"time",400:"temperature",7941:"yank",7942:"power",7959:"pressure",7961:"force",7962:"energy",7979:"viscosity",7981:"momentum",7982:"angular_momentum",7997:"density",7998:"area_density",8e3:"mass",152020:"radiation_exposure",159999:"magnetism",16e4:"current",160020:"charge",312058:"conductance",312078:"capacitance",3199980:"activity",3199997:"molar_concentration",32e5:"substance",63999998:"illuminance",64e6:"luminous_power",128e7:"currency","25599999980":"information_rate","25600000000":"information","511999999980":"angular_velocity","512000000000":"angle"};function le(){return o(Object.keys(te).map(function($){return te[$]}))}L.prototype.kind=function(){return te[this.signature.toString()]},f(L.prototype,{isDegrees:function(){return(this.signature===null||this.signature===400)&&this.numerator.length===1&&l(this.denominator,E)&&(this.numerator[0].match(/<temp-[CFRK]>/)||this.numerator[0].match(/<(kelvin|celsius|rankine|fahrenheit)>/))},isTemperature:function(){return this.isDegrees()&&this.numerator[0].match(/<temp-[CFRK]>/)}});function W($,C){var R=$.units(),O=C.to(R),H=L(fe(R));return L({scalar:$.scalar-O.scalar,numerator:H.numerator,denominator:H.denominator})}function de($,C){var R=C.to(fe($.units()));return L({scalar:$.scalar-R.scalar,numerator:$.numerator,denominator:$.denominator})}function be($,C){var R=C.to(fe($.units()));return L({scalar:$.scalar+R.scalar,numerator:$.numerator,denominator:$.denominator})}function fe($){if($==="tempK")return"degK";if($==="tempC")return"degC";if($==="tempF")return"degF";if($==="tempR")return"degR";throw new g("Unknown type for temp conversion from: "+$)}function ye($,C){var R=_e($),O=C.units(),H;if(O==="degK")H=R.scalar;else if(O==="degC")H=R.scalar;else if(O==="degF")H=R.scalar*9/5;else if(O==="degR")H=R.scalar*9/5;else throw new g("Unknown type for degree conversion to: "+O);return L({scalar:H,numerator:C.numerator,denominator:C.denominator})}function _e($){var C=$.units(),R;if(C.match(/(deg)[CFRK]/))R=$.baseScalar;else if(C==="tempK")R=$.scalar;else if(C==="tempC")R=$.scalar;else if(C==="tempF")R=$.scalar*5/9;else if(C==="tempR")R=$.scalar*5/9;else throw new g("Unknown type for temp conversion from: "+C);return L({scalar:R,numerator:["<kelvin>"],denominator:E})}function Ee($,C){var R=C.units(),O;if(R==="tempK")O=$.baseScalar;else if(R==="tempC")O=$.baseScalar-273.15;else if(R==="tempF")O=$.baseScalar*9/5-459.67;else if(R==="tempR")O=$.baseScalar*9/5;else throw new g("Unknown type for temp conversion to: "+R);return L({scalar:O,numerator:C.numerator,denominator:C.denominator})}function Te($){var C=$.units(),R;if(C.match(/(deg)[CFRK]/))R=$.baseScalar;else if(C==="tempK")R=$.scalar;else if(C==="tempC")R=$.scalar+273.15;else if(C==="tempF")R=($.scalar+459.67)*5/9;else if(C==="tempR")R=$.scalar*5/9;else throw new g("Unknown type for temp conversion from: "+C);return L({scalar:R,numerator:["<temp-K>"],denominator:E})}f(L.prototype,{to:function($){var C,R;if($==null)return this;if(!r($))return this.to($.units());if(C=this._conversionCache[$],C)return C;if(R=L($),R.units()===this.units())return this;if(!this.isCompatible(R))this.isInverse(R)?R=this.inverse().to($):p(this.units(),R.units());else if(R.isTemperature())R=Ee(this,R);else if(R.isDegrees())R=ye(this,R);else{var O=c(this.baseScalar,R.baseScalar);R=L({scalar:O,numerator:R.numerator,denominator:R.denominator})}return this._conversionCache[$]=R,R},toBase:function(){if(this.isBase())return this;if(this.isTemperature())return Te(this);var $=Be[this.units()];return $||($=He(this.numerator,this.denominator),Be[this.units()]=$),$.mul(this.scalar)},toFloat:function(){if(this.isUnitless())return this.scalar;throw new g("Can't convert to Float unless unitless.  Use Unit#scalar")},toPrec:function($){if(r($)&&($=L($)),a($)&&($=L($+" "+this.units())),this.isUnitless()?$.isUnitless()||p(this.units(),$.units()):$=$.to(this.units()),$.scalar===0)throw new g("Divide by zero");var C=h(Math.round(this.scalar/$.scalar),$.scalar);return L(C+this.units())}});function $e($,C){var R=L($),O=L(C);if(R.eq(O))return s;var H;return R.isTemperature()?H=function(Q){return R.mul(Q).to(O).scalar}:H=function(Q){return Q*R.baseScalar/O.baseScalar},function(Se){var Ae,ke,Ce;if(Array.isArray(Se)){for(ke=Se.length,Ce=[],Ae=0;Ae<ke;Ae++)Ce.push(H(Se[Ae]));return Ce}else return H(Se)}}var Be={};function He($,C){for(var R=[],O=[],H=1,Q,Se=0;Se<$.length;Se++)Q=$[Se],w[Q]?H=h(H,w[Q]):I[Q]&&(H*=I[Q].scalar,I[Q].numerator&&R.push(I[Q].numerator),I[Q].denominator&&O.push(I[Q].denominator));for(var Ae=0;Ae<C.length;Ae++)Q=C[Ae],w[Q]?H/=w[Q]:I[Q]&&(H/=I[Q].scalar,I[Q].numerator&&O.push(I[Q].numerator),I[Q].denominator&&R.push(I[Q].denominator));return R=R.reduce(function(ke,Ce){return ke.concat(Ce)},[]),O=O.reduce(function(ke,Ce){return ke.concat(Ce)},[]),L({scalar:H,numerator:R,denominator:O})}L.parse=ne,L.getUnits=D,L.getAliases=P,L.mulSafe=h,L.divSafe=c,L.getKinds=le,L.swiftConverter=$e,L.Error=g,f(L.prototype,{add:function($){if(r($)&&($=L($)),this.isCompatible($)||p(this.units(),$.units()),this.isTemperature()&&$.isTemperature())throw new g("Cannot add two temperatures");return this.isTemperature()?be(this,$):$.isTemperature()?be($,this):L({scalar:this.scalar+$.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},sub:function($){if(r($)&&($=L($)),this.isCompatible($)||p(this.units(),$.units()),this.isTemperature()&&$.isTemperature())return W(this,$);if(this.isTemperature())return de(this,$);if($.isTemperature())throw new g("Cannot subtract a temperature from a differential degree unit");return L({scalar:this.scalar-$.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},mul:function($){if(a($))return L({scalar:h(this.scalar,$),numerator:this.numerator,denominator:this.denominator});if(r($)&&($=L($)),(this.isTemperature()||$.isTemperature())&&!(this.isUnitless()||$.isUnitless()))throw new g("Cannot multiply by temperatures");var C=this,R=$;C.isCompatible(R)&&C.signature!==400&&(R=R.to(C));var O=Ve(C.numerator,C.denominator,R.numerator,R.denominator);return L({scalar:h(C.scalar,R.scalar,O[2]),numerator:O[0],denominator:O[1]})},div:function($){if(a($)){if($===0)throw new g("Divide by zero");return L({scalar:this.scalar/$,numerator:this.numerator,denominator:this.denominator})}else r($)&&($=L($));if($.scalar===0)throw new g("Divide by zero");if($.isTemperature())throw new g("Cannot divide with temperatures");if(this.isTemperature()&&!$.isUnitless())throw new g("Cannot divide with temperatures");var C=this,R=$;C.isCompatible(R)&&C.signature!==400&&(R=R.to(C));var O=Ve(C.numerator,C.denominator,R.denominator,R.numerator);return L({scalar:h(C.scalar,O[2])/R.scalar,numerator:O[0],denominator:O[1]})},inverse:function(){if(this.isTemperature())throw new g("Cannot divide with temperatures");if(this.scalar===0)throw new g("Divide by zero");return L({scalar:1/this.scalar,numerator:this.denominator,denominator:this.numerator})}});function Ve($,C,R,O){function H(De){return De!==x}$=$.filter(H),R=R.filter(H),C=C.filter(H),O=O.filter(H);var Q={};function Se(De,Fe){for(var Re,Ue,Ke,Ne=0;Ne<De.length;Ne++)if(w[De[Ne]]?(Re=De[Ne+1],Ue=De[Ne],Ke=w[Ue],Ne++):(Re=De[Ne],Ue=null,Ke=1),Re&&Re!==x)if(Q[Re]){Q[Re][0]+=Fe;var qe=Q[Re][2]?w[Q[Re][2]]:1;Q[Re][Fe===1?3:4]*=c(Ke,qe)}else Q[Re]=[Fe,Re,Ue,1,1]}Se($,1),Se(C,-1),Se(R,1),Se(O,-1);var Ae=[],ke=[],Ce=1;for(var Ze in Q)if(Q.hasOwnProperty(Ze)){var Ie=Q[Ze],Ye;if(Ie[0]>0)for(Ye=0;Ye<Ie[0];Ye++)Ae.push(Ie[2]===null?Ie[1]:[Ie[2],Ie[1]]);else if(Ie[0]<0)for(Ye=0;Ye<-Ie[0];Ye++)ke.push(Ie[2]===null?Ie[1]:[Ie[2],Ie[1]]);Ce*=c(Ie[3],Ie[4])}return Ae.length===0&&(Ae=E),ke.length===0&&(ke=E),Ae=Ae.reduce(function(De,Fe){return De.concat(Fe)},[]),ke=ke.reduce(function(De,Fe){return De.concat(Fe)},[]),[Ae,ke,Ce]}f(L.prototype,{eq:function($){return this.compareTo($)===0},lt:function($){return this.compareTo($)===-1},lte:function($){return this.eq($)||this.lt($)},gt:function($){return this.compareTo($)===1},gte:function($){return this.eq($)||this.gt($)},compareTo:function($){if(r($))return this.compareTo(L($));if(this.isCompatible($)||p(this.units(),$.units()),this.baseScalar<$.baseScalar)return-1;if(this.baseScalar===$.baseScalar)return 0;if(this.baseScalar>$.baseScalar)return 1},same:function($){return this.scalar===$.scalar&&this.units()===$.units()}}),f(L.prototype,{isUnitless:function(){return[this.numerator,this.denominator].every(function($){return l($,E)})},isCompatible:function($){return r($)?this.isCompatible(L($)):se($)&&$.signature!==void 0?this.signature===$.signature:!1},isInverse:function($){return this.inverse().isCompatible($)},isBase:function(){return this._isBase!==void 0?this._isBase:this.isDegrees()&&this.numerator[0].match(/<(kelvin|temp-K)>/)?(this._isBase=!0,this._isBase):(this.numerator.concat(this.denominator).forEach(function($){$!==x&&y.indexOf($)===-1&&(this._isBase=!1)},this),this._isBase===!1?this._isBase:(this._isBase=!0,this._isBase))}});function Pe(){}Pe.prototype.get=function($){return arguments.length>1&&($=Array.apply(null,arguments)),$.reduce(function(C,R,O){if(C){var H=C[R];return O===$.length-1?H?H.data:void 0:H}},this)},Pe.prototype.set=function($,C){return arguments.length>2&&($=Array.prototype.slice.call(arguments,0,-1),C=arguments[arguments.length-1]),$.reduce(function(R,O,H){var Q=R[O];return Q===void 0&&(Q=R[O]={}),H===$.length-1?(Q.data=C,C):Q},this)};function je($,C){return($+" "+C).trim()}L.formatter=je,f(L.prototype,{units:function(){if(this._units!==void 0)return this._units;var $=l(this.numerator,E),C=l(this.denominator,E);if($&&C)return this._units="",this._units;var R=Oe(this.numerator),O=Oe(this.denominator);return this._units=R+(C?"":"/"+O),this._units},toString:function($,C){var R;if(a($))R=this.units(),C=$;else if(r($))R=$;else if(se($))return this.toPrec($).toString(C);var O=this.to(R),H=C!==void 0?u(O.scalar,C):O.scalar;return O=(H+" "+O.units()).trim(),O},format:function($,C){arguments.length===1&&typeof $=="function"&&(C=$,$=void 0),C=C||L.formatter;var R=this.to($);return C.call(this,R.scalar,R.units())}});var Le=new Pe;function Oe($){var C=Le.get($);if(C)return C;var R=l($,E);return R?C="1":C=ze(Ge($)).join("*"),Le.set($,C),C}function Ge($){for(var C=[],R,O,H=0;H<$.length;H++)R=$[H],O=$[H+1],w[R]?(C.push(v[R]+v[O]),H++):C.push(v[R]);return C}function ze($){var C=$.reduce(function(R,O){var H=R[O];return H||R.push(H=R[O]=[O,0]),H[1]++,R},[]);return C.map(function(R){return R[0]+(R[1]>1?R[1]:"")})}return L.version="1.7.6",L})})(quantities);var quantitiesExports=quantities.exports,Qty=getDefaultExportFromCjs(quantitiesExports);function deepValue(e,t=""){let r=t.split(".");for(let n of r){if(e[n]===void 0)return;e=e[n]}return e}var orientation={exports:{}},twoProduct_1=twoProduct$1,SPLITTER=+(Math.pow(2,27)+1);function twoProduct$1(e,t,r){var n=e*t,a=SPLITTER*e,s=a-e,o=a-s,l=e-o,f=SPLITTER*t,h=f-t,c=f-h,u=t-c,d=n-o*c,g=d-l*c,p=g-o*u,m=l*u-p;return r?(r[0]=m,r[1]=n,r):[m,n]}var robustSum=linearExpansionSum;function scalarScalar$1(e,t){var r=e+t,n=r-e,a=r-n,s=t-n,o=e-a,l=o+s;return l?[l,r]:[r]}function linearExpansionSum(e,t){var r=e.length|0,n=t.length|0;if(r===1&&n===1)return scalarScalar$1(e[0],t[0]);var a=r+n,s=new Array(a),o=0,l=0,f=0,h=Math.abs,c=e[l],u=h(c),d=t[f],g=h(d),p,m;u<g?(m=c,l+=1,l<r&&(c=e[l],u=h(c))):(m=d,f+=1,f<n&&(d=t[f],g=h(d))),l<r&&u<g||f>=n?(p=c,l+=1,l<r&&(c=e[l],u=h(c))):(p=d,f+=1,f<n&&(d=t[f],g=h(d)));for(var y=p+m,x=y-p,E=m-x,_=E,w=y,M,I,k,v,S;l<r&&f<n;)u<g?(p=c,l+=1,l<r&&(c=e[l],u=h(c))):(p=d,f+=1,f<n&&(d=t[f],g=h(d))),m=_,y=p+m,x=y-p,E=m-x,E&&(s[o++]=E),M=w+y,I=M-w,k=M-I,v=y-I,S=w-k,_=S+v,w=M;for(;l<r;)p=c,m=_,y=p+m,x=y-p,E=m-x,E&&(s[o++]=E),M=w+y,I=M-w,k=M-I,v=y-I,S=w-k,_=S+v,w=M,l+=1,l<r&&(c=e[l]);for(;f<n;)p=d,m=_,y=p+m,x=y-p,E=m-x,E&&(s[o++]=E),M=w+y,I=M-w,k=M-I,v=y-I,S=w-k,_=S+v,w=M,f+=1,f<n&&(d=t[f]);return _&&(s[o++]=_),w&&(s[o++]=w),o||(s[o++]=0),s.length=o,s}var twoSum$1=fastTwoSum;function fastTwoSum(e,t,r){var n=e+t,a=n-e,s=n-a,o=t-a,l=e-s;return r?(r[0]=l+o,r[1]=n,r):[l+o,n]}var twoProduct=twoProduct_1,twoSum=twoSum$1,robustScale=scaleLinearExpansion;function scaleLinearExpansion(e,t){var r=e.length;if(r===1){var n=twoProduct(e[0],t);return n[0]?n:[n[1]]}var a=new Array(2*r),s=[.1,.1],o=[.1,.1],l=0;twoProduct(e[0],t,s),s[0]&&(a[l++]=s[0]);for(var f=1;f<r;++f){twoProduct(e[f],t,o);var h=s[1];twoSum(h,o[0],s),s[0]&&(a[l++]=s[0]);var c=o[1],u=s[1],d=c+u,g=d-c,p=u-g;s[1]=d,p&&(a[l++]=p)}return s[1]&&(a[l++]=s[1]),l===0&&(a[l++]=0),a.length=l,a}var robustDiff=robustSubtract;function scalarScalar(e,t){var r=e+t,n=r-e,a=r-n,s=t-n,o=e-a,l=o+s;return l?[l,r]:[r]}function robustSubtract(e,t){var r=e.length|0,n=t.length|0;if(r===1&&n===1)return scalarScalar(e[0],-t[0]);var a=r+n,s=new Array(a),o=0,l=0,f=0,h=Math.abs,c=e[l],u=h(c),d=-t[f],g=h(d),p,m;u<g?(m=c,l+=1,l<r&&(c=e[l],u=h(c))):(m=d,f+=1,f<n&&(d=-t[f],g=h(d))),l<r&&u<g||f>=n?(p=c,l+=1,l<r&&(c=e[l],u=h(c))):(p=d,f+=1,f<n&&(d=-t[f],g=h(d)));for(var y=p+m,x=y-p,E=m-x,_=E,w=y,M,I,k,v,S;l<r&&f<n;)u<g?(p=c,l+=1,l<r&&(c=e[l],u=h(c))):(p=d,f+=1,f<n&&(d=-t[f],g=h(d))),m=_,y=p+m,x=y-p,E=m-x,E&&(s[o++]=E),M=w+y,I=M-w,k=M-I,v=y-I,S=w-k,_=S+v,w=M;for(;l<r;)p=c,m=_,y=p+m,x=y-p,E=m-x,E&&(s[o++]=E),M=w+y,I=M-w,k=M-I,v=y-I,S=w-k,_=S+v,w=M,l+=1,l<r&&(c=e[l]);for(;f<n;)p=d,m=_,y=p+m,x=y-p,E=m-x,E&&(s[o++]=E),M=w+y,I=M-w,k=M-I,v=y-I,S=w-k,_=S+v,w=M,f+=1,f<n&&(d=-t[f]);return _&&(s[o++]=_),w&&(s[o++]=w),o||(s[o++]=0),s.length=o,s}(function(e){var t=twoProduct_1,r=robustSum,n=robustScale,a=robustDiff,s=5,o=11102230246251565e-32,l=(3+16*o)*o,f=(7+56*o)*o;function h(_,w,M,I){return function(v,S,b){var A=_(_(w(S[1],b[0]),w(-b[1],S[0])),_(w(v[1],S[0]),w(-S[1],v[0]))),T=_(w(v[1],b[0]),w(-b[1],v[0])),D=I(A,T);return D[D.length-1]}}function c(_,w,M,I){return function(v,S,b,A){var T=_(_(M(_(w(b[1],A[0]),w(-A[1],b[0])),S[2]),_(M(_(w(S[1],A[0]),w(-A[1],S[0])),-b[2]),M(_(w(S[1],b[0]),w(-b[1],S[0])),A[2]))),_(M(_(w(S[1],A[0]),w(-A[1],S[0])),v[2]),_(M(_(w(v[1],A[0]),w(-A[1],v[0])),-S[2]),M(_(w(v[1],S[0]),w(-S[1],v[0])),A[2])))),D=_(_(M(_(w(b[1],A[0]),w(-A[1],b[0])),v[2]),_(M(_(w(v[1],A[0]),w(-A[1],v[0])),-b[2]),M(_(w(v[1],b[0]),w(-b[1],v[0])),A[2]))),_(M(_(w(S[1],b[0]),w(-b[1],S[0])),v[2]),_(M(_(w(v[1],b[0]),w(-b[1],v[0])),-S[2]),M(_(w(v[1],S[0]),w(-S[1],v[0])),b[2])))),P=I(T,D);return P[P.length-1]}}function u(_,w,M,I){return function(v,S,b,A,T){var D=_(_(_(M(_(M(_(w(A[1],T[0]),w(-T[1],A[0])),b[2]),_(M(_(w(b[1],T[0]),w(-T[1],b[0])),-A[2]),M(_(w(b[1],A[0]),w(-A[1],b[0])),T[2]))),S[3]),_(M(_(M(_(w(A[1],T[0]),w(-T[1],A[0])),S[2]),_(M(_(w(S[1],T[0]),w(-T[1],S[0])),-A[2]),M(_(w(S[1],A[0]),w(-A[1],S[0])),T[2]))),-b[3]),M(_(M(_(w(b[1],T[0]),w(-T[1],b[0])),S[2]),_(M(_(w(S[1],T[0]),w(-T[1],S[0])),-b[2]),M(_(w(S[1],b[0]),w(-b[1],S[0])),T[2]))),A[3]))),_(M(_(M(_(w(b[1],A[0]),w(-A[1],b[0])),S[2]),_(M(_(w(S[1],A[0]),w(-A[1],S[0])),-b[2]),M(_(w(S[1],b[0]),w(-b[1],S[0])),A[2]))),-T[3]),_(M(_(M(_(w(A[1],T[0]),w(-T[1],A[0])),S[2]),_(M(_(w(S[1],T[0]),w(-T[1],S[0])),-A[2]),M(_(w(S[1],A[0]),w(-A[1],S[0])),T[2]))),v[3]),M(_(M(_(w(A[1],T[0]),w(-T[1],A[0])),v[2]),_(M(_(w(v[1],T[0]),w(-T[1],v[0])),-A[2]),M(_(w(v[1],A[0]),w(-A[1],v[0])),T[2]))),-S[3])))),_(_(M(_(M(_(w(S[1],T[0]),w(-T[1],S[0])),v[2]),_(M(_(w(v[1],T[0]),w(-T[1],v[0])),-S[2]),M(_(w(v[1],S[0]),w(-S[1],v[0])),T[2]))),A[3]),_(M(_(M(_(w(S[1],A[0]),w(-A[1],S[0])),v[2]),_(M(_(w(v[1],A[0]),w(-A[1],v[0])),-S[2]),M(_(w(v[1],S[0]),w(-S[1],v[0])),A[2]))),-T[3]),M(_(M(_(w(b[1],A[0]),w(-A[1],b[0])),S[2]),_(M(_(w(S[1],A[0]),w(-A[1],S[0])),-b[2]),M(_(w(S[1],b[0]),w(-b[1],S[0])),A[2]))),v[3]))),_(M(_(M(_(w(b[1],A[0]),w(-A[1],b[0])),v[2]),_(M(_(w(v[1],A[0]),w(-A[1],v[0])),-b[2]),M(_(w(v[1],b[0]),w(-b[1],v[0])),A[2]))),-S[3]),_(M(_(M(_(w(S[1],A[0]),w(-A[1],S[0])),v[2]),_(M(_(w(v[1],A[0]),w(-A[1],v[0])),-S[2]),M(_(w(v[1],S[0]),w(-S[1],v[0])),A[2]))),b[3]),M(_(M(_(w(S[1],b[0]),w(-b[1],S[0])),v[2]),_(M(_(w(v[1],b[0]),w(-b[1],v[0])),-S[2]),M(_(w(v[1],S[0]),w(-S[1],v[0])),b[2]))),-A[3]))))),P=_(_(_(M(_(M(_(w(A[1],T[0]),w(-T[1],A[0])),b[2]),_(M(_(w(b[1],T[0]),w(-T[1],b[0])),-A[2]),M(_(w(b[1],A[0]),w(-A[1],b[0])),T[2]))),v[3]),M(_(M(_(w(A[1],T[0]),w(-T[1],A[0])),v[2]),_(M(_(w(v[1],T[0]),w(-T[1],v[0])),-A[2]),M(_(w(v[1],A[0]),w(-A[1],v[0])),T[2]))),-b[3])),_(M(_(M(_(w(b[1],T[0]),w(-T[1],b[0])),v[2]),_(M(_(w(v[1],T[0]),w(-T[1],v[0])),-b[2]),M(_(w(v[1],b[0]),w(-b[1],v[0])),T[2]))),A[3]),M(_(M(_(w(b[1],A[0]),w(-A[1],b[0])),v[2]),_(M(_(w(v[1],A[0]),w(-A[1],v[0])),-b[2]),M(_(w(v[1],b[0]),w(-b[1],v[0])),A[2]))),-T[3]))),_(_(M(_(M(_(w(b[1],T[0]),w(-T[1],b[0])),S[2]),_(M(_(w(S[1],T[0]),w(-T[1],S[0])),-b[2]),M(_(w(S[1],b[0]),w(-b[1],S[0])),T[2]))),v[3]),M(_(M(_(w(b[1],T[0]),w(-T[1],b[0])),v[2]),_(M(_(w(v[1],T[0]),w(-T[1],v[0])),-b[2]),M(_(w(v[1],b[0]),w(-b[1],v[0])),T[2]))),-S[3])),_(M(_(M(_(w(S[1],T[0]),w(-T[1],S[0])),v[2]),_(M(_(w(v[1],T[0]),w(-T[1],v[0])),-S[2]),M(_(w(v[1],S[0]),w(-S[1],v[0])),T[2]))),b[3]),M(_(M(_(w(S[1],b[0]),w(-b[1],S[0])),v[2]),_(M(_(w(v[1],b[0]),w(-b[1],v[0])),-S[2]),M(_(w(v[1],S[0]),w(-S[1],v[0])),b[2]))),-T[3])))),F=I(D,P);return F[F.length-1]}}function d(_){var w=_===3?h:_===4?c:u;return w(r,t,n,a)}var g=d(3),p=d(4),m=[function(){return 0},function(){return 0},function(w,M){return M[0]-w[0]},function(w,M,I){var k=(w[1]-I[1])*(M[0]-I[0]),v=(w[0]-I[0])*(M[1]-I[1]),S=k-v,b;if(k>0){if(v<=0)return S;b=k+v}else if(k<0){if(v>=0)return S;b=-(k+v)}else return S;var A=l*b;return S>=A||S<=-A?S:g(w,M,I)},function(w,M,I,k){var v=w[0]-k[0],S=M[0]-k[0],b=I[0]-k[0],A=w[1]-k[1],T=M[1]-k[1],D=I[1]-k[1],P=w[2]-k[2],F=M[2]-k[2],V=I[2]-k[2],q=S*D,Y=b*T,ee=b*A,z=v*D,ae=v*T,ie=S*A,j=P*(q-Y)+F*(ee-z)+V*(ae-ie),G=(Math.abs(q)+Math.abs(Y))*Math.abs(P)+(Math.abs(ee)+Math.abs(z))*Math.abs(F)+(Math.abs(ae)+Math.abs(ie))*Math.abs(V),N=f*G;return j>N||-j>N?j:p(w,M,I,k)}];function y(_){var w=m[_.length];return w||(w=m[_.length]=d(_.length)),w.apply(void 0,_)}function x(_,w,M,I,k,v,S){return function(A,T,D,P,F){switch(arguments.length){case 0:case 1:return 0;case 2:return I(A,T);case 3:return k(A,T,D);case 4:return v(A,T,D,P);case 5:return S(A,T,D,P,F)}for(var V=new Array(arguments.length),q=0;q<arguments.length;++q)V[q]=arguments[q];return _(V)}}function E(){for(;m.length<=s;)m.push(d(m.length));e.exports=x.apply(void 0,[y].concat(m));for(var _=0;_<=s;++_)e.exports[_]=m[_]}E()})(orientation);var orientationExports=orientation.exports,robustPnp=robustPointInPolygon,orient=orientationExports;function robustPointInPolygon(e,t){for(var r=t[0],n=t[1],a=e.length,s=1,o=a,l=0,f=a-1;l<o;f=l++){var h=e[l],c=e[f],u=h[1],d=c[1];if(d<u){if(d<n&&n<u){var g=orient(h,c,t);if(g===0)return 0;s^=0<g|0}else if(n===u){var p=e[(l+1)%a],m=p[1];if(u<m){var g=orient(h,c,t);if(g===0)return 0;s^=0<g|0}}}else if(u<d){if(u<n&&n<d){var g=orient(h,c,t);if(g===0)return 0;s^=g<0|0}else if(n===u){var p=e[(l+1)%a],m=p[1];if(m<u){var g=orient(h,c,t);if(g===0)return 0;s^=g<0|0}}}else if(n===u){var y=Math.min(h[0],c[0]),x=Math.max(h[0],c[0]);if(l===0){for(;f>0;){var E=(f+a-1)%a,_=e[E];if(_[1]!==n)break;var w=_[0];y=Math.min(y,w),x=Math.max(x,w),f=E}if(f===0)return y<=r&&r<=x?0:1;o=f+1}for(var M=e[(f+a-1)%a][1];l+1<o;){var _=e[l+1];if(_[1]!==n)break;var w=_[0];y=Math.min(y,w),x=Math.max(x,w),l+=1}if(y<=r&&r<=x)return 0;var I=e[(l+1)%a][1];r<y&&M<n!=I<n&&(s^=1)}}return 2*s-1}var robustPointInPolygon$1=getDefaultExportFromCjs(robustPnp);function feretDiameters(e={}){const{originalPoints:t=monotoneChainConvexHull.call(this)}=e;if(t.length===0)return{min:0,max:0,minLine:[],maxLine:[],aspectRatio:1};if(t.length===1)return{min:1,max:1,minLine:[t[0],t[0]],maxLine:[t[0],t[0]],aspectRatio:1};const r=new Array(t.length);let n=1/0,a=0,s=[];for(let h=0;h<t.length;h++){let c=getAngle(t[h],t[(h+1)%t.length]);rotate(-c,t,r);let u=0,d=[];for(let g=0;g<t.length;g++){let p=Math.abs(r[h][1]-r[g][1]);p>u&&(u=p,d=[],d.push([r[g][0],r[h][1]],[r[g][0],r[g][1]]))}u<n&&(n=u,a=c,s=d)}rotate(a,s,s);let o=0,l=[],f=0;for(let h=0;h<t.length-1;h++)for(let c=h+1;c<t.length;c++){let u=(t[h][0]-t[c][0])**2+(t[h][1]-t[c][1])**2;u>f&&(f=u,o=Math.sqrt(u),l=[t[h],t[c]])}return{min:n,minLine:s,max:o,maxLine:l,aspectRatio:n/o}}function getAngle(e,t){let r=difference(t,e),n=normalize(r),a=Math.acos(n[0]);return n[1]<0?-a:a}class Roi{constructor(t,r){this.map=t,this.id=r,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY,this.meanX=0,this.meanY=0,this.surface=0,this.computed={}}getMask(t={}){const{scale:r=1,kind:n=""}=t;let a;switch(n){case"contour":a=this.contourMask;break;case"box":a=this.boxMask;break;case"filled":a=this.filledMask;break;case"center":a=this.centerMask;break;case"mbr":a=this.mbrFilledMask;break;case"hull":a=this.convexHullFilledMask;break;case"hullContour":a=this.convexHullMask;break;case"mbrContour":a=this.mbrMask;break;case"feret":a=this.feretMask;break;default:a=this.mask}return r<1&&(a=a.resize({factor:r}),a.parent=this.mask.parent,a.position[0]+=this.minX,a.position[1]+=this.minY),a}get mean(){throw new Error("Roi mean not implemented yet")}get center(){return this.computed.center||(this.computed.center=[this.width/2>>0,this.height/2>>0]),this.computed.center}get ratio(){return this.width/this.height}get width(){return this.maxX-this.minX+1}get height(){return this.maxY-this.minY+1}_computExternalIDs(){let t=this.borderIDs,r=this.borderLengths;this.computed.externalIDs=[],this.computed.externalLengths=[];let n=this.internalIDs;for(let a=0;a<t.length;a++)n.includes(t[a])||(this.computed.externalIDs.push(t[a]),this.computed.externalLengths.push(r[a]))}get externalIDs(){return this.computed.externalIDs?this.computed.externalIDs:(this._computExternalIDs(),this.computed.externalIDs)}get externalLengths(){return this.computed.externalLengths?this.computed.externalLengths:(this._computExternalIDs(),this.computed.externalLengths)}_computeBorderIDs(){let t=getBorders(this);this.computed.borderIDs=t.ids,this.computed.borderLengths=t.lengths}get borderIDs(){return this.computed.borderIDs?this.computed.borderIDs:(this._computeBorderIDs(),this.computed.borderIDs)}get borderLengths(){return this.computed.borderLengths?this.computed.borderLengths:(this._computeBorderIDs(),this.computed.borderLengths)}get boxIDs(){return this.computed.boxIDs||(this.computed.boxIDs=getBoxIDs(this)),this.computed.boxIDs}get internalIDs(){return this.computed.internalIDs||(this.computed.internalIDs=getInternalIDs(this)),this.computed.internalIDs}get box(){return this.computed.box||(this.computed.box=getBox(this)),this.computed.box}get external(){return this.computed.external||(this.computed.external=getExternal(this)),this.computed.external}get holesInfo(){return this.computed.holesInfo||(this.computed.holesInfo=getHolesInfo(this)),this.computed.holesInfo}get border(){return this.computed.border||(this.computed.border=getBorder(this)),this.computed.border}get contourMask(){if(!this.computed.contourMask){let t=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let r=0;r<this.width;r++)for(let n=0;n<this.height;n++)this.map.data[r+this.minX+(n+this.minY)*this.map.width]===this.id&&(r>0&&r<this.width-1&&n>0&&n<this.height-1?(this.map.data[r-1+this.minX+(n+this.minY)*this.map.width]!==this.id||this.map.data[r+1+this.minX+(n+this.minY)*this.map.width]!==this.id||this.map.data[r+this.minX+(n-1+this.minY)*this.map.width]!==this.id||this.map.data[r+this.minX+(n+1+this.minY)*this.map.width]!==this.id)&&t.setBitXY(r,n):t.setBitXY(r,n));this.computed.contourMask=t}return this.computed.contourMask}get boxMask(){if(!this.computed.boxMask){let t=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let r=0;r<this.width;r++)t.setBitXY(r,0),t.setBitXY(r,this.height-1);for(let r=0;r<this.height;r++)t.setBitXY(0,r),t.setBitXY(this.width-1,r);this.computed.boxMask=t}return this.computed.boxMask}get mask(){if(!this.computed.mask){let t=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let r=0;r<this.width;r++)for(let n=0;n<this.height;n++)this.map.data[r+this.minX+(n+this.minY)*this.map.width]===this.id&&t.setBitXY(r,n);this.computed.mask=t}return this.computed.mask}get filledMask(){if(!this.computed.filledMask){let t=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let r=0;r<this.width;r++)for(let n=0;n<this.height;n++){let a=r+this.minX+(n+this.minY)*this.map.width;this.internalIDs.includes(this.map.data[a])&&t.setBitXY(r,n)}this.computed.filledMask=t}return this.computed.filledMask}get centerMask(){if(!this.computed.centerMask){let t=new Shape({kind:"smallCross"}).getMask();t.parent=this.map.parent,t.position=[this.minX+this.center[0]-1,this.minY+this.center[1]-1],this.computed.centerMask=t}return this.computed.centerMask}get convexHull(){if(!this.computed.convexHull){const t=[];for(let n=0;n<this.width;n++)for(let a=0;a<this.height;a++)this.map.data[n+this.minX+(a+this.minY)*this.map.width]===this.id&&(n>0&&n<this.width-1&&a>0&&a<this.height-1?(this.map.data[n-1+this.minX+(a+this.minY)*this.map.width]!==this.id||this.map.data[n+1+this.minX+(a+this.minY)*this.map.width]!==this.id||this.map.data[n+this.minX+(a-1+this.minY)*this.map.width]!==this.id||this.map.data[n+this.minX+(a+1+this.minY)*this.map.width]!==this.id)&&(t.push([n,a]),t.push([n+1,a]),t.push([n,a+1]),t.push([n+1,a+1])):(t.push([n,a]),t.push([n+1,a]),t.push([n,a+1]),t.push([n+1,a+1])));const r=monotoneChainConvexHull$1(t);this.computed.convexHull={polyline:r,surface:surface(r),perimeter:perimeter(r)}}return this.computed.convexHull}get convexHullMask(){if(!this.computed.convexHullMask){const t=this.convexHull,r=new Image(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});r.paintPolyline(t.polyline,{closed:!0}),this.computed.convexHullMask=r}return this.computed.convexHullMask}get convexHullFilledMask(){if(!this.computed.convexHullFilledMask){const t=this.convexHull,r=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let n=0;n<this.width;n++)for(let a=0;a<this.height;a++)robustPointInPolygon$1(t.polyline,[n,a])!==1&&r.setBitXY(n,a);this.computed.convexHullFilledMask=r}return this.computed.convexHullFilledMask}get mbr(){if(!this.computed.mbr){let t=minimalBoundingRectangle({originalPoints:this.convexHull.polyline});if(t.length===0)this.computed.mbr={width:0,height:0,surface:0,perimeter:0,rectangle:t};else{let r=t[0],n=t[1],a=t[2],s=Math.sqrt((r[0]-n[0])**2+(r[1]-n[1])**2),o=Math.sqrt((a[0]-n[0])**2+(a[1]-n[1])**2);this.computed.mbr={width:s,height:o,elongation:1-s/o,aspectRatio:s/o,surface:s*o,perimeter:(s+o)*2,rectangle:t}}}return this.computed.mbr}get fillRatio(){return this.surface/(this.surface+this.holesInfo.surface)}get feretDiameters(){return this.computed.feretDiameters||(this.computed.feretDiameters=feretDiameters({originalPoints:this.convexHull.polyline})),this.computed.feretDiameters}get eqpc(){return this.computed.eqpc||(this.computed.eqpc=2*Math.sqrt(this.surface/Math.PI)),this.computed.eqpc}get perimeterInfo(){return this.computed.perimeterInfo||(this.computed.perimeterInfo=getPerimeterInfo(this)),this.computed.perimeterInfo}get perimeter(){let t=this.perimeterInfo,r=2-Math.sqrt(2);return t.one+t.two*2+t.three*3+t.four*4-r*(t.two+t.three*2+t.four)}get ped(){return this.computed.ped||(this.computed.ped=this.perimeter/Math.PI),this.computed.ped}get feretMask(){if(!this.computed.feretMask){const t=new Image(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});t.paintPolyline(this.feretDiameters.minLine),t.paintPolyline(this.feretDiameters.maxLine),this.computed.feretMask=t}return this.computed.feretMask}get mbrMask(){if(!this.computed.mbrMask){let t=round(this.mbr.rectangle);if(t.length>0){const r=minMax(t),n=new Image(r[1][0]-r[0][0]+1,r[1][1]-r[0][1]+1,{kind:BINARY,position:[this.minX+r[0][0],this.minY+r[0][1]],parent:this.map.parent});t=moveToZeroZero(t),n.paintPolyline(t,{closed:!0}),this.computed.mbrMask=n}else this.computed.mbrMask=new Image(1,1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent})}return this.computed.mbrMask}get mbrFilledMask(){if(!this.computed.mbrFilledMask){const t=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent}),r=this.mask.minimalBoundingRectangle();for(let n=0;n<this.width;n++)for(let a=0;a<this.height;a++)robustPointInPolygon$1(r,[n,a])!==1&&t.setBitXY(n,a);this.computed.mbrFilledMask=t}return this.computed.mbrFilledMask}get points(){if(!this.computed.points){let t=[];for(let r=0;r<this.height;r++)for(let n=0;n<this.width;n++){let a=(r+this.minY)*this.map.width+n+this.minX;this.map.data[a]===this.id&&t.push([n,r])}this.computed.points=t}return this.computed.points}get maxLengthPoints(){if(!this.computed.maxLengthPoints){let t=0,r;const n=this.points;for(let a=0;a<n.length;a++)for(let s=a+1;s<n.length;s++){let o=Math.pow(n[a][0]-n[s][0],2)+Math.pow(n[a][1]-n[s][1],2);o>=t&&(t=o,r=[n[a],n[s]])}this.computed.maxLengthPoints=r}return this.computed.maxLengthPoints}get maxLength(){if(!this.computed.maxLength){let t=Math.sqrt(Math.pow(this.maxLengthPoints[0][0]-this.maxLengthPoints[1][0],2)+Math.pow(this.maxLengthPoints[0][1]-this.maxLengthPoints[1][1],2));this.computed.maxLength=t}return this.computed.maxLength}get roundness(){return 4*this.surface/(Math.PI*this.feretDiameters.max**2)}get sphericity(){return 2*Math.sqrt(this.surface*Math.PI)/this.perimeter}get solidity(){return this.surface/this.convexHull.surface}get angle(){if(!this.computed.angle){let t=this.maxLengthPoints,r=-Math.atan2(t[0][1]-t[1][1],t[0][0]-t[1][0])*180/Math.PI;this.computed.angle=r}return this.computed.angle}toJSON(){return{id:this.id,minX:this.minX,maxX:this.maxX,minY:this.minY,maxY:this.maxY,meanX:this.meanX,meanY:this.meanY,height:this.height,width:this.width,surface:this.surface,mbrWidth:this.mbr.width,mbrHeight:this.mbr.height,mbrSurface:this.mbr.surface,eqpc:this.eqpc,ped:this.ped,feretDiameterMin:this.feretDiameters.min,feretDiameterMax:this.feretDiameters.max,aspectRatio:this.feretDiameters.aspectRatio,fillRatio:this.fillRatio,sphericity:this.sphericity,roundness:this.roundness,solidity:this.solidity,perimeter:this.perimeter}}}function getBorders(e){let t=e.map,r=t.data,n=new Set,a=new Map,s=new Set,o=[1,0,-1,0],l=[0,1,0,-1];for(let c=e.minX;c<=e.maxX;c++)for(let u=e.minY;u<=e.maxY;u++){let d=c+u*t.width;if(r[d]===e.id)for(let g=0;g<4;g++){let p=c+o[g],m=u+l[g];if(p>=0&&m>=0&&p<t.width&&m<t.height){let y=p+m*t.width;if(r[y]!==e.id&&!s.has(y)){s.add(y),n.add(r[y]);let x=a.get(r[y]);x?a.set(r[y],++x):a.set(r[y],1)}}}}let f=Array.from(n),h=f.map(function(c){return a.get(c)});return{ids:f,lengths:h}}function getBoxIDs(e){let t=new Set,r=e.map,n=r.data;for(let a of[0,e.height-1])for(let s=0;s<e.width;s++){let o=(a+e.minY)*r.width+s+e.minX;if(s-e.minX>0&&n[o]===e.id&&n[o-1]!==e.id){let l=n[o-1];t.add(l)}if(r.width-s-e.minX>1&&n[o]===e.id&&n[o+1]!==e.id){let l=n[o+1];t.add(l)}}for(let a of[0,e.width-1])for(let s=0;s<e.height;s++){let o=(s+e.minY)*r.width+a+e.minX;if(s-e.minY>0&&n[o]===e.id&&n[o-r.width]!==e.id){let l=n[o-r.width];t.add(l)}if(r.height-s-e.minY>1&&n[o]===e.id&&n[o+r.width]!==e.id){let l=n[o+r.width];t.add(l)}}return Array.from(t)}function getBox(e){let t=0,r=e.map,n=r.data,a=[0];e.height>1&&(a[1]=e.height-1);for(let o of a)for(let l=1;l<e.width-1;l++){let f=(o+e.minY)*r.width+l+e.minX;n[f]===e.id&&t++}let s=[0];e.width>1&&(s[1]=e.width-1);for(let o of s)for(let l=0;l<e.height;l++){let f=(l+e.minY)*r.width+o+e.minX;n[f]===e.id&&t++}return t}function getBorder(e){let t=0,r=e.map,n=r.data;for(let a=1;a<e.width-1;a++)for(let s=1;s<e.height-1;s++){let o=(s+e.minY)*r.width+a+e.minX;n[o]===e.id&&(n[o-1]!==e.id||n[o+1]!==e.id||n[o-r.width]!==e.id||n[o+r.width]!==e.id)&&t++}return t+e.box}function getPerimeterInfo(e){let t=e.map,r=t.data,n=0,a=0,s=0,o=0;for(let l=0;l<e.width;l++)for(let f=0;f<e.height;f++){let h=(f+e.minY)*t.width+l+e.minX;if(r[h]===e.id){let c=0;switch((l===0||e.externalIDs.includes(r[h-1]))&&c++,(l===e.width-1||e.externalIDs.includes(r[h+1]))&&c++,(f===0||e.externalIDs.includes(r[h-t.width]))&&c++,(f===e.height-1||e.externalIDs.includes(r[h+t.width]))&&c++,c){case 1:n++;break;case 2:a++;break;case 3:s++;break;case 4:o++;break}}}return{one:n,two:a,three:s,four:o}}function getExternal(e){let t=0,r=e.map,n=r.data;for(let a=1;a<e.width-1;a++)for(let s=1;s<e.height-1;s++){let o=(s+e.minY)*r.width+a+e.minX;n[o]===e.id&&(e.externalIDs.includes(n[o-1])||e.externalIDs.includes(n[o+1])||e.externalIDs.includes(n[o-r.width])||e.externalIDs.includes(n[o+r.width]))&&t++}return t+e.box}function getHolesInfo(e){let t=0,r=e.map.width,n=e.map.data;for(let a=1;a<e.width-1;a++)for(let s=1;s<e.height-1;s++){let o=(s+e.minY)*r+a+e.minX;e.internalIDs.includes(n[o])&&n[o]!==e.id&&t++}return{number:e.internalIDs.length-1,surface:t}}function getInternalIDs(e){let t=[e.id],r=e.map,n=r.data;if(e.height>2)for(let s=0;s<e.width;s++){let o=e.minY*r.width+s+e.minX;if(t.includes(n[o])){let l=n[o+r.width];!t.includes(l)&&!e.boxIDs.includes(l)&&t.push(l)}}let a=new Array(4);for(let s=1;s<e.width-1;s++)for(let o=1;o<e.height-1;o++){let l=(o+e.minY)*r.width+s+e.minX;if(t.includes(n[l])){a[0]=n[l-1],a[1]=n[l+1],a[2]=n[l-r.width],a[3]=n[l+r.width];for(let f=0;f<4;f++){let h=a[f];!t.includes(h)&&!e.boxIDs.includes(h)&&t.push(h)}}}return t}class RoiLayer{constructor(t,r){this.roiMap=t,this.options=r,this.roi=this.createRoi()}createRoi(){let t=this.roiMap.data,r={};this.roiMap.positive=0,this.roiMap.negative=0;for(let l=0;l<t.length;l++)t[l]&&!r[t[l]]&&(r[t[l]]=!0,t[l]>0?this.roiMap.positive++:this.roiMap.negative++);let n={};for(let l in r)n[l]=new Roi(this.roiMap,l*1);let a=this.roiMap.width,s=this.roiMap.height;for(let l=0;l<s;l++)for(let f=0;f<a;f++){let h=l*a+f;if(t[h]!==0){const c=t[h],u=n[c];f<u.minX&&(u.minX=f),f>u.maxX&&(u.maxX=f),l<u.minY&&(u.minY=l),l>u.maxY&&(u.maxY=l),u.meanX+=f,u.meanY+=l,u.surface++}}let o=[];for(let l in r)n[l].meanX/=n[l].surface,n[l].meanY/=n[l].surface,o.push(n[l]);return o}}function commonBorderLength(e){let t=e.data,r=[1,0,-1,0],n=[0,1,0,-1],a=e.minMax,s=-a.min,o=a.max+s,l=[];for(let h=0;h<=o;h++)l.push(Object.create(null));for(let h=0;h<e.width;h++)for(let c=0;c<e.height;c++){let u=h+c*e.width,d=t[u];if(d!==0){let g=Object.create(null),p=!1;for(let m=0;m<4;m++){let y=h+r[m],x=c+n[m];if(y>=0&&x>=0&&y<e.width&&x<e.height){let E=t[y+x*e.width];d!==E&&(p=!0,E!==0&&g[E]===void 0&&(g[E]=!0,l[E+s][d]?l[E+s][d]++:l[E+s][d]=1))}else p=!0}p&&(l[d+s][d]?l[d+s][d]++:l[d+s][d]=1)}}let f={};for(let h=0;h<l.length;h++)Object.keys(l[h]).length>0&&(f[h-s]=l[h]);return f}function mergeRoi(e={}){const{algorithm:t="commonBorderLength",minCommonBorderLength:r=5,maxCommonBorderLength:n=100,minCommonBorderRatio:a=.3,maxCommonBorderRatio:s=1}=e;let o=function(y,x,E){return y[E]>=r&&y[E]<=n};typeof t=="function"&&(o=t),t.toLowerCase()==="commonborderratio"&&(o=function(y,x,E){let _=Math.min(y[E]/y[x],1);return _>=a&&_<=s});const l=this,f=l.commonBorderLength;let h={},c={};for(let y of Object.keys(f)){let x=f[y],E=Object.keys(x);for(let _ of E)if(_!==y&&o(x,y,_)){let w=_;c[_]&&(w=c[_]);let M=y;if(c[y]&&(M=c[y]),Number(w)!==M){let I=Math.min(w,M),k=Math.max(w,M);if(h[I]||(h[I]={}),h[I][k]=!0,c[k]=I,h[k]){for(let v of Object.keys(h[k]))h[I][v]=!0,c[v]=I;delete h[k]}}}}let u=l.minMax,d=-u.min,g=u.max+d,p=new Array(g+1).fill(0);for(let y of Object.keys(c))p[Number(y)+d]=c[y];let m=l.data;for(let y=0;y<m.length;y++){let x=m[y];if(x!==0){let E=p[x+d];E!==0&&(m[y]=E)}}return l.computed={},l}class RoiMap{constructor(t,r){this.parent=t,this.width=t.width,this.height=t.height,this.data=r,this.negative=0,this.positive=0}get total(){return this.negative+this.positive}get minMax(){let t=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;for(let n=0;n<this.data.length;n++)this.data[n]<t&&(t=this.data[n]),this.data[n]>r&&(r=this.data[n]);return{min:t,max:r}}get commonBorderLength(){return commonBorderLength(this)}mergeRoi(t={}){return mergeRoi.call(this,t)}mergeRois(t){const r=t[0],n=t.slice(1);for(let a=0;a<this.data.length;a++)n.includes(this.data[a])&&(this.data[a]=r)}rowsInfo(){let t=new Array(this.height),r=0;for(let n=0;n<this.data.length;n+=this.width){let a={row:r,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};t[r++]=a;let s={},o={},l=[],f=this.data[n],h=0;for(let c=n;c<n+this.width;c++){let u=this.data[c];f!==u&&(f=u,l.push(h),h=0),h++,u>0?(a.positivePixel++,s[u]||(s[u]=!0)):u<0?(a.negativePixel++,o[u]||(o[u]=!0)):a.zeroPixel++}l.push(h),a.medianChange=l.sort((c,u)=>c-u)[Math.floor(l.length/2)],a.positiveRoiIDs=Object.keys(s),a.negativeRoiIDs=Object.keys(o),a.positiveRoi=a.positiveRoiIDs.length,a.negativeRoi=a.negativeRoiIDs.length}return t}colsInfo(){let t=new Array(this.width),r=0;for(let n=0;n<this.width;n++){let a={col:r,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};t[r++]=a;let s={},o={},l=[],f=this.data[n],h=0;for(let c=n;c<n+this.data.length;c+=this.width){let u=this.data[c];f!==u&&(f=u,l.push(h),h=0),h++,u>0?(a.positivePixel++,s[u]||(s[u]=!0)):u<0?(a.negativePixel++,o[u]||(o[u]=!0)):a.zeroPixel++}l.push(h),a.medianChange=l.sort((c,u)=>c-u)[Math.floor(l.length/2)],a.positiveRoiIDs=Object.keys(s),a.negativeRoiIDs=Object.keys(o),a.positiveRoi=a.positiveRoiIDs.length,a.negativeRoi=a.negativeRoiIDs.length}return t}}function fromMask(e,t={}){const{allowCorners:r=!1}=t,n=65535;let a=new Int16Array(e.size),s=0,o=0,l=new Uint16Array(n+1),f=new Uint16Array(n+1);for(let c=0;c<e.width;c++)for(let u=0;u<e.height;u++)a[u*e.width+c]===0&&h(c,u);function h(c,u){let d=0,g=0,p=e.getBitXY(c,u),m=p?++s:--o;if(s>32767||o<-32768)throw new Error("Too many regions of interest");for(l[0]=c,f[0]=u;d<=g;){let y=l[d&n],x=f[d&n];if(a[x*e.width+y]=m,y>0&&a[x*e.width+y-1]===0&&e.getBitXY(y-1,x)===p&&(g++,l[g&n]=y-1,f[g&n]=x,a[x*e.width+y-1]=-32768),x>0&&a[(x-1)*e.width+y]===0&&e.getBitXY(y,x-1)===p&&(g++,l[g&n]=y,f[g&n]=x-1,a[(x-1)*e.width+y]=-32768),y<e.width-1&&a[x*e.width+y+1]===0&&e.getBitXY(y+1,x)===p&&(g++,l[g&n]=y+1,f[g&n]=x,a[x*e.width+y+1]=-32768),x<e.height-1&&a[(x+1)*e.width+y]===0&&e.getBitXY(y,x+1)===p&&(g++,l[g&n]=y,f[g&n]=x+1,a[(x+1)*e.width+y]=-32768),r&&(y>0&&x>0&&a[(x-1)*e.width+y-1]===0&&e.getBitXY(y-1,x-1)===p&&(g++,l[g&n]=y-1,f[g&n]=x-1,a[(x-1)*e.width+y-1]=-32768),y<e.width-1&&x>0&&a[(x-1)*e.width+y+1]===0&&e.getBitXY(y+1,x-1)===p&&(g++,l[g&n]=y+1,f[g&n]=x-1,a[(x-1)*e.width+y+1]=-32768),y>0&&x<e.height-1&&a[(x+1)*e.width+y-1]===0&&e.getBitXY(y-1,x+1)===p&&(g++,l[g&n]=y-1,f[g&n]=x+1,a[(x+1)*e.width+y-1]=-32768),y<e.width-1&&x<e.height-1&&a[(x+1)*e.width+y+1]===0&&e.getBitXY(y+1,x+1)===p&&(g++,l[g&n]=y+1,f[g&n]=x+1,a[(x+1)*e.width+y+1]=-32768)),d++,g-d>n)throw new Error("analyseMask can not finish, the array to manage internal data is not big enough.You could improve mask by changing MAX_ARRAY")}}return new RoiMap(e,a)}class DisjointSet{constructor(){this.nodes=new Map}add(t){var r=this.nodes.get(t);return r||(r=new DisjointSetNode(t),this.nodes.set(t,r)),r}union(t,r){const n=this.find(t),a=this.find(r);n!==a&&(n.rank<a.rank?n.parent=a:n.rank>a.rank?a.parent=n:(a.parent=n,n.rank++))}find(t){for(var r=t;r.parent!==null;)r=r.parent;for(var n=t;n.parent!==null;){var a=n;n=n.parent,a.parent=r}return r}connected(t,r){return this.find(t)===this.find(r)}}var DisjointSet_1=DisjointSet;function DisjointSetNode(e){this.value=e,this.parent=null,this.rank=0}var DisjointSet$1=getDefaultExportFromCjs(DisjointSet_1);const direction4X=[-1,0],direction4Y=[0,-1],neighbours4=[null,null],direction8X=[-1,-1,0,1],direction8Y=[0,-1,-1,-1],neighbours8=[null,null,null,null];function fromMaskConnectedComponentLabelingAlgorithm(e,t={}){const{allowCorners:r=!1}=t;let n=4;r&&(n=8);let a,s,o;if(n===8)a=direction8X,s=direction8Y,o=neighbours8;else if(n===4)a=direction4X,s=direction4Y,o=neighbours4;else throw new RangeError(`unsupported neighbours count: ${n}`);const l=e.size,f=e.width,h=e.height,c=new Array(l),u=new Uint32Array(l),d=new DisjointSet$1;let g=1;for(let p=0;p<h;p++)for(let m=0;m<f;m++){const y=m+p*f;if(e.getBit(y)){let x=null;for(let E=0;E<o.length;E++){const _=m+a[E],w=p+s[E];if(_>=0&&w>=0&&_<f&&w<h){const M=_+w*f;let I=c[M];I?(o[E]=I,(!x||o[E].value<x.value)&&(x=o[E])):o[E]=null}}if(!x)c[y]=d.add(g++);else{c[y]=x;for(let E=0;E<o.length;E++)o[E]&&o[E]!==x&&d.union(x,o[E])}}}for(let p=0;p<h;p++)for(let m=0;m<f;m++){const y=m+p*f;e.getBit(y)&&(u[y]=d.find(c[y]).value)}return new RoiMap(e,u)}function fromMaxima(e={}){let{allowCorner:t=!0,onlyTop:r=!1,invert:n=!1}=e,a=this;a.checkProcessable("fromMaxima",{components:[1]});const s=1,o=2;let l=0,f=0,h=new Int16Array(a.size),c=new Int8Array(a.size),u=new Float32Array(a.size),d=1048575,g=new Uint16Array(d+1),p=new Uint16Array(d+1),m=0,y=0,x=new Uint16Array(d+1),E=new Uint16Array(d+1),_=0,w=0;for(M(a);m<y;){let v=g[m&d],S=p[m&d];k(v,S,o),m++}return new RoiMap(a,h);function M({maxima:v=!0}){for(let S=1;S<a.height-1;S++)for(let b=1;b<a.width-1;b++){let A=b+S*a.width;if(c[A]===0){let T=v?a.data[A]:-a.data[b+S*a.width];if(a.data[S*a.width+b-1]>T||a.data[S*a.width+b+1]>T||a.data[(S-1)*a.width+b]>T||a.data[(S+1)*a.width+b]>T||t&&(a.data[(S-1)*a.width+b-1]>T||a.data[(S-1)*a.width+b+1]>T||a.data[(S+1)*a.width+b-1]>T||a.data[(S+1)*a.width+b+1]>T))continue;h[A]=v?++l:--f,I(b,S)||(v?--l:++f)}}}function I(v,S){let b=y;_=0,w=1,x[0]=v,E[0]=S;let A=!0;for(;_<w;){let T=x[_&d],D=E[_&d];A&=k(T,D,s),_++}if(!A){for(let T=0;T<w;T++){let D=x[T&d],F=E[T&d]*a.width+D;h[F]=0}y=b}return A}function k(v,S,b){let A=h[S*a.width+v],T=a.data[S*a.width+v];for(let D=S-1;D<=S+1;D++)for(let P=v-1;P<=v+1;P++){let F=D*a.width+P;if(c[F]===0)switch(c[F]=1,u[F]=a.data[F]-T,b){case s:if(u[F]===0){if(P===0||D===0||P===a.width-1||D===a.height-1)return!1;h[F]=A,x[w&d]=P,E[w&d]=D,w++}else{if(u[F]>0)return!1;r||(h[F]=A,g[y&d]=P,p[y&d]=D,y++)}break;case o:u[F]<=0&&(h[F]=A,g[y&d]=P,p[y&d]=D,y++);break;default:throw new Error("unreachable")}}return!0}}function fromPoints(e,t={}){let r=new Shape(t),n=new Int16Array(this.size),a=0,s=r.getPoints();for(let o=0;o<e.length;o++){a++;let l=e[o][0],f=e[o][1];for(let h=0;h<s.length;h++){let c=s[h][0],u=s[h][1];l+c>=0&&f+u>=0&&l+c<this.width&&f+u<this.height&&(n[l+c+(f+u)*this.width]=a)}}return new RoiMap(this,n)}function commonjsRequire(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var priorityQueue={exports:{}};(function(e,t){(function(r){e.exports=r()})(function(){return function r(n,a,s){function o(h,c){if(!a[h]){if(!n[h]){var u=typeof commonjsRequire=="function"&&commonjsRequire;if(!c&&u)return u(h,!0);if(l)return l(h,!0);var d=new Error("Cannot find module '"+h+"'");throw d.code="MODULE_NOT_FOUND",d}var g=a[h]={exports:{}};n[h][0].call(g.exports,function(p){var m=n[h][1][p];return o(m||p)},g,g.exports,r,n,a,s)}return a[h].exports}for(var l=typeof commonjsRequire=="function"&&commonjsRequire,f=0;f<s.length;f++)o(s[f]);return o}({1:[function(r,n,a){var s,o,l,f,h,c=function(d,g){for(var p in g)u.call(g,p)&&(d[p]=g[p]);function m(){this.constructor=d}return m.prototype=g.prototype,d.prototype=new m,d.__super__=g.prototype,d},u={}.hasOwnProperty;s=r("./PriorityQueue/AbstractPriorityQueue"),o=r("./PriorityQueue/ArrayStrategy"),f=r("./PriorityQueue/BinaryHeapStrategy"),l=r("./PriorityQueue/BHeapStrategy"),h=function(d){c(g,d);function g(p){p||(p={}),p.strategy||(p.strategy=f),p.comparator||(p.comparator=function(m,y){return(m||0)-(y||0)}),g.__super__.constructor.call(this,p)}return g}(s),h.ArrayStrategy=o,h.BinaryHeapStrategy=f,h.BHeapStrategy=l,n.exports=h},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(r,n,a){n.exports=function(){function s(o){var l;if((o!=null?o.strategy:void 0)==null)throw"Must pass options.strategy, a strategy";if((o!=null?o.comparator:void 0)==null)throw"Must pass options.comparator, a comparator";this.priv=new o.strategy(o),this.length=(o!=null&&(l=o.initialValues)!=null?l.length:void 0)||0}return s.prototype.queue=function(o){this.length++,this.priv.queue(o)},s.prototype.dequeue=function(o){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},s.prototype.peek=function(o){if(!this.length)throw"Empty queue";return this.priv.peek()},s.prototype.clear=function(){return this.length=0,this.priv.clear()},s}()},{}],3:[function(r,n,a){var s;s=function(o,l,f){var h,c,u;for(c=0,h=o.length;c<h;)u=c+h>>>1,f(o[u],l)>=0?c=u+1:h=u;return c},n.exports=function(){function o(l){var f;this.options=l,this.comparator=this.options.comparator,this.data=((f=this.options.initialValues)!=null?f.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return o.prototype.queue=function(l){var f;f=s(this.data,l,this.comparator),this.data.splice(f,0,l)},o.prototype.dequeue=function(){return this.data.pop()},o.prototype.peek=function(){return this.data[this.data.length-1]},o.prototype.clear=function(){this.data.length=0},o}()},{}],4:[function(r,n,a){n.exports=function(){function s(o){var l,f,h,c,u,d,g,p;for(this.comparator=(o!=null?o.comparator:void 0)||function(m,y){return m-y},this.pageSize=(o!=null?o.pageSize:void 0)||512,this.length=0,g=0;1<<g<this.pageSize;)g+=1;if(1<<g!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=g,this._emptyMemoryPageTemplate=l=[],f=0,u=this.pageSize;0<=u?f<u:f>u;0<=u?++f:--f)l.push(null);if(this._memory=[],this._mask=this.pageSize-1,o.initialValues)for(d=o.initialValues,h=0,c=d.length;h<c;h++)p=d[h],this.queue(p)}return s.prototype.queue=function(o){this.length+=1,this._write(this.length,o),this._bubbleUp(this.length,o)},s.prototype.dequeue=function(){var o,l;return o=this._read(1),l=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,l),this._bubbleDown(1,l)),o},s.prototype.peek=function(){return this._read(1)},s.prototype.clear=function(){this.length=0,this._memory.length=0},s.prototype._write=function(o,l){var f;for(f=o>>this._shift;f>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[f][o&this._mask]=l},s.prototype._read=function(o){return this._memory[o>>this._shift][o&this._mask]},s.prototype._bubbleUp=function(o,l){var f,h,c,u;for(f=this.comparator;o>1&&(h=o&this._mask,o<this.pageSize||h>3?c=o&~this._mask|h>>1:h<2?(c=o-this.pageSize>>this._shift,c+=c&~(this._mask>>1),c|=this.pageSize>>1):c=o-2,u=this._read(c),!(f(u,l)<0));)this._write(c,l),this._write(o,u),o=c},s.prototype._bubbleDown=function(o,l){var f,h,c,u,d;for(d=this.comparator;o<this.length;)if(o>this._mask&&!(o&this._mask-1)?f=h=o+2:o&this.pageSize>>1?(f=(o&~this._mask)>>1,f|=o&this._mask>>1,f=f+1<<this._shift,h=f+1):(f=o+(o&this._mask),h=f+1),f!==h&&h<=this.length)if(c=this._read(f),u=this._read(h),d(c,l)<0&&d(c,u)<=0)this._write(f,l),this._write(o,c),o=f;else if(d(u,l)<0)this._write(h,l),this._write(o,u),o=h;else break;else if(f<=this.length)if(c=this._read(f),d(c,l)<0)this._write(f,l),this._write(o,c),o=f;else break;else break},s}()},{}],5:[function(r,n,a){n.exports=function(){function s(o){var l;this.comparator=(o!=null?o.comparator:void 0)||function(f,h){return f-h},this.length=0,this.data=((l=o.initialValues)!=null?l.slice(0):void 0)||[],this._heapify()}return s.prototype._heapify=function(){var o,l,f;if(this.data.length>0)for(o=l=1,f=this.data.length;1<=f?l<f:l>f;o=1<=f?++l:--l)this._bubbleUp(o)},s.prototype.queue=function(o){this.data.push(o),this._bubbleUp(this.data.length-1)},s.prototype.dequeue=function(){var o,l;return l=this.data[0],o=this.data.pop(),this.data.length>0&&(this.data[0]=o,this._bubbleDown(0)),l},s.prototype.peek=function(){return this.data[0]},s.prototype.clear=function(){this.length=0,this.data.length=0},s.prototype._bubbleUp=function(o){for(var l,f;o>0&&(l=o-1>>>1,this.comparator(this.data[o],this.data[l])<0);)f=this.data[l],this.data[l]=this.data[o],this.data[o]=f,o=l},s.prototype._bubbleDown=function(o){var l,f,h,c,u;for(l=this.data.length-1;f=(o<<1)+1,c=f+1,h=o,f<=l&&this.comparator(this.data[f],this.data[h])<0&&(h=f),c<=l&&this.comparator(this.data[c],this.data[h])<0&&(h=c),h!==o;)u=this.data[h],this.data[h]=this.data[o],this.data[o]=u,o=h},s}()},{}]},{},[1])(1)})})(priorityQueue);var priorityQueueExports=priorityQueue.exports,PriorityQueue=getDefaultExportFromCjs(priorityQueueExports);const dxs=[1,0,-1,0,1,1,-1,-1],dys=[0,1,0,-1,1,-1,1,-1];function fromWaterShed(e={}){let{points:t,mask:r,image:n,fillMaxValue:a=this.maxValue,invert:s=!1}=e,o=n||this;o.checkProcessable("fromWaterShed",{bitDepth:[8,16],components:1}),s=!s,t||(t=o.getLocalMaxima({invert:s,mask:r}));let l=s?0:1,f=new Int16Array(o.size),h=o.width,c=o.height,u=new PriorityQueue({comparator:(d,g)=>d[2]-g[2],strategy:PriorityQueue.BinaryHeapStrategy});for(let d=0;d<t.length;d++){let g=t[d][0]+t[d][1]*h;f[g]=d+1;let p=o.data[g];(s&&p<=a||!s&&p>=a)&&u.queue([t[d][0],t[d][1],p])}for(;u.length>0;){let d=u.dequeue(),g=d[0]+d[1]*h;for(let p=0;p<4;p++){let m=d[0]+dxs[p],y=d[1]+dys[p];if(m>=0&&y>=0&&m<h&&y<c){let x=m+y*h;if(!r||r.getBit(x)===l){let E=o.data[x];(s&&E<=a||!s&&E>=a)&&f[x]===0&&(f[x]=f[g],u.queue([d[0]+dxs[p],d[1]+dys[p],E]))}}}}return new RoiMap(o,f)}class RoiManager{constructor(t,r={}){this._image=t,this._options=r,this._options.label||(this._options.label="default"),this._layers={},this._painted=null}fromMaxima(t={}){let r=Object.assign({},this._options,t),n=fromMaxima.call(this._image,t);this._layers[r.label]=new RoiLayer(n,r)}fromPoints(t,r={}){let n=Object.assign({},this._options,r),a=fromPoints.call(this._image,t,r);return this._layers[n.label]=new RoiLayer(a,n),this}putMap(t,r={}){let n=new RoiMap(this._image,t),a=Object.assign({},this._options,r);return this._layers[a.label]=new RoiLayer(n,a),this}fromWaterShed(t={}){let r=Object.assign({},this._options,t),n=fromWaterShed.call(this._image,t);this._layers[r.label]=new RoiLayer(n,r)}fromMask(t,r={}){let n=Object.assign({},this._options,r),a=fromMask.call(this._image,t,r);return this._layers[n.label]=new RoiLayer(a,n),this}fromMaskConnectedComponentLabelingAlgorithm(t,r={}){let n=Object.assign({},this._options,r),a=fromMaskConnectedComponentLabelingAlgorithm.call(this._image,t,r);return this._layers[n.label]=new RoiLayer(a,n),this}getMap(t={}){let r=Object.assign({},this._options,t);return this._assertLayerWithLabel(r.label),this._layers[r.label].roiMap}rowsInfo(t={}){return this.getMap(t).rowsInfo()}colsInfo(t={}){return this.getMap(t).rowsInfo()}getRoiIds(t={}){let r=this.getRois(t);if(r){let n=new Array(r.length);for(let a=0;a<r.length;a++)n[a]=r[a].id;return n}throw new Error("ROIs not found")}getRois(t={}){let{label:r=this._options.label,positive:n=!0,negative:a=!0,minSurface:s=0,maxSurface:o=Number.POSITIVE_INFINITY,minWidth:l=0,maxWidth:f=Number.POSITIVE_INFINITY,minHeight:h=0,maxHeight:c=Number.POSITIVE_INFINITY,minRatio:u=0,maxRatio:d=Number.POSITIVE_INFINITY}=t;if(!this._layers[r])throw new Error(`this Roi layer (${r}) does not exist`);const g=this._layers[r].roi,p=[];for(const m of g)(m.id<0&&a||m.id>0&&n)&&m.surface>=s&&m.surface<=o&&m.width>=l&&m.width<=f&&m.height>=h&&m.height<=c&&m.ratio>=u&&m.ratio<=d&&p.push(m);return p}getRoi(t,r={}){const{label:n=this._options.label}=r;if(!this._layers[n])throw new Error(`this Roi layer (${n}) does not exist`);const a=this._layers[n].roi.find(s=>s.id===t);if(!a)throw new Error(`found no Roi with id ${t}`);return a}getMasks(t={}){let r=this.getRois(t),n=new Array(r.length);for(let a=0;a<r.length;a++)n[a]=r[a].getMask(t);return n}getAnalysisMasks(t={}){const{analysisProperty:r}=t;let n=`${r}Mask`,a=this.getRois(t);return a.length===0||!a[0][n]?[]:a.map(s=>s[n])}getData(t={}){let r=Object.assign({},this._options,t);return this._assertLayerWithLabel(r.label),this._layers[r.label].roiMap.data}paint(t={}){let{labelProperty:r,analysisProperty:n}=t;this._painted||(this._painted=this._image.rgba8());let a=this.getMasks(t);if(r){const s=this.getRois(t);t.labels=s.map(h=>deepValue(h,r));const o=Math.max(...t.labels);let l=!1,f=!1;if(r.includes("surface")?l=!0:/(?:perimeter|min|max|external|width|height|length)/.test(r)&&(f=!0),isFinite(o)){let h="";if(t.unit!=="pixel"&&t.pixelSize&&(f||l)){h=l?`${t.unit}^2`:t.unit;let c=l?"m^2":"m",u=l?t.pixelSize**2:t.pixelSize;const d=Qty.swiftConverter(c,h);t.labels=t.labels.map(g=>d(u*g))}o>50?t.labels=t.labels.map(c=>Math.round(c)+h):o>10?t.labels=t.labels.map(c=>c.toFixed(1)+h):t.labels=t.labels.map(c=>c.toFixed(2)+h)}t.labelsPosition=s.map(h=>[h.meanX,h.meanY])}if(this._painted.paintMasks(a,t),n){let s=this.getAnalysisMasks(t);this._painted.paintMasks(s,{color:t.analysisColor,alpha:t.analysisAlpha})}return this._painted}getMask(t={}){let r=new Image(this._image.width,this._image.height,{kind:"BINARY"}),n=this.getMasks(t);for(let a=0;a<n.length;a++){let s=n[a];for(let o=0;o<s.width;o++)for(let l=0;l<s.height;l++)s.getBitXY(o,l)&&r.setBitXY(o+s.position[0],l+s.position[1])}return r}resetPainted(t={}){const{image:r}=t;r?this._painted=this.image.rgba8():this._painted=this._image.rgba8()}mergeRoi(t={}){const r=this.getMap(t);return r.mergeRoi(t),this.putMap(r.data,t),this}mergeRois(t,r={}){if(!Array.isArray(t)||t.some(a=>!Number.isInteger(a)))throw new Error("Roi ids must be an array of integers");if(t.length<2)throw new Error("Roi ids must have at least two elements");if(new Set(t).size!==t.length)throw new Error("Roi ids must be all different");t.forEach(a=>this.getRoi(a));const n=this.getMap(r);return n.mergeRois(t),this.putMap(n.data,r),this}findCorrespondingRoi(t,r={}){let n=this.getRois(r),a=[];for(let s=0;s<n.length;s++){let o=n[s],l=o.minX,f=o.minY,h=o.points,c=Math.sign(o.id),u=correspondingRoisInformation(l,f,h,t,c);a.push(u)}return a}_assertLayerWithLabel(t){if(!this._layers[t])throw new Error(`no layer with label ${t}`)}}function correspondingRoisInformation(e,t,r,n,a){let s={id:[],surface:[],roiSurfaceCovered:[],same:0,opposite:0,total:0};for(let o=0;o<r.length;o++){let l=r[o],f=l[0],h=l[1],c=f+e+(h+t)*n.width,u=n.data[c];(u>0||u<0)&&(s.id.includes(u)?s.surface[s.id.indexOf(u)]+=1:(s.id.push(u),s.surface.push(1)))}for(let o=0;o<s.id.length;o++)Math.sign(s.id[o])===a?s.same+=s.surface[o]:s.opposite+=s.surface[o],s.roiSurfaceCovered[o]=s.surface[o]/r.length;return s.total=s.opposite+s.same,s}const objectToString$2=Object.prototype.toString;class Image{constructor(t,r,n,a){if(arguments.length===1?(a=t,{width:t,height:r,data:n}=a):n&&!n.length&&(a=n,{data:n}=a),t===void 0&&(t=1),r===void 0&&(r=1),a===void 0&&(a={}),typeof a!="object"||a===null)throw new TypeError("options must be an object");if(!Number.isInteger(t)||t<=0)throw new RangeError("width must be a positive integer");if(!Number.isInteger(r)||r<=0)throw new RangeError("height must be a positive integer");const{kind:s=RGBA}=a;if(typeof s!="string")throw new TypeError("kind must be a string");const o=getKind(s),l=Object.assign({},a);for(const m in o)l[m]===void 0&&(l[m]=o[m]);verifyKindDefinition(l);const{components:f,bitDepth:h,colorModel:c}=l,u=l.alpha+0,d=t*r,g=f+u,p=h===32?Number.MAX_VALUE:2**h-1;if(n===void 0)n=createPixelArray(d,f,u,g,h,p);else{const m=getTheoreticalPixelArraySize(d,g,h);if(n.length!==m)throw new RangeError(`incorrect data size: ${n.length}. Should be ${m}`)}this.width=t,this.height=r,this.data=n,this.size=d,this.components=f,this.alpha=u,this.bitDepth=h,this.maxValue=p,this.colorModel=c,this.channels=g,this.meta=a.meta||{},Object.defineProperty(this,"parent",{enumerable:!1,writable:!0,configurable:!0,value:a.parent||null}),this.position=a.position||[0,0],this.computed=null,this.sizes=[this.width,this.height],this.multiplierX=this.channels,this.multiplierY=this.channels*this.width,this.isClamped=this.bitDepth<32,this.borderSizes=[0,0]}get[Symbol.toStringTag](){return"IJSImage"}static isImage(t){return objectToString$2.call(t)==="[object IJSImage]"}static fromCanvas(t){const n=t.getContext("2d").getImageData(0,0,t.width,t.height);return new Image(n.width,n.height,n.data)}static createFrom(t,r){const n=getImageParameters(t);return Object.assign(n,{parent:t,position:[0,0]},r),new Image(n)}getRoiManager(t){return new RoiManager(this,t)}clone(){const t=this.data.slice();return new Image(this.width,this.height,t,this)}apply(t){for(let r=0;r<this.height;r++)for(let n=0;n<this.width;n++){let a=(r*this.width+n)*this.channels;t.call(this,a)}}}setValueMethods(Image);setBitMethods(Image);setExportMethods(Image);Image.prototype.checkProcessable=checkProcessable;Image.prototype.getRGBAData=getRGBAData;Image.load=load;Image.extendMethod=extendMethod;Image.extendProperty=extendProperty;extend$1(Image);var workerTemplate$1={},worker$1=function(){self.window=self;function e(){this._listeners={}}e.prototype.on=function(r,n){if(this._listeners[r])throw new RangeError("there is already a listener for "+r);if(typeof n!="function")throw new TypeError("callback argument must be a function");this._listeners[r]=n},e.prototype._send=function(r,n,a){a===void 0?a=[]:Array.isArray(a)||(a=[a]),self.postMessage({id:r,data:n},a)},e.prototype._trigger=function(r,n){if(!this._listeners[r])throw new Error("event "+r+" is not defined");this._listeners[r].apply(null,n)};var t=new e;self.onmessage=function(r){switch(r.data.action){case"exec":r.data.args.unshift(function(n,a){t._send(r.data.id,n,a)}),t._trigger(r.data.event,r.data.args);break;case"ping":t._send(r.data.id,"pong");break;default:throw new Error("unexpected action: "+r.data.action)}}},workerStr=worker$1.toString().split('"CODE";');workerTemplate$1.newWorkerURL=function e(t,r){var n=new Blob(["(",workerStr[0],"importScripts.apply(self, "+JSON.stringify(r)+`);
`,"(",t,")();",workerStr[1],")();"],{type:"application/javascript"});return URL.createObjectURL(n)};var workerTemplate=workerTemplate$1,CORES=navigator.hardwareConcurrency||1;function WorkerManager(e,t){if(typeof e!="string"&&typeof e!="function")throw new TypeError("func argument must be a function");if(t===void 0&&(t={}),typeof t!="object"||t===null)throw new TypeError("options argument must be an object");this._workerCode=e.toString(),t.maxWorkers===void 0||t.maxWorkers==="auto"?this._numWorkers=Math.min(CORES-1,1):t.maxWorkers>0?this._numWorkers=Math.min(t.maxWorkers,CORES):this._numWorkers=CORES,this._workers=new Map,this._timeout=t.timeout||0,this._terminateOnError=!!t.terminateOnError;var r=t.deps;typeof r=="string"&&(r=[r]),Array.isArray(r)||(r=void 0),this._id=0,this._terminated=!1,this._working=0,this._waiting=[],this._init(r)}WorkerManager.prototype._init=function(e){for(var t=workerTemplate.newWorkerURL(this._workerCode,e),r=0;r<this._numWorkers;r++){var n=new Worker(t);n.onmessage=this._onmessage.bind(this,n),n.onerror=this._onerror.bind(this,n),n.running=!1,n.id=r,this._workers.set(n,null)}URL.revokeObjectURL(t)};WorkerManager.prototype._onerror=function(e,t){if(!this._terminated){this._working--,e.running=!1;var r=this._workers.get(e);r&&r[1](t.message),this._workers.set(e,null),this._terminateOnError?this.terminate():this._exec()}};WorkerManager.prototype._onmessage=function(e,t){if(!this._terminated){this._working--,e.running=!1;var r=this._workers.get(e);r&&r[0](t.data.data),this._workers.set(e,null),this._exec()}};WorkerManager.prototype._exec=function(){for(var e of this._workers.keys()){if(this._working===this._numWorkers||this._waiting.length===0)return;if(!e.running)for(var t=0;t<this._waiting.length;t++){var r=this._waiting[t];if(!(typeof r[4]=="number"&&r[4]!==e.id)){this._waiting.splice(t,1),e.postMessage({action:"exec",event:r[0],args:r[1]},r[2]),e.running=!0,e.time=Date.now(),this._workers.set(e,r[3]),this._working++;break}}}};WorkerManager.prototype.terminate=function(){if(!this._terminated){for(var e of this._workers)e[0].terminate(),e[1]&&e[1][1](new Error("Terminated"));this._workers.clear(),this._waiting=[],this._working=0,this._terminated=!0}};WorkerManager.prototype.postAll=function(e,t){if(this._terminated)throw new Error("Cannot post (terminated)");var r=[];for(var n of this._workers.keys())r.push(this.post(e,t,[],n.id));return Promise.all(r)};WorkerManager.prototype.post=function(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),Array.isArray(t)||(t=[t]),Array.isArray(r)||(r=[r]);var a=this;return new Promise(function(s,o){if(a._terminated)throw new Error("Cannot post (terminated)");a._waiting.push([e,t,r,[s,o],n]),a._exec()})};var src=WorkerManager,WorkerManager$1=getDefaultExportFromCjs(src);const defaultOptions={regression:{kernelType:"polynomial",kernelOptions:{degree:2,constant:1}},threshold:.02,roi:{minSurface:100,positive:!1},sampling:20,include:[]};function run(e,t,r){t=Object.assign({},defaultOptions,t);const n=this.manager;return Array.isArray(e)?Promise.all(e.map(function(a){const s=runOnce(n,a,t);return typeof r=="function"&&s.then(r),s})):runOnce(n,e,t)}function runOnce(e,t,r){return e.post("data",[t,r]).then(function(n){for(let a in n)n[a]=new Image(n[a]);return n})}function work(){worker.on("data",function(e,t,r){t=new IJS(t);const n={},a=[],s=t.grey(),o=s.sobelFilter();g("sobel",o);const l=o.level().mask({threshold:r.threshold});g("mask",l);const f=o.getRoiManager();f.fromMask(l);const h=f.getMask(r.roi);g("realMask",h);const c=s.getPixelsGrid({sampling:r.sampling,mask:h}),u=t.getBackground(c.xyS,c.zS,r.regression);g("background",u);const d=t.subtract(u);n.result=d,a.push(d.data.buffer),e(n,a);function g(p,m){r.include.includes(p)&&(n[p]=m,a.push(m.data.buffer))}})}const background={run,work};function extend(e){e.extendMethod("background",background)}let Worker$1=class nt{constructor(){this._url=null,this._deps=[null]}checkUrl(){if(this._url===null)throw new Error("image worker must be initialized with an URL")}get url(){return this._url}set url(t){if(typeof t!="string")throw new TypeError("worker URL must be a string");this._url=t,this._deps[0]=t}static extendMethod(t,r){let n,a,s={};function o(...l){return n||(this.checkUrl(),a=this.url,n=new WorkerManager$1(r.work,{deps:a}),s.manager=n),r.run.call(s,...l)}o.reset=function(){n&&(n.terminate(),n=new WorkerManager$1(r.work,{deps:a}),s.manager=n)},nt.prototype[t]=o}};extend(Worker$1);await import("https://cdn.jsdelivr.net/npm/gdal3.js@2.4.0/dist/package/gdal3.js");let Gdal=await initGdalJs({path:"https://cdn.jsdelivr.net/npm/gdal3.js@2.4.0/dist/package",useWorker:!1});async function manipulateImage$1(e,t,r,n,a,s,o){let l="32767",f="65535",h="0",c="bilinear",u=[],d,g=await Image.load(e);return n===!0&&(g=await g.flipX()),a===!0&&(g=await g.flipY()),t>0&&(g=await g.blurFilter(t)),d=await g.toBuffer(),s!=="0"&&s!=="1081"?o===!0&&(r===!0?u=["-ot","UInt16","-of","PNG","-scale",h,f,l,f,"-outsize",s,s,"-r",c]:u=["-ot","UInt16","-of","PNG","-outsize",s,s,"-r",c],d=await processGdal(d,"heightmap.png",u,"png")):r===!0&&(u=["-ot","UInt16","-of","PNG","-scale",h,f,l,f,"-r",c],d=await processGdal(d,"heightmap.png",u,"png")),d}async function loadImageFromArray(e,t={}){try{return await Image.load(e,t)}catch(r){console.log(r)}}function convertImage(e,t,r,n,a){return new Image(e,t,r,{kind:a,bitDepth:n})}async function processGdal(e,t,r,n){let a=new Blob([e],{type:"image/"+n});const s=new File([a],t),l=(await Gdal.open(s)).datasets[0];console.log("gdal translate");const f=await Gdal.gdal_translate(l,r),h=await Gdal.getFileBytes(f);return Gdal.close(l),h}var imageUtils={manipulateImage:manipulateImage$1,loadImageFromArray,convertImage};function getFileHandle(){if("showOpenFilePicker"in window)return window.showOpenFilePicker().then(e=>e[0])}function getDirHandle(){if("showDirectoryPicker"in window)return window.showDirectoryPicker().then(e=>e)}async function verifyPermission(e,t){const r={};return t&&(r.writable=!0,r.mode="readwrite"),await e.queryPermission(r)==="granted"||await e.requestPermission(r)==="granted"}async function writeFileToDisk(e,t,r){let a=await(await e.getFileHandle(t,{create:!0})).createWritable();await a.write(r),await a.close()}async function fileExists(e,t){try{return await e.getFileHandle(t),!0}catch(r){if(r.name==="NotFoundError")return!1;if(r.name==="NotAllowedError")return console.log("Please select directory to verify permissions"),!1}}async function readFileFromDisk(e,t){return await(await(await e.getFileHandle(t)).getFile()).arrayBuffer()}function checkFileApiSupport(){let e;return"showDirectoryPicker"in window?e=!0:e=!1,e}var fileUtils={getDirHandle,verifyPermission,writeFileToDisk,fileExists,getFileHandle,readFileFromDisk,checkFileApiSupport},freeGlobal$1=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,_freeGlobal=freeGlobal$1,freeGlobal=_freeGlobal,freeSelf=typeof self=="object"&&self&&self.Object===Object&&self,root$8=freeGlobal||freeSelf||Function("return this")(),_root=root$8,root$7=_root,Symbol$6=root$7.Symbol,_Symbol=Symbol$6,Symbol$5=_Symbol,objectProto$b=Object.prototype,hasOwnProperty$8=objectProto$b.hasOwnProperty,nativeObjectToString$1=objectProto$b.toString,symToStringTag$1=Symbol$5?Symbol$5.toStringTag:void 0;function getRawTag$1(e){var t=hasOwnProperty$8.call(e,symToStringTag$1),r=e[symToStringTag$1];try{e[symToStringTag$1]=void 0;var n=!0}catch{}var a=nativeObjectToString$1.call(e);return n&&(t?e[symToStringTag$1]=r:delete e[symToStringTag$1]),a}var _getRawTag=getRawTag$1,objectProto$a=Object.prototype,nativeObjectToString=objectProto$a.toString;function objectToString$1(e){return nativeObjectToString.call(e)}var _objectToString=objectToString$1,Symbol$4=_Symbol,getRawTag=_getRawTag,objectToString=_objectToString,nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=Symbol$4?Symbol$4.toStringTag:void 0;function baseGetTag$5(e){return e==null?e===void 0?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(e)?getRawTag(e):objectToString(e)}var _baseGetTag=baseGetTag$5;function isObjectLike$5(e){return e!=null&&typeof e=="object"}var isObjectLike_1=isObjectLike$5,baseGetTag$4=_baseGetTag,isObjectLike$4=isObjectLike_1,symbolTag$1="[object Symbol]";function isSymbol$5(e){return typeof e=="symbol"||isObjectLike$4(e)&&baseGetTag$4(e)==symbolTag$1}var isSymbol_1=isSymbol$5,isSymbol$4=isSymbol_1;function baseExtremum$2(e,t,r){for(var n=-1,a=e.length;++n<a;){var s=e[n],o=t(s);if(o!=null&&(l===void 0?o===o&&!isSymbol$4(o):r(o,l)))var l=o,f=s}return f}var _baseExtremum=baseExtremum$2;function listCacheClear$1(){this.__data__=[],this.size=0}var _listCacheClear=listCacheClear$1;function eq$3(e,t){return e===t||e!==e&&t!==t}var eq_1=eq$3,eq$2=eq_1;function assocIndexOf$4(e,t){for(var r=e.length;r--;)if(eq$2(e[r][0],t))return r;return-1}var _assocIndexOf=assocIndexOf$4,assocIndexOf$3=_assocIndexOf,arrayProto=Array.prototype,splice=arrayProto.splice;function listCacheDelete$1(e){var t=this.__data__,r=assocIndexOf$3(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():splice.call(t,r,1),--this.size,!0}var _listCacheDelete=listCacheDelete$1,assocIndexOf$2=_assocIndexOf;function listCacheGet$1(e){var t=this.__data__,r=assocIndexOf$2(t,e);return r<0?void 0:t[r][1]}var _listCacheGet=listCacheGet$1,assocIndexOf$1=_assocIndexOf;function listCacheHas$1(e){return assocIndexOf$1(this.__data__,e)>-1}var _listCacheHas=listCacheHas$1,assocIndexOf=_assocIndexOf;function listCacheSet$1(e,t){var r=this.__data__,n=assocIndexOf(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}var _listCacheSet=listCacheSet$1,listCacheClear=_listCacheClear,listCacheDelete=_listCacheDelete,listCacheGet=_listCacheGet,listCacheHas=_listCacheHas,listCacheSet=_listCacheSet;function ListCache$4(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ListCache$4.prototype.clear=listCacheClear;ListCache$4.prototype.delete=listCacheDelete;ListCache$4.prototype.get=listCacheGet;ListCache$4.prototype.has=listCacheHas;ListCache$4.prototype.set=listCacheSet;var _ListCache=ListCache$4,ListCache$3=_ListCache;function stackClear$1(){this.__data__=new ListCache$3,this.size=0}var _stackClear=stackClear$1;function stackDelete$1(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var _stackDelete=stackDelete$1;function stackGet$1(e){return this.__data__.get(e)}var _stackGet=stackGet$1;function stackHas$1(e){return this.__data__.has(e)}var _stackHas=stackHas$1;function isObject$4(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var isObject_1=isObject$4,baseGetTag$3=_baseGetTag,isObject$3=isObject_1,asyncTag="[object AsyncFunction]",funcTag$1="[object Function]",genTag="[object GeneratorFunction]",proxyTag="[object Proxy]";function isFunction$2(e){if(!isObject$3(e))return!1;var t=baseGetTag$3(e);return t==funcTag$1||t==genTag||t==asyncTag||t==proxyTag}var isFunction_1=isFunction$2,root$6=_root,coreJsData$1=root$6["__core-js_shared__"],_coreJsData=coreJsData$1,coreJsData=_coreJsData,maskSrcKey=function(){var e=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function isMasked$1(e){return!!maskSrcKey&&maskSrcKey in e}var _isMasked=isMasked$1,funcProto$1=Function.prototype,funcToString$1=funcProto$1.toString;function toSource$2(e){if(e!=null){try{return funcToString$1.call(e)}catch{}try{return e+""}catch{}}return""}var _toSource=toSource$2,isFunction$1=isFunction_1,isMasked=_isMasked,isObject$2=isObject_1,toSource$1=_toSource,reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto=Function.prototype,objectProto$9=Object.prototype,funcToString=funcProto.toString,hasOwnProperty$7=objectProto$9.hasOwnProperty,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty$7).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative$1(e){if(!isObject$2(e)||isMasked(e))return!1;var t=isFunction$1(e)?reIsNative:reIsHostCtor;return t.test(toSource$1(e))}var _baseIsNative=baseIsNative$1;function getValue$1(e,t){return e==null?void 0:e[t]}var _getValue=getValue$1,baseIsNative=_baseIsNative,getValue=_getValue;function getNative$7(e,t){var r=getValue(e,t);return baseIsNative(r)?r:void 0}var _getNative=getNative$7,getNative$6=_getNative,root$5=_root,Map$4=getNative$6(root$5,"Map"),_Map=Map$4,getNative$5=_getNative,nativeCreate$4=getNative$5(Object,"create"),_nativeCreate=nativeCreate$4,nativeCreate$3=_nativeCreate;function hashClear$1(){this.__data__=nativeCreate$3?nativeCreate$3(null):{},this.size=0}var _hashClear=hashClear$1;function hashDelete$1(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var _hashDelete=hashDelete$1,nativeCreate$2=_nativeCreate,HASH_UNDEFINED$2="__lodash_hash_undefined__",objectProto$8=Object.prototype,hasOwnProperty$6=objectProto$8.hasOwnProperty;function hashGet$1(e){var t=this.__data__;if(nativeCreate$2){var r=t[e];return r===HASH_UNDEFINED$2?void 0:r}return hasOwnProperty$6.call(t,e)?t[e]:void 0}var _hashGet=hashGet$1,nativeCreate$1=_nativeCreate,objectProto$7=Object.prototype,hasOwnProperty$5=objectProto$7.hasOwnProperty;function hashHas$1(e){var t=this.__data__;return nativeCreate$1?t[e]!==void 0:hasOwnProperty$5.call(t,e)}var _hashHas=hashHas$1,nativeCreate=_nativeCreate,HASH_UNDEFINED$1="__lodash_hash_undefined__";function hashSet$1(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=nativeCreate&&t===void 0?HASH_UNDEFINED$1:t,this}var _hashSet=hashSet$1,hashClear=_hashClear,hashDelete=_hashDelete,hashGet=_hashGet,hashHas=_hashHas,hashSet=_hashSet;function Hash$1(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Hash$1.prototype.clear=hashClear;Hash$1.prototype.delete=hashDelete;Hash$1.prototype.get=hashGet;Hash$1.prototype.has=hashHas;Hash$1.prototype.set=hashSet;var _Hash=Hash$1,Hash=_Hash,ListCache$2=_ListCache,Map$3=_Map;function mapCacheClear$1(){this.size=0,this.__data__={hash:new Hash,map:new(Map$3||ListCache$2),string:new Hash}}var _mapCacheClear=mapCacheClear$1;function isKeyable$1(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var _isKeyable=isKeyable$1,isKeyable=_isKeyable;function getMapData$4(e,t){var r=e.__data__;return isKeyable(t)?r[typeof t=="string"?"string":"hash"]:r.map}var _getMapData=getMapData$4,getMapData$3=_getMapData;function mapCacheDelete$1(e){var t=getMapData$3(this,e).delete(e);return this.size-=t?1:0,t}var _mapCacheDelete=mapCacheDelete$1,getMapData$2=_getMapData;function mapCacheGet$1(e){return getMapData$2(this,e).get(e)}var _mapCacheGet=mapCacheGet$1,getMapData$1=_getMapData;function mapCacheHas$1(e){return getMapData$1(this,e).has(e)}var _mapCacheHas=mapCacheHas$1,getMapData=_getMapData;function mapCacheSet$1(e,t){var r=getMapData(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}var _mapCacheSet=mapCacheSet$1,mapCacheClear=_mapCacheClear,mapCacheDelete=_mapCacheDelete,mapCacheGet=_mapCacheGet,mapCacheHas=_mapCacheHas,mapCacheSet=_mapCacheSet;function MapCache$3(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}MapCache$3.prototype.clear=mapCacheClear;MapCache$3.prototype.delete=mapCacheDelete;MapCache$3.prototype.get=mapCacheGet;MapCache$3.prototype.has=mapCacheHas;MapCache$3.prototype.set=mapCacheSet;var _MapCache=MapCache$3,ListCache$1=_ListCache,Map$2=_Map,MapCache$2=_MapCache,LARGE_ARRAY_SIZE=200;function stackSet$1(e,t){var r=this.__data__;if(r instanceof ListCache$1){var n=r.__data__;if(!Map$2||n.length<LARGE_ARRAY_SIZE-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new MapCache$2(n)}return r.set(e,t),this.size=r.size,this}var _stackSet=stackSet$1,ListCache=_ListCache,stackClear=_stackClear,stackDelete=_stackDelete,stackGet=_stackGet,stackHas=_stackHas,stackSet=_stackSet;function Stack$2(e){var t=this.__data__=new ListCache(e);this.size=t.size}Stack$2.prototype.clear=stackClear;Stack$2.prototype.delete=stackDelete;Stack$2.prototype.get=stackGet;Stack$2.prototype.has=stackHas;Stack$2.prototype.set=stackSet;var _Stack=Stack$2,HASH_UNDEFINED="__lodash_hash_undefined__";function setCacheAdd$1(e){return this.__data__.set(e,HASH_UNDEFINED),this}var _setCacheAdd=setCacheAdd$1;function setCacheHas$1(e){return this.__data__.has(e)}var _setCacheHas=setCacheHas$1,MapCache$1=_MapCache,setCacheAdd=_setCacheAdd,setCacheHas=_setCacheHas;function SetCache$1(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new MapCache$1;++t<r;)this.add(e[t])}SetCache$1.prototype.add=SetCache$1.prototype.push=setCacheAdd;SetCache$1.prototype.has=setCacheHas;var _SetCache=SetCache$1;function arraySome$1(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var _arraySome=arraySome$1;function cacheHas$1(e,t){return e.has(t)}var _cacheHas=cacheHas$1,SetCache=_SetCache,arraySome=_arraySome,cacheHas=_cacheHas,COMPARE_PARTIAL_FLAG$5=1,COMPARE_UNORDERED_FLAG$3=2;function equalArrays$2(e,t,r,n,a,s){var o=r&COMPARE_PARTIAL_FLAG$5,l=e.length,f=t.length;if(l!=f&&!(o&&f>l))return!1;var h=s.get(e),c=s.get(t);if(h&&c)return h==t&&c==e;var u=-1,d=!0,g=r&COMPARE_UNORDERED_FLAG$3?new SetCache:void 0;for(s.set(e,t),s.set(t,e);++u<l;){var p=e[u],m=t[u];if(n)var y=o?n(m,p,u,t,e,s):n(p,m,u,e,t,s);if(y!==void 0){if(y)continue;d=!1;break}if(g){if(!arraySome(t,function(x,E){if(!cacheHas(g,E)&&(p===x||a(p,x,r,n,s)))return g.push(E)})){d=!1;break}}else if(!(p===m||a(p,m,r,n,s))){d=!1;break}}return s.delete(e),s.delete(t),d}var _equalArrays=equalArrays$2,root$4=_root,Uint8Array$2=root$4.Uint8Array,_Uint8Array=Uint8Array$2;function mapToArray$1(e){var t=-1,r=Array(e.size);return e.forEach(function(n,a){r[++t]=[a,n]}),r}var _mapToArray=mapToArray$1;function setToArray$1(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var _setToArray=setToArray$1,Symbol$3=_Symbol,Uint8Array$1=_Uint8Array,eq$1=eq_1,equalArrays$1=_equalArrays,mapToArray=_mapToArray,setToArray=_setToArray,COMPARE_PARTIAL_FLAG$4=1,COMPARE_UNORDERED_FLAG$2=2,boolTag$1="[object Boolean]",dateTag$1="[object Date]",errorTag$1="[object Error]",mapTag$2="[object Map]",numberTag$1="[object Number]",regexpTag$1="[object RegExp]",setTag$2="[object Set]",stringTag$1="[object String]",symbolTag="[object Symbol]",arrayBufferTag$1="[object ArrayBuffer]",dataViewTag$2="[object DataView]",symbolProto$1=Symbol$3?Symbol$3.prototype:void 0,symbolValueOf=symbolProto$1?symbolProto$1.valueOf:void 0;function equalByTag$1(e,t,r,n,a,s,o){switch(r){case dataViewTag$2:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case arrayBufferTag$1:return!(e.byteLength!=t.byteLength||!s(new Uint8Array$1(e),new Uint8Array$1(t)));case boolTag$1:case dateTag$1:case numberTag$1:return eq$1(+e,+t);case errorTag$1:return e.name==t.name&&e.message==t.message;case regexpTag$1:case stringTag$1:return e==t+"";case mapTag$2:var l=mapToArray;case setTag$2:var f=n&COMPARE_PARTIAL_FLAG$4;if(l||(l=setToArray),e.size!=t.size&&!f)return!1;var h=o.get(e);if(h)return h==t;n|=COMPARE_UNORDERED_FLAG$2,o.set(e,t);var c=equalArrays$1(l(e),l(t),n,a,s,o);return o.delete(e),c;case symbolTag:if(symbolValueOf)return symbolValueOf.call(e)==symbolValueOf.call(t)}return!1}var _equalByTag=equalByTag$1;function arrayPush$2(e,t){for(var r=-1,n=t.length,a=e.length;++r<n;)e[a+r]=t[r];return e}var _arrayPush=arrayPush$2,isArray$a=Array.isArray,isArray_1=isArray$a,arrayPush$1=_arrayPush,isArray$9=isArray_1;function baseGetAllKeys$1(e,t,r){var n=t(e);return isArray$9(e)?n:arrayPush$1(n,r(e))}var _baseGetAllKeys=baseGetAllKeys$1;function arrayFilter$1(e,t){for(var r=-1,n=e==null?0:e.length,a=0,s=[];++r<n;){var o=e[r];t(o,r,e)&&(s[a++]=o)}return s}var _arrayFilter=arrayFilter$1;function stubArray$1(){return[]}var stubArray_1=stubArray$1,arrayFilter=_arrayFilter,stubArray=stubArray_1,objectProto$6=Object.prototype,propertyIsEnumerable$1=objectProto$6.propertyIsEnumerable,nativeGetSymbols=Object.getOwnPropertySymbols,getSymbols$1=nativeGetSymbols?function(e){return e==null?[]:(e=Object(e),arrayFilter(nativeGetSymbols(e),function(t){return propertyIsEnumerable$1.call(e,t)}))}:stubArray,_getSymbols=getSymbols$1;function baseTimes$1(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var _baseTimes=baseTimes$1,baseGetTag$2=_baseGetTag,isObjectLike$3=isObjectLike_1,argsTag$2="[object Arguments]";function baseIsArguments$1(e){return isObjectLike$3(e)&&baseGetTag$2(e)==argsTag$2}var _baseIsArguments=baseIsArguments$1,baseIsArguments=_baseIsArguments,isObjectLike$2=isObjectLike_1,objectProto$5=Object.prototype,hasOwnProperty$4=objectProto$5.hasOwnProperty,propertyIsEnumerable=objectProto$5.propertyIsEnumerable,isArguments$3=baseIsArguments(function(){return arguments}())?baseIsArguments:function(e){return isObjectLike$2(e)&&hasOwnProperty$4.call(e,"callee")&&!propertyIsEnumerable.call(e,"callee")},isArguments_1=isArguments$3,isBuffer$2={exports:{}};function stubFalse(){return!1}var stubFalse_1=stubFalse;isBuffer$2.exports;(function(e,t){var r=_root,n=stubFalse_1,a=t&&!t.nodeType&&t,s=a&&!0&&e&&!e.nodeType&&e,o=s&&s.exports===a,l=o?r.Buffer:void 0,f=l?l.isBuffer:void 0,h=f||n;e.exports=h})(isBuffer$2,isBuffer$2.exports);var isBufferExports=isBuffer$2.exports,MAX_SAFE_INTEGER$1=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex$3(e,t){var r=typeof e;return t=t??MAX_SAFE_INTEGER$1,!!t&&(r=="number"||r!="symbol"&&reIsUint.test(e))&&e>-1&&e%1==0&&e<t}var _isIndex=isIndex$3,MAX_SAFE_INTEGER=9007199254740991;function isLength$3(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=MAX_SAFE_INTEGER}var isLength_1=isLength$3,baseGetTag$1=_baseGetTag,isLength$2=isLength_1,isObjectLike$1=isObjectLike_1,argsTag$1="[object Arguments]",arrayTag$1="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",mapTag$1="[object Map]",numberTag="[object Number]",objectTag$2="[object Object]",regexpTag="[object RegExp]",setTag$1="[object Set]",stringTag="[object String]",weakMapTag$1="[object WeakMap]",arrayBufferTag="[object ArrayBuffer]",dataViewTag$1="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0;typedArrayTags[argsTag$1]=typedArrayTags[arrayTag$1]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag$1]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag$1]=typedArrayTags[numberTag]=typedArrayTags[objectTag$2]=typedArrayTags[regexpTag]=typedArrayTags[setTag$1]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag$1]=!1;function baseIsTypedArray$1(e){return isObjectLike$1(e)&&isLength$2(e.length)&&!!typedArrayTags[baseGetTag$1(e)]}var _baseIsTypedArray=baseIsTypedArray$1;function baseUnary$2(e){return function(t){return e(t)}}var _baseUnary=baseUnary$2,_nodeUtil={exports:{}};_nodeUtil.exports;(function(e,t){var r=_freeGlobal,n=t&&!t.nodeType&&t,a=n&&!0&&e&&!e.nodeType&&e,s=a&&a.exports===n,o=s&&r.process,l=function(){try{var f=a&&a.require&&a.require("util").types;return f||o&&o.binding&&o.binding("util")}catch{}}();e.exports=l})(_nodeUtil,_nodeUtil.exports);var _nodeUtilExports=_nodeUtil.exports,baseIsTypedArray=_baseIsTypedArray,baseUnary$1=_baseUnary,nodeUtil=_nodeUtilExports,nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray,isTypedArray$2=nodeIsTypedArray?baseUnary$1(nodeIsTypedArray):baseIsTypedArray,isTypedArray_1=isTypedArray$2,baseTimes=_baseTimes,isArguments$2=isArguments_1,isArray$8=isArray_1,isBuffer$1=isBufferExports,isIndex$2=_isIndex,isTypedArray$1=isTypedArray_1,objectProto$4=Object.prototype,hasOwnProperty$3=objectProto$4.hasOwnProperty;function arrayLikeKeys$1(e,t){var r=isArray$8(e),n=!r&&isArguments$2(e),a=!r&&!n&&isBuffer$1(e),s=!r&&!n&&!a&&isTypedArray$1(e),o=r||n||a||s,l=o?baseTimes(e.length,String):[],f=l.length;for(var h in e)(t||hasOwnProperty$3.call(e,h))&&!(o&&(h=="length"||a&&(h=="offset"||h=="parent")||s&&(h=="buffer"||h=="byteLength"||h=="byteOffset")||isIndex$2(h,f)))&&l.push(h);return l}var _arrayLikeKeys=arrayLikeKeys$1,objectProto$3=Object.prototype;function isPrototype$1(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||objectProto$3;return e===r}var _isPrototype=isPrototype$1;function overArg$1(e,t){return function(r){return e(t(r))}}var _overArg=overArg$1,overArg=_overArg,nativeKeys$1=overArg(Object.keys,Object),_nativeKeys=nativeKeys$1,isPrototype=_isPrototype,nativeKeys=_nativeKeys,objectProto$2=Object.prototype,hasOwnProperty$2=objectProto$2.hasOwnProperty;function baseKeys$1(e){if(!isPrototype(e))return nativeKeys(e);var t=[];for(var r in Object(e))hasOwnProperty$2.call(e,r)&&r!="constructor"&&t.push(r);return t}var _baseKeys=baseKeys$1,isFunction=isFunction_1,isLength$1=isLength_1;function isArrayLike$4(e){return e!=null&&isLength$1(e.length)&&!isFunction(e)}var isArrayLike_1=isArrayLike$4,arrayLikeKeys=_arrayLikeKeys,baseKeys=_baseKeys,isArrayLike$3=isArrayLike_1;function keys$3(e){return isArrayLike$3(e)?arrayLikeKeys(e):baseKeys(e)}var keys_1=keys$3,baseGetAllKeys=_baseGetAllKeys,getSymbols=_getSymbols,keys$2=keys_1;function getAllKeys$1(e){return baseGetAllKeys(e,keys$2,getSymbols)}var _getAllKeys=getAllKeys$1,getAllKeys=_getAllKeys,COMPARE_PARTIAL_FLAG$3=1,objectProto$1=Object.prototype,hasOwnProperty$1=objectProto$1.hasOwnProperty;function equalObjects$1(e,t,r,n,a,s){var o=r&COMPARE_PARTIAL_FLAG$3,l=getAllKeys(e),f=l.length,h=getAllKeys(t),c=h.length;if(f!=c&&!o)return!1;for(var u=f;u--;){var d=l[u];if(!(o?d in t:hasOwnProperty$1.call(t,d)))return!1}var g=s.get(e),p=s.get(t);if(g&&p)return g==t&&p==e;var m=!0;s.set(e,t),s.set(t,e);for(var y=o;++u<f;){d=l[u];var x=e[d],E=t[d];if(n)var _=o?n(E,x,d,t,e,s):n(x,E,d,e,t,s);if(!(_===void 0?x===E||a(x,E,r,n,s):_)){m=!1;break}y||(y=d=="constructor")}if(m&&!y){var w=e.constructor,M=t.constructor;w!=M&&"constructor"in e&&"constructor"in t&&!(typeof w=="function"&&w instanceof w&&typeof M=="function"&&M instanceof M)&&(m=!1)}return s.delete(e),s.delete(t),m}var _equalObjects=equalObjects$1,getNative$4=_getNative,root$3=_root,DataView$2=getNative$4(root$3,"DataView"),_DataView=DataView$2,getNative$3=_getNative,root$2=_root,Promise$2=getNative$3(root$2,"Promise"),_Promise=Promise$2,getNative$2=_getNative,root$1=_root,Set$2=getNative$2(root$1,"Set"),_Set=Set$2,getNative$1=_getNative,root=_root,WeakMap$1=getNative$1(root,"WeakMap"),_WeakMap=WeakMap$1,DataView$1=_DataView,Map$1=_Map,Promise$1=_Promise,Set$1=_Set,WeakMap=_WeakMap,baseGetTag=_baseGetTag,toSource=_toSource,mapTag="[object Map]",objectTag$1="[object Object]",promiseTag="[object Promise]",setTag="[object Set]",weakMapTag="[object WeakMap]",dataViewTag="[object DataView]",dataViewCtorString=toSource(DataView$1),mapCtorString=toSource(Map$1),promiseCtorString=toSource(Promise$1),setCtorString=toSource(Set$1),weakMapCtorString=toSource(WeakMap),getTag$1=baseGetTag;(DataView$1&&getTag$1(new DataView$1(new ArrayBuffer(1)))!=dataViewTag||Map$1&&getTag$1(new Map$1)!=mapTag||Promise$1&&getTag$1(Promise$1.resolve())!=promiseTag||Set$1&&getTag$1(new Set$1)!=setTag||WeakMap&&getTag$1(new WeakMap)!=weakMapTag)&&(getTag$1=function(e){var t=baseGetTag(e),r=t==objectTag$1?e.constructor:void 0,n=r?toSource(r):"";if(n)switch(n){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return promiseTag;case setCtorString:return setTag;case weakMapCtorString:return weakMapTag}return t});var _getTag=getTag$1,Stack$1=_Stack,equalArrays=_equalArrays,equalByTag=_equalByTag,equalObjects=_equalObjects,getTag=_getTag,isArray$7=isArray_1,isBuffer=isBufferExports,isTypedArray=isTypedArray_1,COMPARE_PARTIAL_FLAG$2=1,argsTag="[object Arguments]",arrayTag="[object Array]",objectTag="[object Object]",objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;function baseIsEqualDeep$1(e,t,r,n,a,s){var o=isArray$7(e),l=isArray$7(t),f=o?arrayTag:getTag(e),h=l?arrayTag:getTag(t);f=f==argsTag?objectTag:f,h=h==argsTag?objectTag:h;var c=f==objectTag,u=h==objectTag,d=f==h;if(d&&isBuffer(e)){if(!isBuffer(t))return!1;o=!0,c=!1}if(d&&!c)return s||(s=new Stack$1),o||isTypedArray(e)?equalArrays(e,t,r,n,a,s):equalByTag(e,t,f,r,n,a,s);if(!(r&COMPARE_PARTIAL_FLAG$2)){var g=c&&hasOwnProperty.call(e,"__wrapped__"),p=u&&hasOwnProperty.call(t,"__wrapped__");if(g||p){var m=g?e.value():e,y=p?t.value():t;return s||(s=new Stack$1),a(m,y,r,n,s)}}return d?(s||(s=new Stack$1),equalObjects(e,t,r,n,a,s)):!1}var _baseIsEqualDeep=baseIsEqualDeep$1,baseIsEqualDeep=_baseIsEqualDeep,isObjectLike=isObjectLike_1;function baseIsEqual$2(e,t,r,n,a){return e===t?!0:e==null||t==null||!isObjectLike(e)&&!isObjectLike(t)?e!==e&&t!==t:baseIsEqualDeep(e,t,r,n,baseIsEqual$2,a)}var _baseIsEqual=baseIsEqual$2,Stack=_Stack,baseIsEqual$1=_baseIsEqual,COMPARE_PARTIAL_FLAG$1=1,COMPARE_UNORDERED_FLAG$1=2;function baseIsMatch$1(e,t,r,n){var a=r.length,s=a,o=!n;if(e==null)return!s;for(e=Object(e);a--;){var l=r[a];if(o&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++a<s;){l=r[a];var f=l[0],h=e[f],c=l[1];if(o&&l[2]){if(h===void 0&&!(f in e))return!1}else{var u=new Stack;if(n)var d=n(h,c,f,e,t,u);if(!(d===void 0?baseIsEqual$1(c,h,COMPARE_PARTIAL_FLAG$1|COMPARE_UNORDERED_FLAG$1,n,u):d))return!1}}return!0}var _baseIsMatch=baseIsMatch$1,isObject$1=isObject_1;function isStrictComparable$2(e){return e===e&&!isObject$1(e)}var _isStrictComparable=isStrictComparable$2,isStrictComparable$1=_isStrictComparable,keys$1=keys_1;function getMatchData$1(e){for(var t=keys$1(e),r=t.length;r--;){var n=t[r],a=e[n];t[r]=[n,a,isStrictComparable$1(a)]}return t}var _getMatchData=getMatchData$1;function matchesStrictComparable$2(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var _matchesStrictComparable=matchesStrictComparable$2,baseIsMatch=_baseIsMatch,getMatchData=_getMatchData,matchesStrictComparable$1=_matchesStrictComparable;function baseMatches$1(e){var t=getMatchData(e);return t.length==1&&t[0][2]?matchesStrictComparable$1(t[0][0],t[0][1]):function(r){return r===e||baseIsMatch(r,e,t)}}var _baseMatches=baseMatches$1,isArray$6=isArray_1,isSymbol$3=isSymbol_1,reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;function isKey$3(e,t){if(isArray$6(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||isSymbol$3(e)?!0:reIsPlainProp.test(e)||!reIsDeepProp.test(e)||t!=null&&e in Object(t)}var _isKey=isKey$3,MapCache=_MapCache,FUNC_ERROR_TEXT="Expected a function";function memoize$1(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(FUNC_ERROR_TEXT);var r=function(){var n=arguments,a=t?t.apply(this,n):n[0],s=r.cache;if(s.has(a))return s.get(a);var o=e.apply(this,n);return r.cache=s.set(a,o)||s,o};return r.cache=new(memoize$1.Cache||MapCache),r}memoize$1.Cache=MapCache;var memoize_1=memoize$1,memoize=memoize_1,MAX_MEMOIZE_SIZE=500;function memoizeCapped$1(e){var t=memoize(e,function(n){return r.size===MAX_MEMOIZE_SIZE&&r.clear(),n}),r=t.cache;return t}var _memoizeCapped=memoizeCapped$1,memoizeCapped=_memoizeCapped,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,stringToPath$1=memoizeCapped(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(rePropName,function(r,n,a,s){t.push(a?s.replace(reEscapeChar,"$1"):n||r)}),t}),_stringToPath=stringToPath$1;function arrayMap$2(e,t){for(var r=-1,n=e==null?0:e.length,a=Array(n);++r<n;)a[r]=t(e[r],r,e);return a}var _arrayMap=arrayMap$2,Symbol$2=_Symbol,arrayMap$1=_arrayMap,isArray$5=isArray_1,isSymbol$2=isSymbol_1,INFINITY$1=1/0,symbolProto=Symbol$2?Symbol$2.prototype:void 0,symbolToString=symbolProto?symbolProto.toString:void 0;function baseToString$1(e){if(typeof e=="string")return e;if(isArray$5(e))return arrayMap$1(e,baseToString$1)+"";if(isSymbol$2(e))return symbolToString?symbolToString.call(e):"";var t=e+"";return t=="0"&&1/e==-INFINITY$1?"-0":t}var _baseToString=baseToString$1,baseToString=_baseToString;function toString$1(e){return e==null?"":baseToString(e)}var toString_1=toString$1,isArray$4=isArray_1,isKey$2=_isKey,stringToPath=_stringToPath,toString=toString_1;function castPath$2(e,t){return isArray$4(e)?e:isKey$2(e,t)?[e]:stringToPath(toString(e))}var _castPath=castPath$2,isSymbol$1=isSymbol_1,INFINITY=1/0;function toKey$4(e){if(typeof e=="string"||isSymbol$1(e))return e;var t=e+"";return t=="0"&&1/e==-INFINITY?"-0":t}var _toKey=toKey$4,castPath$1=_castPath,toKey$3=_toKey;function baseGet$3(e,t){t=castPath$1(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[toKey$3(t[r++])];return r&&r==n?e:void 0}var _baseGet=baseGet$3,baseGet$2=_baseGet;function get$1(e,t,r){var n=e==null?void 0:baseGet$2(e,t);return n===void 0?r:n}var get_1=get$1;function baseHasIn$1(e,t){return e!=null&&t in Object(e)}var _baseHasIn=baseHasIn$1,castPath=_castPath,isArguments$1=isArguments_1,isArray$3=isArray_1,isIndex$1=_isIndex,isLength=isLength_1,toKey$2=_toKey;function hasPath$1(e,t,r){t=castPath(t,e);for(var n=-1,a=t.length,s=!1;++n<a;){var o=toKey$2(t[n]);if(!(s=e!=null&&r(e,o)))break;e=e[o]}return s||++n!=a?s:(a=e==null?0:e.length,!!a&&isLength(a)&&isIndex$1(o,a)&&(isArray$3(e)||isArguments$1(e)))}var _hasPath=hasPath$1,baseHasIn=_baseHasIn,hasPath=_hasPath;function hasIn$1(e,t){return e!=null&&hasPath(e,t,baseHasIn)}var hasIn_1=hasIn$1,baseIsEqual=_baseIsEqual,get=get_1,hasIn=hasIn_1,isKey$1=_isKey,isStrictComparable=_isStrictComparable,matchesStrictComparable=_matchesStrictComparable,toKey$1=_toKey,COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;function baseMatchesProperty$1(e,t){return isKey$1(e)&&isStrictComparable(t)?matchesStrictComparable(toKey$1(e),t):function(r){var n=get(r,e);return n===void 0&&n===t?hasIn(r,e):baseIsEqual(t,n,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG)}}var _baseMatchesProperty=baseMatchesProperty$1;function identity$4(e){return e}var identity_1=identity$4;function baseProperty$1(e){return function(t){return t==null?void 0:t[e]}}var _baseProperty=baseProperty$1,baseGet$1=_baseGet;function basePropertyDeep$1(e){return function(t){return baseGet$1(t,e)}}var _basePropertyDeep=basePropertyDeep$1,baseProperty=_baseProperty,basePropertyDeep=_basePropertyDeep,isKey=_isKey,toKey=_toKey;function property$1(e){return isKey(e)?baseProperty(toKey(e)):basePropertyDeep(e)}var property_1=property$1,baseMatches=_baseMatches,baseMatchesProperty=_baseMatchesProperty,identity$3=identity_1,isArray$2=isArray_1,property=property_1;function baseIteratee$3(e){return typeof e=="function"?e:e==null?identity$3:typeof e=="object"?isArray$2(e)?baseMatchesProperty(e[0],e[1]):baseMatches(e):property(e)}var _baseIteratee=baseIteratee$3;function baseLt$1(e,t){return e<t}var _baseLt=baseLt$1,baseExtremum$1=_baseExtremum,baseIteratee$2=_baseIteratee,baseLt=_baseLt;function minBy(e,t){return e&&e.length?baseExtremum$1(e,baseIteratee$2(t),baseLt):void 0}var minBy_1=minBy,minBy$1=getDefaultExportFromCjs(minBy_1);function baseGt$1(e,t){return e>t}var _baseGt=baseGt$1,baseExtremum=_baseExtremum,baseGt=_baseGt,baseIteratee$1=_baseIteratee;function maxBy(e,t){return e&&e.length?baseExtremum(e,baseIteratee$1(t),baseGt):void 0}var maxBy_1=maxBy,maxBy$1=getDefaultExportFromCjs(maxBy_1),Symbol$1=_Symbol,isArguments=isArguments_1,isArray$1=isArray_1,spreadableSymbol=Symbol$1?Symbol$1.isConcatSpreadable:void 0;function isFlattenable$1(e){return isArray$1(e)||isArguments(e)||!!(spreadableSymbol&&e&&e[spreadableSymbol])}var _isFlattenable=isFlattenable$1,arrayPush=_arrayPush,isFlattenable=_isFlattenable;function baseFlatten$1(e,t,r,n,a){var s=-1,o=e.length;for(r||(r=isFlattenable),a||(a=[]);++s<o;){var l=e[s];t>0&&r(l)?t>1?baseFlatten$1(l,t-1,r,n,a):arrayPush(a,l):n||(a[a.length]=l)}return a}var _baseFlatten=baseFlatten$1;function createBaseFor$1(e){return function(t,r,n){for(var a=-1,s=Object(t),o=n(t),l=o.length;l--;){var f=o[e?l:++a];if(r(s[f],f,s)===!1)break}return t}}var _createBaseFor=createBaseFor$1,createBaseFor=_createBaseFor,baseFor$1=createBaseFor(),_baseFor=baseFor$1,baseFor=_baseFor,keys=keys_1;function baseForOwn$1(e,t){return e&&baseFor(e,t,keys)}var _baseForOwn=baseForOwn$1,isArrayLike$2=isArrayLike_1;function createBaseEach$1(e,t){return function(r,n){if(r==null)return r;if(!isArrayLike$2(r))return e(r,n);for(var a=r.length,s=t?a:-1,o=Object(r);(t?s--:++s<a)&&n(o[s],s,o)!==!1;);return r}}var _createBaseEach=createBaseEach$1,baseForOwn=_baseForOwn,createBaseEach=_createBaseEach,baseEach$1=createBaseEach(baseForOwn),_baseEach=baseEach$1,baseEach=_baseEach,isArrayLike$1=isArrayLike_1;function baseMap$1(e,t){var r=-1,n=isArrayLike$1(e)?Array(e.length):[];return baseEach(e,function(a,s,o){n[++r]=t(a,s,o)}),n}var _baseMap=baseMap$1;function baseSortBy$1(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}var _baseSortBy=baseSortBy$1,isSymbol=isSymbol_1;function compareAscending$1(e,t){if(e!==t){var r=e!==void 0,n=e===null,a=e===e,s=isSymbol(e),o=t!==void 0,l=t===null,f=t===t,h=isSymbol(t);if(!l&&!h&&!s&&e>t||s&&o&&f&&!l&&!h||n&&o&&f||!r&&f||!a)return 1;if(!n&&!s&&!h&&e<t||h&&r&&a&&!n&&!s||l&&r&&a||!o&&a||!f)return-1}return 0}var _compareAscending=compareAscending$1,compareAscending=_compareAscending;function compareMultiple$1(e,t,r){for(var n=-1,a=e.criteria,s=t.criteria,o=a.length,l=r.length;++n<o;){var f=compareAscending(a[n],s[n]);if(f){if(n>=l)return f;var h=r[n];return f*(h=="desc"?-1:1)}}return e.index-t.index}var _compareMultiple=compareMultiple$1,arrayMap=_arrayMap,baseGet=_baseGet,baseIteratee=_baseIteratee,baseMap=_baseMap,baseSortBy=_baseSortBy,baseUnary=_baseUnary,compareMultiple=_compareMultiple,identity$2=identity_1,isArray=isArray_1;function baseOrderBy$1(e,t,r){t.length?t=arrayMap(t,function(s){return isArray(s)?function(o){return baseGet(o,s.length===1?s[0]:s)}:s}):t=[identity$2];var n=-1;t=arrayMap(t,baseUnary(baseIteratee));var a=baseMap(e,function(s,o,l){var f=arrayMap(t,function(h){return h(s)});return{criteria:f,index:++n,value:s}});return baseSortBy(a,function(s,o){return compareMultiple(s,o,r)})}var _baseOrderBy=baseOrderBy$1;function apply$1(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var _apply=apply$1,apply=_apply,nativeMax=Math.max;function overRest$1(e,t,r){return t=nativeMax(t===void 0?e.length-1:t,0),function(){for(var n=arguments,a=-1,s=nativeMax(n.length-t,0),o=Array(s);++a<s;)o[a]=n[t+a];a=-1;for(var l=Array(t+1);++a<t;)l[a]=n[a];return l[t]=r(o),apply(e,this,l)}}var _overRest=overRest$1;function constant$1(e){return function(){return e}}var constant_1=constant$1,getNative=_getNative,defineProperty$1=function(){try{var e=getNative(Object,"defineProperty");return e({},"",{}),e}catch{}}(),_defineProperty=defineProperty$1,constant=constant_1,defineProperty=_defineProperty,identity$1=identity_1,baseSetToString$1=defineProperty?function(e,t){return defineProperty(e,"toString",{configurable:!0,enumerable:!1,value:constant(t),writable:!0})}:identity$1,_baseSetToString=baseSetToString$1,HOT_COUNT=800,HOT_SPAN=16,nativeNow=Date.now;function shortOut$1(e){var t=0,r=0;return function(){var n=nativeNow(),a=HOT_SPAN-(n-r);if(r=n,a>0){if(++t>=HOT_COUNT)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var _shortOut=shortOut$1,baseSetToString=_baseSetToString,shortOut=_shortOut,setToString$1=shortOut(baseSetToString),_setToString=setToString$1,identity=identity_1,overRest=_overRest,setToString=_setToString;function baseRest$1(e,t){return setToString(overRest(e,t,identity),e+"")}var _baseRest=baseRest$1,eq=eq_1,isArrayLike=isArrayLike_1,isIndex=_isIndex,isObject=isObject_1;function isIterateeCall$1(e,t,r){if(!isObject(r))return!1;var n=typeof t;return(n=="number"?isArrayLike(r)&&isIndex(t,r.length):n=="string"&&t in r)?eq(r[t],e):!1}var _isIterateeCall=isIterateeCall$1,baseFlatten=_baseFlatten,baseOrderBy=_baseOrderBy,baseRest=_baseRest,isIterateeCall=_isIterateeCall,sortBy=baseRest(function(e,t){if(e==null)return[];var r=t.length;return r>1&&isIterateeCall(e,t[0],t[1])?t=[]:r>2&&isIterateeCall(t[0],t[1],t[2])&&(t=[t[0]]),baseOrderBy(e,baseFlatten(t,1),[])}),sortBy_1=sortBy,sortBy$1=getDefaultExportFromCjs(sortBy_1);let totalCount=0;async function combineTilesJimp(e,t,r,n){try{totalCount=e.length;const a=minBy$1(e,m=>m.x).x,s=minBy$1(e,m=>m.y).y,o=m=>({x:m.x-a,y:m.y-s,buffer:m.buffer}),l=sortBy$1(e.map(o),["y","x"]),f=1+maxBy$1(l,m=>m.x).x,h=1+maxBy$1(l,m=>m.y).y,c=t*f,u=r*h;let d=await Jimp.read(Buffer.from(l[0].buffer));return d.background(4294967295),d.resize(c,u),await(await CompositeImg(d,l,r,t,n)).getBufferAsync(Jimp.MIME_PNG)}catch(a){console.log(a)}}async function CompositeImg(e,t,r,n,a){try{let s=1;for(let o of t){let l=Buffer.from(o.buffer),f=o.y*r,h=o.x*n,c=await Jimp.read(l);e.composite(c,h,f),a({process:"combineTilesJimp",msg:"update",count:s,totalCount}),s++}return e}catch{}}onmessage=async function(e){const t=e.data;switch(t.function){case"manipulateImage":await manipulateImage(t);break;case"combineImages":await combineImages(t);break;case"weightMap":await weightMap(t);break}postMessage({process:"worker",msg:"complete"})};async function manipulateImage(e){let t=await imageUtils.manipulateImage(e.png,e.heightmapblurradius,e.sealevel,e.flipx,e.flipy,e.landscapeSize,e.isHeightmap);await saveImage(e.dirHandle,t,e.filename,"png"),postMessage({process:e.function,msg:"complete"})}async function combineImages(e){let t=await combineTilesJimp(e.objTiles.tiles,e.tileSize,e.tileSize,postMessage);await saveImage(e.dirHandle,t,e.filename,"png"),postMessage({process:e.function,msg:"complete"})}function weightMap(e){return new Promise(async(t,r)=>{let n=[0,0,0],a=[255,255,254],s=e.weight_data;for(let o of s){postMessage({process:e.function,msg:"update",name:o.name});let l=null,f=null;if(Array.isArray(o.color[0])){l=null,f=null,l=await imageUtils.loadImageFromArray(e.objTile.buffer),f=l.getPixelsArray();for(let d of o.color)for(let g=0;g<f.length;g++)JSON.stringify(f[g])===JSON.stringify(d)&&l.setPixel(g,a);f=l.getPixelsArray();for(let d=0;d<f.length;d++)JSON.stringify(f[d])!==JSON.stringify(a)&&l.setPixel(d,n);let c=await l.resize({width:e.landscapeSize,height:e.landscapeSize}).gaussianFilter({radius:e.weightmapblurradius}).toBuffer(),u=`weightmap_${o.name}_lat_${e.lat}_lng_${e.lng}.png`;await saveImage(e.dirHandle,c,u,"png")}else{l=await imageUtils.loadImageFromArray(e.objTile.buffer),f=l.getPixelsArray();for(let d=0;d<f.length;d++)JSON.stringify(f[d])===JSON.stringify(o.color)?l.setPixel(d,a):l.setPixel(d,n);let c=await l.resize({width:e.landscapeSize,height:e.landscapeSize}).gaussianFilter({radius:e.weightmapblurradius}).toBuffer(),u=`weightmap_${o.name}_lat_${e.lat}_lng_${e.lng}.png`;await saveImage(e.dirHandle,c,u,"png")}}postMessage({process:e.function,msg:"complete"}),t(!0)})}async function saveImage(e,t,r,n){let a=new Blob([t],{type:"image/"+n});await fileUtils.writeFileToDisk(e,r,a),postMessage({process:"saveImage",msg:"complete"})}
