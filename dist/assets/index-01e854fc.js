var UE=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var i1=(r,e,t)=>(UE(r,e,"read from private field"),t?t.call(r):e.get(r)),H1=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},j1=(r,e,t,n)=>(UE(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);var WC=(r,e,t)=>(UE(r,e,"access private method"),t);function _mergeNamespaces(r,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const o in n)if(o!=="default"&&!(o in r)){const a=Object.getOwnPropertyDescriptor(n,o);a&&Object.defineProperty(r,o,a.get?a:{enumerable:!0,get:()=>n[o]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();const styles="",all="";var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function getAugmentedNamespace(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var o=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return r[n]}})}),t}var mapboxGl$1={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(commonjsGlobal,function(){var t,n,o;function a(s,m){if(!t)t=m;else if(!n)n=m;else{var y="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+t+")(sharedChunk); ("+n+")(sharedChunk); self.onerror = null;",D={};t(D),o=m(D),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(o.workerUrl=window.URL.createObjectURL(new Blob([y],{type:"text/javascript"})))}}a(["exports"],function(s){var m=typeof self<"u"?self:{},y="2.15.0";let D;const W={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(D==null){const u=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{D={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):u}catch{D=u}}return D},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!W.API_URL)return null;try{const u=new URL(W.API_URL);return u.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":u.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Ee={supported:!1,testSupport:function(u){!ir&&Ht&&(Hr?Bn(u):dt=u)}};let dt,Ht,ir=!1,Hr=!1;function Bn(u){const c=u.createTexture();u.bindTexture(u.TEXTURE_2D,c);try{if(u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,Ht),u.isContextLost())return;Ee.supported=!0}catch{}u.deleteTexture(c),ir=!0}m.document&&(Ht=m.document.createElement("img"),Ht.onload=function(){dt&&Bn(dt),dt=null,Hr=!0},Ht.onerror=function(){ir=!0,dt=null},Ht.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Vn="01";function Wr(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var ps=il;function il(u,c,h,w){this.cx=3*u,this.bx=3*(h-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*c,this.by=3*(w-c)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=c,this.p2x=h,this.p2y=w}il.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,c){if(c===void 0&&(c=1e-6),u<0)return 0;if(u>1)return 1;for(var h=u,w=0;w<8;w++){var T=this.sampleCurveX(h)-u;if(Math.abs(T)<c)return h;var F=this.sampleCurveDerivativeX(h);if(Math.abs(F)<1e-6)break;h-=T/F}var Y=0,ut=1;for(h=u,w=0;w<20&&(T=this.sampleCurveX(h),!(Math.abs(T-u)<c));w++)u>T?Y=h:ut=h,h=.5*(ut-Y)+Y;return h},solve:function(u,c){return this.sampleCurveY(this.solveCurveX(u,c))}};var gl=Wr(ps),ml=sl;function sl(u,c){this.x=u,this.y=c}sl.prototype={clone:function(){return new sl(this.x,this.y)},add:function(u){return this.clone()._add(u)},sub:function(u){return this.clone()._sub(u)},multByPoint:function(u){return this.clone()._multByPoint(u)},divByPoint:function(u){return this.clone()._divByPoint(u)},mult:function(u){return this.clone()._mult(u)},div:function(u){return this.clone()._div(u)},rotate:function(u){return this.clone()._rotate(u)},rotateAround:function(u,c){return this.clone()._rotateAround(u,c)},matMult:function(u){return this.clone()._matMult(u)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(u){return this.x===u.x&&this.y===u.y},dist:function(u){return Math.sqrt(this.distSqr(u))},distSqr:function(u){var c=u.x-this.x,h=u.y-this.y;return c*c+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith:function(u){return this.angleWithSep(u.x,u.y)},angleWithSep:function(u,c){return Math.atan2(this.x*c-this.y*u,this.x*u+this.y*c)},_matMult:function(u){var c=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=c,this},_add:function(u){return this.x+=u.x,this.y+=u.y,this},_sub:function(u){return this.x-=u.x,this.y-=u.y,this},_mult:function(u){return this.x*=u,this.y*=u,this},_div:function(u){return this.x/=u,this.y/=u,this},_multByPoint:function(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint:function(u){return this.x/=u.x,this.y/=u.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var u=this.y;return this.y=this.x,this.x=-u,this},_rotate:function(u){var c=Math.cos(u),h=Math.sin(u),w=h*this.x+c*this.y;return this.x=c*this.x-h*this.y,this.y=w,this},_rotateAround:function(u,c){var h=Math.cos(u),w=Math.sin(u),T=c.y+w*(this.x-c.x)+h*(this.y-c.y);return this.x=c.x+h*(this.x-c.x)-w*(this.y-c.y),this.y=T,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},sl.convert=function(u){return u instanceof sl?u:Array.isArray(u)?new sl(u[0],u[1]):u};var ll=Wr(ml);const rl=Math.PI/180,th=180/Math.PI;function nh(u){return u*rl}function bh(u){return u*th}const Fh=[[0,0],[1,0],[1,1],[0,1]];function Bh(u){if(u<=0)return 0;if(u>=1)return 1;const c=u*u,h=c*u;return 4*(u<.5?h:3*(u-c)+h-.75)}function Ed(u,c,h,w){const T=new gl(u,c,h,w);return function(F){return T.solve(F)}}const Td=Ed(.25,.1,.25,1);function td(u,c,h){return Math.min(h,Math.max(c,u))}function Fd(u,c,h){return(h=td((h-u)/(c-u),0,1))*h*(3-2*h)}function Ld(u,c,h){const w=h-c,T=((u-c)%w+w)%w+c;return T===c?h:T}function Ud(u,c,h){if(!u.length)return h(null,[]);let w=u.length;const T=new Array(u.length);let F=null;u.forEach((Y,ut)=>{c(Y,(di,yi)=>{di&&(F=di),T[ut]=yi,--w==0&&h(F,T)})})}function Xd(u){const c=[];for(const h in u)c.push(u[h]);return c}function wd(u,...c){for(const h of c)for(const w in h)u[w]=h[w];return u}let zd=1;function Rd(){return zd++}function op(){return function u(c){return c?(c^Math.random()*(16>>c/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,u)}()}function Wd(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))}function Op(u){return!!u&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(u)}function ep(u,c){u.forEach(h=>{c[h]&&(c[h]=c[h].bind(c))})}function zp(u,c){return u.indexOf(c,u.length-c.length)!==-1}function Kd(u,c,h){const w={};for(const T in u)w[T]=c.call(h||this,u[T],T,u);return w}function Ap(u,c,h){const w={};for(const T in u)c.call(h||this,u[T],T,u)&&(w[T]=u[T]);return w}function Ip(u){return Array.isArray(u)?u.map(Ip):typeof u=="object"&&u?Kd(u,Ip):u}const Yh={};function Ad(u){Yh[u]||(typeof console<"u"&&console.warn(u),Yh[u]=!0)}function kp(u,c,h){return(h.y-u.y)*(c.x-u.x)>(c.y-u.y)*(h.x-u.x)}function up(u){let c=0;for(let h,w,T=0,F=u.length,Y=F-1;T<F;Y=T++)h=u[T],w=u[Y],c+=(w.x-h.x)*(h.y+w.y);return c}function rp(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function fd(u){const c={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(h,w,T,F)=>{const Y=T||F;return c[w]=!Y||Y.toLowerCase(),""}),c["max-age"]){const h=parseInt(c["max-age"],10);isNaN(h)?delete c["max-age"]:c["max-age"]=h}return c}let Cp=null;function Fp(u){if(Cp==null){const c=u.navigator?u.navigator.userAgent:null;Cp=!!u.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return Cp}function _p(u){try{const c=m[u];return c.setItem("_mapbox_test_",1),c.removeItem("_mapbox_test_"),!0}catch{return!1}}function kd(u,c){return[u[4*c],u[4*c+1],u[4*c+2],u[4*c+3]]}const $f="mapbox-tiles";let Uf=500,cd=50,cp,xp;function Ep(){try{return m.caches}catch{}}function Vp(){Ep()&&!cp&&(cp=m.caches.open($f))}function bd(u){const c=u.indexOf("?");if(c<0)return u;const h=function(T){const F=T.indexOf("?");return F>0?T.slice(F+1).split("&"):[]}(u),w=h.filter(T=>{const F=T.split("=");return F[0]==="language"||F[0]==="worldview"});return w.length?`${u.slice(0,c)}?${w.join("&")}`:u.slice(0,c)}let Yd=1/0;const np={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(np);class Up extends Error{constructor(c,h,w){h===401&&yl(w)&&(c+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(c),this.status=h,this.url=w}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Qp=rp()?()=>self.worker&&self.worker.referrer:()=>(m.location.protocol==="blob:"?m.parent:m).location.href,Rp=function(u,c){if(!(/^file:/.test(h=u.url)||/^file:/.test(Qp())&&!/^\w+:/.test(h))){if(m.fetch&&m.Request&&m.AbortController&&m.Request.prototype.hasOwnProperty("signal"))return function(w,T){const F=new m.AbortController,Y=new m.Request(w.url,{method:w.method||"GET",body:w.body,credentials:w.credentials,headers:w.headers,referrer:Qp(),referrerPolicy:w.referrerPolicy,signal:F.signal});let ut=!1,di=!1;const yi=(kn=Y.url).indexOf("sku=")>0&&yl(kn);var kn;w.type==="json"&&Y.headers.set("Accept","application/json");const So=(al,cl,eh)=>{if(di)return;if(al&&al.message!=="SecurityError"&&Ad(al.toString()),cl&&eh)return sa(cl);const fh=Date.now();m.fetch(Y).then(Ch=>{if(Ch.ok){const Gh=yi?Ch.clone():null;return sa(Ch,Gh,fh)}return T(new Up(Ch.statusText,Ch.status,w.url))}).catch(Ch=>{Ch.name!=="AbortError"&&T(new Error(`${Ch.message} ${w.url}`))})},sa=(al,cl,eh)=>{(w.type==="arrayBuffer"?al.arrayBuffer():w.type==="json"?al.json():al.text()).then(fh=>{di||(cl&&eh&&function(Ch,Gh,Eh){if(Vp(),!cp)return;const kh={status:Gh.status,statusText:Gh.statusText,headers:new m.Headers};Gh.headers.forEach((ud,sd)=>kh.headers.set(sd,ud));const jh=fd(Gh.headers.get("Cache-Control")||"");if(jh["no-store"])return;jh["max-age"]&&kh.headers.set("Expires",new Date(Eh+1e3*jh["max-age"]).toUTCString());const Hh=kh.headers.get("Expires");Hh&&(new Date(Hh).getTime()-Eh<42e4||function(ud,sd){if(xp===void 0)try{new Response(new ReadableStream),xp=!0}catch{xp=!1}xp?sd(ud.body):ud.blob().then(sd)}(Gh,ud=>{const sd=new m.Response(ud,kh);Vp(),cp&&cp.then(Cd=>Cd.put(bd(Ch.url),sd)).catch(Cd=>Ad(Cd.message))}))}(Y,cl,eh),ut=!0,T(null,fh,al.headers.get("Cache-Control"),al.headers.get("Expires")))}).catch(fh=>{di||T(new Error(fh.message))})};return yi?function(al,cl){if(Vp(),!cp)return cl(null);const eh=bd(al.url);cp.then(fh=>{fh.match(eh).then(Ch=>{const Gh=function(Eh){if(!Eh)return!1;const kh=new Date(Eh.headers.get("Expires")||0),jh=fd(Eh.headers.get("Cache-Control")||"");return kh>Date.now()&&!jh["no-cache"]}(Ch);fh.delete(eh),Gh&&fh.put(eh,Ch.clone()),cl(null,Ch,Gh)}).catch(cl)}).catch(cl)}(Y,So):So(null,null),{cancel:()=>{di=!0,ut||F.abort()}}}(u,c);if(rp()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",u,c,void 0,!0)}var h;return function(w,T){const F=new m.XMLHttpRequest;F.open(w.method||"GET",w.url,!0),w.type==="arrayBuffer"&&(F.responseType="arraybuffer");for(const Y in w.headers)F.setRequestHeader(Y,w.headers[Y]);return w.type==="json"&&(F.responseType="text",F.setRequestHeader("Accept","application/json")),F.withCredentials=w.credentials==="include",F.onerror=()=>{T(new Error(F.statusText))},F.onload=()=>{if((F.status>=200&&F.status<300||F.status===0)&&F.response!==null){let Y=F.response;if(w.type==="json")try{Y=JSON.parse(F.response)}catch(ut){return T(ut)}T(null,Y,F.getResponseHeader("Cache-Control"),F.getResponseHeader("Expires"))}else T(new Up(F.statusText,F.status,w.url))},F.send(w.body),{cancel:()=>F.abort()}}(u,c)},ng=function(u,c){return Rp(wd(u,{type:"arrayBuffer"}),c)};function bg(u){const c=m.document.createElement("a");return c.href=u,c.protocol===m.document.location.protocol&&c.host===m.document.location.host}const Ih="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let rh,sh;rh=[],sh=0;const oh=function(u,c){if(Ee.supported&&(u.headers||(u.headers={}),u.headers.accept="image/webp,*/*"),sh>=W.MAX_PARALLEL_IMAGE_REQUESTS){const F={requestParameters:u,callback:c,cancelled:!1,cancel(){this.cancelled=!0}};return rh.push(F),F}sh++;let h=!1;const w=()=>{if(!h)for(h=!0,sh--;rh.length&&sh<W.MAX_PARALLEL_IMAGE_REQUESTS;){const F=rh.shift(),{requestParameters:Y,callback:ut,cancelled:di}=F;di||(F.cancel=oh(Y,ut).cancel)}},T=ng(u,(F,Y,ut,di)=>{w(),F?c(F):Y&&(m.createImageBitmap?function(yi,kn){const So=new m.Blob([new Uint8Array(yi)],{type:"image/png"});m.createImageBitmap(So).then(sa=>{kn(null,sa)}).catch(sa=>{kn(new Error(`Could not load image because of ${sa.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(Y,(yi,kn)=>c(yi,kn,ut,di)):function(yi,kn){const So=new m.Image,sa=m.URL;So.onload=()=>{kn(null,So),sa.revokeObjectURL(So.src),So.onload=null,m.requestAnimationFrame(()=>{So.src=Ih})},So.onerror=()=>kn(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const al=new m.Blob([new Uint8Array(yi)],{type:"image/png"});So.src=yi.byteLength?sa.createObjectURL(al):Ih}(Y,(yi,kn)=>c(yi,kn,ut,di)))});return{cancel:()=>{T.cancel(),w()}}},Dh="NO_ACCESS_TOKEN";function $h(u){return u.indexOf("mapbox:")===0}function yl(u){return W.API_URL_REGEX.test(u)}function gs(u){return W.API_CDN_URL_REGEX.test(u)}function Cr(u){return W.API_STYLE_REGEX.test(u)&&!fs(u)}function fs(u){return W.API_SPRITE_REGEX.test(u)}const ul=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ih(u){const c=u.match(ul);if(!c)throw new Error("Unable to parse URL object");return{protocol:c[1],authority:c[2],path:c[3]||"/",params:c[4]?c[4].split("&"):[]}}function ch(u){const c=u.params.length?`?${u.params.join("&")}`:"";return`${u.protocol}://${u.authority}${u.path}${c}`}const vh="mapbox.eventData";function Th(u){if(!u)return null;const c=u.split(".");if(!c||c.length!==3)return null;try{return JSON.parse(decodeURIComponent(m.atob(c[1]).split("").map(h=>"%"+("00"+h.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Nh{constructor(c){this.type=c,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(c){const h=Th(W.ACCESS_TOKEN);let w="";return w=h&&h.u?m.btoa(encodeURIComponent(h.u).replace(/%([0-9A-F]{2})/g,(T,F)=>String.fromCharCode(+("0x"+F)))):W.ACCESS_TOKEN||"",c?`${vh}.${c}:${w}`:`${vh}:${w}`}fetchEventData(){const c=_p("localStorage"),h=this.getStorageKey(),w=this.getStorageKey("uuid");if(c)try{const T=m.localStorage.getItem(h);T&&(this.eventData=JSON.parse(T));const F=m.localStorage.getItem(w);F&&(this.anonId=F)}catch{Ad("Unable to read from LocalStorage")}}saveEventData(){const c=_p("localStorage"),h=this.getStorageKey(),w=this.getStorageKey("uuid");if(c)try{m.localStorage.setItem(w,this.anonId),Object.keys(this.eventData).length>=1&&m.localStorage.setItem(h,JSON.stringify(this.eventData))}catch{Ad("Unable to write to LocalStorage")}}processRequests(c){}postEvent(c,h,w,T){if(!W.EVENTS_URL)return;const F=ih(W.EVENTS_URL);F.params.push(`access_token=${T||W.ACCESS_TOKEN||""}`);const Y={event:this.type,created:new Date(c).toISOString()},ut=h?wd(Y,h):Y,di={url:ch(F),headers:{"Content-Type":"text/plain"},body:JSON.stringify([ut])};this.pendingRequest=function(yi,kn){return Rp(wd(yi,{method:"POST"}),kn)}(di,yi=>{this.pendingRequest=null,w(yi),this.saveEventData(),this.processRequests(T)})}queueRequest(c,h){this.queue.push(c),this.processRequests(h)}}const Qh=new class extends Nh{constructor(u){super("appUserTurnstile"),this._customAccessToken=u}postTurnstileEvent(u,c){W.EVENTS_URL&&W.ACCESS_TOKEN&&Array.isArray(u)&&u.some(h=>$h(h)||yl(h))&&this.queueRequest(Date.now(),c)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const c=Th(W.ACCESS_TOKEN),h=c?c.u:W.ACCESS_TOKEN;let w=h!==this.eventData.tokenU;Op(this.anonId)||(this.anonId=op(),w=!0);const T=this.queue.shift();if(this.eventData.lastSuccess){const F=new Date(this.eventData.lastSuccess),Y=new Date(T),ut=(T-this.eventData.lastSuccess)/864e5;w=w||ut>=1||ut<-1||F.getDate()!==Y.getDate()}else w=!0;w?this.postEvent(T,{sdkIdentifier:"mapbox-gl-js",sdkVersion:y,skuId:Vn,"enabled.telemetry":!1,userId:this.anonId},F=>{F||(this.eventData.lastSuccess=T,this.eventData.tokenU=h)},u):this.processRequests()}},rd=Qh.postTurnstileEvent.bind(Qh),_d=new class extends Nh{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(u,c,h,w){this.skuToken=c,this.errorCb=w,W.EVENTS_URL&&(h||W.ACCESS_TOKEN?this.queueRequest({id:u,timestamp:Date.now()},h):this.errorCb(new Error(Dh)))}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{id:c,timestamp:h}=this.queue.shift();c&&this.success[c]||(this.anonId||this.fetchEventData(),Op(this.anonId)||(this.anonId=op()),this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:y,skuId:Vn,skuToken:this.skuToken,userId:this.anonId},w=>{w?this.errorCb(w):c&&(this.success[c]=!0)},u))}},ip=_d.postMapLoadEvent.bind(_d),Dp=new class extends Nh{constructor(){super("gljs.performance")}postPerformanceEvent(u,c){W.EVENTS_URL&&(u||W.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:c},u)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:c,performanceData:h}=this.queue.shift(),w=function(T){const F=m.performance.getEntriesByType("resource"),Y=m.performance.getEntriesByType("mark"),ut=function(sa){const al={};if(sa){for(const cl in sa)if(cl!=="other")for(const eh of sa[cl]){const fh=`${cl}ResolveRangeMin`,Ch=`${cl}ResolveRangeMax`,Gh=`${cl}RequestCount`,Eh=`${cl}RequestCachedCount`;al[fh]=Math.min(al[fh]||1/0,eh.startTime),al[Ch]=Math.max(al[Ch]||-1/0,eh.responseEnd);const kh=jh=>{al[jh]===void 0&&(al[jh]=0),++al[jh]};eh.transferSize!==void 0&&eh.transferSize===0&&kh(Eh),kh(Gh)}}return al}(function(sa,al){const cl={};if(sa)for(const eh of sa){const fh=al(eh);cl[fh]===void 0&&(cl[fh]=[]),cl[fh].push(eh)}return cl}(F,dg)),di=m.devicePixelRatio,yi=m.navigator.connection||m.navigator.mozConnection||m.navigator.webkitConnection,kn={counters:[],metadata:[],attributes:[]},So=(sa,al,cl)=>{cl!=null&&sa.push({name:al,value:cl.toString()})};for(const sa in ut)So(kn.counters,sa,ut[sa]);if(T.interactionRange[0]!==1/0&&T.interactionRange[1]!==-1/0&&(So(kn.counters,"interactionRangeMin",T.interactionRange[0]),So(kn.counters,"interactionRangeMax",T.interactionRange[1])),Y)for(const sa of Object.keys(Vf)){const al=Vf[sa],cl=Y.find(eh=>eh.name===al);cl&&So(kn.counters,al,cl.startTime)}return So(kn.counters,"visibilityHidden",T.visibilityHidden),So(kn.attributes,"style",function(sa){if(sa)for(const al of sa){const cl=al.name.split("?")[0];if(Cr(cl)){const eh=cl.split("/").slice(-2);if(eh.length===2)return`mapbox://styles/${eh[0]}/${eh[1]}`}}}(F)),So(kn.attributes,"terrainEnabled",T.terrainEnabled?"true":"false"),So(kn.attributes,"fogEnabled",T.fogEnabled?"true":"false"),So(kn.attributes,"projection",T.projection),So(kn.attributes,"zoom",T.zoom),So(kn.metadata,"devicePixelRatio",di),So(kn.metadata,"connectionEffectiveType",yi?yi.effectiveType:void 0),So(kn.metadata,"navigatorUserAgent",m.navigator.userAgent),So(kn.metadata,"screenWidth",m.screen.width),So(kn.metadata,"screenHeight",m.screen.height),So(kn.metadata,"windowWidth",m.innerWidth),So(kn.metadata,"windowHeight",m.innerHeight),So(kn.metadata,"mapWidth",T.width/di),So(kn.metadata,"mapHeight",T.height/di),So(kn.metadata,"webglRenderer",T.renderer),So(kn.metadata,"webglVendor",T.vendor),So(kn.metadata,"sdkVersion",y),So(kn.metadata,"sdkIdentifier","mapbox-gl-js"),kn}(h);for(const T of w.metadata);for(const T of w.counters);for(const T of w.attributes);this.postEvent(c,w,()=>{},u)}},qd=Dp.postPerformanceEvent.bind(Dp),wp=new class extends Nh{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(u,c,h,w){if(!W.API_URL||!W.SESSION_PATH)return;const T=ih(W.API_URL+W.SESSION_PATH);T.params.push(`sku=${c||""}`),T.params.push(`access_token=${w||W.ACCESS_TOKEN||""}`);const F={url:ch(T),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(Y,ut){return Rp(wd(Y,{method:"GET"}),ut)}(F,Y=>{this.pendingRequest=null,h(Y),this.saveEventData(),this.processRequests(w)})}getSessionAPI(u,c,h,w){this.skuToken=c,this.errorCb=w,W.SESSION_PATH&&W.API_URL&&(h||W.ACCESS_TOKEN?this.queueRequest({id:u,timestamp:Date.now()},h):this.errorCb(new Error(Dh)))}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{id:c,timestamp:h}=this.queue.shift();c&&this.success[c]||this.getSession(h,this.skuToken,w=>{w?this.errorCb(w):c&&(this.success[c]=!0)},u)}},pp=wp.getSessionAPI.bind(wp),Wp=new Set,Vf={create:"create",load:"load",fullLoad:"fullLoad"},Wf={mark(u){m.performance.mark(u)},measure(u,c,h){m.performance.measure(u,c,h)}};function dg(u){const c=u.name.split("?")[0];return gs(c)&&c.includes("mapbox-gl.js")?"javascript":gs(c)&&c.includes("mapbox-gl.css")?"css":function(h){return W.API_FONTS_REGEX.test(h)}(c)?"fontRange":fs(c)?"sprite":Cr(c)?"style":function(h){return W.API_TILEJSON_REGEX.test(h)}(c)?"tilejson":"other"}const Jp=m.performance;function Yp(u){const c=u?u.url.toString():void 0;return Jp.getEntriesByName(c)}let Cg,o_,Bg,Xg;const nm={now:()=>Bg!==void 0?Bg:m.performance.now(),setNow(u){Bg=u},restoreNow(){Bg=void 0},frame(u){const c=m.requestAnimationFrame(u);return{cancel:()=>m.cancelAnimationFrame(c)}},getImageData(u,c=0){const{width:h,height:w}=u;Xg||(Xg=m.document.createElement("canvas"));const T=Xg.getContext("2d",{willReadFrequently:!0});if(!T)throw new Error("failed to create canvas 2d context");return(h>Xg.width||w>Xg.height)&&(Xg.width=h,Xg.height=w),T.clearRect(-c,-c,h+2*c,w+2*c),T.drawImage(u,0,0,h,w),T.getImageData(-c,-c,h+2*c,w+2*c)},resolveURL:u=>(Cg||(Cg=m.document.createElement("a")),Cg.href=u,Cg.href),get devicePixelRatio(){return m.devicePixelRatio},get prefersReducedMotion(){return!!m.matchMedia&&(o_==null&&(o_=m.matchMedia("(prefers-reduced-motion: reduce)")),o_.matches)}};function ly(u,c,h){h[u]&&h[u].indexOf(c)!==-1||(h[u]=h[u]||[],h[u].push(c))}function xv(u,c,h){if(h&&h[u]){const w=h[u].indexOf(c);w!==-1&&h[u].splice(w,1)}}class Dg{constructor(c,h={}){wd(this,h),this.type=c}}class s_ extends Dg{constructor(c,h={}){super("error",wd({error:c},h))}}class f_{on(c,h){return this._listeners=this._listeners||{},ly(c,h,this._listeners),this}off(c,h){return xv(c,h,this._listeners),xv(c,h,this._oneTimeListeners),this}once(c,h){return h?(this._oneTimeListeners=this._oneTimeListeners||{},ly(c,h,this._oneTimeListeners),this):new Promise(w=>this.once(c,w))}fire(c,h){typeof c=="string"&&(c=new Dg(c,h||{}));const w=c.type;if(this.listens(w)){c.target=this;const T=this._listeners&&this._listeners[w]?this._listeners[w].slice():[];for(const ut of T)ut.call(this,c);const F=this._oneTimeListeners&&this._oneTimeListeners[w]?this._oneTimeListeners[w].slice():[];for(const ut of F)xv(w,ut,this._oneTimeListeners),ut.call(this,c);const Y=this._eventedParent;Y&&(wd(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),Y.fire(c))}else c instanceof s_&&console.error(c.error);return this}listens(c){return!!(this._listeners&&this._listeners[c]&&this._listeners[c].length>0||this._oneTimeListeners&&this._oneTimeListeners[c]&&this._oneTimeListeners[c].length>0||this._eventedParent&&this._eventedParent.listens(c))}setEventedParent(c,h){return this._eventedParent=c,this._eventedParentData=h,this}}var hd=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function g_(u,...c){for(const h of c)for(const w in h)u[w]=h[w];return u}function xg(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function hm(u){if(Array.isArray(u))return u.map(hm);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const c={};for(const h in u)c[h]=hm(u[h]);return c}return xg(u)}class xm extends Error{constructor(c,h){super(h),this.message=h,this.key=c}}var m_=xm;class wv{constructor(c,h=[]){this.parent=c,this.bindings={};for(const[w,T]of h)this.bindings[w]=T}concat(c){return new wv(this,c)}get(c){if(this.bindings[c])return this.bindings[c];if(this.parent)return this.parent.get(c);throw new Error(`${c} not found in scope.`)}has(c){return!!this.bindings[c]||!!this.parent&&this.parent.has(c)}}var W_=wv;const lg={kind:"null"},ap={kind:"number"},qf={kind:"string"},jf={kind:"boolean"},Wm={kind:"color"},__={kind:"object"},Kf={kind:"value"},qm={kind:"collator"},Ny={kind:"formatted"},ky={kind:"resolvedImage"};function a_(u,c){return{kind:"array",itemType:u,N:c}}function Lg(u){if(u.kind==="array"){const c=Lg(u.itemType);return typeof u.N=="number"?`array<${c}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${c}>`}return u.kind}const B0=[lg,ap,qf,jf,Wm,Ny,__,a_(Kf),ky];function E_(u,c){if(c.kind==="error")return null;if(u.kind==="array"){if(c.kind==="array"&&(c.N===0&&c.itemType.kind==="value"||!E_(u.itemType,c.itemType))&&(typeof u.N!="number"||u.N===c.N))return null}else{if(u.kind===c.kind)return null;if(u.kind==="value"){for(const h of B0)if(!E_(h,c))return null}}return`Expected ${Lg(u)} but found ${Lg(c)} instead.`}function By(u,c){return c.some(h=>h.kind===u.kind)}function bv(u,c){return c.some(h=>h==="null"?u===null:h==="array"?Array.isArray(u):h==="object"?u&&!Array.isArray(u)&&typeof u=="object":h===typeof u)}var G0,O_={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function cy(u){return(u=Math.round(u))<0?0:u>255?255:u}function Fm(u){return cy(u[u.length-1]==="%"?parseFloat(u)/100*255:parseInt(u))}function zy(u){return(c=u[u.length-1]==="%"?parseFloat(u)/100:parseFloat(u))<0?0:c>1?1:c;var c}function F_(u,c,h){return h<0?h+=1:h>1&&(h-=1),6*h<1?u+(c-u)*h*6:2*h<1?c:3*h<2?u+(c-u)*(2/3-h)*6:u}try{G0={}.parseCSSColor=function(u){var c,h=u.replace(/ /g,"").toLowerCase();if(h in O_)return O_[h].slice();if(h[0]==="#")return h.length===4?(c=parseInt(h.substr(1),16))>=0&&c<=4095?[(3840&c)>>4|(3840&c)>>8,240&c|(240&c)>>4,15&c|(15&c)<<4,1]:null:h.length===7&&(c=parseInt(h.substr(1),16))>=0&&c<=16777215?[(16711680&c)>>16,(65280&c)>>8,255&c,1]:null;var w=h.indexOf("("),T=h.indexOf(")");if(w!==-1&&T+1===h.length){var F=h.substr(0,w),Y=h.substr(w+1,T-(w+1)).split(","),ut=1;switch(F){case"rgba":if(Y.length!==4)return null;ut=zy(Y.pop());case"rgb":return Y.length!==3?null:[Fm(Y[0]),Fm(Y[1]),Fm(Y[2]),ut];case"hsla":if(Y.length!==4)return null;ut=zy(Y.pop());case"hsl":if(Y.length!==3)return null;var di=(parseFloat(Y[0])%360+360)%360/360,yi=zy(Y[1]),kn=zy(Y[2]),So=kn<=.5?kn*(yi+1):kn+yi-kn*yi,sa=2*kn-So;return[cy(255*F_(sa,So,di+1/3)),cy(255*F_(sa,So,di)),cy(255*F_(sa,So,di-1/3)),ut];default:return null}}return null}}catch{}class dm{constructor(c,h,w,T=1){this.r=c,this.g=h,this.b=w,this.a=T}static parse(c){if(!c)return;if(c instanceof dm)return c;if(typeof c!="string")return;const h=G0(c);return h?new dm(h[0]/255*h[3],h[1]/255*h[3],h[2]/255*h[3],h[3]):void 0}toString(){const[c,h,w,T]=this.toArray();return`rgba(${Math.round(c)},${Math.round(h)},${Math.round(w)},${T})`}toArray(){const{r:c,g:h,b:w,a:T}=this;return T===0?[0,0,0,0]:[255*c/T,255*h/T,255*w/T,T]}toArray01(){const{r:c,g:h,b:w,a:T}=this;return T===0?[0,0,0,0]:[c/T,h/T,w/T,T]}toArray01PremultipliedAlpha(){const{r:c,g:h,b:w,a:T}=this;return[c,h,w,T]}}dm.black=new dm(0,0,0,1),dm.white=new dm(1,1,1,1),dm.transparent=new dm(0,0,0,0),dm.red=new dm(1,0,0,1),dm.blue=new dm(0,0,1,1);var Gg=dm;class Cv{constructor(c,h,w){this.sensitivity=c?h?"variant":"case":h?"accent":"base",this.locale=w,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(c,h){return this.collator.compare(c,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class uy{constructor(c,h,w,T,F){this.text=c.normalize?c.normalize():c,this.image=h,this.scale=w,this.fontStack=T,this.textColor=F}}class pm{constructor(c){this.sections=c}static fromString(c){return new pm([new uy(c,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(c=>c.text.length!==0||c.image&&c.image.name.length!==0)}static factory(c){return c instanceof pm?c:pm.fromString(c)}toString(){return this.sections.length===0?"":this.sections.map(c=>c.text).join("")}serialize(){const c=["format"];for(const h of this.sections){if(h.image){c.push(["image",h.image.name]);continue}c.push(h.text);const w={};h.fontStack&&(w["text-font"]=["literal",h.fontStack.split(",")]),h.scale&&(w["font-scale"]=h.scale),h.textColor&&(w["text-color"]=["rgba"].concat(h.textColor.toArray())),c.push(w)}return c}}class Vm{constructor(c){this.name=c.name,this.available=c.available}toString(){return this.name}static fromString(c){return c?new Vm({name:c,available:!1}):null}serialize(){return["image",this.name]}}function Km(u,c,h,w){return typeof u=="number"&&u>=0&&u<=255&&typeof c=="number"&&c>=0&&c<=255&&typeof h=="number"&&h>=0&&h<=255?w===void 0||typeof w=="number"&&w>=0&&w<=1?null:`Invalid rgba value [${[u,c,h,w].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof w=="number"?[u,c,h,w]:[u,c,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Em(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof Gg||u instanceof Cv||u instanceof pm||u instanceof Vm)return!0;if(Array.isArray(u)){for(const c of u)if(!Em(c))return!1;return!0}if(typeof u=="object"){for(const c in u)if(!Em(u[c]))return!1;return!0}return!1}function zg(u){if(u===null)return lg;if(typeof u=="string")return qf;if(typeof u=="boolean")return jf;if(typeof u=="number")return ap;if(u instanceof Gg)return Wm;if(u instanceof Cv)return qm;if(u instanceof pm)return Ny;if(u instanceof Vm)return ky;if(Array.isArray(u)){const c=u.length;let h;for(const w of u){const T=zg(w);if(h){if(h===T)continue;h=Kf;break}h=T}return a_(h||Kf,c)}return __}function hy(u){const c=typeof u;return u===null?"":c==="string"||c==="number"||c==="boolean"?String(u):u instanceof Gg||u instanceof pm||u instanceof Vm?u.toString():JSON.stringify(u)}class Ev{constructor(c,h){this.type=c,this.value=h}static parse(c,h){if(c.length!==2)return h.error(`'literal' expression requires exactly one argument, but found ${c.length-1} instead.`);if(!Em(c[1]))return h.error("invalid value");const w=c[1];let T=zg(w);const F=h.expectedType;return T.kind!=="array"||T.N!==0||!F||F.kind!=="array"||typeof F.N=="number"&&F.N!==0||(T=F),new Ev(T,w)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Gg?["rgba"].concat(this.value.toArray()):this.value instanceof pm?this.value.serialize():this.value}}var q_=Ev,em=class{constructor(u){this.name="ExpressionEvaluationError",this.message=u}toJSON(){return this.message}};const K_={string:qf,number:ap,boolean:jf,object:__};class cg{constructor(c,h){this.type=c,this.args=h}static parse(c,h){if(c.length<2)return h.error("Expected at least one argument.");let w,T=1;const F=c[0];if(F==="array"){let ut,di;if(c.length>2){const yi=c[1];if(typeof yi!="string"||!(yi in K_)||yi==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);ut=K_[yi],T++}else ut=Kf;if(c.length>3){if(c[2]!==null&&(typeof c[2]!="number"||c[2]<0||c[2]!==Math.floor(c[2])))return h.error('The length argument to "array" must be a positive integer literal',2);di=c[2],T++}w=a_(ut,di)}else w=K_[F];const Y=[];for(;T<c.length;T++){const ut=h.parse(c[T],T,Kf);if(!ut)return null;Y.push(ut)}return new cg(w,Y)}evaluate(c){for(let h=0;h<this.args.length;h++){const w=this.args[h].evaluate(c);if(!E_(this.type,zg(w)))return w;if(h===this.args.length-1)throw new em(`Expected value to be of type ${Lg(this.type)}, but found ${Lg(zg(w))} instead.`)}return null}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}serialize(){const c=this.type,h=[c.kind];if(c.kind==="array"){const w=c.itemType;if(w.kind==="string"||w.kind==="number"||w.kind==="boolean"){h.push(w.kind);const T=c.N;(typeof T=="number"||this.args.length>1)&&h.push(T)}}return h.concat(this.args.map(w=>w.serialize()))}}var S_=cg;class T_{constructor(c){this.type=Ny,this.sections=c}static parse(c,h){if(c.length<2)return h.error("Expected at least one argument.");const w=c[1];if(!Array.isArray(w)&&typeof w=="object")return h.error("First argument must be an image or text section.");const T=[];let F=!1;for(let Y=1;Y<=c.length-1;++Y){const ut=c[Y];if(F&&typeof ut=="object"&&!Array.isArray(ut)){F=!1;let di=null;if(ut["font-scale"]&&(di=h.parse(ut["font-scale"],1,ap),!di))return null;let yi=null;if(ut["text-font"]&&(yi=h.parse(ut["text-font"],1,a_(qf)),!yi))return null;let kn=null;if(ut["text-color"]&&(kn=h.parse(ut["text-color"],1,Wm),!kn))return null;const So=T[T.length-1];So.scale=di,So.font=yi,So.textColor=kn}else{const di=h.parse(c[Y],1,Kf);if(!di)return null;const yi=di.type.kind;if(yi!=="string"&&yi!=="value"&&yi!=="null"&&yi!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");F=!0,T.push({content:di,scale:null,font:null,textColor:null})}}return new T_(T)}evaluate(c){return new pm(this.sections.map(h=>{const w=h.content.evaluate(c);return zg(w)===ky?new uy("",w,null,null,null):new uy(hy(w),null,h.scale?h.scale.evaluate(c):null,h.font?h.font.evaluate(c).join(","):null,h.textColor?h.textColor.evaluate(c):null)}))}eachChild(c){for(const h of this.sections)c(h.content),h.scale&&c(h.scale),h.font&&c(h.font),h.textColor&&c(h.textColor)}outputDefined(){return!1}serialize(){const c=["format"];for(const h of this.sections){c.push(h.content.serialize());const w={};h.scale&&(w["font-scale"]=h.scale.serialize()),h.font&&(w["text-font"]=h.font.serialize()),h.textColor&&(w["text-color"]=h.textColor.serialize()),c.push(w)}return c}}class a0{constructor(c){this.type=ky,this.input=c}static parse(c,h){if(c.length!==2)return h.error("Expected two arguments.");const w=h.parse(c[1],1,qf);return w?new a0(w):h.error("No image name provided.")}evaluate(c){const h=this.input.evaluate(c),w=Vm.fromString(h);return w&&c.availableImages&&(w.available=c.availableImages.indexOf(h)>-1),w}eachChild(c){c(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const zx={"to-boolean":jf,"to-color":Wm,"to-number":ap,"to-string":qf};class dy{constructor(c,h){this.type=c,this.args=h}static parse(c,h){if(c.length<2)return h.error("Expected at least one argument.");const w=c[0];if((w==="to-boolean"||w==="to-string")&&c.length!==2)return h.error("Expected one argument.");const T=zx[w],F=[];for(let Y=1;Y<c.length;Y++){const ut=h.parse(c[Y],Y,Kf);if(!ut)return null;F.push(ut)}return new dy(T,F)}evaluate(c){if(this.type.kind==="boolean")return!!this.args[0].evaluate(c);if(this.type.kind==="color"){let h,w;for(const T of this.args){if(h=T.evaluate(c),w=null,h instanceof Gg)return h;if(typeof h=="string"){const F=c.parseColor(h);if(F)return F}else if(Array.isArray(h)&&(w=h.length<3||h.length>4?`Invalid rbga value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:Km(h[0],h[1],h[2],h[3]),!w))return new Gg(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new em(w||`Could not parse color from value '${typeof h=="string"?h:String(JSON.stringify(h))}'`)}if(this.type.kind==="number"){let h=null;for(const w of this.args){if(h=w.evaluate(c),h===null)return 0;const T=Number(h);if(!isNaN(T))return T}throw new em(`Could not convert ${JSON.stringify(h)} to number.`)}return this.type.kind==="formatted"?pm.fromString(hy(this.args[0].evaluate(c))):this.type.kind==="resolvedImage"?Vm.fromString(hy(this.args[0].evaluate(c))):hy(this.args[0].evaluate(c))}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}serialize(){if(this.type.kind==="formatted")return new T_([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new a0(this.args[0]).serialize();const c=[`to-${this.type.kind}`];return this.eachChild(h=>{c.push(h.serialize())}),c}}var Sv=dy;const N_=["Unknown","Point","LineString","Polygon"];var xx=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?N_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const u=this.featureDistanceData.center,c=this.featureDistanceData.scale,{x:h,y:w}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(h*c-u[0])+this.featureDistanceData.bearing[1]*(w*c-u[1])}return 0}parseColor(u){let c=this._parseColorCache[u];return c||(c=this._parseColorCache[u]=Gg.parse(u)),c}};class Vy{constructor(c,h,w,T){this.name=c,this.type=h,this._evaluate=w,this.args=T}evaluate(c){return this._evaluate(c,this.args)}eachChild(c){this.args.forEach(c)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(c=>c.serialize()))}static parse(c,h){const w=c[0],T=Vy.definitions[w];if(!T)return h.error(`Unknown expression "${w}". If you wanted a literal array, use ["literal", [...]].`,0);const F=Array.isArray(T)?T[0]:T.type,Y=Array.isArray(T)?[[T[1],T[2]]]:T.overloads,ut=Y.filter(([yi])=>!Array.isArray(yi)||yi.length===c.length-1);let di=null;for(const[yi,kn]of ut){di=new Iv(h.registry,h.path,null,h.scope);const So=[];let sa=!1;for(let al=1;al<c.length;al++){const cl=c[al],eh=Array.isArray(yi)?yi[al-1]:yi.type,fh=di.parse(cl,1+So.length,eh);if(!fh){sa=!0;break}So.push(fh)}if(!sa)if(Array.isArray(yi)&&yi.length!==So.length)di.error(`Expected ${yi.length} arguments, but found ${So.length} instead.`);else{for(let al=0;al<So.length;al++){const cl=Array.isArray(yi)?yi[al]:yi.type,eh=So[al];di.concat(al+1).checkSubtype(cl,eh.type)}if(di.errors.length===0)return new Vy(w,F,kn,So)}}if(ut.length===1)h.errors.push(...di.errors);else{const yi=(ut.length?ut:Y).map(([So])=>{return sa=So,Array.isArray(sa)?`(${sa.map(Lg).join(", ")})`:`(${Lg(sa.type)}...)`;var sa}).join(" | "),kn=[];for(let So=1;So<c.length;So++){const sa=h.parse(c[So],1+kn.length);if(!sa)return null;kn.push(Lg(sa.type))}h.error(`Expected arguments of type ${yi}, but found (${kn.join(", ")}) instead.`)}return null}static register(c,h){Vy.definitions=h;for(const w in h)c[w]=Vy}}var Z_=Vy;class l0{constructor(c,h,w){this.type=qm,this.locale=w,this.caseSensitive=c,this.diacriticSensitive=h}static parse(c,h){if(c.length!==2)return h.error("Expected one argument.");const w=c[1];if(typeof w!="object"||Array.isArray(w))return h.error("Collator options argument must be an object.");const T=h.parse(w["case-sensitive"]!==void 0&&w["case-sensitive"],1,jf);if(!T)return null;const F=h.parse(w["diacritic-sensitive"]!==void 0&&w["diacritic-sensitive"],1,jf);if(!F)return null;let Y=null;return w.locale&&(Y=h.parse(w.locale,1,qf),!Y)?null:new l0(T,F,Y)}evaluate(c){return new Cv(this.caseSensitive.evaluate(c),this.diacriticSensitive.evaluate(c),this.locale?this.locale.evaluate(c):null)}eachChild(c){c(this.caseSensitive),c(this.diacriticSensitive),this.locale&&c(this.locale)}outputDefined(){return!1}serialize(){const c={};return c["case-sensitive"]=this.caseSensitive.serialize(),c["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(c.locale=this.locale.serialize()),["collator",c]}}const A_=8192;function Uy(u,c){u[0]=Math.min(u[0],c[0]),u[1]=Math.min(u[1],c[1]),u[2]=Math.max(u[2],c[0]),u[3]=Math.max(u[3],c[1])}function py(u,c){return!(u[0]<=c[0]||u[2]>=c[2]||u[1]<=c[1]||u[3]>=c[3])}function $y(u,c){const h=(180+u[0])/360,w=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,T=Math.pow(2,c.z);return[Math.round(h*T*A_),Math.round(w*T*A_)]}function Hy(u,c,h){const w=u[0]-c[0],T=u[1]-c[1],F=u[0]-h[0],Y=u[1]-h[1];return w*Y-F*T==0&&w*F<=0&&T*Y<=0}function c0(u,c){let h=!1;for(let Y=0,ut=c.length;Y<ut;Y++){const di=c[Y];for(let yi=0,kn=di.length;yi<kn-1;yi++){if(Hy(u,di[yi],di[yi+1]))return!1;(T=di[yi])[1]>(w=u)[1]!=(F=di[yi+1])[1]>w[1]&&w[0]<(F[0]-T[0])*(w[1]-T[1])/(F[1]-T[1])+T[0]&&(h=!h)}}var w,T,F;return h}function z0(u,c){for(let h=0;h<c.length;h++)if(c0(u,c[h]))return!0;return!1}function u0(u,c,h,w){const T=w[0]-h[0],F=w[1]-h[1],Y=(u[0]-h[0])*F-T*(u[1]-h[1]),ut=(c[0]-h[0])*F-T*(c[1]-h[1]);return Y>0&&ut<0||Y<0&&ut>0}function y_(u,c,h){for(const yi of h)for(let kn=0;kn<yi.length-1;++kn)if((ut=[(Y=yi[kn+1])[0]-(F=yi[kn])[0],Y[1]-F[1]])[0]*(di=[(T=c)[0]-(w=u)[0],T[1]-w[1]])[1]-ut[1]*di[0]!=0&&u0(w,T,F,Y)&&u0(F,Y,w,T))return!0;var w,T,F,Y,ut,di;return!1}function hg(u,c){for(let h=0;h<u.length;++h)if(!c0(u[h],c))return!1;for(let h=0;h<u.length-1;++h)if(y_(u[h],u[h+1],c))return!1;return!0}function Tv(u,c){for(let h=0;h<c.length;h++)if(hg(u,c[h]))return!0;return!1}function fy(u,c,h){const w=[];for(let T=0;T<u.length;T++){const F=[];for(let Y=0;Y<u[T].length;Y++){const ut=$y(u[T][Y],h);Uy(c,ut),F.push(ut)}w.push(F)}return w}function wx(u,c,h){const w=[];for(let T=0;T<u.length;T++){const F=fy(u[T],c,h);w.push(F)}return w}function h0(u,c,h,w){if(u[0]<h[0]||u[0]>h[2]){const T=.5*w;let F=u[0]-h[0]>T?-w:h[0]-u[0]>T?w:0;F===0&&(F=u[0]-h[2]>T?-w:h[2]-u[0]>T?w:0),u[0]+=F}Uy(c,u)}function _g(u,c,h,w){const T=Math.pow(2,w.z)*A_,F=[w.x*A_,w.y*A_],Y=[];if(!u)return Y;for(const ut of u)for(const di of ut){const yi=[di.x+F[0],di.y+F[1]];h0(yi,c,h,T),Y.push(yi)}return Y}function Av(u,c,h,w){const T=Math.pow(2,w.z)*A_,F=[w.x*A_,w.y*A_],Y=[];if(!u)return Y;for(const di of u){const yi=[];for(const kn of di){const So=[kn.x+F[0],kn.y+F[1]];Uy(c,So),yi.push(So)}Y.push(yi)}if(c[2]-c[0]<=T/2){(ut=c)[0]=ut[1]=1/0,ut[2]=ut[3]=-1/0;for(const di of Y)for(const yi of di)h0(yi,c,h,T)}var ut;return Y}class Rv{constructor(c,h){this.type=jf,this.geojson=c,this.geometries=h}static parse(c,h){if(c.length!==2)return h.error(`'within' expression requires exactly one argument, but found ${c.length-1} instead.`);if(Em(c[1])){const w=c[1];if(w.type==="FeatureCollection")for(let T=0;T<w.features.length;++T){const F=w.features[T].geometry.type;if(F==="Polygon"||F==="MultiPolygon")return new Rv(w,w.features[T].geometry)}else if(w.type==="Feature"){const T=w.geometry.type;if(T==="Polygon"||T==="MultiPolygon")return new Rv(w,w.geometry)}else if(w.type==="Polygon"||w.type==="MultiPolygon")return new Rv(w,w)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(c){if(c.geometry()!=null&&c.canonicalID()!=null){if(c.geometryType()==="Point")return function(h,w){const T=[1/0,1/0,-1/0,-1/0],F=[1/0,1/0,-1/0,-1/0],Y=h.canonicalID();if(!Y)return!1;if(w.type==="Polygon"){const ut=fy(w.coordinates,F,Y),di=_g(h.geometry(),T,F,Y);if(!py(T,F))return!1;for(const yi of di)if(!c0(yi,ut))return!1}if(w.type==="MultiPolygon"){const ut=wx(w.coordinates,F,Y),di=_g(h.geometry(),T,F,Y);if(!py(T,F))return!1;for(const yi of di)if(!z0(yi,ut))return!1}return!0}(c,this.geometries);if(c.geometryType()==="LineString")return function(h,w){const T=[1/0,1/0,-1/0,-1/0],F=[1/0,1/0,-1/0,-1/0],Y=h.canonicalID();if(!Y)return!1;if(w.type==="Polygon"){const ut=fy(w.coordinates,F,Y),di=Av(h.geometry(),T,F,Y);if(!py(T,F))return!1;for(const yi of di)if(!hg(yi,ut))return!1}if(w.type==="MultiPolygon"){const ut=wx(w.coordinates,F,Y),di=Av(h.geometry(),T,F,Y);if(!py(T,F))return!1;for(const yi of di)if(!Tv(yi,ut))return!1}return!0}(c,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var d0=Rv;function k_(u){if(u instanceof Z_&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof d0)return!1;let c=!0;return u.eachChild(h=>{c&&!k_(h)&&(c=!1)}),c}function X_(u){if(u instanceof Z_&&u.name==="feature-state")return!1;let c=!0;return u.eachChild(h=>{c&&!X_(h)&&(c=!1)}),c}function Y_(u,c){if(u instanceof Z_&&c.indexOf(u.name)>=0)return!1;let h=!0;return u.eachChild(w=>{h&&!Y_(w,c)&&(h=!1)}),h}class p0{constructor(c,h){this.type=h.type,this.name=c,this.boundExpression=h}static parse(c,h){if(c.length!==2||typeof c[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");const w=c[1];return h.scope.has(w)?new p0(w,h.scope.get(w)):h.error(`Unknown variable "${w}". Make sure "${w}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(c){return this.boundExpression.evaluate(c)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Vx=p0;class jy{constructor(c,h=[],w,T=new W_,F=[]){this.registry=c,this.path=h,this.key=h.map(Y=>`[${Y}]`).join(""),this.scope=T,this.errors=F,this.expectedType=w}parse(c,h,w,T,F={}){return h?this.concat(h,w,T)._parse(c,F):this._parse(c,F)}_parse(c,h){function w(T,F,Y){return Y==="assert"?new S_(F,[T]):Y==="coerce"?new Sv(F,[T]):T}if(c!==null&&typeof c!="string"&&typeof c!="boolean"&&typeof c!="number"||(c=["literal",c]),Array.isArray(c)){if(c.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const T=c[0];if(typeof T!="string")return this.error(`Expression name must be a string, but found ${typeof T} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const F=this.registry[T];if(F){let Y=F.parse(c,this);if(!Y)return null;if(this.expectedType){const ut=this.expectedType,di=Y.type;if(ut.kind!=="string"&&ut.kind!=="number"&&ut.kind!=="boolean"&&ut.kind!=="object"&&ut.kind!=="array"||di.kind!=="value")if(ut.kind!=="color"&&ut.kind!=="formatted"&&ut.kind!=="resolvedImage"||di.kind!=="value"&&di.kind!=="string"){if(this.checkSubtype(ut,di))return null}else Y=w(Y,ut,h.typeAnnotation||"coerce");else Y=w(Y,ut,h.typeAnnotation||"assert")}if(!(Y instanceof q_)&&Y.type.kind!=="resolvedImage"&&Og(Y)){const ut=new xx;try{Y=new q_(Y.type,Y.evaluate(ut))}catch(di){return this.error(di.message),null}}return Y}return this.error(`Unknown expression "${T}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(c===void 0?"'undefined' value invalid. Use null instead.":typeof c=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof c} instead.`)}concat(c,h,w){const T=typeof c=="number"?this.path.concat(c):this.path,F=w?this.scope.concat(w):this.scope;return new jy(this.registry,T,h||null,F,this.errors)}error(c,...h){const w=`${this.key}${h.map(T=>`[${T}]`).join("")}`;this.errors.push(new m_(w,c))}checkSubtype(c,h){const w=E_(c,h);return w&&this.error(w),w}}var Iv=jy;function Og(u){if(u instanceof Vx)return Og(u.boundExpression);if(u instanceof Z_&&u.name==="error"||u instanceof l0||u instanceof d0)return!1;const c=u instanceof Sv||u instanceof S_;let h=!0;return u.eachChild(w=>{h=c?h&&Og(w):h&&w instanceof q_}),!!h&&k_(u)&&Y_(u,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Mv(u,c){const h=u.length-1;let w,T,F=0,Y=h,ut=0;for(;F<=Y;)if(ut=Math.floor((F+Y)/2),w=u[ut],T=u[ut+1],w<=c){if(ut===h||c<T)return ut;F=ut+1}else{if(!(w>c))throw new em("Input is not a number.");Y=ut-1}return 0}class ig{constructor(c,h,w){this.type=c,this.input=h,this.labels=[],this.outputs=[];for(const[T,F]of w)this.labels.push(T),this.outputs.push(F)}static parse(c,h){if(c.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return h.error("Expected an even number of arguments.");const w=h.parse(c[1],1,ap);if(!w)return null;const T=[];let F=null;h.expectedType&&h.expectedType.kind!=="value"&&(F=h.expectedType);for(let Y=1;Y<c.length;Y+=2){const ut=Y===1?-1/0:c[Y],di=c[Y+1],yi=Y,kn=Y+1;if(typeof ut!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',yi);if(T.length&&T[T.length-1][0]>=ut)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',yi);const So=h.parse(di,kn,F);if(!So)return null;F=F||So.type,T.push([ut,So])}return new ig(F,w,T)}evaluate(c){const h=this.labels,w=this.outputs;if(h.length===1)return w[0].evaluate(c);const T=this.input.evaluate(c);if(T<=h[0])return w[0].evaluate(c);const F=h.length;return T>=h[F-1]?w[F-1].evaluate(c):w[Mv(h,T)].evaluate(c)}eachChild(c){c(this.input);for(const h of this.outputs)c(h)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}serialize(){const c=["step",this.input.serialize()];for(let h=0;h<this.labels.length;h++)h>0&&c.push(this.labels[h]),c.push(this.outputs[h].serialize());return c}}var Pv=ig;function Hp(u,c,h){return u*(1-h)+c*h}var yg=Object.freeze({__proto__:null,array:function(u,c,h){return u.map((w,T)=>Hp(w,c[T],h))},color:function(u,c,h){return new Gg(Hp(u.r,c.r,h),Hp(u.g,c.g,h),Hp(u.b,c.b,h),Hp(u.a,c.a,h))},number:Hp});const Wy=.95047,V0=1.08883,U0=4/29,qy=6/29,$0=3*qy*qy,H0=qy*qy*qy,j0=Math.PI/180,bx=180/Math.PI;function f0(u){return u>H0?Math.pow(u,1/3):u/$0+U0}function Ky(u){return u>qy?u*u*u:$0*(u-U0)}function Zy(u){return 255*(u<=.0031308?12.92*u:1.055*Math.pow(u,1/2.4)-.055)}function W0(u){return(u/=255)<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function Cx(u){const c=W0(u.r),h=W0(u.g),w=W0(u.b),T=f0((.4124564*c+.3575761*h+.1804375*w)/Wy),F=f0((.2126729*c+.7151522*h+.072175*w)/1);return{l:116*F-16,a:500*(T-F),b:200*(F-f0((.0193339*c+.119192*h+.9503041*w)/V0)),alpha:u.a}}function Yg(u){let c=(u.l+16)/116,h=isNaN(u.a)?c:c+u.a/500,w=isNaN(u.b)?c:c-u.b/200;return c=1*Ky(c),h=Wy*Ky(h),w=V0*Ky(w),new Gg(Zy(3.2404542*h-1.5371385*c-.4985314*w),Zy(-.969266*h+1.8760108*c+.041556*w),Zy(.0556434*h-.2040259*c+1.0572252*w),u.alpha)}function Xy(u,c,h){const w=c-u;return u+h*(w>180||w<-180?w-360*Math.round(w/360):w)}const Nm={forward:Cx,reverse:Yg,interpolate:function(u,c,h){return{l:Hp(u.l,c.l,h),a:Hp(u.a,c.a,h),b:Hp(u.b,c.b,h),alpha:Hp(u.alpha,c.alpha,h)}}},Yy={forward:function(u){const{l:c,a:h,b:w}=Cx(u),T=Math.atan2(w,h)*bx;return{h:T<0?T+360:T,c:Math.sqrt(h*h+w*w),l:c,alpha:u.a}},reverse:function(u){const c=u.h*j0,h=u.c;return Yg({l:u.l,a:Math.cos(c)*h,b:Math.sin(c)*h,alpha:u.alpha})},interpolate:function(u,c,h){return{h:Xy(u.h,c.h,h),c:Hp(u.c,c.c,h),l:Hp(u.l,c.l,h),alpha:Hp(u.alpha,c.alpha,h)}}};var g0=Object.freeze({__proto__:null,hcl:Yy,lab:Nm});class Dv{constructor(c,h,w,T,F){this.type=c,this.operator=h,this.interpolation=w,this.input=T,this.labels=[],this.outputs=[];for(const[Y,ut]of F)this.labels.push(Y),this.outputs.push(ut)}static interpolationFactor(c,h,w,T){let F=0;if(c.name==="exponential")F=J_(h,c.base,w,T);else if(c.name==="linear")F=J_(h,1,w,T);else if(c.name==="cubic-bezier"){const Y=c.controlPoints;F=new gl(Y[0],Y[1],Y[2],Y[3]).solve(J_(h,1,w,T))}return F}static parse(c,h){let[w,T,F,...Y]=c;if(!Array.isArray(T)||T.length===0)return h.error("Expected an interpolation type expression.",1);if(T[0]==="linear")T={name:"linear"};else if(T[0]==="exponential"){const yi=T[1];if(typeof yi!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);T={name:"exponential",base:yi}}else{if(T[0]!=="cubic-bezier")return h.error(`Unknown interpolation type ${String(T[0])}`,1,0);{const yi=T.slice(1);if(yi.length!==4||yi.some(kn=>typeof kn!="number"||kn<0||kn>1))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);T={name:"cubic-bezier",controlPoints:yi}}}if(c.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(F=h.parse(F,2,ap),!F)return null;const ut=[];let di=null;w==="interpolate-hcl"||w==="interpolate-lab"?di=Wm:h.expectedType&&h.expectedType.kind!=="value"&&(di=h.expectedType);for(let yi=0;yi<Y.length;yi+=2){const kn=Y[yi],So=Y[yi+1],sa=yi+3,al=yi+4;if(typeof kn!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',sa);if(ut.length&&ut[ut.length-1][0]>=kn)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',sa);const cl=h.parse(So,al,di);if(!cl)return null;di=di||cl.type,ut.push([kn,cl])}return di.kind==="number"||di.kind==="color"||di.kind==="array"&&di.itemType.kind==="number"&&typeof di.N=="number"?new Dv(di,w,T,F,ut):h.error(`Type ${Lg(di)} is not interpolatable.`)}evaluate(c){const h=this.labels,w=this.outputs;if(h.length===1)return w[0].evaluate(c);const T=this.input.evaluate(c);if(T<=h[0])return w[0].evaluate(c);const F=h.length;if(T>=h[F-1])return w[F-1].evaluate(c);const Y=Mv(h,T),ut=Dv.interpolationFactor(this.interpolation,T,h[Y],h[Y+1]),di=w[Y].evaluate(c),yi=w[Y+1].evaluate(c);return this.operator==="interpolate"?yg[this.type.kind.toLowerCase()](di,yi,ut):this.operator==="interpolate-hcl"?Yy.reverse(Yy.interpolate(Yy.forward(di),Yy.forward(yi),ut)):Nm.reverse(Nm.interpolate(Nm.forward(di),Nm.forward(yi),ut))}eachChild(c){c(this.input);for(const h of this.outputs)c(h)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}serialize(){let c;c=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const h=[this.operator,c,this.input.serialize()];for(let w=0;w<this.labels.length;w++)h.push(this.labels[w],this.outputs[w].serialize());return h}}function J_(u,c,h,w){const T=w-h,F=u-h;return T===0?0:c===1?F/T:(Math.pow(c,F)-1)/(Math.pow(c,T)-1)}var Zm=Dv;class Q_{constructor(c,h){this.type=c,this.args=h}static parse(c,h){if(c.length<2)return h.error("Expectected at least one argument.");let w=null;const T=h.expectedType;T&&T.kind!=="value"&&(w=T);const F=[];for(const ut of c.slice(1)){const di=h.parse(ut,1+F.length,w,void 0,{typeAnnotation:"omit"});if(!di)return null;w=w||di.type,F.push(di)}const Y=T&&F.some(ut=>E_(T,ut.type));return new Q_(Y?Kf:w,F)}evaluate(c){let h,w=null,T=0;for(const F of this.args){if(T++,w=F.evaluate(c),w&&w instanceof Vm&&!w.available&&(h||(h=w),w=null,T===this.args.length))return h;if(w!==null)break}return w}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}serialize(){const c=["coalesce"];return this.eachChild(h=>{c.push(h.serialize())}),c}}var q0=Q_;class Lv{constructor(c,h){this.type=h.type,this.bindings=[].concat(c),this.result=h}evaluate(c){return this.result.evaluate(c)}eachChild(c){for(const h of this.bindings)c(h[1]);c(this.result)}static parse(c,h){if(c.length<4)return h.error(`Expected at least 3 arguments, but found ${c.length-1} instead.`);const w=[];for(let F=1;F<c.length-1;F+=2){const Y=c[F];if(typeof Y!="string")return h.error(`Expected string, but found ${typeof Y} instead.`,F);if(/[^a-zA-Z0-9_]/.test(Y))return h.error("Variable names must contain only alphanumeric characters or '_'.",F);const ut=h.parse(c[F+1],F+1);if(!ut)return null;w.push([Y,ut])}const T=h.parse(c[c.length-1],c.length-1,h.expectedType,w);return T?new Lv(w,T):null}outputDefined(){return this.result.outputDefined()}serialize(){const c=["let"];for(const[h,w]of this.bindings)c.push(h,w.serialize());return c.push(this.result.serialize()),c}}var K0=Lv;class Z0{constructor(c,h,w){this.type=c,this.index=h,this.input=w}static parse(c,h){if(c.length!==3)return h.error(`Expected 2 arguments, but found ${c.length-1} instead.`);const w=h.parse(c[1],1,ap),T=h.parse(c[2],2,a_(h.expectedType||Kf));return w&&T?new Z0(T.type.itemType,w,T):null}evaluate(c){const h=this.index.evaluate(c),w=this.input.evaluate(c);if(h<0)throw new em(`Array index out of bounds: ${h} < 0.`);if(h>=w.length)throw new em(`Array index out of bounds: ${h} > ${w.length-1}.`);if(h!==Math.floor(h))throw new em(`Array index must be an integer, but found ${h} instead.`);return w[h]}eachChild(c){c(this.index),c(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var X0=Z0;class v_{constructor(c,h){this.type=jf,this.needle=c,this.haystack=h}static parse(c,h){if(c.length!==3)return h.error(`Expected 2 arguments, but found ${c.length-1} instead.`);const w=h.parse(c[1],1,Kf),T=h.parse(c[2],2,Kf);return w&&T?By(w.type,[jf,qf,ap,lg,Kf])?new v_(w,T):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${Lg(w.type)} instead`):null}evaluate(c){const h=this.needle.evaluate(c),w=this.haystack.evaluate(c);if(w==null)return!1;if(!bv(h,["boolean","string","number","null"]))throw new em(`Expected first argument to be of type boolean, string, number or null, but found ${Lg(zg(h))} instead.`);if(!bv(w,["string","array"]))throw new em(`Expected second argument to be of type array or string, but found ${Lg(zg(w))} instead.`);return w.indexOf(h)>=0}eachChild(c){c(this.needle),c(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Jy=v_;class gy{constructor(c,h,w){this.type=ap,this.needle=c,this.haystack=h,this.fromIndex=w}static parse(c,h){if(c.length<=2||c.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`);const w=h.parse(c[1],1,Kf),T=h.parse(c[2],2,Kf);if(!w||!T)return null;if(!By(w.type,[jf,qf,ap,lg,Kf]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${Lg(w.type)} instead`);if(c.length===4){const F=h.parse(c[3],3,ap);return F?new gy(w,T,F):null}return new gy(w,T)}evaluate(c){const h=this.needle.evaluate(c),w=this.haystack.evaluate(c);if(!bv(h,["boolean","string","number","null"]))throw new em(`Expected first argument to be of type boolean, string, number or null, but found ${Lg(zg(h))} instead.`);if(!bv(w,["string","array"]))throw new em(`Expected second argument to be of type array or string, but found ${Lg(zg(w))} instead.`);if(this.fromIndex){const T=this.fromIndex.evaluate(c);return w.indexOf(h,T)}return w.indexOf(h)}eachChild(c){c(this.needle),c(this.haystack),this.fromIndex&&c(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const c=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),c]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Ex=gy;class Qy{constructor(c,h,w,T,F,Y){this.inputType=c,this.type=h,this.input=w,this.cases=T,this.outputs=F,this.otherwise=Y}static parse(c,h){if(c.length<5)return h.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if(c.length%2!=1)return h.error("Expected an even number of arguments.");let w,T;h.expectedType&&h.expectedType.kind!=="value"&&(T=h.expectedType);const F={},Y=[];for(let yi=2;yi<c.length-1;yi+=2){let kn=c[yi];const So=c[yi+1];Array.isArray(kn)||(kn=[kn]);const sa=h.concat(yi);if(kn.length===0)return sa.error("Expected at least one branch label.");for(const cl of kn){if(typeof cl!="number"&&typeof cl!="string")return sa.error("Branch labels must be numbers or strings.");if(typeof cl=="number"&&Math.abs(cl)>Number.MAX_SAFE_INTEGER)return sa.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof cl=="number"&&Math.floor(cl)!==cl)return sa.error("Numeric branch labels must be integer values.");if(w){if(sa.checkSubtype(w,zg(cl)))return null}else w=zg(cl);if(F[String(cl)]!==void 0)return sa.error("Branch labels must be unique.");F[String(cl)]=Y.length}const al=h.parse(So,yi,T);if(!al)return null;T=T||al.type,Y.push(al)}const ut=h.parse(c[1],1,Kf);if(!ut)return null;const di=h.parse(c[c.length-1],c.length-1,T);return di?ut.type.kind!=="value"&&h.concat(1).checkSubtype(w,ut.type)?null:new Qy(w,T,ut,F,Y,di):null}evaluate(c){const h=this.input.evaluate(c);return(zg(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(c)}eachChild(c){c(this.input),this.outputs.forEach(c),c(this.otherwise)}outputDefined(){return this.outputs.every(c=>c.outputDefined())&&this.otherwise.outputDefined()}serialize(){const c=["match",this.input.serialize()],h=Object.keys(this.cases).sort(),w=[],T={};for(const Y of h){const ut=T[this.cases[Y]];ut===void 0?(T[this.cases[Y]]=w.length,w.push([this.cases[Y],[Y]])):w[ut][1].push(Y)}const F=Y=>this.inputType.kind==="number"?Number(Y):Y;for(const[Y,ut]of w)c.push(ut.length===1?F(ut[0]):ut.map(F)),c.push(this.outputs[Y].serialize());return c.push(this.otherwise.serialize()),c}}var Ux=Qy;class Y0{constructor(c,h,w){this.type=c,this.branches=h,this.otherwise=w}static parse(c,h){if(c.length<4)return h.error(`Expected at least 3 arguments, but found only ${c.length-1}.`);if(c.length%2!=0)return h.error("Expected an odd number of arguments.");let w;h.expectedType&&h.expectedType.kind!=="value"&&(w=h.expectedType);const T=[];for(let Y=1;Y<c.length-1;Y+=2){const ut=h.parse(c[Y],Y,jf);if(!ut)return null;const di=h.parse(c[Y+1],Y+1,w);if(!di)return null;T.push([ut,di]),w=w||di.type}const F=h.parse(c[c.length-1],c.length-1,w);return F?new Y0(w,T,F):null}evaluate(c){for(const[h,w]of this.branches)if(h.evaluate(c))return w.evaluate(c);return this.otherwise.evaluate(c)}eachChild(c){for(const[h,w]of this.branches)c(h),c(w);c(this.otherwise)}outputDefined(){return this.branches.every(([c,h])=>h.outputDefined())&&this.otherwise.outputDefined()}serialize(){const c=["case"];return this.eachChild(h=>{c.push(h.serialize())}),c}}var Ov=Y0;class Fv{constructor(c,h,w,T){this.type=c,this.input=h,this.beginIndex=w,this.endIndex=T}static parse(c,h){if(c.length<=2||c.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`);const w=h.parse(c[1],1,Kf),T=h.parse(c[2],2,ap);if(!w||!T)return null;if(!By(w.type,[a_(Kf),qf,Kf]))return h.error(`Expected first argument to be of type array or string, but found ${Lg(w.type)} instead`);if(c.length===4){const F=h.parse(c[3],3,ap);return F?new Fv(w.type,w,T,F):null}return new Fv(w.type,w,T)}evaluate(c){const h=this.input.evaluate(c),w=this.beginIndex.evaluate(c);if(!bv(h,["string","array"]))throw new em(`Expected first argument to be of type array or string, but found ${Lg(zg(h))} instead.`);if(this.endIndex){const T=this.endIndex.evaluate(c);return h.slice(w,T)}return h.slice(w)}eachChild(c){c(this.input),c(this.beginIndex),this.endIndex&&c(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const c=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),c]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var R_=Fv;function Um(u,c){return u==="=="||u==="!="?c.kind==="boolean"||c.kind==="string"||c.kind==="number"||c.kind==="null"||c.kind==="value":c.kind==="string"||c.kind==="number"||c.kind==="value"}function Nv(u,c,h,w){return w.compare(c,h)===0}function Vg(u,c,h){const w=u!=="=="&&u!=="!=";return class XS{constructor(F,Y,ut){this.type=jf,this.lhs=F,this.rhs=Y,this.collator=ut,this.hasUntypedArgument=F.type.kind==="value"||Y.type.kind==="value"}static parse(F,Y){if(F.length!==3&&F.length!==4)return Y.error("Expected two or three arguments.");const ut=F[0];let di=Y.parse(F[1],1,Kf);if(!di)return null;if(!Um(ut,di.type))return Y.concat(1).error(`"${ut}" comparisons are not supported for type '${Lg(di.type)}'.`);let yi=Y.parse(F[2],2,Kf);if(!yi)return null;if(!Um(ut,yi.type))return Y.concat(2).error(`"${ut}" comparisons are not supported for type '${Lg(yi.type)}'.`);if(di.type.kind!==yi.type.kind&&di.type.kind!=="value"&&yi.type.kind!=="value")return Y.error(`Cannot compare types '${Lg(di.type)}' and '${Lg(yi.type)}'.`);w&&(di.type.kind==="value"&&yi.type.kind!=="value"?di=new S_(yi.type,[di]):di.type.kind!=="value"&&yi.type.kind==="value"&&(yi=new S_(di.type,[yi])));let kn=null;if(F.length===4){if(di.type.kind!=="string"&&yi.type.kind!=="string"&&di.type.kind!=="value"&&yi.type.kind!=="value")return Y.error("Cannot use collator to compare non-string types.");if(kn=Y.parse(F[3],3,qm),!kn)return null}return new XS(di,yi,kn)}evaluate(F){const Y=this.lhs.evaluate(F),ut=this.rhs.evaluate(F);if(w&&this.hasUntypedArgument){const di=zg(Y),yi=zg(ut);if(di.kind!==yi.kind||di.kind!=="string"&&di.kind!=="number")throw new em(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${di.kind}, ${yi.kind}) instead.`)}if(this.collator&&!w&&this.hasUntypedArgument){const di=zg(Y),yi=zg(ut);if(di.kind!=="string"||yi.kind!=="string")return c(F,Y,ut)}return this.collator?h(F,Y,ut,this.collator.evaluate(F)):c(F,Y,ut)}eachChild(F){F(this.lhs),F(this.rhs),this.collator&&F(this.collator)}outputDefined(){return!0}serialize(){const F=[u];return this.eachChild(Y=>{F.push(Y.serialize())}),F}}}const my=Vg("==",function(u,c,h){return c===h},Nv),xw=Vg("!=",function(u,c,h){return c!==h},function(u,c,h,w){return!Nv(0,c,h,w)}),ww=Vg("<",function(u,c,h){return c<h},function(u,c,h,w){return w.compare(c,h)<0}),bw=Vg(">",function(u,c,h){return c>h},function(u,c,h,w){return w.compare(c,h)>0}),kv=Vg("<=",function(u,c,h){return c<=h},function(u,c,h,w){return w.compare(c,h)<=0}),Bv=Vg(">=",function(u,c,h){return c>=h},function(u,c,h,w){return w.compare(c,h)>=0});class l_{constructor(c,h,w,T,F,Y){this.type=qf,this.number=c,this.locale=h,this.currency=w,this.unit=T,this.minFractionDigits=F,this.maxFractionDigits=Y}static parse(c,h){if(c.length!==3)return h.error("Expected two arguments.");const w=h.parse(c[1],1,ap);if(!w)return null;const T=c[2];if(typeof T!="object"||Array.isArray(T))return h.error("NumberFormat options argument must be an object.");let F=null;if(T.locale&&(F=h.parse(T.locale,1,qf),!F))return null;let Y=null;if(T.currency&&(Y=h.parse(T.currency,1,qf),!Y))return null;let ut=null;if(T.unit&&(ut=h.parse(T.unit,1,qf),!ut))return null;let di=null;if(T["min-fraction-digits"]&&(di=h.parse(T["min-fraction-digits"],1,ap),!di))return null;let yi=null;return T["max-fraction-digits"]&&(yi=h.parse(T["max-fraction-digits"],1,ap),!yi)?null:new l_(w,F,Y,ut,di,yi)}evaluate(c){return new Intl.NumberFormat(this.locale?this.locale.evaluate(c):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(c):void 0,unit:this.unit?this.unit.evaluate(c):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(c):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(c):void 0}).format(this.number.evaluate(c))}eachChild(c){c(this.number),this.locale&&c(this.locale),this.currency&&c(this.currency),this.unit&&c(this.unit),this.minFractionDigits&&c(this.minFractionDigits),this.maxFractionDigits&&c(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const c={};return this.locale&&(c.locale=this.locale.serialize()),this.currency&&(c.currency=this.currency.serialize()),this.unit&&(c.unit=this.unit.serialize()),this.minFractionDigits&&(c["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(c["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),c]}}class Tp{constructor(c){this.type=ap,this.input=c}static parse(c,h){if(c.length!==2)return h.error(`Expected 1 argument, but found ${c.length-1} instead.`);const w=h.parse(c[1],1);return w?w.type.kind!=="array"&&w.type.kind!=="string"&&w.type.kind!=="value"?h.error(`Expected argument of type string or array, but found ${Lg(w.type)} instead.`):new Tp(w):null}evaluate(c){const h=this.input.evaluate(c);if(typeof h=="string"||Array.isArray(h))return h.length;throw new em(`Expected value to be of type string or array, but found ${Lg(zg(h))} instead.`)}eachChild(c){c(this.input)}outputDefined(){return!1}serialize(){const c=["length"];return this.eachChild(h=>{c.push(h.serialize())}),c}}const m0={"==":my,"!=":xw,">":bw,"<":ww,">=":Bv,"<=":kv,array:S_,at:X0,boolean:S_,case:Ov,coalesce:q0,collator:l0,format:T_,image:a0,in:Jy,"index-of":Ex,interpolate:Zm,"interpolate-hcl":Zm,"interpolate-lab":Zm,length:Tp,let:K0,literal:q_,match:Ux,number:S_,"number-format":l_,object:S_,slice:R_,step:Pv,string:S_,"to-boolean":Sv,"to-color":Sv,"to-number":Sv,"to-string":Sv,var:Vx,within:d0};function Gv(u,[c,h,w,T]){c=c.evaluate(u),h=h.evaluate(u),w=w.evaluate(u);const F=T?T.evaluate(u):1,Y=Km(c,h,w,F);if(Y)throw new em(Y);return new Gg(c/255*F,h/255*F,w/255*F,F)}function Sm(u,c){return u in c}function _0(u,c){const h=c[u];return h===void 0?null:h}function sp(u){return{type:u}}Z_.register(m0,{error:[{kind:"error"},[qf],(u,[c])=>{throw new em(c.evaluate(u))}],typeof:[qf,[Kf],(u,[c])=>Lg(zg(c.evaluate(u)))],"to-rgba":[a_(ap,4),[Wm],(u,[c])=>c.evaluate(u).toArray()],rgb:[Wm,[ap,ap,ap],Gv],rgba:[Wm,[ap,ap,ap,ap],Gv],has:{type:jf,overloads:[[[qf],(u,[c])=>Sm(c.evaluate(u),u.properties())],[[qf,__],(u,[c,h])=>Sm(c.evaluate(u),h.evaluate(u))]]},get:{type:Kf,overloads:[[[qf],(u,[c])=>_0(c.evaluate(u),u.properties())],[[qf,__],(u,[c,h])=>_0(c.evaluate(u),h.evaluate(u))]]},"feature-state":[Kf,[qf],(u,[c])=>_0(c.evaluate(u),u.featureState||{})],properties:[__,[],u=>u.properties()],"geometry-type":[qf,[],u=>u.geometryType()],id:[Kf,[],u=>u.id()],zoom:[ap,[],u=>u.globals.zoom],pitch:[ap,[],u=>u.globals.pitch||0],"distance-from-center":[ap,[],u=>u.distanceFromCenter()],"heatmap-density":[ap,[],u=>u.globals.heatmapDensity||0],"line-progress":[ap,[],u=>u.globals.lineProgress||0],"sky-radial-progress":[ap,[],u=>u.globals.skyRadialProgress||0],accumulated:[Kf,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[ap,sp(ap),(u,c)=>{let h=0;for(const w of c)h+=w.evaluate(u);return h}],"*":[ap,sp(ap),(u,c)=>{let h=1;for(const w of c)h*=w.evaluate(u);return h}],"-":{type:ap,overloads:[[[ap,ap],(u,[c,h])=>c.evaluate(u)-h.evaluate(u)],[[ap],(u,[c])=>-c.evaluate(u)]]},"/":[ap,[ap,ap],(u,[c,h])=>c.evaluate(u)/h.evaluate(u)],"%":[ap,[ap,ap],(u,[c,h])=>c.evaluate(u)%h.evaluate(u)],ln2:[ap,[],()=>Math.LN2],pi:[ap,[],()=>Math.PI],e:[ap,[],()=>Math.E],"^":[ap,[ap,ap],(u,[c,h])=>Math.pow(c.evaluate(u),h.evaluate(u))],sqrt:[ap,[ap],(u,[c])=>Math.sqrt(c.evaluate(u))],log10:[ap,[ap],(u,[c])=>Math.log(c.evaluate(u))/Math.LN10],ln:[ap,[ap],(u,[c])=>Math.log(c.evaluate(u))],log2:[ap,[ap],(u,[c])=>Math.log(c.evaluate(u))/Math.LN2],sin:[ap,[ap],(u,[c])=>Math.sin(c.evaluate(u))],cos:[ap,[ap],(u,[c])=>Math.cos(c.evaluate(u))],tan:[ap,[ap],(u,[c])=>Math.tan(c.evaluate(u))],asin:[ap,[ap],(u,[c])=>Math.asin(c.evaluate(u))],acos:[ap,[ap],(u,[c])=>Math.acos(c.evaluate(u))],atan:[ap,[ap],(u,[c])=>Math.atan(c.evaluate(u))],min:[ap,sp(ap),(u,c)=>Math.min(...c.map(h=>h.evaluate(u)))],max:[ap,sp(ap),(u,c)=>Math.max(...c.map(h=>h.evaluate(u)))],abs:[ap,[ap],(u,[c])=>Math.abs(c.evaluate(u))],round:[ap,[ap],(u,[c])=>{const h=c.evaluate(u);return h<0?-Math.round(-h):Math.round(h)}],floor:[ap,[ap],(u,[c])=>Math.floor(c.evaluate(u))],ceil:[ap,[ap],(u,[c])=>Math.ceil(c.evaluate(u))],"filter-==":[jf,[qf,Kf],(u,[c,h])=>u.properties()[c.value]===h.value],"filter-id-==":[jf,[Kf],(u,[c])=>u.id()===c.value],"filter-type-==":[jf,[qf],(u,[c])=>u.geometryType()===c.value],"filter-<":[jf,[qf,Kf],(u,[c,h])=>{const w=u.properties()[c.value],T=h.value;return typeof w==typeof T&&w<T}],"filter-id-<":[jf,[Kf],(u,[c])=>{const h=u.id(),w=c.value;return typeof h==typeof w&&h<w}],"filter->":[jf,[qf,Kf],(u,[c,h])=>{const w=u.properties()[c.value],T=h.value;return typeof w==typeof T&&w>T}],"filter-id->":[jf,[Kf],(u,[c])=>{const h=u.id(),w=c.value;return typeof h==typeof w&&h>w}],"filter-<=":[jf,[qf,Kf],(u,[c,h])=>{const w=u.properties()[c.value],T=h.value;return typeof w==typeof T&&w<=T}],"filter-id-<=":[jf,[Kf],(u,[c])=>{const h=u.id(),w=c.value;return typeof h==typeof w&&h<=w}],"filter->=":[jf,[qf,Kf],(u,[c,h])=>{const w=u.properties()[c.value],T=h.value;return typeof w==typeof T&&w>=T}],"filter-id->=":[jf,[Kf],(u,[c])=>{const h=u.id(),w=c.value;return typeof h==typeof w&&h>=w}],"filter-has":[jf,[Kf],(u,[c])=>c.value in u.properties()],"filter-has-id":[jf,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[jf,[a_(qf)],(u,[c])=>c.value.indexOf(u.geometryType())>=0],"filter-id-in":[jf,[a_(Kf)],(u,[c])=>c.value.indexOf(u.id())>=0],"filter-in-small":[jf,[qf,a_(Kf)],(u,[c,h])=>h.value.indexOf(u.properties()[c.value])>=0],"filter-in-large":[jf,[qf,a_(Kf)],(u,[c,h])=>function(w,T,F,Y){for(;F<=Y;){const ut=F+Y>>1;if(T[ut]===w)return!0;T[ut]>w?Y=ut-1:F=ut+1}return!1}(u.properties()[c.value],h.value,0,h.value.length-1)],all:{type:jf,overloads:[[[jf,jf],(u,[c,h])=>c.evaluate(u)&&h.evaluate(u)],[sp(jf),(u,c)=>{for(const h of c)if(!h.evaluate(u))return!1;return!0}]]},any:{type:jf,overloads:[[[jf,jf],(u,[c,h])=>c.evaluate(u)||h.evaluate(u)],[sp(jf),(u,c)=>{for(const h of c)if(h.evaluate(u))return!0;return!1}]]},"!":[jf,[jf],(u,[c])=>!c.evaluate(u)],"is-supported-script":[jf,[qf],(u,[c])=>{const h=u.globals&&u.globals.isSupportedScript;return!h||h(c.evaluate(u))}],upcase:[qf,[qf],(u,[c])=>c.evaluate(u).toUpperCase()],downcase:[qf,[qf],(u,[c])=>c.evaluate(u).toLowerCase()],concat:[qf,sp(Kf),(u,c)=>c.map(h=>hy(h.evaluate(u))).join("")],"resolved-locale":[qf,[qm],(u,[c])=>c.evaluate(u).resolvedLocale()]});var _y=m0;function J0(u){return{result:"success",value:u}}function yy(u){return{result:"error",value:u}}function ey(u){return u["property-type"]==="data-driven"}function y0(u){return!!u.expression&&u.expression.parameters.indexOf("zoom")>-1}function ev(u){return!!u.expression&&u.expression.interpolated}function og(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":u===null?"null":typeof u}function zv(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)}function Q0(u){return u}function tv(u,c){const h=c.type==="color",w=u.stops&&typeof u.stops[0][0]=="object",T=w||!(w||u.property!==void 0),F=u.type||(ev(c)?"exponential":"interval");if(h&&((u=g_({},u)).stops&&(u.stops=u.stops.map(yi=>[yi[0],Gg.parse(yi[1])])),u.default=Gg.parse(u.default?u.default:c.default)),u.colorSpace&&u.colorSpace!=="rgb"&&!g0[u.colorSpace])throw new Error(`Unknown color space: ${u.colorSpace}`);let Y,ut,di;if(F==="exponential")Y=km;else if(F==="interval")Y=Tm;else if(F==="categorical"){Y=Vv,ut=Object.create(null);for(const yi of u.stops)ut[yi[0]]=yi[1];di=typeof u.stops[0][0]}else{if(F!=="identity")throw new Error(`Unknown function type "${F}"`);Y=Sx}if(w){const yi={},kn=[];for(let al=0;al<u.stops.length;al++){const cl=u.stops[al],eh=cl[0].zoom;yi[eh]===void 0&&(yi[eh]={zoom:eh,type:u.type,property:u.property,default:u.default,stops:[]},kn.push(eh)),yi[eh].stops.push([cl[0].value,cl[1]])}const So=[];for(const al of kn)So.push([yi[al].zoom,tv(yi[al],c)]);const sa={name:"linear"};return{kind:"composite",interpolationType:sa,interpolationFactor:Zm.interpolationFactor.bind(void 0,sa),zoomStops:So.map(al=>al[0]),evaluate:({zoom:al},cl)=>km({stops:So,base:u.base},c,al).evaluate(al,cl)}}if(T){const yi=F==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:yi,interpolationFactor:Zm.interpolationFactor.bind(void 0,yi),zoomStops:u.stops.map(kn=>kn[0]),evaluate:({zoom:kn})=>Y(u,c,kn,ut,di)}}return{kind:"source",evaluate(yi,kn){const So=kn&&kn.properties?kn.properties[u.property]:void 0;return So===void 0?vy(u.default,c.default):Y(u,c,So,ut,di)}}}function vy(u,c,h){return u!==void 0?u:c!==void 0?c:h!==void 0?h:void 0}function Vv(u,c,h,w,T){return vy(typeof h===T?w[h]:void 0,u.default,c.default)}function Tm(u,c,h){if(og(h)!=="number")return vy(u.default,c.default);const w=u.stops.length;if(w===1||h<=u.stops[0][0])return u.stops[0][1];if(h>=u.stops[w-1][0])return u.stops[w-1][1];const T=Mv(u.stops.map(F=>F[0]),h);return u.stops[T][1]}function km(u,c,h){const w=u.base!==void 0?u.base:1;if(og(h)!=="number")return vy(u.default,c.default);const T=u.stops.length;if(T===1||h<=u.stops[0][0])return u.stops[0][1];if(h>=u.stops[T-1][0])return u.stops[T-1][1];const F=Mv(u.stops.map(kn=>kn[0]),h),Y=function(kn,So,sa,al){const cl=al-sa,eh=kn-sa;return cl===0?0:So===1?eh/cl:(Math.pow(So,eh)-1)/(Math.pow(So,cl)-1)}(h,w,u.stops[F][0],u.stops[F+1][0]),ut=u.stops[F][1],di=u.stops[F+1][1];let yi=yg[c.type]||Q0;if(u.colorSpace&&u.colorSpace!=="rgb"){const kn=g0[u.colorSpace];yi=(So,sa)=>kn.reverse(kn.interpolate(kn.forward(So),kn.forward(sa),Y))}return typeof ut.evaluate=="function"?{evaluate(...kn){const So=ut.evaluate.apply(void 0,kn),sa=di.evaluate.apply(void 0,kn);if(So!==void 0&&sa!==void 0)return yi(So,sa,Y)}}:yi(ut,di,Y)}function Sx(u,c,h){return c.type==="color"?h=Gg.parse(h):c.type==="formatted"?h=pm.fromString(h.toString()):c.type==="resolvedImage"?h=Vm.fromString(h.toString()):og(h)===c.type||c.type==="enum"&&c.values[h]||(h=void 0),vy(h,u.default,c.default)}class Uv{constructor(c,h){this.expression=c,this._warningHistory={},this._evaluator=new xx,this._defaultValue=h?function(w){return w.type==="color"&&(zv(w.default)||Array.isArray(w.default))?new Gg(0,0,0,0):w.type==="color"?Gg.parse(w.default)||null:w.default===void 0?null:w.default}(h):null,this._enumValues=h&&h.type==="enum"?h.values:null}evaluateWithoutErrorHandling(c,h,w,T,F,Y,ut,di){return this._evaluator.globals=c,this._evaluator.feature=h,this._evaluator.featureState=w,this._evaluator.canonical=T||null,this._evaluator.availableImages=F||null,this._evaluator.formattedSection=Y,this._evaluator.featureTileCoord=ut||null,this._evaluator.featureDistanceData=di||null,this.expression.evaluate(this._evaluator)}evaluate(c,h,w,T,F,Y,ut,di){this._evaluator.globals=c,this._evaluator.feature=h||null,this._evaluator.featureState=w||null,this._evaluator.canonical=T||null,this._evaluator.availableImages=F||null,this._evaluator.formattedSection=Y||null,this._evaluator.featureTileCoord=ut||null,this._evaluator.featureDistanceData=di||null;try{const yi=this.expression.evaluate(this._evaluator);if(yi==null||typeof yi=="number"&&yi!=yi)return this._defaultValue;if(this._enumValues&&!(yi in this._enumValues))throw new em(`Expected value to be one of ${Object.keys(this._enumValues).map(kn=>JSON.stringify(kn)).join(", ")}, but found ${JSON.stringify(yi)} instead.`);return yi}catch(yi){return this._warningHistory[yi.message]||(this._warningHistory[yi.message]=!0,typeof console<"u"&&console.warn(yi.message)),this._defaultValue}}}function ty(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in _y}function xy(u,c){const h=new Iv(_y,[],c?function(T){const F={color:Wm,string:qf,number:ap,enum:qf,boolean:jf,formatted:Ny,resolvedImage:ky};return T.type==="array"?a_(F[T.value]||Kf,T.length):F[T.type]}(c):void 0),w=h.parse(u,void 0,void 0,void 0,c&&c.type==="string"?{typeAnnotation:"coerce"}:void 0);return w?J0(new Uv(w,c)):yy(h.errors)}class ex{constructor(c,h){this.kind=c,this._styleExpression=h,this.isStateDependent=c!=="constant"&&!X_(h.expression)}evaluateWithoutErrorHandling(c,h,w,T,F,Y){return this._styleExpression.evaluateWithoutErrorHandling(c,h,w,T,F,Y)}evaluate(c,h,w,T,F,Y){return this._styleExpression.evaluate(c,h,w,T,F,Y)}}class Bm{constructor(c,h,w,T){this.kind=c,this.zoomStops=w,this._styleExpression=h,this.isStateDependent=c!=="camera"&&!X_(h.expression),this.interpolationType=T}evaluateWithoutErrorHandling(c,h,w,T,F,Y){return this._styleExpression.evaluateWithoutErrorHandling(c,h,w,T,F,Y)}evaluate(c,h,w,T,F,Y){return this._styleExpression.evaluate(c,h,w,T,F,Y)}interpolationFactor(c,h,w){return this.interpolationType?Zm.interpolationFactor(this.interpolationType,c,h,w):0}}function Eg(u,c){if((u=xy(u,c)).result==="error")return u;const h=u.value.expression,w=k_(h);if(!w&&!ey(c))return yy([new m_("","data expressions not supported")]);const T=Y_(h,["zoom","pitch","distance-from-center"]);if(!T&&!y0(c))return yy([new m_("","zoom expressions not supported")]);const F=$v(h);return F||T?F instanceof m_?yy([F]):F instanceof Zm&&!ev(c)?yy([new m_("",'"interpolate" expressions cannot be used with this property')]):J0(F?new Bm(w?"camera":"composite",u.value,F.labels,F instanceof Zm?F.interpolation:void 0):new ex(w?"constant":"source",u.value)):yy([new m_("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class iv{constructor(c,h){this._parameters=c,this._specification=h,g_(this,tv(this._parameters,this._specification))}static deserialize(c){return new iv(c._parameters,c._specification)}static serialize(c){return{_parameters:c._parameters,_specification:c._specification}}}function $v(u){let c=null;if(u instanceof K0)c=$v(u.result);else if(u instanceof q0){for(const h of u.args)if(c=$v(h),c)break}else(u instanceof Pv||u instanceof Zm)&&u.input instanceof Z_&&u.input.name==="zoom"&&(c=u);return c instanceof m_||u.eachChild(h=>{const w=$v(h);w instanceof m_?c=w:!c&&w?c=new m_("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):c&&w&&c!==w&&(c=new m_("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),c}class fp{constructor(c,h,w,T){this.message=(c?`${c}: `:"")+w,T&&(this.identifier=T),h!=null&&h.__line__&&(this.line=h.__line__)}}function $m(u){const c=u.key,h=u.value,w=u.valueSpec||{},T=u.objectElementValidators||{},F=u.style,Y=u.styleSpec;let ut=[];const di=og(h);if(di!=="object")return[new fp(c,h,`object expected, ${di} found`)];for(const yi in h){const kn=yi.split(".")[0];let So;T[kn]?So=T[kn]:w[kn]?So=fm:T["*"]?So=T["*"]:w["*"]&&(So=fm),So?ut=ut.concat(So({key:(c&&`${c}.`)+yi,value:h[yi],valueSpec:w[kn]||w["*"],style:F,styleSpec:Y,object:h,objectKey:yi},h)):ut.push(new fp(c,h[yi],`unknown property "${yi}"`))}for(const yi in w)T[yi]||w[yi].required&&w[yi].default===void 0&&h[yi]===void 0&&ut.push(new fp(c,h,`missing required property "${yi}"`));return ut}function Tx(u){const c=u.value,h=u.valueSpec,w=u.style,T=u.styleSpec,F=u.key,Y=u.arrayElementValidator||fm;if(og(c)!=="array")return[new fp(F,c,`array expected, ${og(c)} found`)];if(h.length&&c.length!==h.length)return[new fp(F,c,`array length ${h.length} expected, length ${c.length} found`)];if(h["min-length"]&&c.length<h["min-length"])return[new fp(F,c,`array length at least ${h["min-length"]} expected, length ${c.length} found`)];let ut={type:h.value,values:h.values,minimum:h.minimum,maximum:h.maximum,function:void 0};T.$version<7&&(ut.function=h.function),og(h.value)==="object"&&(ut=h.value);let di=[];for(let yi=0;yi<c.length;yi++)di=di.concat(Y({array:c,arrayIndex:yi,value:c[yi],valueSpec:ut,style:w,styleSpec:T,key:`${F}[${yi}]`}));return di}function rv(u){const c=u.key,h=u.value,w=u.valueSpec;let T=og(h);if(T==="number"&&h!=h&&(T="NaN"),T!=="number")return[new fp(c,h,`number expected, ${T} found`)];if("minimum"in w){let F=w.minimum;if(og(w.minimum)==="array"&&(F=w.minimum[u.arrayIndex]),h<F)return[new fp(c,h,`${h} is less than the minimum value ${F}`)]}if("maximum"in w){let F=w.maximum;if(og(w.maximum)==="array"&&(F=w.maximum[u.arrayIndex]),h>F)return[new fp(c,h,`${h} is greater than the maximum value ${F}`)]}return[]}function Xm(u){const c=u.valueSpec,h=xg(u.value.type);let w,T,F,Y={};const ut=h!=="categorical"&&u.value.property===void 0,di=!ut,yi=og(u.value.stops)==="array"&&og(u.value.stops[0])==="array"&&og(u.value.stops[0][0])==="object",kn=$m({key:u.key,value:u.value,valueSpec:u.styleSpec.function,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(al){if(h==="identity")return[new fp(al.key,al.value,'identity function may not have a "stops" property')];let cl=[];const eh=al.value;return cl=cl.concat(Tx({key:al.key,value:eh,valueSpec:al.valueSpec,style:al.style,styleSpec:al.styleSpec,arrayElementValidator:So})),og(eh)==="array"&&eh.length===0&&cl.push(new fp(al.key,eh,"array must have at least one stop")),cl},default:function(al){return fm({key:al.key,value:al.value,valueSpec:c,style:al.style,styleSpec:al.styleSpec})}}});return h==="identity"&&ut&&kn.push(new fp(u.key,u.value,'missing required property "property"')),h==="identity"||u.value.stops||kn.push(new fp(u.key,u.value,'missing required property "stops"')),h==="exponential"&&u.valueSpec.expression&&!ev(u.valueSpec)&&kn.push(new fp(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(di&&!ey(u.valueSpec)?kn.push(new fp(u.key,u.value,"property functions not supported")):ut&&!y0(u.valueSpec)&&kn.push(new fp(u.key,u.value,"zoom functions not supported"))),h!=="categorical"&&!yi||u.value.property!==void 0||kn.push(new fp(u.key,u.value,'"property" property is required')),kn;function So(al){let cl=[];const eh=al.value,fh=al.key;if(og(eh)!=="array")return[new fp(fh,eh,`array expected, ${og(eh)} found`)];if(eh.length!==2)return[new fp(fh,eh,`array length 2 expected, length ${eh.length} found`)];if(yi){if(og(eh[0])!=="object")return[new fp(fh,eh,`object expected, ${og(eh[0])} found`)];if(eh[0].zoom===void 0)return[new fp(fh,eh,"object stop key must have zoom")];if(eh[0].value===void 0)return[new fp(fh,eh,"object stop key must have value")];const Ch=xg(eh[0].zoom);if(typeof Ch!="number")return[new fp(fh,eh[0].zoom,"stop zoom values must be numbers")];if(F&&F>Ch)return[new fp(fh,eh[0].zoom,"stop zoom values must appear in ascending order")];Ch!==F&&(F=Ch,T=void 0,Y={}),cl=cl.concat($m({key:`${fh}[0]`,value:eh[0],valueSpec:{zoom:{}},style:al.style,styleSpec:al.styleSpec,objectElementValidators:{zoom:rv,value:sa}}))}else cl=cl.concat(sa({key:`${fh}[0]`,value:eh[0],valueSpec:{},style:al.style,styleSpec:al.styleSpec},eh));return ty(hm(eh[1]))?cl.concat([new fp(`${fh}[1]`,eh[1],"expressions are not allowed in function stops.")]):cl.concat(fm({key:`${fh}[1]`,value:eh[1],valueSpec:c,style:al.style,styleSpec:al.styleSpec}))}function sa(al,cl){const eh=og(al.value),fh=xg(al.value),Ch=al.value!==null?al.value:cl;if(w){if(eh!==w)return[new fp(al.key,Ch,`${eh} stop domain type must match previous stop domain type ${w}`)]}else w=eh;if(eh!=="number"&&eh!=="string"&&eh!=="boolean"&&typeof fh!="number"&&typeof fh!="string"&&typeof fh!="boolean")return[new fp(al.key,Ch,"stop domain value must be a number, string, or boolean")];if(eh!=="number"&&h!=="categorical"){let Gh=`number expected, ${eh} found`;return ey(c)&&h===void 0&&(Gh+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new fp(al.key,Ch,Gh)]}return h!=="categorical"||eh!=="number"||typeof fh=="number"&&isFinite(fh)&&Math.floor(fh)===fh?h!=="categorical"&&eh==="number"&&typeof fh=="number"&&typeof T=="number"&&T!==void 0&&fh<T?[new fp(al.key,Ch,"stop domain values must appear in ascending order")]:(T=fh,h==="categorical"&&fh in Y?[new fp(al.key,Ch,"stop domain values must be unique")]:(Y[fh]=!0,[])):[new fp(al.key,Ch,`integer expected, found ${String(fh)}`)]}}function tm(u){const c=(u.expressionContext==="property"?Eg:xy)(hm(u.value),u.valueSpec);if(c.result==="error")return c.value.map(w=>new fp(`${u.key}${w.key}`,u.value,w.message));const h=c.value.expression||c.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!h.outputDefined())return[new fp(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!X_(h))return[new fp(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter")return Np(h,u);if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!Y_(h,["zoom","feature-state"]))return[new fp(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!k_(h))return[new fp(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Np(u,c){const h=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(c.valueSpec&&c.valueSpec.expression)for(const T of c.valueSpec.expression.parameters)h.delete(T);if(h.size===0)return[];const w=[];return u instanceof Z_&&h.has(u.name)?[new fp(c.key,c.value,`["${u.name}"] expression is not supported in a filter for a ${c.object.type} layer with id: ${c.object.id}`)]:(u.eachChild(T=>{w.push(...Np(T,c))}),w)}function Kp(u){const c=u.key,h=u.value,w=u.valueSpec,T=[];return Array.isArray(w.values)?w.values.indexOf(xg(h))===-1&&T.push(new fp(c,h,`expected one of [${w.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(w.values).indexOf(xg(h))===-1&&T.push(new fp(c,h,`expected one of [${Object.keys(w.values).join(", ")}], ${JSON.stringify(h)} found`)),T}function nv(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const c of u.slice(1))if(!nv(c)&&typeof c!="boolean")return!1;return!0;default:return!0}}function Hv(u,c="fill"){if(u==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};nv(u)||(u=Mg(u));const h=u;let w=!0;try{w=function(yi){if(!ov(yi))return yi;let kn=hm(yi);return Am(kn),kn=tx(kn),kn}(h)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(h,null,2)}
        `)}const T=hd[`filter_${c}`],F=xy(w,T);let Y=null;if(F.result==="error")throw new Error(F.value.map(yi=>`${yi.key}: ${yi.message}`).join(", "));Y=(yi,kn,So)=>F.value.evaluate(yi,kn,{},So);let ut=null,di=null;if(w!==h){const yi=xy(h,T);if(yi.result==="error")throw new Error(yi.value.map(kn=>`${kn.key}: ${kn.message}`).join(", "));ut=(kn,So,sa,al,cl)=>yi.value.evaluate(kn,So,{},sa,void 0,void 0,al,cl),di=!k_(yi.value.expression)}return{filter:Y,dynamicFilter:ut||void 0,needGeometry:B_(w),needFeature:!!di}}function tx(u){if(!Array.isArray(u))return u;const c=function(h){if(x_.has(h[0])){for(let w=1;w<h.length;w++)if(ov(h[w]))return!0}return h}(u);return c===!0?c:c.map(h=>tx(h))}function Am(u){let c=!1;const h=[];if(u[0]==="case"){for(let w=1;w<u.length-1;w+=2)c=c||ov(u[w]),h.push(u[w+1]);h.push(u[u.length-1])}else if(u[0]==="match"){c=c||ov(u[1]);for(let w=2;w<u.length-1;w+=2)h.push(u[w+1]);h.push(u[u.length-1])}else if(u[0]==="step"){c=c||ov(u[1]);for(let w=1;w<u.length-1;w+=2)h.push(u[w+1])}c&&(u.length=0,u.push("any",...h));for(let w=1;w<u.length;w++)Am(u[w])}function ov(u){if(!Array.isArray(u))return!1;if((c=u[0])==="pitch"||c==="distance-from-center")return!0;var c;for(let h=1;h<u.length;h++)if(ov(u[h]))return!0;return!1}const x_=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Cw(u,c){return u<c?-1:u>c?1:0}function B_(u){if(!Array.isArray(u))return!1;if(u[0]==="within")return!0;for(let c=1;c<u.length;c++)if(B_(u[c]))return!0;return!1}function Mg(u){if(!u)return!0;const c=u[0];return u.length<=1?c!=="any":c==="=="?Jg(u[1],u[2],"=="):c==="!="?sv(Jg(u[1],u[2],"==")):c==="<"||c===">"||c==="<="||c===">="?Jg(u[1],u[2],c):c==="any"?(h=u.slice(1),["any"].concat(h.map(Mg))):c==="all"?["all"].concat(u.slice(1).map(Mg)):c==="none"?["all"].concat(u.slice(1).map(Mg).map(sv)):c==="in"?ix(u[1],u.slice(2)):c==="!in"?sv(ix(u[1],u.slice(2))):c==="has"?wy(u[1]):c==="!has"?sv(wy(u[1])):c!=="within"||u;var h}function Jg(u,c,h){switch(u){case"$type":return[`filter-type-${h}`,c];case"$id":return[`filter-id-${h}`,c];default:return[`filter-${h}`,u,c]}}function ix(u,c){if(c.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",c]];case"$id":return["filter-id-in",["literal",c]];default:return c.length>200&&!c.some(h=>typeof h!=typeof c[0])?["filter-in-large",u,["literal",c.sort(Cw)]]:["filter-in-small",u,["literal",c]]}}function wy(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function sv(u){return["!",u]}function av(u){return nv(hm(u.value))?tm(g_({},u,{expressionContext:"filter",valueSpec:u.styleSpec[`filter_${u.layerType||"fill"}`]})):Ym(u)}function Ym(u){const c=u.value,h=u.key;if(og(c)!=="array")return[new fp(h,c,`array expected, ${og(c)} found`)];const w=u.styleSpec;let T,F=[];if(c.length<1)return[new fp(h,c,"filter array must have at least 1 element")];switch(F=F.concat(Kp({key:`${h}[0]`,value:c[0],valueSpec:w.filter_operator,style:u.style,styleSpec:u.styleSpec})),xg(c[0])){case"<":case"<=":case">":case">=":c.length>=2&&xg(c[1])==="$type"&&F.push(new fp(h,c,`"$type" cannot be use with operator "${c[0]}"`));case"==":case"!=":c.length!==3&&F.push(new fp(h,c,`filter array for operator "${c[0]}" must have 3 elements`));case"in":case"!in":c.length>=2&&(T=og(c[1]),T!=="string"&&F.push(new fp(`${h}[1]`,c[1],`string expected, ${T} found`)));for(let Y=2;Y<c.length;Y++)T=og(c[Y]),xg(c[1])==="$type"?F=F.concat(Kp({key:`${h}[${Y}]`,value:c[Y],valueSpec:w.geometry_type,style:u.style,styleSpec:u.styleSpec})):T!=="string"&&T!=="number"&&T!=="boolean"&&F.push(new fp(`${h}[${Y}]`,c[Y],`string, number, or boolean expected, ${T} found`));break;case"any":case"all":case"none":for(let Y=1;Y<c.length;Y++)F=F.concat(Ym({key:`${h}[${Y}]`,value:c[Y],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":T=og(c[1]),c.length!==2?F.push(new fp(h,c,`filter array for "${c[0]}" operator must have 2 elements`)):T!=="string"&&F.push(new fp(`${h}[1]`,c[1],`string expected, ${T} found`));break;case"within":T=og(c[1]),c.length!==2?F.push(new fp(h,c,`filter array for "${c[0]}" operator must have 2 elements`)):T!=="object"&&F.push(new fp(`${h}[1]`,c[1],`object expected, ${T} found`))}return F}function jv(u,c){const h=u.key,w=u.style,T=u.styleSpec,F=u.value,Y=u.objectKey,ut=T[`${c}_${u.layerType}`];if(!ut)return[];const di=Y.match(/^(.*)-transition$/);if(c==="paint"&&di&&ut[di[1]]&&ut[di[1]].transition)return fm({key:h,value:F,valueSpec:T.transition,style:w,styleSpec:T});const yi=u.valueSpec||ut[Y];if(!yi)return[new fp(h,F,`unknown property "${Y}"`)];let kn;if(og(F)==="string"&&ey(yi)&&!yi.tokens&&(kn=/^{([^}]+)}$/.exec(F))){const sa=`\`{ "type": "identity", "property": ${kn?JSON.stringify(kn[1]):'"_"'} }\``;return[new fp(h,F,`"${Y}" does not support interpolation syntax
Use an identity property function instead: ${sa}.`)]}const So=[];return u.layerType==="symbol"&&(Y==="text-field"&&w&&!w.glyphs&&So.push(new fp(h,F,'use of "text-field" requires a style "glyphs" property')),Y==="text-font"&&zv(hm(F))&&xg(F.type)==="identity"&&So.push(new fp(h,F,'"text-font" does not support identity functions'))),So.concat(fm({key:u.key,value:F,valueSpec:yi,style:w,styleSpec:T,expressionContext:"property",propertyType:c,propertyKey:Y}))}function by(u){return jv(u,"paint")}function Wv(u){return jv(u,"layout")}function qv(u){let c=[];const h=u.value,w=u.key,T=u.style,F=u.styleSpec;h.type||h.ref||c.push(new fp(w,h,'either "type" or "ref" is required'));let Y=xg(h.type);const ut=xg(h.ref);if(h.id){const di=xg(h.id);for(let yi=0;yi<u.arrayIndex;yi++){const kn=T.layers[yi];xg(kn.id)===di&&c.push(new fp(w,h.id,`duplicate layer id "${h.id}", previously used at line ${kn.id.__line__}`))}}if("ref"in h){let di;["type","source","source-layer","filter","layout"].forEach(yi=>{yi in h&&c.push(new fp(w,h[yi],`"${yi}" is prohibited for ref layers`))}),T.layers.forEach(yi=>{xg(yi.id)===ut&&(di=yi)}),di?di.ref?c.push(new fp(w,h.ref,"ref cannot reference another ref layer")):Y=xg(di.type):typeof ut=="string"&&c.push(new fp(w,h.ref,`ref layer "${ut}" not found`))}else if(Y!=="background"&&Y!=="sky")if(h.source){const di=T.sources&&T.sources[h.source],yi=di&&xg(di.type);di?yi==="vector"&&Y==="raster"?c.push(new fp(w,h.source,`layer "${h.id}" requires a raster source`)):yi==="raster"&&Y!=="raster"?c.push(new fp(w,h.source,`layer "${h.id}" requires a vector source`)):yi!=="vector"||h["source-layer"]?yi==="raster-dem"&&Y!=="hillshade"?c.push(new fp(w,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):Y!=="line"||!h.paint||!h.paint["line-gradient"]&&!h.paint["line-trim-offset"]||yi==="geojson"&&di.lineMetrics||c.push(new fp(w,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):c.push(new fp(w,h,`layer "${h.id}" must specify a "source-layer"`)):c.push(new fp(w,h.source,`source "${h.source}" not found`))}else c.push(new fp(w,h,'missing required property "source"'));return c=c.concat($m({key:w,value:h,valueSpec:F.layer,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{"*":()=>[],type:()=>fm({key:`${w}.type`,value:h.type,valueSpec:F.layer.type,style:u.style,styleSpec:u.styleSpec,object:h,objectKey:"type"}),filter:di=>av(g_({layerType:Y},di)),layout:di=>$m({layer:h,key:di.key,value:di.value,valueSpec:{},style:di.style,styleSpec:di.styleSpec,objectElementValidators:{"*":yi=>Wv(g_({layerType:Y},yi))}}),paint:di=>$m({layer:h,key:di.key,value:di.value,valueSpec:{},style:di.style,styleSpec:di.styleSpec,objectElementValidators:{"*":yi=>by(g_({layerType:Y},yi))}})}})),c}function G_(u){const c=u.value,h=u.key,w=og(c);return w!=="string"?[new fp(h,c,`string expected, ${w} found`)]:[]}const lv={promoteId:function({key:u,value:c}){if(og(c)==="string")return G_({key:u,value:c});{const h=[];for(const w in c)h.push(...G_({key:`${u}.${w}`,value:c[w]}));return h}}};function Cy(u){const c=u.value,h=u.key,w=u.styleSpec,T=u.style;if(!c.type)return[new fp(h,c,'"type" is required')];const F=xg(c.type);let Y;switch(F){case"vector":case"raster":case"raster-dem":return Y=$m({key:h,value:c,valueSpec:w[`source_${F.replace("-","_")}`],style:u.style,styleSpec:w,objectElementValidators:lv}),Y;case"geojson":if(Y=$m({key:h,value:c,valueSpec:w.source_geojson,style:T,styleSpec:w,objectElementValidators:lv}),c.cluster)for(const ut in c.clusterProperties){const[di,yi]=c.clusterProperties[ut],kn=typeof di=="string"?[di,["accumulated"],["get",ut]]:di;Y.push(...tm({key:`${h}.${ut}.map`,value:yi,expressionContext:"cluster-map"})),Y.push(...tm({key:`${h}.${ut}.reduce`,value:kn,expressionContext:"cluster-reduce"}))}return Y;case"video":return $m({key:h,value:c,valueSpec:w.source_video,style:T,styleSpec:w});case"image":return $m({key:h,value:c,valueSpec:w.source_image,style:T,styleSpec:w});case"canvas":return[new fp(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Kp({key:`${h}.type`,value:c.type,valueSpec:{values:Ax(w)},style:T,styleSpec:w})}}function Ax(u){return u.source.reduce((c,h)=>{const w=u[h];return w.type.type==="enum"&&(c=c.concat(Object.keys(w.type.values))),c},[])}function v0(u){const c=u.value,h=u.styleSpec,w=h.light,T=u.style;let F=[];const Y=og(c);if(c===void 0)return F;if(Y!=="object")return F=F.concat([new fp("light",c,`object expected, ${Y} found`)]),F;for(const ut in c){const di=ut.match(/^(.*)-transition$/);F=F.concat(di&&w[di[1]]&&w[di[1]].transition?fm({key:ut,value:c[ut],valueSpec:h.transition,style:T,styleSpec:h}):w[ut]?fm({key:ut,value:c[ut],valueSpec:w[ut],style:T,styleSpec:h}):[new fp(ut,c[ut],`unknown property "${ut}"`)])}return F}function iy(u){const c=u.value,h=u.key,w=u.style,T=u.styleSpec,F=T.terrain;let Y=[];const ut=og(c);if(c===void 0)return Y;if(ut!=="object")return Y=Y.concat([new fp("terrain",c,`object expected, ${ut} found`)]),Y;for(const di in c){const yi=di.match(/^(.*)-transition$/);Y=Y.concat(yi&&F[yi[1]]&&F[yi[1]].transition?fm({key:di,value:c[di],valueSpec:T.transition,style:w,styleSpec:T}):F[di]?fm({key:di,value:c[di],valueSpec:F[di],style:w,styleSpec:T}):[new fp(di,c[di],`unknown property "${di}"`)])}if(c.source){const di=w.sources&&w.sources[c.source],yi=di&&xg(di.type);di?yi!=="raster-dem"&&Y.push(new fp(h,c.source,`terrain cannot be used with a source of type ${String(yi)}, it only be used with a "raster-dem" source type`)):Y.push(new fp(h,c.source,`source "${c.source}" not found`))}else Y.push(new fp(h,c,'terrain is missing required property "source"'));return Y}function x0(u){const c=u.value,h=u.style,w=u.styleSpec,T=w.fog;let F=[];const Y=og(c);if(c===void 0)return F;if(Y!=="object")return F=F.concat([new fp("fog",c,`object expected, ${Y} found`)]),F;for(const ut in c){const di=ut.match(/^(.*)-transition$/);F=F.concat(di&&T[di[1]]&&T[di[1]].transition?fm({key:ut,value:c[ut],valueSpec:w.transition,style:h,styleSpec:w}):T[ut]?fm({key:ut,value:c[ut],valueSpec:T[ut],style:h,styleSpec:w}):[new fp(ut,c[ut],`unknown property "${ut}"`)])}return F}const rx={"*":()=>[],array:Tx,boolean:function(u){const c=u.value,h=u.key,w=og(c);return w!=="boolean"?[new fp(h,c,`boolean expected, ${w} found`)]:[]},number:rv,color:function(u){const c=u.key,h=u.value,w=og(h);return w!=="string"?[new fp(c,h,`color expected, ${w} found`)]:G0(h)===null?[new fp(c,h,`color expected, "${h}" found`)]:[]},enum:Kp,filter:av,function:Xm,layer:qv,object:$m,source:Cy,light:v0,terrain:iy,fog:x0,string:G_,formatted:function(u){return G_(u).length===0?[]:tm(u)},resolvedImage:function(u){return G_(u).length===0?[]:tm(u)},projection:function(u){const c=u.value,h=u.styleSpec,w=h.projection,T=u.style;let F=[];const Y=og(c);if(Y==="object")for(const ut in c)F=F.concat(fm({key:ut,value:c[ut],valueSpec:w[ut],style:T,styleSpec:h}));else Y!=="string"&&(F=F.concat([new fp("projection",c,`object or string expected, ${Y} found`)]));return F}};function fm(u){const c=u.value,h=u.valueSpec,w=u.styleSpec;return h.expression&&zv(xg(c))?Xm(u):h.expression&&ty(hm(c))?tm(u):h.type&&rx[h.type]?rx[h.type](u):$m(g_({},u,{valueSpec:h.type?w[h.type]:h}))}function nx(u){const c=u.value,h=u.key,w=G_(u);return w.length||(c.indexOf("{fontstack}")===-1&&w.push(new fp(h,c,'"glyphs" url must include a "{fontstack}" token')),c.indexOf("{range}")===-1&&w.push(new fp(h,c,'"glyphs" url must include a "{range}" token'))),w}function w0(u,c=hd){return A(fm({key:"",value:u,valueSpec:c.$root,styleSpec:c,style:u,objectElementValidators:{glyphs:nx,"*":()=>[]}}))}const Ve=u=>A(by(u)),g=u=>A(Wv(u));function A(u){return u.slice().sort((c,h)=>c.line&&h.line?c.line-h.line:0)}function _e(u,c){let h=!1;if(c&&c.length)for(const w of c)u.fire(new s_(new Error(w.message))),h=!0;return h}var ct=In,pi=3;function In(u,c,h){var w=this.cells=[];if(u instanceof ArrayBuffer){this.arrayBuffer=u;var T=new Int32Array(this.arrayBuffer);u=T[0],this.d=(c=T[1])+2*(h=T[2]);for(var F=0;F<this.d*this.d;F++){var Y=T[pi+F],ut=T[pi+F+1];w.push(Y===ut?null:T.subarray(Y,ut))}var di=T[pi+w.length+1];this.keys=T.subarray(T[pi+w.length],di),this.bboxes=T.subarray(di),this.insert=this._insertReadonly}else{this.d=c+2*h;for(var yi=0;yi<this.d*this.d;yi++)w.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=u,this.padding=h,this.scale=c/u,this.uid=0;var kn=h/c*u;this.min=-kn,this.max=u+kn}In.prototype.insert=function(u,c,h,w,T){this._forEachCell(c,h,w,T,this._insertCell,this.uid++),this.keys.push(u),this.bboxes.push(c),this.bboxes.push(h),this.bboxes.push(w),this.bboxes.push(T)},In.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},In.prototype._insertCell=function(u,c,h,w,T,F){this.cells[T].push(F)},In.prototype.query=function(u,c,h,w,T){var F=this.min,Y=this.max;if(u<=F&&c<=F&&Y<=h&&Y<=w&&!T)return Array.prototype.slice.call(this.keys);var ut=[];return this._forEachCell(u,c,h,w,this._queryCell,ut,{},T),ut},In.prototype._queryCell=function(u,c,h,w,T,F,Y,ut){var di=this.cells[T];if(di!==null)for(var yi=this.keys,kn=this.bboxes,So=0;So<di.length;So++){var sa=di[So];if(Y[sa]===void 0){var al=4*sa;(ut?ut(kn[al+0],kn[al+1],kn[al+2],kn[al+3]):u<=kn[al+2]&&c<=kn[al+3]&&h>=kn[al+0]&&w>=kn[al+1])?(Y[sa]=!0,F.push(yi[sa])):Y[sa]=!1}}},In.prototype._forEachCell=function(u,c,h,w,T,F,Y,ut){for(var di=this._convertToCellCoord(u),yi=this._convertToCellCoord(c),kn=this._convertToCellCoord(h),So=this._convertToCellCoord(w),sa=di;sa<=kn;sa++)for(var al=yi;al<=So;al++){var cl=this.d*al+sa;if((!ut||ut(this._convertFromCellCoord(sa),this._convertFromCellCoord(al),this._convertFromCellCoord(sa+1),this._convertFromCellCoord(al+1)))&&T.call(this,u,c,h,w,cl,F,Y,ut))return}},In.prototype._convertFromCellCoord=function(u){return(u-this.padding)/this.scale},In.prototype._convertToCellCoord=function(u){return Math.max(0,Math.min(this.d-1,Math.floor(u*this.scale)+this.padding))},In.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var u=this.cells,c=pi+this.cells.length+1+1,h=0,w=0;w<this.cells.length;w++)h+=this.cells[w].length;var T=new Int32Array(c+h+this.keys.length+this.bboxes.length);T[0]=this.extent,T[1]=this.n,T[2]=this.padding;for(var F=c,Y=0;Y<u.length;Y++){var ut=u[Y];T[pi+Y]=F,T.set(ut,F),F+=ut.length}return T[pi+u.length]=F,T.set(this.keys,F),T[pi+u.length+1]=F+=this.keys.length,T.set(this.bboxes,F),F+=this.bboxes.length,T.buffer};var ds=Wr(ct);const hs={};function vs(u,c,h={}){Object.defineProperty(u,"_classRegistryKey",{value:c,writeable:!1}),hs[c]={klass:u,omit:h.omit||[]}}vs(Object,"Object"),ds.serialize=function(u,c){const h=u.toArrayBuffer();return c&&c.push(h),{buffer:h}},ds.deserialize=function(u){return new ds(u.buffer)},Object.defineProperty(ds,"name",{value:"Grid"}),vs(ds,"Grid"),vs(Gg,"Color"),vs(Error,"Error"),vs(Up,"AJAXError"),vs(Vm,"ResolvedImage"),vs(iv,"StylePropertyFunction"),vs(Uv,"StyleExpression",{omit:["_evaluator"]}),vs(Bm,"ZoomDependentExpression"),vs(ex,"ZoomConstantExpression"),vs(Z_,"CompoundExpression",{omit:["_evaluate"]});for(const u in _y)hs[_y[u]._classRegistryKey]||vs(_y[u],`Expression${u}`);function fl(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function dl(u){return m.ImageBitmap&&u instanceof m.ImageBitmap}function dh(u,c){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp)return u;if(fl(u)||dl(u))return c&&c.push(u),u;if(ArrayBuffer.isView(u)){const h=u;return c&&c.push(h.buffer),h}if(u instanceof m.ImageData)return c&&c.push(u.data.buffer),u;if(Array.isArray(u)){const h=[];for(const w of u)h.push(dh(w,c));return h}if(typeof u=="object"){const h=u.constructor,w=h._classRegistryKey;if(!w)throw new Error(`can't serialize object of unregistered class ${w}`);const T=h.serialize?h.serialize(u,c):{};if(!h.serialize){for(const F in u)u.hasOwnProperty(F)&&(hs[w].omit.indexOf(F)>=0||(T[F]=dh(u[F],c)));u instanceof Error&&(T.message=u.message)}if(T.$name)throw new Error("$name property is reserved for worker serialization logic.");return w!=="Object"&&(T.$name=w),T}throw new Error("can't serialize object of type "+typeof u)}function Ah(u){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||fl(u)||dl(u)||ArrayBuffer.isView(u)||u instanceof m.ImageData)return u;if(Array.isArray(u))return u.map(Ah);if(typeof u=="object"){const c=u.$name||"Object",{klass:h}=hs[c];if(!h)throw new Error(`can't deserialize unregistered class ${c}`);if(h.deserialize)return h.deserialize(u);const w=Object.create(h.prototype);for(const T of Object.keys(u))T!=="$name"&&(w[T]=Ah(u[T]));return w}throw new Error("can't deserialize object of type "+typeof u)}const hh={"Latin-1 Supplement":u=>u>=128&&u<=255,Arabic:u=>u>=1536&&u<=1791,"Arabic Supplement":u=>u>=1872&&u<=1919,"Arabic Extended-A":u=>u>=2208&&u<=2303,"Hangul Jamo":u=>u>=4352&&u<=4607,"Unified Canadian Aboriginal Syllabics":u=>u>=5120&&u<=5759,Khmer:u=>u>=6016&&u<=6143,"Unified Canadian Aboriginal Syllabics Extended":u=>u>=6320&&u<=6399,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"CJK Radicals Supplement":u=>u>=11904&&u<=12031,"Kangxi Radicals":u=>u>=12032&&u<=12255,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Hiragana:u=>u>=12352&&u<=12447,Katakana:u=>u>=12448&&u<=12543,Bopomofo:u=>u>=12544&&u<=12591,"Hangul Compatibility Jamo":u=>u>=12592&&u<=12687,Kanbun:u=>u>=12688&&u<=12703,"Bopomofo Extended":u=>u>=12704&&u<=12735,"CJK Strokes":u=>u>=12736&&u<=12783,"Katakana Phonetic Extensions":u=>u>=12784&&u<=12799,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"CJK Unified Ideographs Extension A":u=>u>=13312&&u<=19903,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"CJK Unified Ideographs":u=>u>=19968&&u<=40959,"Yi Syllables":u=>u>=40960&&u<=42127,"Yi Radicals":u=>u>=42128&&u<=42191,"Hangul Jamo Extended-A":u=>u>=43360&&u<=43391,"Hangul Syllables":u=>u>=44032&&u<=55215,"Hangul Jamo Extended-B":u=>u>=55216&&u<=55295,"Private Use Area":u=>u>=57344&&u<=63743,"CJK Compatibility Ideographs":u=>u>=63744&&u<=64255,"Arabic Presentation Forms-A":u=>u>=64336&&u<=65023,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Arabic Presentation Forms-B":u=>u>=65136&&u<=65279,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519};function Rh(u){for(const c of u)if(ad(c.charCodeAt(0)))return!0;return!1}function zh(u){for(const c of u)if(!Kh(c.charCodeAt(0)))return!1;return!0}function Kh(u){return!(hh.Arabic(u)||hh["Arabic Supplement"](u)||hh["Arabic Extended-A"](u)||hh["Arabic Presentation Forms-A"](u)||hh["Arabic Presentation Forms-B"](u))}function ad(u){return!(u!==746&&u!==747&&(u<4352||!(hh["Bopomofo Extended"](u)||hh.Bopomofo(u)||hh["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||hh["CJK Compatibility Ideographs"](u)||hh["CJK Compatibility"](u)||hh["CJK Radicals Supplement"](u)||hh["CJK Strokes"](u)||!(!hh["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||hh["CJK Unified Ideographs Extension A"](u)||hh["CJK Unified Ideographs"](u)||hh["Enclosed CJK Letters and Months"](u)||hh["Hangul Compatibility Jamo"](u)||hh["Hangul Jamo Extended-A"](u)||hh["Hangul Jamo Extended-B"](u)||hh["Hangul Jamo"](u)||hh["Hangul Syllables"](u)||hh.Hiragana(u)||hh["Ideographic Description Characters"](u)||hh.Kanbun(u)||hh["Kangxi Radicals"](u)||hh["Katakana Phonetic Extensions"](u)||hh.Katakana(u)&&u!==12540||!(!hh["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!hh["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||hh["Unified Canadian Aboriginal Syllabics"](u)||hh["Unified Canadian Aboriginal Syllabics Extended"](u)||hh["Vertical Forms"](u)||hh["Yijing Hexagram Symbols"](u)||hh["Yi Syllables"](u)||hh["Yi Radicals"](u))))}function Lh(u){return!(ad(u)||function(c){return!!(hh["Latin-1 Supplement"](c)&&(c===167||c===169||c===174||c===177||c===188||c===189||c===190||c===215||c===247)||hh["General Punctuation"](c)&&(c===8214||c===8224||c===8225||c===8240||c===8241||c===8251||c===8252||c===8258||c===8263||c===8264||c===8265||c===8273)||hh["Letterlike Symbols"](c)||hh["Number Forms"](c)||hh["Miscellaneous Technical"](c)&&(c>=8960&&c<=8967||c>=8972&&c<=8991||c>=8996&&c<=9e3||c===9003||c>=9085&&c<=9114||c>=9150&&c<=9165||c===9167||c>=9169&&c<=9179||c>=9186&&c<=9215)||hh["Control Pictures"](c)&&c!==9251||hh["Optical Character Recognition"](c)||hh["Enclosed Alphanumerics"](c)||hh["Geometric Shapes"](c)||hh["Miscellaneous Symbols"](c)&&!(c>=9754&&c<=9759)||hh["Miscellaneous Symbols and Arrows"](c)&&(c>=11026&&c<=11055||c>=11088&&c<=11097||c>=11192&&c<=11243)||hh["CJK Symbols and Punctuation"](c)||hh.Katakana(c)||hh["Private Use Area"](c)||hh["CJK Compatibility Forms"](c)||hh["Small Form Variants"](c)||hh["Halfwidth and Fullwidth Forms"](c)||c===8734||c===8756||c===8757||c>=9984&&c<=10087||c>=10102&&c<=10131||c===65532||c===65533)}(u))}function od(u){return u>=1424&&u<=2303||hh["Arabic Presentation Forms-A"](u)||hh["Arabic Presentation Forms-B"](u)}function md(u,c){return!(!c&&od(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||hh.Khmer(u))}function Nd(u){for(const c of u)if(od(c.charCodeAt(0)))return!0;return!1}const Hd="deferred",tp="loading",Vd="loaded";let gp=null,L="unavailable",p=null;const S=function(u){u&&typeof u=="string"&&u.indexOf("NetworkError")>-1&&(L="error"),gp&&gp(u)};function X(){ze.fire(new Dg("pluginStateChange",{pluginStatus:L,pluginURL:p}))}const ze=new f_,kt=function(){return L},vi=function(){if(L!==Hd||!p)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");L=tp,X(),p&&ng({url:p},u=>{u?S(u):(L=Vd,X())})},or={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>L===Vd||or.applyArabicShaping!=null,isLoading:()=>L===tp,setState(u){L=u.pluginStatus,p=u.pluginURL},isParsed:()=>or.applyArabicShaping!=null&&or.processBidirectionalText!=null&&or.processStyledBidirectionalText!=null,getPluginURL:()=>p};class Gn{constructor(c,h){this.zoom=c,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.transition=h.transition,this.pitch=h.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(c){return function(h,w){for(const T of h)if(!md(T.charCodeAt(0),w))return!1;return!0}(c,or.isLoaded())}}class ia{constructor(c,h){this.property=c,this.value=h,this.expression=function(w,T){if(zv(w))return new iv(w,T);if(ty(w)){const F=Eg(w,T);if(F.result==="error")throw new Error(F.value.map(Y=>`${Y.key}: ${Y.message}`).join(", "));return F.value}{let F=w;return typeof w=="string"&&T.type==="color"&&(F=Gg.parse(w)),{kind:"constant",evaluate:()=>F}}}(h===void 0?c.specification.default:h,c.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(c,h,w){return this.property.possiblyEvaluate(this,c,h,w)}}class oa{constructor(c){this.property=c,this.value=new ia(c,void 0)}transitioned(c,h){return new lh(this.property,this.value,h,wd({},c.transition,this.transition),c.now)}untransitioned(){return new lh(this.property,this.value,null,{},0)}}class pl{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitionablePropertyValues)}getValue(c){return Ip(this._values[c].value.value)}setValue(c,h){this._values.hasOwnProperty(c)||(this._values[c]=new oa(this._values[c].property)),this._values[c].value=new ia(this._values[c].property,h===null?void 0:Ip(h))}getTransition(c){return Ip(this._values[c].transition)}setTransition(c,h){this._values.hasOwnProperty(c)||(this._values[c]=new oa(this._values[c].property)),this._values[c].transition=Ip(h)||void 0}serialize(){const c={};for(const h of Object.keys(this._values)){const w=this.getValue(h);w!==void 0&&(c[h]=w);const T=this.getTransition(h);T!==void 0&&(c[`${h}-transition`]=T)}return c}transitioned(c,h){const w=new gh(this._properties);for(const T of Object.keys(this._values))w._values[T]=this._values[T].transitioned(c,h._values[T]);return w}untransitioned(){const c=new gh(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].untransitioned();return c}}class lh{constructor(c,h,w,T,F){const Y=T.delay||0,ut=T.duration||0;F=F||0,this.property=c,this.value=h,this.begin=F+Y,this.end=this.begin+ut,c.specification.transition&&(T.delay||T.duration)&&(this.prior=w)}possiblyEvaluate(c,h,w){const T=c.now||0,F=this.value.possiblyEvaluate(c,h,w),Y=this.prior;if(Y){if(T>this.end)return this.prior=null,F;if(this.value.isDataDriven())return this.prior=null,F;if(T<this.begin)return Y.possiblyEvaluate(c,h,w);{const ut=(T-this.begin)/(this.end-this.begin);return this.property.interpolate(Y.possiblyEvaluate(c,h,w),F,Bh(ut))}}return F}}class gh{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitioningPropertyValues)}possiblyEvaluate(c,h,w){const T=new xh(this._properties);for(const F of Object.keys(this._values))T._values[F]=this._values[F].possiblyEvaluate(c,h,w);return T}hasTransition(){for(const c of Object.keys(this._values))if(this._values[c].prior)return!0;return!1}}class yh{constructor(c){this._properties=c,this._values=Object.create(c.defaultPropertyValues)}getValue(c){return Ip(this._values[c].value)}setValue(c,h){this._values[c]=new ia(this._values[c].property,h===null?void 0:Ip(h))}serialize(){const c={};for(const h of Object.keys(this._values)){const w=this.getValue(h);w!==void 0&&(c[h]=w)}return c}possiblyEvaluate(c,h,w){const T=new xh(this._properties);for(const F of Object.keys(this._values))T._values[F]=this._values[F].possiblyEvaluate(c,h,w);return T}}class _h{constructor(c,h,w){this.property=c,this.value=h,this.parameters=w}isConstant(){return this.value.kind==="constant"}constantOr(c){return this.value.kind==="constant"?this.value.value:c}evaluate(c,h,w,T){return this.property.evaluate(this.value,this.parameters,c,h,w,T)}}class xh{constructor(c){this._properties=c,this._values=Object.create(c.defaultPossiblyEvaluatedValues)}get(c){return this._values[c]}}class _l{constructor(c){this.specification=c}possiblyEvaluate(c,h){return c.expression.evaluate(h)}interpolate(c,h,w){const T=yg[this.specification.type];return T?T(c,h,w):c}}class mh{constructor(c,h){this.specification=c,this.overrides=h}possiblyEvaluate(c,h,w,T){return new _h(this,c.expression.kind==="constant"||c.expression.kind==="camera"?{kind:"constant",value:c.expression.evaluate(h,null,{},w,T)}:c.expression,h)}interpolate(c,h,w){if(c.value.kind!=="constant"||h.value.kind!=="constant")return c;if(c.value.value===void 0||h.value.value===void 0)return new _h(this,{kind:"constant",value:void 0},c.parameters);const T=yg[this.specification.type];return T?new _h(this,{kind:"constant",value:T(c.value.value,h.value.value,w)},c.parameters):c}evaluate(c,h,w,T,F,Y){return c.kind==="constant"?c.value:c.evaluate(h,w,T,F,Y)}}class wh{constructor(c){this.specification=c}possiblyEvaluate(c,h,w,T){return!!c.expression.evaluate(h,null,{},w,T)}interpolate(){return!1}}class Sh{constructor(c){this.properties=c,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const h=new Gn(0,{});for(const w in c){const T=c[w];T.specification.overridable&&this.overridableProperties.push(w);const F=this.defaultPropertyValues[w]=new ia(T,void 0),Y=this.defaultTransitionablePropertyValues[w]=new oa(T);this.defaultTransitioningPropertyValues[w]=Y.untransitioned(),this.defaultPossiblyEvaluatedValues[w]=F.possiblyEvaluate(h)}}}function Oh(u,c){return 256*(u=td(Math.floor(u),0,255))+td(Math.floor(c),0,255)}vs(mh,"DataDrivenProperty"),vs(_l,"DataConstantProperty"),vs(wh,"ColorRampProperty");const Uh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Vh{constructor(c,h){this._structArray=c,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Wh{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(c,h){return c._trim(),h&&(c.isTransferred=!0,h.push(c.arrayBuffer)),{length:c.length,arrayBuffer:c.arrayBuffer}}static deserialize(c){const h=Object.create(this.prototype);return h.arrayBuffer=c.arrayBuffer,h.length=c.length,h.capacity=c.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(c){this.reserve(c),this.length=c}reserve(c){if(c>this.capacity){this.capacity=Math.max(c,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Zh(u,c=1){let h=0,w=0;return{members:u.map(T=>{const F=Uh[T.type].BYTES_PER_ELEMENT,Y=h=id(h,Math.max(c,F)),ut=T.components||1;return w=Math.max(w,F),h+=F*ut,{name:T.name,type:T.type,components:ut,offset:Y}}),size:id(h,Math.max(w,c)),alignment:c}}function id(u,c){return Math.ceil(u/c)*c}class Bd extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h){const w=this.length;return this.resize(w+1),this.emplace(w,c,h)}emplace(c,h,w){const T=2*c;return this.int16[T+0]=h,this.int16[T+1]=w,c}}Bd.prototype.bytesPerElement=4,vs(Bd,"StructArrayLayout2i4");class ed extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h,w){const T=this.length;return this.resize(T+1),this.emplace(T,c,h,w)}emplace(c,h,w,T){const F=3*c;return this.int16[F+0]=h,this.int16[F+1]=w,this.int16[F+2]=T,c}}ed.prototype.bytesPerElement=6,vs(ed,"StructArrayLayout3i6");class Sd extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h,w,T){const F=this.length;return this.resize(F+1),this.emplace(F,c,h,w,T)}emplace(c,h,w,T,F){const Y=4*c;return this.int16[Y+0]=h,this.int16[Y+1]=w,this.int16[Y+2]=T,this.int16[Y+3]=F,c}}Sd.prototype.bytesPerElement=8,vs(Sd,"StructArrayLayout4i8");class dd extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,h,w,T,F,Y,ut){const di=this.length;return this.resize(di+1),this.emplace(di,c,h,w,T,F,Y,ut)}emplace(c,h,w,T,F,Y,ut,di){const yi=6*c,kn=12*c,So=3*c;return this.int16[yi+0]=h,this.int16[yi+1]=w,this.uint8[kn+4]=T,this.uint8[kn+5]=F,this.uint8[kn+6]=Y,this.uint8[kn+7]=ut,this.float32[So+2]=di,c}}dd.prototype.bytesPerElement=12,vs(dd,"StructArrayLayout2i4ub1f12");class xd extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,h,w,T){const F=this.length;return this.resize(F+1),this.emplace(F,c,h,w,T)}emplace(c,h,w,T,F){const Y=4*c;return this.float32[Y+0]=h,this.float32[Y+1]=w,this.float32[Y+2]=T,this.float32[Y+3]=F,c}}xd.prototype.bytesPerElement=16,vs(xd,"StructArrayLayout4f16");class nd extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,h,w,T,F){const Y=this.length;return this.resize(Y+1),this.emplace(Y,c,h,w,T,F)}emplace(c,h,w,T,F,Y){const ut=6*c,di=3*c;return this.uint16[ut+0]=h,this.uint16[ut+1]=w,this.uint16[ut+2]=T,this.uint16[ut+3]=F,this.float32[di+2]=Y,c}}nd.prototype.bytesPerElement=12,vs(nd,"StructArrayLayout4ui1f12");class vd extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,h,w,T){const F=this.length;return this.resize(F+1),this.emplace(F,c,h,w,T)}emplace(c,h,w,T,F){const Y=4*c;return this.uint16[Y+0]=h,this.uint16[Y+1]=w,this.uint16[Y+2]=T,this.uint16[Y+3]=F,c}}vd.prototype.bytesPerElement=8,vs(vd,"StructArrayLayout4ui8");class Od extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h,w,T,F,Y){const ut=this.length;return this.resize(ut+1),this.emplace(ut,c,h,w,T,F,Y)}emplace(c,h,w,T,F,Y,ut){const di=6*c;return this.int16[di+0]=h,this.int16[di+1]=w,this.int16[di+2]=T,this.int16[di+3]=F,this.int16[di+4]=Y,this.int16[di+5]=ut,c}}Od.prototype.bytesPerElement=12,vs(Od,"StructArrayLayout6i12");class Id extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,h,w,T,F,Y,ut,di,yi,kn,So,sa){const al=this.length;return this.resize(al+1),this.emplace(al,c,h,w,T,F,Y,ut,di,yi,kn,So,sa)}emplace(c,h,w,T,F,Y,ut,di,yi,kn,So,sa,al){const cl=12*c;return this.int16[cl+0]=h,this.int16[cl+1]=w,this.int16[cl+2]=T,this.int16[cl+3]=F,this.uint16[cl+4]=Y,this.uint16[cl+5]=ut,this.uint16[cl+6]=di,this.uint16[cl+7]=yi,this.int16[cl+8]=kn,this.int16[cl+9]=So,this.int16[cl+10]=sa,this.int16[cl+11]=al,c}}Id.prototype.bytesPerElement=24,vs(Id,"StructArrayLayout4i4ui4i24");class $d extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,h,w,T,F,Y){const ut=this.length;return this.resize(ut+1),this.emplace(ut,c,h,w,T,F,Y)}emplace(c,h,w,T,F,Y,ut){const di=10*c,yi=5*c;return this.int16[di+0]=h,this.int16[di+1]=w,this.int16[di+2]=T,this.float32[yi+2]=F,this.float32[yi+3]=Y,this.float32[yi+4]=ut,c}}$d.prototype.bytesPerElement=20,vs($d,"StructArrayLayout3i3f20");class Gp extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(c){const h=this.length;return this.resize(h+1),this.emplace(h,c)}emplace(c,h){return this.uint32[1*c+0]=h,c}}Gp.prototype.bytesPerElement=4,vs(Gp,"StructArrayLayout1ul4");class Hf extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,h,w,T,F,Y,ut,di,yi,kn,So,sa,al){const cl=this.length;return this.resize(cl+1),this.emplace(cl,c,h,w,T,F,Y,ut,di,yi,kn,So,sa,al)}emplace(c,h,w,T,F,Y,ut,di,yi,kn,So,sa,al,cl){const eh=20*c,fh=10*c;return this.int16[eh+0]=h,this.int16[eh+1]=w,this.int16[eh+2]=T,this.int16[eh+3]=F,this.int16[eh+4]=Y,this.float32[fh+3]=ut,this.float32[fh+4]=di,this.float32[fh+5]=yi,this.float32[fh+6]=kn,this.int16[eh+14]=So,this.uint32[fh+8]=sa,this.uint16[eh+18]=al,this.uint16[eh+19]=cl,c}}Hf.prototype.bytesPerElement=40,vs(Hf,"StructArrayLayout5i4f1i1ul2ui40");class Mp extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h,w,T,F,Y,ut){const di=this.length;return this.resize(di+1),this.emplace(di,c,h,w,T,F,Y,ut)}emplace(c,h,w,T,F,Y,ut,di){const yi=8*c;return this.int16[yi+0]=h,this.int16[yi+1]=w,this.int16[yi+2]=T,this.int16[yi+4]=F,this.int16[yi+5]=Y,this.int16[yi+6]=ut,this.int16[yi+7]=di,c}}Mp.prototype.bytesPerElement=16,vs(Mp,"StructArrayLayout3i2i2i16");class Zp extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h,w,T,F){const Y=this.length;return this.resize(Y+1),this.emplace(Y,c,h,w,T,F)}emplace(c,h,w,T,F,Y){const ut=4*c,di=8*c;return this.float32[ut+0]=h,this.float32[ut+1]=w,this.float32[ut+2]=T,this.int16[di+6]=F,this.int16[di+7]=Y,c}}Zp.prototype.bytesPerElement=16,vs(Zp,"StructArrayLayout2f1f2i16");class rg extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,h,w,T){const F=this.length;return this.resize(F+1),this.emplace(F,c,h,w,T)}emplace(c,h,w,T,F){const Y=12*c,ut=3*c;return this.uint8[Y+0]=h,this.uint8[Y+1]=w,this.float32[ut+1]=T,this.float32[ut+2]=F,c}}rg.prototype.bytesPerElement=12,vs(rg,"StructArrayLayout2ub2f12");class Jf extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,h,w){const T=this.length;return this.resize(T+1),this.emplace(T,c,h,w)}emplace(c,h,w,T){const F=3*c;return this.float32[F+0]=h,this.float32[F+1]=w,this.float32[F+2]=T,c}}Jf.prototype.bytesPerElement=12,vs(Jf,"StructArrayLayout3f12");class Bp extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,h,w){const T=this.length;return this.resize(T+1),this.emplace(T,c,h,w)}emplace(c,h,w,T){const F=3*c;return this.uint16[F+0]=h,this.uint16[F+1]=w,this.uint16[F+2]=T,c}}Bp.prototype.bytesPerElement=6,vs(Bp,"StructArrayLayout3ui6");class fg extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(c,h,w,T,F,Y,ut,di,yi,kn,So,sa,al,cl,eh,fh,Ch,Gh,Eh,kh,jh){const Hh=this.length;return this.resize(Hh+1),this.emplace(Hh,c,h,w,T,F,Y,ut,di,yi,kn,So,sa,al,cl,eh,fh,Ch,Gh,Eh,kh,jh)}emplace(c,h,w,T,F,Y,ut,di,yi,kn,So,sa,al,cl,eh,fh,Ch,Gh,Eh,kh,jh,Hh){const ud=30*c,sd=15*c,Cd=60*c;return this.int16[ud+0]=h,this.int16[ud+1]=w,this.int16[ud+2]=T,this.float32[sd+2]=F,this.float32[sd+3]=Y,this.uint16[ud+8]=ut,this.uint16[ud+9]=di,this.uint32[sd+5]=yi,this.uint32[sd+6]=kn,this.uint32[sd+7]=So,this.uint16[ud+16]=sa,this.uint16[ud+17]=al,this.uint16[ud+18]=cl,this.float32[sd+10]=eh,this.float32[sd+11]=fh,this.uint8[Cd+48]=Ch,this.uint8[Cd+49]=Gh,this.uint8[Cd+50]=Eh,this.uint32[sd+13]=kh,this.int16[ud+28]=jh,this.uint8[Cd+58]=Hh,c}}fg.prototype.bytesPerElement=60,vs(fg,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Sg extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(c,h,w,T,F,Y,ut,di,yi,kn,So,sa,al,cl,eh,fh,Ch,Gh,Eh,kh,jh,Hh,ud,sd,Cd,jd,gd,Pd,Dd,Gd){const Zd=this.length;return this.resize(Zd+1),this.emplace(Zd,c,h,w,T,F,Y,ut,di,yi,kn,So,sa,al,cl,eh,fh,Ch,Gh,Eh,kh,jh,Hh,ud,sd,Cd,jd,gd,Pd,Dd,Gd)}emplace(c,h,w,T,F,Y,ut,di,yi,kn,So,sa,al,cl,eh,fh,Ch,Gh,Eh,kh,jh,Hh,ud,sd,Cd,jd,gd,Pd,Dd,Gd,Zd){const yd=38*c,dp=19*c;return this.int16[yd+0]=h,this.int16[yd+1]=w,this.int16[yd+2]=T,this.float32[dp+2]=F,this.float32[dp+3]=Y,this.int16[yd+8]=ut,this.int16[yd+9]=di,this.int16[yd+10]=yi,this.int16[yd+11]=kn,this.int16[yd+12]=So,this.int16[yd+13]=sa,this.uint16[yd+14]=al,this.uint16[yd+15]=cl,this.uint16[yd+16]=eh,this.uint16[yd+17]=fh,this.uint16[yd+18]=Ch,this.uint16[yd+19]=Gh,this.uint16[yd+20]=Eh,this.uint16[yd+21]=kh,this.uint16[yd+22]=jh,this.uint16[yd+23]=Hh,this.uint16[yd+24]=ud,this.uint16[yd+25]=sd,this.uint16[yd+26]=Cd,this.uint16[yd+27]=jd,this.uint16[yd+28]=gd,this.uint32[dp+15]=Pd,this.float32[dp+16]=Dd,this.float32[dp+17]=Gd,this.float32[dp+18]=Zd,c}}Sg.prototype.bytesPerElement=76,vs(Sg,"StructArrayLayout3i2f6i15ui1ul3f76");class Tg extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c){const h=this.length;return this.resize(h+1),this.emplace(h,c)}emplace(c,h){return this.float32[1*c+0]=h,c}}Tg.prototype.bytesPerElement=4,vs(Tg,"StructArrayLayout1f4");class gg extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,h,w,T,F){const Y=this.length;return this.resize(Y+1),this.emplace(Y,c,h,w,T,F)}emplace(c,h,w,T,F,Y){const ut=5*c;return this.float32[ut+0]=h,this.float32[ut+1]=w,this.float32[ut+2]=T,this.float32[ut+3]=F,this.float32[ut+4]=Y,c}}gg.prototype.bytesPerElement=20,vs(gg,"StructArrayLayout5f20");class Jm extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,h,w,T){const F=this.length;return this.resize(F+1),this.emplace(F,c,h,w,T)}emplace(c,h,w,T,F){const Y=6*c;return this.uint32[3*c+0]=h,this.uint16[Y+2]=w,this.uint16[Y+3]=T,this.uint16[Y+4]=F,c}}Jm.prototype.bytesPerElement=12,vs(Jm,"StructArrayLayout1ul3ui12");class om extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,h){const w=this.length;return this.resize(w+1),this.emplace(w,c,h)}emplace(c,h,w){const T=2*c;return this.uint16[T+0]=h,this.uint16[T+1]=w,c}}om.prototype.bytesPerElement=4,vs(om,"StructArrayLayout2ui4");class c_ extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c){const h=this.length;return this.resize(h+1),this.emplace(h,c)}emplace(c,h){return this.uint16[1*c+0]=h,c}}c_.prototype.bytesPerElement=2,vs(c_,"StructArrayLayout1ui2");class I_ extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,h){const w=this.length;return this.resize(w+1),this.emplace(w,c,h)}emplace(c,h,w){const T=2*c;return this.float32[T+0]=h,this.float32[T+1]=w,c}}I_.prototype.bytesPerElement=8,vs(I_,"StructArrayLayout2f8");class Ug extends Vh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ug.prototype.size=40;class Ag extends Hf{get(c){return new Ug(this,c)}}vs(Ag,"CollisionBoxArray");class mg extends Vh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(c){this._structArray.uint8[this._pos1+49]=c}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(c){this._structArray.uint8[this._pos1+50]=c}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(c){this._structArray.uint32[this._pos4+13]=c}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(c){this._structArray.uint8[this._pos1+58]=c}}mg.prototype.size=60;class pg extends fg{get(c){return new mg(this,c)}}vs(pg,"PlacedSymbolArray");class wm extends Vh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(c){this._structArray.uint32[this._pos4+15]=c}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}wm.prototype.size=76;class Pg extends Sg{get(c){return new wm(this,c)}}vs(Pg,"SymbolInstanceArray");class u_ extends Tg{getoffsetX(c){return this.float32[1*c+0]}}vs(u_,"GlyphOffsetArray");class Kv extends Bd{getx(c){return this.int16[2*c+0]}gety(c){return this.int16[2*c+1]}}vs(Kv,"SymbolLineVertexArray");class b0 extends Vh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}b0.prototype.size=12;class Zv extends Jm{get(c){return new b0(this,c)}}vs(Zv,"FeatureIndexArray");class Ey extends om{geta_centroid_pos0(c){return this.uint16[2*c+0]}geta_centroid_pos1(c){return this.uint16[2*c+1]}}vs(Ey,"FillExtrusionCentroidArray");const cv=Zh([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Xv=Zh([{name:"a_dash",components:4,type:"Uint16"}]);var $x={exports:{}},C0={exports:{}};C0.exports=function(u,c){var h,w,T,F,Y,ut,di,yi;for(w=u.length-(h=3&u.length),T=c,Y=3432918353,ut=461845907,yi=0;yi<w;)di=255&u.charCodeAt(yi)|(255&u.charCodeAt(++yi))<<8|(255&u.charCodeAt(++yi))<<16|(255&u.charCodeAt(++yi))<<24,++yi,T=27492+(65535&(F=5*(65535&(T=(T^=di=(65535&(di=(di=(65535&di)*Y+(((di>>>16)*Y&65535)<<16)&4294967295)<<15|di>>>17))*ut+(((di>>>16)*ut&65535)<<16)&4294967295)<<13|T>>>19))+((5*(T>>>16)&65535)<<16)&4294967295))+((58964+(F>>>16)&65535)<<16);switch(di=0,h){case 3:di^=(255&u.charCodeAt(yi+2))<<16;case 2:di^=(255&u.charCodeAt(yi+1))<<8;case 1:T^=di=(65535&(di=(di=(65535&(di^=255&u.charCodeAt(yi)))*Y+(((di>>>16)*Y&65535)<<16)&4294967295)<<15|di>>>17))*ut+(((di>>>16)*ut&65535)<<16)&4294967295}return T^=u.length,T=2246822507*(65535&(T^=T>>>16))+((2246822507*(T>>>16)&65535)<<16)&4294967295,T=3266489909*(65535&(T^=T>>>13))+((3266489909*(T>>>16)&65535)<<16)&4294967295,(T^=T>>>16)>>>0};var Hx=C0.exports,n1={exports:{}};n1.exports=function(u,c){for(var h,w=u.length,T=c^w,F=0;w>=4;)h=1540483477*(65535&(h=255&u.charCodeAt(F)|(255&u.charCodeAt(++F))<<8|(255&u.charCodeAt(++F))<<16|(255&u.charCodeAt(++F))<<24))+((1540483477*(h>>>16)&65535)<<16),T=1540483477*(65535&T)+((1540483477*(T>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),w-=4,++F;switch(w){case 3:T^=(255&u.charCodeAt(F+2))<<16;case 2:T^=(255&u.charCodeAt(F+1))<<8;case 1:T=1540483477*(65535&(T^=255&u.charCodeAt(F)))+((1540483477*(T>>>16)&65535)<<16)}return T=1540483477*(65535&(T^=T>>>13))+((1540483477*(T>>>16)&65535)<<16),(T^=T>>>15)>>>0};var jx=Hx,ry=n1.exports;$x.exports=jx,$x.exports.murmur3=jx,$x.exports.murmur2=ry;var o1=Wr($x.exports);class Ew{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(c,h,w,T){this.ids.push(Hb(c)),this.positions.push(h,w,T)}getPositions(c){const h=Hb(c);let w=0,T=this.ids.length-1;for(;w<T;){const Y=w+T>>1;this.ids[Y]>=h?T=Y:w=Y+1}const F=[];for(;this.ids[w]===h;)F.push({index:this.positions[3*w],start:this.positions[3*w+1],end:this.positions[3*w+2]}),w++;return F}static serialize(c,h){const w=new Float64Array(c.ids),T=new Uint32Array(c.positions);return W1(w,T,0,w.length-1),h&&h.push(w.buffer,T.buffer),{ids:w,positions:T}}static deserialize(c){const h=new Ew;return h.ids=c.ids,h.positions=c.positions,h.indexed=!0,h}}function Hb(u){const c=+u;return!isNaN(c)&&Number.MIN_SAFE_INTEGER<=c&&c<=Number.MAX_SAFE_INTEGER?c:o1(String(u))}function W1(u,c,h,w){for(;h<w;){const T=u[h+w>>1];let F=h-1,Y=w+1;for(;;){do F++;while(u[F]<T);do Y--;while(u[Y]>T);if(F>=Y)break;s1(u,F,Y),s1(c,3*F,3*Y),s1(c,3*F+1,3*Y+1),s1(c,3*F+2,3*Y+2)}Y-h<w-Y?(W1(u,c,h,Y),h=Y+1):(W1(u,c,Y+1,w),w=Y)}}function s1(u,c,h){const w=u[c];u[c]=u[h],u[h]=w}vs(Ew,"FeaturePositionMap");class uv{constructor(c){this.gl=c.gl,this.initialized=!1}fetchUniformLocation(c,h){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(c,h),this.initialized=!0),!!this.location}}class Rx extends uv{constructor(c){super(c),this.current=0}set(c,h,w){this.fetchUniformLocation(c,h)&&this.current!==w&&(this.current=w,this.gl.uniform1f(this.location,w))}}class q1 extends uv{constructor(c){super(c),this.current=[0,0,0,0]}set(c,h,w){this.fetchUniformLocation(c,h)&&(w[0]===this.current[0]&&w[1]===this.current[1]&&w[2]===this.current[2]&&w[3]===this.current[3]||(this.current=w,this.gl.uniform4f(this.location,w[0],w[1],w[2],w[3])))}}class ox extends uv{constructor(c){super(c),this.current=Gg.transparent}set(c,h,w){this.fetchUniformLocation(c,h)&&(w.r===this.current.r&&w.g===this.current.g&&w.b===this.current.b&&w.a===this.current.a||(this.current=w,this.gl.uniform4f(this.location,w.r,w.g,w.b,w.a)))}}const Sw=new Float32Array(16),XC=new Float32Array(9),YC=new Float32Array(4);function K1(u){return[Oh(255*u.r,255*u.g),Oh(255*u.b,255*u.a)]}class Tw{constructor(c,h,w){this.value=c,this.uniformNames=h.map(T=>`u_${T}`),this.type=w}setUniform(c,h,w,T,F){h.set(c,F,T.constantOr(this.value))}getBinding(c,h){return this.type==="color"?new ox(c):new Rx(c)}}class Wx{constructor(c,h){this.uniformNames=h.map(w=>`u_${w}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(c){this.pixelRatio=c.pixelRatio||1,this.pattern=c.tl.concat(c.br)}setUniform(c,h,w,T,F){const Y=F==="u_pattern"||F==="u_dash"?this.pattern:F==="u_pixel_ratio"?this.pixelRatio:null;Y&&h.set(c,F,Y)}getBinding(c,h){return h==="u_pattern"||h==="u_dash"?new q1(c):new Rx(c)}}class E0{constructor(c,h,w,T){this.expression=c,this.type=w,this.maxValue=0,this.paintVertexAttributes=h.map(F=>({name:`a_${F}`,type:"Float32",components:w==="color"?2:1,offset:0})),this.paintVertexArray=new T}populatePaintArray(c,h,w,T,F,Y){const ut=this.paintVertexArray.length,di=this.expression.evaluate(new Gn(0),h,{},F,T,Y);this.paintVertexArray.resize(c),this._setPaintValue(ut,c,di)}updatePaintArray(c,h,w,T,F){const Y=this.expression.evaluate({zoom:0},w,T,void 0,F);this._setPaintValue(c,h,Y)}_setPaintValue(c,h,w){if(this.type==="color"){const T=K1(w);for(let F=c;F<h;F++)this.paintVertexArray.emplace(F,T[0],T[1])}else{for(let T=c;T<h;T++)this.paintVertexArray.emplace(T,w);this.maxValue=Math.max(this.maxValue,Math.abs(w))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class hv{constructor(c,h,w,T,F,Y){this.expression=c,this.uniformNames=h.map(ut=>`u_${ut}_t`),this.type=w,this.useIntegerZoom=T,this.zoom=F,this.maxValue=0,this.paintVertexAttributes=h.map(ut=>({name:`a_${ut}`,type:"Float32",components:w==="color"?4:2,offset:0})),this.paintVertexArray=new Y}populatePaintArray(c,h,w,T,F,Y){const ut=this.expression.evaluate(new Gn(this.zoom),h,{},F,T,Y),di=this.expression.evaluate(new Gn(this.zoom+1),h,{},F,T,Y),yi=this.paintVertexArray.length;this.paintVertexArray.resize(c),this._setPaintValue(yi,c,ut,di)}updatePaintArray(c,h,w,T,F){const Y=this.expression.evaluate({zoom:this.zoom},w,T,void 0,F),ut=this.expression.evaluate({zoom:this.zoom+1},w,T,void 0,F);this._setPaintValue(c,h,Y,ut)}_setPaintValue(c,h,w,T){if(this.type==="color"){const F=K1(w),Y=K1(T);for(let ut=c;ut<h;ut++)this.paintVertexArray.emplace(ut,F[0],F[1],Y[0],Y[1])}else{for(let F=c;F<h;F++)this.paintVertexArray.emplace(F,w,T);this.maxValue=Math.max(this.maxValue,Math.abs(w),Math.abs(T))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(c,h,w,T,F){const Y=this.useIntegerZoom?Math.floor(w.zoom):w.zoom,ut=td(this.expression.interpolationFactor(Y,this.zoom,this.zoom+1),0,1);h.set(c,F,ut)}getBinding(c,h){return new Rx(c)}}class Yv{constructor(c,h,w,T,F){this.expression=c,this.layerId=F,this.paintVertexAttributes=(w==="array"?Xv:cv).members;for(let Y=0;Y<h.length;++Y);this.paintVertexArray=new T}populatePaintArray(c,h,w){const T=this.paintVertexArray.length;this.paintVertexArray.resize(c),this._setPaintValues(T,c,h.patterns&&h.patterns[this.layerId],w)}updatePaintArray(c,h,w,T,F,Y){this._setPaintValues(c,h,w.patterns&&w.patterns[this.layerId],Y)}_setPaintValues(c,h,w,T){if(!T||!w)return;const F=T[w];if(!F)return;const{tl:Y,br:ut,pixelRatio:di}=F;for(let yi=c;yi<h;yi++)this.paintVertexArray.emplace(yi,Y[0],Y[1],ut[0],ut[1],di)}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class sx{constructor(c,h,w=()=>!0){this.binders={},this._buffers=[];const T=[];for(const F in c.paint._values){if(!w(F))continue;const Y=c.paint.get(F);if(!(Y instanceof _h&&ey(Y.property.specification)))continue;const ut=gm(F,c.type),di=Y.value,yi=Y.property.specification.type,kn=!!Y.property.useIntegerZoom,So=F==="line-dasharray"||F.endsWith("pattern"),sa=F==="line-dasharray"&&c.layout.get("line-cap").value.kind!=="constant";if(di.kind!=="constant"||sa)if(di.kind==="source"||sa||So){const al=Aw(F,yi,"source");this.binders[F]=So?new Yv(di,ut,yi,al,c.id):new E0(di,ut,yi,al),T.push(`/a_${F}`)}else{const al=Aw(F,yi,"composite");this.binders[F]=new hv(di,ut,yi,kn,h,al),T.push(`/z_${F}`)}else this.binders[F]=So?new Wx(di.value,ut):new Tw(di.value,ut,yi),T.push(`/u_${F}`)}this.cacheKey=T.sort().join("")}getMaxValue(c){const h=this.binders[c];return h instanceof E0||h instanceof hv?h.maxValue:0}populatePaintArrays(c,h,w,T,F,Y){for(const ut in this.binders){const di=this.binders[ut];(di instanceof E0||di instanceof hv||di instanceof Yv)&&di.populatePaintArray(c,h,w,T,F,Y)}}setConstantPatternPositions(c){for(const h in this.binders){const w=this.binders[h];w instanceof Wx&&w.setConstantPatternPositions(c)}}updatePaintArrays(c,h,w,T,F,Y){let ut=!1;for(const di in c){const yi=h.getPositions(di);for(const kn of yi){const So=w.feature(kn.index);for(const sa in this.binders){const al=this.binders[sa];if((al instanceof E0||al instanceof hv||al instanceof Yv)&&al.expression.isStateDependent===!0){const cl=T.paint.get(sa);al.expression=cl.value,al.updatePaintArray(kn.start,kn.end,So,c[di],F,Y),ut=!0}}}}return ut}defines(){const c=[];for(const h in this.binders){const w=this.binders[h];(w instanceof Tw||w instanceof Wx)&&c.push(...w.uniformNames.map(T=>`#define HAS_UNIFORM_${T}`))}return c}getBinderAttributes(){const c=[];for(const h in this.binders){const w=this.binders[h];if(w instanceof E0||w instanceof hv||w instanceof Yv)for(let T=0;T<w.paintVertexAttributes.length;T++)c.push(w.paintVertexAttributes[T].name)}return c}getBinderUniforms(){const c=[];for(const h in this.binders){const w=this.binders[h];if(w instanceof Tw||w instanceof Wx||w instanceof hv)for(const T of w.uniformNames)c.push(T)}return c}getPaintVertexBuffers(){return this._buffers}getUniforms(c){const h=[];for(const w in this.binders){const T=this.binders[w];if(T instanceof Tw||T instanceof Wx||T instanceof hv)for(const F of T.uniformNames)h.push({name:F,property:w,binding:T.getBinding(c,F)})}return h}setUniforms(c,h,w,T,F){for(const{name:Y,property:ut,binding:di}of w)this.binders[ut].setUniform(c,di,F,T.get(ut),Y)}updatePaintBuffers(){this._buffers=[];for(const c in this.binders){const h=this.binders[c];(h instanceof E0||h instanceof hv||h instanceof Yv)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}}upload(c){for(const h in this.binders){const w=this.binders[h];(w instanceof E0||w instanceof hv||w instanceof Yv)&&w.upload(c)}this.updatePaintBuffers()}destroy(){for(const c in this.binders){const h=this.binders[c];(h instanceof E0||h instanceof hv||h instanceof Yv)&&h.destroy()}}}class Sy{constructor(c,h,w=()=>!0){this.programConfigurations={};for(const T of c)this.programConfigurations[T.id]=new sx(T,h,w);this.needsUpload=!1,this._featureMap=new Ew,this._bufferOffset=0}populatePaintArrays(c,h,w,T,F,Y,ut){for(const di in this.programConfigurations)this.programConfigurations[di].populatePaintArrays(c,h,T,F,Y,ut);h.id!==void 0&&this._featureMap.add(h.id,w,this._bufferOffset,c),this._bufferOffset=c,this.needsUpload=!0}updatePaintArrays(c,h,w,T,F){for(const Y of w)this.needsUpload=this.programConfigurations[Y.id].updatePaintArrays(c,this._featureMap,h,Y,T,F)||this.needsUpload}get(c){return this.programConfigurations[c]}upload(c){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(c);this.needsUpload=!1}}destroy(){for(const c in this.programConfigurations)this.programConfigurations[c].destroy()}}const JC={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function gm(u,c){return JC[u]||[u.replace(`${c}-`,"").replace(/-/g,"_")]}const a1={"line-pattern":{source:nd,composite:nd},"fill-pattern":{source:nd,composite:nd},"fill-extrusion-pattern":{source:nd,composite:nd},"line-dasharray":{source:vd,composite:vd}},jb={color:{source:I_,composite:xd},number:{source:Tg,composite:I_}};function Aw(u,c,h){const w=a1[u];return w&&w[h]||jb[c][h]}vs(Tw,"ConstantBinder"),vs(Wx,"PatternConstantBinder"),vs(E0,"SourceExpressionBinder"),vs(Yv,"PatternCompositeBinder"),vs(hv,"CompositeExpressionBinder"),vs(sx,"ProgramConfiguration",{omit:["_buffers"]}),vs(Sy,"ProgramConfigurationSet");const Rw="-transition";class M_ extends f_{constructor(c,h){if(super(),this.id=c.id,this.type=c.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,c.type!=="custom"&&(this.metadata=c.metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,c.type!=="background"&&c.type!=="sky"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter),h.layout&&(this._unevaluatedLayout=new yh(h.layout)),h.paint)){this._transitionablePaint=new pl(h.paint);for(const w in c.paint)this.setPaintProperty(w,c.paint[w],{validate:!1});for(const w in c.layout)this.setLayoutProperty(w,c.layout[w],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xh(h.paint)}}getLayoutProperty(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)}setLayoutProperty(c,h,w={}){h!=null&&this._validate(g,`layers.${this.id}.layout.${c}`,c,h,w)||(c!=="visibility"?this._unevaluatedLayout.setValue(c,h):this.visibility=h)}getPaintProperty(c){return zp(c,Rw)?this._transitionablePaint.getTransition(c.slice(0,-11)):this._transitionablePaint.getValue(c)}setPaintProperty(c,h,w={}){if(h!=null&&this._validate(Ve,`layers.${this.id}.paint.${c}`,c,h,w))return!1;if(zp(c,Rw))return this._transitionablePaint.setTransition(c.slice(0,-11),h||void 0),!1;{const T=this._transitionablePaint._values[c],F=T.value.isDataDriven(),Y=T.value;this._transitionablePaint.setValue(c,h),this._handleSpecialPaintPropertyUpdate(c);const ut=this._transitionablePaint._values[c].value,di=ut.isDataDriven(),yi=zp(c,"pattern")||c==="line-dasharray";return di||F||yi||this._handleOverridablePaintPropertyUpdate(c,Y,ut)}}_handleSpecialPaintPropertyUpdate(c){}getProgramIds(){return null}getProgramConfiguration(c){return null}_handleOverridablePaintPropertyUpdate(c,h,w){return!1}isHidden(c){return!!(this.minzoom&&c<this.minzoom)||!!(this.maxzoom&&c>=this.maxzoom)||this.visibility==="none"}updateTransitions(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(c,h){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,h)}serialize(){const c={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(c.layout=c.layout||{},c.layout.visibility=this.visibility),Ap(c,(h,w)=>!(h===void 0||w==="layout"&&!Object.keys(h).length||w==="paint"&&!Object.keys(h).length))}_validate(c,h,w,T,F={}){return(!F||F.validate!==!1)&&_e(this,c.call(w0,{key:h,layerType:this.type,objectKey:w,value:T,styleSpec:hd,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const c in this.paint._values){const h=this.paint.get(c);if(h instanceof _h&&ey(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Hv(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Wb=Zh([{name:"a_pos",components:2,type:"Int16"}],4),qb=Zh([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Kg{constructor(c=[]){this.segments=c}prepareSegment(c,h,w,T){let F=this.segments[this.segments.length-1];return c>Kg.MAX_VERTEX_ARRAY_LENGTH&&Ad(`Max vertices per segment is ${Kg.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${c}`),(!F||F.vertexLength+c>Kg.MAX_VERTEX_ARRAY_LENGTH||F.sortKey!==T)&&(F={vertexOffset:h.length,primitiveOffset:w.length,vertexLength:0,primitiveLength:0},T!==void 0&&(F.sortKey=T),this.segments.push(F)),F}get(){return this.segments}destroy(){for(const c of this.segments)for(const h in c.vaos)c.vaos[h].destroy()}static simpleSegment(c,h,w,T){return new Kg([{vertexOffset:c,primitiveOffset:h,vertexLength:w,primitiveLength:T,vaos:{},sortKey:0}])}}Kg.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,vs(Kg,"SegmentVector");var jp=8192;class Jv{constructor(c,h){c&&(h?this.setSouthWest(c).setNorthEast(h):c.length===4?this.setSouthWest([c[0],c[1]]).setNorthEast([c[2],c[3]]):this.setSouthWest(c[0]).setNorthEast(c[1]))}setNorthEast(c){return this._ne=c instanceof Rg?new Rg(c.lng,c.lat):Rg.convert(c),this}setSouthWest(c){return this._sw=c instanceof Rg?new Rg(c.lng,c.lat):Rg.convert(c),this}extend(c){const h=this._sw,w=this._ne;let T,F;if(c instanceof Rg)T=c,F=c;else{if(!(c instanceof Jv))return Array.isArray(c)?c.length===4||c.every(Array.isArray)?this.extend(Jv.convert(c)):this.extend(Rg.convert(c)):typeof c=="object"&&c!==null&&c.hasOwnProperty("lat")&&(c.hasOwnProperty("lon")||c.hasOwnProperty("lng"))?this.extend(Rg.convert(c)):this;if(T=c._sw,F=c._ne,!T||!F)return this}return h||w?(h.lng=Math.min(T.lng,h.lng),h.lat=Math.min(T.lat,h.lat),w.lng=Math.max(F.lng,w.lng),w.lat=Math.max(F.lat,w.lat)):(this._sw=new Rg(T.lng,T.lat),this._ne=new Rg(F.lng,F.lat)),this}getCenter(){return new Rg((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Rg(this.getWest(),this.getNorth())}getSouthEast(){return new Rg(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(c){const{lng:h,lat:w}=Rg.convert(c);let T=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(T=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=w&&w<=this._ne.lat&&T}static convert(c){return!c||c instanceof Jv?c:new Jv(c)}}var Iw=1e-6,z_=typeof Float32Array<"u"?Float32Array:Array;function Z1(){var u=new z_(9);return z_!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u}function qx(u,c,h){var w=c[0],T=c[1],F=c[2],Y=c[3],ut=c[4],di=c[5],yi=c[6],kn=c[7],So=c[8],sa=h[0],al=h[1],cl=h[2],eh=h[3],fh=h[4],Ch=h[5],Gh=h[6],Eh=h[7],kh=h[8];return u[0]=sa*w+al*Y+cl*yi,u[1]=sa*T+al*ut+cl*kn,u[2]=sa*F+al*di+cl*So,u[3]=eh*w+fh*Y+Ch*yi,u[4]=eh*T+fh*ut+Ch*kn,u[5]=eh*F+fh*di+Ch*So,u[6]=Gh*w+Eh*Y+kh*yi,u[7]=Gh*T+Eh*ut+kh*kn,u[8]=Gh*F+Eh*di+kh*So,u}function dv(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function Mw(u,c){var h=c[0],w=c[1],T=c[2],F=c[3],Y=c[4],ut=c[5],di=c[6],yi=c[7],kn=c[8],So=c[9],sa=c[10],al=c[11],cl=c[12],eh=c[13],fh=c[14],Ch=c[15],Gh=h*ut-w*Y,Eh=h*di-T*Y,kh=h*yi-F*Y,jh=w*di-T*ut,Hh=w*yi-F*ut,ud=T*yi-F*di,sd=kn*eh-So*cl,Cd=kn*fh-sa*cl,jd=kn*Ch-al*cl,gd=So*fh-sa*eh,Pd=So*Ch-al*eh,Dd=sa*Ch-al*fh,Gd=Gh*Dd-Eh*Pd+kh*gd+jh*jd-Hh*Cd+ud*sd;return Gd?(u[0]=(ut*Dd-di*Pd+yi*gd)*(Gd=1/Gd),u[1]=(T*Pd-w*Dd-F*gd)*Gd,u[2]=(eh*ud-fh*Hh+Ch*jh)*Gd,u[3]=(sa*Hh-So*ud-al*jh)*Gd,u[4]=(di*jd-Y*Dd-yi*Cd)*Gd,u[5]=(h*Dd-T*jd+F*Cd)*Gd,u[6]=(fh*kh-cl*ud-Ch*Eh)*Gd,u[7]=(kn*ud-sa*kh+al*Eh)*Gd,u[8]=(Y*Pd-ut*jd+yi*sd)*Gd,u[9]=(w*jd-h*Pd-F*sd)*Gd,u[10]=(cl*Hh-eh*kh+Ch*Gh)*Gd,u[11]=(So*kh-kn*Hh-al*Gh)*Gd,u[12]=(ut*Cd-Y*gd-di*sd)*Gd,u[13]=(h*gd-w*Cd+T*sd)*Gd,u[14]=(eh*Eh-cl*jh-fh*Gh)*Gd,u[15]=(kn*jh-So*Eh+sa*Gh)*Gd,u):null}function Ix(u,c,h){var w=c[0],T=c[1],F=c[2],Y=c[3],ut=c[4],di=c[5],yi=c[6],kn=c[7],So=c[8],sa=c[9],al=c[10],cl=c[11],eh=c[12],fh=c[13],Ch=c[14],Gh=c[15],Eh=h[0],kh=h[1],jh=h[2],Hh=h[3];return u[0]=Eh*w+kh*ut+jh*So+Hh*eh,u[1]=Eh*T+kh*di+jh*sa+Hh*fh,u[2]=Eh*F+kh*yi+jh*al+Hh*Ch,u[3]=Eh*Y+kh*kn+jh*cl+Hh*Gh,u[4]=(Eh=h[4])*w+(kh=h[5])*ut+(jh=h[6])*So+(Hh=h[7])*eh,u[5]=Eh*T+kh*di+jh*sa+Hh*fh,u[6]=Eh*F+kh*yi+jh*al+Hh*Ch,u[7]=Eh*Y+kh*kn+jh*cl+Hh*Gh,u[8]=(Eh=h[8])*w+(kh=h[9])*ut+(jh=h[10])*So+(Hh=h[11])*eh,u[9]=Eh*T+kh*di+jh*sa+Hh*fh,u[10]=Eh*F+kh*yi+jh*al+Hh*Ch,u[11]=Eh*Y+kh*kn+jh*cl+Hh*Gh,u[12]=(Eh=h[12])*w+(kh=h[13])*ut+(jh=h[14])*So+(Hh=h[15])*eh,u[13]=Eh*T+kh*di+jh*sa+Hh*fh,u[14]=Eh*F+kh*yi+jh*al+Hh*Ch,u[15]=Eh*Y+kh*kn+jh*cl+Hh*Gh,u}function Mx(u,c,h){var w,T,F,Y,ut,di,yi,kn,So,sa,al,cl,eh=h[0],fh=h[1],Ch=h[2];return c===u?(u[12]=c[0]*eh+c[4]*fh+c[8]*Ch+c[12],u[13]=c[1]*eh+c[5]*fh+c[9]*Ch+c[13],u[14]=c[2]*eh+c[6]*fh+c[10]*Ch+c[14],u[15]=c[3]*eh+c[7]*fh+c[11]*Ch+c[15]):(T=c[1],F=c[2],Y=c[3],ut=c[4],di=c[5],yi=c[6],kn=c[7],So=c[8],sa=c[9],al=c[10],cl=c[11],u[0]=w=c[0],u[1]=T,u[2]=F,u[3]=Y,u[4]=ut,u[5]=di,u[6]=yi,u[7]=kn,u[8]=So,u[9]=sa,u[10]=al,u[11]=cl,u[12]=w*eh+ut*fh+So*Ch+c[12],u[13]=T*eh+di*fh+sa*Ch+c[13],u[14]=F*eh+yi*fh+al*Ch+c[14],u[15]=Y*eh+kn*fh+cl*Ch+c[15]),u}function S0(u,c,h){var w=h[0],T=h[1],F=h[2];return u[0]=c[0]*w,u[1]=c[1]*w,u[2]=c[2]*w,u[3]=c[3]*w,u[4]=c[4]*T,u[5]=c[5]*T,u[6]=c[6]*T,u[7]=c[7]*T,u[8]=c[8]*F,u[9]=c[9]*F,u[10]=c[10]*F,u[11]=c[11]*F,u[12]=c[12],u[13]=c[13],u[14]=c[14],u[15]=c[15],u}function Pw(u,c,h){var w=Math.sin(h),T=Math.cos(h),F=c[4],Y=c[5],ut=c[6],di=c[7],yi=c[8],kn=c[9],So=c[10],sa=c[11];return c!==u&&(u[0]=c[0],u[1]=c[1],u[2]=c[2],u[3]=c[3],u[12]=c[12],u[13]=c[13],u[14]=c[14],u[15]=c[15]),u[4]=F*T+yi*w,u[5]=Y*T+kn*w,u[6]=ut*T+So*w,u[7]=di*T+sa*w,u[8]=yi*T-F*w,u[9]=kn*T-Y*w,u[10]=So*T-ut*w,u[11]=sa*T-di*w,u}function Dw(u,c,h){var w=Math.sin(h),T=Math.cos(h),F=c[0],Y=c[1],ut=c[2],di=c[3],yi=c[8],kn=c[9],So=c[10],sa=c[11];return c!==u&&(u[4]=c[4],u[5]=c[5],u[6]=c[6],u[7]=c[7],u[12]=c[12],u[13]=c[13],u[14]=c[14],u[15]=c[15]),u[0]=F*T-yi*w,u[1]=Y*T-kn*w,u[2]=ut*T-So*w,u[3]=di*T-sa*w,u[8]=F*w+yi*T,u[9]=Y*w+kn*T,u[10]=ut*w+So*T,u[11]=di*w+sa*T,u}function X1(u,c){return u[0]=c[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=c[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=c[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function Kb(u,c,h){var w,T,F,Y=h[0],ut=h[1],di=h[2],yi=Math.hypot(Y,ut,di);return yi<Iw?null:(Y*=yi=1/yi,ut*=yi,di*=yi,w=Math.sin(c),T=Math.cos(c),u[0]=Y*Y*(F=1-T)+T,u[1]=ut*Y*F+di*w,u[2]=di*Y*F-ut*w,u[3]=0,u[4]=Y*ut*F-di*w,u[5]=ut*ut*F+T,u[6]=di*ut*F+Y*w,u[7]=0,u[8]=Y*di*F+ut*w,u[9]=ut*di*F-Y*w,u[10]=di*di*F+T,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u)}Math.hypot||(Math.hypot=function(){for(var u=0,c=arguments.length;c--;)u+=arguments[c]*arguments[c];return Math.sqrt(u)});var QC=Ix;function Y1(){var u=new z_(3);return z_!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u}function Zb(u){var c=new z_(3);return c[0]=u[0],c[1]=u[1],c[2]=u[2],c}function Ty(u){return Math.hypot(u[0],u[1],u[2])}function Kx(u,c,h){var w=new z_(3);return w[0]=u,w[1]=c,w[2]=h,w}function Qv(u,c,h){return u[0]=c[0]+h[0],u[1]=c[1]+h[1],u[2]=c[2]+h[2],u}function ax(u,c,h){return u[0]=c[0]-h[0],u[1]=c[1]-h[1],u[2]=c[2]-h[2],u}function Xb(u,c,h){return u[0]=c[0]*h[0],u[1]=c[1]*h[1],u[2]=c[2]*h[2],u}function Lw(u,c,h){return u[0]=Math.min(c[0],h[0]),u[1]=Math.min(c[1],h[1]),u[2]=Math.min(c[2],h[2]),u}function Ow(u,c,h){return u[0]=Math.max(c[0],h[0]),u[1]=Math.max(c[1],h[1]),u[2]=Math.max(c[2],h[2]),u}function V_(u,c,h){return u[0]=c[0]*h,u[1]=c[1]*h,u[2]=c[2]*h,u}function Zx(u,c,h,w){return u[0]=c[0]+h[0]*w,u[1]=c[1]+h[1]*w,u[2]=c[2]+h[2]*w,u}function w_(u,c){var h=c[0],w=c[1],T=c[2],F=h*h+w*w+T*T;return F>0&&(F=1/Math.sqrt(F)),u[0]=c[0]*F,u[1]=c[1]*F,u[2]=c[2]*F,u}function Ay(u,c){return u[0]*c[0]+u[1]*c[1]+u[2]*c[2]}function J1(u,c,h){var w=c[0],T=c[1],F=c[2],Y=h[0],ut=h[1],di=h[2];return u[0]=T*di-F*ut,u[1]=F*Y-w*di,u[2]=w*ut-T*Y,u}function sm(u,c,h){var w=c[0],T=c[1],F=c[2],Y=h[3]*w+h[7]*T+h[11]*F+h[15];return u[0]=(h[0]*w+h[4]*T+h[8]*F+h[12])/(Y=Y||1),u[1]=(h[1]*w+h[5]*T+h[9]*F+h[13])/Y,u[2]=(h[2]*w+h[6]*T+h[10]*F+h[14])/Y,u}function l1(u,c,h){var w=h[0],T=h[1],F=h[2],Y=c[0],ut=c[1],di=c[2],yi=T*di-F*ut,kn=F*Y-w*di,So=w*ut-T*Y,sa=T*So-F*kn,al=F*yi-w*So,cl=w*kn-T*yi,eh=2*h[3];return kn*=eh,So*=eh,al*=2,cl*=2,u[0]=Y+(yi*=eh)+(sa*=2),u[1]=ut+kn+al,u[2]=di+So+cl,u}var T0,ny=ax,eE=Xb,tE=Ty;function Q1(u,c,h){return u[0]=c[0]*h,u[1]=c[1]*h,u[2]=c[2]*h,u[3]=c[3]*h,u}function Yb(u,c){var h=c[0],w=c[1],T=c[2],F=c[3],Y=h*h+w*w+T*T+F*F;return Y>0&&(Y=1/Math.sqrt(Y)),u[0]=h*Y,u[1]=w*Y,u[2]=T*Y,u[3]=F*Y,u}function pv(u,c,h){var w=c[0],T=c[1],F=c[2],Y=c[3];return u[0]=h[0]*w+h[4]*T+h[8]*F+h[12]*Y,u[1]=h[1]*w+h[5]*T+h[9]*F+h[13]*Y,u[2]=h[2]*w+h[6]*T+h[10]*F+h[14]*Y,u[3]=h[3]*w+h[7]*T+h[11]*F+h[15]*Y,u}function eb(){var u=new z_(4);return z_!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u[3]=1,u}function Jb(u){return u[0]=0,u[1]=0,u[2]=0,u[3]=1,u}function Qb(u,c,h){h*=.5;var w=c[0],T=c[1],F=c[2],Y=c[3],ut=Math.sin(h),di=Math.cos(h);return u[0]=w*di+Y*ut,u[1]=T*di+F*ut,u[2]=F*di-T*ut,u[3]=Y*di-w*ut,u}function eC(u,c,h){h*=.5;var w=c[0],T=c[1],F=c[2],Y=c[3],ut=Math.sin(h),di=Math.cos(h);return u[0]=w*di-F*ut,u[1]=T*di+Y*ut,u[2]=F*di+w*ut,u[3]=Y*di-T*ut,u}Y1(),T0=new z_(4),z_!=Float32Array&&(T0[0]=0,T0[1]=0,T0[2]=0,T0[3]=0);var iE=Yb;Y1(),Kx(1,0,0),Kx(0,1,0),eb(),eb(),Z1();const rE=Zh([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:tC}=rE,tb=Zh([{name:"a_pos_3",components:3,type:"Int16"}]);var Px=Zh([{name:"a_pos",type:"Int16",components:2}]);class c1{constructor(c,h){this.pos=c,this.dir=h}intersectsPlane(c,h,w){const T=Ay(h,this.dir);if(Math.abs(T)<1e-6)return!1;const F=((c[0]-this.pos[0])*h[0]+(c[1]-this.pos[1])*h[1]+(c[2]-this.pos[2])*h[2])/T;return w[0]=this.pos[0]+this.dir[0]*F,w[1]=this.pos[1]+this.dir[1]*F,w[2]=this.pos[2]+this.dir[2]*F,!0}closestPointOnSphere(c,h,w){if(function(al,cl){var eh=al[0],fh=al[1],Ch=al[2],Gh=cl[0],Eh=cl[1],kh=cl[2];return Math.abs(eh-Gh)<=Iw*Math.max(1,Math.abs(eh),Math.abs(Gh))&&Math.abs(fh-Eh)<=Iw*Math.max(1,Math.abs(fh),Math.abs(Eh))&&Math.abs(Ch-kh)<=Iw*Math.max(1,Math.abs(Ch),Math.abs(kh))}(this.pos,c)||h===0)return w[0]=w[1]=w[2]=0,!1;const[T,F,Y]=this.dir,ut=this.pos[0]-c[0],di=this.pos[1]-c[1],yi=this.pos[2]-c[2],kn=T*T+F*F+Y*Y,So=2*(ut*T+di*F+yi*Y),sa=So*So-4*kn*(ut*ut+di*di+yi*yi-h*h);if(sa<0){const al=Math.max(-So/2,0),cl=ut+T*al,eh=di+F*al,fh=yi+Y*al,Ch=Math.hypot(cl,eh,fh);return w[0]=cl*h/Ch,w[1]=eh*h/Ch,w[2]=fh*h/Ch,!1}{const al=(-So-Math.sqrt(sa))/(2*kn);if(al<0){const cl=Math.hypot(ut,di,yi);return w[0]=ut*h/cl,w[1]=di*h/cl,w[2]=yi*h/cl,!1}return w[0]=ut+T*al,w[1]=di+F*al,w[2]=yi+Y*al,!0}}}class u1{constructor(c,h,w,T,F){this.TL=c,this.TR=h,this.BR=w,this.BL=T,this.horizon=F}static fromInvProjectionMatrix(c,h,w){const T=[-1,1,1],F=[1,1,1],Y=[1,-1,1],ut=[-1,-1,1],di=sm(T,T,c),yi=sm(F,F,c),kn=sm(Y,Y,c),So=sm(ut,ut,c);return new u1(di,yi,kn,So,h/w)}}class h1{constructor(c,h){this.points=c,this.planes=h}static fromInvProjectionMatrix(c,h,w,T){const F=Math.pow(2,w),Y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(di=>{const yi=pv([],di,c),kn=1/yi[3]/h*F;return function(So,sa,al){return So[0]=sa[0]*al[0],So[1]=sa[1]*al[1],So[2]=sa[2]*al[2],So[3]=sa[3]*al[3],So}(yi,yi,[kn,kn,T?1/yi[3]:kn,kn])}),ut=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(di=>{const yi=w_([],J1([],ny([],Y[di[0]],Y[di[1]]),ny([],Y[di[2]],Y[di[1]]))),kn=-Ay(yi,Y[di[1]]);return yi.concat(kn)});return new h1(Y,ut)}}class b_{static fromPoints(c){const h=[1/0,1/0,1/0],w=[-1/0,-1/0,-1/0];for(const T of c)Lw(h,h,T),Ow(w,w,T);return new b_(h,w)}static applyTransform(c,h){const w=c.getCorners();for(let T=0;T<w.length;++T)sm(w[T],w[T],h);return b_.fromPoints(w)}constructor(c,h){this.min=c,this.max=h,this.center=V_([],Qv([],this.min,this.max),.5)}quadrant(c){const h=[c%2==0,c<2],w=Zb(this.min),T=Zb(this.max);for(let F=0;F<h.length;F++)w[F]=h[F]?this.min[F]:this.center[F],T[F]=h[F]?this.center[F]:this.max[F];return T[2]=this.max[2],new b_(w,T)}distanceX(c){return Math.max(Math.min(this.max[0],c[0]),this.min[0])-c[0]}distanceY(c){return Math.max(Math.min(this.max[1],c[1]),this.min[1])-c[1]}distanceZ(c){return Math.max(Math.min(this.max[2],c[2]),this.min[2])-c[2]}getCorners(){const c=this.min,h=this.max;return[[c[0],c[1],c[2]],[h[0],c[1],c[2]],[h[0],h[1],c[2]],[c[0],h[1],c[2]],[c[0],c[1],h[2]],[h[0],c[1],h[2]],[h[0],h[1],h[2]],[c[0],h[1],h[2]]]}intersects(c){const h=this.getCorners();let w=!0;for(let T=0;T<c.planes.length;T++){const F=c.planes[T];let Y=0;for(let ut=0;ut<h.length;ut++)Y+=Ay(F,h[ut])+F[3]>=0;if(Y===0)return 0;Y!==h.length&&(w=!1)}if(w)return 2;for(let T=0;T<3;T++){let F=Number.MAX_VALUE,Y=-Number.MAX_VALUE;for(let ut=0;ut<c.points.length;ut++){const di=c.points[ut][T]-this.min[T];F=Math.min(F,di),Y=Math.max(Y,di)}if(Y<0||F>this.max[T]-this.min[T])return 0}return 1}}const Xx=5,ib=6,e0=jp/Math.PI/2,nE=16383,Dx=64,Yx=[Dx,32,16],Ry=-e0,Iy=e0,Fw=[new b_([Ry,Ry,Ry],[Iy,Iy,Iy]),new b_([Ry,Ry,Ry],[0,0,Iy]),new b_([0,Ry,Ry],[Iy,0,Iy]),new b_([Ry,0,Ry],[0,Iy,Iy]),new b_([0,0,Ry],[Iy,Iy,Iy])];function mm(u){return u*e0/Gw}function rb(u,c,h,w=!0){const T=V_([],u._camera.position,u.worldSize),F=[c,h,1,1];pv(F,F,u.pixelMatrixInverse),Q1(F,F,1/F[3]);const Y=w_([],ny([],F,T)),ut=u.globeMatrix,di=[ut[12],ut[13],ut[14]],yi=ny([],di,T),kn=Ty(yi),So=w_([],yi),sa=u.worldSize/(2*Math.PI),al=Ay(So,Y),cl=Math.asin(sa/kn);if(cl<Math.acos(al)){if(!w)return null;const jd=[],gd=[];V_(jd,Y,kn/al),w_(gd,ny(gd,jd,yi)),w_(Y,Qv(Y,yi,V_(Y,gd,Math.tan(cl)*kn)))}const eh=[];new c1(T,Y).closestPointOnSphere(di,sa,eh);const fh=w_([],kd(ut,0)),Ch=w_([],kd(ut,1)),Gh=w_([],kd(ut,2)),Eh=Ay(fh,eh),kh=Ay(Ch,eh),jh=Ay(Gh,eh),Hh=bh(Math.asin(-kh/sa));let ud=bh(Math.atan2(Eh,jh));ud=u.center.lng+function(jd,gd){const Pd=(gd-jd+180)%360-180;return Pd<-180?Pd+360:Pd}(u.center.lng,ud);const sd=am(ud),Cd=td(My(Hh),0,1);return new M0(sd,Cd)}class iC{constructor(c,h,w){this.a=ny([],c,w),this.b=ny([],h,w),this.center=w;const T=w_([],this.a),F=w_([],this.b);this.angle=Math.acos(Ay(T,F))}}function d1(u,c){if(u.angle===0)return null;let h;return h=u.a[c]===0?1/u.angle*.5*Math.PI:1/u.angle*Math.atan(u.b[c]/u.a[c]/Math.sin(u.angle)-1/Math.tan(u.angle)),h<0||h>1?null:function(w,T,F,Y){const ut=Math.sin(F);return w*(Math.sin((1-Y)*F)/ut)+T*(Math.sin(Y*F)/ut)}(u.a[c],u.b[c],u.angle,td(h,0,1))+u.center[c]}function ug(u){if(u.z<=1)return Fw[u.z+2*u.y+u.x];const c=p1(I0(u));return b_.fromPoints(c)}function A0(u,c,h){return V_(u,u,1-h),Zx(u,u,c,h)}function nb(u,c){const h=ew(c.zoom);if(h===0)return ug(u);const w=I0(u),T=p1(w),F=am(w.getWest())*c.worldSize,Y=am(w.getEast())*c.worldSize,ut=My(w.getNorth())*c.worldSize,di=My(w.getSouth())*c.worldSize,yi=[F,ut,0],kn=[Y,ut,0],So=[F,di,0],sa=[Y,di,0],al=Mw([],c.globeMatrix);return sm(yi,yi,al),sm(kn,kn,al),sm(So,So,al),sm(sa,sa,al),T[0]=A0(T[0],So,h),T[1]=A0(T[1],sa,h),T[2]=A0(T[2],kn,h),T[3]=A0(T[3],yi,h),b_.fromPoints(T)}function ob(u,c,h){for(const w of u)sm(w,w,c),V_(w,w,h)}function R0(u,c,h){const w=c/u.worldSize,T=u.globeMatrix;if(h.z<=1){const sd=ug(h).getCorners();return ob(sd,T,w),b_.fromPoints(sd)}const F=I0(h),Y=p1(F);ob(Y,T,w);const ut=Number.MAX_VALUE,di=[-ut,-ut,-ut],yi=[ut,ut,ut];if(F.contains(u.center)){for(const jd of Y)Lw(yi,yi,jd),Ow(di,di,jd);di[2]=0;const sd=u.point,Cd=[sd.x*w,sd.y*w,0];return Lw(yi,yi,Cd),Ow(di,di,Cd),new b_(yi,di)}const kn=[T[12]*w,T[13]*w,T[14]*w],So=F.getCenter(),sa=td(u.center.lat,-_m,_m),al=td(So.lat,-_m,_m),cl=am(u.center.lng),eh=My(sa);let fh=cl-am(So.lng);const Ch=eh-My(al);fh>.5?fh-=1:fh<-.5&&(fh+=1);let Gh=0;Math.abs(fh)>Math.abs(Ch)?Gh=fh>=0?1:3:(Gh=Ch>=0?0:2,Zx(kn,kn,[T[4]*w,T[5]*w,T[6]*w],-Math.sin(nh(Ch>=0?F.getSouth():F.getNorth()))*e0));const Eh=Y[Gh],kh=Y[(Gh+1)%4],jh=new iC(Eh,kh,kn),Hh=[d1(jh,0)||Eh[0],d1(jh,1)||Eh[1],d1(jh,2)||Eh[2]],ud=ew(u.zoom);if(ud>0){const sd=function({x:jd,y:gd,z:Pd},Dd,Gd,Zd,yd){const dp=1/(1<<Pd);let Lp=jd*dp,mp=Lp+dp,Zf=gd*dp,Qd=Zf+dp,qp=0;const Xf=(Lp+mp)/2-Zd;return Xf>.5?qp=-1:Xf<-.5&&(qp=1),Lp=((Lp+qp)*Dd-(Zd*=Dd))*Gd+Zd,mp=((mp+qp)*Dd-Zd)*Gd+Zd,Zf=(Zf*Dd-(yd*=Dd))*Gd+yd,Qd=(Qd*Dd-yd)*Gd+yd,[[Lp,Qd,0],[mp,Qd,0],[mp,Zf,0],[Lp,Zf,0]]}(h,c,u._pixelsPerMercatorPixel,cl,eh);for(let jd=0;jd<Y.length;jd++)A0(Y[jd],sd[jd],ud);const Cd=Qv([],sd[Gh],sd[(Gh+1)%4]);V_(Cd,Cd,.5),A0(Hh,Cd,ud)}for(const sd of Y)Lw(yi,yi,sd),Ow(di,di,sd);return yi[2]=Math.min(Eh[2],kh[2]),Lw(yi,yi,Hh),Ow(di,di,Hh),new b_(yi,di)}function I0({x:u,y:c,z:h}){const w=1/(1<<h),T=new Rg(Gm(u*w),bm((c+1)*w)),F=new Rg(Gm((u+1)*w),bm(c*w));return new Jv(T,F)}function p1(u){const c=nh(u.getNorth()),h=nh(u.getSouth()),w=Math.cos(c),T=Math.cos(h),F=Math.sin(c),Y=Math.sin(h),ut=u.getWest(),di=u.getEast();return[Jx(T,Y,ut),Jx(T,Y,di),Jx(w,F,di),Jx(w,F,ut)]}function Jx(u,c,h,w=e0){return h=nh(h),[u*Math.sin(h)*w,-c*w,u*Math.cos(h)*w]}function Qx(u,c,h){return Jx(Math.cos(nh(u)),Math.sin(nh(u)),c,h)}function Nw(u,c,h,w){const T=1<<h.z,F=(u/jp+h.x)/T;return Qx(bm((c/jp+h.y)/T),Gm(F),w)}function f1({min:u,max:c}){return nE/Math.max(c[0]-u[0],c[1]-u[1],c[2]-u[2])}const rC=new Float64Array(16);function kw(u){const c=f1(u),h=X1(rC,[c,c,c]);return Mx(h,h,((w=[])[0]=-(T=u.min)[0],w[1]=-T[1],w[2]=-T[2],w));var w,T}function sb(u){const c=(w=u.min,(h=rC)[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1,h[11]=0,h[12]=w[0],h[13]=w[1],h[14]=w[2],h[15]=1,h);var h,w;const T=1/f1(u);return S0(c,c,[T,T,T])}function nC(u,c,h,w,T){const F=function(di){const yi=jp/(2*Math.PI);return di/(2*Math.PI)/yi}(h),Y=[u,c,-h/(2*Math.PI)],ut=dv(new Float64Array(16));return Mx(ut,ut,Y),S0(ut,ut,[F,F,F]),Pw(ut,ut,nh(-T)),Dw(ut,ut,nh(-w)),ut}function ew(u){return Fd(Xx,ib,u)}function Bw(u,c){const h=Qx(c.lat,c.lng),w=function(cl){const eh=Qx(cl._center.lat,cl._center.lng);let fh=J1([],Kx(0,1,0),eh);const Ch=Kb([],-cl.angle,eh);fh=sm(fh,fh,Ch),Kb(Ch,-cl._pitch,fh);const Gh=w_([],eh);return V_(Gh,Gh,mm(cl.cameraToCenterDistance/cl.pixelsPerMeter)),sm(Gh,Gh,Ch),Qv([],eh,Gh)}(u);return Y=(T=ax([],w,h))[0],ut=T[1],di=T[2],yi=(F=h)[0],kn=F[1],So=F[2],al=(sa=Math.sqrt(Y*Y+ut*ut+di*di)*Math.sqrt(yi*yi+kn*kn+So*So))&&Ay(T,F)/sa,Math.acos(Math.min(Math.max(al,-1),1));var T,F,Y,ut,di,yi,kn,So,sa,al}function lx(u,c){return Bw(u,c)>Math.PI/2*1.01}const ab=nh(85),lb=Math.cos(ab),cb=Math.sin(ab),Gw=63710088e-1,oC=2*Math.PI*Gw;class cx{constructor(c,h){if(isNaN(c)||isNaN(h))throw new Error(`Invalid LngLat object: (${c}, ${h})`);if(this.lng=+c,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new cx(Ld(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(c){const h=Math.PI/180,w=this.lat*h,T=c.lat*h,F=Math.sin(w)*Math.sin(T)+Math.cos(w)*Math.cos(T)*Math.cos((c.lng-this.lng)*h);return Gw*Math.acos(Math.min(F,1))}toBounds(c=0){const h=360*c/40075017,w=h/Math.cos(Math.PI/180*this.lat);return new Jv(new cx(this.lng-w,this.lat-h),new cx(this.lng+w,this.lat+h))}toEcef(c){const h=mm(c);return Qx(this.lat,this.lng,e0+h)}static convert(c){if(c instanceof cx)return c;if(Array.isArray(c)&&(c.length===2||c.length===3))return new cx(Number(c[0]),Number(c[1]));if(!Array.isArray(c)&&typeof c=="object"&&c!==null)return new cx(Number("lng"in c?c.lng:c.lon),Number(c.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Rg=cx;function g1(u){return oC*Math.cos(u*Math.PI/180)}function am(u){return(180+u)/360}function My(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function Py(u,c){return u/g1(c)}function Gm(u){return 360*u-180}function bm(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function tw(u,c){return u*g1(bm(c))}const _m=85.051129;function zw(u){return 1/Math.cos(u*Math.PI/180)}class M0{constructor(c,h,w=0){this.x=+c,this.y=+h,this.z=+w}static fromLngLat(c,h=0){const w=Rg.convert(c);return new M0(am(w.lng),My(w.lat),Py(h,w.lat))}toLngLat(){return new Rg(Gm(this.x),bm(this.y))}toAltitude(){return tw(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/oC*zw(bm(this.y))}}function ub(u,c,h,w,T,F,Y,ut,di){const yi=(c+w)/2,kn=(h+T)/2,So=new ll(yi,kn);ut(So),function(sa,al,cl,eh,fh,Ch){const Gh=cl-fh,Eh=eh-Ch;return Math.abs((eh-al)*Gh-(cl-sa)*Eh)/Math.hypot(Gh,Eh)}(So.x,So.y,F.x,F.y,Y.x,Y.y)>=di?(ub(u,c,h,yi,kn,F,So,ut,di),ub(u,yi,kn,w,T,So,Y,ut,di)):u.push(Y)}function hb(u,c,h){let w=u[0],T=w.x,F=w.y;c(w);const Y=[w];for(let ut=1;ut<u.length;ut++){const di=u[ut],{x:yi,y:kn}=di;c(di),ub(Y,T,F,yi,kn,w,di,c,h),T=yi,F=kn,w=di}return Y}function m1(u,c,h,w){if(w(c,h)){const T=c.add(h)._mult(.5);m1(u,c,T,w),m1(u,T,h,w)}else u.push(h)}function oE(u,c){let h=u[0];const w=[h];for(let T=1;T<u.length;T++){const F=u[T];m1(w,h,F,c),h=F}return w}const _1=Math.pow(2,14)-1,db=-_1-1;function pb(u,c){const h=Math.round(u.x*c),w=Math.round(u.y*c);return u.x=td(h,db,_1),u.y=td(w,db,_1),(h<u.x||h>u.x+1||w<u.y||w>u.y+1)&&Ad("Geometry exceeds allowed extent, reduce your vector tile buffer size"),u}function fv(u,c,h){const w=u.loadGeometry(),T=u.extent,F=jp/T;if(c&&h&&h.projection.isReprojectedInTileSpace){const Y=1<<c.z,{scale:ut,x:di,y:yi,projection:kn}=h,So=sa=>{const al=Gm((c.x+sa.x/T)/Y),cl=bm((c.y+sa.y/T)/Y),eh=kn.project(al,cl);sa.x=(eh.x*ut-di)*T,sa.y=(eh.y*ut-yi)*T};for(let sa=0;sa<w.length;sa++)if(u.type!==1)w[sa]=hb(w[sa],So,1);else{const al=[];for(const cl of w[sa])cl.x<0||cl.x>=T||cl.y<0||cl.y>=T||(So(cl),al.push(cl));w[sa]=al}}for(const Y of w)for(const ut of Y)pb(ut,F);return w}function Lx(u,c){return{type:u.type,id:u.id,properties:u.properties,geometry:c?fv(u):[]}}function y1(u,c,h,w,T){u.emplaceBack(2*c+(w+1)/2,2*h+(T+1)/2)}function Vw(u,c,h){u.emplaceBack(c.x,c.y,c.z,h[0]*16384,h[1]*16384,h[2]*16384)}class Ox{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(h=>h.id),this.index=c.index,this.hasPattern=!1,this.projection=c.projection,this.layoutVertexArray=new Bd,this.indexArray=new Bp,this.segments=new Kg,this.programConfigurations=new Sy(c.layers,c.zoom),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(c,h,w,T){const F=this.layers[0],Y=[];let ut=null;F.type==="circle"&&(ut=F.layout.get("circle-sort-key"));for(const{feature:yi,id:kn,index:So,sourceLayerIndex:sa}of c){const al=this.layers[0]._featureFilter.needGeometry,cl=Lx(yi,al);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),cl,w))continue;const eh=ut?ut.evaluate(cl,{},w):void 0,fh={id:kn,properties:yi.properties,type:yi.type,sourceLayerIndex:sa,index:So,geometry:al?cl.geometry:fv(yi,w,T),patterns:{},sortKey:eh};Y.push(fh)}ut&&Y.sort((yi,kn)=>yi.sortKey-kn.sortKey);let di=null;T.projection.name==="globe"&&(this.globeExtVertexArray=new Od,di=T.projection);for(const yi of Y){const{geometry:kn,index:So,sourceLayerIndex:sa}=yi,al=c[So].feature;this.addFeature(yi,kn,So,h.availableImages,w,di),h.featureIndex.insert(al,kn,So,sa,this.index)}}update(c,h,w,T){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,h,this.stateDependentLayers,w,T)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Wb.members),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=c.createVertexBuffer(this.globeExtVertexArray,qb.members))),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(c,h,w,T,F,Y){for(const ut of h)for(const di of ut){const yi=di.x,kn=di.y;if(yi<0||yi>=jp||kn<0||kn>=jp)continue;if(Y){const al=Y.projectTilePoint(yi,kn,F),cl=Y.upVector(F,yi,kn),eh=this.globeExtVertexArray;Vw(eh,al,cl),Vw(eh,al,cl),Vw(eh,al,cl),Vw(eh,al,cl)}const So=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,c.sortKey),sa=So.vertexLength;y1(this.layoutVertexArray,yi,kn,-1,-1),y1(this.layoutVertexArray,yi,kn,1,-1),y1(this.layoutVertexArray,yi,kn,1,1),y1(this.layoutVertexArray,yi,kn,-1,1),this.indexArray.emplaceBack(sa,sa+1,sa+2),this.indexArray.emplaceBack(sa,sa+2,sa+3),So.vertexLength+=4,So.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,w,{},T,F)}}function gv(u,c){for(let h=0;h<u.length;h++)if(P0(c,u[h]))return!0;for(let h=0;h<c.length;h++)if(P0(u,c[h]))return!0;return!!mb(u,c)}function ux(u,c,h){return!!P0(u,c)||!!iw(c,u,h)}function fb(u,c){if(u.length===1)return sC(c,u[0]);for(let h=0;h<c.length;h++){const w=c[h];for(let T=0;T<w.length;T++)if(P0(u,w[T]))return!0}for(let h=0;h<u.length;h++)if(sC(c,u[h]))return!0;for(let h=0;h<c.length;h++)if(mb(u,c[h]))return!0;return!1}function gb(u,c,h){if(u.length>1){if(mb(u,c))return!0;for(let w=0;w<c.length;w++)if(iw(c[w],u,h))return!0}for(let w=0;w<u.length;w++)if(iw(u[w],c,h))return!0;return!1}function mb(u,c){if(u.length===0||c.length===0)return!1;for(let h=0;h<u.length-1;h++){const w=u[h],T=u[h+1];for(let F=0;F<c.length-1;F++)if(sE(w,T,c[F],c[F+1]))return!0}return!1}function sE(u,c,h,w){return kp(u,h,w)!==kp(c,h,w)&&kp(u,c,h)!==kp(u,c,w)}function iw(u,c,h){const w=h*h;if(c.length===1)return u.distSqr(c[0])<w;for(let T=1;T<c.length;T++)if(v1(u,c[T-1],c[T])<w)return!0;return!1}function v1(u,c,h){const w=c.distSqr(h);if(w===0)return u.distSqr(c);const T=((u.x-c.x)*(h.x-c.x)+(u.y-c.y)*(h.y-c.y))/w;return u.distSqr(T<0?c:T>1?h:h.sub(c)._mult(T)._add(c))}function sC(u,c){let h,w,T,F=!1;for(let Y=0;Y<u.length;Y++){h=u[Y];for(let ut=0,di=h.length-1;ut<h.length;di=ut++)w=h[ut],T=h[di],w.y>c.y!=T.y>c.y&&c.x<(T.x-w.x)*(c.y-w.y)/(T.y-w.y)+w.x&&(F=!F)}return F}function P0(u,c){let h=!1;for(let w=0,T=u.length-1;w<u.length;T=w++){const F=u[w],Y=u[T];F.y>c.y!=Y.y>c.y&&c.x<(Y.x-F.x)*(c.y-F.y)/(Y.y-F.y)+F.x&&(h=!h)}return h}function x1(u,c,h,w,T){for(const Y of u)if(c<=Y.x&&h<=Y.y&&w>=Y.x&&T>=Y.y)return!0;const F=[new ll(c,h),new ll(c,T),new ll(w,T),new ll(w,h)];if(u.length>2){for(const Y of F)if(P0(u,Y))return!0}for(let Y=0;Y<u.length-1;Y++)if(rw(u[Y],u[Y+1],F))return!0;return!1}function rw(u,c,h){const w=h[0],T=h[2];if(u.x<w.x&&c.x<w.x||u.x>T.x&&c.x>T.x||u.y<w.y&&c.y<w.y||u.y>T.y&&c.y>T.y)return!1;const F=kp(u,c,h[0]);return F!==kp(u,c,h[1])||F!==kp(u,c,h[2])||F!==kp(u,c,h[3])}function Fx(u,c,h){const w=c.paint.get(u).value;return w.kind==="constant"?w.value:h.programConfigurations.get(c.id).getMaxValue(u)}function Uw(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function w1(u,c,h,w,T){if(!c[0]&&!c[1])return u;const F=ll.convert(c)._mult(T);h==="viewport"&&F._rotate(-w);const Y=[];for(let ut=0;ut<u.length;ut++)Y.push(u[ut].sub(F));return Y}function _b(u,c,h,w){const T=ll.convert(u)._mult(w);return c==="viewport"&&T._rotate(-h),T}vs(Ox,"CircleBucket",{omit:["layers"]});const b1=new Sh({"circle-sort-key":new mh(hd.layout_circle["circle-sort-key"])});var aC={paint:new Sh({"circle-radius":new mh(hd.paint_circle["circle-radius"]),"circle-color":new mh(hd.paint_circle["circle-color"]),"circle-blur":new mh(hd.paint_circle["circle-blur"]),"circle-opacity":new mh(hd.paint_circle["circle-opacity"]),"circle-translate":new _l(hd.paint_circle["circle-translate"]),"circle-translate-anchor":new _l(hd.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new _l(hd.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new _l(hd.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new mh(hd.paint_circle["circle-stroke-width"]),"circle-stroke-color":new mh(hd.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new mh(hd.paint_circle["circle-stroke-opacity"])}),layout:b1};function lC(u,c,h,w,T,F,Y,ut,di){if(F&&u.queryGeometry.isAboveHorizon)return!1;F&&(di*=u.pixelToTileUnitsFactor);const yi=u.tileID.canonical,kn=h.projection.upVectorScale(yi,h.center.lat,h.worldSize).metersToTile;for(const So of c)for(const sa of So){const al=sa.add(ut),cl=T&&h.elevation?h.elevation.exaggeration()*T.getElevationAt(al.x,al.y,!0):0,eh=h.projection.projectTilePoint(al.x,al.y,yi);if(cl>0){const Eh=h.projection.upVector(yi,al.x,al.y);eh.x+=Eh[0]*kn*cl,eh.y+=Eh[1]*kn*cl,eh.z+=Eh[2]*kn*cl}const fh=F?al:cC(eh.x,eh.y,eh.z,w),Ch=F?u.tilespaceRays.map(Eh=>lE(Eh,cl)):u.queryGeometry.screenGeometry,Gh=pv([],[eh.x,eh.y,eh.z,1],w);if(!Y&&F?di*=Gh[3]/h.cameraToCenterDistance:Y&&!F&&(di*=h.cameraToCenterDistance/Gh[3]),F){const Eh=bm((sa.y/jp+yi.y)/(1<<yi.z));di/=h.projection.pixelsPerMeter(Eh,1)/Py(1,Eh)}if(ux(Ch,fh,di))return!0}return!1}function cC(u,c,h,w){const T=pv([],[u,c,h,1],w);return new ll(T[0]/T[3],T[1]/T[3])}const uC=Kx(0,0,0),aE=Kx(0,0,1);function lE(u,c){const h=Y1();return uC[2]=c,u.intersectsPlane(uC,aE,h),new ll(h[0],h[1])}class hC extends Ox{}function C1(u,{width:c,height:h},w,T){if(T){if(T instanceof Uint8ClampedArray)T=new Uint8Array(T.buffer);else if(T.length!==c*h*w)throw new RangeError("mismatched image size")}else T=new Uint8Array(c*h*w);return u.width=c,u.height=h,u.data=T,u}function D0(u,c,h){const{width:w,height:T}=c;w===u.width&&T===u.height||(E1(u,c,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,w),height:Math.min(u.height,T)},h),u.width=w,u.height=T,u.data=c.data)}function E1(u,c,h,w,T,F){if(T.width===0||T.height===0)return c;if(T.width>u.width||T.height>u.height||h.x>u.width-T.width||h.y>u.height-T.height)throw new RangeError("out of range source coordinates for image copy");if(T.width>c.width||T.height>c.height||w.x>c.width-T.width||w.y>c.height-T.height)throw new RangeError("out of range destination coordinates for image copy");const Y=u.data,ut=c.data;for(let di=0;di<T.height;di++){const yi=((h.y+di)*u.width+h.x)*F,kn=((w.y+di)*c.width+w.x)*F;for(let So=0;So<T.width*F;So++)ut[kn+So]=Y[yi+So]}return c}vs(hC,"HeatmapBucket",{omit:["layers"]});class t0{constructor(c,h){C1(this,c,1,h)}resize(c){D0(this,new t0(c),1)}clone(){return new t0({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,h,w,T,F){E1(c,h,w,T,F,1)}}class P_{constructor(c,h){C1(this,c,4,h)}resize(c){D0(this,new P_(c),4)}replace(c,h){h?this.data.set(c):this.data=c instanceof Uint8ClampedArray?new Uint8Array(c.buffer):c}clone(){return new P_({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,h,w,T,F){E1(c,h,w,T,F,4)}}vs(t0,"AlphaImage"),vs(P_,"RGBAImage");var dC={paint:new Sh({"heatmap-radius":new mh(hd.paint_heatmap["heatmap-radius"]),"heatmap-weight":new mh(hd.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new _l(hd.paint_heatmap["heatmap-intensity"]),"heatmap-color":new wh(hd.paint_heatmap["heatmap-color"]),"heatmap-opacity":new _l(hd.paint_heatmap["heatmap-opacity"])})};function S1(u){const c={},h=u.resolution||256,w=u.clips?u.clips.length:1,T=u.image||new P_({width:h,height:w}),F=(Y,ut,di)=>{c[u.evaluationKey]=di;const yi=u.expression.evaluate(c);T.data[Y+ut+0]=Math.floor(255*yi.r/yi.a),T.data[Y+ut+1]=Math.floor(255*yi.g/yi.a),T.data[Y+ut+2]=Math.floor(255*yi.b/yi.a),T.data[Y+ut+3]=Math.floor(255*yi.a)};if(u.clips)for(let Y=0,ut=0;Y<w;++Y,ut+=4*h)for(let di=0,yi=0;di<h;di++,yi+=4){const kn=di/(h-1),{start:So,end:sa}=u.clips[Y];F(ut,yi,So*(1-kn)+sa*kn)}else for(let Y=0,ut=0;Y<h;Y++,ut+=4)F(0,ut,Y/(h-1));return T}var yb={paint:new Sh({"hillshade-illumination-direction":new _l(hd.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new _l(hd.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new _l(hd.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new _l(hd.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new _l(hd.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new _l(hd.paint_hillshade["hillshade-accent-color"])})};const T1=Zh([{name:"a_pos",components:2,type:"Int16"}],4),{members:pC}=T1;var $w={exports:{}};function Hw(u,c,h){h=h||2;var w,T,F,Y,ut,di,yi,kn=c&&c.length,So=kn?c[0]*h:u.length,sa=U_(u,0,So,h,!0),al=[];if(!sa||sa.next===sa.prev)return al;if(kn&&(sa=function(eh,fh,Ch,Gh){var Eh,kh,jh,Hh=[];for(Eh=0,kh=fh.length;Eh<kh;Eh++)(jh=U_(eh,fh[Eh]*Gh,Eh<kh-1?fh[Eh+1]*Gh:eh.length,Gh,!1))===jh.next&&(jh.steiner=!0),Hh.push(xC(jh));for(Hh.sort(yC),Eh=0;Eh<Hh.length;Eh++)Ch=cE(Hh[Eh],Ch);return Ch}(u,c,sa,h)),u.length>80*h){w=F=u[0],T=Y=u[1];for(var cl=h;cl<So;cl+=h)(ut=u[cl])<w&&(w=ut),(di=u[cl+1])<T&&(T=di),ut>F&&(F=ut),di>Y&&(Y=di);yi=(yi=Math.max(F-w,Y-T))!==0?32767/yi:0}return nw(sa,al,h,w,T,yi,0),al}function U_(u,c,h,w,T){var F,Y;if(T===aw(u,c,h,w)>0)for(F=c;F<h;F+=w)Y=vb(F,u[F],u[F+1],Y);else for(F=h-w;F>=c;F-=w)Y=vb(F,u[F],u[F+1],Y);return Y&&A1(Y,Y.next)&&(hx(Y),Y=Y.next),Y}function mv(u,c){if(!u)return u;c||(c=u);var h,w=u;do if(h=!1,w.steiner||!A1(w,w.next)&&lm(w.prev,w,w.next)!==0)w=w.next;else{if(hx(w),(w=c=w.prev)===w.next)break;h=!0}while(h||w!==c);return c}function nw(u,c,h,w,T,F,Y){if(u){!Y&&F&&function(kn,So,sa,al){var cl=kn;do cl.z===0&&(cl.z=i0(cl.x,cl.y,So,sa,al)),cl.prevZ=cl.prev,cl.nextZ=cl.next,cl=cl.next;while(cl!==kn);cl.prevZ.nextZ=null,cl.prevZ=null,function(eh){var fh,Ch,Gh,Eh,kh,jh,Hh,ud,sd=1;do{for(Ch=eh,eh=null,kh=null,jh=0;Ch;){for(jh++,Gh=Ch,Hh=0,fh=0;fh<sd&&(Hh++,Gh=Gh.nextZ);fh++);for(ud=sd;Hh>0||ud>0&&Gh;)Hh!==0&&(ud===0||!Gh||Ch.z<=Gh.z)?(Eh=Ch,Ch=Ch.nextZ,Hh--):(Eh=Gh,Gh=Gh.nextZ,ud--),kh?kh.nextZ=Eh:eh=Eh,Eh.prevZ=kh,kh=Eh;Ch=Gh}kh.nextZ=null,sd*=2}while(jh>1)}(cl)}(u,w,T,F);for(var ut,di,yi=u;u.prev!==u.next;)if(ut=u.prev,di=u.next,F?gC(u,w,T,F):fC(u))c.push(ut.i/h|0),c.push(u.i/h|0),c.push(di.i/h|0),hx(u),u=di.next,yi=di.next;else if((u=di)===yi){Y?Y===1?nw(u=mC(mv(u),c,h),c,h,w,T,F,2):Y===2&&_C(u,c,h,w,T,F):nw(mv(u),c,h,w,T,F,1);break}}}function fC(u){var c=u.prev,h=u,w=u.next;if(lm(c,h,w)>=0)return!1;for(var T=c.x,F=h.x,Y=w.x,ut=c.y,di=h.y,yi=w.y,kn=T<F?T<Y?T:Y:F<Y?F:Y,So=ut<di?ut<yi?ut:yi:di<yi?di:yi,sa=T>F?T>Y?T:Y:F>Y?F:Y,al=ut>di?ut>yi?ut:yi:di>yi?di:yi,cl=w.next;cl!==c;){if(cl.x>=kn&&cl.x<=sa&&cl.y>=So&&cl.y<=al&&Nx(T,ut,F,di,Y,yi,cl.x,cl.y)&&lm(cl.prev,cl,cl.next)>=0)return!1;cl=cl.next}return!0}function gC(u,c,h,w){var T=u.prev,F=u,Y=u.next;if(lm(T,F,Y)>=0)return!1;for(var ut=T.x,di=F.x,yi=Y.x,kn=T.y,So=F.y,sa=Y.y,al=ut<di?ut<yi?ut:yi:di<yi?di:yi,cl=kn<So?kn<sa?kn:sa:So<sa?So:sa,eh=ut>di?ut>yi?ut:yi:di>yi?di:yi,fh=kn>So?kn>sa?kn:sa:So>sa?So:sa,Ch=i0(al,cl,c,h,w),Gh=i0(eh,fh,c,h,w),Eh=u.prevZ,kh=u.nextZ;Eh&&Eh.z>=Ch&&kh&&kh.z<=Gh;){if(Eh.x>=al&&Eh.x<=eh&&Eh.y>=cl&&Eh.y<=fh&&Eh!==T&&Eh!==Y&&Nx(ut,kn,di,So,yi,sa,Eh.x,Eh.y)&&lm(Eh.prev,Eh,Eh.next)>=0||(Eh=Eh.prevZ,kh.x>=al&&kh.x<=eh&&kh.y>=cl&&kh.y<=fh&&kh!==T&&kh!==Y&&Nx(ut,kn,di,So,yi,sa,kh.x,kh.y)&&lm(kh.prev,kh,kh.next)>=0))return!1;kh=kh.nextZ}for(;Eh&&Eh.z>=Ch;){if(Eh.x>=al&&Eh.x<=eh&&Eh.y>=cl&&Eh.y<=fh&&Eh!==T&&Eh!==Y&&Nx(ut,kn,di,So,yi,sa,Eh.x,Eh.y)&&lm(Eh.prev,Eh,Eh.next)>=0)return!1;Eh=Eh.prevZ}for(;kh&&kh.z<=Gh;){if(kh.x>=al&&kh.x<=eh&&kh.y>=cl&&kh.y<=fh&&kh!==T&&kh!==Y&&Nx(ut,kn,di,So,yi,sa,kh.x,kh.y)&&lm(kh.prev,kh,kh.next)>=0)return!1;kh=kh.nextZ}return!0}function mC(u,c,h){var w=u;do{var T=w.prev,F=w.next.next;!A1(T,F)&&bC(T,w,w.next,F)&&ow(T,F)&&ow(F,T)&&(c.push(T.i/h|0),c.push(w.i/h|0),c.push(F.i/h|0),hx(w),hx(w.next),w=u=F),w=w.next}while(w!==u);return mv(w)}function _C(u,c,h,w,T,F){var Y=u;do{for(var ut=Y.next.next;ut!==Y.prev;){if(Y.i!==ut.i&&wC(Y,ut)){var di=Ww(Y,ut);return Y=mv(Y,Y.next),di=mv(di,di.next),nw(Y,c,h,w,T,F,0),void nw(di,c,h,w,T,F,0)}ut=ut.next}Y=Y.next}while(Y!==u)}function yC(u,c){return u.x-c.x}function cE(u,c){var h=function(T,F){var Y,ut=F,di=T.x,yi=T.y,kn=-1/0;do{if(yi<=ut.y&&yi>=ut.next.y&&ut.next.y!==ut.y){var So=ut.x+(yi-ut.y)*(ut.next.x-ut.x)/(ut.next.y-ut.y);if(So<=di&&So>kn&&(kn=So,Y=ut.x<ut.next.x?ut:ut.next,So===di))return Y}ut=ut.next}while(ut!==F);if(!Y)return null;var sa,al=Y,cl=Y.x,eh=Y.y,fh=1/0;ut=Y;do di>=ut.x&&ut.x>=cl&&di!==ut.x&&Nx(yi<eh?di:kn,yi,cl,eh,yi<eh?kn:di,yi,ut.x,ut.y)&&(sa=Math.abs(yi-ut.y)/(di-ut.x),ow(ut,T)&&(sa<fh||sa===fh&&(ut.x>Y.x||ut.x===Y.x&&vC(Y,ut)))&&(Y=ut,fh=sa)),ut=ut.next;while(ut!==al);return Y}(u,c);if(!h)return c;var w=Ww(h,u);return mv(w,w.next),mv(h,h.next)}function vC(u,c){return lm(u.prev,u,c.prev)<0&&lm(c.next,u,u.next)<0}function i0(u,c,h,w,T){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-h)*T|0)|u<<8))|u<<4))|u<<2))|u<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-w)*T|0)|c<<8))|c<<4))|c<<2))|c<<1))<<1}function xC(u){var c=u,h=u;do(c.x<h.x||c.x===h.x&&c.y<h.y)&&(h=c),c=c.next;while(c!==u);return h}function Nx(u,c,h,w,T,F,Y,ut){return(T-Y)*(c-ut)>=(u-Y)*(F-ut)&&(u-Y)*(w-ut)>=(h-Y)*(c-ut)&&(h-Y)*(F-ut)>=(T-Y)*(w-ut)}function wC(u,c){return u.next.i!==c.i&&u.prev.i!==c.i&&!function(h,w){var T=h;do{if(T.i!==h.i&&T.next.i!==h.i&&T.i!==w.i&&T.next.i!==w.i&&bC(T,T.next,h,w))return!0;T=T.next}while(T!==h);return!1}(u,c)&&(ow(u,c)&&ow(c,u)&&function(h,w){var T=h,F=!1,Y=(h.x+w.x)/2,ut=(h.y+w.y)/2;do T.y>ut!=T.next.y>ut&&T.next.y!==T.y&&Y<(T.next.x-T.x)*(ut-T.y)/(T.next.y-T.y)+T.x&&(F=!F),T=T.next;while(T!==h);return F}(u,c)&&(lm(u.prev,u,c.prev)||lm(u,c.prev,c))||A1(u,c)&&lm(u.prev,u,u.next)>0&&lm(c.prev,c,c.next)>0)}function lm(u,c,h){return(c.y-u.y)*(h.x-c.x)-(c.x-u.x)*(h.y-c.y)}function A1(u,c){return u.x===c.x&&u.y===c.y}function bC(u,c,h,w){var T=L0(lm(u,c,h)),F=L0(lm(u,c,w)),Y=L0(lm(h,w,u)),ut=L0(lm(h,w,c));return T!==F&&Y!==ut||!(T!==0||!jw(u,h,c))||!(F!==0||!jw(u,w,c))||!(Y!==0||!jw(h,u,w))||!(ut!==0||!jw(h,c,w))}function jw(u,c,h){return c.x<=Math.max(u.x,h.x)&&c.x>=Math.min(u.x,h.x)&&c.y<=Math.max(u.y,h.y)&&c.y>=Math.min(u.y,h.y)}function L0(u){return u>0?1:u<0?-1:0}function ow(u,c){return lm(u.prev,u,u.next)<0?lm(u,c,u.next)>=0&&lm(u,u.prev,c)>=0:lm(u,c,u.prev)<0||lm(u,u.next,c)<0}function Ww(u,c){var h=new sw(u.i,u.x,u.y),w=new sw(c.i,c.x,c.y),T=u.next,F=c.prev;return u.next=c,c.prev=u,h.next=T,T.prev=h,w.next=h,h.prev=w,F.next=w,w.prev=F,w}function vb(u,c,h,w){var T=new sw(u,c,h);return w?(T.next=w.next,T.prev=w,w.next.prev=T,w.next=T):(T.prev=T,T.next=T),T}function hx(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function sw(u,c,h){this.i=u,this.x=c,this.y=h,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function aw(u,c,h,w){for(var T=0,F=c,Y=h-w;F<h;F+=w)T+=(u[Y]-u[F])*(u[F+1]+u[Y+1]),Y=F;return T}$w.exports=Hw,$w.exports.default=Hw,Hw.deviation=function(u,c,h,w){var T=c&&c.length,F=Math.abs(aw(u,0,T?c[0]*h:u.length,h));if(T)for(var Y=0,ut=c.length;Y<ut;Y++)F-=Math.abs(aw(u,c[Y]*h,Y<ut-1?c[Y+1]*h:u.length,h));var di=0;for(Y=0;Y<w.length;Y+=3){var yi=w[Y]*h,kn=w[Y+1]*h,So=w[Y+2]*h;di+=Math.abs((u[yi]-u[So])*(u[kn+1]-u[yi+1])-(u[yi]-u[kn])*(u[So+1]-u[yi+1]))}return F===0&&di===0?0:Math.abs((di-F)/F)},Hw.flatten=function(u){for(var c=u[0][0].length,h={vertices:[],holes:[],dimensions:c},w=0,T=0;T<u.length;T++){for(var F=0;F<u[T].length;F++)for(var Y=0;Y<c;Y++)h.vertices.push(u[T][F][Y]);T>0&&h.holes.push(w+=u[T-1].length)}return h};var xb=Wr($w.exports);function uE(u,c,h,w,T){CC(u,c,h||0,w||u.length-1,T||lw)}function CC(u,c,h,w,T){for(;w>h;){if(w-h>600){var F=w-h+1,Y=c-h+1,ut=Math.log(F),di=.5*Math.exp(2*ut/3),yi=.5*Math.sqrt(ut*di*(F-di)/F)*(Y-F/2<0?-1:1);CC(u,c,Math.max(h,Math.floor(c-Y*di/F+yi)),Math.min(w,Math.floor(c+(F-Y)*di/F+yi)),T)}var kn=u[c],So=h,sa=w;for(qw(u,h,c),T(u[w],kn)>0&&qw(u,h,w);So<sa;){for(qw(u,So,sa),So++,sa--;T(u[So],kn)<0;)So++;for(;T(u[sa],kn)>0;)sa--}T(u[h],kn)===0?qw(u,h,sa):qw(u,++sa,w),sa<=c&&(h=sa+1),c<=sa&&(w=sa-1)}}function qw(u,c,h){var w=u[c];u[c]=u[h],u[h]=w}function lw(u,c){return u<c?-1:u>c?1:0}function Kw(u,c){const h=u.length;if(h<=1)return[u];const w=[];let T,F;for(let Y=0;Y<h;Y++){const ut=up(u[Y]);ut!==0&&(u[Y].area=Math.abs(ut),F===void 0&&(F=ut<0),F===ut<0?(T&&w.push(T),T=[u[Y]]):T.push(u[Y]))}if(T&&w.push(T),c>1)for(let Y=0;Y<w.length;Y++)w[Y].length<=c||(uE(w[Y],c,1,w[Y].length-1,EC),w[Y]=w[Y].slice(0,c));return w}function EC(u,c){return c.area-u.area}function Zw(u,c,h){const w=h.patternDependencies;let T=!1;for(const F of c){const Y=F.paint.get(`${u}-pattern`);Y.isConstant()||(T=!0);const ut=Y.constantOr(null);ut&&(T=!0,w[ut]=!0)}return T}function wb(u,c,h,w,T){const F=T.patternDependencies;for(const Y of c){const ut=Y.paint.get(`${u}-pattern`).value;if(ut.kind!=="constant"){let di=ut.evaluate({zoom:w},h,{},T.availableImages);di=di&&di.name?di.name:di,F[di]=!0,h.patterns[Y.id]=di}}return h}class Xw{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(h=>h.id),this.index=c.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Bd,this.indexArray=new Bp,this.indexArray2=new om,this.programConfigurations=new Sy(c.layers,c.zoom),this.segments=new Kg,this.segments2=new Kg,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.projection=c.projection}populate(c,h,w,T){this.hasPattern=Zw("fill",this.layers,h);const F=this.layers[0].layout.get("fill-sort-key"),Y=[];for(const{feature:ut,id:di,index:yi,sourceLayerIndex:kn}of c){const So=this.layers[0]._featureFilter.needGeometry,sa=Lx(ut,So);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),sa,w))continue;const al=F?F.evaluate(sa,{},w,h.availableImages):void 0,cl={id:di,properties:ut.properties,type:ut.type,sourceLayerIndex:kn,index:yi,geometry:So?sa.geometry:fv(ut,w,T),patterns:{},sortKey:al};Y.push(cl)}F&&Y.sort((ut,di)=>ut.sortKey-di.sortKey);for(const ut of Y){const{geometry:di,index:yi,sourceLayerIndex:kn}=ut;if(this.hasPattern){const So=wb("fill",this.layers,ut,this.zoom,h);this.patternFeatures.push(So)}else this.addFeature(ut,di,yi,w,{},h.availableImages);h.featureIndex.insert(c[yi].feature,di,yi,kn,this.index)}}update(c,h,w,T){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,h,this.stateDependentLayers,w,T)}addFeatures(c,h,w,T,F){for(const Y of this.patternFeatures)this.addFeature(Y,Y.geometry,Y.index,h,w,T)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,pC),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.indexBuffer2=c.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(c,h,w,T,F,Y=[]){for(const ut of Kw(h,500)){let di=0;for(const cl of ut)di+=cl.length;const yi=this.segments.prepareSegment(di,this.layoutVertexArray,this.indexArray),kn=yi.vertexLength,So=[],sa=[];for(const cl of ut){if(cl.length===0)continue;cl!==ut[0]&&sa.push(So.length/2);const eh=this.segments2.prepareSegment(cl.length,this.layoutVertexArray,this.indexArray2),fh=eh.vertexLength;this.layoutVertexArray.emplaceBack(cl[0].x,cl[0].y),this.indexArray2.emplaceBack(fh+cl.length-1,fh),So.push(cl[0].x),So.push(cl[0].y);for(let Ch=1;Ch<cl.length;Ch++)this.layoutVertexArray.emplaceBack(cl[Ch].x,cl[Ch].y),this.indexArray2.emplaceBack(fh+Ch-1,fh+Ch),So.push(cl[Ch].x),So.push(cl[Ch].y);eh.vertexLength+=cl.length,eh.primitiveLength+=cl.length}const al=xb(So,sa);for(let cl=0;cl<al.length;cl+=3)this.indexArray.emplaceBack(kn+al[cl],kn+al[cl+1],kn+al[cl+2]);yi.vertexLength+=di,yi.primitiveLength+=al.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,w,F,Y,T)}}vs(Xw,"FillBucket",{omit:["layers","patternFeatures"]});const SC=new Sh({"fill-sort-key":new mh(hd.layout_fill["fill-sort-key"])});var hE={paint:new Sh({"fill-antialias":new _l(hd.paint_fill["fill-antialias"]),"fill-opacity":new mh(hd.paint_fill["fill-opacity"]),"fill-color":new mh(hd.paint_fill["fill-color"]),"fill-outline-color":new mh(hd.paint_fill["fill-outline-color"]),"fill-translate":new _l(hd.paint_fill["fill-translate"]),"fill-translate-anchor":new _l(hd.paint_fill["fill-translate-anchor"]),"fill-pattern":new mh(hd.paint_fill["fill-pattern"])}),layout:SC};const TC=Zh([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),bb=Zh([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Cb=Zh([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:AC}=TC;var dx={},Eb=ml,Sb=px;function px(u,c,h,w,T){this.properties={},this.extent=h,this.type=0,this._pbf=u,this._geometry=-1,this._keys=w,this._values=T,u.readFields(R1,this,c)}function R1(u,c,h){u==1?c.id=h.readVarint():u==2?function(w,T){for(var F=w.readVarint()+w.pos;w.pos<F;){var Y=T._keys[w.readVarint()],ut=T._values[w.readVarint()];T.properties[Y]=ut}}(h,c):u==3?c.type=h.readVarint():u==4&&(c._geometry=h.pos)}function Yw(u){for(var c,h,w=0,T=0,F=u.length,Y=F-1;T<F;Y=T++)w+=((h=u[Y]).x-(c=u[T]).x)*(c.y+h.y);return w}px.types=["Unknown","Point","LineString","Polygon"],px.prototype.loadGeometry=function(){var u=this._pbf;u.pos=this._geometry;for(var c,h=u.readVarint()+u.pos,w=1,T=0,F=0,Y=0,ut=[];u.pos<h;){if(T<=0){var di=u.readVarint();w=7&di,T=di>>3}if(T--,w===1||w===2)F+=u.readSVarint(),Y+=u.readSVarint(),w===1&&(c&&ut.push(c),c=[]),c.push(new Eb(F,Y));else{if(w!==7)throw new Error("unknown command "+w);c&&c.push(c[0].clone())}}return c&&ut.push(c),ut},px.prototype.bbox=function(){var u=this._pbf;u.pos=this._geometry;for(var c=u.readVarint()+u.pos,h=1,w=0,T=0,F=0,Y=1/0,ut=-1/0,di=1/0,yi=-1/0;u.pos<c;){if(w<=0){var kn=u.readVarint();h=7&kn,w=kn>>3}if(w--,h===1||h===2)(T+=u.readSVarint())<Y&&(Y=T),T>ut&&(ut=T),(F+=u.readSVarint())<di&&(di=F),F>yi&&(yi=F);else if(h!==7)throw new Error("unknown command "+h)}return[Y,di,ut,yi]},px.prototype.toGeoJSON=function(u,c,h){var w,T,F=this.extent*Math.pow(2,h),Y=this.extent*u,ut=this.extent*c,di=this.loadGeometry(),yi=px.types[this.type];function kn(al){for(var cl=0;cl<al.length;cl++){var eh=al[cl];al[cl]=[360*(eh.x+Y)/F-180,360/Math.PI*Math.atan(Math.exp((180-360*(eh.y+ut)/F)*Math.PI/180))-90]}}switch(this.type){case 1:var So=[];for(w=0;w<di.length;w++)So[w]=di[w][0];kn(di=So);break;case 2:for(w=0;w<di.length;w++)kn(di[w]);break;case 3:for(di=function(al){var cl=al.length;if(cl<=1)return[al];for(var eh,fh,Ch=[],Gh=0;Gh<cl;Gh++){var Eh=Yw(al[Gh]);Eh!==0&&(fh===void 0&&(fh=Eh<0),fh===Eh<0?(eh&&Ch.push(eh),eh=[al[Gh]]):eh.push(al[Gh]))}return eh&&Ch.push(eh),Ch}(di),w=0;w<di.length;w++)for(T=0;T<di[w].length;T++)kn(di[w][T])}di.length===1?di=di[0]:yi="Multi"+yi;var sa={type:"Feature",geometry:{type:yi,coordinates:di},properties:this.properties};return"id"in this&&(sa.id=this.id),sa};var Tb=Sb,I1=M1;function M1(u,c){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(dE,this,c),this.length=this._features.length}function dE(u,c,h){u===15?c.version=h.readVarint():u===1?c.name=h.readString():u===5?c.extent=h.readVarint():u===2?c._features.push(h.pos):u===3?c._keys.push(h.readString()):u===4&&c._values.push(function(w){for(var T=null,F=w.readVarint()+w.pos;w.pos<F;){var Y=w.readVarint()>>3;T=Y===1?w.readString():Y===2?w.readFloat():Y===3?w.readDouble():Y===4?w.readVarint64():Y===5?w.readVarint():Y===6?w.readSVarint():Y===7?w.readBoolean():null}return T}(h))}M1.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var c=this._pbf.readVarint()+this._pbf.pos;return new Tb(this._pbf,c,this.extent,this._keys,this._values)};var x=I1;function f(u,c,h){if(u===3){var w=new x(h,h.readVarint()+h.pos);w.length&&(c[w.name]=w)}}var C=dx.VectorTile=function(u,c){this.layers=u.readFields(f,{},c)},N=dx.VectorTileFeature=Sb;function ot(u,c,h,w){const T=[],F=w===0?(Y,ut,di,yi,kn,So)=>{Y.push(new ll(So,di+(So-ut)/(yi-ut)*(kn-di)))}:(Y,ut,di,yi,kn,So)=>{Y.push(new ll(ut+(So-di)/(kn-di)*(yi-ut),So))};for(const Y of u){const ut=[];for(const di of Y){if(di.length<=2)continue;const yi=[];for(let sa=0;sa<di.length-1;sa++){const al=di[sa].x,cl=di[sa].y,eh=di[sa+1].x,fh=di[sa+1].y,Ch=w===0?al:cl,Gh=w===0?eh:fh;Ch<c?Gh>c&&F(yi,al,cl,eh,fh,c):Ch>h?Gh<h&&F(yi,al,cl,eh,fh,h):yi.push(di[sa]),Gh<c&&Ch>=c&&F(yi,al,cl,eh,fh,c),Gh>h&&Ch<=h&&F(yi,al,cl,eh,fh,h)}let kn=di[di.length-1];const So=w===0?kn.x:kn.y;So>=c&&So<=h&&yi.push(kn),yi.length&&(kn=yi[yi.length-1],yi[0].x===kn.x&&yi[0].y===kn.y||yi.push(yi[0]),ut.push(yi))}ut.length&&T.push(ut)}return T}dx.VectorTileLayer=I1;const Bt=N.types,Jt=Math.pow(2,13);function Ir(u,c,h,w,T,F,Y,ut){u.emplaceBack((c<<1)+Y,(h<<1)+F,(Math.floor(w*Jt)<<1)+T,Math.round(ut))}function wo(u,c,h){u.emplaceBack(c.x,c.y,c.z,h[0]*16384,h[1]*16384,h[2]*16384)}class ol{constructor(){this.acc=new ll(0,0),this.polyCount=[]}startRing(c){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ll(c.x,c.y),this.max=new ll(c.x,c.y))}append(c,h){this.currentPolyCount.edges++,this.acc._add(c);const w=this.min,T=this.max;c.x<w.x?w.x=c.x:c.x>T.x&&(T.x=c.x),c.y<w.y?w.y=c.y:c.y>T.y&&(T.y=c.y),((c.x===0||c.x===jp)&&c.x===h.x)!=((c.y===0||c.y===jp)&&c.y===h.y)&&this.processBorderOverlap(c,h),h.x<0!=c.x<0&&this.addBorderIntersection(0,Hp(h.y,c.y,(0-h.x)/(c.x-h.x))),h.x>jp!=c.x>jp&&this.addBorderIntersection(1,Hp(h.y,c.y,(jp-h.x)/(c.x-h.x))),h.y<0!=c.y<0&&this.addBorderIntersection(2,Hp(h.x,c.x,(0-h.y)/(c.y-h.y))),h.y>jp!=c.y>jp&&this.addBorderIntersection(3,Hp(h.x,c.x,(jp-h.y)/(c.y-h.y)))}addBorderIntersection(c,h){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const w=this.borders[c];h<w[0]&&(w[0]=h),h>w[1]&&(w[1]=h)}processBorderOverlap(c,h){if(c.x===h.x){if(c.y===h.y)return;const w=c.x===0?0:1;this.addBorderIntersection(w,h.y),this.addBorderIntersection(w,c.y)}else{const w=c.y===0?2:3;this.addBorderIntersection(w,h.x),this.addBorderIntersection(w,c.x)}}centroid(){const c=this.polyCount.reduce((h,w)=>h+w.edges,0);return c!==0?this.acc.div(c)._round():new ll(0,0)}span(){return new ll(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((c,h)=>c+ +(h[0]!==Number.MAX_VALUE),0)}}class hl{constructor(c){this.zoom=c.zoom,this.canonical=c.canonical,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(h=>h.id),this.index=c.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=c.projection,this.layoutVertexArray=new Sd,this.centroidVertexArray=new Ey,this.indexArray=new Bp,this.programConfigurations=new Sy(c.layers,c.zoom),this.segments=new Kg,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.enableTerrain=c.enableTerrain}populate(c,h,w,T){this.features=[],this.hasPattern=Zw("fill-extrusion",this.layers,h),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(F){const Y=Math.exp(Math.PI*(1-F.y/(1<<F.z)*2));return 80150034*Y/(Y*Y+1)/jp/(1<<F.z)}(w),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:F,id:Y,index:ut,sourceLayerIndex:di}of c){const yi=this.layers[0]._featureFilter.needGeometry,kn=Lx(F,yi);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),kn,w))continue;const So={id:Y,sourceLayerIndex:di,index:ut,geometry:yi?kn.geometry:fv(F,w,T),properties:F.properties,type:F.type,patterns:{}},sa=this.layoutVertexArray.length;this.hasPattern?this.features.push(wb("fill-extrusion",this.layers,So,this.zoom,h)):this.addFeature(So,So.geometry,ut,w,{},h.availableImages,T),h.featureIndex.insert(F,So.geometry,ut,di,this.index,sa)}this.sortBorders()}addFeatures(c,h,w,T,F){for(const Y of this.features){const{geometry:ut}=Y;this.addFeature(Y,ut,Y.index,h,w,T,F)}this.sortBorders()}update(c,h,w,T){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,h,this.stateDependentLayers,w,T)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,AC),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=c.createVertexBuffer(this.layoutVertexExtArray,Cb.members,!0))),this.programConfigurations.upload(c),this.uploaded=!0}uploadCentroid(c){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=c.createVertexBuffer(this.centroidVertexArray,bb.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(c,h,w,T,F,Y,ut){const di=[new ll(0,0),new ll(jp,jp)],yi=ut.projection,kn=yi.name==="globe",So=this.enableTerrain&&!kn?new ol:null,sa=Bt[c.type]==="Polygon";kn&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Od);const al=Kw(h,500);for(let Ch=al.length-1;Ch>=0;Ch--){const Gh=al[Ch];(Gh.length===0||(cl=Gh[0]).every(Eh=>Eh.x<=0)||cl.every(Eh=>Eh.x>=jp)||cl.every(Eh=>Eh.y<=0)||cl.every(Eh=>Eh.y>=jp))&&al.splice(Ch,1)}var cl;let eh;if(kn)eh=Jh(al,di,T);else{eh=[];for(const Ch of al)eh.push({polygon:Ch,bounds:di})}const fh=sa?this.edgeRadius:0;for(const{polygon:Ch,bounds:Gh}of eh){let Eh=0,kh=0;for(const Hh of Ch)sa&&!Hh[0].equals(Hh[Hh.length-1])&&Hh.push(Hh[0]),kh+=sa?Hh.length-1:Hh.length;const jh=this.segments.prepareSegment((sa?5:4)*kh,this.layoutVertexArray,this.indexArray);if(sa){const Hh=[],ud=[];Eh=jh.vertexLength;for(const Cd of Ch){let jd,gd;Cd.length&&Cd!==Ch[0]&&ud.push(Hh.length/2),jd=Cd[1].sub(Cd[0])._perp()._unit();for(let Pd=1;Pd<Cd.length;Pd++){const Dd=Cd[Pd],Gd=Cd[Pd===Cd.length-1?1:Pd+1];let{x:Zd,y:yd}=Dd;if(fh){gd=Gd.sub(Dd)._perp()._unit();const dp=jd.add(gd)._unit(),Lp=fh*Math.min(4,1/(jd.x*dp.x+jd.y*dp.y));Zd+=Lp*dp.x,yd+=Lp*dp.y,jd=gd}Ir(this.layoutVertexArray,Zd,yd,0,0,1,1,0),jh.vertexLength++,Hh.push(Dd.x,Dd.y),kn&&wo(this.layoutVertexExtArray,yi.projectTilePoint(Zd,yd,T),yi.upVector(T,Zd,yd))}}const sd=xb(Hh,ud);for(let Cd=0;Cd<sd.length;Cd+=3)this.indexArray.emplaceBack(Eh+sd[Cd],Eh+sd[Cd+2],Eh+sd[Cd+1]),jh.primitiveLength++}for(const Hh of Ch){So&&Hh.length&&So.startRing(Hh[0]);let ud,sd,Cd,jd=Hh.length>4&&Ph(Hh[Hh.length-2],Hh[0],Hh[1]),gd=fh?ah(Hh[Hh.length-2],Hh[0],Hh[1],fh):0;sd=Hh[1].sub(Hh[0])._perp()._unit();let Pd=!0;for(let Dd=1,Gd=0;Dd<Hh.length;Dd++){let Zd=Hh[Dd-1],yd=Hh[Dd];const dp=Hh[Dd===Hh.length-1?1:Dd+1];if(So&&sa&&So.currentPolyCount.top++,ph(yd,Zd,Gh)){fh&&(sd=dp.sub(yd)._perp()._unit(),Pd=!Pd);continue}So&&So.append(yd,Zd);const Lp=yd.sub(Zd)._perp(),mp=Lp.x/(Math.abs(Lp.x)+Math.abs(Lp.y)),Zf=Lp.y>0?1:0,Qd=Zd.dist(yd);if(Gd+Qd>32768&&(Gd=0),fh){Cd=dp.sub(yd)._perp()._unit();let Yf=uh(Zd,yd,dp,vl(sd,Cd),fh);isNaN(Yf)&&(Yf=0);const Gf=yd.sub(Zd)._unit();Zd=Zd.add(Gf.mult(gd))._round(),yd=yd.add(Gf.mult(-Yf))._round(),gd=Yf,sd=Cd}const qp=jh.vertexLength,Xf=Hh.length>4&&Ph(Zd,yd,dp);let vg=Mh(Gd,jd,Pd);if(Ir(this.layoutVertexArray,Zd.x,Zd.y,mp,Zf,0,0,vg),Ir(this.layoutVertexArray,Zd.x,Zd.y,mp,Zf,0,1,vg),Gd+=Qd,vg=Mh(Gd,Xf,!Pd),jd=Xf,Ir(this.layoutVertexArray,yd.x,yd.y,mp,Zf,0,0,vg),Ir(this.layoutVertexArray,yd.x,yd.y,mp,Zf,0,1,vg),jh.vertexLength+=4,this.indexArray.emplaceBack(qp+0,qp+1,qp+2),this.indexArray.emplaceBack(qp+1,qp+3,qp+2),jh.primitiveLength+=2,fh){const Yf=Eh+(Dd===1?Hh.length-2:Dd-2),Gf=Dd===1?Eh:Yf+1;if(this.indexArray.emplaceBack(qp+1,Yf,qp+3),this.indexArray.emplaceBack(Yf,Gf,qp+3),jh.primitiveLength+=2,ud===void 0&&(ud=qp),!ph(dp,Hh[Dd],Gh)){const qg=Dd===Hh.length-1?ud:jh.vertexLength;this.indexArray.emplaceBack(qp+2,qp+3,qg),this.indexArray.emplaceBack(qp+3,qg+1,qg),this.indexArray.emplaceBack(qp+3,Gf,qg+1),jh.primitiveLength+=3}Pd=!Pd}if(kn){const Yf=this.layoutVertexExtArray,Gf=yi.projectTilePoint(Zd.x,Zd.y,T),qg=yi.projectTilePoint(yd.x,yd.y,T),Qf=yi.upVector(T,Zd.x,Zd.y),eg=yi.upVector(T,yd.x,yd.y);wo(Yf,Gf,Qf),wo(Yf,Gf,Qf),wo(Yf,qg,eg),wo(Yf,qg,eg)}}sa&&(Eh+=Hh.length-1)}}if(So&&So.polyCount.length>0){if(So.borders){So.vertexArrayOffset=this.centroidVertexArray.length;const Ch=So.borders,Gh=this.featuresOnBorder.push(So)-1;for(let Eh=0;Eh<4;Eh++)Ch[Eh][0]!==Number.MAX_VALUE&&this.borders[Eh].push(Gh)}this.encodeCentroid(So.borders?void 0:So.centroid(),So)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,w,F,Y,T)}sortBorders(){for(let c=0;c<4;c++)this.borders[c].sort((h,w)=>this.featuresOnBorder[h].borders[c][0]-this.featuresOnBorder[w].borders[c][0])}encodeCentroid(c,h,w=!0){let T,F;if(c)if(c.y!==0){const ut=h.span()._mult(this.tileToMeter);T=(Math.max(c.x,1)<<3)+Math.min(7,Math.round(ut.x/10)),F=(Math.max(c.y,1)<<3)+Math.min(7,Math.round(ut.y/10))}else T=Math.ceil(7*(c.x+450)),F=0;else T=0,F=+w;let Y=w?this.centroidVertexArray.length:h.vertexArrayOffset;for(const ut of h.polyCount){w&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*ut.edges+ut.top);for(let di=0;di<ut.top;di++)this.centroidVertexArray.emplace(Y++,T,F);for(let di=0;di<2*ut.edges;di++)this.centroidVertexArray.emplace(Y++,0,F),this.centroidVertexArray.emplace(Y++,T,F)}}}function vl(u,c){const h=u.add(c)._unit();return u.x*h.x+u.y*h.y}function ah(u,c,h,w){const T=c.sub(u)._perp()._unit(),F=h.sub(c)._perp()._unit();return uh(u,c,h,vl(T,F),w)}function uh(u,c,h,w,T){const F=Math.sqrt(1-w*w);return Math.min(u.dist(c)/3,c.dist(h)/3,T*F/w)}function ph(u,c,h){return u.x<h[0].x&&c.x<h[0].x||u.x>h[1].x&&c.x>h[1].x||u.y<h[0].y&&c.y<h[0].y||u.y>h[1].y&&c.y>h[1].y}function Ph(u,c,h){if(u.x<0||u.x>=jp||c.x<0||c.x>=jp||h.x<0||h.x>=jp)return!1;const w=h.sub(c),T=w.perp(),F=u.sub(c);return(w.x*F.x+w.y*F.y)/Math.sqrt((w.x*w.x+w.y*w.y)*(F.x*F.x+F.y*F.y))>-.866&&T.x*F.x+T.y*F.y<0}function Mh(u,c,h){const w=c?2|u:-3&u;return h?1|w:-2&w}function Xh(){const u=Math.PI/32,c=Math.tan(u),h=Gw;return h*Math.sqrt(1+2*c*c)-h}function Jh(u,c,h){const w=1<<h.z,T=Gm(h.x/w),F=Gm((h.x+1)/w),Y=bm(h.y/w),ut=bm((h.y+1)/w);return function(di,yi,kn,So,sa=0,al){const cl=[];if(!di.length||!kn||!So)return cl;const eh=(Hh,ud)=>{for(const sd of Hh)cl.push({polygon:sd,bounds:ud})},fh=Math.ceil(Math.log2(kn)),Ch=Math.ceil(Math.log2(So)),Gh=fh-Ch,Eh=[];for(let Hh=0;Hh<Math.abs(Gh);Hh++)Eh.push(Gh>0?0:1);for(let Hh=0;Hh<Math.min(fh,Ch);Hh++)Eh.push(0),Eh.push(1);let kh=di;if(kh=ot(kh,yi[0].y-sa,yi[1].y+sa,1),kh=ot(kh,yi[0].x-sa,yi[1].x+sa,0),!kh.length)return cl;const jh=[];for(Eh.length?jh.push({polygons:kh,bounds:yi,depth:0}):eh(kh,yi);jh.length;){const Hh=jh.pop(),ud=Hh.depth,sd=Eh[ud],Cd=Hh.bounds[0],jd=Hh.bounds[1],gd=sd===0?Cd.x:Cd.y,Pd=sd===0?jd.x:jd.y,Dd=al?al(sd,gd,Pd):.5*(gd+Pd),Gd=ot(Hh.polygons,gd-sa,Dd+sa,sd),Zd=ot(Hh.polygons,Dd-sa,Pd+sa,sd);if(Gd.length){const yd=[Cd,new ll(sd===0?Dd:jd.x,sd===1?Dd:jd.y)];Eh.length>ud+1?jh.push({polygons:Gd,bounds:yd,depth:ud+1}):eh(Gd,yd)}if(Zd.length){const yd=[new ll(sd===0?Dd:Cd.x,sd===1?Dd:Cd.y),jd];Eh.length>ud+1?jh.push({polygons:Zd,bounds:yd,depth:ud+1}):eh(Zd,yd)}}return cl}(u,c,Math.ceil((F-T)/11.25),Math.ceil((Y-ut)/11.25),1,(di,yi,kn)=>{if(di===0)return .5*(yi+kn);{const So=bm((h.y+yi/jp)/w);return(My(.5*(bm((h.y+kn/jp)/w)+So))*w-h.y)*jp}})}vs(hl,"FillExtrusionBucket",{omit:["layers","features"]}),vs(ol,"PartMetadata");const qh=new Sh({"fill-extrusion-edge-radius":new _l(hd["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var ld={paint:new Sh({"fill-extrusion-opacity":new _l(hd["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new mh(hd["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new _l(hd["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new _l(hd["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new mh(hd["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new mh(hd["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new mh(hd["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new _l(hd["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new _l(hd["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new _l(hd["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new _l(hd["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:qh};function pd(u,c,h){var w=2*Math.PI*6378137/256/Math.pow(2,h);return[u*w-2*Math.PI*6378137/2,c*w-2*Math.PI*6378137/2]}class Md{constructor(c,h,w){this.z=c,this.x=h,this.y=w,this.key=yp(0,c,c,h,w)}equals(c){return this.z===c.z&&this.x===c.x&&this.y===c.y}url(c,h){const w=function(F,Y,ut){var di=pd(256*F,256*(Y=Math.pow(2,ut)-Y-1),ut),yi=pd(256*(F+1),256*(Y+1),ut);return di[0]+","+di[1]+","+yi[0]+","+yi[1]}(this.x,this.y,this.z),T=function(F,Y,ut){let di,yi="";for(let kn=F;kn>0;kn--)di=1<<kn-1,yi+=(Y&di?1:0)+(ut&di?2:0);return yi}(this.z,this.x,this.y);return c[(this.x+this.y)%c.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(h==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",T).replace("{bbox-epsg-3857}",w)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Pp{constructor(c,h){this.wrap=c,this.canonical=h,this.key=yp(c,h.z,h.z,h.x,h.y)}}class bp{constructor(c,h,w,T,F){this.overscaledZ=c,this.wrap=h,this.canonical=new Md(w,+T,+F),this.key=h===0&&c===w?this.canonical.key:yp(h,c,w,T,F)}equals(c){return this.overscaledZ===c.overscaledZ&&this.wrap===c.wrap&&this.canonical.equals(c.canonical)}scaledTo(c){const h=this.canonical.z-c;return c>this.canonical.z?new bp(c,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new bp(c,this.wrap,c,this.canonical.x>>h,this.canonical.y>>h)}calculateScaledKey(c,h=!0){if(this.overscaledZ===c&&h)return this.key;if(c>this.canonical.z)return yp(this.wrap*+h,c,this.canonical.z,this.canonical.x,this.canonical.y);{const w=this.canonical.z-c;return yp(this.wrap*+h,c,c,this.canonical.x>>w,this.canonical.y>>w)}}isChildOf(c){if(c.wrap!==this.wrap)return!1;const h=this.canonical.z-c.canonical.z;return c.overscaledZ===0||c.overscaledZ<this.overscaledZ&&c.canonical.x===this.canonical.x>>h&&c.canonical.y===this.canonical.y>>h}children(c){if(this.overscaledZ>=c)return[new bp(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,w=2*this.canonical.x,T=2*this.canonical.y;return[new bp(h,this.wrap,h,w,T),new bp(h,this.wrap,h,w+1,T),new bp(h,this.wrap,h,w,T+1),new bp(h,this.wrap,h,w+1,T+1)]}isLessThan(c){return this.wrap<c.wrap||!(this.wrap>c.wrap)&&(this.overscaledZ<c.overscaledZ||!(this.overscaledZ>c.overscaledZ)&&(this.canonical.x<c.canonical.x||!(this.canonical.x>c.canonical.x)&&this.canonical.y<c.canonical.y))}wrapped(){return new bp(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(c){return new bp(this.overscaledZ,c,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Pp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function yp(u,c,h,w,T){const F=1<<Math.min(h,22);let Y=F*(T%F)+w%F;return u&&h<22&&(Y+=F*F*((u<0?-2*u-1:2*u)%(1<<2*(22-h)))),16*(32*Y+h)+(c-h)}vs(Md,"CanonicalTileID"),vs(bp,"OverscaledTileID",{omit:["projMatrix"]});class hp extends ll{constructor(c,h,w){super(c,h),this.z=w}}function lp(u,c){return u.x*c.x+u.y*c.y}function Sp(u,c){if(u.length===1){let h=0;const w=c[h++];let T;for(;!T||w.equals(T);)if(T=c[h++],!T)return 1/0;for(;h<c.length;h++){const F=c[h],Y=u[0],ut=T.sub(w),di=F.sub(w),yi=Y.sub(w),kn=lp(ut,ut),So=lp(ut,di),sa=lp(di,di),al=lp(yi,ut),cl=lp(yi,di),eh=kn*sa-So*So,fh=(sa*al-So*cl)/eh,Ch=(kn*cl-So*al)/eh,Gh=w.z*(1-fh-Ch)+T.z*fh+F.z*Ch;if(isFinite(Gh))return Gh}return 1/0}{let h=1/0;for(const w of c)h=Math.min(h,w.z);return h}}function vp(u,c,h,w,T,F,Y,ut){const di=Y*T.getElevationAt(u,c,!0,!0),yi=F[0]!==0,kn=yi?F[1]===0?Y*(F[0]/7-450):Y*function(So,sa,al){const cl=Math.floor(sa[0]/8),eh=Math.floor(sa[1]/8),fh=10*(sa[0]-8*cl),Ch=10*(sa[1]-8*eh),Gh=So.getElevationAt(cl,eh,!0,!0),Eh=So.getMeterToDEM(al),kh=Math.floor(.5*(fh*Eh-1)),jh=Math.floor(.5*(Ch*Eh-1)),Hh=So.tileCoordToPixel(cl,eh),ud=2*kh+1,sd=2*jh+1,Cd=function(Zd,yd,dp,Lp,mp){return[Zd.getElevationAtPixel(yd,dp,!0),Zd.getElevationAtPixel(yd+mp,dp,!0),Zd.getElevationAtPixel(yd,dp+mp,!0),Zd.getElevationAtPixel(yd+Lp,dp+mp,!0)]}(So,Hh.x-kh,Hh.y-jh,ud,sd),jd=Math.abs(Cd[0]-Cd[1]),gd=Math.abs(Cd[2]-Cd[3]),Pd=Math.abs(Cd[0]-Cd[2])+Math.abs(Cd[1]-Cd[3]),Dd=Math.min(.25,.5*Eh*(jd+gd)/ud),Gd=Math.min(.25,.5*Eh*Pd/sd);return Gh+Math.max(Dd*fh,Gd*Ch)}(T,F,ut):di;return{base:di+(h===0)?-1:h,top:yi?Math.max(kn+w,di+h+2):di+w}}const Jd=Zh([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Xp}=Jd,$p=Zh([{name:"a_packed",components:4,type:"Float32"}]),{members:ag}=$p,Wg=N.types,Zg=Math.cos(Math.PI/180*37.5);class cm{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(h=>h.id),this.index=c.index,this.projection=c.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(h=>{this.gradients[h.id]={}}),this.layoutVertexArray=new dd,this.layoutVertexArray2=new xd,this.indexArray=new Bp,this.programConfigurations=new Sy(c.layers,c.zoom),this.segments=new Kg,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(c,h,w,T){this.hasPattern=Zw("line",this.layers,h);const F=this.layers[0].layout.get("line-sort-key"),Y=[];for(const{feature:kn,id:So,index:sa,sourceLayerIndex:al}of c){const cl=this.layers[0]._featureFilter.needGeometry,eh=Lx(kn,cl);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),eh,w))continue;const fh=F?F.evaluate(eh,{},w):void 0,Ch={id:So,properties:kn.properties,type:kn.type,sourceLayerIndex:al,index:sa,geometry:cl?eh.geometry:fv(kn,w,T),patterns:{},sortKey:fh};Y.push(Ch)}F&&Y.sort((kn,So)=>kn.sortKey-So.sortKey);const{lineAtlas:ut,featureIndex:di}=h,yi=this.addConstantDashes(ut);for(const kn of Y){const{geometry:So,index:sa,sourceLayerIndex:al}=kn;if(yi&&this.addFeatureDashes(kn,ut),this.hasPattern){const cl=wb("line",this.layers,kn,this.zoom,h);this.patternFeatures.push(cl)}else this.addFeature(kn,So,sa,w,ut.positions,h.availableImages);di.insert(c[sa].feature,So,sa,al,this.index)}}addConstantDashes(c){let h=!1;for(const w of this.layers){const T=w.paint.get("line-dasharray").value,F=w.layout.get("line-cap").value;if(T.kind!=="constant"||F.kind!=="constant")h=!0;else{const Y=F.value,ut=T.value;if(!ut)continue;c.addDash(ut,Y)}}return h}addFeatureDashes(c,h){const w=this.zoom;for(const T of this.layers){const F=T.paint.get("line-dasharray").value,Y=T.layout.get("line-cap").value;if(F.kind==="constant"&&Y.kind==="constant")continue;let ut,di;if(F.kind==="constant"){if(ut=F.value,!ut)continue}else ut=F.evaluate({zoom:w},c);di=Y.kind==="constant"?Y.value:Y.evaluate({zoom:w},c),h.addDash(ut,di),c.patterns[T.id]=h.getKey(ut,di)}}update(c,h,w,T){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,h,this.stateDependentLayers,w,T)}addFeatures(c,h,w,T,F){for(const Y of this.patternFeatures)this.addFeature(Y,Y.geometry,Y.index,h,w,T)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=c.createVertexBuffer(this.layoutVertexArray2,ag)),this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Xp),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(c){if(c.properties&&c.properties.hasOwnProperty("mapbox_clip_start")&&c.properties.hasOwnProperty("mapbox_clip_end"))return{start:+c.properties.mapbox_clip_start,end:+c.properties.mapbox_clip_end}}addFeature(c,h,w,T,F,Y){const ut=this.layers[0].layout,di=ut.get("line-join").evaluate(c,{}),yi=ut.get("line-cap").evaluate(c,{}),kn=ut.get("line-miter-limit"),So=ut.get("line-round-limit");this.lineClips=this.lineFeatureClips(c);for(const sa of h)this.addLine(sa,c,di,yi,kn,So);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,w,F,Y,T)}addLine(c,h,w,T,F,Y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ch=0;Ch<c.length-1;Ch++)this.totalDistance+=c[Ch].dist(c[Ch+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const ut=Wg[h.type]==="Polygon";let di=c.length;for(;di>=2&&c[di-1].equals(c[di-2]);)di--;let yi=0;for(;yi<di-1&&c[yi].equals(c[yi+1]);)yi++;if(di<(ut?3:2))return;w==="bevel"&&(F=1.05);const kn=this.overscaling<=16?15*jp/(512*this.overscaling):0,So=this.segments.prepareSegment(10*di,this.layoutVertexArray,this.indexArray);let sa,al,cl,eh,fh;this.e1=this.e2=-1,ut&&(sa=c[di-2],fh=c[yi].sub(sa)._unit()._perp());for(let Ch=yi;Ch<di;Ch++){if(cl=Ch===di-1?ut?c[yi+1]:void 0:c[Ch+1],cl&&c[Ch].equals(cl))continue;fh&&(eh=fh),sa&&(al=sa),sa=c[Ch],fh=cl?cl.sub(sa)._unit()._perp():eh,eh=eh||fh;let Gh=eh.add(fh);Gh.x===0&&Gh.y===0||Gh._unit();const Eh=eh.x*fh.x+eh.y*fh.y,kh=Gh.x*fh.x+Gh.y*fh.y,jh=kh!==0?1/kh:1/0,Hh=2*Math.sqrt(2-2*kh),ud=kh<Zg&&al&&cl,sd=eh.x*fh.y-eh.y*fh.x>0;if(ud&&Ch>yi){const gd=sa.dist(al);if(gd>2*kn){const Pd=sa.sub(sa.sub(al)._mult(kn/gd)._round());this.updateDistance(al,Pd),this.addCurrentVertex(Pd,eh,0,0,So),al=Pd}}const Cd=al&&cl;let jd=Cd?w:ut?"butt":T;if(Cd&&jd==="round"&&(jh<Y?jd="miter":jh<=2&&(jd="fakeround")),jd==="miter"&&jh>F&&(jd="bevel"),jd==="bevel"&&(jh>2&&(jd="flipbevel"),jh<F&&(jd="miter")),al&&this.updateDistance(al,sa),jd==="miter")Gh._mult(jh),this.addCurrentVertex(sa,Gh,0,0,So);else if(jd==="flipbevel"){if(jh>100)Gh=fh.mult(-1);else{const gd=jh*eh.add(fh).mag()/eh.sub(fh).mag();Gh._perp()._mult(gd*(sd?-1:1))}this.addCurrentVertex(sa,Gh,0,0,So),this.addCurrentVertex(sa,Gh.mult(-1),0,0,So)}else if(jd==="bevel"||jd==="fakeround"){const gd=-Math.sqrt(jh*jh-1),Pd=sd?gd:0,Dd=sd?0:gd;if(al&&this.addCurrentVertex(sa,eh,Pd,Dd,So),jd==="fakeround"){const Gd=Math.round(180*Hh/Math.PI/20);for(let Zd=1;Zd<Gd;Zd++){let yd=Zd/Gd;if(yd!==.5){const Lp=yd-.5;yd+=yd*Lp*(yd-1)*((1.0904+Eh*(Eh*(3.55645-1.43519*Eh)-3.2452))*Lp*Lp+(.848013+Eh*(.215638*Eh-1.06021)))}const dp=fh.sub(eh)._mult(yd)._add(eh)._unit()._mult(sd?-1:1);this.addHalfVertex(sa,dp.x,dp.y,!1,sd,0,So)}}cl&&this.addCurrentVertex(sa,fh,-Pd,-Dd,So)}else if(jd==="butt")this.addCurrentVertex(sa,Gh,0,0,So);else if(jd==="square"){const gd=al?1:-1;al||this.addCurrentVertex(sa,Gh,gd,gd,So),this.addCurrentVertex(sa,Gh,0,0,So),al&&this.addCurrentVertex(sa,Gh,gd,gd,So)}else jd==="round"&&(al&&(this.addCurrentVertex(sa,eh,0,0,So),this.addCurrentVertex(sa,eh,1,1,So,!0)),cl&&(this.addCurrentVertex(sa,fh,-1,-1,So,!0),this.addCurrentVertex(sa,fh,0,0,So)));if(ud&&Ch<di-1){const gd=sa.dist(cl);if(gd>2*kn){const Pd=sa.add(cl.sub(sa)._mult(kn/gd)._round());this.updateDistance(sa,Pd),this.addCurrentVertex(Pd,fh,0,0,So),sa=Pd}}}}addCurrentVertex(c,h,w,T,F,Y=!1){const ut=h.y*T-h.x,di=-h.y-h.x*T;this.addHalfVertex(c,h.x+h.y*w,h.y-h.x*w,Y,!1,w,F),this.addHalfVertex(c,ut,di,Y,!0,-T,F)}addHalfVertex({x:c,y:h},w,T,F,Y,ut,di){this.layoutVertexArray.emplaceBack((c<<1)+(F?1:0),(h<<1)+(Y?1:0),Math.round(63*w)+128,Math.round(63*T)+128,1+(ut===0?0:ut<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const yi=di.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,yi),di.primitiveLength++),Y?this.e2=yi:this.e1=yi}updateScaledDistance(){if(this.lineClips){const c=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=c*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(c,h){this.distance+=c.dist(h),this.updateScaledDistance()}}vs(cm,"LineBucket",{omit:["layers","patternFeatures"]});const oy=new Sh({"line-cap":new mh(hd.layout_line["line-cap"]),"line-join":new mh(hd.layout_line["line-join"]),"line-miter-limit":new _l(hd.layout_line["line-miter-limit"]),"line-round-limit":new _l(hd.layout_line["line-round-limit"]),"line-sort-key":new mh(hd.layout_line["line-sort-key"])});var Hm={paint:new Sh({"line-opacity":new mh(hd.paint_line["line-opacity"]),"line-color":new mh(hd.paint_line["line-color"]),"line-translate":new _l(hd.paint_line["line-translate"]),"line-translate-anchor":new _l(hd.paint_line["line-translate-anchor"]),"line-width":new mh(hd.paint_line["line-width"]),"line-gap-width":new mh(hd.paint_line["line-gap-width"]),"line-offset":new mh(hd.paint_line["line-offset"]),"line-blur":new mh(hd.paint_line["line-blur"]),"line-dasharray":new mh(hd.paint_line["line-dasharray"]),"line-pattern":new mh(hd.paint_line["line-pattern"]),"line-gradient":new wh(hd.paint_line["line-gradient"]),"line-trim-offset":new _l(hd.paint_line["line-trim-offset"])}),layout:oy};const ym=new class extends mh{possiblyEvaluate(u,c){return c=new Gn(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,transition:c.transition}),super.possiblyEvaluate(u,c)}evaluate(u,c,h,w){return c=wd({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(u,c,h,w)}}(Hm.paint.properties["line-width"].specification);function Rm(u,c){return c>0?c+2*u:u}ym.useIntegerZoom=!0;const Qm=Zh([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),h_=Zh([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),D_=Zh([{name:"a_projected_pos",components:4,type:"Float32"}],4);Zh([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Cm=Zh([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),e_=Zh([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Zh([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const t_=Zh([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),C_=Zh([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Zh([{name:"triangle",components:3,type:"Uint16"}]),Zh([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Zh([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Zh([{type:"Float32",name:"offsetX"}]),Zh([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Ig=24;const im=128;function Qg(u,c){const{expression:h}=c;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new Gn(u+1))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:w,interpolationType:T}=h;let F=0;for(;F<w.length&&w[F]<=u;)F++;F=Math.max(0,F-1);let Y=F;for(;Y<w.length&&w[Y]<u+1;)Y++;Y=Math.min(w.length-1,Y);const ut=w[F],di=w[Y];return h.kind==="composite"?{kind:"composite",minZoom:ut,maxZoom:di,interpolationType:T}:{kind:"camera",minZoom:ut,maxZoom:di,minSize:h.evaluate(new Gn(ut)),maxSize:h.evaluate(new Gn(di)),interpolationType:T}}}function Im(u,{uSize:c,uSizeT:h},{lowerSize:w,upperSize:T}){return u.kind==="source"?w/im:u.kind==="composite"?Hp(w/im,T/im,h):c}function tg(u,c){let h=0,w=0;if(u.kind==="constant")w=u.layoutSize;else if(u.kind!=="source"){const{interpolationType:T,minZoom:F,maxZoom:Y}=u,ut=T?td(Zm.interpolationFactor(T,c,F,Y),0,1):0;u.kind==="camera"?w=Hp(u.minSize,u.maxSize,ut):h=ut}return{uSizeT:h,uSize:w}}var $_=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:im,evaluateSizeForFeature:Im,evaluateSizeForZoom:tg,getSizeData:Qg});function i_(u,c,h){return u.sections.forEach(w=>{w.text=function(T,F,Y){const ut=F.layout.get("text-transform").evaluate(Y,{});return ut==="uppercase"?T=T.toLocaleUpperCase():ut==="lowercase"&&(T=T.toLocaleLowerCase()),or.applyArabicShaping&&(T=or.applyArabicShaping(T)),T}(w.text,c,h)}),u}const Mm={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Dy(u){return u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""}function _v(u){return u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""}var Ly=sg,r0=function(u,c,h,w,T){var F,Y,ut=8*T-w-1,di=(1<<ut)-1,yi=di>>1,kn=-7,So=h?T-1:0,sa=h?-1:1,al=u[c+So];for(So+=sa,F=al&(1<<-kn)-1,al>>=-kn,kn+=ut;kn>0;F=256*F+u[c+So],So+=sa,kn-=8);for(Y=F&(1<<-kn)-1,F>>=-kn,kn+=w;kn>0;Y=256*Y+u[c+So],So+=sa,kn-=8);if(F===0)F=1-yi;else{if(F===di)return Y?NaN:1/0*(al?-1:1);Y+=Math.pow(2,w),F-=yi}return(al?-1:1)*Y*Math.pow(2,F-w)},sy=function(u,c,h,w,T,F){var Y,ut,di,yi=8*F-T-1,kn=(1<<yi)-1,So=kn>>1,sa=T===23?Math.pow(2,-24)-Math.pow(2,-77):0,al=w?0:F-1,cl=w?1:-1,eh=c<0||c===0&&1/c<0?1:0;for(c=Math.abs(c),isNaN(c)||c===1/0?(ut=isNaN(c)?1:0,Y=kn):(Y=Math.floor(Math.log(c)/Math.LN2),c*(di=Math.pow(2,-Y))<1&&(Y--,di*=2),(c+=Y+So>=1?sa/di:sa*Math.pow(2,1-So))*di>=2&&(Y++,di/=2),Y+So>=kn?(ut=0,Y=kn):Y+So>=1?(ut=(c*di-1)*Math.pow(2,T),Y+=So):(ut=c*Math.pow(2,So-1)*Math.pow(2,T),Y=0));T>=8;u[h+al]=255&ut,al+=cl,ut/=256,T-=8);for(Y=Y<<T|ut,yi+=T;yi>0;u[h+al]=255&Y,al+=cl,Y/=256,yi-=8);u[h+al-cl]|=128*eh};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function sg(u){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(u)?u:new Uint8Array(u||0),this.pos=0,this.type=0,this.length=this.buf.length}sg.Varint=0,sg.Fixed64=1,sg.Bytes=2,sg.Fixed32=5;var d_=4294967296,n0=1/d_,uw=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function o0(u){return u.type===sg.Bytes?u.readVarint()+u.pos:u.pos+1}function fx(u,c,h){return h?4294967296*c+(u>>>0):4294967296*(c>>>0)+(u>>>0)}function P1(u,c,h){var w=c<=16383?1:c<=2097151?2:c<=268435455?3:Math.floor(Math.log(c)/(7*Math.LN2));h.realloc(w);for(var T=h.pos-1;T>=u;T--)h.buf[T+w]=h.buf[T]}function O0(u,c){for(var h=0;h<u.length;h++)c.writeVarint(u[h])}function RC(u,c){for(var h=0;h<u.length;h++)c.writeSVarint(u[h])}function Ab(u,c){for(var h=0;h<u.length;h++)c.writeFloat(u[h])}function Rb(u,c){for(var h=0;h<u.length;h++)c.writeDouble(u[h])}function IC(u,c){for(var h=0;h<u.length;h++)c.writeBoolean(u[h])}function pE(u,c){for(var h=0;h<u.length;h++)c.writeFixed32(u[h])}function fE(u,c){for(var h=0;h<u.length;h++)c.writeSFixed32(u[h])}function gE(u,c){for(var h=0;h<u.length;h++)c.writeFixed64(u[h])}function mE(u,c){for(var h=0;h<u.length;h++)c.writeSFixed64(u[h])}function D1(u,c){return(u[c]|u[c+1]<<8|u[c+2]<<16)+16777216*u[c+3]}function hw(u,c,h){u[h]=c,u[h+1]=c>>>8,u[h+2]=c>>>16,u[h+3]=c>>>24}function MC(u,c){return(u[c]|u[c+1]<<8|u[c+2]<<16)+(u[c+3]<<24)}sg.prototype={destroy:function(){this.buf=null},readFields:function(u,c,h){for(h=h||this.length;this.pos<h;){var w=this.readVarint(),T=w>>3,F=this.pos;this.type=7&w,u(T,c,this),this.pos===F&&this.skip(w)}return c},readMessage:function(u,c){return this.readFields(u,c,this.readVarint()+this.pos)},readFixed32:function(){var u=D1(this.buf,this.pos);return this.pos+=4,u},readSFixed32:function(){var u=MC(this.buf,this.pos);return this.pos+=4,u},readFixed64:function(){var u=D1(this.buf,this.pos)+D1(this.buf,this.pos+4)*d_;return this.pos+=8,u},readSFixed64:function(){var u=D1(this.buf,this.pos)+MC(this.buf,this.pos+4)*d_;return this.pos+=8,u},readFloat:function(){var u=r0(this.buf,this.pos,!0,23,4);return this.pos+=4,u},readDouble:function(){var u=r0(this.buf,this.pos,!0,52,8);return this.pos+=8,u},readVarint:function(u){var c,h,w=this.buf;return c=127&(h=w[this.pos++]),h<128?c:(c|=(127&(h=w[this.pos++]))<<7,h<128?c:(c|=(127&(h=w[this.pos++]))<<14,h<128?c:(c|=(127&(h=w[this.pos++]))<<21,h<128?c:function(T,F,Y){var ut,di,yi=Y.buf;if(ut=(112&(di=yi[Y.pos++]))>>4,di<128||(ut|=(127&(di=yi[Y.pos++]))<<3,di<128)||(ut|=(127&(di=yi[Y.pos++]))<<10,di<128)||(ut|=(127&(di=yi[Y.pos++]))<<17,di<128)||(ut|=(127&(di=yi[Y.pos++]))<<24,di<128)||(ut|=(1&(di=yi[Y.pos++]))<<31,di<128))return fx(T,ut,F);throw new Error("Expected varint not more than 10 bytes")}(c|=(15&(h=w[this.pos]))<<28,u,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var u=this.readVarint();return u%2==1?(u+1)/-2:u/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var u=this.readVarint()+this.pos,c=this.pos;return this.pos=u,u-c>=12&&uw?function(h,w,T){return uw.decode(h.subarray(w,T))}(this.buf,c,u):function(h,w,T){for(var F="",Y=w;Y<T;){var ut,di,yi,kn=h[Y],So=null,sa=kn>239?4:kn>223?3:kn>191?2:1;if(Y+sa>T)break;sa===1?kn<128&&(So=kn):sa===2?(192&(ut=h[Y+1]))==128&&(So=(31&kn)<<6|63&ut)<=127&&(So=null):sa===3?(di=h[Y+2],(192&(ut=h[Y+1]))==128&&(192&di)==128&&((So=(15&kn)<<12|(63&ut)<<6|63&di)<=2047||So>=55296&&So<=57343)&&(So=null)):sa===4&&(di=h[Y+2],yi=h[Y+3],(192&(ut=h[Y+1]))==128&&(192&di)==128&&(192&yi)==128&&((So=(15&kn)<<18|(63&ut)<<12|(63&di)<<6|63&yi)<=65535||So>=1114112)&&(So=null)),So===null?(So=65533,sa=1):So>65535&&(So-=65536,F+=String.fromCharCode(So>>>10&1023|55296),So=56320|1023&So),F+=String.fromCharCode(So),Y+=sa}return F}(this.buf,c,u)},readBytes:function(){var u=this.readVarint()+this.pos,c=this.buf.subarray(this.pos,u);return this.pos=u,c},readPackedVarint:function(u,c){if(this.type!==sg.Bytes)return u.push(this.readVarint(c));var h=o0(this);for(u=u||[];this.pos<h;)u.push(this.readVarint(c));return u},readPackedSVarint:function(u){if(this.type!==sg.Bytes)return u.push(this.readSVarint());var c=o0(this);for(u=u||[];this.pos<c;)u.push(this.readSVarint());return u},readPackedBoolean:function(u){if(this.type!==sg.Bytes)return u.push(this.readBoolean());var c=o0(this);for(u=u||[];this.pos<c;)u.push(this.readBoolean());return u},readPackedFloat:function(u){if(this.type!==sg.Bytes)return u.push(this.readFloat());var c=o0(this);for(u=u||[];this.pos<c;)u.push(this.readFloat());return u},readPackedDouble:function(u){if(this.type!==sg.Bytes)return u.push(this.readDouble());var c=o0(this);for(u=u||[];this.pos<c;)u.push(this.readDouble());return u},readPackedFixed32:function(u){if(this.type!==sg.Bytes)return u.push(this.readFixed32());var c=o0(this);for(u=u||[];this.pos<c;)u.push(this.readFixed32());return u},readPackedSFixed32:function(u){if(this.type!==sg.Bytes)return u.push(this.readSFixed32());var c=o0(this);for(u=u||[];this.pos<c;)u.push(this.readSFixed32());return u},readPackedFixed64:function(u){if(this.type!==sg.Bytes)return u.push(this.readFixed64());var c=o0(this);for(u=u||[];this.pos<c;)u.push(this.readFixed64());return u},readPackedSFixed64:function(u){if(this.type!==sg.Bytes)return u.push(this.readSFixed64());var c=o0(this);for(u=u||[];this.pos<c;)u.push(this.readSFixed64());return u},skip:function(u){var c=7&u;if(c===sg.Varint)for(;this.buf[this.pos++]>127;);else if(c===sg.Bytes)this.pos=this.readVarint()+this.pos;else if(c===sg.Fixed32)this.pos+=4;else{if(c!==sg.Fixed64)throw new Error("Unimplemented type: "+c);this.pos+=8}},writeTag:function(u,c){this.writeVarint(u<<3|c)},realloc:function(u){for(var c=this.length||16;c<this.pos+u;)c*=2;if(c!==this.length){var h=new Uint8Array(c);h.set(this.buf),this.buf=h,this.length=c}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(u){this.realloc(4),hw(this.buf,u,this.pos),this.pos+=4},writeSFixed32:function(u){this.realloc(4),hw(this.buf,u,this.pos),this.pos+=4},writeFixed64:function(u){this.realloc(8),hw(this.buf,-1&u,this.pos),hw(this.buf,Math.floor(u*n0),this.pos+4),this.pos+=8},writeSFixed64:function(u){this.realloc(8),hw(this.buf,-1&u,this.pos),hw(this.buf,Math.floor(u*n0),this.pos+4),this.pos+=8},writeVarint:function(u){(u=+u||0)>268435455||u<0?function(c,h){var w,T;if(c>=0?(w=c%4294967296|0,T=c/4294967296|0):(T=~(-c/4294967296),4294967295^(w=~(-c%4294967296))?w=w+1|0:(w=0,T=T+1|0)),c>=18446744073709552e3||c<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),function(F,Y,ut){ut.buf[ut.pos++]=127&F|128,F>>>=7,ut.buf[ut.pos++]=127&F|128,F>>>=7,ut.buf[ut.pos++]=127&F|128,F>>>=7,ut.buf[ut.pos++]=127&F|128,ut.buf[ut.pos]=127&(F>>>=7)}(w,0,h),function(F,Y){var ut=(7&F)<<4;Y.buf[Y.pos++]|=ut|((F>>>=3)?128:0),F&&(Y.buf[Y.pos++]=127&F|((F>>>=7)?128:0),F&&(Y.buf[Y.pos++]=127&F|((F>>>=7)?128:0),F&&(Y.buf[Y.pos++]=127&F|((F>>>=7)?128:0),F&&(Y.buf[Y.pos++]=127&F|((F>>>=7)?128:0),F&&(Y.buf[Y.pos++]=127&F)))))}(T,h)}(u,this):(this.realloc(4),this.buf[this.pos++]=127&u|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=u>>>7&127))))},writeSVarint:function(u){this.writeVarint(u<0?2*-u-1:2*u)},writeBoolean:function(u){this.writeVarint(!!u)},writeString:function(u){u=String(u),this.realloc(4*u.length),this.pos++;var c=this.pos;this.pos=function(w,T,F){for(var Y,ut,di=0;di<T.length;di++){if((Y=T.charCodeAt(di))>55295&&Y<57344){if(!ut){Y>56319||di+1===T.length?(w[F++]=239,w[F++]=191,w[F++]=189):ut=Y;continue}if(Y<56320){w[F++]=239,w[F++]=191,w[F++]=189,ut=Y;continue}Y=ut-55296<<10|Y-56320|65536,ut=null}else ut&&(w[F++]=239,w[F++]=191,w[F++]=189,ut=null);Y<128?w[F++]=Y:(Y<2048?w[F++]=Y>>6|192:(Y<65536?w[F++]=Y>>12|224:(w[F++]=Y>>18|240,w[F++]=Y>>12&63|128),w[F++]=Y>>6&63|128),w[F++]=63&Y|128)}return F}(this.buf,u,this.pos);var h=this.pos-c;h>=128&&P1(c,h,this),this.pos=c-1,this.writeVarint(h),this.pos+=h},writeFloat:function(u){this.realloc(4),sy(this.buf,u,this.pos,!0,23,4),this.pos+=4},writeDouble:function(u){this.realloc(8),sy(this.buf,u,this.pos,!0,52,8),this.pos+=8},writeBytes:function(u){var c=u.length;this.writeVarint(c),this.realloc(c);for(var h=0;h<c;h++)this.buf[this.pos++]=u[h]},writeRawMessage:function(u,c){this.pos++;var h=this.pos;u(c,this);var w=this.pos-h;w>=128&&P1(h,w,this),this.pos=h-1,this.writeVarint(w),this.pos+=w},writeMessage:function(u,c,h){this.writeTag(u,sg.Bytes),this.writeRawMessage(c,h)},writePackedVarint:function(u,c){c.length&&this.writeMessage(u,O0,c)},writePackedSVarint:function(u,c){c.length&&this.writeMessage(u,RC,c)},writePackedBoolean:function(u,c){c.length&&this.writeMessage(u,IC,c)},writePackedFloat:function(u,c){c.length&&this.writeMessage(u,Ab,c)},writePackedDouble:function(u,c){c.length&&this.writeMessage(u,Rb,c)},writePackedFixed32:function(u,c){c.length&&this.writeMessage(u,pE,c)},writePackedSFixed32:function(u,c){c.length&&this.writeMessage(u,fE,c)},writePackedFixed64:function(u,c){c.length&&this.writeMessage(u,gE,c)},writePackedSFixed64:function(u,c){c.length&&this.writeMessage(u,mE,c)},writeBytesField:function(u,c){this.writeTag(u,sg.Bytes),this.writeBytes(c)},writeFixed32Field:function(u,c){this.writeTag(u,sg.Fixed32),this.writeFixed32(c)},writeSFixed32Field:function(u,c){this.writeTag(u,sg.Fixed32),this.writeSFixed32(c)},writeFixed64Field:function(u,c){this.writeTag(u,sg.Fixed64),this.writeFixed64(c)},writeSFixed64Field:function(u,c){this.writeTag(u,sg.Fixed64),this.writeSFixed64(c)},writeVarintField:function(u,c){this.writeTag(u,sg.Varint),this.writeVarint(c)},writeSVarintField:function(u,c){this.writeTag(u,sg.Varint),this.writeSVarint(c)},writeStringField:function(u,c){this.writeTag(u,sg.Bytes),this.writeString(c)},writeFloatField:function(u,c){this.writeTag(u,sg.Fixed32),this.writeFloat(c)},writeDoubleField:function(u,c){this.writeTag(u,sg.Fixed64),this.writeDouble(c)},writeBooleanField:function(u,c){this.writeVarintField(u,!!c)}};var L1=Wr(Ly);const ay=3;function O1(u,c,h){c.glyphs=[],u===1&&h.readMessage(PC,c)}function PC(u,c,h){if(u===3){const{id:w,bitmap:T,width:F,height:Y,left:ut,top:di,advance:yi}=h.readMessage(L_,{});c.glyphs.push({id:w,bitmap:new t0({width:F+2*ay,height:Y+2*ay},T),metrics:{width:F,height:Y,left:ut,top:di,advance:yi}})}else u===4?c.ascender=h.readSVarint():u===5&&(c.descender=h.readSVarint())}function L_(u,c,h){u===1?c.id=h.readVarint():u===2?c.bitmap=h.readBytes():u===3?c.width=h.readVarint():u===4?c.height=h.readVarint():u===5?c.left=h.readSVarint():u===6?c.top=h.readSVarint():u===7&&(c.advance=h.readVarint())}const yv=ay;function kx(u){let c=0,h=0;for(const Y of u)c+=Y.w*Y.h,h=Math.max(h,Y.w);u.sort((Y,ut)=>ut.h-Y.h);const w=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(c/.95)),h),h:1/0}];let T=0,F=0;for(const Y of u)for(let ut=w.length-1;ut>=0;ut--){const di=w[ut];if(!(Y.w>di.w||Y.h>di.h)){if(Y.x=di.x,Y.y=di.y,F=Math.max(F,Y.y+Y.h),T=Math.max(T,Y.x+Y.w),Y.w===di.w&&Y.h===di.h){const yi=w.pop();ut<w.length&&(w[ut]=yi)}else Y.h===di.h?(di.x+=Y.w,di.w-=Y.w):Y.w===di.w?(di.y+=Y.h,di.h-=Y.h):(w.push({x:di.x+Y.w,y:di.y,w:di.w-Y.w,h:Y.h}),di.y+=Y.h,di.h-=Y.h);break}}return{w:T,h:F,fill:c/(T*F)||0}}const jm=1;class F1{constructor(c,{pixelRatio:h,version:w,stretchX:T,stretchY:F,content:Y}){this.paddedRect=c,this.pixelRatio=h,this.stretchX=T,this.stretchY=F,this.content=Y,this.version=w}get tl(){return[this.paddedRect.x+jm,this.paddedRect.y+jm]}get br(){return[this.paddedRect.x+this.paddedRect.w-jm,this.paddedRect.y+this.paddedRect.h-jm]}get displaySize(){return[(this.paddedRect.w-2*jm)/this.pixelRatio,(this.paddedRect.h-2*jm)/this.pixelRatio]}}class gx{constructor(c,h){const w={},T={};this.haveRenderCallbacks=[];const F=[];this.addImages(c,w,F),this.addImages(h,T,F);const{w:Y,h:ut}=kx(F),di=new P_({width:Y||1,height:ut||1});for(const yi in c){const kn=c[yi],So=w[yi].paddedRect;P_.copy(kn.data,di,{x:0,y:0},{x:So.x+jm,y:So.y+jm},kn.data)}for(const yi in h){const kn=h[yi],So=T[yi].paddedRect,sa=So.x+jm,al=So.y+jm,cl=kn.data.width,eh=kn.data.height;P_.copy(kn.data,di,{x:0,y:0},{x:sa,y:al},kn.data),P_.copy(kn.data,di,{x:0,y:eh-1},{x:sa,y:al-1},{width:cl,height:1}),P_.copy(kn.data,di,{x:0,y:0},{x:sa,y:al+eh},{width:cl,height:1}),P_.copy(kn.data,di,{x:cl-1,y:0},{x:sa-1,y:al},{width:1,height:eh}),P_.copy(kn.data,di,{x:0,y:0},{x:sa+cl,y:al},{width:1,height:eh})}this.image=di,this.iconPositions=w,this.patternPositions=T}addImages(c,h,w){for(const T in c){const F=c[T],Y={x:0,y:0,w:F.data.width+2*jm,h:F.data.height+2*jm};w.push(Y),h[T]=new F1(Y,F),F.hasRenderCallback&&this.haveRenderCallbacks.push(T)}}patchUpdatedImages(c,h){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(w=>c.hasImage(w)),c.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const w in c.updatedImages)this.patchUpdatedImage(this.iconPositions[w],c.getImage(w),h),this.patchUpdatedImage(this.patternPositions[w],c.getImage(w),h)}patchUpdatedImage(c,h,w){if(!c||!h||c.version===h.version)return;c.version=h.version;const[T,F]=c.tl;w.update(h.data,void 0,{x:T,y:F})}}vs(F1,"ImagePosition"),vs(gx,"ImageAtlas");const vv={horizontal:1,vertical:2,horizontalOnly:3},jE=-17;class Ib{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(c,h){const w=new Ib;return w.scale=c||1,w.fontStack=h,w}static forImage(c){const h=new Ib;return h.imageName=c,h}}class N1{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(c,h){const w=new N1;for(let T=0;T<c.sections.length;T++){const F=c.sections[T];F.image?w.addImageSection(F):w.addTextSection(F,h)}return w}length(){return this.text.length}getSection(c){return this.sections[this.sectionIndex[c]]}getSections(){return this.sections}getSectionIndex(c){return this.sectionIndex[c]}getCharCode(c){return this.text.charCodeAt(c)}verticalizePunctuation(c){this.text=function(h,w){let T="";for(let F=0;F<h.length;F++){const Y=h.charCodeAt(F+1)||null,ut=h.charCodeAt(F-1)||null;T+=!w&&(Y&&Lh(Y)&&!Mm[h[F+1]]||ut&&Lh(ut)&&!Mm[h[F-1]])||!Mm[h[F]]?h[F]:Mm[h[F]]}return T}(this.text,c)}trim(){let c=0;for(let w=0;w<this.text.length&&DC[this.text.charCodeAt(w)];w++)c++;let h=this.text.length;for(let w=this.text.length-1;w>=0&&w>=c&&DC[this.text.charCodeAt(w)];w--)h--;this.text=this.text.substring(c,h),this.sectionIndex=this.sectionIndex.slice(c,h)}substring(c,h){const w=new N1;return w.text=this.text.substring(c,h),w.sectionIndex=this.sectionIndex.slice(c,h),w.sections=this.sections,w}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((c,h)=>Math.max(c,this.sections[h].scale),0)}addTextSection(c,h){this.text+=c.text,this.sections.push(Ib.forText(c.scale,c.fontStack||h));const w=this.sections.length-1;for(let T=0;T<c.text.length;++T)this.sectionIndex.push(w)}addImageSection(c){const h=c.image?c.image.name:"";if(h.length===0)return void Ad("Can't add FormattedSection with an empty image.");const w=this.getNextImageSectionCharCode();w?(this.text+=String.fromCharCode(w),this.sections.push(Ib.forImage(h)),this.sectionIndex.push(this.sections.length-1)):Ad("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function _E(u,c,h,w,T,F,Y,ut,di,yi,kn,So,sa,al,cl){const eh=N1.fromFeature(u,T);So===vv.vertical&&eh.verticalizePunctuation(sa);let fh=[];const Ch=function(Hh,ud,sd,Cd,jd,gd){if(!Hh)return[];const Pd=[],Dd=function(dp,Lp,mp,Zf,Qd,qp){let Xf=0;for(let vg=0;vg<dp.length();vg++){const Yf=dp.getSection(vg);Xf+=WE(dp.getCharCode(vg),Yf,Zf,Qd,Lp,qp)}return Xf/Math.max(1,Math.ceil(Xf/mp))}(Hh,ud,sd,Cd,jd,gd),Gd=Hh.text.indexOf("")>=0;let Zd=0;for(let dp=0;dp<Hh.length();dp++){const Lp=Hh.getSection(dp),mp=Hh.getCharCode(dp);if(DC[mp]||(Zd+=WE(mp,Lp,Cd,jd,ud,gd)),dp<Hh.length()-1){const Zf=!((yd=mp)<11904||!(hh["Bopomofo Extended"](yd)||hh.Bopomofo(yd)||hh["CJK Compatibility Forms"](yd)||hh["CJK Compatibility Ideographs"](yd)||hh["CJK Compatibility"](yd)||hh["CJK Radicals Supplement"](yd)||hh["CJK Strokes"](yd)||hh["CJK Symbols and Punctuation"](yd)||hh["CJK Unified Ideographs Extension A"](yd)||hh["CJK Unified Ideographs"](yd)||hh["Enclosed CJK Letters and Months"](yd)||hh["Halfwidth and Fullwidth Forms"](yd)||hh.Hiragana(yd)||hh["Ideographic Description Characters"](yd)||hh["Kangxi Radicals"](yd)||hh["Katakana Phonetic Extensions"](yd)||hh.Katakana(yd)||hh["Vertical Forms"](yd)||hh["Yi Radicals"](yd)||hh["Yi Syllables"](yd)));(iT[mp]||Zf||Lp.imageName)&&Pd.push(KE(dp+1,Zd,Dd,Pd,rT(mp,Hh.getCharCode(dp+1),Zf&&Gd),!1))}}var yd;return ZE(KE(Hh.length(),Zd,Dd,Pd,0,!0))}(eh,yi,F,c,w,al),{processBidirectionalText:Gh,processStyledBidirectionalText:Eh}=or;if(Gh&&eh.sections.length===1){const Hh=Gh(eh.toString(),Ch);for(const ud of Hh){const sd=new N1;sd.text=ud,sd.sections=eh.sections;for(let Cd=0;Cd<ud.length;Cd++)sd.sectionIndex.push(0);fh.push(sd)}}else if(Eh){const Hh=Eh(eh.text,eh.sectionIndex,Ch);for(const ud of Hh){const sd=new N1;sd.text=ud[0],sd.sectionIndex=ud[1],sd.sections=eh.sections,fh.push(sd)}}else fh=function(Hh,ud){const sd=[],Cd=Hh.text;let jd=0;for(const gd of ud)sd.push(Hh.substring(jd,gd)),jd=gd;return jd<Cd.length&&sd.push(Hh.substring(jd,Cd.length)),sd}(eh,Ch);const kh=[],jh={positionedLines:kh,text:eh.toString(),top:kn[1],bottom:kn[1],left:kn[0],right:kn[0],writingMode:So,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Hh,ud,sd,Cd,jd,gd,Pd,Dd,Gd,Zd,yd,dp){let Lp=0,mp=0,Zf=0;const Qd=Dd==="right"?1:Dd==="left"?0:.5;let qp=!1;for(const Qf of jd){const eg=Qf.getSections();for(const Fg of eg){if(Fg.imageName)continue;const $g=ud[Fg.fontStack];if($g&&(qp=$g.ascender!==void 0&&$g.descender!==void 0,!qp))break}if(!qp)break}let Xf=0;for(const Qf of jd){Qf.trim();const eg=Qf.getMaxScale(),Fg=(eg-1)*Ig,$g={positionedGlyphs:[],lineOffset:0};Hh.positionedLines[Xf]=$g;const Hg=$g.positionedGlyphs;let Ng=0;if(!Qf.length()){mp+=gd,++Xf;continue}let rm=0,vm=0;for(let kg=0;kg<Qf.length();kg++){const zm=Qf.getSection(kg),Dm=Qf.getSectionIndex(kg),um=Qf.getCharCode(kg);let wg=zm.scale,Lm=null,jg=null,H_=null,Om=Ig,p_=0;const r_=!(Gd===vv.horizontal||!yd&&!ad(um)||yd&&(DC[um]||(vg=um,hh.Arabic(vg)||hh["Arabic Supplement"](vg)||hh["Arabic Extended-A"](vg)||hh["Arabic Presentation Forms-A"](vg)||hh["Arabic Presentation Forms-B"](vg))));if(zm.imageName){const j_=Cd[zm.imageName];if(!j_)continue;H_=zm.imageName,Hh.iconsInText=Hh.iconsInText||!0,jg=j_.paddedRect;const n_=j_.displaySize;wg=wg*Ig/dp,Lm={width:n_[0],height:n_[1],left:jm,top:-yv,advance:r_?n_[1]:n_[0],localGlyph:!1},p_=qp?-Lm.height*wg:jE+eg*Ig-n_[1]*wg,Om=Lm.advance;const k0=(r_?n_[0]:n_[1])*wg-Ig*eg;k0>0&&k0>Ng&&(Ng=k0)}else{const j_=sd[zm.fontStack];if(!j_)continue;j_[um]&&(jg=j_[um]);const n_=ud[zm.fontStack];if(!n_)continue;const k0=n_.glyphs[um];if(!k0)continue;if(Lm=k0.metrics,Om=um!==8203?Ig:0,qp){const $1=n_.ascender!==void 0?Math.abs(n_.ascender):0,Gb=n_.descender!==void 0?Math.abs(n_.descender):0,zb=($1+Gb)*wg;rm<zb&&(rm=zb,vm=($1-Gb)/2*wg),p_=-$1*wg}else p_=jE+(eg-wg)*Ig}r_?(Hh.verticalizable=!0,Hg.push({glyph:um,imageName:H_,x:Lp,y:mp+p_,vertical:r_,scale:wg,localGlyph:Lm.localGlyph,fontStack:zm.fontStack,sectionIndex:Dm,metrics:Lm,rect:jg}),Lp+=Om*wg+Zd):(Hg.push({glyph:um,imageName:H_,x:Lp,y:mp+p_,vertical:r_,scale:wg,localGlyph:Lm.localGlyph,fontStack:zm.fontStack,sectionIndex:Dm,metrics:Lm,rect:jg}),Lp+=Lm.advance*wg+Zd)}Hg.length!==0&&(Zf=Math.max(Lp-Zd,Zf),qp?XE(Hg,Qd,Ng,vm,gd*eg/2):XE(Hg,Qd,Ng,0,gd/2)),Lp=0;const Pm=gd*eg+Ng;$g.lineOffset=Math.max(Ng,Fg),mp+=Pm,++Xf}var vg;const Yf=mp,{horizontalAlign:Gf,verticalAlign:qg}=yE(Pd);(function(Qf,eg,Fg,$g,Hg,Ng){const rm=(eg-Fg)*Hg,vm=-Ng*$g;for(const Pm of Qf)for(const kg of Pm.positionedGlyphs)kg.x+=rm,kg.y+=vm})(Hh.positionedLines,Qd,Gf,qg,Zf,Yf),Hh.top+=-qg*Yf,Hh.bottom=Hh.top+Yf,Hh.left+=-Gf*Zf,Hh.right=Hh.left+Zf,Hh.hasBaseline=qp}(jh,c,h,w,fh,Y,ut,di,So,yi,sa,cl),!function(Hh){for(const ud of Hh)if(ud.positionedGlyphs.length!==0)return!1;return!0}(kh)&&jh}const DC={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},iT={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function WE(u,c,h,w,T,F){if(c.imageName){const Y=w[c.imageName];return Y?Y.displaySize[0]*c.scale*Ig/F+T:0}{const Y=h[c.fontStack],ut=Y&&Y.glyphs[u];return ut?ut.metrics.advance*c.scale+T:0}}function qE(u,c,h,w){const T=Math.pow(u-c,2);return w?u<c?T/2:2*T:T+Math.abs(h)*h}function rT(u,c,h){let w=0;return u===10&&(w-=1e4),h&&(w+=150),u!==40&&u!==65288||(w+=50),c!==41&&c!==65289||(w+=50),w}function KE(u,c,h,w,T,F){let Y=null,ut=qE(c,h,T,F);for(const di of w){const yi=qE(c-di.x,h,T,F)+di.badness;yi<=ut&&(Y=di,ut=yi)}return{index:u,x:c,priorBreak:Y,badness:ut}}function ZE(u){return u?ZE(u.priorBreak).concat(u.index):[]}function yE(u){let c=.5,h=.5;switch(u){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:c,verticalAlign:h}}function XE(u,c,h,w,T){if(!(c||h||w||T))return;const F=u.length-1,Y=u[F],ut=(Y.x+Y.metrics.advance*Y.scale)*c;for(let di=0;di<=F;di++)u[di].x-=ut,u[di].y+=h+w+T}function nT(u,c,h){const{horizontalAlign:w,verticalAlign:T}=yE(h),F=c[0]-u.displaySize[0]*w,Y=c[1]-u.displaySize[1]*T;return{image:u,top:Y,bottom:Y+u.displaySize[1],left:F,right:F+u.displaySize[0]}}function YE(u,c,h,w,T,F){const Y=u.image;let ut;if(Y.content){const fh=Y.content,Ch=Y.pixelRatio||1;ut=[fh[0]/Ch,fh[1]/Ch,Y.displaySize[0]-fh[2]/Ch,Y.displaySize[1]-fh[3]/Ch]}const di=c.left*F,yi=c.right*F;let kn,So,sa,al;h==="width"||h==="both"?(al=T[0]+di-w[3],So=T[0]+yi+w[1]):(al=T[0]+(di+yi-Y.displaySize[0])/2,So=al+Y.displaySize[0]);const cl=c.top*F,eh=c.bottom*F;return h==="height"||h==="both"?(kn=T[1]+cl-w[0],sa=T[1]+eh+w[2]):(kn=T[1]+(cl+eh-Y.displaySize[1])/2,sa=kn+Y.displaySize[1]),{image:Y,top:kn,right:So,bottom:sa,left:al,collisionPadding:ut}}class Bx extends ll{constructor(c,h,w,T,F){super(c,h),this.angle=T,this.z=w,F!==void 0&&(this.segment=F)}clone(){return new Bx(this.x,this.y,this.z,this.angle,this.segment)}}function JE(u,c,h,w,T){if(c.segment===void 0)return!0;let F=c,Y=c.segment+1,ut=0;for(;ut>-h/2;){if(Y--,Y<0)return!1;ut-=u[Y].dist(F),F=u[Y]}ut+=u[Y].dist(u[Y+1]),Y++;const di=[];let yi=0;for(;ut<h/2;){const kn=u[Y],So=u[Y+1];if(!So)return!1;let sa=u[Y-1].angleTo(kn)-kn.angleTo(So);for(sa=Math.abs((sa+3*Math.PI)%(2*Math.PI)-Math.PI),di.push({distance:ut,angleDelta:sa}),yi+=sa;ut-di[0].distance>w;)yi-=di.shift().angleDelta;if(yi>T)return!1;Y++,ut+=kn.dist(So)}return!0}function QE(u){let c=0;for(let h=0;h<u.length-1;h++)c+=u[h].dist(u[h+1]);return c}function eS(u,c,h){return u?.6*c*h:0}function tS(u,c){return Math.max(u?u.right-u.left:0,c?c.right-c.left:0)}function oT(u,c,h,w,T,F){const Y=eS(h,T,F),ut=tS(h,w)*F;let di=0;const yi=QE(u)/2;for(let kn=0;kn<u.length-1;kn++){const So=u[kn],sa=u[kn+1],al=So.dist(sa);if(di+al>yi){const cl=(yi-di)/al,eh=Hp(So.x,sa.x,cl),fh=Hp(So.y,sa.y,cl),Ch=new Bx(eh,fh,0,sa.angleTo(So),kn);return!Y||JE(u,Ch,ut,Y,c)?Ch:void 0}di+=al}}function sT(u,c,h,w,T,F,Y,ut,di){const yi=eS(w,F,Y),kn=tS(w,T),So=kn*Y,sa=u[0].x===0||u[0].x===di||u[0].y===0||u[0].y===di;return c-So<c/4&&(c=So+c/4),iS(u,sa?c/2*ut%c:(kn/2+2*F)*Y*ut%c,c,yi,h,So,sa,!1,di)}function iS(u,c,h,w,T,F,Y,ut,di){const yi=F/2,kn=QE(u);let So=0,sa=c-h,al=[];for(let cl=0;cl<u.length-1;cl++){const eh=u[cl],fh=u[cl+1],Ch=eh.dist(fh),Gh=fh.angleTo(eh);for(;sa+h<So+Ch;){sa+=h;const Eh=(sa-So)/Ch,kh=Hp(eh.x,fh.x,Eh),jh=Hp(eh.y,fh.y,Eh);if(kh>=0&&kh<di&&jh>=0&&jh<di&&sa-yi>=0&&sa+yi<=kn){const Hh=new Bx(kh,jh,0,Gh,cl);Hh._round(),w&&!JE(u,Hh,F,w,T)||al.push(Hh)}}So+=Ch}return ut||al.length||Y||(al=iS(u,So/2,h,w,T,F,Y,!0,di)),al}function rS(u,c,h,w,T){const F=[];for(let Y=0;Y<u.length;Y++){const ut=u[Y];let di;for(let yi=0;yi<ut.length-1;yi++){let kn=ut[yi],So=ut[yi+1];kn.x<c&&So.x<c||(kn.x<c?kn=new ll(c,kn.y+(c-kn.x)/(So.x-kn.x)*(So.y-kn.y))._round():So.x<c&&(So=new ll(c,kn.y+(c-kn.x)/(So.x-kn.x)*(So.y-kn.y))._round()),kn.y<h&&So.y<h||(kn.y<h?kn=new ll(kn.x+(h-kn.y)/(So.y-kn.y)*(So.x-kn.x),h)._round():So.y<h&&(So=new ll(kn.x+(h-kn.y)/(So.y-kn.y)*(So.x-kn.x),h)._round()),kn.x>=w&&So.x>=w||(kn.x>=w?kn=new ll(w,kn.y+(w-kn.x)/(So.x-kn.x)*(So.y-kn.y))._round():So.x>=w&&(So=new ll(w,kn.y+(w-kn.x)/(So.x-kn.x)*(So.y-kn.y))._round()),kn.y>=T&&So.y>=T||(kn.y>=T?kn=new ll(kn.x+(T-kn.y)/(So.y-kn.y)*(So.x-kn.x),T)._round():So.y>=T&&(So=new ll(kn.x+(T-kn.y)/(So.y-kn.y)*(So.x-kn.x),T)._round()),di&&kn.equals(di[di.length-1])||(di=[kn],F.push(di)),di.push(So)))))}}return F}vs(Bx,"Anchor");const Mb=1e20;function nS(u,c,h,w,T,F,Y,ut,di){for(let yi=c;yi<c+w;yi++)oS(u,h*F+yi,F,T,Y,ut,di);for(let yi=h;yi<h+T;yi++)oS(u,yi*F+c,1,w,Y,ut,di)}function oS(u,c,h,w,T,F,Y){F[0]=0,Y[0]=-Mb,Y[1]=Mb,T[0]=u[c];for(let ut=1,di=0,yi=0;ut<w;ut++){T[ut]=u[c+ut*h];const kn=ut*ut;do{const So=F[di];yi=(T[ut]-T[So]+kn-So*So)/(ut-So)/2}while(yi<=Y[di]&&--di>-1);di++,F[di]=ut,Y[di]=yi,Y[di+1]=Mb}for(let ut=0,di=0;ut<w;ut++){for(;Y[di+1]<ut;)di++;const yi=F[di],kn=ut-yi;u[c+ut*h]=T[yi]+kn*kn}}const F0=2,vE={none:0,ideographs:1,all:2};class k1{constructor(c,h,w){this.requestManager=c,this.localGlyphMode=h,this.localFontFamily=w,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(c){this.url=c}getGlyphs(c,h){const w=[];for(const T in c)for(const F of c[T])w.push({stack:T,id:F});Ud(w,({stack:T,id:F},Y)=>{let ut=this.entries[T];ut||(ut=this.entries[T]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let di=ut.glyphs[F];if(di!==void 0)return void Y(null,{stack:T,id:F,glyph:di});if(di=this._tinySDF(ut,T,F),di)return ut.glyphs[F]=di,void Y(null,{stack:T,id:F,glyph:di});const yi=Math.floor(F/256);if(256*yi>65535)return void Y(new Error("glyphs > 65535 not supported"));if(ut.ranges[yi])return void Y(null,{stack:T,id:F,glyph:di});let kn=ut.requests[yi];kn||(kn=ut.requests[yi]=[],k1.loadGlyphRange(T,yi,this.url,this.requestManager,(So,sa)=>{if(sa){ut.ascender=sa.ascender,ut.descender=sa.descender;for(const al in sa.glyphs)this._doesCharSupportLocalGlyph(+al)||(ut.glyphs[+al]=sa.glyphs[+al]);ut.ranges[yi]=!0}for(const al of kn)al(So,sa);delete ut.requests[yi]})),kn.push((So,sa)=>{So?Y(So):sa&&Y(null,{stack:T,id:F,glyph:sa.glyphs[F]||null})})},(T,F)=>{if(T)h(T);else if(F){const Y={};for(const{stack:ut,id:di,glyph:yi}of F)Y[ut]===void 0&&(Y[ut]={}),Y[ut].glyphs===void 0&&(Y[ut].glyphs={}),Y[ut].glyphs[di]=yi&&{id:yi.id,bitmap:yi.bitmap.clone(),metrics:yi.metrics},Y[ut].ascender=this.entries[ut].ascender,Y[ut].descender=this.entries[ut].descender;h(null,Y)}})}_doesCharSupportLocalGlyph(c){return this.localGlyphMode!==vE.none&&(this.localGlyphMode===vE.all?!!this.localFontFamily:!!this.localFontFamily&&(hh["CJK Unified Ideographs"](c)||hh["Hangul Syllables"](c)||hh.Hiragana(c)||hh.Katakana(c)||hh["CJK Symbols and Punctuation"](c)))}_tinySDF(c,h,w){const T=this.localFontFamily;if(!T||!this._doesCharSupportLocalGlyph(w))return;let F=c.tinySDF;if(!F){let eh="400";/bold/i.test(h)?eh="900":/medium/i.test(h)?eh="500":/light/i.test(h)&&(eh="200"),F=c.tinySDF=new k1.TinySDF({fontFamily:T,fontWeight:eh,fontSize:24*F0,buffer:3*F0,radius:8*F0}),F.fontWeight=eh}if(this.localGlyphs[F.fontWeight][w])return this.localGlyphs[F.fontWeight][w];const Y=String.fromCharCode(w),{data:ut,width:di,height:yi,glyphWidth:kn,glyphHeight:So,glyphLeft:sa,glyphTop:al,glyphAdvance:cl}=F.draw(Y);return this.localGlyphs[F.fontWeight][w]={id:w,bitmap:new t0({width:di,height:yi},ut),metrics:{width:kn/F0,height:So/F0,left:sa/F0,top:al/F0-27,advance:cl/F0,localGlyph:!0}}}}k1.loadGlyphRange=function(u,c,h,w,T){const F=256*c,Y=F+255,ut=w.transformRequest(w.normalizeGlyphsURL(h).replace("{fontstack}",u).replace("{range}",`${F}-${Y}`),np.Glyphs);ng(ut,(di,yi)=>{if(di)T(di);else if(yi){const kn={},So=function(sa){return new L1(sa).readFields(O1,{})}(yi);for(const sa of So.glyphs)kn[sa.id]=sa;T(null,{glyphs:kn,ascender:So.ascender,descender:So.descender})}})},k1.TinySDF=class{constructor({fontSize:u=24,buffer:c=3,radius:h=8,cutoff:w=.25,fontFamily:T="sans-serif",fontWeight:F="normal",fontStyle:Y="normal"}={}){this.buffer=c,this.cutoff=w,this.radius=h;const ut=this.size=u+4*c,di=this._createCanvas(ut),yi=this.ctx=di.getContext("2d",{willReadFrequently:!0});yi.font=`${Y} ${F} ${u}px ${T}`,yi.textBaseline="alphabetic",yi.textAlign="left",yi.fillStyle="black",this.gridOuter=new Float64Array(ut*ut),this.gridInner=new Float64Array(ut*ut),this.f=new Float64Array(ut),this.z=new Float64Array(ut+1),this.v=new Uint16Array(ut)}_createCanvas(u){const c=document.createElement("canvas");return c.width=c.height=u,c}draw(u){const{width:c,actualBoundingBoxAscent:h,actualBoundingBoxDescent:w,actualBoundingBoxLeft:T,actualBoundingBoxRight:F}=this.ctx.measureText(u),Y=Math.ceil(h),ut=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(F-T))),di=Math.min(this.size-this.buffer,Y+Math.ceil(w)),yi=ut+2*this.buffer,kn=di+2*this.buffer,So=Math.max(yi*kn,0),sa=new Uint8ClampedArray(So),al={data:sa,width:yi,height:kn,glyphWidth:ut,glyphHeight:di,glyphTop:Y,glyphLeft:0,glyphAdvance:c};if(ut===0||di===0)return al;const{ctx:cl,buffer:eh,gridInner:fh,gridOuter:Ch}=this;cl.clearRect(eh,eh,ut,di),cl.fillText(u,eh,eh+Y);const Gh=cl.getImageData(eh,eh,ut,di);Ch.fill(Mb,0,So),fh.fill(0,0,So);for(let Eh=0;Eh<di;Eh++)for(let kh=0;kh<ut;kh++){const jh=Gh.data[4*(Eh*ut+kh)+3]/255;if(jh===0)continue;const Hh=(Eh+eh)*yi+kh+eh;if(jh===1)Ch[Hh]=0,fh[Hh]=Mb;else{const ud=.5-jh;Ch[Hh]=ud>0?ud*ud:0,fh[Hh]=ud<0?ud*ud:0}}nS(Ch,0,0,yi,kn,yi,this.f,this.v,this.z),nS(fh,eh,eh,ut,di,yi,this.f,this.v,this.z);for(let Eh=0;Eh<So;Eh++){const kh=Math.sqrt(Ch[Eh])-Math.sqrt(fh[Eh]);sa[Eh]=Math.round(255-255*(kh/this.radius+this.cutoff))}return al}};const B1=jm;function sS(u,c,h,w){const T=[],F=u.image,Y=F.pixelRatio,ut=F.paddedRect.w-2*B1,di=F.paddedRect.h-2*B1,yi=u.right-u.left,kn=u.bottom-u.top,So=F.stretchX||[[0,ut]],sa=F.stretchY||[[0,di]],al=(gd,Pd)=>gd+Pd[1]-Pd[0],cl=So.reduce(al,0),eh=sa.reduce(al,0),fh=ut-cl,Ch=di-eh;let Gh=0,Eh=cl,kh=0,jh=eh,Hh=0,ud=fh,sd=0,Cd=Ch;if(F.content&&w){const gd=F.content;Gh=LC(So,0,gd[0]),kh=LC(sa,0,gd[1]),Eh=LC(So,gd[0],gd[2]),jh=LC(sa,gd[1],gd[3]),Hh=gd[0]-Gh,sd=gd[1]-kh,ud=gd[2]-gd[0]-Eh,Cd=gd[3]-gd[1]-jh}const jd=(gd,Pd,Dd,Gd)=>{const Zd=OC(gd.stretch-Gh,Eh,yi,u.left),yd=FC(gd.fixed-Hh,ud,gd.stretch,cl),dp=OC(Pd.stretch-kh,jh,kn,u.top),Lp=FC(Pd.fixed-sd,Cd,Pd.stretch,eh),mp=OC(Dd.stretch-Gh,Eh,yi,u.left),Zf=FC(Dd.fixed-Hh,ud,Dd.stretch,cl),Qd=OC(Gd.stretch-kh,jh,kn,u.top),qp=FC(Gd.fixed-sd,Cd,Gd.stretch,eh),Xf=new ll(Zd,dp),vg=new ll(mp,dp),Yf=new ll(mp,Qd),Gf=new ll(Zd,Qd),qg=new ll(yd/Y,Lp/Y),Qf=new ll(Zf/Y,qp/Y),eg=c*Math.PI/180;if(eg){const Hg=Math.sin(eg),Ng=Math.cos(eg),rm=[Ng,-Hg,Hg,Ng];Xf._matMult(rm),vg._matMult(rm),Gf._matMult(rm),Yf._matMult(rm)}const Fg=gd.stretch+gd.fixed,$g=Pd.stretch+Pd.fixed;return{tl:Xf,tr:vg,bl:Gf,br:Yf,tex:{x:F.paddedRect.x+B1+Fg,y:F.paddedRect.y+B1+$g,w:Dd.stretch+Dd.fixed-Fg,h:Gd.stretch+Gd.fixed-$g},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:qg,pixelOffsetBR:Qf,minFontScaleX:ud/Y/yi,minFontScaleY:Cd/Y/kn,isSDF:h}};if(w&&(F.stretchX||F.stretchY)){const gd=aS(So,fh,cl),Pd=aS(sa,Ch,eh);for(let Dd=0;Dd<gd.length-1;Dd++){const Gd=gd[Dd],Zd=gd[Dd+1];for(let yd=0;yd<Pd.length-1;yd++)T.push(jd(Gd,Pd[yd],Zd,Pd[yd+1]))}}else T.push(jd({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:ut+1},{fixed:0,stretch:di+1}));return T}function LC(u,c,h){let w=0;for(const T of u)w+=Math.max(c,Math.min(h,T[1]))-Math.max(c,Math.min(h,T[0]));return w}function aS(u,c,h){const w=[{fixed:-B1,stretch:0}];for(const[T,F]of u){const Y=w[w.length-1];w.push({fixed:T-Y.stretch,stretch:Y.stretch}),w.push({fixed:T-Y.stretch,stretch:Y.stretch+(F-T)})}return w.push({fixed:c+B1,stretch:h}),w}function OC(u,c,h,w){return u/c*h+w}function FC(u,c,h,w){return u-c*h/w}function aT(u,c,h,w){const T=c+u.positionedLines[w].lineOffset;return w===0?h+T/2:h+(T+(c+u.positionedLines[w-1].lineOffset))/2}class lT{constructor(c=[],h=cT){if(this.data=c,this.length=this.data.length,this.compare=h,this.length>0)for(let w=(this.length>>1)-1;w>=0;w--)this._down(w)}push(c){this.data.push(c),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const c=this.data[0],h=this.data.pop();return this.length--,this.length>0&&(this.data[0]=h,this._down(0)),c}peek(){return this.data[0]}_up(c){const{data:h,compare:w}=this,T=h[c];for(;c>0;){const F=c-1>>1,Y=h[F];if(w(T,Y)>=0)break;h[c]=Y,c=F}h[c]=T}_down(c){const{data:h,compare:w}=this,T=this.length>>1,F=h[c];for(;c<T;){let Y=1+(c<<1),ut=h[Y];const di=Y+1;if(di<this.length&&w(h[di],ut)<0&&(Y=di,ut=h[di]),w(ut,F)>=0)break;h[c]=ut,c=Y}h[c]=F}}function cT(u,c){return u<c?-1:u>c?1:0}function uT(u,c=1,h=!1){let w=1/0,T=1/0,F=-1/0,Y=-1/0;const ut=u[0];for(let al=0;al<ut.length;al++){const cl=ut[al];(!al||cl.x<w)&&(w=cl.x),(!al||cl.y<T)&&(T=cl.y),(!al||cl.x>F)&&(F=cl.x),(!al||cl.y>Y)&&(Y=cl.y)}const di=Math.min(F-w,Y-T);let yi=di/2;const kn=new lT([],hT);if(di===0)return new ll(w,T);for(let al=w;al<F;al+=di)for(let cl=T;cl<Y;cl+=di)kn.push(new G1(al+yi,cl+yi,yi,u));let So=function(al){let cl=0,eh=0,fh=0;const Ch=al[0];for(let Gh=0,Eh=Ch.length,kh=Eh-1;Gh<Eh;kh=Gh++){const jh=Ch[Gh],Hh=Ch[kh],ud=jh.x*Hh.y-Hh.x*jh.y;eh+=(jh.x+Hh.x)*ud,fh+=(jh.y+Hh.y)*ud,cl+=3*ud}return new G1(eh/cl,fh/cl,0,al)}(u),sa=kn.length;for(;kn.length;){const al=kn.pop();(al.d>So.d||!So.d)&&(So=al,h&&console.log("found best %d after %d probes",Math.round(1e4*al.d)/1e4,sa)),al.max-So.d<=c||(yi=al.h/2,kn.push(new G1(al.p.x-yi,al.p.y-yi,yi,u)),kn.push(new G1(al.p.x+yi,al.p.y-yi,yi,u)),kn.push(new G1(al.p.x-yi,al.p.y+yi,yi,u)),kn.push(new G1(al.p.x+yi,al.p.y+yi,yi,u)),sa+=4)}return h&&(console.log(`num probes: ${sa}`),console.log(`best distance: ${So.d}`)),So.p}function hT(u,c){return c.max-u.max}class G1{constructor(c,h,w,T){this.p=new ll(c,h),this.h=w,this.d=function(F,Y){let ut=!1,di=1/0;for(let yi=0;yi<Y.length;yi++){const kn=Y[yi];for(let So=0,sa=kn.length,al=sa-1;So<sa;al=So++){const cl=kn[So],eh=kn[al];cl.y>F.y!=eh.y>F.y&&F.x<(eh.x-cl.x)*(F.y-cl.y)/(eh.y-cl.y)+cl.x&&(ut=!ut),di=Math.min(di,v1(F,cl,eh))}}return(ut?1:-1)*Math.sqrt(di)}(this.p,T),this.max=this.d+this.h*Math.SQRT2}}const z1=7,xE=Number.POSITIVE_INFINITY,dT=Math.sqrt(2);function lS(u,[c,h]){let w=0,T=0;if(h===xE){c<0&&(c=0);const F=c/dT;switch(u){case"top-right":case"top-left":T=F-z1;break;case"bottom-right":case"bottom-left":T=-F+z1;break;case"bottom":T=-c+z1;break;case"top":T=c-z1}switch(u){case"top-right":case"bottom-right":w=-F;break;case"top-left":case"bottom-left":w=F;break;case"left":w=c;break;case"right":w=-c}}else{switch(c=Math.abs(c),h=Math.abs(h),u){case"top-right":case"top-left":case"top":T=h-z1;break;case"bottom-right":case"bottom-left":case"bottom":T=-h+z1}switch(u){case"top-right":case"bottom-right":case"right":w=-c;break;case"top-left":case"bottom-left":case"left":w=c}}return[w,T]}function pT(u,c,h,w,T,F,Y,ut,di,yi){u.createArrays(),u.tilePixelRatio=jp/(512*u.overscaling),u.compareText={},u.iconsNeedLinear=!1;const kn=u.layers[0].layout,So=u.layers[0]._unevaluatedLayout._values,sa={};if(u.textSizeData.kind==="composite"){const{minZoom:eh,maxZoom:fh}=u.textSizeData;sa.compositeTextSizes=[So["text-size"].possiblyEvaluate(new Gn(eh),ut),So["text-size"].possiblyEvaluate(new Gn(fh),ut)]}if(u.iconSizeData.kind==="composite"){const{minZoom:eh,maxZoom:fh}=u.iconSizeData;sa.compositeIconSizes=[So["icon-size"].possiblyEvaluate(new Gn(eh),ut),So["icon-size"].possiblyEvaluate(new Gn(fh),ut)]}sa.layoutTextSize=So["text-size"].possiblyEvaluate(new Gn(di+1),ut),sa.layoutIconSize=So["icon-size"].possiblyEvaluate(new Gn(di+1),ut),sa.textMaxSize=So["text-size"].possiblyEvaluate(new Gn(18),ut);const al=kn.get("text-rotation-alignment")==="map"&&kn.get("symbol-placement")!=="point",cl=kn.get("text-size");for(const eh of u.features){const fh=kn.get("text-font").evaluate(eh,{},ut).join(","),Ch=cl.evaluate(eh,{},ut),Gh=sa.layoutTextSize.evaluate(eh,{},ut),Eh=(sa.layoutIconSize.evaluate(eh,{},ut),{horizontal:{},vertical:void 0}),kh=eh.text;let jh,Hh=[0,0];if(kh){const Cd=kh.toString(),jd=kn.get("text-letter-spacing").evaluate(eh,{},ut)*Ig,gd=kn.get("text-line-height").evaluate(eh,{},ut)*Ig,Pd=zh(Cd)?jd:0,Dd=kn.get("text-anchor").evaluate(eh,{},ut),Gd=kn.get("text-variable-anchor");if(!Gd){const mp=kn.get("text-radial-offset").evaluate(eh,{},ut);Hh=mp?lS(Dd,[mp*Ig,xE]):kn.get("text-offset").evaluate(eh,{},ut).map(Zf=>Zf*Ig)}let Zd=al?"center":kn.get("text-justify").evaluate(eh,{},ut);const yd=kn.get("symbol-placement")==="point",dp=yd?kn.get("text-max-width").evaluate(eh,{},ut)*Ig:1/0,Lp=mp=>{u.allowVerticalPlacement&&Rh(Cd)&&(Eh.vertical=_E(kh,c,h,T,fh,dp,gd,Dd,mp,Pd,Hh,vv.vertical,!0,Gh,Ch))};if(!al&&Gd){const mp=Zd==="auto"?Gd.map(Qd=>wE(Qd)):[Zd];let Zf=!1;for(let Qd=0;Qd<mp.length;Qd++){const qp=mp[Qd];if(!Eh.horizontal[qp])if(Zf)Eh.horizontal[qp]=Eh.horizontal[0];else{const Xf=_E(kh,c,h,T,fh,dp,gd,"center",qp,Pd,Hh,vv.horizontal,!1,Gh,Ch);Xf&&(Eh.horizontal[qp]=Xf,Zf=Xf.positionedLines.length===1)}}Lp("left")}else{if(Zd==="auto"&&(Zd=wE(Dd)),yd||kn.get("text-writing-mode").indexOf("horizontal")>=0||!Rh(Cd)){const mp=_E(kh,c,h,T,fh,dp,gd,Dd,Zd,Pd,Hh,vv.horizontal,!1,Gh,Ch);mp&&(Eh.horizontal[Zd]=mp)}Lp(yd?"left":Zd)}}let ud=!1;if(eh.icon&&eh.icon.name){const Cd=w[eh.icon.name];Cd&&(jh=nT(T[eh.icon.name],kn.get("icon-offset").evaluate(eh,{},ut),kn.get("icon-anchor").evaluate(eh,{},ut)),ud=Cd.sdf,u.sdfIcons===void 0?u.sdfIcons=Cd.sdf:u.sdfIcons!==Cd.sdf&&Ad("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Cd.pixelRatio!==u.pixelRatio||kn.get("icon-rotate").constantOr(1)!==0)&&(u.iconsNeedLinear=!0))}const sd=uS(Eh.horizontal)||Eh.vertical;u.iconsInText||(u.iconsInText=!!sd&&sd.iconsInText),(sd||jh)&&fT(u,eh,Eh,jh,w,sa,Gh,0,Hh,ud,Y,ut,yi)}F&&u.generateCollisionDebugBuffers(di,u.collisionBoxArray)}function wE(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function fT(u,c,h,w,T,F,Y,ut,di,yi,kn,So,sa){let al=F.textMaxSize.evaluate(c,{},So);al===void 0&&(al=Y);const cl=u.layers[0].layout,eh=cl.get("icon-offset").evaluate(c,{},So),fh=uS(h.horizontal)||h.vertical,Ch=sa.name==="globe",Gh=Ig,Eh=Y/Gh,kh=u.tilePixelRatio*al/Gh,jh=(Dd=u.overscaling,u.zoom>18&&Dd>2&&(Dd>>=1),Math.max(jp/(512*Dd),1)*cl.get("symbol-spacing")),Hh=cl.get("text-padding")*u.tilePixelRatio,ud=cl.get("icon-padding")*u.tilePixelRatio,sd=nh(cl.get("text-max-angle")),Cd=cl.get("text-rotation-alignment")==="map"&&cl.get("symbol-placement")!=="point",jd=cl.get("icon-rotation-alignment")==="map"&&cl.get("symbol-placement")!=="point",gd=cl.get("symbol-placement"),Pd=jh/2;var Dd;const Gd=cl.get("icon-text-fit");let Zd;w&&Gd!=="none"&&(u.allowVerticalPlacement&&h.vertical&&(Zd=YE(w,h.vertical,Gd,cl.get("icon-text-fit-padding"),eh,Eh)),fh&&(w=YE(w,fh,Gd,cl.get("icon-text-fit-padding"),eh,Eh)));const yd=(dp,Lp,mp)=>{if(Lp.x<0||Lp.x>=jp||Lp.y<0||Lp.y>=jp)return;let Zf=null;if(Ch){const{x:Qd,y:qp,z:Xf}=sa.projectTilePoint(Lp.x,Lp.y,mp);Zf={anchor:new Bx(Qd,qp,Xf,0,void 0),up:sa.upVector(mp,Lp.x,Lp.y)}}(function(Qd,qp,Xf,vg,Yf,Gf,qg,Qf,eg,Fg,$g,Hg,Ng,rm,vm,Pm,kg,zm,Dm,um,wg,Lm,jg,H_,Om){const p_=Qd.addToLineVertexArray(qp,vg);let r_,j_,n_,k0,$1,Gb,zb,HS=0,jS=0,WS=0,qS=0,NE=-1,kE=-1;const vx={};let KS=o1("");const e1=Xf?Xf.anchor:qp;let BE=0,GE=0;if(eg._unevaluatedLayout.getValue("text-radial-offset")===void 0?[BE,GE]=eg.layout.get("text-offset").evaluate(wg,{},Om).map(Oy=>Oy*Ig):(BE=eg.layout.get("text-radial-offset").evaluate(wg,{},Om)*Ig,GE=xE),Qd.allowVerticalPlacement&&Yf.vertical){const Oy=Yf.vertical;if(vm)Gb=bE(Oy),Qf&&(zb=bE(Qf));else{const Fy=eg.layout.get("text-rotate").evaluate(wg,{},Om)+90;n_=NC(Fg,e1,qp,$g,Hg,Ng,Oy,rm,Fy,Pm),Qf&&(k0=NC(Fg,e1,qp,$g,Hg,Ng,Qf,zm,Fy))}}if(Gf){const Oy=eg.layout.get("icon-rotate").evaluate(wg,{},Om),Fy=eg.layout.get("icon-text-fit")!=="none",Vb=sS(Gf,Oy,jg,Fy),VE=Qf?sS(Qf,Oy,jg,Fy):void 0;j_=NC(Fg,e1,qp,$g,Hg,Ng,Gf,zm,Oy),HS=4*Vb.length;const ZS=Qd.iconSizeData;let t1=null;ZS.kind==="source"?(t1=[im*eg.layout.get("icon-size").evaluate(wg,{},Om)],t1[0]>dw&&Ad(`${Qd.layerIds[0]}: Value for "icon-size" is >= ${Pb}. Reduce your "icon-size".`)):ZS.kind==="composite"&&(t1=[im*Lm.compositeIconSizes[0].evaluate(wg,{},Om),im*Lm.compositeIconSizes[1].evaluate(wg,{},Om)],(t1[0]>dw||t1[1]>dw)&&Ad(`${Qd.layerIds[0]}: Value for "icon-size" is >= ${Pb}. Reduce your "icon-size".`)),Qd.addSymbols(Qd.icon,Vb,t1,um,Dm,wg,!1,Xf,qp,p_.lineStartIndex,p_.lineLength,-1,H_,Om),NE=Qd.icon.placedSymbolArray.length-1,VE&&(jS=4*VE.length,Qd.addSymbols(Qd.icon,VE,t1,um,Dm,wg,vv.vertical,Xf,qp,p_.lineStartIndex,p_.lineLength,-1,H_,Om),kE=Qd.icon.placedSymbolArray.length-1)}for(const Oy in Yf.horizontal){const Fy=Yf.horizontal[Oy];r_||(KS=o1(Fy.text),vm?$1=bE(Fy):r_=NC(Fg,e1,qp,$g,Hg,Ng,Fy,rm,eg.layout.get("text-rotate").evaluate(wg,{},Om),Pm));const Vb=Fy.positionedLines.length===1;if(WS+=cS(Qd,Xf,qp,Fy,qg,eg,vm,wg,Pm,p_,Yf.vertical?vv.horizontal:vv.horizontalOnly,Vb?Object.keys(Yf.horizontal):[Oy],vx,NE,Lm,H_,Om),Vb)break}Yf.vertical&&(qS+=cS(Qd,Xf,qp,Yf.vertical,qg,eg,vm,wg,Pm,p_,vv.vertical,["vertical"],vx,kE,Lm,H_,Om));let yw=-1;const zE=(Oy,Fy)=>Oy?Math.max(Oy,Fy):Fy;yw=zE($1,yw),yw=zE(Gb,yw),yw=zE(zb,yw);const UT=yw>-1?1:0;Qd.glyphOffsetArray.length>=fw.MAX_GLYPHS&&Ad("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),wg.sortKey!==void 0&&Qd.addToSortKeyRanges(Qd.symbolInstances.length,wg.sortKey),Qd.symbolInstances.emplaceBack(e1.x,e1.y,e1.z,qp.x,qp.y,vx.right>=0?vx.right:-1,vx.center>=0?vx.center:-1,vx.left>=0?vx.left:-1,vx.vertical>=0?vx.vertical:-1,NE,kE,KS,r_!==void 0?r_:Qd.collisionBoxArray.length,r_!==void 0?r_+1:Qd.collisionBoxArray.length,n_!==void 0?n_:Qd.collisionBoxArray.length,n_!==void 0?n_+1:Qd.collisionBoxArray.length,j_!==void 0?j_:Qd.collisionBoxArray.length,j_!==void 0?j_+1:Qd.collisionBoxArray.length,k0||Qd.collisionBoxArray.length,k0?k0+1:Qd.collisionBoxArray.length,$g,WS,qS,HS,jS,UT,0,BE,GE,yw)})(u,Lp,Zf,dp,h,w,T,Zd,u.layers[0],u.collisionBoxArray,c.index,c.sourceLayerIndex,u.index,Hh,Cd,di,0,ud,jd,eh,c,F,yi,kn,So)};if(gd==="line")for(const dp of rS(c.geometry,0,0,jp,jp)){const Lp=sT(dp,jh,sd,h.vertical||fh,w,Gh,kh,u.overscaling,jp);for(const mp of Lp)fh&&gT(u,fh.text,Pd,mp)||yd(dp,mp,So)}else if(gd==="line-center"){for(const dp of c.geometry)if(dp.length>1){const Lp=oT(dp,sd,h.vertical||fh,w,Gh,kh);Lp&&yd(dp,Lp,So)}}else if(c.type==="Polygon")for(const dp of Kw(c.geometry,0)){const Lp=uT(dp,16);yd(dp[0],new Bx(Lp.x,Lp.y,0,0,void 0),So)}else if(c.type==="LineString")for(const dp of c.geometry)yd(dp,new Bx(dp[0].x,dp[0].y,0,0,void 0),So);else if(c.type==="Point")for(const dp of c.geometry)for(const Lp of dp)yd([Lp],new Bx(Lp.x,Lp.y,0,0,void 0),So)}const Pb=255,dw=Pb*im;function cS(u,c,h,w,T,F,Y,ut,di,yi,kn,So,sa,al,cl,eh,fh){const Ch=function(kh,jh,Hh,ud,sd,Cd,jd,gd){const Pd=[];if(jh.positionedLines.length===0)return Pd;const Dd=ud.layout.get("text-rotate").evaluate(Cd,{})*Math.PI/180,Gd=function(mp){const Zf=mp[0],Qd=mp[1],qp=Zf*Qd;return qp>0?[Zf,-Qd]:qp<0?[-Zf,Qd]:Zf===0?[Qd,Zf]:[Qd,-Zf]}(Hh);let Zd=Math.abs(jh.top-jh.bottom);for(const mp of jh.positionedLines)Zd-=mp.lineOffset;const yd=jh.positionedLines.length,dp=Zd/yd;let Lp=jh.top-Hh[1];for(let mp=0;mp<yd;++mp){const Zf=jh.positionedLines[mp];Lp=aT(jh,dp,Lp,mp);for(const Qd of Zf.positionedGlyphs){if(!Qd.rect)continue;const qp=Qd.rect||{};let Xf=yv+1,vg=!0,Yf=1,Gf=0;if(Qd.imageName){const jg=jd[Qd.imageName];if(!jg)continue;if(jg.sdf){Ad("SDF images are not supported in formatted text and will be ignored.");continue}vg=!1,Yf=jg.pixelRatio,Xf=jm/Yf}const qg=(sd||gd)&&Qd.vertical,Qf=Qd.metrics.advance*Qd.scale/2,eg=Qd.metrics,Fg=Qd.rect;if(Fg===null)continue;gd&&jh.verticalizable&&(Gf=Qd.imageName?Qf-Qd.metrics.width*Qd.scale/2:0);const $g=sd?[Qd.x+Qf,Qd.y]:[0,0];let Hg=[0,0],Ng=[0,0],rm=!1;sd||(qg?(Ng=[Qd.x+Qf+Gd[0],Qd.y+Gd[1]-Gf],rm=!0):Hg=[Qd.x+Qf+Hh[0],Qd.y+Hh[1]-Gf]);const vm=Fg.w*Qd.scale/(Yf*(Qd.localGlyph?F0:1)),Pm=Fg.h*Qd.scale/(Yf*(Qd.localGlyph?F0:1));let kg,zm,Dm,um;if(qg){const jg=Qd.y-Lp,H_=new ll(-Qf,Qf-jg),Om=-Math.PI/2,p_=new ll(...Ng);kg=new ll(-Qf+Hg[0],Hg[1]),kg._rotateAround(Om,H_)._add(p_),kg.x+=-jg+Qf,kg.y-=(eg.left-Xf)*Qd.scale;const r_=Qd.imageName?eg.advance*Qd.scale:Ig*Qd.scale,j_=String.fromCharCode(Qd.glyph);Dy(j_)?kg.x+=(1-Xf)*Qd.scale:_v(j_)?kg.x+=r_-eg.height*Qd.scale+(-Xf-1)*Qd.scale:kg.x+=Qd.imageName||eg.width+2*Xf===Fg.w&&eg.height+2*Xf===Fg.h?(r_-Pm)/2:(r_-(eg.height+2*Xf)*Qd.scale)/2,zm=new ll(kg.x,kg.y-vm),Dm=new ll(kg.x+Pm,kg.y),um=new ll(kg.x+Pm,kg.y-vm)}else{const jg=(eg.left-Xf)*Qd.scale-Qf+Hg[0],H_=(-eg.top-Xf)*Qd.scale+Hg[1],Om=jg+vm,p_=H_+Pm;kg=new ll(jg,H_),zm=new ll(Om,H_),Dm=new ll(jg,p_),um=new ll(Om,p_)}if(Dd){let jg;jg=sd?new ll(0,0):rm?new ll(Gd[0],Gd[1]):new ll(Hh[0],Hh[1]),kg._rotateAround(Dd,jg),zm._rotateAround(Dd,jg),Dm._rotateAround(Dd,jg),um._rotateAround(Dd,jg)}const wg=new ll(0,0),Lm=new ll(0,0);Pd.push({tl:kg,tr:zm,bl:Dm,br:um,tex:qp,writingMode:jh.writingMode,glyphOffset:$g,sectionIndex:Qd.sectionIndex,isSDF:vg,pixelOffsetTL:wg,pixelOffsetBR:Lm,minFontScaleX:0,minFontScaleY:0})}}return Pd}(0,w,di,F,Y,ut,T,u.allowVerticalPlacement),Gh=u.textSizeData;let Eh=null;Gh.kind==="source"?(Eh=[im*F.layout.get("text-size").evaluate(ut,{},fh)],Eh[0]>dw&&Ad(`${u.layerIds[0]}: Value for "text-size" is >= ${Pb}. Reduce your "text-size".`)):Gh.kind==="composite"&&(Eh=[im*cl.compositeTextSizes[0].evaluate(ut,{},fh),im*cl.compositeTextSizes[1].evaluate(ut,{},fh)],(Eh[0]>dw||Eh[1]>dw)&&Ad(`${u.layerIds[0]}: Value for "text-size" is >= ${Pb}. Reduce your "text-size".`)),u.addSymbols(u.text,Ch,Eh,di,Y,ut,kn,c,h,yi.lineStartIndex,yi.lineLength,al,eh,fh);for(const kh of So)sa[kh]=u.text.placedSymbolArray.length-1;return 4*Ch.length}function uS(u){for(const c in u)return u[c];return null}function NC(u,c,h,w,T,F,Y,ut,di,yi){let kn=Y.top,So=Y.bottom,sa=Y.left,al=Y.right;const cl=Y.collisionPadding;if(cl&&(sa-=cl[0],kn-=cl[1],al+=cl[2],So+=cl[3]),di){const eh=new ll(sa,kn),fh=new ll(al,kn),Ch=new ll(sa,So),Gh=new ll(al,So),Eh=nh(di);let kh=new ll(0,0);yi&&(kh=new ll(yi[0],yi[1])),eh._rotateAround(Eh,kh),fh._rotateAround(Eh,kh),Ch._rotateAround(Eh,kh),Gh._rotateAround(Eh,kh),sa=Math.min(eh.x,fh.x,Ch.x,Gh.x),al=Math.max(eh.x,fh.x,Ch.x,Gh.x),kn=Math.min(eh.y,fh.y,Ch.y,Gh.y),So=Math.max(eh.y,fh.y,Ch.y,Gh.y)}return u.emplaceBack(c.x,c.y,c.z,h.x,h.y,sa,kn,al,So,ut,w,T,F),u.length-1}function bE(u){u.collisionPadding&&(u.top-=u.collisionPadding[1],u.bottom+=u.collisionPadding[3]);const c=u.bottom-u.top;return c>0?Math.max(10,c):null}function gT(u,c,h,w){const T=u.compareText;if(c in T){const F=T[c];for(let Y=F.length-1;Y>=0;Y--)if(w.dist(F[Y])<h)return!0}else T[c]=[];return T[c].push(w),!1}function hS(u,c){const h=u.fovAboveCenter,w=u.elevation?u.elevation.getMinElevationBelowMSL()*c:0,T=(u._camera.position[2]*u.worldSize-w)/Math.cos(u._pitch),F=Math.sin(h)*T/Math.sin(Math.max(Math.PI/2-u._pitch-h,.01)),Y=Math.sin(u._pitch)*F+T;return Math.min(1.01*Y,T*(1/u._horizonShift))}function Jw(u,c){if(!c.isReprojectedInTileSpace)return{scale:1<<u.z,x:u.x,y:u.y,x2:u.x+1,y2:u.y+1,projection:c};const h=Math.pow(2,-u.z),w=u.x*h,T=(u.x+1)*h,F=u.y*h,Y=(u.y+1)*h,ut=Gm(w),di=Gm(T),yi=bm(F),kn=bm(Y),So=c.project(ut,yi),sa=c.project(di,yi),al=c.project(di,kn),cl=c.project(ut,kn);let eh=Math.min(So.x,sa.x,al.x,cl.x),fh=Math.min(So.y,sa.y,al.y,cl.y),Ch=Math.max(So.x,sa.x,al.x,cl.x),Gh=Math.max(So.y,sa.y,al.y,cl.y);const Eh=h/16;function kh(Hh,ud,sd,Cd,jd,gd){const Pd=(sd+jd)/2,Dd=(Cd+gd)/2,Gd=c.project(Gm(Pd),bm(Dd)),Zd=Math.max(0,eh-Gd.x,fh-Gd.y,Gd.x-Ch,Gd.y-Gh);eh=Math.min(eh,Gd.x),Ch=Math.max(Ch,Gd.x),fh=Math.min(fh,Gd.y),Gh=Math.max(Gh,Gd.y),Zd>Eh&&(kh(Hh,Gd,sd,Cd,Pd,Dd),kh(Gd,ud,Pd,Dd,jd,gd))}kh(So,sa,w,F,T,F),kh(sa,al,T,F,T,Y),kh(al,cl,T,Y,w,Y),kh(cl,So,w,Y,w,F),eh-=Eh,fh-=Eh,Ch+=Eh,Gh+=Eh;const jh=1/Math.max(Ch-eh,Gh-fh);return{scale:jh,x:eh*jh,y:fh*jh,x2:Ch*jh,y2:Gh*jh,projection:c}}const mT=dv(new Float32Array(16));class pw{constructor(c){this.spec=c,this.name=c.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(c,h){return{x:0,y:0,z:0}}unproject(c,h){return new Rg(0,0)}projectTilePoint(c,h,w){return{x:c,y:h,z:0}}locationPoint(c,h,w=!0){return c._coordinatePoint(c.locationCoordinate(h),w)}pixelsPerMeter(c,h){return Py(1,c)*h}pixelSpaceConversion(c,h,w){return 1}farthestPixelDistance(c){return hS(c,c.pixelsPerMeter)}pointCoordinate(c,h,w,T){const F=c.horizonLineFromTop(!1),Y=new ll(h,Math.max(F,w));return c.rayIntersectionCoordinate(c.pointRayIntersection(Y,T))}pointCoordinate3D(c,h,w){const T=new ll(h,w);if(c.elevation)return c.elevation.pointCoordinate(T);{const F=this.pointCoordinate(c,T.x,T.y,0);return[F.x,F.y,F.z]}}isPointAboveHorizon(c,h){if(c.elevation)return!this.pointCoordinate3D(c,h.x,h.y);const w=c.horizonLineFromTop();return h.y<w}createInversionMatrix(c,h){return mT}createTileMatrix(c,h,w){let T,F,Y;const ut=w.canonical,di=dv(new Float64Array(16));if(this.isReprojectedInTileSpace){const yi=Jw(ut,this);T=1,F=yi.x+w.wrap*yi.scale,Y=yi.y,S0(di,di,[T/yi.scale,T/yi.scale,c.pixelsPerMeter/h])}else T=h/c.zoomScale(ut.z),F=(ut.x+Math.pow(2,ut.z)*w.wrap)*T,Y=ut.y*T;return Mx(di,di,[F,Y,0]),S0(di,di,[T/jp,T/jp,1]),di}upVector(c,h,w){return[0,0,1]}upVectorScale(c,h,w){return{metersToTile:1}}}class _T extends pw{constructor(c){super(c),this.range=[4,7],this.center=c.center||[-96,37.5];const[h,w]=this.parallels=c.parallels||[29.5,45.5],T=Math.sin(nh(h));this.n=(T+Math.sin(nh(w)))/2,this.c=1+T*(2*this.n-T),this.r0=Math.sqrt(this.c)/this.n}project(c,h){const{n:w,c:T,r0:F}=this,Y=nh(c-this.center[0]),ut=nh(h),di=Math.sqrt(T-2*w*Math.sin(ut))/w;return{x:di*Math.sin(Y*w),y:di*Math.cos(Y*w)-F,z:0}}unproject(c,h){const{n:w,c:T,r0:F}=this,Y=F+h;let ut=Math.atan2(c,Math.abs(Y))*Math.sign(Y);Y*w<0&&(ut-=Math.PI*Math.sign(c)*Math.sign(Y));const di=nh(this.center[0])*w;ut=Ld(ut,-Math.PI-di,Math.PI-di);const yi=td(bh(ut/w)+this.center[0],-180,180),kn=Math.asin(td((T-(c*c+Y*Y)*w*w)/(2*w),-1,1)),So=td(bh(kn),-_m,_m);return new Rg(yi,So)}}const Db=1.340264,Lb=-.081106,Ob=893e-6,Fb=.003796,kC=Math.sqrt(3)/2;class yT extends pw{project(c,h){h=h/180*Math.PI,c=c/180*Math.PI;const w=Math.asin(kC*Math.sin(h)),T=w*w,F=T*T*T;return{x:.5*(c*Math.cos(w)/(kC*(Db+3*Lb*T+F*(7*Ob+9*Fb*T)))/Math.PI+.5),y:1-.5*(w*(Db+Lb*T+F*(Ob+Fb*T))/Math.PI+1),z:0}}unproject(c,h){c=(2*c-.5)*Math.PI;let w=h=(2*(1-h)-1)*Math.PI,T=w*w,F=T*T*T;for(let kn,So,sa,al=0;al<12&&(So=w*(Db+Lb*T+F*(Ob+Fb*T))-h,sa=Db+3*Lb*T+F*(7*Ob+9*Fb*T),kn=So/sa,w=td(w-kn,-Math.PI/3,Math.PI/3),T=w*w,F=T*T*T,!(Math.abs(kn)<1e-12));++al);const Y=kC*c*(Db+3*Lb*T+F*(7*Ob+9*Fb*T))/Math.cos(w),ut=Math.asin(Math.sin(w)/kC),di=td(180*Y/Math.PI,-180,180),yi=td(180*ut/Math.PI,-_m,_m);return new Rg(di,yi)}}class vT extends pw{constructor(c){super(c),this.wrap=!0,this.supportsWorldCopies=!0}project(c,h){return{x:.5+c/360,y:.5-h/360,z:0}}unproject(c,h){const w=360*(c-.5),T=td(360*(.5-h),-_m,_m);return new Rg(w,T)}}const V1=Math.PI/2;function BC(u){return Math.tan((V1+u)/2)}class xT extends pw{constructor(c){super(c),this.center=c.center||[0,30];const[h,w]=this.parallels=c.parallels||[30,30];let T=nh(h),F=nh(w);this.southernCenter=T+F<0,this.southernCenter&&(T=-T,F=-F);const Y=Math.cos(T),ut=BC(T);this.n=T===F?Math.sin(T):Math.log(Y/Math.cos(F))/Math.log(BC(F)/ut),this.f=Y*Math.pow(BC(T),this.n)/this.n}project(c,h){h=nh(h),this.southernCenter&&(h=-h),c=nh(c-this.center[0]);const w=1e-6,{n:T,f:F}=this;F>0?h<-V1+w&&(h=-V1+w):h>V1-w&&(h=V1-w);const Y=F/Math.pow(BC(h),T);let ut=Y*Math.sin(T*c),di=F-Y*Math.cos(T*c);return ut=.5*(ut/Math.PI+.5),di=.5*(di/Math.PI+.5),{x:ut,y:this.southernCenter?di:1-di,z:0}}unproject(c,h){c=(2*c-.5)*Math.PI,this.southernCenter&&(h=1-h),h=(2*(1-h)-.5)*Math.PI;const{n:w,f:T}=this,F=T-h,Y=Math.sign(F),ut=Math.sign(w)*Math.sqrt(c*c+F*F);let di=Math.atan2(c,Math.abs(F))*Y;F*w<0&&(di-=Math.PI*Math.sign(c)*Y);const yi=td(bh(di/w)+this.center[0],-180,180),kn=td(bh(2*Math.atan(Math.pow(T/ut,1/w))-V1),-_m,_m);return new Rg(yi,this.southernCenter?-kn:kn)}}class dS extends pw{constructor(c){super(c),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(c,h){return{x:am(c),y:My(h),z:0}}unproject(c,h){const w=Gm(c),T=bm(h);return new Rg(w,T)}}const pS=nh(_m);class wT extends pw{project(c,h){const w=(h=nh(h))*h,T=w*w;return{x:.5*((c=nh(c))*(.8707-.131979*w+T*(T*(.003971*w-.001529*T)-.013791))/Math.PI+.5),y:1-.5*(h*(1.007226+w*(.015085+T*(.028874*w-.044475-.005916*T)))/Math.PI+1),z:0}}unproject(c,h){c=(2*c-.5)*Math.PI;let w=h=(2*(1-h)-1)*Math.PI,T=25,F=0,Y=w*w;do{Y=w*w;const yi=Y*Y;F=(w*(1.007226+Y*(.015085+yi*(.028874*Y-.044475-.005916*yi)))-h)/(1.007226+Y*(.045255+yi*(.259866*Y-.311325-.005916*11*yi))),w=td(w-F,-pS,pS)}while(Math.abs(F)>1e-6&&--T>0);Y=w*w;const ut=td(bh(c/(.8707+Y*(Y*(Y*Y*Y*(.003971-.001529*Y)-.013791)-.131979))),-180,180),di=bh(w);return new Rg(ut,di)}}const fS=nh(_m);class bT extends pw{project(c,h){h=nh(h),c=nh(c);const w=Math.cos(h),T=2/Math.PI,F=Math.acos(w*Math.cos(c/2)),Y=Math.sin(F)/F,ut=.5*(c*T+2*w*Math.sin(c/2)/Y)||0,di=.5*(h+Math.sin(h)/Y)||0;return{x:.5*(ut/Math.PI+.5),y:1-.5*(di/Math.PI+1),z:0}}unproject(c,h){let w=c=(2*c-.5)*Math.PI,T=h=(2*(1-h)-1)*Math.PI,F=25;const Y=1e-6;let ut=0,di=0;do{const yi=Math.cos(T),kn=Math.sin(T),So=2*kn*yi,sa=kn*kn,al=yi*yi,cl=Math.cos(w/2),eh=Math.sin(w/2),fh=2*cl*eh,Ch=eh*eh,Gh=1-al*cl*cl,Eh=Gh?1/Gh:0,kh=Gh?Math.acos(yi*cl)*Math.sqrt(1/Gh):0,jh=.5*(2*kh*yi*eh+2*w/Math.PI)-c,Hh=.5*(kh*kn+T)-h,ud=.5*Eh*(al*Ch+kh*yi*cl*sa)+1/Math.PI,sd=Eh*(fh*So/4-kh*kn*eh),Cd=.125*Eh*(So*eh-kh*kn*al*fh),jd=.5*Eh*(sa*cl+kh*Ch*yi)+.5,gd=sd*Cd-jd*ud;ut=(Hh*sd-jh*jd)/gd,di=(jh*Cd-Hh*ud)/gd,w=td(w-ut,-Math.PI,Math.PI),T=td(T-di,-fS,fS)}while((Math.abs(ut)>Y||Math.abs(di)>Y)&&--F>0);return new Rg(bh(w),bh(T))}}class gS extends pw{constructor(c){super(c),this.center=c.center||[0,0],this.parallels=c.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(nh(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(c,h){const{scale:w,cosPhi:T}=this;return{x:nh(c)*T*w+.5,y:-Math.sin(nh(h))/T*w+.5,z:0}}unproject(c,h){const{scale:w,cosPhi:T}=this,F=-(h-.5)/w,Y=td(bh((c-.5)/w)/T,-180,180),ut=Math.asin(td(F*T,-1,1)),di=td(bh(ut),-_m,_m);return new Rg(Y,di)}}class CT extends dS{constructor(c){super(c),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(c,h,w){const T=Nw(c,h,w);return sm(T,T,kw(ug(w))),{x:T[0],y:T[1],z:T[2]}}locationPoint(c,h){const w=Qx(h.lat,h.lng),T=w_([],w),F=c.elevation?c.elevation.getAtPointOrZero(c.locationCoordinate(h),c._centerAltitude):c._centerAltitude;Zx(w,w,T,Py(1,0)*jp*F);const Y=dv(new Float64Array(16));return Ix(Y,c.pixelMatrix,c.globeMatrix),sm(w,w,Y),new ll(w[0],w[1])}pixelsPerMeter(c,h){return Py(1,0)*h}pixelSpaceConversion(c,h,w){const T=Py(1,c)*h,F=Hp(Py(1,45)*h,T,w);return this.pixelsPerMeter(c,h)/F}createTileMatrix(c,h,w){const T=sb(ug(w.canonical));return Ix(new Float64Array(16),c.globeMatrix,T)}createInversionMatrix(c,h){const{center:w}=c,T=kw(ug(h));return Dw(T,T,nh(w.lng)),Pw(T,T,nh(w.lat)),S0(T,T,[c._pixelsPerMercatorPixel,c._pixelsPerMercatorPixel,1]),Float32Array.from(T)}pointCoordinate(c,h,w,T){return rb(c,h,w,!0)||new M0(0,0)}pointCoordinate3D(c,h,w){const T=this.pointCoordinate(c,h,w,0);return[T.x,T.y,T.z]}isPointAboveHorizon(c,h){return!rb(c,h.x,h.y,!1)}farthestPixelDistance(c){const h=function(T,F){const Y=T.cameraToCenterDistance,ut=T._centerAltitude*F,di=T._camera,yi=T._camera.forward(),kn=Qv([],V_([],yi,-Y),[0,0,ut]),So=T.worldSize/(2*Math.PI),sa=[0,0,-So],al=T.width/T.height,cl=Math.tan(T.fovAboveCenter),eh=V_([],di.up(),cl),fh=V_([],di.right(),cl*al),Ch=w_([],Qv([],Qv([],yi,eh),fh)),Gh=[];let Eh;if(new c1(kn,Ch).closestPointOnSphere(sa,So,Gh)){const kh=Qv([],Gh,sa),jh=ny([],kh,kn);Eh=Math.cos(T.fovAboveCenter)*Ty(jh)}else{const kh=ny([],kn,sa),jh=ny([],sa,kn);w_(jh,jh);const Hh=Ty(kh)-So;Eh=Math.sqrt(Hh*(Hh+2*So));const ud=Math.acos(Eh/(So+Hh))-Math.acos(Ay(yi,jh));Eh*=Math.cos(ud)}return 1.01*Eh}(c,this.pixelsPerMeter(c.center.lat,c.worldSize)),w=ew(c.zoom);if(w>0){const T=hS(c,Py(1,c.center.lat)*c.worldSize),F=c.worldSize/(2*Math.PI),Y=Math.max(c.width,c.height)/c.worldSize*Math.PI;return Hp(h,T+F*(1-Math.cos(Y)),Math.pow(w,10))}return h}upVector(c,h,w){return Nw(h,w,c,1)}upVectorScale(c){return{metersToTile:mm(f1(ug(c)))}}}function mS(u){const c=u.parallels,h=!!c&&Math.abs(c[0]+c[1])<.01;switch(u.name){case"mercator":return new dS(u);case"equirectangular":return new vT(u);case"naturalEarth":return new wT(u);case"equalEarth":return new yT(u);case"winkelTripel":return new bT(u);case"albers":return h?new gS(u):new _T(u);case"lambertConformalConic":return h?new gS(u):new xT(u);case"globe":return new CT(u)}throw new Error(`Invalid projection name: ${u.name}`)}const ET=N.types,ST=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function GC(u,c,h,w,T,F,Y,ut,di,yi,kn,So,sa){const al=ut?Math.min(dw,Math.round(ut[0])):0,cl=ut?Math.min(dw,Math.round(ut[1])):0;u.emplaceBack(c,h,Math.round(32*w),Math.round(32*T),F,Y,(al<<1)+(di?1:0),cl,16*yi,16*kn,256*So,256*sa)}function zC(u,c,h,w,T,F,Y){u.emplaceBack(c,h,w,T,F,Y)}function VC(u,c,h,w,T){u.emplaceBack(c,h,w,T),u.emplaceBack(c,h,w,T),u.emplaceBack(c,h,w,T),u.emplaceBack(c,h,w,T)}function TT(u){for(const c of u.sections)if(Nd(c.text))return!0;return!1}class CE{constructor(c){this.layoutVertexArray=new Id,this.indexArray=new Bp,this.programConfigurations=c,this.segments=new Kg,this.dynamicLayoutVertexArray=new xd,this.opacityVertexArray=new Gp,this.placedSymbolArray=new pg,this.globeExtVertexArray=new $d}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(c,h,w,T){this.isEmpty()||(w&&(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Qm.members),this.indexBuffer=c.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=c.createVertexBuffer(this.dynamicLayoutVertexArray,D_.members,!0),this.opacityVertexBuffer=c.createVertexBuffer(this.opacityVertexArray,ST,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=c.createVertexBuffer(this.globeExtVertexArray,h_.members,!0)),this.opacityVertexBuffer.itemSize=1),(w||T)&&this.programConfigurations.upload(c))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}vs(CE,"SymbolBuffers");class EE{constructor(c,h,w){this.layoutVertexArray=new c,this.layoutAttributes=h,this.indexArray=new w,this.segments=new Kg,this.collisionVertexArray=new rg,this.collisionVertexArrayExt=new Jf}upload(c){this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=c.createVertexBuffer(this.collisionVertexArray,Cm.members,!0),this.collisionVertexBufferExt=c.createVertexBuffer(this.collisionVertexArrayExt,e_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}vs(EE,"CollisionBuffers");class fw{constructor(c){this.collisionBoxArray=c.collisionBoxArray,this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(Y=>Y.id),this.index=c.index,this.pixelRatio=c.pixelRatio,this.sourceLayerIndex=c.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=dv([]),this.placementViewportMatrix=dv([]);const h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Qg(this.zoom,h["text-size"]),this.iconSizeData=Qg(this.zoom,h["icon-size"]);const w=this.layers[0].layout,T=w.get("symbol-sort-key"),F=w.get("symbol-z-order");this.canOverlap=w.get("text-allow-overlap")||w.get("icon-allow-overlap")||w.get("text-ignore-placement")||w.get("icon-ignore-placement"),this.sortFeaturesByKey=F!=="viewport-y"&&T.constantOr(1)!==void 0,this.sortFeaturesByY=(F==="viewport-y"||F==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=w.get("text-writing-mode").map(Y=>vv[Y]),this.stateDependentLayerIds=this.layers.filter(Y=>Y.isStateDependent()).map(Y=>Y.id),this.sourceID=c.sourceID,this.projection=c.projection}createArrays(){this.text=new CE(new Sy(this.layers,this.zoom,c=>/^text/.test(c))),this.icon=new CE(new Sy(this.layers,this.zoom,c=>/^icon/.test(c))),this.glyphOffsetArray=new u_,this.lineVertexArray=new Kv,this.symbolInstances=new Pg}calculateGlyphDependencies(c,h,w,T,F){for(let Y=0;Y<c.length;Y++)if(h[c.charCodeAt(Y)]=!0,T&&F){const ut=Mm[c.charAt(Y)];ut&&(h[ut.charCodeAt(0)]=!0)}}populate(c,h,w,T){const F=this.layers[0],Y=F.layout,ut=this.projection.name==="globe",di=Y.get("text-font"),yi=Y.get("text-field"),kn=Y.get("icon-image"),So=(yi.value.kind!=="constant"||yi.value.value instanceof pm&&!yi.value.value.isEmpty()||yi.value.value.toString().length>0)&&(di.value.kind!=="constant"||di.value.value.length>0),sa=kn.value.kind!=="constant"||!!kn.value.value||Object.keys(kn.parameters).length>0,al=Y.get("symbol-sort-key");if(this.features=[],!So&&!sa)return;const cl=h.iconDependencies,eh=h.glyphDependencies,fh=h.availableImages,Ch=new Gn(this.zoom);for(const{feature:Gh,id:Eh,index:kh,sourceLayerIndex:jh}of c){const Hh=F._featureFilter.needGeometry,ud=Lx(Gh,Hh);if(!F._featureFilter.filter(Ch,ud,w))continue;if(Hh||(ud.geometry=fv(Gh,w,T)),ut&&Gh.type!==1&&w.z<=5){const gd=ud.geometry,Pd=.98078528056,Dd=(Gd,Zd)=>Ay(Nw(Gd.x,Gd.y,w,1),Nw(Zd.x,Zd.y,w,1))<Pd;for(let Gd=0;Gd<gd.length;Gd++)gd[Gd]=oE(gd[Gd],Dd)}let sd,Cd;if(So){const gd=F.getValueAndResolveTokens("text-field",ud,w,fh),Pd=pm.factory(gd);TT(Pd)&&(this.hasRTLText=!0),(!this.hasRTLText||kt()==="unavailable"||this.hasRTLText&&or.isParsed())&&(sd=i_(Pd,F,ud))}if(sa){const gd=F.getValueAndResolveTokens("icon-image",ud,w,fh);Cd=gd instanceof Vm?gd:Vm.fromString(gd)}if(!sd&&!Cd)continue;const jd=this.sortFeaturesByKey?al.evaluate(ud,{},w):void 0;if(this.features.push({id:Eh,text:sd,icon:Cd,index:kh,sourceLayerIndex:jh,geometry:ud.geometry,properties:Gh.properties,type:ET[Gh.type],sortKey:jd}),Cd&&(cl[Cd.name]=!0),sd){const gd=di.evaluate(ud,{},w).join(","),Pd=Y.get("text-rotation-alignment")==="map"&&Y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(vv.vertical)>=0;for(const Dd of sd.sections)if(Dd.image)cl[Dd.image.name]=!0;else{const Gd=Rh(sd.toString()),Zd=Dd.fontStack||gd,yd=eh[Zd]=eh[Zd]||{};this.calculateGlyphDependencies(Dd.text,yd,Pd,this.allowVerticalPlacement,Gd)}}}Y.get("symbol-placement")==="line"&&(this.features=function(Gh){const Eh={},kh={},jh=[];let Hh=0;function ud(gd){jh.push(Gh[gd]),Hh++}function sd(gd,Pd,Dd){const Gd=kh[gd];return delete kh[gd],kh[Pd]=Gd,jh[Gd].geometry[0].pop(),jh[Gd].geometry[0]=jh[Gd].geometry[0].concat(Dd[0]),Gd}function Cd(gd,Pd,Dd){const Gd=Eh[Pd];return delete Eh[Pd],Eh[gd]=Gd,jh[Gd].geometry[0].shift(),jh[Gd].geometry[0]=Dd[0].concat(jh[Gd].geometry[0]),Gd}function jd(gd,Pd,Dd){const Gd=Dd?Pd[0][Pd[0].length-1]:Pd[0][0];return`${gd}:${Gd.x}:${Gd.y}`}for(let gd=0;gd<Gh.length;gd++){const Pd=Gh[gd],Dd=Pd.geometry,Gd=Pd.text?Pd.text.toString():null;if(!Gd){ud(gd);continue}const Zd=jd(Gd,Dd),yd=jd(Gd,Dd,!0);if(Zd in kh&&yd in Eh&&kh[Zd]!==Eh[yd]){const dp=Cd(Zd,yd,Dd),Lp=sd(Zd,yd,jh[dp].geometry);delete Eh[Zd],delete kh[yd],kh[jd(Gd,jh[Lp].geometry,!0)]=Lp,jh[dp].geometry=null}else Zd in kh?sd(Zd,yd,Dd):yd in Eh?Cd(Zd,yd,Dd):(ud(gd),Eh[Zd]=Hh-1,kh[yd]=Hh-1)}return jh.filter(gd=>gd.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Gh,Eh)=>Gh.sortKey-Eh.sortKey)}update(c,h,w,T){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(c,h,this.layers,w,T),this.icon.programConfigurations.updatePaintArrays(c,h,this.layers,w,T))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(c){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(c),this.iconCollisionBox.upload(c)),this.text.upload(c,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(c,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=mS(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(c,h){const w=this.lineVertexArray.length;if(c.segment!==void 0)for(const{x:T,y:F}of h)this.lineVertexArray.emplaceBack(T,F);return{lineStartIndex:w,lineLength:this.lineVertexArray.length-w}}addSymbols(c,h,w,T,F,Y,ut,di,yi,kn,So,sa,al,cl){const eh=c.indexArray,fh=c.layoutVertexArray,Ch=c.globeExtVertexArray,Gh=c.segments.prepareSegment(4*h.length,fh,eh,this.canOverlap?Y.sortKey:void 0),Eh=this.glyphOffsetArray.length,kh=Gh.vertexLength,jh=this.allowVerticalPlacement&&ut===vv.vertical?Math.PI/2:0,Hh=Y.text&&Y.text.sections;for(let sd=0;sd<h.length;sd++){const{tl:Cd,tr:jd,bl:gd,br:Pd,tex:Dd,pixelOffsetTL:Gd,pixelOffsetBR:Zd,minFontScaleX:yd,minFontScaleY:dp,glyphOffset:Lp,isSDF:mp,sectionIndex:Zf}=h[sd],Qd=Gh.vertexLength,qp=Lp[1];if(GC(fh,yi.x,yi.y,Cd.x,qp+Cd.y,Dd.x,Dd.y,w,mp,Gd.x,Gd.y,yd,dp),GC(fh,yi.x,yi.y,jd.x,qp+jd.y,Dd.x+Dd.w,Dd.y,w,mp,Zd.x,Gd.y,yd,dp),GC(fh,yi.x,yi.y,gd.x,qp+gd.y,Dd.x,Dd.y+Dd.h,w,mp,Gd.x,Zd.y,yd,dp),GC(fh,yi.x,yi.y,Pd.x,qp+Pd.y,Dd.x+Dd.w,Dd.y+Dd.h,w,mp,Zd.x,Zd.y,yd,dp),di){const{x:Xf,y:vg,z:Yf}=di.anchor,[Gf,qg,Qf]=di.up;zC(Ch,Xf,vg,Yf,Gf,qg,Qf),zC(Ch,Xf,vg,Yf,Gf,qg,Qf),zC(Ch,Xf,vg,Yf,Gf,qg,Qf),zC(Ch,Xf,vg,Yf,Gf,qg,Qf),VC(c.dynamicLayoutVertexArray,Xf,vg,Yf,jh)}else VC(c.dynamicLayoutVertexArray,yi.x,yi.y,yi.z,jh);eh.emplaceBack(Qd,Qd+1,Qd+2),eh.emplaceBack(Qd+1,Qd+2,Qd+3),Gh.vertexLength+=4,Gh.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Lp[0]),sd!==h.length-1&&Zf===h[sd+1].sectionIndex||c.programConfigurations.populatePaintArrays(fh.length,Y,Y.index,{},al,cl,Hh&&Hh[Zf])}const ud=di?di.anchor:yi;c.placedSymbolArray.emplaceBack(ud.x,ud.y,ud.z,yi.x,yi.y,Eh,this.glyphOffsetArray.length-Eh,kh,kn,So,yi.segment,w?w[0]:0,w?w[1]:0,T[0],T[1],ut,0,!1,0,sa,0)}_commitLayoutVertex(c,h,w,T,F,Y,ut){c.emplaceBack(h,w,T,F,Y,Math.round(ut.x),Math.round(ut.y))}_addCollisionDebugVertices(c,h,w,T,F,Y,ut){const di=w.segments.prepareSegment(4,w.layoutVertexArray,w.indexArray),yi=di.vertexLength,kn=ut.tileAnchorX,So=ut.tileAnchorY;for(let al=0;al<4;al++)w.collisionVertexArray.emplaceBack(0,0,0,0);w.collisionVertexArrayExt.emplaceBack(h,-c.padding,-c.padding),w.collisionVertexArrayExt.emplaceBack(h,c.padding,-c.padding),w.collisionVertexArrayExt.emplaceBack(h,c.padding,c.padding),w.collisionVertexArrayExt.emplaceBack(h,-c.padding,c.padding),this._commitLayoutVertex(w.layoutVertexArray,T,F,Y,kn,So,new ll(c.x1,c.y1)),this._commitLayoutVertex(w.layoutVertexArray,T,F,Y,kn,So,new ll(c.x2,c.y1)),this._commitLayoutVertex(w.layoutVertexArray,T,F,Y,kn,So,new ll(c.x2,c.y2)),this._commitLayoutVertex(w.layoutVertexArray,T,F,Y,kn,So,new ll(c.x1,c.y2)),di.vertexLength+=4;const sa=w.indexArray;sa.emplaceBack(yi,yi+1),sa.emplaceBack(yi+1,yi+2),sa.emplaceBack(yi+2,yi+3),sa.emplaceBack(yi+3,yi),di.primitiveLength+=4}_addTextDebugCollisionBoxes(c,h,w,T,F,Y){for(let ut=T;ut<F;ut++){const di=w.get(ut),yi=this.getSymbolInstanceTextSize(c,Y,h,ut);this._addCollisionDebugVertices(di,yi,this.textCollisionBox,di.projectedAnchorX,di.projectedAnchorY,di.projectedAnchorZ,Y)}}_addIconDebugCollisionBoxes(c,h,w,T,F,Y){for(let ut=T;ut<F;ut++){const di=w.get(ut),yi=this.getSymbolInstanceIconSize(c,h,Y.placedIconSymbolIndex);this._addCollisionDebugVertices(di,yi,this.iconCollisionBox,di.projectedAnchorX,di.projectedAnchorY,di.projectedAnchorZ,Y)}}generateCollisionDebugBuffers(c,h){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new EE(Mp,t_.members,om),this.iconCollisionBox=new EE(Mp,t_.members,om);const w=tg(this.iconSizeData,c),T=tg(this.textSizeData,c);for(let F=0;F<this.symbolInstances.length;F++){const Y=this.symbolInstances.get(F);this._addTextDebugCollisionBoxes(T,c,h,Y.textBoxStartIndex,Y.textBoxEndIndex,Y),this._addTextDebugCollisionBoxes(T,c,h,Y.verticalTextBoxStartIndex,Y.verticalTextBoxEndIndex,Y),this._addIconDebugCollisionBoxes(w,c,h,Y.iconBoxStartIndex,Y.iconBoxEndIndex,Y),this._addIconDebugCollisionBoxes(w,c,h,Y.verticalIconBoxStartIndex,Y.verticalIconBoxEndIndex,Y)}}getSymbolInstanceTextSize(c,h,w,T){const F=this.text.placedSymbolArray.get(h.rightJustifiedTextSymbolIndex>=0?h.rightJustifiedTextSymbolIndex:h.centerJustifiedTextSymbolIndex>=0?h.centerJustifiedTextSymbolIndex:h.leftJustifiedTextSymbolIndex>=0?h.leftJustifiedTextSymbolIndex:h.verticalPlacedTextSymbolIndex>=0?h.verticalPlacedTextSymbolIndex:T),Y=Im(this.textSizeData,c,F)/Ig;return this.tilePixelRatio*Y}getSymbolInstanceIconSize(c,h,w){const T=this.icon.placedSymbolArray.get(w),F=Im(this.iconSizeData,c,T);return this.tilePixelRatio*F}_commitDebugCollisionVertexUpdate(c,h,w){c.emplaceBack(h,-w,-w),c.emplaceBack(h,w,-w),c.emplaceBack(h,w,w),c.emplaceBack(h,-w,w)}_updateTextDebugCollisionBoxes(c,h,w,T,F,Y){for(let ut=T;ut<F;ut++){const di=w.get(ut),yi=this.getSymbolInstanceTextSize(c,Y,h,ut);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,yi,di.padding)}}_updateIconDebugCollisionBoxes(c,h,w,T,F,Y){for(let ut=T;ut<F;ut++){const di=w.get(ut),yi=this.getSymbolInstanceIconSize(c,h,Y);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,yi,di.padding)}}updateCollisionDebugBuffers(c,h){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const w=tg(this.iconSizeData,c),T=tg(this.textSizeData,c);for(let F=0;F<this.symbolInstances.length;F++){const Y=this.symbolInstances.get(F);this._updateTextDebugCollisionBoxes(T,c,h,Y.textBoxStartIndex,Y.textBoxEndIndex,Y),this._updateTextDebugCollisionBoxes(T,c,h,Y.verticalTextBoxStartIndex,Y.verticalTextBoxEndIndex,Y),this._updateIconDebugCollisionBoxes(w,c,h,Y.iconBoxStartIndex,Y.iconBoxEndIndex,Y.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(w,c,h,Y.verticalIconBoxStartIndex,Y.verticalIconBoxEndIndex,Y.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(c,h,w,T,F,Y,ut,di,yi){const kn={};if(h<w){const{x1:So,y1:sa,x2:al,y2:cl,padding:eh,projectedAnchorX:fh,projectedAnchorY:Ch,projectedAnchorZ:Gh,tileAnchorX:Eh,tileAnchorY:kh,featureIndex:jh}=c.get(h);kn.textBox={x1:So,y1:sa,x2:al,y2:cl,padding:eh,projectedAnchorX:fh,projectedAnchorY:Ch,projectedAnchorZ:Gh,tileAnchorX:Eh,tileAnchorY:kh},kn.textFeatureIndex=jh}if(T<F){const{x1:So,y1:sa,x2:al,y2:cl,padding:eh,projectedAnchorX:fh,projectedAnchorY:Ch,projectedAnchorZ:Gh,tileAnchorX:Eh,tileAnchorY:kh,featureIndex:jh}=c.get(T);kn.verticalTextBox={x1:So,y1:sa,x2:al,y2:cl,padding:eh,projectedAnchorX:fh,projectedAnchorY:Ch,projectedAnchorZ:Gh,tileAnchorX:Eh,tileAnchorY:kh},kn.verticalTextFeatureIndex=jh}if(Y<ut){const{x1:So,y1:sa,x2:al,y2:cl,padding:eh,projectedAnchorX:fh,projectedAnchorY:Ch,projectedAnchorZ:Gh,tileAnchorX:Eh,tileAnchorY:kh,featureIndex:jh}=c.get(Y);kn.iconBox={x1:So,y1:sa,x2:al,y2:cl,padding:eh,projectedAnchorX:fh,projectedAnchorY:Ch,projectedAnchorZ:Gh,tileAnchorX:Eh,tileAnchorY:kh},kn.iconFeatureIndex=jh}if(di<yi){const{x1:So,y1:sa,x2:al,y2:cl,padding:eh,projectedAnchorX:fh,projectedAnchorY:Ch,projectedAnchorZ:Gh,tileAnchorX:Eh,tileAnchorY:kh,featureIndex:jh}=c.get(di);kn.verticalIconBox={x1:So,y1:sa,x2:al,y2:cl,padding:eh,projectedAnchorX:fh,projectedAnchorY:Ch,projectedAnchorZ:Gh,tileAnchorX:Eh,tileAnchorY:kh},kn.verticalIconFeatureIndex=jh}return kn}deserializeCollisionBoxes(c){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const w=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(c,w.textBoxStartIndex,w.textBoxEndIndex,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w.iconBoxStartIndex,w.iconBoxEndIndex,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(c,h){const w=c.placedSymbolArray.get(h),T=w.vertexStartIndex+4*w.numGlyphs;for(let F=w.vertexStartIndex;F<T;F+=4)c.indexArray.emplaceBack(F,F+1,F+2),c.indexArray.emplaceBack(F+1,F+2,F+3)}getSortedSymbolIndexes(c){if(this.sortedAngle===c&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const h=Math.sin(c),w=Math.cos(c),T=[],F=[],Y=[];for(let ut=0;ut<this.symbolInstances.length;++ut){Y.push(ut);const di=this.symbolInstances.get(ut);T.push(0|Math.round(h*di.tileAnchorX+w*di.tileAnchorY)),F.push(di.featureIndex)}return Y.sort((ut,di)=>T[ut]-T[di]||F[di]-F[ut]),Y}addToSortKeyRanges(c,h){const w=this.sortKeyRanges[this.sortKeyRanges.length-1];w&&w.sortKey===h?w.symbolInstanceEnd=c+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:c,symbolInstanceEnd:c+1})}sortFeatures(c){if(this.sortFeaturesByY&&this.sortedAngle!==c&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(c),this.sortedAngle=c,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const w=this.symbolInstances.get(h);this.featureSortOrder.push(w.featureIndex);const{rightJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:F,leftJustifiedTextSymbolIndex:Y,verticalPlacedTextSymbolIndex:ut,placedIconSymbolIndex:di,verticalPlacedIconSymbolIndex:yi}=w;T>=0&&this.addIndicesForPlacedSymbol(this.text,T),F>=0&&F!==T&&this.addIndicesForPlacedSymbol(this.text,F),Y>=0&&Y!==F&&Y!==T&&this.addIndicesForPlacedSymbol(this.text,Y),ut>=0&&this.addIndicesForPlacedSymbol(this.text,ut),di>=0&&this.addIndicesForPlacedSymbol(this.icon,di),yi>=0&&this.addIndicesForPlacedSymbol(this.icon,yi)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}vs(fw,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),fw.MAX_GLYPHS=65535,fw.addDynamicAttributes=VC;const AT=new Sh({"symbol-placement":new _l(hd.layout_symbol["symbol-placement"]),"symbol-spacing":new _l(hd.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new _l(hd.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new mh(hd.layout_symbol["symbol-sort-key"]),"symbol-z-order":new _l(hd.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new _l(hd.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new _l(hd.layout_symbol["icon-ignore-placement"]),"icon-optional":new _l(hd.layout_symbol["icon-optional"]),"icon-rotation-alignment":new _l(hd.layout_symbol["icon-rotation-alignment"]),"icon-size":new mh(hd.layout_symbol["icon-size"]),"icon-text-fit":new _l(hd.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new _l(hd.layout_symbol["icon-text-fit-padding"]),"icon-image":new mh(hd.layout_symbol["icon-image"]),"icon-rotate":new mh(hd.layout_symbol["icon-rotate"]),"icon-padding":new _l(hd.layout_symbol["icon-padding"]),"icon-keep-upright":new _l(hd.layout_symbol["icon-keep-upright"]),"icon-offset":new mh(hd.layout_symbol["icon-offset"]),"icon-anchor":new mh(hd.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new _l(hd.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new _l(hd.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new _l(hd.layout_symbol["text-rotation-alignment"]),"text-field":new mh(hd.layout_symbol["text-field"]),"text-font":new mh(hd.layout_symbol["text-font"]),"text-size":new mh(hd.layout_symbol["text-size"]),"text-max-width":new mh(hd.layout_symbol["text-max-width"]),"text-line-height":new mh(hd.layout_symbol["text-line-height"]),"text-letter-spacing":new mh(hd.layout_symbol["text-letter-spacing"]),"text-justify":new mh(hd.layout_symbol["text-justify"]),"text-radial-offset":new mh(hd.layout_symbol["text-radial-offset"]),"text-variable-anchor":new _l(hd.layout_symbol["text-variable-anchor"]),"text-anchor":new mh(hd.layout_symbol["text-anchor"]),"text-max-angle":new _l(hd.layout_symbol["text-max-angle"]),"text-writing-mode":new _l(hd.layout_symbol["text-writing-mode"]),"text-rotate":new mh(hd.layout_symbol["text-rotate"]),"text-padding":new _l(hd.layout_symbol["text-padding"]),"text-keep-upright":new _l(hd.layout_symbol["text-keep-upright"]),"text-transform":new mh(hd.layout_symbol["text-transform"]),"text-offset":new mh(hd.layout_symbol["text-offset"]),"text-allow-overlap":new _l(hd.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new _l(hd.layout_symbol["text-ignore-placement"]),"text-optional":new _l(hd.layout_symbol["text-optional"])});var SE={paint:new Sh({"icon-opacity":new mh(hd.paint_symbol["icon-opacity"]),"icon-color":new mh(hd.paint_symbol["icon-color"]),"icon-halo-color":new mh(hd.paint_symbol["icon-halo-color"]),"icon-halo-width":new mh(hd.paint_symbol["icon-halo-width"]),"icon-halo-blur":new mh(hd.paint_symbol["icon-halo-blur"]),"icon-translate":new _l(hd.paint_symbol["icon-translate"]),"icon-translate-anchor":new _l(hd.paint_symbol["icon-translate-anchor"]),"text-opacity":new mh(hd.paint_symbol["text-opacity"]),"text-color":new mh(hd.paint_symbol["text-color"],{runtimeType:Wm,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new mh(hd.paint_symbol["text-halo-color"]),"text-halo-width":new mh(hd.paint_symbol["text-halo-width"]),"text-halo-blur":new mh(hd.paint_symbol["text-halo-blur"]),"text-translate":new _l(hd.paint_symbol["text-translate"]),"text-translate-anchor":new _l(hd.paint_symbol["text-translate-anchor"])}),layout:AT};class _S{constructor(c){this.type=c.property.overrides?c.property.overrides.runtimeType:lg,this.defaultValue=c}evaluate(c){if(c.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(c.formattedSection))return h.getOverride(c.formattedSection)}return c.feature&&c.featureState?this.defaultValue.evaluate(c.feature,c.featureState):this.defaultValue.property.specification.default}eachChild(c){this.defaultValue.isConstant()||c(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}vs(_S,"FormatSectionOverride",{omit:["defaultValue"]});class UC extends M_{constructor(c){super(c,SE)}recalculate(c,h){super.recalculate(c,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const w=this.layout.get("text-writing-mode");if(w){const T=[];for(const F of w)T.indexOf(F)<0&&T.push(F);this.layout._values["text-writing-mode"]=T}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(c,h,w,T){const F=this.layout.get(c).evaluate(h,{},w,T),Y=this._unevaluatedLayout._values[c];return Y.isDataDriven()||ty(Y.value)||!F?F:function(ut,di){return di.replace(/{([^{}]+)}/g,(yi,kn)=>kn in ut?String(ut[kn]):"")}(h.properties,F)}createBucket(c){return new fw(c)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const c of SE.paint.overridableProperties){if(!UC.hasPaintOverride(this.layout,c))continue;const h=this.paint.get(c),w=new _S(h),T=new Uv(w,h.property.specification);let F=null;F=h.value.kind==="constant"||h.value.kind==="source"?new ex("source",T):new Bm("composite",T,h.value.zoomStops,h.value._interpolationType),this.paint._values[c]=new _h(h.property,F,h.parameters)}}_handleOverridablePaintPropertyUpdate(c,h,w){return!(!this.layout||h.isDataDriven()||w.isDataDriven())&&UC.hasPaintOverride(this.layout,c)}static hasPaintOverride(c,h){const w=c.get("text-field"),T=SE.paint.properties[h];let F=!1;const Y=ut=>{for(const di of ut)if(T.overrides&&T.overrides.hasOverride(di))return void(F=!0)};if(w.value.kind==="constant"&&w.value.value instanceof pm)Y(w.value.value.sections);else if(w.value.kind==="source"){const ut=yi=>{F||(yi instanceof q_&&zg(yi.value)===Ny?Y(yi.value.sections):yi instanceof T_?Y(yi.sections):yi.eachChild(ut))},di=w.value;di._styleExpression&&ut(di._styleExpression.expression)}return F}getProgramConfiguration(c){return new sx(this,c)}}var RT={paint:new Sh({"background-color":new _l(hd.paint_background["background-color"]),"background-pattern":new _l(hd.paint_background["background-pattern"]),"background-opacity":new _l(hd.paint_background["background-opacity"])})},IT={paint:new Sh({"raster-opacity":new _l(hd.paint_raster["raster-opacity"]),"raster-hue-rotate":new _l(hd.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new _l(hd.paint_raster["raster-brightness-min"]),"raster-brightness-max":new _l(hd.paint_raster["raster-brightness-max"]),"raster-saturation":new _l(hd.paint_raster["raster-saturation"]),"raster-contrast":new _l(hd.paint_raster["raster-contrast"]),"raster-resampling":new _l(hd.paint_raster["raster-resampling"]),"raster-fade-duration":new _l(hd.paint_raster["raster-fade-duration"])})};class MT extends M_{constructor(c){super(c,{}),this.implementation=c}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(c){this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)}onRemove(c){this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)}}var PT={paint:new Sh({"sky-type":new _l(hd.paint_sky["sky-type"]),"sky-atmosphere-sun":new _l(hd.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new _l(hd.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new _l(hd.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new _l(hd.paint_sky["sky-gradient-radius"]),"sky-gradient":new wh(hd.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new _l(hd.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new _l(hd.paint_sky["sky-atmosphere-color"]),"sky-opacity":new _l(hd.paint_sky["sky-opacity"])})};function TE(u,c,h){const w=[0,0,1],T=Jb([]);return eC(T,T,h?-nh(u)+Math.PI:nh(u)),Qb(T,T,-nh(c)),l1(w,w,T),w_(w,w)}const DT={circle:class extends M_{constructor(u){super(u,aC)}createBucket(u){return new Ox(u)}queryRadius(u){const c=u;return Fx("circle-radius",this,c)+Fx("circle-stroke-width",this,c)+Uw(this.paint.get("circle-translate"))}queryIntersectsFeature(u,c,h,w,T,F,Y,ut){const di=_b(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),F.angle,u.pixelToTileUnitsFactor),yi=this.paint.get("circle-radius").evaluate(c,h)+this.paint.get("circle-stroke-width").evaluate(c,h);return lC(u,w,F,Y,ut,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",di,yi)}getProgramIds(){return["circle"]}getProgramConfiguration(u){return new sx(this,u)}},heatmap:class extends M_{createBucket(u){return new hC(u)}constructor(u){super(u,dC),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){u==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=S1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(u){return Fx("heatmap-radius",this,u)}queryIntersectsFeature(u,c,h,w,T,F,Y,ut){const di=this.paint.get("heatmap-radius").evaluate(c,h);return lC(u,w,F,Y,ut,!0,!0,new ll(0,0),di)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(u){return new sx(this,u)}},hillshade:class extends M_{constructor(u){super(u,yb)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends M_{constructor(u){super(u,hE)}getProgramIds(){const u=this.paint.get("fill-pattern"),c=u&&u.constantOr(1),h=[c?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&h.push(c&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),h}getProgramConfiguration(u){return new sx(this,u)}recalculate(u,c){super.recalculate(u,c);const h=this.paint._values["fill-outline-color"];h.value.kind==="constant"&&h.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(u){return new Xw(u)}queryRadius(){return Uw(this.paint.get("fill-translate"))}queryIntersectsFeature(u,c,h,w,T,F){return!u.queryGeometry.isAboveHorizon&&fb(w1(u.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),F.angle,u.pixelToTileUnitsFactor),w)}isTileClipped(){return!0}},"fill-extrusion":class extends M_{constructor(u){super(u,ld)}createBucket(u){return new hl(u)}queryRadius(){return Uw(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(u){return new sx(this,u)}queryIntersectsFeature(u,c,h,w,T,F,Y,ut,di){const yi=_b(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),F.angle,u.pixelToTileUnitsFactor),kn=this.paint.get("fill-extrusion-height").evaluate(c,h),So=this.paint.get("fill-extrusion-base").evaluate(c,h),sa=[0,0],al=ut&&F.elevation,cl=F.elevation?F.elevation.exaggeration():1,eh=u.tile.getBucket(this);if(al&&eh instanceof hl){const kh=eh.centroidVertexArray,jh=di+1;jh<kh.length&&(sa[0]=kh.geta_centroid_pos0(jh),sa[1]=kh.geta_centroid_pos1(jh))}if(sa[0]===0&&sa[1]===1)return!1;F.projection.name==="globe"&&(w=Jh([w],[new ll(0,0),new ll(jp,jp)],u.tileID.canonical).map(kh=>kh.polygon).flat());const fh=al?ut:null,[Ch,Gh]=function(kh,jh,Hh,ud,sd,Cd,jd,gd,Pd,Dd,Gd){return kh.projection.name==="globe"?function(Zd,yd,dp,Lp,mp,Zf,Qd,qp,Xf,vg,Yf){const Gf=[],qg=[],Qf=Zd.projection.upVectorScale(Yf,Zd.center.lat,Zd.worldSize).metersToTile,eg=[0,0,0,1],Fg=[0,0,0,1],$g=(Ng,rm,vm,Pm)=>{Ng[0]=rm,Ng[1]=vm,Ng[2]=Pm,Ng[3]=1},Hg=Xh();dp>0&&(dp+=Hg),Lp+=Hg;for(const Ng of yd){const rm=[],vm=[];for(const Pm of Ng){const kg=Pm.x+mp.x,zm=Pm.y+mp.y,Dm=Zd.projection.projectTilePoint(kg,zm,Yf),um=Zd.projection.upVector(Yf,Pm.x,Pm.y);let wg=dp,Lm=Lp;if(Qd){const jg=vp(kg,zm,dp,Lp,Qd,qp,Xf,vg);wg+=jg.base,Lm+=jg.top}dp!==0?$g(eg,Dm.x+um[0]*Qf*wg,Dm.y+um[1]*Qf*wg,Dm.z+um[2]*Qf*wg):$g(eg,Dm.x,Dm.y,Dm.z),$g(Fg,Dm.x+um[0]*Qf*Lm,Dm.y+um[1]*Qf*Lm,Dm.z+um[2]*Qf*Lm),sm(eg,eg,Zf),sm(Fg,Fg,Zf),rm.push(new hp(eg[0],eg[1],eg[2])),vm.push(new hp(Fg[0],Fg[1],Fg[2]))}Gf.push(rm),qg.push(vm)}return[Gf,qg]}(kh,jh,Hh,ud,sd,Cd,jd,gd,Pd,Dd,Gd):jd?function(Zd,yd,dp,Lp,mp,Zf,Qd,qp,Xf){const vg=[],Yf=[],Gf=[0,0,0,1];for(const qg of Zd){const Qf=[],eg=[];for(const Fg of qg){const $g=Fg.x+Lp.x,Hg=Fg.y+Lp.y,Ng=vp($g,Hg,yd,dp,Zf,Qd,qp,Xf);Gf[0]=$g,Gf[1]=Hg,Gf[2]=Ng.base,Gf[3]=1,pv(Gf,Gf,mp),Gf[3]=Math.max(Gf[3],1e-5);const rm=new hp(Gf[0]/Gf[3],Gf[1]/Gf[3],Gf[2]/Gf[3]);Gf[0]=$g,Gf[1]=Hg,Gf[2]=Ng.top,Gf[3]=1,pv(Gf,Gf,mp),Gf[3]=Math.max(Gf[3],1e-5);const vm=new hp(Gf[0]/Gf[3],Gf[1]/Gf[3],Gf[2]/Gf[3]);Qf.push(rm),eg.push(vm)}vg.push(Qf),Yf.push(eg)}return[vg,Yf]}(jh,Hh,ud,sd,Cd,jd,gd,Pd,Dd):function(Zd,yd,dp,Lp,mp){const Zf=[],Qd=[],qp=mp[8]*yd,Xf=mp[9]*yd,vg=mp[10]*yd,Yf=mp[11]*yd,Gf=mp[8]*dp,qg=mp[9]*dp,Qf=mp[10]*dp,eg=mp[11]*dp;for(const Fg of Zd){const $g=[],Hg=[];for(const Ng of Fg){const rm=Ng.x+Lp.x,vm=Ng.y+Lp.y,Pm=mp[0]*rm+mp[4]*vm+mp[12],kg=mp[1]*rm+mp[5]*vm+mp[13],zm=mp[2]*rm+mp[6]*vm+mp[14],Dm=mp[3]*rm+mp[7]*vm+mp[15],um=Pm+qp,wg=kg+Xf,Lm=zm+vg,jg=Math.max(Dm+Yf,1e-5),H_=Pm+Gf,Om=kg+qg,p_=zm+Qf,r_=Math.max(Dm+eg,1e-5);$g.push(new hp(um/jg,wg/jg,Lm/jg)),Hg.push(new hp(H_/r_,Om/r_,p_/r_))}Zf.push($g),Qd.push(Hg)}return[Zf,Qd]}(jh,Hh,ud,sd,Cd)}(F,w,So,kn,yi,Y,fh,sa,cl,F.center.lat,u.tileID.canonical),Eh=u.queryGeometry;return function(kh,jh,Hh){let ud=1/0;fb(Hh,jh)&&(ud=Sp(Hh,jh[0]));for(let sd=0;sd<jh.length;sd++){const Cd=jh[sd],jd=kh[sd];for(let gd=0;gd<Cd.length-1;gd++){const Pd=Cd[gd],Dd=[Pd,Cd[gd+1],jd[gd+1],jd[gd],Pd];gv(Hh,Dd)&&(ud=Math.min(ud,Sp(Hh,Dd)))}}return ud!==1/0&&ud}(Ch,Gh,Eh.isPointQuery()?Eh.screenBounds:Eh.screenGeometry)}},line:class extends M_{constructor(u){super(u,Hm),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(u){if(u==="line-gradient"){const c=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=c._styleExpression&&c._styleExpression.expression instanceof Pv,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(u,c){super.recalculate(u,c),this.paint._values["line-floorwidth"]=ym.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)}createBucket(u){return new cm(u)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(u){return new sx(this,u)}queryRadius(u){const c=u,h=Rm(Fx("line-width",this,c),Fx("line-gap-width",this,c)),w=Fx("line-offset",this,c);return h/2+Math.abs(w)+Uw(this.paint.get("line-translate"))}queryIntersectsFeature(u,c,h,w,T,F){if(u.queryGeometry.isAboveHorizon)return!1;const Y=w1(u.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),F.angle,u.pixelToTileUnitsFactor),ut=u.pixelToTileUnitsFactor/2*Rm(this.paint.get("line-width").evaluate(c,h),this.paint.get("line-gap-width").evaluate(c,h)),di=this.paint.get("line-offset").evaluate(c,h);return di&&(w=function(yi,kn){const So=[],sa=new ll(0,0);for(let al=0;al<yi.length;al++){const cl=yi[al],eh=[];for(let fh=0;fh<cl.length;fh++){const Ch=cl[fh],Gh=cl[fh+1],Eh=fh===0?sa:Ch.sub(cl[fh-1])._unit()._perp(),kh=fh===cl.length-1?sa:Gh.sub(Ch)._unit()._perp(),jh=Eh._add(kh)._unit();jh._mult(1/(jh.x*kh.x+jh.y*kh.y)),eh.push(jh._mult(kn)._add(Ch))}So.push(eh)}return So}(w,di*u.pixelToTileUnitsFactor)),function(yi,kn,So){for(let sa=0;sa<kn.length;sa++){const al=kn[sa];if(yi.length>=3){for(let cl=0;cl<al.length;cl++)if(P0(yi,al[cl]))return!0}if(gb(yi,al,So))return!0}return!1}(Y,w,ut)}isTileClipped(){return!0}},symbol:UC,background:class extends M_{constructor(u){super(u,RT)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends M_{constructor(u){super(u,IT)}getProgramIds(){return["raster"]}},sky:class extends M_{constructor(u){super(u,PT),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){u==="sky-gradient"?this._updateColorRamp():u!=="sky-atmosphere-sun"&&u!=="sky-atmosphere-halo-color"&&u!=="sky-atmosphere-color"&&u!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=S1({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(u){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const c=u.style.light.properties.get("position");return this._lightPosition.azimuthal!==c.azimuthal||this._lightPosition.polar!==c.polar}return!1}getCenter(u,c){if(this.paint.get("sky-type")==="atmosphere"){const w=this.paint.get("sky-atmosphere-sun"),T=!w,F=u.style.light,Y=F.properties.get("position");return T&&F.properties.get("anchor")==="viewport"&&Ad("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),T?TE(Y.azimuthal,90-Y.polar,c):TE(w[0],90-w[1],c)}const h=this.paint.get("sky-gradient-center");return TE(h[0],90-h[1],c)}is3D(){return!1}isSky(){return!0}markSkyboxValid(u){this._skyboxInvalidated=!1,this._lightPosition=u.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const u=this.paint.get("sky-type");return u==="atmosphere"?["skyboxCapture","skybox"]:u==="gradient"?["skyboxGradient"]:null}}};class Nb{constructor(c,h,w,T){this.context=c,this.format=w,this.texture=c.gl.createTexture(),this.update(h,T)}update(c,h,w){const{width:T,height:F}=c,{context:Y}=this,{gl:ut}=Y,{HTMLImageElement:di,HTMLCanvasElement:yi,HTMLVideoElement:kn,ImageData:So,ImageBitmap:sa}=m;if(ut.bindTexture(ut.TEXTURE_2D,this.texture),Y.pixelStoreUnpackFlipY.set(!1),Y.pixelStoreUnpack.set(1),Y.pixelStoreUnpackPremultiplyAlpha.set(this.format===ut.RGBA&&(!h||h.premultiply!==!1)),w||this.size&&this.size[0]===T&&this.size[1]===F){const{x:al,y:cl}=w||{x:0,y:0};c instanceof di||c instanceof yi||c instanceof kn||c instanceof So||sa&&c instanceof sa?ut.texSubImage2D(ut.TEXTURE_2D,0,al,cl,ut.RGBA,ut.UNSIGNED_BYTE,c):ut.texSubImage2D(ut.TEXTURE_2D,0,al,cl,T,F,ut.RGBA,ut.UNSIGNED_BYTE,c.data)}else this.size=[T,F],c instanceof di||c instanceof yi||c instanceof kn||c instanceof So||sa&&c instanceof sa?ut.texImage2D(ut.TEXTURE_2D,0,this.format,this.format,ut.UNSIGNED_BYTE,c):ut.texImage2D(ut.TEXTURE_2D,0,this.format,T,F,0,this.format,ut.UNSIGNED_BYTE,c.data);this.useMipmap=!!(h&&h.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&ut.generateMipmap(ut.TEXTURE_2D)}bind(c,h){const{context:w}=this,{gl:T}=w;T.bindTexture(T.TEXTURE_2D,this.texture),c!==this.filter&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,c),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,this.useMipmap?c===T.NEAREST?T.NEAREST_MIPMAP_NEAREST:T.LINEAR_MIPMAP_NEAREST:c),this.filter=c),h!==this.wrap&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,h),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:c}=this.context;c.deleteTexture(this.texture),this.texture=null}}class LT{constructor(c){this._callback=c,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class OT{constructor(){this.tasks={},this.taskQueue=[],ep(["process"],this),this.invoker=new LT(this.process),this.nextId=0}add(c,h){const w=this.nextId++,T=function({type:F,isSymbolTile:Y,zoom:ut}){return ut=ut||0,F==="message"?0:F!=="maybePrepare"||Y?F!=="parseTile"||Y?F==="parseTile"&&Y?300-ut:F==="maybePrepare"&&Y?400-ut:500:200-ut:100-ut}(h);if(T===0){rp();try{c()}finally{}return{cancel:()=>{}}}return this.tasks[w]={fn:c,metadata:h,priority:T,id:w},this.taskQueue.push(w),this.invoker.trigger(),{cancel:()=>{delete this.tasks[w]}}}process(){rp();try{if(this.taskQueue=this.taskQueue.filter(w=>!!this.tasks[w]),!this.taskQueue.length)return;const c=this.pick();if(c===null)return;const h=this.tasks[c];if(delete this.tasks[c],this.taskQueue.length&&this.invoker.trigger(),!h)return;h.fn()}finally{}}pick(){let c=null,h=1/0;for(let T=0;T<this.taskQueue.length;T++){const F=this.tasks[this.taskQueue[T]];F.priority<h&&(h=F.priority,c=T)}if(c===null)return null;const w=this.taskQueue[c];return this.taskQueue.splice(c,1),w}remove(){this.invoker.remove()}}class yS{constructor(c){this._stringToNumber={},this._numberToString=[];for(let h=0;h<c.length;h++){const w=c[h];this._stringToNumber[w]=h,this._numberToString[h]=w}}encode(c){return this._stringToNumber[c]}decode(c){return this._numberToString[c]}}const FT=["tile","layer","source","sourceLayer","state"];class vS{constructor(c,h,w,T,F){this.type="Feature",this._vectorTileFeature=c,this._z=h,this._x=w,this._y=T,this.properties=c.properties,this.id=F}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(c){this._geometry=c}toJSON(){const c={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(c.id=this.id);for(const h of FT)this[h]!==void 0&&(c[h]=this[h]);return c}}const s0=32,mx=33,gw=new Uint16Array(8184);for(let u=0;u<2046;u++){let c=u+2,h=0,w=0,T=0,F=0,Y=0,ut=0;for(1&c?T=F=Y=s0:h=w=ut=s0;(c>>=1)>1;){const yi=h+T>>1,kn=w+F>>1;1&c?(T=h,F=w,h=Y,w=ut):(h=T,w=F,T=Y,F=ut),Y=yi,ut=kn}const di=4*u;gw[di+0]=h,gw[di+1]=w,gw[di+2]=T,gw[di+3]=F}const _x=new Uint16Array(2178),mw=new Uint8Array(1089),$C=new Uint16Array(1089);function xS(u){return u===0?-.03125:u===32?.03125:0}var wS=Zh([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const bS={type:2,extent:jp,loadGeometry:()=>[[new ll(0,0),new ll(jp+1,0),new ll(jp+1,jp+1),new ll(0,jp+1),new ll(0,0)]]};class AE{constructor(c,h,w,T,F){this.tileID=c,this.uid=Rd(),this.uses=0,this.tileSize=h,this.tileZoom=w,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=F,this.expiredRequestCount=0,this.state="loading",T&&T.transform&&(this.projection=T.transform.projection)}registerFadeDuration(c){const h=c+this.timeAdded;h<nm.now()||this.fadeEndTime&&h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Jw(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(c,h,w){if(this.unloadVectorData(),this.state="loaded",c){c.featureIndex&&(this.latestFeatureIndex=c.featureIndex,c.rawTileData?(this.latestRawTileData=c.rawTileData,this.latestFeatureIndex.rawTileData=c.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=c.collisionBoxArray,this.buckets=function(T,F){const Y={};if(!F)return Y;for(const ut of T){const di=ut.layerIds.map(yi=>F.getLayer(yi)).filter(Boolean);if(di.length!==0){ut.layers=di,ut.stateDependentLayerIds&&(ut.stateDependentLayers=ut.stateDependentLayerIds.map(yi=>di.filter(kn=>kn.id===yi)[0]));for(const yi of di)Y[yi.id]=ut}}return Y}(c.buckets,h.style),this.hasSymbolBuckets=!1;for(const T in this.buckets){const F=this.buckets[T];if(F instanceof fw){if(this.hasSymbolBuckets=!0,!w)break;F.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const T in this.buckets){const F=this.buckets[T];if(F instanceof fw&&F.hasRTLText){this.hasRTLText=!0,or.isLoading()||or.isLoaded()||kt()!=="deferred"||vi();break}}this.queryPadding=0;for(const T in this.buckets){const F=this.buckets[T];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(T).queryRadius(F))}c.imageAtlas&&(this.imageAtlas=c.imageAtlas),c.glyphAtlasImage&&(this.glyphAtlasImage=c.glyphAtlasImage),c.lineAtlas&&(this.lineAtlas=c.lineAtlas)}else this.collisionBoxArray=new Ag}unloadVectorData(){if(this.hasData()){for(const c in this.buckets)this.buckets[c].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(c){return this.buckets[c.id]}upload(c){for(const w in this.buckets){const T=this.buckets[w];T.uploadPending()&&T.upload(c)}const h=c.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Nb(c,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Nb(c,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Nb(c,this.lineAtlas.image,h.ALPHA),this.lineAtlas.uploaded=!0)}prepare(c){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(c,this.imageAtlasTexture)}queryRenderedFeatures(c,h,w,T,F,Y,ut,di){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:T,pixelPosMatrix:ut,transform:Y,params:F,tileTransform:this.tileTransform},c,h,w):{}}querySourceFeatures(c,h){const w=this.latestFeatureIndex;if(!w||!w.rawTileData)return;const T=w.loadVTLayers(),F=h?h.sourceLayer:"",Y=T._geojsonTileLayer||T[F];if(!Y)return;const ut=Hv(h&&h.filter),{z:di,x:yi,y:kn}=this.tileID.canonical,So={z:di,x:yi,y:kn};for(let sa=0;sa<Y.length;sa++){const al=Y.feature(sa);if(ut.needGeometry){const fh=Lx(al,!0);if(!ut.filter(new Gn(this.tileID.overscaledZ),fh,this.tileID.canonical))continue}else if(!ut.filter(new Gn(this.tileID.overscaledZ),al))continue;const cl=w.getId(al,F),eh=new vS(al,di,yi,kn,cl);eh.tile=So,c.push(eh)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(c){const h=this.expirationTime;if(c.cacheControl){const w=fd(c.cacheControl);w["max-age"]&&(this.expirationTime=Date.now()+1e3*w["max-age"])}else c.expires&&(this.expirationTime=new Date(c.expires).getTime());if(this.expirationTime){const w=Date.now();let T=!1;if(this.expirationTime>w)T=!1;else if(h)if(this.expirationTime<h)T=!0;else{const F=this.expirationTime-h;F?this.expirationTime=w+Math.max(F,3e4):T=!0}else T=!0;T?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(c,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(c).length===0||!h)return;const w=this.latestFeatureIndex.loadVTLayers(),T=h.style.listImages();for(const F in this.buckets){if(!h.style.hasLayer(F))continue;const Y=this.buckets[F],ut=Y.layers[0].sourceLayer||"_geojsonTileLayer",di=w[ut],yi=c[ut];if(!di||!yi||Object.keys(yi).length===0)continue;if(Y.update(yi,di,T,this.imageAtlas&&this.imageAtlas.patternPositions||{}),Y instanceof cm||Y instanceof Xw){const So=h.style._getSourceCache(Y.layers[0].source);h._terrain&&h._terrain.enabled&&So&&Y.programConfigurations.needsUpload&&h._terrain._clearRenderCacheForTile(So.id,this.tileID)}const kn=h&&h.style&&h.style.getLayer(F);kn&&(this.queryPadding=Math.max(this.queryPadding,kn.queryRadius(Y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<nm.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(c){this.symbolFadeHoldUntil=nm.now()+c}setTexture(c,h){const w=h.context,T=w.gl;this.texture=this.texture||h.getTileTexture(c.width),this.texture?this.texture.update(c,{useMipmap:!0}):(this.texture=new Nb(w,c,T.RGBA,{useMipmap:!0}),this.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE))}setDependencies(c,h){const w={};for(const T of h)w[T]=!0;this.dependencies[c]=w}hasDependency(c,h){for(const w of c){const T=this.dependencies[w];if(T){for(const F of h)if(T[F])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(c,h){if(!h||h.name==="mercator"||this._tileDebugBuffer)return;const w=fv(bS,this.tileID.canonical,this.tileTransform)[0],T=new Bd,F=new c_;for(let Y=0;Y<w.length;Y++){const{x:ut,y:di}=w[Y];T.emplaceBack(ut,di),F.emplaceBack(Y)}F.emplaceBack(0),this._tileDebugIndexBuffer=c.createIndexBuffer(F),this._tileDebugBuffer=c.createVertexBuffer(T,Px.members),this._tileDebugSegments=Kg.simpleSegment(0,0,T.length,F.length)}_makeTileBoundsBuffers(c,h){if(this._tileBoundsBuffer||!h||h.name==="mercator")return;const w=fv(bS,this.tileID.canonical,this.tileTransform)[0];let T,F;if(this.isRaster){const Y=function(ut,di){const yi=Jw(ut,di),kn=Math.pow(2,ut.z);for(let fh=0;fh<mx;fh++)for(let Ch=0;Ch<mx;Ch++){const Gh=Gm((ut.x+(Ch+xS(Ch))/s0)/kn),Eh=bm((ut.y+(fh+xS(fh))/s0)/kn),kh=di.project(Gh,Eh),jh=fh*mx+Ch;_x[2*jh+0]=Math.round((kh.x*yi.scale-yi.x)*jp),_x[2*jh+1]=Math.round((kh.y*yi.scale-yi.y)*jp)}mw.fill(0),$C.fill(0);for(let fh=2045;fh>=0;fh--){const Ch=4*fh,Gh=gw[Ch+0],Eh=gw[Ch+1],kh=gw[Ch+2],jh=gw[Ch+3],Hh=Gh+kh>>1,ud=Eh+jh>>1,sd=Hh+ud-Eh,Cd=ud+Gh-Hh,jd=Eh*mx+Gh,gd=jh*mx+kh,Pd=ud*mx+Hh,Dd=Math.hypot((_x[2*jd+0]+_x[2*gd+0])/2-_x[2*Pd+0],(_x[2*jd+1]+_x[2*gd+1])/2-_x[2*Pd+1])>=16;mw[Pd]=mw[Pd]||(Dd?1:0),fh<1022&&(mw[Pd]=mw[Pd]||mw[(Eh+Cd>>1)*mx+(Gh+sd>>1)]||mw[(jh+Cd>>1)*mx+(kh+sd>>1)])}const So=new Sd,sa=new Bp;let al=0;function cl(fh,Ch){const Gh=Ch*mx+fh;return $C[Gh]===0&&(So.emplaceBack(_x[2*Gh+0],_x[2*Gh+1],fh*jp/s0,Ch*jp/s0),$C[Gh]=++al),$C[Gh]-1}function eh(fh,Ch,Gh,Eh,kh,jh){const Hh=fh+Gh>>1,ud=Ch+Eh>>1;if(Math.abs(fh-kh)+Math.abs(Ch-jh)>1&&mw[ud*mx+Hh])eh(kh,jh,fh,Ch,Hh,ud),eh(Gh,Eh,kh,jh,Hh,ud);else{const sd=cl(fh,Ch),Cd=cl(Gh,Eh),jd=cl(kh,jh);sa.emplaceBack(sd,Cd,jd)}}return eh(0,0,s0,s0,s0,0),eh(s0,s0,0,0,0,s0),{vertices:So,indices:sa}}(this.tileID.canonical,h);T=Y.vertices,F=Y.indices}else{T=new Sd,F=new Bp;for(const{x:ut,y:di}of w)T.emplaceBack(ut,di,0,0);const Y=xb(T.int16,void 0,4);for(let ut=0;ut<Y.length;ut+=3)F.emplaceBack(Y[ut],Y[ut+1],Y[ut+2])}this._tileBoundsBuffer=c.createVertexBuffer(T,wS.members),this._tileBoundsIndexBuffer=c.createIndexBuffer(F),this._tileBoundsSegments=Kg.simpleSegment(0,0,T.length,F.length)}_makeGlobeTileDebugBuffers(c,h){const w=h.projection;if(!w||w.name!=="globe"||h.freezeTileCoverage)return;const T=this.tileID.canonical,F=kw(nb(T,h)),Y=ew(h.zoom);let ut;Y>0&&(ut=Mw(new Float64Array(16),h.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(c,T,h,F,ut,Y),this._makeGlobeTileDebugTextBuffer(c,T,h,F,ut,Y)}_globePoint(c,h,w,T,F,Y,ut){let di=Nw(c,h,w);if(Y){const yi=1<<w.z,kn=am(T.center.lng),So=My(T.center.lat),sa=(w.x+.5)/yi-kn;let al=0;sa>.5?al=-1:sa<-.5&&(al=1);let cl=(c/jp+w.x)/yi+al,eh=(h/jp+w.y)/yi;cl=(cl-kn)*T._pixelsPerMercatorPixel+kn,eh=(eh-So)*T._pixelsPerMercatorPixel+So;const fh=[cl*T.worldSize,eh*T.worldSize,0];sm(fh,fh,Y),di=A0(di,fh,ut)}return sm(di,di,F)}_makeGlobeTileDebugBorderBuffer(c,h,w,T,F,Y){const ut=new Bd,di=new c_,yi=new ed,kn=(sa,al,cl,eh,fh)=>{const Ch=(cl-sa)/(fh-1),Gh=(eh-al)/(fh-1),Eh=ut.length;for(let kh=0;kh<fh;kh++){const jh=sa+kh*Ch,Hh=al+kh*Gh;ut.emplaceBack(jh,Hh);const ud=this._globePoint(jh,Hh,h,w,T,F,Y);yi.emplaceBack(ud[0],ud[1],ud[2]),di.emplaceBack(Eh+kh)}},So=jp;kn(0,0,So,0,16),kn(So,0,So,So,16),kn(So,So,0,So,16),kn(0,So,0,0,16),this._tileDebugIndexBuffer=c.createIndexBuffer(di),this._tileDebugBuffer=c.createVertexBuffer(ut,Px.members),this._globeTileDebugBorderBuffer=c.createVertexBuffer(yi,tb.members),this._tileDebugSegments=Kg.simpleSegment(0,0,ut.length,di.length)}_makeGlobeTileDebugTextBuffer(c,h,w,T,F,Y){const ut=jp/4,di=new Bd,yi=new Bp,kn=new ed,So=25;yi.reserve(32),di.reserve(So),kn.reserve(So);const sa=(al,cl)=>So*al+cl;for(let al=0;al<So;al++){const cl=al*ut;for(let eh=0;eh<So;eh++){const fh=eh*ut;di.emplaceBack(fh,cl);const Ch=this._globePoint(fh,cl,h,w,T,F,Y);kn.emplaceBack(Ch[0],Ch[1],Ch[2])}}for(let al=0;al<4;al++)for(let cl=0;cl<4;cl++){const eh=sa(al,cl),fh=sa(al,cl+1),Ch=sa(al+1,cl),Gh=sa(al+1,cl+1);yi.emplaceBack(eh,fh,Ch),yi.emplaceBack(Ch,fh,Gh)}this._tileDebugTextIndexBuffer=c.createIndexBuffer(yi),this._tileDebugTextBuffer=c.createVertexBuffer(di,Px.members),this._globeTileDebugTextBuffer=c.createVertexBuffer(kn,tb.members),this._tileDebugTextSegments=Kg.simpleSegment(0,0,So,32)}}class NT{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(c,h,w){const T=String(h);if(this.stateChanges[c]=this.stateChanges[c]||{},this.stateChanges[c][T]=this.stateChanges[c][T]||{},wd(this.stateChanges[c][T],w),this.deletedStates[c]===null){this.deletedStates[c]={};for(const F in this.state[c])F!==T&&(this.deletedStates[c][F]=null)}else if(this.deletedStates[c]&&this.deletedStates[c][T]===null){this.deletedStates[c][T]={};for(const F in this.state[c][T])w[F]||(this.deletedStates[c][T][F]=null)}else for(const F in w)this.deletedStates[c]&&this.deletedStates[c][T]&&this.deletedStates[c][T][F]===null&&delete this.deletedStates[c][T][F]}removeFeatureState(c,h,w){if(this.deletedStates[c]===null)return;const T=String(h);if(this.deletedStates[c]=this.deletedStates[c]||{},w&&h!==void 0)this.deletedStates[c][T]!==null&&(this.deletedStates[c][T]=this.deletedStates[c][T]||{},this.deletedStates[c][T][w]=null);else if(h!==void 0)if(this.stateChanges[c]&&this.stateChanges[c][T])for(w in this.deletedStates[c][T]={},this.stateChanges[c][T])this.deletedStates[c][T][w]=null;else this.deletedStates[c][T]=null;else this.deletedStates[c]=null}getState(c,h){const w=String(h),T=wd({},(this.state[c]||{})[w],(this.stateChanges[c]||{})[w]);if(this.deletedStates[c]===null)return{};if(this.deletedStates[c]){const F=this.deletedStates[c][h];if(F===null)return{};for(const Y in F)delete T[Y]}return T}initializeTileState(c,h){c.setFeatureState(this.state,h)}coalesceChanges(c,h){const w={};for(const T in this.stateChanges){this.state[T]=this.state[T]||{};const F={};for(const Y in this.stateChanges[T])this.state[T][Y]||(this.state[T][Y]={}),wd(this.state[T][Y],this.stateChanges[T][Y]),F[Y]=this.state[T][Y];w[T]=F}for(const T in this.deletedStates){this.state[T]=this.state[T]||{};const F={};if(this.deletedStates[T]===null)for(const Y in this.state[T])F[Y]={},this.state[T][Y]={};else for(const Y in this.deletedStates[T]){if(this.deletedStates[T][Y]===null)this.state[T][Y]={};else if(this.state[T][Y])for(const ut of Object.keys(this.deletedStates[T][Y]))delete this.state[T][Y][ut];F[Y]=this.state[T][Y]}w[T]=w[T]||{},wd(w[T],F)}if(this.stateChanges={},this.deletedStates={},Object.keys(w).length!==0)for(const T in c)c[T].setFeatureState(w,h)}}class CS{constructor(c){this.size=c,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(c,h){const w=this.toIdx(c,h);return{min:this.minimums[w],max:this.maximums[w]}}isLeaf(c,h){return this.leaves[this.toIdx(c,h)]}toIdx(c,h){return h*this.size+c}}function ES(u,c,h,w){let T=0,F=Number.MAX_VALUE;for(let Y=0;Y<3;Y++)if(Math.abs(w[Y])<1e-15){if(h[Y]<u[Y]||h[Y]>c[Y])return null}else{const ut=1/w[Y];let di=(u[Y]-h[Y])*ut,yi=(c[Y]-h[Y])*ut;if(di>yi){const kn=di;di=yi,yi=kn}if(di>T&&(T=di),yi<F&&(F=yi),T>F)return null}return T}function SS(u,c,h,w,T,F,Y,ut,di,yi,kn){const So=w-u,sa=T-c,al=F-h,cl=Y-u,eh=ut-c,fh=di-h,Ch=kn[1]*fh-kn[2]*eh,Gh=kn[2]*cl-kn[0]*fh,Eh=kn[0]*eh-kn[1]*cl,kh=So*Ch+sa*Gh+al*Eh;if(Math.abs(kh)<1e-15)return null;const jh=1/kh,Hh=yi[0]-u,ud=yi[1]-c,sd=yi[2]-h,Cd=(Hh*Ch+ud*Gh+sd*Eh)*jh;if(Cd<0||Cd>1)return null;const jd=ud*al-sd*sa,gd=sd*So-Hh*al,Pd=Hh*sa-ud*So,Dd=(kn[0]*jd+kn[1]*gd+kn[2]*Pd)*jh;return Dd<0||Cd+Dd>1?null:(cl*jd+eh*gd+fh*Pd)*jh}function TS(u,c,h){return(u-c)/(h-c)}function AS(u,c,h,w,T,F,Y,ut,di){const yi=1<<h,kn=F-w,So=Y-T,sa=(u+1)/yi*kn+w,al=(c+0)/yi*So+T,cl=(c+1)/yi*So+T;ut[0]=(u+0)/yi*kn+w,ut[1]=al,di[0]=sa,di[1]=cl}class RS{constructor(c){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=c,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const h=function(F){const Y=Math.ceil(Math.log2(F.dim/8)),ut=[];let di=Math.ceil(Math.pow(2,Y));const yi=1/di,kn=(al,cl,eh,fh,Ch)=>{const Gh=fh?1:0,Eh=(al+1)*eh-Gh,kh=cl*eh,jh=(cl+1)*eh-Gh;Ch[0]=al*eh,Ch[1]=kh,Ch[2]=Eh,Ch[3]=jh};let So=new CS(di);const sa=[];for(let al=0;al<di*di;al++){kn(al%di,Math.floor(al/di),yi,!1,sa);const cl=_w(sa[0],sa[1],F),eh=_w(sa[2],sa[1],F),fh=_w(sa[2],sa[3],F),Ch=_w(sa[0],sa[3],F);So.minimums.push(Math.min(cl,eh,fh,Ch)),So.maximums.push(Math.max(cl,eh,fh,Ch)),So.leaves.push(1)}for(ut.push(So),di/=2;di>=1;di/=2){const al=ut[ut.length-1];So=new CS(di);for(let cl=0;cl<di*di;cl++){kn(cl%di,Math.floor(cl/di),2,!0,sa);const eh=al.getElevation(sa[0],sa[1]),fh=al.getElevation(sa[2],sa[1]),Ch=al.getElevation(sa[2],sa[3]),Gh=al.getElevation(sa[0],sa[3]),Eh=al.isLeaf(sa[0],sa[1]),kh=al.isLeaf(sa[2],sa[1]),jh=al.isLeaf(sa[2],sa[3]),Hh=al.isLeaf(sa[0],sa[3]),ud=Math.min(eh.min,fh.min,Ch.min,Gh.min),sd=Math.max(eh.max,fh.max,Ch.max,Gh.max),Cd=Eh&&kh&&jh&&Hh;So.maximums.push(sd),So.minimums.push(ud),So.leaves.push(sd-ud<=5&&Cd?1:0)}ut.push(So)}return ut}(this.dem),w=h.length-1,T=h[w];this._addNode(T.minimums[0],T.maximums[0],T.leaves[0]),this._construct(h,0,0,w,0)}raycastRoot(c,h,w,T,F,Y,ut=1){return ES([c,h,-100],[w,T,this.maximums[0]*ut],F,Y)}raycast(c,h,w,T,F,Y,ut=1){if(!this.nodeCount)return null;const di=this.raycastRoot(c,h,w,T,F,Y,ut);if(di==null)return null;const yi=[],kn=[],So=[],sa=[],al=[{idx:0,t:di,nodex:0,nodey:0,depth:0}];for(;al.length>0;){const{idx:cl,t:eh,nodex:fh,nodey:Ch,depth:Gh}=al.pop();if(this.leaves[cl]){AS(fh,Ch,Gh,c,h,w,T,So,sa);const kh=1<<Gh,jh=(fh+0)/kh,Hh=(fh+1)/kh,ud=(Ch+0)/kh,sd=(Ch+1)/kh,Cd=_w(jh,ud,this.dem)*ut,jd=_w(Hh,ud,this.dem)*ut,gd=_w(Hh,sd,this.dem)*ut,Pd=_w(jh,sd,this.dem)*ut,Dd=SS(So[0],So[1],Cd,sa[0],So[1],jd,sa[0],sa[1],gd,F,Y),Gd=SS(sa[0],sa[1],gd,So[0],sa[1],Pd,So[0],So[1],Cd,F,Y),Zd=Math.min(Dd!==null?Dd:Number.MAX_VALUE,Gd!==null?Gd:Number.MAX_VALUE);if(Zd!==Number.MAX_VALUE)return Zd;{const yd=Zx([],F,Y,eh);if(IS(Cd,jd,Pd,gd,TS(yd[0],So[0],sa[0]),TS(yd[1],So[1],sa[1]))>=yd[2])return eh}continue}let Eh=0;for(let kh=0;kh<this._siblingOffset.length;kh++){AS((fh<<1)+this._siblingOffset[kh][0],(Ch<<1)+this._siblingOffset[kh][1],Gh+1,c,h,w,T,So,sa),So[2]=-100,sa[2]=this.maximums[this.childOffsets[cl]+kh]*ut;const jh=ES(So,sa,F,Y);if(jh!=null){const Hh=jh;yi[kh]=Hh;let ud=!1;for(let sd=0;sd<Eh&&!ud;sd++)Hh>=yi[kn[sd]]&&(kn.splice(sd,0,kh),ud=!0);ud||(kn[Eh]=kh),Eh++}}for(let kh=0;kh<Eh;kh++){const jh=kn[kh];al.push({idx:this.childOffsets[cl]+jh,t:yi[jh],nodex:(fh<<1)+this._siblingOffset[jh][0],nodey:(Ch<<1)+this._siblingOffset[jh][1],depth:Gh+1})}}return null}_addNode(c,h,w){return this.minimums.push(c),this.maximums.push(h),this.leaves.push(w),this.childOffsets.push(0),this.nodeCount++}_construct(c,h,w,T,F){if(c[T].isLeaf(h,w)===1)return;this.childOffsets[F]||(this.childOffsets[F]=this.nodeCount);const Y=T-1,ut=c[Y];let di=0,yi=0;for(let kn=0;kn<this._siblingOffset.length;kn++){const So=2*h+this._siblingOffset[kn][0],sa=2*w+this._siblingOffset[kn][1],al=ut.getElevation(So,sa),cl=ut.isLeaf(So,sa),eh=this._addNode(al.min,al.max,cl);cl&&(di|=1<<kn),yi||(yi=eh)}for(let kn=0;kn<this._siblingOffset.length;kn++)di&1<<kn||this._construct(c,2*h+this._siblingOffset[kn][0],2*w+this._siblingOffset[kn][1],Y,yi+kn)}}function IS(u,c,h,w,T,F){return Hp(Hp(u,h,F),Hp(c,w,F),T)}function _w(u,c,h){const w=h.dim,T=td(u*w-.5,0,w-1),F=td(c*w-.5,0,w-1),Y=Math.floor(T),ut=Math.floor(F),di=Math.min(Y+1,w-1),yi=Math.min(ut+1,w-1);return IS(h.get(Y,ut),h.get(di,ut),h.get(Y,yi),h.get(di,yi),T-Y,F-ut)}const MS={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function kT(u,c,h){return(256*u*256+256*c+h)/10-1e4}function BT(u,c,h){return 256*u+c+h/256-32768}class HC{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(c,h,w,T=!1,F=!1){if(this.uid=c,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(w&&w!=="mapbox"&&w!=="terrarium")return Ad(`"${w}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=h.height;const Y=this.dim=h.height-2,ut=new Uint32Array(h.data.buffer);if(this.pixels=new Uint8Array(h.data.buffer),this.encoding=w||"mapbox",this.borderReady=T,!T){for(let di=0;di<Y;di++)ut[this._idx(-1,di)]=ut[this._idx(0,di)],ut[this._idx(Y,di)]=ut[this._idx(Y-1,di)],ut[this._idx(di,-1)]=ut[this._idx(di,0)],ut[this._idx(di,Y)]=ut[this._idx(di,Y-1)];ut[this._idx(-1,-1)]=ut[this._idx(0,0)],ut[this._idx(Y,-1)]=ut[this._idx(Y-1,0)],ut[this._idx(-1,Y)]=ut[this._idx(0,Y-1)],ut[this._idx(Y,Y)]=ut[this._idx(Y-1,Y-1)],F&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new RS(this)}get(c,h,w=!1){w&&(c=td(c,-1,this.dim),h=td(h,-1,this.dim));const T=4*this._idx(c,h);return(this.encoding==="terrarium"?BT:kT)(this.pixels[T],this.pixels[T+1],this.pixels[T+2])}static getUnpackVector(c){return MS[c]}get unpackVector(){return MS[this.encoding]}_idx(c,h){if(c<-1||c>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(c+1)}static pack(c,h){const w=[0,0,0,0],T=HC.getUnpackVector(h);let F=Math.floor((c+T[3])/T[2]);return w[2]=F%256,F=Math.floor(F/256),w[1]=F%256,F=Math.floor(F/256),w[0]=F,w}getPixels(){return new P_({width:this.stride,height:this.stride},this.pixels)}backfillBorder(c,h,w){if(this.dim!==c.dim)throw new Error("dem dimension mismatch");let T=h*this.dim,F=h*this.dim+this.dim,Y=w*this.dim,ut=w*this.dim+this.dim;switch(h){case-1:T=F-1;break;case 1:F=T+1}switch(w){case-1:Y=ut-1;break;case 1:ut=Y+1}const di=-h*this.dim,yi=-w*this.dim;for(let kn=Y;kn<ut;kn++)for(let So=T;So<F;So++){const sa=4*this._idx(So,kn),al=4*this._idx(So+di,kn+yi);this.pixels[sa+0]=c.pixels[al+0],this.pixels[sa+1]=c.pixels[al+1],this.pixels[sa+2]=c.pixels[al+2],this.pixels[sa+3]=c.pixels[al+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}vs(HC,"DEMData"),vs(RS,"DemMinMaxQuadTree",{omit:["dem"]});class GT{constructor(c,h){this.max=c,this.onRemove=h,this.reset()}reset(){for(const c in this.data)for(const h of this.data[c])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(c,h,w){const T=c.wrapped().key;this.data[T]===void 0&&(this.data[T]=[]);const F={value:h,timeout:void 0};if(w!==void 0&&(F.timeout=setTimeout(()=>{this.remove(c,F)},w)),this.data[T].push(F),this.order.push(T),this.order.length>this.max){const Y=this._getAndRemoveByKey(this.order[0]);Y&&this.onRemove(Y)}return this}has(c){return c.wrapped().key in this.data}getAndRemove(c){return this.has(c)?this._getAndRemoveByKey(c.wrapped().key):null}_getAndRemoveByKey(c){const h=this.data[c].shift();return h.timeout&&clearTimeout(h.timeout),this.data[c].length===0&&delete this.data[c],this.order.splice(this.order.indexOf(c),1),h.value}getByKey(c){const h=this.data[c];return h?h[0].value:null}get(c){return this.has(c)?this.data[c.wrapped().key][0].value:null}remove(c,h){if(!this.has(c))return this;const w=c.wrapped().key,T=h===void 0?0:this.data[w].indexOf(h),F=this.data[w][T];return this.data[w].splice(T,1),F.timeout&&clearTimeout(F.timeout),this.data[w].length===0&&delete this.data[w],this.onRemove(F.value),this.order.splice(this.order.indexOf(w),1),this}setMaxSize(c){for(this.max=c;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(c){const h=[];for(const w in this.data)for(const T of this.data[w])c(T.value)||h.push(T);for(const w of h)this.remove(w.value.tileID,w)}}class U1{constructor(c,h,w){this.func=c,this.mask=h,this.range=w}}U1.ReadOnly=!1,U1.ReadWrite=!0,U1.disabled=new U1(519,U1.ReadOnly,[0,1]);const RE=7680;class IE{constructor(c,h,w,T,F,Y){this.test=c,this.ref=h,this.mask=w,this.fail=T,this.depthFail=F,this.pass=Y}}IE.disabled=new IE({func:519,mask:0},0,0,RE,RE,RE);class yx{constructor(c,h,w){this.blendFunction=c,this.blendColor=h,this.mask=w}}yx.Replace=[1,0],yx.disabled=new yx(yx.Replace,Gg.transparent,[!1,!1,!1,!1]),yx.unblended=new yx(yx.Replace,Gg.transparent,[!0,!0,!0,!0]),yx.alphaBlended=new yx([1,771],Gg.transparent,[!0,!0,!0,!0]);const ME=1029,PE=2305;class N0{constructor(c,h,w){this.enable=c,this.mode=h,this.frontFace=w}}N0.disabled=new N0(!1,ME,PE),N0.backCCW=new N0(!0,ME,PE),N0.backCW=new N0(!0,ME,2304),N0.frontCW=new N0(!0,1028,2304),N0.frontCCW=new N0(!0,1028,PE);class Qw extends f_{constructor(c,h,w){super(),this.id=c,this._onlySymbols=w,h.on("data",T=>{T.dataType==="source"&&T.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&T.dataType==="source"&&T.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),h.on("error",()=>{this._sourceErrored=!0}),this._source=h,this._tiles={},this._cache=new GT(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new NT,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(c){this.map=c,this._minTileCacheSize=this._minTileCacheSize===void 0&&c?c._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&c?c._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const c in this._tiles){const h=this._tiles[c];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(c,h){return c.isSymbolTile=this._onlySymbols,this._source.loadTile(c,h)}_unloadTile(c){if(this._source.unloadTile)return this._source.unloadTile(c,()=>{})}_abortTile(c){if(this._source.abortTile)return this._source.abortTile(c,()=>{})}serialize(){return this._source.serialize()}prepare(c){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const w=this._tiles[h];w.upload(c),w.prepare(this.map.style.imageManager)}}getIds(){return Xd(this._tiles).map(c=>c.tileID).sort(PS).map(c=>c.key)}getRenderableIds(c){const h=[];for(const w in this._tiles)this._isIdRenderable(+w,c)&&h.push(this._tiles[w]);return c?h.sort((w,T)=>{const F=w.tileID,Y=T.tileID,ut=new ll(F.canonical.x,F.canonical.y)._rotate(this.transform.angle),di=new ll(Y.canonical.x,Y.canonical.y)._rotate(this.transform.angle);return F.overscaledZ-Y.overscaledZ||di.y-ut.y||di.x-ut.x}).map(w=>w.tileID.key):h.map(w=>w.tileID).sort(PS).map(w=>w.key)}hasRenderableParent(c){const h=this.findLoadedParent(c,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(c,h){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(h||!this._tiles[c].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const c in this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(+c,"reloading")}}_reloadTile(c,h){const w=this._tiles[c];w&&(w.state!=="loading"&&(w.state=h),this._loadTile(w,this._tileLoaded.bind(this,w,c,h)))}_tileLoaded(c,h,w,T){if(T)if(c.state="errored",T.status!==404)this._source.fire(new s_(T,{tile:c}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const F=this.map.painter.terrain;this.update(this.transform,F.getScaledDemTileSize(),!0),F.resetTileLookupCache(this.id)}else this.update(this.transform);else c.timeAdded=nm.now(),w==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(h,c),this._source.type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new Dg("data",{dataType:"source",tile:c,coord:c.tileID,sourceCacheId:this.id}))}_backfillDEM(c){const h=this.getRenderableIds();for(let T=0;T<h.length;T++){const F=h[T];if(c.neighboringTiles&&c.neighboringTiles[F]){const Y=this.getTileByID(F);w(c,Y),w(Y,c)}}function w(T,F){if(!T.dem||T.dem.borderReady)return;T.needsHillshadePrepare=!0,T.needsDEMTextureUpload=!0;let Y=F.tileID.canonical.x-T.tileID.canonical.x;const ut=F.tileID.canonical.y-T.tileID.canonical.y,di=Math.pow(2,T.tileID.canonical.z),yi=F.tileID.key;Y===0&&ut===0||Math.abs(ut)>1||(Math.abs(Y)>1&&(Math.abs(Y+di)===1?Y+=di:Math.abs(Y-di)===1&&(Y-=di)),F.dem&&T.dem&&(T.dem.backfillBorder(F.dem,Y,ut),T.neighboringTiles&&T.neighboringTiles[yi]&&(T.neighboringTiles[yi].backfilled=!0)))}}getTile(c){return this.getTileByID(c.key)}getTileByID(c){return this._tiles[c]}_retainLoadedChildren(c,h,w,T){for(const F in this._tiles){let Y=this._tiles[F];if(T[F]||!Y.hasData()||Y.tileID.overscaledZ<=h||Y.tileID.overscaledZ>w)continue;let ut=Y.tileID;for(;Y&&Y.tileID.overscaledZ>h+1;){const yi=Y.tileID.scaledTo(Y.tileID.overscaledZ-1);Y=this._tiles[yi.key],Y&&Y.hasData()&&(ut=yi)}let di=ut;for(;di.overscaledZ>h;)if(di=di.scaledTo(di.overscaledZ-1),c[di.key]){T[ut.key]=ut;break}}}findLoadedParent(c,h){if(c.key in this._loadedParentTiles){const w=this._loadedParentTiles[c.key];return w&&w.tileID.overscaledZ>=h?w:null}for(let w=c.overscaledZ-1;w>=h;w--){const T=c.scaledTo(w),F=this._getLoadedTile(T);if(F)return F}}_getLoadedTile(c){const h=this._tiles[c.key];return h&&h.hasData()?h:this._cache.getByKey(this._source.reparseOverscaled?c.wrapped().key:c.canonical.key)}updateCacheSize(c,h){h=h||this._source.tileSize;const w=Math.ceil(c.width/h)+1,T=Math.ceil(c.height/h)+1,F=Math.floor(w*T*5),Y=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,F):F,ut=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,Y):Y;this._cache.setMaxSize(ut)}handleWrapJump(c){const h=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,h){const w={};for(const T in this._tiles){const F=this._tiles[T];F.tileID=F.tileID.unwrapTo(F.tileID.wrap+h),w[F.tileID.key]=F}this._tiles=w;for(const T in this._timers)clearTimeout(this._timers[T]),delete this._timers[T];for(const T in this._tiles)this._setTileReloadTimer(+T,this._tiles[T])}}update(c,h,w){if(this.transform=c,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!w)return;let T;this.updateCacheSize(c,h),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?T=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(ut=>new bp(ut.canonical.z,ut.wrap,ut.canonical.z,ut.canonical.x,ut.canonical.y)):(T=c.coveringTiles({tileSize:h||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!w,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(T=T.filter(ut=>this._source.hasTile(ut)))):T=[];const F=this._updateRetainedTiles(T);if(DS(this._source.type)&&T.length!==0){const ut={},di={},yi=Object.keys(F);for(const So of yi){const sa=F[So],al=this._tiles[So];if(!al||al.fadeEndTime&&al.fadeEndTime<=nm.now())continue;const cl=this.findLoadedParent(sa,Math.max(sa.overscaledZ-Qw.maxOverzooming,this._source.minzoom));cl&&(this._addTile(cl.tileID),ut[cl.tileID.key]=cl.tileID),di[So]=sa}const kn=T[T.length-1].overscaledZ;for(const So in this._tiles){const sa=this._tiles[So];if(F[So]||!sa.hasData())continue;let al=sa.tileID;for(;al.overscaledZ>kn;){al=al.scaledTo(al.overscaledZ-1);const cl=this._tiles[al.key];if(cl&&cl.hasData()&&di[al.key]){F[So]=sa.tileID;break}}}for(const So in ut)F[So]||(this._coveredTiles[So]=!0,F[So]=ut[So])}for(const ut in F)this._tiles[ut].clearFadeHold();const Y=function(ut,di){const yi=[];for(const kn in ut)kn in di||yi.push(kn);return yi}(this._tiles,F);for(const ut of Y){const di=this._tiles[ut];di.hasSymbolBuckets&&!di.holdingForFade()?di.setHoldDuration(this.map._fadeDuration):di.hasSymbolBuckets&&!di.symbolFadeFinished()||this._removeTile(+ut)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(+c)}_updateRetainedTiles(c){const h={};if(c.length===0)return h;const w={},T=c.reduce((yi,kn)=>Math.min(yi,kn.overscaledZ),1/0),F=c[0].overscaledZ,Y=Math.max(F-Qw.maxOverzooming,this._source.minzoom),ut=Math.max(F+Qw.maxUnderzooming,this._source.minzoom),di={};for(const yi of c){const kn=this._addTile(yi);h[yi.key]=yi,kn.hasData()||T<this._source.maxzoom&&(di[yi.key]=yi)}this._retainLoadedChildren(di,T,ut,h);for(const yi of c){let kn=this._tiles[yi.key];if(kn.hasData())continue;if(yi.canonical.z>=this._source.maxzoom){const sa=yi.children(this._source.maxzoom)[0],al=this.getTile(sa);if(al&&al.hasData()){h[sa.key]=sa;continue}}else{const sa=yi.children(this._source.maxzoom);if(h[sa[0].key]&&h[sa[1].key]&&h[sa[2].key]&&h[sa[3].key])continue}let So=kn.wasRequested();for(let sa=yi.overscaledZ-1;sa>=Y;--sa){const al=yi.scaledTo(sa);if(w[al.key]||(w[al.key]=!0,kn=this.getTile(al),!kn&&So&&(kn=this._addTile(al)),kn&&(h[al.key]=al,So=kn.wasRequested(),kn.hasData())))break}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const c in this._tiles){const h=[];let w,T=this._tiles[c].tileID;for(;T.overscaledZ>0;){if(T.key in this._loadedParentTiles){w=this._loadedParentTiles[T.key];break}h.push(T.key);const F=T.scaledTo(T.overscaledZ-1);if(w=this._getLoadedTile(F),w)break;T=F}for(const F of h)this._loadedParentTiles[F]=w}}_addTile(c){let h=this._tiles[c.key];if(h)return h;h=this._cache.getAndRemove(c),h&&(this._setTileReloadTimer(c.key,h),h.tileID=c,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,h)));const w=!!h;if(!w){const T=this.map?this.map.painter:null;h=new AE(c,this._source.tileSize*c.overscaleFactor(),this.transform.tileZoom,T,this._isRaster),this._loadTile(h,this._tileLoaded.bind(this,h,c.key,h.state))}return h?(h.uses++,this._tiles[c.key]=h,w||this._source.fire(new Dg("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h):null}_setTileReloadTimer(c,h){c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);const w=h.getExpiryTimeout();w&&(this._timers[c]=setTimeout(()=>{this._reloadTile(c,"expired"),delete this._timers[c]},w))}_removeTile(c){const h=this._tiles[c];h&&(h.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const c in this._tiles)this._removeTile(+c);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(c,h,w){const T=[],F=this.transform;if(!F)return T;const Y=F.projection.name==="globe",ut=am(F.center.lng);for(const di in this._tiles){const yi=this._tiles[di];if(w&&yi.clearQueryDebugViz(),yi.holdingForFade())continue;let kn;if(Y){const So=yi.tileID.canonical;if(So.z===0){const sa=[Math.abs(td(ut,...kb(So,-1))-ut),Math.abs(td(ut,...kb(So,1))-ut)];kn=[0,2*sa.indexOf(Math.min(...sa))-1]}else{const sa=[Math.abs(td(ut,...kb(So,-1))-ut),Math.abs(td(ut,...kb(So,0))-ut),Math.abs(td(ut,...kb(So,1))-ut)];kn=[sa.indexOf(Math.min(...sa))-1]}}else kn=[0];for(const So of kn){const sa=c.containsTile(yi,F,h,So);sa&&T.push(sa)}}return T}getVisibleCoordinates(c){const h=this.getRenderableIds(c).map(w=>this._tiles[w].tileID);for(const w of h)w.projMatrix=this.transform.calculateProjMatrix(w.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(DS(this._source.type))for(const c in this._tiles){const h=this._tiles[c];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=nm.now())return!0}return!1}setFeatureState(c,h,w){this._state.updateState(c=c||"_geojsonTileLayer",h,w)}removeFeatureState(c,h,w){this._state.removeFeatureState(c=c||"_geojsonTileLayer",h,w)}getFeatureState(c,h){return this._state.getState(c=c||"_geojsonTileLayer",h)}setDependencies(c,h,w){const T=this._tiles[c];T&&T.setDependencies(h,w)}reloadTilesForDependencies(c,h){for(const w in this._tiles)this._tiles[w].hasDependency(c,h)&&this._reloadTile(+w,"reloading");this._cache.filter(w=>!w.hasDependency(c,h))}_preloadTiles(c,h){if(!this._sourceLoaded){const ut=()=>{this._sourceLoaded&&(this._source.off("data",ut),this._preloadTiles(c,h))};return void this._source.on("data",ut)}const w=new Map,T=Array.isArray(c)?c:[c],F=this.map.painter.terrain,Y=this.usedForTerrain&&F?F.getScaledDemTileSize():this._source.tileSize;for(const ut of T){const di=ut.coveringTiles({tileSize:Y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const yi of di)w.set(yi.key,yi);this.usedForTerrain&&ut.updateElevation(!1)}Ud(Array.from(w.values()),(ut,di)=>{const yi=new AE(ut,this._source.tileSize*ut.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(yi,kn=>{this._source.type==="raster-dem"&&yi.dem&&this._backfillDEM(yi),di(kn,yi)})},h)}}function PS(u,c){const h=Math.abs(2*u.wrap)-+(u.wrap<0),w=Math.abs(2*c.wrap)-+(c.wrap<0);return u.overscaledZ-c.overscaledZ||w-h||c.canonical.y-u.canonical.y||c.canonical.x-u.canonical.x}function DS(u){return u==="raster"||u==="image"||u==="video"||u==="custom"}function kb(u,c){const h=1<<u.z;return[u.x/h+c,(u.x+1)/h+c]}Qw.maxOverzooming=10,Qw.maxUnderzooming=3;class jC{constructor(c,h,w){this._demTile=c,this._dem=this._demTile.dem,this._scale=h,this._offset=w}static create(c,h,w){const T=w||c.findDEMTileFor(h);if(!T||!T.dem)return;const F=T.dem,Y=T.tileID,ut=1<<h.canonical.z-Y.canonical.z;return new jC(T,T.tileSize/jp/ut,[(h.canonical.x/ut-Y.canonical.x)*F.dim,(h.canonical.y/ut-Y.canonical.y)*F.dim])}tileCoordToPixel(c,h){const w=h*this._scale+this._offset[1],T=Math.floor(c*this._scale+this._offset[0]),F=Math.floor(w);return new ll(T,F)}getElevationAt(c,h,w,T){const F=c*this._scale+this._offset[0],Y=h*this._scale+this._offset[1],ut=Math.floor(F),di=Math.floor(Y),yi=this._dem;return T=!!T,w?Hp(Hp(yi.get(ut,di,T),yi.get(ut,di+1,T),Y-di),Hp(yi.get(ut+1,di,T),yi.get(ut+1,di+1,T),Y-di),F-ut):yi.get(ut,di,T)}getElevationAtPixel(c,h,w){return this._dem.get(c,h,!!w)}getMeterToDEM(c){return(1<<this._demTile.tileID.canonical.z)*Py(1,c)*this._dem.stride}}class LS{constructor(c,h){this.tileID=c,this.x=c.canonical.x,this.y=c.canonical.y,this.z=c.canonical.z,this.grid=new ds(jp,16,0),this.featureIndexArray=new Zv,this.promoteId=h}insert(c,h,w,T,F,Y=0){const ut=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(w,T,F,Y);const di=this.grid;for(let yi=0;yi<h.length;yi++){const kn=h[yi],So=[1/0,1/0,-1/0,-1/0];for(let sa=0;sa<kn.length;sa++){const al=kn[sa];So[0]=Math.min(So[0],al.x),So[1]=Math.min(So[1],al.y),So[2]=Math.max(So[2],al.x),So[3]=Math.max(So[3],al.y)}So[0]<jp&&So[1]<jp&&So[2]>=0&&So[3]>=0&&di.insert(ut,So[0],So[1],So[2],So[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new C(new L1(this.rawTileData)).layers,this.sourceLayerCoder=new yS(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const c in this.vtLayers)this.vtFeatures[c]=[]}return this.vtLayers}query(c,h,w,T){this.loadVTLayers();const F=c.params||{},Y=Hv(F.filter),ut=c.tileResult,di=c.transform,yi=ut.bufferedTilespaceBounds,kn=this.grid.query(yi.min.x,yi.min.y,yi.max.x,yi.max.y,(cl,eh,fh,Ch)=>x1(ut.bufferedTilespaceGeometry,cl,eh,fh,Ch));kn.sort(zT);let So=null;di.elevation&&kn.length>0&&(So=jC.create(di.elevation,this.tileID));const sa={};let al;for(let cl=0;cl<kn.length;cl++){const eh=kn[cl];if(eh===al)continue;al=eh;const fh=this.featureIndexArray.get(eh);let Ch=null;this.loadMatchingFeature(sa,fh,Y,F.layers,F.availableImages,h,w,T,(Gh,Eh,kh,jh=0)=>(Ch||(Ch=fv(Gh,this.tileID.canonical,c.tileTransform)),Eh.queryIntersectsFeature(ut,Gh,kh,Ch,this.z,c.transform,c.pixelPosMatrix,So,jh)))}return sa}loadMatchingFeature(c,h,w,T,F,Y,ut,di,yi){const{featureIndex:kn,bucketIndex:So,sourceLayerIndex:sa,layoutVertexArrayOffset:al}=h,cl=this.bucketLayerIDs[So];if(T&&!function(Gh,Eh){for(let kh=0;kh<Gh.length;kh++)if(Eh.indexOf(Gh[kh])>=0)return!0;return!1}(T,cl))return;const eh=this.sourceLayerCoder.decode(sa),fh=this.vtLayers[eh].feature(kn);if(w.needGeometry){const Gh=Lx(fh,!0);if(!w.filter(new Gn(this.tileID.overscaledZ),Gh,this.tileID.canonical))return}else if(!w.filter(new Gn(this.tileID.overscaledZ),fh))return;const Ch=this.getId(fh,eh);for(let Gh=0;Gh<cl.length;Gh++){const Eh=cl[Gh];if(T&&T.indexOf(Eh)<0)continue;const kh=Y[Eh];if(!kh)continue;let jh={};Ch!==void 0&&di&&(jh=di.getState(kh.sourceLayer||"_geojsonTileLayer",Ch));const Hh=wd({},ut[Eh]);Hh.paint=FS(Hh.paint,kh.paint,fh,jh,F),Hh.layout=FS(Hh.layout,kh.layout,fh,jh,F);const ud=!yi||yi(fh,kh,jh,al);if(!ud)continue;const sd=new vS(fh,this.z,this.x,this.y,Ch);sd.layer=Hh;let Cd=c[Eh];Cd===void 0&&(Cd=c[Eh]=[]),Cd.push({featureIndex:kn,feature:sd,intersectionZ:ud})}}lookupSymbolFeatures(c,h,w,T,F,Y,ut,di){const yi={};this.loadVTLayers();const kn=Hv(F);for(const So of c)this.loadMatchingFeature(yi,{bucketIndex:w,sourceLayerIndex:T,featureIndex:So,layoutVertexArrayOffset:0},kn,Y,ut,di,h);return yi}loadFeature(c){const{featureIndex:h,sourceLayerIndex:w}=c;this.loadVTLayers();const T=this.sourceLayerCoder.decode(w),F=this.vtFeatures[T];if(F[h])return F[h];const Y=this.vtLayers[T].feature(h);return F[h]=Y,Y}hasLayer(c){for(const h of this.bucketLayerIDs)for(const w of h)if(c===w)return!0;return!1}getId(c,h){let w=c.id;if(this.promoteId){const T=typeof this.promoteId=="string"?this.promoteId:this.promoteId[h];T!=null&&(w=c.properties[T]),typeof w=="boolean"&&(w=Number(w))}return w}}function FS(u,c,h,w,T){return Kd(u,(F,Y)=>{const ut=c instanceof xh?c.get(Y):null;return ut&&ut.evaluate?ut.evaluate(h,w,T):ut})}function zT(u,c){return c-u}vs(LS,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class NS{constructor(c,h){this.width=c,this.height=h,this.nextRow=0,this.image=new t0({width:c,height:h}),this.positions={},this.uploaded=!1}getDash(c,h){const w=this.getKey(c,h);return this.positions[w]}trim(){const c=this.width,h=this.height=Wd(this.nextRow);this.image.resize({width:c,height:h})}getKey(c,h){return c.join(",")+h}getDashRanges(c,h,w){const T=[];let F=c.length%2==1?-c[c.length-1]*w:0,Y=c[0]*w,ut=!0;T.push({left:F,right:Y,isDash:ut,zeroLength:c[0]===0});let di=c[0];for(let yi=1;yi<c.length;yi++){ut=!ut;const kn=c[yi];F=di*w,di+=kn,Y=di*w,T.push({left:F,right:Y,isDash:ut,zeroLength:kn===0})}return T}addRoundDash(c,h,w){const T=h/2;for(let F=-w;F<=w;F++){const Y=this.width*(this.nextRow+w+F);let ut=0,di=c[ut];for(let yi=0;yi<this.width;yi++){yi/di.right>1&&(di=c[++ut]);const kn=Math.abs(yi-di.left),So=Math.abs(yi-di.right),sa=Math.min(kn,So);let al;const cl=F/w*(T+1);if(di.isDash){const eh=T-Math.abs(cl);al=Math.sqrt(sa*sa+eh*eh)}else al=T-Math.sqrt(sa*sa+cl*cl);this.image.data[Y+yi]=Math.max(0,Math.min(255,al+128))}}}addRegularDash(c,h){for(let di=c.length-1;di>=0;--di){const yi=c[di],kn=c[di+1];yi.zeroLength?c.splice(di,1):kn&&kn.isDash===yi.isDash&&(kn.left=yi.left,c.splice(di,1))}const w=c[0],T=c[c.length-1];w.isDash===T.isDash&&(w.left=T.left-this.width,T.right=w.right+this.width);const F=this.width*this.nextRow;let Y=0,ut=c[Y];for(let di=0;di<this.width;di++){di/ut.right>1&&(ut=c[++Y]);const yi=Math.abs(di-ut.left),kn=Math.abs(di-ut.right),So=Math.min(yi,kn);this.image.data[F+di]=Math.max(0,Math.min(255,(ut.isDash?So:-So)+h+128))}}addDash(c,h){const w=this.getKey(c,h);if(this.positions[w])return this.positions[w];const T=h==="round",F=T?7:0,Y=2*F+1;if(this.nextRow+Y>this.height)return Ad("LineAtlas out of space"),null;c.length===0&&c.push(1);let ut=0;for(let kn=0;kn<c.length;kn++)c[kn]<0&&(Ad("Negative value is found in line dasharray, replacing values with 0"),c[kn]=0),ut+=c[kn];if(ut!==0){const kn=this.width/ut,So=this.getDashRanges(c,this.width,kn);T?this.addRoundDash(So,kn,F):this.addRegularDash(So,h==="square"?.5*kn:0)}const di=this.nextRow+F;this.nextRow+=Y;const yi={tl:[di,F],br:[ut,0]};return this.positions[w]=yi,yi}}vs(NS,"LineAtlas");const kS=1*F0;class BS{constructor(c){const h={},w=[];for(const ut in c){const di=c[ut],yi=h[ut]={};for(const kn in di.glyphs){const So=di.glyphs[+kn];if(!So||So.bitmap.width===0||So.bitmap.height===0)continue;const sa=So.metrics.localGlyph?kS:1,al={x:0,y:0,w:So.bitmap.width+2*sa,h:So.bitmap.height+2*sa};w.push(al),yi[kn]=al}}const{w:T,h:F}=kx(w),Y=new t0({width:T||1,height:F||1});for(const ut in c){const di=c[ut];for(const yi in di.glyphs){const kn=di.glyphs[+yi];if(!kn||kn.bitmap.width===0||kn.bitmap.height===0)continue;const So=h[ut][yi],sa=kn.metrics.localGlyph?kS:1;t0.copy(kn.bitmap,Y,{x:0,y:0},{x:So.x+sa,y:So.y+sa},kn.bitmap)}}this.image=Y,this.positions=h}}vs(BS,"GlyphAtlas");class VT{constructor(c){this.tileID=new bp(c.tileID.overscaledZ,c.tileID.wrap,c.tileID.canonical.z,c.tileID.canonical.x,c.tileID.canonical.y),this.tileZoom=c.tileZoom,this.uid=c.uid,this.zoom=c.zoom,this.canonical=c.tileID.canonical,this.pixelRatio=c.pixelRatio,this.tileSize=c.tileSize,this.source=c.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=c.showCollisionBoxes,this.collectResourceTiming=!!c.collectResourceTiming,this.returnDependencies=!!c.returnDependencies,this.promoteId=c.promoteId,this.enableTerrain=!!c.enableTerrain,this.isSymbolTile=c.isSymbolTile,this.tileTransform=Jw(c.tileID.canonical,c.projection),this.projection=c.projection}parse(c,h,w,T,F){this.status="parsing",this.data=c,this.collisionBoxArray=new Ag;const Y=new yS(Object.keys(c.layers).sort()),ut=new LS(this.tileID,this.promoteId);ut.bucketLayerIDs=[];const di={},yi=new NS(256,256),kn={featureIndex:ut,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:yi,availableImages:w},So=h.familiesBySource[this.source];for(const jh in So){const Hh=c.layers[jh];if(!Hh)continue;let ud=!1,sd=!1;for(const gd of So[jh])gd[0].type==="symbol"?ud=!0:sd=!0;if(this.isSymbolTile===!0&&!ud||this.isSymbolTile===!1&&!sd)continue;Hh.version===1&&Ad(`Vector tile source "${this.source}" layer "${jh}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Cd=Y.encode(jh),jd=[];for(let gd=0;gd<Hh.length;gd++){const Pd=Hh.feature(gd),Dd=ut.getId(Pd,jh);jd.push({feature:Pd,id:Dd,index:gd,sourceLayerIndex:Cd})}for(const gd of So[jh]){const Pd=gd[0];this.isSymbolTile!==void 0&&Pd.type==="symbol"!==this.isSymbolTile||Pd.minzoom&&this.zoom<Math.floor(Pd.minzoom)||Pd.maxzoom&&this.zoom>=Pd.maxzoom||Pd.visibility!=="none"&&(DE(gd,this.zoom,w),(di[Pd.id]=Pd.createBucket({index:ut.bucketLayerIDs.length,layers:gd,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Cd,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:w})).populate(jd,kn,this.tileID.canonical,this.tileTransform),ut.bucketLayerIDs.push(gd.map(Dd=>Dd.id)))}}let sa,al,cl,eh;yi.trim();const fh={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ch=()=>{if(sa)return F(sa);if(al&&cl&&eh){const jh=new BS(al),Hh=new gx(cl,eh);for(const ud in di){const sd=di[ud];sd instanceof fw?(DE(sd.layers,this.zoom,w),pT(sd,al,jh.positions,cl,Hh.iconPositions,this.showCollisionBoxes,w,this.tileID.canonical,this.tileZoom,this.projection)):sd.hasPattern&&(sd instanceof cm||sd instanceof Xw||sd instanceof hl)&&(DE(sd.layers,this.zoom,w),sd.addFeatures(kn,this.tileID.canonical,Hh.patternPositions,w,this.tileTransform))}this.status="done",F(null,{buckets:Xd(di).filter(ud=>!ud.isEmpty()),featureIndex:ut,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:jh.image,lineAtlas:yi,imageAtlas:Hh,glyphMap:this.returnDependencies?al:null,iconMap:this.returnDependencies?cl:null,glyphPositions:this.returnDependencies?jh.positions:null})}},Gh=Kd(kn.glyphDependencies,jh=>Object.keys(jh).map(Number));Object.keys(Gh).length?T.send("getGlyphs",{uid:this.uid,stacks:Gh},(jh,Hh)=>{sa||(sa=jh,al=Hh,Ch())},void 0,!1,fh):al={};const Eh=Object.keys(kn.iconDependencies);Eh.length?T.send("getImages",{icons:Eh,source:this.source,tileID:this.tileID,type:"icons"},(jh,Hh)=>{sa||(sa=jh,cl=Hh,Ch())},void 0,!1,fh):cl={};const kh=Object.keys(kn.patternDependencies);kh.length?T.send("getImages",{icons:kh,source:this.source,tileID:this.tileID,type:"patterns"},(jh,Hh)=>{sa||(sa=jh,eh=Hh,Ch())},void 0,!1,fh):eh={},Ch()}}function DE(u,c,h){const w=new Gn(c);for(const T of u)T.recalculate(w,h)}class GS{constructor(c){this.entries={},this.scheduler=c}request(c,h,w,T){const F=this.entries[c]=this.entries[c]||{callbacks:[]};if(F.result){const[Y,ut]=F.result;return this.scheduler?this.scheduler.add(()=>{T(Y,ut)},h):T(Y,ut),()=>{}}return F.callbacks.push(T),F.cancel||(F.cancel=w((Y,ut)=>{F.result=[Y,ut];for(const di of F.callbacks)this.scheduler?this.scheduler.add(()=>{di(Y,ut)},h):di(Y,ut);setTimeout(()=>delete this.entries[c],3e3)})),()=>{F.result||(F.callbacks=F.callbacks.filter(Y=>Y!==T),F.callbacks.length||(F.cancel(),delete this.entries[c]))}}}function zS(u,c,h){const w=JSON.stringify(u.request);return u.data&&(this.deduped.entries[w]={result:[null,u.data]}),this.deduped.request(w,{type:"parseTile",isSymbolTile:u.isSymbolTile,zoom:u.tileZoom},T=>{const F=ng(u.request,(Y,ut,di,yi)=>{Y?T(Y):ut&&T(null,{vectorTile:h?void 0:new C(new L1(ut)),rawData:ut,cacheControl:di,expires:yi})});return()=>{F.cancel(),T()}},c)}const VS=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class LE{static from(c){if(!(c instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[h,w]=new Uint8Array(c,0,2);if(h!==219)throw new Error("Data does not appear to be in a KDBush format.");const T=w>>4;if(T!==1)throw new Error(`Got v${T} data when expected v1.`);const F=VS[15&w];if(!F)throw new Error("Unrecognized array type.");const[Y]=new Uint16Array(c,2,1),[ut]=new Uint32Array(c,4,1);return new LE(ut,Y,F,c)}constructor(c,h=64,w=Float64Array,T){if(isNaN(c)||c<0)throw new Error(`Unpexpected numItems value: ${c}.`);this.numItems=+c,this.nodeSize=Math.min(Math.max(+h,2),65535),this.ArrayType=w,this.IndexArrayType=c<65536?Uint16Array:Uint32Array;const F=VS.indexOf(this.ArrayType),Y=2*c*this.ArrayType.BYTES_PER_ELEMENT,ut=c*this.IndexArrayType.BYTES_PER_ELEMENT,di=(8-ut%8)%8;if(F<0)throw new Error(`Unexpected typed array class: ${w}.`);T&&T instanceof ArrayBuffer?(this.data=T,this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+ut+di,2*c),this._pos=2*c,this._finished=!0):(this.data=new ArrayBuffer(8+Y+ut+di),this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+ut+di,2*c),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+F]),new Uint16Array(this.data,2,1)[0]=h,new Uint32Array(this.data,4,1)[0]=c)}add(c,h){const w=this._pos>>1;return this.ids[w]=w,this.coords[this._pos++]=c,this.coords[this._pos++]=h,w}finish(){const c=this._pos>>1;if(c!==this.numItems)throw new Error(`Added ${c} items when expected ${this.numItems}.`);return OE(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(c,h,w,T){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:F,coords:Y,nodeSize:ut}=this,di=[0,F.length-1,0],yi=[];for(;di.length;){const kn=di.pop()||0,So=di.pop()||0,sa=di.pop()||0;if(So-sa<=ut){for(let fh=sa;fh<=So;fh++){const Ch=Y[2*fh],Gh=Y[2*fh+1];Ch>=c&&Ch<=w&&Gh>=h&&Gh<=T&&yi.push(F[fh])}continue}const al=sa+So>>1,cl=Y[2*al],eh=Y[2*al+1];cl>=c&&cl<=w&&eh>=h&&eh<=T&&yi.push(F[al]),(kn===0?c<=cl:h<=eh)&&(di.push(sa),di.push(al-1),di.push(1-kn)),(kn===0?w>=cl:T>=eh)&&(di.push(al+1),di.push(So),di.push(1-kn))}return yi}within(c,h,w){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:T,coords:F,nodeSize:Y}=this,ut=[0,T.length-1,0],di=[],yi=w*w;for(;ut.length;){const kn=ut.pop()||0,So=ut.pop()||0,sa=ut.pop()||0;if(So-sa<=Y){for(let fh=sa;fh<=So;fh++)$S(F[2*fh],F[2*fh+1],c,h)<=yi&&di.push(T[fh]);continue}const al=sa+So>>1,cl=F[2*al],eh=F[2*al+1];$S(cl,eh,c,h)<=yi&&di.push(T[al]),(kn===0?c-w<=cl:h-w<=eh)&&(ut.push(sa),ut.push(al-1),ut.push(1-kn)),(kn===0?c+w>=cl:h+w>=eh)&&(ut.push(al+1),ut.push(So),ut.push(1-kn))}return di}}function OE(u,c,h,w,T,F){if(T-w<=h)return;const Y=w+T>>1;US(u,c,Y,w,T,F),OE(u,c,h,w,Y-1,1-F),OE(u,c,h,Y+1,T,1-F)}function US(u,c,h,w,T,F){for(;T>w;){if(T-w>600){const yi=T-w+1,kn=h-w+1,So=Math.log(yi),sa=.5*Math.exp(2*So/3),al=.5*Math.sqrt(So*sa*(yi-sa)/yi)*(kn-yi/2<0?-1:1);US(u,c,h,Math.max(w,Math.floor(h-kn*sa/yi+al)),Math.min(T,Math.floor(h+(yi-kn)*sa/yi+al)),F)}const Y=c[2*h+F];let ut=w,di=T;for(Bb(u,c,w,h),c[2*T+F]>Y&&Bb(u,c,w,T);ut<di;){for(Bb(u,c,ut,di),ut++,di--;c[2*ut+F]<Y;)ut++;for(;c[2*di+F]>Y;)di--}c[2*w+F]===Y?Bb(u,c,w,di):(di++,Bb(u,c,di,T)),di<=h&&(w=di+1),h<=di&&(T=di-1)}}function Bb(u,c,h,w){FE(u,h,w),FE(c,2*h,2*w),FE(c,2*h+1,2*w+1)}function FE(u,c,h){const w=u[c];u[c]=u[h],u[h]=w}function $S(u,c,h,w){const T=u-h,F=c-w;return T*T+F*F}s.ARRAY_TYPE=z_,s.AUTH_ERR_MSG=Dh,s.Aabb=b_,s.Actor=class{constructor(u,c,h){this.target=u,this.parent=c,this.mapId=h,this.callbacks={},this.cancelCallbacks={},ep(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=rp()?u:m,this.scheduler=new OT}send(u,c,h,w,T=!1,F){const Y=Math.round(1e18*Math.random()).toString(36).substring(0,10);h&&(h.metadata=F,this.callbacks[Y]=h);const ut=Fp(this.globalScope)?void 0:[];return this.target.postMessage({id:Y,type:u,hasCallback:!!h,targetMapId:w,mustQueue:T,sourceMapId:this.mapId,data:dh(c,ut)},ut),{cancel:()=>{h&&delete this.callbacks[Y],this.target.postMessage({id:Y,type:"<cancel>",targetMapId:w,sourceMapId:this.mapId})}}}receive(u){const c=u.data,h=c.id;if(h&&(!c.targetMapId||this.mapId===c.targetMapId))if(c.type==="<cancel>"){const w=this.cancelCallbacks[h];delete this.cancelCallbacks[h],w&&w.cancel()}else if(c.mustQueue||rp()){const w=this.callbacks[h];this.cancelCallbacks[h]=this.scheduler.add(()=>this.processTask(h,c),w&&w.metadata||{type:"message"})}else this.processTask(h,c)}processTask(u,c){if(c.type==="<response>"){const h=this.callbacks[u];delete this.callbacks[u],h&&(c.error?h(Ah(c.error)):h(null,Ah(c.data)))}else{const h=Fp(this.globalScope)?void 0:[],w=c.hasCallback?(F,Y)=>{delete this.cancelCallbacks[u],this.target.postMessage({id:u,type:"<response>",sourceMapId:this.mapId,error:F?dh(F):null,data:dh(Y,h)},h)}:F=>{},T=Ah(c.data);if(this.parent[c.type])this.parent[c.type](c.sourceMapId,T,w);else if(this.parent.getWorkerSource){const F=c.type.split(".");this.parent.getWorkerSource(c.sourceMapId,F[0],T.source)[F[1]](T,w)}else w(new Error(`Could not find function ${c.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.CanonicalTileID=Md,s.Color=Gg,s.ColorMode=yx,s.CullFaceMode=N0,s.DEMData=HC,s.DataConstantProperty=_l,s.DedupedRequest=GS,s.DepthMode=U1,s.EXTENT=jp,s.Elevation=class{isDataAvailableAtPoint(u){const c=this._source();if(this.isUsingMockSource()||!c||u.y<0||u.y>1)return!1;const h=c.getSource().maxzoom,w=1<<h,T=Math.floor(u.x),F=Math.floor((u.x-T)*w),Y=Math.floor(u.y*w),ut=this.findDEMTileFor(new bp(h,T,h,F,Y));return!(!ut||!ut.dem)}getAtPointOrZero(u,c=0){return this.getAtPoint(u,c)||0}getAtPoint(u,c,h=!0){if(this.isUsingMockSource())return null;c==null&&(c=null);const w=this._source();if(!w||u.y<0||u.y>1)return c;const T=w.getSource().maxzoom,F=1<<T,Y=Math.floor(u.x),ut=u.x-Y,di=new bp(T,Y,T,Math.floor(ut*F),Math.floor(u.y*F)),yi=this.findDEMTileFor(di);if(!yi||!yi.dem)return c;const kn=yi.dem,So=1<<yi.tileID.canonical.z,sa=(ut*So-yi.tileID.canonical.x)*kn.dim,al=(u.y*So-yi.tileID.canonical.y)*kn.dim,cl=Math.floor(sa),eh=Math.floor(al);return(h?this.exaggeration():1)*Hp(Hp(kn.get(cl,eh),kn.get(cl,eh+1),al-eh),Hp(kn.get(cl+1,eh),kn.get(cl+1,eh+1),al-eh),sa-cl)}getAtTileOffset(u,c,h){const w=1<<u.canonical.z;return this.getAtPointOrZero(new M0(u.wrap+(u.canonical.x+c/jp)/w,(u.canonical.y+h/jp)/w))}getAtTileOffsetFunc(u,c,h,w){return T=>{const F=this.getAtTileOffset(u,T.x,T.y),Y=w.upVector(u.canonical,T.x,T.y);return V_(Y,Y,F*w.upVectorScale(u.canonical,c,h).metersToTile),Y}}getForTilePoints(u,c,h,w){if(this.isUsingMockSource())return!1;const T=jC.create(this,u,w);return!!T&&(c.forEach(F=>{F[2]=this.exaggeration()*T.getElevationAt(F[0],F[1],h)}),!0)}getMinMaxForTile(u){if(this.isUsingMockSource())return null;const c=this.findDEMTileFor(u);if(!c||!c.dem)return null;const h=c.dem.tree,w=c.tileID,T=1<<u.canonical.z-w.canonical.z;let F=u.canonical.x/T-w.canonical.x,Y=u.canonical.y/T-w.canonical.y,ut=0;for(let di=0;di<u.canonical.z-w.canonical.z&&!h.leaves[ut];di++){F*=2,Y*=2;const yi=2*Math.floor(Y)+Math.floor(F);ut=h.childOffsets[ut]+yi,F%=1,Y%=1}return{min:this.exaggeration()*h.minimums[ut],max:this.exaggeration()*h.maximums[ut]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(u,c,h){throw new Error("Pure virtual method called.")}pointCoordinate(u){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(u){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},s.ErrorEvent=s_,s.EvaluationParameters=Gn,s.Event=Dg,s.Evented=f_,s.FillExtrusionBucket=hl,s.Frustum=h1,s.FrustumCorners=u1,s.GLOBE_RADIUS=e0,s.GLOBE_SCALE_MATCH_LATITUDE=45,s.GLOBE_ZOOM_THRESHOLD_MAX=ib,s.GLOBE_ZOOM_THRESHOLD_MIN=Xx,s.GlobeSharedBuffers=class{constructor(u){this._createGrid(u),this._createPoles(u)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const u of this._poleSegments)u.destroy();for(const u of this._gridSegments)u.withSkirts.destroy(),u.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const u of this._wireframeSegments)u.destroy()}}_fillGridMeshWithLods(u,c){const h=new Bd,w=new Bp,T=[],F=u+1+2,Y=c[0]+1,ut=c[0]+1+(1+c.length),di=(yi,kn,So)=>{let sa=yi===F-1?yi-2:yi===0?yi:yi-1;return sa+=So?24575:0,[sa,kn]};for(let yi=0;yi<F;++yi)h.emplaceBack(...di(yi,0,!0));for(let yi=0;yi<Y;++yi)for(let kn=0;kn<F;++kn)h.emplaceBack(...di(kn,yi,(kn===0||kn===F-1)&&!0));for(let yi=0;yi<c.length;++yi){const kn=c[yi];for(let So=0;So<F;++So)h.emplaceBack(...di(So,kn,!0))}for(let yi=0;yi<c.length;++yi){const kn=w.length,So=c[yi]+1+2,sa=new Bp;for(let eh=0;eh<So-1;eh++){const fh=eh===So-2,Ch=fh?F*(ut-c.length+yi-eh):F;for(let Gh=0;Gh<F-1;Gh++){const Eh=eh*F+Gh;eh===0||fh||Gh===0||Gh===F-2?(sa.emplaceBack(Eh+1,Eh,Eh+Ch),sa.emplaceBack(Eh+Ch,Eh+Ch+1,Eh+1)):(w.emplaceBack(Eh+1,Eh,Eh+Ch),w.emplaceBack(Eh+Ch,Eh+Ch+1,Eh+1))}}const al=Kg.simpleSegment(0,kn,h.length,w.length-kn);for(let eh=0;eh<sa.uint16.length;eh+=3)w.emplaceBack(sa.uint16[eh],sa.uint16[eh+1],sa.uint16[eh+2]);const cl=Kg.simpleSegment(0,kn,h.length,w.length-kn);T.push({withoutSkirts:al,withSkirts:cl})}return{vertices:h,indices:w,segments:T}}_createGrid(u){const c=this._fillGridMeshWithLods(Dx,Yx);this._gridSegments=c.segments,this._gridBuffer=u.createVertexBuffer(c.vertices,Px.members),this._gridIndexBuffer=u.createIndexBuffer(c.indices,!0)}_createPoles(u){const c=new Bp;for(let T=0;T<=Dx;T++)c.emplaceBack(0,T+1,T+2);this._poleIndexBuffer=u.createIndexBuffer(c,!0);const h=new gg,w=new gg;this._poleSegments=[];for(let T=0,F=0;T<Xx;T++){const Y=360/(1<<T);h.emplaceBack(0,-e0,0,.5,0),w.emplaceBack(0,-e0,0,.5,1);for(let ut=0;ut<=Dx;ut++){const di=ut/Dx,yi=Hp(0,Y,di),[kn,So,sa]=Jx(lb,cb,yi,e0);h.emplaceBack(kn,So,sa,di,0),w.emplaceBack(kn,So,sa,di,1)}this._poleSegments.push(Kg.simpleSegment(F,0,66,64)),F+=66}this._poleNorthVertexBuffer=u.createVertexBuffer(h,tC,!1),this._poleSouthVertexBuffer=u.createVertexBuffer(w,tC,!1)}getGridBuffers(u,c){return[this._gridBuffer,this._gridIndexBuffer,c?this._gridSegments[u].withSkirts:this._gridSegments[u].withoutSkirts]}getPoleBuffers(u){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[u]]}getWirefameBuffers(u,c){if(!this._wireframeSegments){const h=new om,w=Dx,T=w+1+2,F=1;this._wireframeSegments=[];for(let Y=0,ut=0;Y<Yx.length;Y++){const di=Yx[Y];for(let kn=F;kn<di+F;kn++)for(let So=F;So<w+F;So++){const sa=kn*T+So;h.emplaceBack(sa,sa+1),h.emplaceBack(sa,sa+T),h.emplaceBack(sa,sa+T+1)}const yi=di*w*3;this._wireframeSegments.push(Kg.simpleSegment(0,ut,(di+1)*T,yi)),ut+=yi}this._wireframeIndexBuffer=u.createIndexBuffer(h)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[c]]}},s.GlyphManager=k1,s.ImagePosition=F1,s.KDBush=LE,s.LivePerformanceUtils=Wf,s.LngLat=Rg,s.LngLatBounds=Jv,s.LocalGlyphMode=vE,s.MAX_MERCATOR_LATITUDE=_m,s.MercatorCoordinate=M0,s.ONE_EM=Ig,s.OverscaledTileID=bp,s.PerformanceMarkers=Vf,s.Point=ll,s.Properties=Sh,s.RGBAImage=P_,s.Ray=c1,s.RequestManager=class{constructor(u,c,h){this._transformRequestFn=u,this._customAccessToken=c,this._silenceAuthErrors=!!h,this._createSkuToken()}_createSkuToken(){const u=function(){let c="";for(let h=0;h<10;h++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Vn,c].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=u.token,this._skuTokenExpiresAt=u.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(u,c){return this._transformRequestFn&&this._transformRequestFn(u,c)||{url:u}}normalizeStyleURL(u,c){if(!$h(u))return u;const h=ih(u);return h.path=`/styles/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||c)}normalizeGlyphsURL(u,c){if(!$h(u))return u;const h=ih(u);return h.path=`/fonts/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||c)}normalizeSourceURL(u,c,h,w){if(!$h(u))return u;const T=ih(u);return T.path=`/v4/${T.authority}.json`,T.params.push("secure"),h&&T.params.push(`language=${h}`),w&&T.params.push(`worldview=${w}`),this._makeAPIURL(T,this._customAccessToken||c)}normalizeSpriteURL(u,c,h,w){const T=ih(u);return $h(u)?(T.path=`/styles/v1${T.path}/sprite${c}${h}`,this._makeAPIURL(T,this._customAccessToken||w)):(T.path+=`${c}${h}`,ch(T))}normalizeTileURL(u,c,h){if(this._isSkuTokenExpired()&&this._createSkuToken(),u&&!$h(u))return u;const w=ih(u);w.path=w.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${c||h&&w.authority!=="raster"&&h===512?"@2x":""}${Ee.supported?".webp":"$1"}`),w.authority==="raster"?w.path=`/${W.RASTER_URL_PREFIX}${w.path}`:(w.path=w.path.replace(/^.+\/v4\//,"/"),w.path=`/${W.TILE_URL_VERSION}${w.path}`);const T=this._customAccessToken||function(F){for(const Y of F){const ut=Y.match(/^access_token=(.*)$/);if(ut)return ut[1]}return null}(w.params)||W.ACCESS_TOKEN;return W.REQUIRE_ACCESS_TOKEN&&T&&this._skuToken&&w.params.push(`sku=${this._skuToken}`),this._makeAPIURL(w,T)}canonicalizeTileURL(u,c){const h=ih(u);if(!h.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!h.path.match(/\.[\w]+$/))return u;let w="mapbox://";h.path.match(/^\/raster\/v1\//)?w+=`raster/${h.path.replace(`/${W.RASTER_URL_PREFIX}/`,"")}`:w+=`tiles/${h.path.replace(`/${W.TILE_URL_VERSION}/`,"")}`;let T=h.params;return c&&(T=T.filter(F=>!F.match(/^access_token=/))),T.length&&(w+=`?${T.join("&")}`),w}canonicalizeTileset(u,c){const h=!!c&&$h(c),w=[];for(const T of u.tiles||[])yl(T)?w.push(this.canonicalizeTileURL(T,h)):w.push(T);return w}_makeAPIURL(u,c){const h="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",w=ih(W.API_URL);if(u.protocol=w.protocol,u.authority=w.authority,u.protocol==="http"){const T=u.params.indexOf("secure");T>=0&&u.params.splice(T,1)}if(w.path!=="/"&&(u.path=`${w.path}${u.path}`),!W.REQUIRE_ACCESS_TOKEN)return ch(u);if(c=c||W.ACCESS_TOKEN,!this._silenceAuthErrors){if(!c)throw new Error(`An API access token is required to use Mapbox GL. ${h}`);if(c[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${h}`)}return u.params=u.params.filter(T=>T.indexOf("access_token")===-1),u.params.push(`access_token=${c||""}`),ch(u)}},s.ResourceType=np,s.SegmentVector=Kg,s.SourceCache=Qw,s.StencilMode=IE,s.StructArrayLayout1ui2=c_,s.StructArrayLayout2f1f2i16=Zp,s.StructArrayLayout2i4=Bd,s.StructArrayLayout2ui4=om,s.StructArrayLayout3f12=Jf,s.StructArrayLayout3ui6=Bp,s.StructArrayLayout4i8=Sd,s.StructArrayLayout5f20=gg,s.Texture=Nb,s.Tile=AE,s.Transitionable=pl,s.Uniform1f=Rx,s.Uniform1i=class extends uv{constructor(u){super(u),this.current=0}set(u,c,h){this.fetchUniformLocation(u,c)&&this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}},s.Uniform2f=class extends uv{constructor(u){super(u),this.current=[0,0]}set(u,c,h){this.fetchUniformLocation(u,c)&&(h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1])))}},s.Uniform3f=class extends uv{constructor(u){super(u),this.current=[0,0,0]}set(u,c,h){this.fetchUniformLocation(u,c)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2])))}},s.Uniform4f=q1,s.UniformColor=ox,s.UniformMatrix2f=class extends uv{constructor(u){super(u),this.current=YC}set(u,c,h){if(this.fetchUniformLocation(u,c)){for(let w=0;w<4;w++)if(h[w]!==this.current[w]){this.current=h,this.gl.uniformMatrix2fv(this.location,!1,h);break}}}},s.UniformMatrix3f=class extends uv{constructor(u){super(u),this.current=XC}set(u,c,h){if(this.fetchUniformLocation(u,c)){for(let w=0;w<9;w++)if(h[w]!==this.current[w]){this.current=h,this.gl.uniformMatrix3fv(this.location,!1,h);break}}}},s.UniformMatrix4f=class extends uv{constructor(u){super(u),this.current=Sw}set(u,c,h){if(this.fetchUniformLocation(u,c)){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let w=1;w<16;w++)if(h[w]!==this.current[w]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}}},s.UnwrappedTileID=Pp,s.ValidationError=fp,s.VectorTileFeature=N,s.VectorTileWorkerSource=class extends f_{constructor(u,c,h,w,T){super(),this.actor=u,this.layerIndex=c,this.availableImages=h,this.loadVectorData=T||zS,this.loading={},this.loaded={},this.deduped=new GS(u.scheduler),this.isSpriteLoaded=w,this.scheduler=u.scheduler}loadTile(u,c){const h=u.uid,w=u&&u.request,T=w&&w.collectResourceTiming,F=this.loading[h]=new VT(u);F.abort=this.loadVectorData(u,(Y,ut)=>{const di=!this.loading[h];if(delete this.loading[h],di||Y||!ut)return F.status="done",di||(this.loaded[h]=F),c(Y);const yi=ut.rawData,kn={};ut.expires&&(kn.expires=ut.expires),ut.cacheControl&&(kn.cacheControl=ut.cacheControl),F.vectorTile=ut.vectorTile||new C(new L1(yi));const So=()=>{F.parse(F.vectorTile,this.layerIndex,this.availableImages,this.actor,(sa,al)=>{if(sa||!al)return c(sa);const cl={};if(T){const eh=Yp(w);eh.length>0&&(cl.resourceTiming=JSON.parse(JSON.stringify(eh)))}c(null,wd({rawTileData:yi.slice(0)},al,kn,cl))})};this.isSpriteLoaded?So():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(So,{type:"parseTile",isSymbolTile:u.isSymbolTile,zoom:u.tileZoom}):So()}),this.loaded=this.loaded||{},this.loaded[h]=F})}reloadTile(u,c){const h=this.loaded,w=u.uid,T=this;if(h&&h[w]){const F=h[w];F.showCollisionBoxes=u.showCollisionBoxes,F.enableTerrain=!!u.enableTerrain,F.projection=u.projection,F.tileTransform=Jw(u.tileID.canonical,u.projection);const Y=(ut,di)=>{const yi=F.reloadCallback;yi&&(delete F.reloadCallback,F.parse(F.vectorTile,T.layerIndex,this.availableImages,T.actor,yi)),c(ut,di)};F.status==="parsing"?F.reloadCallback=Y:F.status==="done"&&(F.vectorTile?F.parse(F.vectorTile,this.layerIndex,this.availableImages,this.actor,Y):Y())}}abortTile(u,c){const h=u.uid,w=this.loading[h];w&&(w.abort&&w.abort(),delete this.loading[h]),c()}removeTile(u,c){const h=this.loaded,w=u.uid;h&&h[w]&&delete h[w],c()}},s.WritingMode=vv,s.ZoomDependentExpression=Bm,s.add=Qv,s.addDynamicAttributes=VC,s.adjoint=function(u,c){var h=c[0],w=c[1],T=c[2],F=c[3],Y=c[4],ut=c[5],di=c[6],yi=c[7],kn=c[8];return u[0]=Y*kn-ut*yi,u[1]=T*yi-w*kn,u[2]=w*ut-T*Y,u[3]=ut*di-F*kn,u[4]=h*kn-T*di,u[5]=T*F-h*ut,u[6]=F*yi-Y*di,u[7]=w*di-h*yi,u[8]=h*Y-w*F,u},s.asyncAll=Ud,s.bezier=Ed,s.bindAll=ep,s.boundsAttributes=wS,s.bufferConvexPolygon=function(u,c){const h=[];for(let w=0;w<u.length;w++){const T=Ld(w-1,-1,u.length-1),F=Ld(w+1,-1,u.length-1),Y=u[w],ut=u[F],di=u[T].sub(Y).unit(),yi=ut.sub(Y).unit(),kn=yi.angleWithSep(di.x,di.y),So=di.add(yi).unit().mult(-1*c/Math.sin(kn/2));h.push(Y.add(So))}return h},s.cacheEntryPossiblyAdded=function(u){Yd++,Yd>cd&&(u.getActor().send("enforceCacheSizeLimit",Uf),Yd=0)},s.calculateGlobeLabelMatrix=function(u,c){const{x:h,y:w}=u.point,T=nC(h,w,u.worldSize/u._pixelsPerMercatorPixel,0,0);return Ix(T,T,sb(ug(c)))},s.calculateGlobeMatrix=function(u){const{x:c,y:h}=u.point,{lng:w,lat:T}=u._center;return nC(c,h,u.worldSize,w,T)},s.calculateGlobeMercatorMatrix=function(u){const c=u.pixelsPerMeter,h=c/Py(1,u.center.lat),w=dv(new Float64Array(16));return Mx(w,w,[u.point.x,u.point.y,0]),S0(w,w,[h,h,c]),Float32Array.from(w)},s.circumferenceAtLatitude=g1,s.clamp=td,s.clearTileCache=function(u){if(!Ep())return;const c=m.caches.delete($f);u&&c.catch(u).then(()=>u())},s.clipLine=rS,s.clone=function(u){var c=new z_(16);return c[0]=u[0],c[1]=u[1],c[2]=u[2],c[3]=u[3],c[4]=u[4],c[5]=u[5],c[6]=u[6],c[7]=u[7],c[8]=u[8],c[9]=u[9],c[10]=u[10],c[11]=u[11],c[12]=u[12],c[13]=u[13],c[14]=u[14],c[15]=u[15],c},s.clone$1=Ip,s.collisionCircleLayout=C_,s.config=W,s.conjugate=function(u,c){return u[0]=-c[0],u[1]=-c[1],u[2]=-c[2],u[3]=c[3],u},s.create=function(){var u=new z_(16);return z_!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u},s.create$1=Z1,s.createExpression=xy,s.createLayout=Zh,s.createStyleLayer=function(u){return u.type==="custom"?new MT(u):new DT[u.type](u)},s.cross=J1,s.degToRad=nh,s.distance=function(u,c){return Math.hypot(c[0]-u[0],c[1]-u[1],c[2]-u[2])},s.div=function(u,c,h){return u[0]=c[0]/h[0],u[1]=c[1]/h[1],u[2]=c[2]/h[2],u},s.dot=Ay,s.earthRadius=Gw,s.ease=Td,s.easeCubicInOut=Bh,s.ecefToLatLng=function([u,c,h]){const w=Math.hypot(u,c,h),T=Math.atan2(u,h),F=.5*Math.PI-Math.acos(-c/w);return new Rg(bh(T),bh(F))},s.emitValidationErrors=_e,s.endsWith=zp,s.enforceCacheSizeLimit=function(u){Vp(),cp&&cp.then(c=>{c.keys().then(h=>{for(let w=0;w<h.length-u;w++)c.delete(h[w])})})},s.evaluateSizeForFeature=Im,s.evaluateSizeForZoom=tg,s.evaluateVariableOffset=lS,s.evented=ze,s.exactEquals=function(u,c){return u[0]===c[0]&&u[1]===c[1]&&u[2]===c[2]&&u[3]===c[3]},s.exactEquals$1=function(u,c){return u[0]===c[0]&&u[1]===c[1]&&u[2]===c[2]},s.exported=nm,s.exported$1=Ee,s.extend=wd,s.extend$1=g_,s.fillExtrusionHeightLift=Xh,s.filterObject=Ap,s.fromMat4=function(u,c){return u[0]=c[0],u[1]=c[1],u[2]=c[2],u[3]=c[4],u[4]=c[5],u[5]=c[6],u[6]=c[8],u[7]=c[9],u[8]=c[10],u},s.fromQuat=function(u,c){var h=c[0],w=c[1],T=c[2],F=c[3],Y=h+h,ut=w+w,di=T+T,yi=h*Y,kn=w*Y,So=w*ut,sa=T*Y,al=T*ut,cl=T*di,eh=F*Y,fh=F*ut,Ch=F*di;return u[0]=1-So-cl,u[1]=kn+Ch,u[2]=sa-fh,u[3]=0,u[4]=kn-Ch,u[5]=1-yi-cl,u[6]=al+eh,u[7]=0,u[8]=sa+fh,u[9]=al-eh,u[10]=1-yi-So,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u},s.fromRotation=function(u,c){var h=Math.sin(c),w=Math.cos(c);return u[0]=w,u[1]=h,u[2]=0,u[3]=-h,u[4]=w,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},s.fromScaling=X1,s.furthestTileCorner=function(u){const c=Math.round((u+45+360)%360/90)%4;return Fh[c]},s.getAABBPointSquareDist=function(u,c,h){let w=0;for(let T=0;T<2;++T){const F=h?h[T]:0;u[T]>F&&(w+=(u[T]-F)*(u[T]-F)),c[T]<F&&(w+=(F-c[T])*(F-c[T]))}return w},s.getAnchorAlignment=yE,s.getAnchorJustification=wE,s.getBounds=function(u){let c=1/0,h=1/0,w=-1/0,T=-1/0;for(const F of u)c=Math.min(c,F.x),h=Math.min(h,F.y),w=Math.max(w,F.x),T=Math.max(T,F.y);return{min:new ll(c,h),max:new ll(w,T)}},s.getColumn=kd,s.getDefaultExportFromCjs=Wr,s.getGridMatrix=function(u,c,h,w){const T=c.getNorth(),F=c.getSouth(),Y=c.getWest(),ut=c.getEast(),di=1<<u.z,yi=ut-Y,kn=T-F,So=yi/Dx,sa=-kn/Yx[h],al=[0,So,0,sa,0,0,T,Y,0];if(u.z>0){const cl=180/w;qx(al,al,[cl/yi+1,0,0,0,cl/kn+1,0,-.5*cl/So,.5*cl/sa,1])}return al[2]=di,al[5]=u.x,al[8]=u.y,al},s.getImage=oh,s.getJSON=function(u,c){return Rp(wd(u,{type:"json"}),c)},s.getLatitudinalLod=function(u){const c=_m-5;u=td(u,-c,c)/c*90;const h=Math.pow(Math.abs(Math.sin(nh(u))),3);return Math.round(h*(Yx.length-1))},s.getMapSessionAPI=pp,s.getPerformanceMeasurement=Yp,s.getProjection=mS,s.getRTLTextPluginStatus=kt,s.getReferrer=Qp,s.getTilePoint=function(u,{x:c,y:h},w=0){return new ll(((c-w)*u.scale-u.x)*jp,(h*u.scale-u.y)*jp)},s.getTileVec3=function(u,c,h=0){return Kx(((c.x-h)*u.scale-u.x)*jp,(c.y*u.scale-u.y)*jp,tw(c.z,c.y))},s.getVideo=function(u,c){const h=m.document.createElement("video");h.muted=!0,h.onloadstart=function(){c(null,h)};for(let w=0;w<u.length;w++){const T=m.document.createElement("source");bg(u[w])||(h.crossOrigin="Anonymous"),T.src=u[w],h.appendChild(T)}return{cancel:()=>{}}},s.globeCenterToScreenPoint=function(u){const c=[0,0,0],h=dv(new Float64Array(16));return Ix(h,u.pixelMatrix,u.globeMatrix),sm(c,c,h),new ll(c[0],c[1])},s.globeDenormalizeECEF=sb,s.globeECEFOrigin=function(u,c){const h=[0,0,0];return sm(h,h,kw(ug(c.canonical))),sm(h,h,u),h},s.globeMetersToEcef=mm,s.globeNormalizeECEF=kw,s.globePixelsToTileUnits=function(u,c){return jp/(512*Math.pow(2,u))*f1(ug(c))},s.globePoleMatrixForTile=function(u,c,h){const w=dv(new Float64Array(16)),T=(c/(1<<u)-.5)*Math.PI*2;return Dw(w,h.globeMatrix,T),Float32Array.from(w)},s.globeTileBounds=ug,s.globeTiltAtLngLat=Bw,s.globeToMercatorTransition=ew,s.globeUseCustomAntiAliasing=function(u,c,h){const w=ew(h.zoom),T=u.style.map._antialias,F=!!c.extStandardDerivatives,Y=c.extStandardDerivativesForceOff||u.terrain&&u.terrain.exaggeration()>0;return w===0&&!T&&!Y&&F},s.identity=dv,s.identity$1=Jb,s.invert=Mw,s.isFullscreen=function(){return!!m.document.fullscreenElement||!!m.document.webkitFullscreenElement},s.isLngLatBehindGlobe=lx,s.isMapAuthenticated=function(u){return Wp.has(u)},s.isMapboxURL=$h,s.isSafariWithAntialiasingBug=function(u){const c=u.navigator?u.navigator.userAgent:null;return!!Fp(u)&&c&&(c.match("Version/15.4")||c.match("Version/15.5")||c.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.latFromMercatorY=bm,s.latLngToECEF=Qx,s.len=tE,s.length=Ty,s.length$1=function(u){return Math.hypot(u[0],u[1],u[2],u[3])},s.lngFromMercatorX=Gm,s.loadVectorTile=zS,s.makeRequest=Rp,s.mapValue=function(u,c,h,w,T){return td((u-c)/(h-c)*(T-w)+w,w,T)},s.mercatorScale=zw,s.mercatorXfromLng=am,s.mercatorYfromLat=My,s.mercatorZfromAltitude=Py,s.mul=QC,s.mul$1=eE,s.multiply=Ix,s.multiply$1=qx,s.multiply$2=Xb,s.nextPowerOfTwo=Wd,s.normalize=w_,s.normalize$1=iE,s.normalize$2=Yb,s.number=Hp,s.ortho=function(u,c,h,w,T,F,Y){var ut=1/(c-h),di=1/(w-T),yi=1/(F-Y);return u[0]=-2*ut,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*di,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*yi,u[11]=0,u[12]=(c+h)*ut,u[13]=(T+w)*di,u[14]=(Y+F)*yi,u[15]=1,u},s.pbf=Ly,s.perspective=function(u,c,h,w,T){var F,Y=1/Math.tan(c/2);return u[0]=Y/h,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=Y,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,T!=null&&T!==1/0?(u[10]=(T+w)*(F=1/(w-T)),u[14]=2*T*w*F):(u[10]=-1,u[14]=-2*w),u},s.pick=function(u,c){const h={};for(let w=0;w<c.length;w++){const T=c[w];T in u&&(h[T]=u[T])}return h},s.plugin=or,s.pointGeometry=ml,s.polesInViewport=function(u){const c=dv(new Float64Array(16));Ix(c,u.pixelMatrix,u.globeMatrix);const h=[0,Ry,0],w=[0,Iy,0];return sm(h,h,c),sm(w,w,c),[h[0]>0&&h[0]<=u.width&&h[1]>0&&h[1]<=u.height&&!lx(u,new Rg(u.center.lat,90)),w[0]>0&&w[0]<=u.width&&w[1]>0&&w[1]<=u.height&&!lx(u,new Rg(u.center.lat,-90))]},s.polygonContainsPoint=P0,s.polygonIntersectsBox=x1,s.polygonIntersectsPolygon=gv,s.polygonizeBounds=function(u,c,h=0,w=!0){const T=new ll(h,h),F=u.sub(T),Y=c.add(T),ut=[F,new ll(Y.x,F.y),Y,new ll(F.x,Y.y)];return w&&ut.push(F.clone()),ut},s.posAttributes=Px,s.postMapLoadEvent=ip,s.postPerformanceEvent=qd,s.postTurnstileEvent=rd,s.potpack=kx,s.prevPowerOfTwo=function(u){return u<=1?1:Math.pow(2,Math.floor(Math.log(u)/Math.LN2))},s.radToDeg=bh,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.registerForPluginStateChange=function(u){return u({pluginStatus:L,pluginURL:p}),ze.on("pluginStateChange",u),u},s.removeAuthState=function(u){Wp.delete(u)},s.renderColorRamp=S1,s.resample=hb,s.rotateX=Pw,s.rotateX$1=Qb,s.rotateY=Dw,s.rotateY$1=eC,s.rotateZ=function(u,c,h){var w=Math.sin(h),T=Math.cos(h),F=c[0],Y=c[1],ut=c[2],di=c[3],yi=c[4],kn=c[5],So=c[6],sa=c[7];return c!==u&&(u[8]=c[8],u[9]=c[9],u[10]=c[10],u[11]=c[11],u[12]=c[12],u[13]=c[13],u[14]=c[14],u[15]=c[15]),u[0]=F*T+yi*w,u[1]=Y*T+kn*w,u[2]=ut*T+So*w,u[3]=di*T+sa*w,u[4]=yi*T-F*w,u[5]=kn*T-Y*w,u[6]=So*T-ut*w,u[7]=sa*T-di*w,u},s.rotateZ$1=function(u,c,h){h*=.5;var w=c[0],T=c[1],F=c[2],Y=c[3],ut=Math.sin(h),di=Math.cos(h);return u[0]=w*di+T*ut,u[1]=T*di-w*ut,u[2]=F*di+Y*ut,u[3]=Y*di-F*ut,u},s.scale=S0,s.scale$1=Q1,s.scale$2=V_,s.scaleAndAdd=Zx,s.set=function(u,c,h,w){return u[0]=c,u[1]=h,u[2]=w,u},s.setCacheLimits=function(u,c){Uf=u,cd=c},s.setColumn=function(u,c,h){u[4*c+0]=h[0],u[4*c+1]=h[1],u[4*c+2]=h[2],u[4*c+3]=h[3]},s.setRTLTextPlugin=function(u,c,h=!1){if(L===Hd||L===tp||L===Vd)throw new Error("setRTLTextPlugin cannot be called multiple times.");p=nm.resolveURL(u),L=Hd,gp=c,X(),h||vi()},s.smoothstep=Fd,s.spec=hd,s.squaredLength=function(u){var c=u[0],h=u[1],w=u[2];return c*c+h*h+w*w},s.storeAuthState=function(u,c){c?Wp.add(u):Wp.delete(u)},s.sub=ny,s.subtract=ax,s.symbolSize=$_,s.tileAABB=function(u,c,h,w,T,F,Y,ut,di){if(di.name==="globe")return R0(u,c,new Md(h,w,T));const yi=Jw({z:h,x:w,y:T},di);return new b_([(F+yi.x/yi.scale)*c,c*(yi.y/yi.scale),Y],[(F+yi.x2/yi.scale)*c,c*(yi.y2/yi.scale),ut])},s.tileCornersToBounds=I0,s.tileTransform=Jw,s.transformMat3=function(u,c,h){var w=c[0],T=c[1],F=c[2];return u[0]=w*h[0]+T*h[3]+F*h[6],u[1]=w*h[1]+T*h[4]+F*h[7],u[2]=w*h[2]+T*h[5]+F*h[8],u},s.transformMat4=sm,s.transformMat4$1=pv,s.transformQuat=l1,s.transitionTileAABBinECEF=nb,s.translate=Mx,s.transpose=function(u,c){if(u===c){var h=c[1],w=c[2],T=c[5];u[1]=c[3],u[2]=c[6],u[3]=h,u[5]=c[7],u[6]=w,u[7]=T}else u[0]=c[0],u[1]=c[3],u[2]=c[6],u[3]=c[1],u[4]=c[4],u[5]=c[7],u[6]=c[2],u[7]=c[5],u[8]=c[8];return u},s.triggerPluginCompletionEvent=S,s.uniqueId=Rd,s.updateGlobeVertexNormal=function(u,c,h,w,T){const F=5*c+2;u.float32[F+0]=h,u.float32[F+1]=w,u.float32[F+2]=T},s.validateCustomStyleLayer=function(u){const c=[],h=u.id;return h===void 0&&c.push({message:`layers.${h}: missing required property "id"`}),u.render===void 0&&c.push({message:`layers.${h}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&c.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),c},s.validateFilter=u=>A(av(u)),s.validateFog=u=>A(x0(u)),s.validateLayer=u=>A(qv(u)),s.validateLight=u=>A(v0(u)),s.validateSource=u=>A(Cy(u)),s.validateStyle=w0,s.validateTerrain=u=>A(iy(u)),s.values=Xd,s.vectorTile=dx,s.version=y,s.warnOnce=Ad,s.window=m,s.wrap=Ld}),a(["./shared"],function(s){function m(Ih){if(typeof Ih=="number"||typeof Ih=="boolean"||typeof Ih=="string"||Ih==null)return JSON.stringify(Ih);if(Array.isArray(Ih)){let sh="[";for(const oh of Ih)sh+=`${m(oh)},`;return`${sh}]`}let rh="{";for(const sh of Object.keys(Ih).sort())rh+=`${sh}:${m(Ih[sh])},`;return`${rh}}`}function y(Ih){let rh="";for(const sh of s.refProperties)rh+=`/${m(Ih[sh])}`;return rh}class D{constructor(rh){this.keyCache={},rh&&this.replace(rh)}replace(rh){this._layerConfigs={},this._layers={},this.update(rh,[])}update(rh,sh){for(const Dh of rh)this._layerConfigs[Dh.id]=Dh,(this._layers[Dh.id]=s.createStyleLayer(Dh)).compileFilter(),this.keyCache[Dh.id]&&delete this.keyCache[Dh.id];for(const Dh of sh)delete this.keyCache[Dh],delete this._layerConfigs[Dh],delete this._layers[Dh];this.familiesBySource={};const oh=function(Dh,$h){const yl={};for(let Cr=0;Cr<Dh.length;Cr++){const fs=$h&&$h[Dh[Cr].id]||y(Dh[Cr]);$h&&($h[Dh[Cr].id]=fs);let ul=yl[fs];ul||(ul=yl[fs]=[]),ul.push(Dh[Cr])}const gs=[];for(const Cr in yl)gs.push(yl[Cr]);return gs}(s.values(this._layerConfigs),this.keyCache);for(const Dh of oh){const $h=Dh.map(ih=>this._layers[ih.id]),yl=$h[0];if(yl.visibility==="none")continue;const gs=yl.source||"";let Cr=this.familiesBySource[gs];Cr||(Cr=this.familiesBySource[gs]={});const fs=yl.sourceLayer||"_geojsonTileLayer";let ul=Cr[fs];ul||(ul=Cr[fs]=[]),ul.push($h)}}}class W{loadTile(rh,sh){const{uid:oh,encoding:Dh,rawImageData:$h,padding:yl,buildQuadTree:gs}=rh,Cr=s.window.ImageBitmap&&$h instanceof s.window.ImageBitmap?this.getImageData($h,yl):$h;sh(null,new s.DEMData(oh,Cr,Dh,yl<1,gs))}getImageData(rh,sh){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(rh.width,rh.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=rh.width,this.offscreenCanvas.height=rh.height,this.offscreenCanvasContext.drawImage(rh,0,0,rh.width,rh.height);const oh=this.offscreenCanvasContext.getImageData(-sh,-sh,rh.width+2*sh,rh.height+2*sh);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),oh}}function Ee(Ih,rh){if(Ih.length!==0){dt(Ih[0],rh);for(var sh=1;sh<Ih.length;sh++)dt(Ih[sh],!rh)}}function dt(Ih,rh){for(var sh=0,oh=0,Dh=0,$h=Ih.length,yl=$h-1;Dh<$h;yl=Dh++){var gs=(Ih[Dh][0]-Ih[yl][0])*(Ih[yl][1]+Ih[Dh][1]),Cr=sh+gs;oh+=Math.abs(sh)>=Math.abs(gs)?sh-Cr+gs:gs-Cr+sh,sh=Cr}sh+oh>=0!=!!rh&&Ih.reverse()}var Ht=s.getDefaultExportFromCjs(function Ih(rh,sh){var oh,Dh=rh&&rh.type;if(Dh==="FeatureCollection")for(oh=0;oh<rh.features.length;oh++)Ih(rh.features[oh],sh);else if(Dh==="GeometryCollection")for(oh=0;oh<rh.geometries.length;oh++)Ih(rh.geometries[oh],sh);else if(Dh==="Feature")Ih(rh.geometry,sh);else if(Dh==="Polygon")Ee(rh.coordinates,sh);else if(Dh==="MultiPolygon")for(oh=0;oh<rh.coordinates.length;oh++)Ee(rh.coordinates[oh],sh);return rh});const ir=s.VectorTileFeature.prototype.toGeoJSON;var Hr={exports:{}},Bn=s.pointGeometry,Vn=s.vectorTile.VectorTileFeature,Wr=ps;function ps(Ih,rh){this.options=rh||{},this.features=Ih,this.length=Ih.length}function il(Ih,rh){this.id=typeof Ih.id=="number"?Ih.id:void 0,this.type=Ih.type,this.rawGeometry=Ih.type===1?[Ih.geometry]:Ih.geometry,this.properties=Ih.tags,this.extent=rh||4096}ps.prototype.feature=function(Ih){return new il(this.features[Ih],this.options.extent)},il.prototype.loadGeometry=function(){var Ih=this.rawGeometry;this.geometry=[];for(var rh=0;rh<Ih.length;rh++){for(var sh=Ih[rh],oh=[],Dh=0;Dh<sh.length;Dh++)oh.push(new Bn(sh[Dh][0],sh[Dh][1]));this.geometry.push(oh)}return this.geometry},il.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ih=this.geometry,rh=1/0,sh=-1/0,oh=1/0,Dh=-1/0,$h=0;$h<Ih.length;$h++)for(var yl=Ih[$h],gs=0;gs<yl.length;gs++){var Cr=yl[gs];rh=Math.min(rh,Cr.x),sh=Math.max(sh,Cr.x),oh=Math.min(oh,Cr.y),Dh=Math.max(Dh,Cr.y)}return[rh,oh,sh,Dh]},il.prototype.toGeoJSON=Vn.prototype.toGeoJSON;var gl=s.pbf,ml=Wr;function sl(Ih){var rh=new gl;return function(sh,oh){for(var Dh in sh.layers)oh.writeMessage(3,ll,sh.layers[Dh])}(Ih,rh),rh.finish()}function ll(Ih,rh){var sh;rh.writeVarintField(15,Ih.version||1),rh.writeStringField(1,Ih.name||""),rh.writeVarintField(5,Ih.extent||4096);var oh={keys:[],values:[],keycache:{},valuecache:{}};for(sh=0;sh<Ih.length;sh++)oh.feature=Ih.feature(sh),rh.writeMessage(2,rl,oh);var Dh=oh.keys;for(sh=0;sh<Dh.length;sh++)rh.writeStringField(3,Dh[sh]);var $h=oh.values;for(sh=0;sh<$h.length;sh++)rh.writeMessage(4,Bh,$h[sh])}function rl(Ih,rh){var sh=Ih.feature;sh.id!==void 0&&rh.writeVarintField(1,sh.id),rh.writeMessage(2,th,Ih),rh.writeVarintField(3,sh.type),rh.writeMessage(4,Fh,sh)}function th(Ih,rh){var sh=Ih.feature,oh=Ih.keys,Dh=Ih.values,$h=Ih.keycache,yl=Ih.valuecache;for(var gs in sh.properties){var Cr=sh.properties[gs],fs=$h[gs];if(Cr!==null){fs===void 0&&(oh.push(gs),$h[gs]=fs=oh.length-1),rh.writeVarint(fs);var ul=typeof Cr;ul!=="string"&&ul!=="boolean"&&ul!=="number"&&(Cr=JSON.stringify(Cr));var ih=ul+":"+Cr,ch=yl[ih];ch===void 0&&(Dh.push(Cr),yl[ih]=ch=Dh.length-1),rh.writeVarint(ch)}}}function nh(Ih,rh){return(rh<<3)+(7&Ih)}function bh(Ih){return Ih<<1^Ih>>31}function Fh(Ih,rh){for(var sh=Ih.loadGeometry(),oh=Ih.type,Dh=0,$h=0,yl=sh.length,gs=0;gs<yl;gs++){var Cr=sh[gs],fs=1;oh===1&&(fs=Cr.length),rh.writeVarint(nh(1,fs));for(var ul=oh===3?Cr.length-1:Cr.length,ih=0;ih<ul;ih++){ih===1&&oh!==1&&rh.writeVarint(nh(2,ul-1));var ch=Cr[ih].x-Dh,vh=Cr[ih].y-$h;rh.writeVarint(bh(ch)),rh.writeVarint(bh(vh)),Dh+=ch,$h+=vh}oh===3&&rh.writeVarint(nh(7,1))}}function Bh(Ih,rh){var sh=typeof Ih;sh==="string"?rh.writeStringField(1,Ih):sh==="boolean"?rh.writeBooleanField(7,Ih):sh==="number"&&(Ih%1!=0?rh.writeDoubleField(3,Ih):Ih<0?rh.writeSVarintField(6,Ih):rh.writeVarintField(5,Ih))}Hr.exports=sl,Hr.exports.fromVectorTileJs=sl,Hr.exports.fromGeojsonVt=function(Ih,rh){rh=rh||{};var sh={};for(var oh in Ih)sh[oh]=new ml(Ih[oh].features,rh),sh[oh].name=oh,sh[oh].version=rh.version,sh[oh].extent=rh.extent;return sl({layers:sh})},Hr.exports.GeoJSONWrapper=ml;var Ed=s.getDefaultExportFromCjs(Hr.exports);const Td={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ih=>Ih},td=Math.fround||(Fd=new Float32Array(1),Ih=>(Fd[0]=+Ih,Fd[0]));var Fd;const Ld=3,Ud=5,Xd=6;class wd{constructor(rh){this.options=Object.assign(Object.create(Td),rh),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(rh){const{log:sh,minZoom:oh,maxZoom:Dh}=this.options;sh&&console.time("total time");const $h=`prepare ${rh.length} points`;sh&&console.time($h),this.points=rh;const yl=[];for(let Cr=0;Cr<rh.length;Cr++){const fs=rh[Cr];if(!fs.geometry)continue;const[ul,ih]=fs.geometry.coordinates,ch=td(op(ul)),vh=td(Wd(ih));yl.push(ch,vh,1/0,Cr,-1,1),this.options.reduce&&yl.push(0)}let gs=this.trees[Dh+1]=this._createTree(yl);sh&&console.timeEnd($h);for(let Cr=Dh;Cr>=oh;Cr--){const fs=+Date.now();gs=this.trees[Cr]=this._createTree(this._cluster(gs,Cr)),sh&&console.log("z%d: %d clusters in %dms",Cr,gs.numItems,+Date.now()-fs)}return sh&&console.timeEnd("total time"),this}getClusters(rh,sh){let oh=((rh[0]+180)%360+360)%360-180;const Dh=Math.max(-90,Math.min(90,rh[1]));let $h=rh[2]===180?180:((rh[2]+180)%360+360)%360-180;const yl=Math.max(-90,Math.min(90,rh[3]));if(rh[2]-rh[0]>=360)oh=-180,$h=180;else if(oh>$h){const ih=this.getClusters([oh,Dh,180,yl],sh),ch=this.getClusters([-180,Dh,$h,yl],sh);return ih.concat(ch)}const gs=this.trees[this._limitZoom(sh)],Cr=gs.range(op(oh),Wd(yl),op($h),Wd(Dh)),fs=gs.data,ul=[];for(const ih of Cr){const ch=this.stride*ih;ul.push(fs[ch+Ud]>1?zd(fs,ch,this.clusterProps):this.points[fs[ch+Ld]])}return ul}getChildren(rh){const sh=this._getOriginId(rh),oh=this._getOriginZoom(rh),Dh="No cluster with the specified id.",$h=this.trees[oh];if(!$h)throw new Error(Dh);const yl=$h.data;if(sh*this.stride>=yl.length)throw new Error(Dh);const gs=this.options.radius/(this.options.extent*Math.pow(2,oh-1)),Cr=$h.within(yl[sh*this.stride],yl[sh*this.stride+1],gs),fs=[];for(const ul of Cr){const ih=ul*this.stride;yl[ih+4]===rh&&fs.push(yl[ih+Ud]>1?zd(yl,ih,this.clusterProps):this.points[yl[ih+Ld]])}if(fs.length===0)throw new Error(Dh);return fs}getLeaves(rh,sh,oh){const Dh=[];return this._appendLeaves(Dh,rh,sh=sh||10,oh=oh||0,0),Dh}getTile(rh,sh,oh){const Dh=this.trees[this._limitZoom(rh)],$h=Math.pow(2,rh),{extent:yl,radius:gs}=this.options,Cr=gs/yl,fs=(oh-Cr)/$h,ul=(oh+1+Cr)/$h,ih={features:[]};return this._addTileFeatures(Dh.range((sh-Cr)/$h,fs,(sh+1+Cr)/$h,ul),Dh.data,sh,oh,$h,ih),sh===0&&this._addTileFeatures(Dh.range(1-Cr/$h,fs,1,ul),Dh.data,$h,oh,$h,ih),sh===$h-1&&this._addTileFeatures(Dh.range(0,fs,Cr/$h,ul),Dh.data,-1,oh,$h,ih),ih.features.length?ih:null}getClusterExpansionZoom(rh){let sh=this._getOriginZoom(rh)-1;for(;sh<=this.options.maxZoom;){const oh=this.getChildren(rh);if(sh++,oh.length!==1)break;rh=oh[0].properties.cluster_id}return sh}_appendLeaves(rh,sh,oh,Dh,$h){const yl=this.getChildren(sh);for(const gs of yl){const Cr=gs.properties;if(Cr&&Cr.cluster?$h+Cr.point_count<=Dh?$h+=Cr.point_count:$h=this._appendLeaves(rh,Cr.cluster_id,oh,Dh,$h):$h<Dh?$h++:rh.push(gs),rh.length===oh)break}return $h}_createTree(rh){const sh=new s.KDBush(rh.length/this.stride|0,this.options.nodeSize,Float32Array);for(let oh=0;oh<rh.length;oh+=this.stride)sh.add(rh[oh],rh[oh+1]);return sh.finish(),sh.data=rh,sh}_addTileFeatures(rh,sh,oh,Dh,$h,yl){for(const gs of rh){const Cr=gs*this.stride,fs=sh[Cr+Ud]>1;let ul,ih,ch;if(fs)ul=Rd(sh,Cr,this.clusterProps),ih=sh[Cr],ch=sh[Cr+1];else{const Nh=this.points[sh[Cr+Ld]];ul=Nh.properties;const[Qh,rd]=Nh.geometry.coordinates;ih=op(Qh),ch=Wd(rd)}const vh={type:1,geometry:[[Math.round(this.options.extent*(ih*$h-oh)),Math.round(this.options.extent*(ch*$h-Dh))]],tags:ul};let Th;Th=fs||this.options.generateId?sh[Cr+Ld]:this.points[sh[Cr+Ld]].id,Th!==void 0&&(vh.id=Th),yl.features.push(vh)}}_limitZoom(rh){return Math.max(this.options.minZoom,Math.min(Math.floor(+rh),this.options.maxZoom+1))}_cluster(rh,sh){const{radius:oh,extent:Dh,reduce:$h,minPoints:yl}=this.options,gs=oh/(Dh*Math.pow(2,sh)),Cr=rh.data,fs=[],ul=this.stride;for(let ih=0;ih<Cr.length;ih+=ul){if(Cr[ih+2]<=sh)continue;Cr[ih+2]=sh;const ch=Cr[ih],vh=Cr[ih+1],Th=rh.within(Cr[ih],Cr[ih+1],gs),Nh=Cr[ih+Ud];let Qh=Nh;for(const rd of Th){const _d=rd*ul;Cr[_d+2]>sh&&(Qh+=Cr[_d+Ud])}if(Qh>Nh&&Qh>=yl){let rd,_d=ch*Nh,ip=vh*Nh,Dp=-1;const qd=((ih/ul|0)<<5)+(sh+1)+this.points.length;for(const wp of Th){const pp=wp*ul;if(Cr[pp+2]<=sh)continue;Cr[pp+2]=sh;const Wp=Cr[pp+Ud];_d+=Cr[pp]*Wp,ip+=Cr[pp+1]*Wp,Cr[pp+4]=qd,$h&&(rd||(rd=this._map(Cr,ih,!0),Dp=this.clusterProps.length,this.clusterProps.push(rd)),$h(rd,this._map(Cr,pp)))}Cr[ih+4]=qd,fs.push(_d/Qh,ip/Qh,1/0,qd,-1,Qh),$h&&fs.push(Dp)}else{for(let rd=0;rd<ul;rd++)fs.push(Cr[ih+rd]);if(Qh>1)for(const rd of Th){const _d=rd*ul;if(!(Cr[_d+2]<=sh)){Cr[_d+2]=sh;for(let ip=0;ip<ul;ip++)fs.push(Cr[_d+ip])}}}}return fs}_getOriginId(rh){return rh-this.points.length>>5}_getOriginZoom(rh){return(rh-this.points.length)%32}_map(rh,sh,oh){if(rh[sh+Ud]>1){const yl=this.clusterProps[rh[sh+Xd]];return oh?Object.assign({},yl):yl}const Dh=this.points[rh[sh+Ld]].properties,$h=this.options.map(Dh);return oh&&$h===Dh?Object.assign({},$h):$h}}function zd(Ih,rh,sh){return{type:"Feature",id:Ih[rh+Ld],properties:Rd(Ih,rh,sh),geometry:{type:"Point",coordinates:[(oh=Ih[rh],360*(oh-.5)),Op(Ih[rh+1])]}};var oh}function Rd(Ih,rh,sh){const oh=Ih[rh+Ud],Dh=oh>=1e4?`${Math.round(oh/1e3)}k`:oh>=1e3?Math.round(oh/100)/10+"k":oh,$h=Ih[rh+Xd],yl=$h===-1?{}:Object.assign({},sh[$h]);return Object.assign(yl,{cluster:!0,cluster_id:Ih[rh+Ld],point_count:oh,point_count_abbreviated:Dh})}function op(Ih){return Ih/360+.5}function Wd(Ih){const rh=Math.sin(Ih*Math.PI/180),sh=.5-.25*Math.log((1+rh)/(1-rh))/Math.PI;return sh<0?0:sh>1?1:sh}function Op(Ih){const rh=(180-360*Ih)*Math.PI/180;return 360*Math.atan(Math.exp(rh))/Math.PI-90}function ep(Ih,rh,sh,oh){for(var Dh,$h=oh,yl=sh-rh>>1,gs=sh-rh,Cr=Ih[rh],fs=Ih[rh+1],ul=Ih[sh],ih=Ih[sh+1],ch=rh+3;ch<sh;ch+=3){var vh=zp(Ih[ch],Ih[ch+1],Cr,fs,ul,ih);if(vh>$h)Dh=ch,$h=vh;else if(vh===$h){var Th=Math.abs(ch-yl);Th<gs&&(Dh=ch,gs=Th)}}$h>oh&&(Dh-rh>3&&ep(Ih,rh,Dh,oh),Ih[Dh+2]=$h,sh-Dh>3&&ep(Ih,Dh,sh,oh))}function zp(Ih,rh,sh,oh,Dh,$h){var yl=Dh-sh,gs=$h-oh;if(yl!==0||gs!==0){var Cr=((Ih-sh)*yl+(rh-oh)*gs)/(yl*yl+gs*gs);Cr>1?(sh=Dh,oh=$h):Cr>0&&(sh+=yl*Cr,oh+=gs*Cr)}return(yl=Ih-sh)*yl+(gs=rh-oh)*gs}function Kd(Ih,rh,sh,oh){var Dh={id:Ih===void 0?null:Ih,type:rh,geometry:sh,tags:oh,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function($h){var yl=$h.geometry,gs=$h.type;if(gs==="Point"||gs==="MultiPoint"||gs==="LineString")Ap($h,yl);else if(gs==="Polygon"||gs==="MultiLineString")for(var Cr=0;Cr<yl.length;Cr++)Ap($h,yl[Cr]);else if(gs==="MultiPolygon")for(Cr=0;Cr<yl.length;Cr++)for(var fs=0;fs<yl[Cr].length;fs++)Ap($h,yl[Cr][fs])}(Dh),Dh}function Ap(Ih,rh){for(var sh=0;sh<rh.length;sh+=3)Ih.minX=Math.min(Ih.minX,rh[sh]),Ih.minY=Math.min(Ih.minY,rh[sh+1]),Ih.maxX=Math.max(Ih.maxX,rh[sh]),Ih.maxY=Math.max(Ih.maxY,rh[sh+1])}function Ip(Ih,rh,sh,oh){if(rh.geometry){var Dh=rh.geometry.coordinates,$h=rh.geometry.type,yl=Math.pow(sh.tolerance/((1<<sh.maxZoom)*sh.extent),2),gs=[],Cr=rh.id;if(sh.promoteId?Cr=rh.properties[sh.promoteId]:sh.generateId&&(Cr=oh||0),$h==="Point")Yh(Dh,gs);else if($h==="MultiPoint")for(var fs=0;fs<Dh.length;fs++)Yh(Dh[fs],gs);else if($h==="LineString")Ad(Dh,gs,yl,!1);else if($h==="MultiLineString"){if(sh.lineMetrics){for(fs=0;fs<Dh.length;fs++)Ad(Dh[fs],gs=[],yl,!1),Ih.push(Kd(Cr,"LineString",gs,rh.properties));return}kp(Dh,gs,yl,!1)}else if($h==="Polygon")kp(Dh,gs,yl,!0);else{if($h!=="MultiPolygon"){if($h==="GeometryCollection"){for(fs=0;fs<rh.geometry.geometries.length;fs++)Ip(Ih,{id:Cr,geometry:rh.geometry.geometries[fs],properties:rh.properties},sh,oh);return}throw new Error("Input data is not a valid GeoJSON object.")}for(fs=0;fs<Dh.length;fs++){var ul=[];kp(Dh[fs],ul,yl,!0),gs.push(ul)}}Ih.push(Kd(Cr,$h,gs,rh.properties))}}function Yh(Ih,rh){rh.push(up(Ih[0])),rh.push(rp(Ih[1])),rh.push(0)}function Ad(Ih,rh,sh,oh){for(var Dh,$h,yl=0,gs=0;gs<Ih.length;gs++){var Cr=up(Ih[gs][0]),fs=rp(Ih[gs][1]);rh.push(Cr),rh.push(fs),rh.push(0),gs>0&&(yl+=oh?(Dh*fs-Cr*$h)/2:Math.sqrt(Math.pow(Cr-Dh,2)+Math.pow(fs-$h,2))),Dh=Cr,$h=fs}var ul=rh.length-3;rh[2]=1,ep(rh,0,ul,sh),rh[ul+2]=1,rh.size=Math.abs(yl),rh.start=0,rh.end=rh.size}function kp(Ih,rh,sh,oh){for(var Dh=0;Dh<Ih.length;Dh++){var $h=[];Ad(Ih[Dh],$h,sh,oh),rh.push($h)}}function up(Ih){return Ih/360+.5}function rp(Ih){var rh=Math.sin(Ih*Math.PI/180),sh=.5-.25*Math.log((1+rh)/(1-rh))/Math.PI;return sh<0?0:sh>1?1:sh}function fd(Ih,rh,sh,oh,Dh,$h,yl,gs){if(oh/=rh,$h>=(sh/=rh)&&yl<oh)return Ih;if(yl<sh||$h>=oh)return null;for(var Cr=[],fs=0;fs<Ih.length;fs++){var ul=Ih[fs],ih=ul.geometry,ch=ul.type,vh=Dh===0?ul.minX:ul.minY,Th=Dh===0?ul.maxX:ul.maxY;if(vh>=sh&&Th<oh)Cr.push(ul);else if(!(Th<sh||vh>=oh)){var Nh=[];if(ch==="Point"||ch==="MultiPoint")Cp(ih,Nh,sh,oh,Dh);else if(ch==="LineString")Fp(ih,Nh,sh,oh,Dh,!1,gs.lineMetrics);else if(ch==="MultiLineString")kd(ih,Nh,sh,oh,Dh,!1);else if(ch==="Polygon")kd(ih,Nh,sh,oh,Dh,!0);else if(ch==="MultiPolygon")for(var Qh=0;Qh<ih.length;Qh++){var rd=[];kd(ih[Qh],rd,sh,oh,Dh,!0),rd.length&&Nh.push(rd)}if(Nh.length){if(gs.lineMetrics&&ch==="LineString"){for(Qh=0;Qh<Nh.length;Qh++)Cr.push(Kd(ul.id,ch,Nh[Qh],ul.tags));continue}ch!=="LineString"&&ch!=="MultiLineString"||(Nh.length===1?(ch="LineString",Nh=Nh[0]):ch="MultiLineString"),ch!=="Point"&&ch!=="MultiPoint"||(ch=Nh.length===3?"Point":"MultiPoint"),Cr.push(Kd(ul.id,ch,Nh,ul.tags))}}}return Cr.length?Cr:null}function Cp(Ih,rh,sh,oh,Dh){for(var $h=0;$h<Ih.length;$h+=3){var yl=Ih[$h+Dh];yl>=sh&&yl<=oh&&(rh.push(Ih[$h]),rh.push(Ih[$h+1]),rh.push(Ih[$h+2]))}}function Fp(Ih,rh,sh,oh,Dh,$h,yl){for(var gs,Cr,fs=_p(Ih),ul=Dh===0?Uf:cd,ih=Ih.start,ch=0;ch<Ih.length-3;ch+=3){var vh=Ih[ch],Th=Ih[ch+1],Nh=Ih[ch+2],Qh=Ih[ch+3],rd=Ih[ch+4],_d=Dh===0?vh:Th,ip=Dh===0?Qh:rd,Dp=!1;yl&&(gs=Math.sqrt(Math.pow(vh-Qh,2)+Math.pow(Th-rd,2))),_d<sh?ip>sh&&(Cr=ul(fs,vh,Th,Qh,rd,sh),yl&&(fs.start=ih+gs*Cr)):_d>oh?ip<oh&&(Cr=ul(fs,vh,Th,Qh,rd,oh),yl&&(fs.start=ih+gs*Cr)):$f(fs,vh,Th,Nh),ip<sh&&_d>=sh&&(Cr=ul(fs,vh,Th,Qh,rd,sh),Dp=!0),ip>oh&&_d<=oh&&(Cr=ul(fs,vh,Th,Qh,rd,oh),Dp=!0),!$h&&Dp&&(yl&&(fs.end=ih+gs*Cr),rh.push(fs),fs=_p(Ih)),yl&&(ih+=gs)}var qd=Ih.length-3;vh=Ih[qd],Th=Ih[qd+1],Nh=Ih[qd+2],(_d=Dh===0?vh:Th)>=sh&&_d<=oh&&$f(fs,vh,Th,Nh),qd=fs.length-3,$h&&qd>=3&&(fs[qd]!==fs[0]||fs[qd+1]!==fs[1])&&$f(fs,fs[0],fs[1],fs[2]),fs.length&&rh.push(fs)}function _p(Ih){var rh=[];return rh.size=Ih.size,rh.start=Ih.start,rh.end=Ih.end,rh}function kd(Ih,rh,sh,oh,Dh,$h){for(var yl=0;yl<Ih.length;yl++)Fp(Ih[yl],rh,sh,oh,Dh,$h,!1)}function $f(Ih,rh,sh,oh){Ih.push(rh),Ih.push(sh),Ih.push(oh)}function Uf(Ih,rh,sh,oh,Dh,$h){var yl=($h-rh)/(oh-rh);return Ih.push($h),Ih.push(sh+(Dh-sh)*yl),Ih.push(1),yl}function cd(Ih,rh,sh,oh,Dh,$h){var yl=($h-sh)/(Dh-sh);return Ih.push(rh+(oh-rh)*yl),Ih.push($h),Ih.push(1),yl}function cp(Ih,rh){for(var sh=[],oh=0;oh<Ih.length;oh++){var Dh,$h=Ih[oh],yl=$h.type;if(yl==="Point"||yl==="MultiPoint"||yl==="LineString")Dh=xp($h.geometry,rh);else if(yl==="MultiLineString"||yl==="Polygon"){Dh=[];for(var gs=0;gs<$h.geometry.length;gs++)Dh.push(xp($h.geometry[gs],rh))}else if(yl==="MultiPolygon")for(Dh=[],gs=0;gs<$h.geometry.length;gs++){for(var Cr=[],fs=0;fs<$h.geometry[gs].length;fs++)Cr.push(xp($h.geometry[gs][fs],rh));Dh.push(Cr)}sh.push(Kd($h.id,yl,Dh,$h.tags))}return sh}function xp(Ih,rh){var sh=[];sh.size=Ih.size,Ih.start!==void 0&&(sh.start=Ih.start,sh.end=Ih.end);for(var oh=0;oh<Ih.length;oh+=3)sh.push(Ih[oh]+rh,Ih[oh+1],Ih[oh+2]);return sh}function Ep(Ih,rh){if(Ih.transformed)return Ih;var sh,oh,Dh,$h=1<<Ih.z,yl=Ih.x,gs=Ih.y;for(sh=0;sh<Ih.features.length;sh++){var Cr=Ih.features[sh],fs=Cr.geometry,ul=Cr.type;if(Cr.geometry=[],ul===1)for(oh=0;oh<fs.length;oh+=2)Cr.geometry.push(Vp(fs[oh],fs[oh+1],rh,$h,yl,gs));else for(oh=0;oh<fs.length;oh++){var ih=[];for(Dh=0;Dh<fs[oh].length;Dh+=2)ih.push(Vp(fs[oh][Dh],fs[oh][Dh+1],rh,$h,yl,gs));Cr.geometry.push(ih)}}return Ih.transformed=!0,Ih}function Vp(Ih,rh,sh,oh,Dh,$h){return[Math.round(sh*(Ih*oh-Dh)),Math.round(sh*(rh*oh-$h))]}function bd(Ih,rh,sh,oh,Dh){for(var $h=rh===Dh.maxZoom?0:Dh.tolerance/((1<<rh)*Dh.extent),yl={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:sh,y:oh,z:rh,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},gs=0;gs<Ih.length;gs++){yl.numFeatures++,Yd(yl,Ih[gs],$h,Dh);var Cr=Ih[gs].minX,fs=Ih[gs].minY,ul=Ih[gs].maxX,ih=Ih[gs].maxY;Cr<yl.minX&&(yl.minX=Cr),fs<yl.minY&&(yl.minY=fs),ul>yl.maxX&&(yl.maxX=ul),ih>yl.maxY&&(yl.maxY=ih)}return yl}function Yd(Ih,rh,sh,oh){var Dh=rh.geometry,$h=rh.type,yl=[];if($h==="Point"||$h==="MultiPoint")for(var gs=0;gs<Dh.length;gs+=3)yl.push(Dh[gs]),yl.push(Dh[gs+1]),Ih.numPoints++,Ih.numSimplified++;else if($h==="LineString")np(yl,Dh,Ih,sh,!1,!1);else if($h==="MultiLineString"||$h==="Polygon")for(gs=0;gs<Dh.length;gs++)np(yl,Dh[gs],Ih,sh,$h==="Polygon",gs===0);else if($h==="MultiPolygon")for(var Cr=0;Cr<Dh.length;Cr++){var fs=Dh[Cr];for(gs=0;gs<fs.length;gs++)np(yl,fs[gs],Ih,sh,!0,gs===0)}if(yl.length){var ul=rh.tags||null;if($h==="LineString"&&oh.lineMetrics){for(var ih in ul={},rh.tags)ul[ih]=rh.tags[ih];ul.mapbox_clip_start=Dh.start/Dh.size,ul.mapbox_clip_end=Dh.end/Dh.size}var ch={geometry:yl,type:$h==="Polygon"||$h==="MultiPolygon"?3:$h==="LineString"||$h==="MultiLineString"?2:1,tags:ul};rh.id!==null&&(ch.id=rh.id),Ih.features.push(ch)}}function np(Ih,rh,sh,oh,Dh,$h){var yl=oh*oh;if(oh>0&&rh.size<(Dh?yl:oh))sh.numPoints+=rh.length/3;else{for(var gs=[],Cr=0;Cr<rh.length;Cr+=3)(oh===0||rh[Cr+2]>yl)&&(sh.numSimplified++,gs.push(rh[Cr]),gs.push(rh[Cr+1])),sh.numPoints++;Dh&&function(fs,ul){for(var ih=0,ch=0,vh=fs.length,Th=vh-2;ch<vh;Th=ch,ch+=2)ih+=(fs[ch]-fs[Th])*(fs[ch+1]+fs[Th+1]);if(ih>0===ul)for(ch=0,vh=fs.length;ch<vh/2;ch+=2){var Nh=fs[ch],Qh=fs[ch+1];fs[ch]=fs[vh-2-ch],fs[ch+1]=fs[vh-1-ch],fs[vh-2-ch]=Nh,fs[vh-1-ch]=Qh}}(gs,$h),Ih.push(gs)}}function Up(Ih,rh){var sh=(rh=this.options=function(Dh,$h){for(var yl in $h)Dh[yl]=$h[yl];return Dh}(Object.create(this.options),rh)).debug;if(sh&&console.time("preprocess data"),rh.maxZoom<0||rh.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(rh.promoteId&&rh.generateId)throw new Error("promoteId and generateId cannot be used together.");var oh=function(Dh,$h){var yl=[];if(Dh.type==="FeatureCollection")for(var gs=0;gs<Dh.features.length;gs++)Ip(yl,Dh.features[gs],$h,gs);else Ip(yl,Dh.type==="Feature"?Dh:{geometry:Dh},$h);return yl}(Ih,rh);this.tiles={},this.tileCoords=[],sh&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",rh.indexMaxZoom,rh.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),oh=function(Dh,$h){var yl=$h.buffer/$h.extent,gs=Dh,Cr=fd(Dh,1,-1-yl,yl,0,-1,2,$h),fs=fd(Dh,1,1-yl,2+yl,0,-1,2,$h);return(Cr||fs)&&(gs=fd(Dh,1,-yl,1+yl,0,-1,2,$h)||[],Cr&&(gs=cp(Cr,1).concat(gs)),fs&&(gs=gs.concat(cp(fs,-1)))),gs}(oh,rh),oh.length&&this.splitTile(oh,0,0,0),sh&&(oh.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Qp(Ih,rh,sh){return 32*((1<<Ih)*sh+rh)+Ih}function Rp(Ih,rh){const sh=Ih.tileID.canonical;if(!this._geoJSONIndex)return rh(null,null);const oh=this._geoJSONIndex.getTile(sh.z,sh.x,sh.y);if(!oh)return rh(null,null);const Dh=new class{constructor(yl){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=yl.length,this._features=yl}feature(yl){return new class{constructor(gs){this._feature=gs,this.extent=s.EXTENT,this.type=gs.type,this.properties=gs.tags,"id"in gs&&!isNaN(gs.id)&&(this.id=parseInt(gs.id,10))}loadGeometry(){if(this._feature.type===1){const gs=[];for(const Cr of this._feature.geometry)gs.push([new s.Point(Cr[0],Cr[1])]);return gs}{const gs=[];for(const Cr of this._feature.geometry){const fs=[];for(const ul of Cr)fs.push(new s.Point(ul[0],ul[1]));gs.push(fs)}return gs}}toGeoJSON(gs,Cr,fs){return ir.call(this,gs,Cr,fs)}}(this._features[yl])}}(oh.features);let $h=Ed(Dh);$h.byteOffset===0&&$h.byteLength===$h.buffer.byteLength||($h=new Uint8Array($h)),rh(null,{vectorTile:Dh,rawData:$h.buffer})}Up.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Up.prototype.splitTile=function(Ih,rh,sh,oh,Dh,$h,yl){for(var gs=[Ih,rh,sh,oh],Cr=this.options,fs=Cr.debug;gs.length;){oh=gs.pop(),sh=gs.pop(),rh=gs.pop(),Ih=gs.pop();var ul=1<<rh,ih=Qp(rh,sh,oh),ch=this.tiles[ih];if(!ch&&(fs>1&&console.time("creation"),ch=this.tiles[ih]=bd(Ih,rh,sh,oh,Cr),this.tileCoords.push({z:rh,x:sh,y:oh}),fs)){fs>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",rh,sh,oh,ch.numFeatures,ch.numPoints,ch.numSimplified),console.timeEnd("creation"));var vh="z"+rh;this.stats[vh]=(this.stats[vh]||0)+1,this.total++}if(ch.source=Ih,Dh){if(rh===Cr.maxZoom||rh===Dh)continue;var Th=1<<Dh-rh;if(sh!==Math.floor($h/Th)||oh!==Math.floor(yl/Th))continue}else if(rh===Cr.indexMaxZoom||ch.numPoints<=Cr.indexMaxPoints)continue;if(ch.source=null,Ih.length!==0){fs>1&&console.time("clipping");var Nh,Qh,rd,_d,ip,Dp,qd=.5*Cr.buffer/Cr.extent,wp=.5-qd,pp=.5+qd,Wp=1+qd;Nh=Qh=rd=_d=null,ip=fd(Ih,ul,sh-qd,sh+pp,0,ch.minX,ch.maxX,Cr),Dp=fd(Ih,ul,sh+wp,sh+Wp,0,ch.minX,ch.maxX,Cr),Ih=null,ip&&(Nh=fd(ip,ul,oh-qd,oh+pp,1,ch.minY,ch.maxY,Cr),Qh=fd(ip,ul,oh+wp,oh+Wp,1,ch.minY,ch.maxY,Cr),ip=null),Dp&&(rd=fd(Dp,ul,oh-qd,oh+pp,1,ch.minY,ch.maxY,Cr),_d=fd(Dp,ul,oh+wp,oh+Wp,1,ch.minY,ch.maxY,Cr),Dp=null),fs>1&&console.timeEnd("clipping"),gs.push(Nh||[],rh+1,2*sh,2*oh),gs.push(Qh||[],rh+1,2*sh,2*oh+1),gs.push(rd||[],rh+1,2*sh+1,2*oh),gs.push(_d||[],rh+1,2*sh+1,2*oh+1)}}},Up.prototype.getTile=function(Ih,rh,sh){var oh=this.options,Dh=oh.extent,$h=oh.debug;if(Ih<0||Ih>24)return null;var yl=1<<Ih,gs=Qp(Ih,rh=(rh%yl+yl)%yl,sh);if(this.tiles[gs])return Ep(this.tiles[gs],Dh);$h>1&&console.log("drilling down to z%d-%d-%d",Ih,rh,sh);for(var Cr,fs=Ih,ul=rh,ih=sh;!Cr&&fs>0;)fs--,ul=Math.floor(ul/2),ih=Math.floor(ih/2),Cr=this.tiles[Qp(fs,ul,ih)];return Cr&&Cr.source?($h>1&&console.log("found parent tile z%d-%d-%d",fs,ul,ih),$h>1&&console.time("drilling down"),this.splitTile(Cr.source,fs,ul,ih,Ih,rh,sh),$h>1&&console.timeEnd("drilling down"),this.tiles[gs]?Ep(this.tiles[gs],Dh):null):null};class ng extends s.VectorTileWorkerSource{constructor(rh,sh,oh,Dh,$h){super(rh,sh,oh,Dh,Rp),$h&&(this.loadGeoJSON=$h)}loadData(rh,sh){const oh=rh&&rh.request,Dh=oh&&oh.collectResourceTiming;this.loadGeoJSON(rh,($h,yl)=>{if($h||!yl)return sh($h);if(typeof yl!="object")return sh(new Error(`Input data given to '${rh.source}' is not a valid GeoJSON object.`));{Ht(yl,!0);try{if(rh.filter){const Cr=s.createExpression(rh.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Cr.result==="error")throw new Error(Cr.value.map(ul=>`${ul.key}: ${ul.message}`).join(", "));yl={type:"FeatureCollection",features:yl.features.filter(ul=>Cr.value.evaluate({zoom:0},ul))}}this._geoJSONIndex=rh.cluster?new wd(function({superclusterOptions:Cr,clusterProperties:fs}){if(!fs||!Cr)return Cr;const ul={},ih={},ch={accumulated:null,zoom:0},vh={properties:null},Th=Object.keys(fs);for(const Nh of Th){const[Qh,rd]=fs[Nh],_d=s.createExpression(rd),ip=s.createExpression(typeof Qh=="string"?[Qh,["accumulated"],["get",Nh]]:Qh);ul[Nh]=_d.value,ih[Nh]=ip.value}return Cr.map=Nh=>{vh.properties=Nh;const Qh={};for(const rd of Th)Qh[rd]=ul[rd].evaluate(ch,vh);return Qh},Cr.reduce=(Nh,Qh)=>{vh.properties=Qh;for(const rd of Th)ch.accumulated=Nh[rd],Nh[rd]=ih[rd].evaluate(ch,vh)},Cr}(rh)).load(yl.features):function(Cr,fs){return new Up(Cr,fs)}(yl,rh.geojsonVtOptions)}catch(Cr){return sh(Cr)}this.loaded={};const gs={};if(Dh){const Cr=s.getPerformanceMeasurement(oh);Cr&&(gs.resourceTiming={},gs.resourceTiming[rh.source]=JSON.parse(JSON.stringify(Cr)))}sh(null,gs)}})}reloadTile(rh,sh){const oh=this.loaded;return oh&&oh[rh.uid]?super.reloadTile(rh,sh):this.loadTile(rh,sh)}loadGeoJSON(rh,sh){if(rh.request)s.getJSON(rh.request,sh);else{if(typeof rh.data!="string")return sh(new Error(`Input data given to '${rh.source}' is not a valid GeoJSON object.`));try{return sh(null,JSON.parse(rh.data))}catch{return sh(new Error(`Input data given to '${rh.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(rh,sh){try{sh(null,this._geoJSONIndex.getClusterExpansionZoom(rh.clusterId))}catch(oh){sh(oh)}}getClusterChildren(rh,sh){try{sh(null,this._geoJSONIndex.getChildren(rh.clusterId))}catch(oh){sh(oh)}}getClusterLeaves(rh,sh){try{sh(null,this._geoJSONIndex.getLeaves(rh.clusterId,rh.limit,rh.offset))}catch(oh){sh(oh)}}}class bg{constructor(rh){this.self=rh,this.actor=new s.Actor(rh,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.getProjection({name:"mercator"}),this.workerSourceTypes={vector:s.VectorTileWorkerSource,geojson:ng},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(sh,oh)=>{if(this.workerSourceTypes[sh])throw new Error(`Worker source with name "${sh}" already registered.`);this.workerSourceTypes[sh]=oh},this.self.registerRTLTextPlugin=sh=>{if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=sh.applyArabicShaping,s.plugin.processBidirectionalText=sh.processBidirectionalText,s.plugin.processStyledBidirectionalText=sh.processStyledBidirectionalText}}clearCaches(rh,sh,oh){delete this.layerIndexes[rh],delete this.availableImages[rh],delete this.workerSources[rh],delete this.demWorkerSources[rh],oh()}checkIfReady(rh,sh,oh){oh()}setReferrer(rh,sh){this.referrer=sh}spriteLoaded(rh,sh){this.isSpriteLoaded[rh]=sh;for(const oh in this.workerSources[rh]){const Dh=this.workerSources[rh][oh];for(const $h in Dh)Dh[$h]instanceof s.VectorTileWorkerSource&&(Dh[$h].isSpriteLoaded=sh,Dh[$h].fire(new s.Event("isSpriteLoaded")))}}setImages(rh,sh,oh){this.availableImages[rh]=sh;for(const Dh in this.workerSources[rh]){const $h=this.workerSources[rh][Dh];for(const yl in $h)$h[yl].availableImages=sh}oh()}enableTerrain(rh,sh,oh){this.terrain=sh,oh()}setProjection(rh,sh){this.projections[rh]=s.getProjection(sh)}setLayers(rh,sh,oh){this.getLayerIndex(rh).replace(sh),oh()}updateLayers(rh,sh,oh){this.getLayerIndex(rh).update(sh.layers,sh.removedIds),oh()}loadTile(rh,sh,oh){const Dh=this.enableTerrain?s.extend({enableTerrain:this.terrain},sh):sh;Dh.projection=this.projections[rh]||this.defaultProjection,this.getWorkerSource(rh,sh.type,sh.source).loadTile(Dh,oh)}loadDEMTile(rh,sh,oh){const Dh=this.enableTerrain?s.extend({buildQuadTree:this.terrain},sh):sh;this.getDEMWorkerSource(rh,sh.source).loadTile(Dh,oh)}reloadTile(rh,sh,oh){const Dh=this.enableTerrain?s.extend({enableTerrain:this.terrain},sh):sh;Dh.projection=this.projections[rh]||this.defaultProjection,this.getWorkerSource(rh,sh.type,sh.source).reloadTile(Dh,oh)}abortTile(rh,sh,oh){this.getWorkerSource(rh,sh.type,sh.source).abortTile(sh,oh)}removeTile(rh,sh,oh){this.getWorkerSource(rh,sh.type,sh.source).removeTile(sh,oh)}removeSource(rh,sh,oh){if(!this.workerSources[rh]||!this.workerSources[rh][sh.type]||!this.workerSources[rh][sh.type][sh.source])return;const Dh=this.workerSources[rh][sh.type][sh.source];delete this.workerSources[rh][sh.type][sh.source],Dh.removeSource!==void 0?Dh.removeSource(sh,oh):oh()}loadWorkerSource(rh,sh,oh){try{this.self.importScripts(sh.url),oh()}catch(Dh){oh(Dh.toString())}}syncRTLPluginState(rh,sh,oh){try{s.plugin.setState(sh);const Dh=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&Dh!=null){this.self.importScripts(Dh);const $h=s.plugin.isParsed();oh($h?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Dh}`),$h)}}catch(Dh){oh(Dh.toString())}}getAvailableImages(rh){let sh=this.availableImages[rh];return sh||(sh=[]),sh}getLayerIndex(rh){let sh=this.layerIndexes[rh];return sh||(sh=this.layerIndexes[rh]=new D),sh}getWorkerSource(rh,sh,oh){if(this.workerSources[rh]||(this.workerSources[rh]={}),this.workerSources[rh][sh]||(this.workerSources[rh][sh]={}),!this.workerSources[rh][sh][oh]){const Dh={send:($h,yl,gs,Cr,fs,ul)=>{this.actor.send($h,yl,gs,rh,fs,ul)},scheduler:this.actor.scheduler};this.workerSources[rh][sh][oh]=new this.workerSourceTypes[sh](Dh,this.getLayerIndex(rh),this.getAvailableImages(rh),this.isSpriteLoaded[rh])}return this.workerSources[rh][sh][oh]}getDEMWorkerSource(rh,sh){return this.demWorkerSources[rh]||(this.demWorkerSources[rh]={}),this.demWorkerSources[rh][sh]||(this.demWorkerSources[rh][sh]=new W),this.demWorkerSources[rh][sh]}enforceCacheSizeLimit(rh,sh){s.enforceCacheSizeLimit(sh)}getWorkerPerformanceMetrics(rh,sh,oh){oh(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new bg(self)),bg}),a(["./shared"],function(s){function m(L,p){if(Array.isArray(L)){if(!Array.isArray(p)||L.length!==p.length)return!1;for(let S=0;S<L.length;S++)if(!m(L[S],p[S]))return!1;return!0}if(typeof L=="object"&&L!==null&&p!==null){if(typeof p!="object"||Object.keys(L).length!==Object.keys(p).length)return!1;for(const S in L)if(!m(L[S],p[S]))return!1;return!0}return L===p}var y=D;function D(L){return!function(p){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var X,ze,kt=new Blob([""],{type:"text/javascript"}),vi=URL.createObjectURL(kt);try{ze=new Worker(vi),X=!0}catch{X=!1}return ze&&ze.terminate(),URL.revokeObjectURL(vi),X}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var X=document.createElement("canvas");X.width=X.height=1;var ze=X.getContext("2d");if(!ze)return!1;var kt=ze.getImageData(0,0,1,1);return kt&&kt.width===X.width}()?(W[S=p&&p.failIfMajorPerformanceCaveat]===void 0&&(W[S]=function(X){var ze,kt=function(vi){var or=document.createElement("canvas"),Gn=Object.create(D.webGLContextAttributes);return Gn.failIfMajorPerformanceCaveat=vi,or.getContext("webgl",Gn)||or.getContext("experimental-webgl",Gn)}(X);if(!kt)return!1;try{ze=kt.createShader(kt.VERTEX_SHADER)}catch{return!1}return!(!ze||kt.isContextLost())&&(kt.shaderSource(ze,"void main() {}"),kt.compileShader(ze),kt.getShaderParameter(ze,kt.COMPILE_STATUS)===!0)}(S)),W[S]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var S}(L)}var W={};function Ee(L,p,S){const X=s.window.document.createElement(L);return p!==void 0&&(X.className=p),S&&S.appendChild(X),X}function dt(L,p,S){const X=s.window.document.createElementNS("http://www.w3.org/2000/svg",L);for(const ze of Object.keys(p))X.setAttributeNS(null,ze,p[ze]);return S&&S.appendChild(X),X}D.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ht=s.window.document&&s.window.document.documentElement.style,ir=Ht&&Ht.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Hr;function Bn(){Ht&&ir&&(Hr=Ht[ir],Ht[ir]="none")}function Vn(){Ht&&ir&&(Ht[ir]=Hr)}function Wr(L){L.preventDefault(),L.stopPropagation(),s.window.removeEventListener("click",Wr,!0)}function ps(){s.window.addEventListener("click",Wr,!0),s.window.setTimeout(()=>{s.window.removeEventListener("click",Wr,!0)},0)}function il(L,p){const S=L.getBoundingClientRect();return sl(L,S,p)}function gl(L,p){const S=L.getBoundingClientRect(),X=[];for(let ze=0;ze<p.length;ze++)X.push(sl(L,S,p[ze]));return X}function ml(L){return s.window.InstallTrigger!==void 0&&L.button===2&&L.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:L.button}function sl(L,p,S){const X=L.offsetWidth===p.width?1:L.offsetWidth/p.width;return new s.Point((S.clientX-p.left)*X,(S.clientY-p.top)*X)}function ll(L,p){var S=p[0],X=p[1],ze=p[2],kt=p[3],vi=S*kt-ze*X;return vi?(L[0]=kt*(vi=1/vi),L[1]=-X*vi,L[2]=-ze*vi,L[3]=S*vi,L):null}function rl(L){const{userImage:p}=L;return!!(p&&p.render&&p.render())&&(L.data.replace(new Uint8Array(p.data.buffer)),!0)}class th extends s.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(p){if(this.loaded!==p&&(this.loaded=p,p)){for(const{ids:S,callback:X}of this.requestors)this._notify(S,X);this.requestors=[]}}hasImage(p){return!!this.getImage(p)}getImage(p){return this.images[p]}addImage(p,S){this._validate(p,S)&&(this.images[p]=S)}_validate(p,S){let X=!0;return this._validateStretch(S.stretchX,S.data&&S.data.width)||(this.fire(new s.ErrorEvent(new Error(`Image "${p}" has invalid "stretchX" value`))),X=!1),this._validateStretch(S.stretchY,S.data&&S.data.height)||(this.fire(new s.ErrorEvent(new Error(`Image "${p}" has invalid "stretchY" value`))),X=!1),this._validateContent(S.content,S)||(this.fire(new s.ErrorEvent(new Error(`Image "${p}" has invalid "content" value`))),X=!1),X}_validateStretch(p,S){if(!p)return!0;let X=0;for(const ze of p){if(ze[0]<X||ze[1]<ze[0]||S<ze[1])return!1;X=ze[1]}return!0}_validateContent(p,S){return!(p&&(p.length!==4||p[0]<0||S.data.width<p[0]||p[1]<0||S.data.height<p[1]||p[2]<0||S.data.width<p[2]||p[3]<0||S.data.height<p[3]||p[2]<p[0]||p[3]<p[1]))}updateImage(p,S){S.version=this.images[p].version+1,this.images[p]=S,this.updatedImages[p]=!0}removeImage(p){const S=this.images[p];delete this.images[p],delete this.patterns[p],S.userImage&&S.userImage.onRemove&&S.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(p,S){let X=!0;if(!this.isLoaded())for(const ze of p)this.images[ze]||(X=!1);this.isLoaded()||X?this._notify(p,S):this.requestors.push({ids:p,callback:S})}_notify(p,S){const X={};for(const ze of p){this.images[ze]||this.fire(new s.Event("styleimagemissing",{id:ze}));const kt=this.images[ze];kt?X[ze]={data:kt.data.clone(),pixelRatio:kt.pixelRatio,sdf:kt.sdf,version:kt.version,stretchX:kt.stretchX,stretchY:kt.stretchY,content:kt.content,hasRenderCallback:!!(kt.userImage&&kt.userImage.render)}:s.warnOnce(`Image "${ze}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}S(null,X)}getPixelSize(){const{width:p,height:S}=this.atlasImage;return{width:p,height:S}}getPattern(p){const S=this.patterns[p],X=this.getImage(p);if(!X)return null;if(S&&S.position.version===X.version)return S.position;if(S)S.position.version=X.version;else{const ze={w:X.data.width+2,h:X.data.height+2,x:0,y:0},kt=new s.ImagePosition(ze,X);this.patterns[p]={bin:ze,position:kt}}return this._updatePatternAtlas(),this.patterns[p].position}bind(p){const S=p.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(p,this.atlasImage,S.RGBA),this.atlasTexture&&this.atlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE)}_updatePatternAtlas(){const p=[];for(const kt in this.patterns)p.push(this.patterns[kt].bin);const{w:S,h:X}=s.potpack(p),ze=this.atlasImage;ze.resize({width:S||1,height:X||1});for(const kt in this.patterns){const{bin:vi}=this.patterns[kt],or=vi.x+1,Gn=vi.y+1,ia=this.images[kt].data,oa=ia.width,pl=ia.height;s.RGBAImage.copy(ia,ze,{x:0,y:0},{x:or,y:Gn},{width:oa,height:pl}),s.RGBAImage.copy(ia,ze,{x:0,y:pl-1},{x:or,y:Gn-1},{width:oa,height:1}),s.RGBAImage.copy(ia,ze,{x:0,y:0},{x:or,y:Gn+pl},{width:oa,height:1}),s.RGBAImage.copy(ia,ze,{x:oa-1,y:0},{x:or-1,y:Gn},{width:1,height:pl}),s.RGBAImage.copy(ia,ze,{x:0,y:0},{x:or+oa,y:Gn},{width:1,height:pl})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(p){for(const S of p){if(this.callbackDispatchedThisFrame[S])continue;this.callbackDispatchedThisFrame[S]=!0;const X=this.images[S];rl(X)&&this.updateImage(S,X)}}}const nh=new s.Properties({anchor:new s.DataConstantProperty(s.spec.light.anchor),position:new class{constructor(){this.specification=s.spec.light.position}possiblyEvaluate(L,p){return function([S,X,ze]){const kt=s.degToRad(X+90),vi=s.degToRad(ze);return{x:S*Math.cos(kt)*Math.sin(vi),y:S*Math.sin(kt)*Math.sin(vi),z:S*Math.cos(vi),azimuthal:X,polar:ze}}(L.expression.evaluate(p))}interpolate(L,p,S){return{x:s.number(L.x,p.x,S),y:s.number(L.y,p.y,S),z:s.number(L.z,p.z,S),azimuthal:s.number(L.azimuthal,p.azimuthal,S),polar:s.number(L.polar,p.polar,S)}}},color:new s.DataConstantProperty(s.spec.light.color),intensity:new s.DataConstantProperty(s.spec.light.intensity)});class bh extends s.Evented{constructor(p){super(),this._transitionable=new s.Transitionable(nh),this.setLight(p),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(p,S={}){if(!this._validate(s.validateLight,p,S))for(const X in p){const ze=p[X];s.endsWith(X,"-transition")?this._transitionable.setTransition(X.slice(0,-11),ze):this._transitionable.setValue(X,ze)}}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}_validate(p,S,X){return(!X||X.validate!==!1)&&s.emitValidationErrors(this,p.call(s.validateStyle,s.extend({value:S,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}const Fh=new s.Properties({source:new s.DataConstantProperty(s.spec.terrain.source),exaggeration:new s.DataConstantProperty(s.spec.terrain.exaggeration)});let Bh=class extends s.Evented{constructor(L,p){super(),this._transitionable=new s.Transitionable(Fh),this.set(L),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=p}get(){return this._transitionable.serialize()}set(L){for(const p in L){const S=L[p];s.endsWith(p,"-transition")?this._transitionable.setTransition(p.slice(0,-11),S):this._transitionable.setValue(p,S)}}updateTransitions(L){this._transitioning=this._transitionable.transitioned(L,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(L){this.properties=this._transitioning.possiblyEvaluate(L)}};function Ed(L,p,S,X){const ze=s.smoothstep(45,65,S),[kt,vi]=Td(L,X),or=s.length(p);let Gn=1-Math.min(1,Math.exp((or-kt)/(vi-kt)*-6));return Gn*=Gn*Gn,Gn=Math.min(1,1.00747*Gn),Gn*ze*L.alpha}function Td(L,p){const S=.5/Math.tan(.5*p);return[L.range[0]+S,L.range[1]+S]}const td=new s.Properties({range:new s.DataConstantProperty(s.spec.fog.range),color:new s.DataConstantProperty(s.spec.fog.color),"high-color":new s.DataConstantProperty(s.spec.fog["high-color"]),"space-color":new s.DataConstantProperty(s.spec.fog["space-color"]),"horizon-blend":new s.DataConstantProperty(s.spec.fog["horizon-blend"]),"star-intensity":new s.DataConstantProperty(s.spec.fog["star-intensity"])});class Fd extends s.Evented{constructor(p,S){super(),this._transitionable=new s.Transitionable(td),this.set(p),this._transitioning=this._transitionable.untransitioned(),this._transform=S}get state(){const p=this._transform,S=p.projection.name==="globe",X=s.globeToMercatorTransition(p.zoom),ze=this.properties.get("range"),kt=[.5,3];return{range:S?[s.number(kt[0],ze[0],X),s.number(kt[1],ze[1],X)]:ze,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(p,S={}){if(!this._validate(s.validateFog,p,S)){for(const X of Object.keys(s.spec.fog))p&&p[X]===void 0&&(p[X]=s.spec.fog[X].default);for(const X in p){const ze=p[X];s.endsWith(X,"-transition")?this._transitionable.setTransition(X.slice(0,-11),ze):this._transitionable.setValue(X,ze)}}}getOpacity(p){if(!this._transform.projection.supportsFog)return 0;const S=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.smoothstep(45,65,p))*S.a}getOpacityAtLatLng(p,S){return this._transform.projection.supportsFog?function(X,ze,kt){const vi=s.MercatorCoordinate.fromLngLat(ze),or=kt.elevation?kt.elevation.getAtPointOrZero(vi):0,Gn=[vi.x,vi.y,or];return s.transformMat4(Gn,Gn,kt.mercatorFogMatrix),Ed(X,Gn,kt.pitch,kt._fov)}(this.state,p,S):0}getFovAdjustedRange(p){return this._transform.projection.supportsFog?Td(this.state,p):[0,1]}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}_validate(p,S,X){return(!X||X.validate!==!1)&&s.emitValidationErrors(this,p.call(s.validateStyle,s.extend({value:S,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}class Ld{constructor(p,S){this.workerPool=p,this.actors=[],this.currentActor=0,this.id=s.uniqueId();const X=this.workerPool.acquire(this.id);for(let ze=0;ze<X.length;ze++){const kt=new Ld.Actor(X[ze],S,this.id);kt.name=`Worker ${ze}`,this.actors.push(kt)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(p,S,X){s.asyncAll(this.actors,(ze,kt)=>{ze.send(p,S,kt)},X=X||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(p=>{p.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Ud(L,p,S){return p*(s.EXTENT/(L.tileSize*Math.pow(2,S-L.tileID.overscaledZ)))}Ld.Actor=s.Actor;class Xd{constructor(p,S,X,ze){this.screenBounds=p,this.cameraPoint=S,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=X,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,ze)}static createFromScreenPoints(p,S){let X,ze;if(p instanceof s.Point||typeof p[0]=="number"){const kt=s.Point.convert(p);X=[kt],ze=S.isPointAboveHorizon(kt)}else{const kt=s.Point.convert(p[0]),vi=s.Point.convert(p[1]);X=[kt,vi],ze=s.polygonizeBounds(kt,vi).every(or=>S.isPointAboveHorizon(or))}return new Xd(X,S.getCameraPoint(),ze,S)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(p){return s.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],p)}bufferedCameraGeometry(p){const S=this.screenBounds[0],X=this.screenBounds.length===1?this.screenBounds[0].add(new s.Point(1,1)):this.screenBounds[1],ze=s.polygonizeBounds(S,X,0,!1);return this.cameraPoint.y>X.y&&(this.cameraPoint.x>S.x&&this.cameraPoint.x<X.x?ze.splice(3,0,this.cameraPoint):this.cameraPoint.x>=X.x?ze[2]=this.cameraPoint:this.cameraPoint.x<=S.x&&(ze[3]=this.cameraPoint)),s.bufferConvexPolygon(ze,p)}bufferedCameraGeometryGlobe(p){const S=this.screenBounds[0],X=this.screenBounds.length===1?this.screenBounds[0].add(new s.Point(1,1)):this.screenBounds[1],ze=s.polygonizeBounds(S,X,p),kt=this.cameraPoint.clone();switch(3*((kt.y>S.y)+(kt.y>X.y))+((kt.x>S.x)+(kt.x>X.x))){case 0:ze[0]=kt,ze[4]=kt.clone();break;case 1:ze.splice(1,0,kt);break;case 2:ze[1]=kt;break;case 3:ze.splice(4,0,kt);break;case 5:ze.splice(2,0,kt);break;case 6:ze[3]=kt;break;case 7:ze.splice(3,0,kt);break;case 8:ze[2]=kt}return ze}containsTile(p,S,X,ze=0){const kt=p.queryPadding/S._pixelsPerMercatorPixel+1,vi=X?this._bufferedCameraMercator(kt,S):this._bufferedScreenMercator(kt,S);let or=p.tileID.wrap+(vi.unwrapped?ze:0);const Gn=vi.polygon.map(xh=>s.getTilePoint(p.tileTransform,xh,or));if(!s.polygonIntersectsBox(Gn,0,0,s.EXTENT,s.EXTENT))return;or=p.tileID.wrap+(this.screenGeometryMercator.unwrapped?ze:0);const ia=this.screenGeometryMercator.polygon.map(xh=>s.getTileVec3(p.tileTransform,xh,or)),oa=ia.map(xh=>new s.Point(xh[0],xh[1])),pl=S.getFreeCameraOptions().position||new s.MercatorCoordinate(0,0,0),lh=s.getTileVec3(p.tileTransform,pl,or),gh=ia.map(xh=>{const _l=s.sub(xh,xh,lh);return s.normalize(_l,_l),new s.Ray(lh,_l)}),yh=Ud(p,1,S.zoom)*S._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:oa,tilespaceRays:gh,bufferedTilespaceGeometry:Gn,bufferedTilespaceBounds:(_h=s.getBounds(Gn),_h.min.x=s.clamp(_h.min.x,0,s.EXTENT),_h.min.y=s.clamp(_h.min.y,0,s.EXTENT),_h.max.x=s.clamp(_h.max.x,0,s.EXTENT),_h.max.y=s.clamp(_h.max.y,0,s.EXTENT),_h),tile:p,tileID:p.tileID,pixelToTileUnitsFactor:yh};var _h}_bufferedScreenMercator(p,S){const X=Rd(p);if(this._screenRaycastCache[X])return this._screenRaycastCache[X];{let ze;return ze=S.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(p),S):{polygon:this.bufferedScreenGeometry(p).map(kt=>S.pointCoordinate3D(kt)),unwrapped:!0},this._screenRaycastCache[X]=ze,ze}}_bufferedCameraMercator(p,S){const X=Rd(p);if(this._cameraRaycastCache[X])return this._cameraRaycastCache[X];{let ze;return ze=S.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(p),S):{polygon:this.bufferedCameraGeometry(p).map(kt=>S.pointCoordinate3D(kt)),unwrapped:!0},this._cameraRaycastCache[X]=ze,ze}}_projectAndResample(p,S){const X=function(kt,vi){const or=s.multiply([],vi.pixelMatrix,vi.globeMatrix),Gn=[0,-s.GLOBE_RADIUS,0,1],ia=[0,s.GLOBE_RADIUS,0,1],oa=[0,0,0,1];s.transformMat4$1(Gn,Gn,or),s.transformMat4$1(ia,ia,or),s.transformMat4$1(oa,oa,or);const pl=new s.Point(Gn[0]/Gn[3],Gn[1]/Gn[3]),lh=new s.Point(ia[0]/ia[3],ia[1]/ia[3]),gh=s.polygonContainsPoint(kt,pl)&&Gn[3]<oa[3],yh=s.polygonContainsPoint(kt,lh)&&ia[3]<oa[3];if(!gh&&!yh)return null;const _h=function(Vh,Wh,Zh){for(let id=1;id<Vh.length;id++){const Bd=zd(Wh.pointCoordinate3D(Vh[id-1]).x),ed=zd(Wh.pointCoordinate3D(Vh[id]).x);if(Zh<0){if(Bd<ed)return{idx:id,t:-Bd/(ed-1-Bd)}}else if(ed<Bd)return{idx:id,t:(1-Bd)/(ed+1-Bd)}}return null}(kt,vi,gh?-1:1);if(!_h)return null;const{idx:xh,t:_l}=_h;let mh=xh>1?wd(kt.slice(0,xh),vi):[],wh=xh<kt.length?wd(kt.slice(xh),vi):[];mh=mh.map(Vh=>new s.Point(zd(Vh.x),Vh.y)),wh=wh.map(Vh=>new s.Point(zd(Vh.x),Vh.y));const Sh=[...mh];Sh.length===0&&Sh.push(wh[wh.length-1]);const Oh=s.number(Sh[Sh.length-1].y,(wh.length===0?mh[0]:wh[0]).y,_l);let Uh;return Uh=gh?[new s.Point(0,Oh),new s.Point(0,0),new s.Point(1,0),new s.Point(1,Oh)]:[new s.Point(1,Oh),new s.Point(1,1),new s.Point(0,1),new s.Point(0,Oh)],Sh.push(...Uh),wh.length===0?Sh.push(mh[0]):Sh.push(...wh),{polygon:Sh.map(Vh=>new s.MercatorCoordinate(Vh.x,Vh.y)),unwrapped:!1}}(p,S);if(X)return X;const ze=function(kt,vi){let or=!1,Gn=-1/0,ia=0;for(let pl=0;pl<kt.length-1;pl++)kt[pl].x>Gn&&(Gn=kt[pl].x,ia=pl);for(let pl=0;pl<kt.length-1;pl++){const lh=(ia+pl)%(kt.length-1),gh=kt[lh],yh=kt[lh+1];Math.abs(gh.x-yh.x)>.5&&(gh.x<yh.x?(gh.x+=1,lh===0&&(kt[kt.length-1].x+=1)):(yh.x+=1,lh+1===kt.length-1&&(kt[0].x+=1)),or=!0)}const oa=s.mercatorXfromLng(vi.center.lng);return or&&oa<Math.abs(oa-1)&&kt.forEach(pl=>{pl.x-=1}),{polygon:kt,unwrapped:or}}(wd(p,S).map(kt=>new s.Point(zd(kt.x),kt.y)),S);return{polygon:ze.polygon.map(kt=>new s.MercatorCoordinate(kt.x,kt.y)),unwrapped:ze.unwrapped}}}function wd(L,p){return s.resample(L,S=>{const X=p.pointCoordinate3D(S);S.x=X.x,S.y=X.y},1/256)}function zd(L){return L<0?1+L%1:L%1}function Rd(L){return 100*L|0}function op(L,p,S,X,ze){const kt=function(vi,or){if(vi)return ze(vi);if(or){L.url&&or.tiles&&L.tiles&&delete L.tiles;const Gn=s.pick(s.extend(or,L),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);or.vector_layers&&(Gn.vectorLayers=or.vector_layers,Gn.vectorLayerIds=Gn.vectorLayers.map(ia=>ia.id)),Gn.tiles=p.canonicalizeTileset(Gn,L.url),ze(null,Gn)}};return L.url?s.getJSON(p.transformRequest(p.normalizeSourceURL(L.url,null,S,X),s.ResourceType.Source),kt):s.exported.frame(()=>kt(null,L))}class Wd{constructor(p,S,X){this.bounds=s.LngLatBounds.convert(this.validateBounds(p)),this.minzoom=S||0,this.maxzoom=X||24}validateBounds(p){return Array.isArray(p)&&p.length===4?[Math.max(-180,p[0]),Math.max(-90,p[1]),Math.min(180,p[2]),Math.min(90,p[3])]:[-180,-90,180,90]}contains(p){const S=Math.pow(2,p.z),X=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*S),ze=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*S),kt=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*S),vi=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*S);return p.x>=X&&p.x<kt&&p.y>=ze&&p.y<vi}}class Op{constructor(p,S,X){this.context=p;const ze=p.gl;this.buffer=ze.createBuffer(),this.dynamicDraw=!!X,this.context.unbindVAO(),p.bindElementBuffer.set(this.buffer),ze.bufferData(ze.ELEMENT_ARRAY_BUFFER,S.arrayBuffer,this.dynamicDraw?ze.DYNAMIC_DRAW:ze.STATIC_DRAW),this.dynamicDraw||S.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(p){const S=this.context.gl;this.context.unbindVAO(),this.bind(),S.bufferSubData(S.ELEMENT_ARRAY_BUFFER,0,p.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ep={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class zp{constructor(p,S,X,ze){this.length=S.length,this.attributes=X,this.itemSize=S.bytesPerElement,this.dynamicDraw=ze,this.context=p;const kt=p.gl;this.buffer=kt.createBuffer(),p.bindVertexBuffer.set(this.buffer),kt.bufferData(kt.ARRAY_BUFFER,S.arrayBuffer,this.dynamicDraw?kt.DYNAMIC_DRAW:kt.STATIC_DRAW),this.dynamicDraw||S.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(p){const S=this.context.gl;this.bind(),S.bufferSubData(S.ARRAY_BUFFER,0,p.arrayBuffer)}enableAttributes(p,S){for(let X=0;X<this.attributes.length;X++){const ze=S.attributes[this.attributes[X].name];ze!==void 0&&p.enableVertexAttribArray(ze)}}setVertexAttribPointers(p,S,X){for(let ze=0;ze<this.attributes.length;ze++){const kt=this.attributes[ze],vi=S.attributes[kt.name];vi!==void 0&&p.vertexAttribPointer(vi,kt.components,p[ep[kt.type]],!1,this.itemSize,kt.offset+this.itemSize*(X||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Kd{constructor(p){this.gl=p.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(p){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ap extends Kd{getDefault(){return s.Color.transparent}set(p){const S=this.current;(p.r!==S.r||p.g!==S.g||p.b!==S.b||p.a!==S.a||this.dirty)&&(this.gl.clearColor(p.r,p.g,p.b,p.a),this.current=p,this.dirty=!1)}}class Ip extends Kd{getDefault(){return 1}set(p){(p!==this.current||this.dirty)&&(this.gl.clearDepth(p),this.current=p,this.dirty=!1)}}class Yh extends Kd{getDefault(){return 0}set(p){(p!==this.current||this.dirty)&&(this.gl.clearStencil(p),this.current=p,this.dirty=!1)}}class Ad extends Kd{getDefault(){return[!0,!0,!0,!0]}set(p){const S=this.current;(p[0]!==S[0]||p[1]!==S[1]||p[2]!==S[2]||p[3]!==S[3]||this.dirty)&&(this.gl.colorMask(p[0],p[1],p[2],p[3]),this.current=p,this.dirty=!1)}}class kp extends Kd{getDefault(){return!0}set(p){(p!==this.current||this.dirty)&&(this.gl.depthMask(p),this.current=p,this.dirty=!1)}}class up extends Kd{getDefault(){return 255}set(p){(p!==this.current||this.dirty)&&(this.gl.stencilMask(p),this.current=p,this.dirty=!1)}}class rp extends Kd{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(p){const S=this.current;(p.func!==S.func||p.ref!==S.ref||p.mask!==S.mask||this.dirty)&&(this.gl.stencilFunc(p.func,p.ref,p.mask),this.current=p,this.dirty=!1)}}class fd extends Kd{getDefault(){const p=this.gl;return[p.KEEP,p.KEEP,p.KEEP]}set(p){const S=this.current;(p[0]!==S[0]||p[1]!==S[1]||p[2]!==S[2]||this.dirty)&&(this.gl.stencilOp(p[0],p[1],p[2]),this.current=p,this.dirty=!1)}}class Cp extends Kd{getDefault(){return!1}set(p){if(p===this.current&&!this.dirty)return;const S=this.gl;p?S.enable(S.STENCIL_TEST):S.disable(S.STENCIL_TEST),this.current=p,this.dirty=!1}}class Fp extends Kd{getDefault(){return[0,1]}set(p){const S=this.current;(p[0]!==S[0]||p[1]!==S[1]||this.dirty)&&(this.gl.depthRange(p[0],p[1]),this.current=p,this.dirty=!1)}}class _p extends Kd{getDefault(){return!1}set(p){if(p===this.current&&!this.dirty)return;const S=this.gl;p?S.enable(S.DEPTH_TEST):S.disable(S.DEPTH_TEST),this.current=p,this.dirty=!1}}class kd extends Kd{getDefault(){return this.gl.LESS}set(p){(p!==this.current||this.dirty)&&(this.gl.depthFunc(p),this.current=p,this.dirty=!1)}}class $f extends Kd{getDefault(){return!1}set(p){if(p===this.current&&!this.dirty)return;const S=this.gl;p?S.enable(S.BLEND):S.disable(S.BLEND),this.current=p,this.dirty=!1}}class Uf extends Kd{getDefault(){const p=this.gl;return[p.ONE,p.ZERO]}set(p){const S=this.current;(p[0]!==S[0]||p[1]!==S[1]||this.dirty)&&(this.gl.blendFunc(p[0],p[1]),this.current=p,this.dirty=!1)}}class cd extends Kd{getDefault(){return s.Color.transparent}set(p){const S=this.current;(p.r!==S.r||p.g!==S.g||p.b!==S.b||p.a!==S.a||this.dirty)&&(this.gl.blendColor(p.r,p.g,p.b,p.a),this.current=p,this.dirty=!1)}}class cp extends Kd{getDefault(){return this.gl.FUNC_ADD}set(p){(p!==this.current||this.dirty)&&(this.gl.blendEquation(p),this.current=p,this.dirty=!1)}}class xp extends Kd{getDefault(){return!1}set(p){if(p===this.current&&!this.dirty)return;const S=this.gl;p?S.enable(S.CULL_FACE):S.disable(S.CULL_FACE),this.current=p,this.dirty=!1}}class Ep extends Kd{getDefault(){return this.gl.BACK}set(p){(p!==this.current||this.dirty)&&(this.gl.cullFace(p),this.current=p,this.dirty=!1)}}class Vp extends Kd{getDefault(){return this.gl.CCW}set(p){(p!==this.current||this.dirty)&&(this.gl.frontFace(p),this.current=p,this.dirty=!1)}}let bd,Yd=class extends Kd{getDefault(){return null}set(L){(L!==this.current||this.dirty)&&(this.gl.useProgram(L),this.current=L,this.dirty=!1)}};class np extends Kd{getDefault(){return this.gl.TEXTURE0}set(p){(p!==this.current||this.dirty)&&(this.gl.activeTexture(p),this.current=p,this.dirty=!1)}}class Up extends Kd{getDefault(){const p=this.gl;return[0,0,p.drawingBufferWidth,p.drawingBufferHeight]}set(p){const S=this.current;(p[0]!==S[0]||p[1]!==S[1]||p[2]!==S[2]||p[3]!==S[3]||this.dirty)&&(this.gl.viewport(p[0],p[1],p[2],p[3]),this.current=p,this.dirty=!1)}}class Qp extends Kd{getDefault(){return null}set(p){if(p===this.current&&!this.dirty)return;const S=this.gl;S.bindFramebuffer(S.FRAMEBUFFER,p),this.current=p,this.dirty=!1}}class Rp extends Kd{getDefault(){return null}set(p){if(p===this.current&&!this.dirty)return;const S=this.gl;S.bindRenderbuffer(S.RENDERBUFFER,p),this.current=p,this.dirty=!1}}class ng extends Kd{getDefault(){return null}set(p){if(p===this.current&&!this.dirty)return;const S=this.gl;S.bindTexture(S.TEXTURE_2D,p),this.current=p,this.dirty=!1}}class bg extends Kd{getDefault(){return null}set(p){if(p===this.current&&!this.dirty)return;const S=this.gl;S.bindBuffer(S.ARRAY_BUFFER,p),this.current=p,this.dirty=!1}}class Ih extends Kd{getDefault(){return null}set(p){const S=this.gl;S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,p),this.current=p,this.dirty=!1}}class rh extends Kd{constructor(p){super(p),this.vao=p.extVertexArrayObject}getDefault(){return null}set(p){this.vao&&(p!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(p),this.current=p,this.dirty=!1)}}class sh extends Kd{getDefault(){return 4}set(p){if(p===this.current&&!this.dirty)return;const S=this.gl;S.pixelStorei(S.UNPACK_ALIGNMENT,p),this.current=p,this.dirty=!1}}class oh extends Kd{getDefault(){return!1}set(p){if(p===this.current&&!this.dirty)return;const S=this.gl;S.pixelStorei(S.UNPACK_PREMULTIPLY_ALPHA_WEBGL,p),this.current=p,this.dirty=!1}}class Dh extends Kd{getDefault(){return!1}set(p){if(p===this.current&&!this.dirty)return;const S=this.gl;S.pixelStorei(S.UNPACK_FLIP_Y_WEBGL,p),this.current=p,this.dirty=!1}}class $h extends Kd{constructor(p,S){super(p),this.context=p,this.parent=S}getDefault(){return null}}class yl extends $h{setDirty(){this.dirty=!0}set(p){if(p===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const S=this.gl;S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_2D,p,0),this.current=p,this.dirty=!1}}class gs extends $h{attachment(){return this.gl.DEPTH_ATTACHMENT}set(p){if(p===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const S=this.gl;S.framebufferRenderbuffer(S.FRAMEBUFFER,this.attachment(),S.RENDERBUFFER,p),this.current=p,this.dirty=!1}}class Cr extends gs{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class fs{constructor(p,S,X,ze){this.context=p,this.width=S,this.height=X;const kt=this.framebuffer=p.gl.createFramebuffer();this.colorAttachment=new yl(p,kt),ze&&(this.depthAttachment=new gs(p,kt))}destroy(){const p=this.context.gl,S=this.colorAttachment.get();if(S&&p.deleteTexture(S),this.depthAttachment){const X=this.depthAttachment.get();X&&p.deleteRenderbuffer(X)}p.deleteFramebuffer(this.framebuffer)}}class ul{constructor(p,S=!1){if(this.gl=p,this.isWebGL2=S,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),S){const X=p;this.extVertexArrayObject={createVertexArrayOES:X.createVertexArray.bind(p),deleteVertexArrayOES:X.deleteVertexArray.bind(p),bindVertexArrayOES:X.bindVertexArray.bind(p)}}this.clearColor=new Ap(this),this.clearDepth=new Ip(this),this.clearStencil=new Yh(this),this.colorMask=new Ad(this),this.depthMask=new kp(this),this.stencilMask=new up(this),this.stencilFunc=new rp(this),this.stencilOp=new fd(this),this.stencilTest=new Cp(this),this.depthRange=new Fp(this),this.depthTest=new _p(this),this.depthFunc=new kd(this),this.blend=new $f(this),this.blendFunc=new Uf(this),this.blendColor=new cd(this),this.blendEquation=new cp(this),this.cullFace=new xp(this),this.cullFaceSide=new Ep(this),this.frontFace=new Vp(this),this.program=new Yd(this),this.activeTexture=new np(this),this.viewport=new Up(this),this.bindFramebuffer=new Qp(this),this.bindRenderbuffer=new Rp(this),this.bindTexture=new ng(this),this.bindVertexBuffer=new bg(this),this.bindElementBuffer=new Ih(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new rh(this),this.pixelStoreUnpack=new sh(this),this.pixelStoreUnpackPremultiplyAlpha=new oh(this),this.pixelStoreUnpackFlipY=new Dh(this),this.extTextureFilterAnisotropic=p.getExtension("EXT_texture_filter_anisotropic")||p.getExtension("MOZ_EXT_texture_filter_anisotropic")||p.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=p.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=p.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=p.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=p.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),S||(this.extTextureHalfFloat=p.getExtension("OES_texture_half_float")),(S||this.extTextureHalfFloat&&p.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=p.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=S||p.getExtension("OES_standard_derivatives"),this.extTimerQuery=p.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=p.getParameter(p.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(p,S){return new Op(this,p,S)}createVertexBuffer(p,S,X){return new zp(this,p,S,X)}createRenderbuffer(p,S,X){const ze=this.gl,kt=ze.createRenderbuffer();return this.bindRenderbuffer.set(kt),ze.renderbufferStorage(ze.RENDERBUFFER,p,S,X),this.bindRenderbuffer.set(null),kt}createFramebuffer(p,S,X){return new fs(this,p,S,X)}clear({color:p,depth:S,stencil:X}){const ze=this.gl;let kt=0;p&&(kt|=ze.COLOR_BUFFER_BIT,this.clearColor.set(p),this.colorMask.set([!0,!0,!0,!0])),S!==void 0&&(kt|=ze.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(S),this.depthMask.set(!0)),X!==void 0&&(kt|=ze.STENCIL_BUFFER_BIT,this.clearStencil.set(X),this.stencilMask.set(255)),ze.clear(kt)}setCullFace(p){p.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(p.mode),this.frontFace.set(p.frontFace))}setDepthMode(p){p.func!==this.gl.ALWAYS||p.mask?(this.depthTest.set(!0),this.depthFunc.set(p.func),this.depthMask.set(p.mask),this.depthRange.set(p.range)):this.depthTest.set(!1)}setStencilMode(p){p.test.func!==this.gl.ALWAYS||p.mask?(this.stencilTest.set(!0),this.stencilMask.set(p.mask),this.stencilOp.set([p.fail,p.depthFail,p.pass]),this.stencilFunc.set({func:p.test.func,ref:p.ref,mask:p.test.mask})):this.stencilTest.set(!1)}setColorMode(p){m(p.blendFunction,s.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(p.blendFunction),this.blendColor.set(p.blendColor)),this.colorMask.set(p.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ih extends s.Evented{constructor(p,S,X,ze){if(super(),this.id=p,this.dispatcher=X,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(S,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},S),this._collectResourceTiming=S.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(ze),this._tileWorkers={},this._deduped=new s.DedupedRequest}load(p){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"}));const S=Array.isArray(this.map._language)?this.map._language.join():this.map._language,X=this.map._worldview;this._tileJSONRequest=op(this._options,this.map._requestManager,S,X,(ze,kt)=>{this._tileJSONRequest=null,this._loaded=!0,ze?(S&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${S}`),X&&X.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${X}`),this.fire(new s.ErrorEvent(ze))):kt&&(s.extend(this,kt),kt.bounds&&(this.tileBounds=new Wd(kt.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(kt.tiles,this.map._requestManager._customAccessToken),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),p&&p(ze)})}loaded(){return this._loaded}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}onAdd(p){this.map=p,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(p){return this._options.tiles=p,this.reload(),this}setUrl(p){return this.url=p,this._options.url=p,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}loadTile(p,S){const X=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),ze={request:this.map._requestManager.transformRequest(X,s.ResourceType.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:p.isSymbolTile};if(ze.request.collectResourceTiming=this._collectResourceTiming,p.actor&&p.state!=="expired")p.state==="loading"?p.reloadCallback=S:p.request=p.actor.send("reloadTile",ze,kt.bind(this));else if(p.actor=this._tileWorkers[X]=this._tileWorkers[X]||this.dispatcher.getActor(),this.dispatcher.ready)p.request=p.actor.send("loadTile",ze,kt.bind(this),void 0,!0);else{const vi=s.loadVectorTile.call({deduped:this._deduped},ze,(or,Gn)=>{or||!Gn?kt.call(this,or):(ze.data={cacheControl:Gn.cacheControl,expires:Gn.expires,rawData:Gn.rawData.slice(0)},p.actor&&p.actor.send("loadTile",ze,kt.bind(this),void 0,!0))},!0);p.request={cancel:vi}}function kt(vi,or){return delete p.request,p.aborted?S(null):vi&&vi.status!==404?S(vi):(or&&or.resourceTiming&&(p.resourceTiming=or.resourceTiming),this.map._refreshExpiredTiles&&or&&p.setExpiryData(or),p.loadVectorData(or,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),S(null),void(p.reloadCallback&&(this.loadTile(p,p.reloadCallback),p.reloadCallback=null)))}}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.actor&&p.actor.send("abortTile",{uid:p.uid,type:this.type,source:this.id})}unloadTile(p){p.unloadVectorData(),p.actor&&p.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ch extends s.Evented{constructor(p,S,X,ze){super(),this.id=p,this.dispatcher=X,this.setEventedParent(ze),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},S),s.extend(this,s.pick(S,["url","scheme","tileSize"]))}load(p){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=op(this._options,this.map._requestManager,null,null,(S,X)=>{this._tileJSONRequest=null,this._loaded=!0,S?this.fire(new s.ErrorEvent(S)):X&&(s.extend(this,X),X.bounds&&(this.tileBounds=new Wd(X.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(X.tiles),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),p&&p(S)})}loaded(){return this._loaded}onAdd(p){this.map=p,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(p){return this._options.tiles=p,this.reload(),this}setUrl(p){return this.url=p,this._options.url=p,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,S){const X=s.exported.devicePixelRatio>=2,ze=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),X,this.tileSize);p.request=s.getImage(this.map._requestManager.transformRequest(ze,s.ResourceType.Tile),(kt,vi,or,Gn)=>(delete p.request,p.aborted?(p.state="unloaded",S(null)):kt?(p.state="errored",S(kt)):vi?(this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:or,expires:Gn}),p.setTexture(vi,this.map.painter),p.state="loaded",s.cacheEntryPossiblyAdded(this.dispatcher),void S(null)):S(null)))}static loadTileData(p,S,X){p.setTexture(S,X)}static unloadTileData(p,S){p.texture&&S.saveTileTexture(p.texture)}abortTile(p,S){p.request&&(p.request.cancel(),delete p.request),S()}unloadTile(p,S){p.texture&&this.map.painter.saveTileTexture(p.texture),S()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function vh(L,p,S,X,ze,kt,vi,or){const Gn=[L,S,ze,p,X,kt,1,1,1],ia=[vi,or,1],oa=s.adjoint([],Gn),[pl,lh,gh]=s.transformMat3(ia,ia,s.transpose(oa,oa));return s.multiply$1(Gn,[pl,0,0,0,lh,0,0,0,gh],Gn)}class Th extends s.Evented{constructor(p,S,X,ze){super(),this.id=p,this.dispatcher=X,this.coordinates=S.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(ze),this.options=S,this._dirty=!1}load(p,S){this._loaded=S||!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),(X,ze)=>{if(this._imageRequest=null,this._loaded=!0,X)this.fire(new s.ErrorEvent(X));else if(ze){const{HTMLImageElement:kt}=s.window;this.image=ze instanceof kt?s.exported.getImageData(ze):ze,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,p&&(this.coordinates=p),this._finishLoading()}})}loaded(){return this._loaded}updateImage(p){return this.image&&p.url?(this._imageRequest&&p.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=p.url,this.load(p.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(p){this.map=p,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(p){this.coordinates=p,this._boundsArray=void 0;const S=p.map(s.MercatorCoordinate.fromLngLat);return this.tileID=function(X){let ze=1/0,kt=1/0,vi=-1/0,or=-1/0;for(const pl of X)ze=Math.min(ze,pl.x),kt=Math.min(kt,pl.y),vi=Math.max(vi,pl.x),or=Math.max(or,pl.y);const Gn=Math.max(vi-ze,or-kt),ia=Math.max(0,Math.floor(-Math.log(Gn)/Math.LN2)),oa=Math.pow(2,ia);return new s.CanonicalTileID(ia,Math.floor((ze+vi)/2*oa),Math.floor((kt+or)/2*oa))}(S),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(p){for(const Gn in this.tiles){const ia=this.tiles[Gn];ia.state!=="loaded"&&(ia.state="loaded",ia.texture=this.texture)}if(this._boundsArray)return;const S=s.tileTransform(this.tileID,this.map.transform.projection),[X,ze,kt,vi]=this.coordinates.map(Gn=>{const ia=S.projection.project(Gn[0],Gn[1]);return s.getTilePoint(S,ia)._round()});this.perspectiveTransform=function(Gn,ia,oa,pl,lh,gh,yh,_h,xh,_l){const mh=vh(0,0,Gn,0,0,ia,Gn,ia),wh=vh(oa,pl,lh,gh,yh,_h,xh,_l);return s.multiply$1(wh,s.adjoint(mh,mh),wh),[wh[6]/wh[8]*Gn/s.EXTENT,wh[7]/wh[8]*ia/s.EXTENT]}(this.width,this.height,X.x,X.y,ze.x,ze.y,vi.x,vi.y,kt.x,kt.y);const or=this._boundsArray=new s.StructArrayLayout4i8;or.emplaceBack(X.x,X.y,0,0),or.emplaceBack(ze.x,ze.y,s.EXTENT,0),or.emplaceBack(vi.x,vi.y,0,s.EXTENT),or.emplaceBack(kt.x,kt.y,s.EXTENT,s.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=p.createVertexBuffer(or,s.boundsAttributes.members),this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const p=this.map.painter.context,S=p.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new s.Texture(p,this.image,S.RGBA),this.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(p)}loadTile(p,S){this.tileID&&this.tileID.equals(p.tileID.canonical)?(this.tiles[String(p.tileID.wrap)]=p,p.buckets={},S(null)):(p.state="errored",S(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Nh={vector:ih,raster:ch,"raster-dem":class extends ch{constructor(L,p,S,X){super(L,p,S,X),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},p),this.encoding=p.encoding||"mapbox"}loadTile(L,p){const S=this.map._requestManager.normalizeTileURL(L.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function X(ze,kt){ze&&(L.state="errored",p(ze)),kt&&(L.dem=kt,L.dem.onDeserialize(),L.needsHillshadePrepare=!0,L.needsDEMTextureUpload=!0,L.state="loaded",p(null))}L.request=s.getImage(this.map._requestManager.transformRequest(S,s.ResourceType.Tile),(function(ze,kt,vi,or){if(delete L.request,L.aborted)L.state="unloaded",p(null);else if(ze)L.state="errored",p(ze);else if(kt){this.map._refreshExpiredTiles&&L.setExpiryData({cacheControl:vi,expires:or});const Gn=s.window.ImageBitmap&&kt instanceof s.window.ImageBitmap&&(bd==null&&(bd=s.window.OffscreenCanvas&&new s.window.OffscreenCanvas(1,1).getContext("2d")&&typeof s.window.createImageBitmap=="function"),bd),ia=1-(kt.width-s.prevPowerOfTwo(kt.width))/2;ia<1||L.neighboringTiles||(L.neighboringTiles=this._getNeighboringTiles(L.tileID));const oa=Gn?kt:s.exported.getImageData(kt,ia),pl={uid:L.uid,coord:L.tileID,source:this.id,rawImageData:oa,encoding:this.encoding,padding:ia};L.actor&&L.state!=="expired"||(L.actor=this.dispatcher.getActor(),L.actor.send("loadDEMTile",pl,X.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(L){const p=L.canonical,S=Math.pow(2,p.z),X=(p.x-1+S)%S,ze=p.x===0?L.wrap-1:L.wrap,kt=(p.x+1+S)%S,vi=p.x+1===S?L.wrap+1:L.wrap,or={};return or[new s.OverscaledTileID(L.overscaledZ,ze,p.z,X,p.y).key]={backfilled:!1},or[new s.OverscaledTileID(L.overscaledZ,vi,p.z,kt,p.y).key]={backfilled:!1},p.y>0&&(or[new s.OverscaledTileID(L.overscaledZ,ze,p.z,X,p.y-1).key]={backfilled:!1},or[new s.OverscaledTileID(L.overscaledZ,L.wrap,p.z,p.x,p.y-1).key]={backfilled:!1},or[new s.OverscaledTileID(L.overscaledZ,vi,p.z,kt,p.y-1).key]={backfilled:!1}),p.y+1<S&&(or[new s.OverscaledTileID(L.overscaledZ,ze,p.z,X,p.y+1).key]={backfilled:!1},or[new s.OverscaledTileID(L.overscaledZ,L.wrap,p.z,p.x,p.y+1).key]={backfilled:!1},or[new s.OverscaledTileID(L.overscaledZ,vi,p.z,kt,p.y+1).key]={backfilled:!1}),or}unloadTile(L){L.demTexture&&this.map.painter.saveTileTexture(L.demTexture),L.fbo&&(L.fbo.destroy(),delete L.fbo),L.dem&&delete L.dem,delete L.neighboringTiles,L.state="unloaded"}},geojson:class extends s.Evented{constructor(L,p,S,X){super(),this.id=L,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=S.getActor(),this.setEventedParent(X),this._data=p.data,this._options=s.extend({},p),this._collectResourceTiming=p.collectResourceTiming,p.maxzoom!==void 0&&(this.maxzoom=p.maxzoom),p.type&&(this.type=p.type),p.attribution&&(this.attribution=p.attribution),this.promoteId=p.promoteId;const ze=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:p.cluster||!1,geojsonVtOptions:{buffer:(p.buffer!==void 0?p.buffer:128)*ze,tolerance:(p.tolerance!==void 0?p.tolerance:.375)*ze,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:p.lineMetrics||!1,generateId:p.generateId||!1},superclusterOptions:{maxZoom:p.clusterMaxZoom!==void 0?p.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,p.clusterMinPoints||2),extent:s.EXTENT,radius:(p.clusterRadius!==void 0?p.clusterRadius:50)*ze,log:!1,generateId:p.generateId||!1},clusterProperties:p.clusterProperties,filter:p.filter},p.workerOptions)}onAdd(L){this.map=L,this.setData(this._data)}setData(L){return this._data=L,this._updateWorkerData(),this}getClusterExpansionZoom(L,p){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:L,source:this.id},p),this}getClusterChildren(L,p){return this.actor.send("geojson.getClusterChildren",{clusterId:L,source:this.id},p),this}getClusterLeaves(L,p,S,X){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:L,limit:p,offset:S},X),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.Event("dataloading",{dataType:"source"})),this._loaded=!1;const L=s.extend({},this.workerOptions),p=this._data;typeof p=="string"?(L.request=this.map._requestManager.transformRequest(s.exported.resolveURL(p),s.ResourceType.Source),L.request.collectResourceTiming=this._collectResourceTiming):L.data=JSON.stringify(p),this._pendingLoad=this.actor.send(`${this.type}.loadData`,L,(S,X)=>{if(this._loaded=!0,this._pendingLoad=null,S)this.fire(new s.ErrorEvent(S));else{const ze={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&X&&X.resourceTiming&&X.resourceTiming[this.id]&&(ze.resourceTiming=X.resourceTiming[this.id]),this.fire(new s.Event("data",ze)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(L,p){const S=L.actor?"reloadTile":"loadTile";L.actor=this.actor,L.request=this.actor.send(S,{type:this.type,uid:L.uid,tileID:L.tileID,tileZoom:L.tileZoom,zoom:L.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(X,ze)=>(delete L.request,L.unloadVectorData(),L.aborted?p(null):X?p(X):(L.loadVectorData(ze,this.map.painter,S==="reloadTile"),p(null))),void 0,S==="loadTile")}abortTile(L){L.request&&(L.request.cancel(),delete L.request),L.aborted=!0}unloadTile(L){L.unloadVectorData(),this.actor.send("removeTile",{uid:L.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Th{constructor(L,p,S,X){super(L,p,S,X),this.roundZoom=!0,this.type="video",this.options=p}load(){this._loaded=!1;const L=this.options;this.urls=[];for(const p of L.urls)this.urls.push(this.map._requestManager.transformRequest(p,s.ResourceType.Source).url);s.getVideo(this.urls,(p,S)=>{this._loaded=!0,p?this.fire(new s.ErrorEvent(p)):S&&(this.video=S,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(L){if(this.video){const p=this.video.seekable;L<p.start(0)||L>p.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${p.start(0)} and ${p.end(0)}-second mark.`))):this.video.currentTime=L}}getVideo(){return this.video}onAdd(L){this.map||(this.map=L,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const L=this.map.painter.context,p=L.gl;this.texture?this.video.paused||(this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE),p.texSubImage2D(p.TEXTURE_2D,0,0,0,p.RGBA,p.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(L,this.video,p.RGBA),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(L)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Th,canvas:class extends Th{constructor(L,p,S,X){super(L,p,S,X),p.coordinates?Array.isArray(p.coordinates)&&p.coordinates.length===4&&!p.coordinates.some(ze=>!Array.isArray(ze)||ze.length!==2||ze.some(kt=>typeof kt!="number"))||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${L}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${L}`,null,'missing required property "coordinates"'))),p.animate&&typeof p.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${L}`,null,'optional "animate" property must be a boolean value'))),p.canvas?typeof p.canvas=="string"||p.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${L}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${L}`,null,'missing required property "canvas"'))),this.options=p,this.animate=p.animate===void 0||p.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(L){this.map=L,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let L=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,L=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,L=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const p=this.map.painter.context;this.texture?(L||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(p,this.canvas,p.gl.RGBA,{premultiply:!0}),this._prepareData(p)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const L of[this.canvas.width,this.canvas.height])if(isNaN(L)||L<=0)return!0;return!1}},custom:class extends s.Evented{constructor(L,p,S,X){super(),this.id=L,this.type="custom",this._dataType="raster",this._dispatcher=S,this._implementation=p,this.setEventedParent(X),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Wd(this._implementation.bounds,this.minzoom,this.maxzoom)),p.update=this._update.bind(this),p.clearTiles=this._clearTiles.bind(this),p.coveringTiles=this._coveringTiles.bind(this),s.extend(this,s.pick(p,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(L){this._map=L,this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(L),this.load()}onRemove(L){this._implementation.onRemove&&this._implementation.onRemove(L)}hasTile(L){if(this._implementation.hasTile){const{x:p,y:S,z:X}=L.canonical;return this._implementation.hasTile({x:p,y:S,z:X})}return!this.tileBounds||this.tileBounds.contains(L.canonical)}loadTile(L,p){const{x:S,y:X,z:ze}=L.tileID.canonical,kt=new s.window.AbortController;L.request=Promise.resolve(this._implementation.loadTile({x:S,y:X,z:ze},{signal:kt.signal})).then((function(vi){return delete L.request,L.aborted?(L.state="unloaded",p(null)):vi===void 0?(L.state="errored",p(null)):vi===null?(this.loadTileData(L,{width:this.tileSize,height:this.tileSize,data:null}),L.state="loaded",p(null)):function(or){return or instanceof s.window.ImageData||or instanceof s.window.HTMLCanvasElement||or instanceof s.window.ImageBitmap||or instanceof s.window.HTMLImageElement}(vi)?(this.loadTileData(L,vi),L.state="loaded",void p(null)):(L.state="errored",p(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(vi=>{vi.code!==20&&(L.state="errored",p(vi))}),L.request.cancel=()=>kt.abort()}loadTileData(L,p){ch.loadTileData(L,p,this._map.painter)}unloadTileData(L){ch.unloadTileData(L,this._map.painter)}unloadTile(L,p){if(this.unloadTileData(L),this._implementation.unloadTile){const{x:S,y:X,z:ze}=L.tileID.canonical;this._implementation.unloadTile({x:S,y:X,z:ze})}p()}abortTile(L,p){L.request&&L.request.cancel&&(L.request.cancel(),delete L.request),p()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(L=>({x:L.canonical.x,y:L.canonical.y,z:L.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Qh=function(L,p,S,X){const ze=new Nh[p.type](L,p,S,X);if(ze.id!==L)throw new Error(`Expected Source id to be ${L} instead of ${ze.id}`);return s.bindAll(["load","abort","unload","serialize","prepare"],ze),ze};function rd(L,p){const S=s.identity([]);return s.scale(S,S,[.5*L.width,.5*-L.height,1]),s.translate(S,S,[1,-1,0]),s.multiply(S,S,L.calculateProjMatrix(p.toUnwrapped())),Float32Array.from(S)}function _d(L,p,S,X,ze,kt,vi,or=!1){const Gn=L.tilesIn(X,vi,or);Gn.sort(Dp);const ia=[];for(const pl of Gn)ia.push({wrappedTileID:pl.tile.tileID.wrapped().key,queryResults:pl.tile.queryRenderedFeatures(p,S,L._state,pl,ze,kt,rd(L.transform,pl.tile.tileID),or)});const oa=function(pl){const lh={},gh={};for(const yh of pl){const _h=yh.queryResults,xh=yh.wrappedTileID,_l=gh[xh]=gh[xh]||{};for(const mh in _h){const wh=_h[mh],Sh=_l[mh]=_l[mh]||{},Oh=lh[mh]=lh[mh]||[];for(const Uh of wh)Sh[Uh.featureIndex]||(Sh[Uh.featureIndex]=!0,Oh.push(Uh))}}return lh}(ia);for(const pl in oa)oa[pl].forEach(lh=>{const gh=lh.feature,yh=gh.layer;yh&&yh.type!=="background"&&yh.type!=="sky"&&(gh.source=yh.source,yh["source-layer"]&&(gh.sourceLayer=yh["source-layer"]),gh.state=gh.id!==void 0?L.getFeatureState(yh["source-layer"],gh.id):{})});return oa}function ip(L,p){const S=L.getRenderableIds().map(kt=>L.getTileByID(kt)),X=[],ze={};for(let kt=0;kt<S.length;kt++){const vi=S[kt],or=vi.tileID.canonical.key;ze[or]||(ze[or]=!0,vi.querySourceFeatures(X,p))}return X}function Dp(L,p){const S=L.tileID,X=p.tileID;return S.overscaledZ-X.overscaledZ||S.canonical.y-X.canonical.y||S.wrap-X.wrap||S.canonical.x-X.canonical.x}function qd(){return gp.workerClass!=null?new gp.workerClass:new s.window.Worker(gp.workerUrl)}const wp="mapboxgl_preloaded_worker_pool";class pp{constructor(){this.active={}}acquire(p){if(!this.workers)for(this.workers=[];this.workers.length<pp.workerCount;)this.workers.push(new qd);return this.active[p]=!0,this.workers.slice()}release(p){delete this.active[p],this.numActive()===0&&(this.workers.forEach(S=>{S.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[wp]}numActive(){return Object.keys(this.active).length}}let Wp;function Vf(){return Wp||(Wp=new pp),Wp}function Wf(L,p){const S={};for(const X in L)X!=="ref"&&(S[X]=L[X]);return s.refProperties.forEach(X=>{X in p&&(S[X]=p[X])}),S}function dg(L){L=L.slice();const p=Object.create(null);for(let S=0;S<L.length;S++)p[L[S].id]=L[S];for(let S=0;S<L.length;S++)"ref"in L[S]&&(L[S]=Wf(L[S],p[L[S].ref]));return L}pp.workerCount=2;const Jp={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Yp(L,p,S){S.push({command:Jp.addSource,args:[L,p[L]]})}function Cg(L,p,S){p.push({command:Jp.removeSource,args:[L]}),S[L]=!0}function o_(L,p,S,X){Cg(L,S,X),Yp(L,p,S)}function Bg(L,p,S){let X;for(X in L[S])if(L[S].hasOwnProperty(X)&&X!=="data"&&!m(L[S][X],p[S][X]))return!1;for(X in p[S])if(p[S].hasOwnProperty(X)&&X!=="data"&&!m(L[S][X],p[S][X]))return!1;return!0}function Xg(L,p,S,X,ze,kt){let vi;for(vi in p=p||{},L=L||{})L.hasOwnProperty(vi)&&(m(L[vi],p[vi])||S.push({command:kt,args:[X,vi,p[vi],ze]}));for(vi in p)p.hasOwnProperty(vi)&&!L.hasOwnProperty(vi)&&(m(L[vi],p[vi])||S.push({command:kt,args:[X,vi,p[vi],ze]}))}function nm(L){return L.id}function ly(L,p){return L[p.id]=p,L}class xv{constructor(p,S){this.reset(p,S)}reset(p,S){this.points=p||[],this._distances=[0];for(let X=1;X<this.points.length;X++)this._distances[X]=this._distances[X-1]+this.points[X].dist(this.points[X-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(S||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(p){if(this.points.length===1)return this.points[0];p=s.clamp(p,0,1);let S=1,X=this._distances[S];const ze=p*this.paddedLength+this.padding;for(;X<ze&&S<this._distances.length;)X=this._distances[++S];const kt=S-1,vi=this._distances[kt],or=X-vi,Gn=or>0?(ze-vi)/or:0;return this.points[kt].mult(1-Gn).add(this.points[S].mult(Gn))}}class Dg{constructor(p,S,X){const ze=this.boxCells=[],kt=this.circleCells=[];this.xCellCount=Math.ceil(p/X),this.yCellCount=Math.ceil(S/X);for(let vi=0;vi<this.xCellCount*this.yCellCount;vi++)ze.push([]),kt.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=p,this.height=S,this.xScale=this.xCellCount/p,this.yScale=this.yCellCount/S,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(p,S,X,ze,kt){this._forEachCell(S,X,ze,kt,this._insertBoxCell,this.boxUid++),this.boxKeys.push(p),this.bboxes.push(S),this.bboxes.push(X),this.bboxes.push(ze),this.bboxes.push(kt)}insertCircle(p,S,X,ze){this._forEachCell(S-ze,X-ze,S+ze,X+ze,this._insertCircleCell,this.circleUid++),this.circleKeys.push(p),this.circles.push(S),this.circles.push(X),this.circles.push(ze)}_insertBoxCell(p,S,X,ze,kt,vi){this.boxCells[kt].push(vi)}_insertCircleCell(p,S,X,ze,kt,vi){this.circleCells[kt].push(vi)}_query(p,S,X,ze,kt,vi){if(X<0||p>this.width||ze<0||S>this.height)return!kt&&[];const or=[];if(p<=0&&S<=0&&this.width<=X&&this.height<=ze){if(kt)return!0;for(let Gn=0;Gn<this.boxKeys.length;Gn++)or.push({key:this.boxKeys[Gn],x1:this.bboxes[4*Gn],y1:this.bboxes[4*Gn+1],x2:this.bboxes[4*Gn+2],y2:this.bboxes[4*Gn+3]});for(let Gn=0;Gn<this.circleKeys.length;Gn++){const ia=this.circles[3*Gn],oa=this.circles[3*Gn+1],pl=this.circles[3*Gn+2];or.push({key:this.circleKeys[Gn],x1:ia-pl,y1:oa-pl,x2:ia+pl,y2:oa+pl})}return vi?or.filter(vi):or}return this._forEachCell(p,S,X,ze,this._queryCell,or,{hitTest:kt,seenUids:{box:{},circle:{}}},vi),kt?or.length>0:or}_queryCircle(p,S,X,ze,kt){const vi=p-X,or=p+X,Gn=S-X,ia=S+X;if(or<0||vi>this.width||ia<0||Gn>this.height)return!ze&&[];const oa=[];return this._forEachCell(vi,Gn,or,ia,this._queryCellCircle,oa,{hitTest:ze,circle:{x:p,y:S,radius:X},seenUids:{box:{},circle:{}}},kt),ze?oa.length>0:oa}query(p,S,X,ze,kt){return this._query(p,S,X,ze,!1,kt)}hitTest(p,S,X,ze,kt){return this._query(p,S,X,ze,!0,kt)}hitTestCircle(p,S,X,ze){return this._queryCircle(p,S,X,!0,ze)}_queryCell(p,S,X,ze,kt,vi,or,Gn){const ia=or.seenUids,oa=this.boxCells[kt];if(oa!==null){const lh=this.bboxes;for(const gh of oa)if(!ia.box[gh]){ia.box[gh]=!0;const yh=4*gh;if(p<=lh[yh+2]&&S<=lh[yh+3]&&X>=lh[yh+0]&&ze>=lh[yh+1]&&(!Gn||Gn(this.boxKeys[gh]))){if(or.hitTest)return vi.push(!0),!0;vi.push({key:this.boxKeys[gh],x1:lh[yh],y1:lh[yh+1],x2:lh[yh+2],y2:lh[yh+3]})}}}const pl=this.circleCells[kt];if(pl!==null){const lh=this.circles;for(const gh of pl)if(!ia.circle[gh]){ia.circle[gh]=!0;const yh=3*gh;if(this._circleAndRectCollide(lh[yh],lh[yh+1],lh[yh+2],p,S,X,ze)&&(!Gn||Gn(this.circleKeys[gh]))){if(or.hitTest)return vi.push(!0),!0;{const _h=lh[yh],xh=lh[yh+1],_l=lh[yh+2];vi.push({key:this.circleKeys[gh],x1:_h-_l,y1:xh-_l,x2:_h+_l,y2:xh+_l})}}}}}_queryCellCircle(p,S,X,ze,kt,vi,or,Gn){const ia=or.circle,oa=or.seenUids,pl=this.boxCells[kt];if(pl!==null){const gh=this.bboxes;for(const yh of pl)if(!oa.box[yh]){oa.box[yh]=!0;const _h=4*yh;if(this._circleAndRectCollide(ia.x,ia.y,ia.radius,gh[_h+0],gh[_h+1],gh[_h+2],gh[_h+3])&&(!Gn||Gn(this.boxKeys[yh])))return vi.push(!0),!0}}const lh=this.circleCells[kt];if(lh!==null){const gh=this.circles;for(const yh of lh)if(!oa.circle[yh]){oa.circle[yh]=!0;const _h=3*yh;if(this._circlesCollide(gh[_h],gh[_h+1],gh[_h+2],ia.x,ia.y,ia.radius)&&(!Gn||Gn(this.circleKeys[yh])))return vi.push(!0),!0}}}_forEachCell(p,S,X,ze,kt,vi,or,Gn){const ia=this._convertToXCellCoord(p),oa=this._convertToYCellCoord(S),pl=this._convertToXCellCoord(X),lh=this._convertToYCellCoord(ze);for(let gh=ia;gh<=pl;gh++)for(let yh=oa;yh<=lh;yh++)if(kt.call(this,p,S,X,ze,this.xCellCount*yh+gh,vi,or,Gn))return}_convertToXCellCoord(p){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(p*this.xScale)))}_convertToYCellCoord(p){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(p*this.yScale)))}_circlesCollide(p,S,X,ze,kt,vi){const or=ze-p,Gn=kt-S,ia=X+vi;return ia*ia>or*or+Gn*Gn}_circleAndRectCollide(p,S,X,ze,kt,vi,or){const Gn=(vi-ze)/2,ia=Math.abs(p-(ze+Gn));if(ia>Gn+X)return!1;const oa=(or-kt)/2,pl=Math.abs(S-(kt+oa));if(pl>oa+X)return!1;if(ia<=Gn||pl<=oa)return!0;const lh=ia-Gn,gh=pl-oa;return lh*lh+gh*gh<=X*X}}const s_={unknown:0,flipRequired:1,flipNotRequired:2},f_=Math.tan(85*Math.PI/180);function hd(L,p,S,X,ze,kt,vi){const or=s.create();if(S)if(kt.name==="globe"){const Gn=s.calculateGlobeLabelMatrix(ze,p);s.multiply(or,or,Gn)}else{const Gn=ll([],vi);or[0]=Gn[0],or[1]=Gn[1],or[4]=Gn[2],or[5]=Gn[3],X||s.rotateZ(or,or,ze.angle)}else s.multiply(or,ze.labelPlaneMatrix,L);return or}function g_(L,p,S,X,ze,kt,vi){const or=hd(L,p,S,X,ze,kt,vi);return kt.name==="globe"&&S||(or[2]=or[6]=or[10]=or[14]=0),or}function xg(L,p,S,X,ze,kt,vi){if(S){if(kt.name==="globe"){const or=hd(L,p,S,X,ze,kt,vi);return s.invert(or,or),s.multiply(or,L,or),or}{const or=s.clone(L),Gn=s.identity([]);return Gn[0]=vi[0],Gn[1]=vi[1],Gn[4]=vi[2],Gn[5]=vi[3],s.multiply(or,or,Gn),X||s.rotateZ(or,or,-ze.angle),or}}return ze.glCoordMatrix}function hm(L,p,S,X){const ze=[L,p,S,1];S?s.transformMat4$1(ze,ze,X):Kf(ze,ze,X);const kt=ze[3];return ze[0]/=kt,ze[1]/=kt,ze[2]/=kt,ze}function xm(L,p){return Math.min(.5+L/p*.5,1.5)}function m_(L,p){const S=L[0]/L[3],X=L[1]/L[3];return S>=-p[0]&&S<=p[0]&&X>=-p[1]&&X<=p[1]}function wv(L,p,S,X,ze,kt,vi,or,Gn,ia){const oa=S.transform,pl=X?L.textSizeData:L.iconSizeData,lh=s.evaluateSizeForZoom(pl,S.transform.zoom),gh=oa.projection.name==="globe",yh=[256/S.width*2+1,256/S.height*2+1],_h=X?L.text.dynamicLayoutVertexArray:L.icon.dynamicLayoutVertexArray;_h.clear();let xh=null;gh&&(xh=X?L.text.globeExtVertexArray:L.icon.globeExtVertexArray);const _l=L.lineVertexArray,mh=X?L.text.placedSymbolArray:L.icon.placedSymbolArray,wh=S.transform.width/S.transform.height;let Sh,Oh=!1;for(let Uh=0;Uh<mh.length;Uh++){const Vh=mh.get(Uh),{numGlyphs:Wh,writingMode:Zh}=Vh;if(Zh!==s.WritingMode.vertical||Oh||Sh===s.WritingMode.horizontal||(Oh=!0),Sh=Zh,(Vh.hidden||Zh===s.WritingMode.vertical)&&!Oh){__(Wh,_h);continue}Oh=!1;const id=new s.Point(Vh.tileAnchorX,Vh.tileAnchorY);let{x:Bd,y:ed,z:Sd}=oa.projection.projectTilePoint(id.x,id.y,ia.canonical);if(Gn){const[Hf,Mp,Zp]=Gn(id);Bd+=Hf,ed+=Mp,Sd+=Zp}const dd=[Bd,ed,Sd,1];if(s.transformMat4$1(dd,dd,p),!m_(dd,yh)){__(Wh,_h);continue}const xd=xm(S.transform.cameraToCenterDistance,dd[3]),nd=s.evaluateSizeForFeature(pl,lh,Vh),vd=vi?nd/xd:nd*xd,Od=hm(Bd,ed,Sd,ze);if(Od[3]<=0){__(Wh,_h);continue}let Id={};const $d=vi?null:Gn,Gp=ap(Vh,vd,!1,or,p,ze,kt,L.glyphOffsetArray,_l,_h,xh,Od,id,Id,wh,$d,oa.projection,ia,vi);Oh=Gp.useVertical,$d&&Gp.needsFlipping&&(Id={}),(Gp.notEnoughRoom||Oh||Gp.needsFlipping&&ap(Vh,vd,!0,or,p,ze,kt,L.glyphOffsetArray,_l,_h,xh,Od,id,Id,wh,$d,oa.projection,ia,vi).notEnoughRoom)&&__(Wh,_h)}X?(L.text.dynamicLayoutVertexBuffer.updateData(_h),xh&&L.text.globeExtVertexBuffer.updateData(xh)):(L.icon.dynamicLayoutVertexBuffer.updateData(_h),xh&&L.icon.globeExtVertexBuffer.updateData(xh))}function W_(L,p,S,X,ze,kt,vi,or,Gn,ia,oa,pl,lh,gh,yh,_h){const{lineStartIndex:xh,glyphStartIndex:_l,segment:mh}=or,wh=_l+or.numGlyphs,Sh=xh+or.lineLength,Oh=p.getoffsetX(_l),Uh=p.getoffsetX(wh-1),Vh=Wm(L*Oh,S,X,ze,kt,vi,mh,xh,Sh,Gn,ia,oa,pl,lh,!0,gh,yh,_h);if(!Vh)return null;const Wh=Wm(L*Uh,S,X,ze,kt,vi,mh,xh,Sh,Gn,ia,oa,pl,lh,!0,gh,yh,_h);return Wh?{first:Vh,last:Wh}:null}function lg(L,p,S,X){return L===s.WritingMode.horizontal&&Math.abs(X)>Math.abs(S)?{useVertical:!0}:L===s.WritingMode.vertical?X>0?{needsFlipping:!0}:null:p!==s_.unknown&&function(ze,kt){return ze===0||Math.abs(kt/ze)>f_}(S,X)?p===s_.flipRequired?{needsFlipping:!0}:null:S<0?{needsFlipping:!0}:null}function ap(L,p,S,X,ze,kt,vi,or,Gn,ia,oa,pl,lh,gh,yh,_h,xh,_l,mh){const wh=p/24,Sh=L.lineOffsetX*wh,Oh=L.lineOffsetY*wh,{lineStartIndex:Uh,glyphStartIndex:Vh,numGlyphs:Wh,segment:Zh,writingMode:id,flipState:Bd}=L,ed=Uh+L.lineLength,Sd=dd=>{if(oa){const[Od,Id,$d]=dd.up,Gp=ia.length;s.updateGlobeVertexNormal(oa,Gp+0,Od,Id,$d),s.updateGlobeVertexNormal(oa,Gp+1,Od,Id,$d),s.updateGlobeVertexNormal(oa,Gp+2,Od,Id,$d),s.updateGlobeVertexNormal(oa,Gp+3,Od,Id,$d)}const[xd,nd,vd]=dd.point;s.addDynamicAttributes(ia,xd,nd,vd,dd.angle)};if(Wh>1){const dd=W_(wh,or,Sh,Oh,S,pl,lh,L,Gn,kt,gh,_h,!1,xh,_l,mh);if(!dd)return{notEnoughRoom:!0};if(X&&!S){let[xd,nd,vd]=dd.first.point,[Od,Id,$d]=dd.last.point;[xd,nd]=hm(xd,nd,vd,vi),[Od,Id]=hm(Od,Id,$d,vi);const Gp=lg(id,Bd,(Od-xd)*yh,Id-nd);if(L.flipState=Gp&&Gp.needsFlipping?s_.flipRequired:s_.flipNotRequired,Gp)return Gp}Sd(dd.first);for(let xd=Vh+1;xd<Vh+Wh-1;xd++){const nd=Wm(wh*or.getoffsetX(xd),Sh,Oh,S,pl,lh,Zh,Uh,ed,Gn,kt,gh,_h,!1,!1,xh,_l,mh);if(!nd)return ia.length-=4*(xd-Vh),{notEnoughRoom:!0};Sd(nd)}Sd(dd.last)}else{if(X&&!S){const xd=hm(lh.x,lh.y,0,ze),nd=Uh+Zh+1,vd=new s.Point(Gn.getx(nd),Gn.gety(nd)),Od=hm(vd.x,vd.y,0,ze),Id=Od[3]>0?Od:jf(lh,vd,xd,1,ze,void 0,xh,_l.canonical),$d=lg(id,Bd,(Id[0]-xd[0])*yh,Id[1]-xd[1]);if(L.flipState=$d&&$d.needsFlipping?s_.flipRequired:s_.flipNotRequired,$d)return $d}const dd=Wm(wh*or.getoffsetX(Vh),Sh,Oh,S,pl,lh,Zh,Uh,ed,Gn,kt,gh,_h,!1,!1,xh,_l,mh);if(!dd)return{notEnoughRoom:!0};Sd(dd)}return{}}function qf(L,p,S,X,ze){const{x:kt,y:vi,z:or}=X.projectTilePoint(L.x,L.y,p);if(!ze)return hm(kt,vi,or,S);const[Gn,ia,oa]=ze(L);return hm(kt+Gn,vi+ia,or+oa,S)}function jf(L,p,S,X,ze,kt,vi,or){const Gn=qf(L.sub(p)._unit()._add(L),or,ze,vi,kt);return s.sub(Gn,S,Gn),s.normalize(Gn,Gn),s.scaleAndAdd(Gn,S,Gn,X)}function Wm(L,p,S,X,ze,kt,vi,or,Gn,ia,oa,pl,lh,gh,yh,_h,xh,_l){const mh=X?L-p:L+p;let wh=mh>0?1:-1,Sh=0;X&&(wh*=-1,Sh=Math.PI),wh<0&&(Sh+=Math.PI);let Oh=or+vi+(wh>0?0:1)|0,Uh=ze,Vh=ze,Wh=0,Zh=0;const id=Math.abs(mh),Bd=[],ed=[];let Sd=kt,dd=Sd;const xd=()=>jf(dd,Sd,Vh,id-Wh+1,oa,lh,_h,xh.canonical);for(;Wh+Zh<=id;){if(Oh+=wh,Oh<or||Oh>=Gn)return null;if(Vh=Uh,dd=Sd,Bd.push(Vh),gh&&ed.push(dd),Sd=new s.Point(ia.getx(Oh),ia.gety(Oh)),Uh=pl[Oh],!Uh){const Zp=qf(Sd,xh.canonical,oa,_h,lh);Uh=Zp[3]>0?pl[Oh]=Zp:xd()}Wh+=Zh,Zh=s.distance(Vh,Uh)}yh&&lh&&(pl[Oh]&&(Uh=xd(),Zh=s.distance(Vh,Uh)),pl[Oh]=Uh);const nd=(id-Wh)/Zh,vd=Sd.sub(dd)._mult(nd)._add(dd),Od=s.sub([],Uh,Vh),Id=s.scaleAndAdd([],Vh,Od,nd);let $d=[0,0,1],Gp=Od[0],Hf=Od[1];if(_l&&($d=_h.upVector(xh.canonical,vd.x,vd.y),$d[0]!==0||$d[1]!==0||$d[2]!==1)){const Zp=[$d[2],0,-$d[0]],rg=s.cross([],$d,Zp);s.normalize(Zp,Zp),s.normalize(rg,rg),Gp=s.dot(Od,Zp),Hf=s.dot(Od,rg)}if(S){const Zp=s.cross([],$d,Od);s.normalize(Zp,Zp),s.scaleAndAdd(Id,Id,Zp,S*wh)}const Mp=Sh+Math.atan2(Hf,Gp);return Bd.push(Id),gh&&ed.push(vd),{point:Id,angle:Mp,path:Bd,tilePath:ed,up:$d}}function __(L,p){const S=p.length,X=S+4*L;p.resize(X),p.float32.fill(-1/0,4*S,4*X)}function Kf(L,p,S){const X=p[0],ze=p[1];return L[0]=S[0]*X+S[4]*ze+S[12],L[1]=S[1]*X+S[5]*ze+S[13],L[3]=S[3]*X+S[7]*ze+S[15],L}const qm=100;class Ny{constructor(p,S,X=new Dg(p.width+200,p.height+200,25),ze=new Dg(p.width+200,p.height+200,25)){this.transform=p,this.grid=X,this.ignoredGrid=ze,this.pitchfactor=Math.cos(p._pitch)*p.cameraToCenterDistance,this.screenRightBoundary=p.width+qm,this.screenBottomBoundary=p.height+qm,this.gridRightBoundary=p.width+200,this.gridBottomBoundary=p.height+200,this.fogState=S}placeCollisionBox(p,S,X,ze,kt,vi,or,Gn){let ia=X.projectedAnchorX,oa=X.projectedAnchorY,pl=X.projectedAnchorZ;const lh=X.elevation,gh=X.tileID,yh=p.getProjection();if(lh&&gh){const[Uh,Vh,Wh]=yh.upVector(gh.canonical,X.tileAnchorX,X.tileAnchorY),Zh=yh.upVectorScale(gh.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;ia+=Uh*lh*Zh,oa+=Vh*lh*Zh,pl+=Wh*lh*Zh}const _h=this.projectAndGetPerspectiveRatio(or,ia,oa,pl,X.tileID,yh.name==="globe"||!!lh||this.transform.pitch>0,yh),xh=vi*_h.perspectiveRatio,_l=(X.x1*S+ze.x-X.padding)*xh+_h.point.x,mh=(X.y1*S+ze.y-X.padding)*xh+_h.point.y,wh=(X.x2*S+ze.x+X.padding)*xh+_h.point.x,Sh=(X.y2*S+ze.y+X.padding)*xh+_h.point.y,Oh=_h.perspectiveRatio<=.55||_h.occluded;return!this.isInsideGrid(_l,mh,wh,Sh)||!kt&&this.grid.hitTest(_l,mh,wh,Sh,Gn)||Oh?{box:[],offscreen:!1,occluded:_h.occluded}:{box:[_l,mh,wh,Sh],offscreen:this.isOffscreen(_l,mh,wh,Sh),occluded:!1}}placeCollisionCircles(p,S,X,ze,kt,vi,or,Gn,ia,oa,pl,lh,gh,yh,_h){const xh=[],_l=this.transform.elevation,mh=p.getProjection(),wh=_l?_l.getAtTileOffsetFunc(_h,this.transform.center.lat,this.transform.worldSize,mh):null,Sh=new s.Point(X.tileAnchorX,X.tileAnchorY);let{x:Oh,y:Uh,z:Vh}=mh.projectTilePoint(Sh.x,Sh.y,_h.canonical);if(wh){const[vd,Od,Id]=wh(Sh);Oh+=vd,Uh+=Od,Vh+=Id}const Wh=mh.name==="globe",Zh=this.projectAndGetPerspectiveRatio(or,Oh,Uh,Vh,_h,Wh||!!_l||this.transform.pitch>0,mh),{perspectiveRatio:id}=Zh,Bd=(pl?vi/id:vi*id)/s.ONE_EM,ed=hm(Oh,Uh,Vh,Gn),Sd=Zh.signedDistanceFromCamera>0?W_(Bd,kt,X.lineOffsetX*Bd,X.lineOffsetY*Bd,!1,ed,Sh,X,ze,Gn,{},_l&&!pl?wh:null,pl&&!!_l,mh,_h,pl):null;let dd=!1,xd=!1,nd=!0;if(Sd&&!Zh.occluded){const vd=.5*gh*id+yh,Od=new s.Point(-100,-100),Id=new s.Point(this.screenRightBoundary,this.screenBottomBoundary),$d=new xv,{first:Gp,last:Hf}=Sd,Mp=Gp.path.length;let Zp=[];for(let Bp=Mp-1;Bp>=1;Bp--)Zp.push(Gp.path[Bp]);for(let Bp=1;Bp<Hf.path.length;Bp++)Zp.push(Hf.path[Bp]);const rg=2.5*vd;ia&&(Zp=Zp.map(([Bp,fg,Sg],Tg)=>(wh&&!Wh&&(Sg=wh(Tg<Mp-1?Gp.tilePath[Mp-1-Tg]:Hf.tilePath[Tg-Mp+2])[2]),hm(Bp,fg,Sg,ia))),Zp.some(Bp=>Bp[3]<=0)&&(Zp=[]));let Jf=[];if(Zp.length>0){let Bp=1/0,fg=-1/0,Sg=1/0,Tg=-1/0;for(const gg of Zp)Bp=Math.min(Bp,gg[0]),Sg=Math.min(Sg,gg[1]),fg=Math.max(fg,gg[0]),Tg=Math.max(Tg,gg[1]);fg>=Od.x&&Bp<=Id.x&&Tg>=Od.y&&Sg<=Id.y&&(Jf=[Zp.map(gg=>new s.Point(gg[0],gg[1]))],(Bp<Od.x||fg>Id.x||Sg<Od.y||Tg>Id.y)&&(Jf=s.clipLine(Jf,Od.x,Od.y,Id.x,Id.y)))}for(const Bp of Jf){$d.reset(Bp,.25*vd);let fg=0;fg=$d.length<=.5*vd?1:Math.ceil($d.paddedLength/rg)+1;for(let Sg=0;Sg<fg;Sg++){const Tg=Sg/Math.max(fg-1,1),gg=$d.lerp(Tg),Jm=gg.x+qm,om=gg.y+qm;xh.push(Jm,om,vd,0);const c_=Jm-vd,I_=om-vd,Ug=Jm+vd,Ag=om+vd;if(nd=nd&&this.isOffscreen(c_,I_,Ug,Ag),xd=xd||this.isInsideGrid(c_,I_,Ug,Ag),!S&&this.grid.hitTestCircle(Jm,om,vd,lh)&&(dd=!0,!oa))return{circles:[],offscreen:!1,collisionDetected:dd,occluded:!1}}}}return{circles:!oa&&dd||!xd?[]:xh,offscreen:nd,collisionDetected:dd,occluded:Zh.occluded}}queryRenderedSymbols(p){if(p.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const S=[];let X=1/0,ze=1/0,kt=-1/0,vi=-1/0;for(const oa of p){const pl=new s.Point(oa.x+qm,oa.y+qm);X=Math.min(X,pl.x),ze=Math.min(ze,pl.y),kt=Math.max(kt,pl.x),vi=Math.max(vi,pl.y),S.push(pl)}const or=this.grid.query(X,ze,kt,vi).concat(this.ignoredGrid.query(X,ze,kt,vi)),Gn={},ia={};for(const oa of or){const pl=oa.key;if(Gn[pl.bucketInstanceId]===void 0&&(Gn[pl.bucketInstanceId]={}),Gn[pl.bucketInstanceId][pl.featureIndex])continue;const lh=[new s.Point(oa.x1,oa.y1),new s.Point(oa.x2,oa.y1),new s.Point(oa.x2,oa.y2),new s.Point(oa.x1,oa.y2)];s.polygonIntersectsPolygon(S,lh)&&(Gn[pl.bucketInstanceId][pl.featureIndex]=!0,ia[pl.bucketInstanceId]===void 0&&(ia[pl.bucketInstanceId]=[]),ia[pl.bucketInstanceId].push(pl.featureIndex))}return ia}insertCollisionBox(p,S,X,ze,kt){(S?this.ignoredGrid:this.grid).insert({bucketInstanceId:X,featureIndex:ze,collisionGroupID:kt},p[0],p[1],p[2],p[3])}insertCollisionCircles(p,S,X,ze,kt){const vi=S?this.ignoredGrid:this.grid,or={bucketInstanceId:X,featureIndex:ze,collisionGroupID:kt};for(let Gn=0;Gn<p.length;Gn+=4)vi.insertCircle(or,p[Gn],p[Gn+1],p[Gn+2])}projectAndGetPerspectiveRatio(p,S,X,ze,kt,vi,or){const Gn=[S,X,ze,1];let ia=!1;ze||this.transform.pitch>0?(s.transformMat4$1(Gn,Gn,p),this.fogState&&kt&&or.name!=="globe"&&(ia=function(lh,gh,yh,_h,xh,_l){const mh=_l.calculateFogTileMatrix(xh),wh=[gh,yh,_h];return s.transformMat4(wh,wh,mh),Ed(lh,wh,_l.pitch,_l._fov)}(this.fogState,S,X,ze,kt.toUnwrapped(),this.transform)>.9)):Kf(Gn,Gn,p);const oa=Gn[3];return{point:new s.Point((Gn[0]/oa+1)/2*this.transform.width+qm,(-Gn[1]/oa+1)/2*this.transform.height+qm),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(or)/oa*.5,1.5),signedDistanceFromCamera:oa,occluded:vi&&Gn[2]>oa||ia}}isOffscreen(p,S,X,ze){return X<qm||p>=this.screenRightBoundary||ze<qm||S>this.screenBottomBoundary}isInsideGrid(p,S,X,ze){return X>=0&&p<this.gridRightBoundary&&ze>=0&&S<this.gridBottomBoundary}getViewportMatrix(){const p=s.identity([]);return s.translate(p,p,[-100,-100,0]),p}}function ky(L,p,S){const X=p.createTileMatrix(L,L.worldSize,S.toUnwrapped());return s.multiply(new Float32Array(16),L.projMatrix,X)}function a_(L,p,S){if(p.projection.name===S.projection.name)return L.projMatrix;const X=S.clone();return X.setProjection(p.projection),ky(X,p.getProjection(),L)}function Lg(L,p,S){return p.name===S.projection.name?L.projMatrix:ky(S,p,L)}class B0{constructor(p,S,X,ze){this.opacity=p?Math.max(0,Math.min(1,p.opacity+(p.placed?S:-S))):ze&&X?1:0,this.placed=X}isHidden(){return this.opacity===0&&!this.placed}}class E_{constructor(p,S,X,ze,kt,vi=!1){this.text=new B0(p?p.text:null,S,X,kt),this.icon=new B0(p?p.icon:null,S,ze,kt),this.clipped=vi}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class By{constructor(p,S,X,ze=!1){this.text=p,this.icon=S,this.skipFade=X,this.clipped=ze}}class bv{constructor(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]}}class G0{constructor(p,S,X,ze,kt){this.bucketInstanceId=p,this.featureIndex=S,this.sourceLayerIndex=X,this.bucketIndex=ze,this.tileID=kt}}class O_{constructor(p){this.crossSourceCollisions=p,this.maxGroupID=0,this.collisionGroups={}}get(p){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[p]){const S=++this.maxGroupID;this.collisionGroups[p]={ID:S,predicate:X=>X.collisionGroupID===S}}return this.collisionGroups[p]}}function cy(L,p,S,X,ze){const{horizontalAlign:kt,verticalAlign:vi}=s.getAnchorAlignment(L),or=-(kt-.5)*p,Gn=-(vi-.5)*S,ia=s.evaluateVariableOffset(L,X);return new s.Point(or+ia[0]*ze,Gn+ia[1]*ze)}function Fm(L,p,S,X,ze){const kt=new s.Point(L,p);return S&&kt._rotate(X?ze:-ze),kt}class zy{constructor(p,S,X,ze,kt){this.transform=p.clone(),this.projection=p.projection.name,this.collisionIndex=new Ny(this.transform,kt),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=S,this.retainedQueryData={},this.collisionGroups=new O_(X),this.collisionCircleArrays={},this.prevPlacement=ze,ze&&(ze.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(p,S,X,ze){const kt=X.getBucket(S),vi=X.latestFeatureIndex;if(!kt||!vi||S.id!==kt.layerIds[0])return;const or=kt.layers[0].layout,Gn=X.collisionBoxArray,ia=Math.pow(2,this.transform.zoom-X.tileID.overscaledZ),oa=X.tileSize/s.EXTENT,pl=X.tileID.toUnwrapped();this.transform.setProjection(kt.projection);const lh=(gh=X.tileID,yh=kt.getProjection(),_h=this.transform,yh.name===this.projection?_h.calculateProjMatrix(gh.toUnwrapped()):ky(_h,yh,gh));var gh,yh,_h;const xh=or.get("text-pitch-alignment")==="map",_l=or.get("text-rotation-alignment")==="map";S.compileFilter();const mh=S.dynamicFilter(),wh=S.dynamicFilterNeedsFeature(),Sh=this.transform.calculatePixelsToTileUnitsMatrix(X),Oh=g_(lh,X.tileID.canonical,xh,_l,this.transform,kt.getProjection(),Sh);let Uh=null;if(xh){const Zh=xg(lh,X.tileID.canonical,xh,_l,this.transform,kt.getProjection(),Sh);Uh=s.multiply([],this.transform.labelPlaneMatrix,Zh)}let Vh=null;mh&&X.latestFeatureIndex&&(Vh={unwrappedTileID:pl,dynamicFilter:mh,dynamicFilterNeedsFeature:wh,featureIndex:X.latestFeatureIndex}),this.retainedQueryData[kt.bucketInstanceId]=new G0(kt.bucketInstanceId,vi,kt.sourceLayerIndex,kt.index,X.tileID);const Wh={bucket:kt,layout:or,posMatrix:lh,textLabelPlaneMatrix:Oh,labelToScreenMatrix:Uh,clippingData:Vh,scale:ia,textPixelRatio:oa,holdingForFade:X.holdingForFade(),collisionBoxArray:Gn,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(kt.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.evaluateSizeForZoom(kt.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(kt.sourceID)};if(ze)for(const Zh of kt.sortKeyRanges){const{sortKey:id,symbolInstanceStart:Bd,symbolInstanceEnd:ed}=Zh;p.push({sortKey:id,symbolInstanceStart:Bd,symbolInstanceEnd:ed,parameters:Wh})}else p.push({symbolInstanceStart:0,symbolInstanceEnd:kt.symbolInstances.length,parameters:Wh})}attemptAnchorPlacement(p,S,X,ze,kt,vi,or,Gn,ia,oa,pl,lh,gh,yh,_h,xh,_l,mh){const{textOffset0:wh,textOffset1:Sh,crossTileID:Oh}=lh,Uh=[wh,Sh],Vh=cy(p,X,ze,Uh,kt),Wh=this.collisionIndex.placeCollisionBox(yh,kt,S,Fm(Vh.x,Vh.y,vi,or,this.transform.angle),pl,Gn,ia,oa.predicate);if(xh){const Zh=yh.getSymbolInstanceIconSize(mh,this.transform.zoom,lh.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(yh,Zh,xh,Fm(Vh.x,Vh.y,vi,or,this.transform.angle),pl,Gn,ia,oa.predicate).box.length===0)return}if(Wh.box.length>0){let Zh;return this.prevPlacement&&this.prevPlacement.variableOffsets[Oh]&&this.prevPlacement.placements[Oh]&&this.prevPlacement.placements[Oh].text&&(Zh=this.prevPlacement.variableOffsets[Oh].anchor),this.variableOffsets[Oh]={textOffset:Uh,width:X,height:ze,anchor:p,textScale:kt,prevAnchor:Zh},this.markUsedJustification(yh,p,lh,_h),yh.allowVerticalPlacement&&(this.markUsedOrientation(yh,_h,lh),this.placedOrientations[Oh]=_h),{shift:Vh,placedGlyphBoxes:Wh}}}placeLayerBucketPart(p,S,X,ze){const{bucket:kt,layout:vi,posMatrix:or,textLabelPlaneMatrix:Gn,labelToScreenMatrix:ia,clippingData:oa,textPixelRatio:pl,holdingForFade:lh,collisionBoxArray:gh,partiallyEvaluatedTextSize:yh,partiallyEvaluatedIconSize:_h,collisionGroup:xh}=p.parameters,_l=vi.get("text-optional"),mh=vi.get("icon-optional"),wh=vi.get("text-allow-overlap"),Sh=vi.get("icon-allow-overlap"),Oh=vi.get("text-rotation-alignment")==="map",Uh=vi.get("text-pitch-alignment")==="map",Vh=vi.get("icon-text-fit")!=="none",Wh=vi.get("symbol-z-order")==="viewport-y";this.transform.setProjection(kt.projection);let Zh=wh&&(Sh||!kt.hasIconData()||mh),id=Sh&&(wh||!kt.hasTextData()||_l);!kt.collisionArrays&&gh&&kt.deserializeCollisionBoxes(gh),X&&ze&&kt.updateCollisionDebugBuffers(this.transform.zoom,gh);const Bd=(ed,Sd,dd)=>{const{crossTileID:xd,numVerticalGlyphVertices:nd}=ed;if(oa){const Ug={zoom:this.transform.zoom,pitch:this.transform.pitch};let Ag=null;if(oa.dynamicFilterNeedsFeature){const mg=this.retainedQueryData[kt.bucketInstanceId];Ag=oa.featureIndex.loadFeature({featureIndex:ed.featureIndex,bucketIndex:mg.bucketIndex,sourceLayerIndex:mg.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,oa.dynamicFilter)(Ug,Ag,this.retainedQueryData[kt.bucketInstanceId].tileID.canonical,new s.Point(ed.tileAnchorX,ed.tileAnchorY),this.transform.calculateDistanceTileData(oa.unwrappedTileID)))return this.placements[xd]=new By(!1,!1,!1,!0),void S.add(xd)}if(S.has(xd))return;if(lh)return void(this.placements[xd]=new By(!1,!1,!1));let vd=!1,Od=!1,Id=!0,$d=!1,Gp=!1,Hf=null,Mp={box:null,offscreen:null,occluded:null},Zp={box:null,offscreen:null,occluded:null},rg=null,Jf=null,Bp=null,fg=0,Sg=0,Tg=0;dd.textFeatureIndex?fg=dd.textFeatureIndex:ed.useRuntimeCollisionCircles&&(fg=ed.featureIndex),dd.verticalTextFeatureIndex&&(Sg=dd.verticalTextFeatureIndex);const gg=Ug=>{Ug.tileID=this.retainedQueryData[kt.bucketInstanceId].tileID;const Ag=this.transform.elevation;(Ag||Ug.elevation)&&(Ug.elevation=Ag?Ag.getAtTileOffset(Ug.tileID,Ug.tileAnchorX,Ug.tileAnchorY):0)},Jm=dd.textBox;if(Jm){gg(Jm);const Ug=mg=>{let pg=s.WritingMode.horizontal;if(kt.allowVerticalPlacement&&!mg&&this.prevPlacement){const wm=this.prevPlacement.placedOrientations[xd];wm&&(this.placedOrientations[xd]=wm,pg=wm,this.markUsedOrientation(kt,pg,ed))}return pg},Ag=(mg,pg)=>{if(kt.allowVerticalPlacement&&nd>0&&dd.verticalTextBox){for(const wm of kt.writingModes)if(wm===s.WritingMode.vertical?(Mp=pg(),Zp=Mp):Mp=mg(),Mp&&Mp.box&&Mp.box.length)break}else Mp=mg()};if(vi.get("text-variable-anchor")){let mg=vi.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[xd]){const Pg=this.prevPlacement.variableOffsets[xd];mg.indexOf(Pg.anchor)>0&&(mg=mg.filter(u_=>u_!==Pg.anchor),mg.unshift(Pg.anchor))}const pg=(Pg,u_,Kv)=>{const b0=kt.getSymbolInstanceTextSize(yh,ed,this.transform.zoom,Sd),Zv=(Pg.x2-Pg.x1)*b0+2*Pg.padding,Ey=(Pg.y2-Pg.y1)*b0+2*Pg.padding,cv=Vh&&!Sh?u_:null;cv&&gg(cv);let Xv={box:[],offscreen:!1,occluded:!1};const $x=wh?2*mg.length:mg.length;for(let C0=0;C0<$x;++C0){const Hx=this.attemptAnchorPlacement(mg[C0%mg.length],Pg,Zv,Ey,b0,Oh,Uh,pl,or,xh,C0>=mg.length,ed,Sd,kt,Kv,cv,yh,_h);if(Hx&&(Xv=Hx.placedGlyphBoxes,Xv&&Xv.box&&Xv.box.length)){vd=!0,Hf=Hx.shift;break}}return Xv};Ag(()=>pg(Jm,dd.iconBox,s.WritingMode.horizontal),()=>{const Pg=dd.verticalTextBox;return Pg&&gg(Pg),kt.allowVerticalPlacement&&!(Mp&&Mp.box&&Mp.box.length)&&nd>0&&Pg?pg(Pg,dd.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Mp&&(vd=Mp.box,Id=Mp.offscreen,$d=Mp.occluded);const wm=Ug(!(!Mp||!Mp.box));if(!vd&&this.prevPlacement){const Pg=this.prevPlacement.variableOffsets[xd];Pg&&(this.variableOffsets[xd]=Pg,this.markUsedJustification(kt,Pg.anchor,ed,wm))}}else{const mg=(pg,wm)=>{const Pg=kt.getSymbolInstanceTextSize(yh,ed,this.transform.zoom,Sd),u_=this.collisionIndex.placeCollisionBox(kt,Pg,pg,new s.Point(0,0),wh,pl,or,xh.predicate);return u_&&u_.box&&u_.box.length&&(this.markUsedOrientation(kt,wm,ed),this.placedOrientations[xd]=wm),u_};Ag(()=>mg(Jm,s.WritingMode.horizontal),()=>{const pg=dd.verticalTextBox;return kt.allowVerticalPlacement&&nd>0&&pg?(gg(pg),mg(pg,s.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Ug(!!(Mp&&Mp.box&&Mp.box.length))}}if(rg=Mp,vd=rg&&rg.box&&rg.box.length>0,Id=rg&&rg.offscreen,$d=rg&&rg.occluded,ed.useRuntimeCollisionCircles){const Ug=kt.text.placedSymbolArray.get(ed.centerJustifiedTextSymbolIndex>=0?ed.centerJustifiedTextSymbolIndex:ed.verticalPlacedTextSymbolIndex),Ag=s.evaluateSizeForFeature(kt.textSizeData,yh,Ug),mg=vi.get("text-padding");Jf=this.collisionIndex.placeCollisionCircles(kt,wh,Ug,kt.lineVertexArray,kt.glyphOffsetArray,Ag,or,Gn,ia,X,Uh,xh.predicate,ed.collisionCircleDiameter*Ag/s.ONE_EM,mg,this.retainedQueryData[kt.bucketInstanceId].tileID),vd=wh||Jf.circles.length>0&&!Jf.collisionDetected,Id=Id&&Jf.offscreen,$d=Jf.occluded}if(dd.iconFeatureIndex&&(Tg=dd.iconFeatureIndex),dd.iconBox){const Ug=Ag=>{gg(Ag);const mg=Vh&&Hf?Fm(Hf.x,Hf.y,Oh,Uh,this.transform.angle):new s.Point(0,0),pg=kt.getSymbolInstanceIconSize(_h,this.transform.zoom,ed.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(kt,pg,Ag,mg,Sh,pl,or,xh.predicate)};Zp&&Zp.box&&Zp.box.length&&dd.verticalIconBox?(Bp=Ug(dd.verticalIconBox),Od=Bp.box.length>0):(Bp=Ug(dd.iconBox),Od=Bp.box.length>0),Id=Id&&Bp.offscreen,Gp=Bp.occluded}const om=_l||ed.numHorizontalGlyphVertices===0&&nd===0,c_=mh||ed.numIconVertices===0;if(om||c_?c_?om||(Od=Od&&vd):vd=Od&&vd:Od=vd=Od&&vd,vd&&rg&&rg.box&&this.collisionIndex.insertCollisionBox(rg.box,vi.get("text-ignore-placement"),kt.bucketInstanceId,Zp&&Zp.box&&Sg?Sg:fg,xh.ID),Od&&Bp&&this.collisionIndex.insertCollisionBox(Bp.box,vi.get("icon-ignore-placement"),kt.bucketInstanceId,Tg,xh.ID),Jf&&(vd&&this.collisionIndex.insertCollisionCircles(Jf.circles,vi.get("text-ignore-placement"),kt.bucketInstanceId,fg,xh.ID),X)){const Ug=kt.bucketInstanceId;let Ag=this.collisionCircleArrays[Ug];Ag===void 0&&(Ag=this.collisionCircleArrays[Ug]=new bv);for(let mg=0;mg<Jf.circles.length;mg+=4)Ag.circles.push(Jf.circles[mg+0]),Ag.circles.push(Jf.circles[mg+1]),Ag.circles.push(Jf.circles[mg+2]),Ag.circles.push(Jf.collisionDetected?1:0)}const I_=kt.projection.name!=="globe";Zh=Zh&&(I_||!$d),id=id&&(I_||!Gp),this.placements[xd]=new By(vd||Zh,Od||id,Id||kt.justReloaded),S.add(xd)};if(Wh){const ed=kt.getSortedSymbolIndexes(this.transform.angle);for(let Sd=ed.length-1;Sd>=0;--Sd){const dd=ed[Sd];Bd(kt.symbolInstances.get(dd),dd,kt.collisionArrays[dd])}}else for(let ed=p.symbolInstanceStart;ed<p.symbolInstanceEnd;ed++)Bd(kt.symbolInstances.get(ed),ed,kt.collisionArrays[ed]);if(X&&kt.bucketInstanceId in this.collisionCircleArrays){const ed=this.collisionCircleArrays[kt.bucketInstanceId];s.invert(ed.invProjMatrix,or),ed.viewportMatrix=this.collisionIndex.getViewportMatrix()}kt.justReloaded=!1}markUsedJustification(p,S,X,ze){const{leftJustifiedTextSymbolIndex:kt,centerJustifiedTextSymbolIndex:vi,rightJustifiedTextSymbolIndex:or,verticalPlacedTextSymbolIndex:Gn,crossTileID:ia}=X,oa=s.getAnchorJustification(S),pl=ze===s.WritingMode.vertical?Gn:oa==="left"?kt:oa==="center"?vi:oa==="right"?or:-1;kt>=0&&(p.text.placedSymbolArray.get(kt).crossTileID=pl>=0&&kt!==pl?0:ia),vi>=0&&(p.text.placedSymbolArray.get(vi).crossTileID=pl>=0&&vi!==pl?0:ia),or>=0&&(p.text.placedSymbolArray.get(or).crossTileID=pl>=0&&or!==pl?0:ia),Gn>=0&&(p.text.placedSymbolArray.get(Gn).crossTileID=pl>=0&&Gn!==pl?0:ia)}markUsedOrientation(p,S,X){const ze=S===s.WritingMode.horizontal||S===s.WritingMode.horizontalOnly?S:0,kt=S===s.WritingMode.vertical?S:0,{leftJustifiedTextSymbolIndex:vi,centerJustifiedTextSymbolIndex:or,rightJustifiedTextSymbolIndex:Gn,verticalPlacedTextSymbolIndex:ia}=X,oa=p.text.placedSymbolArray;vi>=0&&(oa.get(vi).placedOrientation=ze),or>=0&&(oa.get(or).placedOrientation=ze),Gn>=0&&(oa.get(Gn).placedOrientation=ze),ia>=0&&(oa.get(ia).placedOrientation=kt)}commit(p){this.commitTime=p,this.zoomAtLastRecencyCheck=this.transform.zoom;const S=this.prevPlacement;let X=!1;this.prevZoomAdjustment=S?S.zoomAdjustment(this.transform.zoom):0;const ze=S?S.symbolFadeChange(p):1,kt=S?S.opacities:{},vi=S?S.variableOffsets:{},or=S?S.placedOrientations:{};for(const Gn in this.placements){const ia=this.placements[Gn],oa=kt[Gn];oa?(this.opacities[Gn]=new E_(oa,ze,ia.text,ia.icon,null,ia.clipped),X=X||ia.text!==oa.text.placed||ia.icon!==oa.icon.placed):(this.opacities[Gn]=new E_(null,ze,ia.text,ia.icon,ia.skipFade,ia.clipped),X=X||ia.text||ia.icon)}for(const Gn in kt){const ia=kt[Gn];if(!this.opacities[Gn]){const oa=new E_(ia,ze,!1,!1);oa.isHidden()||(this.opacities[Gn]=oa,X=X||ia.text.placed||ia.icon.placed)}}for(const Gn in vi)this.variableOffsets[Gn]||!this.opacities[Gn]||this.opacities[Gn].isHidden()||(this.variableOffsets[Gn]=vi[Gn]);for(const Gn in or)this.placedOrientations[Gn]||!this.opacities[Gn]||this.opacities[Gn].isHidden()||(this.placedOrientations[Gn]=or[Gn]);X?this.lastPlacementChangeTime=p:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=S?S.lastPlacementChangeTime:p)}updateLayerOpacities(p,S){const X=new Set;for(const ze of S){const kt=ze.getBucket(p);kt&&ze.latestFeatureIndex&&p.id===kt.layerIds[0]&&this.updateBucketOpacities(kt,X,ze.collisionBoxArray)}}updateBucketOpacities(p,S,X){p.hasTextData()&&p.text.opacityVertexArray.clear(),p.hasIconData()&&p.icon.opacityVertexArray.clear(),p.hasIconCollisionBoxData()&&p.iconCollisionBox.collisionVertexArray.clear(),p.hasTextCollisionBoxData()&&p.textCollisionBox.collisionVertexArray.clear();const ze=p.layers[0].layout,kt=!!p.layers[0].dynamicFilter(),vi=new E_(null,0,!1,!1,!0),or=ze.get("text-allow-overlap"),Gn=ze.get("icon-allow-overlap"),ia=ze.get("text-variable-anchor"),oa=ze.get("text-rotation-alignment")==="map",pl=ze.get("text-pitch-alignment")==="map",lh=ze.get("icon-text-fit")!=="none",gh=new E_(null,0,or&&(Gn||!p.hasIconData()||ze.get("icon-optional")),Gn&&(or||!p.hasTextData()||ze.get("text-optional")),!0);!p.collisionArrays&&X&&(p.hasIconCollisionBoxData()||p.hasTextCollisionBoxData())&&p.deserializeCollisionBoxes(X);const yh=(xh,_l,mh)=>{for(let wh=0;wh<_l/4;wh++)xh.opacityVertexArray.emplaceBack(mh)};let _h=0;for(let xh=0;xh<p.symbolInstances.length;xh++){const _l=p.symbolInstances.get(xh),{numHorizontalGlyphVertices:mh,numVerticalGlyphVertices:wh,crossTileID:Sh,numIconVertices:Oh}=_l,Uh=S.has(Sh);let Vh=this.opacities[Sh];Uh?Vh=vi:Vh||(Vh=gh,this.opacities[Sh]=Vh),S.add(Sh);const Wh=mh>0||wh>0,Zh=Oh>0,id=this.placedOrientations[Sh],Bd=id===s.WritingMode.vertical,ed=id===s.WritingMode.horizontal||id===s.WritingMode.horizontalOnly;if(!Wh&&!Zh||Vh.isHidden()||_h++,Wh){const Sd=Em(Vh.text);yh(p.text,mh,Bd?zg:Sd),yh(p.text,wh,ed?zg:Sd);const dd=Vh.text.isHidden(),{leftJustifiedTextSymbolIndex:xd,centerJustifiedTextSymbolIndex:nd,rightJustifiedTextSymbolIndex:vd,verticalPlacedTextSymbolIndex:Od}=_l,Id=p.text.placedSymbolArray,$d=dd||Bd?1:0;xd>=0&&(Id.get(xd).hidden=$d),nd>=0&&(Id.get(nd).hidden=$d),vd>=0&&(Id.get(vd).hidden=$d),Od>=0&&(Id.get(Od).hidden=dd||ed?1:0);const Gp=this.variableOffsets[Sh];Gp&&this.markUsedJustification(p,Gp.anchor,_l,id);const Hf=this.placedOrientations[Sh];Hf&&(this.markUsedJustification(p,"left",_l,Hf),this.markUsedOrientation(p,Hf,_l))}if(Zh){const Sd=Em(Vh.icon),{placedIconSymbolIndex:dd,verticalPlacedIconSymbolIndex:xd}=_l,nd=p.icon.placedSymbolArray,vd=Vh.icon.isHidden()?1:0;dd>=0&&(yh(p.icon,Oh,Bd?zg:Sd),nd.get(dd).hidden=vd),xd>=0&&(yh(p.icon,_l.numVerticalIconVertices,ed?zg:Sd),nd.get(xd).hidden=vd)}if(p.hasIconCollisionBoxData()||p.hasTextCollisionBoxData()){const Sd=p.collisionArrays[xh];if(Sd){let dd=new s.Point(0,0),xd=!0;if(Sd.textBox||Sd.verticalTextBox){if(ia){const vd=this.variableOffsets[Sh];vd?(dd=cy(vd.anchor,vd.width,vd.height,vd.textOffset,vd.textScale),oa&&dd._rotate(pl?this.transform.angle:-this.transform.angle)):xd=!1}kt&&(xd=!Vh.clipped),Sd.textBox&&F_(p.textCollisionBox.collisionVertexArray,Vh.text.placed,!xd||Bd,dd.x,dd.y),Sd.verticalTextBox&&F_(p.textCollisionBox.collisionVertexArray,Vh.text.placed,!xd||ed,dd.x,dd.y)}const nd=xd&&!!(!ed&&Sd.verticalIconBox);Sd.iconBox&&F_(p.iconCollisionBox.collisionVertexArray,Vh.icon.placed,nd,lh?dd.x:0,lh?dd.y:0),Sd.verticalIconBox&&F_(p.iconCollisionBox.collisionVertexArray,Vh.icon.placed,!nd,lh?dd.x:0,lh?dd.y:0)}}}if(p.fullyClipped=_h===0,p.sortFeatures(this.transform.angle),this.retainedQueryData[p.bucketInstanceId]&&(this.retainedQueryData[p.bucketInstanceId].featureSortOrder=p.featureSortOrder),p.hasTextData()&&p.text.opacityVertexBuffer&&p.text.opacityVertexBuffer.updateData(p.text.opacityVertexArray),p.hasIconData()&&p.icon.opacityVertexBuffer&&p.icon.opacityVertexBuffer.updateData(p.icon.opacityVertexArray),p.hasIconCollisionBoxData()&&p.iconCollisionBox.collisionVertexBuffer&&p.iconCollisionBox.collisionVertexBuffer.updateData(p.iconCollisionBox.collisionVertexArray),p.hasTextCollisionBoxData()&&p.textCollisionBox.collisionVertexBuffer&&p.textCollisionBox.collisionVertexBuffer.updateData(p.textCollisionBox.collisionVertexArray),p.bucketInstanceId in this.collisionCircleArrays){const xh=this.collisionCircleArrays[p.bucketInstanceId];p.placementInvProjMatrix=xh.invProjMatrix,p.placementViewportMatrix=xh.viewportMatrix,p.collisionCircleArray=xh.circles,delete this.collisionCircleArrays[p.bucketInstanceId]}}symbolFadeChange(p){return this.fadeDuration===0?1:(p-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(p){return Math.max(0,(this.transform.zoom-p)/1.5)}hasTransitions(p){return this.stale||p-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(p,S){const X=this.zoomAtLastRecencyCheck===S?1-this.zoomAdjustment(S):1;return this.zoomAtLastRecencyCheck=S,this.commitTime+this.fadeDuration*X>p}setStale(){this.stale=!0}}function F_(L,p,S,X,ze){L.emplaceBack(p?1:0,S?1:0,X||0,ze||0),L.emplaceBack(p?1:0,S?1:0,X||0,ze||0),L.emplaceBack(p?1:0,S?1:0,X||0,ze||0),L.emplaceBack(p?1:0,S?1:0,X||0,ze||0)}const dm=Math.pow(2,25),Gg=Math.pow(2,24),Cv=Math.pow(2,17),uy=Math.pow(2,16),pm=Math.pow(2,9),Vm=Math.pow(2,8),Km=Math.pow(2,1);function Em(L){if(L.opacity===0&&!L.placed)return 0;if(L.opacity===1&&L.placed)return 4294967295;const p=L.placed?1:0,S=Math.floor(127*L.opacity);return S*dm+p*Gg+S*Cv+p*uy+S*pm+p*Vm+S*Km+p}const zg=0;class hy{constructor(p){this._sortAcrossTiles=p.layout.get("symbol-z-order")!=="viewport-y"&&p.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(p,S,X,ze,kt){const vi=this._bucketParts;for(;this._currentTileIndex<p.length;)if(S.getBucketParts(vi,ze,p[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,kt())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,vi.sort((or,Gn)=>or.sortKey-Gn.sortKey));this._currentPartIndex<vi.length;){const or=vi[this._currentPartIndex];if(S.placeLayerBucketPart(or,this._seenCrossTileIDs,X,or.symbolInstanceStart===0),this._currentPartIndex++,kt())return!0}return!1}}class Ev{constructor(p,S,X,ze,kt,vi,or,Gn){this.placement=new zy(p,kt,vi,or,Gn),this._currentPlacementIndex=S.length-1,this._forceFullPlacement=X,this._showCollisionBoxes=ze,this._done=!1}isDone(){return this._done}continuePlacement(p,S,X){const ze=s.exported.now(),kt=()=>{const vi=s.exported.now()-ze;return!this._forceFullPlacement&&vi>2};for(;this._currentPlacementIndex>=0;){const vi=S[p[this._currentPlacementIndex]],or=this.placement.collisionIndex.transform.zoom;if(vi.type==="symbol"&&(!vi.minzoom||vi.minzoom<=or)&&(!vi.maxzoom||vi.maxzoom>or)){if(this._inProgressLayer||(this._inProgressLayer=new hy(vi)),this._inProgressLayer.continuePlacement(X[vi.source],this.placement,this._showCollisionBoxes,vi,kt))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(p){return this.placement.commit(p),this.placement}}const q_=512/s.EXTENT/2;class em{constructor(p,S,X){this.tileID=p,this.bucketInstanceId=X,this.index=new s.KDBush(S.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const ze=p.canonical.x*s.EXTENT,kt=p.canonical.y*s.EXTENT;for(let vi=0;vi<S.length;vi++){const{key:or,crossTileID:Gn,tileAnchorX:ia,tileAnchorY:oa}=S.get(vi),pl=Math.floor((ze+ia)*q_),lh=Math.floor((kt+oa)*q_);this.index.add(pl,lh),this.keys.push(or),this.crossTileIDs.push(Gn)}this.index.finish()}findMatches(p,S,X){const ze=this.tileID.canonical.z<S.canonical.z?1:Math.pow(2,this.tileID.canonical.z-S.canonical.z),kt=q_/Math.pow(2,S.canonical.z-this.tileID.canonical.z),vi=S.canonical.x*s.EXTENT,or=S.canonical.y*s.EXTENT;for(let Gn=0;Gn<p.length;Gn++){const ia=p.get(Gn);if(ia.crossTileID)continue;const{key:oa,tileAnchorX:pl,tileAnchorY:lh}=ia,gh=Math.floor((vi+pl)*kt),yh=Math.floor((or+lh)*kt),_h=this.index.range(gh-ze,yh-ze,gh+ze,yh+ze);for(const xh of _h){const _l=this.crossTileIDs[xh];if(this.keys[xh]===oa&&!X.has(_l)){X.add(_l),ia.crossTileID=_l;break}}}}}class K_{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class cg{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(p){const S=Math.round((p-this.lng)/360);if(S!==0)for(const X in this.indexes){const ze=this.indexes[X],kt={};for(const vi in ze){const or=ze[vi];or.tileID=or.tileID.unwrapTo(or.tileID.wrap+S),kt[or.tileID.key]=or}this.indexes[X]=kt}this.lng=p}addBucket(p,S,X){if(this.indexes[p.overscaledZ]&&this.indexes[p.overscaledZ][p.key]){if(this.indexes[p.overscaledZ][p.key].bucketInstanceId===S.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(p.overscaledZ,this.indexes[p.overscaledZ][p.key])}for(let kt=0;kt<S.symbolInstances.length;kt++)S.symbolInstances.get(kt).crossTileID=0;this.usedCrossTileIDs[p.overscaledZ]||(this.usedCrossTileIDs[p.overscaledZ]=new Set);const ze=this.usedCrossTileIDs[p.overscaledZ];for(const kt in this.indexes){const vi=this.indexes[kt];if(Number(kt)>p.overscaledZ)for(const or in vi){const Gn=vi[or];Gn.tileID.isChildOf(p)&&Gn.findMatches(S.symbolInstances,p,ze)}else{const or=vi[p.scaledTo(Number(kt)).key];or&&or.findMatches(S.symbolInstances,p,ze)}}for(let kt=0;kt<S.symbolInstances.length;kt++){const vi=S.symbolInstances.get(kt);vi.crossTileID||(vi.crossTileID=X.generate(),ze.add(vi.crossTileID))}return this.indexes[p.overscaledZ]===void 0&&(this.indexes[p.overscaledZ]={}),this.indexes[p.overscaledZ][p.key]=new em(p,S.symbolInstances,S.bucketInstanceId),!0}removeBucketCrossTileIDs(p,S){for(const X of S.crossTileIDs)this.usedCrossTileIDs[p].delete(X)}removeStaleBuckets(p){let S=!1;for(const X in this.indexes){const ze=this.indexes[X];for(const kt in ze)p[ze[kt].bucketInstanceId]||(this.removeBucketCrossTileIDs(X,ze[kt]),delete ze[kt],S=!0)}return S}}class S_{constructor(){this.layerIndexes={},this.crossTileIDs=new K_,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(p,S,X,ze){let kt=this.layerIndexes[p.id];kt===void 0&&(kt=this.layerIndexes[p.id]=new cg);let vi=!1;const or={};ze.name!=="globe"&&kt.handleWrapJump(X);for(const Gn of S){const ia=Gn.getBucket(p);ia&&p.id===ia.layerIds[0]&&(ia.bucketInstanceId||(ia.bucketInstanceId=++this.maxBucketInstanceId),kt.addBucket(Gn.tileID,ia,this.crossTileIDs)&&(vi=!0),or[ia.bucketInstanceId]=!0)}return kt.removeStaleBuckets(or)&&(vi=!0),vi}pruneUnusedLayers(p){const S={};p.forEach(X=>{S[X]=!0});for(const X in this.layerIndexes)S[X]||delete this.layerIndexes[X]}}const T_=(L,p)=>s.emitValidationErrors(L,p&&p.filter(S=>S.identifier!=="source.canvas")),a0=s.pick(Jp,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),zx=s.pick(Jp,["setCenter","setZoom","setBearing","setPitch"]),dy={version:8,layers:[],sources:{}},Sv={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class N_ extends s.Evented{constructor(p,S={}){super(),this.map=p,this.dispatcher=new Ld(Vf(),this),this.imageManager=new th,this.imageManager.setEventedParent(this),this.glyphManager=new s.GlyphManager(p._requestManager,S.localFontFamily?s.LocalGlyphMode.all:S.localIdeographFontFamily?s.LocalGlyphMode.ideographs:s.LocalGlyphMode.none,S.localFontFamily||S.localIdeographFontFamily),this.crossTileSymbolIndex=new S_,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());const X=this;this._rtlTextPluginCallback=N_.registerForPluginStateChange(ze=>{X.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:ze.pluginStatus,pluginURL:ze.pluginURL},(kt,vi)=>{if(s.triggerPluginCompletionEvent(kt),vi&&vi.every(or=>or))for(const or in X._sourceCaches){const Gn=X._sourceCaches[or],ia=Gn.getSource().type;ia!=="vector"&&ia!=="geojson"||Gn.reload()}})}),this.on("data",ze=>{if(ze.dataType!=="source"||ze.sourceDataType!=="metadata")return;const kt=this.getSource(ze.sourceId);if(kt&&kt.vectorLayerIds)for(const vi in this._layers){const or=this._layers[vi];or.source===kt.id&&this._validateLayer(or)}})}loadURL(p,S={}){this.fire(new s.Event("dataloading",{dataType:"style"}));const X=typeof S.validate=="boolean"?S.validate:!s.isMapboxURL(p);p=this.map._requestManager.normalizeStyleURL(p,S.accessToken);const ze=this.map._requestManager.transformRequest(p,s.ResourceType.Style);this._request=s.getJSON(ze,(kt,vi)=>{this._request=null,kt?this.fire(new s.ErrorEvent(kt)):vi&&this._load(vi,X)})}loadJSON(p,S={}){this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.exported.frame(()=>{this._request=null,this._load(p,S.validate!==!1)})}loadEmpty(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(dy,!1)}_updateLayerCount(p,S){const X=S?1:-1;p.is3D()&&(this._num3DLayers+=X),p.type==="circle"&&(this._numCircleLayers+=X),p.type==="symbol"&&(this._numSymbolLayers+=X)}_load(p,S){if(S&&T_(this,s.validateStyle(p)))return;this._loaded=!0,this.stylesheet=s.clone$1(p),this._updateMapProjection();for(const ze in p.sources)this.addSource(ze,p.sources[ze],{validate:!1});this._changed=!1,p.sprite?this._loadSprite(p.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(p.glyphs);const X=dg(this.stylesheet.layers);this._order=X.map(ze=>ze.id),this._layers={},this._serializedLayers={};for(const ze of X){const kt=s.createStyleLayer(ze);kt.setEventedParent(this,{layer:{id:kt.id}}),this._layers[kt.id]=kt,this._serializedLayers[kt.id]=kt.serialize(),this._updateLayerCount(kt,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new bh(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(p){p?this.stylesheet.projection=p:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(p){this._spriteRequest=function(S,X,ze){let kt,vi,or;const Gn=s.exported.devicePixelRatio>1?"@2x":"";let ia=s.getJSON(X.transformRequest(X.normalizeSpriteURL(S,Gn,".json"),s.ResourceType.SpriteJSON),(lh,gh)=>{ia=null,or||(or=lh,kt=gh,pl())}),oa=s.getImage(X.transformRequest(X.normalizeSpriteURL(S,Gn,".png"),s.ResourceType.SpriteImage),(lh,gh)=>{oa=null,or||(or=lh,vi=gh,pl())});function pl(){if(or)ze(or);else if(kt&&vi){const lh=s.exported.getImageData(vi),gh={};for(const yh in kt){const{width:_h,height:xh,x:_l,y:mh,sdf:wh,pixelRatio:Sh,stretchX:Oh,stretchY:Uh,content:Vh}=kt[yh],Wh=new s.RGBAImage({width:_h,height:xh});s.RGBAImage.copy(lh,Wh,{x:_l,y:mh},{x:0,y:0},{width:_h,height:xh}),gh[yh]={data:Wh,pixelRatio:Sh,sdf:wh,stretchX:Oh,stretchY:Uh,content:Vh}}ze(null,gh)}}return{cancel(){ia&&(ia.cancel(),ia=null),oa&&(oa.cancel(),oa=null)}}}(p,this.map._requestManager,(S,X)=>{if(this._spriteRequest=null,S)this.fire(new s.ErrorEvent(S));else if(X)for(const ze in X)this.imageManager.addImage(ze,X[ze]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new s.Event("data",{dataType:"style"}))})}_validateLayer(p){const S=this.getSource(p.source);if(!S)return;const X=p.sourceLayer;X&&(S.type==="geojson"||S.vectorLayerIds&&S.vectorLayerIds.indexOf(X)===-1)&&this.fire(new s.ErrorEvent(new Error(`Source layer "${X}" does not exist on source "${S.id}" as specified by style layer "${p.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const p in this._sourceCaches)if(!this._sourceCaches[p].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(p){const S=[];for(const X of p){const ze=this._layers[X];ze.type!=="custom"&&S.push(ze.serialize())}return S}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const p in this._sourceCaches)if(this._sourceCaches[p].hasTransition())return!0;for(const p in this._layers)if(this._layers[p].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(p){return!!this.terrain&&(typeof p.isLayerDraped=="function"?p.isLayerDraped():Sv[p.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(p){if(!this._loaded)return;const S=this._changed;if(this._changed){const ze=Object.keys(this._updatedLayers),kt=Object.keys(this._removedLayers);(ze.length||kt.length)&&this._updateWorkerLayers(ze,kt);for(const vi in this._updatedSources){const or=this._updatedSources[vi];or==="reload"?this._reloadSource(vi):or==="clear"&&this._clearSource(vi)}this._updateTilesForChangedImages();for(const vi in this._updatedPaintProps)this._layers[vi].updateTransitions(p);this.light.updateTransitions(p),this.fog&&this.fog.updateTransitions(p),this._resetUpdates()}const X={};for(const ze in this._sourceCaches){const kt=this._sourceCaches[ze];X[ze]=kt.used,kt.used=!1}for(const ze of this._order){const kt=this._layers[ze];if(kt.recalculate(p,this._availableImages),!kt.isHidden(p.zoom)){const or=this._getLayerSourceCache(kt);or&&(or.used=!0)}const vi=this.map.painter;if(vi){const or=kt.getProgramIds();if(!or)continue;const Gn=kt.getProgramConfiguration(p.zoom);for(const ia of or)vi.useProgram(ia,Gn)}}for(const ze in X){const kt=this._sourceCaches[ze];X[ze]!==kt.used&&kt.getSource().fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:kt.getSource().id}))}this.light.recalculate(p),this.terrain&&this.terrain.recalculate(p),this.fog&&this.fog.recalculate(p),this.z=p.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),S&&this.fire(new s.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const p=Object.keys(this._changedImages);if(p.length){for(const S in this._sourceCaches)this._sourceCaches[S].reloadTilesForDependencies(["icons","patterns"],p);this._changedImages={}}}_updateWorkerLayers(p,S){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(p),removedIds:S})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(p){if(this._checkLoaded(),T_(this,s.validateStyle(p)))return!1;(p=s.clone$1(p)).layers=dg(p.layers);const S=function(ze,kt){if(!ze)return[{command:Jp.setStyle,args:[kt]}];let vi=[];try{if(!m(ze.version,kt.version))return[{command:Jp.setStyle,args:[kt]}];m(ze.center,kt.center)||vi.push({command:Jp.setCenter,args:[kt.center]}),m(ze.zoom,kt.zoom)||vi.push({command:Jp.setZoom,args:[kt.zoom]}),m(ze.bearing,kt.bearing)||vi.push({command:Jp.setBearing,args:[kt.bearing]}),m(ze.pitch,kt.pitch)||vi.push({command:Jp.setPitch,args:[kt.pitch]}),m(ze.sprite,kt.sprite)||vi.push({command:Jp.setSprite,args:[kt.sprite]}),m(ze.glyphs,kt.glyphs)||vi.push({command:Jp.setGlyphs,args:[kt.glyphs]}),m(ze.transition,kt.transition)||vi.push({command:Jp.setTransition,args:[kt.transition]}),m(ze.light,kt.light)||vi.push({command:Jp.setLight,args:[kt.light]}),m(ze.fog,kt.fog)||vi.push({command:Jp.setFog,args:[kt.fog]}),m(ze.projection,kt.projection)||vi.push({command:Jp.setProjection,args:[kt.projection]});const or={},Gn=[];(function(pl,lh,gh,yh){let _h;for(_h in lh=lh||{},pl=pl||{})pl.hasOwnProperty(_h)&&(lh.hasOwnProperty(_h)||Cg(_h,gh,yh));for(_h in lh){if(!lh.hasOwnProperty(_h))continue;const xh=lh[_h];pl.hasOwnProperty(_h)?m(pl[_h],xh)||(pl[_h].type==="geojson"&&xh.type==="geojson"&&Bg(pl,lh,_h)?gh.push({command:Jp.setGeoJSONSourceData,args:[_h,xh.data]}):o_(_h,lh,gh,yh)):Yp(_h,lh,gh)}})(ze.sources,kt.sources,Gn,or);const ia=[];ze.layers&&ze.layers.forEach(pl=>{pl.source&&or[pl.source]?vi.push({command:Jp.removeLayer,args:[pl.id]}):ia.push(pl)});let oa=ze.terrain;oa&&or[oa.source]&&(vi.push({command:Jp.setTerrain,args:[void 0]}),oa=void 0),vi=vi.concat(Gn),m(oa,kt.terrain)||vi.push({command:Jp.setTerrain,args:[kt.terrain]}),function(pl,lh,gh){lh=lh||[];const yh=(pl=pl||[]).map(nm),_h=lh.map(nm),xh=pl.reduce(ly,{}),_l=lh.reduce(ly,{}),mh=yh.slice(),wh=Object.create(null);let Sh,Oh,Uh,Vh,Wh,Zh,id;for(Sh=0,Oh=0;Sh<yh.length;Sh++)Uh=yh[Sh],_l.hasOwnProperty(Uh)?Oh++:(gh.push({command:Jp.removeLayer,args:[Uh]}),mh.splice(mh.indexOf(Uh,Oh),1));for(Sh=0,Oh=0;Sh<_h.length;Sh++)Uh=_h[_h.length-1-Sh],mh[mh.length-1-Sh]!==Uh&&(xh.hasOwnProperty(Uh)?(gh.push({command:Jp.removeLayer,args:[Uh]}),mh.splice(mh.lastIndexOf(Uh,mh.length-Oh),1)):Oh++,Zh=mh[mh.length-Sh],gh.push({command:Jp.addLayer,args:[_l[Uh],Zh]}),mh.splice(mh.length-Sh,0,Uh),wh[Uh]=!0);for(Sh=0;Sh<_h.length;Sh++)if(Uh=_h[Sh],Vh=xh[Uh],Wh=_l[Uh],!wh[Uh]&&!m(Vh,Wh))if(m(Vh.source,Wh.source)&&m(Vh["source-layer"],Wh["source-layer"])&&m(Vh.type,Wh.type)){for(id in Xg(Vh.layout,Wh.layout,gh,Uh,null,Jp.setLayoutProperty),Xg(Vh.paint,Wh.paint,gh,Uh,null,Jp.setPaintProperty),m(Vh.filter,Wh.filter)||gh.push({command:Jp.setFilter,args:[Uh,Wh.filter]}),m(Vh.minzoom,Wh.minzoom)&&m(Vh.maxzoom,Wh.maxzoom)||gh.push({command:Jp.setLayerZoomRange,args:[Uh,Wh.minzoom,Wh.maxzoom]}),Vh)Vh.hasOwnProperty(id)&&id!=="layout"&&id!=="paint"&&id!=="filter"&&id!=="metadata"&&id!=="minzoom"&&id!=="maxzoom"&&(id.indexOf("paint.")===0?Xg(Vh[id],Wh[id],gh,Uh,id.slice(6),Jp.setPaintProperty):m(Vh[id],Wh[id])||gh.push({command:Jp.setLayerProperty,args:[Uh,id,Wh[id]]}));for(id in Wh)Wh.hasOwnProperty(id)&&!Vh.hasOwnProperty(id)&&id!=="layout"&&id!=="paint"&&id!=="filter"&&id!=="metadata"&&id!=="minzoom"&&id!=="maxzoom"&&(id.indexOf("paint.")===0?Xg(Vh[id],Wh[id],gh,Uh,id.slice(6),Jp.setPaintProperty):m(Vh[id],Wh[id])||gh.push({command:Jp.setLayerProperty,args:[Uh,id,Wh[id]]}))}else gh.push({command:Jp.removeLayer,args:[Uh]}),Zh=mh[mh.lastIndexOf(Uh)+1],gh.push({command:Jp.addLayer,args:[Wh,Zh]})}(ia,kt.layers,vi)}catch(or){console.warn("Unable to compute style diff:",or),vi=[{command:Jp.setStyle,args:[kt]}]}return vi}(this.serialize(),p).filter(ze=>!(ze.command in zx));if(S.length===0)return!1;const X=S.filter(ze=>!(ze.command in a0));if(X.length>0)throw new Error(`Unimplemented: ${X.map(ze=>ze.command).join(", ")}.`);return S.forEach(ze=>{ze.command!=="setTransition"&&ze.command!=="setProjection"&&this[ze.command].apply(this,ze.args)}),this.stylesheet=p,this._updateMapProjection(),!0}addImage(p,S){return this.getImage(p)?this.fire(new s.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(p,S),this._afterImageUpdated(p),this)}updateImage(p,S){this.imageManager.updateImage(p,S)}getImage(p){return this.imageManager.getImage(p)}removeImage(p){return this.getImage(p)?(this.imageManager.removeImage(p),this._afterImageUpdated(p),this):this.fire(new s.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(p){this._availableImages=this.imageManager.listImages(),this._changedImages[p]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(p,S,X={}){if(this._checkLoaded(),this.getSource(p)!==void 0)throw new Error("There is already a source with this ID");if(!S.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(S).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(S.type)>=0&&this._validate(s.validateSource,`sources.${p}`,S,null,X))return;this.map&&this.map._collectResourceTiming&&(S.collectResourceTiming=!0);const ze=Qh(p,S,this.dispatcher,this);ze.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(p),source:ze.serialize(),sourceId:p}));const kt=vi=>{const or=(vi?"symbol:":"other:")+p,Gn=this._sourceCaches[or]=new s.SourceCache(or,ze,vi);(vi?this._symbolSourceCaches:this._otherSourceCaches)[p]=Gn,Gn.style=this,Gn.onAdd(this.map)};kt(!1),S.type!=="vector"&&S.type!=="geojson"||kt(!0),ze.onAdd&&ze.onAdd(this.map),this._changed=!0}removeSource(p){this._checkLoaded();const S=this.getSource(p);if(!S)throw new Error("There is no source with this ID");for(const ze in this._layers)if(this._layers[ze].source===p)return this.fire(new s.ErrorEvent(new Error(`Source "${p}" cannot be removed while layer "${ze}" is using it.`)));if(this.terrain&&this.terrain.get().source===p)return this.fire(new s.ErrorEvent(new Error(`Source "${p}" cannot be removed while terrain is using it.`)));const X=this._getSourceCaches(p);for(const ze of X)delete this._sourceCaches[ze.id],delete this._updatedSources[ze.id],ze.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:ze.getSource().id})),ze.setEventedParent(null),ze.clearTiles();return delete this._otherSourceCaches[p],delete this._symbolSourceCaches[p],S.setEventedParent(null),S.onRemove&&S.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(p,S){this._checkLoaded(),this.getSource(p).setData(S),this._changed=!0}getSource(p){const S=this._getSourceCache(p);return S&&S.getSource()}_getSources(){const p=[];for(const S in this._otherSourceCaches){const X=this._getSourceCache(S);X&&p.push(X.getSource())}return p}addLayer(p,S,X={}){this._checkLoaded();const ze=p.id;if(this.getLayer(ze))return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${ze}" already exists on this map`)));let kt;if(p.type==="custom"){if(T_(this,s.validateCustomStyleLayer(p)))return;kt=s.createStyleLayer(p)}else{if(typeof p.source=="object"&&(this.addSource(ze,p.source),p=s.clone$1(p),p=s.extend(p,{source:ze})),this._validate(s.validateLayer,`layers.${ze}`,p,{arrayIndex:-1},X))return;kt=s.createStyleLayer(p),this._validateLayer(kt),kt.setEventedParent(this,{layer:{id:ze}}),this._serializedLayers[kt.id]=kt.serialize(),this._updateLayerCount(kt,!0)}const vi=S?this._order.indexOf(S):this._order.length;if(S&&vi===-1)return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${S}" does not exist on this map.`)));this._order.splice(vi,0,ze),this._layerOrderChanged=!0,this._layers[ze]=kt;const or=this._getLayerSourceCache(kt);if(this._removedLayers[ze]&&kt.source&&or&&kt.type!=="custom"){const Gn=this._removedLayers[ze];delete this._removedLayers[ze],Gn.type!==kt.type?this._updatedSources[kt.source]="clear":(this._updatedSources[kt.source]="reload",or.pause())}this._updateLayer(kt),kt.onAdd&&kt.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(p,S){if(this._checkLoaded(),this._changed=!0,!this._layers[p])return void this.fire(new s.ErrorEvent(new Error(`The layer '${p}' does not exist in the map's style and cannot be moved.`)));if(p===S)return;const X=this._order.indexOf(p);this._order.splice(X,1);const ze=S?this._order.indexOf(S):this._order.length;S&&ze===-1?this.fire(new s.ErrorEvent(new Error(`Layer with id "${S}" does not exist on this map.`))):(this._order.splice(ze,0,p),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(p){this._checkLoaded();const S=this._layers[p];if(!S)return void this.fire(new s.ErrorEvent(new Error(`The layer '${p}' does not exist in the map's style and cannot be removed.`)));S.setEventedParent(null),this._updateLayerCount(S,!1);const X=this._order.indexOf(p);this._order.splice(X,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[p]=S,delete this._layers[p],delete this._serializedLayers[p],delete this._updatedLayers[p],delete this._updatedPaintProps[p],S.onRemove&&S.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(p){return this._layers[p]}hasLayer(p){return p in this._layers}hasLayerType(p){for(const S in this._layers)if(this._layers[S].type===p)return!0;return!1}setLayerZoomRange(p,S,X){this._checkLoaded();const ze=this.getLayer(p);ze?ze.minzoom===S&&ze.maxzoom===X||(S!=null&&(ze.minzoom=S),X!=null&&(ze.maxzoom=X),this._updateLayer(ze)):this.fire(new s.ErrorEvent(new Error(`The layer '${p}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(p,S,X={}){this._checkLoaded();const ze=this.getLayer(p);if(ze){if(!m(ze.filter,S))return S==null?(ze.filter=void 0,void this._updateLayer(ze)):void(this._validate(s.validateFilter,`layers.${ze.id}.filter`,S,{layerType:ze.type},X)||(ze.filter=s.clone$1(S),this._updateLayer(ze)))}else this.fire(new s.ErrorEvent(new Error(`The layer '${p}' does not exist in the map's style and cannot be filtered.`)))}getFilter(p){const S=this.getLayer(p);return S&&s.clone$1(S.filter)}setLayoutProperty(p,S,X,ze={}){this._checkLoaded();const kt=this.getLayer(p);kt?m(kt.getLayoutProperty(S),X)||(kt.setLayoutProperty(S,X,ze),this._updateLayer(kt)):this.fire(new s.ErrorEvent(new Error(`The layer '${p}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(p,S){const X=this.getLayer(p);if(X)return X.getLayoutProperty(S);this.fire(new s.ErrorEvent(new Error(`The layer '${p}' does not exist in the map's style.`)))}setPaintProperty(p,S,X,ze={}){this._checkLoaded();const kt=this.getLayer(p);kt?m(kt.getPaintProperty(S),X)||(kt.setPaintProperty(S,X,ze)&&this._updateLayer(kt),this._changed=!0,this._updatedPaintProps[p]=!0):this.fire(new s.ErrorEvent(new Error(`The layer '${p}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(p,S){const X=this.getLayer(p);return X&&X.getPaintProperty(S)}setFeatureState(p,S){this._checkLoaded();const X=p.source,ze=p.sourceLayer,kt=this.getSource(X);if(!kt)return void this.fire(new s.ErrorEvent(new Error(`The source '${X}' does not exist in the map's style.`)));const vi=kt.type;if(vi==="geojson"&&ze)return void this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(vi==="vector"&&!ze)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));p.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided.")));const or=this._getSourceCaches(X);for(const Gn of or)Gn.setFeatureState(ze,p.id,S)}removeFeatureState(p,S){this._checkLoaded();const X=p.source,ze=this.getSource(X);if(!ze)return void this.fire(new s.ErrorEvent(new Error(`The source '${X}' does not exist in the map's style.`)));const kt=ze.type,vi=kt==="vector"?p.sourceLayer:void 0;if(kt==="vector"&&!vi)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(S&&typeof p.id!="string"&&typeof p.id!="number")return void this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const or=this._getSourceCaches(X);for(const Gn of or)Gn.removeFeatureState(vi,p.id,S)}getFeatureState(p){this._checkLoaded();const S=p.source,X=p.sourceLayer,ze=this.getSource(S);if(ze){if(ze.type!=="vector"||X)return p.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(S)[0].getFeatureState(X,p.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error(`The source '${S}' does not exist in the map's style.`)))}getTransition(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const p={};for(const S in this._sourceCaches){const X=this._sourceCaches[S].getSource();p[X.id]||(p[X.id]=X.serialize())}return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:p,layers:this._serializeLayers(this._order)},S=>S!==void 0)}_updateLayer(p){this._updatedLayers[p.id]=!0;const S=this._getLayerSourceCache(p);p.source&&!this._updatedSources[p.source]&&S&&S.getSource().type!=="raster"&&(this._updatedSources[p.source]="reload",S.pause()),this._changed=!0,p.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(p){const S=vi=>this._layers[vi].type==="fill-extrusion",X={},ze=[];for(let vi=this._order.length-1;vi>=0;vi--){const or=this._order[vi];if(S(or)){X[or]=vi;for(const Gn of p){const ia=Gn[or];if(ia)for(const oa of ia)ze.push(oa)}}}ze.sort((vi,or)=>or.intersectionZ-vi.intersectionZ);const kt=[];for(let vi=this._order.length-1;vi>=0;vi--){const or=this._order[vi];if(S(or))for(let Gn=ze.length-1;Gn>=0;Gn--){const ia=ze[Gn].feature;if(X[ia.layer.id]<vi)break;kt.push(ia),ze.pop()}else for(const Gn of p){const ia=Gn[or];if(ia)for(const oa of ia)kt.push(oa.feature)}}return kt}queryRenderedFeatures(p,S,X){S&&S.filter&&this._validate(s.validateFilter,"queryRenderedFeatures.filter",S.filter,null,S);const ze={};if(S&&S.layers){if(!Array.isArray(S.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const Gn of S.layers){const ia=this._layers[Gn];if(!ia)return this.fire(new s.ErrorEvent(new Error(`The layer '${Gn}' does not exist in the map's style and cannot be queried for features.`))),[];ze[ia.source]=!0}}const kt=[];S.availableImages=this._availableImages;const vi=S&&S.layers?S.layers.some(Gn=>{const ia=this.getLayer(Gn);return ia&&ia.is3D()}):this.has3DLayers(),or=Xd.createFromScreenPoints(p,X);for(const Gn in this._sourceCaches){const ia=this._sourceCaches[Gn].getSource().id;S.layers&&!ze[ia]||kt.push(_d(this._sourceCaches[Gn],this._layers,this._serializedLayers,or,S,X,vi,!!this.map._showQueryGeometry))}return this.placement&&kt.push(function(Gn,ia,oa,pl,lh,gh,yh){const _h={},xh=gh.queryRenderedSymbols(pl),_l=[];for(const mh of Object.keys(xh).map(Number))_l.push(yh[mh]);_l.sort(Dp);for(const mh of _l){const wh=mh.featureIndex.lookupSymbolFeatures(xh[mh.bucketInstanceId],ia,mh.bucketIndex,mh.sourceLayerIndex,lh.filter,lh.layers,lh.availableImages,Gn);for(const Sh in wh){const Oh=_h[Sh]=_h[Sh]||[],Uh=wh[Sh];Uh.sort((Vh,Wh)=>{const Zh=mh.featureSortOrder;if(Zh){const id=Zh.indexOf(Vh.featureIndex);return Zh.indexOf(Wh.featureIndex)-id}return Wh.featureIndex-Vh.featureIndex});for(const Vh of Uh)Oh.push(Vh)}}for(const mh in _h)_h[mh].forEach(wh=>{const Sh=wh.feature,Oh=oa(Gn[mh]);if(!Oh)return;const Uh=Oh.getFeatureState(Sh.layer["source-layer"],Sh.id);Sh.source=Sh.layer.source,Sh.layer["source-layer"]&&(Sh.sourceLayer=Sh.layer["source-layer"]),Sh.state=Uh});return _h}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),or.screenGeometry,S,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(kt)}querySourceFeatures(p,S){S&&S.filter&&this._validate(s.validateFilter,"querySourceFeatures.filter",S.filter,null,S);const X=this._getSourceCaches(p);let ze=[];for(const kt of X)ze=ze.concat(ip(kt,S));return ze}addSourceType(p,S,X){return N_.getSourceType(p)?X(new Error(`A source type called "${p}" already exists.`)):(N_.setSourceType(p,S),S.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:p,url:S.workerSourceURL},X):X(null,null))}getLight(){return this.light.getLight()}setLight(p,S={}){this._checkLoaded();const X=this.light.getLight();let ze=!1;for(const vi in p)if(!m(p[vi],X[vi])){ze=!0;break}if(!ze)return;const kt=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(p,S),this.light.updateTransitions(kt)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(p,S=1){if(this._checkLoaded(),!p)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let X=p;if(S===1){if(typeof X.source=="object"){const ze="terrain-dem-src";this.addSource(ze,X.source),X=s.clone$1(X),X=s.extend(X,{source:ze})}if(this._validate(s.validateTerrain,"terrain",X))return}if(!this.terrain||this.terrain&&S!==this.terrain.drapeRenderMode){if(!X)return;this._createTerrain(X,S)}else{const ze=this.terrain,kt=ze.get();for(const vi of Object.keys(s.spec.terrain))!X.hasOwnProperty(vi)&&s.spec.terrain[vi].default&&(X[vi]=s.spec.terrain[vi].default);for(const vi in X)if(!m(X[vi],kt[vi])){ze.set(X),this.stylesheet.terrain=X;const or=this._setTransitionParameters({duration:0});ze.updateTransitions(or);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(p){const S=this.fog=new Fd(p,this.map.transform);this.stylesheet.fog=p;const X=this._setTransitionParameters({duration:0});S.updateTransitions(X)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const p of this.map._markers)p._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(p){if(this._checkLoaded(),!p)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const S=this.fog,X=S.get();Object.keys(p).length===0&&S.set(p);for(const ze in p)if(!m(p[ze],X[ze])){S.set(p),this.stylesheet.fog=p;const kt=this._setTransitionParameters({duration:0});S.updateTransitions(kt);break}}else this._createFog(p);this._markersNeedUpdate=!0}_setTransitionParameters(p){return{now:s.exported.now(),transition:s.extend(p,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const p=this._order.filter(X=>this.isLayerDraped(this._layers[X])),S=this._order.filter(X=>!this.isLayerDraped(this._layers[X]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...p),this._drapedFirstOrder.push(...S)}_createTerrain(p,S){const X=this.terrain=new Bh(p,S);this.stylesheet.terrain=p,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const ze=this._setTransitionParameters({duration:0});X.updateTransitions(ze)}_force3DLayerUpdate(){for(const p in this._layers){const S=this._layers[p];S.type==="fill-extrusion"&&this._updateLayer(S)}}_forceSymbolLayerUpdate(){for(const p in this._layers){const S=this._layers[p];S.type==="symbol"&&this._updateLayer(S)}}_validate(p,S,X,ze,kt={}){return(!kt||kt.validate!==!1)&&T_(this,p.call(s.validateStyle,s.extend({key:S,style:this.serialize(),value:X,styleSpec:s.spec},ze)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const p in this._layers)this._layers[p].setEventedParent(null);for(const p in this._sourceCaches)this._sourceCaches[p].clearTiles(),this._sourceCaches[p].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(p){const S=this._getSourceCaches(p);for(const X of S)X.clearTiles()}_reloadSource(p){const S=this._getSourceCaches(p);for(const X of S)X.resume(),X.reload()}_reloadSources(){for(const p of this._getSources())p.reload&&p.reload()}_updateSources(p){for(const S in this._sourceCaches)this._sourceCaches[S].update(p)}_generateCollisionBoxes(){for(const p in this._sourceCaches){const S=this._sourceCaches[p];S.resume(),S.reload()}}_updatePlacement(p,S,X,ze,kt=!1){let vi=!1,or=!1;const Gn={};for(const ia of this._order){const oa=this._layers[ia];if(oa.type!=="symbol")continue;if(!Gn[oa.source]){const lh=this._getLayerSourceCache(oa);if(!lh)continue;Gn[oa.source]=lh.getRenderableIds(!0).map(gh=>lh.getTileByID(gh)).sort((gh,yh)=>yh.tileID.overscaledZ-gh.tileID.overscaledZ||(gh.tileID.isLessThan(yh.tileID)?-1:1))}const pl=this.crossTileSymbolIndex.addLayer(oa,Gn[oa.source],p.center.lng,p.projection);vi=vi||pl}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),kt=kt||this._layerOrderChanged||X===0,this._layerOrderChanged&&this.fire(new s.Event("neworder")),(kt||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.exported.now(),p.zoom))&&(this.pauseablePlacement=new Ev(p,this._order,kt,S,X,ze,this.placement,this.fog&&p.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Gn),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.exported.now()),or=!0),vi&&this.pauseablePlacement.placement.setStale()),or||vi)for(const ia of this._order){const oa=this._layers[ia];oa.type==="symbol"&&this.placement.updateLayerOpacities(oa,Gn[oa.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.exported.now())}_releaseSymbolFadeTiles(){for(const p in this._sourceCaches)this._sourceCaches[p].releaseSymbolFadeTiles()}getImages(p,S,X){this.imageManager.getImages(S.icons,X),this._updateTilesForChangedImages();const ze=kt=>{kt&&kt.setDependencies(S.tileID.key,S.type,S.icons)};ze(this._otherSourceCaches[S.source]),ze(this._symbolSourceCaches[S.source])}getGlyphs(p,S,X){this.glyphManager.getGlyphs(S.stacks,X)}getResource(p,S,X){return s.makeRequest(S,X)}_getSourceCache(p){return this._otherSourceCaches[p]}_getLayerSourceCache(p){return p.type==="symbol"?this._symbolSourceCaches[p.source]:this._otherSourceCaches[p.source]}_getSourceCaches(p){const S=[];return this._otherSourceCaches[p]&&S.push(this._otherSourceCaches[p]),this._symbolSourceCaches[p]&&S.push(this._symbolSourceCaches[p]),S}_isSourceCacheLoaded(p){const S=this._getSourceCaches(p);return S.length===0?(this.fire(new s.ErrorEvent(new Error(`There is no source with ID '${p}'`))),!1):S.every(X=>X.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}N_.getSourceType=function(L){return Nh[L]},N_.setSourceType=function(L,p){Nh[L]=p},N_.registerForPluginStateChange=s.registerForPluginStateChange;var xx=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Vy="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Z_=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,l0=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,A_=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let Uy={},py={};const $y=[];y_(xx,$y),y_(Z_,$y),y_(l0,$y),y_(A_,$y),Uy=hg("",Z_),py=hg(A_,l0);const Hy=hg(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),c0=xx,z0=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var u0={background:hg(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:hg(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:hg(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:hg("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:hg(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:hg(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:hg("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:hg("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:hg("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:hg(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:hg(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:hg(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:hg(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:hg(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:hg(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:hg(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:hg(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:hg(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:hg(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:hg(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:hg(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:hg(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:hg(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:hg(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:hg(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:hg(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Vy),skyboxGradient:hg(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Vy),skyboxCapture:hg(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:hg(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:hg(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function y_(L,p){const S=L.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let X of S)if(X=X.trim(),X[0]==="#"&&X.includes("if")&&!X.includes("endif")){X=X.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const ze=X.split(" ");for(const kt of ze)p.includes(kt)||p.push(kt)}}function hg(L,p){const S=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,X=p.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),ze={},kt=[...$y];return y_(L,kt),y_(p,kt),{fragmentSource:L=L.replace(S,(vi,or,Gn,ia,oa)=>(ze[oa]=!0,or==="define"?`
#ifndef HAS_UNIFORM_u_${oa}
varying ${Gn} ${ia} ${oa};
#else
uniform ${Gn} ${ia} u_${oa};
#endif
`:`
#ifdef HAS_UNIFORM_u_${oa}
    ${Gn} ${ia} ${oa} = u_${oa};
#endif
`)),vertexSource:p=p.replace(S,(vi,or,Gn,ia,oa)=>{const pl=ia==="float"?"vec2":"vec4",lh=oa.match(/color/)?"color":pl;return ze[oa]?or==="define"?`
#ifndef HAS_UNIFORM_u_${oa}
uniform lowp float u_${oa}_t;
attribute ${Gn} ${pl} a_${oa};
varying ${Gn} ${ia} ${oa};
#else
uniform ${Gn} ${ia} u_${oa};
#endif
`:lh==="vec4"?`
#ifndef HAS_UNIFORM_u_${oa}
    ${oa} = a_${oa};
#else
    ${Gn} ${ia} ${oa} = u_${oa};
#endif
`:`
#ifndef HAS_UNIFORM_u_${oa}
    ${oa} = unpack_mix_${lh}(a_${oa}, u_${oa}_t);
#else
    ${Gn} ${ia} ${oa} = u_${oa};
#endif
`:or==="define"?`
#ifndef HAS_UNIFORM_u_${oa}
uniform lowp float u_${oa}_t;
attribute ${Gn} ${pl} a_${oa};
#else
uniform ${Gn} ${ia} u_${oa};
#endif
`:lh==="vec4"?`
#ifndef HAS_UNIFORM_u_${oa}
    ${Gn} ${ia} ${oa} = a_${oa};
#else
    ${Gn} ${ia} ${oa} = u_${oa};
#endif
`:`
#ifndef HAS_UNIFORM_u_${oa}
    ${Gn} ${ia} ${oa} = unpack_mix_${lh}(a_${oa}, u_${oa}_t);
#else
    ${Gn} ${ia} ${oa} = u_${oa};
#endif
`}),staticAttributes:X,usedDefines:kt}}class Tv{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(p,S,X,ze,kt,vi,or){this.context=p;let Gn=this.boundPaintVertexBuffers.length!==ze.length;for(let oa=0;!Gn&&oa<ze.length;oa++)this.boundPaintVertexBuffers[oa]!==ze[oa]&&(Gn=!0);let ia=this.boundDynamicVertexBuffers.length!==or.length;for(let oa=0;!ia&&oa<or.length;oa++)this.boundDynamicVertexBuffers[oa]!==or[oa]&&(ia=!0);if(!p.extVertexArrayObject||!this.vao||this.boundProgram!==S||this.boundLayoutVertexBuffer!==X||Gn||ia||this.boundIndexBuffer!==kt||this.boundVertexOffset!==vi)this.freshBind(S,X,ze,kt,vi,or);else{p.bindVertexArrayOES.set(this.vao);for(const oa of or)oa&&oa.bind();kt&&kt.dynamicDraw&&kt.bind()}}freshBind(p,S,X,ze,kt,vi){let or;const Gn=p.numAttributes,ia=this.context,oa=ia.gl;if(ia.extVertexArrayObject)this.vao&&this.destroy(),this.vao=ia.extVertexArrayObject.createVertexArrayOES(),ia.bindVertexArrayOES.set(this.vao),or=0,this.boundProgram=p,this.boundLayoutVertexBuffer=S,this.boundPaintVertexBuffers=X,this.boundIndexBuffer=ze,this.boundVertexOffset=kt,this.boundDynamicVertexBuffers=vi;else{or=ia.currentNumAttributes||0;for(let pl=Gn;pl<or;pl++)oa.disableVertexAttribArray(pl)}S.enableAttributes(oa,p),S.bind(),S.setVertexAttribPointers(oa,p,kt);for(const pl of X)pl.enableAttributes(oa,p),pl.bind(),pl.setVertexAttribPointers(oa,p,kt);for(const pl of vi)pl&&(pl.enableAttributes(oa,p),pl.bind(),pl.setVertexAttribPointers(oa,p,kt));ze&&ze.bind(),ia.currentNumAttributes=Gn}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function fy(L,p){const S=Math.pow(2,p.canonical.z),X=p.canonical.y;return[new s.MercatorCoordinate(0,X/S).toLngLat().lat,new s.MercatorCoordinate(0,(X+1)/S).toLngLat().lat]}function wx(L,p,S,X,ze,kt,vi){const or=L.context,Gn=or.gl,ia=S.fbo;if(!ia)return;L.prepareDrawTile();const oa=L.useProgram("hillshade");or.activeTexture.set(Gn.TEXTURE0),Gn.bindTexture(Gn.TEXTURE_2D,ia.colorAttachment.get());const pl=((_h,xh,_l,mh)=>{const wh=_l.paint.get("hillshade-shadow-color"),Sh=_l.paint.get("hillshade-highlight-color"),Oh=_l.paint.get("hillshade-accent-color");let Uh=_l.paint.get("hillshade-illumination-direction")*(Math.PI/180);_l.paint.get("hillshade-illumination-anchor")==="viewport"&&(Uh-=_h.transform.angle);const Vh=!_h.options.moving;return{u_matrix:mh||_h.transform.calculateProjMatrix(xh.tileID.toUnwrapped(),Vh),u_image:0,u_latrange:fy(0,xh.tileID),u_light:[_l.paint.get("hillshade-exaggeration"),Uh],u_shadow:wh,u_highlight:Sh,u_accent:Oh}})(L,S,X,L.terrain?p.projMatrix:null);L.prepareDrawProgram(or,oa,p.toUnwrapped());const{tileBoundsBuffer:lh,tileBoundsIndexBuffer:gh,tileBoundsSegments:yh}=L.getTileBoundsBuffers(S);oa.draw(or,Gn.TRIANGLES,ze,kt,vi,s.CullFaceMode.disabled,pl,X.id,lh,gh,yh)}function h0(L,p,S){if(!p.needsDEMTextureUpload)return;const X=L.context,ze=X.gl;X.pixelStoreUnpackPremultiplyAlpha.set(!1),p.demTexture=p.demTexture||L.getTileTexture(S.stride);const kt=S.getPixels();p.demTexture?p.demTexture.update(kt,{premultiply:!1}):p.demTexture=new s.Texture(X,kt,ze.RGBA,{premultiply:!1}),p.needsDEMTextureUpload=!1}function _g(L,p,S,X,ze,kt){const vi=L.context,or=vi.gl;if(!p.dem)return;const Gn=p.dem;if(vi.activeTexture.set(or.TEXTURE1),h0(L,p,Gn),!p.demTexture)return;p.demTexture.bind(or.NEAREST,or.CLAMP_TO_EDGE);const ia=Gn.dim;vi.activeTexture.set(or.TEXTURE0);let oa=p.fbo;if(!oa){const yh=new s.Texture(vi,{width:ia,height:ia,data:null},or.RGBA);yh.bind(or.LINEAR,or.CLAMP_TO_EDGE),oa=p.fbo=vi.createFramebuffer(ia,ia,!0),oa.colorAttachment.set(yh.texture)}vi.bindFramebuffer.set(oa.framebuffer),vi.viewport.set([0,0,ia,ia]);const{tileBoundsBuffer:pl,tileBoundsIndexBuffer:lh,tileBoundsSegments:gh}=L.getMercatorTileBoundsBuffers();L.useProgram("hillshadePrepare").draw(vi,or.TRIANGLES,X,ze,kt,s.CullFaceMode.disabled,((yh,_h)=>{const xh=_h.stride,_l=s.create();return s.ortho(_l,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(_l,_l,[0,-s.EXTENT,0]),{u_matrix:_l,u_image:1,u_dimension:[xh,xh],u_zoom:yh.overscaledZ,u_unpack:_h.unpackVector}})(p.tileID,Gn),S.id,pl,lh,gh),p.needsHillshadePrepare=!1}const Av=L=>({u_matrix:new s.UniformMatrix4f(L),u_image0:new s.Uniform1i(L),u_skirt_height:new s.Uniform1f(L)}),Rv=(L,p)=>({u_matrix:L,u_image0:0,u_skirt_height:p}),d0=(L,p,S,X,ze,kt,vi,or,Gn,ia,oa,pl,lh,gh,yh)=>({u_proj_matrix:Float32Array.from(L),u_globe_matrix:p,u_normalize_matrix:Float32Array.from(X),u_merc_matrix:S,u_zoom_transition:ze,u_merc_center:kt,u_image0:0,u_frustum_tl:vi,u_frustum_tr:or,u_frustum_br:Gn,u_frustum_bl:ia,u_globe_pos:oa,u_globe_radius:pl,u_viewport:lh,u_grid_matrix:yh?Float32Array.from(yh):new Float32Array(9),u_skirt_height:gh});function k_(L,p){return L!=null&&p!=null&&!(!L.hasData()||!p.hasData())&&L.demTexture!=null&&p.demTexture!=null&&L.tileID.key!==p.tileID.key}const X_=new class{constructor(){this.operations={}}newMorphing(L,p,S,X,ze){if(L in this.operations){const kt=this.operations[L];kt.to.tileID.key!==S.tileID.key&&(kt.queued=S)}else this.operations[L]={startTime:X,phase:0,duration:ze,from:p,to:S,queued:null}}getMorphValuesForProxy(L){if(!(L in this.operations))return null;const p=this.operations[L];return{from:p.from,to:p.to,phase:p.phase}}update(L){for(const p in this.operations){const S=this.operations[p];for(S.phase=(L-S.startTime)/S.duration;S.phase>=1||!this._validOp(S);)if(!this._nextOp(S,L)){delete this.operations[p];break}}}_nextOp(L,p){return!!L.queued&&(L.from=L.to,L.to=L.queued,L.queued=null,L.phase=0,L.startTime=p,!0)}_validOp(L){return L.from.hasData()&&L.to.hasData()}},Y_={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function p0(L){return 6*Math.pow(1.5,22-L)}function Vx(L,p){const S=1<<L.z;return!p&&(L.x===0||L.x===S-1)||L.y===0||L.y===S-1}const jy=L=>({u_matrix:L});function Iv(L,p,S,X,ze){if(ze>0){const kt=s.exported.now(),vi=(kt-L.timeAdded)/ze,or=p?(kt-p.timeAdded)/ze:-1,Gn=S.getSource(),ia=X.coveringZoomLevel({tileSize:Gn.tileSize,roundZoom:Gn.roundZoom}),oa=!p||Math.abs(p.tileID.overscaledZ-ia)>Math.abs(L.tileID.overscaledZ-ia),pl=oa&&L.refreshedUponExpiration?1:s.clamp(oa?vi:1-or,0,1);return L.refreshedUponExpiration&&vi>=1&&(L.refreshedUponExpiration=!1),p?{opacity:1,mix:1-pl}:{opacity:pl,mix:0}}return{opacity:1,mix:0}}class Og extends s.SourceCache{constructor(p){const S={type:"raster-dem",maxzoom:p.transform.maxZoom},X=new Ld(Vf(),null),ze=Qh("mock-dem",S,X,p.style);super("mock-dem",ze,!1),ze.setEventedParent(this),this._sourceLoaded=!0}_loadTile(p,S){p.state="loaded",S(null)}}class Mv extends s.SourceCache{constructor(p){const S=Qh("proxy",{type:"geojson",maxzoom:p.transform.maxZoom},new Ld(Vf(),null),p.style);super("proxy",S,!1),S.setEventedParent(this),this.map=this.getSource().map=p,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(p,S,X){if(p.freezeTileCoverage)return;this.transform=p;const ze=p.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((kt,vi)=>{if(kt[vi.key]="",!this._tiles[vi.key]){const or=new s.Tile(vi,this._source.tileSize*vi.overscaleFactor(),p.tileZoom);or.state="loaded",this._tiles[vi.key]=or}return kt},{});for(const kt in this._tiles)kt in ze||(this.freeFBO(kt),this._tiles[kt].unloadVectorData(),delete this._tiles[kt])}freeFBO(p){const S=this.proxyCachedFBO[p];if(S!==void 0){const X=Object.values(S);this.renderCachePool.push(...X),delete this.proxyCachedFBO[p]}}deallocRenderCache(){this.renderCache.forEach(p=>p.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ig extends s.OverscaledTileID{constructor(p,S,X){super(p.overscaledZ,p.wrap,p.canonical.z,p.canonical.x,p.canonical.y),this.proxyTileKey=S,this.projMatrix=X}}class Pv extends s.Elevation{constructor(p,S){super(),this.painter=p,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[X,ze,kt]=function(Gn){const ia=new s.StructArrayLayout2i4,oa=new s.StructArrayLayout3ui6,pl=131;ia.reserve(17161),oa.reserve(33800);const lh=s.EXTENT/128,gh=s.EXTENT+lh/2,yh=gh+lh;for(let xh=-lh;xh<yh;xh+=lh)for(let _l=-lh;_l<yh;_l+=lh){const mh=_l<0||_l>gh||xh<0||xh>gh?24575:0,wh=s.clamp(Math.round(_l),0,s.EXTENT),Sh=s.clamp(Math.round(xh),0,s.EXTENT);ia.emplaceBack(wh+mh,Sh)}const _h=(xh,_l)=>{const mh=_l*pl+xh;oa.emplaceBack(mh+1,mh,mh+pl),oa.emplaceBack(mh+pl,mh+pl+1,mh+1)};for(let xh=1;xh<129;xh++)for(let _l=1;_l<129;_l++)_h(_l,xh);return[0,129].forEach(xh=>{for(let _l=0;_l<130;_l++)_h(_l,xh),_h(xh,_l)}),[ia,oa,32768]}(),vi=p.context;this.gridBuffer=vi.createVertexBuffer(X,s.posAttributes.members),this.gridIndexBuffer=vi.createIndexBuffer(ze),this.gridSegments=s.SegmentVector.simpleSegment(0,0,X.length,ze.length),this.gridNoSkirtSegments=s.SegmentVector.simpleSegment(0,0,X.length,kt),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Mv(S.map),this.orthoMatrix=s.create(),s.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.EXTENT,0,s.EXTENT,0,1);const or=vi.gl;this._overlapStencilMode=new s.StencilMode({func:or.GEQUAL,mask:255},0,255,or.KEEP,or.KEEP,or.REPLACE),this._previousZoom=p.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=S,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Og(S.map)}set style(p){p.on("data",this._onStyleDataEvent.bind(this)),p.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=p,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(p,S,X){if(p&&p.terrain){this._style!==p&&(this.style=p),this.enabled=!0;const ze=p.terrain.properties;this.sourceCache=p.terrain.drapeRenderMode===0?this._mockSourceCache:p._getSourceCache(ze.get("source")),this._exaggeration=ze.get("exaggeration");const kt=()=>{this.sourceCache.used&&s.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const vi=this.getScaledDemTileSize();this.sourceCache.update(S,vi,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,kt(),this._initializing=!0),kt(),S.updateElevation(!0,X),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(S),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(p){this._findCoveringTileCache[p]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const p=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||p.efficiency!==100&&s.warnOnce(`Terrain render cache efficiency is not optimal (${p.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${p.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(p){p.coord&&p.dataType==="source"?this._clearRenderCacheForTile(p.sourceCacheId,p.coord):p.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const p in this._style._sourceCaches)this._style._sourceCaches[p].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(p=>p.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const p=2*this.proxySourceCache.getSource().tileSize;return[p,p]}set useVertexMorphing(p){this._useVertexMorphing=p}updateTileBinding(p){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const S=this.proxySourceCache,X=this.painter.transform;this._initializing&&(this._initializing=X._centerAltitude===0&&this.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(X.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const ze=this.proxyCoords=S.getIds().map(Gn=>{const ia=S.getTileByID(Gn).tileID;return ia.projMatrix=X.calculateProjMatrix(ia.toUnwrapped()),ia});(function(Gn,ia){const oa=ia.transform.pointCoordinate(ia.transform.getCameraPoint()),pl=new s.Point(oa.x,oa.y);Gn.sort((lh,gh)=>{if(gh.overscaledZ-lh.overscaledZ)return gh.overscaledZ-lh.overscaledZ;const yh=new s.Point(lh.canonical.x+(1<<lh.canonical.z)*lh.wrap,lh.canonical.y),_h=new s.Point(gh.canonical.x+(1<<gh.canonical.z)*gh.wrap,gh.canonical.y),xh=pl.mult(1<<lh.canonical.z);return xh.x-=.5,xh.y-=.5,xh.distSqr(yh)-xh.distSqr(_h)})})(ze,this.painter),this._previousZoom=X.zoom;const kt=this.proxyToSource||{};this.proxyToSource={},ze.forEach(Gn=>{this.proxyToSource[Gn.key]={}}),this.terrainTileForTile={};const vi=this._style._sourceCaches;for(const Gn in vi){const ia=vi[Gn];if(!ia.used||(ia!==this.sourceCache&&this.resetTileLookupCache(ia.id),this._setupProxiedCoordsForOrtho(ia,p[Gn],kt),ia.usedForTerrain))continue;const oa=p[Gn];ia.getSource().reparseOverscaled&&this._assignTerrainTiles(oa)}this.proxiedCoords[S.id]=ze.map(Gn=>new ig(Gn,Gn.key,this.orthoMatrix)),this._assignTerrainTiles(ze),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(kt),this.renderingToTexture=!1,this._updateTimestamp=s.exported.now();const or={};this._visibleDemTiles=[];for(const Gn of this.proxyCoords){const ia=this.terrainTileForTile[Gn.key];if(!ia)continue;const oa=ia.tileID.key;oa in or||(this._visibleDemTiles.push(ia),or[oa]=oa)}}_assignTerrainTiles(p){this._initializing||p.forEach(S=>{if(this.terrainTileForTile[S.key])return;const X=this._findTileCoveringTileID(S,this.sourceCache);X&&(this.terrainTileForTile[S.key]=X)})}_prepareDEMTextures(){const p=this.painter.context,S=p.gl;for(const X in this.terrainTileForTile){const ze=this.terrainTileForTile[X],kt=ze.dem;!kt||ze.demTexture&&!ze.needsDEMTextureUpload||(p.activeTexture.set(S.TEXTURE1),h0(this.painter,ze,kt))}}_prepareDemTileUniforms(p,S,X,ze){if(!S||S.demTexture==null)return!1;const kt=p.tileID.canonical,vi=Math.pow(2,S.tileID.canonical.z-kt.z),or=ze||"";return X[`u_dem_tl${or}`]=[kt.x*vi%1,kt.y*vi%1],X[`u_dem_scale${or}`]=vi,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const p=this.painter.context,S=p.gl;if(!this._emptyDepthBufferTexture){const X=new s.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.Texture(p,X,S.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let p=0;const S=this._visibleDemTiles.reduce((X,ze)=>{if(!ze.dem)return X;const kt=ze.dem.tree.minimums[0];return kt>0&&p++,X+kt},0);return p?S/p:0}_updateEmptyDEMTexture(){const p=this.painter.context,S=p.gl;p.activeTexture.set(S.TEXTURE2);const X=this._getLoadedAreaMinimum(),ze=new s.RGBAImage({width:1,height:1},new Uint8Array(s.DEMData.pack(X,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let kt=this._emptyDEMTexture;return kt?kt.update(ze,{premultiply:!1}):kt=this._emptyDEMTexture=new s.Texture(p,ze,S.RGBA,{premultiply:!1}),kt}setupElevationDraw(p,S,X){const ze=this.painter.context,kt=ze.gl,vi=(or=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:s.DEMData.getUnpackVector(or),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var or;vi.u_dem_size=this.sourceCache.getSource().tileSize,vi.u_exaggeration=this.exaggeration();let Gn=null,ia=null,oa=1;if(X&&X.morphing&&this._useVertexMorphing){const pl=X.morphing.srcDemTile,lh=X.morphing.dstDemTile;oa=X.morphing.phase,pl&&lh&&(this._prepareDemTileUniforms(p,pl,vi,"_prev")&&(ia=pl),this._prepareDemTileUniforms(p,lh,vi)&&(Gn=lh))}if(ia&&Gn?(ze.activeTexture.set(kt.TEXTURE2),Gn.demTexture.bind(kt.NEAREST,kt.CLAMP_TO_EDGE,kt.NEAREST),ze.activeTexture.set(kt.TEXTURE4),ia.demTexture.bind(kt.NEAREST,kt.CLAMP_TO_EDGE,kt.NEAREST),vi.u_dem_lerp=oa):(Gn=this.terrainTileForTile[p.tileID.key],ze.activeTexture.set(kt.TEXTURE2),(this._prepareDemTileUniforms(p,Gn,vi)?Gn.demTexture:this.emptyDEMTexture).bind(kt.NEAREST,kt.CLAMP_TO_EDGE)),ze.activeTexture.set(kt.TEXTURE3),X&&X.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(kt.NEAREST,kt.CLAMP_TO_EDGE),this._depthFBO&&(vi.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(kt.NEAREST,kt.CLAMP_TO_EDGE),vi.u_depth_size_inv=[1,1]),X&&X.useMeterToDem&&Gn){const pl=(1<<Gn.tileID.canonical.z)*s.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;vi.u_meter_to_dem=pl}if(X&&X.labelPlaneMatrixInv&&(vi.u_label_plane_matrix_inv=X.labelPlaneMatrixInv),S.setTerrainUniformValues(ze,vi),this.painter.transform.projection.name==="globe"){const pl=this.globeUniformValues(this.painter.transform,p.tileID.canonical,X&&X.useDenormalizedUpVectorScale);S.setGlobeUniformValues(ze,pl)}}globeUniformValues(p,S,X){const ze=p.projection;return{u_tile_tl_up:ze.upVector(S,0,0),u_tile_tr_up:ze.upVector(S,s.EXTENT,0),u_tile_br_up:ze.upVector(S,s.EXTENT,s.EXTENT),u_tile_bl_up:ze.upVector(S,0,s.EXTENT),u_tile_up_scale:X?s.globeMetersToEcef(1):ze.upVectorScale(S,p.center.lat,p.worldSize).metersToTile}}renderToBackBuffer(p){const S=this.painter,X=this.painter.context;p.length!==0&&(X.bindFramebuffer.set(null),X.viewport.set([0,0,S.width,S.height]),S.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(ze,kt,vi,or,Gn){if(ze.transform.projection.name==="globe")(function(ia,oa,pl,lh,gh){const yh=ia.context,_h=yh.gl;let xh,_l;const mh=ia.options.showTerrainWireframe?2:0,wh=ia.transform,Sh=s.globeUseCustomAntiAliasing(ia,yh,wh),Oh=(xd,nd)=>{if(_l===xd)return;const vd=[Y_[xd],"PROJECTION_GLOBE_VIEW"];Sh&&vd.push("CUSTOM_ANTIALIASING"),nd&&vd.push(Y_[mh]),xh=ia.useProgram("globeRaster",null,vd),_l=xd},Uh=ia.colorModeForRenderPass(),Vh=new s.DepthMode(_h.LEQUAL,s.DepthMode.ReadWrite,ia.depthRangeFor3D);X_.update(gh);const Wh=s.calculateGlobeMercatorMatrix(wh),Zh=[s.mercatorXfromLng(wh.center.lng),s.mercatorYfromLat(wh.center.lat)],id=mh?[!1,!0]:[!1],Bd=ia.globeSharedBuffers,ed=[wh.width*s.exported.devicePixelRatio,wh.height*s.exported.devicePixelRatio],Sd=Float32Array.from(wh.globeMatrix),dd={useDenormalizedUpVectorScale:!0};if(id.forEach(xd=>{const nd=ia.transform,vd=p0(nd.zoom)*oa.exaggeration();_l=-1;const Od=xd?_h.LINES:_h.TRIANGLES;for(const Id of lh){const $d=pl.getTile(Id),Gp=s.StencilMode.disabled,Hf=oa.prevTerrainTileForTile[Id.key],Mp=oa.terrainTileForTile[Id.key];k_(Hf,Mp)&&X_.newMorphing(Id.key,Hf,Mp,gh,250),yh.activeTexture.set(_h.TEXTURE0),$d.texture.bind(_h.LINEAR,_h.CLAMP_TO_EDGE);const Zp=X_.getMorphValuesForProxy(Id.key),rg=Zp?1:0;Zp&&s.extend$1(dd,{morphing:{srcDemTile:Zp.from,dstDemTile:Zp.to,phase:s.easeCubicInOut(Zp.phase)}});const Jf=s.tileCornersToBounds(Id.canonical),Bp=s.getLatitudinalLod(Jf.getCenter().lat),fg=s.getGridMatrix(Id.canonical,Jf,Bp,nd.worldSize/nd._pixelsPerMercatorPixel),Sg=s.globeNormalizeECEF(s.globeTileBounds(Id.canonical)),Tg=d0(nd.projMatrix,Sd,Wh,Sg,s.globeToMercatorTransition(nd.zoom),Zh,nd.frustumCorners.TL,nd.frustumCorners.TR,nd.frustumCorners.BR,nd.frustumCorners.BL,nd.globeCenterInViewSpace,nd.globeRadius,ed,vd,fg);if(Oh(rg,xd),oa.setupElevationDraw($d,xh,dd),ia.prepareDrawProgram(yh,xh,Id.toUnwrapped()),Bd){const[gg,Jm,om]=xd?Bd.getWirefameBuffers(ia.context,Bp):Bd.getGridBuffers(Bp,vd!==0);xh.draw(yh,Od,Vh,Gp,Uh,s.CullFaceMode.backCCW,Tg,"globe_raster",gg,Jm,om)}}}),Bd){const xd=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Sh&&xd.push("CUSTOM_ANTIALIASING"),xh=ia.useProgram("globeRaster",null,xd);for(const nd of lh){const{x:vd,y:Od,z:Id}=nd.canonical,$d=Od===0,Gp=Od===(1<<Id)-1,[Hf,Mp,Zp,rg]=Bd.getPoleBuffers(Id);if(rg&&($d||Gp)){const Jf=pl.getTile(nd);yh.activeTexture.set(_h.TEXTURE0),Jf.texture.bind(_h.LINEAR,_h.CLAMP_TO_EDGE);let Bp=s.globePoleMatrixForTile(Id,vd,wh);const fg=s.globeNormalizeECEF(s.globeTileBounds(nd.canonical)),Sg=(Tg,gg)=>Tg.draw(yh,_h.TRIANGLES,Vh,s.StencilMode.disabled,Uh,s.CullFaceMode.disabled,d0(wh.projMatrix,Bp,Bp,fg,0,Zh,wh.frustumCorners.TL,wh.frustumCorners.TR,wh.frustumCorners.BR,wh.frustumCorners.BL,wh.globeCenterInViewSpace,wh.globeRadius,ed,0),"globe_pole_raster",gg,Zp,rg);oa.setupElevationDraw(Jf,xh,dd),ia.prepareDrawProgram(yh,xh,nd.toUnwrapped()),$d&&Sg(xh,Hf),Gp&&(Bp=s.scale(s.create(),Bp,[1,-1,1]),Sg(xh,Mp))}}}})(ze,kt,vi,or,Gn);else{const ia=ze.context,oa=ia.gl;let pl,lh;const gh=ze.options.showTerrainWireframe?2:0,yh=(wh,Sh)=>{if(lh===wh)return;const Oh=[Y_[wh]];Sh&&Oh.push(Y_[gh]),pl=ze.useProgram("terrainRaster",null,Oh),lh=wh},_h=ze.colorModeForRenderPass(),xh=new s.DepthMode(oa.LEQUAL,s.DepthMode.ReadWrite,ze.depthRangeFor3D);X_.update(Gn);const _l=ze.transform,mh=p0(_l.zoom)*kt.exaggeration();(gh?[!1,!0]:[!1]).forEach(wh=>{lh=-1;const Sh=wh?oa.LINES:oa.TRIANGLES,[Oh,Uh]=wh?kt.getWirefameBuffer():[kt.gridIndexBuffer,kt.gridSegments];for(const Vh of or){const Wh=vi.getTile(Vh),Zh=s.StencilMode.disabled,id=kt.prevTerrainTileForTile[Vh.key],Bd=kt.terrainTileForTile[Vh.key];k_(id,Bd)&&X_.newMorphing(Vh.key,id,Bd,Gn,250),ia.activeTexture.set(oa.TEXTURE0),Wh.texture.bind(oa.LINEAR,oa.CLAMP_TO_EDGE,oa.LINEAR_MIPMAP_NEAREST);const ed=X_.getMorphValuesForProxy(Vh.key),Sd=ed?1:0;let dd;ed&&(dd={morphing:{srcDemTile:ed.from,dstDemTile:ed.to,phase:s.easeCubicInOut(ed.phase)}});const xd=Rv(Vh.projMatrix,Vx(Vh.canonical,_l.renderWorldCopies)?mh/10:mh);yh(Sd,wh),kt.setupElevationDraw(Wh,pl,dd),ze.prepareDrawProgram(ia,pl,Vh.toUnwrapped()),pl.draw(ia,Sh,xh,Zh,_h,s.CullFaceMode.backCCW,xd,"terrain_raster",kt.gridBuffer,Oh,Uh)}})}}(S,this,this.proxySourceCache,p,this._updateTimestamp),this.renderingToTexture=!0,S.gpuTimingDeferredRenderEnd(),p.splice(0,p.length))}renderBatch(p){if(this._drapedRenderBatches.length===0)return p+1;this.renderingToTexture=!0;const S=this.painter,X=this.painter.context,ze=this.proxySourceCache,kt=this.proxiedCoords[ze.id],vi=this._drapedRenderBatches.shift(),or=[],Gn=S.style.order;let ia=0;for(const oa of kt){const pl=ze.getTileByID(oa.proxyTileKey),lh=ze.proxyCachedFBO[oa.key]?ze.proxyCachedFBO[oa.key][p]:void 0,gh=lh!==void 0?ze.renderCache[lh]:this.pool[ia++],yh=lh!==void 0;if(pl.texture=gh.tex,yh&&!gh.dirty){or.push(pl.tileID);continue}let _h;X.bindFramebuffer.set(gh.fb.framebuffer),this.renderedToTile=!1,gh.dirty&&(X.clear({color:s.Color.transparent,stencil:0}),gh.dirty=!1);for(let xh=vi.start;xh<=vi.end;++xh){const _l=S.style._layers[Gn[xh]];if(_l.isHidden(S.transform.zoom))continue;const mh=S.style._getLayerSourceCache(_l),wh=mh?this.proxyToSource[oa.key][mh.id]:[oa];if(!wh)continue;const Sh=wh;X.viewport.set([0,0,gh.fb.width,gh.fb.height]),_h!==(mh?mh.id:null)&&(this._setupStencil(gh,wh,_l,mh),_h=mh?mh.id:null),S.renderLayer(S,mh,_l,Sh)}this.renderedToTile?(gh.dirty=!0,or.push(pl.tileID)):yh||--ia,ia===5&&(ia=0,this.renderToBackBuffer(or))}return this.renderToBackBuffer(or),this.renderingToTexture=!1,X.bindFramebuffer.set(null),X.viewport.set([0,0,S.width,S.height]),vi.end+1}postRender(){}renderCacheEfficiency(p){const S=p.order.length;if(S===0)return{efficiency:100};let X,ze=0,kt=0,vi=!1;for(let or=0;or<S;++or){const Gn=p._layers[p.order[or]];this._style.isLayerDraped(Gn)?(vi&&++ze,++kt):vi||(vi=!0,X=Gn.id)}return kt===0?{efficiency:100}:{efficiency:100*(1-ze/kt),firstUndrapedLayer:X}}getMinElevationBelowMSL(){let p=0;return this._visibleDemTiles.filter(S=>S.dem).forEach(S=>{p=Math.min(p,S.dem.tree.minimums[0])}),p===0?p:(p-30)*this._exaggeration}raycast(p,S,X){if(!this._visibleDemTiles)return null;const ze=this._visibleDemTiles.filter(kt=>kt.dem).map(kt=>{const vi=kt.tileID,or=1<<vi.overscaledZ,{x:Gn,y:ia}=vi.canonical,oa=Gn/or,pl=(Gn+1)/or,lh=ia/or,gh=(ia+1)/or;return{minx:oa,miny:lh,maxx:pl,maxy:gh,t:kt.dem.tree.raycastRoot(oa,lh,pl,gh,p,S,X),tile:kt}});ze.sort((kt,vi)=>(kt.t!==null?kt.t:Number.MAX_VALUE)-(vi.t!==null?vi.t:Number.MAX_VALUE));for(const kt of ze){if(kt.t==null)return null;const vi=kt.tile.dem.tree.raycast(kt.minx,kt.miny,kt.maxx,kt.maxy,p,S,X);if(vi!=null)return vi}return null}_createFBO(){const p=this.painter.context,S=p.gl,X=this.drapeBufferSize;p.activeTexture.set(S.TEXTURE0);const ze=new s.Texture(p,{width:X[0],height:X[1],data:null},S.RGBA);ze.bind(S.LINEAR,S.CLAMP_TO_EDGE);const kt=p.createFramebuffer(X[0],X[1],!1);return kt.colorAttachment.set(ze.texture),kt.depthAttachment=new Cr(p,kt.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=p.createRenderbuffer(p.gl.DEPTH_STENCIL,X[0],X[1]),this._stencilRef=0,kt.depthAttachment.set(this._sharedDepthStencil),p.clear({stencil:0})):kt.depthAttachment.set(this._sharedDepthStencil),p.extTextureFilterAnisotropic&&!p.extTextureFilterAnisotropicForceOff&&S.texParameterf(S.TEXTURE_2D,p.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,p.extTextureFilterAnisotropicMax),{fb:kt,tex:ze,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const p in this._style._sourceCaches)if(this._style._sourceCaches[p].hasTransition())return!0;return this._style.order.some(p=>{const S=this._style._layers[p],X=S.isHidden(this.painter.transform.zoom);return S.type==="custom"?!X&&S.shouldRedrape():!X&&S.hasTransition()})}_clearLineLayersFromRenderCache(){let p=!1;for(const X of this._style._getSources())if(X instanceof ih){p=!0;break}if(!p)return;const S={};for(let X=0;X<this._style.order.length;++X){const ze=this._style._layers[this._style.order[X]],kt=this._style._getLayerSourceCache(ze);if(kt&&!S[kt.id]&&!ze.isHidden(this.painter.transform.zoom)&&ze.type==="line"&&ze.widthExpression()instanceof s.ZoomDependentExpression){S[kt.id]=!0;for(const vi of this.proxyCoords){const or=this.proxyToSource[vi.key][kt.id];if(or)for(const Gn of or)this._clearRenderCacheForTile(kt.id,Gn)}}}}_clearRasterLayersFromRenderCache(){let p=!1;for(const X in this._style._sourceCaches)if(this._style._sourceCaches[X]._source instanceof ch){p=!0;break}if(!p)return;const S={};for(let X=0;X<this._style.order.length;++X){const ze=this._style._layers[this._style.order[X]],kt=this._style._getLayerSourceCache(ze);if(!kt||S[kt.id]||ze.isHidden(this.painter.transform.zoom)||ze.type!=="raster")continue;const vi=ze.paint.get("raster-fade-duration");for(const or of this.proxyCoords){const Gn=this.proxyToSource[or.key][kt.id];if(Gn)for(const ia of Gn){const oa=Iv(kt.getTile(ia),kt.findLoadedParent(ia,0),kt,this.painter.transform,vi);(oa.opacity!==1||oa.mix!==0)&&this._clearRenderCacheForTile(kt.id,ia)}}}}_setupDrapedRenderBatches(){const p=this._style.order,S=p.length;if(S===0)return;const X=[];let ze,kt=0,vi=this._style._layers[p[kt]];for(;!this._style.isLayerDraped(vi)&&vi.isHidden(this.painter.transform.zoom)&&++kt<S;)vi=this._style._layers[p[kt]];for(;kt<S;++kt){const or=this._style._layers[p[kt]];or.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(or)?ze===void 0&&(ze=kt):ze!==void 0&&(X.push({start:ze,end:kt-1}),ze=void 0))}ze!==void 0&&X.push({start:ze,end:kt-1}),this._drapedRenderBatches=X}_setupRenderCache(p){const S=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,S.renderCache.length>S.renderCachePool.length){const vi=Object.values(S.proxyCachedFBO);S.proxyCachedFBO={};for(let or=0;or<vi.length;++or){const Gn=Object.values(vi[or]);S.renderCachePool.push(...Gn)}}return}this._clearRasterLayersFromRenderCache();const X=this.proxyCoords,ze=this._tilesDirty;for(let vi=X.length-1;vi>=0;vi--){const or=X[vi];if(S.getTileByID(or.key),S.proxyCachedFBO[or.key]!==void 0){const Gn=p[or.key],ia=this.proxyToSource[or.key];let oa=0;for(const pl in ia){const lh=ia[pl],gh=Gn[pl];if(!gh||gh.length!==lh.length||lh.some((yh,_h)=>yh!==gh[_h]||ze[pl]&&ze[pl].hasOwnProperty(yh.key))){oa=-1;break}++oa}for(const pl in S.proxyCachedFBO[or.key])S.renderCache[S.proxyCachedFBO[or.key][pl]].dirty=oa<0||oa!==Object.values(Gn).length}}const kt=[...this._drapedRenderBatches];kt.sort((vi,or)=>or.end-or.start-(vi.end-vi.start));for(const vi of kt)for(const or of X){if(S.proxyCachedFBO[or.key])continue;let Gn=S.renderCachePool.pop();Gn===void 0&&S.renderCache.length<50&&(Gn=S.renderCache.length,S.renderCache.push(this._createFBO())),Gn!==void 0&&(S.proxyCachedFBO[or.key]={},S.proxyCachedFBO[or.key][vi.start]=Gn,S.renderCache[Gn].dirty=!0)}this._tilesDirty={}}_setupStencil(p,S,X,ze){if(!ze||!this._sourceTilesOverlap[ze.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const kt=this.painter.context,vi=kt.gl;if(S.length<=1)return void(this._overlapStencilType=!1);let or;if(X.isTileClipped())or=S.length,this._overlapStencilMode.test={func:vi.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(S[0].overscaledZ>S[S.length-1].overscaledZ))return void(this._overlapStencilType=!1);or=1,this._overlapStencilMode.test={func:vi.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+or>255&&(kt.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=or,this._overlapStencilMode.ref=this._stencilRef,X.isTileClipped()&&this._renderTileClippingMasks(S,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(p){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[p.key]),this._overlapStencilMode):s.StencilMode.disabled}_renderTileClippingMasks(p,S){const X=this.painter,ze=this.painter.context,kt=ze.gl;X._tileClippingMaskIDs={},ze.setColorMode(s.ColorMode.disabled),ze.setDepthMode(s.DepthMode.disabled);const vi=X.useProgram("clippingMask");for(const or of p){const Gn=X._tileClippingMaskIDs[or.key]=--S;vi.draw(ze,kt.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:kt.ALWAYS,mask:0},Gn,255,kt.KEEP,kt.KEEP,kt.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,jy(or.projMatrix),"$clipping",X.tileExtentBuffer,X.quadTriangleIndexBuffer,X.tileExtentSegments)}}pointCoordinate(p){const S=this.painter.transform;if(p.x<0||p.x>S.width||p.y<0||p.y>S.height)return null;const X=[p.x,p.y,1,1];s.transformMat4$1(X,X,S.pixelMatrixInverse),s.scale$1(X,X,1/X[3]),X[0]/=S.worldSize,X[1]/=S.worldSize;const ze=S._camera.position,kt=s.mercatorZfromAltitude(1,S.center.lat),vi=[ze[0],ze[1],ze[2]/kt,0],or=s.subtract([],X.slice(0,3),vi);s.normalize(or,or);const Gn=this.raycast(vi,or,this._exaggeration);return Gn!==null&&Gn?(s.scaleAndAdd(vi,vi,or,Gn),vi[3]=vi[2],vi[2]*=kt,vi):null}drawDepth(){const p=this.painter,S=p.context,X=this.proxySourceCache,ze=Math.ceil(p.width),kt=Math.ceil(p.height);if(!this._depthFBO||this._depthFBO.width===ze&&this._depthFBO.height===kt||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const vi=S.gl,or=S.createFramebuffer(ze,kt,!0);S.activeTexture.set(vi.TEXTURE0);const Gn=new s.Texture(S,{width:ze,height:kt,data:null},vi.RGBA);Gn.bind(vi.NEAREST,vi.CLAMP_TO_EDGE),or.colorAttachment.set(Gn.texture);const ia=S.createRenderbuffer(S.gl.DEPTH_COMPONENT16,ze,kt);or.depthAttachment.set(ia),this._depthFBO=or,this._depthTexture=Gn}S.bindFramebuffer.set(this._depthFBO.framebuffer),S.viewport.set([0,0,ze,kt]),function(vi,or,Gn,ia){if(vi.transform.projection.name==="globe")return;const oa=vi.context,pl=oa.gl;oa.clear({depth:1});const lh=vi.useProgram("terrainDepth"),gh=new s.DepthMode(pl.LESS,s.DepthMode.ReadWrite,vi.depthRangeFor3D);for(const yh of ia){const _h=Gn.getTile(yh),xh=Rv(yh.projMatrix,0);or.setupElevationDraw(_h,lh),lh.draw(oa,pl.TRIANGLES,gh,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.backCCW,xh,"terrain_depth",or.gridBuffer,or.gridIndexBuffer,or.gridNoSkirtSegments)}}(p,this,X,this.proxyCoords)}_setupProxiedCoordsForOrtho(p,S,X){if(p.getSource()instanceof Th)return this._setupProxiedCoordsForImageSource(p,S,X);this._findCoveringTileCache[p.id]=this._findCoveringTileCache[p.id]||{};const ze=this.proxiedCoords[p.id]=[],kt=this.proxyCoords;for(let or=0;or<kt.length;or++){const Gn=kt[or],ia=this._findTileCoveringTileID(Gn,p);if(ia){const oa=this._createProxiedId(Gn,ia,X[Gn.key]&&X[Gn.key][p.id]);ze.push(oa),this.proxyToSource[Gn.key][p.id]=[oa]}}let vi=!1;for(let or=0;or<S.length;or++){const Gn=p.getTile(S[or]);if(!Gn||!Gn.hasData())continue;const ia=this._findTileCoveringTileID(Gn.tileID,this.proxySourceCache);if(ia&&ia.tileID.canonical.z!==Gn.tileID.canonical.z){const oa=this.proxyToSource[ia.tileID.key][p.id],pl=this._createProxiedId(ia.tileID,Gn,X[ia.tileID.key]&&X[ia.tileID.key][p.id]);oa?oa.splice(oa.length-1,0,pl):this.proxyToSource[ia.tileID.key][p.id]=[pl],ze.push(pl),vi=!0}}this._sourceTilesOverlap[p.id]=vi}_setupProxiedCoordsForImageSource(p,S,X){if(!p.getSource().loaded())return;const ze=this.proxiedCoords[p.id]=[],kt=this.proxyCoords,vi=p.getSource(),or=new s.Point(vi.tileID.x,vi.tileID.y)._div(1<<vi.tileID.z),Gn=vi.coordinates.map(s.MercatorCoordinate.fromLngLat).reduce((oa,pl)=>(oa.min.x=Math.min(oa.min.x,pl.x-or.x),oa.min.y=Math.min(oa.min.y,pl.y-or.y),oa.max.x=Math.max(oa.max.x,pl.x-or.x),oa.max.y=Math.max(oa.max.y,pl.y-or.y),oa),{min:new s.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),ia=(oa,pl)=>{const lh=oa.wrap+oa.canonical.x/(1<<oa.canonical.z),gh=oa.canonical.y/(1<<oa.canonical.z),yh=s.EXTENT/(1<<oa.canonical.z),_h=pl.wrap+pl.canonical.x/(1<<pl.canonical.z),xh=pl.canonical.y/(1<<pl.canonical.z);return lh+yh<_h+Gn.min.x||lh>_h+Gn.max.x||gh+yh<xh+Gn.min.y||gh>xh+Gn.max.y};for(let oa=0;oa<kt.length;oa++){const pl=kt[oa];for(let lh=0;lh<S.length;lh++){const gh=p.getTile(S[lh]);if(!gh||!gh.hasData()||ia(pl,gh.tileID))continue;const yh=this._createProxiedId(pl,gh,X[pl.key]&&X[pl.key][p.id]),_h=this.proxyToSource[pl.key][p.id];_h?_h.push(yh):this.proxyToSource[pl.key][p.id]=[yh],ze.push(yh)}}}_createProxiedId(p,S,X){let ze=this.orthoMatrix;if(X){const kt=X.find(vi=>vi.key===S.tileID.key);if(kt)return kt}if(S.tileID.key!==p.key){const kt=p.canonical.z-S.tileID.canonical.z;let vi,or,Gn;ze=s.create();const ia=S.tileID.wrap-p.wrap<<p.overscaledZ;kt>0?(vi=s.EXTENT>>kt,or=vi*((S.tileID.canonical.x<<kt)-p.canonical.x+ia),Gn=vi*((S.tileID.canonical.y<<kt)-p.canonical.y)):(vi=s.EXTENT<<-kt,or=s.EXTENT*(S.tileID.canonical.x-(p.canonical.x+ia<<-kt)),Gn=s.EXTENT*(S.tileID.canonical.y-(p.canonical.y<<-kt))),s.ortho(ze,0,vi,0,vi,0,1),s.translate(ze,ze,[or,Gn,0])}return new ig(S.tileID,p.key,ze)}_findTileCoveringTileID(p,S){let X=S.getTile(p);if(X&&X.hasData())return X;const ze=this._findCoveringTileCache[S.id],kt=ze[p.key];if(X=kt?S.getTileByID(kt):null,X&&X.hasData()||kt===null)return X;let vi=X?X.tileID:p,or=vi.overscaledZ;const Gn=S.getSource().minzoom,ia=[];if(!kt){const pl=S.getSource().maxzoom;if(p.canonical.z>=pl){const lh=p.canonical.z-pl;S.getSource().reparseOverscaled?(or=Math.max(p.canonical.z+2,S.transform.tileZoom),vi=new s.OverscaledTileID(or,p.wrap,pl,p.canonical.x>>lh,p.canonical.y>>lh)):lh!==0&&(or=pl,vi=new s.OverscaledTileID(or,p.wrap,pl,p.canonical.x>>lh,p.canonical.y>>lh))}vi.key!==p.key&&(ia.push(vi.key),X=S.getTile(vi))}const oa=pl=>{ia.forEach(lh=>{ze[lh]=pl}),ia.length=0};for(or-=1;or>=Gn&&(!X||!X.hasData());or--){X&&oa(X.tileID.key);const pl=vi.calculateScaledKey(or);if(X=S.getTileByID(pl),X&&X.hasData())break;const lh=ze[pl];if(lh===null)break;lh===void 0?ia.push(pl):X=S.getTileByID(lh)}return oa(X?X.tileID.key:null),X&&X.hasData()?X:null}findDEMTileFor(p){return this.enabled?this._findTileCoveringTileID(p,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(p,S){let X=this._tilesDirty[p];X||(X=this._tilesDirty[p]={}),X[S.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const p=function(S){let X=0;const ze=new s.StructArrayLayout2ui4,kt=131;for(let vi=1;vi<129;vi++){for(let or=1;or<129;or++)X=vi*kt+or,ze.emplaceBack(X,X+1),ze.emplaceBack(X,X+kt),ze.emplaceBack(X+1,X+kt),vi===128&&ze.emplaceBack(X+kt,X+kt+1);ze.emplaceBack(X+1,X+1+kt)}return ze}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(p),this.wireframeSegments=s.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,p.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Hp{static cacheKey(p,S,X,ze){let kt=`${S}${ze?ze.cacheKey:""}`;for(const vi of X)p.usedDefines.includes(vi)&&(kt+=`/${vi}`);return kt}constructor(p,S,X,ze,kt,vi){const or=p.gl;this.program=or.createProgram();const Gn=function(_l){const mh=[];for(let wh=0;wh<_l.length;wh++){if(_l[wh]===null)continue;const Sh=_l[wh].split(" ");mh.push(Sh.pop())}return mh}(X.staticAttributes),ia=ze?ze.getBinderAttributes():[],oa=Gn.concat(ia);let pl=ze?ze.defines():[];pl=pl.concat(vi.map(_l=>`#define ${_l}`));const lh=p.isWebGL2?`#version 300 es
`:"",gh=lh+pl.concat(p.extStandardDerivatives&&lh.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(z0):z0,z0,c0,Hy.fragmentSource,py.fragmentSource,X.fragmentSource).join(`
`),yh=lh+pl.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,c0,Hy.vertexSource,py.vertexSource,Uy.vertexSource,X.vertexSource).join(`
`),_h=or.createShader(or.FRAGMENT_SHADER);if(or.isContextLost())return void(this.failedToCreate=!0);or.shaderSource(_h,gh),or.compileShader(_h),or.attachShader(this.program,_h);const xh=or.createShader(or.VERTEX_SHADER);if(or.isContextLost())this.failedToCreate=!0;else{or.shaderSource(xh,yh),or.compileShader(xh),or.attachShader(this.program,xh),this.attributes={},this.numAttributes=oa.length;for(let _l=0;_l<this.numAttributes;_l++)oa[_l]&&(or.bindAttribLocation(this.program,_l,oa[_l]),this.attributes[oa[_l]]=_l);or.linkProgram(this.program),or.deleteShader(xh),or.deleteShader(_h),this.fixedUniforms=kt(p),this.binderUniforms=ze?ze.getUniforms(p):[],vi.includes("TERRAIN")&&(this.terrainUniforms=(_l=>({u_dem:new s.Uniform1i(_l),u_dem_prev:new s.Uniform1i(_l),u_dem_unpack:new s.Uniform4f(_l),u_dem_tl:new s.Uniform2f(_l),u_dem_scale:new s.Uniform1f(_l),u_dem_tl_prev:new s.Uniform2f(_l),u_dem_scale_prev:new s.Uniform1f(_l),u_dem_size:new s.Uniform1f(_l),u_dem_lerp:new s.Uniform1f(_l),u_exaggeration:new s.Uniform1f(_l),u_depth:new s.Uniform1i(_l),u_depth_size_inv:new s.Uniform2f(_l),u_meter_to_dem:new s.Uniform1f(_l),u_label_plane_matrix_inv:new s.UniformMatrix4f(_l)}))(p)),vi.includes("GLOBE")&&(this.globeUniforms=(_l=>({u_tile_tl_up:new s.Uniform3f(_l),u_tile_tr_up:new s.Uniform3f(_l),u_tile_br_up:new s.Uniform3f(_l),u_tile_bl_up:new s.Uniform3f(_l),u_tile_up_scale:new s.Uniform1f(_l)}))(p)),vi.includes("FOG")&&(this.fogUniforms=(_l=>({u_fog_matrix:new s.UniformMatrix4f(_l),u_fog_range:new s.Uniform2f(_l),u_fog_color:new s.Uniform4f(_l),u_fog_horizon_blend:new s.Uniform1f(_l),u_fog_temporal_offset:new s.Uniform1f(_l),u_frustum_tl:new s.Uniform3f(_l),u_frustum_tr:new s.Uniform3f(_l),u_frustum_br:new s.Uniform3f(_l),u_frustum_bl:new s.Uniform3f(_l),u_globe_pos:new s.Uniform3f(_l),u_globe_radius:new s.Uniform1f(_l),u_globe_transition:new s.Uniform1f(_l),u_is_globe:new s.Uniform1i(_l),u_viewport:new s.Uniform2f(_l)}))(p))}}setTerrainUniformValues(p,S){if(!this.terrainUniforms)return;const X=this.terrainUniforms;if(!this.failedToCreate){p.program.set(this.program);for(const ze in S)X[ze]&&X[ze].set(this.program,ze,S[ze])}}setGlobeUniformValues(p,S){if(!this.globeUniforms)return;const X=this.globeUniforms;if(!this.failedToCreate){p.program.set(this.program);for(const ze in S)X[ze]&&X[ze].set(this.program,ze,S[ze])}}setFogUniformValues(p,S){if(!this.fogUniforms)return;const X=this.fogUniforms;if(!this.failedToCreate){p.program.set(this.program);for(const ze in S)X[ze].set(this.program,ze,S[ze])}}draw(p,S,X,ze,kt,vi,or,Gn,ia,oa,pl,lh,gh,yh,_h){const xh=p.gl;if(this.failedToCreate)return;p.program.set(this.program),p.setDepthMode(X),p.setStencilMode(ze),p.setColorMode(kt),p.setCullFace(vi);for(const mh of Object.keys(this.fixedUniforms))this.fixedUniforms[mh].set(this.program,mh,or[mh]);yh&&yh.setUniforms(this.program,p,this.binderUniforms,lh,{zoom:gh});const _l={[xh.LINES]:2,[xh.TRIANGLES]:3,[xh.LINE_STRIP]:1}[S];for(const mh of pl.get()){const wh=mh.vaos||(mh.vaos={});(wh[Gn]||(wh[Gn]=new Tv)).bind(p,this,ia,yh?yh.getPaintVertexBuffers():[],oa,mh.vertexOffset,_h||[]),xh.drawElements(S,mh.primitiveLength*_l,xh.UNSIGNED_SHORT,mh.primitiveOffset*_l*2)}}}function yg(L,p){const S=Math.pow(2,p.tileID.overscaledZ),X=p.tileSize*Math.pow(2,L.transform.tileZoom)/S,ze=X*(p.tileID.canonical.x+p.tileID.wrap*S),kt=X*p.tileID.canonical.y;return{u_image:0,u_texsize:p.imageAtlasTexture.size,u_tile_units_to_pixels:1/Ud(p,1,L.transform.tileZoom),u_pixel_coord_upper:[ze>>16,kt>>16],u_pixel_coord_lower:[65535&ze,65535&kt]}}const Wy=s.create(),V0=(L,p,S,X,ze,kt,vi,or,Gn,ia,oa)=>{const pl=p.style.light,lh=pl.properties.get("position"),gh=[lh.x,lh.y,lh.z],yh=s.create$1();pl.properties.get("anchor")==="viewport"&&(s.fromRotation(yh,-p.transform.angle),s.transformMat3(gh,gh,yh));const _h=pl.properties.get("color"),xh=p.transform,_l={u_matrix:L,u_lightpos:gh,u_lightintensity:pl.properties.get("intensity"),u_lightcolor:[_h.r,_h.g,_h.b],u_vertical_gradient:+S,u_opacity:X,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Wy,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:ze,u_edge_radius:kt};return xh.projection.name==="globe"&&(_l.u_tile_id=[vi.canonical.x,vi.canonical.y,1<<vi.canonical.z],_l.u_zoom_transition=Gn,_l.u_inv_rot_matrix=oa,_l.u_merc_center=ia,_l.u_up_dir=xh.projection.upVector(new s.CanonicalTileID(0,0,0),ia[0]*s.EXTENT,ia[1]*s.EXTENT),_l.u_height_lift=or),_l},U0=(L,p,S,X,ze,kt,vi,or,Gn,ia,oa,pl)=>{const lh=V0(L,p,S,X,ze,kt,vi,Gn,ia,oa,pl),gh={u_height_factor:-Math.pow(2,vi.overscaledZ)/or.tileSize/8};return s.extend(lh,yg(p,or),gh)},qy=L=>({u_matrix:L}),$0=(L,p,S)=>s.extend(qy(L),yg(p,S)),H0=(L,p)=>({u_matrix:L,u_world:p}),j0=(L,p,S,X)=>s.extend($0(L,p,S),{u_world:X}),bx=s.create(),f0=(L,p,S,X,ze,kt)=>{const vi=L.transform,or=vi.projection.name==="globe";let Gn;if(kt.paint.get("circle-pitch-alignment")==="map")if(or){const oa=s.globePixelsToTileUnits(vi.zoom,p.canonical)*vi._pixelsPerMercatorPixel;Gn=Float32Array.from([oa,0,0,oa])}else Gn=vi.calculatePixelsToTileUnitsMatrix(S);else Gn=new Float32Array([vi.pixelsToGLUnits[0],0,0,vi.pixelsToGLUnits[1]]);const ia={u_camera_to_center_distance:vi.cameraToCenterDistance,u_matrix:L.translatePosMatrix(p.projMatrix,S,kt.paint.get("circle-translate"),kt.paint.get("circle-translate-anchor")),u_device_pixel_ratio:s.exported.devicePixelRatio,u_extrude_scale:Gn,u_inv_rot_matrix:bx,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(or){ia.u_inv_rot_matrix=X,ia.u_merc_center=ze,ia.u_tile_id=[p.canonical.x,p.canonical.y,1<<p.canonical.z],ia.u_zoom_transition=s.globeToMercatorTransition(vi.zoom);const oa=ze[0]*s.EXTENT,pl=ze[1]*s.EXTENT;ia.u_up_dir=vi.projection.upVector(new s.CanonicalTileID(0,0,0),oa,pl)}return ia},Ky=L=>{const p=[];return L.paint.get("circle-pitch-alignment")==="map"&&p.push("PITCH_WITH_MAP"),L.paint.get("circle-pitch-scale")==="map"&&p.push("SCALE_WITH_MAP"),p},Zy=(L,p,S,X)=>{const ze=s.EXTENT/S.tileSize;return{u_matrix:L,u_camera_to_center_distance:p.getCameraToCenterDistance(X),u_extrude_scale:[p.pixelsToGLUnits[0]/ze,p.pixelsToGLUnits[1]/ze]}},W0=(L,p,S=1)=>({u_matrix:L,u_color:p,u_overlay:0,u_overlay_scale:S}),Cx=s.create(),Yg=(L,p,S,X,ze,kt,vi)=>{const or=L.transform,Gn=or.projection.name==="globe",ia=Gn?s.globePixelsToTileUnits(or.zoom,p.canonical)*or._pixelsPerMercatorPixel:Ud(S,1,kt),oa={u_matrix:p.projMatrix,u_extrude_scale:ia,u_intensity:vi,u_inv_rot_matrix:Cx,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(Gn){oa.u_inv_rot_matrix=X,oa.u_merc_center=ze,oa.u_tile_id=[p.canonical.x,p.canonical.y,1<<p.canonical.z],oa.u_zoom_transition=s.globeToMercatorTransition(or.zoom);const pl=ze[0]*s.EXTENT,lh=ze[1]*s.EXTENT;oa.u_up_dir=or.projection.upVector(new s.CanonicalTileID(0,0,0),pl,lh)}return oa},Xy=(L,p,S,X,ze,kt,vi)=>{const or=L.transform,Gn=or.calculatePixelsToTileUnitsMatrix(p);return{u_matrix:g0(L,p,S,X),u_pixels_to_tile_units:Gn,u_device_pixel_ratio:kt,u_units_to_pixels:[1/or.pixelsToGLUnits[0],1/or.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:ze,u_texsize:Dv(S)?p.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Yy(p,L.transform),u_alpha_discard_threshold:0,u_trim_offset:vi}},Nm=(L,p,S,X,ze)=>{const kt=L.transform;return{u_matrix:g0(L,p,S,X),u_texsize:p.imageAtlasTexture.size,u_pixels_to_tile_units:kt.calculatePixelsToTileUnitsMatrix(p),u_device_pixel_ratio:ze,u_image:0,u_tile_units_to_pixels:Yy(p,kt),u_units_to_pixels:[1/kt.pixelsToGLUnits[0],1/kt.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Yy(L,p){return 1/Ud(L,1,p.tileZoom)}function g0(L,p,S,X){return L.translatePosMatrix(X||p.tileID.projMatrix,p,S.paint.get("line-translate"),S.paint.get("line-translate-anchor"))}function Dv(L){const p=L.paint.get("line-dasharray").value;return p.value||p.kind!=="constant"}const J_=(L,p,S,X,ze,kt)=>{return{u_matrix:L,u_tl_parent:p,u_scale_parent:S,u_fade_t:X.mix,u_opacity:X.opacity*ze.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:ze.paint.get("raster-brightness-min"),u_brightness_high:ze.paint.get("raster-brightness-max"),u_saturation_factor:(or=ze.paint.get("raster-saturation"),or>0?1-1/(1.001-or):-or),u_contrast_factor:(vi=ze.paint.get("raster-contrast"),vi>0?1/(1-vi):1+vi),u_spin_weights:Zm(ze.paint.get("raster-hue-rotate")),u_perspective_transform:kt};var vi,or};function Zm(L){L*=Math.PI/180;const p=Math.sin(L),S=Math.cos(L);return[(2*S+1)/3,(-Math.sqrt(3)*p-S+1)/3,(Math.sqrt(3)*p-S+1)/3]}const Q_=s.create(),q0=(L,p,S,X,ze,kt,vi,or,Gn,ia,oa,pl,lh,gh,yh,_h)=>{const xh=ze.transform,_l={u_is_size_zoom_constant:+(L==="constant"||L==="source"),u_is_size_feature_constant:+(L==="constant"||L==="camera"),u_size_t:p?p.uSizeT:0,u_size:p?p.uSize:0,u_camera_to_center_distance:xh.cameraToCenterDistance,u_rotate_symbol:+S,u_aspect_ratio:xh.width/xh.height,u_fade_change:ze.options.fadeDuration?ze.symbolFadeChange:1,u_matrix:kt,u_label_plane_matrix:vi,u_coord_matrix:or,u_is_text:+Gn,u_pitch_with_map:+X,u_texsize:ia,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Q_,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Q_,u_up_vector:[0,-1,0]};return _h.name==="globe"&&(_l.u_tile_id=[oa.canonical.x,oa.canonical.y,1<<oa.canonical.z],_l.u_zoom_transition=pl,_l.u_inv_rot_matrix=gh,_l.u_merc_center=lh,_l.u_camera_forward=xh._camera.forward(),_l.u_ecef_origin=s.globeECEFOrigin(xh.globeMatrix,oa.toUnwrapped()),_l.u_tile_matrix=Float32Array.from(xh.globeMatrix),_l.u_up_vector=yh),_l},Lv=(L,p,S,X,ze,kt,vi,or,Gn,ia,oa,pl,lh,gh,yh,_h,xh)=>s.extend(q0(L,p,S,X,ze,kt,vi,or,Gn,ia,pl,lh,gh,yh,_h,xh),{u_gamma_scale:X?ze.transform.cameraToCenterDistance*Math.cos(ze.terrain?0:ze.transform._pitch):1,u_device_pixel_ratio:s.exported.devicePixelRatio,u_is_halo:+oa}),K0=(L,p,S,X,ze,kt,vi,or,Gn,ia,oa,pl,lh,gh,yh,_h)=>s.extend(Lv(L,p,S,X,ze,kt,vi,or,!0,Gn,!0,oa,pl,lh,gh,yh,_h),{u_texsize_icon:ia,u_texture_icon:1}),Z0=(L,p,S)=>({u_matrix:L,u_opacity:p,u_color:S}),X0=(L,p,S,X,ze)=>s.extend(function(kt,vi,or){const Gn=vi.imageManager.getPattern(kt.toString()),{width:ia,height:oa}=vi.imageManager.getPixelSize(),pl=Math.pow(2,or.tileID.overscaledZ),lh=or.tileSize*Math.pow(2,vi.transform.tileZoom)/pl,gh=lh*(or.tileID.canonical.x+or.tileID.wrap*pl),yh=lh*or.tileID.canonical.y;return{u_image:0,u_pattern_tl:Gn.tl,u_pattern_br:Gn.br,u_texsize:[ia,oa],u_pattern_size:Gn.displaySize,u_tile_units_to_pixels:1/Ud(or,1,vi.transform.tileZoom),u_pixel_coord_upper:[gh>>16,yh>>16],u_pixel_coord_lower:[65535&gh,65535&yh]}}(X,S,ze),{u_matrix:L,u_opacity:p}),v_={fillExtrusion:L=>({u_matrix:new s.UniformMatrix4f(L),u_lightpos:new s.Uniform3f(L),u_lightintensity:new s.Uniform1f(L),u_lightcolor:new s.Uniform3f(L),u_vertical_gradient:new s.Uniform1f(L),u_opacity:new s.Uniform1f(L),u_edge_radius:new s.Uniform1f(L),u_ao:new s.Uniform2f(L),u_tile_id:new s.Uniform3f(L),u_zoom_transition:new s.Uniform1f(L),u_inv_rot_matrix:new s.UniformMatrix4f(L),u_merc_center:new s.Uniform2f(L),u_up_dir:new s.Uniform3f(L),u_height_lift:new s.Uniform1f(L)}),fillExtrusionPattern:L=>({u_matrix:new s.UniformMatrix4f(L),u_lightpos:new s.Uniform3f(L),u_lightintensity:new s.Uniform1f(L),u_lightcolor:new s.Uniform3f(L),u_vertical_gradient:new s.Uniform1f(L),u_height_factor:new s.Uniform1f(L),u_edge_radius:new s.Uniform1f(L),u_ao:new s.Uniform2f(L),u_tile_id:new s.Uniform3f(L),u_zoom_transition:new s.Uniform1f(L),u_inv_rot_matrix:new s.UniformMatrix4f(L),u_merc_center:new s.Uniform2f(L),u_up_dir:new s.Uniform3f(L),u_height_lift:new s.Uniform1f(L),u_image:new s.Uniform1i(L),u_texsize:new s.Uniform2f(L),u_pixel_coord_upper:new s.Uniform2f(L),u_pixel_coord_lower:new s.Uniform2f(L),u_tile_units_to_pixels:new s.Uniform1f(L),u_opacity:new s.Uniform1f(L)}),fill:L=>({u_matrix:new s.UniformMatrix4f(L)}),fillPattern:L=>({u_matrix:new s.UniformMatrix4f(L),u_image:new s.Uniform1i(L),u_texsize:new s.Uniform2f(L),u_pixel_coord_upper:new s.Uniform2f(L),u_pixel_coord_lower:new s.Uniform2f(L),u_tile_units_to_pixels:new s.Uniform1f(L)}),fillOutline:L=>({u_matrix:new s.UniformMatrix4f(L),u_world:new s.Uniform2f(L)}),fillOutlinePattern:L=>({u_matrix:new s.UniformMatrix4f(L),u_world:new s.Uniform2f(L),u_image:new s.Uniform1i(L),u_texsize:new s.Uniform2f(L),u_pixel_coord_upper:new s.Uniform2f(L),u_pixel_coord_lower:new s.Uniform2f(L),u_tile_units_to_pixels:new s.Uniform1f(L)}),circle:L=>({u_camera_to_center_distance:new s.Uniform1f(L),u_extrude_scale:new s.UniformMatrix2f(L),u_device_pixel_ratio:new s.Uniform1f(L),u_matrix:new s.UniformMatrix4f(L),u_inv_rot_matrix:new s.UniformMatrix4f(L),u_merc_center:new s.Uniform2f(L),u_tile_id:new s.Uniform3f(L),u_zoom_transition:new s.Uniform1f(L),u_up_dir:new s.Uniform3f(L)}),collisionBox:L=>({u_matrix:new s.UniformMatrix4f(L),u_camera_to_center_distance:new s.Uniform1f(L),u_extrude_scale:new s.Uniform2f(L)}),collisionCircle:L=>({u_matrix:new s.UniformMatrix4f(L),u_inv_matrix:new s.UniformMatrix4f(L),u_camera_to_center_distance:new s.Uniform1f(L),u_viewport_size:new s.Uniform2f(L)}),debug:L=>({u_color:new s.UniformColor(L),u_matrix:new s.UniformMatrix4f(L),u_overlay:new s.Uniform1i(L),u_overlay_scale:new s.Uniform1f(L)}),clippingMask:L=>({u_matrix:new s.UniformMatrix4f(L)}),heatmap:L=>({u_extrude_scale:new s.Uniform1f(L),u_intensity:new s.Uniform1f(L),u_matrix:new s.UniformMatrix4f(L),u_inv_rot_matrix:new s.UniformMatrix4f(L),u_merc_center:new s.Uniform2f(L),u_tile_id:new s.Uniform3f(L),u_zoom_transition:new s.Uniform1f(L),u_up_dir:new s.Uniform3f(L)}),heatmapTexture:L=>({u_image:new s.Uniform1i(L),u_color_ramp:new s.Uniform1i(L),u_opacity:new s.Uniform1f(L)}),hillshade:L=>({u_matrix:new s.UniformMatrix4f(L),u_image:new s.Uniform1i(L),u_latrange:new s.Uniform2f(L),u_light:new s.Uniform2f(L),u_shadow:new s.UniformColor(L),u_highlight:new s.UniformColor(L),u_accent:new s.UniformColor(L)}),hillshadePrepare:L=>({u_matrix:new s.UniformMatrix4f(L),u_image:new s.Uniform1i(L),u_dimension:new s.Uniform2f(L),u_zoom:new s.Uniform1f(L),u_unpack:new s.Uniform4f(L)}),line:L=>({u_matrix:new s.UniformMatrix4f(L),u_pixels_to_tile_units:new s.UniformMatrix2f(L),u_device_pixel_ratio:new s.Uniform1f(L),u_units_to_pixels:new s.Uniform2f(L),u_dash_image:new s.Uniform1i(L),u_gradient_image:new s.Uniform1i(L),u_image_height:new s.Uniform1f(L),u_texsize:new s.Uniform2f(L),u_tile_units_to_pixels:new s.Uniform1f(L),u_alpha_discard_threshold:new s.Uniform1f(L),u_trim_offset:new s.Uniform2f(L)}),linePattern:L=>({u_matrix:new s.UniformMatrix4f(L),u_texsize:new s.Uniform2f(L),u_pixels_to_tile_units:new s.UniformMatrix2f(L),u_device_pixel_ratio:new s.Uniform1f(L),u_image:new s.Uniform1i(L),u_units_to_pixels:new s.Uniform2f(L),u_tile_units_to_pixels:new s.Uniform1f(L),u_alpha_discard_threshold:new s.Uniform1f(L)}),raster:L=>({u_matrix:new s.UniformMatrix4f(L),u_tl_parent:new s.Uniform2f(L),u_scale_parent:new s.Uniform1f(L),u_fade_t:new s.Uniform1f(L),u_opacity:new s.Uniform1f(L),u_image0:new s.Uniform1i(L),u_image1:new s.Uniform1i(L),u_brightness_low:new s.Uniform1f(L),u_brightness_high:new s.Uniform1f(L),u_saturation_factor:new s.Uniform1f(L),u_contrast_factor:new s.Uniform1f(L),u_spin_weights:new s.Uniform3f(L),u_perspective_transform:new s.Uniform2f(L)}),symbolIcon:L=>({u_is_size_zoom_constant:new s.Uniform1i(L),u_is_size_feature_constant:new s.Uniform1i(L),u_size_t:new s.Uniform1f(L),u_size:new s.Uniform1f(L),u_camera_to_center_distance:new s.Uniform1f(L),u_rotate_symbol:new s.Uniform1i(L),u_aspect_ratio:new s.Uniform1f(L),u_fade_change:new s.Uniform1f(L),u_matrix:new s.UniformMatrix4f(L),u_label_plane_matrix:new s.UniformMatrix4f(L),u_coord_matrix:new s.UniformMatrix4f(L),u_is_text:new s.Uniform1i(L),u_pitch_with_map:new s.Uniform1i(L),u_texsize:new s.Uniform2f(L),u_tile_id:new s.Uniform3f(L),u_zoom_transition:new s.Uniform1f(L),u_inv_rot_matrix:new s.UniformMatrix4f(L),u_merc_center:new s.Uniform2f(L),u_camera_forward:new s.Uniform3f(L),u_tile_matrix:new s.UniformMatrix4f(L),u_up_vector:new s.Uniform3f(L),u_ecef_origin:new s.Uniform3f(L),u_texture:new s.Uniform1i(L)}),symbolSDF:L=>({u_is_size_zoom_constant:new s.Uniform1i(L),u_is_size_feature_constant:new s.Uniform1i(L),u_size_t:new s.Uniform1f(L),u_size:new s.Uniform1f(L),u_camera_to_center_distance:new s.Uniform1f(L),u_rotate_symbol:new s.Uniform1i(L),u_aspect_ratio:new s.Uniform1f(L),u_fade_change:new s.Uniform1f(L),u_matrix:new s.UniformMatrix4f(L),u_label_plane_matrix:new s.UniformMatrix4f(L),u_coord_matrix:new s.UniformMatrix4f(L),u_is_text:new s.Uniform1i(L),u_pitch_with_map:new s.Uniform1i(L),u_texsize:new s.Uniform2f(L),u_texture:new s.Uniform1i(L),u_gamma_scale:new s.Uniform1f(L),u_device_pixel_ratio:new s.Uniform1f(L),u_tile_id:new s.Uniform3f(L),u_zoom_transition:new s.Uniform1f(L),u_inv_rot_matrix:new s.UniformMatrix4f(L),u_merc_center:new s.Uniform2f(L),u_camera_forward:new s.Uniform3f(L),u_tile_matrix:new s.UniformMatrix4f(L),u_up_vector:new s.Uniform3f(L),u_ecef_origin:new s.Uniform3f(L),u_is_halo:new s.Uniform1i(L)}),symbolTextAndIcon:L=>({u_is_size_zoom_constant:new s.Uniform1i(L),u_is_size_feature_constant:new s.Uniform1i(L),u_size_t:new s.Uniform1f(L),u_size:new s.Uniform1f(L),u_camera_to_center_distance:new s.Uniform1f(L),u_rotate_symbol:new s.Uniform1i(L),u_aspect_ratio:new s.Uniform1f(L),u_fade_change:new s.Uniform1f(L),u_matrix:new s.UniformMatrix4f(L),u_label_plane_matrix:new s.UniformMatrix4f(L),u_coord_matrix:new s.UniformMatrix4f(L),u_is_text:new s.Uniform1i(L),u_pitch_with_map:new s.Uniform1i(L),u_texsize:new s.Uniform2f(L),u_texsize_icon:new s.Uniform2f(L),u_texture:new s.Uniform1i(L),u_texture_icon:new s.Uniform1i(L),u_gamma_scale:new s.Uniform1f(L),u_device_pixel_ratio:new s.Uniform1f(L),u_is_halo:new s.Uniform1i(L)}),background:L=>({u_matrix:new s.UniformMatrix4f(L),u_opacity:new s.Uniform1f(L),u_color:new s.UniformColor(L)}),backgroundPattern:L=>({u_matrix:new s.UniformMatrix4f(L),u_opacity:new s.Uniform1f(L),u_image:new s.Uniform1i(L),u_pattern_tl:new s.Uniform2f(L),u_pattern_br:new s.Uniform2f(L),u_texsize:new s.Uniform2f(L),u_pattern_size:new s.Uniform2f(L),u_pixel_coord_upper:new s.Uniform2f(L),u_pixel_coord_lower:new s.Uniform2f(L),u_tile_units_to_pixels:new s.Uniform1f(L)}),terrainRaster:Av,terrainDepth:Av,skybox:L=>({u_matrix:new s.UniformMatrix4f(L),u_sun_direction:new s.Uniform3f(L),u_cubemap:new s.Uniform1i(L),u_opacity:new s.Uniform1f(L),u_temporal_offset:new s.Uniform1f(L)}),skyboxGradient:L=>({u_matrix:new s.UniformMatrix4f(L),u_color_ramp:new s.Uniform1i(L),u_center_direction:new s.Uniform3f(L),u_radius:new s.Uniform1f(L),u_opacity:new s.Uniform1f(L),u_temporal_offset:new s.Uniform1f(L)}),skyboxCapture:L=>({u_matrix_3f:new s.UniformMatrix3f(L),u_sun_direction:new s.Uniform3f(L),u_sun_intensity:new s.Uniform1f(L),u_color_tint_r:new s.Uniform4f(L),u_color_tint_m:new s.Uniform4f(L),u_luminance:new s.Uniform1f(L)}),globeRaster:L=>({u_proj_matrix:new s.UniformMatrix4f(L),u_globe_matrix:new s.UniformMatrix4f(L),u_normalize_matrix:new s.UniformMatrix4f(L),u_merc_matrix:new s.UniformMatrix4f(L),u_zoom_transition:new s.Uniform1f(L),u_merc_center:new s.Uniform2f(L),u_image0:new s.Uniform1i(L),u_grid_matrix:new s.UniformMatrix3f(L),u_skirt_height:new s.Uniform1f(L),u_frustum_tl:new s.Uniform3f(L),u_frustum_tr:new s.Uniform3f(L),u_frustum_br:new s.Uniform3f(L),u_frustum_bl:new s.Uniform3f(L),u_globe_pos:new s.Uniform3f(L),u_globe_radius:new s.Uniform1f(L),u_viewport:new s.Uniform2f(L)}),globeAtmosphere:L=>({u_frustum_tl:new s.Uniform3f(L),u_frustum_tr:new s.Uniform3f(L),u_frustum_br:new s.Uniform3f(L),u_frustum_bl:new s.Uniform3f(L),u_horizon:new s.Uniform1f(L),u_transition:new s.Uniform1f(L),u_fadeout_range:new s.Uniform1f(L),u_color:new s.Uniform4f(L),u_high_color:new s.Uniform4f(L),u_space_color:new s.Uniform4f(L),u_star_intensity:new s.Uniform1f(L),u_star_density:new s.Uniform1f(L),u_star_size:new s.Uniform1f(L),u_temporal_offset:new s.Uniform1f(L),u_horizon_angle:new s.Uniform1f(L),u_rotation_matrix:new s.UniformMatrix4f(L)})};let Jy;function gy(L,p,S,X,ze,kt,vi){const or=L.context,Gn=or.gl,ia=L.transform,oa=L.useProgram("collisionBox"),pl=[];let lh=0,gh=0;for(let Sh=0;Sh<X.length;Sh++){const Oh=X[Sh],Uh=p.getTile(Oh),Vh=Uh.getBucket(S);if(!Vh)continue;const Wh=a_(Oh,Vh,ia);let Zh=Wh;ze[0]===0&&ze[1]===0||(Zh=L.translatePosMatrix(Wh,Uh,ze,kt));const id=vi?Vh.textCollisionBox:Vh.iconCollisionBox,Bd=Vh.collisionCircleArray;if(Bd.length>0){const ed=s.create(),Sd=Zh;s.mul(ed,Vh.placementInvProjMatrix,ia.glCoordMatrix),s.mul(ed,ed,Vh.placementViewportMatrix),pl.push({circleArray:Bd,circleOffset:gh,transform:Sd,invTransform:ed,projection:Vh.getProjection()}),lh+=Bd.length/4,gh=lh}id&&(L.terrain&&L.terrain.setupElevationDraw(Uh,oa),oa.draw(or,Gn.LINES,s.DepthMode.disabled,s.StencilMode.disabled,L.colorModeForRenderPass(),s.CullFaceMode.disabled,Zy(Zh,ia,Uh,Vh.getProjection()),S.id,id.layoutVertexBuffer,id.indexBuffer,id.segments,null,ia.zoom,null,[id.collisionVertexBuffer,id.collisionVertexBufferExt]))}if(!vi||!pl.length)return;const yh=L.useProgram("collisionCircle"),_h=new s.StructArrayLayout2f1f2i16;_h.resize(4*lh),_h._trim();let xh=0;for(const Sh of pl)for(let Oh=0;Oh<Sh.circleArray.length/4;Oh++){const Uh=4*Oh,Vh=Sh.circleArray[Uh+0],Wh=Sh.circleArray[Uh+1],Zh=Sh.circleArray[Uh+2],id=Sh.circleArray[Uh+3];_h.emplace(xh++,Vh,Wh,Zh,id,0),_h.emplace(xh++,Vh,Wh,Zh,id,1),_h.emplace(xh++,Vh,Wh,Zh,id,2),_h.emplace(xh++,Vh,Wh,Zh,id,3)}(!Jy||Jy.length<2*lh)&&(Jy=function(Sh){const Oh=2*Sh,Uh=new s.StructArrayLayout3ui6;Uh.resize(Oh),Uh._trim();for(let Vh=0;Vh<Oh;Vh++){const Wh=6*Vh;Uh.uint16[Wh+0]=4*Vh+0,Uh.uint16[Wh+1]=4*Vh+1,Uh.uint16[Wh+2]=4*Vh+2,Uh.uint16[Wh+3]=4*Vh+2,Uh.uint16[Wh+4]=4*Vh+3,Uh.uint16[Wh+5]=4*Vh+0}return Uh}(lh));const _l=or.createIndexBuffer(Jy,!0),mh=or.createVertexBuffer(_h,s.collisionCircleLayout.members,!0);for(const Sh of pl){const Oh={u_matrix:Sh.transform,u_inv_matrix:Sh.invTransform,u_camera_to_center_distance:(wh=ia).getCameraToCenterDistance(Sh.projection),u_viewport_size:[wh.width,wh.height]};yh.draw(or,Gn.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,L.colorModeForRenderPass(),s.CullFaceMode.disabled,Oh,S.id,mh,_l,s.SegmentVector.simpleSegment(0,2*Sh.circleOffset,Sh.circleArray.length,Sh.circleArray.length/2),null,ia.zoom)}var wh;mh.destroy(),_l.destroy()}const Ex=s.create();function Qy({width:L,height:p,anchor:S,textOffset:X,textScale:ze},kt){const{horizontalAlign:vi,verticalAlign:or}=s.getAnchorAlignment(S),Gn=-(vi-.5)*L,ia=-(or-.5)*p,oa=s.evaluateVariableOffset(S,X);return new s.Point((Gn/ze+oa[0])*kt,(ia/ze+oa[1])*kt)}function Ux(L,p,S,X,ze,kt,vi,or,Gn,ia,oa){const pl=L.text.placedSymbolArray,lh=L.text.dynamicLayoutVertexArray,gh=L.icon.dynamicLayoutVertexArray,yh={},_h=L.getProjection(),xh=Lg(or,_h,kt),_l=kt.elevation,mh=_h.upVectorScale(or.canonical,kt.center.lat,kt.worldSize).metersToTile;lh.clear();for(let wh=0;wh<pl.length;wh++){const Sh=pl.get(wh),{tileAnchorX:Oh,tileAnchorY:Uh,numGlyphs:Vh}=Sh,Wh=Sh.hidden||!Sh.crossTileID||L.allowVerticalPlacement&&!Sh.placedOrientation?null:X[Sh.crossTileID];if(Wh){let Zh=0,id=0,Bd=0;if(_l){const $d=_l?_l.getAtTileOffset(or,Oh,Uh):0,[Gp,Hf,Mp]=_h.upVector(or.canonical,Oh,Uh);Zh=$d*Gp*mh,id=$d*Hf*mh,Bd=$d*Mp*mh}let[ed,Sd,dd,xd]=hm(Sh.projectedAnchorX+Zh,Sh.projectedAnchorY+id,Sh.projectedAnchorZ+Bd,S?xh:vi);const nd=xm(kt.getCameraToCenterDistance(_h),xd);let vd=ze.evaluateSizeForFeature(L.textSizeData,ia,Sh)*nd/s.ONE_EM;S&&(vd*=L.tilePixelRatio/Gn);const Od=Qy(Wh,vd);S?({x:ed,y:Sd,z:dd}=_h.projectTilePoint(Oh+Od.x,Uh+Od.y,or.canonical),[ed,Sd,dd]=hm(ed+Zh,Sd+id,dd+Bd,vi)):(p&&Od._rotate(-kt.angle),ed+=Od.x,Sd+=Od.y,dd=0);const Id=L.allowVerticalPlacement&&Sh.placedOrientation===s.WritingMode.vertical?Math.PI/2:0;for(let $d=0;$d<Vh;$d++)s.addDynamicAttributes(lh,ed,Sd,dd,Id);oa&&Sh.associatedIconIndex>=0&&(yh[Sh.associatedIconIndex]={x:ed,y:Sd,z:dd,angle:Id})}else __(Vh,lh)}if(oa){gh.clear();const wh=L.icon.placedSymbolArray;for(let Sh=0;Sh<wh.length;Sh++){const Oh=wh.get(Sh),{numGlyphs:Uh}=Oh,Vh=yh[Sh];if(Oh.hidden||!Vh)__(Uh,gh);else{const{x:Wh,y:Zh,z:id,angle:Bd}=Vh;for(let ed=0;ed<Uh;ed++)s.addDynamicAttributes(gh,Wh,Zh,id,Bd)}}L.icon.dynamicLayoutVertexBuffer.updateData(gh)}L.text.dynamicLayoutVertexBuffer.updateData(lh)}function Y0(L,p,S){return S.iconsInText&&p?"symbolTextAndIcon":L?"symbolSDF":"symbolIcon"}function Ov(L,p,S,X,ze,kt,vi,or,Gn,ia,oa,pl){const lh=L.context,gh=lh.gl,yh=L.transform,_h=or==="map",xh=Gn==="map",_l=_h&&S.layout.get("symbol-placement")!=="point",mh=_h&&!xh&&!_l,wh=S.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Sh=!1;const Oh=L.depthModeForSublayer(0,s.DepthMode.ReadOnly),Uh=[s.mercatorXfromLng(yh.center.lng),s.mercatorYfromLat(yh.center.lat)],Vh=S.layout.get("text-variable-anchor"),Wh=yh.projection.name==="globe",Zh=[],id=[0,-1,0];let Bd=id;!Wh&&!yh.mercatorFromTransition||_h||(Bd=function(ed){const Sd=ed._camera.getWorldToCamera(ed.worldSize,1),dd=s.multiply([],Sd,ed.globeMatrix);s.invert(dd,dd);const xd=[0,0,0],nd=[0,1,0,0];return s.transformMat4$1(nd,nd,dd),xd[0]=nd[0],xd[1]=nd[1],xd[2]=nd[2],s.normalize(xd,xd),xd}(yh));for(const ed of X){const Sd=p.getTile(ed),dd=Sd.getBucket(S);if(!dd||dd.projection.name==="mercator"&&Wh)continue;const xd=ze?dd.text:dd.icon;if(!xd||dd.fullyClipped||!xd.segments.get().length)continue;const nd=xd.programConfigurations.get(S.id),vd=ze||dd.sdfIcons,Od=ze?dd.textSizeData:dd.iconSizeData,Id=xh||yh.pitch!==0,$d=s.evaluateSizeForZoom(Od,yh.zoom);let Gp,Hf,Mp,Zp,rg=[0,0],Jf=null;if(ze)Hf=Sd.glyphAtlasTexture,Mp=gh.LINEAR,Gp=Sd.glyphAtlasTexture.size,dd.iconsInText&&(rg=Sd.imageAtlasTexture.size,Jf=Sd.imageAtlasTexture,Zp=Id||L.options.rotating||L.options.zooming||Od.kind==="composite"||Od.kind==="camera"?gh.LINEAR:gh.NEAREST);else{const Ey=S.layout.get("icon-size").constantOr(0)!==1||dd.iconsNeedLinear;Hf=Sd.imageAtlasTexture,Mp=vd||L.options.rotating||L.options.zooming||Ey||Id?gh.LINEAR:gh.NEAREST,Gp=Sd.imageAtlasTexture.size}const Bp=dd.projection.name==="globe",fg=Bp?Bd:id,Sg=Bp?s.globeToMercatorTransition(yh.zoom):0,Tg=Lg(ed,dd.getProjection(),yh),gg=yh.calculatePixelsToTileUnitsMatrix(Sd),Jm=hd(Tg,Sd.tileID.canonical,xh,_h,yh,dd.getProjection(),gg),om=L.terrain&&xh&&_l?s.invert(s.create(),Jm):Ex,c_=xg(Tg,Sd.tileID.canonical,xh,_h,yh,dd.getProjection(),gg),I_=Vh&&dd.hasTextData(),Ug=S.layout.get("icon-text-fit")!=="none"&&I_&&dd.hasIconData();if(_l){const Ey=yh.elevation,cv=Ey?Ey.getAtTileOffsetFunc(ed,yh.center.lat,yh.worldSize,dd.getProjection()):null,Xv=g_(Tg,Sd.tileID.canonical,xh,_h,yh,dd.getProjection(),gg);wv(dd,Tg,L,ze,Xv,c_,xh,ia,cv,ed)}const Ag=_l||ze&&Vh||Ug,mg=L.translatePosMatrix(Tg,Sd,kt,vi),pg=Ag?Ex:Jm,wm=L.translatePosMatrix(c_,Sd,kt,vi,!0),Pg=dd.getProjection().createInversionMatrix(yh,ed.canonical),u_=[];L.terrainRenderModeElevated()&&xh&&u_.push("PITCH_WITH_MAP_TERRAIN"),Bp&&u_.push("PROJECTION_GLOBE_VIEW"),Ag&&u_.push("PROJECTED_POS_ON_VIEWPORT");const Kv=vd&&S.paint.get(ze?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let b0;b0=vd?dd.iconsInText?K0(Od.kind,$d,mh,xh,L,mg,pg,wm,Gp,rg,ed,Sg,Uh,Pg,fg,dd.getProjection()):Lv(Od.kind,$d,mh,xh,L,mg,pg,wm,ze,Gp,!0,ed,Sg,Uh,Pg,fg,dd.getProjection()):q0(Od.kind,$d,mh,xh,L,mg,pg,wm,ze,Gp,ed,Sg,Uh,Pg,fg,dd.getProjection());const Zv={program:L.useProgram(Y0(vd,ze,dd),nd,u_),buffers:xd,uniformValues:b0,atlasTexture:Hf,atlasTextureIcon:Jf,atlasInterpolation:Mp,atlasInterpolationIcon:Zp,isSDF:vd,hasHalo:Kv,tile:Sd,labelPlaneMatrixInv:om};if(wh&&dd.canOverlap){Sh=!0;const Ey=xd.segments.get();for(const cv of Ey)Zh.push({segments:new s.SegmentVector([cv]),sortKey:cv.sortKey,state:Zv})}else Zh.push({segments:xd.segments,sortKey:0,state:Zv})}Sh&&Zh.sort((ed,Sd)=>ed.sortKey-Sd.sortKey);for(const ed of Zh){const Sd=ed.state;if(L.terrain&&L.terrain.setupElevationDraw(Sd.tile,Sd.program,{useDepthForOcclusion:!Wh,labelPlaneMatrixInv:Sd.labelPlaneMatrixInv}),lh.activeTexture.set(gh.TEXTURE0),Sd.atlasTexture.bind(Sd.atlasInterpolation,gh.CLAMP_TO_EDGE),Sd.atlasTextureIcon&&(lh.activeTexture.set(gh.TEXTURE1),Sd.atlasTextureIcon&&Sd.atlasTextureIcon.bind(Sd.atlasInterpolationIcon,gh.CLAMP_TO_EDGE)),Sd.isSDF){const dd=Sd.uniformValues;Sd.hasHalo&&(dd.u_is_halo=1,Fv(Sd.buffers,ed.segments,S,L,Sd.program,Oh,oa,pl,dd)),dd.u_is_halo=0}Fv(Sd.buffers,ed.segments,S,L,Sd.program,Oh,oa,pl,Sd.uniformValues)}}function Fv(L,p,S,X,ze,kt,vi,or,Gn){const ia=X.context,oa=[L.dynamicLayoutVertexBuffer,L.opacityVertexBuffer,L.globeExtVertexBuffer];ze.draw(ia,ia.gl.TRIANGLES,kt,vi,or,s.CullFaceMode.disabled,Gn,S.id,L.layoutVertexBuffer,L.indexBuffer,p,S.paint,X.transform.zoom,L.programConfigurations.get(S.id),oa)}function R_(L,p,S,X,ze,kt,vi){const or=L.context.gl,Gn=S.paint.get("fill-pattern"),ia=Gn&&Gn.constantOr(1);let oa,pl,lh,gh,yh;vi?(pl=ia&&!S.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",oa=or.LINES):(pl=ia?"fillPattern":"fill",oa=or.TRIANGLES);for(const _h of X){const xh=p.getTile(_h);if(ia&&!xh.patternsLoaded())continue;const _l=xh.getBucket(S);if(!_l)continue;L.prepareDrawTile();const mh=_l.programConfigurations.get(S.id),wh=L.useProgram(pl,mh);ia&&(L.context.activeTexture.set(or.TEXTURE0),xh.imageAtlasTexture.bind(or.LINEAR,or.CLAMP_TO_EDGE),mh.updatePaintBuffers());const Sh=Gn.constantOr(null);if(Sh&&xh.imageAtlas){const Uh=xh.imageAtlas.patternPositions[Sh.toString()];Uh&&mh.setConstantPatternPositions(Uh)}const Oh=L.translatePosMatrix(_h.projMatrix,xh,S.paint.get("fill-translate"),S.paint.get("fill-translate-anchor"));if(vi){gh=_l.indexBuffer2,yh=_l.segments2;const Uh=L.terrain&&L.terrain.renderingToTexture?L.terrain.drapeBufferSize:[or.drawingBufferWidth,or.drawingBufferHeight];lh=pl==="fillOutlinePattern"&&ia?j0(Oh,L,xh,Uh):H0(Oh,Uh)}else gh=_l.indexBuffer,yh=_l.segments,lh=ia?$0(Oh,L,xh):qy(Oh);L.prepareDrawProgram(L.context,wh,_h.toUnwrapped()),wh.draw(L.context,oa,ze,L.stencilModeForClipping(_h),kt,s.CullFaceMode.disabled,lh,S.id,_l.layoutVertexBuffer,gh,yh,S.paint,L.transform.zoom,mh)}}function Um(L,p,S,X,ze,kt,vi){const or=L.context,Gn=or.gl,ia=L.transform,oa=S.paint.get("fill-extrusion-pattern"),pl=oa.constantOr(1),lh=S.paint.get("fill-extrusion-opacity"),gh=[S.paint.get("fill-extrusion-ambient-occlusion-intensity"),S.paint.get("fill-extrusion-ambient-occlusion-radius")],yh=S.layout.get("fill-extrusion-edge-radius"),_h=yh>0&&!S.paint.get("fill-extrusion-rounded-roof"),xh=_h?0:yh,_l=ia.projection.name==="globe"?s.fillExtrusionHeightLift():0,mh=ia.projection.name==="globe",wh=mh?s.globeToMercatorTransition(ia.zoom):0,Sh=[s.mercatorXfromLng(ia.center.lng),s.mercatorYfromLat(ia.center.lat)],Oh=[];mh&&Oh.push("PROJECTION_GLOBE_VIEW"),gh[0]>0&&Oh.push("FAUX_AO"),_h&&Oh.push("ZERO_ROOF_RADIUS");for(const Uh of X){const Vh=p.getTile(Uh),Wh=Vh.getBucket(S);if(!Wh||Wh.projection.name!==ia.projection.name)continue;const Zh=Wh.programConfigurations.get(S.id),id=L.useProgram(pl?"fillExtrusionPattern":"fillExtrusion",Zh,Oh);if(L.terrain){const vd=L.terrain;if(L.style.terrainSetForDrapingOnly())vd.setupElevationDraw(Vh,id,{useMeterToDem:!0});else{if(!Wh.enableTerrain)continue;if(vd.setupElevationDraw(Vh,id,{useMeterToDem:!0}),Nv(or,p,Uh,Wh,S,vd),!Wh.centroidVertexBuffer){const Od=id.attributes.a_centroid_pos;Od!==void 0&&Gn.vertexAttrib2f(Od,0,0)}}}pl&&(L.context.activeTexture.set(Gn.TEXTURE0),Vh.imageAtlasTexture.bind(Gn.LINEAR,Gn.CLAMP_TO_EDGE),Zh.updatePaintBuffers());const Bd=oa.constantOr(null);if(Bd&&Vh.imageAtlas){const vd=Vh.imageAtlas.patternPositions[Bd.toString()];vd&&Zh.setConstantPatternPositions(vd)}const ed=L.translatePosMatrix(Uh.projMatrix,Vh,S.paint.get("fill-extrusion-translate"),S.paint.get("fill-extrusion-translate-anchor")),Sd=ia.projection.createInversionMatrix(ia,Uh.canonical),dd=S.paint.get("fill-extrusion-vertical-gradient"),xd=pl?U0(ed,L,dd,lh,gh,xh,Uh,Vh,_l,wh,Sh,Sd):V0(ed,L,dd,lh,gh,xh,Uh,_l,wh,Sh,Sd);L.prepareDrawProgram(or,id,Uh.toUnwrapped());const nd=[];L.terrain&&nd.push(Wh.centroidVertexBuffer),mh&&nd.push(Wh.layoutVertexExtBuffer),id.draw(or,or.gl.TRIANGLES,ze,kt,vi,s.CullFaceMode.backCCW,xd,S.id,Wh.layoutVertexBuffer,Wh.indexBuffer,Wh.segments,S.paint,L.transform.zoom,Zh,nd)}}function Nv(L,p,S,X,ze,kt){const vi=[_l=>{let mh=_l.canonical.x-1,wh=_l.wrap;return mh<0&&(mh=(1<<_l.canonical.z)-1,wh--),new s.OverscaledTileID(_l.overscaledZ,wh,_l.canonical.z,mh,_l.canonical.y)},_l=>{let mh=_l.canonical.x+1,wh=_l.wrap;return mh===1<<_l.canonical.z&&(mh=0,wh++),new s.OverscaledTileID(_l.overscaledZ,wh,_l.canonical.z,mh,_l.canonical.y)},_l=>new s.OverscaledTileID(_l.overscaledZ,_l.wrap,_l.canonical.z,_l.canonical.x,(_l.canonical.y===0?1<<_l.canonical.z:_l.canonical.y)-1),_l=>new s.OverscaledTileID(_l.overscaledZ,_l.wrap,_l.canonical.z,_l.canonical.x,_l.canonical.y===(1<<_l.canonical.z)-1?0:_l.canonical.y+1)],or=_l=>{const mh=p.getSource().minzoom,wh=Oh=>{const Uh=p.getTileByID(Oh);if(Uh&&Uh.hasData())return Uh.getBucket(ze)},Sh=[0,-1,1];for(const Oh of Sh){if(_l.overscaledZ+Oh<mh)continue;const Uh=wh(_l.calculateScaledKey(_l.overscaledZ+Oh));if(Uh)return Uh}},Gn=[0,0,0],ia=(_l,mh)=>(Gn[0]=Math.min(_l.min.y,mh.min.y),Gn[1]=Math.max(_l.max.y,mh.max.y),Gn[2]=s.EXTENT-mh.min.x>_l.max.x?mh.min.x-s.EXTENT:_l.max.x,Gn),oa=(_l,mh)=>(Gn[0]=Math.min(_l.min.x,mh.min.x),Gn[1]=Math.max(_l.max.x,mh.max.x),Gn[2]=s.EXTENT-mh.min.y>_l.max.y?mh.min.y-s.EXTENT:_l.max.y,Gn),pl=[(_l,mh)=>ia(_l,mh),(_l,mh)=>ia(mh,_l),(_l,mh)=>oa(_l,mh),(_l,mh)=>oa(mh,_l)],lh=new s.Point(0,0);let gh,yh,_h;const xh=(_l,mh,wh,Sh,Oh)=>{const Uh=[[Sh?wh:_l,Sh?_l:wh,0],[Sh?wh:mh,Sh?mh:wh,0]],Vh=Oh<0?s.EXTENT+Oh:Oh,Wh=[Sh?Vh:(_l+mh)/2,Sh?(_l+mh)/2:Vh,0];return wh===0&&Oh<0||wh!==0&&Oh>0?kt.getForTilePoints(_h,[Wh],!0,yh):Uh.push(Wh),kt.getForTilePoints(S,Uh,!0,gh),Math.max(Uh[0][2],Uh[1][2],Wh[2])/kt.exaggeration()};for(let _l=0;_l<4;_l++){const mh=(_l<2?1:5)-_l,wh=X.borders[_l];if(wh.length===0)continue;const Sh=_h=vi[_l](S),Oh=or(Sh);if(!(Oh&&Oh instanceof s.FillExtrusionBucket&&Oh.enableTerrain)||X.borderDoneWithNeighborZ[_l]===Oh.canonical.z&&Oh.borderDoneWithNeighborZ[mh]===X.canonical.z||(yh=kt.findDEMTileFor(Sh),!yh||!yh.dem))continue;if(!gh){const Zh=kt.findDEMTileFor(S);if(!Zh||!Zh.dem)return;gh=Zh}const Uh=Oh.borders[mh];let Vh=0;const Wh=Oh.borderDoneWithNeighborZ[mh]!==X.canonical.z;if(X.canonical.z===Oh.canonical.z){for(let Zh=0;Zh<wh.length;Zh++){const id=X.featuresOnBorder[wh[Zh]],Bd=id.borders[_l];let ed;for(;Vh<Uh.length&&(ed=Oh.featuresOnBorder[Uh[Vh]],!(ed.borders[mh][1]>Bd[0]+3));)Wh&&Oh.encodeCentroid(void 0,ed,!1),Vh++;if(ed&&Vh<Uh.length){const Sd=Vh;let dd=0;for(;!(ed.borders[mh][0]>Bd[1]-3)&&(dd++,++Vh!==Uh.length);)ed=Oh.featuresOnBorder[Uh[Vh]];if(ed=Oh.featuresOnBorder[Uh[Sd]],id.intersectsCount()>1||ed.intersectsCount()>1||dd!==1){dd!==1&&(Vh=Sd),X.encodeCentroid(void 0,id,!1),Wh&&Oh.encodeCentroid(void 0,ed,!1);continue}const xd=pl[_l](id,ed),nd=_l%2?s.EXTENT-1:0;lh.x=xh(xd[0],Math.min(s.EXTENT-1,xd[1]),nd,_l<2,xd[2]),lh.y=0,X.encodeCentroid(lh,id,!1),Wh&&Oh.encodeCentroid(lh,ed,!1)}else X.encodeCentroid(void 0,id,!1)}X.borderDoneWithNeighborZ[_l]=Oh.canonical.z,X.needsCentroidUpdate=!0,Wh&&(Oh.borderDoneWithNeighborZ[mh]=X.canonical.z,Oh.needsCentroidUpdate=!0)}else{for(const Zh of wh)X.encodeCentroid(void 0,X.featuresOnBorder[Zh],!1);if(Wh){for(const Zh of Uh)Oh.encodeCentroid(void 0,Oh.featuresOnBorder[Zh],!1);Oh.borderDoneWithNeighborZ[mh]=X.canonical.z,Oh.needsCentroidUpdate=!0}X.borderDoneWithNeighborZ[_l]=Oh.canonical.z,X.needsCentroidUpdate=!0}}(X.needsCentroidUpdate||!X.centroidVertexBuffer&&X.centroidVertexArray.length!==0)&&X.uploadCentroid(L)}const Vg=new s.Color(1,0,0,1),my=new s.Color(0,1,0,1),xw=new s.Color(0,0,1,1),ww=new s.Color(1,0,1,1),bw=new s.Color(0,1,1,1);function kv(L,p,S){const X=L.context,ze=L.transform,kt=X.gl,vi=ze.projection.name==="globe",or=vi?["PROJECTION_GLOBE_VIEW"]:null;let Gn=S.projMatrix;if(vi&&s.globeToMercatorTransition(ze.zoom)>0){const id=s.transitionTileAABBinECEF(S.canonical,ze),Bd=s.globeDenormalizeECEF(id);Gn=s.multiply(new Float32Array(16),ze.globeMatrix,Bd),s.multiply(Gn,ze.projMatrix,Gn)}const ia=L.useProgram("debug",null,or),oa=p.getTileByID(S.key);L.terrain&&L.terrain.setupElevationDraw(oa,ia);const pl=s.DepthMode.disabled,lh=s.StencilMode.disabled,gh=L.colorModeForRenderPass(),yh="$debug";X.activeTexture.set(kt.TEXTURE0),L.emptyTexture.bind(kt.LINEAR,kt.CLAMP_TO_EDGE),vi?oa._makeGlobeTileDebugBuffers(L.context,ze):oa._makeDebugTileBoundsBuffers(L.context,ze.projection);const _h=oa._tileDebugBuffer||L.debugBuffer,xh=oa._tileDebugIndexBuffer||L.debugIndexBuffer,_l=oa._tileDebugSegments||L.debugSegments;ia.draw(X,kt.LINE_STRIP,pl,lh,gh,s.CullFaceMode.disabled,W0(Gn,s.Color.red),yh,_h,xh,_l,null,null,null,[oa._globeTileDebugBorderBuffer]);const mh=oa.latestRawTileData,wh=Math.floor((mh&&mh.byteLength||0)/1024),Sh=p.getTile(S).tileSize,Oh=512/Math.min(Sh,512)*(S.overscaledZ/ze.zoom)*.5;let Uh=S.canonical.toString();S.overscaledZ!==S.canonical.z&&(Uh+=` => ${S.overscaledZ}`),Uh+=` ${wh}kb`,function(id,Bd){id.initDebugOverlayCanvas();const ed=id.debugOverlayCanvas,Sd=id.context.gl,dd=id.debugOverlayCanvas.getContext("2d");dd.clearRect(0,0,ed.width,ed.height),dd.shadowColor="white",dd.shadowBlur=2,dd.lineWidth=1.5,dd.strokeStyle="white",dd.textBaseline="top",dd.font="bold 36px Open Sans, sans-serif",dd.fillText(Bd,5,5),dd.strokeText(Bd,5,5),id.debugOverlayTexture.update(ed),id.debugOverlayTexture.bind(Sd.LINEAR,Sd.CLAMP_TO_EDGE)}(L,Uh);const Vh=oa._tileDebugTextBuffer||L.debugBuffer,Wh=oa._tileDebugTextIndexBuffer||L.quadTriangleIndexBuffer,Zh=oa._tileDebugTextSegments||L.debugSegments;ia.draw(X,kt.TRIANGLES,pl,lh,s.ColorMode.alphaBlended,s.CullFaceMode.disabled,W0(Gn,s.Color.transparent,Oh),yh,Vh,Wh,Zh,null,null,null,[oa._globeTileDebugTextBuffer])}function Bv(L,p,S,X){Tp(L,0,p+S/2,L.transform.width,S,X)}function l_(L,p,S,X){Tp(L,p-S/2,0,S,L.transform.height,X)}function Tp(L,p,S,X,ze,kt){const vi=L.context,or=vi.gl;or.enable(or.SCISSOR_TEST),or.scissor(p*s.exported.devicePixelRatio,S*s.exported.devicePixelRatio,X*s.exported.devicePixelRatio,ze*s.exported.devicePixelRatio),vi.clear({color:kt}),or.disable(or.SCISSOR_TEST)}const m0=s.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Gv}=m0;function Sm(L,p,S,X){L.emplaceBack(p,S,X)}class _0{constructor(p){this.vertexArray=new s.StructArrayLayout3f12,this.indices=new s.StructArrayLayout3ui6,Sm(this.vertexArray,-1,-1,1),Sm(this.vertexArray,1,-1,1),Sm(this.vertexArray,-1,1,1),Sm(this.vertexArray,1,1,1),Sm(this.vertexArray,-1,-1,-1),Sm(this.vertexArray,1,-1,-1),Sm(this.vertexArray,-1,1,-1),Sm(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=p.createVertexBuffer(this.vertexArray,Gv),this.indexBuffer=p.createIndexBuffer(this.indices),this.segment=s.SegmentVector.simpleSegment(0,0,36,12)}}function sp(L,p,S,X,ze,kt){const vi=L.gl,or=p.paint.get("sky-atmosphere-color"),Gn=p.paint.get("sky-atmosphere-halo-color"),ia=p.paint.get("sky-atmosphere-sun-intensity"),oa=((pl,lh,gh,yh,_h)=>({u_matrix_3f:pl,u_sun_direction:lh,u_sun_intensity:gh,u_color_tint_r:[yh.r,yh.g,yh.b,yh.a],u_color_tint_m:[_h.r,_h.g,_h.b,_h.a],u_luminance:5e-5}))(s.fromMat4(s.create$1(),X),ze,ia,or,Gn);vi.framebufferTexture2D(vi.FRAMEBUFFER,vi.COLOR_ATTACHMENT0,vi.TEXTURE_CUBE_MAP_POSITIVE_X+kt,p.skyboxTexture,0),S.draw(L,vi.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.frontCW,oa,"skyboxCapture",p.skyboxGeometry.vertexBuffer,p.skyboxGeometry.indexBuffer,p.skyboxGeometry.segment)}const _y=s.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class J0{constructor(p){const S=new s.StructArrayLayout5f20;S.emplaceBack(-1,1,1,0,0),S.emplaceBack(1,1,1,1,0),S.emplaceBack(1,-1,1,1,1),S.emplaceBack(-1,-1,1,0,1);const X=new s.StructArrayLayout3ui6;X.emplaceBack(0,1,2),X.emplaceBack(2,3,0),this.vertexBuffer=p.createVertexBuffer(S,_y.members),this.indexBuffer=p.createIndexBuffer(X),this.segments=s.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const yy={symbol:function(L,p,S,X,ze){if(L.renderPass!=="translucent")return;const kt=s.StencilMode.disabled,vi=L.colorModeForRenderPass();S.layout.get("text-variable-anchor")&&function(or,Gn,ia,oa,pl,lh,gh){const yh=Gn.transform,_h=pl==="map",xh=lh==="map";for(const _l of or){const mh=oa.getTile(_l),wh=mh.getBucket(ia);if(!wh||!wh.text||!wh.text.segments.get().length)continue;const Sh=s.evaluateSizeForZoom(wh.textSizeData,yh.zoom),Oh=Lg(_l,wh.getProjection(),yh),Uh=yh.calculatePixelsToTileUnitsMatrix(mh),Vh=hd(Oh,mh.tileID.canonical,xh,_h,yh,wh.getProjection(),Uh),Wh=ia.layout.get("icon-text-fit")!=="none"&&wh.hasIconData();if(Sh){const Zh=Math.pow(2,yh.zoom-mh.tileID.overscaledZ);Ux(wh,_h,xh,gh,s.symbolSize,yh,Vh,_l,Zh,Sh,Wh)}}}(X,L,S,p,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),ze),S.paint.get("icon-opacity").constantOr(1)!==0&&Ov(L,p,S,X,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),kt,vi),S.paint.get("text-opacity").constantOr(1)!==0&&Ov(L,p,S,X,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),kt,vi),p.map.showCollisionBoxes&&(gy(L,p,S,X,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),!0),gy(L,p,S,X,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),!1))},circle:function(L,p,S,X){if(L.renderPass!=="translucent")return;const ze=S.paint.get("circle-opacity"),kt=S.paint.get("circle-stroke-width"),vi=S.paint.get("circle-stroke-opacity"),or=S.layout.get("circle-sort-key").constantOr(1)!==void 0;if(ze.constantOr(1)===0&&(kt.constantOr(1)===0||vi.constantOr(1)===0))return;const Gn=L.context,ia=Gn.gl,oa=L.transform,pl=L.depthModeForSublayer(0,s.DepthMode.ReadOnly),lh=s.StencilMode.disabled,gh=L.colorModeForRenderPass(),yh=oa.projection.name==="globe",_h=[s.mercatorXfromLng(oa.center.lng),s.mercatorYfromLat(oa.center.lat)],xh=[];for(let mh=0;mh<X.length;mh++){const wh=X[mh],Sh=p.getTile(wh),Oh=Sh.getBucket(S);if(!Oh||Oh.projection.name!==oa.projection.name)continue;const Uh=Oh.programConfigurations.get(S.id),Vh=Ky(S);yh&&Vh.push("PROJECTION_GLOBE_VIEW");const Wh=L.useProgram("circle",Uh,Vh),Zh=Oh.layoutVertexBuffer,id=Oh.globeExtVertexBuffer,Bd=Oh.indexBuffer,ed=oa.projection.createInversionMatrix(oa,wh.canonical),Sd={programConfiguration:Uh,program:Wh,layoutVertexBuffer:Zh,globeExtVertexBuffer:id,indexBuffer:Bd,uniformValues:f0(L,wh,Sh,ed,_h,S),tile:Sh};if(or){const dd=Oh.segments.get();for(const xd of dd)xh.push({segments:new s.SegmentVector([xd]),sortKey:xd.sortKey,state:Sd})}else xh.push({segments:Oh.segments,sortKey:0,state:Sd})}or&&xh.sort((mh,wh)=>mh.sortKey-wh.sortKey);const _l={useDepthForOcclusion:!yh};for(const mh of xh){const{programConfiguration:wh,program:Sh,layoutVertexBuffer:Oh,globeExtVertexBuffer:Uh,indexBuffer:Vh,uniformValues:Wh,tile:Zh}=mh.state,id=mh.segments;L.terrain&&L.terrain.setupElevationDraw(Zh,Sh,_l),L.prepareDrawProgram(Gn,Sh,Zh.tileID.toUnwrapped()),Sh.draw(Gn,ia.TRIANGLES,pl,lh,gh,s.CullFaceMode.disabled,Wh,S.id,Oh,Vh,id,S.paint,oa.zoom,wh,[Uh])}},heatmap:function(L,p,S,X){if(S.paint.get("heatmap-opacity")!==0)if(L.renderPass==="offscreen"){const ze=L.context,kt=ze.gl,vi=s.StencilMode.disabled,or=new s.ColorMode([kt.ONE,kt.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(gh,yh,_h,xh){const _l=gh.gl,mh=yh.width*xh,wh=yh.height*xh;gh.activeTexture.set(_l.TEXTURE1),gh.viewport.set([0,0,mh,wh]);let Sh=_h.heatmapFbo;if(!Sh||Sh&&(Sh.width!==mh||Sh.height!==wh)){Sh&&Sh.destroy();const Oh=_l.createTexture();_l.bindTexture(_l.TEXTURE_2D,Oh),_l.texParameteri(_l.TEXTURE_2D,_l.TEXTURE_WRAP_S,_l.CLAMP_TO_EDGE),_l.texParameteri(_l.TEXTURE_2D,_l.TEXTURE_WRAP_T,_l.CLAMP_TO_EDGE),_l.texParameteri(_l.TEXTURE_2D,_l.TEXTURE_MIN_FILTER,_l.LINEAR),_l.texParameteri(_l.TEXTURE_2D,_l.TEXTURE_MAG_FILTER,_l.LINEAR),Sh=_h.heatmapFbo=gh.createFramebuffer(mh,wh,!1),function(Uh,Vh,Wh,Zh,id,Bd){const ed=Uh.gl;ed.texImage2D(ed.TEXTURE_2D,0,Uh.isWebGL2&&Uh.extRenderToTextureHalfFloat?ed.RGBA16F:ed.RGBA,id,Bd,0,ed.RGBA,Uh.extRenderToTextureHalfFloat?Uh.isWebGL2?ed.HALF_FLOAT:Uh.extTextureHalfFloat.HALF_FLOAT_OES:ed.UNSIGNED_BYTE,null),Zh.colorAttachment.set(Wh)}(gh,0,Oh,Sh,mh,wh)}else _l.bindTexture(_l.TEXTURE_2D,Sh.colorAttachment.get()),gh.bindFramebuffer.set(Sh.framebuffer)})(ze,L,S,L.transform.projection.name==="globe"?.5:.25),ze.clear({color:s.Color.transparent});const Gn=L.transform,ia=Gn.projection.name==="globe",oa=ia?["PROJECTION_GLOBE_VIEW"]:null,pl=ia?s.CullFaceMode.frontCCW:s.CullFaceMode.disabled,lh=[s.mercatorXfromLng(Gn.center.lng),s.mercatorYfromLat(Gn.center.lat)];for(let gh=0;gh<X.length;gh++){const yh=X[gh];if(p.hasRenderableParent(yh))continue;const _h=p.getTile(yh),xh=_h.getBucket(S);if(!xh||xh.projection.name!==Gn.projection.name)continue;const _l=xh.programConfigurations.get(S.id),mh=L.useProgram("heatmap",_l,oa),{zoom:wh}=L.transform;L.terrain&&L.terrain.setupElevationDraw(_h,mh),L.prepareDrawProgram(ze,mh,yh.toUnwrapped());const Sh=Gn.projection.createInversionMatrix(Gn,yh.canonical);mh.draw(ze,kt.TRIANGLES,s.DepthMode.disabled,vi,or,pl,Yg(L,yh,_h,Sh,lh,wh,S.paint.get("heatmap-intensity")),S.id,xh.layoutVertexBuffer,xh.indexBuffer,xh.segments,S.paint,L.transform.zoom,_l,ia?[xh.globeExtVertexBuffer]:null)}ze.viewport.set([0,0,L.width,L.height])}else L.renderPass==="translucent"&&(L.context.setColorMode(L.colorModeForRenderPass()),function(ze,kt){const vi=ze.context,or=vi.gl,Gn=kt.heatmapFbo;if(!Gn)return;vi.activeTexture.set(or.TEXTURE0),or.bindTexture(or.TEXTURE_2D,Gn.colorAttachment.get()),vi.activeTexture.set(or.TEXTURE1);let ia=kt.colorRampTexture;ia||(ia=kt.colorRampTexture=new s.Texture(vi,kt.colorRamp,or.RGBA)),ia.bind(or.LINEAR,or.CLAMP_TO_EDGE),ze.useProgram("heatmapTexture").draw(vi,or.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,ze.colorModeForRenderPass(),s.CullFaceMode.disabled,((oa,pl,lh,gh)=>({u_image:0,u_color_ramp:1,u_opacity:pl.paint.get("heatmap-opacity")}))(0,kt),kt.id,ze.viewportBuffer,ze.quadTriangleIndexBuffer,ze.viewportSegments,kt.paint,ze.transform.zoom)}(L,S))},line:function(L,p,S,X){if(L.renderPass!=="translucent")return;const ze=S.paint.get("line-opacity"),kt=S.paint.get("line-width");if(ze.constantOr(1)===0||kt.constantOr(1)===0)return;const vi=L.depthModeForSublayer(0,s.DepthMode.ReadOnly),or=L.colorModeForRenderPass(),Gn=L.terrain&&L.terrain.renderingToTexture?1:s.exported.devicePixelRatio,ia=S.paint.get("line-dasharray"),oa=ia.constantOr(1),pl=S.layout.get("line-cap"),lh=S.paint.get("line-pattern"),gh=lh.constantOr(1),yh=S.paint.get("line-gradient"),_h=gh?"linePattern":"line",xh=L.context,_l=xh.gl,mh=(Sh=>{const Oh=[];Dv(Sh)&&Oh.push("RENDER_LINE_DASH"),Sh.paint.get("line-gradient")&&Oh.push("RENDER_LINE_GRADIENT");const Uh=Sh.paint.get("line-trim-offset");Uh[0]===0&&Uh[1]===0||Oh.push("RENDER_LINE_TRIM_OFFSET");const Vh=Sh.paint.get("line-pattern").constantOr(1),Wh=Sh.paint.get("line-opacity").constantOr(1)!==1;return!Vh&&Wh&&Oh.push("RENDER_LINE_ALPHA_DISCARD"),Oh})(S);let wh=mh.includes("RENDER_LINE_ALPHA_DISCARD");L.terrain&&L.terrain.clipOrMaskOverlapStencilType()&&(wh=!1);for(const Sh of X){const Oh=p.getTile(Sh);if(gh&&!Oh.patternsLoaded())continue;const Uh=Oh.getBucket(S);if(!Uh)continue;L.prepareDrawTile();const Vh=Uh.programConfigurations.get(S.id),Wh=L.useProgram(_h,Vh,mh),Zh=lh.constantOr(null);if(Zh&&Oh.imageAtlas){const vd=Oh.imageAtlas.patternPositions[Zh.toString()];vd&&Vh.setConstantPatternPositions(vd)}const id=ia.constantOr(null),Bd=pl.constantOr(null);if(!gh&&id&&Bd&&Oh.lineAtlas){const vd=Oh.lineAtlas.getDash(id,Bd);vd&&Vh.setConstantPatternPositions(vd)}let[ed,Sd]=S.paint.get("line-trim-offset");(Bd==="round"||Bd==="square")&&ed!==Sd&&(ed===0&&(ed-=1),Sd===1&&(Sd+=1));const dd=L.terrain?Sh.projMatrix:null,xd=gh?Nm(L,Oh,S,dd,Gn):Xy(L,Oh,S,dd,Uh.lineClipsArray.length,Gn,[ed,Sd]);if(yh){const vd=Uh.gradients[S.id];let Od=vd.texture;if(S.gradientVersion!==vd.version){let Id=256;if(S.stepInterpolant){const $d=p.getSource().maxzoom,Gp=Sh.canonical.z===$d?Math.ceil(1<<L.transform.maxZoom-Sh.canonical.z):1;Id=s.clamp(s.nextPowerOfTwo(Uh.maxLineLength/s.EXTENT*1024*Gp),256,xh.maxTextureSize)}vd.gradient=s.renderColorRamp({expression:S.gradientExpression(),evaluationKey:"lineProgress",resolution:Id,image:vd.gradient||void 0,clips:Uh.lineClipsArray}),vd.texture?vd.texture.update(vd.gradient):vd.texture=new s.Texture(xh,vd.gradient,_l.RGBA),vd.version=S.gradientVersion,Od=vd.texture}xh.activeTexture.set(_l.TEXTURE1),Od.bind(S.stepInterpolant?_l.NEAREST:_l.LINEAR,_l.CLAMP_TO_EDGE)}oa&&(xh.activeTexture.set(_l.TEXTURE0),Oh.lineAtlasTexture.bind(_l.LINEAR,_l.REPEAT),Vh.updatePaintBuffers()),gh&&(xh.activeTexture.set(_l.TEXTURE0),Oh.imageAtlasTexture.bind(_l.LINEAR,_l.CLAMP_TO_EDGE),Vh.updatePaintBuffers()),L.prepareDrawProgram(xh,Wh,Sh.toUnwrapped());const nd=vd=>{Wh.draw(xh,_l.TRIANGLES,vi,vd,or,s.CullFaceMode.disabled,xd,S.id,Uh.layoutVertexBuffer,Uh.indexBuffer,Uh.segments,S.paint,L.transform.zoom,Vh,[Uh.layoutVertexBuffer2])};if(wh){const vd=L.stencilModeForClipping(Sh).ref;vd===0&&L.terrain&&xh.clear({stencil:0});const Od={func:_l.EQUAL,mask:255};xd.u_alpha_discard_threshold=.8,nd(new s.StencilMode(Od,vd,255,_l.KEEP,_l.KEEP,_l.INVERT)),xd.u_alpha_discard_threshold=0,nd(new s.StencilMode(Od,vd,255,_l.KEEP,_l.KEEP,_l.KEEP))}else nd(L.stencilModeForClipping(Sh))}wh&&(L.resetStencilClippingMasks(),L.terrain&&xh.clear({stencil:0}))},fill:function(L,p,S,X){const ze=S.paint.get("fill-color"),kt=S.paint.get("fill-opacity");if(kt.constantOr(1)===0)return;const vi=L.colorModeForRenderPass(),or=S.paint.get("fill-pattern"),Gn=L.opaquePassEnabledForLayer()&&!or.constantOr(1)&&ze.constantOr(s.Color.transparent).a===1&&kt.constantOr(0)===1?"opaque":"translucent";if(L.renderPass===Gn){const ia=L.depthModeForSublayer(1,L.renderPass==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly);R_(L,p,S,X,ia,vi,!1)}if(L.renderPass==="translucent"&&S.paint.get("fill-antialias")){const ia=L.depthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,s.DepthMode.ReadOnly);R_(L,p,S,X,ia,vi,!0)}},"fill-extrusion":function(L,p,S,X){const ze=S.paint.get("fill-extrusion-opacity");if(ze!==0&&L.renderPass==="translucent"){const kt=new s.DepthMode(L.context.gl.LEQUAL,s.DepthMode.ReadWrite,L.depthRangeFor3D);if(ze!==1||S.paint.get("fill-extrusion-pattern").constantOr(1))Um(L,p,S,X,kt,s.StencilMode.disabled,s.ColorMode.disabled),Um(L,p,S,X,kt,L.stencilModeFor3D(),L.colorModeForRenderPass()),L.resetStencilClippingMasks();else{const vi=L.colorModeForRenderPass();Um(L,p,S,X,kt,s.StencilMode.disabled,vi)}}},hillshade:function(L,p,S,X){if(L.renderPass!=="offscreen"&&L.renderPass!=="translucent")return;const ze=L.context,kt=L.depthModeForSublayer(0,s.DepthMode.ReadOnly),vi=L.colorModeForRenderPass(),or=L.terrain&&L.terrain.renderingToTexture,[Gn,ia]=L.renderPass!=="translucent"||or?[{},X]:L.stencilConfigForOverlap(X);for(const oa of ia){const pl=p.getTile(oa);if(pl.needsHillshadePrepare&&L.renderPass==="offscreen")_g(L,pl,S,kt,s.StencilMode.disabled,vi);else if(L.renderPass==="translucent"){const lh=or&&L.terrain?L.terrain.stencilModeForRTTOverlap(oa):Gn[oa.overscaledZ];wx(L,oa,pl,S,kt,lh,vi)}}ze.viewport.set([0,0,L.width,L.height]),L.resetStencilClippingMasks()},raster:function(L,p,S,X,ze,kt){if(L.renderPass!=="translucent"||S.paint.get("raster-opacity")===0||!X.length)return;const vi=L.context,or=vi.gl,Gn=p.getSource(),ia=L.useProgram("raster"),oa=L.colorModeForRenderPass(),pl=L.terrain&&L.terrain.renderingToTexture,[lh,gh]=Gn instanceof Th||pl?[{},X]:L.stencilConfigForOverlap(X),yh=gh[gh.length-1].overscaledZ,_h=!L.options.moving;for(const xh of gh){const _l=pl?s.DepthMode.disabled:L.depthModeForSublayer(xh.overscaledZ-yh,S.paint.get("raster-opacity")===1?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly,or.LESS),mh=xh.toUnwrapped(),wh=p.getTile(xh);if(pl&&(!wh||!wh.hasData()))continue;const Sh=pl?xh.projMatrix:L.transform.calculateProjMatrix(mh,_h),Oh=L.terrain&&pl?L.terrain.stencilModeForRTTOverlap(xh):lh[xh.overscaledZ],Uh=kt?0:S.paint.get("raster-fade-duration");wh.registerFadeDuration(Uh);const Vh=p.findLoadedParent(xh,0),Wh=Iv(wh,Vh,p,L.transform,Uh);let Zh,id;L.terrain&&L.terrain.prepareDrawTile();const Bd=S.paint.get("raster-resampling")==="nearest"?or.NEAREST:or.LINEAR;vi.activeTexture.set(or.TEXTURE0),wh.texture.bind(Bd,or.CLAMP_TO_EDGE),vi.activeTexture.set(or.TEXTURE1),Vh?(Vh.texture.bind(Bd,or.CLAMP_TO_EDGE),Zh=Math.pow(2,Vh.tileID.overscaledZ-wh.tileID.overscaledZ),id=[wh.tileID.canonical.x*Zh%1,wh.tileID.canonical.y*Zh%1]):wh.texture.bind(Bd,or.CLAMP_TO_EDGE),wh.texture.useMipmap&&vi.extTextureFilterAnisotropic&&L.transform.pitch>20&&or.texParameterf(or.TEXTURE_2D,vi.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,vi.extTextureFilterAnisotropicMax);const ed=J_(Sh,id||[0,0],Zh||1,Wh,S,Gn instanceof Th?Gn.perspectiveTransform:[0,0]);if(L.prepareDrawProgram(vi,ia,mh),Gn instanceof Th)Gn.boundsBuffer&&Gn.boundsSegments&&ia.draw(vi,or.TRIANGLES,_l,s.StencilMode.disabled,oa,s.CullFaceMode.disabled,ed,S.id,Gn.boundsBuffer,L.quadTriangleIndexBuffer,Gn.boundsSegments);else{const{tileBoundsBuffer:Sd,tileBoundsIndexBuffer:dd,tileBoundsSegments:xd}=L.getTileBoundsBuffers(wh);ia.draw(vi,or.TRIANGLES,_l,Oh,oa,s.CullFaceMode.disabled,ed,S.id,Sd,dd,xd)}}L.resetStencilClippingMasks()},background:function(L,p,S,X){const ze=S.paint.get("background-color"),kt=S.paint.get("background-opacity");if(kt===0)return;const vi=L.context,or=vi.gl,Gn=L.transform,ia=Gn.tileSize,oa=S.paint.get("background-pattern");if(L.isPatternMissing(oa))return;const pl=!oa&&ze.a===1&&kt===1&&L.opaquePassEnabledForLayer()?"opaque":"translucent";if(L.renderPass!==pl)return;const lh=s.StencilMode.disabled,gh=L.depthModeForSublayer(0,pl==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly),yh=L.colorModeForRenderPass(),_h=L.useProgram(oa?"backgroundPattern":"background");let xh,_l=X;_l||(xh=L.getBackgroundTiles(),_l=Object.values(xh).map(mh=>mh.tileID)),oa&&(vi.activeTexture.set(or.TEXTURE0),L.imageManager.bind(L.context));for(const mh of _l){const wh=mh.toUnwrapped(),Sh=X?mh.projMatrix:L.transform.calculateProjMatrix(wh);L.prepareDrawTile();const Oh=p?p.getTile(mh):xh?xh[mh.key]:new s.Tile(mh,ia,Gn.zoom,L),Uh=oa?X0(Sh,kt,L,oa,{tileID:mh,tileSize:ia}):Z0(Sh,kt,ze);L.prepareDrawProgram(vi,_h,wh);const{tileBoundsBuffer:Vh,tileBoundsIndexBuffer:Wh,tileBoundsSegments:Zh}=L.getTileBoundsBuffers(Oh);_h.draw(vi,or.TRIANGLES,gh,lh,yh,s.CullFaceMode.disabled,Uh,S.id,Vh,Wh,Zh)}},sky:function(L,p,S){const X=L.transform,ze=X.projection.name==="mercator"||X.projection.name==="globe"?1:s.smoothstep(7,8,X.zoom),kt=S.paint.get("sky-opacity")*ze;if(kt===0)return;const vi=L.context,or=S.paint.get("sky-type"),Gn=new s.DepthMode(vi.gl.LEQUAL,s.DepthMode.ReadOnly,[0,1]),ia=L.frameCounter/1e3%1;or==="atmosphere"?L.renderPass==="offscreen"?S.needsSkyboxCapture(L)&&(function(oa,pl,lh,gh){const yh=oa.context,_h=yh.gl;let xh=pl.skyboxFbo;if(!xh){xh=pl.skyboxFbo=yh.createFramebuffer(32,32,!1),pl.skyboxGeometry=new _0(yh),pl.skyboxTexture=yh.gl.createTexture(),_h.bindTexture(_h.TEXTURE_CUBE_MAP,pl.skyboxTexture),_h.texParameteri(_h.TEXTURE_CUBE_MAP,_h.TEXTURE_WRAP_S,_h.CLAMP_TO_EDGE),_h.texParameteri(_h.TEXTURE_CUBE_MAP,_h.TEXTURE_WRAP_T,_h.CLAMP_TO_EDGE),_h.texParameteri(_h.TEXTURE_CUBE_MAP,_h.TEXTURE_MIN_FILTER,_h.LINEAR),_h.texParameteri(_h.TEXTURE_CUBE_MAP,_h.TEXTURE_MAG_FILTER,_h.LINEAR);for(let Sh=0;Sh<6;++Sh)_h.texImage2D(_h.TEXTURE_CUBE_MAP_POSITIVE_X+Sh,0,_h.RGBA,32,32,0,_h.RGBA,_h.UNSIGNED_BYTE,null)}yh.bindFramebuffer.set(xh.framebuffer),yh.viewport.set([0,0,32,32]);const _l=pl.getCenter(oa,!0),mh=oa.useProgram("skyboxCapture"),wh=new Float64Array(16);s.identity(wh),s.rotateY(wh,wh,.5*-Math.PI),sp(yh,pl,mh,wh,_l,0),s.identity(wh),s.rotateY(wh,wh,.5*Math.PI),sp(yh,pl,mh,wh,_l,1),s.identity(wh),s.rotateX(wh,wh,.5*-Math.PI),sp(yh,pl,mh,wh,_l,2),s.identity(wh),s.rotateX(wh,wh,.5*Math.PI),sp(yh,pl,mh,wh,_l,3),s.identity(wh),sp(yh,pl,mh,wh,_l,4),s.identity(wh),s.rotateY(wh,wh,Math.PI),sp(yh,pl,mh,wh,_l,5),yh.viewport.set([0,0,oa.width,oa.height])}(L,S),S.markSkyboxValid(L)):L.renderPass==="sky"&&function(oa,pl,lh,gh,yh){const _h=oa.context,xh=_h.gl,_l=oa.transform,mh=oa.useProgram("skybox");_h.activeTexture.set(xh.TEXTURE0),xh.bindTexture(xh.TEXTURE_CUBE_MAP,pl.skyboxTexture);const wh=((Sh,Oh,Uh,Vh,Wh)=>({u_matrix:Sh,u_sun_direction:Oh,u_cubemap:0,u_opacity:Vh,u_temporal_offset:Wh}))(_l.skyboxMatrix,pl.getCenter(oa,!1),0,gh,yh);oa.prepareDrawProgram(_h,mh),mh.draw(_h,xh.TRIANGLES,lh,s.StencilMode.disabled,oa.colorModeForRenderPass(),s.CullFaceMode.backCW,wh,"skybox",pl.skyboxGeometry.vertexBuffer,pl.skyboxGeometry.indexBuffer,pl.skyboxGeometry.segment)}(L,S,Gn,kt,ia):or==="gradient"&&L.renderPass==="sky"&&function(oa,pl,lh,gh,yh){const _h=oa.context,xh=_h.gl,_l=oa.transform,mh=oa.useProgram("skyboxGradient");pl.skyboxGeometry||(pl.skyboxGeometry=new _0(_h)),_h.activeTexture.set(xh.TEXTURE0);let wh=pl.colorRampTexture;wh||(wh=pl.colorRampTexture=new s.Texture(_h,pl.colorRamp,xh.RGBA)),wh.bind(xh.LINEAR,xh.CLAMP_TO_EDGE);const Sh=((Oh,Uh,Vh,Wh,Zh)=>({u_matrix:Oh,u_color_ramp:0,u_center_direction:Uh,u_radius:s.degToRad(Vh),u_opacity:Wh,u_temporal_offset:Zh}))(_l.skyboxMatrix,pl.getCenter(oa,!1),pl.paint.get("sky-gradient-radius"),gh,yh);oa.prepareDrawProgram(_h,mh),mh.draw(_h,xh.TRIANGLES,lh,s.StencilMode.disabled,oa.colorModeForRenderPass(),s.CullFaceMode.backCW,Sh,"skyboxGradient",pl.skyboxGeometry.vertexBuffer,pl.skyboxGeometry.indexBuffer,pl.skyboxGeometry.segment)}(L,S,Gn,kt,ia)},debug:function(L,p,S){for(let X=0;X<S.length;X++)kv(L,p,S[X])},custom:function(L,p,S,X){const ze=L.context,kt=S.implementation;if(!L.transform.projection.unsupportedLayers||!L.transform.projection.unsupportedLayers.includes("custom")||L.terrain&&(L.terrain.renderingToTexture||L.renderPass==="offscreen")&&S.isLayerDraped()){if(L.renderPass==="offscreen"){const vi=kt.prerender;if(vi){if(L.setCustomLayerDefaults(),ze.setColorMode(L.colorModeForRenderPass()),L.transform.projection.name==="globe"){const or=L.transform.pointMerc;vi.call(kt,ze.gl,L.transform.customLayerMatrix(),L.transform.getProjection(),L.transform.globeToMercatorMatrix(),s.globeToMercatorTransition(L.transform.zoom),[or.x,or.y],L.transform.pixelsPerMeterRatio)}else vi.call(kt,ze.gl,L.transform.customLayerMatrix());ze.setDirty(),L.setBaseState()}}else if(L.renderPass==="translucent"){if(L.terrain&&L.terrain.renderingToTexture){const or=kt.renderToTile;if(or){const Gn=X[0].canonical,ia=new s.MercatorCoordinate(Gn.x+X[0].wrap*(1<<Gn.z),Gn.y,Gn.z);ze.setDepthMode(s.DepthMode.disabled),ze.setStencilMode(s.StencilMode.disabled),ze.setColorMode(L.colorModeForRenderPass()),L.setCustomLayerDefaults(),or.call(kt,ze.gl,ia),ze.setDirty(),L.setBaseState()}return}L.setCustomLayerDefaults(),ze.setColorMode(L.colorModeForRenderPass()),ze.setStencilMode(s.StencilMode.disabled);const vi=kt.renderingMode==="3d"?new s.DepthMode(L.context.gl.LEQUAL,s.DepthMode.ReadWrite,L.depthRangeFor3D):L.depthModeForSublayer(0,s.DepthMode.ReadOnly);if(ze.setDepthMode(vi),L.transform.projection.name==="globe"){const or=L.transform.pointMerc;kt.render(ze.gl,L.transform.customLayerMatrix(),L.transform.getProjection(),L.transform.globeToMercatorMatrix(),s.globeToMercatorTransition(L.transform.zoom),[or.x,or.y],L.transform.pixelsPerMeterRatio)}else kt.render(ze.gl,L.transform.customLayerMatrix());ze.setDirty(),L.setBaseState(),ze.bindFramebuffer.set(null)}}else s.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class ey{constructor(p,S,X=!1){this.context=new ul(p,X),this.transform=S,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=s.SourceCache.maxUnderzooming+s.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(p,S){const X=!!p&&!!p.terrain&&this.transform.projection.supportsTerrain;if(!(X||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Pv(this,p));const ze=this._terrain;this.transform.elevation=X?ze:null,ze.update(p,this.transform,S)}_updateFog(p){const S=p.fog;if(!S||this.transform.projection.name==="globe"||S.getOpacity(this.transform.pitch)<1||S.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[X,ze]=S.getFovAdjustedRange(this.transform._fov);if(X>ze)return void(this.transform.fogCullDistSq=null);const kt=X+.78*(ze-X);this.transform.fogCullDistSq=kt*kt}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(p,S){if(this.width=p*s.exported.devicePixelRatio,this.height=S*s.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const X of this.style.order)this.style._layers[X].resize()}setup(){const p=this.context,S=new s.StructArrayLayout2i4;S.emplaceBack(0,0),S.emplaceBack(s.EXTENT,0),S.emplaceBack(0,s.EXTENT),S.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=p.createVertexBuffer(S,s.posAttributes.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);const X=new s.StructArrayLayout2i4;X.emplaceBack(0,0),X.emplaceBack(s.EXTENT,0),X.emplaceBack(0,s.EXTENT),X.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=p.createVertexBuffer(X,s.posAttributes.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);const ze=new s.StructArrayLayout2i4;ze.emplaceBack(-1,-1),ze.emplaceBack(1,-1),ze.emplaceBack(-1,1),ze.emplaceBack(1,1),this.viewportBuffer=p.createVertexBuffer(ze,s.posAttributes.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);const kt=new s.StructArrayLayout4i8;kt.emplaceBack(0,0,0,0),kt.emplaceBack(s.EXTENT,0,s.EXTENT,0),kt.emplaceBack(0,s.EXTENT,0,s.EXTENT),kt.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.mercatorBoundsBuffer=p.createVertexBuffer(kt,s.boundsAttributes.members),this.mercatorBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);const vi=new s.StructArrayLayout3ui6;vi.emplaceBack(0,1,2),vi.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=p.createIndexBuffer(vi);const or=new s.StructArrayLayout1ui2;for(const ia of[0,1,3,2,0])or.emplaceBack(ia);this.debugIndexBuffer=p.createIndexBuffer(or),this.emptyTexture=new s.Texture(p,new s.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),p.gl.RGBA),this.identityMat=s.create();const Gn=this.context.gl;this.stencilClearMode=new s.StencilMode({func:Gn.ALWAYS,mask:0},0,255,Gn.ZERO,Gn.ZERO,Gn.ZERO),this.loadTimeStamps.push(s.window.performance.now()),this.atmosphereBuffer=new J0(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(p){return p._makeTileBoundsBuffers(this.context,this.transform.projection),p._tileBoundsBuffer?{tileBoundsBuffer:p._tileBoundsBuffer,tileBoundsIndexBuffer:p._tileBoundsIndexBuffer,tileBoundsSegments:p._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const p=this.context,S=p.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(p,S.TRIANGLES,s.DepthMode.disabled,this.stencilClearMode,s.ColorMode.disabled,s.CullFaceMode.disabled,jy(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(p,S,X){if(!S||this.currentStencilSource===S.id||!p.isTileClipped()||!X||X.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let or=!1;for(const Gn of X)if(this._tileClippingMaskIDs[Gn.key]===void 0){or=!0;break}if(!or)return}this.currentStencilSource=S.id;const ze=this.context,kt=ze.gl;this.nextStencilID+X.length>256&&this.clearStencil(),ze.setColorMode(s.ColorMode.disabled),ze.setDepthMode(s.DepthMode.disabled);const vi=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const or of X){const Gn=S.getTile(or),ia=this._tileClippingMaskIDs[or.key]=this.nextStencilID++,{tileBoundsBuffer:oa,tileBoundsIndexBuffer:pl,tileBoundsSegments:lh}=this.getTileBoundsBuffers(Gn);vi.draw(ze,kt.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:kt.ALWAYS,mask:0},ia,255,kt.KEEP,kt.KEEP,kt.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,jy(or.projMatrix),"$clipping",oa,pl,lh)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const p=this.nextStencilID++,S=this.context.gl;return new s.StencilMode({func:S.NOTEQUAL,mask:255},p,255,S.KEEP,S.KEEP,S.REPLACE)}stencilModeForClipping(p){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(p);const S=this.context.gl;return new s.StencilMode({func:S.EQUAL,mask:255},this._tileClippingMaskIDs[p.key],0,S.KEEP,S.KEEP,S.REPLACE)}stencilConfigForOverlap(p){const S=this.context.gl,X=p.sort((vi,or)=>or.overscaledZ-vi.overscaledZ),ze=X[X.length-1].overscaledZ,kt=X[0].overscaledZ-ze+1;if(kt>1){this.currentStencilSource=void 0,this.nextStencilID+kt>256&&this.clearStencil();const vi={};for(let or=0;or<kt;or++)vi[or+ze]=new s.StencilMode({func:S.GEQUAL,mask:255},or+this.nextStencilID,255,S.KEEP,S.KEEP,S.REPLACE);return this.nextStencilID+=kt,[vi,X]}return[{[ze]:s.StencilMode.disabled},X]}colorModeForRenderPass(){const p=this.context.gl;return this._showOverdrawInspector?new s.ColorMode([p.CONSTANT_COLOR,p.ONE],new s.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?s.ColorMode.unblended:s.ColorMode.alphaBlended}depthModeForSublayer(p,S,X){if(!this.opaquePassEnabledForLayer())return s.DepthMode.disabled;const ze=1-((1+this.currentLayer)*this.numSublayers+p)*this.depthEpsilon;return new s.DepthMode(X||this.context.gl.LEQUAL,S,[ze,ze])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(p,S){this.style=p,this.options=S,this.imageManager=p.imageManager,this.glyphManager=p.glyphManager,this.symbolFadeChange=p.placement.symbolFadeChange(s.exported.now()),this.imageManager.beginFrame();const X=this.style.order,ze=this.style._sourceCaches;for(const ia in ze){const oa=ze[ia];oa.used&&oa.prepare(this.context)}const kt={},vi={},or={};for(const ia in ze){const oa=ze[ia];kt[ia]=oa.getVisibleCoordinates(),vi[ia]=kt[ia].slice().reverse(),or[ia]=oa.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let ia=0;ia<X.length;ia++)if(this.style._layers[X[ia]].is3D()){this.opaquePassCutoff=ia;break}if(this.terrain&&(this.terrain.updateTileBinding(or),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.GlobeSharedBuffers(this.context)),!s.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const ia of X){const oa=this.style._layers[ia],pl=p._getLayerSourceCache(oa);if(!oa.hasOffscreenPass()||oa.isHidden(this.transform.zoom))continue;const lh=pl?vi[pl.id]:void 0;(oa.type==="custom"||oa.isSky()||lh&&lh.length)&&this.renderLayer(this,pl,oa,lh)}this.depthRangeFor3D=[0,1-(p.order.length+2)*this.numSublayers*this.depthEpsilon];const Gn=this.terrain;if(Gn&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&Gn.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:S.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=S.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=X.length-1;this.currentLayer>=0;this.currentLayer--){const ia=this.style._layers[X[this.currentLayer]],oa=p._getLayerSourceCache(ia);if(ia.isSky())continue;const pl=oa?vi[oa.id]:void 0;this._renderTileClippingMasks(ia,oa,pl),this.renderLayer(this,oa,ia,pl)}if(this.style.fog&&this.transform.projection.supportsFog&&function(ia,oa){const pl=ia.context,lh=pl.gl,gh=ia.transform,yh=new s.DepthMode(lh.LEQUAL,s.DepthMode.ReadOnly,[0,1]),_h=ia.useProgram("globeAtmosphere",null,gh.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),xh=s.globeToMercatorTransition(gh.zoom),_l=oa.properties.get("color").toArray01(),mh=oa.properties.get("high-color").toArray01(),wh=oa.properties.get("space-color").toArray01PremultipliedAlpha(),Sh=s.identity$1([]);s.rotateY$1(Sh,Sh,-s.degToRad(gh._center.lng)),s.rotateX$1(Sh,Sh,s.degToRad(gh._center.lat)),s.rotateZ$1(Sh,Sh,gh.angle),s.rotateX$1(Sh,Sh,-gh._pitch);const Oh=s.fromQuat(new Float32Array(16),Sh),Uh=s.mapValue(oa.properties.get("star-intensity"),0,1,0,.25),Vh=5e-4,Wh=s.mapValue(oa.properties.get("horizon-blend"),0,1,Vh,.25),Zh=s.globeUseCustomAntiAliasing(ia,pl,gh)&&Wh===Vh?gh.worldSize/(2*Math.PI*1.025)-1:gh.globeRadius,id=ia.frameCounter/1e3%1,Bd=s.length(gh.globeCenterInViewSpace),ed=Math.sqrt(Math.pow(Bd,2)-Math.pow(Zh,2)),Sd=Math.acos(ed/Bd),dd=((nd,vd,Od,Id,$d,Gp,Hf,Mp,Zp,rg,Jf,Bp,fg,Sg)=>({u_frustum_tl:nd,u_frustum_tr:vd,u_frustum_br:Od,u_frustum_bl:Id,u_horizon:$d,u_transition:Gp,u_fadeout_range:Hf,u_color:Mp,u_high_color:Zp,u_space_color:rg,u_star_intensity:Jf,u_star_size:5*s.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Bp,u_horizon_angle:fg,u_rotation_matrix:Sg}))(gh.frustumCorners.TL,gh.frustumCorners.TR,gh.frustumCorners.BR,gh.frustumCorners.BL,gh.frustumCorners.horizon,xh,Wh,_l,mh,wh,Uh,id,Sd,Oh);ia.prepareDrawProgram(pl,_h);const xd=ia.atmosphereBuffer;xd&&_h.draw(pl,lh.TRIANGLES,yh,s.StencilMode.disabled,s.ColorMode.alphaBlended,s.CullFaceMode.backCW,dd,"skybox",xd.vertexBuffer,xd.indexBuffer,xd.segments)}(this,this.style.fog),this.renderPass="sky",(s.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<X.length;this.currentLayer++){const ia=this.style._layers[X[this.currentLayer]],oa=p._getLayerSourceCache(ia);ia.isSky()&&this.renderLayer(this,oa,ia,oa?vi[oa.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<X.length;){const ia=this.style._layers[X[this.currentLayer]],oa=p._getLayerSourceCache(ia);if(ia.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(ia)){if(ia.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const pl=oa?(ia.type==="symbol"?or:vi)[oa.id]:void 0;this._renderTileClippingMasks(ia,oa,oa?kt[oa.id]:void 0),this.renderLayer(this,oa,ia,pl),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ia=null;s.values(this.style._layers).forEach(oa=>{const pl=p._getLayerSourceCache(oa);pl&&!oa.isHidden(this.transform.zoom)&&(!ia||ia.getSource().maxzoom<pl.getSource().maxzoom)&&(ia=pl)}),ia&&this.options.showTileBoundaries&&yy.debug(this,ia,ia.getVisibleCoordinates())}this.options.showPadding&&function(ia){const oa=ia.transform.padding;Bv(ia,ia.transform.height-(oa.top||0),3,Vg),Bv(ia,oa.bottom||0,3,my),l_(ia,oa.left||0,3,xw),l_(ia,ia.transform.width-(oa.right||0),3,ww);const pl=ia.transform.centerPoint;(function(lh,gh,yh,_h){Tp(lh,gh-1,yh-10,2,20,_h),Tp(lh,gh-10,yh-1,20,2,_h)})(ia,pl.x,ia.transform.height-pl.y,bw)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(s.window.performance.now()),this.saveCanvasCopy())}renderLayer(p,S,X,ze){X.isHidden(this.transform.zoom)||(X.type==="background"||X.type==="sky"||X.type==="custom"||ze&&ze.length)&&(this.id=X.id,this.gpuTimingStart(X),(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes(X.type)||p.terrain&&X.type==="custom")&&yy[X.type](p,S,X,ze,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(p){if(!this.options.gpuTiming)return;const S=this.context.extTimerQuery;let X=this.gpuTimers[p.id];X||(X=this.gpuTimers[p.id]={calls:0,cpuTime:0,query:S.createQueryEXT()}),X.calls++,S.beginQueryEXT(S.TIME_ELAPSED_EXT,X.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const p=this.context.extTimerQuery,S=p.createQueryEXT();this.deferredRenderGpuTimeQueries.push(S),p.beginQueryEXT(p.TIME_ELAPSED_EXT,S)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const p=this.context.extTimerQuery;p.endQueryEXT(p.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const p=this.context.extTimerQuery;p.endQueryEXT(p.TIME_ELAPSED_EXT)}collectGpuTimers(){const p=this.gpuTimers;return this.gpuTimers={},p}collectDeferredRenderGpuQueries(){const p=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],p}queryGpuTimers(p){const S={};for(const X in p){const ze=p[X],kt=this.context.extTimerQuery,vi=kt.getQueryObjectEXT(ze.query,kt.QUERY_RESULT_EXT)/1e6;kt.deleteQueryEXT(ze.query),S[X]=vi}return S}queryGpuTimeDeferredRender(p){if(!this.options.gpuTimingDeferredRender)return 0;const S=this.context.extTimerQuery;let X=0;for(const ze of p)X+=S.getQueryObjectEXT(ze,S.QUERY_RESULT_EXT)/1e6,S.deleteQueryEXT(ze);return X}translatePosMatrix(p,S,X,ze,kt){if(!X[0]&&!X[1])return p;const vi=kt?ze==="map"?this.transform.angle:0:ze==="viewport"?-this.transform.angle:0;if(vi){const ia=Math.sin(vi),oa=Math.cos(vi);X=[X[0]*oa-X[1]*ia,X[0]*ia+X[1]*oa]}const or=[kt?X[0]:Ud(S,X[0],this.transform.zoom),kt?X[1]:Ud(S,X[1],this.transform.zoom),0],Gn=new Float32Array(16);return s.translate(Gn,p,or),Gn}saveTileTexture(p){const S=this._tileTextures[p.size[0]];S?S.push(p):this._tileTextures[p.size[0]]=[p]}getTileTexture(p){const S=this._tileTextures[p];return S&&S.length>0?S.pop():null}isPatternMissing(p){return p===null||p!==void 0&&!this.imageManager.getPattern(p.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const p=this.terrain&&this.terrain.renderingToTexture,S=this.terrain&&this.terrain.exaggeration()===0,X=this.style&&this.style.fog,ze=[];return this.terrainRenderModeElevated()&&ze.push("TERRAIN"),this.transform.projection.name==="globe"&&ze.push("GLOBE"),S&&ze.push("ZERO_EXAGGERATION"),X&&!p&&X.getOpacity(this.transform.pitch)!==0&&ze.push("FOG"),p&&ze.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&ze.push("OVERDRAW_INSPECTOR"),ze}useProgram(p,S,X){this.cache=this.cache||{};const ze=X||[],kt=this.currentGlobalDefines().concat(ze),vi=Hp.cacheKey(u0[p],p,kt,S);return this.cache[vi]||(this.cache[vi]=new Hp(this.context,p,u0[p],S,v_[p],kt)),this.cache[vi]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const p=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(p.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(p,S,X){if(this.terrain&&this.terrain.renderingToTexture)return;const ze=this.style.fog;if(ze){const kt=ze.getOpacity(this.transform.pitch),vi=((or,Gn,ia,oa,pl,lh,gh,yh,_h,xh,_l)=>{const mh=or.transform,wh=Gn.properties.get("color").toArray01();wh[3]=oa;const Sh=or.frameCounter/1e3%1;return{u_fog_matrix:ia?mh.calculateFogTileMatrix(ia):or.identityMat,u_fog_range:Gn.getFovAdjustedRange(mh._fov),u_fog_color:wh,u_fog_horizon_blend:Gn.properties.get("horizon-blend"),u_fog_temporal_offset:Sh,u_frustum_tl:pl,u_frustum_tr:lh,u_frustum_br:gh,u_frustum_bl:yh,u_globe_pos:_h,u_globe_radius:xh,u_viewport:_l,u_globe_transition:s.globeToMercatorTransition(mh.zoom),u_is_globe:+(mh.projection.name==="globe")}})(this,ze,X,kt,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.exported.devicePixelRatio,this.transform.height*s.exported.devicePixelRatio]);S.setFogUniformValues(p,vi)}}setTileLoadedFlag(p){this.tileLoaded=p}saveCanvasCopy(){const p=this.canvasCopy();p&&(this.frameCopies.push(p),this.tileLoaded=!1)}canvasCopy(){const p=this.context.gl,S=p.createTexture();return p.bindTexture(p.TEXTURE_2D,S),p.copyTexImage2D(p.TEXTURE_2D,0,p.RGBA,0,0,p.drawingBufferWidth,p.drawingBufferHeight,0),S}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const p=this.style&&this.style.fog;return!!p&&p.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const p=this._backgroundTiles,S=this._backgroundTiles={},X=this.transform.coveringTiles({tileSize:512});for(const ze of X)S[ze.key]=p[ze.key]||new s.Tile(ze,512,this.transform.tileZoom,this);return S}clearBackgroundTiles(){this._backgroundTiles={}}}class y0{constructor(p=0,S=0,X=0,ze=0){if(isNaN(p)||p<0||isNaN(S)||S<0||isNaN(X)||X<0||isNaN(ze)||ze<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=p,this.bottom=S,this.left=X,this.right=ze}interpolate(p,S,X){return S.top!=null&&p.top!=null&&(this.top=s.number(p.top,S.top,X)),S.bottom!=null&&p.bottom!=null&&(this.bottom=s.number(p.bottom,S.bottom,X)),S.left!=null&&p.left!=null&&(this.left=s.number(p.left,S.left,X)),S.right!=null&&p.right!=null&&(this.right=s.number(p.right,S.right,X)),this}getCenter(p,S){const X=s.clamp((this.left+p-this.right)/2,0,p),ze=s.clamp((this.top+S-this.bottom)/2,0,S);return new s.Point(X,ze)}equals(p){return this.top===p.top&&this.bottom===p.bottom&&this.left===p.left&&this.right===p.right}clone(){return new y0(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ev(L,p){const S=s.getColumn(L,3);s.fromQuat(L,p),s.setColumn(L,3,S)}function og(L,p){const S=s.identity$1([]);return s.rotateZ$1(S,S,-p),s.rotateX$1(S,S,-L),S}function zv(L,p){const S=[L[0],L[1],0],X=[p[0],p[1],0];if(s.length(S)>=1e-15){const vi=s.normalize([],S);s.scale$2(X,vi,s.dot(X,vi)),p[0]=X[0],p[1]=X[1]}const ze=s.cross([],p,L);if(s.len(ze)<1e-15)return null;const kt=Math.atan2(-ze[1],ze[0]);return og(Math.atan2(Math.sqrt(L[0]*L[0]+L[1]*L[1]),-L[2]),kt)}class Q0{constructor(p,S){this.position=p,this.orientation=S}get position(){return this._position}set position(p){if(p){const S=p instanceof s.MercatorCoordinate?p:new s.MercatorCoordinate(p[0],p[1],p[2]);this._renderWorldCopies&&(S.x=s.wrap(S.x,0,1)),this._position=S}else this._position=null}lookAtPoint(p,S){if(this.orientation=null,!this.position)return;const X=this.position,ze=this._elevation?this._elevation.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(p)):0,kt=s.MercatorCoordinate.fromLngLat(p,ze),vi=[kt.x-X.x,kt.y-X.y,kt.z-X.z];S||(S=[0,0,1]),S[2]=Math.abs(S[2]),this.orientation=zv(vi,S)}setPitchBearing(p,S){this.orientation=og(s.degToRad(p),s.degToRad(-S))}}class tv{constructor(p,S){this._transform=s.identity([]),this.orientation=S,this.position=p}get mercatorPosition(){const p=this.position;return new s.MercatorCoordinate(p[0],p[1],p[2])}get position(){const p=s.getColumn(this._transform,3);return[p[0],p[1],p[2]]}set position(p){var S;p&&s.setColumn(this._transform,3,[(S=p)[0],S[1],S[2],1])}get orientation(){return this._orientation}set orientation(p){this._orientation=p||s.identity$1([]),p&&ev(this._transform,this._orientation)}getPitchBearing(){const p=this.forward(),S=this.right();return{bearing:Math.atan2(-S[1],S[0]),pitch:Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2])}}setPitchBearing(p,S){this._orientation=og(p,S),ev(this._transform,this._orientation)}forward(){const p=s.getColumn(this._transform,2);return[-p[0],-p[1],-p[2]]}up(){const p=s.getColumn(this._transform,1);return[-p[0],-p[1],-p[2]]}right(){const p=s.getColumn(this._transform,0);return[p[0],p[1],p[2]]}getCameraToWorld(p,S){const X=new Float64Array(16);return s.invert(X,this.getWorldToCamera(p,S)),X}getWorldToCameraPosition(p,S,X){const ze=this.position;s.scale$2(ze,ze,-p);const kt=new Float64Array(16);return s.fromScaling(kt,[X,X,X]),s.translate(kt,kt,ze),kt[10]*=S,kt}getWorldToCamera(p,S){const X=new Float64Array(16),ze=new Float64Array(4),kt=this.position;return s.conjugate(ze,this._orientation),s.scale$2(kt,kt,-p),s.fromQuat(X,ze),s.translate(X,X,kt),X[1]*=-1,X[5]*=-1,X[9]*=-1,X[13]*=-1,X[8]*=S,X[9]*=S,X[10]*=S,X[11]*=S,X}getCameraToClipPerspective(p,S,X,ze){const kt=new Float64Array(16);return s.perspective(kt,p,S,X,ze),kt}getDistanceToElevation(p,S=!1){const X=p===0?0:s.mercatorZfromAltitude(p,S?s.latFromMercatorY(this.position[1]):this.position[1]),ze=this.forward();return(X-this.position[2])/ze[2]}clone(){return new tv([...this.position],[...this.orientation])}}function vy(L,p){const S=Tm(L.projection,L.zoom,L.width,L.height),X=function(kt,vi,or,Gn,ia){const oa=new s.LngLat(or.lng-180*km,or.lat),pl=new s.LngLat(or.lng+180*km,or.lat),lh=kt.project(oa.lng,oa.lat),gh=kt.project(pl.lng,pl.lat),yh=-Math.atan2(gh.y-lh.y,gh.x-lh.x),_h=s.MercatorCoordinate.fromLngLat(or);_h.y=s.clamp(_h.y,-1+km,1-km);const xh=_h.toLngLat(),_l=kt.project(xh.lng,xh.lat),mh=s.MercatorCoordinate.fromLngLat(xh);mh.x+=km;const wh=mh.toLngLat(),Sh=kt.project(wh.lng,wh.lat),Oh=Uv(Sh.x-_l.x,Sh.y-_l.y,yh),Uh=s.MercatorCoordinate.fromLngLat(xh);Uh.y+=km;const Vh=Uh.toLngLat(),Wh=kt.project(Vh.lng,Vh.lat),Zh=Uv(Wh.x-_l.x,Wh.y-_l.y,yh),id=Math.abs(Oh.x)/Math.abs(Zh.y),Bd=s.identity([]);s.rotateZ(Bd,Bd,-yh*(1-(ia?0:Gn)));const ed=s.identity([]);return s.scale(ed,ed,[1,1-(1-id)*Gn,1]),ed[4]=-Zh.x/Zh.y*Gn,s.rotateZ(ed,ed,yh),s.multiply(ed,Bd,ed),ed}(L.projection,0,L.center,S,p),ze=Vv(L);return s.scale(X,X,[ze,ze,1]),X}function Vv(L){const p=L.projection,S=Tm(L.projection,L.zoom,L.width,L.height),X=Sx(p,L.center),ze=Sx(p,s.LngLat.convert(p.center));return Math.pow(2,X*S+(1-S)*ze)}function Tm(L,p,S,X,ze=1/0){const kt=L.range;if(!kt)return 0;const vi=Math.min(ze,Math.max(S,X)),or=Math.log(vi/1024)/Math.LN2;return s.smoothstep(kt[0]+or,kt[1]+or,p)}const km=1/4e4;function Sx(L,p){const S=s.clamp(p.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),X=new s.LngLat(p.lng-180*km,S),ze=new s.LngLat(p.lng+180*km,S),kt=L.project(X.lng,S),vi=L.project(ze.lng,S),or=s.MercatorCoordinate.fromLngLat(X),Gn=s.MercatorCoordinate.fromLngLat(ze),ia=vi.x-kt.x,oa=vi.y-kt.y,pl=Gn.x-or.x,lh=Gn.y-or.y,gh=Math.sqrt((pl*pl+lh*lh)/(ia*ia+oa*oa));return Math.log(gh)/Math.LN2}function Uv(L,p,S){const X=Math.cos(S),ze=Math.sin(S);return{x:L*X-p*ze,y:L*ze+p*X}}class ty{constructor(p,S,X,ze,kt,vi,or){this.tileSize=512,this._renderWorldCopies=kt===void 0||kt,this._minZoom=p||0,this._maxZoom=S||22,this._minPitch=X??0,this._maxPitch=ze??60,this.setProjection(vi),this.setMaxBounds(or),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new y0,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new tv,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const p=new ty(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return p._elevation=this._elevation,p._centerAltitude=this._centerAltitude,p._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,p.tileSize=this.tileSize,p.mercatorFromTransition=this.mercatorFromTransition,p.width=this.width,p.height=this.height,p.cameraElevationReference=this.cameraElevationReference,p._center=this._center,p._setZoom(this.zoom),p._seaLevelZoom=this._seaLevelZoom,p.angle=this.angle,p._fov=this._fov,p._pitch=this._pitch,p._nearZ=this._nearZ,p._farZ=this._farZ,p._averageElevation=this._averageElevation,p._unmodified=this._unmodified,p._edgeInsets=this._edgeInsets.clone(),p._camera=this._camera.clone(),p._calcMatrices(),p.freezeTileCoverage=this.freezeTileCoverage,p.frustumCorners=this.frustumCorners,p}get elevation(){return this._elevation}set elevation(p){this._elevation!==p&&(this._elevation=p,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(p,S=!1){const X=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||X)&&this._updateCameraOnTerrain(),(p||X)&&this._constrainCamera(S),this._calcMatrices()}getProjection(){return s.pick(this.projection,["name","center","parallels"])}setProjection(p){this.projectionOptions=p||{name:"mercator"};const S=this.projection?this.getProjection():void 0;this.projection=s.getProjection(this.projectionOptions);const X=!m(S,this.getProjection());return X&&this._calcMatrices(),this.mercatorFromTransition=!1,X}setMercatorFromTransition(){const p=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.getProjection({name:"mercator"});const S=p!==this.projection.name;return S&&this._calcMatrices(),S}get minZoom(){return this._minZoom}set minZoom(p){this._minZoom!==p&&(this._minZoom=p,this.zoom=Math.max(this.zoom,p))}get maxZoom(){return this._maxZoom}set maxZoom(p){this._maxZoom!==p&&(this._maxZoom=p,this.zoom=Math.min(this.zoom,p))}get minPitch(){return this._minPitch}set minPitch(p){this._minPitch!==p&&(this._minPitch=p,this.pitch=Math.max(this.pitch,p))}get maxPitch(){return this._maxPitch}set maxPitch(p){this._maxPitch!==p&&(this._maxPitch=p,this.pitch=Math.min(this.pitch,p))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(p){p===void 0?p=!0:p===null&&(p=!1),this._renderWorldCopies=p}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const p=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(p))}get cameraWorldSize(){const p=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(p))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.Point(this.width,this.height)}get bearing(){return s.wrap(this.rotation,-180,180)}set bearing(p){this.rotation=p}get rotation(){return-this.angle/Math.PI*180}set rotation(p){const S=-p*Math.PI/180;var X;this.angle!==S&&(this._unmodified=!1,this.angle=S,this._calcMatrices(),this.rotationMatrix=(X=new s.ARRAY_TYPE(4),s.ARRAY_TYPE!=Float32Array&&(X[1]=0,X[2]=0),X[0]=1,X[3]=1,X),function(ze,kt,vi){var or=kt[0],Gn=kt[1],ia=kt[2],oa=kt[3],pl=Math.sin(vi),lh=Math.cos(vi);ze[0]=or*lh+ia*pl,ze[1]=Gn*lh+oa*pl,ze[2]=or*-pl+ia*lh,ze[3]=Gn*-pl+oa*lh}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(p){const S=s.clamp(p,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==S&&(this._unmodified=!1,this._pitch=S,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const p=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/p)}set fov(p){p=Math.max(.01,Math.min(60,p)),this._fov!==p&&(this._unmodified=!1,this._fov=s.degToRad(p),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(p){this._averageElevation=p,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(p){const S=Math.min(Math.max(p,this.minZoom),this.maxZoom);this._zoom!==S&&(this._unmodified=!1,this._setZoom(S),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(p){this._zoom=p,this.scale=this.zoomScale(p),this.tileZoom=Math.floor(p),this.zoomFraction=p-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const p=this._elevation;this._centerAltitude=p.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=p.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const p=this._elevation,S=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],X=this.horizonLineFromTop();let ze=0,kt=0;for(let vi=0;vi<S.length;vi++){const or=new s.Point(S[vi][0]*this.width,X+S[vi][1]*(this.height-X)),Gn=p.pointCoordinate(or);if(!Gn)continue;const ia=1/Math.hypot(Gn[0]-this._camera.position[0],Gn[1]-this._camera.position[1]);ze+=Gn[3]*ia,kt+=ia}return kt===0?NaN:ze/kt}get center(){return this._center}set center(p){p.lat===this._center.lat&&p.lng===this._center.lng||(this._unmodified=!1,this._center=p,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const p=this._seaLevelZoom,S=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),X=this.pixelsPerMeter/this.worldSize*S,ze=this._mercatorZfromZoom(p),kt=this._mercatorZfromZoom(this._maxZoom),vi=Math.max(ze-X,kt);this._setZoom(this._zoomFromMercatorZ(vi))}get padding(){return this._edgeInsets.toJSON()}set padding(p){this._edgeInsets.equals(p)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,p,1),this._calcMatrices())}computeZoomRelativeTo(p){const S=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,p.toAltitude()));let X;X=p.z<this._camera.position[2]?[S.x,S.y,S.z]:[p.x,p.y,p.z];const ze=s.length(s.sub([],this._camera.position,X));return s.clamp(this._zoomFromMercatorZ(ze),this._minZoom,this._maxZoom)}setFreeCameraOptions(p){if(!this.height||!p.position&&!p.orientation)return;this._updateCameraState();let S=!1;if(p.orientation&&!s.exactEquals(p.orientation,this._camera.orientation)&&(S=this._setCameraOrientation(p.orientation)),p.position){const X=[p.position.x,p.position.y,p.position.z];s.exactEquals$1(X,this._camera.position)||(this._setCameraPosition(X),S=!0)}S&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const p=this._camera.position,S=new Q0;return S.position=new s.MercatorCoordinate(p[0],p[1],p[2]),S.orientation=this._camera.orientation,S._elevation=this.elevation,S._renderWorldCopies=this.renderWorldCopies,S}_setCameraOrientation(p){if(!s.length$1(p))return!1;s.normalize$1(p,p);const S=s.transformQuat([],[0,0,-1],p),X=s.transformQuat([],[0,-1,0],p);if(X[2]<0)return!1;const ze=zv(S,X);return!!ze&&(this._camera.orientation=ze,!0)}_setCameraPosition(p){const S=this.zoomScale(this.minZoom)*this.tileSize,X=this.zoomScale(this.maxZoom)*this.tileSize,ze=this.cameraToCenterDistance;p[2]=s.clamp(p[2],ze/X,ze/S),this._camera.position=p}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(p){return this._edgeInsets.equals(p)}interpolatePadding(p,S,X){this._unmodified=!1,this._edgeInsets.interpolate(p,S,X),this._constrain(),this._calcMatrices()}coveringZoomLevel(p){const S=(p.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/p.tileSize));return Math.max(0,S)}getVisibleUnwrappedCoordinates(p){const S=[new s.UnwrappedTileID(0,p)];if(this.renderWorldCopies){const X=this.pointCoordinate(new s.Point(0,0)),ze=this.pointCoordinate(new s.Point(this.width,0)),kt=this.pointCoordinate(new s.Point(this.width,this.height)),vi=this.pointCoordinate(new s.Point(0,this.height)),or=Math.floor(Math.min(X.x,ze.x,kt.x,vi.x)),Gn=Math.floor(Math.max(X.x,ze.x,kt.x,vi.x)),ia=1;for(let oa=or-ia;oa<=Gn+ia;oa++)oa!==0&&S.push(new s.UnwrappedTileID(oa,p))}return S}coveringTiles(p){let S=this.coveringZoomLevel(p);const X=S,ze=this.elevation&&!p.isTerrainDEM,kt=this.projection.name==="mercator";if(p.minzoom!==void 0&&S<p.minzoom)return[];p.maxzoom!==void 0&&S>p.maxzoom&&(S=p.maxzoom);const vi=this.locationCoordinate(this.center),or=this.center.lat,Gn=1<<S,ia=[Gn*vi.x,Gn*vi.y,0],oa=this.projection.name==="globe",pl=!oa,lh=s.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,S,pl),gh=oa?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),yh=Gn*s.mercatorZfromAltitude(1,this.center.lat),_h=this._camera.position[2]/s.mercatorZfromAltitude(1,this.center.lat),xh=[Gn*gh.x,Gn*gh.y,_h*(pl?1:yh)],_l=this.cameraToCenterDistance/p.tileSize*(p.roundZoom?1:.502),mh=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?S:0,wh=p.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,Sh=p.isTerrainDEM?-wh:this._elevation?this._elevation.getMinElevationBelowMSL():0,Oh=this.projection.isReprojectedInTileSpace?Vv(this):1,Uh=nd=>{const Od=new s.MercatorCoordinate(nd.x+25e-6,nd.y,nd.z),Id=new s.MercatorCoordinate(nd.x,nd.y+25e-6,nd.z),$d=nd.toLngLat(),Gp=Od.toLngLat(),Hf=Id.toLngLat(),Mp=this.locationCoordinate($d),Zp=this.locationCoordinate(Gp),rg=this.locationCoordinate(Hf),Jf=Math.hypot(Zp.x-Mp.x,Zp.y-Mp.y),Bp=Math.hypot(rg.x-Mp.x,rg.y-Mp.y);return Math.sqrt(Jf*Bp)*Oh/25e-6},Vh=nd=>{const vd=wh,Od=Sh;return{aabb:s.tileAABB(this,Gn,0,0,0,nd,Od,vd,this.projection),zoom:0,x:0,y:0,minZ:Od,maxZ:vd,wrap:nd,fullyVisible:!1}},Wh=[];let Zh=[];const id=S,Bd=p.reparseOverscaled?X:S,ed=nd=>nd*nd,Sd=ed((_h-this._centerAltitude)*yh),dd=nd=>{if(!this._elevation||!nd.tileID||!kt)return;const vd=this._elevation.getMinMaxForTile(nd.tileID),Od=nd.aabb;vd?(Od.min[2]=vd.min,Od.max[2]=vd.max,Od.center[2]=(Od.min[2]+Od.max[2])/2):(nd.shouldSplit=xd(nd),nd.shouldSplit||(Od.min[2]=Od.max[2]=Od.center[2]=this._centerAltitude))},xd=nd=>{if(nd.zoom<mh)return!0;if(nd.zoom===id)return!1;if(nd.shouldSplit!=null)return nd.shouldSplit;const vd=nd.aabb.distanceX(xh),Od=nd.aabb.distanceY(xh);let Id=Sd,$d=1;if(oa){Id=ed(nd.aabb.distanceZ(xh));const Mp=Math.pow(2,nd.zoom),Zp=s.latFromMercatorY((nd.y+1)/Mp),rg=s.latFromMercatorY(nd.y/Mp),Jf=Math.min(Math.max(or,Zp),rg),Bp=s.circumferenceAtLatitude(Jf)/s.circumferenceAtLatitude(or);if($d=Jf===or?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Bp/this._mercatorScaleRatio),this.zoom<=s.GLOBE_ZOOM_THRESHOLD_MIN&&nd.zoom===id-1&&Bp>=.9)return!0}else if(ze&&(Id=ed(nd.aabb.distanceZ(xh)*yh)),this.projection.isReprojectedInTileSpace&&X<=5){const Mp=Math.pow(2,nd.zoom),Zp=Uh(new s.MercatorCoordinate((nd.x+.5)/Mp,(nd.y+.5)/Mp));$d=Zp>.85?1:Zp}const Gp=vd*vd+Od*Od+Id,Hf=ed((1<<id-nd.zoom)*_l*$d*((Mp,Zp)=>{if(Zp*ed(.707)<Mp)return 1;const rg=Math.sqrt(Zp/Mp);return rg/(1.4144271570014144+(Math.pow(1.1,rg-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Id,Sd),Gp));return Gp<Hf};if(this.renderWorldCopies)for(let nd=1;nd<=3;nd++)Wh.push(Vh(-nd)),Wh.push(Vh(nd));for(Wh.push(Vh(0));Wh.length>0;){const nd=Wh.pop(),vd=nd.x,Od=nd.y;let Id=nd.fullyVisible;if(!Id){const $d=nd.aabb.intersects(lh);if($d===0)continue;Id=$d===2}if(nd.zoom!==id&&xd(nd))for(let $d=0;$d<4;$d++){const Gp=(vd<<1)+$d%2,Hf=(Od<<1)+($d>>1),Mp={aabb:kt?nd.aabb.quadrant($d):s.tileAABB(this,Gn,nd.zoom+1,Gp,Hf,nd.wrap,nd.minZ,nd.maxZ,this.projection),zoom:nd.zoom+1,x:Gp,y:Hf,wrap:nd.wrap,fullyVisible:Id,tileID:void 0,shouldSplit:void 0,minZ:nd.minZ,maxZ:nd.maxZ};ze&&!oa&&(Mp.tileID=new s.OverscaledTileID(nd.zoom+1===id?Bd:nd.zoom+1,nd.wrap,nd.zoom+1,Gp,Hf),dd(Mp)),Wh.push(Mp)}else{const $d=nd.zoom===id?Bd:nd.zoom;if(p.minzoom&&p.minzoom>$d)continue;const Gp=ia[0]-(.5+vd+(nd.wrap<<nd.zoom))*(1<<S-nd.zoom),Hf=ia[1]-.5-Od,Mp=nd.tileID?nd.tileID:new s.OverscaledTileID($d,nd.wrap,nd.zoom,vd,Od);Zh.push({tileID:Mp,distanceSq:Gp*Gp+Hf*Hf})}}if(this.fogCullDistSq){const nd=this.fogCullDistSq,vd=this.horizonLineFromTop();Zh=Zh.filter(Od=>{const Id=[0,0,0,1],$d=[s.EXTENT,s.EXTENT,0,1],Gp=this.calculateFogTileMatrix(Od.tileID.toUnwrapped());s.transformMat4$1(Id,Id,Gp),s.transformMat4$1($d,$d,Gp);const Hf=s.getAABBPointSquareDist(Id,$d);if(Hf===0)return!0;let Mp=!1;const Zp=this._elevation;if(Zp&&Hf>nd&&vd!==0){const rg=this.calculateProjMatrix(Od.tileID.toUnwrapped());let Jf;p.isTerrainDEM||(Jf=Zp.getMinMaxForTile(Od.tileID)),Jf||(Jf={min:Sh,max:wh});const Bp=s.furthestTileCorner(this.rotation),fg=[Bp[0]*s.EXTENT,Bp[1]*s.EXTENT,Jf.max];s.transformMat4(fg,fg,rg),Mp=(1-fg[1])*this.height*.5<vd}return Hf<nd||Mp})}return Zh.sort((nd,vd)=>nd.distanceSq-vd.distanceSq).map(nd=>nd.tileID)}resize(p,S){this.width=p,this.height=S,this.pixelsToGLUnits=[2/p,-2/S],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(p){return Math.pow(2,p)}scaleZoom(p){return Math.log(p)/Math.LN2}project(p){const S=s.clamp(p.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),X=this.projection.project(p.lng,S);return new s.Point(X.x*this.worldSize,X.y*this.worldSize)}unproject(p){return this.projection.unproject(p.x/this.worldSize,p.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(p,S){let X,ze;const kt=this.centerPoint;if(this.projection.name==="globe"){const or=this.worldSize;X=(S.x-kt.x)/or,ze=(S.y-kt.y)/or}else{const or=this.pointCoordinate(S),Gn=this.pointCoordinate(kt);X=or.x-Gn.x,ze=or.y-Gn.y}const vi=this.locationCoordinate(p);this.setLocation(new s.MercatorCoordinate(vi.x-X,vi.y-ze))}setLocation(p){this.center=this.coordinateLocation(p),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(p){return this.projection.locationPoint(this,p)}locationPoint3D(p){return this.projection.locationPoint(this,p,!0)}pointLocation(p){return this.coordinateLocation(this.pointCoordinate(p))}pointLocation3D(p){return this.coordinateLocation(this.pointCoordinate3D(p))}locationCoordinate(p,S){const X=S?s.mercatorZfromAltitude(S,p.lat):void 0,ze=this.projection.project(p.lng,p.lat);return new s.MercatorCoordinate(ze.x,ze.y,X)}coordinateLocation(p){return this.projection.unproject(p.x,p.y)}pointRayIntersection(p,S){const X=S??this._centerAltitude,ze=[p.x,p.y,0,1],kt=[p.x,p.y,1,1];s.transformMat4$1(ze,ze,this.pixelMatrixInverse),s.transformMat4$1(kt,kt,this.pixelMatrixInverse);const vi=kt[3];s.scale$1(ze,ze,1/ze[3]),s.scale$1(kt,kt,1/vi);const or=ze[2],Gn=kt[2];return{p0:ze,p1:kt,t:or===Gn?0:(X-or)/(Gn-or)}}screenPointToMercatorRay(p){const S=[p.x,p.y,0,1],X=[p.x,p.y,1,1];return s.transformMat4$1(S,S,this.pixelMatrixInverse),s.transformMat4$1(X,X,this.pixelMatrixInverse),s.scale$1(S,S,1/S[3]),s.scale$1(X,X,1/X[3]),S[2]=s.mercatorZfromAltitude(S[2],this._center.lat)*this.worldSize,X[2]=s.mercatorZfromAltitude(X[2],this._center.lat)*this.worldSize,s.scale$1(S,S,1/this.worldSize),s.scale$1(X,X,1/this.worldSize),new s.Ray([S[0],S[1],S[2]],s.normalize([],s.sub([],X,S)))}rayIntersectionCoordinate(p){const{p0:S,p1:X,t:ze}=p,kt=s.mercatorZfromAltitude(S[2],this._center.lat),vi=s.mercatorZfromAltitude(X[2],this._center.lat);return new s.MercatorCoordinate(s.number(S[0],X[0],ze)/this.worldSize,s.number(S[1],X[1],ze)/this.worldSize,s.number(kt,vi,ze))}pointCoordinate(p,S=this._centerAltitude){return this.projection.pointCoordinate(this,p.x,p.y,S)}pointCoordinate3D(p){if(!this.elevation)return this.pointCoordinate(p);let S=this.projection.pointCoordinate3D(this,p.x,p.y);if(S)return new s.MercatorCoordinate(S[0],S[1],S[2]);let X=0,ze=this.horizonLineFromTop();if(p.y>ze)return this.pointCoordinate(p);const kt=.02*ze,vi=p.clone();for(let or=0;or<10&&ze-X>kt;or++){vi.y=s.number(X,ze,.66);const Gn=this.projection.pointCoordinate3D(this,vi.x,vi.y);Gn?(ze=vi.y,S=Gn):X=vi.y}return S?new s.MercatorCoordinate(S[0],S[1],S[2]):this.pointCoordinate(p)}isPointAboveHorizon(p){return this.projection.isPointAboveHorizon(this,p)}isPointOnSurface(p){if(p.y<0||p.y>this.height||p.x<0||p.x>this.width)return!1;if(this.elevation||this.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(p);const S=this.pointCoordinate(p);return S.y>=0&&S.y<=1}_coordinatePoint(p,S){const X=S&&this.elevation?this.elevation.getAtPointOrZero(p,this._centerAltitude):this._centerAltitude,ze=[p.x*this.worldSize,p.y*this.worldSize,X+p.toAltitude(),1];return s.transformMat4$1(ze,ze,this.pixelMatrix),ze[3]>0?new s.Point(ze[0]/ze[3],ze[1]/ze[3]):new s.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:p,left:S}=this._edgeInsets,X=this.height-this._edgeInsets.bottom,ze=this.width-this._edgeInsets.right,kt=this.pointLocation3D(new s.Point(S,p)),vi=this.pointLocation3D(new s.Point(ze,p)),or=this.pointLocation3D(new s.Point(ze,X)),Gn=this.pointLocation3D(new s.Point(S,X));let ia=Math.min(kt.lng,vi.lng,or.lng,Gn.lng),oa=Math.max(kt.lng,vi.lng,or.lng,Gn.lng),pl=Math.min(kt.lat,vi.lat,or.lat,Gn.lat),lh=Math.max(kt.lat,vi.lat,or.lat,Gn.lat);const gh=Math.pow(2,-this.zoom)/16*270,yh=this.projection.name==="globe"?1:4,_h=(xh,_l,mh,wh,Sh)=>{const Oh=(xh+mh)/2,Uh=(_l+wh)/2,Vh=new s.Point(Oh,Uh),{lng:Wh,lat:Zh}=this.pointLocation3D(Vh),id=Math.max(0,ia-Wh,pl-Zh,Wh-oa,Zh-lh);ia=Math.min(ia,Wh),oa=Math.max(oa,Wh),pl=Math.min(pl,Zh),lh=Math.max(lh,Zh),(Sh<yh||id>gh)&&(_h(xh,_l,Oh,Uh,Sh+1),_h(Oh,Uh,mh,wh,Sh+1))};if(_h(S,p,ze,p,1),_h(ze,p,ze,X,1),_h(ze,X,S,X,1),_h(S,X,S,p,1),this.projection.name==="globe"){const[xh,_l]=s.polesInViewport(this);xh?(lh=90,oa=180,ia=-180):_l&&(pl=-90,oa=180,ia=-180)}return new s.LngLatBounds(new s.LngLat(ia,pl),new s.LngLat(oa,lh))}_getBoundsRectangular(p,S){const{top:X,left:ze}=this._edgeInsets,kt=this.height-this._edgeInsets.bottom,vi=this.width-this._edgeInsets.right,or=new s.Point(ze,X),Gn=new s.Point(vi,X),ia=new s.Point(vi,kt),oa=new s.Point(ze,kt);let pl=this.pointCoordinate(or,p),lh=this.pointCoordinate(Gn,p);const gh=this.pointCoordinate(ia,S),yh=this.pointCoordinate(oa,S),_h=(xh,_l)=>(_l.y-xh.y)/(_l.x-xh.x);return pl.y>1&&lh.y>=0?pl=new s.MercatorCoordinate((1-yh.y)/_h(yh,pl)+yh.x,1):pl.y<0&&lh.y<=1&&(pl=new s.MercatorCoordinate(-yh.y/_h(yh,pl)+yh.x,0)),lh.y>1&&pl.y>=0?lh=new s.MercatorCoordinate((1-gh.y)/_h(gh,lh)+gh.x,1):lh.y<0&&pl.y<=1&&(lh=new s.MercatorCoordinate(-gh.y/_h(gh,lh)+gh.x,0)),new s.LngLatBounds().extend(this.coordinateLocation(pl)).extend(this.coordinateLocation(lh)).extend(this.coordinateLocation(yh)).extend(this.coordinateLocation(gh))}_getBoundsRectangularTerrain(){const p=this.elevation;if(!p.visibleDemTiles.length||p.isUsingMockSource())return this._getBoundsRectangular(0,0);const S=p.visibleDemTiles.reduce((X,ze)=>{if(ze.dem){const kt=ze.dem.tree;X.min=Math.min(X.min,kt.minimums[0]),X.max=Math.max(X.max,kt.maximums[0])}return X},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(S.min*p.exaggeration(),S.max*p.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(p=!0){const S=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,X=this.height/2-S*(1-this._horizonShift);return p?Math.max(0,X):X}getMaxBounds(){return this.maxBounds}setMaxBounds(p){this.maxBounds=p,this.minLat=-s.MAX_MERCATOR_LATITUDE,this.maxLat=s.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,p&&(this.minLat=p.getSouth(),this.maxLat=p.getNorth(),this.minLng=p.getWest(),this.maxLng=p.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=s.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=s.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=s.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(p,S){return this.projection.createTileMatrix(this,S,p)}calculateDistanceTileData(p){const S=p.key,X=this._distanceTileDataCache;if(X[S])return X[S];const ze=p.canonical,kt=1/this.height,vi=this.cameraWorldSize,or=vi/this.zoomScale(ze.z),Gn=(ze.x+Math.pow(2,ze.z)*p.wrap)*or,ia=ze.y*or,oa=this.point;oa.x*=vi/this.worldSize,oa.y*=vi/this.worldSize;const pl=this.angle,lh=Math.sin(-pl),gh=-Math.cos(-pl);return X[S]={bearing:[lh,gh],center:[(oa.x-Gn)*kt,(oa.y-ia)*kt],scale:or/s.EXTENT*kt},X[S]}calculateFogTileMatrix(p){const S=p.key,X=this._fogTileMatrixCache;if(X[S])return X[S];const ze=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,p);return s.multiply(ze,this.worldToFogMatrix,ze),X[S]=new Float32Array(ze),X[S]}calculateProjMatrix(p,S=!1){const X=p.key,ze=S?this._alignedProjMatrixCache:this._projMatrixCache;if(ze[X])return ze[X];const kt=this.calculatePosMatrix(p,this.worldSize);return s.multiply(kt,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:S?this.alignedProjMatrix:this.projMatrix,kt),ze[X]=new Float32Array(kt),ze[X]}calculatePixelsToTileUnitsMatrix(p){const S=p.tileID.key,X=this._pixelsToTileUnitsCache;if(X[S])return X[S];const ze=function(kt,vi){const{scale:or}=kt.tileTransform,Gn=or*s.EXTENT/(kt.tileSize*Math.pow(2,vi.zoom-kt.tileID.overscaledZ+kt.tileID.canonical.z));return ia=new Float32Array(4),lh=(oa=vi.inverseAdjustmentMatrix)[1],gh=oa[2],yh=oa[3],xh=(pl=[Gn,Gn])[1],ia[0]=oa[0]*(_h=pl[0]),ia[1]=lh*_h,ia[2]=gh*xh,ia[3]=yh*xh,ia;var ia,oa,pl,lh,gh,yh,_h,xh}(p,this);return X[S]=ze,X[S]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const p=1/this.worldSize,S=s.fromScaling([],[p,p,p]);return s.multiply(S,S,this.globeMatrix),S}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const p=this._elevation;this._updateCameraState();const S=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,X=this._computeCameraPosition(S),ze=this._camera.forward(),kt=s.mercatorZfromAltitude(1,this._center.lat);X[2]/=kt,ze[2]/=kt,s.normalize(ze,ze);const vi=p.raycast(X,ze,p.exaggeration());if(vi){const or=s.scaleAndAdd([],X,ze,vi),Gn=new s.MercatorCoordinate(or[0],or[1],s.mercatorZfromAltitude(or[2],s.latFromMercatorY(or[1]))),ia=(Gn.z+s.length([Gn.x-X[0],Gn.y-X[1],Gn.z-X[2]*kt]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(ia),this._centerAltitude=Gn.toAltitude(),this._center=this.coordinateLocation(Gn),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(p=!1){if(!this._elevation)return;const S=this._elevation,X=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,ze=this._computeCameraPosition(X),kt=S.getAtPointOrZero(new s.MercatorCoordinate(...ze)),vi=this.pixelsPerMeter/this.worldSize*kt,or=this._minimumHeightOverTerrain(),Gn=ze[2]-vi;if(Gn<=or)if(Gn<0||p){const ia=this.locationCoordinate(this._center,this._centerAltitude),oa=[ze[0],ze[1],ia.z-ze[2]],pl=s.length(oa);oa[2]-=(or-Gn)/this._pixelsPerMercatorPixel;const lh=s.length(oa);if(lh===0)return;s.scale$2(oa,oa,pl/lh*this._pixelsPerMercatorPixel),this._camera.position=[ze[0],ze[1],ia.z*this._pixelsPerMercatorPixel-oa[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const p=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||p){const lh=this.center;return lh.lat=s.clamp(lh.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!p)&&(lh.lng=s.clamp(lh.lng,this.minLng,this.maxLng)),this.center=lh,void(this._constraining=!1)}const S=this._unmodified,{x:X,y:ze}=this.point;let kt=0,vi=X,or=ze;const Gn=this.width/2,ia=this.height/2,oa=this.worldMinY*this.scale,pl=this.worldMaxY*this.scale;if(ze-ia<oa&&(or=oa+ia),ze+ia>pl&&(or=pl-ia),pl-oa<this.height&&(kt=Math.max(kt,this.height/(pl-oa)),or=(pl+oa)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const lh=this.worldMinX*this.scale,gh=this.worldMaxX*this.scale,yh=this.worldSize/2-(lh+gh)/2;vi=(X+yh+this.worldSize)%this.worldSize-yh,vi-Gn<lh&&(vi=lh+Gn),vi+Gn>gh&&(vi=gh-Gn),gh-lh<this.width&&(kt=Math.max(kt,this.width/(gh-lh)),vi=(gh+lh)/2)}vi===X&&or===ze||(this.center=this.unproject(new s.Point(vi,or))),kt&&(this.zoom+=this.scaleZoom(kt)),this._constrainCamera(),this._unmodified=S,this._constraining=!1}_minZoomForBounds(){let p=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(p=Math.max(p,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),p}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const p=this.centerOffset,S=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.mercatorZfromAltitude(1,this.center.lat)/s.mercatorZfromAltitude(1,s.GLOBE_SCALE_MATCH_LATITUDE));const X=Tm(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,X),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const ze=this.projection.zAxisUnit==="meters"?S:1,kt=this._camera.getWorldToCamera(this.worldSize,ze),vi=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);vi[8]=2*-p.x/this.width,vi[9]=2*p.y/this.height;let or=s.mul([],vi,kt);if(this.projection.isReprojectedInTileSpace){const Uh=this.locationCoordinate(this.center),Vh=s.identity([]);s.translate(Vh,Vh,[Uh.x*this.worldSize,Uh.y*this.worldSize,0]),s.multiply(Vh,Vh,vy(this)),s.translate(Vh,Vh,[-Uh.x*this.worldSize,-Uh.y*this.worldSize,0]),s.multiply(or,or,Vh),this.inverseAdjustmentMatrix=function(Wh){const Zh=vy(Wh,!0);return ll([],[Zh[0],Zh[1],Zh[4],Zh[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=s.scale([],or,[this.worldSize,this.worldSize,this.worldSize/ze,1]),this.projMatrix=or,this.invProjMatrix=s.invert(new Float64Array(16),this.projMatrix);const Gn=s.invert([],vi);this.frustumCorners=s.FrustumCorners.fromInvProjectionMatrix(Gn,this.horizonLineFromTop(),this.height);const ia=new Float32Array(16);s.identity(ia),s.scale(ia,ia,[1,-1,1]),s.rotateX(ia,ia,this._pitch),s.rotateZ(ia,ia,this.angle);const oa=s.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),pl=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;oa[8]=2*-p.x/this.width,oa[9]=2*(p.y+pl)/this.height,this.skyboxMatrix=s.multiply(ia,oa,ia);const lh=this.point,gh=lh.x,yh=lh.y,_h=this.width%2/2,xh=this.height%2/2,_l=Math.cos(this.angle),mh=Math.sin(this.angle),wh=gh-Math.round(gh)+_l*_h+mh*xh,Sh=yh-Math.round(yh)+_l*xh+mh*_h,Oh=new Float64Array(or);if(s.translate(Oh,Oh,[wh>.5?wh-1:wh,Sh>.5?Sh-1:Sh,0]),this.alignedProjMatrix=Oh,or=s.create(),s.scale(or,or,[this.width/2,-this.height/2,1]),s.translate(or,or,[1,-1,0]),this.labelPlaneMatrix=or,or=s.create(),s.scale(or,or,[1,-1,1]),s.translate(or,or,[-1,-1,0]),s.scale(or,or,[2/this.width,2/this.height,1]),this.glCoordMatrix=or,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},or=s.invert(new Float64Array(16),this.pixelMatrix),!or)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=or,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.calculateGlobeMatrix(this);const Uh=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.transformMat4(Uh,Uh,kt),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=or;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const p=this.cameraWorldSizeForFog,S=this.cameraPixelsPerMeter,X=this._camera.position,ze=1/this.height/this._pixelsPerMercatorPixel,kt=[p,p,S];s.scale$2(kt,kt,ze),s.scale$2(X,X,-1),s.multiply$2(X,X,kt);const vi=s.create();s.translate(vi,vi,X),s.scale(vi,vi,kt),this.mercatorFogMatrix=vi,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(p,S,ze)}_computeCameraPosition(p){const S=(p=p||this.pixelsPerMeter)/this.pixelsPerMeter,X=this._camera.forward(),ze=this.point,kt=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*S-p/this.worldSize*this._centerAltitude;return[ze.x/this.worldSize-X[0]*kt,ze.y/this.worldSize-X[1]*kt,p/this.worldSize*this._centerAltitude-X[2]*kt]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(p){const S=this._maxCameraBoundsDistance()*Math.cos(this._pitch),X=this._camera.position[2],ze=p[2];let kt=1;this.projection.wrap&&(this.center=this.center.wrap()),ze>0&&(kt=Math.min((S-X)/ze,1)),this._camera.position=s.scaleAndAdd([],this._camera.position,p,kt),this._updateStateFromCamera()}_updateStateFromCamera(){const p=this._camera.position,S=this._camera.forward(),{pitch:X,bearing:ze}=this._camera.getPitchBearing(),kt=s.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,vi=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.degToRad(this._maxPitch)),or=Math.max((p[2]-kt)/Math.cos(X),vi),Gn=this._zoomFromMercatorZ(or);s.scaleAndAdd(p,p,S,or),this._pitch=s.clamp(X,s.degToRad(this.minPitch),s.degToRad(this.maxPitch)),this.angle=s.wrap(ze,-Math.PI,Math.PI),this._setZoom(s.clamp(Gn,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.MercatorCoordinate(p[0],p[1],p[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(p){return Math.pow(2,p)*this.tileSize}_mercatorZfromZoom(p){return this.cameraToCenterDistance/this._worldSizeFromZoom(p)}_minimumHeightOverTerrain(){const p=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(p)}_zoomFromMercatorZ(p){return this.scaleZoom(this.cameraToCenterDistance/(p*this.tileSize))}zoomFromMercatorZAdjusted(p){let S=0,X=s.GLOBE_ZOOM_THRESHOLD_MAX,ze=0,kt=1/0;for(;X-S>1e-6&&X>S;){const vi=S+.5*(X-S),or=this.tileSize*Math.pow(2,vi),Gn=this.getCameraToCenterDistance(this.projection,vi,or),ia=this.scaleZoom(Gn/(p*this.tileSize)),oa=Math.abs(vi-ia);oa<kt&&(kt=oa,ze=vi),vi<ia?S=vi:X=vi}return ze}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(p,S){const X=Math.min(p.x,S.x),ze=Math.max(p.x,S.x),kt=Math.min(p.y,S.y),vi=Math.max(p.y,S.y);if(kt<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const or=[new s.Point(X,kt),new s.Point(ze,vi),new s.Point(X,vi),new s.Point(ze,kt)],Gn=this.renderWorldCopies?-3:0,ia=this.renderWorldCopies?4:1;for(const oa of or){const pl=this.pointRayIntersection(oa);if(pl.t<0)return!0;const lh=this.rayIntersectionCoordinate(pl);if(lh.x<Gn||lh.y<0||lh.x>ia||lh.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.Point(0,0),new s.Point(this.width,this.height))}zoomDeltaToMovement(p,S){const X=s.length(s.sub([],this._camera.position,p)),ze=this._zoomFromMercatorZ(X)+S;return X-this._mercatorZfromZoom(ze)}getCameraPoint(){if(this.projection.name==="globe"){const p=function([S,X,ze],kt){const vi=[S,X,ze,1];s.transformMat4$1(vi,vi,kt);const or=vi[3]=Math.max(vi[3],1e-6);return vi[0]/=or,vi[1]/=or,vi[2]/=or,vi}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.Point(p[0],p[1])}{const p=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.Point(0,p))}}getCameraToCenterDistance(p,S=this.zoom,X=this.worldSize){const ze=Tm(p,S,this.width,this.height,1024),kt=p.pixelSpaceConversion(this.center.lat,X,ze);return .5/Math.tan(.5*this._fov)*this.height*kt}getWorldToCameraMatrix(){const p=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.multiply(p,p,this.globeMatrix),p}}function xy(L,p){let S=!1,X=null;const ze=()=>{X=null,S&&(L(),X=setTimeout(ze,p),S=!1)};return()=>(S=!0,X||ze(),X)}class ex{constructor(p){this._hashName=p&&encodeURIComponent(p),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=xy(this._updateHashUnthrottled.bind(this),300)}addTo(p){return this._map=p,s.window.addEventListener("hashchange",this._onHashChange,!1),p.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),s.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const p=this._map;if(!p)return"";const S=Bm(p);if(this._hashName){const X=this._hashName;let ze=!1;const kt=s.window.location.hash.slice(1).split("&").map(vi=>{const or=vi.split("=")[0];return or===X?(ze=!0,`${or}=${S}`):vi}).filter(vi=>vi);return ze||kt.push(`${X}=${S}`),`#${kt.join("&")}`}return`#${S}`}_getCurrentHash(){const p=s.window.location.hash.replace("#","");if(this._hashName){let S;return p.split("&").map(X=>X.split("=")).forEach(X=>{X[0]===this._hashName&&(S=X)}),(S&&S[1]||"").split("/")}return p.split("/")}_onHashChange(){const p=this._map;if(!p)return!1;const S=this._getCurrentHash();if(S.length>=3&&!S.some(X=>isNaN(X))){const X=p.dragRotate.isEnabled()&&p.touchZoomRotate.isEnabled()?+(S[3]||0):p.getBearing();return p.jumpTo({center:[+S[2],+S[1]],zoom:+S[0],bearing:X,pitch:+(S[4]||0)}),!0}return!1}_updateHashUnthrottled(){const p=s.window.location.href.replace(/(#.+)?$/,this.getHashString());s.window.history.replaceState(s.window.history.state,null,p)}}function Bm(L,p){const S=L.getCenter(),X=Math.round(100*L.getZoom())/100,ze=Math.ceil((X*Math.LN2+Math.log(512/360/.5))/Math.LN10),kt=Math.pow(10,ze),vi=Math.round(S.lng*kt)/kt,or=Math.round(S.lat*kt)/kt,Gn=L.getBearing(),ia=L.getPitch();let oa=p?`/${vi}/${or}/${X}`:`${X}/${or}/${vi}`;return(Gn||ia)&&(oa+="/"+Math.round(10*Gn)/10),ia&&(oa+=`/${Math.round(ia)}`),oa}const Eg={linearity:.3,easing:s.bezier(0,0,.3,1)},iv=s.extend({deceleration:2500,maxSpeed:1400},Eg),$v=s.extend({deceleration:20,maxSpeed:1400},Eg),fp=s.extend({deceleration:1e3,maxSpeed:360},Eg),$m=s.extend({deceleration:1e3,maxSpeed:90},Eg);class Tx{constructor(p){this._map=p,this.clear()}clear(){this._inertiaBuffer=[]}record(p){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.exported.now(),settings:p})}_drainInertiaBuffer(){const p=this._inertiaBuffer,S=s.exported.now();for(;p.length>0&&S-p[0].time>160;)p.shift()}_onMoveEnd(p){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const S={zoom:0,bearing:0,pitch:0,pan:new s.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:kt}of this._inertiaBuffer)S.zoom+=kt.zoomDelta||0,S.bearing+=kt.bearingDelta||0,S.pitch+=kt.pitchDelta||0,kt.panDelta&&S.pan._add(kt.panDelta),kt.around&&(S.around=kt.around),kt.pinchAround&&(S.pinchAround=kt.pinchAround);const X=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,ze={};if(S.pan.mag()){const kt=Xm(S.pan.mag(),X,s.extend({},iv,p||{}));ze.offset=S.pan.mult(kt.amount/S.pan.mag()),ze.center=this._map.transform.center,rv(ze,kt)}if(S.zoom){const kt=Xm(S.zoom,X,$v);ze.zoom=this._map.transform.zoom+kt.amount,rv(ze,kt)}if(S.bearing){const kt=Xm(S.bearing,X,fp);ze.bearing=this._map.transform.bearing+s.clamp(kt.amount,-179,179),rv(ze,kt)}if(S.pitch){const kt=Xm(S.pitch,X,$m);ze.pitch=this._map.transform.pitch+kt.amount,rv(ze,kt)}if(ze.zoom||ze.bearing){const kt=S.pinchAround===void 0?S.around:S.pinchAround;ze.around=kt?this._map.unproject(kt):this._map.getCenter()}return this.clear(),ze.noMoveStart=!0,ze}}function rv(L,p){(!L.duration||L.duration<p.duration)&&(L.duration=p.duration,L.easing=p.easing)}function Xm(L,p,S){const{maxSpeed:X,linearity:ze,deceleration:kt}=S,vi=s.clamp(L*ze/(p/1e3),-X,X),or=Math.abs(vi)/(kt*ze);return{easing:S.easing,duration:1e3*or,amount:vi*(or/2)}}class tm extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(p,S,X,ze={}){const kt=il(S.getCanvasContainer(),X),vi=S.unproject(kt);super(p,s.extend({point:kt,lngLat:vi,originalEvent:X},ze)),this._defaultPrevented=!1,this.target=S}}class Np extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(p,S,X){const ze=p==="touchend"?X.changedTouches:X.touches,kt=gl(S.getCanvasContainer(),ze),vi=kt.map(Gn=>S.unproject(Gn)),or=kt.reduce((Gn,ia,oa,pl)=>Gn.add(ia.div(pl.length)),new s.Point(0,0));super(p,{points:kt,point:or,lngLats:vi,lngLat:S.unproject(or),originalEvent:X}),this._defaultPrevented=!1}}class Kp extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(p,S,X){super(p,{originalEvent:X}),this._defaultPrevented=!1}}class nv{constructor(p,S){this._map=p,this._clickTolerance=S.clickTolerance}reset(){this._mousedownPos=void 0}wheel(p){return this._firePreventable(new Kp(p.type,this._map,p))}mousedown(p,S){return this._mousedownPos=S,this._firePreventable(new tm(p.type,this._map,p))}mouseup(p){this._map.fire(new tm(p.type,this._map,p))}preclick(p){const S=s.extend({},p);S.type="preclick",this._map.fire(new tm(S.type,this._map,S))}click(p,S){this._mousedownPos&&this._mousedownPos.dist(S)>=this._clickTolerance||(this.preclick(p),this._map.fire(new tm(p.type,this._map,p)))}dblclick(p){return this._firePreventable(new tm(p.type,this._map,p))}mouseover(p){this._map.fire(new tm(p.type,this._map,p))}mouseout(p){this._map.fire(new tm(p.type,this._map,p))}touchstart(p){return this._firePreventable(new Np(p.type,this._map,p))}touchmove(p){this._map.fire(new Np(p.type,this._map,p))}touchend(p){this._map.fire(new Np(p.type,this._map,p))}touchcancel(p){this._map.fire(new Np(p.type,this._map,p))}_firePreventable(p){if(this._map.fire(p),p.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hv{constructor(p){this._map=p}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(p){this._map.fire(new tm(p.type,this._map,p))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new tm("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(p){this._delayContextMenu?this._contextMenuEvent=p:this._map.fire(new tm(p.type,this._map,p)),this._map.listens("contextmenu")&&p.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class tx{constructor(p,S){this._map=p,this._el=p.getCanvasContainer(),this._container=p.getContainer(),this._clickTolerance=S.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(p,S){this.isEnabled()&&p.shiftKey&&p.button===0&&(Bn(),this._startPos=this._lastPos=S,this._active=!0)}mousemoveWindow(p,S){if(!this._active)return;const X=S,ze=this._startPos,kt=this._lastPos;if(!ze||!kt||kt.equals(X)||!this._box&&X.dist(ze)<this._clickTolerance)return;this._lastPos=X,this._box||(this._box=Ee("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",p));const vi=Math.min(ze.x,X.x),or=Math.max(ze.x,X.x),Gn=Math.min(ze.y,X.y),ia=Math.max(ze.y,X.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${vi}px,${Gn}px)`,this._box.style.width=or-vi+"px",this._box.style.height=ia-Gn+"px")})}mouseupWindow(p,S){if(!this._active)return;const X=this._startPos,ze=S;if(X&&p.button===0){if(this.reset(),ps(),X.x!==ze.x||X.y!==ze.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:p})),{cameraAnimation:kt=>kt.fitScreenCoordinates(X,ze,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",p)}}keydown(p){this._active&&p.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",p))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Vn(),delete this._startPos,delete this._lastPos}_fireEvent(p,S){return this._map.fire(new s.Event(p,{originalEvent:S}))}}function Am(L,p){const S={};for(let X=0;X<L.length;X++)S[L[X].identifier]=p[X];return S}class ov{constructor(p){this.reset(),this.numTouches=p.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(p,S,X){(this.centroid||X.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=p.timeStamp),X.length===this.numTouches&&(this.centroid=function(ze){const kt=new s.Point(0,0);for(const vi of ze)kt._add(vi);return kt.div(ze.length)}(S),this.touches=Am(X,S)))}touchmove(p,S,X){if(this.aborted||!this.centroid)return;const ze=Am(X,S);for(const kt in this.touches){const vi=ze[kt];(!vi||vi.dist(this.touches[kt])>30)&&(this.aborted=!0)}}touchend(p,S,X){if((!this.centroid||p.timeStamp-this.startTime>500)&&(this.aborted=!0),X.length===0){const ze=!this.aborted&&this.centroid;if(this.reset(),ze)return ze}}}class x_{constructor(p){this.singleTap=new ov(p),this.numTaps=p.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(p,S,X){this.singleTap.touchstart(p,S,X)}touchmove(p,S,X){this.singleTap.touchmove(p,S,X)}touchend(p,S,X){const ze=this.singleTap.touchend(p,S,X);if(ze){const kt=p.timeStamp-this.lastTime<500,vi=!this.lastTap||this.lastTap.dist(ze)<30;if(kt&&vi||this.reset(),this.count++,this.lastTime=p.timeStamp,this.lastTap=ze,this.count===this.numTaps)return this.reset(),ze}}}class Cw{constructor(){this._zoomIn=new x_({numTouches:1,numTaps:2}),this._zoomOut=new x_({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(p,S,X){this._zoomIn.touchstart(p,S,X),this._zoomOut.touchstart(p,S,X)}touchmove(p,S,X){this._zoomIn.touchmove(p,S,X),this._zoomOut.touchmove(p,S,X)}touchend(p,S,X){const ze=this._zoomIn.touchend(p,S,X),kt=this._zoomOut.touchend(p,S,X);return ze?(this._active=!0,p.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:vi=>vi.easeTo({duration:300,zoom:vi.getZoom()+1,around:vi.unproject(ze)},{originalEvent:p})}):kt?(this._active=!0,p.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:vi=>vi.easeTo({duration:300,zoom:vi.getZoom()-1,around:vi.unproject(kt)},{originalEvent:p})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const B_={0:1,2:2};class Mg{constructor(p){this.reset(),this._clickTolerance=p.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(p,S){return!1}_move(p,S){return{}}mousedown(p,S){if(this._lastPoint)return;const X=ml(p);this._correctButton(p,X)&&(this._lastPoint=S,this._eventButton=X)}mousemoveWindow(p,S){const X=this._lastPoint;if(X){if(p.preventDefault(),this._eventButton!=null&&function(ze,kt){const vi=B_[kt];return ze.buttons===void 0||(ze.buttons&vi)!==vi}(p,this._eventButton))this.reset();else if(this._moved||!(S.dist(X)<this._clickTolerance))return this._moved=!0,this._lastPoint=S,this._move(X,S)}}mouseupWindow(p){this._lastPoint&&ml(p)===this._eventButton&&(this._moved&&ps(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jg extends Mg{mousedown(p,S){super.mousedown(p,S),this._lastPoint&&(this._active=!0)}_correctButton(p,S){return S===0&&!p.ctrlKey}_move(p,S){return{around:S,panDelta:S.sub(p)}}}class ix extends Mg{_correctButton(p,S){return S===0&&p.ctrlKey||S===2}_move(p,S){const X=.8*(S.x-p.x);if(X)return this._active=!0,{bearingDelta:X}}contextmenu(p){p.preventDefault()}}class wy extends Mg{_correctButton(p,S){return S===0&&p.ctrlKey||S===2}_move(p,S){const X=-.5*(S.y-p.y);if(X)return this._active=!0,{pitchDelta:X}}contextmenu(p){p.preventDefault()}}class sv{constructor(p,S){this._map=p,this._el=p.getCanvasContainer(),this._minTouches=1,this._clickTolerance=S.clickTolerance||1,this.reset(),s.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.Point(0,0)}touchstart(p,S,X){return this._calculateTransform(p,S,X)}touchmove(p,S,X){if(this._active&&!(X.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(X.length===1&&!s.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return p.cancelable&&p.preventDefault(),this._calculateTransform(p,S,X)}}touchend(p,S,X){this._calculateTransform(p,S,X),this._active&&X.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(p,S,X){X.length>0&&(this._active=!0);const ze=Am(X,S),kt=new s.Point(0,0),vi=new s.Point(0,0);let or=0;for(const ia in ze){const oa=ze[ia],pl=this._touches[ia];pl&&(kt._add(oa),vi._add(oa.sub(pl)),or++,ze[ia]=oa)}if(this._touches=ze,or<this._minTouches||!vi.mag())return;const Gn=vi.div(or);return this._sum._add(Gn),this._sum.mag()<this._clickTolerance?void 0:{around:kt.div(or),panDelta:Gn}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ee("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class av{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(p){}_move(p,S,X){return{}}touchstart(p,S,X){this._firstTwoTouches||X.length<2||(this._firstTwoTouches=[X[0].identifier,X[1].identifier],this._start([S[0],S[1]]))}touchmove(p,S,X){const ze=this._firstTwoTouches;if(!ze)return;p.preventDefault();const[kt,vi]=ze,or=Ym(X,S,kt),Gn=Ym(X,S,vi);if(!or||!Gn)return;const ia=this._aroundCenter?null:or.add(Gn).div(2);return this._move([or,Gn],ia,p)}touchend(p,S,X){if(!this._firstTwoTouches)return;const[ze,kt]=this._firstTwoTouches,vi=Ym(X,S,ze),or=Ym(X,S,kt);vi&&or||(this._active&&ps(),this.reset())}touchcancel(){this.reset()}enable(p){this._enabled=!0,this._aroundCenter=!!p&&p.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ym(L,p,S){for(let X=0;X<L.length;X++)if(L[X].identifier===S)return p[X]}function jv(L,p){return Math.log(L/p)/Math.LN2}class by extends av{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(p){this._startDistance=this._distance=p[0].dist(p[1])}_move(p,S){const X=this._distance;if(this._distance=p[0].dist(p[1]),this._active||!(Math.abs(jv(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:jv(this._distance,X),pinchAround:S}}}function Wv(L,p){return 180*L.angleWith(p)/Math.PI}class qv extends av{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(p){this._startVector=this._vector=p[0].sub(p[1]),this._minDiameter=p[0].dist(p[1])}_move(p,S){const X=this._vector;if(this._vector=p[0].sub(p[1]),X&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Wv(this._vector,X),pinchAround:S}}_isBelowThreshold(p){this._minDiameter=Math.min(this._minDiameter,p.mag());const S=25/(Math.PI*this._minDiameter)*360,X=this._startVector;if(!X)return!1;const ze=Wv(p,X);return Math.abs(ze)<S}}function G_(L){return Math.abs(L.y)>Math.abs(L.x)}class lv extends av{constructor(p){super(),this._map=p}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(p){this._lastPoints=p,G_(p[0].sub(p[1]))&&(this._valid=!1)}_move(p,S,X){const ze=this._lastPoints;if(!ze)return;const kt=p[0].sub(ze[0]),vi=p[1].sub(ze[1]);return this._map._cooperativeGestures&&!s.isFullscreen()&&X.touches.length<3||(this._valid=this.gestureBeginsVertically(kt,vi,X.timeStamp),!this._valid)?void 0:(this._lastPoints=p,this._active=!0,{pitchDelta:(kt.y+vi.y)/2*-.5})}gestureBeginsVertically(p,S,X){if(this._valid!==void 0)return this._valid;const ze=p.mag()>=2,kt=S.mag()>=2;if(!ze&&!kt)return;if(!ze||!kt)return this._firstMove==null&&(this._firstMove=X),X-this._firstMove<100&&void 0;const vi=p.y>0==S.y>0;return G_(p)&&G_(S)&&vi}}const Cy={panStep:100,bearingStep:15,pitchStep:10};class Ax{constructor(){const p=Cy;this._panStep=p.panStep,this._bearingStep=p.bearingStep,this._pitchStep=p.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(p){if(p.altKey||p.ctrlKey||p.metaKey)return;let S=0,X=0,ze=0,kt=0,vi=0;switch(p.keyCode){case 61:case 107:case 171:case 187:S=1;break;case 189:case 109:case 173:S=-1;break;case 37:p.shiftKey?X=-1:(p.preventDefault(),kt=-1);break;case 39:p.shiftKey?X=1:(p.preventDefault(),kt=1);break;case 38:p.shiftKey?ze=1:(p.preventDefault(),vi=-1);break;case 40:p.shiftKey?ze=-1:(p.preventDefault(),vi=1);break;default:return}return this._rotationDisabled&&(X=0,ze=0),{cameraAnimation:or=>{const Gn=or.getZoom();or.easeTo({duration:300,easeId:"keyboardHandler",easing:v0,zoom:S?Math.round(Gn)+S*(p.shiftKey?2:1):Gn,bearing:or.getBearing()+X*this._bearingStep,pitch:or.getPitch()+ze*this._pitchStep,offset:[-kt*this._panStep,-vi*this._panStep],center:or.getCenter()},{originalEvent:p})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function v0(L){return L*(2-L)}const iy=4.000244140625;class x0{constructor(p,S){this._map=p,this._el=p.getCanvasContainer(),this._handler=S,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(p){this._defaultZoomRate=p}setWheelZoomRate(p){this._wheelZoomRate=p}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(p){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!p&&p.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(p){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(p.ctrlKey||p.metaKey||this.isZooming()||s.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let S=p.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*p.deltaY:p.deltaY;const X=s.exported.now(),ze=X-(this._lastWheelEventTime||0);this._lastWheelEventTime=X,S!==0&&S%iy==0?this._type="wheel":S!==0&&Math.abs(S)<4?this._type="trackpad":ze>400?(this._type=null,this._lastValue=S,this._timeout=setTimeout(this._onTimeout,40,p)):this._type||(this._type=Math.abs(ze*S)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,S+=this._lastValue)),p.shiftKey&&S&&(S/=4),this._type&&(this._lastWheelEvent=p,this._delta-=S,this._active||this._start(p)),p.preventDefault()}_onTimeout(p){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)}_start(p){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const S=il(this._el,p);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:S,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const p=this._map.transform;this._type==="wheel"&&p.projection.wrap&&(p._center.lng>=180||p._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const S=()=>p._terrainEnabled()&&this._aroundCoord?p.computeZoomRelativeTo(this._aroundCoord):p.zoom;if(this._delta!==0){const Gn=this._type==="wheel"&&Math.abs(this._delta)>iy?this._wheelZoomRate:this._defaultZoomRate;let ia=2/(1+Math.exp(-Math.abs(this._delta*Gn)));this._delta<0&&ia!==0&&(ia=1/ia);const oa=S(),pl=Math.pow(2,oa),lh=typeof this._targetZoom=="number"?p.zoomScale(this._targetZoom):pl;this._targetZoom=Math.min(p.maxZoom,Math.max(p.minZoom,p.scaleZoom(lh*ia))),this._type==="wheel"&&(this._startZoom=oa,this._easing=this._smoothOutEasing(200)),this._delta=0}const X=typeof this._targetZoom=="number"?this._targetZoom:S(),ze=this._startZoom,kt=this._easing;let vi,or=!1;if(this._type==="wheel"&&ze&&kt){const Gn=Math.min((s.exported.now()-this._lastWheelEventTime)/200,1),ia=kt(Gn);vi=s.number(ze,X,ia),Gn<1?this._frameId||(this._frameId=!0):or=!0}else vi=X,or=!0;return this._active=!0,or&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!or,zoomDelta:vi-S(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(p){let S=s.ease;if(this._prevEase){const X=this._prevEase,ze=(s.exported.now()-X.start)/X.duration,kt=X.easing(ze+.01)-X.easing(ze),vi=.27/Math.sqrt(kt*kt+1e-4)*.01,or=Math.sqrt(.0729-vi*vi);S=s.bezier(vi,or,.25,1)}return this._prevEase={start:s.exported.now(),duration:p,easing:S},S}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ee("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(s.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class rx{constructor(p,S){this._clickZoom=p,this._tapZoom=S}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class fm{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(p,S){return p.preventDefault(),{cameraAnimation:X=>{X.easeTo({duration:300,zoom:X.getZoom()+(p.shiftKey?-1:1),around:X.unproject(S)},{originalEvent:p})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class nx{constructor(){this._tap=new x_({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(p,S,X){this._swipePoint||(this._tapTime&&p.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?X.length>0&&(this._swipePoint=S[0],this._swipeTouch=X[0].identifier):this._tap.touchstart(p,S,X))}touchmove(p,S,X){if(this._tapTime){if(this._swipePoint){if(X[0].identifier!==this._swipeTouch)return;const ze=S[0],kt=ze.y-this._swipePoint.y;return this._swipePoint=ze,p.preventDefault(),this._active=!0,{zoomDelta:kt/128}}}else this._tap.touchmove(p,S,X)}touchend(p,S,X){this._tapTime?this._swipePoint&&X.length===0&&this.reset():this._tap.touchend(p,S,X)&&(this._tapTime=p.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class w0{constructor(p,S,X){this._el=p,this._mousePan=S,this._touchPan=X}enable(p){this._inertiaOptions=p||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ve{constructor(p,S,X){this._pitchWithRotate=p.pitchWithRotate,this._mouseRotate=S,this._mousePitch=X}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class g{constructor(p,S,X,ze){this._el=p,this._touchZoom=S,this._touchRotate=X,this._tapDragZoom=ze,this._rotationDisabled=!1,this._enabled=!0}enable(p){this._touchZoom.enable(p),this._rotationDisabled||this._touchRotate.enable(p),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const A=L=>L.zoom||L.drag||L.pitch||L.rotate;class _e extends s.Event{}class ct{constructor(){this.constants=[1,1,.01],this.radius=0}setup(p,S){const X=s.sub([],S,p);this.radius=s.length(X[2]<0?s.div([],X,this.constants):[X[0],X[1],0])}projectRay(p){s.div(p,p,this.constants),s.normalize(p,p),s.mul$1(p,p,this.constants);const S=s.scale$2([],p,this.radius);if(S[2]>0){const X=s.scale$2([],[0,0,1],s.dot(S,[0,0,1])),ze=s.scale$2([],s.normalize([],[S[0],S[1],0]),this.radius),kt=s.add([],S,s.scale$2([],s.sub([],s.add([],ze,X),S),2));S[0]=kt[0],S[1]=kt[1]}return S}}function pi(L){return L.panDelta&&L.panDelta.mag()||L.zoomDelta||L.bearingDelta||L.pitchDelta}class In{constructor(p,S){this._map=p,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Tx(p),this._bearingSnap=S.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ct,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(S),s.bindAll(["handleEvent","handleWindowEvent"],this);const X=this._el;this._listeners=[[X,"touchstart",{passive:!0}],[X,"touchmove",{passive:!1}],[X,"touchend",void 0],[X,"touchcancel",void 0],[X,"mousedown",void 0],[X,"mousemove",void 0],[X,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[X,"mouseover",void 0],[X,"mouseout",void 0],[X,"dblclick",void 0],[X,"click",void 0],[X,"keydown",{capture:!1}],[X,"keyup",void 0],[X,"wheel",{passive:!1}],[X,"contextmenu",void 0],[s.window,"blur",void 0]];for(const[ze,kt,vi]of this._listeners)ze.addEventListener(kt,ze===s.window.document?this.handleWindowEvent:this.handleEvent,vi)}destroy(){for(const[p,S,X]of this._listeners)p.removeEventListener(S,p===s.window.document?this.handleWindowEvent:this.handleEvent,X)}_addDefaultHandlers(p){const S=this._map,X=S.getCanvasContainer();this._add("mapEvent",new nv(S,p));const ze=S.boxZoom=new tx(S,p);this._add("boxZoom",ze);const kt=new Cw,vi=new fm;S.doubleClickZoom=new rx(vi,kt),this._add("tapZoom",kt),this._add("clickZoom",vi);const or=new nx;this._add("tapDragZoom",or);const Gn=S.touchPitch=new lv(S);this._add("touchPitch",Gn);const ia=new ix(p),oa=new wy(p);S.dragRotate=new Ve(p,ia,oa),this._add("mouseRotate",ia,["mousePitch"]),this._add("mousePitch",oa,["mouseRotate"]);const pl=new Jg(p),lh=new sv(S,p);S.dragPan=new w0(X,pl,lh),this._add("mousePan",pl),this._add("touchPan",lh,["touchZoom","touchRotate"]);const gh=new qv,yh=new by;S.touchZoomRotate=new g(X,yh,gh,or),this._add("touchRotate",gh,["touchPan","touchZoom"]),this._add("touchZoom",yh,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Hv(S));const _h=S.scrollZoom=new x0(S,this);this._add("scrollZoom",_h,["mousePan"]);const xh=S.keyboard=new Ax;this._add("keyboard",xh);for(const _l of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])p.interactive&&p[_l]&&S[_l].enable(p[_l])}_add(p,S,X){this._handlers.push({handlerName:p,handler:S,allowed:X}),this._handlersById[p]=S}stop(p){if(!this._updatingCamera){for(const{handler:S}of this._handlers)S.reset();this._inertia.clear(),this._fireEvents({},{},p),this._changes=[]}}isActive(){for(const{handler:p}of this._handlers)if(p.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!A(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(p,S,X){for(const ze in p)if(ze!==X&&(!S||S.indexOf(ze)<0))return!0;return!1}handleWindowEvent(p){this.handleEvent(p,`${p.type}Window`)}_getMapTouches(p){const S=[];for(const X of p)this._el.contains(X.target)&&S.push(X);return S}handleEvent(p,S){this._updatingCamera=!0;const X=p.type==="renderFrame",ze=X?void 0:p,kt={needsRenderFrame:!1},vi={},or={},Gn=p.touches?this._getMapTouches(p.touches):void 0,ia=Gn?gl(this._el,Gn):X?void 0:il(this._el,p);for(const{handlerName:lh,handler:gh,allowed:yh}of this._handlers){if(!gh.isEnabled())continue;let _h;this._blockedByActive(or,yh,lh)?gh.reset():gh[S||p.type]&&(_h=gh[S||p.type](p,ia,Gn),this.mergeHandlerResult(kt,vi,_h,lh,ze),_h&&_h.needsRenderFrame&&this._triggerRenderFrame()),(_h||gh.isActive())&&(or[lh]=gh)}const oa={};for(const lh in this._previousActiveHandlers)or[lh]||(oa[lh]=ze);this._previousActiveHandlers=or,(Object.keys(oa).length||pi(kt))&&(this._changes.push([kt,vi,oa]),this._triggerRenderFrame()),(Object.keys(or).length||pi(kt))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:pl}=kt;pl&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],pl(this._map))}mergeHandlerResult(p,S,X,ze,kt){if(!X)return;s.extend(p,X);const vi={handlerName:ze,originalEvent:X.originalEvent||kt};X.zoomDelta!==void 0&&(S.zoom=vi),X.panDelta!==void 0&&(S.drag=vi),X.pitchDelta!==void 0&&(S.pitch=vi),X.bearingDelta!==void 0&&(S.rotate=vi)}_applyChanges(){const p={},S={},X={};for(const[ze,kt,vi]of this._changes)ze.panDelta&&(p.panDelta=(p.panDelta||new s.Point(0,0))._add(ze.panDelta)),ze.zoomDelta&&(p.zoomDelta=(p.zoomDelta||0)+ze.zoomDelta),ze.bearingDelta&&(p.bearingDelta=(p.bearingDelta||0)+ze.bearingDelta),ze.pitchDelta&&(p.pitchDelta=(p.pitchDelta||0)+ze.pitchDelta),ze.around!==void 0&&(p.around=ze.around),ze.aroundCoord!==void 0&&(p.aroundCoord=ze.aroundCoord),ze.pinchAround!==void 0&&(p.pinchAround=ze.pinchAround),ze.noInertia&&(p.noInertia=ze.noInertia),s.extend(S,kt),s.extend(X,vi);this._updateMapTransform(p,S,X),this._changes=[]}_updateMapTransform(p,S,X){const ze=this._map,kt=ze.transform,vi=mh=>[mh.x,mh.y,mh.z];if((mh=>{const wh=this._eventsInProgress.drag;return wh&&!this._handlersById[wh.handlerName].isActive()})()&&!pi(p)){const mh=kt.zoom;kt.cameraElevationReference="sea",kt.recenterOnTerrain(),kt.cameraElevationReference="ground",mh!==kt.zoom&&this._map._update(!0)}if(kt._isCameraConstrained&&ze._stop(!0),!pi(p))return void this._fireEvents(S,X,!0);let{panDelta:or,zoomDelta:Gn,bearingDelta:ia,pitchDelta:oa,around:pl,aroundCoord:lh,pinchAround:gh}=p;kt._isCameraConstrained&&(Gn>0&&(Gn=0),kt._isCameraConstrained=!1),gh!==void 0&&(pl=gh),(Gn||(mh=>S[mh]&&!this._eventsInProgress[mh])("drag"))&&pl&&(this._dragOrigin=vi(kt.pointCoordinate3D(pl)),this._trackingEllipsoid.setup(kt._camera.position,this._dragOrigin)),kt.cameraElevationReference="sea",ze._stop(!0),pl=pl||ze.transform.centerPoint,ia&&(kt.bearing+=ia),oa&&(kt.pitch+=oa),kt._updateCameraState();const yh=[0,0,0];if(or)if(kt.projection.name==="mercator"){const mh=this._trackingEllipsoid.projectRay(kt.screenPointToMercatorRay(pl).dir),wh=this._trackingEllipsoid.projectRay(kt.screenPointToMercatorRay(pl.sub(or)).dir);yh[0]=wh[0]-mh[0],yh[1]=wh[1]-mh[1]}else{const mh=kt.pointCoordinate(pl);if(kt.projection.name==="globe"){or=or.rotate(-kt.angle);const wh=kt._pixelsPerMercatorPixel/kt.worldSize;yh[0]=-or.x*s.mercatorScale(s.latFromMercatorY(mh.y))*wh,yh[1]=-or.y*s.mercatorScale(kt.center.lat)*wh}else{const wh=kt.pointCoordinate(pl.sub(or));mh&&wh&&(yh[0]=wh.x-mh.x,yh[1]=wh.y-mh.y)}}const _h=kt.zoom,xh=[0,0,0];if(Gn){const mh=vi(lh||kt.pointCoordinate3D(pl)),wh={dir:s.normalize([],s.sub([],mh,kt._camera.position))};if(wh.dir[2]<0){const Sh=kt.zoomDeltaToMovement(mh,Gn);s.scale$2(xh,wh.dir,Sh)}}const _l=s.add(yh,yh,xh);kt._translateCameraConstrained(_l),Gn&&Math.abs(kt.zoom-_h)>1e-4&&kt.recenterOnTerrain(),kt.cameraElevationReference="ground",this._map._update(),p.noInertia||this._inertia.record(p),this._fireEvents(S,X,!0)}_fireEvents(p,S,X){const ze=A(this._eventsInProgress),kt=A(p),vi={};for(const oa in p){const{originalEvent:pl}=p[oa];this._eventsInProgress[oa]||(vi[`${oa}start`]=pl),this._eventsInProgress[oa]=p[oa]}!ze&&kt&&this._fireEvent("movestart",kt.originalEvent);for(const oa in vi)this._fireEvent(oa,vi[oa]);kt&&this._fireEvent("move",kt.originalEvent);for(const oa in p){const{originalEvent:pl}=p[oa];this._fireEvent(oa,pl)}const or={};let Gn;for(const oa in this._eventsInProgress){const{handlerName:pl,originalEvent:lh}=this._eventsInProgress[oa];this._handlersById[pl].isActive()||(delete this._eventsInProgress[oa],Gn=S[pl]||lh,or[`${oa}end`]=Gn)}for(const oa in or)this._fireEvent(oa,or[oa]);const ia=A(this._eventsInProgress);if(X&&(ze||kt)&&!ia){this._updatingCamera=!0;const oa=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),pl=lh=>lh!==0&&-this._bearingSnap<lh&&lh<this._bearingSnap;oa?(pl(oa.bearing||this._map.getBearing())&&(oa.bearing=0),this._map.easeTo(oa,{originalEvent:Gn})):(this._map.fire(new s.Event("moveend",{originalEvent:Gn})),pl(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(p,S){this._map.fire(new s.Event(p,S?{originalEvent:S}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(p=>{this._frameId=void 0,this.handleEvent(new _e("renderFrame",{timeStamp:p})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const ds="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class hs extends s.Evented{constructor(p,S){super(),this._moving=!1,this._zooming=!1,this.transform=p,this._bearingSnap=S.bearingSnap,this._respectPrefersReducedMotion=S.respectPrefersReducedMotion!==!1,s.bindAll(["_renderFrameCallback"],this)}getCenter(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(p,S){return this.jumpTo({center:p},S)}panBy(p,S,X){return p=s.Point.convert(p).mult(-1),this.panTo(this.transform.center,s.extend({offset:p},S),X)}panTo(p,S,X){return this.easeTo(s.extend({center:p},S),X)}getZoom(){return this.transform.zoom}setZoom(p,S){return this.jumpTo({zoom:p},S),this}zoomTo(p,S,X){return this.easeTo(s.extend({zoom:p},S),X)}zoomIn(p,S){return this.zoomTo(this.getZoom()+1,p,S),this}zoomOut(p,S){return this.zoomTo(this.getZoom()-1,p,S),this}getBearing(){return this.transform.bearing}setBearing(p,S){return this.jumpTo({bearing:p},S),this}getPadding(){return this.transform.padding}setPadding(p,S){return this.jumpTo({padding:p},S),this}rotateTo(p,S,X){return this.easeTo(s.extend({bearing:p},S),X)}resetNorth(p,S){return this.rotateTo(0,s.extend({duration:1e3},p),S),this}resetNorthPitch(p,S){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},p),S),this}snapToNorth(p,S){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(p,S):this}getPitch(){return this.transform.pitch}setPitch(p,S){return this.jumpTo({pitch:p},S),this}cameraForBounds(p,S){p=s.LngLatBounds.convert(p);const X=S&&S.bearing||0,ze=S&&S.pitch||0,kt=p.getNorthWest(),vi=p.getSouthEast();return this._cameraForBounds(this.transform,kt,vi,X,ze,S)}_extendCameraOptions(p){const S={top:0,bottom:0,right:0,left:0};if(typeof(p=s.extend({padding:S,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){const X=p.padding;p.padding={top:X,bottom:X,right:X,left:X}}return p.padding=s.extend(S,p.padding),p}_minimumAABBFrustumDistance(p,S){const X=S.max[0]-S.min[0],ze=S.max[1]-S.min[1];return X/ze>p.aspect?X/(2*Math.tan(.5*p.fovX)*p.aspect):ze/(2*Math.tan(.5*p.fovY)*p.aspect)}_cameraForBoundsOnGlobe(p,S,X,ze,kt,vi){const or=p.clone(),Gn=this._extendCameraOptions(vi);or.bearing=ze,or.pitch=kt;const ia=s.LngLat.convert(S),oa=s.LngLat.convert(X),pl=.5*(ia.lat+oa.lat),lh=.5*(ia.lng+oa.lng),gh=s.latLngToECEF(pl,lh),yh=s.normalize([],gh),_h=s.normalize([],s.cross([],yh,[0,1,0])),xh=s.cross([],_h,yh),_l=[_h[0],_h[1],_h[2],0,xh[0],xh[1],xh[2],0,yh[0],yh[1],yh[2],0,0,0,0,1],mh=[gh,s.latLngToECEF(ia.lat,ia.lng),s.latLngToECEF(oa.lat,ia.lng),s.latLngToECEF(oa.lat,oa.lng),s.latLngToECEF(ia.lat,oa.lng),s.latLngToECEF(pl,ia.lng),s.latLngToECEF(pl,oa.lng),s.latLngToECEF(ia.lat,lh),s.latLngToECEF(oa.lat,lh)];let wh=s.Aabb.fromPoints(mh.map(Id=>[s.dot(_h,Id),s.dot(xh,Id),s.dot(yh,Id)]));const Sh=s.transformMat4([],wh.center,_l);s.squaredLength(Sh)===0&&s.set(Sh,0,0,1),s.normalize(Sh,Sh),s.scale$2(Sh,Sh,s.GLOBE_RADIUS),or.center=s.ecefToLatLng(Sh);const Oh=or.getWorldToCameraMatrix(),Uh=s.invert(new Float64Array(16),Oh);wh=s.Aabb.applyTransform(wh,s.multiply([],Oh,_l)),s.transformMat4(Sh,Sh,Oh);const Vh=.5*(wh.max[2]-wh.min[2]),Wh=this._minimumAABBFrustumDistance(or,wh),Zh=s.scale$2([],[0,0,1],Vh),id=s.add(Zh,Sh,Zh),Bd=Wh+(or.pitch===0?0:s.distance(Sh,id)),ed=or.globeCenterInViewSpace,Sd=s.sub([],Sh,[ed[0],ed[1],ed[2]]);s.normalize(Sd,Sd),s.scale$2(Sd,Sd,Bd);const dd=s.add([],Sh,Sd);s.transformMat4(dd,dd,Uh);const xd=s.earthRadius/s.GLOBE_RADIUS,nd=s.length(dd),vd=s.mercatorZfromAltitude(Math.max(nd*xd-s.earthRadius,Number.EPSILON),0),Od=Math.min(or.zoomFromMercatorZAdjusted(vd),Gn.maxZoom);return Od>.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(or.setProjection({name:"mercator"}),or.zoom=Od,this._cameraForBounds(or,S,X,ze,kt,vi)):{center:or.center,zoom:Od,bearing:ze,pitch:kt}}queryTerrainElevation(p,S){const X=this.transform.elevation;return X?(S=s.extend({},{exaggerated:!0},S),X.getAtPoint(s.MercatorCoordinate.fromLngLat(p),null,S.exaggerated)):null}_cameraForBounds(p,S,X,ze,kt,vi){if(p.projection.name==="globe")return this._cameraForBoundsOnGlobe(p,S,X,ze,kt,vi);const or=p.clone(),Gn=this._extendCameraOptions(vi),ia=or.padding;or.bearing=ze,or.pitch=kt;const oa=s.LngLat.convert(S),pl=s.LngLat.convert(X),lh=new s.LngLat(oa.lng,pl.lat),gh=new s.LngLat(pl.lng,oa.lat),yh=or.project(oa),_h=or.project(pl),xh=this.queryTerrainElevation(oa),_l=this.queryTerrainElevation(pl),mh=this.queryTerrainElevation(lh),wh=this.queryTerrainElevation(gh),Sh=[[yh.x,yh.y,Math.min(xh||0,_l||0,mh||0,wh||0)],[_h.x,_h.y,Math.max(xh||0,_l||0,mh||0,wh||0)]];let Oh=s.Aabb.fromPoints(Sh);const Uh=or.getWorldToCameraMatrix(),Vh=s.invert(new Float64Array(16),Uh);Oh=s.Aabb.applyTransform(Oh,Uh);const Wh=s.sub([],Oh.max,Oh.min),Zh=ia.left||0,id=ia.right||0,Bd=ia.bottom||0,ed=ia.top||0,{left:Sd,right:dd,top:xd,bottom:nd}=Gn.padding,vd=.5*(Zh+id),Od=.5*(ed+Bd),Id=Math.min(or.scaleZoom(or.scale*Math.min((or.width-(Zh+id+Sd+dd))/Wh[0],(or.height-(Bd+ed+nd+xd))/Wh[1])),Gn.maxZoom),$d=or.scale/or.zoomScale(Id);Oh=new s.Aabb([Oh.min[0]-(Sd+vd)*$d,Oh.min[1]-(nd+Od)*$d,Oh.min[2]],[Oh.max[0]+(dd+vd)*$d,Oh.max[1]+(xd+Od)*$d,Oh.max[2]]);const Gp=.5*Wh[2],Hf=this._minimumAABBFrustumDistance(or,Oh),Mp=[0,0,1,0];s.transformMat4$1(Mp,Mp,Uh),s.normalize$2(Mp,Mp);const Zp=s.scale$2([],Mp,Hf+Gp),rg=s.add([],Oh.center,Zp),Jf=(typeof Gn.offset.x=="number"&&typeof Gn.offset.y=="number"?new s.Point(Gn.offset.x,Gn.offset.y):s.Point.convert(Gn.offset)).rotate(-s.degToRad(ze));Oh.center[0]-=Jf.x*$d,Oh.center[1]+=Jf.y*$d,s.transformMat4(Oh.center,Oh.center,Vh),s.transformMat4(rg,rg,Vh);const Bp=[Oh.center[0],Oh.center[1],rg[2]*or.pixelsPerMeter];s.scale$2(Bp,Bp,1/or.worldSize);const fg=s.lngFromMercatorX(Bp[0]),Sg=s.latFromMercatorY(Bp[1]),Tg=Math.min(or._zoomFromMercatorZ(Bp[2]),Gn.maxZoom),gg=new s.LngLat(fg,Sg);return or.mercatorFromTransition&&Tg<.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(or.setProjection({name:"globe"}),or.zoom=Tg,this._cameraForBounds(or,S,X,ze,kt,vi)):{center:gg,zoom:Tg,bearing:ze,pitch:kt}}fitBounds(p,S,X){const ze=this.cameraForBounds(p,S);return this._fitInternal(ze,S,X)}fitScreenCoordinates(p,S,X,ze,kt){const vi=s.Point.convert(p),or=s.Point.convert(S),Gn=new s.Point(Math.min(vi.x,or.x),Math.min(vi.y,or.y)),ia=new s.Point(Math.max(vi.x,or.x),Math.max(vi.y,or.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(vi,or))return this;const oa=this.transform.pointLocation3D(Gn),pl=this.transform.pointLocation3D(ia),lh=this.transform.pointLocation3D(new s.Point(Gn.x,ia.y)),gh=this.transform.pointLocation3D(new s.Point(ia.x,Gn.y)),yh=[Math.min(oa.lng,pl.lng,lh.lng,gh.lng),Math.min(oa.lat,pl.lat,lh.lat,gh.lat)],_h=[Math.max(oa.lng,pl.lng,lh.lng,gh.lng),Math.max(oa.lat,pl.lat,lh.lat,gh.lat)],xh=ze&&ze.pitch?ze.pitch:this.getPitch(),_l=this._cameraForBounds(this.transform,yh,_h,X,xh,ze);return this._fitInternal(_l,ze,kt)}_fitInternal(p,S,X){return p?(delete(S=s.extend(p,S)).padding,S.linear?this.easeTo(S,X):this.flyTo(S,X)):this}jumpTo(p,S){this.stop();const X=p.preloadOnly?this.transform.clone():this.transform;let ze=!1,kt=!1,vi=!1;return"zoom"in p&&X.zoom!==+p.zoom&&(ze=!0,X.zoom=+p.zoom),p.center!==void 0&&(X.center=s.LngLat.convert(p.center)),"bearing"in p&&X.bearing!==+p.bearing&&(kt=!0,X.bearing=+p.bearing),"pitch"in p&&X.pitch!==+p.pitch&&(vi=!0,X.pitch=+p.pitch),p.padding==null||X.isPaddingEqual(p.padding)||(X.padding=p.padding),p.preloadOnly?(this._preloadTiles(X),this):(this.fire(new s.Event("movestart",S)).fire(new s.Event("move",S)),ze&&this.fire(new s.Event("zoomstart",S)).fire(new s.Event("zoom",S)).fire(new s.Event("zoomend",S)),kt&&this.fire(new s.Event("rotatestart",S)).fire(new s.Event("rotate",S)).fire(new s.Event("rotateend",S)),vi&&this.fire(new s.Event("pitchstart",S)).fire(new s.Event("pitch",S)).fire(new s.Event("pitchend",S)),this.fire(new s.Event("moveend",S)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.warnOnce(ds),this.transform.getFreeCameraOptions()}setFreeCameraOptions(p,S){const X=this.transform;if(!X.projection.supportsFreeCamera)return s.warnOnce(ds),this;this.stop();const ze=X.zoom,kt=X.pitch,vi=X.bearing;X.setFreeCameraOptions(p);const or=ze!==X.zoom,Gn=kt!==X.pitch,ia=vi!==X.bearing;return this.fire(new s.Event("movestart",S)).fire(new s.Event("move",S)),or&&this.fire(new s.Event("zoomstart",S)).fire(new s.Event("zoom",S)).fire(new s.Event("zoomend",S)),ia&&this.fire(new s.Event("rotatestart",S)).fire(new s.Event("rotate",S)).fire(new s.Event("rotateend",S)),Gn&&this.fire(new s.Event("pitchstart",S)).fire(new s.Event("pitch",S)).fire(new s.Event("pitchend",S)),this.fire(new s.Event("moveend",S)),this}easeTo(p,S){this._stop(!1,p.easeId),((p=s.extend({offset:[0,0],duration:500,easing:s.ease},p)).animate===!1||this._prefersReducedMotion(p))&&(p.duration=0);const X=this.transform,ze=this.getZoom(),kt=this.getBearing(),vi=this.getPitch(),or=this.getPadding(),Gn="zoom"in p?+p.zoom:ze,ia="bearing"in p?this._normalizeBearing(p.bearing,kt):kt,oa="pitch"in p?+p.pitch:vi,pl="padding"in p?p.padding:X.padding,lh=s.Point.convert(p.offset);let gh,yh,_h;if(X.projection.name==="globe"){const Zh=s.MercatorCoordinate.fromLngLat(X.center),id=lh.rotate(-X.angle);Zh.x+=id.x/X.worldSize,Zh.y+=id.y/X.worldSize;const Bd=Zh.toLngLat(),ed=s.LngLat.convert(p.center||Bd);this._normalizeCenter(ed),gh=X.centerPoint.add(id),yh=new s.Point(Zh.x,Zh.y).mult(X.worldSize),_h=new s.Point(s.mercatorXfromLng(ed.lng),s.mercatorYfromLat(ed.lat)).mult(X.worldSize).sub(yh)}else{gh=X.centerPoint.add(lh);const Zh=X.pointLocation(gh),id=s.LngLat.convert(p.center||Zh);this._normalizeCenter(id),yh=X.project(Zh),_h=X.project(id).sub(yh)}const xh=X.zoomScale(Gn-ze);let _l,mh;p.around&&(_l=s.LngLat.convert(p.around),mh=X.locationPoint(_l));const wh=this._zooming||Gn!==ze,Sh=this._rotating||kt!==ia,Oh=this._pitching||oa!==vi,Uh=!X.isPaddingEqual(pl),Vh=Zh=>id=>{if(wh&&(Zh.zoom=s.number(ze,Gn,id)),Sh&&(Zh.bearing=s.number(kt,ia,id)),Oh&&(Zh.pitch=s.number(vi,oa,id)),Uh&&(Zh.interpolatePadding(or,pl,id),gh=Zh.centerPoint.add(lh)),_l)Zh.setLocationAtPoint(_l,mh);else{const Bd=Zh.zoomScale(Zh.zoom-ze),ed=Gn>ze?Math.min(2,xh):Math.max(.5,xh),Sd=Math.pow(ed,1-id),dd=Zh.unproject(yh.add(_h.mult(id*Sd)).mult(Bd));Zh.setLocationAtPoint(Zh.renderWorldCopies?dd.wrap():dd,gh)}return p.preloadOnly||this._fireMoveEvents(S),Zh};if(p.preloadOnly){const Zh=this._emulate(Vh,p.duration,X);return this._preloadTiles(Zh),this}const Wh={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=wh,this._rotating=Sh,this._pitching=Oh,this._padding=Uh,this._easeId=p.easeId,this._prepareEase(S,p.noMoveStart,Wh),this._ease(Vh(X),Zh=>{X.recenterOnTerrain(),this._afterEase(S,Zh)},p),this}_prepareEase(p,S,X={}){this._moving=!0,this.transform.cameraElevationReference="sea",S||X.moving||this.fire(new s.Event("movestart",p)),this._zooming&&!X.zooming&&this.fire(new s.Event("zoomstart",p)),this._rotating&&!X.rotating&&this.fire(new s.Event("rotatestart",p)),this._pitching&&!X.pitching&&this.fire(new s.Event("pitchstart",p))}_fireMoveEvents(p){this.fire(new s.Event("move",p)),this._zooming&&this.fire(new s.Event("zoom",p)),this._rotating&&this.fire(new s.Event("rotate",p)),this._pitching&&this.fire(new s.Event("pitch",p))}_afterEase(p,S){if(this._easeId&&S&&this._easeId===S)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const X=this._zooming,ze=this._rotating,kt=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,X&&this.fire(new s.Event("zoomend",p)),ze&&this.fire(new s.Event("rotateend",p)),kt&&this.fire(new s.Event("pitchend",p)),this.fire(new s.Event("moveend",p))}flyTo(p,S){if(this._prefersReducedMotion(p)){const Id=s.pick(p,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Id,S)}this.stop(),p=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},p);const X=this.transform,ze=this.getZoom(),kt=this.getBearing(),vi=this.getPitch(),or=this.getPadding(),Gn="zoom"in p?s.clamp(+p.zoom,X.minZoom,X.maxZoom):ze,ia="bearing"in p?this._normalizeBearing(p.bearing,kt):kt,oa="pitch"in p?+p.pitch:vi,pl="padding"in p?p.padding:X.padding,lh=X.zoomScale(Gn-ze),gh=s.Point.convert(p.offset);let yh=X.centerPoint.add(gh);const _h=X.pointLocation(yh),xh=s.LngLat.convert(p.center||_h);this._normalizeCenter(xh);const _l=X.project(_h),mh=X.project(xh).sub(_l);let wh=p.curve;const Sh=Math.max(X.width,X.height),Oh=Sh/lh,Uh=mh.mag();if("minZoom"in p){const Id=s.clamp(Math.min(p.minZoom,ze,Gn),X.minZoom,X.maxZoom),$d=Sh/X.zoomScale(Id-ze);wh=Math.sqrt($d/Uh*2)}const Vh=wh*wh;function Wh(Id){const $d=(Oh*Oh-Sh*Sh+(Id?-1:1)*Vh*Vh*Uh*Uh)/(2*(Id?Oh:Sh)*Vh*Uh);return Math.log(Math.sqrt($d*$d+1)-$d)}function Zh(Id){return(Math.exp(Id)-Math.exp(-Id))/2}function id(Id){return(Math.exp(Id)+Math.exp(-Id))/2}const Bd=Wh(0);let ed=function(Id){return id(Bd)/id(Bd+wh*Id)},Sd=function(Id){return Sh*((id(Bd)*(Zh($d=Bd+wh*Id)/id($d))-Zh(Bd))/Vh)/Uh;var $d},dd=(Wh(1)-Bd)/wh;if(Math.abs(Uh)<1e-6||!isFinite(dd)){if(Math.abs(Sh-Oh)<1e-6)return this.easeTo(p,S);const Id=Oh<Sh?-1:1;dd=Math.abs(Math.log(Oh/Sh))/wh,Sd=function(){return 0},ed=function($d){return Math.exp(Id*wh*$d)}}p.duration="duration"in p?+p.duration:1e3*dd/("screenSpeed"in p?+p.screenSpeed/wh:+p.speed),p.maxDuration&&p.duration>p.maxDuration&&(p.duration=0);const xd=kt!==ia,nd=oa!==vi,vd=!X.isPaddingEqual(pl),Od=Id=>$d=>{const Gp=$d*dd,Hf=1/ed(Gp);Id.zoom=$d===1?Gn:ze+Id.scaleZoom(Hf),xd&&(Id.bearing=s.number(kt,ia,$d)),nd&&(Id.pitch=s.number(vi,oa,$d)),vd&&(Id.interpolatePadding(or,pl,$d),yh=Id.centerPoint.add(gh));const Mp=$d===1?xh:Id.unproject(_l.add(mh.mult(Sd(Gp))).mult(Hf));return Id.setLocationAtPoint(Id.renderWorldCopies?Mp.wrap():Mp,yh),Id._updateCameraOnTerrain(),p.preloadOnly||this._fireMoveEvents(S),Id};if(p.preloadOnly){const Id=this._emulate(Od,p.duration,X);return this._preloadTiles(Id),this}return this._zooming=!0,this._rotating=xd,this._pitching=nd,this._padding=vd,this._prepareEase(S,!1),this._ease(Od(X),()=>this._afterEase(S),p),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(p,S){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const X=this._onEaseEnd;this._onEaseEnd=void 0,X.call(this,S)}if(!p){const X=this.handlers;X&&X.stop(!1)}return this}_ease(p,S,X){X.animate===!1||X.duration===0?(p(1),S()):(this._easeStart=s.exported.now(),this._easeOptions=X,this._onEaseFrame=p,this._onEaseEnd=S,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const p=Math.min((s.exported.now()-this._easeStart)/this._easeOptions.duration,1),S=this._onEaseFrame;S&&S(this._easeOptions.easing(p)),p<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(p,S){p=s.wrap(p,-180,180);const X=Math.abs(p-S);return Math.abs(p-360-S)<X&&(p-=360),Math.abs(p+360-S)<X&&(p+=360),p}_normalizeCenter(p){const S=this.transform;if(!S.renderWorldCopies||S.maxBounds)return;const X=p.lng-S.center.lng;p.lng+=X>180?-360:X<-180?360:0}_prefersReducedMotion(p){return this._respectPrefersReducedMotion&&s.exported.prefersReducedMotion&&!(p&&p.essential)}_emulate(p,S,X){const ze=Math.ceil(15*S/1e3),kt=[],vi=p(X.clone());for(let or=0;or<=ze;or++){const Gn=vi(or/ze);kt.push(Gn.clone())}return kt}}class vs{constructor(p={}){this.options=p,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(p){const S=this.options&&this.options.compact;return this._map=p,this._container=Ee("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ee("button","mapboxgl-ctrl-attrib-button",this._container),Ee("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ee("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),S&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),S===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(p,S){const X=this._map._getUIString(`AttributionControl.${S}`);p.setAttribute("aria-label",X),p.removeAttribute("title"),p.firstElementChild&&p.firstElementChild.setAttribute("title",X)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let p=this._editLink;p||(p=this._editLink=this._container.querySelector(".mapbox-improve-map"));const S=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(p){const X=S.reduce((ze,kt,vi)=>(kt.value&&(ze+=`${kt.key}=${kt.value}${vi<S.length-1?"&":""}`),ze),"?");p.href=`${s.config.FEEDBACK_URL}/${X}#${Bm(this._map,!0)}`,p.rel="noopener nofollow",this._setElementTitle(p,"MapFeedback")}}_updateData(p){!p||p.sourceDataType!=="metadata"&&p.sourceDataType!=="visibility"&&p.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let p=[];if(this._map.style.stylesheet){const ze=this._map.style.stylesheet;this.styleOwner=ze.owner,this.styleId=ze.id}const S=this._map.style._sourceCaches;for(const ze in S){const kt=S[ze];if(kt.used){const vi=kt.getSource();vi.attribution&&p.indexOf(vi.attribution)<0&&p.push(vi.attribution)}}p.sort((ze,kt)=>ze.length-kt.length),p=p.filter((ze,kt)=>{for(let vi=kt+1;vi<p.length;vi++)if(p[vi].indexOf(ze)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?p=[...this.options.customAttribution,...p]:p.unshift(this.options.customAttribution));const X=p.join(" | ");X!==this._attribHTML&&(this._attribHTML=X,p.length?(this._innerContainer.innerHTML=X,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class fl{constructor(){s.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(p){this._map=p,this._container=Ee("div","mapboxgl-ctrl");const S=Ee("a","mapboxgl-ctrl-logo");return S.target="_blank",S.rel="noopener nofollow",S.href="https://www.mapbox.com/",S.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),S.setAttribute("rel","noopener nofollow"),this._container.appendChild(S),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(p){p&&p.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const p=this._map.style._sourceCaches;if(Object.entries(p).length===0)return!0;for(const S in p){const X=p[S].getSource();if(X.hasOwnProperty("mapbox_logo")&&!X.mapbox_logo)return!1}return!0}_updateCompact(){const p=this._container.children;if(p.length){const S=p[0];this._map.getCanvasContainer().offsetWidth<250?S.classList.add("mapboxgl-compact"):S.classList.remove("mapboxgl-compact")}}}class dl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(p){const S=++this._id;return this._queue.push({callback:p,id:S,cancelled:!1}),S}remove(p){const S=this._currentlyRunning,X=S?this._queue.concat(S):this._queue;for(const ze of X)if(ze.id===p)return void(ze.cancelled=!0)}run(p=0){const S=this._currentlyRunning=this._queue;this._queue=[];for(const X of S)if(!X.cancelled&&(X.callback(p),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function dh(L,p,S){if(L=new s.LngLat(L.lng,L.lat),p){const X=new s.LngLat(L.lng-360,L.lat),ze=new s.LngLat(L.lng+360,L.lat),kt=360*Math.ceil(Math.abs(L.lng-S.center.lng)/360),vi=S.locationPoint(L).distSqr(p),or=p.x<0||p.y<0||p.x>S.width||p.y>S.height;S.locationPoint(X).distSqr(p)<vi&&(or||Math.abs(X.lng-S.center.lng)<kt)?L=X:S.locationPoint(ze).distSqr(p)<vi&&(or||Math.abs(ze.lng-S.center.lng)<kt)&&(L=ze)}for(;Math.abs(L.lng-S.center.lng)>180;){const X=S.locationPoint(L);if(X.x>=0&&X.y>=0&&X.x<=S.width&&X.y<=S.height)break;L.lng>S.center.lng?L.lng-=360:L.lng+=360}return L}const Ah={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class hh extends s.Evented{constructor(p,S){if(super(),(p instanceof s.window.HTMLElement||S)&&(p=s.extend({element:p},S)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=p&&p.anchor||"center",this._color=p&&p.color||"#3FB1CE",this._scale=p&&p.scale||1,this._draggable=p&&p.draggable||!1,this._clickTolerance=p&&p.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=p&&p.rotation||0,this._rotationAlignment=p&&p.rotationAlignment||"auto",this._pitchAlignment=p&&p.pitchAlignment&&p.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=p&&p.occludedOpacity||.2,p&&p.element)this._element=p.element,this._offset=s.Point.convert(p&&p.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ee("div");const ze=41,kt=27,vi=dt("svg",{display:"block",height:ze*this._scale+"px",width:kt*this._scale+"px",viewBox:`0 0 ${kt} ${ze}`},this._element),or=dt("radialGradient",{id:"shadowGradient"},dt("defs",{},vi));dt("stop",{offset:"10%","stop-opacity":.4},or),dt("stop",{offset:"100%","stop-opacity":.05},or),dt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},vi),dt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},vi),dt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},vi),dt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},vi),this._offset=s.Point.convert(p&&p.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",ze=>{ze.preventDefault()}),this._element.addEventListener("mousedown",ze=>{ze.preventDefault()});const X=this._element.classList;for(const ze in Ah)X.remove(`mapboxgl-marker-anchor-${ze}`);X.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(p){return p===this._map||(this.remove(),this._map=p,p.getCanvasContainer().appendChild(this._element),p.on("move",this._updateMoving),p.on("moveend",this._update),p.on("remove",this._clearFadeTimer),p._addMarker(this),this.setDraggable(this._draggable),this._update(),p.on("click",this._onMapClick)),this}remove(){const p=this._map;return p&&(p.off("click",this._onMapClick),p.off("move",this._updateMoving),p.off("moveend",this._update),p.off("mousedown",this._addDragHandler),p.off("touchstart",this._addDragHandler),p.off("mouseup",this._onUp),p.off("touchend",this._onUp),p.off("mousemove",this._onMove),p.off("touchmove",this._onMove),p.off("remove",this._clearFadeTimer),p._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=s.LngLat.convert(p),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(p){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),p){if(!("offset"in p.options)){const ze=Math.sqrt(Math.pow(13.5,2)/2);p.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[ze,-1*(38.1-13.5+ze)],"bottom-right":[-ze,-1*(38.1-13.5+ze)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=p,p._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(p){const S=p.code,X=p.charCode||p.keyCode;S!=="Space"&&S!=="Enter"&&X!==32&&X!==13||this.togglePopup()}_onMapClick(p){const S=p.originalEvent.target,X=this._element;this._popup&&(S===X||X.contains(S))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const p=this._popup;return p?(p.isOpen()?(p.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(p.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const p=this._map,S=this._pos;if(!p||!S)return!1;const X=p.unproject(S),ze=p.getFreeCameraOptions();if(!ze.position)return!1;const kt=ze.position.toLngLat();return kt.distanceTo(X)<.9*kt.distanceTo(this._lngLat)}_evaluateOpacity(){const p=this._map;if(!p)return;const S=this._pos;if(!S||S.x<0||S.x>p.transform.width||S.y<0||S.y>p.transform.height)return void this._clearFadeTimer();const X=p.unproject(S);let ze;p._showingGlobe()&&s.isLngLatBehindGlobe(p.transform,this._lngLat)?ze=0:(ze=1-p._queryFogOpacity(X),p.transform._terrainEnabled()&&p.getTerrain()&&this._behindTerrain()&&(ze*=this._occludedOpacity)),this._element.style.opacity=`${ze}`,this._element.style.pointerEvents=ze>0?"auto":"none",this._popup&&this._popup._setOpacity(ze),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const p=this._pos;if(!p||!this._map)return;const S=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${p.x}px,${p.y}px)
            ${Ah[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${S.x}px,${S.y}px)
        `}_calculateXYTransform(){const p=this._pos,S=this._map,X=this.getPitchAlignment();if(!S||!p||X!=="map")return"";if(!S._showingGlobe()){const Gn=S.getPitch();return Gn?`rotateX(${Gn}deg)`:""}const ze=s.radToDeg(s.globeTiltAtLngLat(S.transform,this._lngLat)),kt=p.sub(s.globeCenterToScreenPoint(S.transform)),vi=Math.abs(kt.x)+Math.abs(kt.y);if(vi===0)return"";const or=ze/vi;return`rotateX(${-kt.y*or}deg) rotateY(${kt.x*or}deg)`}_calculateZTransform(){const p=this._pos,S=this._map;if(!S||!p)return"";let X=0;const ze=this.getRotationAlignment();if(ze==="map")if(S._showingGlobe()){const kt=S.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),vi=S.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(kt);X=s.radToDeg(Math.atan2(vi.y,vi.x))-90}else X=-S.getBearing();else if(ze==="horizon"){const kt=s.smoothstep(4,6,S.getZoom()),vi=s.globeCenterToScreenPoint(S.transform);vi.y+=kt*S.transform.height;const or=p.sub(vi),Gn=s.radToDeg(Math.atan2(or.y,or.x));X=(Gn>90?Gn-270:Gn+90)*(1-kt)}return X+=this._rotation,X?`rotateZ(${X}deg)`:""}_update(p){s.window.cancelAnimationFrame(this._updateFrameId);const S=this._map;S&&(S.transform.renderWorldCopies&&(this._lngLat=dh(this._lngLat,this._pos,S.transform)),this._pos=S.project(this._lngLat),p===!0?this._updateFrameId=s.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),S._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(S._showingGlobe()||S.getTerrain()||S.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(p){return this._offset=s.Point.convert(p),this._update(),this}_onMove(p){const S=this._map;if(!S)return;const X=this._pointerdownPos,ze=this._positionDelta;if(X&&ze){if(!this._isDragging){const kt=this._clickTolerance||S._clickTolerance;if(p.point.dist(X)<kt)return;this._isDragging=!0}this._pos=p.point.sub(ze),this._lngLat=S.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const p=this._map;p&&(p.off("mousemove",this._onMove),p.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"}_addDragHandler(p){const S=this._map,X=this._pos;S&&X&&this._element.contains(p.originalEvent.target)&&(p.preventDefault(),this._positionDelta=p.point.sub(X),this._pointerdownPos=p.point,this._state="pending",S.on("mousemove",this._onMove),S.on("touchmove",this._onMove),S.once("mouseup",this._onUp),S.once("touchend",this._onUp))}setDraggable(p){this._draggable=!!p;const S=this._map;return S&&(p?(S.on("mousedown",this._addDragHandler),S.on("touchstart",this._addDragHandler)):(S.off("mousedown",this._addDragHandler),S.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(p){return this._rotation=p||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(p){return this._rotationAlignment=p||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(p){return this._pitchAlignment=p||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(p){return this._occludedOpacity=p||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Rh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},zh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Kh(L=new s.Point(0,0),p="bottom"){if(typeof L=="number"){const S=Math.round(Math.sqrt(.5*Math.pow(L,2)));switch(p){case"top":return new s.Point(0,L);case"top-left":return new s.Point(S,S);case"top-right":return new s.Point(-S,S);case"bottom":return new s.Point(0,-L);case"bottom-left":return new s.Point(S,-S);case"bottom-right":return new s.Point(-S,-S);case"left":return new s.Point(L,0);case"right":return new s.Point(-L,0)}return new s.Point(0,0)}return L instanceof s.Point||Array.isArray(L)?s.Point.convert(L):s.Point.convert(L[p]||[0,0])}class ad{constructor(p){this.jumpTo(p)}getValue(p){if(p<=this._startTime)return this._start;if(p>=this._endTime)return this._end;const S=s.easeCubicInOut((p-this._startTime)/(this._endTime-this._startTime));return this._start*(1-S)+this._end*S}isEasing(p){return p>=this._startTime&&p<=this._endTime}jumpTo(p){this._startTime=-1/0,this._endTime=-1/0,this._start=p,this._end=p}easeTo(p,S,X){this._start=this.getValue(S),this._end=p,this._startTime=S,this._endTime=S+X}}const Lh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},od={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},md={showCompass:!0,showZoom:!0,visualizePitch:!1};class Nd{constructor(p,S,X=!1){this._clickTolerance=10,this.element=S,this.mouseRotate=new ix({clickTolerance:p.dragRotate._mouseRotate._clickTolerance}),this.map=p,X&&(this.mousePitch=new wy({clickTolerance:p.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),S.addEventListener("mousedown",this.mousedown),S.addEventListener("touchstart",this.touchstart,{passive:!1}),S.addEventListener("touchmove",this.touchmove),S.addEventListener("touchend",this.touchend),S.addEventListener("touchcancel",this.reset)}down(p,S){this.mouseRotate.mousedown(p,S),this.mousePitch&&this.mousePitch.mousedown(p,S),Bn()}move(p,S){const X=this.map,ze=this.mouseRotate.mousemoveWindow(p,S),kt=ze&&ze.bearingDelta;if(kt&&X.setBearing(X.getBearing()+kt),this.mousePitch){const vi=this.mousePitch.mousemoveWindow(p,S),or=vi&&vi.pitchDelta;or&&X.setPitch(X.getPitch()+or)}}off(){const p=this.element;p.removeEventListener("mousedown",this.mousedown),p.removeEventListener("touchstart",this.touchstart,{passive:!1}),p.removeEventListener("touchmove",this.touchmove),p.removeEventListener("touchend",this.touchend),p.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Vn(),s.window.removeEventListener("mousemove",this.mousemove),s.window.removeEventListener("mouseup",this.mouseup)}mousedown(p){this.down(s.extend({},p,{ctrlKey:!0,preventDefault:()=>p.preventDefault()}),il(this.element,p)),s.window.addEventListener("mousemove",this.mousemove),s.window.addEventListener("mouseup",this.mouseup)}mousemove(p){this.move(p,il(this.element,p))}mouseup(p){this.mouseRotate.mouseupWindow(p),this.mousePitch&&this.mousePitch.mouseupWindow(p),this.offTemp()}touchstart(p){p.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=gl(this.element,p.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>p.preventDefault()},this._startPos))}touchmove(p){p.targetTouches.length!==1?this.reset():(this._lastPos=gl(this.element,p.targetTouches)[0],this.move({preventDefault:()=>p.preventDefault()},this._lastPos))}touchend(p){p.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Hd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},tp={maxWidth:100,unit:"metric"},Vd={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},gp={version:s.version,supported:y,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:class extends hs{constructor(L){if(s.LivePerformanceUtils.mark(s.PerformanceMarkers.create),(L=s.extend({},od,L)).minZoom!=null&&L.maxZoom!=null&&L.minZoom>L.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(L.minPitch!=null&&L.maxPitch!=null&&L.minPitch>L.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(L.minPitch!=null&&L.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(L.maxPitch!=null&&L.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(L.antialias&&s.isSafariWithAntialiasingBug(s.window)&&(L.antialias=!1,s.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ty(L.minZoom,L.maxZoom,L.minPitch,L.maxPitch,L.renderWorldCopies),L),this._interactive=L.interactive,this._minTileCacheSize=L.minTileCacheSize,this._maxTileCacheSize=L.maxTileCacheSize,this._failIfMajorPerformanceCaveat=L.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=L.preserveDrawingBuffer,this._antialias=L.antialias,this._useWebGL2=L.useWebGL2,this._trackResize=L.trackResize,this._bearingSnap=L.bearingSnap,this._refreshExpiredTiles=L.refreshExpiredTiles,this._fadeDuration=L.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=L.crossSourceCollisions,this._collectResourceTiming=L.collectResourceTiming,this._optimizeForTerrain=L.optimizeForTerrain,this._language=this._parseLanguage(L.language),this._worldview=L.worldview,this._renderTaskQueue=new dl,this._domRenderTaskQueue=new dl,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.uniqueId(),this._locale=s.extend({},Lh,L.locale),this._clickTolerance=L.clickTolerance,this._cooperativeGestures=L.cooperativeGestures,this._performanceMetricsCollection=L.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ad(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new s.RequestManager(L.transformRequest,L.accessToken,L.testMode),this._silenceAuthErrors=!!L.testMode,typeof L.container=="string"){if(this._container=s.window.document.getElementById(L.container),!this._container)throw new Error(`Container '${L.container}' not found.`)}else{if(!(L.container instanceof s.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=L.container}if(this._container.childNodes.length>0&&s.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),L.maxBounds&&this.setMaxBounds(L.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1),s.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new In(this,L),this._localFontFamily=L.localFontFamily,this._localIdeographFontFamily=L.localIdeographFontFamily,L.style&&this.setStyle(L.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),L.projection&&this.setProjection(L.projection),this._hash=L.hash&&new ex(typeof L.hash=="string"&&L.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:L.center,zoom:L.zoom,bearing:L.bearing,pitch:L.pitch}),L.bounds&&(this.resize(),this.fitBounds(L.bounds,s.extend({},L.fitBoundsOptions,{duration:0})))),this.resize(),L.attributionControl&&this.addControl(new vs({customAttribution:L.customAttribution})),this._logoControl=new fl,this.addControl(this._logoControl,L.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",p=>{this._update(p.dataType==="style"),this.fire(new s.Event(`${p.dataType}data`,p))}),this.on("dataloading",p=>{this.fire(new s.Event(`${p.dataType}dataloading`,p))})}_getMapId(){return this._mapId}addControl(L,p){if(p===void 0&&(p=L.getDefaultPosition?L.getDefaultPosition():"top-right"),!L||!L.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const S=L.onAdd(this);this._controls.push(L);const X=this._controlPositions[p];return p.indexOf("bottom")!==-1?X.insertBefore(S,X.firstChild):X.appendChild(S),this}removeControl(L){if(!L||!L.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const p=this._controls.indexOf(L);return p>-1&&this._controls.splice(p,1),L.onRemove(this),this}hasControl(L){return this._controls.indexOf(L)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(L){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const p=!this._moving;return p&&this.fire(new s.Event("movestart",L)).fire(new s.Event("move",L)),this.fire(new s.Event("resize",L)),p&&this.fire(new s.Event("moveend",L)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(L){return this.transform.setMaxBounds(s.LngLatBounds.convert(L)),this._update()}setMinZoom(L){if((L=L??-2)>=-2&&L<=this.transform.maxZoom)return this.transform.minZoom=L,this._update(),this.getZoom()<L?this.setZoom(L):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(L){if((L=L??22)>=this.transform.minZoom)return this.transform.maxZoom=L,this._update(),this.getZoom()>L?this.setZoom(L):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(L){if((L=L??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(L>=0&&L<=this.transform.maxPitch)return this.transform.minPitch=L,this._update(),this.getPitch()<L?this.setPitch(L):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(L){if((L=L??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(L>=this.transform.minPitch)return this.transform.maxPitch=L,this._update(),this.getPitch()>L?this.setPitch(L):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(L){return this.transform.renderWorldCopies=L,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(L){return L==="auto"?s.window.navigator.language:Array.isArray(L)?L.length===0?void 0:L.map(p=>p==="auto"?s.window.navigator.language:p):L}setLanguage(L){const p=this._parseLanguage(L);if(!this.style||p===this._language)return this;this._language=p,this.style._reloadSources();for(const S of this._controls)S._setLanguage&&S._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(L){return this.style&&L!==this._worldview?(this._worldview=L,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(L){return this._lazyInitEmptyStyle(),L?typeof L=="string"&&(L={name:L}):L=null,this._useExplicitProjection=!!L,this._prioritizeAndUpdateProjection(L,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const L=this.transform,p=L.projection.name;let S;p==="globe"&&L.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?(L.setMercatorFromTransition(),S=!0):p==="mercator"&&L.zoom<s.GLOBE_ZOOM_THRESHOLD_MAX&&(L.setProjection({name:"globe"}),S=!0),S&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(L,p){return this._updateProjection(L||p||{name:"mercator"})}_updateProjection(L){let p;if(p=L.name==="globe"&&this.transform.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(L),this.style.applyProjectionUpdate(),p){this.painter.clearBackgroundTiles();for(const S in this.style._sourceCaches)this.style._sourceCaches[S].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(L){return this.transform.locationPoint3D(s.LngLat.convert(L))}unproject(L){return this.transform.pointLocation3D(s.Point.convert(L))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(L,p,S){if(L==="mouseenter"||L==="mouseover"){let X=!1;const ze=vi=>{const or=p.filter(ia=>this.getLayer(ia)),Gn=or.length?this.queryRenderedFeatures(vi.point,{layers:or}):[];Gn.length?X||(X=!0,S.call(this,new tm(L,this,vi.originalEvent,{features:Gn}))):X=!1},kt=()=>{X=!1};return{layers:new Set(p),listener:S,delegates:{mousemove:ze,mouseout:kt}}}if(L==="mouseleave"||L==="mouseout"){let X=!1;const ze=vi=>{const or=p.filter(Gn=>this.getLayer(Gn));(or.length?this.queryRenderedFeatures(vi.point,{layers:or}):[]).length?X=!0:X&&(X=!1,S.call(this,new tm(L,this,vi.originalEvent)))},kt=vi=>{X&&(X=!1,S.call(this,new tm(L,this,vi.originalEvent)))};return{layers:new Set(p),listener:S,delegates:{mousemove:ze,mouseout:kt}}}{const X=ze=>{const kt=p.filter(or=>this.getLayer(or)),vi=kt.length?this.queryRenderedFeatures(ze.point,{layers:kt}):[];vi.length&&(ze.features=vi,S.call(this,ze),delete ze.features)};return{layers:new Set(p),listener:S,delegates:{[L]:X}}}}on(L,p,S){if(S===void 0)return super.on(L,p);Array.isArray(p)||(p=[p]);const X=this._createDelegatedListener(L,p,S);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[L]=this._delegatedListeners[L]||[],this._delegatedListeners[L].push(X);for(const ze in X.delegates)this.on(ze,X.delegates[ze]);return this}once(L,p,S){if(S===void 0)return super.once(L,p);Array.isArray(p)||(p=[p]);const X=this._createDelegatedListener(L,p,S);for(const ze in X.delegates)this.once(ze,X.delegates[ze]);return this}off(L,p,S){if(S===void 0)return super.off(L,p);p=new Set(Array.isArray(p)?p:[p]);const X=(kt,vi)=>{if(kt.size!==vi.size)return!1;for(const or of kt)if(!vi.has(or))return!1;return!0},ze=this._delegatedListeners?this._delegatedListeners[L]:void 0;return ze&&(kt=>{for(let vi=0;vi<kt.length;vi++){const or=kt[vi];if(or.listener===S&&X(or.layers,p)){for(const Gn in or.delegates)this.off(Gn,or.delegates[Gn]);return kt.splice(vi,1),this}}})(ze),this}queryRenderedFeatures(L,p){return this.style?(p!==void 0||L===void 0||L instanceof s.Point||Array.isArray(L)||(p=L,L=void 0),this.style.queryRenderedFeatures(L=L||[[0,0],[this.transform.width,this.transform.height]],p=p||{},this.transform)):[]}querySourceFeatures(L,p){return this.style.querySourceFeatures(L,p)}isPointOnSurface(L){const{name:p}=this.transform.projection;return p!=="globe"&&p!=="mercator"&&s.warnOnce(`${p} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.Point.convert(L))}setStyle(L,p){return(p=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},p)).diff!==!1&&p.localIdeographFontFamily===this._localIdeographFontFamily&&p.localFontFamily===this._localFontFamily&&this.style&&L?(this._diffStyle(L,p),this):(this._localIdeographFontFamily=p.localIdeographFontFamily,this._localFontFamily=p.localFontFamily,this._updateStyle(L,p))}_getUIString(L){const p=this._locale[L];if(p==null)throw new Error(`Missing UI string '${L}'`);return p}_updateStyle(L,p){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),L&&(this.style=new N_(this,p||{}),this.style.setEventedParent(this,{style:this.style}),typeof L=="string"?this.style.loadURL(L):this.style.loadJSON(L)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new N_(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(L,p){if(typeof L=="string"){const S=this._requestManager.normalizeStyleURL(L),X=this._requestManager.transformRequest(S,s.ResourceType.Style);s.getJSON(X,(ze,kt)=>{ze?this.fire(new s.ErrorEvent(ze)):kt&&this._updateDiff(kt,p)})}else typeof L=="object"&&this._updateDiff(L,p)}_updateDiff(L,p){try{this.style.setState(L)&&this._update(!0)}catch(S){s.warnOnce(`Unable to perform style diff: ${S.message||S.error||S}.  Rebuilding the style from scratch.`),this._updateStyle(L,p)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.warnOnce("There is no style added to the map."),!1)}addSource(L,p){return this._lazyInitEmptyStyle(),this.style.addSource(L,p),this._update(!0)}isSourceLoaded(L){return!!this.style&&this.style._isSourceCacheLoaded(L)}areTilesLoaded(){const L=this.style&&this.style._sourceCaches;for(const p in L){const S=L[p]._tiles;for(const X in S){const ze=S[X];if(ze.state!=="loaded"&&ze.state!=="errored")return!1}}return!0}addSourceType(L,p,S){this._lazyInitEmptyStyle(),this.style.addSourceType(L,p,S)}removeSource(L){return this.style.removeSource(L),this._updateTerrain(),this._update(!0)}getSource(L){return this.style.getSource(L)}addImage(L,p,{pixelRatio:S=1,sdf:X=!1,stretchX:ze,stretchY:kt,content:vi}={}){if(this._lazyInitEmptyStyle(),p instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&p instanceof s.window.ImageBitmap){const{width:or,height:Gn,data:ia}=s.exported.getImageData(p);this.style.addImage(L,{data:new s.RGBAImage({width:or,height:Gn},ia),pixelRatio:S,stretchX:ze,stretchY:kt,content:vi,sdf:X,version:0})}else if(p.width===void 0||p.height===void 0)this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:or,height:Gn}=p,ia=p;this.style.addImage(L,{data:new s.RGBAImage({width:or,height:Gn},new Uint8Array(ia.data)),pixelRatio:S,stretchX:ze,stretchY:kt,content:vi,sdf:X,version:0,userImage:ia}),ia.onAdd&&ia.onAdd(this,L)}}updateImage(L,p){const S=this.style.getImage(L);if(!S)return void this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const X=p instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&p instanceof s.window.ImageBitmap?s.exported.getImageData(p):p,{width:ze,height:kt}=X;ze!==void 0&&kt!==void 0?ze===S.data.width&&kt===S.data.height?(S.data.replace(X.data,!(p instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&p instanceof s.window.ImageBitmap)),this.style.updateImage(L,S)):this.fire(new s.ErrorEvent(new Error(`The width and height of the updated image (${ze}, ${kt})
                must be that same as the previous version of the image
                (${S.data.width}, ${S.data.height})`))):this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(L){return L?!!this.style.getImage(L):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(L){this.style.removeImage(L)}loadImage(L,p){s.getImage(this._requestManager.transformRequest(L,s.ResourceType.Image),(S,X)=>{p(S,X instanceof s.window.HTMLImageElement?s.exported.getImageData(X):X)})}listImages(){return this.style.listImages()}addLayer(L,p){return this._lazyInitEmptyStyle(),this.style.addLayer(L,p),this._update(!0)}moveLayer(L,p){return this.style.moveLayer(L,p),this._update(!0)}removeLayer(L){return this.style.removeLayer(L),this._update(!0)}getLayer(L){return this.style.getLayer(L)}setLayerZoomRange(L,p,S){return this.style.setLayerZoomRange(L,p,S),this._update(!0)}setFilter(L,p,S={}){return this.style.setFilter(L,p,S),this._update(!0)}getFilter(L){return this.style.getFilter(L)}setPaintProperty(L,p,S,X={}){return this.style.setPaintProperty(L,p,S,X),this._update(!0)}getPaintProperty(L,p){return this.style.getPaintProperty(L,p)}setLayoutProperty(L,p,S,X={}){return this.style.setLayoutProperty(L,p,S,X),this._update(!0)}getLayoutProperty(L,p){return this.style.getLayoutProperty(L,p)}setLight(L,p={}){return this._lazyInitEmptyStyle(),this.style.setLight(L,p),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(L){return this._lazyInitEmptyStyle(),!L&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(L),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(L){return this._lazyInitEmptyStyle(),this.style.setFog(L),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(L){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.LngLat.convert(L),this.transform):0}setFeatureState(L,p){return this.style.setFeatureState(L,p),this._update()}removeFeatureState(L,p){return this.style.removeFeatureState(L,p),this._update()}getFeatureState(L){return this.style.getFeatureState(L)}_updateContainerDimensions(){if(!this._container)return;const L=this._container.getBoundingClientRect().width||400,p=this._container.getBoundingClientRect().height||300;let S,X,ze,kt=this._container;for(;kt&&(!X||!ze);){const vi=s.window.getComputedStyle(kt).transform;vi&&vi!=="none"&&(S=vi.match(/matrix.*\((.+)\)/)[1].split(", "),S[0]&&S[0]!=="0"&&S[0]!=="1"&&(X=S[0]),S[3]&&S[3]!=="0"&&S[3]!=="1"&&(ze=S[3])),kt=kt.parentElement}this._containerWidth=X?Math.abs(L/X):L,this._containerHeight=ze?Math.abs(p/ze):p}_detectMissingCSS(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const L=this._container;L.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ee("div","mapboxgl-canary",L)).style.visibility="hidden",this._detectMissingCSS();const p=this._canvasContainer=Ee("div","mapboxgl-canvas-container",L);this._interactive&&p.classList.add("mapboxgl-interactive"),this._canvas=Ee("canvas","mapboxgl-canvas",p),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const S=this._controlContainer=Ee("div","mapboxgl-control-container",L),X=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(ze=>{X[ze]=Ee("div",`mapboxgl-ctrl-${ze}`,S)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(L,p){const S=s.exported.devicePixelRatio||1;this._canvas.width=S*Math.ceil(L),this._canvas.height=S*Math.ceil(p),this._canvas.style.width=`${L}px`,this._canvas.style.height=`${p}px`}_addMarker(L){this._markers.push(L)}_removeMarker(L){const p=this._markers.indexOf(L);p!==-1&&this._markers.splice(p,1)}_addPopup(L){this._popups.push(L)}_removePopup(L){const p=this._popups.indexOf(L);p!==-1&&this._popups.splice(p,1)}_setupPainter(){const L=s.extend({},y.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),p=this._useWebGL2&&this._canvas.getContext("webgl2",L),S=p||this._canvas.getContext("webgl",L)||this._canvas.getContext("experimental-webgl",L);S?(this._useWebGL2&&!p&&s.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),s.storeAuthState(S,!0),this.painter=new ey(S,this.transform,!!p),this.on("data",X=>{X.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.exported$1.testSupport(S)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(L){L.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:L}))}_contextRestored(L){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:L}))}_onMapScroll(L){if(L.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(L){return this.style?(this._styleDirty=this._styleDirty||L,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(L){return this._update(),this._renderTaskQueue.add(L)}_cancelRenderFrame(L){this._renderTaskQueue.remove(L)}_requestDomTask(L){!this.loaded()||this.loaded()&&!this.isMoving()?L():this._domRenderTaskQueue.add(L)}_render(L){let p;const S=this.painter.context.extTimerQuery,X=s.exported.now();if(this.listens("gpu-timing-frame")&&(p=S.createQueryEXT(),S.beginQueryEXT(S.TIME_ELAPSED_EXT,p)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],s.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],s.window.performance.now())),this._renderTaskQueue.run(L),this._domRenderTaskQueue.run(L),this._removed)return;this._updateProjectionTransition();const ze=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const or=this.transform.zoom,Gn=this.transform.pitch,ia=s.exported.now(),oa=new s.EvaluationParameters(or,{now:ia,fadeDuration:ze,pitch:Gn,transition:this.style.getTransition()});this.style.update(oa)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let kt=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),kt=this._updateAverageElevation(X),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):kt=this._updateAverageElevation(X),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,ze,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:ze,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),p){const or=s.exported.now()-X;S.endQueryEXT(S.TIME_ELAPSED_EXT,p),setTimeout(()=>{const Gn=S.getQueryObjectEXT(p,S.QUERY_RESULT_EXT)/1e6;S.deleteQueryEXT(p),this.fire(new s.Event("gpu-timing-frame",{cpuTime:or,gpuTime:Gn})),s.window.performance.mark("frame-gpu",{startTime:X,detail:{gpuTime:Gn}})},50)}if(this.listens("gpu-timing-layer")){const or=this.painter.collectGpuTimers();setTimeout(()=>{const Gn=this.painter.queryGpuTimers(or);this.fire(new s.Event("gpu-timing-layer",{layerTimes:Gn}))},50)}if(this.listens("gpu-timing-deferred-render")){const or=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const Gn=this.painter.queryGpuTimeDeferredRender(or);this.fire(new s.Event("gpu-timing-deferred-render",{gpuTime:Gn}))},50)}const vi=this._sourcesDirty||this._styleDirty||this._placementDirty||kt;if(vi||this._repaint)this.triggerRepaint();else{const or=!this.isMoving()&&this.loaded();if(or&&(kt=this._updateAverageElevation(X,!0)),kt)this.triggerRepaint();else if(this._triggerFrame(!1),or&&(this.fire(new s.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const Gn=this._calculateSpeedIndex();this.fire(new s.Event("speedindexcompleted",{speedIndex:Gn})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||vi||(this._fullyLoaded=!0,s.LivePerformanceUtils.mark(s.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&s.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(L){for(const p of this._markers)L&&!this.getRenderWorldCopies()&&(p._lngLat=p._lngLat.wrap()),p._update();for(const p of this._popups)!L||this.getRenderWorldCopies()||p._trackPointer||(p._lngLat=p._lngLat.wrap()),p._update()}_updateAverageElevation(L,p=!1){const S=X=>(this.transform.averageElevation=X,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&S(0);if((p||L-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(L)){const X=this.transform.averageElevation;let ze=this.transform.sampleAverageElevation(),kt=!1;this.transform.elevation&&(kt=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(ze)?ze=0:this._averageElevationLastSampledAt=L;const vi=Math.abs(X-ze);if(vi>1){if(this._isInitialLoad||kt)return this._averageElevation.jumpTo(ze),S(ze);this._averageElevation.easeTo(ze,L,300)}else if(vi>1e-4)return this._averageElevation.jumpTo(ze),S(ze)}return!!this._averageElevation.isEasing(L)&&S(this._averageElevation.getValue(L))}_authenticate(){s.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,L=>{if(L&&(L.message===s.AUTH_ERR_MSG||L.status===401)){const p=this.painter.context.gl;s.storeAuthState(p,!1),this._logoControl instanceof fl&&this._logoControl._updateLogo(),p&&p.clear(p.DEPTH_BUFFER_BIT|p.COLOR_BUFFER_BIT|p.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const L=this._isDragging();this.painter.updateTerrain(this.style,L)}_calculateSpeedIndex(){const L=this.painter.canvasCopy(),p=this.painter.getCanvasCopiesAndTimestamps();p.timeStamps.push(performance.now());const S=this.painter.context.gl,X=S.createFramebuffer();function ze(kt){S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_2D,kt,0);const vi=new Uint8Array(S.drawingBufferWidth*S.drawingBufferHeight*4);return S.readPixels(0,0,S.drawingBufferWidth,S.drawingBufferHeight,S.RGBA,S.UNSIGNED_BYTE,vi),vi}return S.bindFramebuffer(S.FRAMEBUFFER,X),this._canvasPixelComparison(ze(L),p.canvasCopies.map(ze),p.timeStamps)}_canvasPixelComparison(L,p,S){let X=S[1]-S[0];const ze=L.length/4;for(let kt=0;kt<p.length;kt++){const vi=p[kt];let or=0;for(let Gn=0;Gn<vi.length;Gn+=4)vi[Gn]===L[Gn]&&vi[Gn+1]===L[Gn+1]&&vi[Gn+2]===L[Gn+2]&&vi[Gn+3]===L[Gn+3]&&(or+=1);X+=(S[kt+2]-S[kt+1])*(1-or/ze)}return X}remove(){this._hash&&this._hash.remove();for(const p of this._controls)p.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1),s.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const L=this.painter.context.gl.getExtension("WEBGL_lose_context");L&&L.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),s.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new s.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(L){this._renderNextFrame=this._renderNextFrame||L,this.style&&!this._frame&&(this._frame=s.exported.frame(p=>{const S=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,S&&this._render(p)}))}_preloadTiles(L){const p=this.style?Object.values(this.style._sourceCaches):[];return s.asyncAll(p,(S,X)=>S._preloadTiles(L,X),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(L){this._trackResize&&this.resize({originalEvent:L})._update()}_onVisibilityChange(){s.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(L){this._showTileBoundaries!==L&&(this._showTileBoundaries=L,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(L){this._showTerrainWireframe!==L&&(this._showTerrainWireframe=L,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(L){this._speedIndexTiming!==L&&(this._speedIndexTiming=L,this._update())}get showPadding(){return!!this._showPadding}set showPadding(L){this._showPadding!==L&&(this._showPadding=L,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(L){this._showCollisionBoxes!==L&&(this._showCollisionBoxes=L,L?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(L){this._showOverdrawInspector!==L&&(this._showOverdrawInspector=L,this._update())}get repaint(){return!!this._repaint}set repaint(L){this._repaint!==L&&(this._repaint=L,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(L){this._vertices=L,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(L){this._showTileAABBs!==L&&(this._showTileAABBs=L,L&&this._update())}_setCacheLimits(L,p){s.setCacheLimits(L,p)}get version(){return s.version}},NavigationControl:class{constructor(L){this.options=s.extend({},md,L),this._container=Ee("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",p=>p.preventDefault()),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",p=>{this._map&&this._map.zoomIn({},{originalEvent:p})}),Ee("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",p=>{this._map&&this._map.zoomOut({},{originalEvent:p})}),Ee("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",p=>{const S=this._map;S&&(this.options.visualizePitch?S.resetNorthPitch({},{originalEvent:p}):S.resetNorth({},{originalEvent:p}))}),this._compassIcon=Ee("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const L=this._map;if(!L)return;const p=L.getZoom(),S=p===L.getMaxZoom(),X=p===L.getMinZoom();this._zoomInButton.disabled=S,this._zoomOutButton.disabled=X,this._zoomInButton.setAttribute("aria-disabled",S.toString()),this._zoomOutButton.setAttribute("aria-disabled",X.toString())}_rotateCompassArrow(){const L=this._map;if(!L)return;const p=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(L.transform.pitch*(Math.PI/180)),.5)}) rotateX(${L.transform.pitch}deg) rotateZ(${L.transform.angle*(180/Math.PI)}deg)`:`rotate(${L.transform.angle*(180/Math.PI)}deg)`;L._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=p)})}onAdd(L){return this._map=L,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),L.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&L.on("pitch",this._rotateCompassArrow),L.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Nd(L,this._compass,this.options.visualizePitch)),this._container}onRemove(){const L=this._map;L&&(this._container.remove(),this.options.showZoom&&L.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&L.off("pitch",this._rotateCompassArrow),L.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(L,p){const S=Ee("button",L,this._container);return S.type="button",S.addEventListener("click",p),S}_setButtonTitle(L,p){if(!this._map)return;const S=this._map._getUIString(`NavigationControl.${p}`);L.setAttribute("aria-label",S),L.firstElementChild&&L.firstElementChild.setAttribute("title",S)}},GeolocateControl:class extends s.Evented{constructor(L){super(),this.options=s.extend({geolocation:s.window.navigator.geolocation},Hd,L),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=xy(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(L){return this._map=L,this._container=Ee("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(L){const p=(S=!!this.options.geolocation)=>{this._supportsGeolocation=S,L(S)};this._supportsGeolocation!==void 0?L(this._supportsGeolocation):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then(S=>p(S.state!=="denied")).catch(()=>p()):p()}_isOutOfMapMaxBounds(L){const p=this._map.getMaxBounds(),S=L.coords;return!!p&&(S.longitude<p.getWest()||S.longitude>p.getEast()||S.latitude<p.getSouth()||S.latitude>p.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(L){if(this._map){if(this._isOutOfMapMaxBounds(L))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",L)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=L,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(L),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(L),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",L)),this._finish()}}_updateCamera(L){const p=new s.LngLat(L.coords.longitude,L.coords.latitude),S=L.coords.accuracy,X=this._map.getBearing(),ze=s.extend({bearing:X},this.options.fitBoundsOptions);this._map.fitBounds(p.toBounds(S),ze,{geolocateSource:!0})}_updateMarker(L){if(L){const p=new s.LngLat(L.coords.longitude,L.coords.latitude);this._accuracyCircleMarker.setLngLat(p).addTo(this._map),this._userLocationDotMarker.setLngLat(p).addTo(this._map),this._accuracy=L.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const L=this._map.transform,p=s.mercatorZfromAltitude(1,L._center.lat)*L.worldSize,S=Math.ceil(2*this._accuracy*p);this._circleElement.style.width=`${S}px`,this._circleElement.style.height=`${S}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(L){if(this._map){if(this.options.trackUserLocation)if(L.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const p=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",p),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",p),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(L.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",L)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(L){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",p=>p.preventDefault()),this._geolocateButton=Ee("button","mapboxgl-ctrl-geolocate",this._container),Ee("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",L===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const p=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",p),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",p)}else{const p=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",p),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",p)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ee("div","mapboxgl-user-location"),this._dotElement.appendChild(Ee("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ee("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new hh({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ee("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new hh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",p=>{p.geolocateSource||this._watchState!=="ACTIVE_LOCK"||p.originalEvent&&p.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.Event("trackuserlocationend")))})}}_onDeviceOrientation(L){this._userLocationDotMarker&&(L.webkitCompassHeading?this._heading=L.webkitCompassHeading:L.absolute===!0&&(this._heading=-1*L.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let L;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(L={maximumAge:6e5,timeout:0},this._noTimeout=!0):(L=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,L),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const L=()=>{s.window.addEventListener("ondeviceorientationabsolute"in s.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};s.window.DeviceMotionEvent!==void 0&&typeof s.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(p=>{p==="granted"&&L()}).catch(console.error):L()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),s.window.removeEventListener("deviceorientation",this._onDeviceOrientation),s.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:vs,ScaleControl:class{constructor(L){this.options=s.extend({},tp,L),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const L=this.options.maxWidth||100,p=this._map,S=p._containerHeight/2,X=p._containerWidth/2-L/2,ze=p.unproject([X,S]),kt=p.unproject([X+L,S]),vi=ze.distanceTo(kt);if(this.options.unit==="imperial"){const or=3.2808*vi;or>5280?this._setScale(L,or/5280,"mile"):this._setScale(L,or,"foot")}else this.options.unit==="nautical"?this._setScale(L,vi/1852,"nautical-mile"):vi>=1e3?this._setScale(L,vi/1e3,"kilometer"):this._setScale(L,vi,"meter")}_setScale(L,p,S){this._map._requestDomTask(()=>{const X=function(kt){const vi=Math.pow(10,`${Math.floor(kt)}`.length-1);let or=kt/vi;return or=or>=10?10:or>=5?5:or>=3?3:or>=2?2:or>=1?1:function(Gn){const ia=Math.pow(10,Math.ceil(-Math.log(Gn)/Math.LN10));return Math.round(Gn*ia)/ia}(or),vi*or}(p),ze=X/p;this._container.innerHTML=this._isNumberFormatSupported&&S!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:S}).format(X):`${X}&nbsp;${Vd[S]}`,this._container.style.width=L*ze+"px"})}onAdd(L){return this._map=L,this._language=L.getLanguage(),this._container=Ee("div","mapboxgl-ctrl mapboxgl-ctrl-scale",L.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(L){this._language=L,this._update()}setUnit(L){this.options.unit=L,this._update()}},FullscreenControl:class{constructor(L){this._fullscreen=!1,L&&L.container&&(L.container instanceof s.window.HTMLElement?this._container=L.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in s.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(L){return this._map=L,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ee("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!s.window.document.fullscreenEnabled&&!s.window.document.webkitFullscreenEnabled)}_setupUI(){const L=this._fullscreenButton=Ee("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ee("span","mapboxgl-ctrl-icon",L).setAttribute("aria-hidden","true"),L.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const L=this._getTitle();this._fullscreenButton.setAttribute("aria-label",L),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",L)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(s.window.document.fullscreenElement||s.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.Evented{constructor(L){super(),this.options=s.extend(Object.create(Rh),L),s.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(L&&L.className?L.className.trim().split(/\s+/):[])}addTo(L){return this._map&&this.remove(),this._map=L,this.options.closeOnClick&&L.on("preclick",this._onClose),this.options.closeOnMove&&L.on("move",this._onClose),L.on("remove",this.remove),this._update(),L._addPopup(this),this._focusFirstElement(),this._trackPointer?(L.on("mousemove",this._onMouseEvent),L.on("mouseup",this._onMouseEvent),L._canvasContainer.classList.add("mapboxgl-track-pointer")):L.on("move",this._update),this.fire(new s.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const L=this._map;return L&&(L.off("move",this._update),L.off("move",this._onClose),L.off("preclick",this._onClose),L.off("click",this._onClose),L.off("remove",this.remove),L.off("mousemove",this._onMouseEvent),L.off("mouseup",this._onMouseEvent),L.off("drag",this._onMouseEvent),L._canvasContainer&&L._canvasContainer.classList.remove("mapboxgl-track-pointer"),L._removePopup(this),this._map=void 0),this.fire(new s.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(L){this._lngLat=s.LngLat.convert(L),this._pos=null,this._trackPointer=!1,this._update();const p=this._map;return p&&(p.on("move",this._update),p.off("mousemove",this._onMouseEvent),p._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const L=this._map;return L&&(L.off("move",this._update),L.on("mousemove",this._onMouseEvent),L.on("drag",this._onMouseEvent),L._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(L){return this.setDOMContent(s.window.document.createTextNode(L))}setHTML(L){const p=s.window.document.createDocumentFragment(),S=s.window.document.createElement("body");let X;for(S.innerHTML=L;X=S.firstChild,X;)p.appendChild(X);return this.setDOMContent(p)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(L){return this.options.maxWidth=L,this._update(),this}setDOMContent(L){let p=this._content;if(p)for(;p.hasChildNodes();)p.firstChild&&p.removeChild(p.firstChild);else p=this._content=Ee("div","mapboxgl-popup-content",this._container||void 0);if(p.appendChild(L),this.options.closeButton){const S=this._closeButton=Ee("button","mapboxgl-popup-close-button",p);S.type="button",S.setAttribute("aria-label","Close popup"),S.setAttribute("aria-hidden","true"),S.innerHTML="&#215;",S.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(L){return this._classList.add(L),this._updateClassList(),this}removeClassName(L){return this._classList.delete(L),this._updateClassList(),this}setOffset(L){return this.options.offset=L,this._update(),this}toggleClassName(L){let p;return this._classList.delete(L)?p=!1:(this._classList.add(L),p=!0),this._updateClassList(),p}_onMouseEvent(L){this._update(L.point)}_getAnchor(L){if(this.options.anchor)return this.options.anchor;const p=this._map,S=this._container,X=this._pos;if(!p||!S||!X)return"bottom";const ze=S.offsetWidth,kt=S.offsetHeight,vi=X.x<ze/2,or=X.x>p.transform.width-ze/2;if(X.y+L<kt)return vi?"top-left":or?"top-right":"top";if(X.y>p.transform.height-kt){if(vi)return"bottom-left";if(or)return"bottom-right"}return vi?"left":or?"right":"bottom"}_updateClassList(){const L=this._container;if(!L)return;const p=[...this._classList];p.push("mapboxgl-popup"),this._anchor&&p.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&p.push("mapboxgl-popup-track-pointer"),L.className=p.join(" ")}_update(L){const p=this._map,S=this._content;if(!p||!this._lngLat&&!this._trackPointer||!S)return;let X=this._container;if(X||(X=this._container=Ee("div","mapboxgl-popup",p.getContainer()),this._tip=Ee("div","mapboxgl-popup-tip",X),X.appendChild(S)),this.options.maxWidth&&X.style.maxWidth!==this.options.maxWidth&&(X.style.maxWidth=this.options.maxWidth),p.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=dh(this._lngLat,this._pos,p.transform)),!this._trackPointer||L){const ze=this._pos=this._trackPointer&&L?L:p.project(this._lngLat),kt=Kh(this.options.offset),vi=this._anchor=this._getAnchor(kt.y),or=Kh(this.options.offset,vi),Gn=ze.add(or).round();p._requestDomTask(()=>{this._container&&vi&&(this._container.style.transform=`${Ah[vi]} translate(${Gn.x}px,${Gn.y}px)`)})}if(!this._marker&&p._showingGlobe()){const ze=s.isLngLatBehindGlobe(p.transform,this._lngLat)?0:1;this._setOpacity(ze)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const L=this._container.querySelector(zh);L&&L.focus()}_onClose(){this.remove()}_setOpacity(L){this._container&&(this._container.style.opacity=`${L}`),this._content&&(this._content.style.pointerEvents=L?"auto":"none")}},Marker:hh,Style:N_,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.Point,MercatorCoordinate:s.MercatorCoordinate,FreeCameraOptions:Q0,Evented:s.Evented,config:s.config,prewarm:function(){Vf().acquire(wp)},clearPrewarmedResources:function(){const L=Wp;L&&(L.isPreloaded()&&L.numActive()===1?(L.release(wp),Wp=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(L){s.config.ACCESS_TOKEN=L},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(L){s.config.API_URL=L},get workerCount(){return pp.workerCount},set workerCount(L){pp.workerCount=L},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(L){s.config.MAX_PARALLEL_IMAGE_REQUESTS=L},clearStorage(L){s.clearTileCache(L)},workerUrl:"",workerClass:null,setNow:s.exported.setNow,restoreNow:s.exported.restoreNow};return gp});var l=o;return l})})(mapboxGl$1);var mapboxGlExports=mapboxGl$1.exports;const mapboxgl=getDefaultExportFromCjs(mapboxGlExports),mapboxGl="";var immutable=extend$5,hasOwnProperty=Object.prototype.hasOwnProperty;function extend$5(){for(var r={},e=0;e<arguments.length;e++){var t=arguments[e];for(var n in t)hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r}var fuzzy$1={exports:{}};(function(r,e){(function(){var t={};r.exports=t,t.simpleFilter=function(n,o){return o.filter(function(a){return t.test(n,a)})},t.test=function(n,o){return t.match(n,o)!==null},t.match=function(n,o,a){a=a||{};var l=0,s=[],m=o.length,y=0,D=0,W=a.pre||"",Ee=a.post||"",dt=a.caseSensitive&&o||o.toLowerCase(),Ht;n=a.caseSensitive&&n||n.toLowerCase();for(var ir=0;ir<m;ir++)Ht=o[ir],dt[ir]===n[l]?(Ht=W+Ht+Ee,l+=1,D+=1+D):D=0,y+=D,s[s.length]=Ht;return l===n.length?(y=dt===n?1/0:y,{rendered:s.join(""),score:y}):null},t.filter=function(n,o,a){return!o||o.length===0?[]:typeof n!="string"?o:(a=a||{},o.reduce(function(l,s,m,y){var D=s;a.extract&&(D=a.extract(s));var W=t.match(n,D,a);return W!=null&&(l[l.length]={string:W.rendered,score:W.score,index:m,original:s}),l},[]).sort(function(l,s){var m=s.score-l.score;return m||l.index-s.index}))}})()})(fuzzy$1);var fuzzyExports=fuzzy$1.exports,List$1=function(r){return this.component=r,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,r.el.parentNode.insertBefore(this.wrapper,r.el.nextSibling),this};List$1.prototype.show=function(){this.element.style.display="block"};List$1.prototype.hide=function(){this.element.style.display="none"};List$1.prototype.add=function(r){this.items.push(r)};List$1.prototype.clear=function(){this.items=[],this.active=0};List$1.prototype.isEmpty=function(){return!this.items.length};List$1.prototype.isVisible=function(){return this.element.style.display==="block"};List$1.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var r=0;r<this.items.length;r++)this.drawItem(this.items[r],this.active===r);this.show()};List$1.prototype.drawItem=function(r,e){var t=document.createElement("li"),n=document.createElement("a");e&&(t.className+=" active"),n.innerHTML=r.string,t.appendChild(n),this.element.appendChild(t),t.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),t.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,r)}).bind(this))};List$1.prototype.handleMouseUp=function(r){this.selectingListItem=!1,this.component.value(r.original),this.clear(),this.draw()};List$1.prototype.move=function(r){this.active=r,this.draw()};List$1.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};List$1.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};List$1.prototype.drawError=function(r){var e=document.createElement("li");e.innerHTML=r,this.element.appendChild(e),this.show()};var list=List$1,extend$4=immutable,fuzzy=fuzzyExports,List=list,Suggestions$1=function(r,e,t){return t=t||{},this.options=extend$4({minLength:2,limit:5,filter:!0,hideOnBlur:!0},t),this.el=r,this.data=e||[],this.list=new List(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(n){this.handleKeyUp(n.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(n){this.handleKeyDown(n)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(n){this.handlePaste(n)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Suggestions$1.prototype.handleKeyUp=function(r){r===40||r===38||r===27||r===13||r===9||this.handleInputChange(this.el.value)};Suggestions$1.prototype.handleKeyDown=function(r){switch(r.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&r.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Suggestions$1.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Suggestions$1.prototype.handlePaste=function(r){if(r.clipboardData)this.handleInputChange(r.clipboardData.getData("Text"));else{var e=this;setTimeout(function(){e.handleInputChange(r.target.value)},100)}};Suggestions$1.prototype.handleInputChange=function(r){if(this.query=this.normalize(r),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(e){for(var t=0;t<e.length&&(this.list.add(e[t]),t!==this.options.limit-1);t++);this.list.draw()}).bind(this))};Suggestions$1.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Suggestions$1.prototype.update=function(r){this.data=r,this.handleKeyUp()};Suggestions$1.prototype.clear=function(){this.data=[],this.list.clear()};Suggestions$1.prototype.normalize=function(r){return r=r.toLowerCase(),r};Suggestions$1.prototype.match=function(r,e){return r.indexOf(e)>-1};Suggestions$1.prototype.value=function(r){if(this.selected=r,this.el.value=this.getItemValue(r),document.createEvent){var e=document.createEvent("HTMLEvents");e.initEvent("change",!0,!1),this.el.dispatchEvent(e)}else this.el.fireEvent("onchange")};Suggestions$1.prototype.getCandidates=function(r){var e={pre:"<strong>",post:"</strong>",extract:(function(n){return this.getItemValue(n)}).bind(this)},t;this.options.filter?(t=fuzzy.filter(this.query,this.data,e),t=t.map((function(n){return{original:n.original,string:this.render(n.original,n.string)}}).bind(this))):t=this.data.map((function(n){var o=this.render(n);return{original:n,string:o}}).bind(this)),r(t)};Suggestions$1.prototype.getItemValue=function(r){return r};Suggestions$1.prototype.render=function(r,e){if(e)return e;for(var t=r.original?this.getItemValue(r.original):this.getItemValue(r),n=this.normalize(t),o=n.lastIndexOf(this.query);o>-1;){var a=o+this.query.length;t=t.slice(0,o)+"<strong>"+t.slice(o,a)+"</strong>"+t.slice(a),o=n.slice(0,o).lastIndexOf(this.query)}return t};Suggestions$1.prototype.renderError=function(r){this.list.drawError(r)};var suggestions$1=Suggestions$1,Suggestions=suggestions$1,suggestions=Suggestions;typeof window<"u"&&(window.Suggestions=Suggestions);var FUNC_ERROR_TEXT="Expected a function",NAN=0/0,symbolTag="[object Symbol]",reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt,freeGlobal=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,freeSelf=typeof self=="object"&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),objectProto=Object.prototype,objectToString$1=objectProto.toString,nativeMax=Math.max,nativeMin=Math.min,now=function(){return root.Date.now()};function debounce$2(r,e,t){var n,o,a,l,s,m,y=0,D=!1,W=!1,Ee=!0;if(typeof r!="function")throw new TypeError(FUNC_ERROR_TEXT);e=toNumber$1(e)||0,isObject$1(t)&&(D=!!t.leading,W="maxWait"in t,a=W?nativeMax(toNumber$1(t.maxWait)||0,e):a,Ee="trailing"in t?!!t.trailing:Ee);function dt(gl){var ml=n,sl=o;return n=o=void 0,y=gl,l=r.apply(sl,ml),l}function Ht(gl){return y=gl,s=setTimeout(Bn,e),D?dt(gl):l}function ir(gl){var ml=gl-m,sl=gl-y,ll=e-ml;return W?nativeMin(ll,a-sl):ll}function Hr(gl){var ml=gl-m,sl=gl-y;return m===void 0||ml>=e||ml<0||W&&sl>=a}function Bn(){var gl=now();if(Hr(gl))return Vn(gl);s=setTimeout(Bn,ir(gl))}function Vn(gl){return s=void 0,Ee&&n?dt(gl):(n=o=void 0,l)}function Wr(){s!==void 0&&clearTimeout(s),y=0,n=m=o=s=void 0}function ps(){return s===void 0?l:Vn(now())}function il(){var gl=now(),ml=Hr(gl);if(n=arguments,o=this,m=gl,ml){if(s===void 0)return Ht(m);if(W)return s=setTimeout(Bn,e),dt(m)}return s===void 0&&(s=setTimeout(Bn,e)),l}return il.cancel=Wr,il.flush=ps,il}function isObject$1(r){var e=typeof r;return!!r&&(e=="object"||e=="function")}function isObjectLike(r){return!!r&&typeof r=="object"}function isSymbol(r){return typeof r=="symbol"||isObjectLike(r)&&objectToString$1.call(r)==symbolTag}function toNumber$1(r){if(typeof r=="number")return r;if(isSymbol(r))return NAN;if(isObject$1(r)){var e=typeof r.valueOf=="function"?r.valueOf():r;r=isObject$1(e)?e+"":e}if(typeof r!="string")return r===0?r:+r;r=r.replace(reTrim,"");var t=reIsBinary.test(r);return t||reIsOctal.test(r)?freeParseInt(r.slice(2),t?2:8):reIsBadHex.test(r)?NAN:+r}var lodash_debounce=debounce$2,events$1={exports:{}},R=typeof Reflect=="object"?Reflect:null,ReflectApply=R&&typeof R.apply=="function"?R.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},ReflectOwnKeys;R&&typeof R.ownKeys=="function"?ReflectOwnKeys=R.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:ReflectOwnKeys=function(e){return Object.getOwnPropertyNames(e)};function ProcessEmitWarning(r){console&&console.warn&&console.warn(r)}var NumberIsNaN=Number.isNaN||function(e){return e!==e};function EventEmitter$2(){EventEmitter$2.init.call(this)}events$1.exports=EventEmitter$2;events$1.exports.once=once;EventEmitter$2.EventEmitter=EventEmitter$2;EventEmitter$2.prototype._events=void 0;EventEmitter$2.prototype._eventsCount=0;EventEmitter$2.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(EventEmitter$2,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(r){if(typeof r!="number"||r<0||NumberIsNaN(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");defaultMaxListeners=r}});EventEmitter$2.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter$2.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||NumberIsNaN(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function _getMaxListeners(r){return r._maxListeners===void 0?EventEmitter$2.defaultMaxListeners:r._maxListeners}EventEmitter$2.prototype.getMaxListeners=function(){return _getMaxListeners(this)};EventEmitter$2.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var o=e==="error",a=this._events;if(a!==void 0)o=o&&a.error===void 0;else if(!o)return!1;if(o){var l;if(t.length>0&&(l=t[0]),l instanceof Error)throw l;var s=new Error("Unhandled error."+(l?" ("+l.message+")":""));throw s.context=l,s}var m=a[e];if(m===void 0)return!1;if(typeof m=="function")ReflectApply(m,this,t);else for(var y=m.length,D=arrayClone(m,y),n=0;n<y;++n)ReflectApply(D[n],this,t);return!0};function _addListener(r,e,t,n){var o,a,l;if(checkListener(t),a=r._events,a===void 0?(a=r._events=Object.create(null),r._eventsCount=0):(a.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),a=r._events),l=a[e]),l===void 0)l=a[e]=t,++r._eventsCount;else if(typeof l=="function"?l=a[e]=n?[t,l]:[l,t]:n?l.unshift(t):l.push(t),o=_getMaxListeners(r),o>0&&l.length>o&&!l.warned){l.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=r,s.type=e,s.count=l.length,ProcessEmitWarning(s)}return r}EventEmitter$2.prototype.addListener=function(e,t){return _addListener(this,e,t,!1)};EventEmitter$2.prototype.on=EventEmitter$2.prototype.addListener;EventEmitter$2.prototype.prependListener=function(e,t){return _addListener(this,e,t,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(r,e,t){var n={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},o=onceWrapper.bind(n);return o.listener=t,n.wrapFn=o,o}EventEmitter$2.prototype.once=function(e,t){return checkListener(t),this.on(e,_onceWrap(this,e,t)),this};EventEmitter$2.prototype.prependOnceListener=function(e,t){return checkListener(t),this.prependListener(e,_onceWrap(this,e,t)),this};EventEmitter$2.prototype.removeListener=function(e,t){var n,o,a,l,s;if(checkListener(t),o=this._events,o===void 0)return this;if(n=o[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete o[e],o.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(a=-1,l=n.length-1;l>=0;l--)if(n[l]===t||n[l].listener===t){s=n[l].listener,a=l;break}if(a<0)return this;a===0?n.shift():spliceOne(n,a),n.length===1&&(o[e]=n[0]),o.removeListener!==void 0&&this.emit("removeListener",e,s||t)}return this};EventEmitter$2.prototype.off=EventEmitter$2.prototype.removeListener;EventEmitter$2.prototype.removeAllListeners=function(e){var t,n,o;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var a=Object.keys(n),l;for(o=0;o<a.length;++o)l=a[o],l!=="removeListener"&&this.removeAllListeners(l);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(o=t.length-1;o>=0;o--)this.removeListener(e,t[o]);return this};function _listeners(r,e,t){var n=r._events;if(n===void 0)return[];var o=n[e];return o===void 0?[]:typeof o=="function"?t?[o.listener||o]:[o]:t?unwrapListeners(o):arrayClone(o,o.length)}EventEmitter$2.prototype.listeners=function(e){return _listeners(this,e,!0)};EventEmitter$2.prototype.rawListeners=function(e){return _listeners(this,e,!1)};EventEmitter$2.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):listenerCount.call(r,e)};EventEmitter$2.prototype.listenerCount=listenerCount;function listenerCount(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}EventEmitter$2.prototype.eventNames=function(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(r,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=r[n];return t}function spliceOne(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function unwrapListeners(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function once(r,e){return new Promise(function(t,n){function o(l){r.removeListener(e,a),n(l)}function a(){typeof r.removeListener=="function"&&r.removeListener("error",o),t([].slice.call(arguments))}eventTargetAgnosticAddListener(r,e,a,{once:!0}),e!=="error"&&addErrorHandlerIfEventEmitter(r,o,{once:!0})})}function addErrorHandlerIfEventEmitter(r,e,t){typeof r.on=="function"&&eventTargetAgnosticAddListener(r,"error",e,t)}function eventTargetAgnosticAddListener(r,e,t,n){if(typeof r.on=="function")n.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function o(a){n.once&&r.removeEventListener(e,o),t(a)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var eventsExports=events$1.exports;const EventEmitter$3=getDefaultExportFromCjs(eventsExports);var exceptions$1={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function parseParam(r){var e=r.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return e?{key:e[1],value:e[2]}:null}function parseLink(r){var e=r.match(/<?([^>]*)>(.*)/);if(!e)return null;var t=e[1],n=e[2].split(";"),o=null,a=n.reduce(function(l,s){var m=parseParam(s);return m?m.key==="rel"?(o||(o=m.value),l):(l[m.key]=m.value,l):l},{});return o?{url:t,rel:o,params:a}:null}function parseLinkHeader$1(r){return r?r.split(/,\s*</).reduce(function(e,t){var n=parseLink(t);if(!n)return e;var o=n.rel.split(/\s+/);return o.forEach(function(a){e[a]||(e[a]={url:n.url,params:n.params})}),e},{}):{}}var parseLinkHeader_1=parseLinkHeader$1,parseLinkHeader=parseLinkHeader_1;function MapiResponse$1(r,e){this.request=r,this.headers=e.headers,this.rawBody=e.body,this.statusCode=e.statusCode;try{this.body=JSON.parse(e.body||"{}")}catch{this.body=e.body}this.links=parseLinkHeader(this.headers.link)}MapiResponse$1.prototype.hasNextPage=function(){return!!this.links.next};MapiResponse$1.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var mapiResponse=MapiResponse$1,constants$9={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},constants$8=constants$9;function MapiError$1(r){var e=r.type||constants$8.ERROR_HTTP,t;if(r.body)try{t=JSON.parse(r.body)}catch{t=r.body}else t=null;var n=r.message||null;n||(typeof t=="string"?n=t:t&&typeof t.message=="string"?n=t.message:e===constants$8.ERROR_REQUEST_ABORTED&&(n="Request aborted")),this.message=n,this.type=e,this.statusCode=r.statusCode||null,this.request=r.request,this.body=t}var mapiError=MapiError$1;function parseSingleHeader(r){var e=r.indexOf(":"),t=r.substring(0,e).trim().toLowerCase(),n=r.substring(e+1).trim();return{name:t,value:n}}function parseHeaders$1(r){var e={};return r&&r.trim().split(/[\r|\n]+/).forEach(function(t){var n=parseSingleHeader(t);e[n.name]=n.value}),e}var parseHeaders_1=parseHeaders$1,MapiResponse=mapiResponse,MapiError=mapiError,constants$7=constants$9,parseHeaders=parseHeaders_1,requestsUnderway={};function browserAbort(r){var e=requestsUnderway[r.id];e&&(e.abort(),delete requestsUnderway[r.id])}function createResponse(r,e){return new MapiResponse(r,{body:e.response,headers:parseHeaders(e.getAllResponseHeaders()),statusCode:e.status})}function normalizeBrowserProgressEvent(r){var e=r.total,t=r.loaded,n=100*t/e;return{total:e,transferred:t,percent:n}}function sendRequestXhr(r,e){return new Promise(function(t,n){e.onprogress=function(l){r.emitter.emit(constants$7.EVENT_PROGRESS_DOWNLOAD,normalizeBrowserProgressEvent(l))};var o=r.file;o&&(e.upload.onprogress=function(l){r.emitter.emit(constants$7.EVENT_PROGRESS_UPLOAD,normalizeBrowserProgressEvent(l))}),e.onerror=function(l){n(l)},e.onabort=function(){var l=new MapiError({request:r,type:constants$7.ERROR_REQUEST_ABORTED});n(l)},e.onload=function(){if(delete requestsUnderway[r.id],e.status<200||e.status>=400){var l=new MapiError({request:r,body:e.response,statusCode:e.status});n(l);return}t(e)};var a=r.body;typeof a=="string"?e.send(a):a?e.send(JSON.stringify(a)):o?e.send(o):e.send(),requestsUnderway[r.id]=e}).then(function(t){return createResponse(r,t)})}function createRequestXhr(r,e){var t=r.url(e),n=new window.XMLHttpRequest;return n.open(r.method,t),Object.keys(r.headers).forEach(function(o){n.setRequestHeader(o,r.headers[o])}),n}function browserSend(r){return Promise.resolve().then(function(){var e=createRequestXhr(r,r.client.accessToken);return sendRequestXhr(r,e)})}var browserLayer={browserAbort,sendRequestXhr,browserSend,createRequestXhr},base64$1={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */base64$1.exports;(function(r,e){(function(t){var n=e,o=r&&r.exports==n&&r,a=typeof commonjsGlobal=="object"&&commonjsGlobal;(a.global===a||a.window===a)&&(t=a);var l=function(Ht){this.message=Ht};l.prototype=new Error,l.prototype.name="InvalidCharacterError";var s=function(Ht){throw new l(Ht)},m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",y=/[\t\n\f\r ]/g,D=function(Ht){Ht=String(Ht).replace(y,"");var ir=Ht.length;ir%4==0&&(Ht=Ht.replace(/==?$/,""),ir=Ht.length),(ir%4==1||/[^+a-zA-Z0-9/]/.test(Ht))&&s("Invalid character: the string to be decoded is not correctly encoded.");for(var Hr=0,Bn,Vn,Wr="",ps=-1;++ps<ir;)Vn=m.indexOf(Ht.charAt(ps)),Bn=Hr%4?Bn*64+Vn:Vn,Hr++%4&&(Wr+=String.fromCharCode(255&Bn>>(-2*Hr&6)));return Wr},W=function(Ht){Ht=String(Ht),/[^\0-\xFF]/.test(Ht)&&s("The string to be encoded contains characters outside of the Latin1 range.");for(var ir=Ht.length%3,Hr="",Bn=-1,Vn,Wr,ps,il,gl=Ht.length-ir;++Bn<gl;)Vn=Ht.charCodeAt(Bn)<<16,Wr=Ht.charCodeAt(++Bn)<<8,ps=Ht.charCodeAt(++Bn),il=Vn+Wr+ps,Hr+=m.charAt(il>>18&63)+m.charAt(il>>12&63)+m.charAt(il>>6&63)+m.charAt(il&63);return ir==2?(Vn=Ht.charCodeAt(Bn)<<8,Wr=Ht.charCodeAt(++Bn),il=Vn+Wr,Hr+=m.charAt(il>>10)+m.charAt(il>>4&63)+m.charAt(il<<2&63)+"="):ir==1&&(il=Ht.charCodeAt(Bn),Hr+=m.charAt(il>>2)+m.charAt(il<<4&63)+"=="),Hr},Ee={encode:W,decode:D,version:"0.1.0"};if(n&&!n.nodeType)if(o)o.exports=Ee;else for(var dt in Ee)Ee.hasOwnProperty(dt)&&(n[dt]=Ee[dt]);else t.base64=Ee})(commonjsGlobal)})(base64$1,base64$1.exports);var base64Exports=base64$1.exports,base64=base64Exports,tokenCache={};function parseToken$2(r){if(tokenCache[r])return tokenCache[r];var e=r.split("."),t=e[0],n=e[1];if(!n)throw new Error("Invalid token");var o=parsePaylod(n),a={usage:t,user:o.u};return has(o,"a")&&(a.authorization=o.a),has(o,"exp")&&(a.expires=o.exp*1e3),has(o,"iat")&&(a.created=o.iat*1e3),has(o,"scopes")&&(a.scopes=o.scopes),has(o,"client")&&(a.client=o.client),has(o,"ll")&&(a.lastLogin=o.ll),has(o,"iu")&&(a.impersonator=o.iu),tokenCache[r]=a,a}function parsePaylod(r){try{return JSON.parse(base64.decode(r))}catch{throw new Error("Invalid token")}}function has(r,e){return Object.prototype.hasOwnProperty.call(r,e)}var parseMapboxToken=parseToken$2,eventemitter3={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function o(m,y,D){this.fn=m,this.context=y,this.once=D||!1}function a(m,y,D,W,Ee){if(typeof D!="function")throw new TypeError("The listener must be a function");var dt=new o(D,W||m,Ee),Ht=t?t+y:y;return m._events[Ht]?m._events[Ht].fn?m._events[Ht]=[m._events[Ht],dt]:m._events[Ht].push(dt):(m._events[Ht]=dt,m._eventsCount++),m}function l(m,y){--m._eventsCount===0?m._events=new n:delete m._events[y]}function s(){this._events=new n,this._eventsCount=0}s.prototype.eventNames=function(){var y=[],D,W;if(this._eventsCount===0)return y;for(W in D=this._events)e.call(D,W)&&y.push(t?W.slice(1):W);return Object.getOwnPropertySymbols?y.concat(Object.getOwnPropertySymbols(D)):y},s.prototype.listeners=function(y){var D=t?t+y:y,W=this._events[D];if(!W)return[];if(W.fn)return[W.fn];for(var Ee=0,dt=W.length,Ht=new Array(dt);Ee<dt;Ee++)Ht[Ee]=W[Ee].fn;return Ht},s.prototype.listenerCount=function(y){var D=t?t+y:y,W=this._events[D];return W?W.fn?1:W.length:0},s.prototype.emit=function(y,D,W,Ee,dt,Ht){var ir=t?t+y:y;if(!this._events[ir])return!1;var Hr=this._events[ir],Bn=arguments.length,Vn,Wr;if(Hr.fn){switch(Hr.once&&this.removeListener(y,Hr.fn,void 0,!0),Bn){case 1:return Hr.fn.call(Hr.context),!0;case 2:return Hr.fn.call(Hr.context,D),!0;case 3:return Hr.fn.call(Hr.context,D,W),!0;case 4:return Hr.fn.call(Hr.context,D,W,Ee),!0;case 5:return Hr.fn.call(Hr.context,D,W,Ee,dt),!0;case 6:return Hr.fn.call(Hr.context,D,W,Ee,dt,Ht),!0}for(Wr=1,Vn=new Array(Bn-1);Wr<Bn;Wr++)Vn[Wr-1]=arguments[Wr];Hr.fn.apply(Hr.context,Vn)}else{var ps=Hr.length,il;for(Wr=0;Wr<ps;Wr++)switch(Hr[Wr].once&&this.removeListener(y,Hr[Wr].fn,void 0,!0),Bn){case 1:Hr[Wr].fn.call(Hr[Wr].context);break;case 2:Hr[Wr].fn.call(Hr[Wr].context,D);break;case 3:Hr[Wr].fn.call(Hr[Wr].context,D,W);break;case 4:Hr[Wr].fn.call(Hr[Wr].context,D,W,Ee);break;default:if(!Vn)for(il=1,Vn=new Array(Bn-1);il<Bn;il++)Vn[il-1]=arguments[il];Hr[Wr].fn.apply(Hr[Wr].context,Vn)}}return!0},s.prototype.on=function(y,D,W){return a(this,y,D,W,!1)},s.prototype.once=function(y,D,W){return a(this,y,D,W,!0)},s.prototype.removeListener=function(y,D,W,Ee){var dt=t?t+y:y;if(!this._events[dt])return this;if(!D)return l(this,dt),this;var Ht=this._events[dt];if(Ht.fn)Ht.fn===D&&(!Ee||Ht.once)&&(!W||Ht.context===W)&&l(this,dt);else{for(var ir=0,Hr=[],Bn=Ht.length;ir<Bn;ir++)(Ht[ir].fn!==D||Ee&&!Ht[ir].once||W&&Ht[ir].context!==W)&&Hr.push(Ht[ir]);Hr.length?this._events[dt]=Hr.length===1?Hr[0]:Hr:l(this,dt)}return this},s.prototype.removeAllListeners=function(y){var D;return y?(D=t?t+y:y,this._events[D]&&l(this,D)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=t,s.EventEmitter=s,r.exports=s})(eventemitter3);var eventemitter3Exports=eventemitter3.exports;function encodeArray(r){return r.map(encodeURIComponent).join(",")}function encodeValue(r){return Array.isArray(r)?encodeArray(r):encodeURIComponent(String(r))}function appendQueryParam(r,e,t){if(t===!1||t===null)return r;var n=/\?/.test(r)?"&":"?",o=encodeURIComponent(e);return t!==void 0&&t!==""&&t!==!0&&(o+="="+encodeValue(t)),""+r+n+o}function appendQueryObject(r,e){if(!e)return r;var t=r;return Object.keys(e).forEach(function(n){var o=e[n];o!==void 0&&(Array.isArray(o)&&(o=o.filter(function(a){return a!=null}).join(",")),t=appendQueryParam(t,n,o))}),t}function prependOrigin(r,e){if(!e||r.slice(0,4)==="http")return r;var t=r[0]==="/"?"":"/";return""+e.replace(/\/$/,"")+t+r}function interpolateRouteParams(r,e){return e?r.replace(/\/:([a-zA-Z0-9]+)/g,function(t,n){var o=e[n];if(o===void 0)throw new Error("Unspecified route parameter "+n);var a=encodeValue(o);return"/"+a}):r}var urlUtils$1={appendQueryObject,appendQueryParam,prependOrigin,interpolateRouteParams},parseToken$1=parseMapboxToken,xtend$3=immutable,EventEmitter$1=eventemitter3Exports,urlUtils=urlUtils$1,constants$6=constants$9,requestId=1;function MapiRequest$1(r,e){if(!r)throw new Error("MapiRequest requires a client");if(!e||!e.path||!e.method)throw new Error("MapiRequest requires an options object with path and method properties");var t={};e.body&&(t["content-type"]="application/json");var n=xtend$3(t,e.headers),o=Object.keys(n).reduce(function(a,l){return a[l.toLowerCase()]=n[l],a},{});this.id=requestId++,this._options=e,this.emitter=new EventEmitter$1,this.client=r,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=e.path,this.method=e.method,this.origin=e.origin||r.origin,this.query=e.query||{},this.params=e.params||{},this.body=e.body||null,this.file=e.file||null,this.encoding=e.encoding||"utf8",this.sendFileAs=e.sendFileAs||null,this.headers=o}MapiRequest$1.prototype.url=function(e){var t=urlUtils.prependOrigin(this.path,this.origin);t=urlUtils.appendQueryObject(t,this.query);var n=this.params,o=e??this.client.accessToken;if(o){t=urlUtils.appendQueryParam(t,"access_token",o);var a=parseToken$1(o).user;n=xtend$3({ownerId:a},n)}return t=urlUtils.interpolateRouteParams(t,n),t};MapiRequest$1.prototype.send=function(){var e=this;if(e.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return e.sent=!0,e.client.sendRequest(e).then(function(t){return e.response=t,e.emitter.emit(constants$6.EVENT_RESPONSE,t),t},function(t){throw e.error=t,e.emitter.emit(constants$6.EVENT_ERROR,t),t})};MapiRequest$1.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};MapiRequest$1.prototype.eachPage=function(e){var t=this;function n(l){function s(){delete t._nextPageRequest;var m=l.nextPage();m&&(t._nextPageRequest=m,a(m))}e(null,l,s)}function o(l){e(l,null,function(){})}function a(l){l.send().then(n,o)}a(this)};MapiRequest$1.prototype.clone=function(){return this._extend()};MapiRequest$1.prototype._extend=function(e){var t=xtend$3(this._options,e);return new MapiRequest$1(this.client,t)};var mapiRequest=MapiRequest$1,parseToken=parseMapboxToken,MapiRequest=mapiRequest,constants$5=constants$9;function MapiClient$2(r){if(!r||!r.accessToken)throw new Error("Cannot create a client without an access token");parseToken(r.accessToken),this.accessToken=r.accessToken,this.origin=r.origin||constants$5.API_ORIGIN}MapiClient$2.prototype.createRequest=function(e){return new MapiRequest(this,e)};var mapiClient=MapiClient$2,browser=browserLayer,MapiClient$1=mapiClient;function BrowserClient(r){MapiClient$1.call(this,r)}BrowserClient.prototype=Object.create(MapiClient$1.prototype);BrowserClient.prototype.constructor=BrowserClient;BrowserClient.prototype.sendRequest=browser.browserSend;BrowserClient.prototype.abortRequest=browser.browserAbort;function createBrowserClient(r){return new BrowserClient(r)}var browserClient=createBrowserClient,client=browserClient,mapboxSdk=client,toString$3=Object.prototype.toString,isPlainObj=function(r){var e;return toString$3.call(r)==="[object Object]"&&(e=Object.getPrototypeOf(r),e===null||e===Object.getPrototypeOf({}))},isPlainObject=isPlainObj,xtend$2=immutable,DEFAULT_ERROR_PATH="value",NEWLINE_INDENT=`
  `,v$2={};v$2.assert=function(r,e){return e=e||{},function(t){var n=validate(r,t);if(n){var o=processMessage(n,e);throw e.apiName&&(o=e.apiName+": "+o),new Error(o)}}};v$2.shape=function(e){var t=objectEntries(e);return function(o){var a=validate(v$2.plainObject,o);if(a)return a;for(var l,s,m=[],y=0;y<t.length;y++)l=t[y].key,s=t[y].value,a=validate(s,o[l]),a&&m.push([l].concat(a));return m.length<2?m[0]:function(D){m=m.map(function(dt){var Ht=dt[0],ir=processMessage(dt,D).split(`
`).join(NEWLINE_INDENT);return"- "+Ht+": "+ir});var W=D.path.join("."),Ee=W===DEFAULT_ERROR_PATH?"":" of "+W;return"The following properties"+Ee+" have invalid values:"+NEWLINE_INDENT+m.join(NEWLINE_INDENT)}}};v$2.strictShape=function(e){var t=v$2.shape(e);return function(o){var a=t(o);if(a)return a;var l=Object.keys(o).reduce(function(s,m){return e[m]===void 0&&s.push(m),s},[]);if(l.length!==0)return function(){return"The following keys are invalid: "+l.join(", ")}}};v$2.arrayOf=function(e){return createArrayValidator(e)};v$2.tuple=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return createArrayValidator(e)};function createArrayValidator(r){var e=Array.isArray(r),t=function(n){return e?r[n]:r};return function(o){var a=validate(v$2.plainArray,o);if(a)return a;if(e&&o.length!==r.length)return"an array with "+r.length+" items";for(var l=0;l<o.length;l++)if(a=validate(t(l),o[l]),a)return[l].concat(a)}}v$2.required=function(e){function t(n){return n==null?function(o){return formatErrorMessage(o,isArrayCulprit(o.path)?"cannot be undefined/null.":"is required.")}:e.apply(this,arguments)}return t.__required=!0,t};v$2.oneOfType=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(n){var o=e.map(function(a){return validate(a,n)}).filter(Boolean);if(o.length===e.length)return o.every(function(a){return a.length===1&&typeof a[0]=="string"})?orList(o.map(function(a){return a[0]})):o.reduce(function(a,l){return l.length>a.length?l:a})}};v$2.equal=function(e){return function(n){if(n!==e)return JSON.stringify(e)}};v$2.oneOf=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),t=e.map(function(n){return v$2.equal(n)});return v$2.oneOfType.apply(this,t)};v$2.range=function(e){var t=e[0],n=e[1];return function(a){var l=validate(v$2.number,a);if(l||a<t||a>n)return"number between "+t+" & "+n+" (inclusive)"}};v$2.any=function(){};v$2.boolean=function(e){if(typeof e!="boolean")return"boolean"};v$2.number=function(e){if(typeof e!="number")return"number"};v$2.plainArray=function(e){if(!Array.isArray(e))return"array"};v$2.plainObject=function(e){if(!isPlainObject(e))return"object"};v$2.string=function(e){if(typeof e!="string")return"string"};v$2.func=function(e){if(typeof e!="function")return"function"};function validate(r,e){if(!(e==null&&!r.hasOwnProperty("__required"))){var t=r(e);if(t)return Array.isArray(t)?t:[t]}}function processMessage(r,e){var t=r.length,n=r[t-1],o=r.slice(0,t-1);return o.length===0&&(o=[DEFAULT_ERROR_PATH]),e=xtend$2(e,{path:o}),typeof n=="function"?n(e):formatErrorMessage(e,prettifyResult(n))}function orList(r){return r.length<2?r[0]:r.length===2?r.join(" or "):r.slice(0,-1).join(", ")+", or "+r.slice(-1)}function prettifyResult(r){return"must be "+addArticle(r)+"."}function addArticle(r){return/^an? /.test(r)?r:/^[aeiou]/i.test(r)?"an "+r:/^[a-z]/i.test(r)?"a "+r:r}function formatErrorMessage(r,e){var t=isArrayCulprit(r.path),n=r.path.join(".")+" "+e,o=t?"Item at position ":"";return o+n}function isArrayCulprit(r){return typeof r[r.length-1]=="number"||typeof r[0]=="number"}function objectEntries(r){return Object.keys(r||{}).map(function(e){return{key:e,value:r[e]}})}v$2.validate=validate;v$2.processMessage=processMessage;var lib$1=v$2,xtend$1=immutable,v$1=lib$1;function file(r){if(typeof window<"u")return r instanceof commonjsGlobal.Blob||r instanceof commonjsGlobal.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof r=="string"||r.pipe!==void 0))return"Filename or Readable stream"}function assertShape(r,e){return v$1.assert(v$1.strictShape(r),e)}function date(r){var e="date";if(typeof r=="boolean")return e;try{var t=new Date(r);if(t.getTime&&isNaN(t.getTime()))return e}catch{return e}}function coordinates$1(r){return v$1.tuple(v$1.number,v$1.number)(r)}var validator=xtend$1(v$1,{file,date,coordinates:coordinates$1,assertShape});function pick$1(r,e){var t=function(n,o){return e.indexOf(n)!==-1&&o!==void 0};return typeof e=="function"&&(t=e),Object.keys(r).filter(function(n){return t(n,r[n])}).reduce(function(n,o){return n[o]=r[o],n},{})}var pick_1=pick$1;function objectMap$1(r,e){return Object.keys(r).reduce(function(t,n){return t[n]=e(n,r[n]),t},{})}var objectMap_1=objectMap$1,objectMap=objectMap_1;function stringifyBoolean(r){return objectMap(r,function(e,t){return typeof t=="boolean"?JSON.stringify(t):t})}var stringifyBooleans$1=stringifyBoolean,MapiClient=mapiClient,createClient=browserClient;function createServiceFactory$1(r){return function(e){var t;MapiClient.prototype.isPrototypeOf(e)?t=e:t=createClient(e);var n=Object.create(r);return n.client=t,n}}var createServiceFactory_1=createServiceFactory$1,xtend=immutable,v=validator,pick=pick_1,stringifyBooleans=stringifyBooleans$1,createServiceFactory=createServiceFactory_1,Geocoding={},featureTypes=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Geocoding.forwardGeocode=function(r){v.assertShape({query:v.required(v.string),mode:v.oneOf("mapbox.places","mapbox.places-permanent"),countries:v.arrayOf(v.string),proximity:v.oneOf(v.coordinates,"ip"),types:v.arrayOf(v.oneOf(featureTypes)),autocomplete:v.boolean,bbox:v.arrayOf(v.number),limit:v.number,language:v.arrayOf(v.string),routing:v.boolean,fuzzyMatch:v.boolean,worldview:v.string})(r),r.mode=r.mode||"mapbox.places";var e=stringifyBooleans(xtend({country:r.countries},pick(r,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pick(r,["mode","query"]),query:e})};Geocoding.reverseGeocode=function(r){v.assertShape({query:v.required(v.coordinates),mode:v.oneOf("mapbox.places","mapbox.places-permanent"),countries:v.arrayOf(v.string),types:v.arrayOf(v.oneOf(featureTypes)),bbox:v.arrayOf(v.number),limit:v.number,language:v.arrayOf(v.string),reverseMode:v.oneOf("distance","score"),routing:v.boolean,worldview:v.string})(r),r.mode=r.mode||"mapbox.places";var e=stringifyBooleans(xtend({country:r.countries},pick(r,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pick(r,["mode","query"]),query:e})};var geocoding$1=createServiceFactory(Geocoding);let urlAlphabet="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",random=r=>crypto.getRandomValues(new Uint8Array(r)),customRandom=(r,e,t)=>{let n=(2<<Math.log(r.length-1)/Math.LN2)-1,o=-~(1.6*n*e/r.length);return(a=e)=>{let l="";for(;;){let s=t(o),m=o;for(;m--;)if(l+=r[s[m]&n]||"",l.length===a)return l}}},customAlphabet=(r,e=21)=>customRandom(r,e,random),nanoid$1=(r=21)=>crypto.getRandomValues(new Uint8Array(r)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");const index_browser=Object.freeze(Object.defineProperty({__proto__:null,customAlphabet,customRandom,nanoid:nanoid$1,random,urlAlphabet},Symbol.toStringTag,{value:"Module"})),require$$0$4=getAugmentedNamespace(index_browser);var nanoid=require$$0$4.nanoid;function MapboxEventManager$1(r){this.origin=r.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=r.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=r,this.send=this.send.bind(this),this.countries=r.countries?r.countries.split(","):null,this.types=r.types?r.types.split(","):null,this.bbox=r.bbox?r.bbox:null,this.language=r.language?r.language.split(","):null,this.limit=r.limit?+r.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(r),this.eventQueue=new Array,this.flushInterval=r.flushInterval||1e3,this.maxQueueSize=r.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}MapboxEventManager$1.prototype={select:function(r,e){var t=this.getSelectedIndex(r,e),n=this.getEventPayload("search.select",e);if(n.resultIndex=t,n.resultPlaceName=r.place_name,n.resultId=r.id,!(t===this.lastSentIndex&&n.queryString===this.lastSentInput||t==-1)&&(this.lastSentIndex=t,this.lastSentInput=n.queryString,!!n.queryString))return this.push(n)},start:function(r){var e=this.getEventPayload("search.start",r);if(e.queryString)return this.push(e)},keyevent:function(r,e){if(r.key&&!(r.metaKey||[9,27,37,39,13,38,40].indexOf(r.keyCode)!==-1)){var t=this.getEventPayload("search.keystroke",e);if(t.lastAction=r.key,!!t.queryString)return this.push(t)}},send:function(r,e){if(!this.enableEventLogging)return e?e():void 0;var t=this.getRequestOptions(r);this.request(t,(function(n){if(n)return this.handleError(n,e);if(e)return e()}).bind(this))},getRequestOptions:function(r){Array.isArray(r)||(r=[r]);var e={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(r)};return e},getEventPayload:function(r,e){var t;e.options.proximity?typeof e.options.proximity=="object"?t=[e.options.proximity.longitude,e.options.proximity.latitude]:e.options.proximity==="ip"?t=[999,999]:t=e.options.proximity:t=null;var n=e._map?e._map.getZoom():void 0,o={event:r,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:e.options.autocomplete,fuzzyMatch:e.options.fuzzyMatch,proximity:t,limit:e.options.limit,routing:e.options.routing,worldview:e.options.worldview,mapZoom:n,keyboardLocale:this.locale};return r==="search.select"?o.queryString=e.inputString:r!="search.select"&&e._inputEl?o.queryString=e._inputEl.value:o.queryString=e.inputString,o},request:function(r,e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(this.readyState==4)return this.status==204?e(null):e(this.statusText)},t.open(r.method,r.host+"/"+r.path,!0);for(var n in r.headers){var o=r.headers[n];t.setRequestHeader(n,o)}t.send(r.body)},handleError:function(r,e){if(e)return e(r)},generateSessionID:function(){return nanoid()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(r,e){if(e._typeahead){var t=e._typeahead.data,n=r.id,o=t.map(function(l){return l.id}),a=o.indexOf(n);return a}},shouldEnableLogging:function(r){return!(r.enableEventLogging===!1||r.origin&&r.origin!=="https://api.mapbox.com"||r.localGeocoder||r.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(r,e){this.eventQueue.push(r),(this.eventQueue.length>=this.maxQueueSize||e)&&this.flush()},remove:function(){this.flush()}};var events=MapboxEventManager$1,placeholder={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"",ja:"",lv:"Meklt",pt:"Procurar",sr:"",zh:"",cs:"Vyhledvn",hu:"Keress",ka:"",nb:"Ske",sk:"Vyhadvanie",th:"",fi:"Hae",is:"Leita",ko:"",pl:"Szukaj",sl:"Iskanje",fa:"",ru:""},localization$1={placeholder},subtag$1={exports:{}};(function(r){(function(e,t,n){r.exports?r.exports=n():e[t]=n()})(commonjsGlobal,"subtag",function(){var e="",t=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function n(m){return m.match(t)||[]}function o(m){return n(m).filter(function(y,D){return y&&D})}function a(m){return m=n(m),{language:m[1]||e,extlang:m[2]||e,script:m[3]||e,region:m[4]||e}}function l(m,y,D){Object.defineProperty(m,y,{value:D,enumerable:!0})}function s(m,y,D){function W(Ee){return n(Ee)[m]||e}l(W,"pattern",y),l(a,D,W)}return s(1,/^[a-zA-Z]{2,3}$/,"language"),s(2,/^[a-zA-Z]{3}$/,"extlang"),s(3,/^[a-zA-Z]{4}$/,"script"),s(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),l(a,"split",o),a})})(subtag$1);var subtagExports=subtag$1.exports;function Geolocation$1(){}Geolocation$1.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const r={enableHighAccuracy:!0};return new Promise(function(e,t){window.navigator.geolocation.getCurrentPosition(e,t,r)})}};var geolocation$1=Geolocation$1;function transformFeatureToGeolocationText(r,e){const t=getAddressInfo(r),n=["address","street","place","country"];var o;if(typeof e=="function")return e(t);const a=n.indexOf(e);return a===-1?o=n:o=n.slice(a),o.reduce(function(l,s){return t[s]?(l!==""&&(l=l+", "),l+t[s]):l},"")}function getAddressInfo(r){const e=r.address||"",t=r.text||"",n=r.place_name||"",a={address:n.split(",")[0],houseNumber:e,street:t,placeName:n};return r.context.forEach(function(l){const s=l.id.split(".")[0];a[s]=l.text}),a}const REVERSE_GEOCODE_COORD_RGX=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var utils$2={transformFeatureToGeolocationText,getAddressInfo,REVERSE_GEOCODE_COORD_RGX},Typeahead=suggestions,debounce$1=lodash_debounce,extend$3=immutable,EventEmitter=eventsExports.EventEmitter,exceptions=exceptions$1,MapboxClient=mapboxSdk,mbxGeocoder=geocoding$1,MapboxEventManager=events,localization=localization$1,subtag=subtagExports,Geolocation=geolocation$1,utils$1=utils$2;const GEOCODE_REQUEST_TYPE={FORWARD:0,LOCAL:1,REVERSE:2};function getFooterNode(){var r=document.createElement("div");return r.className="mapboxgl-ctrl-geocoder--powered-by",r.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',r}function MapboxGeocoder(r){this._eventEmitter=new EventEmitter,this.options=extend$3({},this.options,r),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new Geolocation}MapboxGeocoder.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(r){return r.place_name},render:function(r){var e=r.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+e[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+e.splice(1,e.length).join(",")+"</div></div>"}},addTo:function(r){function e(t,n){if(!document.body.contains(n))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const o=t.onAdd();n.appendChild(o)}if(r._controlContainer)r.addControl(this);else if(r instanceof HTMLElement)e(this,r);else if(typeof r=="string"){const t=document.querySelectorAll(r);if(t.length===0)throw new Error("Element ",r,"not found.");if(t.length>1)throw new Error("Geocoder can only be added to a single html element");e(this,t[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(r){if(r&&typeof r!="string"&&(this._map=r),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=mbxGeocoder(MapboxClient({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new MapboxEventManager(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var e=this.container=document.createElement("div");e.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var t=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",debounce$1(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",(function(y){this.eventManager.keyevent(y,this)}).bind(this));var n=document.createElement("div");n.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var o=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(o),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),n.appendChild(this._clearEl),n.appendChild(this._loadingEl),e.appendChild(t),e.appendChild(this._inputEl),e.appendChild(n),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var a=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(a),n.appendChild(this._geolocateEl),this._showGeolocateButton()}var l=this._typeahead=new Typeahead(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),l.getItemValue=this.options.getItemValue;var s=l.list.draw,m=this._footerNode=getFooterNode();return l.list.draw=function(){s.call(this),m.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),m.addEventListener("mouseup",(function(){this.selectingListItem=!1}).bind(this)),this.element.appendChild(m)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),e},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then((function(r){this._hideLoadingIcon();const e={geometry:{type:"Point",coordinates:[r.coords.longitude,r.coords.latitude]}};this._handleMarker(e),this._fly(e),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(e),this._showClearButton(),this.fresh=!1;const t={limit:1,language:[this.options.language],query:e.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const n=e.geometry.coordinates[0]+","+e.geometry.coordinates[1];this._setInputValue(n),this._eventEmitter.emit("result",{result:e})}else this.geocoderService.reverseGeocode(t).send().then((function(n){const o=n.body.features[0];if(o){const a=utils$1.transformFeatureToGeolocationText(o,this.options.addressAccuracy);this._setInputValue(a),o.user_coordinates=e.geometry.coordinates,this._eventEmitter.emit("result",{result:o})}else this._eventEmitter.emit("result",{result:{user_coordinates:e.geometry.coordinates}})}).bind(this))}).bind(this)).catch((function(r){r.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}).bind(this))},createIcon:function(r,e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+r),t.setAttribute("viewBox","0 0 18 18"),t.setAttribute("xml:space","preserve"),t.setAttribute("width",18),t.setAttribute("height",18),t.innerHTML=e,t},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(r){this._inputEl.value=r,setTimeout((function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}).bind(this),1)},_onPaste:function(r){var e=(r.clipboardData||window.clipboardData).getData("text");e.length>=this.options.minLength&&this._geocode(e)},_onKeyDown:function(r){var e=27,t=9;if(r.keyCode===e&&this.options.clearAndBlurOnEsc)return this._clear(r),this._inputEl.blur();var n=r.target&&r.target.shadowRoot?r.target.shadowRoot.activeElement:r.target,o=n?n.value:"";if(!o)return this.fresh=!0,r.keyCode!==t&&this.clear(r),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(r.metaKey||[t,e,37,39,13,38,40].indexOf(r.keyCode)!==-1)&&n.value.length>=this.options.minLength&&this._geocode(n.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(r){this.options.clearOnBlur&&this._clearOnBlur(r),this.options.collapsed&&this._collapse()},_onChange:function(){var r=this._typeahead.selected;r&&JSON.stringify(r)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(r),this.options.marker&&this._mapboxgl&&this._handleMarker(r),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(r),this._eventEmitter.emit("result",{result:r}),this.eventManager.select(r,this))},_fly:function(r){var e;if(r.properties&&exceptions[r.properties.short_code])e=extend$3({},this.options.flyTo),this._map&&this._map.fitBounds(exceptions[r.properties.short_code].bbox,e);else if(r.bbox){var t=r.bbox;e=extend$3({},this.options.flyTo),this._map&&this._map.fitBounds([[t[0],t[1]],[t[2],t[3]]],e)}else{var n={zoom:this.options.zoom};e=extend$3({},n,this.options.flyTo),r.center?e.center=r.center:r.geometry&&r.geometry.type&&r.geometry.type==="Point"&&r.geometry.coordinates&&(e.center=r.geometry.coordinates),this._map&&this._map.flyTo(e)}},_requestType:function(r,e){var t;return r.localGeocoderOnly?t=GEOCODE_REQUEST_TYPE.LOCAL:r.reverseGeocode&&utils$1.REVERSE_GEOCODE_COORD_RGX.test(e)?t=GEOCODE_REQUEST_TYPE.REVERSE:t=GEOCODE_REQUEST_TYPE.FORWARD,t},_setupConfig:function(r,e){const t=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],n=/[\s,]+/;var o=this,a=t.reduce(function(s,m){if(o.options[m]===void 0||o.options[m]===null)return s;["countries","types","language"].indexOf(m)>-1?s[m]=o.options[m].split(n):s[m]=o.options[m];const y=typeof o.options[m].longitude=="number"&&typeof o.options[m].latitude=="number";if(m==="proximity"&&y){const D=o.options[m].longitude,W=o.options[m].latitude;s[m]=[D,W]}return s},{});switch(r){case GEOCODE_REQUEST_TYPE.REVERSE:{var l=e.split(n).map(function(s){return parseFloat(s,10)});o.options.flipCoordinates||l.reverse(),a.types&&a.types[0],a=extend$3(a,{query:l,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(s){s in a&&delete a[s]})}break;case GEOCODE_REQUEST_TYPE.FORWARD:{const s=e.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(s)&&(e=e.replace(/,/g," ")),a=extend$3(a,{query:e})}break}return a},_geocode:function(r){this.inputString=r,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:r});const e=this._requestType(this.options,r),t=this._setupConfig(e,r);var n;switch(e){case GEOCODE_REQUEST_TYPE.LOCAL:n=Promise.resolve();break;case GEOCODE_REQUEST_TYPE.FORWARD:n=this.geocoderService.forwardGeocode(t).send();break;case GEOCODE_REQUEST_TYPE.REVERSE:n=this.geocoderService.reverseGeocode(t).send();break}var o=this.options.localGeocoder?this.options.localGeocoder(r)||[]:[],a=[],l=null;return n.catch((function(s){l=s}).bind(this)).then((function(s){this._hideLoadingIcon();var m={};return s?s.statusCode=="200"&&(m=s.body,m.request=s.request,m.headers=s.headers):m={type:"FeatureCollection",features:[]},m.config=t,this.fresh&&(this.eventManager.start(this),this.fresh=!1),m.features=m.features?o.concat(m.features):o,this.options.externalGeocoder?(a=this.options.externalGeocoder(r,m.features)||Promise.resolve([]),a.then(function(y){return m.features=m.features?y.concat(m.features):y,m},function(){return m})):m}).bind(this)).then((function(s){if(l)throw l;this.options.filter&&s.features.length&&(s.features=s.features.filter(this.options.filter)),s.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",s),this._typeahead.update(s.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",s))}).bind(this)).catch((function(s){this._hideLoadingIcon(),this._hideAttribution(),o.length&&this.options.localGeocoder||a.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(o)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:o}),this._eventEmitter.emit("error",{error:s})}).bind(this)),n},_clear:function(r){r&&r.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(r){this._clear(r),this._inputEl.focus()},_clearOnBlur:function(r){var e=this;r.relatedTarget&&e._clear(r)},_onQueryResult:function(r){var e=r.body;if(e.features.length){var t=e.features[0];this._typeahead.selected=t,this._inputEl.value=t.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var r=this._map.getCenter().wrap();this.setProximity({longitude:r.lng,latitude:r.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(r){return this._geocode(r).then(this._onQueryResult),this},_renderError:function(){var r="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(r)},_renderLocationError:function(){var r="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(r)},_renderNoResults:function(){var r="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(r)},_renderUserDeniedGeolocationError:function(){var r="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(r)},_renderMessage:function(r){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(r)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var r=this.options.language.split(",")[0],e=subtag.language(r),t=localization.placeholder[e];if(t)return t}return"Search"},setInput:function(r){return this._inputEl.value=r,this._typeahead.selected=null,this._typeahead.clear(),r.length>=this.options.minLength&&this._geocode(r),this},setProximity:function(r,e=!0){return this.options.proximity=r,e&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(r){return r&&typeof r=="function"&&(this._typeahead.render=r),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(r){var e=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=r||this.options.language||e,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(r){return this.options.zoom=r,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(r){return this.options.flyTo=r,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(r){return this.placeholder=r||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(r){return this.options.bbox=r,this},getCountries:function(){return this.options.countries},setCountries:function(r){return this.options.countries=r,this},getTypes:function(){return this.options.types},setTypes:function(r){return this.options.types=r,this},getMinLength:function(){return this.options.minLength},setMinLength:function(r){return this.options.minLength=r,this._typeahead&&(this._typeahead.options.minLength=r),this},getLimit:function(){return this.options.limit},setLimit:function(r){return this.options.limit=r,this._typeahead&&(this._typeahead.options.limit=r),this},getFilter:function(){return this.options.filter},setFilter:function(r){return this.options.filter=r,this},setOrigin:function(r){return this.options.origin=r,this.geocoderService=mbxGeocoder(MapboxClient({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(r){return this.options.accessToken=r,this.geocoderService=mbxGeocoder(MapboxClient({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(r){return this.options.autocomplete=r,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(r){return this.options.fuzzyMatch=r,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(r){return this.options.routing=r,this},getRouting:function(){return this.options.routing},setWorldview:function(r){return this.options.worldview=r,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(r){if(this._map){this._removeMarker();var e={color:"#4668F2"},t=extend$3({},e,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(t),r.center?this.mapMarker.setLngLat(r.center).addTo(this._map):r.geometry&&r.geometry.type&&r.geometry.type==="Point"&&r.geometry.coordinates&&this.mapMarker.setLngLat(r.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(r,e){return this._eventEmitter.on(r,e),this},off:function(r,e){return this._eventEmitter.removeListener(r,e),this.eventManager.remove(),this}};var lib=MapboxGeocoder;const MapboxGeocoder$1=getDefaultExportFromCjs(lib),mapboxGlGeocoder="";var maplibreGl={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(commonjsGlobal,function(){var t,n,o;function a(s,m){if(!t)t=m;else if(!n)n=m;else{var y="var sharedChunk = {}; ("+t+")(sharedChunk); ("+n+")(sharedChunk);",D={};t(D),o=m(D),typeof window<"u"&&(o.workerUrl=window.URL.createObjectURL(new Blob([y],{type:"text/javascript"})))}}a(["exports"],function(s){function m(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x.default:x}var y=D;function D(x,f){this.x=x,this.y=f}D.prototype={clone:function(){return new D(this.x,this.y)},add:function(x){return this.clone()._add(x)},sub:function(x){return this.clone()._sub(x)},multByPoint:function(x){return this.clone()._multByPoint(x)},divByPoint:function(x){return this.clone()._divByPoint(x)},mult:function(x){return this.clone()._mult(x)},div:function(x){return this.clone()._div(x)},rotate:function(x){return this.clone()._rotate(x)},rotateAround:function(x,f){return this.clone()._rotateAround(x,f)},matMult:function(x){return this.clone()._matMult(x)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(x){return this.x===x.x&&this.y===x.y},dist:function(x){return Math.sqrt(this.distSqr(x))},distSqr:function(x){var f=x.x-this.x,C=x.y-this.y;return f*f+C*C},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(x){return Math.atan2(this.y-x.y,this.x-x.x)},angleWith:function(x){return this.angleWithSep(x.x,x.y)},angleWithSep:function(x,f){return Math.atan2(this.x*f-this.y*x,this.x*x+this.y*f)},_matMult:function(x){var f=x[2]*this.x+x[3]*this.y;return this.x=x[0]*this.x+x[1]*this.y,this.y=f,this},_add:function(x){return this.x+=x.x,this.y+=x.y,this},_sub:function(x){return this.x-=x.x,this.y-=x.y,this},_mult:function(x){return this.x*=x,this.y*=x,this},_div:function(x){return this.x/=x,this.y/=x,this},_multByPoint:function(x){return this.x*=x.x,this.y*=x.y,this},_divByPoint:function(x){return this.x/=x.x,this.y/=x.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var x=this.y;return this.y=this.x,this.x=-x,this},_rotate:function(x){var f=Math.cos(x),C=Math.sin(x),N=C*this.x+f*this.y;return this.x=f*this.x-C*this.y,this.y=N,this},_rotateAround:function(x,f){var C=Math.cos(x),N=Math.sin(x),ot=f.y+N*(this.x-f.x)+C*(this.y-f.y);return this.x=f.x+C*(this.x-f.x)-N*(this.y-f.y),this.y=ot,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},D.convert=function(x){return x instanceof D?x:Array.isArray(x)?new D(x[0],x[1]):x};var W=m(y),Ee=dt;function dt(x,f,C,N){this.cx=3*x,this.bx=3*(C-x)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*f,this.by=3*(N-f)-this.cy,this.ay=1-this.cy-this.by,this.p1x=x,this.p1y=f,this.p2x=C,this.p2y=N}dt.prototype={sampleCurveX:function(x){return((this.ax*x+this.bx)*x+this.cx)*x},sampleCurveY:function(x){return((this.ay*x+this.by)*x+this.cy)*x},sampleCurveDerivativeX:function(x){return(3*this.ax*x+2*this.bx)*x+this.cx},solveCurveX:function(x,f){if(f===void 0&&(f=1e-6),x<0)return 0;if(x>1)return 1;for(var C=x,N=0;N<8;N++){var ot=this.sampleCurveX(C)-x;if(Math.abs(ot)<f)return C;var Bt=this.sampleCurveDerivativeX(C);if(Math.abs(Bt)<1e-6)break;C-=ot/Bt}var Jt=0,Ir=1;for(C=x,N=0;N<20&&(ot=this.sampleCurveX(C),!(Math.abs(ot-x)<f));N++)x>ot?Jt=C:Ir=C,C=.5*(Ir-Jt)+Jt;return C},solve:function(x,f){return this.sampleCurveY(this.solveCurveX(x,f))}};var Ht=m(Ee);function ir(x,f,C,N){const ot=new Ht(x,f,C,N);return function(Bt){return ot.solve(Bt)}}const Hr=ir(.25,.1,.25,1);function Bn(x,f,C){return Math.min(C,Math.max(f,x))}function Vn(x,f,C){const N=C-f,ot=((x-f)%N+N)%N+f;return ot===f?C:ot}function Wr(x,...f){for(const C of f)for(const N in C)x[N]=C[N];return x}let ps=1;function il(x,f){x.forEach(C=>{f[C]&&(f[C]=f[C].bind(f))})}function gl(x,f,C){const N={};for(const ot in x)N[ot]=f.call(C||this,x[ot],ot,x);return N}function ml(x,f,C){const N={};for(const ot in x)f.call(C||this,x[ot],ot,x)&&(N[ot]=x[ot]);return N}function sl(x){return Array.isArray(x)?x.map(sl):typeof x=="object"&&x?gl(x,sl):x}const ll={};function rl(x){ll[x]||(typeof console<"u"&&console.warn(x),ll[x]=!0)}function th(x,f,C){return(C.y-x.y)*(f.x-x.x)>(f.y-x.y)*(C.x-x.x)}function nh(x){let f=0;for(let C,N,ot=0,Bt=x.length,Jt=Bt-1;ot<Bt;Jt=ot++)C=x[ot],N=x[Jt],f+=(N.x-C.x)*(C.y+N.y);return f}function bh(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let Fh=null;function Bh(x){if(Fh==null){const f=x.navigator?x.navigator.userAgent:null;Fh=!!x.safari||!(!f||!(/\b(iPad|iPhone|iPod)\b/.test(f)||f.match("Safari")&&!f.match("Chrome")))}return Fh}function Ed(x){return typeof ImageBitmap<"u"&&x instanceof ImageBitmap}const Td="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let td,Fd;const Ld={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(x){const f=requestAnimationFrame(x);return{cancel:()=>cancelAnimationFrame(f)}},getImageData(x,f=0){return this.getImageCanvasContext(x).getImageData(-f,-f,x.width+2*f,x.height+2*f)},getImageCanvasContext(x){const f=window.document.createElement("canvas"),C=f.getContext("2d",{willReadFrequently:!0});if(!C)throw new Error("failed to create canvas 2d context");return f.width=x.width,f.height=x.height,C.drawImage(x,0,0,x.width,x.height),C},resolveURL:x=>(td||(td=document.createElement("a")),td.href=x,td.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Fd==null&&(Fd=matchMedia("(prefers-reduced-motion: reduce)")),Fd.matches)}},Ud={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class Xd extends Error{constructor(f,C,N,ot){super(`AJAXError: ${C} (${f}): ${N}`),this.status=f,this.statusText=C,this.url=N,this.body=ot}}const wd=bh()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,zd=x=>Ud.REGISTERED_PROTOCOLS[x.substring(0,x.indexOf("://"))];function Rd(x,f){const C=new AbortController,N=new Request(x.url,{method:x.method||"GET",body:x.body,credentials:x.credentials,headers:x.headers,referrer:wd(),signal:C.signal});let ot=!1,Bt=!1;return x.type==="json"&&N.headers.set("Accept","application/json"),Bt||fetch(N).then(Jt=>Jt.ok?(Ir=>{(x.type==="arrayBuffer"||x.type==="image"?Ir.arrayBuffer():x.type==="json"?Ir.json():Ir.text()).then(wo=>{Bt||(ot=!0,f(null,wo,Ir.headers.get("Cache-Control"),Ir.headers.get("Expires")))}).catch(wo=>{Bt||f(new Error(wo.message))})})(Jt):Jt.blob().then(Ir=>f(new Xd(Jt.status,Jt.statusText,x.url,Ir)))).catch(Jt=>{Jt.code!==20&&f(new Error(Jt.message))}),{cancel:()=>{Bt=!0,ot||C.abort()}}}const op=function(x,f){if(/:\/\//.test(x.url)&&!/^https?:|^file:/.test(x.url)){if(bh()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",x,f);if(!bh())return(zd(x.url)||Rd)(x,f)}if(!(/^file:/.test(C=x.url)||/^file:/.test(wd())&&!/^\w+:/.test(C))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Rd(x,f);if(bh()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",x,f,void 0,!0)}var C;return function(N,ot){const Bt=new XMLHttpRequest;Bt.open(N.method||"GET",N.url,!0),N.type!=="arrayBuffer"&&N.type!=="image"||(Bt.responseType="arraybuffer");for(const Jt in N.headers)Bt.setRequestHeader(Jt,N.headers[Jt]);return N.type==="json"&&(Bt.responseType="text",Bt.setRequestHeader("Accept","application/json")),Bt.withCredentials=N.credentials==="include",Bt.onerror=()=>{ot(new Error(Bt.statusText))},Bt.onload=()=>{if((Bt.status>=200&&Bt.status<300||Bt.status===0)&&Bt.response!==null){let Jt=Bt.response;if(N.type==="json")try{Jt=JSON.parse(Bt.response)}catch(Ir){return ot(Ir)}ot(null,Jt,Bt.getResponseHeader("Cache-Control"),Bt.getResponseHeader("Expires"))}else{const Jt=new Blob([Bt.response],{type:Bt.getResponseHeader("Content-Type")});ot(new Xd(Bt.status,Bt.statusText,N.url,Jt))}},Bt.send(N.body),{cancel:()=>Bt.abort()}}(x,f)},Wd=function(x,f){return op(Wr(x,{type:"arrayBuffer"}),f)};function Op(x){if(!x||x.indexOf("://")<=0||x.indexOf("data:image/")===0||x.indexOf("blob:")===0)return!0;const f=new URL(x),C=window.location;return f.protocol===C.protocol&&f.host===C.host}function ep(x,f,C){C[x]&&C[x].indexOf(f)!==-1||(C[x]=C[x]||[],C[x].push(f))}function zp(x,f,C){if(C&&C[x]){const N=C[x].indexOf(f);N!==-1&&C[x].splice(N,1)}}class Kd{constructor(f,C={}){Wr(this,C),this.type=f}}class Ap extends Kd{constructor(f,C={}){super("error",Wr({error:f},C))}}class Ip{on(f,C){return this._listeners=this._listeners||{},ep(f,C,this._listeners),this}off(f,C){return zp(f,C,this._listeners),zp(f,C,this._oneTimeListeners),this}once(f,C){return C?(this._oneTimeListeners=this._oneTimeListeners||{},ep(f,C,this._oneTimeListeners),this):new Promise(N=>this.once(f,N))}fire(f,C){typeof f=="string"&&(f=new Kd(f,C||{}));const N=f.type;if(this.listens(N)){f.target=this;const ot=this._listeners&&this._listeners[N]?this._listeners[N].slice():[];for(const Ir of ot)Ir.call(this,f);const Bt=this._oneTimeListeners&&this._oneTimeListeners[N]?this._oneTimeListeners[N].slice():[];for(const Ir of Bt)zp(N,Ir,this._oneTimeListeners),Ir.call(this,f);const Jt=this._eventedParent;Jt&&(Wr(f,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),Jt.fire(f))}else f instanceof Ap&&console.error(f.error);return this}listens(f){return this._listeners&&this._listeners[f]&&this._listeners[f].length>0||this._oneTimeListeners&&this._oneTimeListeners[f]&&this._oneTimeListeners[f].length>0||this._eventedParent&&this._eventedParent.listens(f)}setEventedParent(f,C){return this._eventedParent=f,this._eventedParentData=C,this}}var Yh={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ad=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function kp(x,f){const C={};for(const N in x)N!=="ref"&&(C[N]=x[N]);return Ad.forEach(N=>{N in f&&(C[N]=f[N])}),C}function up(x,f){if(Array.isArray(x)){if(!Array.isArray(f)||x.length!==f.length)return!1;for(let C=0;C<x.length;C++)if(!up(x[C],f[C]))return!1;return!0}if(typeof x=="object"&&x!==null&&f!==null){if(typeof f!="object"||Object.keys(x).length!==Object.keys(f).length)return!1;for(const C in x)if(!up(x[C],f[C]))return!1;return!0}return x===f}const rp={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function fd(x,f,C){C.push({command:rp.addSource,args:[x,f[x]]})}function Cp(x,f,C){f.push({command:rp.removeSource,args:[x]}),C[x]=!0}function Fp(x,f,C,N){Cp(x,C,N),fd(x,f,C)}function _p(x,f,C){let N;for(N in x[C])if(Object.prototype.hasOwnProperty.call(x[C],N)&&N!=="data"&&!up(x[C][N],f[C][N]))return!1;for(N in f[C])if(Object.prototype.hasOwnProperty.call(f[C],N)&&N!=="data"&&!up(x[C][N],f[C][N]))return!1;return!0}function kd(x,f,C,N,ot,Bt){let Jt;for(Jt in f=f||{},x=x||{})Object.prototype.hasOwnProperty.call(x,Jt)&&(up(x[Jt],f[Jt])||C.push({command:Bt,args:[N,Jt,f[Jt],ot]}));for(Jt in f)Object.prototype.hasOwnProperty.call(f,Jt)&&!Object.prototype.hasOwnProperty.call(x,Jt)&&(up(x[Jt],f[Jt])||C.push({command:Bt,args:[N,Jt,f[Jt],ot]}))}function $f(x){return x.id}function Uf(x,f){return x[f.id]=f,x}class cd{constructor(f,C,N,ot){this.message=(f?`${f}: `:"")+N,ot&&(this.identifier=ot),C!=null&&C.__line__&&(this.line=C.__line__)}}function cp(x,...f){for(const C of f)for(const N in C)x[N]=C[N];return x}class xp extends Error{constructor(f,C){super(C),this.message=C,this.key=f}}class Ep{constructor(f,C=[]){this.parent=f,this.bindings={};for(const[N,ot]of C)this.bindings[N]=ot}concat(f){return new Ep(this,f)}get(f){if(this.bindings[f])return this.bindings[f];if(this.parent)return this.parent.get(f);throw new Error(`${f} not found in scope.`)}has(f){return!!this.bindings[f]||!!this.parent&&this.parent.has(f)}}const Vp={kind:"null"},bd={kind:"number"},Yd={kind:"string"},np={kind:"boolean"},Up={kind:"color"},Qp={kind:"object"},Rp={kind:"value"},ng={kind:"collator"},bg={kind:"formatted"},Ih={kind:"padding"},rh={kind:"resolvedImage"};function sh(x,f){return{kind:"array",itemType:x,N:f}}function oh(x){if(x.kind==="array"){const f=oh(x.itemType);return typeof x.N=="number"?`array<${f}, ${x.N}>`:x.itemType.kind==="value"?"array":`array<${f}>`}return x.kind}const Dh=[Vp,bd,Yd,np,Up,bg,Qp,sh(Rp),Ih,rh];function $h(x,f){if(f.kind==="error")return null;if(x.kind==="array"){if(f.kind==="array"&&(f.N===0&&f.itemType.kind==="value"||!$h(x.itemType,f.itemType))&&(typeof x.N!="number"||x.N===f.N))return null}else{if(x.kind===f.kind)return null;if(x.kind==="value"){for(const C of Dh)if(!$h(C,f))return null}}return`Expected ${oh(x)} but found ${oh(f)} instead.`}function yl(x,f){return f.some(C=>C.kind===x.kind)}function gs(x,f){return f.some(C=>C==="null"?x===null:C==="array"?Array.isArray(x):C==="object"?x&&!Array.isArray(x)&&typeof x=="object":C===typeof x)}function Cr(x,f){return x.kind==="array"&&f.kind==="array"?x.itemType.kind===f.itemType.kind&&typeof x.N=="number":x.kind===f.kind}const fs=.96422,ul=.82521,ih=4/29,ch=6/29,vh=3*ch*ch,Th=ch*ch*ch,Nh=Math.PI/180,Qh=180/Math.PI;function rd(x){return(x%=360)<0&&(x+=360),x}function _d([x,f,C,N]){let ot,Bt;const Jt=Dp((.2225045*(x=ip(x))+.7168786*(f=ip(f))+.0606169*(C=ip(C)))/1);x===f&&f===C?ot=Bt=Jt:(ot=Dp((.4360747*x+.3850649*f+.1430804*C)/fs),Bt=Dp((.0139322*x+.0971045*f+.7141733*C)/ul));const Ir=116*Jt-16;return[Ir<0?0:Ir,500*(ot-Jt),200*(Jt-Bt),N]}function ip(x){return x<=.04045?x/12.92:Math.pow((x+.055)/1.055,2.4)}function Dp(x){return x>Th?Math.pow(x,1/3):x/vh+ih}function qd([x,f,C,N]){let ot=(x+16)/116,Bt=isNaN(f)?ot:ot+f/500,Jt=isNaN(C)?ot:ot-C/200;return ot=1*pp(ot),Bt=fs*pp(Bt),Jt=ul*pp(Jt),[wp(3.1338561*Bt-1.6168667*ot-.4906146*Jt),wp(-.9787684*Bt+1.9161415*ot+.033454*Jt),wp(.0719453*Bt-.2289914*ot+1.4052427*Jt),N]}function wp(x){return(x=x<=.00304?12.92*x:1.055*Math.pow(x,1/2.4)-.055)<0?0:x>1?1:x}function pp(x){return x>ch?x*x*x:vh*(x-ih)}function Wp(x){return parseInt(x.padEnd(2,x),16)/255}function Vf(x,f){return Wf(f?x/100:x,0,1)}function Wf(x,f,C){return Math.min(Math.max(f,x),C)}function dg(x){return!x.some(Number.isNaN)}const Jp={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Yp{constructor(f,C,N,ot=1,Bt=!0){this.r=f,this.g=C,this.b=N,this.a=ot,Bt||(this.r*=ot,this.g*=ot,this.b*=ot,ot||this.overwriteGetter("rgb",[f,C,N,ot]))}static parse(f){if(f instanceof Yp)return f;if(typeof f!="string")return;const C=function(N){if((N=N.toLowerCase())==="transparent")return[0,0,0,0];const ot=Jp[N];if(ot){const[Jt,Ir,wo]=ot;return[Jt/255,Ir/255,wo/255,1]}if(N.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(N)){const Jt=N.length<6?1:2;let Ir=1;return[Wp(N.slice(Ir,Ir+=Jt)),Wp(N.slice(Ir,Ir+=Jt)),Wp(N.slice(Ir,Ir+=Jt)),Wp(N.slice(Ir,Ir+Jt)||"ff")]}if(N.startsWith("rgb")){const Jt=N.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(Jt){const[Ir,wo,ol,hl,vl,ah,uh,ph,Ph,Mh,Xh,Jh]=Jt,qh=[hl||" ",uh||" ",Mh].join("");if(qh==="  "||qh==="  /"||qh===",,"||qh===",,,"){const ld=[ol,ah,Ph].join(""),pd=ld==="%%%"?100:ld===""?255:0;if(pd){const Md=[Wf(+wo/pd,0,1),Wf(+vl/pd,0,1),Wf(+ph/pd,0,1),Xh?Vf(+Xh,Jh):1];if(dg(Md))return Md}}return}}const Bt=N.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(Bt){const[Jt,Ir,wo,ol,hl,vl,ah,uh,ph]=Bt,Ph=[wo||" ",hl||" ",ah].join("");if(Ph==="  "||Ph==="  /"||Ph===",,"||Ph===",,,"){const Mh=[+Ir,Wf(+ol,0,100),Wf(+vl,0,100),uh?Vf(+uh,ph):1];if(dg(Mh))return function([Xh,Jh,qh,ld]){function pd(Md){const Pp=(Md+Xh/30)%12,bp=Jh*Math.min(qh,1-qh);return qh-bp*Math.max(-1,Math.min(Pp-3,9-Pp,1))}return Xh=rd(Xh),Jh/=100,qh/=100,[pd(0),pd(8),pd(4),ld]}(Mh)}}}(f);return C?new Yp(...C,!1):void 0}get rgb(){const{r:f,g:C,b:N,a:ot}=this,Bt=ot||1/0;return this.overwriteGetter("rgb",[f/Bt,C/Bt,N/Bt,ot])}get hcl(){return this.overwriteGetter("hcl",function(f){const[C,N,ot,Bt]=_d(f),Jt=Math.sqrt(N*N+ot*ot);return[Math.round(1e4*Jt)?rd(Math.atan2(ot,N)*Qh):NaN,Jt,C,Bt]}(this.rgb))}get lab(){return this.overwriteGetter("lab",_d(this.rgb))}overwriteGetter(f,C){return Object.defineProperty(this,f,{value:C}),C}toString(){const[f,C,N,ot]=this.rgb;return`rgba(${[f,C,N].map(Bt=>Math.round(255*Bt)).join(",")},${ot})`}}Yp.black=new Yp(0,0,0,1),Yp.white=new Yp(1,1,1,1),Yp.transparent=new Yp(0,0,0,0),Yp.red=new Yp(1,0,0,1);class Cg{constructor(f,C,N){this.sensitivity=f?C?"variant":"case":C?"accent":"base",this.locale=N,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(f,C){return this.collator.compare(f,C)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class o_{constructor(f,C,N,ot,Bt){this.text=f,this.image=C,this.scale=N,this.fontStack=ot,this.textColor=Bt}}class Bg{constructor(f){this.sections=f}static fromString(f){return new Bg([new o_(f,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(f=>f.text.length!==0||f.image&&f.image.name.length!==0)}static factory(f){return f instanceof Bg?f:Bg.fromString(f)}toString(){return this.sections.length===0?"":this.sections.map(f=>f.text).join("")}}class Xg{constructor(f){this.values=f.slice()}static parse(f){if(f instanceof Xg)return f;if(typeof f=="number")return new Xg([f,f,f,f]);if(Array.isArray(f)&&!(f.length<1||f.length>4)){for(const C of f)if(typeof C!="number")return;switch(f.length){case 1:f=[f[0],f[0],f[0],f[0]];break;case 2:f=[f[0],f[1],f[0],f[1]];break;case 3:f=[f[0],f[1],f[2],f[1]]}return new Xg(f)}}toString(){return JSON.stringify(this.values)}}class nm{constructor(f){this.name=f.name,this.available=f.available}toString(){return this.name}static fromString(f){return f?new nm({name:f,available:!1}):null}}function ly(x,f,C,N){return typeof x=="number"&&x>=0&&x<=255&&typeof f=="number"&&f>=0&&f<=255&&typeof C=="number"&&C>=0&&C<=255?N===void 0||typeof N=="number"&&N>=0&&N<=1?null:`Invalid rgba value [${[x,f,C,N].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof N=="number"?[x,f,C,N]:[x,f,C]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function xv(x){if(x===null||typeof x=="string"||typeof x=="boolean"||typeof x=="number"||x instanceof Yp||x instanceof Cg||x instanceof Bg||x instanceof Xg||x instanceof nm)return!0;if(Array.isArray(x)){for(const f of x)if(!xv(f))return!1;return!0}if(typeof x=="object"){for(const f in x)if(!xv(x[f]))return!1;return!0}return!1}function Dg(x){if(x===null)return Vp;if(typeof x=="string")return Yd;if(typeof x=="boolean")return np;if(typeof x=="number")return bd;if(x instanceof Yp)return Up;if(x instanceof Cg)return ng;if(x instanceof Bg)return bg;if(x instanceof Xg)return Ih;if(x instanceof nm)return rh;if(Array.isArray(x)){const f=x.length;let C;for(const N of x){const ot=Dg(N);if(C){if(C===ot)continue;C=Rp;break}C=ot}return sh(C||Rp,f)}return Qp}function s_(x){const f=typeof x;return x===null?"":f==="string"||f==="number"||f==="boolean"?String(x):x instanceof Yp||x instanceof Bg||x instanceof Xg||x instanceof nm?x.toString():JSON.stringify(x)}class f_{constructor(f,C){this.type=f,this.value=C}static parse(f,C){if(f.length!==2)return C.error(`'literal' expression requires exactly one argument, but found ${f.length-1} instead.`);if(!xv(f[1]))return C.error("invalid value");const N=f[1];let ot=Dg(N);const Bt=C.expectedType;return ot.kind!=="array"||ot.N!==0||!Bt||Bt.kind!=="array"||typeof Bt.N=="number"&&Bt.N!==0||(ot=Bt),new f_(ot,N)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class hd{constructor(f){this.name="ExpressionEvaluationError",this.message=f}toJSON(){return this.message}}const g_={string:Yd,number:bd,boolean:np,object:Qp};class xg{constructor(f,C){this.type=f,this.args=C}static parse(f,C){if(f.length<2)return C.error("Expected at least one argument.");let N,ot=1;const Bt=f[0];if(Bt==="array"){let Ir,wo;if(f.length>2){const ol=f[1];if(typeof ol!="string"||!(ol in g_)||ol==="object")return C.error('The item type argument of "array" must be one of string, number, boolean',1);Ir=g_[ol],ot++}else Ir=Rp;if(f.length>3){if(f[2]!==null&&(typeof f[2]!="number"||f[2]<0||f[2]!==Math.floor(f[2])))return C.error('The length argument to "array" must be a positive integer literal',2);wo=f[2],ot++}N=sh(Ir,wo)}else{if(!g_[Bt])throw new Error(`Types doesn't contain name = ${Bt}`);N=g_[Bt]}const Jt=[];for(;ot<f.length;ot++){const Ir=C.parse(f[ot],ot,Rp);if(!Ir)return null;Jt.push(Ir)}return new xg(N,Jt)}evaluate(f){for(let C=0;C<this.args.length;C++){const N=this.args[C].evaluate(f);if(!$h(this.type,Dg(N)))return N;if(C===this.args.length-1)throw new hd(`Expected value to be of type ${oh(this.type)}, but found ${oh(Dg(N))} instead.`)}throw new Error}eachChild(f){this.args.forEach(f)}outputDefined(){return this.args.every(f=>f.outputDefined())}}const hm={"to-boolean":np,"to-color":Up,"to-number":bd,"to-string":Yd};class xm{constructor(f,C){this.type=f,this.args=C}static parse(f,C){if(f.length<2)return C.error("Expected at least one argument.");const N=f[0];if(!hm[N])throw new Error(`Can't parse ${N} as it is not part of the known types`);if((N==="to-boolean"||N==="to-string")&&f.length!==2)return C.error("Expected one argument.");const ot=hm[N],Bt=[];for(let Jt=1;Jt<f.length;Jt++){const Ir=C.parse(f[Jt],Jt,Rp);if(!Ir)return null;Bt.push(Ir)}return new xm(ot,Bt)}evaluate(f){if(this.type.kind==="boolean")return!!this.args[0].evaluate(f);if(this.type.kind==="color"){let C,N;for(const ot of this.args){if(C=ot.evaluate(f),N=null,C instanceof Yp)return C;if(typeof C=="string"){const Bt=f.parseColor(C);if(Bt)return Bt}else if(Array.isArray(C)&&(N=C.length<3||C.length>4?`Invalid rbga value ${JSON.stringify(C)}: expected an array containing either three or four numeric values.`:ly(C[0],C[1],C[2],C[3]),!N))return new Yp(C[0]/255,C[1]/255,C[2]/255,C[3])}throw new hd(N||`Could not parse color from value '${typeof C=="string"?C:JSON.stringify(C)}'`)}if(this.type.kind==="padding"){let C;for(const N of this.args){C=N.evaluate(f);const ot=Xg.parse(C);if(ot)return ot}throw new hd(`Could not parse padding from value '${typeof C=="string"?C:JSON.stringify(C)}'`)}if(this.type.kind==="number"){let C=null;for(const N of this.args){if(C=N.evaluate(f),C===null)return 0;const ot=Number(C);if(!isNaN(ot))return ot}throw new hd(`Could not convert ${JSON.stringify(C)} to number.`)}return this.type.kind==="formatted"?Bg.fromString(s_(this.args[0].evaluate(f))):this.type.kind==="resolvedImage"?nm.fromString(s_(this.args[0].evaluate(f))):s_(this.args[0].evaluate(f))}eachChild(f){this.args.forEach(f)}outputDefined(){return this.args.every(f=>f.outputDefined())}}const m_=["Unknown","Point","LineString","Polygon"];class wv{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?m_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(f){let C=this._parseColorCache[f];return C||(C=this._parseColorCache[f]=Yp.parse(f)),C}}class W_{constructor(f,C,N=[],ot,Bt=new Ep,Jt=[]){this.registry=f,this.path=N,this.key=N.map(Ir=>`[${Ir}]`).join(""),this.scope=Bt,this.errors=Jt,this.expectedType=ot,this._isConstant=C}parse(f,C,N,ot,Bt={}){return C?this.concat(C,N,ot)._parse(f,Bt):this._parse(f,Bt)}_parse(f,C){function N(ot,Bt,Jt){return Jt==="assert"?new xg(Bt,[ot]):Jt==="coerce"?new xm(Bt,[ot]):ot}if(f!==null&&typeof f!="string"&&typeof f!="boolean"&&typeof f!="number"||(f=["literal",f]),Array.isArray(f)){if(f.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const ot=f[0];if(typeof ot!="string")return this.error(`Expression name must be a string, but found ${typeof ot} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const Bt=this.registry[ot];if(Bt){let Jt=Bt.parse(f,this);if(!Jt)return null;if(this.expectedType){const Ir=this.expectedType,wo=Jt.type;if(Ir.kind!=="string"&&Ir.kind!=="number"&&Ir.kind!=="boolean"&&Ir.kind!=="object"&&Ir.kind!=="array"||wo.kind!=="value")if(Ir.kind!=="color"&&Ir.kind!=="formatted"&&Ir.kind!=="resolvedImage"||wo.kind!=="value"&&wo.kind!=="string")if(Ir.kind!=="padding"||wo.kind!=="value"&&wo.kind!=="number"&&wo.kind!=="array"){if(this.checkSubtype(Ir,wo))return null}else Jt=N(Jt,Ir,C.typeAnnotation||"coerce");else Jt=N(Jt,Ir,C.typeAnnotation||"coerce");else Jt=N(Jt,Ir,C.typeAnnotation||"assert")}if(!(Jt instanceof f_)&&Jt.type.kind!=="resolvedImage"&&this._isConstant(Jt)){const Ir=new wv;try{Jt=new f_(Jt.type,Jt.evaluate(Ir))}catch(wo){return this.error(wo.message),null}}return Jt}return this.error(`Unknown expression "${ot}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(f===void 0?"'undefined' value invalid. Use null instead.":typeof f=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof f} instead.`)}concat(f,C,N){const ot=typeof f=="number"?this.path.concat(f):this.path,Bt=N?this.scope.concat(N):this.scope;return new W_(this.registry,this._isConstant,ot,C||null,Bt,this.errors)}error(f,...C){const N=`${this.key}${C.map(ot=>`[${ot}]`).join("")}`;this.errors.push(new xp(N,f))}checkSubtype(f,C){const N=$h(f,C);return N&&this.error(N),N}}class lg{constructor(f,C,N){this.type=ng,this.locale=N,this.caseSensitive=f,this.diacriticSensitive=C}static parse(f,C){if(f.length!==2)return C.error("Expected one argument.");const N=f[1];if(typeof N!="object"||Array.isArray(N))return C.error("Collator options argument must be an object.");const ot=C.parse(N["case-sensitive"]!==void 0&&N["case-sensitive"],1,np);if(!ot)return null;const Bt=C.parse(N["diacritic-sensitive"]!==void 0&&N["diacritic-sensitive"],1,np);if(!Bt)return null;let Jt=null;return N.locale&&(Jt=C.parse(N.locale,1,Yd),!Jt)?null:new lg(ot,Bt,Jt)}evaluate(f){return new Cg(this.caseSensitive.evaluate(f),this.diacriticSensitive.evaluate(f),this.locale?this.locale.evaluate(f):null)}eachChild(f){f(this.caseSensitive),f(this.diacriticSensitive),this.locale&&f(this.locale)}outputDefined(){return!1}}const ap=8192;function qf(x,f){x[0]=Math.min(x[0],f[0]),x[1]=Math.min(x[1],f[1]),x[2]=Math.max(x[2],f[0]),x[3]=Math.max(x[3],f[1])}function jf(x,f){return!(x[0]<=f[0]||x[2]>=f[2]||x[1]<=f[1]||x[3]>=f[3])}function Wm(x,f){const C=(180+x[0])/360,N=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+x[1]*Math.PI/360)))/360,ot=Math.pow(2,f.z);return[Math.round(C*ot*ap),Math.round(N*ot*ap)]}function __(x,f,C){const N=x[0]-f[0],ot=x[1]-f[1],Bt=x[0]-C[0],Jt=x[1]-C[1];return N*Jt-Bt*ot==0&&N*Bt<=0&&ot*Jt<=0}function Kf(x,f){let C=!1;for(let Jt=0,Ir=f.length;Jt<Ir;Jt++){const wo=f[Jt];for(let ol=0,hl=wo.length;ol<hl-1;ol++){if(__(x,wo[ol],wo[ol+1]))return!1;(ot=wo[ol])[1]>(N=x)[1]!=(Bt=wo[ol+1])[1]>N[1]&&N[0]<(Bt[0]-ot[0])*(N[1]-ot[1])/(Bt[1]-ot[1])+ot[0]&&(C=!C)}}var N,ot,Bt;return C}function qm(x,f){for(let C=0;C<f.length;C++)if(Kf(x,f[C]))return!0;return!1}function Ny(x,f,C,N){const ot=N[0]-C[0],Bt=N[1]-C[1],Jt=(x[0]-C[0])*Bt-ot*(x[1]-C[1]),Ir=(f[0]-C[0])*Bt-ot*(f[1]-C[1]);return Jt>0&&Ir<0||Jt<0&&Ir>0}function ky(x,f,C){for(const ol of C)for(let hl=0;hl<ol.length-1;++hl)if((Ir=[(Jt=ol[hl+1])[0]-(Bt=ol[hl])[0],Jt[1]-Bt[1]])[0]*(wo=[(ot=f)[0]-(N=x)[0],ot[1]-N[1]])[1]-Ir[1]*wo[0]!=0&&Ny(N,ot,Bt,Jt)&&Ny(Bt,Jt,N,ot))return!0;var N,ot,Bt,Jt,Ir,wo;return!1}function a_(x,f){for(let C=0;C<x.length;++C)if(!Kf(x[C],f))return!1;for(let C=0;C<x.length-1;++C)if(ky(x[C],x[C+1],f))return!1;return!0}function Lg(x,f){for(let C=0;C<f.length;C++)if(a_(x,f[C]))return!0;return!1}function B0(x,f,C){const N=[];for(let ot=0;ot<x.length;ot++){const Bt=[];for(let Jt=0;Jt<x[ot].length;Jt++){const Ir=Wm(x[ot][Jt],C);qf(f,Ir),Bt.push(Ir)}N.push(Bt)}return N}function E_(x,f,C){const N=[];for(let ot=0;ot<x.length;ot++){const Bt=B0(x[ot],f,C);N.push(Bt)}return N}function By(x,f,C,N){if(x[0]<C[0]||x[0]>C[2]){const ot=.5*N;let Bt=x[0]-C[0]>ot?-N:C[0]-x[0]>ot?N:0;Bt===0&&(Bt=x[0]-C[2]>ot?-N:C[2]-x[0]>ot?N:0),x[0]+=Bt}qf(f,x)}function bv(x,f,C,N){const ot=Math.pow(2,N.z)*ap,Bt=[N.x*ap,N.y*ap],Jt=[];for(const Ir of x)for(const wo of Ir){const ol=[wo.x+Bt[0],wo.y+Bt[1]];By(ol,f,C,ot),Jt.push(ol)}return Jt}function G0(x,f,C,N){const ot=Math.pow(2,N.z)*ap,Bt=[N.x*ap,N.y*ap],Jt=[];for(const wo of x){const ol=[];for(const hl of wo){const vl=[hl.x+Bt[0],hl.y+Bt[1]];qf(f,vl),ol.push(vl)}Jt.push(ol)}if(f[2]-f[0]<=ot/2){(Ir=f)[0]=Ir[1]=1/0,Ir[2]=Ir[3]=-1/0;for(const wo of Jt)for(const ol of wo)By(ol,f,C,ot)}var Ir;return Jt}class O_{constructor(f,C){this.type=np,this.geojson=f,this.geometries=C}static parse(f,C){if(f.length!==2)return C.error(`'within' expression requires exactly one argument, but found ${f.length-1} instead.`);if(xv(f[1])){const N=f[1];if(N.type==="FeatureCollection")for(let ot=0;ot<N.features.length;++ot){const Bt=N.features[ot].geometry.type;if(Bt==="Polygon"||Bt==="MultiPolygon")return new O_(N,N.features[ot].geometry)}else if(N.type==="Feature"){const ot=N.geometry.type;if(ot==="Polygon"||ot==="MultiPolygon")return new O_(N,N.geometry)}else if(N.type==="Polygon"||N.type==="MultiPolygon")return new O_(N,N)}return C.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(f){if(f.geometry()!=null&&f.canonicalID()!=null){if(f.geometryType()==="Point")return function(C,N){const ot=[1/0,1/0,-1/0,-1/0],Bt=[1/0,1/0,-1/0,-1/0],Jt=C.canonicalID();if(N.type==="Polygon"){const Ir=B0(N.coordinates,Bt,Jt),wo=bv(C.geometry(),ot,Bt,Jt);if(!jf(ot,Bt))return!1;for(const ol of wo)if(!Kf(ol,Ir))return!1}if(N.type==="MultiPolygon"){const Ir=E_(N.coordinates,Bt,Jt),wo=bv(C.geometry(),ot,Bt,Jt);if(!jf(ot,Bt))return!1;for(const ol of wo)if(!qm(ol,Ir))return!1}return!0}(f,this.geometries);if(f.geometryType()==="LineString")return function(C,N){const ot=[1/0,1/0,-1/0,-1/0],Bt=[1/0,1/0,-1/0,-1/0],Jt=C.canonicalID();if(N.type==="Polygon"){const Ir=B0(N.coordinates,Bt,Jt),wo=G0(C.geometry(),ot,Bt,Jt);if(!jf(ot,Bt))return!1;for(const ol of wo)if(!a_(ol,Ir))return!1}if(N.type==="MultiPolygon"){const Ir=E_(N.coordinates,Bt,Jt),wo=G0(C.geometry(),ot,Bt,Jt);if(!jf(ot,Bt))return!1;for(const ol of wo)if(!Lg(ol,Ir))return!1}return!0}(f,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class cy{constructor(f,C){this.type=C.type,this.name=f,this.boundExpression=C}static parse(f,C){if(f.length!==2||typeof f[1]!="string")return C.error("'var' expression requires exactly one string literal argument.");const N=f[1];return C.scope.has(N)?new cy(N,C.scope.get(N)):C.error(`Unknown variable "${N}". Make sure "${N}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(f){return this.boundExpression.evaluate(f)}eachChild(){}outputDefined(){return!1}}class Fm{constructor(f,C,N,ot){this.name=f,this.type=C,this._evaluate=N,this.args=ot}evaluate(f){return this._evaluate(f,this.args)}eachChild(f){this.args.forEach(f)}outputDefined(){return!1}static parse(f,C){const N=f[0],ot=Fm.definitions[N];if(!ot)return C.error(`Unknown expression "${N}". If you wanted a literal array, use ["literal", [...]].`,0);const Bt=Array.isArray(ot)?ot[0]:ot.type,Jt=Array.isArray(ot)?[[ot[1],ot[2]]]:ot.overloads,Ir=Jt.filter(([ol])=>!Array.isArray(ol)||ol.length===f.length-1);let wo=null;for(const[ol,hl]of Ir){wo=new W_(C.registry,zy,C.path,null,C.scope);const vl=[];let ah=!1;for(let uh=1;uh<f.length;uh++){const ph=f[uh],Ph=Array.isArray(ol)?ol[uh-1]:ol.type,Mh=wo.parse(ph,1+vl.length,Ph);if(!Mh){ah=!0;break}vl.push(Mh)}if(!ah)if(Array.isArray(ol)&&ol.length!==vl.length)wo.error(`Expected ${ol.length} arguments, but found ${vl.length} instead.`);else{for(let uh=0;uh<vl.length;uh++){const ph=Array.isArray(ol)?ol[uh]:ol.type,Ph=vl[uh];wo.concat(uh+1).checkSubtype(ph,Ph.type)}if(wo.errors.length===0)return new Fm(N,Bt,hl,vl)}}if(Ir.length===1)C.errors.push(...wo.errors);else{const ol=(Ir.length?Ir:Jt).map(([vl])=>{return ah=vl,Array.isArray(ah)?`(${ah.map(oh).join(", ")})`:`(${oh(ah.type)}...)`;var ah}).join(" | "),hl=[];for(let vl=1;vl<f.length;vl++){const ah=C.parse(f[vl],1+hl.length);if(!ah)return null;hl.push(oh(ah.type))}C.error(`Expected arguments of type ${ol}, but found (${hl.join(", ")}) instead.`)}return null}static register(f,C){Fm.definitions=C;for(const N in C)f[N]=Fm}}function zy(x){if(x instanceof cy)return zy(x.boundExpression);if(x instanceof Fm&&x.name==="error"||x instanceof lg||x instanceof O_)return!1;const f=x instanceof xm||x instanceof xg;let C=!0;return x.eachChild(N=>{C=f?C&&zy(N):C&&N instanceof f_}),!!C&&F_(x)&&Gg(x,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function F_(x){if(x instanceof Fm&&(x.name==="get"&&x.args.length===1||x.name==="feature-state"||x.name==="has"&&x.args.length===1||x.name==="properties"||x.name==="geometry-type"||x.name==="id"||/^filter-/.test(x.name))||x instanceof O_)return!1;let f=!0;return x.eachChild(C=>{f&&!F_(C)&&(f=!1)}),f}function dm(x){if(x instanceof Fm&&x.name==="feature-state")return!1;let f=!0;return x.eachChild(C=>{f&&!dm(C)&&(f=!1)}),f}function Gg(x,f){if(x instanceof Fm&&f.indexOf(x.name)>=0)return!1;let C=!0;return x.eachChild(N=>{C&&!Gg(N,f)&&(C=!1)}),C}function Cv(x,f){const C=x.length-1;let N,ot,Bt=0,Jt=C,Ir=0;for(;Bt<=Jt;)if(Ir=Math.floor((Bt+Jt)/2),N=x[Ir],ot=x[Ir+1],N<=f){if(Ir===C||f<ot)return Ir;Bt=Ir+1}else{if(!(N>f))throw new hd("Input is not a number.");Jt=Ir-1}return 0}class uy{constructor(f,C,N){this.type=f,this.input=C,this.labels=[],this.outputs=[];for(const[ot,Bt]of N)this.labels.push(ot),this.outputs.push(Bt)}static parse(f,C){if(f.length-1<4)return C.error(`Expected at least 4 arguments, but found only ${f.length-1}.`);if((f.length-1)%2!=0)return C.error("Expected an even number of arguments.");const N=C.parse(f[1],1,bd);if(!N)return null;const ot=[];let Bt=null;C.expectedType&&C.expectedType.kind!=="value"&&(Bt=C.expectedType);for(let Jt=1;Jt<f.length;Jt+=2){const Ir=Jt===1?-1/0:f[Jt],wo=f[Jt+1],ol=Jt,hl=Jt+1;if(typeof Ir!="number")return C.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ol);if(ot.length&&ot[ot.length-1][0]>=Ir)return C.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',ol);const vl=C.parse(wo,hl,Bt);if(!vl)return null;Bt=Bt||vl.type,ot.push([Ir,vl])}return new uy(Bt,N,ot)}evaluate(f){const C=this.labels,N=this.outputs;if(C.length===1)return N[0].evaluate(f);const ot=this.input.evaluate(f);if(ot<=C[0])return N[0].evaluate(f);const Bt=C.length;return ot>=C[Bt-1]?N[Bt-1].evaluate(f):N[Cv(C,ot)].evaluate(f)}eachChild(f){f(this.input);for(const C of this.outputs)f(C)}outputDefined(){return this.outputs.every(f=>f.outputDefined())}}function pm(x,f,C){return x+C*(f-x)}function Vm(x,f,C){return x.map((N,ot)=>pm(N,f[ot],C))}const Km={number:pm,color:function(x,f,C,N="rgb"){switch(N){case"rgb":{const[ot,Bt,Jt,Ir]=Vm(x.rgb,f.rgb,C);return new Yp(ot,Bt,Jt,Ir,!1)}case"hcl":{const[ot,Bt,Jt,Ir]=x.hcl,[wo,ol,hl,vl]=f.hcl;let ah,uh;if(isNaN(ot)||isNaN(wo))isNaN(ot)?isNaN(wo)?ah=NaN:(ah=wo,Jt!==1&&Jt!==0||(uh=ol)):(ah=ot,hl!==1&&hl!==0||(uh=Bt));else{let Jh=wo-ot;wo>ot&&Jh>180?Jh-=360:wo<ot&&ot-wo>180&&(Jh+=360),ah=ot+C*Jh}const[ph,Ph,Mh,Xh]=function([Jh,qh,ld,pd]){return Jh=isNaN(Jh)?0:Jh*Nh,qd([ld,Math.cos(Jh)*qh,Math.sin(Jh)*qh,pd])}([ah,uh??pm(Bt,ol,C),pm(Jt,hl,C),pm(Ir,vl,C)]);return new Yp(ph,Ph,Mh,Xh,!1)}case"lab":{const[ot,Bt,Jt,Ir]=qd(Vm(x.lab,f.lab,C));return new Yp(ot,Bt,Jt,Ir,!1)}}},array:Vm,padding:function(x,f,C){return new Xg(Vm(x.values,f.values,C))}};class Em{constructor(f,C,N,ot,Bt){this.type=f,this.operator=C,this.interpolation=N,this.input=ot,this.labels=[],this.outputs=[];for(const[Jt,Ir]of Bt)this.labels.push(Jt),this.outputs.push(Ir)}static interpolationFactor(f,C,N,ot){let Bt=0;if(f.name==="exponential")Bt=zg(C,f.base,N,ot);else if(f.name==="linear")Bt=zg(C,1,N,ot);else if(f.name==="cubic-bezier"){const Jt=f.controlPoints;Bt=new Ht(Jt[0],Jt[1],Jt[2],Jt[3]).solve(zg(C,1,N,ot))}return Bt}static parse(f,C){let[N,ot,Bt,...Jt]=f;if(!Array.isArray(ot)||ot.length===0)return C.error("Expected an interpolation type expression.",1);if(ot[0]==="linear")ot={name:"linear"};else if(ot[0]==="exponential"){const ol=ot[1];if(typeof ol!="number")return C.error("Exponential interpolation requires a numeric base.",1,1);ot={name:"exponential",base:ol}}else{if(ot[0]!=="cubic-bezier")return C.error(`Unknown interpolation type ${String(ot[0])}`,1,0);{const ol=ot.slice(1);if(ol.length!==4||ol.some(hl=>typeof hl!="number"||hl<0||hl>1))return C.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);ot={name:"cubic-bezier",controlPoints:ol}}}if(f.length-1<4)return C.error(`Expected at least 4 arguments, but found only ${f.length-1}.`);if((f.length-1)%2!=0)return C.error("Expected an even number of arguments.");if(Bt=C.parse(Bt,2,bd),!Bt)return null;const Ir=[];let wo=null;N==="interpolate-hcl"||N==="interpolate-lab"?wo=Up:C.expectedType&&C.expectedType.kind!=="value"&&(wo=C.expectedType);for(let ol=0;ol<Jt.length;ol+=2){const hl=Jt[ol],vl=Jt[ol+1],ah=ol+3,uh=ol+4;if(typeof hl!="number")return C.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ah);if(Ir.length&&Ir[Ir.length-1][0]>=hl)return C.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ah);const ph=C.parse(vl,uh,wo);if(!ph)return null;wo=wo||ph.type,Ir.push([hl,ph])}return Cr(wo,bd)||Cr(wo,Up)||Cr(wo,Ih)||Cr(wo,sh(bd))?new Em(wo,N,ot,Bt,Ir):C.error(`Type ${oh(wo)} is not interpolatable.`)}evaluate(f){const C=this.labels,N=this.outputs;if(C.length===1)return N[0].evaluate(f);const ot=this.input.evaluate(f);if(ot<=C[0])return N[0].evaluate(f);const Bt=C.length;if(ot>=C[Bt-1])return N[Bt-1].evaluate(f);const Jt=Cv(C,ot),Ir=Em.interpolationFactor(this.interpolation,ot,C[Jt],C[Jt+1]),wo=N[Jt].evaluate(f),ol=N[Jt+1].evaluate(f);switch(this.operator){case"interpolate":return Km[this.type.kind](wo,ol,Ir);case"interpolate-hcl":return Km.color(wo,ol,Ir,"hcl");case"interpolate-lab":return Km.color(wo,ol,Ir,"lab")}}eachChild(f){f(this.input);for(const C of this.outputs)f(C)}outputDefined(){return this.outputs.every(f=>f.outputDefined())}}function zg(x,f,C,N){const ot=N-C,Bt=x-C;return ot===0?0:f===1?Bt/ot:(Math.pow(f,Bt)-1)/(Math.pow(f,ot)-1)}class hy{constructor(f,C){this.type=f,this.args=C}static parse(f,C){if(f.length<2)return C.error("Expectected at least one argument.");let N=null;const ot=C.expectedType;ot&&ot.kind!=="value"&&(N=ot);const Bt=[];for(const Ir of f.slice(1)){const wo=C.parse(Ir,1+Bt.length,N,void 0,{typeAnnotation:"omit"});if(!wo)return null;N=N||wo.type,Bt.push(wo)}if(!N)throw new Error("No output type");const Jt=ot&&Bt.some(Ir=>$h(ot,Ir.type));return new hy(Jt?Rp:N,Bt)}evaluate(f){let C,N=null,ot=0;for(const Bt of this.args)if(ot++,N=Bt.evaluate(f),N&&N instanceof nm&&!N.available&&(C||(C=N.name),N=null,ot===this.args.length&&(N=C)),N!==null)break;return N}eachChild(f){this.args.forEach(f)}outputDefined(){return this.args.every(f=>f.outputDefined())}}class Ev{constructor(f,C){this.type=C.type,this.bindings=[].concat(f),this.result=C}evaluate(f){return this.result.evaluate(f)}eachChild(f){for(const C of this.bindings)f(C[1]);f(this.result)}static parse(f,C){if(f.length<4)return C.error(`Expected at least 3 arguments, but found ${f.length-1} instead.`);const N=[];for(let Bt=1;Bt<f.length-1;Bt+=2){const Jt=f[Bt];if(typeof Jt!="string")return C.error(`Expected string, but found ${typeof Jt} instead.`,Bt);if(/[^a-zA-Z0-9_]/.test(Jt))return C.error("Variable names must contain only alphanumeric characters or '_'.",Bt);const Ir=C.parse(f[Bt+1],Bt+1);if(!Ir)return null;N.push([Jt,Ir])}const ot=C.parse(f[f.length-1],f.length-1,C.expectedType,N);return ot?new Ev(N,ot):null}outputDefined(){return this.result.outputDefined()}}class q_{constructor(f,C,N){this.type=f,this.index=C,this.input=N}static parse(f,C){if(f.length!==3)return C.error(`Expected 2 arguments, but found ${f.length-1} instead.`);const N=C.parse(f[1],1,bd),ot=C.parse(f[2],2,sh(C.expectedType||Rp));return N&&ot?new q_(ot.type.itemType,N,ot):null}evaluate(f){const C=this.index.evaluate(f),N=this.input.evaluate(f);if(C<0)throw new hd(`Array index out of bounds: ${C} < 0.`);if(C>=N.length)throw new hd(`Array index out of bounds: ${C} > ${N.length-1}.`);if(C!==Math.floor(C))throw new hd(`Array index must be an integer, but found ${C} instead.`);return N[C]}eachChild(f){f(this.index),f(this.input)}outputDefined(){return!1}}class em{constructor(f,C){this.type=np,this.needle=f,this.haystack=C}static parse(f,C){if(f.length!==3)return C.error(`Expected 2 arguments, but found ${f.length-1} instead.`);const N=C.parse(f[1],1,Rp),ot=C.parse(f[2],2,Rp);return N&&ot?yl(N.type,[np,Yd,bd,Vp,Rp])?new em(N,ot):C.error(`Expected first argument to be of type boolean, string, number or null, but found ${oh(N.type)} instead`):null}evaluate(f){const C=this.needle.evaluate(f),N=this.haystack.evaluate(f);if(!N)return!1;if(!gs(C,["boolean","string","number","null"]))throw new hd(`Expected first argument to be of type boolean, string, number or null, but found ${oh(Dg(C))} instead.`);if(!gs(N,["string","array"]))throw new hd(`Expected second argument to be of type array or string, but found ${oh(Dg(N))} instead.`);return N.indexOf(C)>=0}eachChild(f){f(this.needle),f(this.haystack)}outputDefined(){return!0}}class K_{constructor(f,C,N){this.type=bd,this.needle=f,this.haystack=C,this.fromIndex=N}static parse(f,C){if(f.length<=2||f.length>=5)return C.error(`Expected 3 or 4 arguments, but found ${f.length-1} instead.`);const N=C.parse(f[1],1,Rp),ot=C.parse(f[2],2,Rp);if(!N||!ot)return null;if(!yl(N.type,[np,Yd,bd,Vp,Rp]))return C.error(`Expected first argument to be of type boolean, string, number or null, but found ${oh(N.type)} instead`);if(f.length===4){const Bt=C.parse(f[3],3,bd);return Bt?new K_(N,ot,Bt):null}return new K_(N,ot)}evaluate(f){const C=this.needle.evaluate(f),N=this.haystack.evaluate(f);if(!gs(C,["boolean","string","number","null"]))throw new hd(`Expected first argument to be of type boolean, string, number or null, but found ${oh(Dg(C))} instead.`);if(!gs(N,["string","array"]))throw new hd(`Expected second argument to be of type array or string, but found ${oh(Dg(N))} instead.`);if(this.fromIndex){const ot=this.fromIndex.evaluate(f);return N.indexOf(C,ot)}return N.indexOf(C)}eachChild(f){f(this.needle),f(this.haystack),this.fromIndex&&f(this.fromIndex)}outputDefined(){return!1}}class cg{constructor(f,C,N,ot,Bt,Jt){this.inputType=f,this.type=C,this.input=N,this.cases=ot,this.outputs=Bt,this.otherwise=Jt}static parse(f,C){if(f.length<5)return C.error(`Expected at least 4 arguments, but found only ${f.length-1}.`);if(f.length%2!=1)return C.error("Expected an even number of arguments.");let N,ot;C.expectedType&&C.expectedType.kind!=="value"&&(ot=C.expectedType);const Bt={},Jt=[];for(let ol=2;ol<f.length-1;ol+=2){let hl=f[ol];const vl=f[ol+1];Array.isArray(hl)||(hl=[hl]);const ah=C.concat(ol);if(hl.length===0)return ah.error("Expected at least one branch label.");for(const ph of hl){if(typeof ph!="number"&&typeof ph!="string")return ah.error("Branch labels must be numbers or strings.");if(typeof ph=="number"&&Math.abs(ph)>Number.MAX_SAFE_INTEGER)return ah.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ph=="number"&&Math.floor(ph)!==ph)return ah.error("Numeric branch labels must be integer values.");if(N){if(ah.checkSubtype(N,Dg(ph)))return null}else N=Dg(ph);if(Bt[String(ph)]!==void 0)return ah.error("Branch labels must be unique.");Bt[String(ph)]=Jt.length}const uh=C.parse(vl,ol,ot);if(!uh)return null;ot=ot||uh.type,Jt.push(uh)}const Ir=C.parse(f[1],1,Rp);if(!Ir)return null;const wo=C.parse(f[f.length-1],f.length-1,ot);return wo?Ir.type.kind!=="value"&&C.concat(1).checkSubtype(N,Ir.type)?null:new cg(N,ot,Ir,Bt,Jt,wo):null}evaluate(f){const C=this.input.evaluate(f);return(Dg(C)===this.inputType&&this.outputs[this.cases[C]]||this.otherwise).evaluate(f)}eachChild(f){f(this.input),this.outputs.forEach(f),f(this.otherwise)}outputDefined(){return this.outputs.every(f=>f.outputDefined())&&this.otherwise.outputDefined()}}class S_{constructor(f,C,N){this.type=f,this.branches=C,this.otherwise=N}static parse(f,C){if(f.length<4)return C.error(`Expected at least 3 arguments, but found only ${f.length-1}.`);if(f.length%2!=0)return C.error("Expected an odd number of arguments.");let N;C.expectedType&&C.expectedType.kind!=="value"&&(N=C.expectedType);const ot=[];for(let Jt=1;Jt<f.length-1;Jt+=2){const Ir=C.parse(f[Jt],Jt,np);if(!Ir)return null;const wo=C.parse(f[Jt+1],Jt+1,N);if(!wo)return null;ot.push([Ir,wo]),N=N||wo.type}const Bt=C.parse(f[f.length-1],f.length-1,N);if(!Bt)return null;if(!N)throw new Error("Can't infer output type");return new S_(N,ot,Bt)}evaluate(f){for(const[C,N]of this.branches)if(C.evaluate(f))return N.evaluate(f);return this.otherwise.evaluate(f)}eachChild(f){for(const[C,N]of this.branches)f(C),f(N);f(this.otherwise)}outputDefined(){return this.branches.every(([f,C])=>C.outputDefined())&&this.otherwise.outputDefined()}}class T_{constructor(f,C,N,ot){this.type=f,this.input=C,this.beginIndex=N,this.endIndex=ot}static parse(f,C){if(f.length<=2||f.length>=5)return C.error(`Expected 3 or 4 arguments, but found ${f.length-1} instead.`);const N=C.parse(f[1],1,Rp),ot=C.parse(f[2],2,bd);if(!N||!ot)return null;if(!yl(N.type,[sh(Rp),Yd,Rp]))return C.error(`Expected first argument to be of type array or string, but found ${oh(N.type)} instead`);if(f.length===4){const Bt=C.parse(f[3],3,bd);return Bt?new T_(N.type,N,ot,Bt):null}return new T_(N.type,N,ot)}evaluate(f){const C=this.input.evaluate(f),N=this.beginIndex.evaluate(f);if(!gs(C,["string","array"]))throw new hd(`Expected first argument to be of type array or string, but found ${oh(Dg(C))} instead.`);if(this.endIndex){const ot=this.endIndex.evaluate(f);return C.slice(N,ot)}return C.slice(N)}eachChild(f){f(this.input),f(this.beginIndex),this.endIndex&&f(this.endIndex)}outputDefined(){return!1}}function a0(x,f){return x==="=="||x==="!="?f.kind==="boolean"||f.kind==="string"||f.kind==="number"||f.kind==="null"||f.kind==="value":f.kind==="string"||f.kind==="number"||f.kind==="value"}function zx(x,f,C,N){return N.compare(f,C)===0}function dy(x,f,C){const N=x!=="=="&&x!=="!=";return class YS{constructor(Bt,Jt,Ir){this.type=np,this.lhs=Bt,this.rhs=Jt,this.collator=Ir,this.hasUntypedArgument=Bt.type.kind==="value"||Jt.type.kind==="value"}static parse(Bt,Jt){if(Bt.length!==3&&Bt.length!==4)return Jt.error("Expected two or three arguments.");const Ir=Bt[0];let wo=Jt.parse(Bt[1],1,Rp);if(!wo)return null;if(!a0(Ir,wo.type))return Jt.concat(1).error(`"${Ir}" comparisons are not supported for type '${oh(wo.type)}'.`);let ol=Jt.parse(Bt[2],2,Rp);if(!ol)return null;if(!a0(Ir,ol.type))return Jt.concat(2).error(`"${Ir}" comparisons are not supported for type '${oh(ol.type)}'.`);if(wo.type.kind!==ol.type.kind&&wo.type.kind!=="value"&&ol.type.kind!=="value")return Jt.error(`Cannot compare types '${oh(wo.type)}' and '${oh(ol.type)}'.`);N&&(wo.type.kind==="value"&&ol.type.kind!=="value"?wo=new xg(ol.type,[wo]):wo.type.kind!=="value"&&ol.type.kind==="value"&&(ol=new xg(wo.type,[ol])));let hl=null;if(Bt.length===4){if(wo.type.kind!=="string"&&ol.type.kind!=="string"&&wo.type.kind!=="value"&&ol.type.kind!=="value")return Jt.error("Cannot use collator to compare non-string types.");if(hl=Jt.parse(Bt[3],3,ng),!hl)return null}return new YS(wo,ol,hl)}evaluate(Bt){const Jt=this.lhs.evaluate(Bt),Ir=this.rhs.evaluate(Bt);if(N&&this.hasUntypedArgument){const wo=Dg(Jt),ol=Dg(Ir);if(wo.kind!==ol.kind||wo.kind!=="string"&&wo.kind!=="number")throw new hd(`Expected arguments for "${x}" to be (string, string) or (number, number), but found (${wo.kind}, ${ol.kind}) instead.`)}if(this.collator&&!N&&this.hasUntypedArgument){const wo=Dg(Jt),ol=Dg(Ir);if(wo.kind!=="string"||ol.kind!=="string")return f(Bt,Jt,Ir)}return this.collator?C(Bt,Jt,Ir,this.collator.evaluate(Bt)):f(Bt,Jt,Ir)}eachChild(Bt){Bt(this.lhs),Bt(this.rhs),this.collator&&Bt(this.collator)}outputDefined(){return!0}}}const Sv=dy("==",function(x,f,C){return f===C},zx),N_=dy("!=",function(x,f,C){return f!==C},function(x,f,C,N){return!zx(0,f,C,N)}),xx=dy("<",function(x,f,C){return f<C},function(x,f,C,N){return N.compare(f,C)<0}),Vy=dy(">",function(x,f,C){return f>C},function(x,f,C,N){return N.compare(f,C)>0}),Z_=dy("<=",function(x,f,C){return f<=C},function(x,f,C,N){return N.compare(f,C)<=0}),l0=dy(">=",function(x,f,C){return f>=C},function(x,f,C,N){return N.compare(f,C)>=0});class A_{constructor(f,C,N,ot,Bt){this.type=Yd,this.number=f,this.locale=C,this.currency=N,this.minFractionDigits=ot,this.maxFractionDigits=Bt}static parse(f,C){if(f.length!==3)return C.error("Expected two arguments.");const N=C.parse(f[1],1,bd);if(!N)return null;const ot=f[2];if(typeof ot!="object"||Array.isArray(ot))return C.error("NumberFormat options argument must be an object.");let Bt=null;if(ot.locale&&(Bt=C.parse(ot.locale,1,Yd),!Bt))return null;let Jt=null;if(ot.currency&&(Jt=C.parse(ot.currency,1,Yd),!Jt))return null;let Ir=null;if(ot["min-fraction-digits"]&&(Ir=C.parse(ot["min-fraction-digits"],1,bd),!Ir))return null;let wo=null;return ot["max-fraction-digits"]&&(wo=C.parse(ot["max-fraction-digits"],1,bd),!wo)?null:new A_(N,Bt,Jt,Ir,wo)}evaluate(f){return new Intl.NumberFormat(this.locale?this.locale.evaluate(f):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(f):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(f):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(f):void 0}).format(this.number.evaluate(f))}eachChild(f){f(this.number),this.locale&&f(this.locale),this.currency&&f(this.currency),this.minFractionDigits&&f(this.minFractionDigits),this.maxFractionDigits&&f(this.maxFractionDigits)}outputDefined(){return!1}}class Uy{constructor(f){this.type=bg,this.sections=f}static parse(f,C){if(f.length<2)return C.error("Expected at least one argument.");const N=f[1];if(!Array.isArray(N)&&typeof N=="object")return C.error("First argument must be an image or text section.");const ot=[];let Bt=!1;for(let Jt=1;Jt<=f.length-1;++Jt){const Ir=f[Jt];if(Bt&&typeof Ir=="object"&&!Array.isArray(Ir)){Bt=!1;let wo=null;if(Ir["font-scale"]&&(wo=C.parse(Ir["font-scale"],1,bd),!wo))return null;let ol=null;if(Ir["text-font"]&&(ol=C.parse(Ir["text-font"],1,sh(Yd)),!ol))return null;let hl=null;if(Ir["text-color"]&&(hl=C.parse(Ir["text-color"],1,Up),!hl))return null;const vl=ot[ot.length-1];vl.scale=wo,vl.font=ol,vl.textColor=hl}else{const wo=C.parse(f[Jt],1,Rp);if(!wo)return null;const ol=wo.type.kind;if(ol!=="string"&&ol!=="value"&&ol!=="null"&&ol!=="resolvedImage")return C.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");Bt=!0,ot.push({content:wo,scale:null,font:null,textColor:null})}}return new Uy(ot)}evaluate(f){return new Bg(this.sections.map(C=>{const N=C.content.evaluate(f);return Dg(N)===rh?new o_("",N,null,null,null):new o_(s_(N),null,C.scale?C.scale.evaluate(f):null,C.font?C.font.evaluate(f).join(","):null,C.textColor?C.textColor.evaluate(f):null)}))}eachChild(f){for(const C of this.sections)f(C.content),C.scale&&f(C.scale),C.font&&f(C.font),C.textColor&&f(C.textColor)}outputDefined(){return!1}}class py{constructor(f){this.type=rh,this.input=f}static parse(f,C){if(f.length!==2)return C.error("Expected two arguments.");const N=C.parse(f[1],1,Yd);return N?new py(N):C.error("No image name provided.")}evaluate(f){const C=this.input.evaluate(f),N=nm.fromString(C);return N&&f.availableImages&&(N.available=f.availableImages.indexOf(C)>-1),N}eachChild(f){f(this.input)}outputDefined(){return!1}}class $y{constructor(f){this.type=bd,this.input=f}static parse(f,C){if(f.length!==2)return C.error(`Expected 1 argument, but found ${f.length-1} instead.`);const N=C.parse(f[1],1);return N?N.type.kind!=="array"&&N.type.kind!=="string"&&N.type.kind!=="value"?C.error(`Expected argument of type string or array, but found ${oh(N.type)} instead.`):new $y(N):null}evaluate(f){const C=this.input.evaluate(f);if(typeof C=="string"||Array.isArray(C))return C.length;throw new hd(`Expected value to be of type string or array, but found ${oh(Dg(C))} instead.`)}eachChild(f){f(this.input)}outputDefined(){return!1}}const Hy={"==":Sv,"!=":N_,">":Vy,"<":xx,">=":l0,"<=":Z_,array:xg,at:q_,boolean:xg,case:S_,coalesce:hy,collator:lg,format:Uy,image:py,in:em,"index-of":K_,interpolate:Em,"interpolate-hcl":Em,"interpolate-lab":Em,length:$y,let:Ev,literal:f_,match:cg,number:xg,"number-format":A_,object:xg,slice:T_,step:uy,string:xg,"to-boolean":xm,"to-color":xm,"to-number":xm,"to-string":xm,var:cy,within:O_};function c0(x,[f,C,N,ot]){f=f.evaluate(x),C=C.evaluate(x),N=N.evaluate(x);const Bt=ot?ot.evaluate(x):1,Jt=ly(f,C,N,Bt);if(Jt)throw new hd(Jt);return new Yp(f/255,C/255,N/255,Bt,!1)}function z0(x,f){return x in f}function u0(x,f){const C=f[x];return C===void 0?null:C}function y_(x){return{type:x}}function hg(x){return{result:"success",value:x}}function Tv(x){return{result:"error",value:x}}function fy(x){return x["property-type"]==="data-driven"||x["property-type"]==="cross-faded-data-driven"}function wx(x){return!!x.expression&&x.expression.parameters.indexOf("zoom")>-1}function h0(x){return!!x.expression&&x.expression.interpolated}function _g(x){return x instanceof Number?"number":x instanceof String?"string":x instanceof Boolean?"boolean":Array.isArray(x)?"array":x===null?"null":typeof x}function Av(x){return typeof x=="object"&&x!==null&&!Array.isArray(x)}function Rv(x){return x}function d0(x,f){const C=f.type==="color",N=x.stops&&typeof x.stops[0][0]=="object",ot=N||!(N||x.property!==void 0),Bt=x.type||(h0(f)?"exponential":"interval");if(C||f.type==="padding"){const hl=C?Yp.parse:Xg.parse;(x=cp({},x)).stops&&(x.stops=x.stops.map(vl=>[vl[0],hl(vl[1])])),x.default=hl(x.default?x.default:f.default)}if(x.colorSpace&&(Jt=x.colorSpace)!=="rgb"&&Jt!=="hcl"&&Jt!=="lab")throw new Error(`Unknown color space: "${x.colorSpace}"`);var Jt;let Ir,wo,ol;if(Bt==="exponential")Ir=p0;else if(Bt==="interval")Ir=Y_;else if(Bt==="categorical"){Ir=X_,wo=Object.create(null);for(const hl of x.stops)wo[hl[0]]=hl[1];ol=typeof x.stops[0][0]}else{if(Bt!=="identity")throw new Error(`Unknown function type "${Bt}"`);Ir=Vx}if(N){const hl={},vl=[];for(let ph=0;ph<x.stops.length;ph++){const Ph=x.stops[ph],Mh=Ph[0].zoom;hl[Mh]===void 0&&(hl[Mh]={zoom:Mh,type:x.type,property:x.property,default:x.default,stops:[]},vl.push(Mh)),hl[Mh].stops.push([Ph[0].value,Ph[1]])}const ah=[];for(const ph of vl)ah.push([hl[ph].zoom,d0(hl[ph],f)]);const uh={name:"linear"};return{kind:"composite",interpolationType:uh,interpolationFactor:Em.interpolationFactor.bind(void 0,uh),zoomStops:ah.map(ph=>ph[0]),evaluate:({zoom:ph},Ph)=>p0({stops:ah,base:x.base},f,ph).evaluate(ph,Ph)}}if(ot){const hl=Bt==="exponential"?{name:"exponential",base:x.base!==void 0?x.base:1}:null;return{kind:"camera",interpolationType:hl,interpolationFactor:Em.interpolationFactor.bind(void 0,hl),zoomStops:x.stops.map(vl=>vl[0]),evaluate:({zoom:vl})=>Ir(x,f,vl,wo,ol)}}return{kind:"source",evaluate(hl,vl){const ah=vl&&vl.properties?vl.properties[x.property]:void 0;return ah===void 0?k_(x.default,f.default):Ir(x,f,ah,wo,ol)}}}function k_(x,f,C){return x!==void 0?x:f!==void 0?f:C!==void 0?C:void 0}function X_(x,f,C,N,ot){return k_(typeof C===ot?N[C]:void 0,x.default,f.default)}function Y_(x,f,C){if(_g(C)!=="number")return k_(x.default,f.default);const N=x.stops.length;if(N===1||C<=x.stops[0][0])return x.stops[0][1];if(C>=x.stops[N-1][0])return x.stops[N-1][1];const ot=Cv(x.stops.map(Bt=>Bt[0]),C);return x.stops[ot][1]}function p0(x,f,C){const N=x.base!==void 0?x.base:1;if(_g(C)!=="number")return k_(x.default,f.default);const ot=x.stops.length;if(ot===1||C<=x.stops[0][0])return x.stops[0][1];if(C>=x.stops[ot-1][0])return x.stops[ot-1][1];const Bt=Cv(x.stops.map(hl=>hl[0]),C),Jt=function(hl,vl,ah,uh){const ph=uh-ah,Ph=hl-ah;return ph===0?0:vl===1?Ph/ph:(Math.pow(vl,Ph)-1)/(Math.pow(vl,ph)-1)}(C,N,x.stops[Bt][0],x.stops[Bt+1][0]),Ir=x.stops[Bt][1],wo=x.stops[Bt+1][1],ol=Km[f.type]||Rv;return typeof Ir.evaluate=="function"?{evaluate(...hl){const vl=Ir.evaluate.apply(void 0,hl),ah=wo.evaluate.apply(void 0,hl);if(vl!==void 0&&ah!==void 0)return ol(vl,ah,Jt,x.colorSpace)}}:ol(Ir,wo,Jt,x.colorSpace)}function Vx(x,f,C){switch(f.type){case"color":C=Yp.parse(C);break;case"formatted":C=Bg.fromString(C.toString());break;case"resolvedImage":C=nm.fromString(C.toString());break;case"padding":C=Xg.parse(C);break;default:_g(C)===f.type||f.type==="enum"&&f.values[C]||(C=void 0)}return k_(C,x.default,f.default)}Fm.register(Hy,{error:[{kind:"error"},[Yd],(x,[f])=>{throw new hd(f.evaluate(x))}],typeof:[Yd,[Rp],(x,[f])=>oh(Dg(f.evaluate(x)))],"to-rgba":[sh(bd,4),[Up],(x,[f])=>{const[C,N,ot,Bt]=f.evaluate(x).rgb;return[255*C,255*N,255*ot,Bt]}],rgb:[Up,[bd,bd,bd],c0],rgba:[Up,[bd,bd,bd,bd],c0],has:{type:np,overloads:[[[Yd],(x,[f])=>z0(f.evaluate(x),x.properties())],[[Yd,Qp],(x,[f,C])=>z0(f.evaluate(x),C.evaluate(x))]]},get:{type:Rp,overloads:[[[Yd],(x,[f])=>u0(f.evaluate(x),x.properties())],[[Yd,Qp],(x,[f,C])=>u0(f.evaluate(x),C.evaluate(x))]]},"feature-state":[Rp,[Yd],(x,[f])=>u0(f.evaluate(x),x.featureState||{})],properties:[Qp,[],x=>x.properties()],"geometry-type":[Yd,[],x=>x.geometryType()],id:[Rp,[],x=>x.id()],zoom:[bd,[],x=>x.globals.zoom],"heatmap-density":[bd,[],x=>x.globals.heatmapDensity||0],"line-progress":[bd,[],x=>x.globals.lineProgress||0],accumulated:[Rp,[],x=>x.globals.accumulated===void 0?null:x.globals.accumulated],"+":[bd,y_(bd),(x,f)=>{let C=0;for(const N of f)C+=N.evaluate(x);return C}],"*":[bd,y_(bd),(x,f)=>{let C=1;for(const N of f)C*=N.evaluate(x);return C}],"-":{type:bd,overloads:[[[bd,bd],(x,[f,C])=>f.evaluate(x)-C.evaluate(x)],[[bd],(x,[f])=>-f.evaluate(x)]]},"/":[bd,[bd,bd],(x,[f,C])=>f.evaluate(x)/C.evaluate(x)],"%":[bd,[bd,bd],(x,[f,C])=>f.evaluate(x)%C.evaluate(x)],ln2:[bd,[],()=>Math.LN2],pi:[bd,[],()=>Math.PI],e:[bd,[],()=>Math.E],"^":[bd,[bd,bd],(x,[f,C])=>Math.pow(f.evaluate(x),C.evaluate(x))],sqrt:[bd,[bd],(x,[f])=>Math.sqrt(f.evaluate(x))],log10:[bd,[bd],(x,[f])=>Math.log(f.evaluate(x))/Math.LN10],ln:[bd,[bd],(x,[f])=>Math.log(f.evaluate(x))],log2:[bd,[bd],(x,[f])=>Math.log(f.evaluate(x))/Math.LN2],sin:[bd,[bd],(x,[f])=>Math.sin(f.evaluate(x))],cos:[bd,[bd],(x,[f])=>Math.cos(f.evaluate(x))],tan:[bd,[bd],(x,[f])=>Math.tan(f.evaluate(x))],asin:[bd,[bd],(x,[f])=>Math.asin(f.evaluate(x))],acos:[bd,[bd],(x,[f])=>Math.acos(f.evaluate(x))],atan:[bd,[bd],(x,[f])=>Math.atan(f.evaluate(x))],min:[bd,y_(bd),(x,f)=>Math.min(...f.map(C=>C.evaluate(x)))],max:[bd,y_(bd),(x,f)=>Math.max(...f.map(C=>C.evaluate(x)))],abs:[bd,[bd],(x,[f])=>Math.abs(f.evaluate(x))],round:[bd,[bd],(x,[f])=>{const C=f.evaluate(x);return C<0?-Math.round(-C):Math.round(C)}],floor:[bd,[bd],(x,[f])=>Math.floor(f.evaluate(x))],ceil:[bd,[bd],(x,[f])=>Math.ceil(f.evaluate(x))],"filter-==":[np,[Yd,Rp],(x,[f,C])=>x.properties()[f.value]===C.value],"filter-id-==":[np,[Rp],(x,[f])=>x.id()===f.value],"filter-type-==":[np,[Yd],(x,[f])=>x.geometryType()===f.value],"filter-<":[np,[Yd,Rp],(x,[f,C])=>{const N=x.properties()[f.value],ot=C.value;return typeof N==typeof ot&&N<ot}],"filter-id-<":[np,[Rp],(x,[f])=>{const C=x.id(),N=f.value;return typeof C==typeof N&&C<N}],"filter->":[np,[Yd,Rp],(x,[f,C])=>{const N=x.properties()[f.value],ot=C.value;return typeof N==typeof ot&&N>ot}],"filter-id->":[np,[Rp],(x,[f])=>{const C=x.id(),N=f.value;return typeof C==typeof N&&C>N}],"filter-<=":[np,[Yd,Rp],(x,[f,C])=>{const N=x.properties()[f.value],ot=C.value;return typeof N==typeof ot&&N<=ot}],"filter-id-<=":[np,[Rp],(x,[f])=>{const C=x.id(),N=f.value;return typeof C==typeof N&&C<=N}],"filter->=":[np,[Yd,Rp],(x,[f,C])=>{const N=x.properties()[f.value],ot=C.value;return typeof N==typeof ot&&N>=ot}],"filter-id->=":[np,[Rp],(x,[f])=>{const C=x.id(),N=f.value;return typeof C==typeof N&&C>=N}],"filter-has":[np,[Rp],(x,[f])=>f.value in x.properties()],"filter-has-id":[np,[],x=>x.id()!==null&&x.id()!==void 0],"filter-type-in":[np,[sh(Yd)],(x,[f])=>f.value.indexOf(x.geometryType())>=0],"filter-id-in":[np,[sh(Rp)],(x,[f])=>f.value.indexOf(x.id())>=0],"filter-in-small":[np,[Yd,sh(Rp)],(x,[f,C])=>C.value.indexOf(x.properties()[f.value])>=0],"filter-in-large":[np,[Yd,sh(Rp)],(x,[f,C])=>function(N,ot,Bt,Jt){for(;Bt<=Jt;){const Ir=Bt+Jt>>1;if(ot[Ir]===N)return!0;ot[Ir]>N?Jt=Ir-1:Bt=Ir+1}return!1}(x.properties()[f.value],C.value,0,C.value.length-1)],all:{type:np,overloads:[[[np,np],(x,[f,C])=>f.evaluate(x)&&C.evaluate(x)],[y_(np),(x,f)=>{for(const C of f)if(!C.evaluate(x))return!1;return!0}]]},any:{type:np,overloads:[[[np,np],(x,[f,C])=>f.evaluate(x)||C.evaluate(x)],[y_(np),(x,f)=>{for(const C of f)if(C.evaluate(x))return!0;return!1}]]},"!":[np,[np],(x,[f])=>!f.evaluate(x)],"is-supported-script":[np,[Yd],(x,[f])=>{const C=x.globals&&x.globals.isSupportedScript;return!C||C(f.evaluate(x))}],upcase:[Yd,[Yd],(x,[f])=>f.evaluate(x).toUpperCase()],downcase:[Yd,[Yd],(x,[f])=>f.evaluate(x).toLowerCase()],concat:[Yd,y_(Rp),(x,f)=>f.map(C=>s_(C.evaluate(x))).join("")],"resolved-locale":[Yd,[ng],(x,[f])=>f.evaluate(x).resolvedLocale()]});class jy{constructor(f,C){var N;this.expression=f,this._warningHistory={},this._evaluator=new wv,this._defaultValue=C?(N=C).type==="color"&&Av(N.default)?new Yp(0,0,0,0):N.type==="color"?Yp.parse(N.default)||null:N.type==="padding"?Xg.parse(N.default)||null:N.default===void 0?null:N.default:null,this._enumValues=C&&C.type==="enum"?C.values:null}evaluateWithoutErrorHandling(f,C,N,ot,Bt,Jt){return this._evaluator.globals=f,this._evaluator.feature=C,this._evaluator.featureState=N,this._evaluator.canonical=ot,this._evaluator.availableImages=Bt||null,this._evaluator.formattedSection=Jt,this.expression.evaluate(this._evaluator)}evaluate(f,C,N,ot,Bt,Jt){this._evaluator.globals=f,this._evaluator.feature=C||null,this._evaluator.featureState=N||null,this._evaluator.canonical=ot,this._evaluator.availableImages=Bt||null,this._evaluator.formattedSection=Jt||null;try{const Ir=this.expression.evaluate(this._evaluator);if(Ir==null||typeof Ir=="number"&&Ir!=Ir)return this._defaultValue;if(this._enumValues&&!(Ir in this._enumValues))throw new hd(`Expected value to be one of ${Object.keys(this._enumValues).map(wo=>JSON.stringify(wo)).join(", ")}, but found ${JSON.stringify(Ir)} instead.`);return Ir}catch(Ir){return this._warningHistory[Ir.message]||(this._warningHistory[Ir.message]=!0,typeof console<"u"&&console.warn(Ir.message)),this._defaultValue}}}function Iv(x){return Array.isArray(x)&&x.length>0&&typeof x[0]=="string"&&x[0]in Hy}function Og(x,f){const C=new W_(Hy,zy,[],f?function(ot){const Bt={color:Up,string:Yd,number:bd,enum:Yd,boolean:np,formatted:bg,padding:Ih,resolvedImage:rh};return ot.type==="array"?sh(Bt[ot.value]||Rp,ot.length):Bt[ot.type]}(f):void 0),N=C.parse(x,void 0,void 0,void 0,f&&f.type==="string"?{typeAnnotation:"coerce"}:void 0);return N?hg(new jy(N,f)):Tv(C.errors)}class Mv{constructor(f,C){this.kind=f,this._styleExpression=C,this.isStateDependent=f!=="constant"&&!dm(C.expression)}evaluateWithoutErrorHandling(f,C,N,ot,Bt,Jt){return this._styleExpression.evaluateWithoutErrorHandling(f,C,N,ot,Bt,Jt)}evaluate(f,C,N,ot,Bt,Jt){return this._styleExpression.evaluate(f,C,N,ot,Bt,Jt)}}class ig{constructor(f,C,N,ot){this.kind=f,this.zoomStops=N,this._styleExpression=C,this.isStateDependent=f!=="camera"&&!dm(C.expression),this.interpolationType=ot}evaluateWithoutErrorHandling(f,C,N,ot,Bt,Jt){return this._styleExpression.evaluateWithoutErrorHandling(f,C,N,ot,Bt,Jt)}evaluate(f,C,N,ot,Bt,Jt){return this._styleExpression.evaluate(f,C,N,ot,Bt,Jt)}interpolationFactor(f,C,N){return this.interpolationType?Em.interpolationFactor(this.interpolationType,f,C,N):0}}function Pv(x,f){const C=Og(x,f);if(C.result==="error")return C;const N=C.value.expression,ot=F_(N);if(!ot&&!fy(f))return Tv([new xp("","data expressions not supported")]);const Bt=Gg(N,["zoom"]);if(!Bt&&!wx(f))return Tv([new xp("","zoom expressions not supported")]);const Jt=yg(N);return Jt||Bt?Jt instanceof xp?Tv([Jt]):Jt instanceof Em&&!h0(f)?Tv([new xp("",'"interpolate" expressions cannot be used with this property')]):hg(Jt?new ig(ot?"camera":"composite",C.value,Jt.labels,Jt instanceof Em?Jt.interpolation:void 0):new Mv(ot?"constant":"source",C.value)):Tv([new xp("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Hp{constructor(f,C){this._parameters=f,this._specification=C,cp(this,d0(this._parameters,this._specification))}static deserialize(f){return new Hp(f._parameters,f._specification)}static serialize(f){return{_parameters:f._parameters,_specification:f._specification}}}function yg(x){let f=null;if(x instanceof Ev)f=yg(x.result);else if(x instanceof hy){for(const C of x.args)if(f=yg(C),f)break}else(x instanceof uy||x instanceof Em)&&x.input instanceof Fm&&x.input.name==="zoom"&&(f=x);return f instanceof xp||x.eachChild(C=>{const N=yg(C);N instanceof xp?f=N:!f&&N?f=new xp("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):f&&N&&f!==N&&(f=new xp("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),f}function Wy(x){if(x===!0||x===!1)return!0;if(!Array.isArray(x)||x.length===0)return!1;switch(x[0]){case"has":return x.length>=2&&x[1]!=="$id"&&x[1]!=="$type";case"in":return x.length>=3&&(typeof x[1]!="string"||Array.isArray(x[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return x.length!==3||Array.isArray(x[1])||Array.isArray(x[2]);case"any":case"all":for(const f of x.slice(1))if(!Wy(f)&&typeof f!="boolean")return!1;return!0;default:return!0}}const V0={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function U0(x){if(x==null)return{filter:()=>!0,needGeometry:!1};Wy(x)||(x=H0(x));const f=Og(x,V0);if(f.result==="error")throw new Error(f.value.map(C=>`${C.key}: ${C.message}`).join(", "));return{filter:(C,N,ot)=>f.value.evaluate(C,N,{},ot),needGeometry:$0(x)}}function qy(x,f){return x<f?-1:x>f?1:0}function $0(x){if(!Array.isArray(x))return!1;if(x[0]==="within")return!0;for(let f=1;f<x.length;f++)if($0(x[f]))return!0;return!1}function H0(x){if(!x)return!0;const f=x[0];return x.length<=1?f!=="any":f==="=="?j0(x[1],x[2],"=="):f==="!="?Ky(j0(x[1],x[2],"==")):f==="<"||f===">"||f==="<="||f===">="?j0(x[1],x[2],f):f==="any"?(C=x.slice(1),["any"].concat(C.map(H0))):f==="all"?["all"].concat(x.slice(1).map(H0)):f==="none"?["all"].concat(x.slice(1).map(H0).map(Ky)):f==="in"?bx(x[1],x.slice(2)):f==="!in"?Ky(bx(x[1],x.slice(2))):f==="has"?f0(x[1]):f==="!has"?Ky(f0(x[1])):f!=="within"||x;var C}function j0(x,f,C){switch(x){case"$type":return[`filter-type-${C}`,f];case"$id":return[`filter-id-${C}`,f];default:return[`filter-${C}`,x,f]}}function bx(x,f){if(f.length===0)return!1;switch(x){case"$type":return["filter-type-in",["literal",f]];case"$id":return["filter-id-in",["literal",f]];default:return f.length>200&&!f.some(C=>typeof C!=typeof f[0])?["filter-in-large",x,["literal",f.sort(qy)]]:["filter-in-small",x,["literal",f]]}}function f0(x){switch(x){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",x]}}function Ky(x){return["!",x]}function Zy(x){const f=typeof x;if(f==="number"||f==="boolean"||f==="string"||x==null)return JSON.stringify(x);if(Array.isArray(x)){let ot="[";for(const Bt of x)ot+=`${Zy(Bt)},`;return`${ot}]`}const C=Object.keys(x).sort();let N="{";for(let ot=0;ot<C.length;ot++)N+=`${JSON.stringify(C[ot])}:${Zy(x[C[ot]])},`;return`${N}}`}function W0(x){let f="";for(const C of Ad)f+=`/${Zy(x[C])}`;return f}function Cx(x){const f=x.value;return f?[new cd(x.key,f,"constants have been deprecated as of v8")]:[]}function Yg(x){return x instanceof Number||x instanceof String||x instanceof Boolean?x.valueOf():x}function Xy(x){if(Array.isArray(x))return x.map(Xy);if(x instanceof Object&&!(x instanceof Number||x instanceof String||x instanceof Boolean)){const f={};for(const C in x)f[C]=Xy(x[C]);return f}return Yg(x)}function Nm(x){const f=x.key,C=x.value,N=x.valueSpec||{},ot=x.objectElementValidators||{},Bt=x.style,Jt=x.styleSpec,Ir=x.validateSpec;let wo=[];const ol=_g(C);if(ol!=="object")return[new cd(f,C,`object expected, ${ol} found`)];for(const hl in C){const vl=hl.split(".")[0],ah=N[vl]||N["*"];let uh;if(ot[vl])uh=ot[vl];else if(N[vl])uh=Ir;else if(ot["*"])uh=ot["*"];else{if(!N["*"]){wo.push(new cd(f,C[hl],`unknown property "${hl}"`));continue}uh=Ir}wo=wo.concat(uh({key:(f&&`${f}.`)+hl,value:C[hl],valueSpec:ah,style:Bt,styleSpec:Jt,object:C,objectKey:hl,validateSpec:Ir},C))}for(const hl in N)ot[hl]||N[hl].required&&N[hl].default===void 0&&C[hl]===void 0&&wo.push(new cd(f,C,`missing required property "${hl}"`));return wo}function Yy(x){const f=x.value,C=x.valueSpec,N=x.style,ot=x.styleSpec,Bt=x.key,Jt=x.arrayElementValidator||x.validateSpec;if(_g(f)!=="array")return[new cd(Bt,f,`array expected, ${_g(f)} found`)];if(C.length&&f.length!==C.length)return[new cd(Bt,f,`array length ${C.length} expected, length ${f.length} found`)];if(C["min-length"]&&f.length<C["min-length"])return[new cd(Bt,f,`array length at least ${C["min-length"]} expected, length ${f.length} found`)];let Ir={type:C.value,values:C.values};ot.$version<7&&(Ir.function=C.function),_g(C.value)==="object"&&(Ir=C.value);let wo=[];for(let ol=0;ol<f.length;ol++)wo=wo.concat(Jt({array:f,arrayIndex:ol,value:f[ol],valueSpec:Ir,validateSpec:x.validateSpec,style:N,styleSpec:ot,key:`${Bt}[${ol}]`}));return wo}function g0(x){const f=x.key,C=x.value,N=x.valueSpec;let ot=_g(C);return ot==="number"&&C!=C&&(ot="NaN"),ot!=="number"?[new cd(f,C,`number expected, ${ot} found`)]:"minimum"in N&&C<N.minimum?[new cd(f,C,`${C} is less than the minimum value ${N.minimum}`)]:"maximum"in N&&C>N.maximum?[new cd(f,C,`${C} is greater than the maximum value ${N.maximum}`)]:[]}function Dv(x){const f=x.valueSpec,C=Yg(x.value.type);let N,ot,Bt,Jt={};const Ir=C!=="categorical"&&x.value.property===void 0,wo=!Ir,ol=_g(x.value.stops)==="array"&&_g(x.value.stops[0])==="array"&&_g(x.value.stops[0][0])==="object",hl=Nm({key:x.key,value:x.value,valueSpec:x.styleSpec.function,validateSpec:x.validateSpec,style:x.style,styleSpec:x.styleSpec,objectElementValidators:{stops:function(uh){if(C==="identity")return[new cd(uh.key,uh.value,'identity function may not have a "stops" property')];let ph=[];const Ph=uh.value;return ph=ph.concat(Yy({key:uh.key,value:Ph,valueSpec:uh.valueSpec,validateSpec:uh.validateSpec,style:uh.style,styleSpec:uh.styleSpec,arrayElementValidator:vl})),_g(Ph)==="array"&&Ph.length===0&&ph.push(new cd(uh.key,Ph,"array must have at least one stop")),ph},default:function(uh){return uh.validateSpec({key:uh.key,value:uh.value,valueSpec:f,validateSpec:uh.validateSpec,style:uh.style,styleSpec:uh.styleSpec})}}});return C==="identity"&&Ir&&hl.push(new cd(x.key,x.value,'missing required property "property"')),C==="identity"||x.value.stops||hl.push(new cd(x.key,x.value,'missing required property "stops"')),C==="exponential"&&x.valueSpec.expression&&!h0(x.valueSpec)&&hl.push(new cd(x.key,x.value,"exponential functions not supported")),x.styleSpec.$version>=8&&(wo&&!fy(x.valueSpec)?hl.push(new cd(x.key,x.value,"property functions not supported")):Ir&&!wx(x.valueSpec)&&hl.push(new cd(x.key,x.value,"zoom functions not supported"))),C!=="categorical"&&!ol||x.value.property!==void 0||hl.push(new cd(x.key,x.value,'"property" property is required')),hl;function vl(uh){let ph=[];const Ph=uh.value,Mh=uh.key;if(_g(Ph)!=="array")return[new cd(Mh,Ph,`array expected, ${_g(Ph)} found`)];if(Ph.length!==2)return[new cd(Mh,Ph,`array length 2 expected, length ${Ph.length} found`)];if(ol){if(_g(Ph[0])!=="object")return[new cd(Mh,Ph,`object expected, ${_g(Ph[0])} found`)];if(Ph[0].zoom===void 0)return[new cd(Mh,Ph,"object stop key must have zoom")];if(Ph[0].value===void 0)return[new cd(Mh,Ph,"object stop key must have value")];if(Bt&&Bt>Yg(Ph[0].zoom))return[new cd(Mh,Ph[0].zoom,"stop zoom values must appear in ascending order")];Yg(Ph[0].zoom)!==Bt&&(Bt=Yg(Ph[0].zoom),ot=void 0,Jt={}),ph=ph.concat(Nm({key:`${Mh}[0]`,value:Ph[0],valueSpec:{zoom:{}},validateSpec:uh.validateSpec,style:uh.style,styleSpec:uh.styleSpec,objectElementValidators:{zoom:g0,value:ah}}))}else ph=ph.concat(ah({key:`${Mh}[0]`,value:Ph[0],valueSpec:{},validateSpec:uh.validateSpec,style:uh.style,styleSpec:uh.styleSpec},Ph));return Iv(Xy(Ph[1]))?ph.concat([new cd(`${Mh}[1]`,Ph[1],"expressions are not allowed in function stops.")]):ph.concat(uh.validateSpec({key:`${Mh}[1]`,value:Ph[1],valueSpec:f,validateSpec:uh.validateSpec,style:uh.style,styleSpec:uh.styleSpec}))}function ah(uh,ph){const Ph=_g(uh.value),Mh=Yg(uh.value),Xh=uh.value!==null?uh.value:ph;if(N){if(Ph!==N)return[new cd(uh.key,Xh,`${Ph} stop domain type must match previous stop domain type ${N}`)]}else N=Ph;if(Ph!=="number"&&Ph!=="string"&&Ph!=="boolean")return[new cd(uh.key,Xh,"stop domain value must be a number, string, or boolean")];if(Ph!=="number"&&C!=="categorical"){let Jh=`number expected, ${Ph} found`;return fy(f)&&C===void 0&&(Jh+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new cd(uh.key,Xh,Jh)]}return C!=="categorical"||Ph!=="number"||isFinite(Mh)&&Math.floor(Mh)===Mh?C!=="categorical"&&Ph==="number"&&ot!==void 0&&Mh<ot?[new cd(uh.key,Xh,"stop domain values must appear in ascending order")]:(ot=Mh,C==="categorical"&&Mh in Jt?[new cd(uh.key,Xh,"stop domain values must be unique")]:(Jt[Mh]=!0,[])):[new cd(uh.key,Xh,`integer expected, found ${Mh}`)]}}function J_(x){const f=(x.expressionContext==="property"?Pv:Og)(Xy(x.value),x.valueSpec);if(f.result==="error")return f.value.map(N=>new cd(`${x.key}${N.key}`,x.value,N.message));const C=f.value.expression||f.value._styleExpression.expression;if(x.expressionContext==="property"&&x.propertyKey==="text-font"&&!C.outputDefined())return[new cd(x.key,x.value,`Invalid data expression for "${x.propertyKey}". Output values must be contained as literals within the expression.`)];if(x.expressionContext==="property"&&x.propertyType==="layout"&&!dm(C))return[new cd(x.key,x.value,'"feature-state" data expressions are not supported with layout properties.')];if(x.expressionContext==="filter"&&!dm(C))return[new cd(x.key,x.value,'"feature-state" data expressions are not supported with filters.')];if(x.expressionContext&&x.expressionContext.indexOf("cluster")===0){if(!Gg(C,["zoom","feature-state"]))return[new cd(x.key,x.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(x.expressionContext==="cluster-initial"&&!F_(C))return[new cd(x.key,x.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Zm(x){const f=x.key,C=x.value,N=x.valueSpec,ot=[];return Array.isArray(N.values)?N.values.indexOf(Yg(C))===-1&&ot.push(new cd(f,C,`expected one of [${N.values.join(", ")}], ${JSON.stringify(C)} found`)):Object.keys(N.values).indexOf(Yg(C))===-1&&ot.push(new cd(f,C,`expected one of [${Object.keys(N.values).join(", ")}], ${JSON.stringify(C)} found`)),ot}function Q_(x){return Wy(Xy(x.value))?J_(cp({},x,{expressionContext:"filter",valueSpec:{value:"boolean"}})):q0(x)}function q0(x){const f=x.value,C=x.key;if(_g(f)!=="array")return[new cd(C,f,`array expected, ${_g(f)} found`)];const N=x.styleSpec;let ot,Bt=[];if(f.length<1)return[new cd(C,f,"filter array must have at least 1 element")];switch(Bt=Bt.concat(Zm({key:`${C}[0]`,value:f[0],valueSpec:N.filter_operator,style:x.style,styleSpec:x.styleSpec})),Yg(f[0])){case"<":case"<=":case">":case">=":f.length>=2&&Yg(f[1])==="$type"&&Bt.push(new cd(C,f,`"$type" cannot be use with operator "${f[0]}"`));case"==":case"!=":f.length!==3&&Bt.push(new cd(C,f,`filter array for operator "${f[0]}" must have 3 elements`));case"in":case"!in":f.length>=2&&(ot=_g(f[1]),ot!=="string"&&Bt.push(new cd(`${C}[1]`,f[1],`string expected, ${ot} found`)));for(let Jt=2;Jt<f.length;Jt++)ot=_g(f[Jt]),Yg(f[1])==="$type"?Bt=Bt.concat(Zm({key:`${C}[${Jt}]`,value:f[Jt],valueSpec:N.geometry_type,style:x.style,styleSpec:x.styleSpec})):ot!=="string"&&ot!=="number"&&ot!=="boolean"&&Bt.push(new cd(`${C}[${Jt}]`,f[Jt],`string, number, or boolean expected, ${ot} found`));break;case"any":case"all":case"none":for(let Jt=1;Jt<f.length;Jt++)Bt=Bt.concat(q0({key:`${C}[${Jt}]`,value:f[Jt],style:x.style,styleSpec:x.styleSpec}));break;case"has":case"!has":ot=_g(f[1]),f.length!==2?Bt.push(new cd(C,f,`filter array for "${f[0]}" operator must have 2 elements`)):ot!=="string"&&Bt.push(new cd(`${C}[1]`,f[1],`string expected, ${ot} found`));break;case"within":ot=_g(f[1]),f.length!==2?Bt.push(new cd(C,f,`filter array for "${f[0]}" operator must have 2 elements`)):ot!=="object"&&Bt.push(new cd(`${C}[1]`,f[1],`object expected, ${ot} found`))}return Bt}function Lv(x,f){const C=x.key,N=x.validateSpec,ot=x.style,Bt=x.styleSpec,Jt=x.value,Ir=x.objectKey,wo=Bt[`${f}_${x.layerType}`];if(!wo)return[];const ol=Ir.match(/^(.*)-transition$/);if(f==="paint"&&ol&&wo[ol[1]]&&wo[ol[1]].transition)return N({key:C,value:Jt,valueSpec:Bt.transition,style:ot,styleSpec:Bt});const hl=x.valueSpec||wo[Ir];if(!hl)return[new cd(C,Jt,`unknown property "${Ir}"`)];let vl;if(_g(Jt)==="string"&&fy(hl)&&!hl.tokens&&(vl=/^{([^}]+)}$/.exec(Jt)))return[new cd(C,Jt,`"${Ir}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(vl[1])} }\`.`)];const ah=[];return x.layerType==="symbol"&&(Ir==="text-field"&&ot&&!ot.glyphs&&ah.push(new cd(C,Jt,'use of "text-field" requires a style "glyphs" property')),Ir==="text-font"&&Av(Xy(Jt))&&Yg(Jt.type)==="identity"&&ah.push(new cd(C,Jt,'"text-font" does not support identity functions'))),ah.concat(N({key:x.key,value:Jt,valueSpec:hl,style:ot,styleSpec:Bt,expressionContext:"property",propertyType:f,propertyKey:Ir}))}function K0(x){return Lv(x,"paint")}function Z0(x){return Lv(x,"layout")}function X0(x){let f=[];const C=x.value,N=x.key,ot=x.style,Bt=x.styleSpec;C.type||C.ref||f.push(new cd(N,C,'either "type" or "ref" is required'));let Jt=Yg(C.type);const Ir=Yg(C.ref);if(C.id){const wo=Yg(C.id);for(let ol=0;ol<x.arrayIndex;ol++){const hl=ot.layers[ol];Yg(hl.id)===wo&&f.push(new cd(N,C.id,`duplicate layer id "${C.id}", previously used at line ${hl.id.__line__}`))}}if("ref"in C){let wo;["type","source","source-layer","filter","layout"].forEach(ol=>{ol in C&&f.push(new cd(N,C[ol],`"${ol}" is prohibited for ref layers`))}),ot.layers.forEach(ol=>{Yg(ol.id)===Ir&&(wo=ol)}),wo?wo.ref?f.push(new cd(N,C.ref,"ref cannot reference another ref layer")):Jt=Yg(wo.type):f.push(new cd(N,C.ref,`ref layer "${Ir}" not found`))}else if(Jt!=="background")if(C.source){const wo=ot.sources&&ot.sources[C.source],ol=wo&&Yg(wo.type);wo?ol==="vector"&&Jt==="raster"?f.push(new cd(N,C.source,`layer "${C.id}" requires a raster source`)):ol==="raster"&&Jt!=="raster"?f.push(new cd(N,C.source,`layer "${C.id}" requires a vector source`)):ol!=="vector"||C["source-layer"]?ol==="raster-dem"&&Jt!=="hillshade"?f.push(new cd(N,C.source,"raster-dem source can only be used with layer type 'hillshade'.")):Jt!=="line"||!C.paint||!C.paint["line-gradient"]||ol==="geojson"&&wo.lineMetrics||f.push(new cd(N,C,`layer "${C.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):f.push(new cd(N,C,`layer "${C.id}" must specify a "source-layer"`)):f.push(new cd(N,C.source,`source "${C.source}" not found`))}else f.push(new cd(N,C,'missing required property "source"'));return f=f.concat(Nm({key:N,value:C,valueSpec:Bt.layer,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":()=>[],type:()=>x.validateSpec({key:`${N}.type`,value:C.type,valueSpec:Bt.layer.type,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,object:C,objectKey:"type"}),filter:Q_,layout:wo=>Nm({layer:C,key:wo.key,value:wo.value,style:wo.style,styleSpec:wo.styleSpec,validateSpec:wo.validateSpec,objectElementValidators:{"*":ol=>Z0(cp({layerType:Jt},ol))}}),paint:wo=>Nm({layer:C,key:wo.key,value:wo.value,style:wo.style,styleSpec:wo.styleSpec,validateSpec:wo.validateSpec,objectElementValidators:{"*":ol=>K0(cp({layerType:Jt},ol))}})}})),f}function v_(x){const f=x.value,C=x.key,N=_g(f);return N!=="string"?[new cd(C,f,`string expected, ${N} found`)]:[]}const Jy={promoteId:function({key:x,value:f}){if(_g(f)==="string")return v_({key:x,value:f});{const C=[];for(const N in f)C.push(...v_({key:`${x}.${N}`,value:f[N]}));return C}}};function gy(x){const f=x.value,C=x.key,N=x.styleSpec,ot=x.style,Bt=x.validateSpec;if(!f.type)return[new cd(C,f,'"type" is required')];const Jt=Yg(f.type);let Ir;switch(Jt){case"vector":case"raster":case"raster-dem":return Ir=Nm({key:C,value:f,valueSpec:N[`source_${Jt.replace("-","_")}`],style:x.style,styleSpec:N,objectElementValidators:Jy,validateSpec:Bt}),Ir;case"geojson":if(Ir=Nm({key:C,value:f,valueSpec:N.source_geojson,style:ot,styleSpec:N,validateSpec:Bt,objectElementValidators:Jy}),f.cluster)for(const wo in f.clusterProperties){const[ol,hl]=f.clusterProperties[wo],vl=typeof ol=="string"?[ol,["accumulated"],["get",wo]]:ol;Ir.push(...J_({key:`${C}.${wo}.map`,value:hl,validateSpec:Bt,expressionContext:"cluster-map"})),Ir.push(...J_({key:`${C}.${wo}.reduce`,value:vl,validateSpec:Bt,expressionContext:"cluster-reduce"}))}return Ir;case"video":return Nm({key:C,value:f,valueSpec:N.source_video,style:ot,validateSpec:Bt,styleSpec:N});case"image":return Nm({key:C,value:f,valueSpec:N.source_image,style:ot,validateSpec:Bt,styleSpec:N});case"canvas":return[new cd(C,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Zm({key:`${C}.type`,value:f.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:ot,validateSpec:Bt,styleSpec:N})}}function Ex(x){const f=x.value,C=x.styleSpec,N=C.light,ot=x.style;let Bt=[];const Jt=_g(f);if(f===void 0)return Bt;if(Jt!=="object")return Bt=Bt.concat([new cd("light",f,`object expected, ${Jt} found`)]),Bt;for(const Ir in f){const wo=Ir.match(/^(.*)-transition$/);Bt=Bt.concat(wo&&N[wo[1]]&&N[wo[1]].transition?x.validateSpec({key:Ir,value:f[Ir],valueSpec:C.transition,validateSpec:x.validateSpec,style:ot,styleSpec:C}):N[Ir]?x.validateSpec({key:Ir,value:f[Ir],valueSpec:N[Ir],validateSpec:x.validateSpec,style:ot,styleSpec:C}):[new cd(Ir,f[Ir],`unknown property "${Ir}"`)])}return Bt}function Qy(x){const f=x.value,C=x.styleSpec,N=C.terrain,ot=x.style;let Bt=[];const Jt=_g(f);if(f===void 0)return Bt;if(Jt!=="object")return Bt=Bt.concat([new cd("terrain",f,`object expected, ${Jt} found`)]),Bt;for(const Ir in f)Bt=Bt.concat(N[Ir]?x.validateSpec({key:Ir,value:f[Ir],valueSpec:N[Ir],validateSpec:x.validateSpec,style:ot,styleSpec:C}):[new cd(Ir,f[Ir],`unknown property "${Ir}"`)]);return Bt}function Ux(x){let f=[];const C=x.value,N=x.key;if(Array.isArray(C)){const ot=[],Bt=[];for(const Jt in C)C[Jt].id&&ot.includes(C[Jt].id)&&f.push(new cd(N,C,`all the sprites' ids must be unique, but ${C[Jt].id} is duplicated`)),ot.push(C[Jt].id),C[Jt].url&&Bt.includes(C[Jt].url)&&f.push(new cd(N,C,`all the sprites' URLs must be unique, but ${C[Jt].url} is duplicated`)),Bt.push(C[Jt].url),f=f.concat(Nm({key:`${N}[${Jt}]`,value:C[Jt],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:x.validateSpec}));return f}return v_({key:N,value:C})}const Y0={"*":()=>[],array:Yy,boolean:function(x){const f=x.value,C=x.key,N=_g(f);return N!=="boolean"?[new cd(C,f,`boolean expected, ${N} found`)]:[]},number:g0,color:function(x){const f=x.key,C=x.value,N=_g(C);return N!=="string"?[new cd(f,C,`color expected, ${N} found`)]:Yp.parse(String(C))?[]:[new cd(f,C,`color expected, "${C}" found`)]},constants:Cx,enum:Zm,filter:Q_,function:Dv,layer:X0,object:Nm,source:gy,light:Ex,terrain:Qy,string:v_,formatted:function(x){return v_(x).length===0?[]:J_(x)},resolvedImage:function(x){return v_(x).length===0?[]:J_(x)},padding:function(x){const f=x.key,C=x.value;if(_g(C)==="array"){if(C.length<1||C.length>4)return[new cd(f,C,`padding requires 1 to 4 values; ${C.length} values found`)];const N={type:"number"};let ot=[];for(let Bt=0;Bt<C.length;Bt++)ot=ot.concat(x.validateSpec({key:`${f}[${Bt}]`,value:C[Bt],validateSpec:x.validateSpec,valueSpec:N}));return ot}return g0({key:f,value:C,valueSpec:{}})},sprite:Ux};function Ov(x){const f=x.value,C=x.valueSpec,N=x.styleSpec;return x.validateSpec=Ov,C.expression&&Av(Yg(f))?Dv(x):C.expression&&Iv(Xy(f))?J_(x):C.type&&Y0[C.type]?Y0[C.type](x):Nm(cp({},x,{valueSpec:C.type?N[C.type]:C}))}function Fv(x){const f=x.value,C=x.key,N=v_(x);return N.length||(f.indexOf("{fontstack}")===-1&&N.push(new cd(C,f,'"glyphs" url must include a "{fontstack}" token')),f.indexOf("{range}")===-1&&N.push(new cd(C,f,'"glyphs" url must include a "{range}" token'))),N}function R_(x,f=Yh){let C=[];return C=C.concat(Ov({key:"",value:x,valueSpec:f.$root,styleSpec:f,style:x,validateSpec:Ov,objectElementValidators:{glyphs:Fv,"*":()=>[]}})),x.constants&&(C=C.concat(Cx({key:"constants",value:x.constants,style:x,styleSpec:f,validateSpec:Ov}))),Nv(C)}function Um(x){return function(f){return x({...f,validateSpec:Ov})}}function Nv(x){return[].concat(x).sort((f,C)=>f.line-C.line)}function Vg(x){return function(...f){return Nv(x.apply(this,f))}}R_.source=Vg(Um(gy)),R_.sprite=Vg(Um(Ux)),R_.glyphs=Vg(Um(Fv)),R_.light=Vg(Um(Ex)),R_.terrain=Vg(Um(Qy)),R_.layer=Vg(Um(X0)),R_.filter=Vg(Um(Q_)),R_.paintProperty=Vg(Um(K0)),R_.layoutProperty=Vg(Um(Z0));const my=R_,xw=my.light,ww=my.paintProperty,bw=my.layoutProperty;function kv(x,f){let C=!1;if(f&&f.length)for(const N of f)x.fire(new Ap(new Error(N.message))),C=!0;return C}class Bv{constructor(f,C,N){const ot=this.cells=[];if(f instanceof ArrayBuffer){this.arrayBuffer=f;const Jt=new Int32Array(this.arrayBuffer);f=Jt[0],this.d=(C=Jt[1])+2*(N=Jt[2]);for(let wo=0;wo<this.d*this.d;wo++){const ol=Jt[3+wo],hl=Jt[3+wo+1];ot.push(ol===hl?null:Jt.subarray(ol,hl))}const Ir=Jt[3+ot.length+1];this.keys=Jt.subarray(Jt[3+ot.length],Ir),this.bboxes=Jt.subarray(Ir),this.insert=this._insertReadonly}else{this.d=C+2*N;for(let Jt=0;Jt<this.d*this.d;Jt++)ot.push([]);this.keys=[],this.bboxes=[]}this.n=C,this.extent=f,this.padding=N,this.scale=C/f,this.uid=0;const Bt=N/C*f;this.min=-Bt,this.max=f+Bt}insert(f,C,N,ot,Bt){this._forEachCell(C,N,ot,Bt,this._insertCell,this.uid++,void 0,void 0),this.keys.push(f),this.bboxes.push(C),this.bboxes.push(N),this.bboxes.push(ot),this.bboxes.push(Bt)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(f,C,N,ot,Bt,Jt){this.cells[Bt].push(Jt)}query(f,C,N,ot,Bt){const Jt=this.min,Ir=this.max;if(f<=Jt&&C<=Jt&&Ir<=N&&Ir<=ot&&!Bt)return Array.prototype.slice.call(this.keys);{const wo=[];return this._forEachCell(f,C,N,ot,this._queryCell,wo,{},Bt),wo}}_queryCell(f,C,N,ot,Bt,Jt,Ir,wo){const ol=this.cells[Bt];if(ol!==null){const hl=this.keys,vl=this.bboxes;for(let ah=0;ah<ol.length;ah++){const uh=ol[ah];if(Ir[uh]===void 0){const ph=4*uh;(wo?wo(vl[ph+0],vl[ph+1],vl[ph+2],vl[ph+3]):f<=vl[ph+2]&&C<=vl[ph+3]&&N>=vl[ph+0]&&ot>=vl[ph+1])?(Ir[uh]=!0,Jt.push(hl[uh])):Ir[uh]=!1}}}}_forEachCell(f,C,N,ot,Bt,Jt,Ir,wo){const ol=this._convertToCellCoord(f),hl=this._convertToCellCoord(C),vl=this._convertToCellCoord(N),ah=this._convertToCellCoord(ot);for(let uh=ol;uh<=vl;uh++)for(let ph=hl;ph<=ah;ph++){const Ph=this.d*ph+uh;if((!wo||wo(this._convertFromCellCoord(uh),this._convertFromCellCoord(ph),this._convertFromCellCoord(uh+1),this._convertFromCellCoord(ph+1)))&&Bt.call(this,f,C,N,ot,Ph,Jt,Ir,wo))return}}_convertFromCellCoord(f){return(f-this.padding)/this.scale}_convertToCellCoord(f){return Math.max(0,Math.min(this.d-1,Math.floor(f*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const f=this.cells,C=3+this.cells.length+1+1;let N=0;for(let Jt=0;Jt<this.cells.length;Jt++)N+=this.cells[Jt].length;const ot=new Int32Array(C+N+this.keys.length+this.bboxes.length);ot[0]=this.extent,ot[1]=this.n,ot[2]=this.padding;let Bt=C;for(let Jt=0;Jt<f.length;Jt++){const Ir=f[Jt];ot[3+Jt]=Bt,ot.set(Ir,Bt),Bt+=Ir.length}return ot[3+f.length]=Bt,ot.set(this.keys,Bt),Bt+=this.keys.length,ot[3+f.length+1]=Bt,ot.set(this.bboxes,Bt),Bt+=this.bboxes.length,ot.buffer}static serialize(f,C){const N=f.toArrayBuffer();return C&&C.push(N),{buffer:N}}static deserialize(f){return new Bv(f.buffer)}}const l_={};function Tp(x,f,C={}){if(l_[x])throw new Error(`${x} is already registered.`);Object.defineProperty(f,"_classRegistryKey",{value:x,writeable:!1}),l_[x]={klass:f,omit:C.omit||[],shallow:C.shallow||[]}}Tp("Object",Object),Tp("TransferableGridIndex",Bv),Tp("Color",Yp),Tp("Error",Error),Tp("AJAXError",Xd),Tp("ResolvedImage",nm),Tp("StylePropertyFunction",Hp),Tp("StyleExpression",jy,{omit:["_evaluator"]}),Tp("ZoomDependentExpression",ig),Tp("ZoomConstantExpression",Mv),Tp("CompoundExpression",Fm,{omit:["_evaluate"]});for(const x in Hy)Hy[x]._classRegistryKey||Tp(`Expression_${x}`,Hy[x]);function m0(x){return x&&typeof ArrayBuffer<"u"&&(x instanceof ArrayBuffer||x.constructor&&x.constructor.name==="ArrayBuffer")}function Gv(x,f){if(x==null||typeof x=="boolean"||typeof x=="number"||typeof x=="string"||x instanceof Boolean||x instanceof Number||x instanceof String||x instanceof Date||x instanceof RegExp||x instanceof Blob)return x;if(m0(x)||Ed(x))return f&&f.push(x),x;if(ArrayBuffer.isView(x)){const C=x;return f&&f.push(C.buffer),C}if(x instanceof ImageData)return f&&f.push(x.data.buffer),x;if(Array.isArray(x)){const C=[];for(const N of x)C.push(Gv(N,f));return C}if(typeof x=="object"){const C=x.constructor,N=C._classRegistryKey;if(!N)throw new Error("can't serialize object of unregistered class");if(!l_[N])throw new Error(`${N} is not registered.`);const ot=C.serialize?C.serialize(x,f):{};if(C.serialize){if(f&&ot===f[f.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const Bt in x){if(!x.hasOwnProperty(Bt)||l_[N].omit.indexOf(Bt)>=0)continue;const Jt=x[Bt];ot[Bt]=l_[N].shallow.indexOf(Bt)>=0?Jt:Gv(Jt,f)}x instanceof Error&&(ot.message=x.message)}if(ot.$name)throw new Error("$name property is reserved for worker serialization logic.");return N!=="Object"&&(ot.$name=N),ot}throw new Error("can't serialize object of type "+typeof x)}function Sm(x){if(x==null||typeof x=="boolean"||typeof x=="number"||typeof x=="string"||x instanceof Boolean||x instanceof Number||x instanceof String||x instanceof Date||x instanceof RegExp||x instanceof Blob||m0(x)||Ed(x)||ArrayBuffer.isView(x)||x instanceof ImageData)return x;if(Array.isArray(x))return x.map(Sm);if(typeof x=="object"){const f=x.$name||"Object";if(!l_[f])throw new Error(`can't deserialize unregistered class ${f}`);const{klass:C}=l_[f];if(!C)throw new Error(`can't deserialize unregistered class ${f}`);if(C.deserialize)return C.deserialize(x);const N=Object.create(C.prototype);for(const ot of Object.keys(x)){if(ot==="$name")continue;const Bt=x[ot];N[ot]=l_[f].shallow.indexOf(ot)>=0?Bt:Sm(Bt)}return N}throw new Error("can't deserialize object of type "+typeof x)}class _0{constructor(){this.first=!0}update(f,C){const N=Math.floor(f);return this.first?(this.first=!1,this.lastIntegerZoom=N,this.lastIntegerZoomTime=0,this.lastZoom=f,this.lastFloorZoom=N,!0):(this.lastFloorZoom>N?(this.lastIntegerZoom=N+1,this.lastIntegerZoomTime=C):this.lastFloorZoom<N&&(this.lastIntegerZoom=N,this.lastIntegerZoomTime=C),f!==this.lastZoom&&(this.lastZoom=f,this.lastFloorZoom=N,!0))}}const sp={"Latin-1 Supplement":x=>x>=128&&x<=255,Arabic:x=>x>=1536&&x<=1791,"Arabic Supplement":x=>x>=1872&&x<=1919,"Arabic Extended-A":x=>x>=2208&&x<=2303,"Hangul Jamo":x=>x>=4352&&x<=4607,"Unified Canadian Aboriginal Syllabics":x=>x>=5120&&x<=5759,Khmer:x=>x>=6016&&x<=6143,"Unified Canadian Aboriginal Syllabics Extended":x=>x>=6320&&x<=6399,"General Punctuation":x=>x>=8192&&x<=8303,"Letterlike Symbols":x=>x>=8448&&x<=8527,"Number Forms":x=>x>=8528&&x<=8591,"Miscellaneous Technical":x=>x>=8960&&x<=9215,"Control Pictures":x=>x>=9216&&x<=9279,"Optical Character Recognition":x=>x>=9280&&x<=9311,"Enclosed Alphanumerics":x=>x>=9312&&x<=9471,"Geometric Shapes":x=>x>=9632&&x<=9727,"Miscellaneous Symbols":x=>x>=9728&&x<=9983,"Miscellaneous Symbols and Arrows":x=>x>=11008&&x<=11263,"CJK Radicals Supplement":x=>x>=11904&&x<=12031,"Kangxi Radicals":x=>x>=12032&&x<=12255,"Ideographic Description Characters":x=>x>=12272&&x<=12287,"CJK Symbols and Punctuation":x=>x>=12288&&x<=12351,Hiragana:x=>x>=12352&&x<=12447,Katakana:x=>x>=12448&&x<=12543,Bopomofo:x=>x>=12544&&x<=12591,"Hangul Compatibility Jamo":x=>x>=12592&&x<=12687,Kanbun:x=>x>=12688&&x<=12703,"Bopomofo Extended":x=>x>=12704&&x<=12735,"CJK Strokes":x=>x>=12736&&x<=12783,"Katakana Phonetic Extensions":x=>x>=12784&&x<=12799,"Enclosed CJK Letters and Months":x=>x>=12800&&x<=13055,"CJK Compatibility":x=>x>=13056&&x<=13311,"CJK Unified Ideographs Extension A":x=>x>=13312&&x<=19903,"Yijing Hexagram Symbols":x=>x>=19904&&x<=19967,"CJK Unified Ideographs":x=>x>=19968&&x<=40959,"Yi Syllables":x=>x>=40960&&x<=42127,"Yi Radicals":x=>x>=42128&&x<=42191,"Hangul Jamo Extended-A":x=>x>=43360&&x<=43391,"Hangul Syllables":x=>x>=44032&&x<=55215,"Hangul Jamo Extended-B":x=>x>=55216&&x<=55295,"Private Use Area":x=>x>=57344&&x<=63743,"CJK Compatibility Ideographs":x=>x>=63744&&x<=64255,"Arabic Presentation Forms-A":x=>x>=64336&&x<=65023,"Vertical Forms":x=>x>=65040&&x<=65055,"CJK Compatibility Forms":x=>x>=65072&&x<=65103,"Small Form Variants":x=>x>=65104&&x<=65135,"Arabic Presentation Forms-B":x=>x>=65136&&x<=65279,"Halfwidth and Fullwidth Forms":x=>x>=65280&&x<=65519};function _y(x){for(const f of x)if(ey(f.charCodeAt(0)))return!0;return!1}function J0(x){for(const f of x)if(!yy(f.charCodeAt(0)))return!1;return!0}function yy(x){return!(sp.Arabic(x)||sp["Arabic Supplement"](x)||sp["Arabic Extended-A"](x)||sp["Arabic Presentation Forms-A"](x)||sp["Arabic Presentation Forms-B"](x))}function ey(x){return!(x!==746&&x!==747&&(x<4352||!(sp["Bopomofo Extended"](x)||sp.Bopomofo(x)||sp["CJK Compatibility Forms"](x)&&!(x>=65097&&x<=65103)||sp["CJK Compatibility Ideographs"](x)||sp["CJK Compatibility"](x)||sp["CJK Radicals Supplement"](x)||sp["CJK Strokes"](x)||!(!sp["CJK Symbols and Punctuation"](x)||x>=12296&&x<=12305||x>=12308&&x<=12319||x===12336)||sp["CJK Unified Ideographs Extension A"](x)||sp["CJK Unified Ideographs"](x)||sp["Enclosed CJK Letters and Months"](x)||sp["Hangul Compatibility Jamo"](x)||sp["Hangul Jamo Extended-A"](x)||sp["Hangul Jamo Extended-B"](x)||sp["Hangul Jamo"](x)||sp["Hangul Syllables"](x)||sp.Hiragana(x)||sp["Ideographic Description Characters"](x)||sp.Kanbun(x)||sp["Kangxi Radicals"](x)||sp["Katakana Phonetic Extensions"](x)||sp.Katakana(x)&&x!==12540||!(!sp["Halfwidth and Fullwidth Forms"](x)||x===65288||x===65289||x===65293||x>=65306&&x<=65310||x===65339||x===65341||x===65343||x>=65371&&x<=65503||x===65507||x>=65512&&x<=65519)||!(!sp["Small Form Variants"](x)||x>=65112&&x<=65118||x>=65123&&x<=65126)||sp["Unified Canadian Aboriginal Syllabics"](x)||sp["Unified Canadian Aboriginal Syllabics Extended"](x)||sp["Vertical Forms"](x)||sp["Yijing Hexagram Symbols"](x)||sp["Yi Syllables"](x)||sp["Yi Radicals"](x))))}function y0(x){return!(ey(x)||function(f){return!!(sp["Latin-1 Supplement"](f)&&(f===167||f===169||f===174||f===177||f===188||f===189||f===190||f===215||f===247)||sp["General Punctuation"](f)&&(f===8214||f===8224||f===8225||f===8240||f===8241||f===8251||f===8252||f===8258||f===8263||f===8264||f===8265||f===8273)||sp["Letterlike Symbols"](f)||sp["Number Forms"](f)||sp["Miscellaneous Technical"](f)&&(f>=8960&&f<=8967||f>=8972&&f<=8991||f>=8996&&f<=9e3||f===9003||f>=9085&&f<=9114||f>=9150&&f<=9165||f===9167||f>=9169&&f<=9179||f>=9186&&f<=9215)||sp["Control Pictures"](f)&&f!==9251||sp["Optical Character Recognition"](f)||sp["Enclosed Alphanumerics"](f)||sp["Geometric Shapes"](f)||sp["Miscellaneous Symbols"](f)&&!(f>=9754&&f<=9759)||sp["Miscellaneous Symbols and Arrows"](f)&&(f>=11026&&f<=11055||f>=11088&&f<=11097||f>=11192&&f<=11243)||sp["CJK Symbols and Punctuation"](f)||sp.Katakana(f)||sp["Private Use Area"](f)||sp["CJK Compatibility Forms"](f)||sp["Small Form Variants"](f)||sp["Halfwidth and Fullwidth Forms"](f)||f===8734||f===8756||f===8757||f>=9984&&f<=10087||f>=10102&&f<=10131||f===65532||f===65533)}(x))}function ev(x){return x>=1424&&x<=2303||sp["Arabic Presentation Forms-A"](x)||sp["Arabic Presentation Forms-B"](x)}function og(x,f){return!(!f&&ev(x)||x>=2304&&x<=3583||x>=3840&&x<=4255||sp.Khmer(x))}function zv(x){for(const f of x)if(ev(f.charCodeAt(0)))return!0;return!1}const Q0="deferred",tv="loading",vy="loaded";let Vv=null,Tm="unavailable",km=null;const Sx=function(x){x&&typeof x=="string"&&x.indexOf("NetworkError")>-1&&(Tm="error"),Vv&&Vv(x)};function Uv(){ty.fire(new Kd("pluginStateChange",{pluginStatus:Tm,pluginURL:km}))}const ty=new Ip,xy=function(){return Tm},ex=function(){if(Tm!==Q0||!km)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Tm=tv,Uv(),km&&Wd({url:km},x=>{x?Sx(x):(Tm=vy,Uv())})},Bm={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Tm===vy||Bm.applyArabicShaping!=null,isLoading:()=>Tm===tv,setState(x){if(!bh())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Tm=x.pluginStatus,km=x.pluginURL},isParsed(){if(!bh())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Bm.applyArabicShaping!=null&&Bm.processBidirectionalText!=null&&Bm.processStyledBidirectionalText!=null},getPluginURL(){if(!bh())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return km}};class Eg{constructor(f,C){this.zoom=f,C?(this.now=C.now,this.fadeDuration=C.fadeDuration,this.zoomHistory=C.zoomHistory,this.transition=C.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new _0,this.transition={})}isSupportedScript(f){return function(C,N){for(const ot of C)if(!og(ot.charCodeAt(0),N))return!1;return!0}(f,Bm.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const f=this.zoom,C=f-Math.floor(f),N=this.crossFadingFactor();return f>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:C+(1-C)*N}:{fromScale:.5,toScale:1,t:1-(1-N)*C}}}class iv{constructor(f,C){this.property=f,this.value=C,this.expression=function(N,ot){if(Av(N))return new Hp(N,ot);if(Iv(N)){const Bt=Pv(N,ot);if(Bt.result==="error")throw new Error(Bt.value.map(Jt=>`${Jt.key}: ${Jt.message}`).join(", "));return Bt.value}{let Bt=N;return ot.type==="color"&&typeof N=="string"?Bt=Yp.parse(N):ot.type!=="padding"||typeof N!="number"&&!Array.isArray(N)||(Bt=Xg.parse(N)),{kind:"constant",evaluate:()=>Bt}}}(C===void 0?f.specification.default:C,f.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(f,C,N){return this.property.possiblyEvaluate(this,f,C,N)}}class $v{constructor(f){this.property=f,this.value=new iv(f,void 0)}transitioned(f,C){return new $m(this.property,this.value,C,Wr({},f.transition,this.transition),f.now)}untransitioned(){return new $m(this.property,this.value,null,{},0)}}class fp{constructor(f){this._properties=f,this._values=Object.create(f.defaultTransitionablePropertyValues)}getValue(f){return sl(this._values[f].value.value)}setValue(f,C){Object.prototype.hasOwnProperty.call(this._values,f)||(this._values[f]=new $v(this._values[f].property)),this._values[f].value=new iv(this._values[f].property,C===null?void 0:sl(C))}getTransition(f){return sl(this._values[f].transition)}setTransition(f,C){Object.prototype.hasOwnProperty.call(this._values,f)||(this._values[f]=new $v(this._values[f].property)),this._values[f].transition=sl(C)||void 0}serialize(){const f={};for(const C of Object.keys(this._values)){const N=this.getValue(C);N!==void 0&&(f[C]=N);const ot=this.getTransition(C);ot!==void 0&&(f[`${C}-transition`]=ot)}return f}transitioned(f,C){const N=new Tx(this._properties);for(const ot of Object.keys(this._values))N._values[ot]=this._values[ot].transitioned(f,C._values[ot]);return N}untransitioned(){const f=new Tx(this._properties);for(const C of Object.keys(this._values))f._values[C]=this._values[C].untransitioned();return f}}class $m{constructor(f,C,N,ot,Bt){this.property=f,this.value=C,this.begin=Bt+ot.delay||0,this.end=this.begin+ot.duration||0,f.specification.transition&&(ot.delay||ot.duration)&&(this.prior=N)}possiblyEvaluate(f,C,N){const ot=f.now||0,Bt=this.value.possiblyEvaluate(f,C,N),Jt=this.prior;if(Jt){if(ot>this.end)return this.prior=null,Bt;if(this.value.isDataDriven())return this.prior=null,Bt;if(ot<this.begin)return Jt.possiblyEvaluate(f,C,N);{const Ir=(ot-this.begin)/(this.end-this.begin);return this.property.interpolate(Jt.possiblyEvaluate(f,C,N),Bt,function(wo){if(wo<=0)return 0;if(wo>=1)return 1;const ol=wo*wo,hl=ol*wo;return 4*(wo<.5?hl:3*(wo-ol)+hl-.75)}(Ir))}}return Bt}}class Tx{constructor(f){this._properties=f,this._values=Object.create(f.defaultTransitioningPropertyValues)}possiblyEvaluate(f,C,N){const ot=new tm(this._properties);for(const Bt of Object.keys(this._values))ot._values[Bt]=this._values[Bt].possiblyEvaluate(f,C,N);return ot}hasTransition(){for(const f of Object.keys(this._values))if(this._values[f].prior)return!0;return!1}}class rv{constructor(f){this._properties=f,this._values=Object.create(f.defaultPropertyValues)}getValue(f){return sl(this._values[f].value)}setValue(f,C){this._values[f]=new iv(this._values[f].property,C===null?void 0:sl(C))}serialize(){const f={};for(const C of Object.keys(this._values)){const N=this.getValue(C);N!==void 0&&(f[C]=N)}return f}possiblyEvaluate(f,C,N){const ot=new tm(this._properties);for(const Bt of Object.keys(this._values))ot._values[Bt]=this._values[Bt].possiblyEvaluate(f,C,N);return ot}}class Xm{constructor(f,C,N){this.property=f,this.value=C,this.parameters=N}isConstant(){return this.value.kind==="constant"}constantOr(f){return this.value.kind==="constant"?this.value.value:f}evaluate(f,C,N,ot){return this.property.evaluate(this.value,this.parameters,f,C,N,ot)}}class tm{constructor(f){this._properties=f,this._values=Object.create(f.defaultPossiblyEvaluatedValues)}get(f){return this._values[f]}}class Np{constructor(f){this.specification=f}possiblyEvaluate(f,C){if(f.isDataDriven())throw new Error("Value should not be data driven");return f.expression.evaluate(C)}interpolate(f,C,N){const ot=Km[this.specification.type];return ot?ot(f,C,N):f}}class Kp{constructor(f,C){this.specification=f,this.overrides=C}possiblyEvaluate(f,C,N,ot){return new Xm(this,f.expression.kind==="constant"||f.expression.kind==="camera"?{kind:"constant",value:f.expression.evaluate(C,null,{},N,ot)}:f.expression,C)}interpolate(f,C,N){if(f.value.kind!=="constant"||C.value.kind!=="constant")return f;if(f.value.value===void 0||C.value.value===void 0)return new Xm(this,{kind:"constant",value:void 0},f.parameters);const ot=Km[this.specification.type];if(ot){const Bt=ot(f.value.value,C.value.value,N);return new Xm(this,{kind:"constant",value:Bt},f.parameters)}return f}evaluate(f,C,N,ot,Bt,Jt){return f.kind==="constant"?f.value:f.evaluate(C,N,ot,Bt,Jt)}}class nv extends Kp{possiblyEvaluate(f,C,N,ot){if(f.value===void 0)return new Xm(this,{kind:"constant",value:void 0},C);if(f.expression.kind==="constant"){const Bt=f.expression.evaluate(C,null,{},N,ot),Jt=f.property.specification.type==="resolvedImage"&&typeof Bt!="string"?Bt.name:Bt,Ir=this._calculate(Jt,Jt,Jt,C);return new Xm(this,{kind:"constant",value:Ir},C)}if(f.expression.kind==="camera"){const Bt=this._calculate(f.expression.evaluate({zoom:C.zoom-1}),f.expression.evaluate({zoom:C.zoom}),f.expression.evaluate({zoom:C.zoom+1}),C);return new Xm(this,{kind:"constant",value:Bt},C)}return new Xm(this,f.expression,C)}evaluate(f,C,N,ot,Bt,Jt){if(f.kind==="source"){const Ir=f.evaluate(C,N,ot,Bt,Jt);return this._calculate(Ir,Ir,Ir,C)}return f.kind==="composite"?this._calculate(f.evaluate({zoom:Math.floor(C.zoom)-1},N,ot),f.evaluate({zoom:Math.floor(C.zoom)},N,ot),f.evaluate({zoom:Math.floor(C.zoom)+1},N,ot),C):f.value}_calculate(f,C,N,ot){return ot.zoom>ot.zoomHistory.lastIntegerZoom?{from:f,to:C}:{from:N,to:C}}interpolate(f){return f}}class Hv{constructor(f){this.specification=f}possiblyEvaluate(f,C,N,ot){if(f.value!==void 0){if(f.expression.kind==="constant"){const Bt=f.expression.evaluate(C,null,{},N,ot);return this._calculate(Bt,Bt,Bt,C)}return this._calculate(f.expression.evaluate(new Eg(Math.floor(C.zoom-1),C)),f.expression.evaluate(new Eg(Math.floor(C.zoom),C)),f.expression.evaluate(new Eg(Math.floor(C.zoom+1),C)),C)}}_calculate(f,C,N,ot){return ot.zoom>ot.zoomHistory.lastIntegerZoom?{from:f,to:C}:{from:N,to:C}}interpolate(f){return f}}class tx{constructor(f){this.specification=f}possiblyEvaluate(f,C,N,ot){return!!f.expression.evaluate(C,null,{},N,ot)}interpolate(){return!1}}class Am{constructor(f){this.properties=f,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const C in f){const N=f[C];N.specification.overridable&&this.overridableProperties.push(C);const ot=this.defaultPropertyValues[C]=new iv(N,void 0),Bt=this.defaultTransitionablePropertyValues[C]=new $v(N);this.defaultTransitioningPropertyValues[C]=Bt.untransitioned(),this.defaultPossiblyEvaluatedValues[C]=ot.possiblyEvaluate({})}}}Tp("DataDrivenProperty",Kp),Tp("DataConstantProperty",Np),Tp("CrossFadedDataDrivenProperty",nv),Tp("CrossFadedProperty",Hv),Tp("ColorRampProperty",tx);const ov="-transition";class x_ extends Ip{constructor(f,C){if(super(),this.id=f.id,this.type=f.type,this._featureFilter={filter:()=>!0,needGeometry:!1},f.type!=="custom"&&(this.metadata=f.metadata,this.minzoom=f.minzoom,this.maxzoom=f.maxzoom,f.type!=="background"&&(this.source=f.source,this.sourceLayer=f["source-layer"],this.filter=f.filter),C.layout&&(this._unevaluatedLayout=new rv(C.layout)),C.paint)){this._transitionablePaint=new fp(C.paint);for(const N in f.paint)this.setPaintProperty(N,f.paint[N],{validate:!1});for(const N in f.layout)this.setLayoutProperty(N,f.layout[N],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new tm(C.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(f){return f==="visibility"?this.visibility:this._unevaluatedLayout.getValue(f)}setLayoutProperty(f,C,N={}){C!=null&&this._validate(bw,`layers.${this.id}.layout.${f}`,f,C,N)||(f!=="visibility"?this._unevaluatedLayout.setValue(f,C):this.visibility=C)}getPaintProperty(f){return f.endsWith(ov)?this._transitionablePaint.getTransition(f.slice(0,-11)):this._transitionablePaint.getValue(f)}setPaintProperty(f,C,N={}){if(C!=null&&this._validate(ww,`layers.${this.id}.paint.${f}`,f,C,N))return!1;if(f.endsWith(ov))return this._transitionablePaint.setTransition(f.slice(0,-11),C||void 0),!1;{const ot=this._transitionablePaint._values[f],Bt=ot.property.specification["property-type"]==="cross-faded-data-driven",Jt=ot.value.isDataDriven(),Ir=ot.value;this._transitionablePaint.setValue(f,C),this._handleSpecialPaintPropertyUpdate(f);const wo=this._transitionablePaint._values[f].value;return wo.isDataDriven()||Jt||Bt||this._handleOverridablePaintPropertyUpdate(f,Ir,wo)}}_handleSpecialPaintPropertyUpdate(f){}_handleOverridablePaintPropertyUpdate(f,C,N){return!1}isHidden(f){return!!(this.minzoom&&f<this.minzoom)||!!(this.maxzoom&&f>=this.maxzoom)||this.visibility==="none"}updateTransitions(f){this._transitioningPaint=this._transitionablePaint.transitioned(f,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(f,C){f.getCrossfadeParameters&&(this._crossfadeParameters=f.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(f,void 0,C)),this.paint=this._transitioningPaint.possiblyEvaluate(f,void 0,C)}serialize(){const f={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(f.layout=f.layout||{},f.layout.visibility=this.visibility),ml(f,(C,N)=>!(C===void 0||N==="layout"&&!Object.keys(C).length||N==="paint"&&!Object.keys(C).length))}_validate(f,C,N,ot,Bt={}){return(!Bt||Bt.validate!==!1)&&kv(this,f.call(my,{key:C,layerType:this.type,objectKey:N,value:ot,styleSpec:Yh,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const f in this.paint._values){const C=this.paint.get(f);if(C instanceof Xm&&fy(C.property.specification)&&(C.value.kind==="source"||C.value.kind==="composite")&&C.value.isStateDependent)return!0}return!1}}const Cw={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class B_{constructor(f,C){this._structArray=f,this._pos1=C*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Mg{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(f,C){return f._trim(),C&&(f.isTransferred=!0,C.push(f.arrayBuffer)),{length:f.length,arrayBuffer:f.arrayBuffer}}static deserialize(f){const C=Object.create(this.prototype);return C.arrayBuffer=f.arrayBuffer,C.length=f.length,C.capacity=f.arrayBuffer.byteLength/C.bytesPerElement,C._refreshViews(),C}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(f){this.reserve(f),this.length=f}reserve(f){if(f>this.capacity){this.capacity=Math.max(f,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const C=this.uint8;this._refreshViews(),C&&this.uint8.set(C)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Jg(x,f=1){let C=0,N=0;return{members:x.map(ot=>{const Bt=Cw[ot.type].BYTES_PER_ELEMENT,Jt=C=ix(C,Math.max(f,Bt)),Ir=ot.components||1;return N=Math.max(N,Bt),C+=Bt*Ir,{name:ot.name,type:ot.type,components:Ir,offset:Jt}}),size:ix(C,Math.max(N,f)),alignment:f}}function ix(x,f){return Math.ceil(x/f)*f}class wy extends Mg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(f,C){const N=this.length;return this.resize(N+1),this.emplace(N,f,C)}emplace(f,C,N){const ot=2*f;return this.int16[ot+0]=C,this.int16[ot+1]=N,f}}wy.prototype.bytesPerElement=4,Tp("StructArrayLayout2i4",wy);class sv extends Mg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(f,C,N){const ot=this.length;return this.resize(ot+1),this.emplace(ot,f,C,N)}emplace(f,C,N,ot){const Bt=3*f;return this.int16[Bt+0]=C,this.int16[Bt+1]=N,this.int16[Bt+2]=ot,f}}sv.prototype.bytesPerElement=6,Tp("StructArrayLayout3i6",sv);class av extends Mg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(f,C,N,ot){const Bt=this.length;return this.resize(Bt+1),this.emplace(Bt,f,C,N,ot)}emplace(f,C,N,ot,Bt){const Jt=4*f;return this.int16[Jt+0]=C,this.int16[Jt+1]=N,this.int16[Jt+2]=ot,this.int16[Jt+3]=Bt,f}}av.prototype.bytesPerElement=8,Tp("StructArrayLayout4i8",av);class Ym extends Mg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(f,C,N,ot,Bt,Jt){const Ir=this.length;return this.resize(Ir+1),this.emplace(Ir,f,C,N,ot,Bt,Jt)}emplace(f,C,N,ot,Bt,Jt,Ir){const wo=6*f;return this.int16[wo+0]=C,this.int16[wo+1]=N,this.int16[wo+2]=ot,this.int16[wo+3]=Bt,this.int16[wo+4]=Jt,this.int16[wo+5]=Ir,f}}Ym.prototype.bytesPerElement=12,Tp("StructArrayLayout2i4i12",Ym);class jv extends Mg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(f,C,N,ot,Bt,Jt){const Ir=this.length;return this.resize(Ir+1),this.emplace(Ir,f,C,N,ot,Bt,Jt)}emplace(f,C,N,ot,Bt,Jt,Ir){const wo=4*f,ol=8*f;return this.int16[wo+0]=C,this.int16[wo+1]=N,this.uint8[ol+4]=ot,this.uint8[ol+5]=Bt,this.uint8[ol+6]=Jt,this.uint8[ol+7]=Ir,f}}jv.prototype.bytesPerElement=8,Tp("StructArrayLayout2i4ub8",jv);class by extends Mg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(f,C){const N=this.length;return this.resize(N+1),this.emplace(N,f,C)}emplace(f,C,N){const ot=2*f;return this.float32[ot+0]=C,this.float32[ot+1]=N,f}}by.prototype.bytesPerElement=8,Tp("StructArrayLayout2f8",by);class Wv extends Mg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(f,C,N,ot,Bt,Jt,Ir,wo,ol,hl){const vl=this.length;return this.resize(vl+1),this.emplace(vl,f,C,N,ot,Bt,Jt,Ir,wo,ol,hl)}emplace(f,C,N,ot,Bt,Jt,Ir,wo,ol,hl,vl){const ah=10*f;return this.uint16[ah+0]=C,this.uint16[ah+1]=N,this.uint16[ah+2]=ot,this.uint16[ah+3]=Bt,this.uint16[ah+4]=Jt,this.uint16[ah+5]=Ir,this.uint16[ah+6]=wo,this.uint16[ah+7]=ol,this.uint16[ah+8]=hl,this.uint16[ah+9]=vl,f}}Wv.prototype.bytesPerElement=20,Tp("StructArrayLayout10ui20",Wv);class qv extends Mg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(f,C,N,ot,Bt,Jt,Ir,wo,ol,hl,vl,ah){const uh=this.length;return this.resize(uh+1),this.emplace(uh,f,C,N,ot,Bt,Jt,Ir,wo,ol,hl,vl,ah)}emplace(f,C,N,ot,Bt,Jt,Ir,wo,ol,hl,vl,ah,uh){const ph=12*f;return this.int16[ph+0]=C,this.int16[ph+1]=N,this.int16[ph+2]=ot,this.int16[ph+3]=Bt,this.uint16[ph+4]=Jt,this.uint16[ph+5]=Ir,this.uint16[ph+6]=wo,this.uint16[ph+7]=ol,this.int16[ph+8]=hl,this.int16[ph+9]=vl,this.int16[ph+10]=ah,this.int16[ph+11]=uh,f}}qv.prototype.bytesPerElement=24,Tp("StructArrayLayout4i4ui4i24",qv);class G_ extends Mg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(f,C,N){const ot=this.length;return this.resize(ot+1),this.emplace(ot,f,C,N)}emplace(f,C,N,ot){const Bt=3*f;return this.float32[Bt+0]=C,this.float32[Bt+1]=N,this.float32[Bt+2]=ot,f}}G_.prototype.bytesPerElement=12,Tp("StructArrayLayout3f12",G_);class lv extends Mg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(f){const C=this.length;return this.resize(C+1),this.emplace(C,f)}emplace(f,C){return this.uint32[1*f+0]=C,f}}lv.prototype.bytesPerElement=4,Tp("StructArrayLayout1ul4",lv);class Cy extends Mg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(f,C,N,ot,Bt,Jt,Ir,wo,ol){const hl=this.length;return this.resize(hl+1),this.emplace(hl,f,C,N,ot,Bt,Jt,Ir,wo,ol)}emplace(f,C,N,ot,Bt,Jt,Ir,wo,ol,hl){const vl=10*f,ah=5*f;return this.int16[vl+0]=C,this.int16[vl+1]=N,this.int16[vl+2]=ot,this.int16[vl+3]=Bt,this.int16[vl+4]=Jt,this.int16[vl+5]=Ir,this.uint32[ah+3]=wo,this.uint16[vl+8]=ol,this.uint16[vl+9]=hl,f}}Cy.prototype.bytesPerElement=20,Tp("StructArrayLayout6i1ul2ui20",Cy);class Ax extends Mg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(f,C,N,ot,Bt,Jt){const Ir=this.length;return this.resize(Ir+1),this.emplace(Ir,f,C,N,ot,Bt,Jt)}emplace(f,C,N,ot,Bt,Jt,Ir){const wo=6*f;return this.int16[wo+0]=C,this.int16[wo+1]=N,this.int16[wo+2]=ot,this.int16[wo+3]=Bt,this.int16[wo+4]=Jt,this.int16[wo+5]=Ir,f}}Ax.prototype.bytesPerElement=12,Tp("StructArrayLayout2i2i2i12",Ax);class v0 extends Mg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(f,C,N,ot,Bt){const Jt=this.length;return this.resize(Jt+1),this.emplace(Jt,f,C,N,ot,Bt)}emplace(f,C,N,ot,Bt,Jt){const Ir=4*f,wo=8*f;return this.float32[Ir+0]=C,this.float32[Ir+1]=N,this.float32[Ir+2]=ot,this.int16[wo+6]=Bt,this.int16[wo+7]=Jt,f}}v0.prototype.bytesPerElement=16,Tp("StructArrayLayout2f1f2i16",v0);class iy extends Mg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(f,C,N,ot){const Bt=this.length;return this.resize(Bt+1),this.emplace(Bt,f,C,N,ot)}emplace(f,C,N,ot,Bt){const Jt=12*f,Ir=3*f;return this.uint8[Jt+0]=C,this.uint8[Jt+1]=N,this.float32[Ir+1]=ot,this.float32[Ir+2]=Bt,f}}iy.prototype.bytesPerElement=12,Tp("StructArrayLayout2ub2f12",iy);class x0 extends Mg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(f,C,N){const ot=this.length;return this.resize(ot+1),this.emplace(ot,f,C,N)}emplace(f,C,N,ot){const Bt=3*f;return this.uint16[Bt+0]=C,this.uint16[Bt+1]=N,this.uint16[Bt+2]=ot,f}}x0.prototype.bytesPerElement=6,Tp("StructArrayLayout3ui6",x0);class rx extends Mg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(f,C,N,ot,Bt,Jt,Ir,wo,ol,hl,vl,ah,uh,ph,Ph,Mh,Xh){const Jh=this.length;return this.resize(Jh+1),this.emplace(Jh,f,C,N,ot,Bt,Jt,Ir,wo,ol,hl,vl,ah,uh,ph,Ph,Mh,Xh)}emplace(f,C,N,ot,Bt,Jt,Ir,wo,ol,hl,vl,ah,uh,ph,Ph,Mh,Xh,Jh){const qh=24*f,ld=12*f,pd=48*f;return this.int16[qh+0]=C,this.int16[qh+1]=N,this.uint16[qh+2]=ot,this.uint16[qh+3]=Bt,this.uint32[ld+2]=Jt,this.uint32[ld+3]=Ir,this.uint32[ld+4]=wo,this.uint16[qh+10]=ol,this.uint16[qh+11]=hl,this.uint16[qh+12]=vl,this.float32[ld+7]=ah,this.float32[ld+8]=uh,this.uint8[pd+36]=ph,this.uint8[pd+37]=Ph,this.uint8[pd+38]=Mh,this.uint32[ld+10]=Xh,this.int16[qh+22]=Jh,f}}rx.prototype.bytesPerElement=48,Tp("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",rx);class fm extends Mg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(f,C,N,ot,Bt,Jt,Ir,wo,ol,hl,vl,ah,uh,ph,Ph,Mh,Xh,Jh,qh,ld,pd,Md,Pp,bp,yp,hp,lp,Sp){const vp=this.length;return this.resize(vp+1),this.emplace(vp,f,C,N,ot,Bt,Jt,Ir,wo,ol,hl,vl,ah,uh,ph,Ph,Mh,Xh,Jh,qh,ld,pd,Md,Pp,bp,yp,hp,lp,Sp)}emplace(f,C,N,ot,Bt,Jt,Ir,wo,ol,hl,vl,ah,uh,ph,Ph,Mh,Xh,Jh,qh,ld,pd,Md,Pp,bp,yp,hp,lp,Sp,vp){const Jd=34*f,Xp=17*f;return this.int16[Jd+0]=C,this.int16[Jd+1]=N,this.int16[Jd+2]=ot,this.int16[Jd+3]=Bt,this.int16[Jd+4]=Jt,this.int16[Jd+5]=Ir,this.int16[Jd+6]=wo,this.int16[Jd+7]=ol,this.uint16[Jd+8]=hl,this.uint16[Jd+9]=vl,this.uint16[Jd+10]=ah,this.uint16[Jd+11]=uh,this.uint16[Jd+12]=ph,this.uint16[Jd+13]=Ph,this.uint16[Jd+14]=Mh,this.uint16[Jd+15]=Xh,this.uint16[Jd+16]=Jh,this.uint16[Jd+17]=qh,this.uint16[Jd+18]=ld,this.uint16[Jd+19]=pd,this.uint16[Jd+20]=Md,this.uint16[Jd+21]=Pp,this.uint16[Jd+22]=bp,this.uint32[Xp+12]=yp,this.float32[Xp+13]=hp,this.float32[Xp+14]=lp,this.float32[Xp+15]=Sp,this.float32[Xp+16]=vp,f}}fm.prototype.bytesPerElement=68,Tp("StructArrayLayout8i15ui1ul4f68",fm);class nx extends Mg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(f){const C=this.length;return this.resize(C+1),this.emplace(C,f)}emplace(f,C){return this.float32[1*f+0]=C,f}}nx.prototype.bytesPerElement=4,Tp("StructArrayLayout1f4",nx);class w0 extends Mg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(f,C,N){const ot=this.length;return this.resize(ot+1),this.emplace(ot,f,C,N)}emplace(f,C,N,ot){const Bt=4*f;return this.uint32[2*f+0]=C,this.uint16[Bt+2]=N,this.uint16[Bt+3]=ot,f}}w0.prototype.bytesPerElement=8,Tp("StructArrayLayout1ul2ui8",w0);class Ve extends Mg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(f,C){const N=this.length;return this.resize(N+1),this.emplace(N,f,C)}emplace(f,C,N){const ot=2*f;return this.uint16[ot+0]=C,this.uint16[ot+1]=N,f}}Ve.prototype.bytesPerElement=4,Tp("StructArrayLayout2ui4",Ve);class g extends Mg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(f){const C=this.length;return this.resize(C+1),this.emplace(C,f)}emplace(f,C){return this.uint16[1*f+0]=C,f}}g.prototype.bytesPerElement=2,Tp("StructArrayLayout1ui2",g);class A extends Mg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(f,C,N,ot){const Bt=this.length;return this.resize(Bt+1),this.emplace(Bt,f,C,N,ot)}emplace(f,C,N,ot,Bt){const Jt=4*f;return this.float32[Jt+0]=C,this.float32[Jt+1]=N,this.float32[Jt+2]=ot,this.float32[Jt+3]=Bt,f}}A.prototype.bytesPerElement=16,Tp("StructArrayLayout4f16",A);class _e extends B_{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new W(this.anchorPointX,this.anchorPointY)}}_e.prototype.size=20;class ct extends Cy{get(f){return new _e(this,f)}}Tp("CollisionBoxArray",ct);class pi extends B_{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(f){this._structArray.uint8[this._pos1+37]=f}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(f){this._structArray.uint8[this._pos1+38]=f}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(f){this._structArray.uint32[this._pos4+10]=f}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}pi.prototype.size=48;class In extends rx{get(f){return new pi(this,f)}}Tp("PlacedSymbolArray",In);class ds extends B_{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(f){this._structArray.uint32[this._pos4+12]=f}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}ds.prototype.size=68;class hs extends fm{get(f){return new ds(this,f)}}Tp("SymbolInstanceArray",hs);class vs extends nx{getoffsetX(f){return this.float32[1*f+0]}}Tp("GlyphOffsetArray",vs);class fl extends sv{getx(f){return this.int16[3*f+0]}gety(f){return this.int16[3*f+1]}gettileUnitDistanceFromAnchor(f){return this.int16[3*f+2]}}Tp("SymbolLineVertexArray",fl);class dl extends B_{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}dl.prototype.size=8;class dh extends w0{get(f){return new dl(this,f)}}Tp("FeatureIndexArray",dh);class Ah extends wy{}class hh extends wy{}class Rh extends wy{}class zh extends Ym{}class Kh extends jv{}class ad extends by{}class Lh extends Wv{}class od extends qv{}class md extends G_{}class Nd extends lv{}class Hd extends Ax{}class tp extends iy{}class Vd extends x0{}class gp extends Ve{}const L=Jg([{name:"a_pos",components:2,type:"Int16"}],4),{members:p}=L;class S{constructor(f=[]){this.segments=f}prepareSegment(f,C,N,ot){let Bt=this.segments[this.segments.length-1];return f>S.MAX_VERTEX_ARRAY_LENGTH&&rl(`Max vertices per segment is ${S.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${f}`),(!Bt||Bt.vertexLength+f>S.MAX_VERTEX_ARRAY_LENGTH||Bt.sortKey!==ot)&&(Bt={vertexOffset:C.length,primitiveOffset:N.length,vertexLength:0,primitiveLength:0},ot!==void 0&&(Bt.sortKey=ot),this.segments.push(Bt)),Bt}get(){return this.segments}destroy(){for(const f of this.segments)for(const C in f.vaos)f.vaos[C].destroy()}static simpleSegment(f,C,N,ot){return new S([{vertexOffset:f,primitiveOffset:C,vertexLength:N,primitiveLength:ot,vaos:{},sortKey:0}])}}function X(x,f){return 256*(x=Bn(Math.floor(x),0,255))+Bn(Math.floor(f),0,255)}S.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Tp("SegmentVector",S);const ze=Jg([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var kt={exports:{}},vi={exports:{}};vi.exports=function(x,f){var C,N,ot,Bt,Jt,Ir,wo,ol;for(N=x.length-(C=3&x.length),ot=f,Jt=3432918353,Ir=461845907,ol=0;ol<N;)wo=255&x.charCodeAt(ol)|(255&x.charCodeAt(++ol))<<8|(255&x.charCodeAt(++ol))<<16|(255&x.charCodeAt(++ol))<<24,++ol,ot=27492+(65535&(Bt=5*(65535&(ot=(ot^=wo=(65535&(wo=(wo=(65535&wo)*Jt+(((wo>>>16)*Jt&65535)<<16)&4294967295)<<15|wo>>>17))*Ir+(((wo>>>16)*Ir&65535)<<16)&4294967295)<<13|ot>>>19))+((5*(ot>>>16)&65535)<<16)&4294967295))+((58964+(Bt>>>16)&65535)<<16);switch(wo=0,C){case 3:wo^=(255&x.charCodeAt(ol+2))<<16;case 2:wo^=(255&x.charCodeAt(ol+1))<<8;case 1:ot^=wo=(65535&(wo=(wo=(65535&(wo^=255&x.charCodeAt(ol)))*Jt+(((wo>>>16)*Jt&65535)<<16)&4294967295)<<15|wo>>>17))*Ir+(((wo>>>16)*Ir&65535)<<16)&4294967295}return ot^=x.length,ot=2246822507*(65535&(ot^=ot>>>16))+((2246822507*(ot>>>16)&65535)<<16)&4294967295,ot=3266489909*(65535&(ot^=ot>>>13))+((3266489909*(ot>>>16)&65535)<<16)&4294967295,(ot^=ot>>>16)>>>0};var or=vi.exports,Gn={exports:{}};Gn.exports=function(x,f){for(var C,N=x.length,ot=f^N,Bt=0;N>=4;)C=1540483477*(65535&(C=255&x.charCodeAt(Bt)|(255&x.charCodeAt(++Bt))<<8|(255&x.charCodeAt(++Bt))<<16|(255&x.charCodeAt(++Bt))<<24))+((1540483477*(C>>>16)&65535)<<16),ot=1540483477*(65535&ot)+((1540483477*(ot>>>16)&65535)<<16)^(C=1540483477*(65535&(C^=C>>>24))+((1540483477*(C>>>16)&65535)<<16)),N-=4,++Bt;switch(N){case 3:ot^=(255&x.charCodeAt(Bt+2))<<16;case 2:ot^=(255&x.charCodeAt(Bt+1))<<8;case 1:ot=1540483477*(65535&(ot^=255&x.charCodeAt(Bt)))+((1540483477*(ot>>>16)&65535)<<16)}return ot=1540483477*(65535&(ot^=ot>>>13))+((1540483477*(ot>>>16)&65535)<<16),(ot^=ot>>>15)>>>0};var ia=or,oa=Gn.exports;kt.exports=ia,kt.exports.murmur3=ia,kt.exports.murmur2=oa;var pl=m(kt.exports);class lh{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(f,C,N,ot){this.ids.push(gh(f)),this.positions.push(C,N,ot)}getPositions(f){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const C=gh(f);let N=0,ot=this.ids.length-1;for(;N<ot;){const Jt=N+ot>>1;this.ids[Jt]>=C?ot=Jt:N=Jt+1}const Bt=[];for(;this.ids[N]===C;)Bt.push({index:this.positions[3*N],start:this.positions[3*N+1],end:this.positions[3*N+2]}),N++;return Bt}static serialize(f,C){const N=new Float64Array(f.ids),ot=new Uint32Array(f.positions);return yh(N,ot,0,N.length-1),C&&C.push(N.buffer,ot.buffer),{ids:N,positions:ot}}static deserialize(f){const C=new lh;return C.ids=f.ids,C.positions=f.positions,C.indexed=!0,C}}function gh(x){const f=+x;return!isNaN(f)&&f<=Number.MAX_SAFE_INTEGER?f:pl(String(x))}function yh(x,f,C,N){for(;C<N;){const ot=x[C+N>>1];let Bt=C-1,Jt=N+1;for(;;){do Bt++;while(x[Bt]<ot);do Jt--;while(x[Jt]>ot);if(Bt>=Jt)break;_h(x,Bt,Jt),_h(f,3*Bt,3*Jt),_h(f,3*Bt+1,3*Jt+1),_h(f,3*Bt+2,3*Jt+2)}Jt-C<N-Jt?(yh(x,f,C,Jt),C=Jt+1):(yh(x,f,Jt+1,N),N=Jt)}}function _h(x,f,C){const N=x[f];x[f]=x[C],x[C]=N}Tp("FeaturePositionMap",lh);class xh{constructor(f,C){this.gl=f.gl,this.location=C}}class _l extends xh{constructor(f,C){super(f,C),this.current=0}set(f){this.current!==f&&(this.current=f,this.gl.uniform1f(this.location,f))}}class mh extends xh{constructor(f,C){super(f,C),this.current=[0,0,0,0]}set(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]&&f[3]===this.current[3]||(this.current=f,this.gl.uniform4f(this.location,f[0],f[1],f[2],f[3]))}}class wh extends xh{constructor(f,C){super(f,C),this.current=Yp.transparent}set(f){f.r===this.current.r&&f.g===this.current.g&&f.b===this.current.b&&f.a===this.current.a||(this.current=f,this.gl.uniform4f(this.location,f.r,f.g,f.b,f.a))}}const Sh=new Float32Array(16);function Oh(x){return[X(255*x.r,255*x.g),X(255*x.b,255*x.a)]}class Uh{constructor(f,C,N){this.value=f,this.uniformNames=C.map(ot=>`u_${ot}`),this.type=N}setUniform(f,C,N){f.set(N.constantOr(this.value))}getBinding(f,C,N){return this.type==="color"?new wh(f,C):new _l(f,C)}}class Vh{constructor(f,C){this.uniformNames=C.map(N=>`u_${N}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(f,C){this.pixelRatioFrom=C.pixelRatio,this.pixelRatioTo=f.pixelRatio,this.patternFrom=C.tlbr,this.patternTo=f.tlbr}setUniform(f,C,N,ot){const Bt=ot==="u_pattern_to"?this.patternTo:ot==="u_pattern_from"?this.patternFrom:ot==="u_pixel_ratio_to"?this.pixelRatioTo:ot==="u_pixel_ratio_from"?this.pixelRatioFrom:null;Bt&&f.set(Bt)}getBinding(f,C,N){return N.substr(0,9)==="u_pattern"?new mh(f,C):new _l(f,C)}}class Wh{constructor(f,C,N,ot){this.expression=f,this.type=N,this.maxValue=0,this.paintVertexAttributes=C.map(Bt=>({name:`a_${Bt}`,type:"Float32",components:N==="color"?2:1,offset:0})),this.paintVertexArray=new ot}populatePaintArray(f,C,N,ot,Bt){const Jt=this.paintVertexArray.length,Ir=this.expression.evaluate(new Eg(0),C,{},ot,[],Bt);this.paintVertexArray.resize(f),this._setPaintValue(Jt,f,Ir)}updatePaintArray(f,C,N,ot){const Bt=this.expression.evaluate({zoom:0},N,ot);this._setPaintValue(f,C,Bt)}_setPaintValue(f,C,N){if(this.type==="color"){const ot=Oh(N);for(let Bt=f;Bt<C;Bt++)this.paintVertexArray.emplace(Bt,ot[0],ot[1])}else{for(let ot=f;ot<C;ot++)this.paintVertexArray.emplace(ot,N);this.maxValue=Math.max(this.maxValue,Math.abs(N))}}upload(f){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=f.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Zh{constructor(f,C,N,ot,Bt,Jt){this.expression=f,this.uniformNames=C.map(Ir=>`u_${Ir}_t`),this.type=N,this.useIntegerZoom=ot,this.zoom=Bt,this.maxValue=0,this.paintVertexAttributes=C.map(Ir=>({name:`a_${Ir}`,type:"Float32",components:N==="color"?4:2,offset:0})),this.paintVertexArray=new Jt}populatePaintArray(f,C,N,ot,Bt){const Jt=this.expression.evaluate(new Eg(this.zoom),C,{},ot,[],Bt),Ir=this.expression.evaluate(new Eg(this.zoom+1),C,{},ot,[],Bt),wo=this.paintVertexArray.length;this.paintVertexArray.resize(f),this._setPaintValue(wo,f,Jt,Ir)}updatePaintArray(f,C,N,ot){const Bt=this.expression.evaluate({zoom:this.zoom},N,ot),Jt=this.expression.evaluate({zoom:this.zoom+1},N,ot);this._setPaintValue(f,C,Bt,Jt)}_setPaintValue(f,C,N,ot){if(this.type==="color"){const Bt=Oh(N),Jt=Oh(ot);for(let Ir=f;Ir<C;Ir++)this.paintVertexArray.emplace(Ir,Bt[0],Bt[1],Jt[0],Jt[1])}else{for(let Bt=f;Bt<C;Bt++)this.paintVertexArray.emplace(Bt,N,ot);this.maxValue=Math.max(this.maxValue,Math.abs(N),Math.abs(ot))}}upload(f){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=f.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(f,C){const N=this.useIntegerZoom?Math.floor(C.zoom):C.zoom,ot=Bn(this.expression.interpolationFactor(N,this.zoom,this.zoom+1),0,1);f.set(ot)}getBinding(f,C,N){return new _l(f,C)}}class id{constructor(f,C,N,ot,Bt,Jt){this.expression=f,this.type=C,this.useIntegerZoom=N,this.zoom=ot,this.layerId=Jt,this.zoomInPaintVertexArray=new Bt,this.zoomOutPaintVertexArray=new Bt}populatePaintArray(f,C,N){const ot=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(f),this.zoomOutPaintVertexArray.resize(f),this._setPaintValues(ot,f,C.patterns&&C.patterns[this.layerId],N)}updatePaintArray(f,C,N,ot,Bt){this._setPaintValues(f,C,N.patterns&&N.patterns[this.layerId],Bt)}_setPaintValues(f,C,N,ot){if(!ot||!N)return;const{min:Bt,mid:Jt,max:Ir}=N,wo=ot[Bt],ol=ot[Jt],hl=ot[Ir];if(wo&&ol&&hl)for(let vl=f;vl<C;vl++)this.zoomInPaintVertexArray.emplace(vl,ol.tl[0],ol.tl[1],ol.br[0],ol.br[1],wo.tl[0],wo.tl[1],wo.br[0],wo.br[1],ol.pixelRatio,wo.pixelRatio),this.zoomOutPaintVertexArray.emplace(vl,ol.tl[0],ol.tl[1],ol.br[0],ol.br[1],hl.tl[0],hl.tl[1],hl.br[0],hl.br[1],ol.pixelRatio,hl.pixelRatio)}upload(f){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=f.createVertexBuffer(this.zoomInPaintVertexArray,ze.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=f.createVertexBuffer(this.zoomOutPaintVertexArray,ze.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Bd{constructor(f,C,N){this.binders={},this._buffers=[];const ot=[];for(const Bt in f.paint._values){if(!N(Bt))continue;const Jt=f.paint.get(Bt);if(!(Jt instanceof Xm&&fy(Jt.property.specification)))continue;const Ir=Sd(Bt,f.type),wo=Jt.value,ol=Jt.property.specification.type,hl=Jt.property.useIntegerZoom,vl=Jt.property.specification["property-type"],ah=vl==="cross-faded"||vl==="cross-faded-data-driven";if(wo.kind==="constant")this.binders[Bt]=ah?new Vh(wo.value,Ir):new Uh(wo.value,Ir,ol),ot.push(`/u_${Bt}`);else if(wo.kind==="source"||ah){const uh=dd(Bt,ol,"source");this.binders[Bt]=ah?new id(wo,ol,hl,C,uh,f.id):new Wh(wo,Ir,ol,uh),ot.push(`/a_${Bt}`)}else{const uh=dd(Bt,ol,"composite");this.binders[Bt]=new Zh(wo,Ir,ol,hl,C,uh),ot.push(`/z_${Bt}`)}}this.cacheKey=ot.sort().join("")}getMaxValue(f){const C=this.binders[f];return C instanceof Wh||C instanceof Zh?C.maxValue:0}populatePaintArrays(f,C,N,ot,Bt){for(const Jt in this.binders){const Ir=this.binders[Jt];(Ir instanceof Wh||Ir instanceof Zh||Ir instanceof id)&&Ir.populatePaintArray(f,C,N,ot,Bt)}}setConstantPatternPositions(f,C){for(const N in this.binders){const ot=this.binders[N];ot instanceof Vh&&ot.setConstantPatternPositions(f,C)}}updatePaintArrays(f,C,N,ot,Bt){let Jt=!1;for(const Ir in f){const wo=C.getPositions(Ir);for(const ol of wo){const hl=N.feature(ol.index);for(const vl in this.binders){const ah=this.binders[vl];if((ah instanceof Wh||ah instanceof Zh||ah instanceof id)&&ah.expression.isStateDependent===!0){const uh=ot.paint.get(vl);ah.expression=uh.value,ah.updatePaintArray(ol.start,ol.end,hl,f[Ir],Bt),Jt=!0}}}}return Jt}defines(){const f=[];for(const C in this.binders){const N=this.binders[C];(N instanceof Uh||N instanceof Vh)&&f.push(...N.uniformNames.map(ot=>`#define HAS_UNIFORM_${ot}`))}return f}getBinderAttributes(){const f=[];for(const C in this.binders){const N=this.binders[C];if(N instanceof Wh||N instanceof Zh)for(let ot=0;ot<N.paintVertexAttributes.length;ot++)f.push(N.paintVertexAttributes[ot].name);else if(N instanceof id)for(let ot=0;ot<ze.members.length;ot++)f.push(ze.members[ot].name)}return f}getBinderUniforms(){const f=[];for(const C in this.binders){const N=this.binders[C];if(N instanceof Uh||N instanceof Vh||N instanceof Zh)for(const ot of N.uniformNames)f.push(ot)}return f}getPaintVertexBuffers(){return this._buffers}getUniforms(f,C){const N=[];for(const ot in this.binders){const Bt=this.binders[ot];if(Bt instanceof Uh||Bt instanceof Vh||Bt instanceof Zh){for(const Jt of Bt.uniformNames)if(C[Jt]){const Ir=Bt.getBinding(f,C[Jt],Jt);N.push({name:Jt,property:ot,binding:Ir})}}}return N}setUniforms(f,C,N,ot){for(const{name:Bt,property:Jt,binding:Ir}of C)this.binders[Jt].setUniform(Ir,ot,N.get(Jt),Bt)}updatePaintBuffers(f){this._buffers=[];for(const C in this.binders){const N=this.binders[C];if(f&&N instanceof id){const ot=f.fromScale===2?N.zoomInPaintVertexBuffer:N.zoomOutPaintVertexBuffer;ot&&this._buffers.push(ot)}else(N instanceof Wh||N instanceof Zh)&&N.paintVertexBuffer&&this._buffers.push(N.paintVertexBuffer)}}upload(f){for(const C in this.binders){const N=this.binders[C];(N instanceof Wh||N instanceof Zh||N instanceof id)&&N.upload(f)}this.updatePaintBuffers()}destroy(){for(const f in this.binders){const C=this.binders[f];(C instanceof Wh||C instanceof Zh||C instanceof id)&&C.destroy()}}}class ed{constructor(f,C,N=()=>!0){this.programConfigurations={};for(const ot of f)this.programConfigurations[ot.id]=new Bd(ot,C,N);this.needsUpload=!1,this._featureMap=new lh,this._bufferOffset=0}populatePaintArrays(f,C,N,ot,Bt,Jt){for(const Ir in this.programConfigurations)this.programConfigurations[Ir].populatePaintArrays(f,C,ot,Bt,Jt);C.id!==void 0&&this._featureMap.add(C.id,N,this._bufferOffset,f),this._bufferOffset=f,this.needsUpload=!0}updatePaintArrays(f,C,N,ot){for(const Bt of N)this.needsUpload=this.programConfigurations[Bt.id].updatePaintArrays(f,this._featureMap,C,Bt,ot)||this.needsUpload}get(f){return this.programConfigurations[f]}upload(f){if(this.needsUpload){for(const C in this.programConfigurations)this.programConfigurations[C].upload(f);this.needsUpload=!1}}destroy(){for(const f in this.programConfigurations)this.programConfigurations[f].destroy()}}function Sd(x,f){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[x]||[x.replace(`${f}-`,"").replace(/-/g,"_")]}function dd(x,f,C){const N={color:{source:by,composite:A},number:{source:nx,composite:by}},ot=function(Bt){return{"line-pattern":{source:Lh,composite:Lh},"fill-pattern":{source:Lh,composite:Lh},"fill-extrusion-pattern":{source:Lh,composite:Lh}}[Bt]}(x);return ot&&ot[C]||N[f][C]}Tp("ConstantBinder",Uh),Tp("CrossFadedConstantBinder",Vh),Tp("SourceExpressionBinder",Wh),Tp("CrossFadedCompositeBinder",id),Tp("CompositeExpressionBinder",Zh),Tp("ProgramConfiguration",Bd,{omit:["_buffers"]}),Tp("ProgramConfigurationSet",ed);var xd=8192;const nd=Math.pow(2,14)-1,vd=-nd-1;function Od(x){const f=xd/x.extent,C=x.loadGeometry();for(let N=0;N<C.length;N++){const ot=C[N];for(let Bt=0;Bt<ot.length;Bt++){const Jt=ot[Bt],Ir=Math.round(Jt.x*f),wo=Math.round(Jt.y*f);Jt.x=Bn(Ir,vd,nd),Jt.y=Bn(wo,vd,nd),(Ir<Jt.x||Ir>Jt.x+1||wo<Jt.y||wo>Jt.y+1)&&rl("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return C}function Id(x,f){return{type:x.type,id:x.id,properties:x.properties,geometry:f?Od(x):[]}}function $d(x,f,C,N,ot){x.emplaceBack(2*f+(N+1)/2,2*C+(ot+1)/2)}class Gp{constructor(f){this.zoom=f.zoom,this.overscaling=f.overscaling,this.layers=f.layers,this.layerIds=this.layers.map(C=>C.id),this.index=f.index,this.hasPattern=!1,this.layoutVertexArray=new hh,this.indexArray=new Vd,this.segments=new S,this.programConfigurations=new ed(f.layers,f.zoom),this.stateDependentLayerIds=this.layers.filter(C=>C.isStateDependent()).map(C=>C.id)}populate(f,C,N){const ot=this.layers[0],Bt=[];let Jt=null,Ir=!1;ot.type==="circle"&&(Jt=ot.layout.get("circle-sort-key"),Ir=!Jt.isConstant());for(const{feature:wo,id:ol,index:hl,sourceLayerIndex:vl}of f){const ah=this.layers[0]._featureFilter.needGeometry,uh=Id(wo,ah);if(!this.layers[0]._featureFilter.filter(new Eg(this.zoom),uh,N))continue;const ph=Ir?Jt.evaluate(uh,{},N):void 0,Ph={id:ol,properties:wo.properties,type:wo.type,sourceLayerIndex:vl,index:hl,geometry:ah?uh.geometry:Od(wo),patterns:{},sortKey:ph};Bt.push(Ph)}Ir&&Bt.sort((wo,ol)=>wo.sortKey-ol.sortKey);for(const wo of Bt){const{geometry:ol,index:hl,sourceLayerIndex:vl}=wo,ah=f[hl].feature;this.addFeature(wo,ol,hl,N),C.featureIndex.insert(ah,ol,hl,vl,this.index)}}update(f,C,N){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(f,C,this.stateDependentLayers,N)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(f){this.uploaded||(this.layoutVertexBuffer=f.createVertexBuffer(this.layoutVertexArray,p),this.indexBuffer=f.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(f),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(f,C,N,ot){for(const Bt of C)for(const Jt of Bt){const Ir=Jt.x,wo=Jt.y;if(Ir<0||Ir>=xd||wo<0||wo>=xd)continue;const ol=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,f.sortKey),hl=ol.vertexLength;$d(this.layoutVertexArray,Ir,wo,-1,-1),$d(this.layoutVertexArray,Ir,wo,1,-1),$d(this.layoutVertexArray,Ir,wo,1,1),$d(this.layoutVertexArray,Ir,wo,-1,1),this.indexArray.emplaceBack(hl,hl+1,hl+2),this.indexArray.emplaceBack(hl,hl+3,hl+2),ol.vertexLength+=4,ol.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,f,N,{},ot)}}function Hf(x,f){for(let C=0;C<x.length;C++)if(gg(f,x[C]))return!0;for(let C=0;C<f.length;C++)if(gg(x,f[C]))return!0;return!!Jf(x,f)}function Mp(x,f,C){return!!gg(x,f)||!!fg(f,x,C)}function Zp(x,f){if(x.length===1)return Tg(f,x[0]);for(let C=0;C<f.length;C++){const N=f[C];for(let ot=0;ot<N.length;ot++)if(gg(x,N[ot]))return!0}for(let C=0;C<x.length;C++)if(Tg(f,x[C]))return!0;for(let C=0;C<f.length;C++)if(Jf(x,f[C]))return!0;return!1}function rg(x,f,C){if(x.length>1){if(Jf(x,f))return!0;for(let N=0;N<f.length;N++)if(fg(f[N],x,C))return!0}for(let N=0;N<x.length;N++)if(fg(x[N],f,C))return!0;return!1}function Jf(x,f){if(x.length===0||f.length===0)return!1;for(let C=0;C<x.length-1;C++){const N=x[C],ot=x[C+1];for(let Bt=0;Bt<f.length-1;Bt++)if(Bp(N,ot,f[Bt],f[Bt+1]))return!0}return!1}function Bp(x,f,C,N){return th(x,C,N)!==th(f,C,N)&&th(x,f,C)!==th(x,f,N)}function fg(x,f,C){const N=C*C;if(f.length===1)return x.distSqr(f[0])<N;for(let ot=1;ot<f.length;ot++)if(Sg(x,f[ot-1],f[ot])<N)return!0;return!1}function Sg(x,f,C){const N=f.distSqr(C);if(N===0)return x.distSqr(f);const ot=((x.x-f.x)*(C.x-f.x)+(x.y-f.y)*(C.y-f.y))/N;return x.distSqr(ot<0?f:ot>1?C:C.sub(f)._mult(ot)._add(f))}function Tg(x,f){let C,N,ot,Bt=!1;for(let Jt=0;Jt<x.length;Jt++){C=x[Jt];for(let Ir=0,wo=C.length-1;Ir<C.length;wo=Ir++)N=C[Ir],ot=C[wo],N.y>f.y!=ot.y>f.y&&f.x<(ot.x-N.x)*(f.y-N.y)/(ot.y-N.y)+N.x&&(Bt=!Bt)}return Bt}function gg(x,f){let C=!1;for(let N=0,ot=x.length-1;N<x.length;ot=N++){const Bt=x[N],Jt=x[ot];Bt.y>f.y!=Jt.y>f.y&&f.x<(Jt.x-Bt.x)*(f.y-Bt.y)/(Jt.y-Bt.y)+Bt.x&&(C=!C)}return C}function Jm(x,f,C){const N=C[0],ot=C[2];if(x.x<N.x&&f.x<N.x||x.x>ot.x&&f.x>ot.x||x.y<N.y&&f.y<N.y||x.y>ot.y&&f.y>ot.y)return!1;const Bt=th(x,f,C[0]);return Bt!==th(x,f,C[1])||Bt!==th(x,f,C[2])||Bt!==th(x,f,C[3])}function om(x,f,C){const N=f.paint.get(x).value;return N.kind==="constant"?N.value:C.programConfigurations.get(f.id).getMaxValue(x)}function c_(x){return Math.sqrt(x[0]*x[0]+x[1]*x[1])}function I_(x,f,C,N,ot){if(!f[0]&&!f[1])return x;const Bt=W.convert(f)._mult(ot);C==="viewport"&&Bt._rotate(-N);const Jt=[];for(let Ir=0;Ir<x.length;Ir++)Jt.push(x[Ir].sub(Bt));return Jt}let Ug,Ag;Tp("CircleBucket",Gp,{omit:["layers"]});var mg={get paint(){return Ag=Ag||new Am({"circle-radius":new Kp(Yh.paint_circle["circle-radius"]),"circle-color":new Kp(Yh.paint_circle["circle-color"]),"circle-blur":new Kp(Yh.paint_circle["circle-blur"]),"circle-opacity":new Kp(Yh.paint_circle["circle-opacity"]),"circle-translate":new Np(Yh.paint_circle["circle-translate"]),"circle-translate-anchor":new Np(Yh.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Np(Yh.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Np(Yh.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Kp(Yh.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Kp(Yh.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Kp(Yh.paint_circle["circle-stroke-opacity"])})},get layout(){return Ug=Ug||new Am({"circle-sort-key":new Kp(Yh.layout_circle["circle-sort-key"])})}},pg=1e-6,wm=typeof Float32Array<"u"?Float32Array:Array;function Pg(x){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x}function u_(x,f,C){var N=f[0],ot=f[1],Bt=f[2],Jt=f[3],Ir=f[4],wo=f[5],ol=f[6],hl=f[7],vl=f[8],ah=f[9],uh=f[10],ph=f[11],Ph=f[12],Mh=f[13],Xh=f[14],Jh=f[15],qh=C[0],ld=C[1],pd=C[2],Md=C[3];return x[0]=qh*N+ld*Ir+pd*vl+Md*Ph,x[1]=qh*ot+ld*wo+pd*ah+Md*Mh,x[2]=qh*Bt+ld*ol+pd*uh+Md*Xh,x[3]=qh*Jt+ld*hl+pd*ph+Md*Jh,x[4]=(qh=C[4])*N+(ld=C[5])*Ir+(pd=C[6])*vl+(Md=C[7])*Ph,x[5]=qh*ot+ld*wo+pd*ah+Md*Mh,x[6]=qh*Bt+ld*ol+pd*uh+Md*Xh,x[7]=qh*Jt+ld*hl+pd*ph+Md*Jh,x[8]=(qh=C[8])*N+(ld=C[9])*Ir+(pd=C[10])*vl+(Md=C[11])*Ph,x[9]=qh*ot+ld*wo+pd*ah+Md*Mh,x[10]=qh*Bt+ld*ol+pd*uh+Md*Xh,x[11]=qh*Jt+ld*hl+pd*ph+Md*Jh,x[12]=(qh=C[12])*N+(ld=C[13])*Ir+(pd=C[14])*vl+(Md=C[15])*Ph,x[13]=qh*ot+ld*wo+pd*ah+Md*Mh,x[14]=qh*Bt+ld*ol+pd*uh+Md*Xh,x[15]=qh*Jt+ld*hl+pd*ph+Md*Jh,x}Math.hypot||(Math.hypot=function(){for(var x=0,f=arguments.length;f--;)x+=arguments[f]*arguments[f];return Math.sqrt(x)});var Kv,b0=u_;function Zv(x,f,C){var N=f[0],ot=f[1],Bt=f[2],Jt=f[3];return x[0]=C[0]*N+C[4]*ot+C[8]*Bt+C[12]*Jt,x[1]=C[1]*N+C[5]*ot+C[9]*Bt+C[13]*Jt,x[2]=C[2]*N+C[6]*ot+C[10]*Bt+C[14]*Jt,x[3]=C[3]*N+C[7]*ot+C[11]*Bt+C[15]*Jt,x}function Ey(x,f){const C=Zv([],[x.x,x.y,0,1],f);return new W(C[0]/C[3],C[1]/C[3])}Kv=new wm(4),wm!=Float32Array&&(Kv[0]=0,Kv[1]=0,Kv[2]=0,Kv[3]=0);class cv extends Gp{}let Xv;Tp("HeatmapBucket",cv,{omit:["layers"]});var $x={get paint(){return Xv=Xv||new Am({"heatmap-radius":new Kp(Yh.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Kp(Yh.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Np(Yh.paint_heatmap["heatmap-intensity"]),"heatmap-color":new tx(Yh.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Np(Yh.paint_heatmap["heatmap-opacity"])})}};function C0(x,{width:f,height:C},N,ot){if(ot){if(ot instanceof Uint8ClampedArray)ot=new Uint8Array(ot.buffer);else if(ot.length!==f*C*N)throw new RangeError(`mismatched image size. expected: ${ot.length} but got: ${f*C*N}`)}else ot=new Uint8Array(f*C*N);return x.width=f,x.height=C,x.data=ot,x}function Hx(x,{width:f,height:C},N){if(f===x.width&&C===x.height)return;const ot=C0({},{width:f,height:C},N);n1(x,ot,{x:0,y:0},{x:0,y:0},{width:Math.min(x.width,f),height:Math.min(x.height,C)},N),x.width=f,x.height=C,x.data=ot.data}function n1(x,f,C,N,ot,Bt){if(ot.width===0||ot.height===0)return f;if(ot.width>x.width||ot.height>x.height||C.x>x.width-ot.width||C.y>x.height-ot.height)throw new RangeError("out of range source coordinates for image copy");if(ot.width>f.width||ot.height>f.height||N.x>f.width-ot.width||N.y>f.height-ot.height)throw new RangeError("out of range destination coordinates for image copy");const Jt=x.data,Ir=f.data;if(Jt===Ir)throw new Error("srcData equals dstData, so image is already copied");for(let wo=0;wo<ot.height;wo++){const ol=((C.y+wo)*x.width+C.x)*Bt,hl=((N.y+wo)*f.width+N.x)*Bt;for(let vl=0;vl<ot.width*Bt;vl++)Ir[hl+vl]=Jt[ol+vl]}return f}class jx{constructor(f,C){C0(this,f,1,C)}resize(f){Hx(this,f,1)}clone(){return new jx({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(f,C,N,ot,Bt){n1(f,C,N,ot,Bt,1)}}class ry{constructor(f,C){C0(this,f,4,C)}resize(f){Hx(this,f,4)}replace(f,C){C?this.data.set(f):this.data=f instanceof Uint8ClampedArray?new Uint8Array(f.buffer):f}clone(){return new ry({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(f,C,N,ot,Bt){n1(f,C,N,ot,Bt,4)}}function o1(x){const f={},C=x.resolution||256,N=x.clips?x.clips.length:1,ot=x.image||new ry({width:C,height:N});if(Math.log(C)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${C}`);const Bt=(Jt,Ir,wo)=>{f[x.evaluationKey]=wo;const ol=x.expression.evaluate(f);ot.data[Jt+Ir+0]=Math.floor(255*ol.r/ol.a),ot.data[Jt+Ir+1]=Math.floor(255*ol.g/ol.a),ot.data[Jt+Ir+2]=Math.floor(255*ol.b/ol.a),ot.data[Jt+Ir+3]=Math.floor(255*ol.a)};if(x.clips)for(let Jt=0,Ir=0;Jt<N;++Jt,Ir+=4*C)for(let wo=0,ol=0;wo<C;wo++,ol+=4){const hl=wo/(C-1),{start:vl,end:ah}=x.clips[Jt];Bt(Ir,ol,vl*(1-hl)+ah*hl)}else for(let Jt=0,Ir=0;Jt<C;Jt++,Ir+=4)Bt(0,Ir,Jt/(C-1));return ot}let Ew;Tp("AlphaImage",jx),Tp("RGBAImage",ry);var Hb={get paint(){return Ew=Ew||new Am({"hillshade-illumination-direction":new Np(Yh.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Np(Yh.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Np(Yh.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Np(Yh.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Np(Yh.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Np(Yh.paint_hillshade["hillshade-accent-color"])})}};const W1=Jg([{name:"a_pos",components:2,type:"Int16"}],4),{members:s1}=W1;var uv={exports:{}};function Rx(x,f,C){C=C||2;var N,ot,Bt,Jt,Ir,wo,ol,hl=f&&f.length,vl=hl?f[0]*C:x.length,ah=q1(x,0,vl,C,!0),uh=[];if(!ah||ah.next===ah.prev)return uh;if(hl&&(ah=function(Ph,Mh,Xh,Jh){var qh,ld,pd,Md=[];for(qh=0,ld=Mh.length;qh<ld;qh++)(pd=q1(Ph,Mh[qh]*Jh,qh<ld-1?Mh[qh+1]*Jh:Ph.length,Jh,!1))===pd.next&&(pd.steiner=!0),Md.push(sx(pd));for(Md.sort(Wx),qh=0;qh<Md.length;qh++)Xh=E0(Md[qh],Xh);return Xh}(x,f,ah,C)),x.length>80*C){N=Bt=x[0],ot=Jt=x[1];for(var ph=C;ph<vl;ph+=C)(Ir=x[ph])<N&&(N=Ir),(wo=x[ph+1])<ot&&(ot=wo),Ir>Bt&&(Bt=Ir),wo>Jt&&(Jt=wo);ol=(ol=Math.max(Bt-N,Jt-ot))!==0?32767/ol:0}return Sw(ah,uh,C,N,ot,ol,0),uh}function q1(x,f,C,N,ot){var Bt,Jt;if(ot===Jv(x,f,C,N)>0)for(Bt=f;Bt<C;Bt+=N)Jt=qb(Bt,x[Bt],x[Bt+1],Jt);else for(Bt=C-N;Bt>=f;Bt-=N)Jt=qb(Bt,x[Bt],x[Bt+1],Jt);return Jt&&a1(Jt,Jt.next)&&(Kg(Jt),Jt=Jt.next),Jt}function ox(x,f){if(!x)return x;f||(f=x);var C,N=x;do if(C=!1,N.steiner||!a1(N,N.next)&&gm(N.prev,N,N.next)!==0)N=N.next;else{if(Kg(N),(N=f=N.prev)===N.next)break;C=!0}while(C||N!==f);return f}function Sw(x,f,C,N,ot,Bt,Jt){if(x){!Jt&&Bt&&function(hl,vl,ah,uh){var ph=hl;do ph.z===0&&(ph.z=Yv(ph.x,ph.y,vl,ah,uh)),ph.prevZ=ph.prev,ph.nextZ=ph.next,ph=ph.next;while(ph!==hl);ph.prevZ.nextZ=null,ph.prevZ=null,function(Ph){var Mh,Xh,Jh,qh,ld,pd,Md,Pp,bp=1;do{for(Xh=Ph,Ph=null,ld=null,pd=0;Xh;){for(pd++,Jh=Xh,Md=0,Mh=0;Mh<bp&&(Md++,Jh=Jh.nextZ);Mh++);for(Pp=bp;Md>0||Pp>0&&Jh;)Md!==0&&(Pp===0||!Jh||Xh.z<=Jh.z)?(qh=Xh,Xh=Xh.nextZ,Md--):(qh=Jh,Jh=Jh.nextZ,Pp--),ld?ld.nextZ=qh:Ph=qh,qh.prevZ=ld,ld=qh;Xh=Jh}ld.nextZ=null,bp*=2}while(pd>1)}(ph)}(x,N,ot,Bt);for(var Ir,wo,ol=x;x.prev!==x.next;)if(Ir=x.prev,wo=x.next,Bt?YC(x,N,ot,Bt):XC(x))f.push(Ir.i/C|0),f.push(x.i/C|0),f.push(wo.i/C|0),Kg(x),x=wo.next,ol=wo.next;else if((x=wo)===ol){Jt?Jt===1?Sw(x=K1(ox(x),f,C),f,C,N,ot,Bt,2):Jt===2&&Tw(x,f,C,N,ot,Bt):Sw(ox(x),f,C,N,ot,Bt,1);break}}}function XC(x){var f=x.prev,C=x,N=x.next;if(gm(f,C,N)>=0)return!1;for(var ot=f.x,Bt=C.x,Jt=N.x,Ir=f.y,wo=C.y,ol=N.y,hl=ot<Bt?ot<Jt?ot:Jt:Bt<Jt?Bt:Jt,vl=Ir<wo?Ir<ol?Ir:ol:wo<ol?wo:ol,ah=ot>Bt?ot>Jt?ot:Jt:Bt>Jt?Bt:Jt,uh=Ir>wo?Ir>ol?Ir:ol:wo>ol?wo:ol,ph=N.next;ph!==f;){if(ph.x>=hl&&ph.x<=ah&&ph.y>=vl&&ph.y<=uh&&Sy(ot,Ir,Bt,wo,Jt,ol,ph.x,ph.y)&&gm(ph.prev,ph,ph.next)>=0)return!1;ph=ph.next}return!0}function YC(x,f,C,N){var ot=x.prev,Bt=x,Jt=x.next;if(gm(ot,Bt,Jt)>=0)return!1;for(var Ir=ot.x,wo=Bt.x,ol=Jt.x,hl=ot.y,vl=Bt.y,ah=Jt.y,uh=Ir<wo?Ir<ol?Ir:ol:wo<ol?wo:ol,ph=hl<vl?hl<ah?hl:ah:vl<ah?vl:ah,Ph=Ir>wo?Ir>ol?Ir:ol:wo>ol?wo:ol,Mh=hl>vl?hl>ah?hl:ah:vl>ah?vl:ah,Xh=Yv(uh,ph,f,C,N),Jh=Yv(Ph,Mh,f,C,N),qh=x.prevZ,ld=x.nextZ;qh&&qh.z>=Xh&&ld&&ld.z<=Jh;){if(qh.x>=uh&&qh.x<=Ph&&qh.y>=ph&&qh.y<=Mh&&qh!==ot&&qh!==Jt&&Sy(Ir,hl,wo,vl,ol,ah,qh.x,qh.y)&&gm(qh.prev,qh,qh.next)>=0||(qh=qh.prevZ,ld.x>=uh&&ld.x<=Ph&&ld.y>=ph&&ld.y<=Mh&&ld!==ot&&ld!==Jt&&Sy(Ir,hl,wo,vl,ol,ah,ld.x,ld.y)&&gm(ld.prev,ld,ld.next)>=0))return!1;ld=ld.nextZ}for(;qh&&qh.z>=Xh;){if(qh.x>=uh&&qh.x<=Ph&&qh.y>=ph&&qh.y<=Mh&&qh!==ot&&qh!==Jt&&Sy(Ir,hl,wo,vl,ol,ah,qh.x,qh.y)&&gm(qh.prev,qh,qh.next)>=0)return!1;qh=qh.prevZ}for(;ld&&ld.z<=Jh;){if(ld.x>=uh&&ld.x<=Ph&&ld.y>=ph&&ld.y<=Mh&&ld!==ot&&ld!==Jt&&Sy(Ir,hl,wo,vl,ol,ah,ld.x,ld.y)&&gm(ld.prev,ld,ld.next)>=0)return!1;ld=ld.nextZ}return!0}function K1(x,f,C){var N=x;do{var ot=N.prev,Bt=N.next.next;!a1(ot,Bt)&&jb(ot,N,N.next,Bt)&&M_(ot,Bt)&&M_(Bt,ot)&&(f.push(ot.i/C|0),f.push(N.i/C|0),f.push(Bt.i/C|0),Kg(N),Kg(N.next),N=x=Bt),N=N.next}while(N!==x);return ox(N)}function Tw(x,f,C,N,ot,Bt){var Jt=x;do{for(var Ir=Jt.next.next;Ir!==Jt.prev;){if(Jt.i!==Ir.i&&JC(Jt,Ir)){var wo=Wb(Jt,Ir);return Jt=ox(Jt,Jt.next),wo=ox(wo,wo.next),Sw(Jt,f,C,N,ot,Bt,0),void Sw(wo,f,C,N,ot,Bt,0)}Ir=Ir.next}Jt=Jt.next}while(Jt!==x)}function Wx(x,f){return x.x-f.x}function E0(x,f){var C=function(ot,Bt){var Jt,Ir=Bt,wo=ot.x,ol=ot.y,hl=-1/0;do{if(ol<=Ir.y&&ol>=Ir.next.y&&Ir.next.y!==Ir.y){var vl=Ir.x+(ol-Ir.y)*(Ir.next.x-Ir.x)/(Ir.next.y-Ir.y);if(vl<=wo&&vl>hl&&(hl=vl,Jt=Ir.x<Ir.next.x?Ir:Ir.next,vl===wo))return Jt}Ir=Ir.next}while(Ir!==Bt);if(!Jt)return null;var ah,uh=Jt,ph=Jt.x,Ph=Jt.y,Mh=1/0;Ir=Jt;do wo>=Ir.x&&Ir.x>=ph&&wo!==Ir.x&&Sy(ol<Ph?wo:hl,ol,ph,Ph,ol<Ph?hl:wo,ol,Ir.x,Ir.y)&&(ah=Math.abs(ol-Ir.y)/(wo-Ir.x),M_(Ir,ot)&&(ah<Mh||ah===Mh&&(Ir.x>Jt.x||Ir.x===Jt.x&&hv(Jt,Ir)))&&(Jt=Ir,Mh=ah)),Ir=Ir.next;while(Ir!==uh);return Jt}(x,f);if(!C)return f;var N=Wb(C,x);return ox(N,N.next),ox(C,C.next)}function hv(x,f){return gm(x.prev,x,f.prev)<0&&gm(f.next,x,x.next)<0}function Yv(x,f,C,N,ot){return(x=1431655765&((x=858993459&((x=252645135&((x=16711935&((x=(x-C)*ot|0)|x<<8))|x<<4))|x<<2))|x<<1))|(f=1431655765&((f=858993459&((f=252645135&((f=16711935&((f=(f-N)*ot|0)|f<<8))|f<<4))|f<<2))|f<<1))<<1}function sx(x){var f=x,C=x;do(f.x<C.x||f.x===C.x&&f.y<C.y)&&(C=f),f=f.next;while(f!==x);return C}function Sy(x,f,C,N,ot,Bt,Jt,Ir){return(ot-Jt)*(f-Ir)>=(x-Jt)*(Bt-Ir)&&(x-Jt)*(N-Ir)>=(C-Jt)*(f-Ir)&&(C-Jt)*(Bt-Ir)>=(ot-Jt)*(N-Ir)}function JC(x,f){return x.next.i!==f.i&&x.prev.i!==f.i&&!function(C,N){var ot=C;do{if(ot.i!==C.i&&ot.next.i!==C.i&&ot.i!==N.i&&ot.next.i!==N.i&&jb(ot,ot.next,C,N))return!0;ot=ot.next}while(ot!==C);return!1}(x,f)&&(M_(x,f)&&M_(f,x)&&function(C,N){var ot=C,Bt=!1,Jt=(C.x+N.x)/2,Ir=(C.y+N.y)/2;do ot.y>Ir!=ot.next.y>Ir&&ot.next.y!==ot.y&&Jt<(ot.next.x-ot.x)*(Ir-ot.y)/(ot.next.y-ot.y)+ot.x&&(Bt=!Bt),ot=ot.next;while(ot!==C);return Bt}(x,f)&&(gm(x.prev,x,f.prev)||gm(x,f.prev,f))||a1(x,f)&&gm(x.prev,x,x.next)>0&&gm(f.prev,f,f.next)>0)}function gm(x,f,C){return(f.y-x.y)*(C.x-f.x)-(f.x-x.x)*(C.y-f.y)}function a1(x,f){return x.x===f.x&&x.y===f.y}function jb(x,f,C,N){var ot=Rw(gm(x,f,C)),Bt=Rw(gm(x,f,N)),Jt=Rw(gm(C,N,x)),Ir=Rw(gm(C,N,f));return ot!==Bt&&Jt!==Ir||!(ot!==0||!Aw(x,C,f))||!(Bt!==0||!Aw(x,N,f))||!(Jt!==0||!Aw(C,x,N))||!(Ir!==0||!Aw(C,f,N))}function Aw(x,f,C){return f.x<=Math.max(x.x,C.x)&&f.x>=Math.min(x.x,C.x)&&f.y<=Math.max(x.y,C.y)&&f.y>=Math.min(x.y,C.y)}function Rw(x){return x>0?1:x<0?-1:0}function M_(x,f){return gm(x.prev,x,x.next)<0?gm(x,f,x.next)>=0&&gm(x,x.prev,f)>=0:gm(x,f,x.prev)<0||gm(x,x.next,f)<0}function Wb(x,f){var C=new jp(x.i,x.x,x.y),N=new jp(f.i,f.x,f.y),ot=x.next,Bt=f.prev;return x.next=f,f.prev=x,C.next=ot,ot.prev=C,N.next=C,C.prev=N,Bt.next=N,N.prev=Bt,N}function qb(x,f,C,N){var ot=new jp(x,f,C);return N?(ot.next=N.next,ot.prev=N,N.next.prev=ot,N.next=ot):(ot.prev=ot,ot.next=ot),ot}function Kg(x){x.next.prev=x.prev,x.prev.next=x.next,x.prevZ&&(x.prevZ.nextZ=x.nextZ),x.nextZ&&(x.nextZ.prevZ=x.prevZ)}function jp(x,f,C){this.i=x,this.x=f,this.y=C,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Jv(x,f,C,N){for(var ot=0,Bt=f,Jt=C-N;Bt<C;Bt+=N)ot+=(x[Jt]-x[Bt])*(x[Bt+1]+x[Jt+1]),Jt=Bt;return ot}uv.exports=Rx,uv.exports.default=Rx,Rx.deviation=function(x,f,C,N){var ot=f&&f.length,Bt=Math.abs(Jv(x,0,ot?f[0]*C:x.length,C));if(ot)for(var Jt=0,Ir=f.length;Jt<Ir;Jt++)Bt-=Math.abs(Jv(x,f[Jt]*C,Jt<Ir-1?f[Jt+1]*C:x.length,C));var wo=0;for(Jt=0;Jt<N.length;Jt+=3){var ol=N[Jt]*C,hl=N[Jt+1]*C,vl=N[Jt+2]*C;wo+=Math.abs((x[ol]-x[vl])*(x[hl+1]-x[ol+1])-(x[ol]-x[hl])*(x[vl+1]-x[ol+1]))}return Bt===0&&wo===0?0:Math.abs((wo-Bt)/Bt)},Rx.flatten=function(x){for(var f=x[0][0].length,C={vertices:[],holes:[],dimensions:f},N=0,ot=0;ot<x.length;ot++){for(var Bt=0;Bt<x[ot].length;Bt++)for(var Jt=0;Jt<f;Jt++)C.vertices.push(x[ot][Bt][Jt]);ot>0&&C.holes.push(N+=x[ot-1].length)}return C};var Iw=m(uv.exports);function z_(x,f,C,N,ot){Z1(x,f,C||0,N||x.length-1,ot||dv)}function Z1(x,f,C,N,ot){for(;N>C;){if(N-C>600){var Bt=N-C+1,Jt=f-C+1,Ir=Math.log(Bt),wo=.5*Math.exp(2*Ir/3),ol=.5*Math.sqrt(Ir*wo*(Bt-wo)/Bt)*(Jt-Bt/2<0?-1:1);Z1(x,f,Math.max(C,Math.floor(f-Jt*wo/Bt+ol)),Math.min(N,Math.floor(f+(Bt-Jt)*wo/Bt+ol)),ot)}var hl=x[f],vl=C,ah=N;for(qx(x,C,f),ot(x[N],hl)>0&&qx(x,C,N);vl<ah;){for(qx(x,vl,ah),vl++,ah--;ot(x[vl],hl)<0;)vl++;for(;ot(x[ah],hl)>0;)ah--}ot(x[C],hl)===0?qx(x,C,ah):qx(x,++ah,N),ah<=f&&(C=ah+1),f<=ah&&(N=ah-1)}}function qx(x,f,C){var N=x[f];x[f]=x[C],x[C]=N}function dv(x,f){return x<f?-1:x>f?1:0}function Mw(x,f){const C=x.length;if(C<=1)return[x];const N=[];let ot,Bt;for(let Jt=0;Jt<C;Jt++){const Ir=nh(x[Jt]);Ir!==0&&(x[Jt].area=Math.abs(Ir),Bt===void 0&&(Bt=Ir<0),Bt===Ir<0?(ot&&N.push(ot),ot=[x[Jt]]):ot.push(x[Jt]))}if(ot&&N.push(ot),f>1)for(let Jt=0;Jt<N.length;Jt++)N[Jt].length<=f||(z_(N[Jt],f,1,N[Jt].length-1,Ix),N[Jt]=N[Jt].slice(0,f));return N}function Ix(x,f){return f.area-x.area}function Mx(x,f,C){const N=C.patternDependencies;let ot=!1;for(const Bt of f){const Jt=Bt.paint.get(`${x}-pattern`);Jt.isConstant()||(ot=!0);const Ir=Jt.constantOr(null);Ir&&(ot=!0,N[Ir.to]=!0,N[Ir.from]=!0)}return ot}function S0(x,f,C,N,ot){const Bt=ot.patternDependencies;for(const Jt of f){const Ir=Jt.paint.get(`${x}-pattern`).value;if(Ir.kind!=="constant"){let wo=Ir.evaluate({zoom:N-1},C,{},ot.availableImages),ol=Ir.evaluate({zoom:N},C,{},ot.availableImages),hl=Ir.evaluate({zoom:N+1},C,{},ot.availableImages);wo=wo&&wo.name?wo.name:wo,ol=ol&&ol.name?ol.name:ol,hl=hl&&hl.name?hl.name:hl,Bt[wo]=!0,Bt[ol]=!0,Bt[hl]=!0,C.patterns[Jt.id]={min:wo,mid:ol,max:hl}}}return C}class Pw{constructor(f){this.zoom=f.zoom,this.overscaling=f.overscaling,this.layers=f.layers,this.layerIds=this.layers.map(C=>C.id),this.index=f.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Rh,this.indexArray=new Vd,this.indexArray2=new gp,this.programConfigurations=new ed(f.layers,f.zoom),this.segments=new S,this.segments2=new S,this.stateDependentLayerIds=this.layers.filter(C=>C.isStateDependent()).map(C=>C.id)}populate(f,C,N){this.hasPattern=Mx("fill",this.layers,C);const ot=this.layers[0].layout.get("fill-sort-key"),Bt=!ot.isConstant(),Jt=[];for(const{feature:Ir,id:wo,index:ol,sourceLayerIndex:hl}of f){const vl=this.layers[0]._featureFilter.needGeometry,ah=Id(Ir,vl);if(!this.layers[0]._featureFilter.filter(new Eg(this.zoom),ah,N))continue;const uh=Bt?ot.evaluate(ah,{},N,C.availableImages):void 0,ph={id:wo,properties:Ir.properties,type:Ir.type,sourceLayerIndex:hl,index:ol,geometry:vl?ah.geometry:Od(Ir),patterns:{},sortKey:uh};Jt.push(ph)}Bt&&Jt.sort((Ir,wo)=>Ir.sortKey-wo.sortKey);for(const Ir of Jt){const{geometry:wo,index:ol,sourceLayerIndex:hl}=Ir;if(this.hasPattern){const vl=S0("fill",this.layers,Ir,this.zoom,C);this.patternFeatures.push(vl)}else this.addFeature(Ir,wo,ol,N,{});C.featureIndex.insert(f[ol].feature,wo,ol,hl,this.index)}}update(f,C,N){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(f,C,this.stateDependentLayers,N)}addFeatures(f,C,N){for(const ot of this.patternFeatures)this.addFeature(ot,ot.geometry,ot.index,C,N)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(f){this.uploaded||(this.layoutVertexBuffer=f.createVertexBuffer(this.layoutVertexArray,s1),this.indexBuffer=f.createIndexBuffer(this.indexArray),this.indexBuffer2=f.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(f),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(f,C,N,ot,Bt){for(const Jt of Mw(C,500)){let Ir=0;for(const uh of Jt)Ir+=uh.length;const wo=this.segments.prepareSegment(Ir,this.layoutVertexArray,this.indexArray),ol=wo.vertexLength,hl=[],vl=[];for(const uh of Jt){if(uh.length===0)continue;uh!==Jt[0]&&vl.push(hl.length/2);const ph=this.segments2.prepareSegment(uh.length,this.layoutVertexArray,this.indexArray2),Ph=ph.vertexLength;this.layoutVertexArray.emplaceBack(uh[0].x,uh[0].y),this.indexArray2.emplaceBack(Ph+uh.length-1,Ph),hl.push(uh[0].x),hl.push(uh[0].y);for(let Mh=1;Mh<uh.length;Mh++)this.layoutVertexArray.emplaceBack(uh[Mh].x,uh[Mh].y),this.indexArray2.emplaceBack(Ph+Mh-1,Ph+Mh),hl.push(uh[Mh].x),hl.push(uh[Mh].y);ph.vertexLength+=uh.length,ph.primitiveLength+=uh.length}const ah=Iw(hl,vl);for(let uh=0;uh<ah.length;uh+=3)this.indexArray.emplaceBack(ol+ah[uh],ol+ah[uh+1],ol+ah[uh+2]);wo.vertexLength+=Ir,wo.primitiveLength+=ah.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,f,N,Bt,ot)}}let Dw,X1;Tp("FillBucket",Pw,{omit:["layers","patternFeatures"]});var Kb={get paint(){return X1=X1||new Am({"fill-antialias":new Np(Yh.paint_fill["fill-antialias"]),"fill-opacity":new Kp(Yh.paint_fill["fill-opacity"]),"fill-color":new Kp(Yh.paint_fill["fill-color"]),"fill-outline-color":new Kp(Yh.paint_fill["fill-outline-color"]),"fill-translate":new Np(Yh.paint_fill["fill-translate"]),"fill-translate-anchor":new Np(Yh.paint_fill["fill-translate-anchor"]),"fill-pattern":new nv(Yh.paint_fill["fill-pattern"])})},get layout(){return Dw=Dw||new Am({"fill-sort-key":new Kp(Yh.layout_fill["fill-sort-key"])})}};const QC=Jg([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Y1=Jg([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Zb}=QC;var Ty={},Kx=y,Qv=ax;function ax(x,f,C,N,ot){this.properties={},this.extent=C,this.type=0,this._pbf=x,this._geometry=-1,this._keys=N,this._values=ot,x.readFields(Xb,this,f)}function Xb(x,f,C){x==1?f.id=C.readVarint():x==2?function(N,ot){for(var Bt=N.readVarint()+N.pos;N.pos<Bt;){var Jt=ot._keys[N.readVarint()],Ir=ot._values[N.readVarint()];ot.properties[Jt]=Ir}}(C,f):x==3?f.type=C.readVarint():x==4&&(f._geometry=C.pos)}function Lw(x){for(var f,C,N=0,ot=0,Bt=x.length,Jt=Bt-1;ot<Bt;Jt=ot++)N+=((C=x[Jt]).x-(f=x[ot]).x)*(f.y+C.y);return N}ax.types=["Unknown","Point","LineString","Polygon"],ax.prototype.loadGeometry=function(){var x=this._pbf;x.pos=this._geometry;for(var f,C=x.readVarint()+x.pos,N=1,ot=0,Bt=0,Jt=0,Ir=[];x.pos<C;){if(ot<=0){var wo=x.readVarint();N=7&wo,ot=wo>>3}if(ot--,N===1||N===2)Bt+=x.readSVarint(),Jt+=x.readSVarint(),N===1&&(f&&Ir.push(f),f=[]),f.push(new Kx(Bt,Jt));else{if(N!==7)throw new Error("unknown command "+N);f&&f.push(f[0].clone())}}return f&&Ir.push(f),Ir},ax.prototype.bbox=function(){var x=this._pbf;x.pos=this._geometry;for(var f=x.readVarint()+x.pos,C=1,N=0,ot=0,Bt=0,Jt=1/0,Ir=-1/0,wo=1/0,ol=-1/0;x.pos<f;){if(N<=0){var hl=x.readVarint();C=7&hl,N=hl>>3}if(N--,C===1||C===2)(ot+=x.readSVarint())<Jt&&(Jt=ot),ot>Ir&&(Ir=ot),(Bt+=x.readSVarint())<wo&&(wo=Bt),Bt>ol&&(ol=Bt);else if(C!==7)throw new Error("unknown command "+C)}return[Jt,wo,Ir,ol]},ax.prototype.toGeoJSON=function(x,f,C){var N,ot,Bt=this.extent*Math.pow(2,C),Jt=this.extent*x,Ir=this.extent*f,wo=this.loadGeometry(),ol=ax.types[this.type];function hl(uh){for(var ph=0;ph<uh.length;ph++){var Ph=uh[ph];uh[ph]=[360*(Ph.x+Jt)/Bt-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ph.y+Ir)/Bt)*Math.PI/180))-90]}}switch(this.type){case 1:var vl=[];for(N=0;N<wo.length;N++)vl[N]=wo[N][0];hl(wo=vl);break;case 2:for(N=0;N<wo.length;N++)hl(wo[N]);break;case 3:for(wo=function(uh){var ph=uh.length;if(ph<=1)return[uh];for(var Ph,Mh,Xh=[],Jh=0;Jh<ph;Jh++){var qh=Lw(uh[Jh]);qh!==0&&(Mh===void 0&&(Mh=qh<0),Mh===qh<0?(Ph&&Xh.push(Ph),Ph=[uh[Jh]]):Ph.push(uh[Jh]))}return Ph&&Xh.push(Ph),Xh}(wo),N=0;N<wo.length;N++)for(ot=0;ot<wo[N].length;ot++)hl(wo[N][ot])}wo.length===1?wo=wo[0]:ol="Multi"+ol;var ah={type:"Feature",geometry:{type:ol,coordinates:wo},properties:this.properties};return"id"in this&&(ah.id=this.id),ah};var Ow=Qv,V_=Zx;function Zx(x,f){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=x,this._keys=[],this._values=[],this._features=[],x.readFields(w_,this,f),this.length=this._features.length}function w_(x,f,C){x===15?f.version=C.readVarint():x===1?f.name=C.readString():x===5?f.extent=C.readVarint():x===2?f._features.push(C.pos):x===3?f._keys.push(C.readString()):x===4&&f._values.push(function(N){for(var ot=null,Bt=N.readVarint()+N.pos;N.pos<Bt;){var Jt=N.readVarint()>>3;ot=Jt===1?N.readString():Jt===2?N.readFloat():Jt===3?N.readDouble():Jt===4?N.readVarint64():Jt===5?N.readVarint():Jt===6?N.readSVarint():Jt===7?N.readBoolean():null}return ot}(C))}Zx.prototype.feature=function(x){if(x<0||x>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[x];var f=this._pbf.readVarint()+this._pbf.pos;return new Ow(this._pbf,f,this.extent,this._keys,this._values)};var Ay=V_;function J1(x,f,C){if(x===3){var N=new Ay(C,C.readVarint()+C.pos);N.length&&(f[N.name]=N)}}Ty.VectorTile=function(x,f){this.layers=x.readFields(J1,{},f)},Ty.VectorTileFeature=Qv,Ty.VectorTileLayer=V_;const sm=Ty.VectorTileFeature.types,l1=Math.pow(2,13);function T0(x,f,C,N,ot,Bt,Jt,Ir){x.emplaceBack(f,C,2*Math.floor(N*l1)+Jt,ot*l1*2,Bt*l1*2,Math.round(Ir))}class ny{constructor(f){this.zoom=f.zoom,this.overscaling=f.overscaling,this.layers=f.layers,this.layerIds=this.layers.map(C=>C.id),this.index=f.index,this.hasPattern=!1,this.layoutVertexArray=new zh,this.centroidVertexArray=new Ah,this.indexArray=new Vd,this.programConfigurations=new ed(f.layers,f.zoom),this.segments=new S,this.stateDependentLayerIds=this.layers.filter(C=>C.isStateDependent()).map(C=>C.id)}populate(f,C,N){this.features=[],this.hasPattern=Mx("fill-extrusion",this.layers,C);for(const{feature:ot,id:Bt,index:Jt,sourceLayerIndex:Ir}of f){const wo=this.layers[0]._featureFilter.needGeometry,ol=Id(ot,wo);if(!this.layers[0]._featureFilter.filter(new Eg(this.zoom),ol,N))continue;const hl={id:Bt,sourceLayerIndex:Ir,index:Jt,geometry:wo?ol.geometry:Od(ot),properties:ot.properties,type:ot.type,patterns:{}};this.hasPattern?this.features.push(S0("fill-extrusion",this.layers,hl,this.zoom,C)):this.addFeature(hl,hl.geometry,Jt,N,{}),C.featureIndex.insert(ot,hl.geometry,Jt,Ir,this.index,!0)}}addFeatures(f,C,N){for(const ot of this.features){const{geometry:Bt}=ot;this.addFeature(ot,Bt,ot.index,C,N)}}update(f,C,N){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(f,C,this.stateDependentLayers,N)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(f){this.uploaded||(this.layoutVertexBuffer=f.createVertexBuffer(this.layoutVertexArray,Zb),this.centroidVertexBuffer=f.createVertexBuffer(this.centroidVertexArray,Y1.members,!0),this.indexBuffer=f.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(f),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(f,C,N,ot,Bt){const Jt={x:0,y:0,vertexCount:0};for(const Ir of Mw(C,500)){let wo=0;for(const ph of Ir)wo+=ph.length;let ol=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ph of Ir){if(ph.length===0||tE(ph))continue;let Ph=0;for(let Mh=0;Mh<ph.length;Mh++){const Xh=ph[Mh];if(Mh>=1){const Jh=ph[Mh-1];if(!eE(Xh,Jh)){ol.vertexLength+4>S.MAX_VERTEX_ARRAY_LENGTH&&(ol=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const qh=Xh.sub(Jh)._perp()._unit(),ld=Jh.dist(Xh);Ph+ld>32768&&(Ph=0),T0(this.layoutVertexArray,Xh.x,Xh.y,qh.x,qh.y,0,0,Ph),T0(this.layoutVertexArray,Xh.x,Xh.y,qh.x,qh.y,0,1,Ph),Jt.x+=2*Xh.x,Jt.y+=2*Xh.y,Jt.vertexCount+=2,Ph+=ld,T0(this.layoutVertexArray,Jh.x,Jh.y,qh.x,qh.y,0,0,Ph),T0(this.layoutVertexArray,Jh.x,Jh.y,qh.x,qh.y,0,1,Ph),Jt.x+=2*Jh.x,Jt.y+=2*Jh.y,Jt.vertexCount+=2;const pd=ol.vertexLength;this.indexArray.emplaceBack(pd,pd+2,pd+1),this.indexArray.emplaceBack(pd+1,pd+2,pd+3),ol.vertexLength+=4,ol.primitiveLength+=2}}}}if(ol.vertexLength+wo>S.MAX_VERTEX_ARRAY_LENGTH&&(ol=this.segments.prepareSegment(wo,this.layoutVertexArray,this.indexArray)),sm[f.type]!=="Polygon")continue;const hl=[],vl=[],ah=ol.vertexLength;for(const ph of Ir)if(ph.length!==0){ph!==Ir[0]&&vl.push(hl.length/2);for(let Ph=0;Ph<ph.length;Ph++){const Mh=ph[Ph];T0(this.layoutVertexArray,Mh.x,Mh.y,0,0,1,1,0),Jt.x+=Mh.x,Jt.y+=Mh.y,Jt.vertexCount+=1,hl.push(Mh.x),hl.push(Mh.y)}}const uh=Iw(hl,vl);for(let ph=0;ph<uh.length;ph+=3)this.indexArray.emplaceBack(ah+uh[ph],ah+uh[ph+2],ah+uh[ph+1]);ol.primitiveLength+=uh.length/3,ol.vertexLength+=wo}for(let Ir=0;Ir<Jt.vertexCount;Ir++)this.centroidVertexArray.emplaceBack(Math.floor(Jt.x/Jt.vertexCount),Math.floor(Jt.y/Jt.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,f,N,Bt,ot)}}function eE(x,f){return x.x===f.x&&(x.x<0||x.x>xd)||x.y===f.y&&(x.y<0||x.y>xd)}function tE(x){return x.every(f=>f.x<0)||x.every(f=>f.x>xd)||x.every(f=>f.y<0)||x.every(f=>f.y>xd)}let Q1;Tp("FillExtrusionBucket",ny,{omit:["layers","features"]});var Yb={get paint(){return Q1=Q1||new Am({"fill-extrusion-opacity":new Np(Yh["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Kp(Yh["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Np(Yh["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Np(Yh["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new nv(Yh["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Kp(Yh["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Kp(Yh["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Np(Yh["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};function pv(x,f){return x.x*f.x+x.y*f.y}function eb(x,f){if(x.length===1){let C=0;const N=f[C++];let ot;for(;!ot||N.equals(ot);)if(ot=f[C++],!ot)return 1/0;for(;C<f.length;C++){const Bt=f[C],Jt=x[0],Ir=ot.sub(N),wo=Bt.sub(N),ol=Jt.sub(N),hl=pv(Ir,Ir),vl=pv(Ir,wo),ah=pv(wo,wo),uh=pv(ol,Ir),ph=pv(ol,wo),Ph=hl*ah-vl*vl,Mh=(ah*uh-vl*ph)/Ph,Xh=(hl*ph-vl*uh)/Ph,Jh=N.z*(1-Mh-Xh)+ot.z*Mh+Bt.z*Xh;if(isFinite(Jh))return Jh}return 1/0}{let C=1/0;for(const N of f)C=Math.min(C,N.z);return C}}const Jb=Jg([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Qb}=Jb,eC=Jg([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:iE}=eC,rE=Ty.VectorTileFeature.types,tC=Math.cos(Math.PI/180*37.5),tb=Math.pow(2,14)/.5;class Px{constructor(f){this.zoom=f.zoom,this.overscaling=f.overscaling,this.layers=f.layers,this.layerIds=this.layers.map(C=>C.id),this.index=f.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(C=>{this.gradients[C.id]={}}),this.layoutVertexArray=new Kh,this.layoutVertexArray2=new ad,this.indexArray=new Vd,this.programConfigurations=new ed(f.layers,f.zoom),this.segments=new S,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(C=>C.isStateDependent()).map(C=>C.id)}populate(f,C,N){this.hasPattern=Mx("line",this.layers,C);const ot=this.layers[0].layout.get("line-sort-key"),Bt=!ot.isConstant(),Jt=[];for(const{feature:Ir,id:wo,index:ol,sourceLayerIndex:hl}of f){const vl=this.layers[0]._featureFilter.needGeometry,ah=Id(Ir,vl);if(!this.layers[0]._featureFilter.filter(new Eg(this.zoom),ah,N))continue;const uh=Bt?ot.evaluate(ah,{},N):void 0,ph={id:wo,properties:Ir.properties,type:Ir.type,sourceLayerIndex:hl,index:ol,geometry:vl?ah.geometry:Od(Ir),patterns:{},sortKey:uh};Jt.push(ph)}Bt&&Jt.sort((Ir,wo)=>Ir.sortKey-wo.sortKey);for(const Ir of Jt){const{geometry:wo,index:ol,sourceLayerIndex:hl}=Ir;if(this.hasPattern){const vl=S0("line",this.layers,Ir,this.zoom,C);this.patternFeatures.push(vl)}else this.addFeature(Ir,wo,ol,N,{});C.featureIndex.insert(f[ol].feature,wo,ol,hl,this.index)}}update(f,C,N){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(f,C,this.stateDependentLayers,N)}addFeatures(f,C,N){for(const ot of this.patternFeatures)this.addFeature(ot,ot.geometry,ot.index,C,N)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(f){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=f.createVertexBuffer(this.layoutVertexArray2,iE)),this.layoutVertexBuffer=f.createVertexBuffer(this.layoutVertexArray,Qb),this.indexBuffer=f.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(f),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(f){if(f.properties&&Object.prototype.hasOwnProperty.call(f.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(f.properties,"mapbox_clip_end"))return{start:+f.properties.mapbox_clip_start,end:+f.properties.mapbox_clip_end}}addFeature(f,C,N,ot,Bt){const Jt=this.layers[0].layout,Ir=Jt.get("line-join").evaluate(f,{}),wo=Jt.get("line-cap"),ol=Jt.get("line-miter-limit"),hl=Jt.get("line-round-limit");this.lineClips=this.lineFeatureClips(f);for(const vl of C)this.addLine(vl,f,Ir,wo,ol,hl);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,f,N,Bt,ot)}addLine(f,C,N,ot,Bt,Jt){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Xh=0;Xh<f.length-1;Xh++)this.totalDistance+=f[Xh].dist(f[Xh+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const Ir=rE[C.type]==="Polygon";let wo=f.length;for(;wo>=2&&f[wo-1].equals(f[wo-2]);)wo--;let ol=0;for(;ol<wo-1&&f[ol].equals(f[ol+1]);)ol++;if(wo<(Ir?3:2))return;N==="bevel"&&(Bt=1.05);const hl=this.overscaling<=16?15*xd/(512*this.overscaling):0,vl=this.segments.prepareSegment(10*wo,this.layoutVertexArray,this.indexArray);let ah,uh,ph,Ph,Mh;this.e1=this.e2=-1,Ir&&(ah=f[wo-2],Mh=f[ol].sub(ah)._unit()._perp());for(let Xh=ol;Xh<wo;Xh++){if(ph=Xh===wo-1?Ir?f[ol+1]:void 0:f[Xh+1],ph&&f[Xh].equals(ph))continue;Mh&&(Ph=Mh),ah&&(uh=ah),ah=f[Xh],Mh=ph?ph.sub(ah)._unit()._perp():Ph,Ph=Ph||Mh;let Jh=Ph.add(Mh);Jh.x===0&&Jh.y===0||Jh._unit();const qh=Ph.x*Mh.x+Ph.y*Mh.y,ld=Jh.x*Mh.x+Jh.y*Mh.y,pd=ld!==0?1/ld:1/0,Md=2*Math.sqrt(2-2*ld),Pp=ld<tC&&uh&&ph,bp=Ph.x*Mh.y-Ph.y*Mh.x>0;if(Pp&&Xh>ol){const lp=ah.dist(uh);if(lp>2*hl){const Sp=ah.sub(ah.sub(uh)._mult(hl/lp)._round());this.updateDistance(uh,Sp),this.addCurrentVertex(Sp,Ph,0,0,vl),uh=Sp}}const yp=uh&&ph;let hp=yp?N:Ir?"butt":ot;if(yp&&hp==="round"&&(pd<Jt?hp="miter":pd<=2&&(hp="fakeround")),hp==="miter"&&pd>Bt&&(hp="bevel"),hp==="bevel"&&(pd>2&&(hp="flipbevel"),pd<Bt&&(hp="miter")),uh&&this.updateDistance(uh,ah),hp==="miter")Jh._mult(pd),this.addCurrentVertex(ah,Jh,0,0,vl);else if(hp==="flipbevel"){if(pd>100)Jh=Mh.mult(-1);else{const lp=pd*Ph.add(Mh).mag()/Ph.sub(Mh).mag();Jh._perp()._mult(lp*(bp?-1:1))}this.addCurrentVertex(ah,Jh,0,0,vl),this.addCurrentVertex(ah,Jh.mult(-1),0,0,vl)}else if(hp==="bevel"||hp==="fakeround"){const lp=-Math.sqrt(pd*pd-1),Sp=bp?lp:0,vp=bp?0:lp;if(uh&&this.addCurrentVertex(ah,Ph,Sp,vp,vl),hp==="fakeround"){const Jd=Math.round(180*Md/Math.PI/20);for(let Xp=1;Xp<Jd;Xp++){let $p=Xp/Jd;if($p!==.5){const Wg=$p-.5;$p+=$p*Wg*($p-1)*((1.0904+qh*(qh*(3.55645-1.43519*qh)-3.2452))*Wg*Wg+(.848013+qh*(.215638*qh-1.06021)))}const ag=Mh.sub(Ph)._mult($p)._add(Ph)._unit()._mult(bp?-1:1);this.addHalfVertex(ah,ag.x,ag.y,!1,bp,0,vl)}}ph&&this.addCurrentVertex(ah,Mh,-Sp,-vp,vl)}else if(hp==="butt")this.addCurrentVertex(ah,Jh,0,0,vl);else if(hp==="square"){const lp=uh?1:-1;this.addCurrentVertex(ah,Jh,lp,lp,vl)}else hp==="round"&&(uh&&(this.addCurrentVertex(ah,Ph,0,0,vl),this.addCurrentVertex(ah,Ph,1,1,vl,!0)),ph&&(this.addCurrentVertex(ah,Mh,-1,-1,vl,!0),this.addCurrentVertex(ah,Mh,0,0,vl)));if(Pp&&Xh<wo-1){const lp=ah.dist(ph);if(lp>2*hl){const Sp=ah.add(ph.sub(ah)._mult(hl/lp)._round());this.updateDistance(ah,Sp),this.addCurrentVertex(Sp,Mh,0,0,vl),ah=Sp}}}}addCurrentVertex(f,C,N,ot,Bt,Jt=!1){const Ir=C.y*ot-C.x,wo=-C.y-C.x*ot;this.addHalfVertex(f,C.x+C.y*N,C.y-C.x*N,Jt,!1,N,Bt),this.addHalfVertex(f,Ir,wo,Jt,!0,-ot,Bt),this.distance>tb/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(f,C,N,ot,Bt,Jt))}addHalfVertex({x:f,y:C},N,ot,Bt,Jt,Ir,wo){const ol=.5*(this.lineClips?this.scaledDistance*(tb-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((f<<1)+(Bt?1:0),(C<<1)+(Jt?1:0),Math.round(63*N)+128,Math.round(63*ot)+128,1+(Ir===0?0:Ir<0?-1:1)|(63&ol)<<2,ol>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const hl=wo.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,hl),wo.primitiveLength++),Jt?this.e2=hl:this.e1=hl}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(f,C){this.distance+=f.dist(C),this.updateScaledDistance()}}let c1,u1;Tp("LineBucket",Px,{omit:["layers","patternFeatures"]});var h1={get paint(){return u1=u1||new Am({"line-opacity":new Kp(Yh.paint_line["line-opacity"]),"line-color":new Kp(Yh.paint_line["line-color"]),"line-translate":new Np(Yh.paint_line["line-translate"]),"line-translate-anchor":new Np(Yh.paint_line["line-translate-anchor"]),"line-width":new Kp(Yh.paint_line["line-width"]),"line-gap-width":new Kp(Yh.paint_line["line-gap-width"]),"line-offset":new Kp(Yh.paint_line["line-offset"]),"line-blur":new Kp(Yh.paint_line["line-blur"]),"line-dasharray":new Hv(Yh.paint_line["line-dasharray"]),"line-pattern":new nv(Yh.paint_line["line-pattern"]),"line-gradient":new tx(Yh.paint_line["line-gradient"])})},get layout(){return c1=c1||new Am({"line-cap":new Np(Yh.layout_line["line-cap"]),"line-join":new Kp(Yh.layout_line["line-join"]),"line-miter-limit":new Np(Yh.layout_line["line-miter-limit"]),"line-round-limit":new Np(Yh.layout_line["line-round-limit"]),"line-sort-key":new Kp(Yh.layout_line["line-sort-key"])})}};class b_ extends Kp{possiblyEvaluate(f,C){return C=new Eg(Math.floor(C.zoom),{now:C.now,fadeDuration:C.fadeDuration,zoomHistory:C.zoomHistory,transition:C.transition}),super.possiblyEvaluate(f,C)}evaluate(f,C,N,ot){return C=Wr({},C,{zoom:Math.floor(C.zoom)}),super.evaluate(f,C,N,ot)}}let Xx;function ib(x,f){return f>0?f+2*x:x}const e0=Jg([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),nE=Jg([{name:"a_projected_pos",components:3,type:"Float32"}],4);Jg([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Dx=Jg([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Jg([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Yx=Jg([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Ry=Jg([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Iy(x,f,C){return x.sections.forEach(N=>{N.text=function(ot,Bt,Jt){const Ir=Bt.layout.get("text-transform").evaluate(Jt,{});return Ir==="uppercase"?ot=ot.toLocaleUpperCase():Ir==="lowercase"&&(ot=ot.toLocaleLowerCase()),Bm.applyArabicShaping&&(ot=Bm.applyArabicShaping(ot)),ot}(N.text,f,C)}),x}Jg([{name:"triangle",components:3,type:"Uint16"}]),Jg([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Jg([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Jg([{type:"Float32",name:"offsetX"}]),Jg([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Fw={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var mm=24,rb=ug,iC=function(x,f,C,N,ot){var Bt,Jt,Ir=8*ot-N-1,wo=(1<<Ir)-1,ol=wo>>1,hl=-7,vl=C?ot-1:0,ah=C?-1:1,uh=x[f+vl];for(vl+=ah,Bt=uh&(1<<-hl)-1,uh>>=-hl,hl+=Ir;hl>0;Bt=256*Bt+x[f+vl],vl+=ah,hl-=8);for(Jt=Bt&(1<<-hl)-1,Bt>>=-hl,hl+=N;hl>0;Jt=256*Jt+x[f+vl],vl+=ah,hl-=8);if(Bt===0)Bt=1-ol;else{if(Bt===wo)return Jt?NaN:1/0*(uh?-1:1);Jt+=Math.pow(2,N),Bt-=ol}return(uh?-1:1)*Jt*Math.pow(2,Bt-N)},d1=function(x,f,C,N,ot,Bt){var Jt,Ir,wo,ol=8*Bt-ot-1,hl=(1<<ol)-1,vl=hl>>1,ah=ot===23?Math.pow(2,-24)-Math.pow(2,-77):0,uh=N?0:Bt-1,ph=N?1:-1,Ph=f<0||f===0&&1/f<0?1:0;for(f=Math.abs(f),isNaN(f)||f===1/0?(Ir=isNaN(f)?1:0,Jt=hl):(Jt=Math.floor(Math.log(f)/Math.LN2),f*(wo=Math.pow(2,-Jt))<1&&(Jt--,wo*=2),(f+=Jt+vl>=1?ah/wo:ah*Math.pow(2,1-vl))*wo>=2&&(Jt++,wo/=2),Jt+vl>=hl?(Ir=0,Jt=hl):Jt+vl>=1?(Ir=(f*wo-1)*Math.pow(2,ot),Jt+=vl):(Ir=f*Math.pow(2,vl-1)*Math.pow(2,ot),Jt=0));ot>=8;x[C+uh]=255&Ir,uh+=ph,Ir/=256,ot-=8);for(Jt=Jt<<ot|Ir,ol+=ot;ol>0;x[C+uh]=255&Jt,uh+=ph,Jt/=256,ol-=8);x[C+uh-ph]|=128*Ph};function ug(x){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(x)?x:new Uint8Array(x||0),this.pos=0,this.type=0,this.length=this.buf.length}ug.Varint=0,ug.Fixed64=1,ug.Bytes=2,ug.Fixed32=5;var A0=4294967296,nb=1/A0,ob=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function R0(x){return x.type===ug.Bytes?x.readVarint()+x.pos:x.pos+1}function I0(x,f,C){return C?4294967296*f+(x>>>0):4294967296*(f>>>0)+(x>>>0)}function p1(x,f,C){var N=f<=16383?1:f<=2097151?2:f<=268435455?3:Math.floor(Math.log(f)/(7*Math.LN2));C.realloc(N);for(var ot=C.pos-1;ot>=x;ot--)C.buf[ot+N]=C.buf[ot]}function Jx(x,f){for(var C=0;C<x.length;C++)f.writeVarint(x[C])}function Qx(x,f){for(var C=0;C<x.length;C++)f.writeSVarint(x[C])}function Nw(x,f){for(var C=0;C<x.length;C++)f.writeFloat(x[C])}function f1(x,f){for(var C=0;C<x.length;C++)f.writeDouble(x[C])}function rC(x,f){for(var C=0;C<x.length;C++)f.writeBoolean(x[C])}function kw(x,f){for(var C=0;C<x.length;C++)f.writeFixed32(x[C])}function sb(x,f){for(var C=0;C<x.length;C++)f.writeSFixed32(x[C])}function nC(x,f){for(var C=0;C<x.length;C++)f.writeFixed64(x[C])}function ew(x,f){for(var C=0;C<x.length;C++)f.writeSFixed64(x[C])}function Bw(x,f){return(x[f]|x[f+1]<<8|x[f+2]<<16)+16777216*x[f+3]}function lx(x,f,C){x[C]=f,x[C+1]=f>>>8,x[C+2]=f>>>16,x[C+3]=f>>>24}function ab(x,f){return(x[f]|x[f+1]<<8|x[f+2]<<16)+(x[f+3]<<24)}ug.prototype={destroy:function(){this.buf=null},readFields:function(x,f,C){for(C=C||this.length;this.pos<C;){var N=this.readVarint(),ot=N>>3,Bt=this.pos;this.type=7&N,x(ot,f,this),this.pos===Bt&&this.skip(N)}return f},readMessage:function(x,f){return this.readFields(x,f,this.readVarint()+this.pos)},readFixed32:function(){var x=Bw(this.buf,this.pos);return this.pos+=4,x},readSFixed32:function(){var x=ab(this.buf,this.pos);return this.pos+=4,x},readFixed64:function(){var x=Bw(this.buf,this.pos)+Bw(this.buf,this.pos+4)*A0;return this.pos+=8,x},readSFixed64:function(){var x=Bw(this.buf,this.pos)+ab(this.buf,this.pos+4)*A0;return this.pos+=8,x},readFloat:function(){var x=iC(this.buf,this.pos,!0,23,4);return this.pos+=4,x},readDouble:function(){var x=iC(this.buf,this.pos,!0,52,8);return this.pos+=8,x},readVarint:function(x){var f,C,N=this.buf;return f=127&(C=N[this.pos++]),C<128?f:(f|=(127&(C=N[this.pos++]))<<7,C<128?f:(f|=(127&(C=N[this.pos++]))<<14,C<128?f:(f|=(127&(C=N[this.pos++]))<<21,C<128?f:function(ot,Bt,Jt){var Ir,wo,ol=Jt.buf;if(Ir=(112&(wo=ol[Jt.pos++]))>>4,wo<128||(Ir|=(127&(wo=ol[Jt.pos++]))<<3,wo<128)||(Ir|=(127&(wo=ol[Jt.pos++]))<<10,wo<128)||(Ir|=(127&(wo=ol[Jt.pos++]))<<17,wo<128)||(Ir|=(127&(wo=ol[Jt.pos++]))<<24,wo<128)||(Ir|=(1&(wo=ol[Jt.pos++]))<<31,wo<128))return I0(ot,Ir,Bt);throw new Error("Expected varint not more than 10 bytes")}(f|=(15&(C=N[this.pos]))<<28,x,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var x=this.readVarint();return x%2==1?(x+1)/-2:x/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var x=this.readVarint()+this.pos,f=this.pos;return this.pos=x,x-f>=12&&ob?function(C,N,ot){return ob.decode(C.subarray(N,ot))}(this.buf,f,x):function(C,N,ot){for(var Bt="",Jt=N;Jt<ot;){var Ir,wo,ol,hl=C[Jt],vl=null,ah=hl>239?4:hl>223?3:hl>191?2:1;if(Jt+ah>ot)break;ah===1?hl<128&&(vl=hl):ah===2?(192&(Ir=C[Jt+1]))==128&&(vl=(31&hl)<<6|63&Ir)<=127&&(vl=null):ah===3?(wo=C[Jt+2],(192&(Ir=C[Jt+1]))==128&&(192&wo)==128&&((vl=(15&hl)<<12|(63&Ir)<<6|63&wo)<=2047||vl>=55296&&vl<=57343)&&(vl=null)):ah===4&&(wo=C[Jt+2],ol=C[Jt+3],(192&(Ir=C[Jt+1]))==128&&(192&wo)==128&&(192&ol)==128&&((vl=(15&hl)<<18|(63&Ir)<<12|(63&wo)<<6|63&ol)<=65535||vl>=1114112)&&(vl=null)),vl===null?(vl=65533,ah=1):vl>65535&&(vl-=65536,Bt+=String.fromCharCode(vl>>>10&1023|55296),vl=56320|1023&vl),Bt+=String.fromCharCode(vl),Jt+=ah}return Bt}(this.buf,f,x)},readBytes:function(){var x=this.readVarint()+this.pos,f=this.buf.subarray(this.pos,x);return this.pos=x,f},readPackedVarint:function(x,f){if(this.type!==ug.Bytes)return x.push(this.readVarint(f));var C=R0(this);for(x=x||[];this.pos<C;)x.push(this.readVarint(f));return x},readPackedSVarint:function(x){if(this.type!==ug.Bytes)return x.push(this.readSVarint());var f=R0(this);for(x=x||[];this.pos<f;)x.push(this.readSVarint());return x},readPackedBoolean:function(x){if(this.type!==ug.Bytes)return x.push(this.readBoolean());var f=R0(this);for(x=x||[];this.pos<f;)x.push(this.readBoolean());return x},readPackedFloat:function(x){if(this.type!==ug.Bytes)return x.push(this.readFloat());var f=R0(this);for(x=x||[];this.pos<f;)x.push(this.readFloat());return x},readPackedDouble:function(x){if(this.type!==ug.Bytes)return x.push(this.readDouble());var f=R0(this);for(x=x||[];this.pos<f;)x.push(this.readDouble());return x},readPackedFixed32:function(x){if(this.type!==ug.Bytes)return x.push(this.readFixed32());var f=R0(this);for(x=x||[];this.pos<f;)x.push(this.readFixed32());return x},readPackedSFixed32:function(x){if(this.type!==ug.Bytes)return x.push(this.readSFixed32());var f=R0(this);for(x=x||[];this.pos<f;)x.push(this.readSFixed32());return x},readPackedFixed64:function(x){if(this.type!==ug.Bytes)return x.push(this.readFixed64());var f=R0(this);for(x=x||[];this.pos<f;)x.push(this.readFixed64());return x},readPackedSFixed64:function(x){if(this.type!==ug.Bytes)return x.push(this.readSFixed64());var f=R0(this);for(x=x||[];this.pos<f;)x.push(this.readSFixed64());return x},skip:function(x){var f=7&x;if(f===ug.Varint)for(;this.buf[this.pos++]>127;);else if(f===ug.Bytes)this.pos=this.readVarint()+this.pos;else if(f===ug.Fixed32)this.pos+=4;else{if(f!==ug.Fixed64)throw new Error("Unimplemented type: "+f);this.pos+=8}},writeTag:function(x,f){this.writeVarint(x<<3|f)},realloc:function(x){for(var f=this.length||16;f<this.pos+x;)f*=2;if(f!==this.length){var C=new Uint8Array(f);C.set(this.buf),this.buf=C,this.length=f}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(x){this.realloc(4),lx(this.buf,x,this.pos),this.pos+=4},writeSFixed32:function(x){this.realloc(4),lx(this.buf,x,this.pos),this.pos+=4},writeFixed64:function(x){this.realloc(8),lx(this.buf,-1&x,this.pos),lx(this.buf,Math.floor(x*nb),this.pos+4),this.pos+=8},writeSFixed64:function(x){this.realloc(8),lx(this.buf,-1&x,this.pos),lx(this.buf,Math.floor(x*nb),this.pos+4),this.pos+=8},writeVarint:function(x){(x=+x||0)>268435455||x<0?function(f,C){var N,ot;if(f>=0?(N=f%4294967296|0,ot=f/4294967296|0):(ot=~(-f/4294967296),4294967295^(N=~(-f%4294967296))?N=N+1|0:(N=0,ot=ot+1|0)),f>=18446744073709552e3||f<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");C.realloc(10),function(Bt,Jt,Ir){Ir.buf[Ir.pos++]=127&Bt|128,Bt>>>=7,Ir.buf[Ir.pos++]=127&Bt|128,Bt>>>=7,Ir.buf[Ir.pos++]=127&Bt|128,Bt>>>=7,Ir.buf[Ir.pos++]=127&Bt|128,Ir.buf[Ir.pos]=127&(Bt>>>=7)}(N,0,C),function(Bt,Jt){var Ir=(7&Bt)<<4;Jt.buf[Jt.pos++]|=Ir|((Bt>>>=3)?128:0),Bt&&(Jt.buf[Jt.pos++]=127&Bt|((Bt>>>=7)?128:0),Bt&&(Jt.buf[Jt.pos++]=127&Bt|((Bt>>>=7)?128:0),Bt&&(Jt.buf[Jt.pos++]=127&Bt|((Bt>>>=7)?128:0),Bt&&(Jt.buf[Jt.pos++]=127&Bt|((Bt>>>=7)?128:0),Bt&&(Jt.buf[Jt.pos++]=127&Bt)))))}(ot,C)}(x,this):(this.realloc(4),this.buf[this.pos++]=127&x|(x>127?128:0),x<=127||(this.buf[this.pos++]=127&(x>>>=7)|(x>127?128:0),x<=127||(this.buf[this.pos++]=127&(x>>>=7)|(x>127?128:0),x<=127||(this.buf[this.pos++]=x>>>7&127))))},writeSVarint:function(x){this.writeVarint(x<0?2*-x-1:2*x)},writeBoolean:function(x){this.writeVarint(!!x)},writeString:function(x){x=String(x),this.realloc(4*x.length),this.pos++;var f=this.pos;this.pos=function(N,ot,Bt){for(var Jt,Ir,wo=0;wo<ot.length;wo++){if((Jt=ot.charCodeAt(wo))>55295&&Jt<57344){if(!Ir){Jt>56319||wo+1===ot.length?(N[Bt++]=239,N[Bt++]=191,N[Bt++]=189):Ir=Jt;continue}if(Jt<56320){N[Bt++]=239,N[Bt++]=191,N[Bt++]=189,Ir=Jt;continue}Jt=Ir-55296<<10|Jt-56320|65536,Ir=null}else Ir&&(N[Bt++]=239,N[Bt++]=191,N[Bt++]=189,Ir=null);Jt<128?N[Bt++]=Jt:(Jt<2048?N[Bt++]=Jt>>6|192:(Jt<65536?N[Bt++]=Jt>>12|224:(N[Bt++]=Jt>>18|240,N[Bt++]=Jt>>12&63|128),N[Bt++]=Jt>>6&63|128),N[Bt++]=63&Jt|128)}return Bt}(this.buf,x,this.pos);var C=this.pos-f;C>=128&&p1(f,C,this),this.pos=f-1,this.writeVarint(C),this.pos+=C},writeFloat:function(x){this.realloc(4),d1(this.buf,x,this.pos,!0,23,4),this.pos+=4},writeDouble:function(x){this.realloc(8),d1(this.buf,x,this.pos,!0,52,8),this.pos+=8},writeBytes:function(x){var f=x.length;this.writeVarint(f),this.realloc(f);for(var C=0;C<f;C++)this.buf[this.pos++]=x[C]},writeRawMessage:function(x,f){this.pos++;var C=this.pos;x(f,this);var N=this.pos-C;N>=128&&p1(C,N,this),this.pos=C-1,this.writeVarint(N),this.pos+=N},writeMessage:function(x,f,C){this.writeTag(x,ug.Bytes),this.writeRawMessage(f,C)},writePackedVarint:function(x,f){f.length&&this.writeMessage(x,Jx,f)},writePackedSVarint:function(x,f){f.length&&this.writeMessage(x,Qx,f)},writePackedBoolean:function(x,f){f.length&&this.writeMessage(x,rC,f)},writePackedFloat:function(x,f){f.length&&this.writeMessage(x,Nw,f)},writePackedDouble:function(x,f){f.length&&this.writeMessage(x,f1,f)},writePackedFixed32:function(x,f){f.length&&this.writeMessage(x,kw,f)},writePackedSFixed32:function(x,f){f.length&&this.writeMessage(x,sb,f)},writePackedFixed64:function(x,f){f.length&&this.writeMessage(x,nC,f)},writePackedSFixed64:function(x,f){f.length&&this.writeMessage(x,ew,f)},writeBytesField:function(x,f){this.writeTag(x,ug.Bytes),this.writeBytes(f)},writeFixed32Field:function(x,f){this.writeTag(x,ug.Fixed32),this.writeFixed32(f)},writeSFixed32Field:function(x,f){this.writeTag(x,ug.Fixed32),this.writeSFixed32(f)},writeFixed64Field:function(x,f){this.writeTag(x,ug.Fixed64),this.writeFixed64(f)},writeSFixed64Field:function(x,f){this.writeTag(x,ug.Fixed64),this.writeSFixed64(f)},writeVarintField:function(x,f){this.writeTag(x,ug.Varint),this.writeVarint(f)},writeSVarintField:function(x,f){this.writeTag(x,ug.Varint),this.writeSVarint(f)},writeStringField:function(x,f){this.writeTag(x,ug.Bytes),this.writeString(f)},writeFloatField:function(x,f){this.writeTag(x,ug.Fixed32),this.writeFloat(f)},writeDoubleField:function(x,f){this.writeTag(x,ug.Fixed64),this.writeDouble(f)},writeBooleanField:function(x,f){this.writeVarintField(x,!!f)}};var lb=m(rb);const cb=3;function Gw(x,f,C){x===1&&C.readMessage(oC,f)}function oC(x,f,C){if(x===3){const{id:N,bitmap:ot,width:Bt,height:Jt,left:Ir,top:wo,advance:ol}=C.readMessage(cx,{});f.push({id:N,bitmap:new jx({width:Bt+2*cb,height:Jt+2*cb},ot),metrics:{width:Bt,height:Jt,left:Ir,top:wo,advance:ol}})}}function cx(x,f,C){x===1?f.id=C.readVarint():x===2?f.bitmap=C.readBytes():x===3?f.width=C.readVarint():x===4?f.height=C.readVarint():x===5?f.left=C.readSVarint():x===6?f.top=C.readSVarint():x===7&&(f.advance=C.readVarint())}const Rg=cb;function g1(x){let f=0,C=0;for(const Jt of x)f+=Jt.w*Jt.h,C=Math.max(C,Jt.w);x.sort((Jt,Ir)=>Ir.h-Jt.h);const N=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(f/.95)),C),h:1/0}];let ot=0,Bt=0;for(const Jt of x)for(let Ir=N.length-1;Ir>=0;Ir--){const wo=N[Ir];if(!(Jt.w>wo.w||Jt.h>wo.h)){if(Jt.x=wo.x,Jt.y=wo.y,Bt=Math.max(Bt,Jt.y+Jt.h),ot=Math.max(ot,Jt.x+Jt.w),Jt.w===wo.w&&Jt.h===wo.h){const ol=N.pop();Ir<N.length&&(N[Ir]=ol)}else Jt.h===wo.h?(wo.x+=Jt.w,wo.w-=Jt.w):Jt.w===wo.w?(wo.y+=Jt.h,wo.h-=Jt.h):(N.push({x:wo.x+Jt.w,y:wo.y,w:wo.w-Jt.w,h:Jt.h}),wo.y+=Jt.h,wo.h-=Jt.h);break}}return{w:ot,h:Bt,fill:f/(ot*Bt)||0}}const am=1;class My{constructor(f,{pixelRatio:C,version:N,stretchX:ot,stretchY:Bt,content:Jt}){this.paddedRect=f,this.pixelRatio=C,this.stretchX=ot,this.stretchY=Bt,this.content=Jt,this.version=N}get tl(){return[this.paddedRect.x+am,this.paddedRect.y+am]}get br(){return[this.paddedRect.x+this.paddedRect.w-am,this.paddedRect.y+this.paddedRect.h-am]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*am)/this.pixelRatio,(this.paddedRect.h-2*am)/this.pixelRatio]}}class Py{constructor(f,C){const N={},ot={};this.haveRenderCallbacks=[];const Bt=[];this.addImages(f,N,Bt),this.addImages(C,ot,Bt);const{w:Jt,h:Ir}=g1(Bt),wo=new ry({width:Jt||1,height:Ir||1});for(const ol in f){const hl=f[ol],vl=N[ol].paddedRect;ry.copy(hl.data,wo,{x:0,y:0},{x:vl.x+am,y:vl.y+am},hl.data)}for(const ol in C){const hl=C[ol],vl=ot[ol].paddedRect,ah=vl.x+am,uh=vl.y+am,ph=hl.data.width,Ph=hl.data.height;ry.copy(hl.data,wo,{x:0,y:0},{x:ah,y:uh},hl.data),ry.copy(hl.data,wo,{x:0,y:Ph-1},{x:ah,y:uh-1},{width:ph,height:1}),ry.copy(hl.data,wo,{x:0,y:0},{x:ah,y:uh+Ph},{width:ph,height:1}),ry.copy(hl.data,wo,{x:ph-1,y:0},{x:ah-1,y:uh},{width:1,height:Ph}),ry.copy(hl.data,wo,{x:0,y:0},{x:ah+ph,y:uh},{width:1,height:Ph})}this.image=wo,this.iconPositions=N,this.patternPositions=ot}addImages(f,C,N){for(const ot in f){const Bt=f[ot],Jt={x:0,y:0,w:Bt.data.width+2*am,h:Bt.data.height+2*am};N.push(Jt),C[ot]=new My(Jt,Bt),Bt.hasRenderCallback&&this.haveRenderCallbacks.push(ot)}}patchUpdatedImages(f,C){f.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const N in f.updatedImages)this.patchUpdatedImage(this.iconPositions[N],f.getImage(N),C),this.patchUpdatedImage(this.patternPositions[N],f.getImage(N),C)}patchUpdatedImage(f,C,N){if(!f||!C||f.version===C.version)return;f.version=C.version;const[ot,Bt]=f.tl;N.update(C.data,void 0,{x:ot,y:Bt})}}var Gm;Tp("ImagePosition",My),Tp("ImageAtlas",Py),s.WritingMode=void 0,(Gm=s.WritingMode||(s.WritingMode={}))[Gm.none=0]="none",Gm[Gm.horizontal=1]="horizontal",Gm[Gm.vertical=2]="vertical",Gm[Gm.horizontalOnly=3]="horizontalOnly";const bm=-17;class tw{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(f,C){const N=new tw;return N.scale=f||1,N.fontStack=C,N}static forImage(f){const C=new tw;return C.imageName=f,C}}class _m{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(f,C){const N=new _m;for(let ot=0;ot<f.sections.length;ot++){const Bt=f.sections[ot];Bt.image?N.addImageSection(Bt):N.addTextSection(Bt,C)}return N}length(){return this.text.length}getSection(f){return this.sections[this.sectionIndex[f]]}getSectionIndex(f){return this.sectionIndex[f]}getCharCode(f){return this.text.charCodeAt(f)}verticalizePunctuation(){this.text=function(f){let C="";for(let N=0;N<f.length;N++){const ot=f.charCodeAt(N+1)||null,Bt=f.charCodeAt(N-1)||null;C+=ot&&y0(ot)&&!Fw[f[N+1]]||Bt&&y0(Bt)&&!Fw[f[N-1]]||!Fw[f[N]]?f[N]:Fw[f[N]]}return C}(this.text)}trim(){let f=0;for(let N=0;N<this.text.length&&M0[this.text.charCodeAt(N)];N++)f++;let C=this.text.length;for(let N=this.text.length-1;N>=0&&N>=f&&M0[this.text.charCodeAt(N)];N--)C--;this.text=this.text.substring(f,C),this.sectionIndex=this.sectionIndex.slice(f,C)}substring(f,C){const N=new _m;return N.text=this.text.substring(f,C),N.sectionIndex=this.sectionIndex.slice(f,C),N.sections=this.sections,N}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((f,C)=>Math.max(f,this.sections[C].scale),0)}addTextSection(f,C){this.text+=f.text,this.sections.push(tw.forText(f.scale,f.fontStack||C));const N=this.sections.length-1;for(let ot=0;ot<f.text.length;++ot)this.sectionIndex.push(N)}addImageSection(f){const C=f.image?f.image.name:"";if(C.length===0)return void rl("Can't add FormattedSection with an empty image.");const N=this.getNextImageSectionCharCode();N?(this.text+=String.fromCharCode(N),this.sections.push(tw.forImage(C)),this.sectionIndex.push(this.sections.length-1)):rl("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function zw(x,f,C,N,ot,Bt,Jt,Ir,wo,ol,hl,vl,ah,uh,ph,Ph){const Mh=_m.fromFeature(x,ot);let Xh;vl===s.WritingMode.vertical&&Mh.verticalizePunctuation();const{processBidirectionalText:Jh,processStyledBidirectionalText:qh}=Bm;if(Jh&&Mh.sections.length===1){Xh=[];const Md=Jh(Mh.toString(),pb(Mh,ol,Bt,f,N,uh,ph));for(const Pp of Md){const bp=new _m;bp.text=Pp,bp.sections=Mh.sections;for(let yp=0;yp<Pp.length;yp++)bp.sectionIndex.push(0);Xh.push(bp)}}else if(qh){Xh=[];const Md=qh(Mh.text,Mh.sectionIndex,pb(Mh,ol,Bt,f,N,uh,ph));for(const Pp of Md){const bp=new _m;bp.text=Pp[0],bp.sectionIndex=Pp[1],bp.sections=Mh.sections,Xh.push(bp)}}else Xh=function(Md,Pp){const bp=[],yp=Md.text;let hp=0;for(const lp of Pp)bp.push(Md.substring(hp,lp)),hp=lp;return hp<yp.length&&bp.push(Md.substring(hp,yp.length)),bp}(Mh,pb(Mh,ol,Bt,f,N,uh,ph));const ld=[],pd={positionedLines:ld,text:Mh.toString(),top:hl[1],bottom:hl[1],left:hl[0],right:hl[0],writingMode:vl,iconsInText:!1,verticalizable:!1};return function(Md,Pp,bp,yp,hp,lp,Sp,vp,Jd,Xp,$p,ag){let Wg=0,Zg=bm,cm=0,oy=0;const Hm=vp==="right"?1:vp==="left"?0:.5;let ym=0;for(const Cm of hp){Cm.trim();const e_=Cm.getMaxScale(),t_=(e_-1)*mm,C_={positionedGlyphs:[],lineOffset:0};Md.positionedLines[ym]=C_;const Ig=C_.positionedGlyphs;let im=0;if(!Cm.length()){Zg+=lp,++ym;continue}for(let Im=0;Im<Cm.length();Im++){const tg=Cm.getSection(Im),$_=Cm.getSectionIndex(Im),i_=Cm.getCharCode(Im);let Mm=0,Dy=null,_v=null,Ly=null,r0=mm;const sy=!(Jd===s.WritingMode.horizontal||!$p&&!ey(i_)||$p&&(M0[i_]||(Rm=i_,sp.Arabic(Rm)||sp["Arabic Supplement"](Rm)||sp["Arabic Extended-A"](Rm)||sp["Arabic Presentation Forms-A"](Rm)||sp["Arabic Presentation Forms-B"](Rm))));if(tg.imageName){const sg=yp[tg.imageName];if(!sg)continue;Ly=tg.imageName,Md.iconsInText=Md.iconsInText||!0,_v=sg.paddedRect;const d_=sg.displaySize;tg.scale=tg.scale*mm/ag,Dy={width:d_[0],height:d_[1],left:am,top:-Rg,advance:sy?d_[1]:d_[0]},Mm=t_+(mm-d_[1]*tg.scale),r0=Dy.advance;const n0=sy?d_[0]*tg.scale-mm*e_:d_[1]*tg.scale-mm*e_;n0>0&&n0>im&&(im=n0)}else{const sg=bp[tg.fontStack],d_=sg&&sg[i_];if(d_&&d_.rect)_v=d_.rect,Dy=d_.metrics;else{const n0=Pp[tg.fontStack],uw=n0&&n0[i_];if(!uw)continue;Dy=uw.metrics}Mm=(e_-tg.scale)*mm}sy?(Md.verticalizable=!0,Ig.push({glyph:i_,imageName:Ly,x:Wg,y:Zg+Mm,vertical:sy,scale:tg.scale,fontStack:tg.fontStack,sectionIndex:$_,metrics:Dy,rect:_v}),Wg+=r0*tg.scale+Xp):(Ig.push({glyph:i_,imageName:Ly,x:Wg,y:Zg+Mm,vertical:sy,scale:tg.scale,fontStack:tg.fontStack,sectionIndex:$_,metrics:Dy,rect:_v}),Wg+=Dy.advance*tg.scale+Xp)}Ig.length!==0&&(cm=Math.max(Wg-Xp,cm),Lx(Ig,0,Ig.length-1,Hm,im)),Wg=0;const Qg=lp*e_+im;C_.lineOffset=Math.max(im,t_),Zg+=Qg,oy=Math.max(Qg,oy),++ym}var Rm;const Qm=Zg-bm,{horizontalAlign:h_,verticalAlign:D_}=fv(Sp);(function(Cm,e_,t_,C_,Ig,im,Qg,Im,tg){const $_=(e_-t_)*Ig;let i_=0;i_=im!==Qg?-Im*C_-bm:(-C_*tg+.5)*Qg;for(const Mm of Cm)for(const Dy of Mm.positionedGlyphs)Dy.x+=$_,Dy.y+=i_})(Md.positionedLines,Hm,h_,D_,cm,oy,lp,Qm,hp.length),Md.top+=-D_*Qm,Md.bottom=Md.top+Qm,Md.left+=-h_*cm,Md.right=Md.left+cm}(pd,f,C,N,Xh,Jt,Ir,wo,vl,ol,ah,Ph),!function(Md){for(const Pp of Md)if(Pp.positionedGlyphs.length!==0)return!1;return!0}(ld)&&pd}const M0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ub={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function hb(x,f,C,N,ot,Bt){if(f.imageName){const Jt=N[f.imageName];return Jt?Jt.displaySize[0]*f.scale*mm/Bt+ot:0}{const Jt=C[f.fontStack],Ir=Jt&&Jt[x];return Ir?Ir.metrics.advance*f.scale+ot:0}}function m1(x,f,C,N){const ot=Math.pow(x-f,2);return N?x<f?ot/2:2*ot:ot+Math.abs(C)*C}function oE(x,f,C){let N=0;return x===10&&(N-=1e4),C&&(N+=150),x!==40&&x!==65288||(N+=50),f!==41&&f!==65289||(N+=50),N}function _1(x,f,C,N,ot,Bt){let Jt=null,Ir=m1(f,C,ot,Bt);for(const wo of N){const ol=m1(f-wo.x,C,ot,Bt)+wo.badness;ol<=Ir&&(Jt=wo,Ir=ol)}return{index:x,x:f,priorBreak:Jt,badness:Ir}}function db(x){return x?db(x.priorBreak).concat(x.index):[]}function pb(x,f,C,N,ot,Bt,Jt){if(Bt!=="point")return[];if(!x)return[];const Ir=[],wo=function(ah,uh,ph,Ph,Mh,Xh){let Jh=0;for(let qh=0;qh<ah.length();qh++){const ld=ah.getSection(qh);Jh+=hb(ah.getCharCode(qh),ld,Ph,Mh,uh,Xh)}return Jh/Math.max(1,Math.ceil(Jh/ph))}(x,f,C,N,ot,Jt),ol=x.text.indexOf("")>=0;let hl=0;for(let ah=0;ah<x.length();ah++){const uh=x.getSection(ah),ph=x.getCharCode(ah);if(M0[ph]||(hl+=hb(ph,uh,N,ot,f,Jt)),ah<x.length()-1){const Ph=!((vl=ph)<11904||!(sp["Bopomofo Extended"](vl)||sp.Bopomofo(vl)||sp["CJK Compatibility Forms"](vl)||sp["CJK Compatibility Ideographs"](vl)||sp["CJK Compatibility"](vl)||sp["CJK Radicals Supplement"](vl)||sp["CJK Strokes"](vl)||sp["CJK Symbols and Punctuation"](vl)||sp["CJK Unified Ideographs Extension A"](vl)||sp["CJK Unified Ideographs"](vl)||sp["Enclosed CJK Letters and Months"](vl)||sp["Halfwidth and Fullwidth Forms"](vl)||sp.Hiragana(vl)||sp["Ideographic Description Characters"](vl)||sp["Kangxi Radicals"](vl)||sp["Katakana Phonetic Extensions"](vl)||sp.Katakana(vl)||sp["Vertical Forms"](vl)||sp["Yi Radicals"](vl)||sp["Yi Syllables"](vl)));(ub[ph]||Ph||uh.imageName)&&Ir.push(_1(ah+1,hl,wo,Ir,oE(ph,x.getCharCode(ah+1),Ph&&ol),!1))}}var vl;return db(_1(x.length(),hl,wo,Ir,0,!0))}function fv(x){let f=.5,C=.5;switch(x){case"right":case"top-right":case"bottom-right":f=1;break;case"left":case"top-left":case"bottom-left":f=0}switch(x){case"bottom":case"bottom-right":case"bottom-left":C=1;break;case"top":case"top-right":case"top-left":C=0}return{horizontalAlign:f,verticalAlign:C}}function Lx(x,f,C,N,ot){if(!N&&!ot)return;const Bt=x[C],Jt=(x[C].x+Bt.metrics.advance*Bt.scale)*N;for(let Ir=f;Ir<=C;Ir++)x[Ir].x-=Jt,x[Ir].y+=ot}function y1(x,f,C){const{horizontalAlign:N,verticalAlign:ot}=fv(C),Bt=f[0]-x.displaySize[0]*N,Jt=f[1]-x.displaySize[1]*ot;return{image:x,top:Jt,bottom:Jt+x.displaySize[1],left:Bt,right:Bt+x.displaySize[0]}}function Vw(x,f,C,N,ot,Bt){const Jt=x.image;let Ir;if(Jt.content){const Mh=Jt.content,Xh=Jt.pixelRatio||1;Ir=[Mh[0]/Xh,Mh[1]/Xh,Jt.displaySize[0]-Mh[2]/Xh,Jt.displaySize[1]-Mh[3]/Xh]}const wo=f.left*Bt,ol=f.right*Bt;let hl,vl,ah,uh;C==="width"||C==="both"?(uh=ot[0]+wo-N[3],vl=ot[0]+ol+N[1]):(uh=ot[0]+(wo+ol-Jt.displaySize[0])/2,vl=uh+Jt.displaySize[0]);const ph=f.top*Bt,Ph=f.bottom*Bt;return C==="height"||C==="both"?(hl=ot[1]+ph-N[0],ah=ot[1]+Ph+N[2]):(hl=ot[1]+(ph+Ph-Jt.displaySize[1])/2,ah=hl+Jt.displaySize[1]),{image:Jt,top:hl,right:vl,bottom:ah,left:uh,collisionPadding:Ir}}const Ox=255,gv=128,ux=Ox*gv;function fb(x,f){const{expression:C}=f;if(C.kind==="constant")return{kind:"constant",layoutSize:C.evaluate(new Eg(x+1))};if(C.kind==="source")return{kind:"source"};{const{zoomStops:N,interpolationType:ot}=C;let Bt=0;for(;Bt<N.length&&N[Bt]<=x;)Bt++;Bt=Math.max(0,Bt-1);let Jt=Bt;for(;Jt<N.length&&N[Jt]<x+1;)Jt++;Jt=Math.min(N.length-1,Jt);const Ir=N[Bt],wo=N[Jt];return C.kind==="composite"?{kind:"composite",minZoom:Ir,maxZoom:wo,interpolationType:ot}:{kind:"camera",minZoom:Ir,maxZoom:wo,minSize:C.evaluate(new Eg(Ir)),maxSize:C.evaluate(new Eg(wo)),interpolationType:ot}}}function gb(x,f,C){let N="never";const ot=x.get(f);return ot?N=ot:x.get(C)&&(N="always"),N}const mb=Ty.VectorTileFeature.types,sE=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function iw(x,f,C,N,ot,Bt,Jt,Ir,wo,ol,hl,vl,ah){const uh=Ir?Math.min(ux,Math.round(Ir[0])):0,ph=Ir?Math.min(ux,Math.round(Ir[1])):0;x.emplaceBack(f,C,Math.round(32*N),Math.round(32*ot),Bt,Jt,(uh<<1)+(wo?1:0),ph,16*ol,16*hl,256*vl,256*ah)}function v1(x,f,C){x.emplaceBack(f.x,f.y,C),x.emplaceBack(f.x,f.y,C),x.emplaceBack(f.x,f.y,C),x.emplaceBack(f.x,f.y,C)}function sC(x){for(const f of x.sections)if(zv(f.text))return!0;return!1}class P0{constructor(f){this.layoutVertexArray=new od,this.indexArray=new Vd,this.programConfigurations=f,this.segments=new S,this.dynamicLayoutVertexArray=new md,this.opacityVertexArray=new Nd,this.hasVisibleVertices=!1,this.placedSymbolArray=new In}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(f,C,N,ot){this.isEmpty()||(N&&(this.layoutVertexBuffer=f.createVertexBuffer(this.layoutVertexArray,e0.members),this.indexBuffer=f.createIndexBuffer(this.indexArray,C),this.dynamicLayoutVertexBuffer=f.createVertexBuffer(this.dynamicLayoutVertexArray,nE.members,!0),this.opacityVertexBuffer=f.createVertexBuffer(this.opacityVertexArray,sE,!0),this.opacityVertexBuffer.itemSize=1),(N||ot)&&this.programConfigurations.upload(f))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Tp("SymbolBuffers",P0);class x1{constructor(f,C,N){this.layoutVertexArray=new f,this.layoutAttributes=C,this.indexArray=new N,this.segments=new S,this.collisionVertexArray=new tp}upload(f){this.layoutVertexBuffer=f.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=f.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=f.createVertexBuffer(this.collisionVertexArray,Dx.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Tp("CollisionBuffers",x1);class rw{constructor(f){this.collisionBoxArray=f.collisionBoxArray,this.zoom=f.zoom,this.overscaling=f.overscaling,this.layers=f.layers,this.layerIds=this.layers.map(Jt=>Jt.id),this.index=f.index,this.pixelRatio=f.pixelRatio,this.sourceLayerIndex=f.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Pg([]),this.placementViewportMatrix=Pg([]);const C=this.layers[0]._unevaluatedLayout._values;this.textSizeData=fb(this.zoom,C["text-size"]),this.iconSizeData=fb(this.zoom,C["icon-size"]);const N=this.layers[0].layout,ot=N.get("symbol-sort-key"),Bt=N.get("symbol-z-order");this.canOverlap=gb(N,"text-overlap","text-allow-overlap")!=="never"||gb(N,"icon-overlap","icon-allow-overlap")!=="never"||N.get("text-ignore-placement")||N.get("icon-ignore-placement"),this.sortFeaturesByKey=Bt!=="viewport-y"&&!ot.isConstant(),this.sortFeaturesByY=(Bt==="viewport-y"||Bt==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,N.get("symbol-placement")==="point"&&(this.writingModes=N.get("text-writing-mode").map(Jt=>s.WritingMode[Jt])),this.stateDependentLayerIds=this.layers.filter(Jt=>Jt.isStateDependent()).map(Jt=>Jt.id),this.sourceID=f.sourceID}createArrays(){this.text=new P0(new ed(this.layers,this.zoom,f=>/^text/.test(f))),this.icon=new P0(new ed(this.layers,this.zoom,f=>/^icon/.test(f))),this.glyphOffsetArray=new vs,this.lineVertexArray=new fl,this.symbolInstances=new hs}calculateGlyphDependencies(f,C,N,ot,Bt){for(let Jt=0;Jt<f.length;Jt++)if(C[f.charCodeAt(Jt)]=!0,(N||ot)&&Bt){const Ir=Fw[f.charAt(Jt)];Ir&&(C[Ir.charCodeAt(0)]=!0)}}populate(f,C,N){const ot=this.layers[0],Bt=ot.layout,Jt=Bt.get("text-font"),Ir=Bt.get("text-field"),wo=Bt.get("icon-image"),ol=(Ir.value.kind!=="constant"||Ir.value.value instanceof Bg&&!Ir.value.value.isEmpty()||Ir.value.value.toString().length>0)&&(Jt.value.kind!=="constant"||Jt.value.value.length>0),hl=wo.value.kind!=="constant"||!!wo.value.value||Object.keys(wo.parameters).length>0,vl=Bt.get("symbol-sort-key");if(this.features=[],!ol&&!hl)return;const ah=C.iconDependencies,uh=C.glyphDependencies,ph=C.availableImages,Ph=new Eg(this.zoom);for(const{feature:Mh,id:Xh,index:Jh,sourceLayerIndex:qh}of f){const ld=ot._featureFilter.needGeometry,pd=Id(Mh,ld);if(!ot._featureFilter.filter(Ph,pd,N))continue;let Md,Pp;if(ld||(pd.geometry=Od(Mh)),ol){const yp=ot.getValueAndResolveTokens("text-field",pd,N,ph),hp=Bg.factory(yp);sC(hp)&&(this.hasRTLText=!0),(!this.hasRTLText||xy()==="unavailable"||this.hasRTLText&&Bm.isParsed())&&(Md=Iy(hp,ot,pd))}if(hl){const yp=ot.getValueAndResolveTokens("icon-image",pd,N,ph);Pp=yp instanceof nm?yp:nm.fromString(yp)}if(!Md&&!Pp)continue;const bp=this.sortFeaturesByKey?vl.evaluate(pd,{},N):void 0;if(this.features.push({id:Xh,text:Md,icon:Pp,index:Jh,sourceLayerIndex:qh,geometry:pd.geometry,properties:Mh.properties,type:mb[Mh.type],sortKey:bp}),Pp&&(ah[Pp.name]=!0),Md){const yp=Jt.evaluate(pd,{},N).join(","),hp=Bt.get("text-rotation-alignment")!=="viewport"&&Bt.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(s.WritingMode.vertical)>=0;for(const lp of Md.sections)if(lp.image)ah[lp.image.name]=!0;else{const Sp=_y(Md.toString()),vp=lp.fontStack||yp,Jd=uh[vp]=uh[vp]||{};this.calculateGlyphDependencies(lp.text,Jd,hp,this.allowVerticalPlacement,Sp)}}}Bt.get("symbol-placement")==="line"&&(this.features=function(Mh){const Xh={},Jh={},qh=[];let ld=0;function pd(yp){qh.push(Mh[yp]),ld++}function Md(yp,hp,lp){const Sp=Jh[yp];return delete Jh[yp],Jh[hp]=Sp,qh[Sp].geometry[0].pop(),qh[Sp].geometry[0]=qh[Sp].geometry[0].concat(lp[0]),Sp}function Pp(yp,hp,lp){const Sp=Xh[hp];return delete Xh[hp],Xh[yp]=Sp,qh[Sp].geometry[0].shift(),qh[Sp].geometry[0]=lp[0].concat(qh[Sp].geometry[0]),Sp}function bp(yp,hp,lp){const Sp=lp?hp[0][hp[0].length-1]:hp[0][0];return`${yp}:${Sp.x}:${Sp.y}`}for(let yp=0;yp<Mh.length;yp++){const hp=Mh[yp],lp=hp.geometry,Sp=hp.text?hp.text.toString():null;if(!Sp){pd(yp);continue}const vp=bp(Sp,lp),Jd=bp(Sp,lp,!0);if(vp in Jh&&Jd in Xh&&Jh[vp]!==Xh[Jd]){const Xp=Pp(vp,Jd,lp),$p=Md(vp,Jd,qh[Xp].geometry);delete Xh[vp],delete Jh[Jd],Jh[bp(Sp,qh[$p].geometry,!0)]=$p,qh[Xp].geometry=null}else vp in Jh?Md(vp,Jd,lp):Jd in Xh?Pp(vp,Jd,lp):(pd(yp),Xh[vp]=ld-1,Jh[Jd]=ld-1)}return qh.filter(yp=>yp.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Mh,Xh)=>Mh.sortKey-Xh.sortKey)}update(f,C,N){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(f,C,this.layers,N),this.icon.programConfigurations.updatePaintArrays(f,C,this.layers,N))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(f){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(f),this.iconCollisionBox.upload(f)),this.text.upload(f,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(f,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(f,C){const N=this.lineVertexArray.length;if(f.segment!==void 0){let ot=f.dist(C[f.segment+1]),Bt=f.dist(C[f.segment]);const Jt={};for(let Ir=f.segment+1;Ir<C.length;Ir++)Jt[Ir]={x:C[Ir].x,y:C[Ir].y,tileUnitDistanceFromAnchor:ot},Ir<C.length-1&&(ot+=C[Ir+1].dist(C[Ir]));for(let Ir=f.segment||0;Ir>=0;Ir--)Jt[Ir]={x:C[Ir].x,y:C[Ir].y,tileUnitDistanceFromAnchor:Bt},Ir>0&&(Bt+=C[Ir-1].dist(C[Ir]));for(let Ir=0;Ir<C.length;Ir++){const wo=Jt[Ir];this.lineVertexArray.emplaceBack(wo.x,wo.y,wo.tileUnitDistanceFromAnchor)}}return{lineStartIndex:N,lineLength:this.lineVertexArray.length-N}}addSymbols(f,C,N,ot,Bt,Jt,Ir,wo,ol,hl,vl,ah){const uh=f.indexArray,ph=f.layoutVertexArray,Ph=f.segments.prepareSegment(4*C.length,ph,uh,this.canOverlap?Jt.sortKey:void 0),Mh=this.glyphOffsetArray.length,Xh=Ph.vertexLength,Jh=this.allowVerticalPlacement&&Ir===s.WritingMode.vertical?Math.PI/2:0,qh=Jt.text&&Jt.text.sections;for(let ld=0;ld<C.length;ld++){const{tl:pd,tr:Md,bl:Pp,br:bp,tex:yp,pixelOffsetTL:hp,pixelOffsetBR:lp,minFontScaleX:Sp,minFontScaleY:vp,glyphOffset:Jd,isSDF:Xp,sectionIndex:$p}=C[ld],ag=Ph.vertexLength,Wg=Jd[1];iw(ph,wo.x,wo.y,pd.x,Wg+pd.y,yp.x,yp.y,N,Xp,hp.x,hp.y,Sp,vp),iw(ph,wo.x,wo.y,Md.x,Wg+Md.y,yp.x+yp.w,yp.y,N,Xp,lp.x,hp.y,Sp,vp),iw(ph,wo.x,wo.y,Pp.x,Wg+Pp.y,yp.x,yp.y+yp.h,N,Xp,hp.x,lp.y,Sp,vp),iw(ph,wo.x,wo.y,bp.x,Wg+bp.y,yp.x+yp.w,yp.y+yp.h,N,Xp,lp.x,lp.y,Sp,vp),v1(f.dynamicLayoutVertexArray,wo,Jh),uh.emplaceBack(ag,ag+1,ag+2),uh.emplaceBack(ag+1,ag+2,ag+3),Ph.vertexLength+=4,Ph.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Jd[0]),ld!==C.length-1&&$p===C[ld+1].sectionIndex||f.programConfigurations.populatePaintArrays(ph.length,Jt,Jt.index,{},ah,qh&&qh[$p])}f.placedSymbolArray.emplaceBack(wo.x,wo.y,Mh,this.glyphOffsetArray.length-Mh,Xh,ol,hl,wo.segment,N?N[0]:0,N?N[1]:0,ot[0],ot[1],Ir,0,!1,0,vl)}_addCollisionDebugVertex(f,C,N,ot,Bt,Jt){return C.emplaceBack(0,0),f.emplaceBack(N.x,N.y,ot,Bt,Math.round(Jt.x),Math.round(Jt.y))}addCollisionDebugVertices(f,C,N,ot,Bt,Jt,Ir){const wo=Bt.segments.prepareSegment(4,Bt.layoutVertexArray,Bt.indexArray),ol=wo.vertexLength,hl=Bt.layoutVertexArray,vl=Bt.collisionVertexArray,ah=Ir.anchorX,uh=Ir.anchorY;this._addCollisionDebugVertex(hl,vl,Jt,ah,uh,new W(f,C)),this._addCollisionDebugVertex(hl,vl,Jt,ah,uh,new W(N,C)),this._addCollisionDebugVertex(hl,vl,Jt,ah,uh,new W(N,ot)),this._addCollisionDebugVertex(hl,vl,Jt,ah,uh,new W(f,ot)),wo.vertexLength+=4;const ph=Bt.indexArray;ph.emplaceBack(ol,ol+1),ph.emplaceBack(ol+1,ol+2),ph.emplaceBack(ol+2,ol+3),ph.emplaceBack(ol+3,ol),wo.primitiveLength+=4}addDebugCollisionBoxes(f,C,N,ot){for(let Bt=f;Bt<C;Bt++){const Jt=this.collisionBoxArray.get(Bt);this.addCollisionDebugVertices(Jt.x1,Jt.y1,Jt.x2,Jt.y2,ot?this.textCollisionBox:this.iconCollisionBox,Jt.anchorPoint,N)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new x1(Hd,Yx.members,gp),this.iconCollisionBox=new x1(Hd,Yx.members,gp);for(let f=0;f<this.symbolInstances.length;f++){const C=this.symbolInstances.get(f);this.addDebugCollisionBoxes(C.textBoxStartIndex,C.textBoxEndIndex,C,!0),this.addDebugCollisionBoxes(C.verticalTextBoxStartIndex,C.verticalTextBoxEndIndex,C,!0),this.addDebugCollisionBoxes(C.iconBoxStartIndex,C.iconBoxEndIndex,C,!1),this.addDebugCollisionBoxes(C.verticalIconBoxStartIndex,C.verticalIconBoxEndIndex,C,!1)}}_deserializeCollisionBoxesForSymbol(f,C,N,ot,Bt,Jt,Ir,wo,ol){const hl={};for(let vl=C;vl<N;vl++){const ah=f.get(vl);hl.textBox={x1:ah.x1,y1:ah.y1,x2:ah.x2,y2:ah.y2,anchorPointX:ah.anchorPointX,anchorPointY:ah.anchorPointY},hl.textFeatureIndex=ah.featureIndex;break}for(let vl=ot;vl<Bt;vl++){const ah=f.get(vl);hl.verticalTextBox={x1:ah.x1,y1:ah.y1,x2:ah.x2,y2:ah.y2,anchorPointX:ah.anchorPointX,anchorPointY:ah.anchorPointY},hl.verticalTextFeatureIndex=ah.featureIndex;break}for(let vl=Jt;vl<Ir;vl++){const ah=f.get(vl);hl.iconBox={x1:ah.x1,y1:ah.y1,x2:ah.x2,y2:ah.y2,anchorPointX:ah.anchorPointX,anchorPointY:ah.anchorPointY},hl.iconFeatureIndex=ah.featureIndex;break}for(let vl=wo;vl<ol;vl++){const ah=f.get(vl);hl.verticalIconBox={x1:ah.x1,y1:ah.y1,x2:ah.x2,y2:ah.y2,anchorPointX:ah.anchorPointX,anchorPointY:ah.anchorPointY},hl.verticalIconFeatureIndex=ah.featureIndex;break}return hl}deserializeCollisionBoxes(f){this.collisionArrays=[];for(let C=0;C<this.symbolInstances.length;C++){const N=this.symbolInstances.get(C);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(f,N.textBoxStartIndex,N.textBoxEndIndex,N.verticalTextBoxStartIndex,N.verticalTextBoxEndIndex,N.iconBoxStartIndex,N.iconBoxEndIndex,N.verticalIconBoxStartIndex,N.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(f,C){const N=f.placedSymbolArray.get(C),ot=N.vertexStartIndex+4*N.numGlyphs;for(let Bt=N.vertexStartIndex;Bt<ot;Bt+=4)f.indexArray.emplaceBack(Bt,Bt+1,Bt+2),f.indexArray.emplaceBack(Bt+1,Bt+2,Bt+3)}getSortedSymbolIndexes(f){if(this.sortedAngle===f&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const C=Math.sin(f),N=Math.cos(f),ot=[],Bt=[],Jt=[];for(let Ir=0;Ir<this.symbolInstances.length;++Ir){Jt.push(Ir);const wo=this.symbolInstances.get(Ir);ot.push(0|Math.round(C*wo.anchorX+N*wo.anchorY)),Bt.push(wo.featureIndex)}return Jt.sort((Ir,wo)=>ot[Ir]-ot[wo]||Bt[wo]-Bt[Ir]),Jt}addToSortKeyRanges(f,C){const N=this.sortKeyRanges[this.sortKeyRanges.length-1];N&&N.sortKey===C?N.symbolInstanceEnd=f+1:this.sortKeyRanges.push({sortKey:C,symbolInstanceStart:f,symbolInstanceEnd:f+1})}sortFeatures(f){if(this.sortFeaturesByY&&this.sortedAngle!==f&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(f),this.sortedAngle=f,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const C of this.symbolInstanceIndexes){const N=this.symbolInstances.get(C);this.featureSortOrder.push(N.featureIndex),[N.rightJustifiedTextSymbolIndex,N.centerJustifiedTextSymbolIndex,N.leftJustifiedTextSymbolIndex].forEach((ot,Bt,Jt)=>{ot>=0&&Jt.indexOf(ot)===Bt&&this.addIndicesForPlacedSymbol(this.text,ot)}),N.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,N.verticalPlacedTextSymbolIndex),N.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,N.placedIconSymbolIndex),N.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,N.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Fx,Uw;Tp("SymbolBucket",rw,{omit:["layers","collisionBoxArray","features","compareText"]}),rw.MAX_GLYPHS=65535,rw.addDynamicAttributes=v1;var w1={get paint(){return Uw=Uw||new Am({"icon-opacity":new Kp(Yh.paint_symbol["icon-opacity"]),"icon-color":new Kp(Yh.paint_symbol["icon-color"]),"icon-halo-color":new Kp(Yh.paint_symbol["icon-halo-color"]),"icon-halo-width":new Kp(Yh.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Kp(Yh.paint_symbol["icon-halo-blur"]),"icon-translate":new Np(Yh.paint_symbol["icon-translate"]),"icon-translate-anchor":new Np(Yh.paint_symbol["icon-translate-anchor"]),"text-opacity":new Kp(Yh.paint_symbol["text-opacity"]),"text-color":new Kp(Yh.paint_symbol["text-color"],{runtimeType:Up,getOverride:x=>x.textColor,hasOverride:x=>!!x.textColor}),"text-halo-color":new Kp(Yh.paint_symbol["text-halo-color"]),"text-halo-width":new Kp(Yh.paint_symbol["text-halo-width"]),"text-halo-blur":new Kp(Yh.paint_symbol["text-halo-blur"]),"text-translate":new Np(Yh.paint_symbol["text-translate"]),"text-translate-anchor":new Np(Yh.paint_symbol["text-translate-anchor"])})},get layout(){return Fx=Fx||new Am({"symbol-placement":new Np(Yh.layout_symbol["symbol-placement"]),"symbol-spacing":new Np(Yh.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Np(Yh.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Kp(Yh.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Np(Yh.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Np(Yh.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Np(Yh.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Np(Yh.layout_symbol["icon-ignore-placement"]),"icon-optional":new Np(Yh.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Np(Yh.layout_symbol["icon-rotation-alignment"]),"icon-size":new Kp(Yh.layout_symbol["icon-size"]),"icon-text-fit":new Np(Yh.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Np(Yh.layout_symbol["icon-text-fit-padding"]),"icon-image":new Kp(Yh.layout_symbol["icon-image"]),"icon-rotate":new Kp(Yh.layout_symbol["icon-rotate"]),"icon-padding":new Kp(Yh.layout_symbol["icon-padding"]),"icon-keep-upright":new Np(Yh.layout_symbol["icon-keep-upright"]),"icon-offset":new Kp(Yh.layout_symbol["icon-offset"]),"icon-anchor":new Kp(Yh.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Np(Yh.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Np(Yh.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Np(Yh.layout_symbol["text-rotation-alignment"]),"text-field":new Kp(Yh.layout_symbol["text-field"]),"text-font":new Kp(Yh.layout_symbol["text-font"]),"text-size":new Kp(Yh.layout_symbol["text-size"]),"text-max-width":new Kp(Yh.layout_symbol["text-max-width"]),"text-line-height":new Np(Yh.layout_symbol["text-line-height"]),"text-letter-spacing":new Kp(Yh.layout_symbol["text-letter-spacing"]),"text-justify":new Kp(Yh.layout_symbol["text-justify"]),"text-radial-offset":new Kp(Yh.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Np(Yh.layout_symbol["text-variable-anchor"]),"text-anchor":new Kp(Yh.layout_symbol["text-anchor"]),"text-max-angle":new Np(Yh.layout_symbol["text-max-angle"]),"text-writing-mode":new Np(Yh.layout_symbol["text-writing-mode"]),"text-rotate":new Kp(Yh.layout_symbol["text-rotate"]),"text-padding":new Np(Yh.layout_symbol["text-padding"]),"text-keep-upright":new Np(Yh.layout_symbol["text-keep-upright"]),"text-transform":new Kp(Yh.layout_symbol["text-transform"]),"text-offset":new Kp(Yh.layout_symbol["text-offset"]),"text-allow-overlap":new Np(Yh.layout_symbol["text-allow-overlap"]),"text-overlap":new Np(Yh.layout_symbol["text-overlap"]),"text-ignore-placement":new Np(Yh.layout_symbol["text-ignore-placement"]),"text-optional":new Np(Yh.layout_symbol["text-optional"])})}};class _b{constructor(f){if(f.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=f.property.overrides?f.property.overrides.runtimeType:Vp,this.defaultValue=f}evaluate(f){if(f.formattedSection){const C=this.defaultValue.property.overrides;if(C&&C.hasOverride(f.formattedSection))return C.getOverride(f.formattedSection)}return f.feature&&f.featureState?this.defaultValue.evaluate(f.feature,f.featureState):this.defaultValue.property.specification.default}eachChild(f){this.defaultValue.isConstant()||f(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Tp("FormatSectionOverride",_b,{omit:["defaultValue"]});class b1 extends x_{constructor(f){super(f,w1)}recalculate(f,C){if(super.recalculate(f,C),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const N=this.layout.get("text-writing-mode");if(N){const ot=[];for(const Bt of N)ot.indexOf(Bt)<0&&ot.push(Bt);this.layout._values["text-writing-mode"]=ot}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(f,C,N,ot){const Bt=this.layout.get(f).evaluate(C,{},N,ot),Jt=this._unevaluatedLayout._values[f];return Jt.isDataDriven()||Iv(Jt.value)||!Bt?Bt:function(Ir,wo){return wo.replace(/{([^{}]+)}/g,(ol,hl)=>hl in Ir?String(Ir[hl]):"")}(C.properties,Bt)}createBucket(f){return new rw(f)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const f of w1.paint.overridableProperties){if(!b1.hasPaintOverride(this.layout,f))continue;const C=this.paint.get(f),N=new _b(C),ot=new jy(N,C.property.specification);let Bt=null;Bt=C.value.kind==="constant"||C.value.kind==="source"?new Mv("source",ot):new ig("composite",ot,C.value.zoomStops),this.paint._values[f]=new Xm(C.property,Bt,C.parameters)}}_handleOverridablePaintPropertyUpdate(f,C,N){return!(!this.layout||C.isDataDriven()||N.isDataDriven())&&b1.hasPaintOverride(this.layout,f)}static hasPaintOverride(f,C){const N=f.get("text-field"),ot=w1.paint.properties[C];let Bt=!1;const Jt=Ir=>{for(const wo of Ir)if(ot.overrides&&ot.overrides.hasOverride(wo))return void(Bt=!0)};if(N.value.kind==="constant"&&N.value.value instanceof Bg)Jt(N.value.value.sections);else if(N.value.kind==="source"){const Ir=ol=>{Bt||(ol instanceof f_&&Dg(ol.value)===bg?Jt(ol.value.sections):ol instanceof Uy?Jt(ol.sections):ol.eachChild(Ir))},wo=N.value;wo._styleExpression&&Ir(wo._styleExpression.expression)}return Bt}}let aC;var lC={get paint(){return aC=aC||new Am({"background-color":new Np(Yh.paint_background["background-color"]),"background-pattern":new Hv(Yh.paint_background["background-pattern"]),"background-opacity":new Np(Yh.paint_background["background-opacity"])})}};let cC;var uC={get paint(){return cC=cC||new Am({"raster-opacity":new Np(Yh.paint_raster["raster-opacity"]),"raster-hue-rotate":new Np(Yh.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Np(Yh.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Np(Yh.paint_raster["raster-brightness-max"]),"raster-saturation":new Np(Yh.paint_raster["raster-saturation"]),"raster-contrast":new Np(Yh.paint_raster["raster-contrast"]),"raster-resampling":new Np(Yh.paint_raster["raster-resampling"]),"raster-fade-duration":new Np(Yh.paint_raster["raster-fade-duration"])})}};class aE extends x_{constructor(f){super(f,{}),this.onAdd=C=>{this.implementation.onAdd&&this.implementation.onAdd(C,C.painter.context.gl)},this.onRemove=C=>{this.implementation.onRemove&&this.implementation.onRemove(C,C.painter.context.gl)},this.implementation=f}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const lE={circle:class extends x_{constructor(x){super(x,mg)}createBucket(x){return new Gp(x)}queryRadius(x){const f=x;return om("circle-radius",this,f)+om("circle-stroke-width",this,f)+c_(this.paint.get("circle-translate"))}queryIntersectsFeature(x,f,C,N,ot,Bt,Jt,Ir){const wo=I_(x,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),Bt.angle,Jt),ol=this.paint.get("circle-radius").evaluate(f,C)+this.paint.get("circle-stroke-width").evaluate(f,C),hl=this.paint.get("circle-pitch-alignment")==="map",vl=hl?wo:function(uh,ph){return uh.map(Ph=>Ey(Ph,ph))}(wo,Ir),ah=hl?ol*Jt:ol;for(const uh of N)for(const ph of uh){const Ph=hl?ph:Ey(ph,Ir);let Mh=ah;const Xh=Zv([],[ph.x,ph.y,0,1],Ir);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Mh*=Xh[3]/Bt.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Mh*=Bt.cameraToCenterDistance/Xh[3]),Mp(vl,Ph,Mh))return!0}return!1}},heatmap:class extends x_{createBucket(x){return new cv(x)}constructor(x){super(x,$x),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(x){x==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=o1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends x_{constructor(x){super(x,Hb)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends x_{constructor(x){super(x,Kb)}recalculate(x,f){super.recalculate(x,f);const C=this.paint._values["fill-outline-color"];C.value.kind==="constant"&&C.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(x){return new Pw(x)}queryRadius(){return c_(this.paint.get("fill-translate"))}queryIntersectsFeature(x,f,C,N,ot,Bt,Jt){return Zp(I_(x,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),Bt.angle,Jt),N)}isTileClipped(){return!0}},"fill-extrusion":class extends x_{constructor(x){super(x,Yb)}createBucket(x){return new ny(x)}queryRadius(){return c_(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(x,f,C,N,ot,Bt,Jt,Ir){const wo=I_(x,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),Bt.angle,Jt),ol=this.paint.get("fill-extrusion-height").evaluate(f,C),hl=this.paint.get("fill-extrusion-base").evaluate(f,C),vl=function(uh,ph,Ph,Mh){const Xh=[];for(const Jh of uh){const qh=[Jh.x,Jh.y,0,1];Zv(qh,qh,ph),Xh.push(new W(qh[0]/qh[3],qh[1]/qh[3]))}return Xh}(wo,Ir),ah=function(uh,ph,Ph,Mh){const Xh=[],Jh=[],qh=Mh[8]*ph,ld=Mh[9]*ph,pd=Mh[10]*ph,Md=Mh[11]*ph,Pp=Mh[8]*Ph,bp=Mh[9]*Ph,yp=Mh[10]*Ph,hp=Mh[11]*Ph;for(const lp of uh){const Sp=[],vp=[];for(const Jd of lp){const Xp=Jd.x,$p=Jd.y,ag=Mh[0]*Xp+Mh[4]*$p+Mh[12],Wg=Mh[1]*Xp+Mh[5]*$p+Mh[13],Zg=Mh[2]*Xp+Mh[6]*$p+Mh[14],cm=Mh[3]*Xp+Mh[7]*$p+Mh[15],oy=Zg+pd,Hm=cm+Md,ym=ag+Pp,Rm=Wg+bp,Qm=Zg+yp,h_=cm+hp,D_=new W((ag+qh)/Hm,(Wg+ld)/Hm);D_.z=oy/Hm,Sp.push(D_);const Cm=new W(ym/h_,Rm/h_);Cm.z=Qm/h_,vp.push(Cm)}Xh.push(Sp),Jh.push(vp)}return[Xh,Jh]}(N,hl,ol,Ir);return function(uh,ph,Ph){let Mh=1/0;Zp(Ph,ph)&&(Mh=eb(Ph,ph[0]));for(let Xh=0;Xh<ph.length;Xh++){const Jh=ph[Xh],qh=uh[Xh];for(let ld=0;ld<Jh.length-1;ld++){const pd=Jh[ld],Md=[pd,Jh[ld+1],qh[ld+1],qh[ld],pd];Hf(Ph,Md)&&(Mh=Math.min(Mh,eb(Ph,Md)))}}return Mh!==1/0&&Mh}(ah[0],ah[1],vl)}},line:class extends x_{constructor(x){super(x,h1),this.gradientVersion=0,Xx||(Xx=new b_(h1.paint.properties["line-width"].specification),Xx.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(x){x==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof uy,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(x,f){super.recalculate(x,f),this.paint._values["line-floorwidth"]=Xx.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,x)}createBucket(x){return new Px(x)}queryRadius(x){const f=x,C=ib(om("line-width",this,f),om("line-gap-width",this,f)),N=om("line-offset",this,f);return C/2+Math.abs(N)+c_(this.paint.get("line-translate"))}queryIntersectsFeature(x,f,C,N,ot,Bt,Jt){const Ir=I_(x,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),Bt.angle,Jt),wo=Jt/2*ib(this.paint.get("line-width").evaluate(f,C),this.paint.get("line-gap-width").evaluate(f,C)),ol=this.paint.get("line-offset").evaluate(f,C);return ol&&(N=function(hl,vl){const ah=[];for(let uh=0;uh<hl.length;uh++){const ph=hl[uh],Ph=[];for(let Mh=0;Mh<ph.length;Mh++){const Xh=ph[Mh-1],Jh=ph[Mh],qh=ph[Mh+1],ld=Mh===0?new W(0,0):Jh.sub(Xh)._unit()._perp(),pd=Mh===ph.length-1?new W(0,0):qh.sub(Jh)._unit()._perp(),Md=ld._add(pd)._unit(),Pp=Md.x*pd.x+Md.y*pd.y;Pp!==0&&Md._mult(1/Pp),Ph.push(Md._mult(vl)._add(Jh))}ah.push(Ph)}return ah}(N,ol*Jt)),function(hl,vl,ah){for(let uh=0;uh<vl.length;uh++){const ph=vl[uh];if(hl.length>=3){for(let Ph=0;Ph<ph.length;Ph++)if(gg(hl,ph[Ph]))return!0}if(rg(hl,ph,ah))return!0}return!1}(Ir,N,wo)}isTileClipped(){return!0}},symbol:b1,background:class extends x_{constructor(x){super(x,lC)}},raster:class extends x_{constructor(x){super(x,uC)}}};class hC{constructor(f){this._callback=f,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const C1=63710088e-1;class D0{constructor(f,C){if(isNaN(f)||isNaN(C))throw new Error(`Invalid LngLat object: (${f}, ${C})`);if(this.lng=+f,this.lat=+C,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new D0(Vn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(f){const C=Math.PI/180,N=this.lat*C,ot=f.lat*C,Bt=Math.sin(N)*Math.sin(ot)+Math.cos(N)*Math.cos(ot)*Math.cos((f.lng-this.lng)*C);return C1*Math.acos(Math.min(Bt,1))}static convert(f){if(f instanceof D0)return f;if(Array.isArray(f)&&(f.length===2||f.length===3))return new D0(Number(f[0]),Number(f[1]));if(!Array.isArray(f)&&typeof f=="object"&&f!==null)return new D0(Number("lng"in f?f.lng:f.lon),Number(f.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const E1=2*Math.PI*C1;function t0(x){return E1*Math.cos(x*Math.PI/180)}function P_(x){return(180+x)/360}function dC(x){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+x*Math.PI/360)))/360}function S1(x,f){return x/t0(f)}function yb(x){return 360/Math.PI*Math.atan(Math.exp((180-360*x)*Math.PI/180))-90}class T1{constructor(f,C,N=0){this.x=+f,this.y=+C,this.z=+N}static fromLngLat(f,C=0){const N=D0.convert(f);return new T1(P_(N.lng),dC(N.lat),S1(C,N.lat))}toLngLat(){return new D0(360*this.x-180,yb(this.y))}toAltitude(){return this.z*t0(yb(this.y))}meterInMercatorCoordinateUnits(){return 1/E1*(f=yb(this.y),1/Math.cos(f*Math.PI/180));var f}}function pC(x,f,C){var N=2*Math.PI*6378137/256/Math.pow(2,C);return[x*N-2*Math.PI*6378137/2,f*N-2*Math.PI*6378137/2]}class $w{constructor(f,C,N){if(f<0||f>25||N<0||N>=Math.pow(2,f)||C<0||C>=Math.pow(2,f))throw new Error(`x=${C}, y=${N}, z=${f} outside of bounds. 0<=x<${Math.pow(2,f)}, 0<=y<${Math.pow(2,f)} 0<=z<=25 `);this.z=f,this.x=C,this.y=N,this.key=mv(0,f,f,C,N)}equals(f){return this.z===f.z&&this.x===f.x&&this.y===f.y}url(f,C,N){const ot=(Jt=this.y,Ir=this.z,wo=pC(256*(Bt=this.x),256*(Jt=Math.pow(2,Ir)-Jt-1),Ir),ol=pC(256*(Bt+1),256*(Jt+1),Ir),wo[0]+","+wo[1]+","+ol[0]+","+ol[1]);var Bt,Jt,Ir,wo,ol;const hl=function(vl,ah,uh){let ph,Ph="";for(let Mh=vl;Mh>0;Mh--)ph=1<<Mh-1,Ph+=(ah&ph?1:0)+(uh&ph?2:0);return Ph}(this.z,this.x,this.y);return f[(this.x+this.y)%f.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(N==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,C>1?"@2x":"").replace(/{quadkey}/g,hl).replace(/{bbox-epsg-3857}/g,ot)}isChildOf(f){const C=this.z-f.z;return C>0&&f.x===this.x>>C&&f.y===this.y>>C}getTilePoint(f){const C=Math.pow(2,this.z);return new W((f.x*C-this.x)*xd,(f.y*C-this.y)*xd)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Hw{constructor(f,C){this.wrap=f,this.canonical=C,this.key=mv(f,C.z,C.z,C.x,C.y)}}class U_{constructor(f,C,N,ot,Bt){if(f<N)throw new Error(`overscaledZ should be >= z; overscaledZ = ${f}; z = ${N}`);this.overscaledZ=f,this.wrap=C,this.canonical=new $w(N,+ot,+Bt),this.key=mv(C,f,N,ot,Bt)}clone(){return new U_(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(f){return this.overscaledZ===f.overscaledZ&&this.wrap===f.wrap&&this.canonical.equals(f.canonical)}scaledTo(f){if(f>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${f}; overscaledZ = ${this.overscaledZ}`);const C=this.canonical.z-f;return f>this.canonical.z?new U_(f,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new U_(f,this.wrap,f,this.canonical.x>>C,this.canonical.y>>C)}calculateScaledKey(f,C){if(f>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${f}; overscaledZ = ${this.overscaledZ}`);const N=this.canonical.z-f;return f>this.canonical.z?mv(this.wrap*+C,f,this.canonical.z,this.canonical.x,this.canonical.y):mv(this.wrap*+C,f,f,this.canonical.x>>N,this.canonical.y>>N)}isChildOf(f){if(f.wrap!==this.wrap)return!1;const C=this.canonical.z-f.canonical.z;return f.overscaledZ===0||f.overscaledZ<this.overscaledZ&&f.canonical.x===this.canonical.x>>C&&f.canonical.y===this.canonical.y>>C}children(f){if(this.overscaledZ>=f)return[new U_(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const C=this.canonical.z+1,N=2*this.canonical.x,ot=2*this.canonical.y;return[new U_(C,this.wrap,C,N,ot),new U_(C,this.wrap,C,N+1,ot),new U_(C,this.wrap,C,N,ot+1),new U_(C,this.wrap,C,N+1,ot+1)]}isLessThan(f){return this.wrap<f.wrap||!(this.wrap>f.wrap)&&(this.overscaledZ<f.overscaledZ||!(this.overscaledZ>f.overscaledZ)&&(this.canonical.x<f.canonical.x||!(this.canonical.x>f.canonical.x)&&this.canonical.y<f.canonical.y))}wrapped(){return new U_(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(f){return new U_(this.overscaledZ,f,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Hw(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(f){return this.canonical.getTilePoint(new T1(f.x-this.wrap,f.y))}}function mv(x,f,C,N,ot){(x*=2)<0&&(x=-1*x-1);const Bt=1<<C;return(Bt*Bt*x+Bt*ot+N).toString(36)+C.toString(36)+f.toString(36)}Tp("CanonicalTileID",$w),Tp("OverscaledTileID",U_,{omit:["posMatrix"]});class nw{constructor(f,C,N){if(this.uid=f,C.height!==C.width)throw new RangeError("DEM tiles must be square");if(N&&N!=="mapbox"&&N!=="terrarium")return void rl(`"${N}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=C.height;const ot=this.dim=C.height-2;this.data=new Uint32Array(C.data.buffer),this.encoding=N||"mapbox";for(let Bt=0;Bt<ot;Bt++)this.data[this._idx(-1,Bt)]=this.data[this._idx(0,Bt)],this.data[this._idx(ot,Bt)]=this.data[this._idx(ot-1,Bt)],this.data[this._idx(Bt,-1)]=this.data[this._idx(Bt,0)],this.data[this._idx(Bt,ot)]=this.data[this._idx(Bt,ot-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(ot,-1)]=this.data[this._idx(ot-1,0)],this.data[this._idx(-1,ot)]=this.data[this._idx(0,ot-1)],this.data[this._idx(ot,ot)]=this.data[this._idx(ot-1,ot-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let Bt=0;Bt<ot;Bt++)for(let Jt=0;Jt<ot;Jt++){const Ir=this.get(Bt,Jt);Ir>this.max&&(this.max=Ir),Ir<this.min&&(this.min=Ir)}}get(f,C){const N=new Uint8Array(this.data.buffer),ot=4*this._idx(f,C);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(N[ot],N[ot+1],N[ot+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(f,C){if(f<-1||f>=this.dim+1||C<-1||C>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(C+1)*this.stride+(f+1)}_unpackMapbox(f,C,N){return(256*f*256+256*C+N)/10-1e4}_unpackTerrarium(f,C,N){return 256*f+C+N/256-32768}getPixels(){return new ry({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(f,C,N){if(this.dim!==f.dim)throw new Error("dem dimension mismatch");let ot=C*this.dim,Bt=C*this.dim+this.dim,Jt=N*this.dim,Ir=N*this.dim+this.dim;switch(C){case-1:ot=Bt-1;break;case 1:Bt=ot+1}switch(N){case-1:Jt=Ir-1;break;case 1:Ir=Jt+1}const wo=-C*this.dim,ol=-N*this.dim;for(let hl=Jt;hl<Ir;hl++)for(let vl=ot;vl<Bt;vl++)this.data[this._idx(vl,hl)]=f.data[this._idx(vl+wo,hl+ol)]}}Tp("DEMData",nw);class fC{constructor(f){this._stringToNumber={},this._numberToString=[];for(let C=0;C<f.length;C++){const N=f[C];this._stringToNumber[N]=C,this._numberToString[C]=N}}encode(f){return this._stringToNumber[f]}decode(f){if(f>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${f} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[f]}}class gC{constructor(f,C,N,ot,Bt){this.type="Feature",this._vectorTileFeature=f,f._z=C,f._x=N,f._y=ot,this.properties=f.properties,this.id=Bt}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(f){this._geometry=f}toJSON(){const f={geometry:this.geometry};for(const C in this)C!=="_geometry"&&C!=="_vectorTileFeature"&&(f[C]=this[C]);return f}}class mC{constructor(f,C){this.tileID=f,this.x=f.canonical.x,this.y=f.canonical.y,this.z=f.canonical.z,this.grid=new Bv(xd,16,0),this.grid3D=new Bv(xd,16,0),this.featureIndexArray=new dh,this.promoteId=C}insert(f,C,N,ot,Bt,Jt){const Ir=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(N,ot,Bt);const wo=Jt?this.grid3D:this.grid;for(let ol=0;ol<C.length;ol++){const hl=C[ol],vl=[1/0,1/0,-1/0,-1/0];for(let ah=0;ah<hl.length;ah++){const uh=hl[ah];vl[0]=Math.min(vl[0],uh.x),vl[1]=Math.min(vl[1],uh.y),vl[2]=Math.max(vl[2],uh.x),vl[3]=Math.max(vl[3],uh.y)}vl[0]<xd&&vl[1]<xd&&vl[2]>=0&&vl[3]>=0&&wo.insert(Ir,vl[0],vl[1],vl[2],vl[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ty.VectorTile(new lb(this.rawTileData)).layers,this.sourceLayerCoder=new fC(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(f,C,N,ot){this.loadVTLayers();const Bt=f.params||{},Jt=xd/f.tileSize/f.scale,Ir=U0(Bt.filter),wo=f.queryGeometry,ol=f.queryPadding*Jt,hl=yC(wo),vl=this.grid.query(hl.minX-ol,hl.minY-ol,hl.maxX+ol,hl.maxY+ol),ah=yC(f.cameraQueryGeometry),uh=this.grid3D.query(ah.minX-ol,ah.minY-ol,ah.maxX+ol,ah.maxY+ol,(Mh,Xh,Jh,qh)=>function(ld,pd,Md,Pp,bp){for(const hp of ld)if(pd<=hp.x&&Md<=hp.y&&Pp>=hp.x&&bp>=hp.y)return!0;const yp=[new W(pd,Md),new W(pd,bp),new W(Pp,bp),new W(Pp,Md)];if(ld.length>2){for(const hp of yp)if(gg(ld,hp))return!0}for(let hp=0;hp<ld.length-1;hp++)if(Jm(ld[hp],ld[hp+1],yp))return!0;return!1}(f.cameraQueryGeometry,Mh-ol,Xh-ol,Jh+ol,qh+ol));for(const Mh of uh)vl.push(Mh);vl.sort(cE);const ph={};let Ph;for(let Mh=0;Mh<vl.length;Mh++){const Xh=vl[Mh];if(Xh===Ph)continue;Ph=Xh;const Jh=this.featureIndexArray.get(Xh);let qh=null;this.loadMatchingFeature(ph,Jh.bucketIndex,Jh.sourceLayerIndex,Jh.featureIndex,Ir,Bt.layers,Bt.availableImages,C,N,ot,(ld,pd,Md)=>(qh||(qh=Od(ld)),pd.queryIntersectsFeature(wo,ld,Md,qh,this.z,f.transform,Jt,f.pixelPosMatrix)))}return ph}loadMatchingFeature(f,C,N,ot,Bt,Jt,Ir,wo,ol,hl,vl){const ah=this.bucketLayerIDs[C];if(Jt&&!function(Mh,Xh){for(let Jh=0;Jh<Mh.length;Jh++)if(Xh.indexOf(Mh[Jh])>=0)return!0;return!1}(Jt,ah))return;const uh=this.sourceLayerCoder.decode(N),ph=this.vtLayers[uh].feature(ot);if(Bt.needGeometry){const Mh=Id(ph,!0);if(!Bt.filter(new Eg(this.tileID.overscaledZ),Mh,this.tileID.canonical))return}else if(!Bt.filter(new Eg(this.tileID.overscaledZ),ph))return;const Ph=this.getId(ph,uh);for(let Mh=0;Mh<ah.length;Mh++){const Xh=ah[Mh];if(Jt&&Jt.indexOf(Xh)<0)continue;const Jh=wo[Xh];if(!Jh)continue;let qh={};Ph&&hl&&(qh=hl.getState(Jh.sourceLayer||"_geojsonTileLayer",Ph));const ld=Wr({},ol[Xh]);ld.paint=_C(ld.paint,Jh.paint,ph,qh,Ir),ld.layout=_C(ld.layout,Jh.layout,ph,qh,Ir);const pd=!vl||vl(ph,Jh,qh);if(!pd)continue;const Md=new gC(ph,this.z,this.x,this.y,Ph);Md.layer=ld;let Pp=f[Xh];Pp===void 0&&(Pp=f[Xh]=[]),Pp.push({featureIndex:ot,feature:Md,intersectionZ:pd})}}lookupSymbolFeatures(f,C,N,ot,Bt,Jt,Ir,wo){const ol={};this.loadVTLayers();const hl=U0(Bt);for(const vl of f)this.loadMatchingFeature(ol,N,ot,vl,hl,Jt,Ir,wo,C);return ol}hasLayer(f){for(const C of this.bucketLayerIDs)for(const N of C)if(f===N)return!0;return!1}getId(f,C){let N=f.id;return this.promoteId&&(N=f.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[C]],typeof N=="boolean"&&(N=Number(N))),N}}function _C(x,f,C,N,ot){return gl(x,(Bt,Jt)=>{const Ir=f instanceof tm?f.get(Jt):null;return Ir&&Ir.evaluate?Ir.evaluate(C,N,ot):Ir})}function yC(x){let f=1/0,C=1/0,N=-1/0,ot=-1/0;for(const Bt of x)f=Math.min(f,Bt.x),C=Math.min(C,Bt.y),N=Math.max(N,Bt.x),ot=Math.max(ot,Bt.y);return{minX:f,minY:C,maxX:N,maxY:ot}}function cE(x,f){return f-x}function vC(x,f,C,N,ot){const Bt=[];for(let Jt=0;Jt<x.length;Jt++){const Ir=x[Jt];let wo;for(let ol=0;ol<Ir.length-1;ol++){let hl=Ir[ol],vl=Ir[ol+1];hl.x<f&&vl.x<f||(hl.x<f?hl=new W(f,hl.y+(f-hl.x)/(vl.x-hl.x)*(vl.y-hl.y))._round():vl.x<f&&(vl=new W(f,hl.y+(f-hl.x)/(vl.x-hl.x)*(vl.y-hl.y))._round()),hl.y<C&&vl.y<C||(hl.y<C?hl=new W(hl.x+(C-hl.y)/(vl.y-hl.y)*(vl.x-hl.x),C)._round():vl.y<C&&(vl=new W(hl.x+(C-hl.y)/(vl.y-hl.y)*(vl.x-hl.x),C)._round()),hl.x>=N&&vl.x>=N||(hl.x>=N?hl=new W(N,hl.y+(N-hl.x)/(vl.x-hl.x)*(vl.y-hl.y))._round():vl.x>=N&&(vl=new W(N,hl.y+(N-hl.x)/(vl.x-hl.x)*(vl.y-hl.y))._round()),hl.y>=ot&&vl.y>=ot||(hl.y>=ot?hl=new W(hl.x+(ot-hl.y)/(vl.y-hl.y)*(vl.x-hl.x),ot)._round():vl.y>=ot&&(vl=new W(hl.x+(ot-hl.y)/(vl.y-hl.y)*(vl.x-hl.x),ot)._round()),wo&&hl.equals(wo[wo.length-1])||(wo=[hl],Bt.push(wo)),wo.push(vl)))))}}return Bt}Tp("FeatureIndex",mC,{omit:["rawTileData","sourceLayerCoder"]});class i0 extends W{constructor(f,C,N,ot){super(f,C),this.angle=N,ot!==void 0&&(this.segment=ot)}clone(){return new i0(this.x,this.y,this.angle,this.segment)}}function xC(x,f,C,N,ot){if(f.segment===void 0)return!0;let Bt=f,Jt=f.segment+1,Ir=0;for(;Ir>-C/2;){if(Jt--,Jt<0)return!1;Ir-=x[Jt].dist(Bt),Bt=x[Jt]}Ir+=x[Jt].dist(x[Jt+1]),Jt++;const wo=[];let ol=0;for(;Ir<C/2;){const hl=x[Jt],vl=x[Jt+1];if(!vl)return!1;let ah=x[Jt-1].angleTo(hl)-hl.angleTo(vl);for(ah=Math.abs((ah+3*Math.PI)%(2*Math.PI)-Math.PI),wo.push({distance:Ir,angleDelta:ah}),ol+=ah;Ir-wo[0].distance>N;)ol-=wo.shift().angleDelta;if(ol>ot)return!1;Jt++,Ir+=hl.dist(vl)}return!0}function Nx(x){let f=0;for(let C=0;C<x.length-1;C++)f+=x[C].dist(x[C+1]);return f}function wC(x,f,C){return x?.6*f*C:0}function lm(x,f){return Math.max(x?x.right-x.left:0,f?f.right-f.left:0)}function A1(x,f,C,N,ot,Bt){const Jt=wC(C,ot,Bt),Ir=lm(C,N)*Bt;let wo=0;const ol=Nx(x)/2;for(let hl=0;hl<x.length-1;hl++){const vl=x[hl],ah=x[hl+1],uh=vl.dist(ah);if(wo+uh>ol){const ph=(ol-wo)/uh,Ph=Km.number(vl.x,ah.x,ph),Mh=Km.number(vl.y,ah.y,ph),Xh=new i0(Ph,Mh,ah.angleTo(vl),hl);return Xh._round(),!Jt||xC(x,Xh,Ir,Jt,f)?Xh:void 0}wo+=uh}}function bC(x,f,C,N,ot,Bt,Jt,Ir,wo){const ol=wC(N,Bt,Jt),hl=lm(N,ot),vl=hl*Jt,ah=x[0].x===0||x[0].x===wo||x[0].y===0||x[0].y===wo;return f-vl<f/4&&(f=vl+f/4),jw(x,ah?f/2*Ir%f:(hl/2+2*Bt)*Jt*Ir%f,f,ol,C,vl,ah,!1,wo)}function jw(x,f,C,N,ot,Bt,Jt,Ir,wo){const ol=Bt/2,hl=Nx(x);let vl=0,ah=f-C,uh=[];for(let ph=0;ph<x.length-1;ph++){const Ph=x[ph],Mh=x[ph+1],Xh=Ph.dist(Mh),Jh=Mh.angleTo(Ph);for(;ah+C<vl+Xh;){ah+=C;const qh=(ah-vl)/Xh,ld=Km.number(Ph.x,Mh.x,qh),pd=Km.number(Ph.y,Mh.y,qh);if(ld>=0&&ld<wo&&pd>=0&&pd<wo&&ah-ol>=0&&ah+ol<=hl){const Md=new i0(ld,pd,Jh,ph);Md._round(),N&&!xC(x,Md,Bt,N,ot)||uh.push(Md)}}vl+=Xh}return Ir||uh.length||Jt||(uh=jw(x,vl/2,C,N,ot,Bt,Jt,!0,wo)),uh}Tp("Anchor",i0);const L0=am;function ow(x,f,C,N){const ot=[],Bt=x.image,Jt=Bt.pixelRatio,Ir=Bt.paddedRect.w-2*L0,wo=Bt.paddedRect.h-2*L0,ol=x.right-x.left,hl=x.bottom-x.top,vl=Bt.stretchX||[[0,Ir]],ah=Bt.stretchY||[[0,wo]],uh=(lp,Sp)=>lp+Sp[1]-Sp[0],ph=vl.reduce(uh,0),Ph=ah.reduce(uh,0),Mh=Ir-ph,Xh=wo-Ph;let Jh=0,qh=ph,ld=0,pd=Ph,Md=0,Pp=Mh,bp=0,yp=Xh;if(Bt.content&&N){const lp=Bt.content;Jh=Ww(vl,0,lp[0]),ld=Ww(ah,0,lp[1]),qh=Ww(vl,lp[0],lp[2]),pd=Ww(ah,lp[1],lp[3]),Md=lp[0]-Jh,bp=lp[1]-ld,Pp=lp[2]-lp[0]-qh,yp=lp[3]-lp[1]-pd}const hp=(lp,Sp,vp,Jd)=>{const Xp=hx(lp.stretch-Jh,qh,ol,x.left),$p=sw(lp.fixed-Md,Pp,lp.stretch,ph),ag=hx(Sp.stretch-ld,pd,hl,x.top),Wg=sw(Sp.fixed-bp,yp,Sp.stretch,Ph),Zg=hx(vp.stretch-Jh,qh,ol,x.left),cm=sw(vp.fixed-Md,Pp,vp.stretch,ph),oy=hx(Jd.stretch-ld,pd,hl,x.top),Hm=sw(Jd.fixed-bp,yp,Jd.stretch,Ph),ym=new W(Xp,ag),Rm=new W(Zg,ag),Qm=new W(Zg,oy),h_=new W(Xp,oy),D_=new W($p/Jt,Wg/Jt),Cm=new W(cm/Jt,Hm/Jt),e_=f*Math.PI/180;if(e_){const Ig=Math.sin(e_),im=Math.cos(e_),Qg=[im,-Ig,Ig,im];ym._matMult(Qg),Rm._matMult(Qg),h_._matMult(Qg),Qm._matMult(Qg)}const t_=lp.stretch+lp.fixed,C_=Sp.stretch+Sp.fixed;return{tl:ym,tr:Rm,bl:h_,br:Qm,tex:{x:Bt.paddedRect.x+L0+t_,y:Bt.paddedRect.y+L0+C_,w:vp.stretch+vp.fixed-t_,h:Jd.stretch+Jd.fixed-C_},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:D_,pixelOffsetBR:Cm,minFontScaleX:Pp/Jt/ol,minFontScaleY:yp/Jt/hl,isSDF:C}};if(N&&(Bt.stretchX||Bt.stretchY)){const lp=vb(vl,Mh,ph),Sp=vb(ah,Xh,Ph);for(let vp=0;vp<lp.length-1;vp++){const Jd=lp[vp],Xp=lp[vp+1];for(let $p=0;$p<Sp.length-1;$p++)ot.push(hp(Jd,Sp[$p],Xp,Sp[$p+1]))}}else ot.push(hp({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:Ir+1},{fixed:0,stretch:wo+1}));return ot}function Ww(x,f,C){let N=0;for(const ot of x)N+=Math.max(f,Math.min(C,ot[1]))-Math.max(f,Math.min(C,ot[0]));return N}function vb(x,f,C){const N=[{fixed:-L0,stretch:0}];for(const[ot,Bt]of x){const Jt=N[N.length-1];N.push({fixed:ot-Jt.stretch,stretch:Jt.stretch}),N.push({fixed:ot-Jt.stretch,stretch:Jt.stretch+(Bt-ot)})}return N.push({fixed:f+L0,stretch:C}),N}function hx(x,f,C,N){return x/f*C+N}function sw(x,f,C,N){return x-f*C/N}class aw{constructor(f,C,N,ot,Bt,Jt,Ir,wo,ol,hl){if(this.boxStartIndex=f.length,ol){let vl=Jt.top,ah=Jt.bottom;const uh=Jt.collisionPadding;uh&&(vl-=uh[1],ah+=uh[3]);let ph=ah-vl;ph>0&&(ph=Math.max(10,ph),this.circleDiameter=ph)}else{let vl=Jt.top*Ir-wo[0],ah=Jt.bottom*Ir+wo[2],uh=Jt.left*Ir-wo[3],ph=Jt.right*Ir+wo[1];const Ph=Jt.collisionPadding;if(Ph&&(uh-=Ph[0]*Ir,vl-=Ph[1]*Ir,ph+=Ph[2]*Ir,ah+=Ph[3]*Ir),hl){const Mh=new W(uh,vl),Xh=new W(ph,vl),Jh=new W(uh,ah),qh=new W(ph,ah),ld=hl*Math.PI/180;Mh._rotate(ld),Xh._rotate(ld),Jh._rotate(ld),qh._rotate(ld),uh=Math.min(Mh.x,Xh.x,Jh.x,qh.x),ph=Math.max(Mh.x,Xh.x,Jh.x,qh.x),vl=Math.min(Mh.y,Xh.y,Jh.y,qh.y),ah=Math.max(Mh.y,Xh.y,Jh.y,qh.y)}f.emplaceBack(C.x,C.y,uh,vl,ph,ah,N,ot,Bt)}this.boxEndIndex=f.length}}class xb{constructor(f=[],C=uE){if(this.data=f,this.length=this.data.length,this.compare=C,this.length>0)for(let N=(this.length>>1)-1;N>=0;N--)this._down(N)}push(f){this.data.push(f),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const f=this.data[0],C=this.data.pop();return this.length--,this.length>0&&(this.data[0]=C,this._down(0)),f}peek(){return this.data[0]}_up(f){const{data:C,compare:N}=this,ot=C[f];for(;f>0;){const Bt=f-1>>1,Jt=C[Bt];if(N(ot,Jt)>=0)break;C[f]=Jt,f=Bt}C[f]=ot}_down(f){const{data:C,compare:N}=this,ot=this.length>>1,Bt=C[f];for(;f<ot;){let Jt=1+(f<<1),Ir=C[Jt];const wo=Jt+1;if(wo<this.length&&N(C[wo],Ir)<0&&(Jt=wo,Ir=C[wo]),N(Ir,Bt)>=0)break;C[f]=Ir,f=Jt}C[f]=Bt}}function uE(x,f){return x<f?-1:x>f?1:0}function CC(x,f=1,C=!1){let N=1/0,ot=1/0,Bt=-1/0,Jt=-1/0;const Ir=x[0];for(let uh=0;uh<Ir.length;uh++){const ph=Ir[uh];(!uh||ph.x<N)&&(N=ph.x),(!uh||ph.y<ot)&&(ot=ph.y),(!uh||ph.x>Bt)&&(Bt=ph.x),(!uh||ph.y>Jt)&&(Jt=ph.y)}const wo=Math.min(Bt-N,Jt-ot);let ol=wo/2;const hl=new xb([],qw);if(wo===0)return new W(N,ot);for(let uh=N;uh<Bt;uh+=wo)for(let ph=ot;ph<Jt;ph+=wo)hl.push(new lw(uh+ol,ph+ol,ol,x));let vl=function(uh){let ph=0,Ph=0,Mh=0;const Xh=uh[0];for(let Jh=0,qh=Xh.length,ld=qh-1;Jh<qh;ld=Jh++){const pd=Xh[Jh],Md=Xh[ld],Pp=pd.x*Md.y-Md.x*pd.y;Ph+=(pd.x+Md.x)*Pp,Mh+=(pd.y+Md.y)*Pp,ph+=3*Pp}return new lw(Ph/ph,Mh/ph,0,uh)}(x),ah=hl.length;for(;hl.length;){const uh=hl.pop();(uh.d>vl.d||!vl.d)&&(vl=uh,C&&console.log("found best %d after %d probes",Math.round(1e4*uh.d)/1e4,ah)),uh.max-vl.d<=f||(ol=uh.h/2,hl.push(new lw(uh.p.x-ol,uh.p.y-ol,ol,x)),hl.push(new lw(uh.p.x+ol,uh.p.y-ol,ol,x)),hl.push(new lw(uh.p.x-ol,uh.p.y+ol,ol,x)),hl.push(new lw(uh.p.x+ol,uh.p.y+ol,ol,x)),ah+=4)}return C&&(console.log(`num probes: ${ah}`),console.log(`best distance: ${vl.d}`)),vl.p}function qw(x,f){return f.max-x.max}function lw(x,f,C,N){this.p=new W(x,f),this.h=C,this.d=function(ot,Bt){let Jt=!1,Ir=1/0;for(let wo=0;wo<Bt.length;wo++){const ol=Bt[wo];for(let hl=0,vl=ol.length,ah=vl-1;hl<vl;ah=hl++){const uh=ol[hl],ph=ol[ah];uh.y>ot.y!=ph.y>ot.y&&ot.x<(ph.x-uh.x)*(ot.y-uh.y)/(ph.y-uh.y)+uh.x&&(Jt=!Jt),Ir=Math.min(Ir,Sg(ot,uh,ph))}}return(Jt?1:-1)*Math.sqrt(Ir)}(this.p,N),this.max=this.d+this.h*Math.SQRT2}const Kw=Number.POSITIVE_INFINITY;function EC(x,f){return f[1]!==Kw?function(C,N,ot){let Bt=0,Jt=0;switch(N=Math.abs(N),ot=Math.abs(ot),C){case"top-right":case"top-left":case"top":Jt=ot-7;break;case"bottom-right":case"bottom-left":case"bottom":Jt=7-ot}switch(C){case"top-right":case"bottom-right":case"right":Bt=-N;break;case"top-left":case"bottom-left":case"left":Bt=N}return[Bt,Jt]}(x,f[0],f[1]):function(C,N){let ot=0,Bt=0;N<0&&(N=0);const Jt=N/Math.sqrt(2);switch(C){case"top-right":case"top-left":Bt=Jt-7;break;case"bottom-right":case"bottom-left":Bt=7-Jt;break;case"bottom":Bt=7-N;break;case"top":Bt=N-7}switch(C){case"top-right":case"bottom-right":ot=-Jt;break;case"top-left":case"bottom-left":ot=Jt;break;case"left":ot=N;break;case"right":ot=-N}return[ot,Bt]}(x,f[0])}function Zw(x){switch(x){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function wb(x,f,C,N,ot,Bt,Jt,Ir,wo,ol,hl){let vl=Bt.textMaxSize.evaluate(f,{});vl===void 0&&(vl=Jt);const ah=x.layers[0].layout,uh=ah.get("icon-offset").evaluate(f,{},hl),ph=SC(C.horizontal),Ph=Jt/24,Mh=x.tilePixelRatio*Ph,Xh=x.tilePixelRatio*vl/24,Jh=x.tilePixelRatio*Ir,qh=x.tilePixelRatio*ah.get("symbol-spacing"),ld=ah.get("text-padding")*x.tilePixelRatio,pd=function(Jd,Xp,$p,ag=1){const Wg=Jd.get("icon-padding").evaluate(Xp,{},$p),Zg=Wg&&Wg.values;return[Zg[0]*ag,Zg[1]*ag,Zg[2]*ag,Zg[3]*ag]}(ah,f,hl,x.tilePixelRatio),Md=ah.get("text-max-angle")/180*Math.PI,Pp=ah.get("text-rotation-alignment")!=="viewport"&&ah.get("symbol-placement")!=="point",bp=ah.get("icon-rotation-alignment")==="map"&&ah.get("symbol-placement")!=="point",yp=ah.get("symbol-placement"),hp=qh/2,lp=ah.get("icon-text-fit");let Sp;N&&lp!=="none"&&(x.allowVerticalPlacement&&C.vertical&&(Sp=Vw(N,C.vertical,lp,ah.get("icon-text-fit-padding"),uh,Ph)),ph&&(N=Vw(N,ph,lp,ah.get("icon-text-fit-padding"),uh,Ph)));const vp=(Jd,Xp)=>{Xp.x<0||Xp.x>=xd||Xp.y<0||Xp.y>=xd||function($p,ag,Wg,Zg,cm,oy,Hm,ym,Rm,Qm,h_,D_,Cm,e_,t_,C_,Ig,im,Qg,Im,tg,$_,i_,Mm,Dy){const _v=$p.addToLineVertexArray(ag,Wg);let Ly,r0,sy,sg,d_=0,n0=0,uw=0,o0=0,fx=-1,P1=-1;const O0={};let RC=pl(""),Ab=0,Rb=0;if(ym._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Ab,Rb]=ym.layout.get("text-offset").evaluate(tg,{},Mm).map(L_=>L_*mm):(Ab=ym.layout.get("text-radial-offset").evaluate(tg,{},Mm)*mm,Rb=Kw),$p.allowVerticalPlacement&&Zg.vertical){const L_=ym.layout.get("text-rotate").evaluate(tg,{},Mm)+90;sy=new aw(Rm,ag,Qm,h_,D_,Zg.vertical,Cm,e_,t_,L_),Hm&&(sg=new aw(Rm,ag,Qm,h_,D_,Hm,Ig,im,t_,L_))}if(cm){const L_=ym.layout.get("icon-rotate").evaluate(tg,{}),yv=ym.layout.get("icon-text-fit")!=="none",kx=ow(cm,L_,i_,yv),jm=Hm?ow(Hm,L_,i_,yv):void 0;r0=new aw(Rm,ag,Qm,h_,D_,cm,Ig,im,!1,L_),d_=4*kx.length;const F1=$p.iconSizeData;let gx=null;F1.kind==="source"?(gx=[gv*ym.layout.get("icon-size").evaluate(tg,{})],gx[0]>ux&&rl(`${$p.layerIds[0]}: Value for "icon-size" is >= ${Ox}. Reduce your "icon-size".`)):F1.kind==="composite"&&(gx=[gv*$_.compositeIconSizes[0].evaluate(tg,{},Mm),gv*$_.compositeIconSizes[1].evaluate(tg,{},Mm)],(gx[0]>ux||gx[1]>ux)&&rl(`${$p.layerIds[0]}: Value for "icon-size" is >= ${Ox}. Reduce your "icon-size".`)),$p.addSymbols($p.icon,kx,gx,Im,Qg,tg,s.WritingMode.none,ag,_v.lineStartIndex,_v.lineLength,-1,Mm),fx=$p.icon.placedSymbolArray.length-1,jm&&(n0=4*jm.length,$p.addSymbols($p.icon,jm,gx,Im,Qg,tg,s.WritingMode.vertical,ag,_v.lineStartIndex,_v.lineLength,-1,Mm),P1=$p.icon.placedSymbolArray.length-1)}const IC=Object.keys(Zg.horizontal);for(const L_ of IC){const yv=Zg.horizontal[L_];if(!Ly){RC=pl(yv.text);const jm=ym.layout.get("text-rotate").evaluate(tg,{},Mm);Ly=new aw(Rm,ag,Qm,h_,D_,yv,Cm,e_,t_,jm)}const kx=yv.positionedLines.length===1;if(uw+=Xw($p,ag,yv,oy,ym,t_,tg,C_,_v,Zg.vertical?s.WritingMode.horizontal:s.WritingMode.horizontalOnly,kx?IC:[L_],O0,fx,$_,Mm),kx)break}Zg.vertical&&(o0+=Xw($p,ag,Zg.vertical,oy,ym,t_,tg,C_,_v,s.WritingMode.vertical,["vertical"],O0,P1,$_,Mm));const pE=Ly?Ly.boxStartIndex:$p.collisionBoxArray.length,fE=Ly?Ly.boxEndIndex:$p.collisionBoxArray.length,gE=sy?sy.boxStartIndex:$p.collisionBoxArray.length,mE=sy?sy.boxEndIndex:$p.collisionBoxArray.length,D1=r0?r0.boxStartIndex:$p.collisionBoxArray.length,hw=r0?r0.boxEndIndex:$p.collisionBoxArray.length,MC=sg?sg.boxStartIndex:$p.collisionBoxArray.length,L1=sg?sg.boxEndIndex:$p.collisionBoxArray.length;let ay=-1;const O1=(L_,yv)=>L_&&L_.circleDiameter?Math.max(L_.circleDiameter,yv):yv;ay=O1(Ly,ay),ay=O1(sy,ay),ay=O1(r0,ay),ay=O1(sg,ay);const PC=ay>-1?1:0;PC&&(ay*=Dy/mm),$p.glyphOffsetArray.length>=rw.MAX_GLYPHS&&rl("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),tg.sortKey!==void 0&&$p.addToSortKeyRanges($p.symbolInstances.length,tg.sortKey),$p.symbolInstances.emplaceBack(ag.x,ag.y,O0.right>=0?O0.right:-1,O0.center>=0?O0.center:-1,O0.left>=0?O0.left:-1,O0.vertical||-1,fx,P1,RC,pE,fE,gE,mE,D1,hw,MC,L1,Qm,uw,o0,d_,n0,PC,0,Cm,Ab,Rb,ay)}(x,Xp,Jd,C,N,ot,Sp,x.layers[0],x.collisionBoxArray,f.index,f.sourceLayerIndex,x.index,Mh,[ld,ld,ld,ld],Pp,wo,Jh,pd,bp,uh,f,Bt,ol,hl,Jt)};if(yp==="line")for(const Jd of vC(f.geometry,0,0,xd,xd)){const Xp=bC(Jd,qh,Md,C.vertical||ph,N,24,Xh,x.overscaling,xd);for(const $p of Xp)ph&&hE(x,ph.text,hp,$p)||vp(Jd,$p)}else if(yp==="line-center"){for(const Jd of f.geometry)if(Jd.length>1){const Xp=A1(Jd,Md,C.vertical||ph,N,24,Xh);Xp&&vp(Jd,Xp)}}else if(f.type==="Polygon")for(const Jd of Mw(f.geometry,0)){const Xp=CC(Jd,16);vp(Jd[0],new i0(Xp.x,Xp.y,0))}else if(f.type==="LineString")for(const Jd of f.geometry)vp(Jd,new i0(Jd[0].x,Jd[0].y,0));else if(f.type==="Point")for(const Jd of f.geometry)for(const Xp of Jd)vp([Xp],new i0(Xp.x,Xp.y,0))}function Xw(x,f,C,N,ot,Bt,Jt,Ir,wo,ol,hl,vl,ah,uh,ph){const Ph=function(Jh,qh,ld,pd,Md,Pp,bp,yp){const hp=pd.layout.get("text-rotate").evaluate(Pp,{})*Math.PI/180,lp=[];for(const Sp of qh.positionedLines)for(const vp of Sp.positionedGlyphs){if(!vp.rect)continue;const Jd=vp.rect||{};let Xp=Rg+1,$p=!0,ag=1,Wg=0;const Zg=(Md||yp)&&vp.vertical,cm=vp.metrics.advance*vp.scale/2;if(yp&&qh.verticalizable&&(Wg=Sp.lineOffset/2-(vp.imageName?-(mm-vp.metrics.width*vp.scale)/2:(vp.scale-1)*mm)),vp.imageName){const Qg=bp[vp.imageName];$p=Qg.sdf,ag=Qg.pixelRatio,Xp=am/ag}const oy=Md?[vp.x+cm,vp.y]:[0,0];let Hm=Md?[0,0]:[vp.x+cm+ld[0],vp.y+ld[1]-Wg],ym=[0,0];Zg&&(ym=Hm,Hm=[0,0]);const Rm=(vp.metrics.left-Xp)*vp.scale-cm+Hm[0],Qm=(-vp.metrics.top-Xp)*vp.scale+Hm[1],h_=Rm+Jd.w*vp.scale/ag,D_=Qm+Jd.h*vp.scale/ag,Cm=new W(Rm,Qm),e_=new W(h_,Qm),t_=new W(Rm,D_),C_=new W(h_,D_);if(Zg){const Qg=new W(-cm,cm-bm),Im=-Math.PI/2,tg=mm/2-cm,$_=new W(5-bm-tg,-(vp.imageName?tg:0)),i_=new W(...ym);Cm._rotateAround(Im,Qg)._add($_)._add(i_),e_._rotateAround(Im,Qg)._add($_)._add(i_),t_._rotateAround(Im,Qg)._add($_)._add(i_),C_._rotateAround(Im,Qg)._add($_)._add(i_)}if(hp){const Qg=Math.sin(hp),Im=Math.cos(hp),tg=[Im,-Qg,Qg,Im];Cm._matMult(tg),e_._matMult(tg),t_._matMult(tg),C_._matMult(tg)}const Ig=new W(0,0),im=new W(0,0);lp.push({tl:Cm,tr:e_,bl:t_,br:C_,tex:Jd,writingMode:qh.writingMode,glyphOffset:oy,sectionIndex:vp.sectionIndex,isSDF:$p,pixelOffsetTL:Ig,pixelOffsetBR:im,minFontScaleX:0,minFontScaleY:0})}return lp}(0,C,Ir,ot,Bt,Jt,N,x.allowVerticalPlacement),Mh=x.textSizeData;let Xh=null;Mh.kind==="source"?(Xh=[gv*ot.layout.get("text-size").evaluate(Jt,{})],Xh[0]>ux&&rl(`${x.layerIds[0]}: Value for "text-size" is >= ${Ox}. Reduce your "text-size".`)):Mh.kind==="composite"&&(Xh=[gv*uh.compositeTextSizes[0].evaluate(Jt,{},ph),gv*uh.compositeTextSizes[1].evaluate(Jt,{},ph)],(Xh[0]>ux||Xh[1]>ux)&&rl(`${x.layerIds[0]}: Value for "text-size" is >= ${Ox}. Reduce your "text-size".`)),x.addSymbols(x.text,Ph,Xh,Ir,Bt,Jt,ol,f,wo.lineStartIndex,wo.lineLength,ah,ph);for(const Jh of hl)vl[Jh]=x.text.placedSymbolArray.length-1;return 4*Ph.length}function SC(x){for(const f in x)return x[f];return null}function hE(x,f,C,N){const ot=x.compareText;if(f in ot){const Bt=ot[f];for(let Jt=Bt.length-1;Jt>=0;Jt--)if(N.dist(Bt[Jt])<C)return!0}else ot[f]=[];return ot[f].push(N),!1}const TC=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class bb{static from(f){if(!(f instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[C,N]=new Uint8Array(f,0,2);if(C!==219)throw new Error("Data does not appear to be in a KDBush format.");const ot=N>>4;if(ot!==1)throw new Error(`Got v${ot} data when expected v1.`);const Bt=TC[15&N];if(!Bt)throw new Error("Unrecognized array type.");const[Jt]=new Uint16Array(f,2,1),[Ir]=new Uint32Array(f,4,1);return new bb(Ir,Jt,Bt,f)}constructor(f,C=64,N=Float64Array,ot){if(isNaN(f)||f<0)throw new Error(`Unpexpected numItems value: ${f}.`);this.numItems=+f,this.nodeSize=Math.min(Math.max(+C,2),65535),this.ArrayType=N,this.IndexArrayType=f<65536?Uint16Array:Uint32Array;const Bt=TC.indexOf(this.ArrayType),Jt=2*f*this.ArrayType.BYTES_PER_ELEMENT,Ir=f*this.IndexArrayType.BYTES_PER_ELEMENT,wo=(8-Ir%8)%8;if(Bt<0)throw new Error(`Unexpected typed array class: ${N}.`);ot&&ot instanceof ArrayBuffer?(this.data=ot,this.ids=new this.IndexArrayType(this.data,8,f),this.coords=new this.ArrayType(this.data,8+Ir+wo,2*f),this._pos=2*f,this._finished=!0):(this.data=new ArrayBuffer(8+Jt+Ir+wo),this.ids=new this.IndexArrayType(this.data,8,f),this.coords=new this.ArrayType(this.data,8+Ir+wo,2*f),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+Bt]),new Uint16Array(this.data,2,1)[0]=C,new Uint32Array(this.data,4,1)[0]=f)}add(f,C){const N=this._pos>>1;return this.ids[N]=N,this.coords[this._pos++]=f,this.coords[this._pos++]=C,N}finish(){const f=this._pos>>1;if(f!==this.numItems)throw new Error(`Added ${f} items when expected ${this.numItems}.`);return Cb(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(f,C,N,ot){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:Bt,coords:Jt,nodeSize:Ir}=this,wo=[0,Bt.length-1,0],ol=[];for(;wo.length;){const hl=wo.pop()||0,vl=wo.pop()||0,ah=wo.pop()||0;if(vl-ah<=Ir){for(let Mh=ah;Mh<=vl;Mh++){const Xh=Jt[2*Mh],Jh=Jt[2*Mh+1];Xh>=f&&Xh<=N&&Jh>=C&&Jh<=ot&&ol.push(Bt[Mh])}continue}const uh=ah+vl>>1,ph=Jt[2*uh],Ph=Jt[2*uh+1];ph>=f&&ph<=N&&Ph>=C&&Ph<=ot&&ol.push(Bt[uh]),(hl===0?f<=ph:C<=Ph)&&(wo.push(ah),wo.push(uh-1),wo.push(1-hl)),(hl===0?N>=ph:ot>=Ph)&&(wo.push(uh+1),wo.push(vl),wo.push(1-hl))}return ol}within(f,C,N){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:ot,coords:Bt,nodeSize:Jt}=this,Ir=[0,ot.length-1,0],wo=[],ol=N*N;for(;Ir.length;){const hl=Ir.pop()||0,vl=Ir.pop()||0,ah=Ir.pop()||0;if(vl-ah<=Jt){for(let Mh=ah;Mh<=vl;Mh++)Sb(Bt[2*Mh],Bt[2*Mh+1],f,C)<=ol&&wo.push(ot[Mh]);continue}const uh=ah+vl>>1,ph=Bt[2*uh],Ph=Bt[2*uh+1];Sb(ph,Ph,f,C)<=ol&&wo.push(ot[uh]),(hl===0?f-N<=ph:C-N<=Ph)&&(Ir.push(ah),Ir.push(uh-1),Ir.push(1-hl)),(hl===0?f+N>=ph:C+N>=Ph)&&(Ir.push(uh+1),Ir.push(vl),Ir.push(1-hl))}return wo}}function Cb(x,f,C,N,ot,Bt){if(ot-N<=C)return;const Jt=N+ot>>1;AC(x,f,Jt,N,ot,Bt),Cb(x,f,C,N,Jt-1,1-Bt),Cb(x,f,C,Jt+1,ot,1-Bt)}function AC(x,f,C,N,ot,Bt){for(;ot>N;){if(ot-N>600){const ol=ot-N+1,hl=C-N+1,vl=Math.log(ol),ah=.5*Math.exp(2*vl/3),uh=.5*Math.sqrt(vl*ah*(ol-ah)/ol)*(hl-ol/2<0?-1:1);AC(x,f,C,Math.max(N,Math.floor(C-hl*ah/ol+uh)),Math.min(ot,Math.floor(C+(ol-hl)*ah/ol+uh)),Bt)}const Jt=f[2*C+Bt];let Ir=N,wo=ot;for(dx(x,f,N,C),f[2*ot+Bt]>Jt&&dx(x,f,N,ot);Ir<wo;){for(dx(x,f,Ir,wo),Ir++,wo--;f[2*Ir+Bt]<Jt;)Ir++;for(;f[2*wo+Bt]>Jt;)wo--}f[2*N+Bt]===Jt?dx(x,f,N,wo):(wo++,dx(x,f,wo,ot)),wo<=C&&(N=wo+1),C<=wo&&(ot=wo-1)}}function dx(x,f,C,N){Eb(x,C,N),Eb(f,2*C,2*N),Eb(f,2*C+1,2*N+1)}function Eb(x,f,C){const N=x[f];x[f]=x[C],x[C]=N}function Sb(x,f,C,N){const ot=x-C,Bt=f-N;return ot*ot+Bt*Bt}var px;s.PerformanceMarkers=void 0,(px=s.PerformanceMarkers||(s.PerformanceMarkers={})).create="create",px.load="load",px.fullLoad="fullLoad";let R1=null,Yw=[];const Tb=1e3/60,I1="loadTime",M1="fullLoadTime",dE={mark(x){performance.mark(x)},frame(x){const f=x;R1!=null&&Yw.push(f-R1),R1=f},clearMetrics(){R1=null,Yw=[],performance.clearMeasures(I1),performance.clearMeasures(M1);for(const x in s.PerformanceMarkers)performance.clearMarks(s.PerformanceMarkers[x])},getPerformanceMetrics(){performance.measure(I1,s.PerformanceMarkers.create,s.PerformanceMarkers.load),performance.measure(M1,s.PerformanceMarkers.create,s.PerformanceMarkers.fullLoad);const x=performance.getEntriesByName(I1)[0].duration,f=performance.getEntriesByName(M1)[0].duration,C=Yw.length,N=1/(Yw.reduce((Bt,Jt)=>Bt+Jt,0)/C/1e3),ot=Yw.filter(Bt=>Bt>Tb).reduce((Bt,Jt)=>Bt+(Jt-Tb)/Tb,0);return{loadTime:x,fullLoadTime:f,fps:N,percentDroppedFrames:ot/(C+ot)*100,totalFrames:C}}};s.AJAXError=Xd,s.ARRAY_TYPE=wm,s.Actor=class{constructor(x,f,C){this.target=x,this.parent=f,this.mapId=C,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},il(["receive","process"],this),this.invoker=new hC(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=bh()?x:window}send(x,f,C,N,ot=!1){const Bt=Math.round(1e18*Math.random()).toString(36).substring(0,10);C&&(this.callbacks[Bt]=C);const Jt=Bh(this.globalScope)?void 0:[];return this.target.postMessage({id:Bt,type:x,hasCallback:!!C,targetMapId:N,mustQueue:ot,sourceMapId:this.mapId,data:Gv(f,Jt)},Jt),{cancel:()=>{C&&delete this.callbacks[Bt],this.target.postMessage({id:Bt,type:"<cancel>",targetMapId:N,sourceMapId:this.mapId})}}}receive(x){const f=x.data,C=f.id;if(C&&(!f.targetMapId||this.mapId===f.targetMapId))if(f.type==="<cancel>"){delete this.tasks[C];const N=this.cancelCallbacks[C];delete this.cancelCallbacks[C],N&&N()}else bh()||f.mustQueue?(this.tasks[C]=f,this.taskQueue.push(C),this.invoker.trigger()):this.processTask(C,f)}process(){if(!this.taskQueue.length)return;const x=this.taskQueue.shift(),f=this.tasks[x];delete this.tasks[x],this.taskQueue.length&&this.invoker.trigger(),f&&this.processTask(x,f)}processTask(x,f){if(f.type==="<response>"){const C=this.callbacks[x];delete this.callbacks[x],C&&(f.error?C(Sm(f.error)):C(null,Sm(f.data)))}else{let C=!1;const N=Bh(this.globalScope)?void 0:[],ot=f.hasCallback?(Ir,wo)=>{C=!0,delete this.cancelCallbacks[x],this.target.postMessage({id:x,type:"<response>",sourceMapId:this.mapId,error:Ir?Gv(Ir):null,data:Gv(wo,N)},N)}:Ir=>{C=!0};let Bt=null;const Jt=Sm(f.data);if(this.parent[f.type])Bt=this.parent[f.type](f.sourceMapId,Jt,ot);else if(this.parent.getWorkerSource){const Ir=f.type.split(".");Bt=this.parent.getWorkerSource(f.sourceMapId,Ir[0],Jt.source)[Ir[1]](Jt,ot)}else ot(new Error(`Could not find function ${f.type}`));!C&&Bt&&Bt.cancel&&(this.cancelCallbacks[x]=Bt.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.AlphaImage=jx,s.CanonicalTileID=$w,s.CollisionBoxArray=ct,s.CollisionCircleLayoutArray=class extends v0{},s.Color=Yp,s.DEMData=nw,s.DataConstantProperty=Np,s.DictionaryCoder=fC,s.EXTENT=xd,s.ErrorEvent=Ap,s.EvaluationParameters=Eg,s.Event=Kd,s.Evented=Ip,s.FeatureIndex=mC,s.FillBucket=Pw,s.FillExtrusionBucket=ny,s.GeoJSONFeature=gC,s.ImageAtlas=Py,s.ImagePosition=My,s.KDBush=bb,s.LineBucket=Px,s.LineStripIndexArray=class extends g{},s.LngLat=D0,s.MercatorCoordinate=T1,s.ONE_EM=mm,s.OverscaledTileID=U_,s.PerformanceUtils=dE,s.Point=W,s.Pos3dArray=class extends sv{},s.PosArray=Ah,s.Properties=Am,s.Protobuf=lb,s.QuadTriangleArray=class extends x0{},s.RGBAImage=ry,s.RasterBoundsArray=class extends av{},s.RequestPerformance=class{constructor(x){this._marks={start:[x.url,"start"].join("#"),end:[x.url,"end"].join("#"),measure:x.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let x=performance.getEntriesByName(this._marks.measure);return x.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),x=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),x}},s.SegmentVector=S,s.SymbolBucket=rw,s.Transitionable=fp,s.TriangleIndexArray=Vd,s.Uniform1f=_l,s.Uniform1i=class extends xh{constructor(x,f){super(x,f),this.current=0}set(x){this.current!==x&&(this.current=x,this.gl.uniform1i(this.location,x))}},s.Uniform2f=class extends xh{constructor(x,f){super(x,f),this.current=[0,0]}set(x){x[0]===this.current[0]&&x[1]===this.current[1]||(this.current=x,this.gl.uniform2f(this.location,x[0],x[1]))}},s.Uniform3f=class extends xh{constructor(x,f){super(x,f),this.current=[0,0,0]}set(x){x[0]===this.current[0]&&x[1]===this.current[1]&&x[2]===this.current[2]||(this.current=x,this.gl.uniform3f(this.location,x[0],x[1],x[2]))}},s.Uniform4f=mh,s.UniformColor=wh,s.UniformMatrix4f=class extends xh{constructor(x,f){super(x,f),this.current=Sh}set(x){if(x[12]!==this.current[12]||x[0]!==this.current[0])return this.current=x,void this.gl.uniformMatrix4fv(this.location,!1,x);for(let f=1;f<16;f++)if(x[f]!==this.current[f]){this.current=x,this.gl.uniformMatrix4fv(this.location,!1,x);break}}},s.UnwrappedTileID=Hw,s.ValidationError=cd,s.ZoomHistory=_0,s.addDynamicAttributes=v1,s.arrayBufferToImage=function(x,f){const C=new Image;C.onload=()=>{f(null,C),URL.revokeObjectURL(C.src),C.onload=null,window.requestAnimationFrame(()=>{C.src=Td})},C.onerror=()=>f(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const N=new Blob([new Uint8Array(x)],{type:"image/png"});C.src=x.byteLength?URL.createObjectURL(N):Td},s.arrayBufferToImageBitmap=function(x,f){const C=new Blob([new Uint8Array(x)],{type:"image/png"});createImageBitmap(C).then(N=>{f(null,N)}).catch(N=>{f(new Error(`Could not load image because of ${N.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},s.asyncAll=function(x,f,C){if(!x.length)return C(null,[]);let N=x.length;const ot=new Array(x.length);let Bt=null;x.forEach((Jt,Ir)=>{f(Jt,(wo,ol)=>{wo&&(Bt=wo),ot[Ir]=ol,--N==0&&C(Bt,ot)})})},s.bezier=ir,s.bindAll=il,s.clamp=Bn,s.clipLine=vC,s.clone=function(x){var f=new wm(16);return f[0]=x[0],f[1]=x[1],f[2]=x[2],f[3]=x[3],f[4]=x[4],f[5]=x[5],f[6]=x[6],f[7]=x[7],f[8]=x[8],f[9]=x[9],f[10]=x[10],f[11]=x[11],f[12]=x[12],f[13]=x[13],f[14]=x[14],f[15]=x[15],f},s.clone$1=sl,s.collisionCircleLayout=Ry,s.config=Ud,s.copy=function(x,f){return x[0]=f[0],x[1]=f[1],x[2]=f[2],x[3]=f[3],x[4]=f[4],x[5]=f[5],x[6]=f[6],x[7]=f[7],x[8]=f[8],x[9]=f[9],x[10]=f[10],x[11]=f[11],x[12]=f[12],x[13]=f[13],x[14]=f[14],x[15]=f[15],x},s.create=function(){var x=new wm(16);return wm!=Float32Array&&(x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=0,x[12]=0,x[13]=0,x[14]=0),x[0]=1,x[5]=1,x[10]=1,x[15]=1,x},s.createExpression=Og,s.createFilter=U0,s.createLayout=Jg,s.createStyleLayer=function(x){return x.type==="custom"?new aE(x):new lE[x.type](x)},s.deepEqual=function x(f,C){if(Array.isArray(f)){if(!Array.isArray(C)||f.length!==C.length)return!1;for(let N=0;N<f.length;N++)if(!x(f[N],C[N]))return!1;return!0}if(typeof f=="object"&&f!==null&&C!==null){if(typeof C!="object"||Object.keys(f).length!==Object.keys(C).length)return!1;for(const N in f)if(!x(f[N],C[N]))return!1;return!0}return f===C},s.derefLayers=function(x){x=x.slice();const f=Object.create(null);for(let C=0;C<x.length;C++)f[x[C].id]=x[C];for(let C=0;C<x.length;C++)"ref"in x[C]&&(x[C]=kp(x[C],f[x[C].ref]));return x},s.diffStyles=function(x,f){if(!x)return[{command:rp.setStyle,args:[f]}];let C=[];try{if(!up(x.version,f.version))return[{command:rp.setStyle,args:[f]}];up(x.center,f.center)||C.push({command:rp.setCenter,args:[f.center]}),up(x.zoom,f.zoom)||C.push({command:rp.setZoom,args:[f.zoom]}),up(x.bearing,f.bearing)||C.push({command:rp.setBearing,args:[f.bearing]}),up(x.pitch,f.pitch)||C.push({command:rp.setPitch,args:[f.pitch]}),up(x.sprite,f.sprite)||C.push({command:rp.setSprite,args:[f.sprite]}),up(x.glyphs,f.glyphs)||C.push({command:rp.setGlyphs,args:[f.glyphs]}),up(x.transition,f.transition)||C.push({command:rp.setTransition,args:[f.transition]}),up(x.light,f.light)||C.push({command:rp.setLight,args:[f.light]});const N={},ot=[];(function(Jt,Ir,wo,ol){let hl;for(hl in Ir=Ir||{},Jt=Jt||{})Object.prototype.hasOwnProperty.call(Jt,hl)&&(Object.prototype.hasOwnProperty.call(Ir,hl)||Cp(hl,wo,ol));for(hl in Ir)Object.prototype.hasOwnProperty.call(Ir,hl)&&(Object.prototype.hasOwnProperty.call(Jt,hl)?up(Jt[hl],Ir[hl])||(Jt[hl].type==="geojson"&&Ir[hl].type==="geojson"&&_p(Jt,Ir,hl)?wo.push({command:rp.setGeoJSONSourceData,args:[hl,Ir[hl].data]}):Fp(hl,Ir,wo,ol)):fd(hl,Ir,wo))})(x.sources,f.sources,ot,N);const Bt=[];x.layers&&x.layers.forEach(Jt=>{N[Jt.source]?C.push({command:rp.removeLayer,args:[Jt.id]}):Bt.push(Jt)}),C=C.concat(ot),function(Jt,Ir,wo){Ir=Ir||[];const ol=(Jt=Jt||[]).map($f),hl=Ir.map($f),vl=Jt.reduce(Uf,{}),ah=Ir.reduce(Uf,{}),uh=ol.slice(),ph=Object.create(null);let Ph,Mh,Xh,Jh,qh,ld,pd;for(Ph=0,Mh=0;Ph<ol.length;Ph++)Xh=ol[Ph],Object.prototype.hasOwnProperty.call(ah,Xh)?Mh++:(wo.push({command:rp.removeLayer,args:[Xh]}),uh.splice(uh.indexOf(Xh,Mh),1));for(Ph=0,Mh=0;Ph<hl.length;Ph++)Xh=hl[hl.length-1-Ph],uh[uh.length-1-Ph]!==Xh&&(Object.prototype.hasOwnProperty.call(vl,Xh)?(wo.push({command:rp.removeLayer,args:[Xh]}),uh.splice(uh.lastIndexOf(Xh,uh.length-Mh),1)):Mh++,ld=uh[uh.length-Ph],wo.push({command:rp.addLayer,args:[ah[Xh],ld]}),uh.splice(uh.length-Ph,0,Xh),ph[Xh]=!0);for(Ph=0;Ph<hl.length;Ph++)if(Xh=hl[Ph],Jh=vl[Xh],qh=ah[Xh],!ph[Xh]&&!up(Jh,qh))if(up(Jh.source,qh.source)&&up(Jh["source-layer"],qh["source-layer"])&&up(Jh.type,qh.type)){for(pd in kd(Jh.layout,qh.layout,wo,Xh,null,rp.setLayoutProperty),kd(Jh.paint,qh.paint,wo,Xh,null,rp.setPaintProperty),up(Jh.filter,qh.filter)||wo.push({command:rp.setFilter,args:[Xh,qh.filter]}),up(Jh.minzoom,qh.minzoom)&&up(Jh.maxzoom,qh.maxzoom)||wo.push({command:rp.setLayerZoomRange,args:[Xh,qh.minzoom,qh.maxzoom]}),Jh)Object.prototype.hasOwnProperty.call(Jh,pd)&&pd!=="layout"&&pd!=="paint"&&pd!=="filter"&&pd!=="metadata"&&pd!=="minzoom"&&pd!=="maxzoom"&&(pd.indexOf("paint.")===0?kd(Jh[pd],qh[pd],wo,Xh,pd.slice(6),rp.setPaintProperty):up(Jh[pd],qh[pd])||wo.push({command:rp.setLayerProperty,args:[Xh,pd,qh[pd]]}));for(pd in qh)Object.prototype.hasOwnProperty.call(qh,pd)&&!Object.prototype.hasOwnProperty.call(Jh,pd)&&pd!=="layout"&&pd!=="paint"&&pd!=="filter"&&pd!=="metadata"&&pd!=="minzoom"&&pd!=="maxzoom"&&(pd.indexOf("paint.")===0?kd(Jh[pd],qh[pd],wo,Xh,pd.slice(6),rp.setPaintProperty):up(Jh[pd],qh[pd])||wo.push({command:rp.setLayerProperty,args:[Xh,pd,qh[pd]]}))}else wo.push({command:rp.removeLayer,args:[Xh]}),ld=uh[uh.lastIndexOf(Xh)+1],wo.push({command:rp.addLayer,args:[qh,ld]})}(Bt,f.layers,C)}catch(N){console.warn("Unable to compute style diff:",N),C=[{command:rp.setStyle,args:[f]}]}return C},s.dot=function(x,f){return x[0]*f[0]+x[1]*f[1]+x[2]*f[2]+x[3]*f[3]},s.earthRadius=C1,s.ease=Hr,s.emitValidationErrors=kv,s.emptyStyle=function(){const x={},f=Yh.$version;for(const C in Yh.$root){const N=Yh.$root[C];if(N.required){let ot=null;ot=C==="version"?f:N.type==="array"?[]:{},ot!=null&&(x[C]=ot)}}return x},s.equals=function(x,f){var C=x[0],N=x[1],ot=x[2],Bt=x[3],Jt=x[4],Ir=x[5],wo=x[6],ol=x[7],hl=x[8],vl=x[9],ah=x[10],uh=x[11],ph=x[12],Ph=x[13],Mh=x[14],Xh=x[15],Jh=f[0],qh=f[1],ld=f[2],pd=f[3],Md=f[4],Pp=f[5],bp=f[6],yp=f[7],hp=f[8],lp=f[9],Sp=f[10],vp=f[11],Jd=f[12],Xp=f[13],$p=f[14],ag=f[15];return Math.abs(C-Jh)<=pg*Math.max(1,Math.abs(C),Math.abs(Jh))&&Math.abs(N-qh)<=pg*Math.max(1,Math.abs(N),Math.abs(qh))&&Math.abs(ot-ld)<=pg*Math.max(1,Math.abs(ot),Math.abs(ld))&&Math.abs(Bt-pd)<=pg*Math.max(1,Math.abs(Bt),Math.abs(pd))&&Math.abs(Jt-Md)<=pg*Math.max(1,Math.abs(Jt),Math.abs(Md))&&Math.abs(Ir-Pp)<=pg*Math.max(1,Math.abs(Ir),Math.abs(Pp))&&Math.abs(wo-bp)<=pg*Math.max(1,Math.abs(wo),Math.abs(bp))&&Math.abs(ol-yp)<=pg*Math.max(1,Math.abs(ol),Math.abs(yp))&&Math.abs(hl-hp)<=pg*Math.max(1,Math.abs(hl),Math.abs(hp))&&Math.abs(vl-lp)<=pg*Math.max(1,Math.abs(vl),Math.abs(lp))&&Math.abs(ah-Sp)<=pg*Math.max(1,Math.abs(ah),Math.abs(Sp))&&Math.abs(uh-vp)<=pg*Math.max(1,Math.abs(uh),Math.abs(vp))&&Math.abs(ph-Jd)<=pg*Math.max(1,Math.abs(ph),Math.abs(Jd))&&Math.abs(Ph-Xp)<=pg*Math.max(1,Math.abs(Ph),Math.abs(Xp))&&Math.abs(Mh-$p)<=pg*Math.max(1,Math.abs(Mh),Math.abs($p))&&Math.abs(Xh-ag)<=pg*Math.max(1,Math.abs(Xh),Math.abs(ag))},s.evaluateSizeForFeature=function(x,{uSize:f,uSizeT:C},{lowerSize:N,upperSize:ot}){return x.kind==="source"?N/gv:x.kind==="composite"?Km.number(N/gv,ot/gv,C):f},s.evaluateSizeForZoom=function(x,f){let C=0,N=0;if(x.kind==="constant")N=x.layoutSize;else if(x.kind!=="source"){const{interpolationType:ot,minZoom:Bt,maxZoom:Jt}=x,Ir=ot?Bn(Em.interpolationFactor(ot,f,Bt,Jt),0,1):0;x.kind==="camera"?N=Km.number(x.minSize,x.maxSize,Ir):C=Ir}return{uSizeT:C,uSize:N}},s.evaluateVariableOffset=EC,s.evented=ty,s.exported=Ld,s.extend=Wr,s.filterObject=ml,s.findLineIntersection=function(x,f,C,N){const ot=f.y-x.y,Bt=f.x-x.x,Jt=N.y-C.y,Ir=N.x-C.x,wo=Jt*Bt-Ir*ot;if(wo===0)return null;const ol=(Ir*(x.y-C.y)-Jt*(x.x-C.x))/wo;return new W(x.x+ol*Bt,x.y+ol*ot)},s.fromScaling=function(x,f){return x[0]=f[0],x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=f[1],x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=f[2],x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},s.getAnchorAlignment=fv,s.getAnchorJustification=Zw,s.getArrayBuffer=Wd,s.getDefaultExportFromCjs=m,s.getJSON=function(x,f){return op(Wr(x,{type:"json"}),f)},s.getOverlapMode=gb,s.getProtocolAction=zd,s.getRTLTextPluginStatus=xy,s.getReferrer=wd,s.getVideo=function(x,f){const C=window.document.createElement("video");C.muted=!0,C.onloadstart=function(){f(null,C)};for(let N=0;N<x.length;N++){const ot=window.document.createElement("source");Op(x[N])||(C.crossOrigin="Anonymous"),ot.src=x[N],C.appendChild(ot)}return{cancel:()=>{}}},s.groupByLayout=function(x,f){const C={};for(let ot=0;ot<x.length;ot++){const Bt=f&&f[x[ot].id]||W0(x[ot]);f&&(f[x[ot].id]=Bt);let Jt=C[Bt];Jt||(Jt=C[Bt]=[]),Jt.push(x[ot])}const N=[];for(const ot in C)N.push(C[ot]);return N},s.identity=Pg,s.interpolate=Km,s.invert=function(x,f){var C=f[0],N=f[1],ot=f[2],Bt=f[3],Jt=f[4],Ir=f[5],wo=f[6],ol=f[7],hl=f[8],vl=f[9],ah=f[10],uh=f[11],ph=f[12],Ph=f[13],Mh=f[14],Xh=f[15],Jh=C*Ir-N*Jt,qh=C*wo-ot*Jt,ld=C*ol-Bt*Jt,pd=N*wo-ot*Ir,Md=N*ol-Bt*Ir,Pp=ot*ol-Bt*wo,bp=hl*Ph-vl*ph,yp=hl*Mh-ah*ph,hp=hl*Xh-uh*ph,lp=vl*Mh-ah*Ph,Sp=vl*Xh-uh*Ph,vp=ah*Xh-uh*Mh,Jd=Jh*vp-qh*Sp+ld*lp+pd*hp-Md*yp+Pp*bp;return Jd?(x[0]=(Ir*vp-wo*Sp+ol*lp)*(Jd=1/Jd),x[1]=(ot*Sp-N*vp-Bt*lp)*Jd,x[2]=(Ph*Pp-Mh*Md+Xh*pd)*Jd,x[3]=(ah*Md-vl*Pp-uh*pd)*Jd,x[4]=(wo*hp-Jt*vp-ol*yp)*Jd,x[5]=(C*vp-ot*hp+Bt*yp)*Jd,x[6]=(Mh*ld-ph*Pp-Xh*qh)*Jd,x[7]=(hl*Pp-ah*ld+uh*qh)*Jd,x[8]=(Jt*Sp-Ir*hp+ol*bp)*Jd,x[9]=(N*hp-C*Sp-Bt*bp)*Jd,x[10]=(ph*Md-Ph*ld+Xh*Jh)*Jd,x[11]=(vl*ld-hl*Md-uh*Jh)*Jd,x[12]=(Ir*yp-Jt*lp-wo*bp)*Jd,x[13]=(C*lp-N*yp+ot*bp)*Jd,x[14]=(Ph*qh-ph*pd-Mh*Jh)*Jd,x[15]=(hl*pd-vl*qh+ah*Jh)*Jd,x):null},s.isImageBitmap=Ed,s.isSafari=Bh,s.isWorker=bh,s.keysDifference=function(x,f){const C=[];for(const N in x)N in f||C.push(N);return C},s.lazyLoadRTLTextPlugin=function(){Bm.isLoading()||Bm.isLoaded()||xy()!=="deferred"||ex()},s.makeRequest=op,s.mapObject=gl,s.mercatorXfromLng=P_,s.mercatorYfromLat=dC,s.mercatorZfromAltitude=S1,s.mul=b0,s.mul$1=function(x,f,C){return x[0]=f[0]*C[0],x[1]=f[1]*C[1],x[2]=f[2]*C[2],x[3]=f[3]*C[3],x},s.multiply=u_,s.nextPowerOfTwo=function(x){return x<=1?1:Math.pow(2,Math.ceil(Math.log(x)/Math.LN2))},s.operations=rp,s.ortho=function(x,f,C,N,ot,Bt,Jt){var Ir=1/(f-C),wo=1/(N-ot),ol=1/(Bt-Jt);return x[0]=-2*Ir,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=-2*wo,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=2*ol,x[11]=0,x[12]=(f+C)*Ir,x[13]=(ot+N)*wo,x[14]=(Jt+Bt)*ol,x[15]=1,x},s.parseCacheControl=function(x){const f={};if(x.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(C,N,ot,Bt)=>{const Jt=ot||Bt;return f[N]=!Jt||Jt.toLowerCase(),""}),f["max-age"]){const C=parseInt(f["max-age"],10);isNaN(C)?delete f["max-age"]:f["max-age"]=C}return f},s.parseGlyphPbf=function(x){return new lb(x).readFields(Gw,[])},s.pbf=rb,s.performSymbolLayout=function(x){x.bucket.createArrays(),x.bucket.tilePixelRatio=xd/(512*x.bucket.overscaling),x.bucket.compareText={},x.bucket.iconsNeedLinear=!1;const f=x.bucket.layers[0].layout,C=x.bucket.layers[0]._unevaluatedLayout._values,N={layoutIconSize:C["icon-size"].possiblyEvaluate(new Eg(x.bucket.zoom+1),x.canonical),layoutTextSize:C["text-size"].possiblyEvaluate(new Eg(x.bucket.zoom+1),x.canonical),textMaxSize:C["text-size"].possiblyEvaluate(new Eg(18))};if(x.bucket.textSizeData.kind==="composite"){const{minZoom:wo,maxZoom:ol}=x.bucket.textSizeData;N.compositeTextSizes=[C["text-size"].possiblyEvaluate(new Eg(wo),x.canonical),C["text-size"].possiblyEvaluate(new Eg(ol),x.canonical)]}if(x.bucket.iconSizeData.kind==="composite"){const{minZoom:wo,maxZoom:ol}=x.bucket.iconSizeData;N.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new Eg(wo),x.canonical),C["icon-size"].possiblyEvaluate(new Eg(ol),x.canonical)]}const ot=f.get("text-line-height")*mm,Bt=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point",Jt=f.get("text-keep-upright"),Ir=f.get("text-size");for(const wo of x.bucket.features){const ol=f.get("text-font").evaluate(wo,{},x.canonical).join(","),hl=Ir.evaluate(wo,{},x.canonical),vl=N.layoutTextSize.evaluate(wo,{},x.canonical),ah=N.layoutIconSize.evaluate(wo,{},x.canonical),uh={horizontal:{},vertical:void 0},ph=wo.text;let Ph,Mh=[0,0];if(ph){const qh=ph.toString(),ld=f.get("text-letter-spacing").evaluate(wo,{},x.canonical)*mm,pd=J0(qh)?ld:0,Md=f.get("text-anchor").evaluate(wo,{},x.canonical),Pp=f.get("text-variable-anchor");if(!Pp){const Sp=f.get("text-radial-offset").evaluate(wo,{},x.canonical);Mh=Sp?EC(Md,[Sp*mm,Kw]):f.get("text-offset").evaluate(wo,{},x.canonical).map(vp=>vp*mm)}let bp=Bt?"center":f.get("text-justify").evaluate(wo,{},x.canonical);const yp=f.get("symbol-placement"),hp=yp==="point"?f.get("text-max-width").evaluate(wo,{},x.canonical)*mm:0,lp=()=>{x.bucket.allowVerticalPlacement&&_y(qh)&&(uh.vertical=zw(ph,x.glyphMap,x.glyphPositions,x.imagePositions,ol,hp,ot,Md,"left",pd,Mh,s.WritingMode.vertical,!0,yp,vl,hl))};if(!Bt&&Pp){const Sp=bp==="auto"?Pp.map(Jd=>Zw(Jd)):[bp];let vp=!1;for(let Jd=0;Jd<Sp.length;Jd++){const Xp=Sp[Jd];if(!uh.horizontal[Xp])if(vp)uh.horizontal[Xp]=uh.horizontal[0];else{const $p=zw(ph,x.glyphMap,x.glyphPositions,x.imagePositions,ol,hp,ot,"center",Xp,pd,Mh,s.WritingMode.horizontal,!1,yp,vl,hl);$p&&(uh.horizontal[Xp]=$p,vp=$p.positionedLines.length===1)}}lp()}else{bp==="auto"&&(bp=Zw(Md));const Sp=zw(ph,x.glyphMap,x.glyphPositions,x.imagePositions,ol,hp,ot,Md,bp,pd,Mh,s.WritingMode.horizontal,!1,yp,vl,hl);Sp&&(uh.horizontal[bp]=Sp),lp(),_y(qh)&&Bt&&Jt&&(uh.vertical=zw(ph,x.glyphMap,x.glyphPositions,x.imagePositions,ol,hp,ot,Md,bp,pd,Mh,s.WritingMode.vertical,!1,yp,vl,hl))}}let Xh=!1;if(wo.icon&&wo.icon.name){const qh=x.imageMap[wo.icon.name];qh&&(Ph=y1(x.imagePositions[wo.icon.name],f.get("icon-offset").evaluate(wo,{},x.canonical),f.get("icon-anchor").evaluate(wo,{},x.canonical)),Xh=!!qh.sdf,x.bucket.sdfIcons===void 0?x.bucket.sdfIcons=Xh:x.bucket.sdfIcons!==Xh&&rl("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(qh.pixelRatio!==x.bucket.pixelRatio||f.get("icon-rotate").constantOr(1)!==0)&&(x.bucket.iconsNeedLinear=!0))}const Jh=SC(uh.horizontal)||uh.vertical;x.bucket.iconsInText=!!Jh&&Jh.iconsInText,(Jh||Ph)&&wb(x.bucket,wo,uh,Ph,x.imageMap,N,vl,ah,Mh,Xh,x.canonical)}x.showCollisionBoxes&&x.bucket.generateCollisionDebugBuffers()},s.perspective=function(x,f,C,N,ot){var Bt,Jt=1/Math.tan(f/2);return x[0]=Jt/C,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=Jt,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,ot!=null&&ot!==1/0?(x[10]=(ot+N)*(Bt=1/(N-ot)),x[14]=2*ot*N*Bt):(x[10]=-1,x[14]=-2*N),x},s.pick=function(x,f){const C={};for(let N=0;N<f.length;N++){const ot=f[N];ot in x&&(C[ot]=x[ot])}return C},s.plugin=Bm,s.pointGeometry=y,s.polygonIntersectsPolygon=Hf,s.potpack=g1,s.register=Tp,s.registerForPluginStateChange=function(x){return x({pluginStatus:Tm,pluginURL:km}),ty.on("pluginStateChange",x),x},s.renderColorRamp=o1,s.rotateX=function(x,f,C){var N=Math.sin(C),ot=Math.cos(C),Bt=f[4],Jt=f[5],Ir=f[6],wo=f[7],ol=f[8],hl=f[9],vl=f[10],ah=f[11];return f!==x&&(x[0]=f[0],x[1]=f[1],x[2]=f[2],x[3]=f[3],x[12]=f[12],x[13]=f[13],x[14]=f[14],x[15]=f[15]),x[4]=Bt*ot+ol*N,x[5]=Jt*ot+hl*N,x[6]=Ir*ot+vl*N,x[7]=wo*ot+ah*N,x[8]=ol*ot-Bt*N,x[9]=hl*ot-Jt*N,x[10]=vl*ot-Ir*N,x[11]=ah*ot-wo*N,x},s.rotateZ=function(x,f,C){var N=Math.sin(C),ot=Math.cos(C),Bt=f[0],Jt=f[1],Ir=f[2],wo=f[3],ol=f[4],hl=f[5],vl=f[6],ah=f[7];return f!==x&&(x[8]=f[8],x[9]=f[9],x[10]=f[10],x[11]=f[11],x[12]=f[12],x[13]=f[13],x[14]=f[14],x[15]=f[15]),x[0]=Bt*ot+ol*N,x[1]=Jt*ot+hl*N,x[2]=Ir*ot+vl*N,x[3]=wo*ot+ah*N,x[4]=ol*ot-Bt*N,x[5]=hl*ot-Jt*N,x[6]=vl*ot-Ir*N,x[7]=ah*ot-wo*N,x},s.sameOrigin=Op,s.scale=function(x,f,C){var N=C[0],ot=C[1],Bt=C[2];return x[0]=f[0]*N,x[1]=f[1]*N,x[2]=f[2]*N,x[3]=f[3]*N,x[4]=f[4]*ot,x[5]=f[5]*ot,x[6]=f[6]*ot,x[7]=f[7]*ot,x[8]=f[8]*Bt,x[9]=f[9]*Bt,x[10]=f[10]*Bt,x[11]=f[11]*Bt,x[12]=f[12],x[13]=f[13],x[14]=f[14],x[15]=f[15],x},s.setRTLTextPlugin=function(x,f,C=!1){if(Tm===Q0||Tm===tv||Tm===vy)throw new Error("setRTLTextPlugin cannot be called multiple times.");km=Ld.resolveURL(x),Tm=Q0,Vv=f,Uv(),C||ex()},s.sphericalToCartesian=function([x,f,C]){return f+=90,f*=Math.PI/180,C*=Math.PI/180,{x:x*Math.cos(f)*Math.sin(C),y:x*Math.sin(f)*Math.sin(C),z:x*Math.cos(C)}},s.toEvaluationFeature=Id,s.transformMat4=Zv,s.translate=function(x,f,C){var N,ot,Bt,Jt,Ir,wo,ol,hl,vl,ah,uh,ph,Ph=C[0],Mh=C[1],Xh=C[2];return f===x?(x[12]=f[0]*Ph+f[4]*Mh+f[8]*Xh+f[12],x[13]=f[1]*Ph+f[5]*Mh+f[9]*Xh+f[13],x[14]=f[2]*Ph+f[6]*Mh+f[10]*Xh+f[14],x[15]=f[3]*Ph+f[7]*Mh+f[11]*Xh+f[15]):(ot=f[1],Bt=f[2],Jt=f[3],Ir=f[4],wo=f[5],ol=f[6],hl=f[7],vl=f[8],ah=f[9],uh=f[10],ph=f[11],x[0]=N=f[0],x[1]=ot,x[2]=Bt,x[3]=Jt,x[4]=Ir,x[5]=wo,x[6]=ol,x[7]=hl,x[8]=vl,x[9]=ah,x[10]=uh,x[11]=ph,x[12]=N*Ph+Ir*Mh+vl*Xh+f[12],x[13]=ot*Ph+wo*Mh+ah*Xh+f[13],x[14]=Bt*Ph+ol*Mh+uh*Xh+f[14],x[15]=Jt*Ph+hl*Mh+ph*Xh+f[15]),x},s.triggerPluginCompletionEvent=Sx,s.unicodeBlockLookup=sp,s.uniqueId=function(){return ps++},s.v8Spec=Yh,s.validateCustomStyleLayer=function(x){const f=[],C=x.id;return C===void 0&&f.push({message:`layers.${C}: missing required property "id"`}),x.render===void 0&&f.push({message:`layers.${C}: missing required method "render"`}),x.renderingMode&&x.renderingMode!=="2d"&&x.renderingMode!=="3d"&&f.push({message:`layers.${C}: property "renderingMode" must be either "2d" or "3d"`}),f},s.validateLight=xw,s.validateStyle=my,s.vectorTile=Ty,s.warnOnce=rl,s.wrap=Vn}),a(["./shared"],function(s){class m{constructor(gs){this.keyCache={},gs&&this.replace(gs)}replace(gs){this._layerConfigs={},this._layers={},this.update(gs,[])}update(gs,Cr){for(const ul of gs){this._layerConfigs[ul.id]=ul;const ih=this._layers[ul.id]=s.createStyleLayer(ul);ih._featureFilter=s.createFilter(ih.filter),this.keyCache[ul.id]&&delete this.keyCache[ul.id]}for(const ul of Cr)delete this.keyCache[ul],delete this._layerConfigs[ul],delete this._layers[ul];this.familiesBySource={};const fs=s.groupByLayout(Object.values(this._layerConfigs),this.keyCache);for(const ul of fs){const ih=ul.map(rd=>this._layers[rd.id]),ch=ih[0];if(ch.visibility==="none")continue;const vh=ch.source||"";let Th=this.familiesBySource[vh];Th||(Th=this.familiesBySource[vh]={});const Nh=ch.sourceLayer||"_geojsonTileLayer";let Qh=Th[Nh];Qh||(Qh=Th[Nh]=[]),Qh.push(ih)}}}class y{constructor(gs){const Cr={},fs=[];for(const vh in gs){const Th=gs[vh],Nh=Cr[vh]={};for(const Qh in Th){const rd=Th[+Qh];if(!rd||rd.bitmap.width===0||rd.bitmap.height===0)continue;const _d={x:0,y:0,w:rd.bitmap.width+2,h:rd.bitmap.height+2};fs.push(_d),Nh[Qh]={rect:_d,metrics:rd.metrics}}}const{w:ul,h:ih}=s.potpack(fs),ch=new s.AlphaImage({width:ul||1,height:ih||1});for(const vh in gs){const Th=gs[vh];for(const Nh in Th){const Qh=Th[+Nh];if(!Qh||Qh.bitmap.width===0||Qh.bitmap.height===0)continue;const rd=Cr[vh][Nh].rect;s.AlphaImage.copy(Qh.bitmap,ch,{x:0,y:0},{x:rd.x+1,y:rd.y+1},Qh.bitmap)}}this.image=ch,this.positions=Cr}}s.register("GlyphAtlas",y);class D{constructor(gs){this.tileID=new s.OverscaledTileID(gs.tileID.overscaledZ,gs.tileID.wrap,gs.tileID.canonical.z,gs.tileID.canonical.x,gs.tileID.canonical.y),this.uid=gs.uid,this.zoom=gs.zoom,this.pixelRatio=gs.pixelRatio,this.tileSize=gs.tileSize,this.source=gs.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=gs.showCollisionBoxes,this.collectResourceTiming=!!gs.collectResourceTiming,this.returnDependencies=!!gs.returnDependencies,this.promoteId=gs.promoteId}parse(gs,Cr,fs,ul,ih){this.status="parsing",this.data=gs,this.collisionBoxArray=new s.CollisionBoxArray;const ch=new s.DictionaryCoder(Object.keys(gs.layers).sort()),vh=new s.FeatureIndex(this.tileID,this.promoteId);vh.bucketLayerIDs=[];const Th={},Nh={featureIndex:vh,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:fs},Qh=Cr.familiesBySource[this.source];for(const Vf in Qh){const Wf=gs.layers[Vf];if(!Wf)continue;Wf.version===1&&s.warnOnce(`Vector tile source "${this.source}" layer "${Vf}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const dg=ch.encode(Vf),Jp=[];for(let Yp=0;Yp<Wf.length;Yp++){const Cg=Wf.feature(Yp),o_=vh.getId(Cg,Vf);Jp.push({feature:Cg,id:o_,index:Yp,sourceLayerIndex:dg})}for(const Yp of Qh[Vf]){const Cg=Yp[0];Cg.source!==this.source&&s.warnOnce(`layer.source = ${Cg.source} does not equal this.source = ${this.source}`),Cg.minzoom&&this.zoom<Math.floor(Cg.minzoom)||Cg.maxzoom&&this.zoom>=Cg.maxzoom||Cg.visibility!=="none"&&(W(Yp,this.zoom,fs),(Th[Cg.id]=Cg.createBucket({index:vh.bucketLayerIDs.length,layers:Yp,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:dg,sourceID:this.source})).populate(Jp,Nh,this.tileID.canonical),vh.bucketLayerIDs.push(Yp.map(o_=>o_.id)))}}let rd,_d,ip,Dp;const qd=s.mapObject(Nh.glyphDependencies,Vf=>Object.keys(Vf).map(Number));Object.keys(qd).length?ul.send("getGlyphs",{uid:this.uid,stacks:qd,source:this.source,tileID:this.tileID,type:"glyphs"},(Vf,Wf)=>{rd||(rd=Vf,_d=Wf,Wp.call(this))}):_d={};const wp=Object.keys(Nh.iconDependencies);wp.length?ul.send("getImages",{icons:wp,source:this.source,tileID:this.tileID,type:"icons"},(Vf,Wf)=>{rd||(rd=Vf,ip=Wf,Wp.call(this))}):ip={};const pp=Object.keys(Nh.patternDependencies);function Wp(){if(rd)return ih(rd);if(_d&&ip&&Dp){const Vf=new y(_d),Wf=new s.ImageAtlas(ip,Dp);for(const dg in Th){const Jp=Th[dg];Jp instanceof s.SymbolBucket?(W(Jp.layers,this.zoom,fs),s.performSymbolLayout({bucket:Jp,glyphMap:_d,glyphPositions:Vf.positions,imageMap:ip,imagePositions:Wf.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Jp.hasPattern&&(Jp instanceof s.LineBucket||Jp instanceof s.FillBucket||Jp instanceof s.FillExtrusionBucket)&&(W(Jp.layers,this.zoom,fs),Jp.addFeatures(Nh,this.tileID.canonical,Wf.patternPositions))}this.status="done",ih(null,{buckets:Object.values(Th).filter(dg=>!dg.isEmpty()),featureIndex:vh,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Vf.image,imageAtlas:Wf,glyphMap:this.returnDependencies?_d:null,iconMap:this.returnDependencies?ip:null,glyphPositions:this.returnDependencies?Vf.positions:null})}}pp.length?ul.send("getImages",{icons:pp,source:this.source,tileID:this.tileID,type:"patterns"},(Vf,Wf)=>{rd||(rd=Vf,Dp=Wf,Wp.call(this))}):Dp={},Wp.call(this)}}function W(yl,gs,Cr){const fs=new s.EvaluationParameters(gs);for(const ul of yl)ul.recalculate(fs,Cr)}function Ee(yl,gs){const Cr=s.getArrayBuffer(yl.request,(fs,ul,ih,ch)=>{fs?gs(fs):ul&&gs(null,{vectorTile:new s.vectorTile.VectorTile(new s.Protobuf(ul)),rawData:ul,cacheControl:ih,expires:ch})});return()=>{Cr.cancel(),gs()}}class dt{constructor(gs,Cr,fs,ul){this.actor=gs,this.layerIndex=Cr,this.availableImages=fs,this.loadVectorData=ul||Ee,this.loading={},this.loaded={}}loadTile(gs,Cr){const fs=gs.uid;this.loading||(this.loading={});const ul=!!(gs&&gs.request&&gs.request.collectResourceTiming)&&new s.RequestPerformance(gs.request),ih=this.loading[fs]=new D(gs);ih.abort=this.loadVectorData(gs,(ch,vh)=>{if(delete this.loading[fs],ch||!vh)return ih.status="done",this.loaded[fs]=ih,Cr(ch);const Th=vh.rawData,Nh={};vh.expires&&(Nh.expires=vh.expires),vh.cacheControl&&(Nh.cacheControl=vh.cacheControl);const Qh={};if(ul){const rd=ul.finish();rd&&(Qh.resourceTiming=JSON.parse(JSON.stringify(rd)))}ih.vectorTile=vh.vectorTile,ih.parse(vh.vectorTile,this.layerIndex,this.availableImages,this.actor,(rd,_d)=>{if(rd||!_d)return Cr(rd);Cr(null,s.extend({rawTileData:Th.slice(0)},_d,Nh,Qh))}),this.loaded=this.loaded||{},this.loaded[fs]=ih})}reloadTile(gs,Cr){const fs=this.loaded,ul=gs.uid,ih=this;if(fs&&fs[ul]){const ch=fs[ul];ch.showCollisionBoxes=gs.showCollisionBoxes;const vh=(Th,Nh)=>{const Qh=ch.reloadCallback;Qh&&(delete ch.reloadCallback,ch.parse(ch.vectorTile,ih.layerIndex,this.availableImages,ih.actor,Qh)),Cr(Th,Nh)};ch.status==="parsing"?ch.reloadCallback=vh:ch.status==="done"&&(ch.vectorTile?ch.parse(ch.vectorTile,this.layerIndex,this.availableImages,this.actor,vh):vh())}}abortTile(gs,Cr){const fs=this.loading,ul=gs.uid;fs&&fs[ul]&&fs[ul].abort&&(fs[ul].abort(),delete fs[ul]),Cr()}removeTile(gs,Cr){const fs=this.loaded,ul=gs.uid;fs&&fs[ul]&&delete fs[ul],Cr()}}class Ht{constructor(){this.loaded={}}loadTile(gs,Cr){const{uid:fs,encoding:ul,rawImageData:ih}=gs,ch=s.isImageBitmap(ih)?this.getImageData(ih):ih,vh=new s.DEMData(fs,ch,ul);this.loaded=this.loaded||{},this.loaded[fs]=vh,Cr(null,vh)}getImageData(gs){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(gs.width,gs.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=gs.width,this.offscreenCanvas.height=gs.height,this.offscreenCanvasContext.drawImage(gs,0,0,gs.width,gs.height);const Cr=this.offscreenCanvasContext.getImageData(-1,-1,gs.width+2,gs.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new s.RGBAImage({width:Cr.width,height:Cr.height},Cr.data)}removeTile(gs){const Cr=this.loaded,fs=gs.uid;Cr&&Cr[fs]&&delete Cr[fs]}}function ir(yl,gs){if(yl.length!==0){Hr(yl[0],gs);for(var Cr=1;Cr<yl.length;Cr++)Hr(yl[Cr],!gs)}}function Hr(yl,gs){for(var Cr=0,fs=0,ul=0,ih=yl.length,ch=ih-1;ul<ih;ch=ul++){var vh=(yl[ul][0]-yl[ch][0])*(yl[ch][1]+yl[ul][1]),Th=Cr+vh;fs+=Math.abs(Cr)>=Math.abs(vh)?Cr-Th+vh:vh-Th+Cr,Cr=Th}Cr+fs>=0!=!!gs&&yl.reverse()}var Bn=s.getDefaultExportFromCjs(function yl(gs,Cr){var fs,ul=gs&&gs.type;if(ul==="FeatureCollection")for(fs=0;fs<gs.features.length;fs++)yl(gs.features[fs],Cr);else if(ul==="GeometryCollection")for(fs=0;fs<gs.geometries.length;fs++)yl(gs.geometries[fs],Cr);else if(ul==="Feature")yl(gs.geometry,Cr);else if(ul==="Polygon")ir(gs.coordinates,Cr);else if(ul==="MultiPolygon")for(fs=0;fs<gs.coordinates.length;fs++)ir(gs.coordinates[fs],Cr);return gs});const Vn=s.vectorTile.VectorTileFeature.prototype.toGeoJSON;var Wr={exports:{}},ps=s.pointGeometry,il=s.vectorTile.VectorTileFeature,gl=ml;function ml(yl,gs){this.options=gs||{},this.features=yl,this.length=yl.length}function sl(yl,gs){this.id=typeof yl.id=="number"?yl.id:void 0,this.type=yl.type,this.rawGeometry=yl.type===1?[yl.geometry]:yl.geometry,this.properties=yl.tags,this.extent=gs||4096}ml.prototype.feature=function(yl){return new sl(this.features[yl],this.options.extent)},sl.prototype.loadGeometry=function(){var yl=this.rawGeometry;this.geometry=[];for(var gs=0;gs<yl.length;gs++){for(var Cr=yl[gs],fs=[],ul=0;ul<Cr.length;ul++)fs.push(new ps(Cr[ul][0],Cr[ul][1]));this.geometry.push(fs)}return this.geometry},sl.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var yl=this.geometry,gs=1/0,Cr=-1/0,fs=1/0,ul=-1/0,ih=0;ih<yl.length;ih++)for(var ch=yl[ih],vh=0;vh<ch.length;vh++){var Th=ch[vh];gs=Math.min(gs,Th.x),Cr=Math.max(Cr,Th.x),fs=Math.min(fs,Th.y),ul=Math.max(ul,Th.y)}return[gs,fs,Cr,ul]},sl.prototype.toGeoJSON=il.prototype.toGeoJSON;var ll=s.pbf,rl=gl;function th(yl){var gs=new ll;return function(Cr,fs){for(var ul in Cr.layers)fs.writeMessage(3,nh,Cr.layers[ul])}(yl,gs),gs.finish()}function nh(yl,gs){var Cr;gs.writeVarintField(15,yl.version||1),gs.writeStringField(1,yl.name||""),gs.writeVarintField(5,yl.extent||4096);var fs={keys:[],values:[],keycache:{},valuecache:{}};for(Cr=0;Cr<yl.length;Cr++)fs.feature=yl.feature(Cr),gs.writeMessage(2,bh,fs);var ul=fs.keys;for(Cr=0;Cr<ul.length;Cr++)gs.writeStringField(3,ul[Cr]);var ih=fs.values;for(Cr=0;Cr<ih.length;Cr++)gs.writeMessage(4,td,ih[Cr])}function bh(yl,gs){var Cr=yl.feature;Cr.id!==void 0&&gs.writeVarintField(1,Cr.id),gs.writeMessage(2,Fh,yl),gs.writeVarintField(3,Cr.type),gs.writeMessage(4,Td,Cr)}function Fh(yl,gs){var Cr=yl.feature,fs=yl.keys,ul=yl.values,ih=yl.keycache,ch=yl.valuecache;for(var vh in Cr.properties){var Th=Cr.properties[vh],Nh=ih[vh];if(Th!==null){Nh===void 0&&(fs.push(vh),ih[vh]=Nh=fs.length-1),gs.writeVarint(Nh);var Qh=typeof Th;Qh!=="string"&&Qh!=="boolean"&&Qh!=="number"&&(Th=JSON.stringify(Th));var rd=Qh+":"+Th,_d=ch[rd];_d===void 0&&(ul.push(Th),ch[rd]=_d=ul.length-1),gs.writeVarint(_d)}}}function Bh(yl,gs){return(gs<<3)+(7&yl)}function Ed(yl){return yl<<1^yl>>31}function Td(yl,gs){for(var Cr=yl.loadGeometry(),fs=yl.type,ul=0,ih=0,ch=Cr.length,vh=0;vh<ch;vh++){var Th=Cr[vh],Nh=1;fs===1&&(Nh=Th.length),gs.writeVarint(Bh(1,Nh));for(var Qh=fs===3?Th.length-1:Th.length,rd=0;rd<Qh;rd++){rd===1&&fs!==1&&gs.writeVarint(Bh(2,Qh-1));var _d=Th[rd].x-ul,ip=Th[rd].y-ih;gs.writeVarint(Ed(_d)),gs.writeVarint(Ed(ip)),ul+=_d,ih+=ip}fs===3&&gs.writeVarint(Bh(7,1))}}function td(yl,gs){var Cr=typeof yl;Cr==="string"?gs.writeStringField(1,yl):Cr==="boolean"?gs.writeBooleanField(7,yl):Cr==="number"&&(yl%1!=0?gs.writeDoubleField(3,yl):yl<0?gs.writeSVarintField(6,yl):gs.writeVarintField(5,yl))}Wr.exports=th,Wr.exports.fromVectorTileJs=th,Wr.exports.fromGeojsonVt=function(yl,gs){gs=gs||{};var Cr={};for(var fs in yl)Cr[fs]=new rl(yl[fs].features,gs),Cr[fs].name=fs,Cr[fs].version=gs.version,Cr[fs].extent=gs.extent;return th({layers:Cr})},Wr.exports.GeoJSONWrapper=rl;var Fd=s.getDefaultExportFromCjs(Wr.exports);const Ld={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:yl=>yl},Ud=Math.fround||(Xd=new Float32Array(1),yl=>(Xd[0]=+yl,Xd[0]));var Xd;const wd=3,zd=5,Rd=6;class op{constructor(gs){this.options=Object.assign(Object.create(Ld),gs),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(gs){const{log:Cr,minZoom:fs,maxZoom:ul}=this.options;Cr&&console.time("total time");const ih=`prepare ${gs.length} points`;Cr&&console.time(ih),this.points=gs;const ch=[];for(let Th=0;Th<gs.length;Th++){const Nh=gs[Th];if(!Nh.geometry)continue;const[Qh,rd]=Nh.geometry.coordinates,_d=Ud(ep(Qh)),ip=Ud(zp(rd));ch.push(_d,ip,1/0,Th,-1,1),this.options.reduce&&ch.push(0)}let vh=this.trees[ul+1]=this._createTree(ch);Cr&&console.timeEnd(ih);for(let Th=ul;Th>=fs;Th--){const Nh=+Date.now();vh=this.trees[Th]=this._createTree(this._cluster(vh,Th)),Cr&&console.log("z%d: %d clusters in %dms",Th,vh.numItems,+Date.now()-Nh)}return Cr&&console.timeEnd("total time"),this}getClusters(gs,Cr){let fs=((gs[0]+180)%360+360)%360-180;const ul=Math.max(-90,Math.min(90,gs[1]));let ih=gs[2]===180?180:((gs[2]+180)%360+360)%360-180;const ch=Math.max(-90,Math.min(90,gs[3]));if(gs[2]-gs[0]>=360)fs=-180,ih=180;else if(fs>ih){const rd=this.getClusters([fs,ul,180,ch],Cr),_d=this.getClusters([-180,ul,ih,ch],Cr);return rd.concat(_d)}const vh=this.trees[this._limitZoom(Cr)],Th=vh.range(ep(fs),zp(ch),ep(ih),zp(ul)),Nh=vh.data,Qh=[];for(const rd of Th){const _d=this.stride*rd;Qh.push(Nh[_d+zd]>1?Wd(Nh,_d,this.clusterProps):this.points[Nh[_d+wd]])}return Qh}getChildren(gs){const Cr=this._getOriginId(gs),fs=this._getOriginZoom(gs),ul="No cluster with the specified id.",ih=this.trees[fs];if(!ih)throw new Error(ul);const ch=ih.data;if(Cr*this.stride>=ch.length)throw new Error(ul);const vh=this.options.radius/(this.options.extent*Math.pow(2,fs-1)),Th=ih.within(ch[Cr*this.stride],ch[Cr*this.stride+1],vh),Nh=[];for(const Qh of Th){const rd=Qh*this.stride;ch[rd+4]===gs&&Nh.push(ch[rd+zd]>1?Wd(ch,rd,this.clusterProps):this.points[ch[rd+wd]])}if(Nh.length===0)throw new Error(ul);return Nh}getLeaves(gs,Cr,fs){const ul=[];return this._appendLeaves(ul,gs,Cr=Cr||10,fs=fs||0,0),ul}getTile(gs,Cr,fs){const ul=this.trees[this._limitZoom(gs)],ih=Math.pow(2,gs),{extent:ch,radius:vh}=this.options,Th=vh/ch,Nh=(fs-Th)/ih,Qh=(fs+1+Th)/ih,rd={features:[]};return this._addTileFeatures(ul.range((Cr-Th)/ih,Nh,(Cr+1+Th)/ih,Qh),ul.data,Cr,fs,ih,rd),Cr===0&&this._addTileFeatures(ul.range(1-Th/ih,Nh,1,Qh),ul.data,ih,fs,ih,rd),Cr===ih-1&&this._addTileFeatures(ul.range(0,Nh,Th/ih,Qh),ul.data,-1,fs,ih,rd),rd.features.length?rd:null}getClusterExpansionZoom(gs){let Cr=this._getOriginZoom(gs)-1;for(;Cr<=this.options.maxZoom;){const fs=this.getChildren(gs);if(Cr++,fs.length!==1)break;gs=fs[0].properties.cluster_id}return Cr}_appendLeaves(gs,Cr,fs,ul,ih){const ch=this.getChildren(Cr);for(const vh of ch){const Th=vh.properties;if(Th&&Th.cluster?ih+Th.point_count<=ul?ih+=Th.point_count:ih=this._appendLeaves(gs,Th.cluster_id,fs,ul,ih):ih<ul?ih++:gs.push(vh),gs.length===fs)break}return ih}_createTree(gs){const Cr=new s.KDBush(gs.length/this.stride|0,this.options.nodeSize,Float32Array);for(let fs=0;fs<gs.length;fs+=this.stride)Cr.add(gs[fs],gs[fs+1]);return Cr.finish(),Cr.data=gs,Cr}_addTileFeatures(gs,Cr,fs,ul,ih,ch){for(const vh of gs){const Th=vh*this.stride,Nh=Cr[Th+zd]>1;let Qh,rd,_d;if(Nh)Qh=Op(Cr,Th,this.clusterProps),rd=Cr[Th],_d=Cr[Th+1];else{const qd=this.points[Cr[Th+wd]];Qh=qd.properties;const[wp,pp]=qd.geometry.coordinates;rd=ep(wp),_d=zp(pp)}const ip={type:1,geometry:[[Math.round(this.options.extent*(rd*ih-fs)),Math.round(this.options.extent*(_d*ih-ul))]],tags:Qh};let Dp;Dp=Nh||this.options.generateId?Cr[Th+wd]:this.points[Cr[Th+wd]].id,Dp!==void 0&&(ip.id=Dp),ch.features.push(ip)}}_limitZoom(gs){return Math.max(this.options.minZoom,Math.min(Math.floor(+gs),this.options.maxZoom+1))}_cluster(gs,Cr){const{radius:fs,extent:ul,reduce:ih,minPoints:ch}=this.options,vh=fs/(ul*Math.pow(2,Cr)),Th=gs.data,Nh=[],Qh=this.stride;for(let rd=0;rd<Th.length;rd+=Qh){if(Th[rd+2]<=Cr)continue;Th[rd+2]=Cr;const _d=Th[rd],ip=Th[rd+1],Dp=gs.within(Th[rd],Th[rd+1],vh),qd=Th[rd+zd];let wp=qd;for(const pp of Dp){const Wp=pp*Qh;Th[Wp+2]>Cr&&(wp+=Th[Wp+zd])}if(wp>qd&&wp>=ch){let pp,Wp=_d*qd,Vf=ip*qd,Wf=-1;const dg=((rd/Qh|0)<<5)+(Cr+1)+this.points.length;for(const Jp of Dp){const Yp=Jp*Qh;if(Th[Yp+2]<=Cr)continue;Th[Yp+2]=Cr;const Cg=Th[Yp+zd];Wp+=Th[Yp]*Cg,Vf+=Th[Yp+1]*Cg,Th[Yp+4]=dg,ih&&(pp||(pp=this._map(Th,rd,!0),Wf=this.clusterProps.length,this.clusterProps.push(pp)),ih(pp,this._map(Th,Yp)))}Th[rd+4]=dg,Nh.push(Wp/wp,Vf/wp,1/0,dg,-1,wp),ih&&Nh.push(Wf)}else{for(let pp=0;pp<Qh;pp++)Nh.push(Th[rd+pp]);if(wp>1)for(const pp of Dp){const Wp=pp*Qh;if(!(Th[Wp+2]<=Cr)){Th[Wp+2]=Cr;for(let Vf=0;Vf<Qh;Vf++)Nh.push(Th[Wp+Vf])}}}}return Nh}_getOriginId(gs){return gs-this.points.length>>5}_getOriginZoom(gs){return(gs-this.points.length)%32}_map(gs,Cr,fs){if(gs[Cr+zd]>1){const ch=this.clusterProps[gs[Cr+Rd]];return fs?Object.assign({},ch):ch}const ul=this.points[gs[Cr+wd]].properties,ih=this.options.map(ul);return fs&&ih===ul?Object.assign({},ih):ih}}function Wd(yl,gs,Cr){return{type:"Feature",id:yl[gs+wd],properties:Op(yl,gs,Cr),geometry:{type:"Point",coordinates:[(fs=yl[gs],360*(fs-.5)),Kd(yl[gs+1])]}};var fs}function Op(yl,gs,Cr){const fs=yl[gs+zd],ul=fs>=1e4?`${Math.round(fs/1e3)}k`:fs>=1e3?Math.round(fs/100)/10+"k":fs,ih=yl[gs+Rd],ch=ih===-1?{}:Object.assign({},Cr[ih]);return Object.assign(ch,{cluster:!0,cluster_id:yl[gs+wd],point_count:fs,point_count_abbreviated:ul})}function ep(yl){return yl/360+.5}function zp(yl){const gs=Math.sin(yl*Math.PI/180),Cr=.5-.25*Math.log((1+gs)/(1-gs))/Math.PI;return Cr<0?0:Cr>1?1:Cr}function Kd(yl){const gs=(180-360*yl)*Math.PI/180;return 360*Math.atan(Math.exp(gs))/Math.PI-90}function Ap(yl,gs,Cr,fs){for(var ul,ih=fs,ch=Cr-gs>>1,vh=Cr-gs,Th=yl[gs],Nh=yl[gs+1],Qh=yl[Cr],rd=yl[Cr+1],_d=gs+3;_d<Cr;_d+=3){var ip=Ip(yl[_d],yl[_d+1],Th,Nh,Qh,rd);if(ip>ih)ul=_d,ih=ip;else if(ip===ih){var Dp=Math.abs(_d-ch);Dp<vh&&(ul=_d,vh=Dp)}}ih>fs&&(ul-gs>3&&Ap(yl,gs,ul,fs),yl[ul+2]=ih,Cr-ul>3&&Ap(yl,ul,Cr,fs))}function Ip(yl,gs,Cr,fs,ul,ih){var ch=ul-Cr,vh=ih-fs;if(ch!==0||vh!==0){var Th=((yl-Cr)*ch+(gs-fs)*vh)/(ch*ch+vh*vh);Th>1?(Cr=ul,fs=ih):Th>0&&(Cr+=ch*Th,fs+=vh*Th)}return(ch=yl-Cr)*ch+(vh=gs-fs)*vh}function Yh(yl,gs,Cr,fs){var ul={id:yl===void 0?null:yl,type:gs,geometry:Cr,tags:fs,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ih){var ch=ih.geometry,vh=ih.type;if(vh==="Point"||vh==="MultiPoint"||vh==="LineString")Ad(ih,ch);else if(vh==="Polygon"||vh==="MultiLineString")for(var Th=0;Th<ch.length;Th++)Ad(ih,ch[Th]);else if(vh==="MultiPolygon")for(Th=0;Th<ch.length;Th++)for(var Nh=0;Nh<ch[Th].length;Nh++)Ad(ih,ch[Th][Nh])}(ul),ul}function Ad(yl,gs){for(var Cr=0;Cr<gs.length;Cr+=3)yl.minX=Math.min(yl.minX,gs[Cr]),yl.minY=Math.min(yl.minY,gs[Cr+1]),yl.maxX=Math.max(yl.maxX,gs[Cr]),yl.maxY=Math.max(yl.maxY,gs[Cr+1])}function kp(yl,gs,Cr,fs){if(gs.geometry){var ul=gs.geometry.coordinates,ih=gs.geometry.type,ch=Math.pow(Cr.tolerance/((1<<Cr.maxZoom)*Cr.extent),2),vh=[],Th=gs.id;if(Cr.promoteId?Th=gs.properties[Cr.promoteId]:Cr.generateId&&(Th=fs||0),ih==="Point")up(ul,vh);else if(ih==="MultiPoint")for(var Nh=0;Nh<ul.length;Nh++)up(ul[Nh],vh);else if(ih==="LineString")rp(ul,vh,ch,!1);else if(ih==="MultiLineString"){if(Cr.lineMetrics){for(Nh=0;Nh<ul.length;Nh++)rp(ul[Nh],vh=[],ch,!1),yl.push(Yh(Th,"LineString",vh,gs.properties));return}fd(ul,vh,ch,!1)}else if(ih==="Polygon")fd(ul,vh,ch,!0);else{if(ih!=="MultiPolygon"){if(ih==="GeometryCollection"){for(Nh=0;Nh<gs.geometry.geometries.length;Nh++)kp(yl,{id:Th,geometry:gs.geometry.geometries[Nh],properties:gs.properties},Cr,fs);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Nh=0;Nh<ul.length;Nh++){var Qh=[];fd(ul[Nh],Qh,ch,!0),vh.push(Qh)}}yl.push(Yh(Th,ih,vh,gs.properties))}}function up(yl,gs){gs.push(Cp(yl[0])),gs.push(Fp(yl[1])),gs.push(0)}function rp(yl,gs,Cr,fs){for(var ul,ih,ch=0,vh=0;vh<yl.length;vh++){var Th=Cp(yl[vh][0]),Nh=Fp(yl[vh][1]);gs.push(Th),gs.push(Nh),gs.push(0),vh>0&&(ch+=fs?(ul*Nh-Th*ih)/2:Math.sqrt(Math.pow(Th-ul,2)+Math.pow(Nh-ih,2))),ul=Th,ih=Nh}var Qh=gs.length-3;gs[2]=1,Ap(gs,0,Qh,Cr),gs[Qh+2]=1,gs.size=Math.abs(ch),gs.start=0,gs.end=gs.size}function fd(yl,gs,Cr,fs){for(var ul=0;ul<yl.length;ul++){var ih=[];rp(yl[ul],ih,Cr,fs),gs.push(ih)}}function Cp(yl){return yl/360+.5}function Fp(yl){var gs=Math.sin(yl*Math.PI/180),Cr=.5-.25*Math.log((1+gs)/(1-gs))/Math.PI;return Cr<0?0:Cr>1?1:Cr}function _p(yl,gs,Cr,fs,ul,ih,ch,vh){if(fs/=gs,ih>=(Cr/=gs)&&ch<fs)return yl;if(ch<Cr||ih>=fs)return null;for(var Th=[],Nh=0;Nh<yl.length;Nh++){var Qh=yl[Nh],rd=Qh.geometry,_d=Qh.type,ip=ul===0?Qh.minX:Qh.minY,Dp=ul===0?Qh.maxX:Qh.maxY;if(ip>=Cr&&Dp<fs)Th.push(Qh);else if(!(Dp<Cr||ip>=fs)){var qd=[];if(_d==="Point"||_d==="MultiPoint")kd(rd,qd,Cr,fs,ul);else if(_d==="LineString")$f(rd,qd,Cr,fs,ul,!1,vh.lineMetrics);else if(_d==="MultiLineString")cd(rd,qd,Cr,fs,ul,!1);else if(_d==="Polygon")cd(rd,qd,Cr,fs,ul,!0);else if(_d==="MultiPolygon")for(var wp=0;wp<rd.length;wp++){var pp=[];cd(rd[wp],pp,Cr,fs,ul,!0),pp.length&&qd.push(pp)}if(qd.length){if(vh.lineMetrics&&_d==="LineString"){for(wp=0;wp<qd.length;wp++)Th.push(Yh(Qh.id,_d,qd[wp],Qh.tags));continue}_d!=="LineString"&&_d!=="MultiLineString"||(qd.length===1?(_d="LineString",qd=qd[0]):_d="MultiLineString"),_d!=="Point"&&_d!=="MultiPoint"||(_d=qd.length===3?"Point":"MultiPoint"),Th.push(Yh(Qh.id,_d,qd,Qh.tags))}}}return Th.length?Th:null}function kd(yl,gs,Cr,fs,ul){for(var ih=0;ih<yl.length;ih+=3){var ch=yl[ih+ul];ch>=Cr&&ch<=fs&&(gs.push(yl[ih]),gs.push(yl[ih+1]),gs.push(yl[ih+2]))}}function $f(yl,gs,Cr,fs,ul,ih,ch){for(var vh,Th,Nh=Uf(yl),Qh=ul===0?xp:Ep,rd=yl.start,_d=0;_d<yl.length-3;_d+=3){var ip=yl[_d],Dp=yl[_d+1],qd=yl[_d+2],wp=yl[_d+3],pp=yl[_d+4],Wp=ul===0?ip:Dp,Vf=ul===0?wp:pp,Wf=!1;ch&&(vh=Math.sqrt(Math.pow(ip-wp,2)+Math.pow(Dp-pp,2))),Wp<Cr?Vf>Cr&&(Th=Qh(Nh,ip,Dp,wp,pp,Cr),ch&&(Nh.start=rd+vh*Th)):Wp>fs?Vf<fs&&(Th=Qh(Nh,ip,Dp,wp,pp,fs),ch&&(Nh.start=rd+vh*Th)):cp(Nh,ip,Dp,qd),Vf<Cr&&Wp>=Cr&&(Th=Qh(Nh,ip,Dp,wp,pp,Cr),Wf=!0),Vf>fs&&Wp<=fs&&(Th=Qh(Nh,ip,Dp,wp,pp,fs),Wf=!0),!ih&&Wf&&(ch&&(Nh.end=rd+vh*Th),gs.push(Nh),Nh=Uf(yl)),ch&&(rd+=vh)}var dg=yl.length-3;ip=yl[dg],Dp=yl[dg+1],qd=yl[dg+2],(Wp=ul===0?ip:Dp)>=Cr&&Wp<=fs&&cp(Nh,ip,Dp,qd),dg=Nh.length-3,ih&&dg>=3&&(Nh[dg]!==Nh[0]||Nh[dg+1]!==Nh[1])&&cp(Nh,Nh[0],Nh[1],Nh[2]),Nh.length&&gs.push(Nh)}function Uf(yl){var gs=[];return gs.size=yl.size,gs.start=yl.start,gs.end=yl.end,gs}function cd(yl,gs,Cr,fs,ul,ih){for(var ch=0;ch<yl.length;ch++)$f(yl[ch],gs,Cr,fs,ul,ih,!1)}function cp(yl,gs,Cr,fs){yl.push(gs),yl.push(Cr),yl.push(fs)}function xp(yl,gs,Cr,fs,ul,ih){var ch=(ih-gs)/(fs-gs);return yl.push(ih),yl.push(Cr+(ul-Cr)*ch),yl.push(1),ch}function Ep(yl,gs,Cr,fs,ul,ih){var ch=(ih-Cr)/(ul-Cr);return yl.push(gs+(fs-gs)*ch),yl.push(ih),yl.push(1),ch}function Vp(yl,gs){for(var Cr=[],fs=0;fs<yl.length;fs++){var ul,ih=yl[fs],ch=ih.type;if(ch==="Point"||ch==="MultiPoint"||ch==="LineString")ul=bd(ih.geometry,gs);else if(ch==="MultiLineString"||ch==="Polygon"){ul=[];for(var vh=0;vh<ih.geometry.length;vh++)ul.push(bd(ih.geometry[vh],gs))}else if(ch==="MultiPolygon")for(ul=[],vh=0;vh<ih.geometry.length;vh++){for(var Th=[],Nh=0;Nh<ih.geometry[vh].length;Nh++)Th.push(bd(ih.geometry[vh][Nh],gs));ul.push(Th)}Cr.push(Yh(ih.id,ch,ul,ih.tags))}return Cr}function bd(yl,gs){var Cr=[];Cr.size=yl.size,yl.start!==void 0&&(Cr.start=yl.start,Cr.end=yl.end);for(var fs=0;fs<yl.length;fs+=3)Cr.push(yl[fs]+gs,yl[fs+1],yl[fs+2]);return Cr}function Yd(yl,gs){if(yl.transformed)return yl;var Cr,fs,ul,ih=1<<yl.z,ch=yl.x,vh=yl.y;for(Cr=0;Cr<yl.features.length;Cr++){var Th=yl.features[Cr],Nh=Th.geometry,Qh=Th.type;if(Th.geometry=[],Qh===1)for(fs=0;fs<Nh.length;fs+=2)Th.geometry.push(np(Nh[fs],Nh[fs+1],gs,ih,ch,vh));else for(fs=0;fs<Nh.length;fs++){var rd=[];for(ul=0;ul<Nh[fs].length;ul+=2)rd.push(np(Nh[fs][ul],Nh[fs][ul+1],gs,ih,ch,vh));Th.geometry.push(rd)}}return yl.transformed=!0,yl}function np(yl,gs,Cr,fs,ul,ih){return[Math.round(Cr*(yl*fs-ul)),Math.round(Cr*(gs*fs-ih))]}function Up(yl,gs,Cr,fs,ul){for(var ih=gs===ul.maxZoom?0:ul.tolerance/((1<<gs)*ul.extent),ch={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Cr,y:fs,z:gs,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},vh=0;vh<yl.length;vh++){ch.numFeatures++,Qp(ch,yl[vh],ih,ul);var Th=yl[vh].minX,Nh=yl[vh].minY,Qh=yl[vh].maxX,rd=yl[vh].maxY;Th<ch.minX&&(ch.minX=Th),Nh<ch.minY&&(ch.minY=Nh),Qh>ch.maxX&&(ch.maxX=Qh),rd>ch.maxY&&(ch.maxY=rd)}return ch}function Qp(yl,gs,Cr,fs){var ul=gs.geometry,ih=gs.type,ch=[];if(ih==="Point"||ih==="MultiPoint")for(var vh=0;vh<ul.length;vh+=3)ch.push(ul[vh]),ch.push(ul[vh+1]),yl.numPoints++,yl.numSimplified++;else if(ih==="LineString")Rp(ch,ul,yl,Cr,!1,!1);else if(ih==="MultiLineString"||ih==="Polygon")for(vh=0;vh<ul.length;vh++)Rp(ch,ul[vh],yl,Cr,ih==="Polygon",vh===0);else if(ih==="MultiPolygon")for(var Th=0;Th<ul.length;Th++){var Nh=ul[Th];for(vh=0;vh<Nh.length;vh++)Rp(ch,Nh[vh],yl,Cr,!0,vh===0)}if(ch.length){var Qh=gs.tags||null;if(ih==="LineString"&&fs.lineMetrics){for(var rd in Qh={},gs.tags)Qh[rd]=gs.tags[rd];Qh.mapbox_clip_start=ul.start/ul.size,Qh.mapbox_clip_end=ul.end/ul.size}var _d={geometry:ch,type:ih==="Polygon"||ih==="MultiPolygon"?3:ih==="LineString"||ih==="MultiLineString"?2:1,tags:Qh};gs.id!==null&&(_d.id=gs.id),yl.features.push(_d)}}function Rp(yl,gs,Cr,fs,ul,ih){var ch=fs*fs;if(fs>0&&gs.size<(ul?ch:fs))Cr.numPoints+=gs.length/3;else{for(var vh=[],Th=0;Th<gs.length;Th+=3)(fs===0||gs[Th+2]>ch)&&(Cr.numSimplified++,vh.push(gs[Th]),vh.push(gs[Th+1])),Cr.numPoints++;ul&&function(Nh,Qh){for(var rd=0,_d=0,ip=Nh.length,Dp=ip-2;_d<ip;Dp=_d,_d+=2)rd+=(Nh[_d]-Nh[Dp])*(Nh[_d+1]+Nh[Dp+1]);if(rd>0===Qh)for(_d=0,ip=Nh.length;_d<ip/2;_d+=2){var qd=Nh[_d],wp=Nh[_d+1];Nh[_d]=Nh[ip-2-_d],Nh[_d+1]=Nh[ip-1-_d],Nh[ip-2-_d]=qd,Nh[ip-1-_d]=wp}}(vh,ih),yl.push(vh)}}function ng(yl,gs){var Cr=(gs=this.options=function(ul,ih){for(var ch in ih)ul[ch]=ih[ch];return ul}(Object.create(this.options),gs)).debug;if(Cr&&console.time("preprocess data"),gs.maxZoom<0||gs.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(gs.promoteId&&gs.generateId)throw new Error("promoteId and generateId cannot be used together.");var fs=function(ul,ih){var ch=[];if(ul.type==="FeatureCollection")for(var vh=0;vh<ul.features.length;vh++)kp(ch,ul.features[vh],ih,vh);else kp(ch,ul.type==="Feature"?ul:{geometry:ul},ih);return ch}(yl,gs);this.tiles={},this.tileCoords=[],Cr&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",gs.indexMaxZoom,gs.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),fs=function(ul,ih){var ch=ih.buffer/ih.extent,vh=ul,Th=_p(ul,1,-1-ch,ch,0,-1,2,ih),Nh=_p(ul,1,1-ch,2+ch,0,-1,2,ih);return(Th||Nh)&&(vh=_p(ul,1,-ch,1+ch,0,-1,2,ih)||[],Th&&(vh=Vp(Th,1).concat(vh)),Nh&&(vh=vh.concat(Vp(Nh,-1)))),vh}(fs,gs),fs.length&&this.splitTile(fs,0,0,0),Cr&&(fs.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function bg(yl,gs,Cr){return 32*((1<<yl)*Cr+gs)+yl}function Ih(yl,gs){return gs?yl.properties[gs]:yl.id}function rh(yl,gs){if(yl==null)return!0;if(yl.type==="Feature")return Ih(yl,gs)!=null;if(yl.type==="FeatureCollection"){const Cr=new Set;for(const fs of yl.features){const ul=Ih(fs,gs);if(ul==null||Cr.has(ul))return!1;Cr.add(ul)}return!0}return!1}function sh(yl,gs){const Cr=new Map;if(yl!=null)if(yl.type==="Feature")Cr.set(Ih(yl,gs),yl);else for(const fs of yl.features)Cr.set(Ih(fs,gs),fs);return Cr}function oh(yl,gs){const Cr=yl.tileID.canonical;if(!this._geoJSONIndex)return gs(null,null);const fs=this._geoJSONIndex.getTile(Cr.z,Cr.x,Cr.y);if(!fs)return gs(null,null);const ul=new class{constructor(ch){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=ch.length,this._features=ch}feature(ch){return new class{constructor(vh){this._feature=vh,this.extent=s.EXTENT,this.type=vh.type,this.properties=vh.tags,"id"in vh&&!isNaN(vh.id)&&(this.id=parseInt(vh.id,10))}loadGeometry(){if(this._feature.type===1){const vh=[];for(const Th of this._feature.geometry)vh.push([new s.Point(Th[0],Th[1])]);return vh}{const vh=[];for(const Th of this._feature.geometry){const Nh=[];for(const Qh of Th)Nh.push(new s.Point(Qh[0],Qh[1]));vh.push(Nh)}return vh}}toGeoJSON(vh,Th,Nh){return Vn.call(this,vh,Th,Nh)}}(this._features[ch])}}(fs.features);let ih=Fd(ul);ih.byteOffset===0&&ih.byteLength===ih.buffer.byteLength||(ih=new Uint8Array(ih)),gs(null,{vectorTile:ul,rawData:ih.buffer})}ng.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ng.prototype.splitTile=function(yl,gs,Cr,fs,ul,ih,ch){for(var vh=[yl,gs,Cr,fs],Th=this.options,Nh=Th.debug;vh.length;){fs=vh.pop(),Cr=vh.pop(),gs=vh.pop(),yl=vh.pop();var Qh=1<<gs,rd=bg(gs,Cr,fs),_d=this.tiles[rd];if(!_d&&(Nh>1&&console.time("creation"),_d=this.tiles[rd]=Up(yl,gs,Cr,fs,Th),this.tileCoords.push({z:gs,x:Cr,y:fs}),Nh)){Nh>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",gs,Cr,fs,_d.numFeatures,_d.numPoints,_d.numSimplified),console.timeEnd("creation"));var ip="z"+gs;this.stats[ip]=(this.stats[ip]||0)+1,this.total++}if(_d.source=yl,ul){if(gs===Th.maxZoom||gs===ul)continue;var Dp=1<<ul-gs;if(Cr!==Math.floor(ih/Dp)||fs!==Math.floor(ch/Dp))continue}else if(gs===Th.indexMaxZoom||_d.numPoints<=Th.indexMaxPoints)continue;if(_d.source=null,yl.length!==0){Nh>1&&console.time("clipping");var qd,wp,pp,Wp,Vf,Wf,dg=.5*Th.buffer/Th.extent,Jp=.5-dg,Yp=.5+dg,Cg=1+dg;qd=wp=pp=Wp=null,Vf=_p(yl,Qh,Cr-dg,Cr+Yp,0,_d.minX,_d.maxX,Th),Wf=_p(yl,Qh,Cr+Jp,Cr+Cg,0,_d.minX,_d.maxX,Th),yl=null,Vf&&(qd=_p(Vf,Qh,fs-dg,fs+Yp,1,_d.minY,_d.maxY,Th),wp=_p(Vf,Qh,fs+Jp,fs+Cg,1,_d.minY,_d.maxY,Th),Vf=null),Wf&&(pp=_p(Wf,Qh,fs-dg,fs+Yp,1,_d.minY,_d.maxY,Th),Wp=_p(Wf,Qh,fs+Jp,fs+Cg,1,_d.minY,_d.maxY,Th),Wf=null),Nh>1&&console.timeEnd("clipping"),vh.push(qd||[],gs+1,2*Cr,2*fs),vh.push(wp||[],gs+1,2*Cr,2*fs+1),vh.push(pp||[],gs+1,2*Cr+1,2*fs),vh.push(Wp||[],gs+1,2*Cr+1,2*fs+1)}}},ng.prototype.getTile=function(yl,gs,Cr){var fs=this.options,ul=fs.extent,ih=fs.debug;if(yl<0||yl>24)return null;var ch=1<<yl,vh=bg(yl,gs=(gs%ch+ch)%ch,Cr);if(this.tiles[vh])return Yd(this.tiles[vh],ul);ih>1&&console.log("drilling down to z%d-%d-%d",yl,gs,Cr);for(var Th,Nh=yl,Qh=gs,rd=Cr;!Th&&Nh>0;)Nh--,Qh=Math.floor(Qh/2),rd=Math.floor(rd/2),Th=this.tiles[bg(Nh,Qh,rd)];return Th&&Th.source?(ih>1&&console.log("found parent tile z%d-%d-%d",Nh,Qh,rd),ih>1&&console.time("drilling down"),this.splitTile(Th.source,Nh,Qh,rd,yl,gs,Cr),ih>1&&console.timeEnd("drilling down"),this.tiles[vh]?Yd(this.tiles[vh],ul):null):null};class Dh extends dt{constructor(gs,Cr,fs,ul){super(gs,Cr,fs,oh),this._dataUpdateable=new Map,this.loadGeoJSON=(ih,ch)=>{const{promoteId:vh}=ih;if(ih.request)return s.getJSON(ih.request,(Th,Nh,Qh,rd)=>{this._dataUpdateable=rh(Nh,vh)?sh(Nh,vh):void 0,ch(Th,Nh,Qh,rd)});if(typeof ih.data=="string")try{const Th=JSON.parse(ih.data);this._dataUpdateable=rh(Th,vh)?sh(Th,vh):void 0,ch(null,Th)}catch{ch(new Error(`Input data given to '${ih.source}' is not a valid GeoJSON object.`))}else ih.dataDiff?this._dataUpdateable?(function(Th,Nh,Qh){var rd,_d,ip,Dp;if(Nh.removeAll&&Th.clear(),Nh.remove)for(const qd of Nh.remove)Th.delete(qd);if(Nh.add)for(const qd of Nh.add){const wp=Ih(qd,Qh);wp!=null&&Th.set(wp,qd)}if(Nh.update)for(const qd of Nh.update){let wp=Th.get(qd.id);if(wp==null)continue;const pp=!qd.removeAllProperties&&(((rd=qd.removeProperties)===null||rd===void 0?void 0:rd.length)>0||((_d=qd.addOrUpdateProperties)===null||_d===void 0?void 0:_d.length)>0);if((qd.newGeometry||qd.removeAllProperties||pp)&&(wp={...wp},Th.set(qd.id,wp),pp&&(wp.properties={...wp.properties})),qd.newGeometry&&(wp.geometry=qd.newGeometry),qd.removeAllProperties)wp.properties={};else if(((ip=qd.removeProperties)===null||ip===void 0?void 0:ip.length)>0)for(const Wp of qd.removeProperties)Object.prototype.hasOwnProperty.call(wp.properties,Wp)&&delete wp.properties[Wp];if(((Dp=qd.addOrUpdateProperties)===null||Dp===void 0?void 0:Dp.length)>0)for(const{key:Wp,value:Vf}of qd.addOrUpdateProperties)wp.properties[Wp]=Vf}}(this._dataUpdateable,ih.dataDiff,vh),ch(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):ch(new Error(`Cannot update existing geojson data in ${ih.source}`)):ch(new Error(`Input data given to '${ih.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},ul&&(this.loadGeoJSON=ul)}loadData(gs,Cr){var fs;(fs=this._pendingRequest)===null||fs===void 0||fs.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const ul=!!(gs&&gs.request&&gs.request.collectResourceTiming)&&new s.RequestPerformance(gs.request);this._pendingCallback=Cr,this._pendingRequest=this.loadGeoJSON(gs,(ih,ch)=>{if(delete this._pendingCallback,delete this._pendingRequest,ih||!ch)return Cr(ih);if(typeof ch!="object")return Cr(new Error(`Input data given to '${gs.source}' is not a valid GeoJSON object.`));{Bn(ch,!0);try{if(gs.filter){const Th=s.createExpression(gs.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Th.result==="error")throw new Error(Th.value.map(Qh=>`${Qh.key}: ${Qh.message}`).join(", "));ch={type:"FeatureCollection",features:ch.features.filter(Qh=>Th.value.evaluate({zoom:0},Qh))}}this._geoJSONIndex=gs.cluster?new op(function({superclusterOptions:Th,clusterProperties:Nh}){if(!Nh||!Th)return Th;const Qh={},rd={},_d={accumulated:null,zoom:0},ip={properties:null},Dp=Object.keys(Nh);for(const qd of Dp){const[wp,pp]=Nh[qd],Wp=s.createExpression(pp),Vf=s.createExpression(typeof wp=="string"?[wp,["accumulated"],["get",qd]]:wp);Qh[qd]=Wp.value,rd[qd]=Vf.value}return Th.map=qd=>{ip.properties=qd;const wp={};for(const pp of Dp)wp[pp]=Qh[pp].evaluate(_d,ip);return wp},Th.reduce=(qd,wp)=>{ip.properties=wp;for(const pp of Dp)_d.accumulated=qd[pp],qd[pp]=rd[pp].evaluate(_d,ip)},Th}(gs)).load(ch.features):function(Th,Nh){return new ng(Th,Nh)}(ch,gs.geojsonVtOptions)}catch(Th){return Cr(Th)}this.loaded={};const vh={};if(ul){const Th=ul.finish();Th&&(vh.resourceTiming={},vh.resourceTiming[gs.source]=JSON.parse(JSON.stringify(Th)))}Cr(null,vh)}})}reloadTile(gs,Cr){const fs=this.loaded;return fs&&fs[gs.uid]?super.reloadTile(gs,Cr):this.loadTile(gs,Cr)}removeSource(gs,Cr){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),Cr()}getClusterExpansionZoom(gs,Cr){try{Cr(null,this._geoJSONIndex.getClusterExpansionZoom(gs.clusterId))}catch(fs){Cr(fs)}}getClusterChildren(gs,Cr){try{Cr(null,this._geoJSONIndex.getChildren(gs.clusterId))}catch(fs){Cr(fs)}}getClusterLeaves(gs,Cr){try{Cr(null,this._geoJSONIndex.getLeaves(gs.clusterId,gs.limit,gs.offset))}catch(fs){Cr(fs)}}}class $h{constructor(gs){this.self=gs,this.actor=new s.Actor(gs,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:dt,geojson:Dh},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Cr,fs)=>{if(this.workerSourceTypes[Cr])throw new Error(`Worker source with name "${Cr}" already registered.`);this.workerSourceTypes[Cr]=fs},this.self.registerRTLTextPlugin=Cr=>{if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=Cr.applyArabicShaping,s.plugin.processBidirectionalText=Cr.processBidirectionalText,s.plugin.processStyledBidirectionalText=Cr.processStyledBidirectionalText}}setReferrer(gs,Cr){this.referrer=Cr}setImages(gs,Cr,fs){this.availableImages[gs]=Cr;for(const ul in this.workerSources[gs]){const ih=this.workerSources[gs][ul];for(const ch in ih)ih[ch].availableImages=Cr}fs()}setLayers(gs,Cr,fs){this.getLayerIndex(gs).replace(Cr),fs()}updateLayers(gs,Cr,fs){this.getLayerIndex(gs).update(Cr.layers,Cr.removedIds),fs()}loadTile(gs,Cr,fs){this.getWorkerSource(gs,Cr.type,Cr.source).loadTile(Cr,fs)}loadDEMTile(gs,Cr,fs){this.getDEMWorkerSource(gs,Cr.source).loadTile(Cr,fs)}reloadTile(gs,Cr,fs){this.getWorkerSource(gs,Cr.type,Cr.source).reloadTile(Cr,fs)}abortTile(gs,Cr,fs){this.getWorkerSource(gs,Cr.type,Cr.source).abortTile(Cr,fs)}removeTile(gs,Cr,fs){this.getWorkerSource(gs,Cr.type,Cr.source).removeTile(Cr,fs)}removeDEMTile(gs,Cr){this.getDEMWorkerSource(gs,Cr.source).removeTile(Cr)}removeSource(gs,Cr,fs){if(!this.workerSources[gs]||!this.workerSources[gs][Cr.type]||!this.workerSources[gs][Cr.type][Cr.source])return;const ul=this.workerSources[gs][Cr.type][Cr.source];delete this.workerSources[gs][Cr.type][Cr.source],ul.removeSource!==void 0?ul.removeSource(Cr,fs):fs()}loadWorkerSource(gs,Cr,fs){try{this.self.importScripts(Cr.url),fs()}catch(ul){fs(ul.toString())}}syncRTLPluginState(gs,Cr,fs){try{s.plugin.setState(Cr);const ul=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&ul!=null){this.self.importScripts(ul);const ih=s.plugin.isParsed();fs(ih?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ul}`),ih)}}catch(ul){fs(ul.toString())}}getAvailableImages(gs){let Cr=this.availableImages[gs];return Cr||(Cr=[]),Cr}getLayerIndex(gs){let Cr=this.layerIndexes[gs];return Cr||(Cr=this.layerIndexes[gs]=new m),Cr}getWorkerSource(gs,Cr,fs){if(this.workerSources[gs]||(this.workerSources[gs]={}),this.workerSources[gs][Cr]||(this.workerSources[gs][Cr]={}),!this.workerSources[gs][Cr][fs]){const ul={send:(ih,ch,vh)=>{this.actor.send(ih,ch,vh,gs)}};this.workerSources[gs][Cr][fs]=new this.workerSourceTypes[Cr](ul,this.getLayerIndex(gs),this.getAvailableImages(gs))}return this.workerSources[gs][Cr][fs]}getDEMWorkerSource(gs,Cr){return this.demWorkerSources[gs]||(this.demWorkerSources[gs]={}),this.demWorkerSources[gs][Cr]||(this.demWorkerSources[gs][Cr]=new Ht),this.demWorkerSources[gs][Cr]}}return s.isWorker()&&(self.worker=new $h(self)),$h}),a(["./shared"],function(s){var m="3.1.0";class y{static testProp(g){if(!y.docStyle)return g[0];for(let A=0;A<g.length;A++)if(g[A]in y.docStyle)return g[A];return g[0]}static create(g,A,_e){const ct=window.document.createElement(g);return A!==void 0&&(ct.className=A),_e&&_e.appendChild(ct),ct}static createNS(g,A){return window.document.createElementNS(g,A)}static disableDrag(){y.docStyle&&y.selectProp&&(y.userSelect=y.docStyle[y.selectProp],y.docStyle[y.selectProp]="none")}static enableDrag(){y.docStyle&&y.selectProp&&(y.docStyle[y.selectProp]=y.userSelect)}static setTransform(g,A){g.style[y.transformProp]=A}static addEventListener(g,A,_e,ct={}){g.addEventListener(A,_e,"passive"in ct?ct:ct.capture)}static removeEventListener(g,A,_e,ct={}){g.removeEventListener(A,_e,"passive"in ct?ct:ct.capture)}static suppressClickInternal(g){g.preventDefault(),g.stopPropagation(),window.removeEventListener("click",y.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",y.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",y.suppressClickInternal,!0)},0)}static mousePos(g,A){const _e=g.getBoundingClientRect();return new s.Point(A.clientX-_e.left-g.clientLeft,A.clientY-_e.top-g.clientTop)}static touchPos(g,A){const _e=g.getBoundingClientRect(),ct=[];for(let pi=0;pi<A.length;pi++)ct.push(new s.Point(A[pi].clientX-_e.left-g.clientLeft,A[pi].clientY-_e.top-g.clientTop));return ct}static mouseButton(g){return g.button}static remove(g){g.parentNode&&g.parentNode.removeChild(g)}}y.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,y.selectProp=y.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),y.transformProp=y.testProp(["transform","WebkitTransform"]);const D={supported:!1,testSupport:function(Ve){!dt&&Ee&&(Ht?ir(Ve):W=Ve)}};let W,Ee,dt=!1,Ht=!1;function ir(Ve){const g=Ve.createTexture();Ve.bindTexture(Ve.TEXTURE_2D,g);try{if(Ve.texImage2D(Ve.TEXTURE_2D,0,Ve.RGBA,Ve.RGBA,Ve.UNSIGNED_BYTE,Ee),Ve.isContextLost())return;D.supported=!0}catch{}Ve.deleteTexture(g),dt=!0}var Hr;typeof document<"u"&&(Ee=document.createElement("img"),Ee.onload=function(){W&&ir(W),W=null,Ht=!0},Ee.onerror=function(){dt=!0,W=null},Ee.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(Ve){let g,A,_e,ct;Ve.resetRequestQueue=()=>{g=[],A=0,_e=0,ct={}},Ve.addThrottleControl=vs=>{const fl=_e++;return ct[fl]=vs,fl},Ve.removeThrottleControl=vs=>{delete ct[vs],ds()},Ve.getImage=(vs,fl,dl=!0)=>{D.supported&&(vs.headers||(vs.headers={}),vs.headers.accept="image/webp,*/*");const dh={requestParameters:vs,supportImageRefresh:dl,callback:fl,cancelled:!1,completed:!1,cancel:()=>{dh.completed||dh.cancelled||(dh.cancelled=!0,dh.innerRequest&&(dh.innerRequest.cancel(),A--),ds())}};return g.push(dh),ds(),dh};const pi=vs=>{const{requestParameters:fl,supportImageRefresh:dl,callback:dh}=vs;return s.extend(fl,{type:"image"}),(dl!==!1||s.isWorker()||s.getProtocolAction(fl.url)||fl.headers&&!Object.keys(fl.headers).reduce((Ah,hh)=>Ah&&hh==="accept",!0)?s.makeRequest:hs)(fl,(Ah,hh,Rh,zh)=>{In(vs,dh,Ah,hh,Rh,zh)})},In=(vs,fl,dl,dh,Ah,hh)=>{dl?fl(dl):dh instanceof HTMLImageElement||dh instanceof ImageBitmap?fl(null,dh):dh&&((Rh,zh)=>{typeof createImageBitmap=="function"?s.arrayBufferToImageBitmap(Rh,zh):s.arrayBufferToImage(Rh,zh)})(dh,(Rh,zh)=>{Rh!=null?fl(Rh):zh!=null&&fl(null,zh,{cacheControl:Ah,expires:hh})}),vs.cancelled||(vs.completed=!0,A--,ds())},ds=()=>{const vs=(()=>{const fl=Object.keys(ct);let dl=!1;if(fl.length>0){for(const dh of fl)if(dl=ct[dh](),dl)break}return dl})()?s.config.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.config.MAX_PARALLEL_IMAGE_REQUESTS;for(let fl=A;fl<vs&&g.length>0;fl++){const dl=g.shift();if(dl.cancelled){fl--;continue}const dh=pi(dl);A++,dl.innerRequest=dh}},hs=(vs,fl)=>{const dl=new Image,dh=vs.url;let Ah=!1;const hh=vs.credentials;return hh&&hh==="include"?dl.crossOrigin="use-credentials":(hh&&hh==="same-origin"||!s.sameOrigin(dh))&&(dl.crossOrigin="anonymous"),dl.fetchPriority="high",dl.onload=()=>{fl(null,dl),dl.onerror=dl.onload=null},dl.onerror=()=>{Ah||fl(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),dl.onerror=dl.onload=null},dl.src=dh,{cancel:()=>{Ah=!0,dl.src=""}}}}(Hr||(Hr={})),Hr.resetRequestQueue();var Bn,Vn=Hr;(function(Ve){Ve.Glyphs="Glyphs",Ve.Image="Image",Ve.Source="Source",Ve.SpriteImage="SpriteImage",Ve.SpriteJSON="SpriteJSON",Ve.Style="Style",Ve.Tile="Tile",Ve.Unknown="Unknown"})(Bn||(Bn={}));class Wr{constructor(g){this._transformRequestFn=g}transformRequest(g,A){return this._transformRequestFn&&this._transformRequestFn(g,A)||{url:g}}normalizeSpriteURL(g,A,_e){const ct=function(pi){const In=pi.match(ps);if(!In)throw new Error(`Unable to parse URL "${pi}"`);return{protocol:In[1],authority:In[2],path:In[3]||"/",params:In[4]?In[4].split("&"):[]}}(g);return ct.path+=`${A}${_e}`,function(pi){const In=pi.params.length?`?${pi.params.join("&")}`:"";return`${pi.protocol}://${pi.authority}${pi.path}${In}`}(ct)}setTransformRequest(g){this._transformRequestFn=g}}const ps=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function il(Ve){var g=new s.ARRAY_TYPE(3);return g[0]=Ve[0],g[1]=Ve[1],g[2]=Ve[2],g}var gl,ml=function(Ve,g,A){return Ve[0]=g[0]-A[0],Ve[1]=g[1]-A[1],Ve[2]=g[2]-A[2],Ve};gl=new s.ARRAY_TYPE(3),s.ARRAY_TYPE!=Float32Array&&(gl[0]=0,gl[1]=0,gl[2]=0);var sl=function(Ve){var g=Ve[0],A=Ve[1];return g*g+A*A};function ll(Ve){const g=[];if(typeof Ve=="string")g.push({id:"default",url:Ve});else if(Ve&&Ve.length>0){const A=[];for(const{id:_e,url:ct}of Ve){const pi=`${_e}${ct}`;A.indexOf(pi)===-1&&(A.push(pi),g.push({id:_e,url:ct}))}}return g}function rl(Ve,g,A,_e,ct){if(_e)return void Ve(_e);if(ct!==Object.values(g).length||ct!==Object.values(A).length)return;const pi={};for(const In in g){pi[In]={};const ds=s.exported.getImageCanvasContext(A[In]),hs=g[In];for(const vs in hs){const{width:fl,height:dl,x:dh,y:Ah,sdf:hh,pixelRatio:Rh,stretchX:zh,stretchY:Kh,content:ad}=hs[vs];pi[In][vs]={data:null,pixelRatio:Rh,sdf:hh,stretchX:zh,stretchY:Kh,content:ad,spriteData:{width:fl,height:dl,x:dh,y:Ah,context:ds}}}}Ve(null,pi)}(function(){var Ve=new s.ARRAY_TYPE(2);s.ARRAY_TYPE!=Float32Array&&(Ve[0]=0,Ve[1]=0)})();class th{constructor(g,A,_e,ct){this.context=g,this.format=_e,this.texture=g.gl.createTexture(),this.update(A,ct)}update(g,A,_e){const{width:ct,height:pi}=g,In=!(this.size&&this.size[0]===ct&&this.size[1]===pi||_e),{context:ds}=this,{gl:hs}=ds;if(this.useMipmap=!!(A&&A.useMipmap),hs.bindTexture(hs.TEXTURE_2D,this.texture),ds.pixelStoreUnpackFlipY.set(!1),ds.pixelStoreUnpack.set(1),ds.pixelStoreUnpackPremultiplyAlpha.set(this.format===hs.RGBA&&(!A||A.premultiply!==!1)),In)this.size=[ct,pi],g instanceof HTMLImageElement||g instanceof HTMLCanvasElement||g instanceof HTMLVideoElement||g instanceof ImageData||s.isImageBitmap(g)?hs.texImage2D(hs.TEXTURE_2D,0,this.format,this.format,hs.UNSIGNED_BYTE,g):hs.texImage2D(hs.TEXTURE_2D,0,this.format,ct,pi,0,this.format,hs.UNSIGNED_BYTE,g.data);else{const{x:vs,y:fl}=_e||{x:0,y:0};g instanceof HTMLImageElement||g instanceof HTMLCanvasElement||g instanceof HTMLVideoElement||g instanceof ImageData||s.isImageBitmap(g)?hs.texSubImage2D(hs.TEXTURE_2D,0,vs,fl,hs.RGBA,hs.UNSIGNED_BYTE,g):hs.texSubImage2D(hs.TEXTURE_2D,0,vs,fl,ct,pi,hs.RGBA,hs.UNSIGNED_BYTE,g.data)}this.useMipmap&&this.isSizePowerOfTwo()&&hs.generateMipmap(hs.TEXTURE_2D)}bind(g,A,_e){const{context:ct}=this,{gl:pi}=ct;pi.bindTexture(pi.TEXTURE_2D,this.texture),_e!==pi.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(_e=pi.LINEAR),g!==this.filter&&(pi.texParameteri(pi.TEXTURE_2D,pi.TEXTURE_MAG_FILTER,g),pi.texParameteri(pi.TEXTURE_2D,pi.TEXTURE_MIN_FILTER,_e||g),this.filter=g),A!==this.wrap&&(pi.texParameteri(pi.TEXTURE_2D,pi.TEXTURE_WRAP_S,A),pi.texParameteri(pi.TEXTURE_2D,pi.TEXTURE_WRAP_T,A),this.wrap=A)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:g}=this.context;g.deleteTexture(this.texture),this.texture=null}}function nh(Ve){const{userImage:g}=Ve;return!!(g&&g.render&&g.render())&&(Ve.data.replace(new Uint8Array(g.data.buffer)),!0)}class bh extends s.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(g){if(this.loaded!==g&&(this.loaded=g,g)){for(const{ids:A,callback:_e}of this.requestors)this._notify(A,_e);this.requestors=[]}}getImage(g){const A=this.images[g];if(A&&!A.data&&A.spriteData){const _e=A.spriteData;A.data=new s.RGBAImage({width:_e.width,height:_e.height},_e.context.getImageData(_e.x,_e.y,_e.width,_e.height).data),A.spriteData=null}return A}addImage(g,A){if(this.images[g])throw new Error(`Image id ${g} already exist, use updateImage instead`);this._validate(g,A)&&(this.images[g]=A)}_validate(g,A){let _e=!0;const ct=A.data||A.spriteData;return this._validateStretch(A.stretchX,ct&&ct.width)||(this.fire(new s.ErrorEvent(new Error(`Image "${g}" has invalid "stretchX" value`))),_e=!1),this._validateStretch(A.stretchY,ct&&ct.height)||(this.fire(new s.ErrorEvent(new Error(`Image "${g}" has invalid "stretchY" value`))),_e=!1),this._validateContent(A.content,A)||(this.fire(new s.ErrorEvent(new Error(`Image "${g}" has invalid "content" value`))),_e=!1),_e}_validateStretch(g,A){if(!g)return!0;let _e=0;for(const ct of g){if(ct[0]<_e||ct[1]<ct[0]||A<ct[1])return!1;_e=ct[1]}return!0}_validateContent(g,A){if(!g)return!0;if(g.length!==4)return!1;const _e=A.spriteData,ct=_e&&_e.width||A.data.width,pi=_e&&_e.height||A.data.height;return!(g[0]<0||ct<g[0]||g[1]<0||pi<g[1]||g[2]<0||ct<g[2]||g[3]<0||pi<g[3]||g[2]<g[0]||g[3]<g[1])}updateImage(g,A,_e=!0){const ct=this.getImage(g);if(_e&&(ct.data.width!==A.data.width||ct.data.height!==A.data.height))throw new Error(`size mismatch between old image (${ct.data.width}x${ct.data.height}) and new image (${A.data.width}x${A.data.height}).`);A.version=ct.version+1,this.images[g]=A,this.updatedImages[g]=!0}removeImage(g){const A=this.images[g];delete this.images[g],delete this.patterns[g],A.userImage&&A.userImage.onRemove&&A.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(g,A){let _e=!0;if(!this.isLoaded())for(const ct of g)this.images[ct]||(_e=!1);this.isLoaded()||_e?this._notify(g,A):this.requestors.push({ids:g,callback:A})}_notify(g,A){const _e={};for(const ct of g){let pi=this.getImage(ct);pi||(this.fire(new s.Event("styleimagemissing",{id:ct})),pi=this.getImage(ct)),pi?_e[ct]={data:pi.data.clone(),pixelRatio:pi.pixelRatio,sdf:pi.sdf,version:pi.version,stretchX:pi.stretchX,stretchY:pi.stretchY,content:pi.content,hasRenderCallback:!!(pi.userImage&&pi.userImage.render)}:s.warnOnce(`Image "${ct}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}A(null,_e)}getPixelSize(){const{width:g,height:A}=this.atlasImage;return{width:g,height:A}}getPattern(g){const A=this.patterns[g],_e=this.getImage(g);if(!_e)return null;if(A&&A.position.version===_e.version)return A.position;if(A)A.position.version=_e.version;else{const ct={w:_e.data.width+2,h:_e.data.height+2,x:0,y:0},pi=new s.ImagePosition(ct,_e);this.patterns[g]={bin:ct,position:pi}}return this._updatePatternAtlas(),this.patterns[g].position}bind(g){const A=g.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new th(g,this.atlasImage,A.RGBA),this.atlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE)}_updatePatternAtlas(){const g=[];for(const pi in this.patterns)g.push(this.patterns[pi].bin);const{w:A,h:_e}=s.potpack(g),ct=this.atlasImage;ct.resize({width:A||1,height:_e||1});for(const pi in this.patterns){const{bin:In}=this.patterns[pi],ds=In.x+1,hs=In.y+1,vs=this.getImage(pi).data,fl=vs.width,dl=vs.height;s.RGBAImage.copy(vs,ct,{x:0,y:0},{x:ds,y:hs},{width:fl,height:dl}),s.RGBAImage.copy(vs,ct,{x:0,y:dl-1},{x:ds,y:hs-1},{width:fl,height:1}),s.RGBAImage.copy(vs,ct,{x:0,y:0},{x:ds,y:hs+dl},{width:fl,height:1}),s.RGBAImage.copy(vs,ct,{x:fl-1,y:0},{x:ds-1,y:hs},{width:1,height:dl}),s.RGBAImage.copy(vs,ct,{x:0,y:0},{x:ds+fl,y:hs},{width:1,height:dl})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(g){for(const A of g){if(this.callbackDispatchedThisFrame[A])continue;this.callbackDispatchedThisFrame[A]=!0;const _e=this.getImage(A);_e||s.warnOnce(`Image with ID: "${A}" was not found`),nh(_e)&&this.updateImage(A,_e)}}}const Fh=1e20;function Bh(Ve,g,A,_e,ct,pi,In,ds,hs){for(let vs=g;vs<g+_e;vs++)Ed(Ve,A*pi+vs,pi,ct,In,ds,hs);for(let vs=A;vs<A+ct;vs++)Ed(Ve,vs*pi+g,1,_e,In,ds,hs)}function Ed(Ve,g,A,_e,ct,pi,In){pi[0]=0,In[0]=-Fh,In[1]=Fh,ct[0]=Ve[g];for(let ds=1,hs=0,vs=0;ds<_e;ds++){ct[ds]=Ve[g+ds*A];const fl=ds*ds;do{const dl=pi[hs];vs=(ct[ds]-ct[dl]+fl-dl*dl)/(ds-dl)/2}while(vs<=In[hs]&&--hs>-1);hs++,pi[hs]=ds,In[hs]=vs,In[hs+1]=Fh}for(let ds=0,hs=0;ds<_e;ds++){for(;In[hs+1]<ds;)hs++;const vs=pi[hs],fl=ds-vs;Ve[g+ds*A]=ct[vs]+fl*fl}}class Td{constructor(g,A){this.requestManager=g,this.localIdeographFontFamily=A,this.entries={}}setURL(g){this.url=g}getGlyphs(g,A){const _e=[];for(const ct in g)for(const pi of g[ct])_e.push({stack:ct,id:pi});s.asyncAll(_e,({stack:ct,id:pi},In)=>{let ds=this.entries[ct];ds||(ds=this.entries[ct]={glyphs:{},requests:{},ranges:{}});let hs=ds.glyphs[pi];if(hs!==void 0)return void In(null,{stack:ct,id:pi,glyph:hs});if(hs=this._tinySDF(ds,ct,pi),hs)return ds.glyphs[pi]=hs,void In(null,{stack:ct,id:pi,glyph:hs});const vs=Math.floor(pi/256);if(256*vs>65535)return void In(new Error("glyphs > 65535 not supported"));if(ds.ranges[vs])return void In(null,{stack:ct,id:pi,glyph:hs});if(!this.url)return void In(new Error("glyphsUrl is not set"));let fl=ds.requests[vs];fl||(fl=ds.requests[vs]=[],Td.loadGlyphRange(ct,vs,this.url,this.requestManager,(dl,dh)=>{if(dh){for(const Ah in dh)this._doesCharSupportLocalGlyph(+Ah)||(ds.glyphs[+Ah]=dh[+Ah]);ds.ranges[vs]=!0}for(const Ah of fl)Ah(dl,dh);delete ds.requests[vs]})),fl.push((dl,dh)=>{dl?In(dl):dh&&In(null,{stack:ct,id:pi,glyph:dh[pi]||null})})},(ct,pi)=>{if(ct)A(ct);else if(pi){const In={};for(const{stack:ds,id:hs,glyph:vs}of pi)(In[ds]||(In[ds]={}))[hs]=vs&&{id:vs.id,bitmap:vs.bitmap.clone(),metrics:vs.metrics};A(null,In)}})}_doesCharSupportLocalGlyph(g){return!!this.localIdeographFontFamily&&(s.unicodeBlockLookup["CJK Unified Ideographs"](g)||s.unicodeBlockLookup["Hangul Syllables"](g)||s.unicodeBlockLookup.Hiragana(g)||s.unicodeBlockLookup.Katakana(g))}_tinySDF(g,A,_e){const ct=this.localIdeographFontFamily;if(!ct||!this._doesCharSupportLocalGlyph(_e))return;let pi=g.tinySDF;if(!pi){let ds="400";/bold/i.test(A)?ds="900":/medium/i.test(A)?ds="500":/light/i.test(A)&&(ds="200"),pi=g.tinySDF=new Td.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:ct,fontWeight:ds})}const In=pi.draw(String.fromCharCode(_e));return{id:_e,bitmap:new s.AlphaImage({width:In.width||30,height:In.height||30},In.data),metrics:{width:In.glyphWidth||24,height:In.glyphHeight||24,left:In.glyphLeft||0,top:In.glyphTop-27||-8,advance:In.glyphAdvance||24}}}}Td.loadGlyphRange=function(Ve,g,A,_e,ct){const pi=256*g,In=pi+255,ds=_e.transformRequest(A.replace("{fontstack}",Ve).replace("{range}",`${pi}-${In}`),Bn.Glyphs);s.getArrayBuffer(ds,(hs,vs)=>{if(hs)ct(hs);else if(vs){const fl={};for(const dl of s.parseGlyphPbf(vs))fl[dl.id]=dl;ct(null,fl)}})},Td.TinySDF=class{constructor({fontSize:Ve=24,buffer:g=3,radius:A=8,cutoff:_e=.25,fontFamily:ct="sans-serif",fontWeight:pi="normal",fontStyle:In="normal"}={}){this.buffer=g,this.cutoff=_e,this.radius=A;const ds=this.size=Ve+4*g,hs=this._createCanvas(ds),vs=this.ctx=hs.getContext("2d",{willReadFrequently:!0});vs.font=`${In} ${pi} ${Ve}px ${ct}`,vs.textBaseline="alphabetic",vs.textAlign="left",vs.fillStyle="black",this.gridOuter=new Float64Array(ds*ds),this.gridInner=new Float64Array(ds*ds),this.f=new Float64Array(ds),this.z=new Float64Array(ds+1),this.v=new Uint16Array(ds)}_createCanvas(Ve){const g=document.createElement("canvas");return g.width=g.height=Ve,g}draw(Ve){const{width:g,actualBoundingBoxAscent:A,actualBoundingBoxDescent:_e,actualBoundingBoxLeft:ct,actualBoundingBoxRight:pi}=this.ctx.measureText(Ve),In=Math.ceil(A),ds=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(pi-ct))),hs=Math.min(this.size-this.buffer,In+Math.ceil(_e)),vs=ds+2*this.buffer,fl=hs+2*this.buffer,dl=Math.max(vs*fl,0),dh=new Uint8ClampedArray(dl),Ah={data:dh,width:vs,height:fl,glyphWidth:ds,glyphHeight:hs,glyphTop:In,glyphLeft:0,glyphAdvance:g};if(ds===0||hs===0)return Ah;const{ctx:hh,buffer:Rh,gridInner:zh,gridOuter:Kh}=this;hh.clearRect(Rh,Rh,ds,hs),hh.fillText(Ve,Rh,Rh+In);const ad=hh.getImageData(Rh,Rh,ds,hs);Kh.fill(Fh,0,dl),zh.fill(0,0,dl);for(let Lh=0;Lh<hs;Lh++)for(let od=0;od<ds;od++){const md=ad.data[4*(Lh*ds+od)+3]/255;if(md===0)continue;const Nd=(Lh+Rh)*vs+od+Rh;if(md===1)Kh[Nd]=0,zh[Nd]=Fh;else{const Hd=.5-md;Kh[Nd]=Hd>0?Hd*Hd:0,zh[Nd]=Hd<0?Hd*Hd:0}}Bh(Kh,0,0,vs,fl,vs,this.f,this.v,this.z),Bh(zh,Rh,Rh,ds,hs,vs,this.f,this.v,this.z);for(let Lh=0;Lh<dl;Lh++){const od=Math.sqrt(Kh[Lh])-Math.sqrt(zh[Lh]);dh[Lh]=Math.round(255-255*(od/this.radius+this.cutoff))}return Ah}};class td{constructor(){this.specification=s.v8Spec.light.position}possiblyEvaluate(g,A){return s.sphericalToCartesian(g.expression.evaluate(A))}interpolate(g,A,_e){return{x:s.interpolate.number(g.x,A.x,_e),y:s.interpolate.number(g.y,A.y,_e),z:s.interpolate.number(g.z,A.z,_e)}}}let Fd,Ld;class Ud extends s.Evented{constructor(g){super(),Fd=Fd||new s.Properties({anchor:new s.DataConstantProperty(s.v8Spec.light.anchor),position:new td,color:new s.DataConstantProperty(s.v8Spec.light.color),intensity:new s.DataConstantProperty(s.v8Spec.light.intensity)}),this._transitionable=new s.Transitionable(Fd),this.setLight(g),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(g,A={}){if(!this._validate(s.validateLight,g,A))for(const _e in g){const ct=g[_e];_e.endsWith("-transition")?this._transitionable.setTransition(_e.slice(0,-11),ct):this._transitionable.setValue(_e,ct)}}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}_validate(g,A,_e){return(!_e||_e.validate!==!1)&&s.emitValidationErrors(this,g.call(s.validateStyle,s.extend({value:A,style:{glyphs:!0,sprite:!0},styleSpec:s.v8Spec})))}}class Xd{constructor(g,A){this.width=g,this.height=A,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(g,A){const _e=g.join(",")+String(A);return this.dashEntry[_e]||(this.dashEntry[_e]=this.addDash(g,A)),this.dashEntry[_e]}getDashRanges(g,A,_e){const ct=[];let pi=g.length%2==1?-g[g.length-1]*_e:0,In=g[0]*_e,ds=!0;ct.push({left:pi,right:In,isDash:ds,zeroLength:g[0]===0});let hs=g[0];for(let vs=1;vs<g.length;vs++){ds=!ds;const fl=g[vs];pi=hs*_e,hs+=fl,In=hs*_e,ct.push({left:pi,right:In,isDash:ds,zeroLength:fl===0})}return ct}addRoundDash(g,A,_e){const ct=A/2;for(let pi=-_e;pi<=_e;pi++){const In=this.width*(this.nextRow+_e+pi);let ds=0,hs=g[ds];for(let vs=0;vs<this.width;vs++){vs/hs.right>1&&(hs=g[++ds]);const fl=Math.abs(vs-hs.left),dl=Math.abs(vs-hs.right),dh=Math.min(fl,dl);let Ah;const hh=pi/_e*(ct+1);if(hs.isDash){const Rh=ct-Math.abs(hh);Ah=Math.sqrt(dh*dh+Rh*Rh)}else Ah=ct-Math.sqrt(dh*dh+hh*hh);this.data[In+vs]=Math.max(0,Math.min(255,Ah+128))}}}addRegularDash(g){for(let ds=g.length-1;ds>=0;--ds){const hs=g[ds],vs=g[ds+1];hs.zeroLength?g.splice(ds,1):vs&&vs.isDash===hs.isDash&&(vs.left=hs.left,g.splice(ds,1))}const A=g[0],_e=g[g.length-1];A.isDash===_e.isDash&&(A.left=_e.left-this.width,_e.right=A.right+this.width);const ct=this.width*this.nextRow;let pi=0,In=g[pi];for(let ds=0;ds<this.width;ds++){ds/In.right>1&&(In=g[++pi]);const hs=Math.abs(ds-In.left),vs=Math.abs(ds-In.right),fl=Math.min(hs,vs);this.data[ct+ds]=Math.max(0,Math.min(255,(In.isDash?fl:-fl)+128))}}addDash(g,A){const _e=A?7:0,ct=2*_e+1;if(this.nextRow+ct>this.height)return s.warnOnce("LineAtlas out of space"),null;let pi=0;for(let ds=0;ds<g.length;ds++)pi+=g[ds];if(pi!==0){const ds=this.width/pi,hs=this.getDashRanges(g,this.width,ds);A?this.addRoundDash(hs,ds,_e):this.addRegularDash(hs)}const In={y:(this.nextRow+_e+.5)/this.height,height:2*_e/this.height,width:pi};return this.nextRow+=ct,this.dirty=!0,In}bind(g){const A=g.gl;this.texture?(A.bindTexture(A.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,A.texSubImage2D(A.TEXTURE_2D,0,0,0,this.width,this.height,A.ALPHA,A.UNSIGNED_BYTE,this.data))):(this.texture=A.createTexture(),A.bindTexture(A.TEXTURE_2D,this.texture),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.REPEAT),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.REPEAT),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.LINEAR),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.LINEAR),A.texImage2D(A.TEXTURE_2D,0,A.ALPHA,this.width,this.height,0,A.ALPHA,A.UNSIGNED_BYTE,this.data))}}class wd{constructor(g,A,_e){this.workerPool=g,this.actors=[],this.currentActor=0,this.id=_e;const ct=this.workerPool.acquire(_e);for(let pi=0;pi<ct.length;pi++){const In=new wd.Actor(ct[pi],A,_e);In.name=`Worker ${pi}`,this.actors.push(In)}if(!this.actors.length)throw new Error("No actors found")}broadcast(g,A,_e){s.asyncAll(this.actors,(ct,pi)=>{ct.send(g,A,pi)},_e=_e||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(g=!0){this.actors.forEach(A=>{A.remove()}),this.actors=[],g&&this.workerPool.release(this.id)}}function zd(Ve,g,A){const _e=function(ct,pi){if(ct)return A(ct);if(pi){const In=s.pick(s.extend(pi,Ve),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);pi.vector_layers&&(In.vectorLayers=pi.vector_layers,In.vectorLayerIds=In.vectorLayers.map(ds=>ds.id)),A(null,In)}};return Ve.url?s.getJSON(g.transformRequest(Ve.url,Bn.Source),_e):s.exported.frame(()=>_e(null,Ve))}wd.Actor=s.Actor;class Rd{constructor(g,A){g&&(A?this.setSouthWest(g).setNorthEast(A):Array.isArray(g)&&(g.length===4?this.setSouthWest([g[0],g[1]]).setNorthEast([g[2],g[3]]):this.setSouthWest(g[0]).setNorthEast(g[1])))}setNorthEast(g){return this._ne=g instanceof s.LngLat?new s.LngLat(g.lng,g.lat):s.LngLat.convert(g),this}setSouthWest(g){return this._sw=g instanceof s.LngLat?new s.LngLat(g.lng,g.lat):s.LngLat.convert(g),this}extend(g){const A=this._sw,_e=this._ne;let ct,pi;if(g instanceof s.LngLat)ct=g,pi=g;else{if(!(g instanceof Rd))return Array.isArray(g)?g.length===4||g.every(Array.isArray)?this.extend(Rd.convert(g)):this.extend(s.LngLat.convert(g)):g&&("lng"in g||"lon"in g)&&"lat"in g?this.extend(s.LngLat.convert(g)):this;if(ct=g._sw,pi=g._ne,!ct||!pi)return this}return A||_e?(A.lng=Math.min(ct.lng,A.lng),A.lat=Math.min(ct.lat,A.lat),_e.lng=Math.max(pi.lng,_e.lng),_e.lat=Math.max(pi.lat,_e.lat)):(this._sw=new s.LngLat(ct.lng,ct.lat),this._ne=new s.LngLat(pi.lng,pi.lat)),this}getCenter(){return new s.LngLat((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.LngLat(this.getWest(),this.getNorth())}getSouthEast(){return new s.LngLat(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(g){const{lng:A,lat:_e}=s.LngLat.convert(g);let ct=this._sw.lng<=A&&A<=this._ne.lng;return this._sw.lng>this._ne.lng&&(ct=this._sw.lng>=A&&A>=this._ne.lng),this._sw.lat<=_e&&_e<=this._ne.lat&&ct}static convert(g){return g instanceof Rd?g:g&&new Rd(g)}static fromLngLat(g,A=0){const _e=360*A/40075017,ct=_e/Math.cos(Math.PI/180*g.lat);return new Rd(new s.LngLat(g.lng-ct,g.lat-_e),new s.LngLat(g.lng+ct,g.lat+_e))}}class op{constructor(g,A,_e){this.bounds=Rd.convert(this.validateBounds(g)),this.minzoom=A||0,this.maxzoom=_e||24}validateBounds(g){return Array.isArray(g)&&g.length===4?[Math.max(-180,g[0]),Math.max(-90,g[1]),Math.min(180,g[2]),Math.min(90,g[3])]:[-180,-90,180,90]}contains(g){const A=Math.pow(2,g.z),_e=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*A),ct=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*A),pi=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*A),In=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*A);return g.x>=_e&&g.x<pi&&g.y>=ct&&g.y<In}}class Wd extends s.Evented{constructor(g,A,_e,ct){if(super(),this.id=g,this.dispatcher=_e,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(A,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},A),this._collectResourceTiming=A.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(ct)}load(){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=zd(this._options,this.map._requestManager,(g,A)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),g?this.fire(new s.ErrorEvent(g)):A&&(s.extend(this,A),A.bounds&&(this.tileBounds=new op(A.bounds,this.minzoom,this.maxzoom)),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}onAdd(g){this.map=g,this.load()}setSourceProperty(g){this._tileJSONRequest&&this._tileJSONRequest.cancel(),g(),this.load()}setTiles(g){return this.setSourceProperty(()=>{this._options.tiles=g}),this}setUrl(g){return this.setSourceProperty(()=>{this.url=g,this._options.url=g}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return s.extend({},this._options)}loadTile(g,A){const _e=g.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),ct={request:this.map._requestManager.transformRequest(_e,Bn.Tile),uid:g.uid,tileID:g.tileID,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function pi(In,ds){return delete g.request,g.aborted?A(null):In&&In.status!==404?A(In):(ds&&ds.resourceTiming&&(g.resourceTiming=ds.resourceTiming),this.map._refreshExpiredTiles&&ds&&g.setExpiryData(ds),g.loadVectorData(ds,this.map.painter),A(null),void(g.reloadCallback&&(this.loadTile(g,g.reloadCallback),g.reloadCallback=null)))}ct.request.collectResourceTiming=this._collectResourceTiming,g.actor&&g.state!=="expired"?g.state==="loading"?g.reloadCallback=A:g.request=g.actor.send("reloadTile",ct,pi.bind(this)):(g.actor=this.dispatcher.getActor(),g.request=g.actor.send("loadTile",ct,pi.bind(this)))}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.actor&&g.actor.send("abortTile",{uid:g.uid,type:this.type,source:this.id},void 0)}unloadTile(g){g.unloadVectorData(),g.actor&&g.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Op extends s.Evented{constructor(g,A,_e,ct){super(),this.id=g,this.dispatcher=_e,this.setEventedParent(ct),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},A),s.extend(this,s.pick(A,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=zd(this._options,this.map._requestManager,(g,A)=>{this._tileJSONRequest=null,this._loaded=!0,g?this.fire(new s.ErrorEvent(g)):A&&(s.extend(this,A),A.bounds&&(this.tileBounds=new op(A.bounds,this.minzoom,this.maxzoom)),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(g){this.map=g,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return s.extend({},this._options)}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,A){const _e=g.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);g.request=Vn.getImage(this.map._requestManager.transformRequest(_e,Bn.Tile),(ct,pi,In)=>{if(delete g.request,g.aborted)g.state="unloaded",A(null);else if(ct)g.state="errored",A(ct);else if(pi){this.map._refreshExpiredTiles&&In&&g.setExpiryData(In);const ds=this.map.painter.context,hs=ds.gl;g.texture=this.map.painter.getTileTexture(pi.width),g.texture?g.texture.update(pi,{useMipmap:!0}):(g.texture=new th(ds,pi,hs.RGBA,{useMipmap:!0}),g.texture.bind(hs.LINEAR,hs.CLAMP_TO_EDGE,hs.LINEAR_MIPMAP_NEAREST),ds.extTextureFilterAnisotropic&&hs.texParameterf(hs.TEXTURE_2D,ds.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ds.extTextureFilterAnisotropicMax)),g.state="loaded",A(null)}},this.map._refreshExpiredTiles)}abortTile(g,A){g.request&&(g.request.cancel(),delete g.request),A()}unloadTile(g,A){g.texture&&this.map.painter.saveTileTexture(g.texture),A()}hasTransition(){return!1}}class ep extends Op{constructor(g,A,_e,ct){super(g,A,_e,ct),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},A),this.encoding=A.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(g,A){const _e=g.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function ct(pi,In){pi&&(g.state="errored",A(pi)),In&&(g.dem=In,g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0,g.state="loaded",A(null))}g.request=Vn.getImage(this.map._requestManager.transformRequest(_e,Bn.Tile),(function(pi,In){if(delete g.request,g.aborted)g.state="unloaded",A(null);else if(pi)g.state="errored",A(pi);else if(In){this.map._refreshExpiredTiles&&g.setExpiryData(In),delete In.cacheControl,delete In.expires;const ds=s.isImageBitmap(In)&&(Ld==null&&(Ld=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ld)?In:s.exported.getImageData(In,1),hs={uid:g.uid,coord:g.tileID,source:this.id,rawImageData:ds,encoding:this.encoding};g.actor&&g.state!=="expired"||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",hs,ct.bind(this)))}}).bind(this),this.map._refreshExpiredTiles),g.neighboringTiles=this._getNeighboringTiles(g.tileID)}_getNeighboringTiles(g){const A=g.canonical,_e=Math.pow(2,A.z),ct=(A.x-1+_e)%_e,pi=A.x===0?g.wrap-1:g.wrap,In=(A.x+1+_e)%_e,ds=A.x+1===_e?g.wrap+1:g.wrap,hs={};return hs[new s.OverscaledTileID(g.overscaledZ,pi,A.z,ct,A.y).key]={backfilled:!1},hs[new s.OverscaledTileID(g.overscaledZ,ds,A.z,In,A.y).key]={backfilled:!1},A.y>0&&(hs[new s.OverscaledTileID(g.overscaledZ,pi,A.z,ct,A.y-1).key]={backfilled:!1},hs[new s.OverscaledTileID(g.overscaledZ,g.wrap,A.z,A.x,A.y-1).key]={backfilled:!1},hs[new s.OverscaledTileID(g.overscaledZ,ds,A.z,In,A.y-1).key]={backfilled:!1}),A.y+1<_e&&(hs[new s.OverscaledTileID(g.overscaledZ,pi,A.z,ct,A.y+1).key]={backfilled:!1},hs[new s.OverscaledTileID(g.overscaledZ,g.wrap,A.z,A.x,A.y+1).key]={backfilled:!1},hs[new s.OverscaledTileID(g.overscaledZ,ds,A.z,In,A.y+1).key]={backfilled:!1}),hs}unloadTile(g){g.demTexture&&this.map.painter.saveTileTexture(g.demTexture),g.fbo&&(g.fbo.destroy(),delete g.fbo),g.dem&&delete g.dem,delete g.neighboringTiles,g.state="unloaded",g.actor&&g.actor.send("removeDEMTile",{uid:g.uid,source:this.id})}}class zp extends s.Evented{constructor(g,A,_e,ct){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=_e.getActor(),this.setEventedParent(ct),this._data=A.data,this._options=s.extend({},A),this._collectResourceTiming=A.collectResourceTiming,A.maxzoom!==void 0&&(this.maxzoom=A.maxzoom),A.type&&(this.type=A.type),A.attribution&&(this.attribution=A.attribution),this.promoteId=A.promoteId;const pi=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:A.cluster||!1,geojsonVtOptions:{buffer:(A.buffer!==void 0?A.buffer:128)*pi,tolerance:(A.tolerance!==void 0?A.tolerance:.375)*pi,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:A.lineMetrics||!1,generateId:A.generateId||!1},superclusterOptions:{maxZoom:A.clusterMaxZoom!==void 0?A.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,A.clusterMinPoints||2),extent:s.EXTENT,radius:(A.clusterRadius||50)*pi,log:!1,generateId:A.generateId||!1},clusterProperties:A.clusterProperties,filter:A.filter},A.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){this._updateWorkerData()}onAdd(g){this.map=g,this.load()}setData(g){return this._data=g,this._updateWorkerData(),this}updateData(g){return this._updateWorkerData(g),this}setClusterOptions(g){return this.workerOptions.cluster=g.cluster,g&&(g.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=g.clusterRadius),g.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=g.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(g,A){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id},A),this}getClusterChildren(g,A){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id},A),this}getClusterLeaves(g,A,_e,ct){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:g,limit:A,offset:_e},ct),this}_updateWorkerData(g){const A=s.extend({},this.workerOptions);g?A.dataDiff=g:typeof this._data=="string"?(A.request=this.map._requestManager.transformRequest(s.exported.resolveURL(this._data),Bn.Source),A.request.collectResourceTiming=this._collectResourceTiming):A.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,A,(_e,ct)=>{if(this._pendingLoads--,this._removed||ct&&ct.abandoned)return void this.fire(new s.Event("dataabort",{dataType:"source"}));let pi=null;if(ct&&ct.resourceTiming&&ct.resourceTiming[this.id]&&(pi=ct.resourceTiming[this.id].slice(0)),_e)return void this.fire(new s.ErrorEvent(_e));const In={dataType:"source"};this._collectResourceTiming&&pi&&pi.length>0&&s.extend(In,{resourceTiming:pi}),this.fire(new s.Event("data",{...In,sourceDataType:"metadata"})),this.fire(new s.Event("data",{...In,sourceDataType:"content"}))})}loaded(){return this._pendingLoads===0}loadTile(g,A){const _e=g.actor?"reloadTile":"loadTile";g.actor=this.actor;const ct={type:this.type,uid:g.uid,tileID:g.tileID,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};g.request=this.actor.send(_e,ct,(pi,In)=>(delete g.request,g.unloadVectorData(),g.aborted?A(null):pi?A(pi):(g.loadVectorData(In,this.map.painter,_e==="reloadTile"),A(null))))}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g){g.unloadVectorData(),this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return s.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Kd=s.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ap extends s.Evented{constructor(g,A,_e,ct){super(),this.id=g,this.dispatcher=_e,this.coordinates=A.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(ct),this.options=A}load(g,A){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=Vn.getImage(this.map._requestManager.transformRequest(this.url,Bn.Image),(_e,ct)=>{this._request=null,this._loaded=!0,_e?this.fire(new s.ErrorEvent(_e)):ct&&(this.image=ct,g&&(this.coordinates=g),A&&A(),this._finishLoading())})}loaded(){return this._loaded}updateImage(g){return g.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=g.url,this.load(g.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(g){this.map=g,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(g){this.coordinates=g;const A=g.map(s.MercatorCoordinate.fromLngLat);this.tileID=function(ct){let pi=1/0,In=1/0,ds=-1/0,hs=-1/0;for(const dh of ct)pi=Math.min(pi,dh.x),In=Math.min(In,dh.y),ds=Math.max(ds,dh.x),hs=Math.max(hs,dh.y);const vs=Math.max(ds-pi,hs-In),fl=Math.max(0,Math.floor(-Math.log(vs)/Math.LN2)),dl=Math.pow(2,fl);return new s.CanonicalTileID(fl,Math.floor((pi+ds)/2*dl),Math.floor((In+hs)/2*dl))}(A),this.minzoom=this.maxzoom=this.tileID.z;const _e=A.map(ct=>this.tileID.getTilePoint(ct)._round());return this._boundsArray=new s.RasterBoundsArray,this._boundsArray.emplaceBack(_e[0].x,_e[0].y,0,0),this._boundsArray.emplaceBack(_e[1].x,_e[1].y,s.EXTENT,0),this._boundsArray.emplaceBack(_e[3].x,_e[3].y,0,s.EXTENT),this._boundsArray.emplaceBack(_e[2].x,_e[2].y,s.EXTENT,s.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const g=this.map.painter.context,A=g.gl;this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,Kd.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new th(g,this.image,A.RGBA),this.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE));let _e=!1;for(const ct in this.tiles){const pi=this.tiles[ct];pi.state!=="loaded"&&(pi.state="loaded",pi.texture=this.texture,_e=!0)}_e&&this.fire(new s.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(g,A){this.tileID&&this.tileID.equals(g.tileID.canonical)?(this.tiles[String(g.tileID.wrap)]=g,g.buckets={},A(null)):(g.state="errored",A(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Ip extends Ap{constructor(g,A,_e,ct){super(g,A,_e,ct),this.roundZoom=!0,this.type="video",this.options=A}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const A of g.urls)this.urls.push(this.map._requestManager.transformRequest(A,Bn.Source).url);s.getVideo(this.urls,(A,_e)=>{this._loaded=!0,A?this.fire(new s.ErrorEvent(A)):_e&&(this.video=_e,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const A=this.video.seekable;g<A.start(0)||g>A.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${A.start(0)} and ${A.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const g=this.map.painter.context,A=g.gl;this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,Kd.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE),A.texSubImage2D(A.TEXTURE_2D,0,0,0,A.RGBA,A.UNSIGNED_BYTE,this.video)):(this.texture=new th(g,this.video,A.RGBA),this.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE));let _e=!1;for(const ct in this.tiles){const pi=this.tiles[ct];pi.state!=="loaded"&&(pi.state="loaded",pi.texture=this.texture,_e=!0)}_e&&this.fire(new s.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Yh extends Ap{constructor(g,A,_e,ct){super(g,A,_e,ct),A.coordinates?Array.isArray(A.coordinates)&&A.coordinates.length===4&&!A.coordinates.some(pi=>!Array.isArray(pi)||pi.length!==2||pi.some(In=>typeof In!="number"))||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${g}`,null,'missing required property "coordinates"'))),A.animate&&typeof A.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),A.canvas?typeof A.canvas=="string"||A.canvas instanceof HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${g}`,null,'missing required property "canvas"'))),this.options=A,this.animate=A.animate===void 0||A.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const A=this.map.painter.context,_e=A.gl;this.boundsBuffer||(this.boundsBuffer=A.createVertexBuffer(this._boundsArray,Kd.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new th(A,this.canvas,_e.RGBA,{premultiply:!0});let ct=!1;for(const pi in this.tiles){const In=this.tiles[pi];In.state!=="loaded"&&(In.state="loaded",In.texture=this.texture,ct=!0)}ct&&this.fire(new s.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}}const Ad={vector:Wd,raster:Op,"raster-dem":ep,geojson:zp,video:Ip,image:Ap,canvas:Yh};function kp(Ve,g){const A=s.create();return s.translate(A,A,[1,1,0]),s.scale(A,A,[.5*Ve.width,.5*Ve.height,1]),s.multiply(A,A,Ve.calculatePosMatrix(g.toUnwrapped()))}function up(Ve,g,A,_e,ct,pi){const In=function(dl,dh,Ah){if(dl)for(const hh of dl){const Rh=dh[hh];if(Rh&&Rh.source===Ah&&Rh.type==="fill-extrusion")return!0}else for(const hh in dh){const Rh=dh[hh];if(Rh.source===Ah&&Rh.type==="fill-extrusion")return!0}return!1}(ct&&ct.layers,g,Ve.id),ds=pi.maxPitchScaleFactor(),hs=Ve.tilesIn(_e,ds,In);hs.sort(rp);const vs=[];for(const dl of hs)vs.push({wrappedTileID:dl.tileID.wrapped().key,queryResults:dl.tile.queryRenderedFeatures(g,A,Ve._state,dl.queryGeometry,dl.cameraQueryGeometry,dl.scale,ct,pi,ds,kp(Ve.transform,dl.tileID))});const fl=function(dl){const dh={},Ah={};for(const hh of dl){const Rh=hh.queryResults,zh=hh.wrappedTileID,Kh=Ah[zh]=Ah[zh]||{};for(const ad in Rh){const Lh=Rh[ad],od=Kh[ad]=Kh[ad]||{},md=dh[ad]=dh[ad]||[];for(const Nd of Lh)od[Nd.featureIndex]||(od[Nd.featureIndex]=!0,md.push(Nd))}}return dh}(vs);for(const dl in fl)fl[dl].forEach(dh=>{const Ah=dh.feature,hh=Ve.getFeatureState(Ah.layer["source-layer"],Ah.id);Ah.source=Ah.layer.source,Ah.layer["source-layer"]&&(Ah.sourceLayer=Ah.layer["source-layer"]),Ah.state=hh});return fl}function rp(Ve,g){const A=Ve.tileID,_e=g.tileID;return A.overscaledZ-_e.overscaledZ||A.canonical.y-_e.canonical.y||A.wrap-_e.wrap||A.canonical.x-_e.canonical.x}class fd{constructor(g,A){this.timeAdded=0,this.fadeEndTime=0,this.tileID=g,this.uid=s.uniqueId(),this.uses=0,this.tileSize=A,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(g){const A=g+this.timeAdded;A<this.fadeEndTime||(this.fadeEndTime=A)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(g){this.demTexture&&g.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(g,A,_e){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",g){g.featureIndex&&(this.latestFeatureIndex=g.featureIndex,g.rawTileData?(this.latestRawTileData=g.rawTileData,this.latestFeatureIndex.rawTileData=g.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=g.collisionBoxArray,this.buckets=function(ct,pi){const In={};if(!pi)return In;for(const ds of ct){const hs=ds.layerIds.map(vs=>pi.getLayer(vs)).filter(Boolean);if(hs.length!==0){ds.layers=hs,ds.stateDependentLayerIds&&(ds.stateDependentLayers=ds.stateDependentLayerIds.map(vs=>hs.filter(fl=>fl.id===vs)[0]));for(const vs of hs)In[vs.id]=ds}}return In}(g.buckets,A.style),this.hasSymbolBuckets=!1;for(const ct in this.buckets){const pi=this.buckets[ct];if(pi instanceof s.SymbolBucket){if(this.hasSymbolBuckets=!0,!_e)break;pi.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const ct in this.buckets){const pi=this.buckets[ct];if(pi instanceof s.SymbolBucket&&pi.hasRTLText){this.hasRTLText=!0,s.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const ct in this.buckets){const pi=this.buckets[ct];this.queryPadding=Math.max(this.queryPadding,A.style.getLayer(ct).queryRadius(pi))}g.imageAtlas&&(this.imageAtlas=g.imageAtlas),g.glyphAtlasImage&&(this.glyphAtlasImage=g.glyphAtlasImage)}else this.collisionBoxArray=new s.CollisionBoxArray}unloadVectorData(){for(const g in this.buckets)this.buckets[g].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(g){return this.buckets[g.id]}upload(g){for(const _e in this.buckets){const ct=this.buckets[_e];ct.uploadPending()&&ct.upload(g)}const A=g.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new th(g,this.imageAtlas.image,A.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new th(g,this.glyphAtlasImage,A.ALPHA),this.glyphAtlasImage=null)}prepare(g){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(g,this.imageAtlasTexture)}queryRenderedFeatures(g,A,_e,ct,pi,In,ds,hs,vs,fl){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:ct,cameraQueryGeometry:pi,scale:In,tileSize:this.tileSize,pixelPosMatrix:fl,transform:hs,params:ds,queryPadding:this.queryPadding*vs},g,A,_e):{}}querySourceFeatures(g,A){const _e=this.latestFeatureIndex;if(!_e||!_e.rawTileData)return;const ct=_e.loadVTLayers(),pi=A&&A.sourceLayer?A.sourceLayer:"",In=ct._geojsonTileLayer||ct[pi];if(!In)return;const ds=s.createFilter(A&&A.filter),{z:hs,x:vs,y:fl}=this.tileID.canonical,dl={z:hs,x:vs,y:fl};for(let dh=0;dh<In.length;dh++){const Ah=In.feature(dh);if(ds.needGeometry){const zh=s.toEvaluationFeature(Ah,!0);if(!ds.filter(new s.EvaluationParameters(this.tileID.overscaledZ),zh,this.tileID.canonical))continue}else if(!ds.filter(new s.EvaluationParameters(this.tileID.overscaledZ),Ah))continue;const hh=_e.getId(Ah,pi),Rh=new s.GeoJSONFeature(Ah,hs,vs,fl,hh);Rh.tile=dl,g.push(Rh)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(g){const A=this.expirationTime;if(g.cacheControl){const _e=s.parseCacheControl(g.cacheControl);_e["max-age"]&&(this.expirationTime=Date.now()+1e3*_e["max-age"])}else g.expires&&(this.expirationTime=new Date(g.expires).getTime());if(this.expirationTime){const _e=Date.now();let ct=!1;if(this.expirationTime>_e)ct=!1;else if(A)if(this.expirationTime<A)ct=!0;else{const pi=this.expirationTime-A;pi?this.expirationTime=_e+Math.max(pi,3e4):ct=!0}else ct=!0;ct?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(g,A){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(g).length===0)return;const _e=this.latestFeatureIndex.loadVTLayers();for(const ct in this.buckets){if(!A.style.hasLayer(ct))continue;const pi=this.buckets[ct],In=pi.layers[0].sourceLayer||"_geojsonTileLayer",ds=_e[In],hs=g[In];if(!ds||!hs||Object.keys(hs).length===0)continue;pi.update(hs,ds,this.imageAtlas&&this.imageAtlas.patternPositions||{});const vs=A&&A.style&&A.style.getLayer(ct);vs&&(this.queryPadding=Math.max(this.queryPadding,vs.queryRadius(pi)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(g){this.symbolFadeHoldUntil=s.exported.now()+g}setDependencies(g,A){const _e={};for(const ct of A)_e[ct]=!0;this.dependencies[g]=_e}hasDependency(g,A){for(const _e of g){const ct=this.dependencies[_e];if(ct){for(const pi of A)if(ct[pi])return!0}}return!1}}class Cp{constructor(g,A){this.max=g,this.onRemove=A,this.reset()}reset(){for(const g in this.data)for(const A of this.data[g])A.timeout&&clearTimeout(A.timeout),this.onRemove(A.value);return this.data={},this.order=[],this}add(g,A,_e){const ct=g.wrapped().key;this.data[ct]===void 0&&(this.data[ct]=[]);const pi={value:A,timeout:void 0};if(_e!==void 0&&(pi.timeout=setTimeout(()=>{this.remove(g,pi)},_e)),this.data[ct].push(pi),this.order.push(ct),this.order.length>this.max){const In=this._getAndRemoveByKey(this.order[0]);In&&this.onRemove(In)}return this}has(g){return g.wrapped().key in this.data}getAndRemove(g){return this.has(g)?this._getAndRemoveByKey(g.wrapped().key):null}_getAndRemoveByKey(g){const A=this.data[g].shift();return A.timeout&&clearTimeout(A.timeout),this.data[g].length===0&&delete this.data[g],this.order.splice(this.order.indexOf(g),1),A.value}getByKey(g){const A=this.data[g];return A?A[0].value:null}get(g){return this.has(g)?this.data[g.wrapped().key][0].value:null}remove(g,A){if(!this.has(g))return this;const _e=g.wrapped().key,ct=A===void 0?0:this.data[_e].indexOf(A),pi=this.data[_e][ct];return this.data[_e].splice(ct,1),pi.timeout&&clearTimeout(pi.timeout),this.data[_e].length===0&&delete this.data[_e],this.onRemove(pi.value),this.order.splice(this.order.indexOf(_e),1),this}setMaxSize(g){for(this.max=g;this.order.length>this.max;){const A=this._getAndRemoveByKey(this.order[0]);A&&this.onRemove(A)}return this}filter(g){const A=[];for(const _e in this.data)for(const ct of this.data[_e])g(ct.value)||A.push(ct);for(const _e of A)this.remove(_e.value.tileID,_e)}}class Fp{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(g,A,_e){const ct=String(A);if(this.stateChanges[g]=this.stateChanges[g]||{},this.stateChanges[g][ct]=this.stateChanges[g][ct]||{},s.extend(this.stateChanges[g][ct],_e),this.deletedStates[g]===null){this.deletedStates[g]={};for(const pi in this.state[g])pi!==ct&&(this.deletedStates[g][pi]=null)}else if(this.deletedStates[g]&&this.deletedStates[g][ct]===null){this.deletedStates[g][ct]={};for(const pi in this.state[g][ct])_e[pi]||(this.deletedStates[g][ct][pi]=null)}else for(const pi in _e)this.deletedStates[g]&&this.deletedStates[g][ct]&&this.deletedStates[g][ct][pi]===null&&delete this.deletedStates[g][ct][pi]}removeFeatureState(g,A,_e){if(this.deletedStates[g]===null)return;const ct=String(A);if(this.deletedStates[g]=this.deletedStates[g]||{},_e&&A!==void 0)this.deletedStates[g][ct]!==null&&(this.deletedStates[g][ct]=this.deletedStates[g][ct]||{},this.deletedStates[g][ct][_e]=null);else if(A!==void 0)if(this.stateChanges[g]&&this.stateChanges[g][ct])for(_e in this.deletedStates[g][ct]={},this.stateChanges[g][ct])this.deletedStates[g][ct][_e]=null;else this.deletedStates[g][ct]=null;else this.deletedStates[g]=null}getState(g,A){const _e=String(A),ct=s.extend({},(this.state[g]||{})[_e],(this.stateChanges[g]||{})[_e]);if(this.deletedStates[g]===null)return{};if(this.deletedStates[g]){const pi=this.deletedStates[g][A];if(pi===null)return{};for(const In in pi)delete ct[In]}return ct}initializeTileState(g,A){g.setFeatureState(this.state,A)}coalesceChanges(g,A){const _e={};for(const ct in this.stateChanges){this.state[ct]=this.state[ct]||{};const pi={};for(const In in this.stateChanges[ct])this.state[ct][In]||(this.state[ct][In]={}),s.extend(this.state[ct][In],this.stateChanges[ct][In]),pi[In]=this.state[ct][In];_e[ct]=pi}for(const ct in this.deletedStates){this.state[ct]=this.state[ct]||{};const pi={};if(this.deletedStates[ct]===null)for(const In in this.state[ct])pi[In]={},this.state[ct][In]={};else for(const In in this.deletedStates[ct]){if(this.deletedStates[ct][In]===null)this.state[ct][In]={};else for(const ds of Object.keys(this.deletedStates[ct][In]))delete this.state[ct][In][ds];pi[In]=this.state[ct][In]}_e[ct]=_e[ct]||{},s.extend(_e[ct],pi)}if(this.stateChanges={},this.deletedStates={},Object.keys(_e).length!==0)for(const ct in g)g[ct].setFeatureState(_e,A)}}class _p extends s.Evented{constructor(g,A,_e){super(),this.id=g,this.dispatcher=_e,this.on("data",ct=>{ct.dataType==="source"&&ct.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&ct.dataType==="source"&&ct.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(ct,pi,In,ds){const hs=new Ad[pi.type](ct,pi,In,ds);if(hs.id!==ct)throw new Error(`Expected Source id to be ${ct} instead of ${hs.id}`);return s.bindAll(["load","abort","unload","serialize","prepare"],hs),hs}(g,A,_e,this),this._tiles={},this._cache=new Cp(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Fp,this._didEmitContent=!1,this._updated=!1}onAdd(g){this.map=g,this._maxTileCacheSize=g?g._maxTileCacheSize:null,this._maxTileCacheZoomLevels=g?g._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(g)}onRemove(g){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(g)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const g in this._tiles){const A=this._tiles[g];if(A.state!=="loaded"&&A.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const g=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,g&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(g,A){return this._source.loadTile(g,A)}_unloadTile(g){if(this._source.unloadTile)return this._source.unloadTile(g,()=>{})}_abortTile(g){this._source.abortTile&&this._source.abortTile(g,()=>{}),this._source.fire(new s.Event("dataabort",{tile:g,coord:g.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(g){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const A in this._tiles){const _e=this._tiles[A];_e.upload(g),_e.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(g=>g.tileID).sort(kd).map(g=>g.key)}getRenderableIds(g){const A=[];for(const _e in this._tiles)this._isIdRenderable(_e,g)&&A.push(this._tiles[_e]);return g?A.sort((_e,ct)=>{const pi=_e.tileID,In=ct.tileID,ds=new s.Point(pi.canonical.x,pi.canonical.y)._rotate(this.transform.angle),hs=new s.Point(In.canonical.x,In.canonical.y)._rotate(this.transform.angle);return pi.overscaledZ-In.overscaledZ||hs.y-ds.y||hs.x-ds.x}).map(_e=>_e.tileID.key):A.map(_e=>_e.tileID).sort(kd).map(_e=>_e.key)}hasRenderableParent(g){const A=this.findLoadedParent(g,0);return!!A&&this._isIdRenderable(A.tileID.key)}_isIdRenderable(g,A){return this._tiles[g]&&this._tiles[g].hasData()&&!this._coveredTiles[g]&&(A||!this._tiles[g].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const g in this._tiles)this._tiles[g].state!=="errored"&&this._reloadTile(g,"reloading")}}_reloadTile(g,A){const _e=this._tiles[g];_e&&(_e.state!=="loading"&&(_e.state=A),this._loadTile(_e,this._tileLoaded.bind(this,_e,g,A)))}_tileLoaded(g,A,_e,ct){if(ct)return g.state="errored",void(ct.status!==404?this._source.fire(new s.ErrorEvent(ct,{tile:g})):this.update(this.transform,this.terrain));g.timeAdded=s.exported.now(),_e==="expired"&&(g.refreshedUponExpiration=!0),this._setTileReloadTimer(A,g),this.getSource().type==="raster-dem"&&g.dem&&this._backfillDEM(g),this._state.initializeTileState(g,this.map?this.map.painter:null),g.aborted||this._source.fire(new s.Event("data",{dataType:"source",tile:g,coord:g.tileID}))}_backfillDEM(g){const A=this.getRenderableIds();for(let ct=0;ct<A.length;ct++){const pi=A[ct];if(g.neighboringTiles&&g.neighboringTiles[pi]){const In=this.getTileByID(pi);_e(g,In),_e(In,g)}}function _e(ct,pi){ct.needsHillshadePrepare=!0,ct.needsTerrainPrepare=!0;let In=pi.tileID.canonical.x-ct.tileID.canonical.x;const ds=pi.tileID.canonical.y-ct.tileID.canonical.y,hs=Math.pow(2,ct.tileID.canonical.z),vs=pi.tileID.key;In===0&&ds===0||Math.abs(ds)>1||(Math.abs(In)>1&&(Math.abs(In+hs)===1?In+=hs:Math.abs(In-hs)===1&&(In-=hs)),pi.dem&&ct.dem&&(ct.dem.backfillBorder(pi.dem,In,ds),ct.neighboringTiles&&ct.neighboringTiles[vs]&&(ct.neighboringTiles[vs].backfilled=!0)))}}getTile(g){return this.getTileByID(g.key)}getTileByID(g){return this._tiles[g]}_retainLoadedChildren(g,A,_e,ct){for(const pi in this._tiles){let In=this._tiles[pi];if(ct[pi]||!In.hasData()||In.tileID.overscaledZ<=A||In.tileID.overscaledZ>_e)continue;let ds=In.tileID;for(;In&&In.tileID.overscaledZ>A+1;){const vs=In.tileID.scaledTo(In.tileID.overscaledZ-1);In=this._tiles[vs.key],In&&In.hasData()&&(ds=vs)}let hs=ds;for(;hs.overscaledZ>A;)if(hs=hs.scaledTo(hs.overscaledZ-1),g[hs.key]){ct[ds.key]=ds;break}}}findLoadedParent(g,A){if(g.key in this._loadedParentTiles){const _e=this._loadedParentTiles[g.key];return _e&&_e.tileID.overscaledZ>=A?_e:null}for(let _e=g.overscaledZ-1;_e>=A;_e--){const ct=g.scaledTo(_e),pi=this._getLoadedTile(ct);if(pi)return pi}}_getLoadedTile(g){const A=this._tiles[g.key];return A&&A.hasData()?A:this._cache.getByKey(g.wrapped().key)}updateCacheSize(g){const A=Math.ceil(g.width/this._source.tileSize)+1,_e=Math.ceil(g.height/this._source.tileSize)+1,ct=Math.floor(A*_e*(this._maxTileCacheZoomLevels===null?s.config.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),pi=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,ct):ct;this._cache.setMaxSize(pi)}handleWrapJump(g){const A=Math.round((g-(this._prevLng===void 0?g:this._prevLng))/360);if(this._prevLng=g,A){const _e={};for(const ct in this._tiles){const pi=this._tiles[ct];pi.tileID=pi.tileID.unwrapTo(pi.tileID.wrap+A),_e[pi.tileID.key]=pi}this._tiles=_e;for(const ct in this._timers)clearTimeout(this._timers[ct]),delete this._timers[ct];for(const ct in this._tiles)this._setTileReloadTimer(ct,this._tiles[ct])}}update(g,A){if(this.transform=g,this.terrain=A,!this._sourceLoaded||this._paused)return;let _e;this.updateCacheSize(g),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?_e=g.getVisibleUnwrappedCoordinates(this._source.tileID).map(fl=>new s.OverscaledTileID(fl.canonical.z,fl.wrap,fl.canonical.z,fl.canonical.x,fl.canonical.y)):(_e=g.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:A}),this._source.hasTile&&(_e=_e.filter(fl=>this._source.hasTile(fl)))):_e=[];const ct=g.coveringZoomLevel(this._source),pi=Math.max(ct-_p.maxOverzooming,this._source.minzoom),In=Math.max(ct+_p.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const fl={};for(const dl of _e)if(dl.canonical.z>this._source.minzoom){const dh=dl.scaledTo(dl.canonical.z-1);fl[dh.key]=dh;const Ah=dl.scaledTo(Math.max(this._source.minzoom,Math.min(dl.canonical.z,5)));fl[Ah.key]=Ah}_e=_e.concat(Object.values(fl))}const ds=_e.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,ds&&this.fire(new s.Event("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const hs=this._updateRetainedTiles(_e,ct);if($f(this._source.type)){const fl={},dl={},dh=Object.keys(hs),Ah=s.exported.now();for(const hh of dh){const Rh=hs[hh],zh=this._tiles[hh];if(!zh||zh.fadeEndTime!==0&&zh.fadeEndTime<=Ah)continue;const Kh=this.findLoadedParent(Rh,pi);Kh&&(this._addTile(Kh.tileID),fl[Kh.tileID.key]=Kh.tileID),dl[hh]=Rh}this._retainLoadedChildren(dl,ct,In,hs);for(const hh in fl)hs[hh]||(this._coveredTiles[hh]=!0,hs[hh]=fl[hh]);if(A){const hh={},Rh={};for(const zh of _e)this._tiles[zh.key].hasData()?hh[zh.key]=zh:Rh[zh.key]=zh;for(const zh in Rh){const Kh=Rh[zh].children(this._source.maxzoom);this._tiles[Kh[0].key]&&this._tiles[Kh[1].key]&&this._tiles[Kh[2].key]&&this._tiles[Kh[3].key]&&(hh[Kh[0].key]=hs[Kh[0].key]=Kh[0],hh[Kh[1].key]=hs[Kh[1].key]=Kh[1],hh[Kh[2].key]=hs[Kh[2].key]=Kh[2],hh[Kh[3].key]=hs[Kh[3].key]=Kh[3],delete Rh[zh])}for(const zh in Rh){const Kh=this.findLoadedParent(Rh[zh],this._source.minzoom);if(Kh){hh[Kh.tileID.key]=hs[Kh.tileID.key]=Kh.tileID;for(const ad in hh)hh[ad].isChildOf(Kh.tileID)&&delete hh[ad]}}for(const zh in this._tiles)hh[zh]||(this._coveredTiles[zh]=!0)}}for(const fl in hs)this._tiles[fl].clearFadeHold();const vs=s.keysDifference(this._tiles,hs);for(const fl of vs){const dl=this._tiles[fl];dl.hasSymbolBuckets&&!dl.holdingForFade()?dl.setHoldDuration(this.map._fadeDuration):dl.hasSymbolBuckets&&!dl.symbolFadeFinished()||this._removeTile(fl)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const g in this._tiles)this._tiles[g].holdingForFade()&&this._removeTile(g)}_updateRetainedTiles(g,A){const _e={},ct={},pi=Math.max(A-_p.maxOverzooming,this._source.minzoom),In=Math.max(A+_p.maxUnderzooming,this._source.minzoom),ds={};for(const hs of g){const vs=this._addTile(hs);_e[hs.key]=hs,vs.hasData()||A<this._source.maxzoom&&(ds[hs.key]=hs)}this._retainLoadedChildren(ds,A,In,_e);for(const hs of g){let vs=this._tiles[hs.key];if(vs.hasData())continue;if(A+1>this._source.maxzoom){const dl=hs.children(this._source.maxzoom)[0],dh=this.getTile(dl);if(dh&&dh.hasData()){_e[dl.key]=dl;continue}}else{const dl=hs.children(this._source.maxzoom);if(_e[dl[0].key]&&_e[dl[1].key]&&_e[dl[2].key]&&_e[dl[3].key])continue}let fl=vs.wasRequested();for(let dl=hs.overscaledZ-1;dl>=pi;--dl){const dh=hs.scaledTo(dl);if(ct[dh.key])break;if(ct[dh.key]=!0,vs=this.getTile(dh),!vs&&fl&&(vs=this._addTile(dh)),vs){const Ah=vs.hasData();if((fl||Ah)&&(_e[dh.key]=dh),fl=vs.wasRequested(),Ah)break}}}return _e}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const g in this._tiles){const A=[];let _e,ct=this._tiles[g].tileID;for(;ct.overscaledZ>0;){if(ct.key in this._loadedParentTiles){_e=this._loadedParentTiles[ct.key];break}A.push(ct.key);const pi=ct.scaledTo(ct.overscaledZ-1);if(_e=this._getLoadedTile(pi),_e)break;ct=pi}for(const pi of A)this._loadedParentTiles[pi]=_e}}_addTile(g){let A=this._tiles[g.key];if(A)return A;A=this._cache.getAndRemove(g),A&&(this._setTileReloadTimer(g.key,A),A.tileID=g,this._state.initializeTileState(A,this.map?this.map.painter:null),this._cacheTimers[g.key]&&(clearTimeout(this._cacheTimers[g.key]),delete this._cacheTimers[g.key],this._setTileReloadTimer(g.key,A)));const _e=A;return A||(A=new fd(g,this._source.tileSize*g.overscaleFactor()),this._loadTile(A,this._tileLoaded.bind(this,A,g.key,A.state))),A.uses++,this._tiles[g.key]=A,_e||this._source.fire(new s.Event("dataloading",{tile:A,coord:A.tileID,dataType:"source"})),A}_setTileReloadTimer(g,A){g in this._timers&&(clearTimeout(this._timers[g]),delete this._timers[g]);const _e=A.getExpiryTimeout();_e&&(this._timers[g]=setTimeout(()=>{this._reloadTile(g,"expired"),delete this._timers[g]},_e))}_removeTile(g){const A=this._tiles[g];A&&(A.uses--,delete this._tiles[g],this._timers[g]&&(clearTimeout(this._timers[g]),delete this._timers[g]),A.uses>0||(A.hasData()&&A.state!=="reloading"?this._cache.add(A.tileID,A,A.getExpiryTimeout()):(A.aborted=!0,this._abortTile(A),this._unloadTile(A))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const g in this._tiles)this._removeTile(g);this._cache.reset()}tilesIn(g,A,_e){const ct=[],pi=this.transform;if(!pi)return ct;const In=_e?pi.getCameraQueryGeometry(g):g,ds=g.map(hh=>pi.pointCoordinate(hh,this.terrain)),hs=In.map(hh=>pi.pointCoordinate(hh,this.terrain)),vs=this.getIds();let fl=1/0,dl=1/0,dh=-1/0,Ah=-1/0;for(const hh of hs)fl=Math.min(fl,hh.x),dl=Math.min(dl,hh.y),dh=Math.max(dh,hh.x),Ah=Math.max(Ah,hh.y);for(let hh=0;hh<vs.length;hh++){const Rh=this._tiles[vs[hh]];if(Rh.holdingForFade())continue;const zh=Rh.tileID,Kh=Math.pow(2,pi.zoom-Rh.tileID.overscaledZ),ad=A*Rh.queryPadding*s.EXTENT/Rh.tileSize/Kh,Lh=[zh.getTilePoint(new s.MercatorCoordinate(fl,dl)),zh.getTilePoint(new s.MercatorCoordinate(dh,Ah))];if(Lh[0].x-ad<s.EXTENT&&Lh[0].y-ad<s.EXTENT&&Lh[1].x+ad>=0&&Lh[1].y+ad>=0){const od=ds.map(Nd=>zh.getTilePoint(Nd)),md=hs.map(Nd=>zh.getTilePoint(Nd));ct.push({tile:Rh,tileID:zh,queryGeometry:od,cameraQueryGeometry:md,scale:Kh})}}return ct}getVisibleCoordinates(g){const A=this.getRenderableIds(g).map(_e=>this._tiles[_e].tileID);for(const _e of A)_e.posMatrix=this.transform.calculatePosMatrix(_e.toUnwrapped());return A}hasTransition(){if(this._source.hasTransition())return!0;if($f(this._source.type)){const g=s.exported.now();for(const A in this._tiles)if(this._tiles[A].fadeEndTime>=g)return!0}return!1}setFeatureState(g,A,_e){this._state.updateState(g=g||"_geojsonTileLayer",A,_e)}removeFeatureState(g,A,_e){this._state.removeFeatureState(g=g||"_geojsonTileLayer",A,_e)}getFeatureState(g,A){return this._state.getState(g=g||"_geojsonTileLayer",A)}setDependencies(g,A,_e){const ct=this._tiles[g];ct&&ct.setDependencies(A,_e)}reloadTilesForDependencies(g,A){for(const _e in this._tiles)this._tiles[_e].hasDependency(g,A)&&this._reloadTile(_e,"reloading");this._cache.filter(_e=>!_e.hasDependency(g,A))}}function kd(Ve,g){const A=Math.abs(2*Ve.wrap)-+(Ve.wrap<0),_e=Math.abs(2*g.wrap)-+(g.wrap<0);return Ve.overscaledZ-g.overscaledZ||_e-A||g.canonical.y-Ve.canonical.y||g.canonical.x-Ve.canonical.x}function $f(Ve){return Ve==="raster"||Ve==="image"||Ve==="video"}_p.maxOverzooming=10,_p.maxUnderzooming=3;const Uf="mapboxgl_preloaded_worker_pool";class cd{constructor(){this.active={}}acquire(g){if(!this.workers)for(this.workers=[];this.workers.length<cd.workerCount;)this.workers.push(new Worker(s.config.WORKER_URL));return this.active[g]=!0,this.workers.slice()}release(g){delete this.active[g],this.numActive()===0&&(this.workers.forEach(A=>{A.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Uf]}numActive(){return Object.keys(this.active).length}}const cp=Math.floor(s.exported.hardwareConcurrency/2);let xp;function Ep(){return xp||(xp=new cd),xp}cd.workerCount=s.isSafari(globalThis)?Math.max(Math.min(cp,3),1):1;class Vp{constructor(g,A){this.reset(g,A)}reset(g,A){this.points=g||[],this._distances=[0];for(let _e=1;_e<this.points.length;_e++)this._distances[_e]=this._distances[_e-1]+this.points[_e].dist(this.points[_e-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(A||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(g){if(this.points.length===1)return this.points[0];g=s.clamp(g,0,1);let A=1,_e=this._distances[A];const ct=g*this.paddedLength+this.padding;for(;_e<ct&&A<this._distances.length;)_e=this._distances[++A];const pi=A-1,In=this._distances[pi],ds=_e-In,hs=ds>0?(ct-In)/ds:0;return this.points[pi].mult(1-hs).add(this.points[A].mult(hs))}}function bd(Ve,g){let A=!0;return Ve==="always"||Ve!=="never"&&g!=="never"||(A=!1),A}class Yd{constructor(g,A,_e){const ct=this.boxCells=[],pi=this.circleCells=[];this.xCellCount=Math.ceil(g/_e),this.yCellCount=Math.ceil(A/_e);for(let In=0;In<this.xCellCount*this.yCellCount;In++)ct.push([]),pi.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=g,this.height=A,this.xScale=this.xCellCount/g,this.yScale=this.yCellCount/A,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(g,A,_e,ct,pi){this._forEachCell(A,_e,ct,pi,this._insertBoxCell,this.boxUid++),this.boxKeys.push(g),this.bboxes.push(A),this.bboxes.push(_e),this.bboxes.push(ct),this.bboxes.push(pi)}insertCircle(g,A,_e,ct){this._forEachCell(A-ct,_e-ct,A+ct,_e+ct,this._insertCircleCell,this.circleUid++),this.circleKeys.push(g),this.circles.push(A),this.circles.push(_e),this.circles.push(ct)}_insertBoxCell(g,A,_e,ct,pi,In){this.boxCells[pi].push(In)}_insertCircleCell(g,A,_e,ct,pi,In){this.circleCells[pi].push(In)}_query(g,A,_e,ct,pi,In,ds){if(_e<0||g>this.width||ct<0||A>this.height)return[];const hs=[];if(g<=0&&A<=0&&this.width<=_e&&this.height<=ct){if(pi)return[{key:null,x1:g,y1:A,x2:_e,y2:ct}];for(let vs=0;vs<this.boxKeys.length;vs++)hs.push({key:this.boxKeys[vs],x1:this.bboxes[4*vs],y1:this.bboxes[4*vs+1],x2:this.bboxes[4*vs+2],y2:this.bboxes[4*vs+3]});for(let vs=0;vs<this.circleKeys.length;vs++){const fl=this.circles[3*vs],dl=this.circles[3*vs+1],dh=this.circles[3*vs+2];hs.push({key:this.circleKeys[vs],x1:fl-dh,y1:dl-dh,x2:fl+dh,y2:dl+dh})}}else this._forEachCell(g,A,_e,ct,this._queryCell,hs,{hitTest:pi,overlapMode:In,seenUids:{box:{},circle:{}}},ds);return hs}query(g,A,_e,ct){return this._query(g,A,_e,ct,!1,null)}hitTest(g,A,_e,ct,pi,In){return this._query(g,A,_e,ct,!0,pi,In).length>0}hitTestCircle(g,A,_e,ct,pi){const In=g-_e,ds=g+_e,hs=A-_e,vs=A+_e;if(ds<0||In>this.width||vs<0||hs>this.height)return!1;const fl=[];return this._forEachCell(In,hs,ds,vs,this._queryCellCircle,fl,{hitTest:!0,overlapMode:ct,circle:{x:g,y:A,radius:_e},seenUids:{box:{},circle:{}}},pi),fl.length>0}_queryCell(g,A,_e,ct,pi,In,ds,hs){const{seenUids:vs,hitTest:fl,overlapMode:dl}=ds,dh=this.boxCells[pi];if(dh!==null){const hh=this.bboxes;for(const Rh of dh)if(!vs.box[Rh]){vs.box[Rh]=!0;const zh=4*Rh,Kh=this.boxKeys[Rh];if(g<=hh[zh+2]&&A<=hh[zh+3]&&_e>=hh[zh+0]&&ct>=hh[zh+1]&&(!hs||hs(Kh))&&(!fl||!bd(dl,Kh.overlapMode))&&(In.push({key:Kh,x1:hh[zh],y1:hh[zh+1],x2:hh[zh+2],y2:hh[zh+3]}),fl))return!0}}const Ah=this.circleCells[pi];if(Ah!==null){const hh=this.circles;for(const Rh of Ah)if(!vs.circle[Rh]){vs.circle[Rh]=!0;const zh=3*Rh,Kh=this.circleKeys[Rh];if(this._circleAndRectCollide(hh[zh],hh[zh+1],hh[zh+2],g,A,_e,ct)&&(!hs||hs(Kh))&&(!fl||!bd(dl,Kh.overlapMode))){const ad=hh[zh],Lh=hh[zh+1],od=hh[zh+2];if(In.push({key:Kh,x1:ad-od,y1:Lh-od,x2:ad+od,y2:Lh+od}),fl)return!0}}}return!1}_queryCellCircle(g,A,_e,ct,pi,In,ds,hs){const{circle:vs,seenUids:fl,overlapMode:dl}=ds,dh=this.boxCells[pi];if(dh!==null){const hh=this.bboxes;for(const Rh of dh)if(!fl.box[Rh]){fl.box[Rh]=!0;const zh=4*Rh,Kh=this.boxKeys[Rh];if(this._circleAndRectCollide(vs.x,vs.y,vs.radius,hh[zh+0],hh[zh+1],hh[zh+2],hh[zh+3])&&(!hs||hs(Kh))&&!bd(dl,Kh.overlapMode))return In.push(!0),!0}}const Ah=this.circleCells[pi];if(Ah!==null){const hh=this.circles;for(const Rh of Ah)if(!fl.circle[Rh]){fl.circle[Rh]=!0;const zh=3*Rh,Kh=this.circleKeys[Rh];if(this._circlesCollide(hh[zh],hh[zh+1],hh[zh+2],vs.x,vs.y,vs.radius)&&(!hs||hs(Kh))&&!bd(dl,Kh.overlapMode))return In.push(!0),!0}}}_forEachCell(g,A,_e,ct,pi,In,ds,hs){const vs=this._convertToXCellCoord(g),fl=this._convertToYCellCoord(A),dl=this._convertToXCellCoord(_e),dh=this._convertToYCellCoord(ct);for(let Ah=vs;Ah<=dl;Ah++)for(let hh=fl;hh<=dh;hh++)if(pi.call(this,g,A,_e,ct,this.xCellCount*hh+Ah,In,ds,hs))return}_convertToXCellCoord(g){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(g*this.xScale)))}_convertToYCellCoord(g){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(g*this.yScale)))}_circlesCollide(g,A,_e,ct,pi,In){const ds=ct-g,hs=pi-A,vs=_e+In;return vs*vs>ds*ds+hs*hs}_circleAndRectCollide(g,A,_e,ct,pi,In,ds){const hs=(In-ct)/2,vs=Math.abs(g-(ct+hs));if(vs>hs+_e)return!1;const fl=(ds-pi)/2,dl=Math.abs(A-(pi+fl));if(dl>fl+_e)return!1;if(vs<=hs||dl<=fl)return!0;const dh=vs-hs,Ah=dl-fl;return dh*dh+Ah*Ah<=_e*_e}}function np(Ve,g,A,_e,ct){const pi=s.create();return g?(s.scale(pi,pi,[1/ct,1/ct,1]),A||s.rotateZ(pi,pi,_e.angle)):s.multiply(pi,_e.labelPlaneMatrix,Ve),pi}function Up(Ve,g,A,_e,ct){if(g){const pi=s.clone(Ve);return s.scale(pi,pi,[ct,ct,1]),A||s.rotateZ(pi,pi,-_e.angle),pi}return _e.glCoordMatrix}function Qp(Ve,g,A){let _e;A?(_e=[Ve.x,Ve.y,A(Ve.x,Ve.y),1],s.transformMat4(_e,_e,g)):(_e=[Ve.x,Ve.y,0,1],ul(_e,_e,g));const ct=_e[3];return{point:new s.Point(_e[0]/ct,_e[1]/ct),signedDistanceFromCamera:ct}}function Rp(Ve,g){return .5+Ve/g*.5}function ng(Ve,g){const A=Ve[0]/Ve[3],_e=Ve[1]/Ve[3];return A>=-g[0]&&A<=g[0]&&_e>=-g[1]&&_e<=g[1]}function bg(Ve,g,A,_e,ct,pi,In,ds,hs,vs){const fl=_e?Ve.textSizeData:Ve.iconSizeData,dl=s.evaluateSizeForZoom(fl,A.transform.zoom),dh=[256/A.width*2+1,256/A.height*2+1],Ah=_e?Ve.text.dynamicLayoutVertexArray:Ve.icon.dynamicLayoutVertexArray;Ah.clear();const hh=Ve.lineVertexArray,Rh=_e?Ve.text.placedSymbolArray:Ve.icon.placedSymbolArray,zh=A.transform.width/A.transform.height;let Kh=!1;for(let ad=0;ad<Rh.length;ad++){const Lh=Rh.get(ad);if(Lh.hidden||Lh.writingMode===s.WritingMode.vertical&&!Kh){fs(Lh.numGlyphs,Ah);continue}let od;if(Kh=!1,vs?(od=[Lh.anchorX,Lh.anchorY,vs(Lh.anchorX,Lh.anchorY),1],s.transformMat4(od,od,g)):(od=[Lh.anchorX,Lh.anchorY,0,1],ul(od,od,g)),!ng(od,dh)){fs(Lh.numGlyphs,Ah);continue}const md=Rp(A.transform.cameraToCenterDistance,od[3]),Nd=s.evaluateSizeForFeature(fl,dl,Lh),Hd=In?Nd/md:Nd*md,tp=new s.Point(Lh.anchorX,Lh.anchorY),Vd=Qp(tp,ct,vs).point,gp={projections:{},offsets:{}},L=sh(Lh,Hd,!1,ds,g,ct,pi,Ve.glyphOffsetArray,hh,Ah,Vd,tp,gp,zh,hs,vs);Kh=L.useVertical,(L.notEnoughRoom||Kh||L.needsFlipping&&sh(Lh,Hd,!0,ds,g,ct,pi,Ve.glyphOffsetArray,hh,Ah,Vd,tp,gp,zh,hs,vs).notEnoughRoom)&&fs(Lh.numGlyphs,Ah)}_e?Ve.text.dynamicLayoutVertexBuffer.updateData(Ah):Ve.icon.dynamicLayoutVertexBuffer.updateData(Ah)}function Ih(Ve,g,A,_e,ct,pi,In,ds,hs,vs,fl,dl,dh){const Ah=ds.glyphStartIndex+ds.numGlyphs,hh=ds.lineStartIndex,Rh=ds.lineStartIndex+ds.lineLength,zh=g.getoffsetX(ds.glyphStartIndex),Kh=g.getoffsetX(Ah-1),ad=gs(Ve*zh,A,_e,ct,pi,In,ds.segment,hh,Rh,hs,vs,fl,dl,dh);if(!ad)return null;const Lh=gs(Ve*Kh,A,_e,ct,pi,In,ds.segment,hh,Rh,hs,vs,fl,dl,dh);return Lh?{first:ad,last:Lh}:null}function rh(Ve,g,A,_e){return Ve===s.WritingMode.horizontal&&Math.abs(A.y-g.y)>Math.abs(A.x-g.x)*_e?{useVertical:!0}:(Ve===s.WritingMode.vertical?g.y<A.y:g.x>A.x)?{needsFlipping:!0}:null}function sh(Ve,g,A,_e,ct,pi,In,ds,hs,vs,fl,dl,dh,Ah,hh,Rh){const zh=g/24,Kh=Ve.lineOffsetX*zh,ad=Ve.lineOffsetY*zh;let Lh;if(Ve.numGlyphs>1){const od=Ve.glyphStartIndex+Ve.numGlyphs,md=Ve.lineStartIndex,Nd=Ve.lineStartIndex+Ve.lineLength,Hd=Ih(zh,ds,Kh,ad,A,fl,dl,Ve,hs,pi,dh,hh,Rh);if(!Hd)return{notEnoughRoom:!0};const tp=Qp(Hd.first.point,In,Rh).point,Vd=Qp(Hd.last.point,In,Rh).point;if(_e&&!A){const gp=rh(Ve.writingMode,tp,Vd,Ah);if(gp)return gp}Lh=[Hd.first];for(let gp=Ve.glyphStartIndex+1;gp<od-1;gp++)Lh.push(gs(zh*ds.getoffsetX(gp),Kh,ad,A,fl,dl,Ve.segment,md,Nd,hs,pi,dh,hh,Rh));Lh.push(Hd.last)}else{if(_e&&!A){const md=Qp(dl,ct,Rh).point,Nd=Ve.lineStartIndex+Ve.segment+1,Hd=new s.Point(hs.getx(Nd),hs.gety(Nd)),tp=Qp(Hd,ct,Rh),Vd=tp.signedDistanceFromCamera>0?tp.point:oh(dl,Hd,md,1,ct,Rh),gp=rh(Ve.writingMode,md,Vd,Ah);if(gp)return gp}const od=gs(zh*ds.getoffsetX(Ve.glyphStartIndex),Kh,ad,A,fl,dl,Ve.segment,Ve.lineStartIndex,Ve.lineStartIndex+Ve.lineLength,hs,pi,dh,hh,Rh);if(!od)return{notEnoughRoom:!0};Lh=[od]}for(const od of Lh)s.addDynamicAttributes(vs,od.point,od.angle);return{}}function oh(Ve,g,A,_e,ct,pi){const In=Qp(Ve.add(Ve.sub(g)._unit()),ct,pi).point,ds=A.sub(In);return A.add(ds._mult(_e/ds.mag()))}function Dh(Ve,g){const{projectionCache:A,lineVertexArray:_e,labelPlaneMatrix:ct,tileAnchorPoint:pi,distanceFromAnchor:In,getElevation:ds,previousVertex:hs,direction:vs,absOffsetX:fl}=g;if(A.projections[Ve])return A.projections[Ve];const dl=new s.Point(_e.getx(Ve),_e.gety(Ve)),dh=Qp(dl,ct,ds);if(dh.signedDistanceFromCamera>0)return A.projections[Ve]=dh.point,dh.point;const Ah=Ve-vs;return oh(In===0?pi:new s.Point(_e.getx(Ah),_e.gety(Ah)),dl,hs,fl-In+1,ct,ds)}function $h(Ve,g,A){return Ve._unit()._perp()._mult(g*A)}function yl(Ve,g,A,_e,ct,pi,In,ds){const{projectionCache:hs,direction:vs}=ds;if(hs.offsets[Ve])return hs.offsets[Ve];const fl=A.add(g);if(Ve+vs<_e||Ve+vs>=ct)return hs.offsets[Ve]=fl,fl;const dl=Dh(Ve+vs,ds),dh=$h(dl.sub(A),In,vs),Ah=A.add(dh),hh=dl.add(dh);return hs.offsets[Ve]=s.findLineIntersection(pi,fl,Ah,hh)||fl,hs.offsets[Ve]}function gs(Ve,g,A,_e,ct,pi,In,ds,hs,vs,fl,dl,dh,Ah){const hh=_e?Ve-g:Ve+g;let Rh=hh>0?1:-1,zh=0;_e&&(Rh*=-1,zh=Math.PI),Rh<0&&(zh+=Math.PI);let Kh,ad,Lh=Rh>0?ds+In:ds+In+1,od=ct,md=ct,Nd=0,Hd=0;const tp=Math.abs(hh),Vd=[];let gp;for(;Nd+Hd<=tp;){if(Lh+=Rh,Lh<ds||Lh>=hs)return null;Nd+=Hd,md=od,ad=Kh;const S={projectionCache:dl,lineVertexArray:vs,labelPlaneMatrix:fl,tileAnchorPoint:pi,distanceFromAnchor:Nd,getElevation:Ah,previousVertex:md,direction:Rh,absOffsetX:tp};if(od=Dh(Lh,S),A===0)Vd.push(md),gp=od.sub(md);else{let X;const ze=od.sub(md);X=ze.mag()===0?$h(Dh(Lh+Rh,S).sub(od),A,Rh):$h(ze,A,Rh),ad||(ad=md.add(X)),Kh=yl(Lh,X,od,ds,hs,ad,A,S),Vd.push(ad),gp=Kh.sub(ad)}Hd=gp.mag()}const L=gp._mult((tp-Nd)/Hd)._add(ad||md),p=zh+Math.atan2(od.y-md.y,od.x-md.x);return Vd.push(L),{point:L,angle:dh?p:0,path:Vd}}const Cr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function fs(Ve,g){for(let A=0;A<Ve;A++){const _e=g.length;g.resize(_e+4),g.float32.set(Cr,3*_e)}}function ul(Ve,g,A){const _e=g[0],ct=g[1];return Ve[0]=A[0]*_e+A[4]*ct+A[12],Ve[1]=A[1]*_e+A[5]*ct+A[13],Ve[3]=A[3]*_e+A[7]*ct+A[15],Ve}const ih=100;class ch{constructor(g,A=new Yd(g.width+200,g.height+200,25),_e=new Yd(g.width+200,g.height+200,25)){this.transform=g,this.grid=A,this.ignoredGrid=_e,this.pitchfactor=Math.cos(g._pitch)*g.cameraToCenterDistance,this.screenRightBoundary=g.width+ih,this.screenBottomBoundary=g.height+ih,this.gridRightBoundary=g.width+200,this.gridBottomBoundary=g.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(g,A,_e,ct,pi,In){const ds=this.projectAndGetPerspectiveRatio(ct,g.anchorPointX,g.anchorPointY,In),hs=_e*ds.perspectiveRatio,vs=g.x1*hs+ds.point.x,fl=g.y1*hs+ds.point.y,dl=g.x2*hs+ds.point.x,dh=g.y2*hs+ds.point.y;return!this.isInsideGrid(vs,fl,dl,dh)||A!=="always"&&this.grid.hitTest(vs,fl,dl,dh,A,pi)||ds.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[vs,fl,dl,dh],offscreen:this.isOffscreen(vs,fl,dl,dh)}}placeCollisionCircles(g,A,_e,ct,pi,In,ds,hs,vs,fl,dl,dh,Ah,hh){const Rh=[],zh=new s.Point(A.anchorX,A.anchorY),Kh=Qp(zh,In,hh),ad=Rp(this.transform.cameraToCenterDistance,Kh.signedDistanceFromCamera),Lh=(fl?pi/ad:pi*ad)/s.ONE_EM,od=Qp(zh,ds,hh).point,md=Ih(Lh,ct,A.lineOffsetX*Lh,A.lineOffsetY*Lh,!1,od,zh,A,_e,ds,{projections:{},offsets:{}},!1,hh);let Nd=!1,Hd=!1,tp=!0;if(md){const Vd=.5*dh*ad+Ah,gp=new s.Point(-100,-100),L=new s.Point(this.screenRightBoundary,this.screenBottomBoundary),p=new Vp,S=md.first,X=md.last;let ze=[];for(let or=S.path.length-1;or>=1;or--)ze.push(S.path[or]);for(let or=1;or<X.path.length;or++)ze.push(X.path[or]);const kt=2.5*Vd;if(hs){const or=ze.map(Gn=>Qp(Gn,hs,hh));ze=or.some(Gn=>Gn.signedDistanceFromCamera<=0)?[]:or.map(Gn=>Gn.point)}let vi=[];if(ze.length>0){const or=ze[0].clone(),Gn=ze[0].clone();for(let ia=1;ia<ze.length;ia++)or.x=Math.min(or.x,ze[ia].x),or.y=Math.min(or.y,ze[ia].y),Gn.x=Math.max(Gn.x,ze[ia].x),Gn.y=Math.max(Gn.y,ze[ia].y);vi=or.x>=gp.x&&Gn.x<=L.x&&or.y>=gp.y&&Gn.y<=L.y?[ze]:Gn.x<gp.x||or.x>L.x||Gn.y<gp.y||or.y>L.y?[]:s.clipLine([ze],gp.x,gp.y,L.x,L.y)}for(const or of vi){p.reset(or,.25*Vd);let Gn=0;Gn=p.length<=.5*Vd?1:Math.ceil(p.paddedLength/kt)+1;for(let ia=0;ia<Gn;ia++){const oa=ia/Math.max(Gn-1,1),pl=p.lerp(oa),lh=pl.x+ih,gh=pl.y+ih;Rh.push(lh,gh,Vd,0);const yh=lh-Vd,_h=gh-Vd,xh=lh+Vd,_l=gh+Vd;if(tp=tp&&this.isOffscreen(yh,_h,xh,_l),Hd=Hd||this.isInsideGrid(yh,_h,xh,_l),g!=="always"&&this.grid.hitTestCircle(lh,gh,Vd,g,dl)&&(Nd=!0,!vs))return{circles:[],offscreen:!1,collisionDetected:Nd}}}}return{circles:!vs&&Nd||!Hd||ad<this.perspectiveRatioCutoff?[]:Rh,offscreen:tp,collisionDetected:Nd}}queryRenderedSymbols(g){if(g.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const A=[];let _e=1/0,ct=1/0,pi=-1/0,In=-1/0;for(const fl of g){const dl=new s.Point(fl.x+ih,fl.y+ih);_e=Math.min(_e,dl.x),ct=Math.min(ct,dl.y),pi=Math.max(pi,dl.x),In=Math.max(In,dl.y),A.push(dl)}const ds=this.grid.query(_e,ct,pi,In).concat(this.ignoredGrid.query(_e,ct,pi,In)),hs={},vs={};for(const fl of ds){const dl=fl.key;if(hs[dl.bucketInstanceId]===void 0&&(hs[dl.bucketInstanceId]={}),hs[dl.bucketInstanceId][dl.featureIndex])continue;const dh=[new s.Point(fl.x1,fl.y1),new s.Point(fl.x2,fl.y1),new s.Point(fl.x2,fl.y2),new s.Point(fl.x1,fl.y2)];s.polygonIntersectsPolygon(A,dh)&&(hs[dl.bucketInstanceId][dl.featureIndex]=!0,vs[dl.bucketInstanceId]===void 0&&(vs[dl.bucketInstanceId]=[]),vs[dl.bucketInstanceId].push(dl.featureIndex))}return vs}insertCollisionBox(g,A,_e,ct,pi,In){(_e?this.ignoredGrid:this.grid).insert({bucketInstanceId:ct,featureIndex:pi,collisionGroupID:In,overlapMode:A},g[0],g[1],g[2],g[3])}insertCollisionCircles(g,A,_e,ct,pi,In){const ds=_e?this.ignoredGrid:this.grid,hs={bucketInstanceId:ct,featureIndex:pi,collisionGroupID:In,overlapMode:A};for(let vs=0;vs<g.length;vs+=4)ds.insertCircle(hs,g[vs],g[vs+1],g[vs+2])}projectAndGetPerspectiveRatio(g,A,_e,ct){let pi;return ct?(pi=[A,_e,ct(A,_e),1],s.transformMat4(pi,pi,g)):(pi=[A,_e,0,1],ul(pi,pi,g)),{point:new s.Point((pi[0]/pi[3]+1)/2*this.transform.width+ih,(-pi[1]/pi[3]+1)/2*this.transform.height+ih),perspectiveRatio:.5+this.transform.cameraToCenterDistance/pi[3]*.5}}isOffscreen(g,A,_e,ct){return _e<ih||g>=this.screenRightBoundary||ct<ih||A>this.screenBottomBoundary}isInsideGrid(g,A,_e,ct){return _e>=0&&g<this.gridRightBoundary&&ct>=0&&A<this.gridBottomBoundary}getViewportMatrix(){const g=s.identity([]);return s.translate(g,g,[-100,-100,0]),g}}function vh(Ve,g,A){return g*(s.EXTENT/(Ve.tileSize*Math.pow(2,A-Ve.tileID.overscaledZ)))}class Th{constructor(g,A,_e,ct){this.opacity=g?Math.max(0,Math.min(1,g.opacity+(g.placed?A:-A))):ct&&_e?1:0,this.placed=_e}isHidden(){return this.opacity===0&&!this.placed}}class Nh{constructor(g,A,_e,ct,pi){this.text=new Th(g?g.text:null,A,_e,pi),this.icon=new Th(g?g.icon:null,A,ct,pi)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Qh{constructor(g,A,_e){this.text=g,this.icon=A,this.skipFade=_e}}class rd{constructor(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]}}class _d{constructor(g,A,_e,ct,pi){this.bucketInstanceId=g,this.featureIndex=A,this.sourceLayerIndex=_e,this.bucketIndex=ct,this.tileID=pi}}class ip{constructor(g){this.crossSourceCollisions=g,this.maxGroupID=0,this.collisionGroups={}}get(g){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[g]){const A=++this.maxGroupID;this.collisionGroups[g]={ID:A,predicate:_e=>_e.collisionGroupID===A}}return this.collisionGroups[g]}}function Dp(Ve,g,A,_e,ct){const{horizontalAlign:pi,verticalAlign:In}=s.getAnchorAlignment(Ve),ds=-(pi-.5)*g,hs=-(In-.5)*A,vs=s.evaluateVariableOffset(Ve,_e);return new s.Point(ds+vs[0]*ct,hs+vs[1]*ct)}function qd(Ve,g,A,_e,ct,pi){const{x1:In,x2:ds,y1:hs,y2:vs,anchorPointX:fl,anchorPointY:dl}=Ve,dh=new s.Point(g,A);return _e&&dh._rotate(ct?pi:-pi),{x1:In+dh.x,y1:hs+dh.y,x2:ds+dh.x,y2:vs+dh.y,anchorPointX:fl,anchorPointY:dl}}class wp{constructor(g,A,_e,ct,pi){this.transform=g.clone(),this.terrain=A,this.collisionIndex=new ch(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=_e,this.retainedQueryData={},this.collisionGroups=new ip(ct),this.collisionCircleArrays={},this.prevPlacement=pi,pi&&(pi.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(g,A,_e,ct){const pi=_e.getBucket(A),In=_e.latestFeatureIndex;if(!pi||!In||A.id!==pi.layerIds[0])return;const ds=_e.collisionBoxArray,hs=pi.layers[0].layout,vs=Math.pow(2,this.transform.zoom-_e.tileID.overscaledZ),fl=_e.tileSize/s.EXTENT,dl=this.transform.calculatePosMatrix(_e.tileID.toUnwrapped()),dh=hs.get("text-pitch-alignment")==="map",Ah=hs.get("text-rotation-alignment")==="map",hh=vh(_e,1,this.transform.zoom),Rh=np(dl,dh,Ah,this.transform,hh);let zh=null;if(dh){const ad=Up(dl,dh,Ah,this.transform,hh);zh=s.multiply([],this.transform.labelPlaneMatrix,ad)}this.retainedQueryData[pi.bucketInstanceId]=new _d(pi.bucketInstanceId,In,pi.sourceLayerIndex,pi.index,_e.tileID);const Kh={bucket:pi,layout:hs,posMatrix:dl,textLabelPlaneMatrix:Rh,labelToScreenMatrix:zh,scale:vs,textPixelRatio:fl,holdingForFade:_e.holdingForFade(),collisionBoxArray:ds,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(pi.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(pi.sourceID)};if(ct)for(const ad of pi.sortKeyRanges){const{sortKey:Lh,symbolInstanceStart:od,symbolInstanceEnd:md}=ad;g.push({sortKey:Lh,symbolInstanceStart:od,symbolInstanceEnd:md,parameters:Kh})}else g.push({symbolInstanceStart:0,symbolInstanceEnd:pi.symbolInstances.length,parameters:Kh})}attemptAnchorPlacement(g,A,_e,ct,pi,In,ds,hs,vs,fl,dl,dh,Ah,hh,Rh,zh){const Kh=[dh.textOffset0,dh.textOffset1],ad=Dp(g,_e,ct,Kh,pi),Lh=this.collisionIndex.placeCollisionBox(qd(A,ad.x,ad.y,In,ds,this.transform.angle),dl,hs,vs,fl.predicate,zh);if((!Rh||this.collisionIndex.placeCollisionBox(qd(Rh,ad.x,ad.y,In,ds,this.transform.angle),dl,hs,vs,fl.predicate,zh).box.length!==0)&&Lh.box.length>0){let od;if(this.prevPlacement&&this.prevPlacement.variableOffsets[dh.crossTileID]&&this.prevPlacement.placements[dh.crossTileID]&&this.prevPlacement.placements[dh.crossTileID].text&&(od=this.prevPlacement.variableOffsets[dh.crossTileID].anchor),dh.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[dh.crossTileID]={textOffset:Kh,width:_e,height:ct,anchor:g,textBoxScale:pi,prevAnchor:od},this.markUsedJustification(Ah,g,dh,hh),Ah.allowVerticalPlacement&&(this.markUsedOrientation(Ah,hh,dh),this.placedOrientations[dh.crossTileID]=hh),{shift:ad,placedGlyphBoxes:Lh}}}placeLayerBucketPart(g,A,_e){const{bucket:ct,layout:pi,posMatrix:In,textLabelPlaneMatrix:ds,labelToScreenMatrix:hs,textPixelRatio:vs,holdingForFade:fl,collisionBoxArray:dl,partiallyEvaluatedTextSize:dh,collisionGroup:Ah}=g.parameters,hh=pi.get("text-optional"),Rh=pi.get("icon-optional"),zh=s.getOverlapMode(pi,"text-overlap","text-allow-overlap"),Kh=zh==="always",ad=s.getOverlapMode(pi,"icon-overlap","icon-allow-overlap"),Lh=ad==="always",od=pi.get("text-rotation-alignment")==="map",md=pi.get("text-pitch-alignment")==="map",Nd=pi.get("icon-text-fit")!=="none",Hd=pi.get("symbol-z-order")==="viewport-y",tp=Kh&&(Lh||!ct.hasIconData()||Rh),Vd=Lh&&(Kh||!ct.hasTextData()||hh);!ct.collisionArrays&&dl&&ct.deserializeCollisionBoxes(dl);const gp=this.retainedQueryData[ct.bucketInstanceId].tileID,L=this.terrain?(S,X)=>this.terrain.getElevation(gp,S,X):null,p=(S,X)=>{if(A[S.crossTileID])return;if(fl)return void(this.placements[S.crossTileID]=new Qh(!1,!1,!1));let ze=!1,kt=!1,vi=!0,or=null,Gn={box:null,offscreen:null},ia={box:null,offscreen:null},oa=null,pl=null,lh=null,gh=0,yh=0,_h=0;X.textFeatureIndex?gh=X.textFeatureIndex:S.useRuntimeCollisionCircles&&(gh=S.featureIndex),X.verticalTextFeatureIndex&&(yh=X.verticalTextFeatureIndex);const xh=X.textBox;if(xh){const wh=Oh=>{let Uh=s.WritingMode.horizontal;if(ct.allowVerticalPlacement&&!Oh&&this.prevPlacement){const Vh=this.prevPlacement.placedOrientations[S.crossTileID];Vh&&(this.placedOrientations[S.crossTileID]=Vh,Uh=Vh,this.markUsedOrientation(ct,Uh,S))}return Uh},Sh=(Oh,Uh)=>{if(ct.allowVerticalPlacement&&S.numVerticalGlyphVertices>0&&X.verticalTextBox){for(const Vh of ct.writingModes)if(Vh===s.WritingMode.vertical?(Gn=Uh(),ia=Gn):Gn=Oh(),Gn&&Gn.box&&Gn.box.length)break}else Gn=Oh()};if(pi.get("text-variable-anchor")){let Oh=pi.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[S.crossTileID]){const Wh=this.prevPlacement.variableOffsets[S.crossTileID];Oh.indexOf(Wh.anchor)>0&&(Oh=Oh.filter(Zh=>Zh!==Wh.anchor),Oh.unshift(Wh.anchor))}const Uh=(Wh,Zh,id)=>{const Bd=Wh.x2-Wh.x1,ed=Wh.y2-Wh.y1,Sd=S.textBoxScale,dd=Nd&&ad==="never"?Zh:null;let xd={box:[],offscreen:!1};const nd=zh!=="never"?2*Oh.length:Oh.length;for(let vd=0;vd<nd;++vd){const Od=this.attemptAnchorPlacement(Oh[vd%Oh.length],Wh,Bd,ed,Sd,od,md,vs,In,Ah,vd>=Oh.length?zh:"never",S,ct,id,dd,L);if(Od&&(xd=Od.placedGlyphBoxes,xd&&xd.box&&xd.box.length)){ze=!0,or=Od.shift;break}}return xd};Sh(()=>Uh(xh,X.iconBox,s.WritingMode.horizontal),()=>{const Wh=X.verticalTextBox;return ct.allowVerticalPlacement&&!(Gn&&Gn.box&&Gn.box.length)&&S.numVerticalGlyphVertices>0&&Wh?Uh(Wh,X.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null}}),Gn&&(ze=Gn.box,vi=Gn.offscreen);const Vh=wh(Gn&&Gn.box);if(!ze&&this.prevPlacement){const Wh=this.prevPlacement.variableOffsets[S.crossTileID];Wh&&(this.variableOffsets[S.crossTileID]=Wh,this.markUsedJustification(ct,Wh.anchor,S,Vh))}}else{const Oh=(Uh,Vh)=>{const Wh=this.collisionIndex.placeCollisionBox(Uh,zh,vs,In,Ah.predicate,L);return Wh&&Wh.box&&Wh.box.length&&(this.markUsedOrientation(ct,Vh,S),this.placedOrientations[S.crossTileID]=Vh),Wh};Sh(()=>Oh(xh,s.WritingMode.horizontal),()=>{const Uh=X.verticalTextBox;return ct.allowVerticalPlacement&&S.numVerticalGlyphVertices>0&&Uh?Oh(Uh,s.WritingMode.vertical):{box:null,offscreen:null}}),wh(Gn&&Gn.box&&Gn.box.length)}}if(oa=Gn,ze=oa&&oa.box&&oa.box.length>0,vi=oa&&oa.offscreen,S.useRuntimeCollisionCircles){const wh=ct.text.placedSymbolArray.get(S.centerJustifiedTextSymbolIndex),Sh=s.evaluateSizeForFeature(ct.textSizeData,dh,wh),Oh=pi.get("text-padding");pl=this.collisionIndex.placeCollisionCircles(zh,wh,ct.lineVertexArray,ct.glyphOffsetArray,Sh,In,ds,hs,_e,md,Ah.predicate,S.collisionCircleDiameter,Oh,L),pl.circles.length&&pl.collisionDetected&&!_e&&s.warnOnce("Collisions detected, but collision boxes are not shown"),ze=Kh||pl.circles.length>0&&!pl.collisionDetected,vi=vi&&pl.offscreen}if(X.iconFeatureIndex&&(_h=X.iconFeatureIndex),X.iconBox){const wh=Sh=>{const Oh=Nd&&or?qd(Sh,or.x,or.y,od,md,this.transform.angle):Sh;return this.collisionIndex.placeCollisionBox(Oh,ad,vs,In,Ah.predicate,L)};ia&&ia.box&&ia.box.length&&X.verticalIconBox?(lh=wh(X.verticalIconBox),kt=lh.box.length>0):(lh=wh(X.iconBox),kt=lh.box.length>0),vi=vi&&lh.offscreen}const _l=hh||S.numHorizontalGlyphVertices===0&&S.numVerticalGlyphVertices===0,mh=Rh||S.numIconVertices===0;if(_l||mh?mh?_l||(kt=kt&&ze):ze=kt&&ze:kt=ze=kt&&ze,ze&&oa&&oa.box&&this.collisionIndex.insertCollisionBox(oa.box,zh,pi.get("text-ignore-placement"),ct.bucketInstanceId,ia&&ia.box&&yh?yh:gh,Ah.ID),kt&&lh&&this.collisionIndex.insertCollisionBox(lh.box,ad,pi.get("icon-ignore-placement"),ct.bucketInstanceId,_h,Ah.ID),pl&&(ze&&this.collisionIndex.insertCollisionCircles(pl.circles,zh,pi.get("text-ignore-placement"),ct.bucketInstanceId,gh,Ah.ID),_e)){const wh=ct.bucketInstanceId;let Sh=this.collisionCircleArrays[wh];Sh===void 0&&(Sh=this.collisionCircleArrays[wh]=new rd);for(let Oh=0;Oh<pl.circles.length;Oh+=4)Sh.circles.push(pl.circles[Oh+0]),Sh.circles.push(pl.circles[Oh+1]),Sh.circles.push(pl.circles[Oh+2]),Sh.circles.push(pl.collisionDetected?1:0)}if(S.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(ct.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[S.crossTileID]=new Qh(ze||tp,kt||Vd,vi||ct.justReloaded),A[S.crossTileID]=!0};if(Hd){if(g.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const S=ct.getSortedSymbolIndexes(this.transform.angle);for(let X=S.length-1;X>=0;--X){const ze=S[X];p(ct.symbolInstances.get(ze),ct.collisionArrays[ze])}}else for(let S=g.symbolInstanceStart;S<g.symbolInstanceEnd;S++)p(ct.symbolInstances.get(S),ct.collisionArrays[S]);if(_e&&ct.bucketInstanceId in this.collisionCircleArrays){const S=this.collisionCircleArrays[ct.bucketInstanceId];s.invert(S.invProjMatrix,In),S.viewportMatrix=this.collisionIndex.getViewportMatrix()}ct.justReloaded=!1}markUsedJustification(g,A,_e,ct){let pi;pi=ct===s.WritingMode.vertical?_e.verticalPlacedTextSymbolIndex:{left:_e.leftJustifiedTextSymbolIndex,center:_e.centerJustifiedTextSymbolIndex,right:_e.rightJustifiedTextSymbolIndex}[s.getAnchorJustification(A)];const In=[_e.leftJustifiedTextSymbolIndex,_e.centerJustifiedTextSymbolIndex,_e.rightJustifiedTextSymbolIndex,_e.verticalPlacedTextSymbolIndex];for(const ds of In)ds>=0&&(g.text.placedSymbolArray.get(ds).crossTileID=pi>=0&&ds!==pi?0:_e.crossTileID)}markUsedOrientation(g,A,_e){const ct=A===s.WritingMode.horizontal||A===s.WritingMode.horizontalOnly?A:0,pi=A===s.WritingMode.vertical?A:0,In=[_e.leftJustifiedTextSymbolIndex,_e.centerJustifiedTextSymbolIndex,_e.rightJustifiedTextSymbolIndex];for(const ds of In)g.text.placedSymbolArray.get(ds).placedOrientation=ct;_e.verticalPlacedTextSymbolIndex&&(g.text.placedSymbolArray.get(_e.verticalPlacedTextSymbolIndex).placedOrientation=pi)}commit(g){this.commitTime=g,this.zoomAtLastRecencyCheck=this.transform.zoom;const A=this.prevPlacement;let _e=!1;this.prevZoomAdjustment=A?A.zoomAdjustment(this.transform.zoom):0;const ct=A?A.symbolFadeChange(g):1,pi=A?A.opacities:{},In=A?A.variableOffsets:{},ds=A?A.placedOrientations:{};for(const hs in this.placements){const vs=this.placements[hs],fl=pi[hs];fl?(this.opacities[hs]=new Nh(fl,ct,vs.text,vs.icon),_e=_e||vs.text!==fl.text.placed||vs.icon!==fl.icon.placed):(this.opacities[hs]=new Nh(null,ct,vs.text,vs.icon,vs.skipFade),_e=_e||vs.text||vs.icon)}for(const hs in pi){const vs=pi[hs];if(!this.opacities[hs]){const fl=new Nh(vs,ct,!1,!1);fl.isHidden()||(this.opacities[hs]=fl,_e=_e||vs.text.placed||vs.icon.placed)}}for(const hs in In)this.variableOffsets[hs]||!this.opacities[hs]||this.opacities[hs].isHidden()||(this.variableOffsets[hs]=In[hs]);for(const hs in ds)this.placedOrientations[hs]||!this.opacities[hs]||this.opacities[hs].isHidden()||(this.placedOrientations[hs]=ds[hs]);if(A&&A.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");_e?this.lastPlacementChangeTime=g:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=A?A.lastPlacementChangeTime:g)}updateLayerOpacities(g,A){const _e={};for(const ct of A){const pi=ct.getBucket(g);pi&&ct.latestFeatureIndex&&g.id===pi.layerIds[0]&&this.updateBucketOpacities(pi,_e,ct.collisionBoxArray)}}updateBucketOpacities(g,A,_e){g.hasTextData()&&(g.text.opacityVertexArray.clear(),g.text.hasVisibleVertices=!1),g.hasIconData()&&(g.icon.opacityVertexArray.clear(),g.icon.hasVisibleVertices=!1),g.hasIconCollisionBoxData()&&g.iconCollisionBox.collisionVertexArray.clear(),g.hasTextCollisionBoxData()&&g.textCollisionBox.collisionVertexArray.clear();const ct=g.layers[0].layout,pi=new Nh(null,0,!1,!1,!0),In=ct.get("text-allow-overlap"),ds=ct.get("icon-allow-overlap"),hs=ct.get("text-variable-anchor"),vs=ct.get("text-rotation-alignment")==="map",fl=ct.get("text-pitch-alignment")==="map",dl=ct.get("icon-text-fit")!=="none",dh=new Nh(null,0,In&&(ds||!g.hasIconData()||ct.get("icon-optional")),ds&&(In||!g.hasTextData()||ct.get("text-optional")),!0);!g.collisionArrays&&_e&&(g.hasIconCollisionBoxData()||g.hasTextCollisionBoxData())&&g.deserializeCollisionBoxes(_e);const Ah=(hh,Rh,zh)=>{for(let Kh=0;Kh<Rh/4;Kh++)hh.opacityVertexArray.emplaceBack(zh);hh.hasVisibleVertices=hh.hasVisibleVertices||zh!==Bg};for(let hh=0;hh<g.symbolInstances.length;hh++){const Rh=g.symbolInstances.get(hh),{numHorizontalGlyphVertices:zh,numVerticalGlyphVertices:Kh,crossTileID:ad}=Rh;let Lh=this.opacities[ad];A[ad]?Lh=pi:Lh||(Lh=dh,this.opacities[ad]=Lh),A[ad]=!0;const od=Rh.numIconVertices>0,md=this.placedOrientations[Rh.crossTileID],Nd=md===s.WritingMode.vertical,Hd=md===s.WritingMode.horizontal||md===s.WritingMode.horizontalOnly;if(zh>0||Kh>0){const tp=o_(Lh.text);Ah(g.text,zh,Nd?Bg:tp),Ah(g.text,Kh,Hd?Bg:tp);const Vd=Lh.text.isHidden();[Rh.rightJustifiedTextSymbolIndex,Rh.centerJustifiedTextSymbolIndex,Rh.leftJustifiedTextSymbolIndex].forEach(p=>{p>=0&&(g.text.placedSymbolArray.get(p).hidden=Vd||Nd?1:0)}),Rh.verticalPlacedTextSymbolIndex>=0&&(g.text.placedSymbolArray.get(Rh.verticalPlacedTextSymbolIndex).hidden=Vd||Hd?1:0);const gp=this.variableOffsets[Rh.crossTileID];gp&&this.markUsedJustification(g,gp.anchor,Rh,md);const L=this.placedOrientations[Rh.crossTileID];L&&(this.markUsedJustification(g,"left",Rh,L),this.markUsedOrientation(g,L,Rh))}if(od){const tp=o_(Lh.icon),Vd=!(dl&&Rh.verticalPlacedIconSymbolIndex&&Nd);Rh.placedIconSymbolIndex>=0&&(Ah(g.icon,Rh.numIconVertices,Vd?tp:Bg),g.icon.placedSymbolArray.get(Rh.placedIconSymbolIndex).hidden=Lh.icon.isHidden()),Rh.verticalPlacedIconSymbolIndex>=0&&(Ah(g.icon,Rh.numVerticalIconVertices,Vd?Bg:tp),g.icon.placedSymbolArray.get(Rh.verticalPlacedIconSymbolIndex).hidden=Lh.icon.isHidden())}if(g.hasIconCollisionBoxData()||g.hasTextCollisionBoxData()){const tp=g.collisionArrays[hh];if(tp){let Vd=new s.Point(0,0);if(tp.textBox||tp.verticalTextBox){let L=!0;if(hs){const p=this.variableOffsets[ad];p?(Vd=Dp(p.anchor,p.width,p.height,p.textOffset,p.textBoxScale),vs&&Vd._rotate(fl?this.transform.angle:-this.transform.angle)):L=!1}tp.textBox&&pp(g.textCollisionBox.collisionVertexArray,Lh.text.placed,!L||Nd,Vd.x,Vd.y),tp.verticalTextBox&&pp(g.textCollisionBox.collisionVertexArray,Lh.text.placed,!L||Hd,Vd.x,Vd.y)}const gp=!!(!Hd&&tp.verticalIconBox);tp.iconBox&&pp(g.iconCollisionBox.collisionVertexArray,Lh.icon.placed,gp,dl?Vd.x:0,dl?Vd.y:0),tp.verticalIconBox&&pp(g.iconCollisionBox.collisionVertexArray,Lh.icon.placed,!gp,dl?Vd.x:0,dl?Vd.y:0)}}}if(g.sortFeatures(this.transform.angle),this.retainedQueryData[g.bucketInstanceId]&&(this.retainedQueryData[g.bucketInstanceId].featureSortOrder=g.featureSortOrder),g.hasTextData()&&g.text.opacityVertexBuffer&&g.text.opacityVertexBuffer.updateData(g.text.opacityVertexArray),g.hasIconData()&&g.icon.opacityVertexBuffer&&g.icon.opacityVertexBuffer.updateData(g.icon.opacityVertexArray),g.hasIconCollisionBoxData()&&g.iconCollisionBox.collisionVertexBuffer&&g.iconCollisionBox.collisionVertexBuffer.updateData(g.iconCollisionBox.collisionVertexArray),g.hasTextCollisionBoxData()&&g.textCollisionBox.collisionVertexBuffer&&g.textCollisionBox.collisionVertexBuffer.updateData(g.textCollisionBox.collisionVertexArray),g.text.opacityVertexArray.length!==g.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${g.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${g.text.layoutVertexArray.length}) / 4`);if(g.icon.opacityVertexArray.length!==g.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${g.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${g.icon.layoutVertexArray.length}) / 4`);if(g.bucketInstanceId in this.collisionCircleArrays){const hh=this.collisionCircleArrays[g.bucketInstanceId];g.placementInvProjMatrix=hh.invProjMatrix,g.placementViewportMatrix=hh.viewportMatrix,g.collisionCircleArray=hh.circles,delete this.collisionCircleArrays[g.bucketInstanceId]}}symbolFadeChange(g){return this.fadeDuration===0?1:(g-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(g){return Math.max(0,(this.transform.zoom-g)/1.5)}hasTransitions(g){return this.stale||g-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(g,A){const _e=this.zoomAtLastRecencyCheck===A?1-this.zoomAdjustment(A):1;return this.zoomAtLastRecencyCheck=A,this.commitTime+this.fadeDuration*_e>g}setStale(){this.stale=!0}}function pp(Ve,g,A,_e,ct){Ve.emplaceBack(g?1:0,A?1:0,_e||0,ct||0),Ve.emplaceBack(g?1:0,A?1:0,_e||0,ct||0),Ve.emplaceBack(g?1:0,A?1:0,_e||0,ct||0),Ve.emplaceBack(g?1:0,A?1:0,_e||0,ct||0)}const Wp=Math.pow(2,25),Vf=Math.pow(2,24),Wf=Math.pow(2,17),dg=Math.pow(2,16),Jp=Math.pow(2,9),Yp=Math.pow(2,8),Cg=Math.pow(2,1);function o_(Ve){if(Ve.opacity===0&&!Ve.placed)return 0;if(Ve.opacity===1&&Ve.placed)return 4294967295;const g=Ve.placed?1:0,A=Math.floor(127*Ve.opacity);return A*Wp+g*Vf+A*Wf+g*dg+A*Jp+g*Yp+A*Cg+g}const Bg=0;class Xg{constructor(g){this._sortAcrossTiles=g.layout.get("symbol-z-order")!=="viewport-y"&&!g.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(g,A,_e,ct,pi){const In=this._bucketParts;for(;this._currentTileIndex<g.length;)if(A.getBucketParts(In,ct,g[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,pi())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,In.sort((ds,hs)=>ds.sortKey-hs.sortKey));this._currentPartIndex<In.length;)if(A.placeLayerBucketPart(In[this._currentPartIndex],this._seenCrossTileIDs,_e),this._currentPartIndex++,pi())return!0;return!1}}class nm{constructor(g,A,_e,ct,pi,In,ds,hs){this.placement=new wp(g,A,In,ds,hs),this._currentPlacementIndex=_e.length-1,this._forceFullPlacement=ct,this._showCollisionBoxes=pi,this._done=!1}isDone(){return this._done}continuePlacement(g,A,_e){const ct=s.exported.now(),pi=()=>!this._forceFullPlacement&&s.exported.now()-ct>2;for(;this._currentPlacementIndex>=0;){const In=A[g[this._currentPlacementIndex]],ds=this.placement.collisionIndex.transform.zoom;if(In.type==="symbol"&&(!In.minzoom||In.minzoom<=ds)&&(!In.maxzoom||In.maxzoom>ds)){if(this._inProgressLayer||(this._inProgressLayer=new Xg(In)),this._inProgressLayer.continuePlacement(_e[In.source],this.placement,this._showCollisionBoxes,In,pi))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(g){return this.placement.commit(g),this.placement}}const ly=512/s.EXTENT/2;class xv{constructor(g,A,_e){this.tileID=g,this.bucketInstanceId=_e,this._symbolsByKey={};const ct=new Map;for(let pi=0;pi<A.length;pi++){const In=A.get(pi),ds=In.key,hs=ct.get(ds);hs?hs.push(In):ct.set(ds,[In])}for(const[pi,In]of ct){const ds={positions:In.map(hs=>({x:Math.floor(hs.anchorX*ly),y:Math.floor(hs.anchorY*ly)})),crossTileIDs:In.map(hs=>hs.crossTileID)};if(ds.positions.length>128){const hs=new s.KDBush(ds.positions.length,16,Uint16Array);for(const{x:vs,y:fl}of ds.positions)hs.add(vs,fl);hs.finish(),delete ds.positions,ds.index=hs}this._symbolsByKey[pi]=ds}}getScaledCoordinates(g,A){const{x:_e,y:ct,z:pi}=this.tileID.canonical,{x:In,y:ds,z:hs}=A.canonical,vs=ly/Math.pow(2,hs-pi),fl=(ds*s.EXTENT+g.anchorY)*vs,dl=ct*s.EXTENT*ly;return{x:Math.floor((In*s.EXTENT+g.anchorX)*vs-_e*s.EXTENT*ly),y:Math.floor(fl-dl)}}findMatches(g,A,_e){const ct=this.tileID.canonical.z<A.canonical.z?1:Math.pow(2,this.tileID.canonical.z-A.canonical.z);for(let pi=0;pi<g.length;pi++){const In=g.get(pi);if(In.crossTileID)continue;const ds=this._symbolsByKey[In.key];if(!ds)continue;const hs=this.getScaledCoordinates(In,A);if(ds.index){const vs=ds.index.range(hs.x-ct,hs.y-ct,hs.x+ct,hs.y+ct).sort();for(const fl of vs){const dl=ds.crossTileIDs[fl];if(!_e[dl]){_e[dl]=!0,In.crossTileID=dl;break}}}else if(ds.positions)for(let vs=0;vs<ds.positions.length;vs++){const fl=ds.positions[vs],dl=ds.crossTileIDs[vs];if(Math.abs(fl.x-hs.x)<=ct&&Math.abs(fl.y-hs.y)<=ct&&!_e[dl]){_e[dl]=!0,In.crossTileID=dl;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:g})=>g)}}class Dg{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class s_{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(g){const A=Math.round((g-this.lng)/360);if(A!==0)for(const _e in this.indexes){const ct=this.indexes[_e],pi={};for(const In in ct){const ds=ct[In];ds.tileID=ds.tileID.unwrapTo(ds.tileID.wrap+A),pi[ds.tileID.key]=ds}this.indexes[_e]=pi}this.lng=g}addBucket(g,A,_e){if(this.indexes[g.overscaledZ]&&this.indexes[g.overscaledZ][g.key]){if(this.indexes[g.overscaledZ][g.key].bucketInstanceId===A.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(g.overscaledZ,this.indexes[g.overscaledZ][g.key])}for(let pi=0;pi<A.symbolInstances.length;pi++)A.symbolInstances.get(pi).crossTileID=0;this.usedCrossTileIDs[g.overscaledZ]||(this.usedCrossTileIDs[g.overscaledZ]={});const ct=this.usedCrossTileIDs[g.overscaledZ];for(const pi in this.indexes){const In=this.indexes[pi];if(Number(pi)>g.overscaledZ)for(const ds in In){const hs=In[ds];hs.tileID.isChildOf(g)&&hs.findMatches(A.symbolInstances,g,ct)}else{const ds=In[g.scaledTo(Number(pi)).key];ds&&ds.findMatches(A.symbolInstances,g,ct)}}for(let pi=0;pi<A.symbolInstances.length;pi++){const In=A.symbolInstances.get(pi);In.crossTileID||(In.crossTileID=_e.generate(),ct[In.crossTileID]=!0)}return this.indexes[g.overscaledZ]===void 0&&(this.indexes[g.overscaledZ]={}),this.indexes[g.overscaledZ][g.key]=new xv(g,A.symbolInstances,A.bucketInstanceId),!0}removeBucketCrossTileIDs(g,A){for(const _e of A.getCrossTileIDsLists())for(const ct of _e)delete this.usedCrossTileIDs[g][ct]}removeStaleBuckets(g){let A=!1;for(const _e in this.indexes){const ct=this.indexes[_e];for(const pi in ct)g[ct[pi].bucketInstanceId]||(this.removeBucketCrossTileIDs(_e,ct[pi]),delete ct[pi],A=!0)}return A}}class f_{constructor(){this.layerIndexes={},this.crossTileIDs=new Dg,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(g,A,_e){let ct=this.layerIndexes[g.id];ct===void 0&&(ct=this.layerIndexes[g.id]=new s_);let pi=!1;const In={};ct.handleWrapJump(_e);for(const ds of A){const hs=ds.getBucket(g);hs&&g.id===hs.layerIds[0]&&(hs.bucketInstanceId||(hs.bucketInstanceId=++this.maxBucketInstanceId),ct.addBucket(ds.tileID,hs,this.crossTileIDs)&&(pi=!0),In[hs.bucketInstanceId]=!0)}return ct.removeStaleBuckets(In)&&(pi=!0),pi}pruneUnusedLayers(g){const A={};g.forEach(_e=>{A[_e]=!0});for(const _e in this.layerIndexes)A[_e]||delete this.layerIndexes[_e]}}const hd=(Ve,g)=>s.emitValidationErrors(Ve,g&&g.filter(A=>A.identifier!=="source.canvas")),g_=s.pick(s.operations,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),xg=s.pick(s.operations,["setCenter","setZoom","setBearing","setPitch"]),hm=s.emptyStyle();class xm extends s.Evented{constructor(g,A={}){super(),this.map=g,this.dispatcher=new wd(Ep(),this,g._getMapId()),this.imageManager=new bh,this.imageManager.setEventedParent(this),this.glyphManager=new Td(g._requestManager,A.localIdeographFontFamily),this.lineAtlas=new Xd(256,512),this.crossTileSymbolIndex=new f_,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());const _e=this;this._rtlTextPluginCallback=xm.registerForPluginStateChange(ct=>{_e.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:ct.pluginStatus,pluginURL:ct.pluginURL},(pi,In)=>{if(s.triggerPluginCompletionEvent(pi),In&&In.every(ds=>ds))for(const ds in _e.sourceCaches){const hs=_e.sourceCaches[ds].getSource().type;hs!=="vector"&&hs!=="geojson"||_e.sourceCaches[ds].reload()}})}),this.on("data",ct=>{if(ct.dataType!=="source"||ct.sourceDataType!=="metadata")return;const pi=this.sourceCaches[ct.sourceId];if(!pi)return;const In=pi.getSource();if(In&&In.vectorLayerIds)for(const ds in this._layers){const hs=this._layers[ds];hs.source===In.id&&this._validateLayer(hs)}})}loadURL(g,A={},_e){this.fire(new s.Event("dataloading",{dataType:"style"})),A.validate=typeof A.validate!="boolean"||A.validate;const ct=this.map._requestManager.transformRequest(g,Bn.Style);this._request=s.getJSON(ct,(pi,In)=>{this._request=null,pi?this.fire(new s.ErrorEvent(pi)):In&&this._load(In,A,_e)})}loadJSON(g,A={},_e){this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.exported.frame(()=>{this._request=null,A.validate=A.validate!==!1,this._load(g,A,_e)})}loadEmpty(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(hm,{validate:!1})}_load(g,A,_e){const ct=A.transformStyle?A.transformStyle(_e,g):g;if(!A.validate||!hd(this,s.validateStyle(ct))){this._loaded=!0,this.stylesheet=ct;for(const pi in ct.sources)this.addSource(pi,ct.sources[pi],{validate:!1});ct.sprite?this._loadSprite(ct.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(ct.glyphs),this._createLayers(),this.light=new Ud(this.stylesheet.light),this.map.setTerrain(this.stylesheet.terrain),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}}_createLayers(){const g=s.derefLayers(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",g),this._order=g.map(A=>A.id),this._layers={},this._serializedLayers=null;for(const A of g){const _e=s.createStyleLayer(A);_e.setEventedParent(this,{layer:{id:A.id}}),this._layers[A.id]=_e}}_loadSprite(g,A=!1,_e=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(ct,pi,In,ds){const hs=ll(ct),vs=hs.length,fl=In>1?"@2x":"",dl={},dh={},Ah={};for(const{id:hh,url:Rh}of hs){const zh=pi.transformRequest(pi.normalizeSpriteURL(Rh,fl,".json"),Bn.SpriteJSON),Kh=`${hh}_${zh.url}`;dl[Kh]=s.getJSON(zh,(od,md)=>{delete dl[Kh],dh[hh]=md,rl(ds,dh,Ah,od,vs)});const ad=pi.transformRequest(pi.normalizeSpriteURL(Rh,fl,".png"),Bn.SpriteImage),Lh=`${hh}_${ad.url}`;dl[Lh]=Vn.getImage(ad,(od,md)=>{delete dl[Lh],Ah[hh]=md,rl(ds,dh,Ah,od,vs)})}return{cancel(){for(const hh of Object.values(dl))hh.cancel()}}}(g,this.map._requestManager,this.map.getPixelRatio(),(ct,pi)=>{if(this._spriteRequest=null,ct)this.fire(new s.ErrorEvent(ct));else if(pi)for(const In in pi){this._spritesImagesIds[In]=[];const ds=this._spritesImagesIds[In]?this._spritesImagesIds[In].filter(hs=>!(hs in pi)):[];for(const hs of ds)this.imageManager.removeImage(hs),this._changedImages[hs]=!0;for(const hs in pi[In]){const vs=In==="default"?hs:`${In}:${hs}`;this._spritesImagesIds[In].push(vs),vs in this.imageManager.images?this.imageManager.updateImage(vs,pi[In][hs],!1):this.imageManager.addImage(vs,pi[In][hs]),A&&(this._changedImages[vs]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),A&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"})),_e&&_e(ct)})}_unloadSprite(){for(const g of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(g),this._changedImages[g]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}_validateLayer(g){const A=this.sourceCaches[g.source];if(!A)return;const _e=g.sourceLayer;if(!_e)return;const ct=A.getSource();(ct.type==="geojson"||ct.vectorLayerIds&&ct.vectorLayerIds.indexOf(_e)===-1)&&this.fire(new s.ErrorEvent(new Error(`Source layer "${_e}" does not exist on source "${ct.id}" as specified by style layer "${g.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const g in this.sourceCaches)if(!this.sourceCaches[g].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(g){const A=this._serializedAllLayers();if(!g||g.length===0)return Object.values(A);const _e=[];for(const ct of g)A[ct]&&_e.push(A[ct]);return _e}_serializedAllLayers(){let g=this._serializedLayers;if(g)return g;g=this._serializedLayers={};const A=Object.keys(this._layers);for(const _e of A){const ct=this._layers[_e];ct.type!=="custom"&&(g[_e]=ct.serialize())}return g}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const g in this.sourceCaches)if(this.sourceCaches[g].hasTransition())return!0;for(const g in this._layers)if(this._layers[g].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(g){if(!this._loaded)return;const A=this._changed;if(this._changed){const ct=Object.keys(this._updatedLayers),pi=Object.keys(this._removedLayers);(ct.length||pi.length)&&this._updateWorkerLayers(ct,pi);for(const In in this._updatedSources){const ds=this._updatedSources[In];if(ds==="reload")this._reloadSource(In);else{if(ds!=="clear")throw new Error(`Invalid action ${ds}`);this._clearSource(In)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const In in this._updatedPaintProps)this._layers[In].updateTransitions(g);this.light.updateTransitions(g),this._resetUpdates()}const _e={};for(const ct in this.sourceCaches){const pi=this.sourceCaches[ct];_e[ct]=pi.used,pi.used=!1}for(const ct of this._order){const pi=this._layers[ct];pi.recalculate(g,this._availableImages),!pi.isHidden(g.zoom)&&pi.source&&(this.sourceCaches[pi.source].used=!0)}for(const ct in _e){const pi=this.sourceCaches[ct];_e[ct]!==pi.used&&pi.fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:ct}))}this.light.recalculate(g),this.z=g.zoom,A&&this.fire(new s.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const g=Object.keys(this._changedImages);if(g.length){for(const A in this.sourceCaches)this.sourceCaches[A].reloadTilesForDependencies(["icons","patterns"],g);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const g in this.sourceCaches)this.sourceCaches[g].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(g,A){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(g),removedIds:A})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(g,A={}){this._checkLoaded();const _e=this.serialize();if(g=A.transformStyle?A.transformStyle(_e,g):g,hd(this,s.validateStyle(g)))return!1;(g=s.clone$1(g)).layers=s.derefLayers(g.layers);const ct=s.diffStyles(_e,g).filter(In=>!(In.command in xg));if(ct.length===0)return!1;const pi=ct.filter(In=>!(In.command in g_));if(pi.length>0)throw new Error(`Unimplemented: ${pi.map(In=>In.command).join(", ")}.`);for(const In of ct)In.command!=="setTransition"&&this[In.command].apply(this,In.args);return this.stylesheet=g,!0}addImage(g,A){if(this.getImage(g))return this.fire(new s.ErrorEvent(new Error(`An image named "${g}" already exists.`)));this.imageManager.addImage(g,A),this._afterImageUpdated(g)}updateImage(g,A){this.imageManager.updateImage(g,A)}getImage(g){return this.imageManager.getImage(g)}removeImage(g){if(!this.getImage(g))return this.fire(new s.ErrorEvent(new Error(`An image named "${g}" does not exist.`)));this.imageManager.removeImage(g),this._afterImageUpdated(g)}_afterImageUpdated(g){this._availableImages=this.imageManager.listImages(),this._changedImages[g]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(g,A,_e={}){if(this._checkLoaded(),this.sourceCaches[g]!==void 0)throw new Error(`Source "${g}" already exists.`);if(!A.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(A).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(A.type)>=0&&this._validate(s.validateStyle.source,`sources.${g}`,A,null,_e))return;this.map&&this.map._collectResourceTiming&&(A.collectResourceTiming=!0);const ct=this.sourceCaches[g]=new _p(g,A,this.dispatcher);ct.style=this,ct.setEventedParent(this,()=>({isSourceLoaded:ct.loaded(),source:ct.serialize(),sourceId:g})),ct.onAdd(this.map),this._changed=!0}removeSource(g){if(this._checkLoaded(),this.sourceCaches[g]===void 0)throw new Error("There is no source with this ID");for(const _e in this._layers)if(this._layers[_e].source===g)return this.fire(new s.ErrorEvent(new Error(`Source "${g}" cannot be removed while layer "${_e}" is using it.`)));const A=this.sourceCaches[g];delete this.sourceCaches[g],delete this._updatedSources[g],A.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:g})),A.setEventedParent(null),A.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(g,A){if(this._checkLoaded(),this.sourceCaches[g]===void 0)throw new Error(`There is no source with this ID=${g}`);const _e=this.sourceCaches[g].getSource();if(_e.type!=="geojson")throw new Error(`geojsonSource.type is ${_e.type}, which is !== 'geojson`);_e.setData(A),this._changed=!0}getSource(g){return this.sourceCaches[g]&&this.sourceCaches[g].getSource()}addLayer(g,A,_e={}){this._checkLoaded();const ct=g.id;if(this.getLayer(ct))return void this.fire(new s.ErrorEvent(new Error(`Layer "${ct}" already exists on this map.`)));let pi;if(g.type==="custom"){if(hd(this,s.validateCustomStyleLayer(g)))return;pi=s.createStyleLayer(g)}else{if(typeof g.source=="object"&&(this.addSource(ct,g.source),g=s.clone$1(g),g=s.extend(g,{source:ct})),this._validate(s.validateStyle.layer,`layers.${ct}`,g,{arrayIndex:-1},_e))return;pi=s.createStyleLayer(g),this._validateLayer(pi),pi.setEventedParent(this,{layer:{id:ct}})}const In=A?this._order.indexOf(A):this._order.length;if(A&&In===-1)this.fire(new s.ErrorEvent(new Error(`Cannot add layer "${ct}" before non-existing layer "${A}".`)));else{if(this._order.splice(In,0,ct),this._layerOrderChanged=!0,this._layers[ct]=pi,this._removedLayers[ct]&&pi.source&&pi.type!=="custom"){const ds=this._removedLayers[ct];delete this._removedLayers[ct],ds.type!==pi.type?this._updatedSources[pi.source]="clear":(this._updatedSources[pi.source]="reload",this.sourceCaches[pi.source].pause())}this._updateLayer(pi),pi.onAdd&&pi.onAdd(this.map)}}moveLayer(g,A){if(this._checkLoaded(),this._changed=!0,!this._layers[g])return void this.fire(new s.ErrorEvent(new Error(`The layer '${g}' does not exist in the map's style and cannot be moved.`)));if(g===A)return;const _e=this._order.indexOf(g);this._order.splice(_e,1);const ct=A?this._order.indexOf(A):this._order.length;A&&ct===-1?this.fire(new s.ErrorEvent(new Error(`Cannot move layer "${g}" before non-existing layer "${A}".`))):(this._order.splice(ct,0,g),this._layerOrderChanged=!0)}removeLayer(g){this._checkLoaded();const A=this._layers[g];if(!A)return void this.fire(new s.ErrorEvent(new Error(`Cannot remove non-existing layer "${g}".`)));A.setEventedParent(null);const _e=this._order.indexOf(g);this._order.splice(_e,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[g]=A,delete this._layers[g],this._serializedLayers&&delete this._serializedLayers[g],delete this._updatedLayers[g],delete this._updatedPaintProps[g],A.onRemove&&A.onRemove(this.map)}getLayer(g){return this._layers[g]}hasLayer(g){return g in this._layers}setLayerZoomRange(g,A,_e){this._checkLoaded();const ct=this.getLayer(g);ct?ct.minzoom===A&&ct.maxzoom===_e||(A!=null&&(ct.minzoom=A),_e!=null&&(ct.maxzoom=_e),this._updateLayer(ct)):this.fire(new s.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${g}".`)))}setFilter(g,A,_e={}){this._checkLoaded();const ct=this.getLayer(g);if(ct){if(!s.deepEqual(ct.filter,A))return A==null?(ct.filter=void 0,void this._updateLayer(ct)):void(this._validate(s.validateStyle.filter,`layers.${ct.id}.filter`,A,null,_e)||(ct.filter=s.clone$1(A),this._updateLayer(ct)))}else this.fire(new s.ErrorEvent(new Error(`Cannot filter non-existing layer "${g}".`)))}getFilter(g){return s.clone$1(this.getLayer(g).filter)}setLayoutProperty(g,A,_e,ct={}){this._checkLoaded();const pi=this.getLayer(g);pi?s.deepEqual(pi.getLayoutProperty(A),_e)||(pi.setLayoutProperty(A,_e,ct),this._updateLayer(pi)):this.fire(new s.ErrorEvent(new Error(`Cannot style non-existing layer "${g}".`)))}getLayoutProperty(g,A){const _e=this.getLayer(g);if(_e)return _e.getLayoutProperty(A);this.fire(new s.ErrorEvent(new Error(`Cannot get style of non-existing layer "${g}".`)))}setPaintProperty(g,A,_e,ct={}){this._checkLoaded();const pi=this.getLayer(g);pi?s.deepEqual(pi.getPaintProperty(A),_e)||(pi.setPaintProperty(A,_e,ct)&&this._updateLayer(pi),this._changed=!0,this._updatedPaintProps[g]=!0):this.fire(new s.ErrorEvent(new Error(`Cannot style non-existing layer "${g}".`)))}getPaintProperty(g,A){return this.getLayer(g).getPaintProperty(A)}setFeatureState(g,A){this._checkLoaded();const _e=g.source,ct=g.sourceLayer,pi=this.sourceCaches[_e];if(pi===void 0)return void this.fire(new s.ErrorEvent(new Error(`The source '${_e}' does not exist in the map's style.`)));const In=pi.getSource().type;In==="geojson"&&ct?this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):In!=="vector"||ct?(g.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),pi.setFeatureState(ct,g.id,A)):this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(g,A){this._checkLoaded();const _e=g.source,ct=this.sourceCaches[_e];if(ct===void 0)return void this.fire(new s.ErrorEvent(new Error(`The source '${_e}' does not exist in the map's style.`)));const pi=ct.getSource().type,In=pi==="vector"?g.sourceLayer:void 0;pi!=="vector"||In?A&&typeof g.id!="string"&&typeof g.id!="number"?this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):ct.removeFeatureState(In,g.id,A):this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(g){this._checkLoaded();const A=g.source,_e=g.sourceLayer,ct=this.sourceCaches[A];if(ct!==void 0)return ct.getSource().type!=="vector"||_e?(g.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),ct.getFeatureState(_e,g.id)):void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.ErrorEvent(new Error(`The source '${A}' does not exist in the map's style.`)))}getTransition(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const g=s.mapObject(this.sourceCaches,ct=>ct.serialize()),A=this._serializeByIds(this._order),_e=this.stylesheet;return s.filterObject({version:_e.version,name:_e.name,metadata:_e.metadata,light:_e.light,center:_e.center,zoom:_e.zoom,bearing:_e.bearing,pitch:_e.pitch,sprite:_e.sprite,glyphs:_e.glyphs,transition:_e.transition,sources:g,layers:A},ct=>ct!==void 0)}_updateLayer(g){this._updatedLayers[g.id]=!0,g.source&&!this._updatedSources[g.source]&&this.sourceCaches[g.source].getSource().type!=="raster"&&(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(g){const A=In=>this._layers[In].type==="fill-extrusion",_e={},ct=[];for(let In=this._order.length-1;In>=0;In--){const ds=this._order[In];if(A(ds)){_e[ds]=In;for(const hs of g){const vs=hs[ds];if(vs)for(const fl of vs)ct.push(fl)}}}ct.sort((In,ds)=>ds.intersectionZ-In.intersectionZ);const pi=[];for(let In=this._order.length-1;In>=0;In--){const ds=this._order[In];if(A(ds))for(let hs=ct.length-1;hs>=0;hs--){const vs=ct[hs].feature;if(_e[vs.layer.id]<In)break;pi.push(vs),ct.pop()}else for(const hs of g){const vs=hs[ds];if(vs)for(const fl of vs)pi.push(fl.feature)}}return pi}queryRenderedFeatures(g,A,_e){A&&A.filter&&this._validate(s.validateStyle.filter,"queryRenderedFeatures.filter",A.filter,null,A);const ct={};if(A&&A.layers){if(!Array.isArray(A.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const ds of A.layers){const hs=this._layers[ds];if(!hs)return this.fire(new s.ErrorEvent(new Error(`The layer '${ds}' does not exist in the map's style and cannot be queried for features.`))),[];ct[hs.source]=!0}}const pi=[];A.availableImages=this._availableImages;const In=this._serializedAllLayers();for(const ds in this.sourceCaches)A.layers&&!ct[ds]||pi.push(up(this.sourceCaches[ds],this._layers,In,g,A,_e));return this.placement&&pi.push(function(ds,hs,vs,fl,dl,dh,Ah){const hh={},Rh=dh.queryRenderedSymbols(fl),zh=[];for(const Kh of Object.keys(Rh).map(Number))zh.push(Ah[Kh]);zh.sort(rp);for(const Kh of zh){const ad=Kh.featureIndex.lookupSymbolFeatures(Rh[Kh.bucketInstanceId],hs,Kh.bucketIndex,Kh.sourceLayerIndex,dl.filter,dl.layers,dl.availableImages,ds);for(const Lh in ad){const od=hh[Lh]=hh[Lh]||[],md=ad[Lh];md.sort((Nd,Hd)=>{const tp=Kh.featureSortOrder;if(tp){const Vd=tp.indexOf(Nd.featureIndex);return tp.indexOf(Hd.featureIndex)-Vd}return Hd.featureIndex-Nd.featureIndex});for(const Nd of md)od.push(Nd)}}for(const Kh in hh)hh[Kh].forEach(ad=>{const Lh=ad.feature,od=vs[ds[Kh].source].getFeatureState(Lh.layer["source-layer"],Lh.id);Lh.source=Lh.layer.source,Lh.layer["source-layer"]&&(Lh.sourceLayer=Lh.layer["source-layer"]),Lh.state=od});return hh}(this._layers,In,this.sourceCaches,g,A,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(pi)}querySourceFeatures(g,A){A&&A.filter&&this._validate(s.validateStyle.filter,"querySourceFeatures.filter",A.filter,null,A);const _e=this.sourceCaches[g];return _e?function(ct,pi){const In=ct.getRenderableIds().map(vs=>ct.getTileByID(vs)),ds=[],hs={};for(let vs=0;vs<In.length;vs++){const fl=In[vs],dl=fl.tileID.canonical.key;hs[dl]||(hs[dl]=!0,fl.querySourceFeatures(ds,pi))}return ds}(_e,A):[]}addSourceType(g,A,_e){return xm.getSourceType(g)?_e(new Error(`A source type called "${g}" already exists.`)):(xm.setSourceType(g,A),A.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:g,url:A.workerSourceURL},_e):_e(null,null))}getLight(){return this.light.getLight()}setLight(g,A={}){this._checkLoaded();const _e=this.light.getLight();let ct=!1;for(const In in g)if(!s.deepEqual(g[In],_e[In])){ct=!0;break}if(!ct)return;const pi={now:s.exported.now(),transition:s.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(g,A),this.light.updateTransitions(pi)}_validate(g,A,_e,ct,pi={}){return(!pi||pi.validate!==!1)&&hd(this,g.call(s.validateStyle,s.extend({key:A,style:this.serialize(),value:_e,styleSpec:s.v8Spec},ct)))}_remove(g=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const A in this._layers)this._layers[A].setEventedParent(null);for(const A in this.sourceCaches){const _e=this.sourceCaches[A];_e.setEventedParent(null),_e.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(g)}_clearSource(g){this.sourceCaches[g].clearTiles()}_reloadSource(g){this.sourceCaches[g].resume(),this.sourceCaches[g].reload()}_updateSources(g){for(const A in this.sourceCaches)this.sourceCaches[A].update(g,this.map.terrain)}_generateCollisionBoxes(){for(const g in this.sourceCaches)this._reloadSource(g)}_updatePlacement(g,A,_e,ct,pi=!1){let In=!1,ds=!1;const hs={};for(const vs of this._order){const fl=this._layers[vs];if(fl.type!=="symbol")continue;if(!hs[fl.source]){const dh=this.sourceCaches[fl.source];hs[fl.source]=dh.getRenderableIds(!0).map(Ah=>dh.getTileByID(Ah)).sort((Ah,hh)=>hh.tileID.overscaledZ-Ah.tileID.overscaledZ||(Ah.tileID.isLessThan(hh.tileID)?-1:1))}const dl=this.crossTileSymbolIndex.addLayer(fl,hs[fl.source],g.center.lng);In=In||dl}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((pi=pi||this._layerOrderChanged||_e===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.exported.now(),g.zoom))&&(this.pauseablePlacement=new nm(g,this.map.terrain,this._order,pi,A,_e,ct,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,hs),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.exported.now()),ds=!0),In&&this.pauseablePlacement.placement.setStale()),ds||In)for(const vs of this._order){const fl=this._layers[vs];fl.type==="symbol"&&this.placement.updateLayerOpacities(fl,hs[fl.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.exported.now())}_releaseSymbolFadeTiles(){for(const g in this.sourceCaches)this.sourceCaches[g].releaseSymbolFadeTiles()}getImages(g,A,_e){this.imageManager.getImages(A.icons,_e),this._updateTilesForChangedImages();const ct=this.sourceCaches[A.source];ct&&ct.setDependencies(A.tileID.key,A.type,A.icons)}getGlyphs(g,A,_e){this.glyphManager.getGlyphs(A.stacks,_e);const ct=this.sourceCaches[A.source];ct&&ct.setDependencies(A.tileID.key,A.type,[""])}getResource(g,A,_e){return s.makeRequest(A,_e)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(g,A={}){this._checkLoaded(),g&&this._validate(s.validateStyle.glyphs,"glyphs",g,null,A)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=g,this.glyphManager.entries={},this.glyphManager.setURL(g))}addSprite(g,A,_e={},ct){this._checkLoaded();const pi=[{id:g,url:A}],In=[...ll(this.stylesheet.sprite),...pi];this._validate(s.validateStyle.sprite,"sprite",In,null,_e)||(this.stylesheet.sprite=In,this._loadSprite(pi,!0,ct))}removeSprite(g){this._checkLoaded();const A=ll(this.stylesheet.sprite);if(A.find(_e=>_e.id===g)){if(this._spritesImagesIds[g])for(const _e of this._spritesImagesIds[g])this.imageManager.removeImage(_e),this._changedImages[_e]=!0;A.splice(A.findIndex(_e=>_e.id===g),1),this.stylesheet.sprite=A.length>0?A:void 0,delete this._spritesImagesIds[g],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}else this.fire(new s.ErrorEvent(new Error(`Sprite "${g}" doesn't exists on this map.`)))}getSprite(){return ll(this.stylesheet.sprite)}setSprite(g,A={},_e){this._checkLoaded(),g&&this._validate(s.validateStyle.sprite,"sprite",g,null,A)||(this.stylesheet.sprite=g,g?this._loadSprite(g,!0,_e):(this._unloadSprite(),_e&&_e(null)))}}xm.getSourceType=function(Ve){return Ad[Ve]},xm.setSourceType=function(Ve,g){Ad[Ve]=g},xm.registerForPluginStateChange=s.registerForPluginStateChange;var m_=s.createLayout([{name:"a_pos",type:"Int16",components:2}]),wv="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const W_={prelude:lg(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:lg(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:lg(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:lg(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:lg("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:lg(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:lg(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:lg("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:lg("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:lg("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:lg(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:lg(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:lg(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:lg(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:lg(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:lg(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:lg(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:lg(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:lg(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:lg(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:lg(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:lg(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:lg(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:lg(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:lg(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:lg(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:lg("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",wv),terrainDepth:lg("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",wv),terrainCoords:lg("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",wv)};function lg(Ve,g){const A=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_e=g.match(/attribute ([\w]+) ([\w]+)/g),ct=Ve.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),pi=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),In=pi?pi.concat(ct):ct,ds={};return{fragmentSource:Ve=Ve.replace(A,(hs,vs,fl,dl,dh)=>(ds[dh]=!0,vs==="define"?`
#ifndef HAS_UNIFORM_u_${dh}
varying ${fl} ${dl} ${dh};
#else
uniform ${fl} ${dl} u_${dh};
#endif
`:`
#ifdef HAS_UNIFORM_u_${dh}
    ${fl} ${dl} ${dh} = u_${dh};
#endif
`)),vertexSource:g=g.replace(A,(hs,vs,fl,dl,dh)=>{const Ah=dl==="float"?"vec2":"vec4",hh=dh.match(/color/)?"color":Ah;return ds[dh]?vs==="define"?`
#ifndef HAS_UNIFORM_u_${dh}
uniform lowp float u_${dh}_t;
attribute ${fl} ${Ah} a_${dh};
varying ${fl} ${dl} ${dh};
#else
uniform ${fl} ${dl} u_${dh};
#endif
`:hh==="vec4"?`
#ifndef HAS_UNIFORM_u_${dh}
    ${dh} = a_${dh};
#else
    ${fl} ${dl} ${dh} = u_${dh};
#endif
`:`
#ifndef HAS_UNIFORM_u_${dh}
    ${dh} = unpack_mix_${hh}(a_${dh}, u_${dh}_t);
#else
    ${fl} ${dl} ${dh} = u_${dh};
#endif
`:vs==="define"?`
#ifndef HAS_UNIFORM_u_${dh}
uniform lowp float u_${dh}_t;
attribute ${fl} ${Ah} a_${dh};
#else
uniform ${fl} ${dl} u_${dh};
#endif
`:hh==="vec4"?`
#ifndef HAS_UNIFORM_u_${dh}
    ${fl} ${dl} ${dh} = a_${dh};
#else
    ${fl} ${dl} ${dh} = u_${dh};
#endif
`:`
#ifndef HAS_UNIFORM_u_${dh}
    ${fl} ${dl} ${dh} = unpack_mix_${hh}(a_${dh}, u_${dh}_t);
#else
    ${fl} ${dl} ${dh} = u_${dh};
#endif
`}),staticAttributes:_e,staticUniforms:In}}class ap{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(g,A,_e,ct,pi,In,ds,hs,vs){this.context=g;let fl=this.boundPaintVertexBuffers.length!==ct.length;for(let dl=0;!fl&&dl<ct.length;dl++)this.boundPaintVertexBuffers[dl]!==ct[dl]&&(fl=!0);!this.vao||this.boundProgram!==A||this.boundLayoutVertexBuffer!==_e||fl||this.boundIndexBuffer!==pi||this.boundVertexOffset!==In||this.boundDynamicVertexBuffer!==ds||this.boundDynamicVertexBuffer2!==hs||this.boundDynamicVertexBuffer3!==vs?this.freshBind(A,_e,ct,pi,In,ds,hs,vs):(g.bindVertexArray.set(this.vao),ds&&ds.bind(),pi&&pi.dynamicDraw&&pi.bind(),hs&&hs.bind(),vs&&vs.bind())}freshBind(g,A,_e,ct,pi,In,ds,hs){const vs=g.numAttributes,fl=this.context,dl=fl.gl;this.vao&&this.destroy(),this.vao=fl.createVertexArray(),fl.bindVertexArray.set(this.vao),this.boundProgram=g,this.boundLayoutVertexBuffer=A,this.boundPaintVertexBuffers=_e,this.boundIndexBuffer=ct,this.boundVertexOffset=pi,this.boundDynamicVertexBuffer=In,this.boundDynamicVertexBuffer2=ds,this.boundDynamicVertexBuffer3=hs,A.enableAttributes(dl,g);for(const dh of _e)dh.enableAttributes(dl,g);In&&In.enableAttributes(dl,g),ds&&ds.enableAttributes(dl,g),hs&&hs.enableAttributes(dl,g),A.bind(),A.setVertexAttribPointers(dl,g,pi);for(const dh of _e)dh.bind(),dh.setVertexAttribPointers(dl,g,pi);In&&(In.bind(),In.setVertexAttribPointers(dl,g,pi)),ct&&ct.bind(),ds&&(ds.bind(),ds.setVertexAttribPointers(dl,g,pi)),hs&&(hs.bind(),hs.setVertexAttribPointers(dl,g,pi)),fl.currentNumAttributes=vs}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function qf(Ve){const g=[];for(let A=0;A<Ve.length;A++){if(Ve[A]===null)continue;const _e=Ve[A].split(" ");g.push(_e.pop())}return g}class jf{constructor(g,A,_e,ct,pi,In,ds){const hs=g.gl;this.program=hs.createProgram();const vs=qf(_e.staticAttributes),fl=ct?ct.getBinderAttributes():[],dl=vs.concat(fl),dh=W_.prelude.staticUniforms?qf(W_.prelude.staticUniforms):[],Ah=_e.staticUniforms?qf(_e.staticUniforms):[],hh=ct?ct.getBinderUniforms():[],Rh=dh.concat(Ah).concat(hh),zh=[];for(const Hd of Rh)zh.indexOf(Hd)<0&&zh.push(Hd);const Kh=ct?ct.defines():[];In&&Kh.push("#define OVERDRAW_INSPECTOR;"),ds&&Kh.push("#define TERRAIN3D;");const ad=Kh.concat(W_.prelude.fragmentSource,_e.fragmentSource).join(`
`),Lh=Kh.concat(W_.prelude.vertexSource,_e.vertexSource).join(`
`),od=hs.createShader(hs.FRAGMENT_SHADER);if(hs.isContextLost())return void(this.failedToCreate=!0);hs.shaderSource(od,ad),hs.compileShader(od),hs.attachShader(this.program,od);const md=hs.createShader(hs.VERTEX_SHADER);if(hs.isContextLost())return void(this.failedToCreate=!0);hs.shaderSource(md,Lh),hs.compileShader(md),hs.attachShader(this.program,md),this.attributes={};const Nd={};this.numAttributes=dl.length;for(let Hd=0;Hd<this.numAttributes;Hd++)dl[Hd]&&(hs.bindAttribLocation(this.program,Hd,dl[Hd]),this.attributes[dl[Hd]]=Hd);hs.linkProgram(this.program),hs.deleteShader(md),hs.deleteShader(od);for(let Hd=0;Hd<zh.length;Hd++){const tp=zh[Hd];if(tp&&!Nd[tp]){const Vd=hs.getUniformLocation(this.program,tp);Vd&&(Nd[tp]=Vd)}}this.fixedUniforms=pi(g,Nd),this.terrainUniforms=((Hd,tp)=>({u_depth:new s.Uniform1i(Hd,tp.u_depth),u_terrain:new s.Uniform1i(Hd,tp.u_terrain),u_terrain_dim:new s.Uniform1f(Hd,tp.u_terrain_dim),u_terrain_matrix:new s.UniformMatrix4f(Hd,tp.u_terrain_matrix),u_terrain_unpack:new s.Uniform4f(Hd,tp.u_terrain_unpack),u_terrain_exaggeration:new s.Uniform1f(Hd,tp.u_terrain_exaggeration)}))(g,Nd),this.binderUniforms=ct?ct.getUniforms(g,Nd):[]}draw(g,A,_e,ct,pi,In,ds,hs,vs,fl,dl,dh,Ah,hh,Rh,zh,Kh,ad){const Lh=g.gl;if(this.failedToCreate)return;if(g.program.set(this.program),g.setDepthMode(_e),g.setStencilMode(ct),g.setColorMode(pi),g.setCullFace(In),hs){g.activeTexture.set(Lh.TEXTURE2),Lh.bindTexture(Lh.TEXTURE_2D,hs.depthTexture),g.activeTexture.set(Lh.TEXTURE3),Lh.bindTexture(Lh.TEXTURE_2D,hs.texture);for(const md in this.terrainUniforms)this.terrainUniforms[md].set(hs[md])}for(const md in this.fixedUniforms)this.fixedUniforms[md].set(ds[md]);Rh&&Rh.setUniforms(g,this.binderUniforms,Ah,{zoom:hh});let od=0;switch(A){case Lh.LINES:od=2;break;case Lh.TRIANGLES:od=3;break;case Lh.LINE_STRIP:od=1}for(const md of dh.get()){const Nd=md.vaos||(md.vaos={});(Nd[vs]||(Nd[vs]=new ap)).bind(g,this,fl,Rh?Rh.getPaintVertexBuffers():[],dl,md.vertexOffset,zh,Kh,ad),Lh.drawElements(A,md.primitiveLength*od,Lh.UNSIGNED_SHORT,md.primitiveOffset*od*2)}}}function Wm(Ve,g,A){const _e=1/vh(A,1,g.transform.tileZoom),ct=Math.pow(2,A.tileID.overscaledZ),pi=A.tileSize*Math.pow(2,g.transform.tileZoom)/ct,In=pi*(A.tileID.canonical.x+A.tileID.wrap*ct),ds=pi*A.tileID.canonical.y;return{u_image:0,u_texsize:A.imageAtlasTexture.size,u_scale:[_e,Ve.fromScale,Ve.toScale],u_fade:Ve.t,u_pixel_coord_upper:[In>>16,ds>>16],u_pixel_coord_lower:[65535&In,65535&ds]}}const __=(Ve,g,A,_e)=>{const ct=g.style.light,pi=ct.properties.get("position"),In=[pi.x,pi.y,pi.z],ds=function(){var vs=new s.ARRAY_TYPE(9);return s.ARRAY_TYPE!=Float32Array&&(vs[1]=0,vs[2]=0,vs[3]=0,vs[5]=0,vs[6]=0,vs[7]=0),vs[0]=1,vs[4]=1,vs[8]=1,vs}();ct.properties.get("anchor")==="viewport"&&function(vs,fl){var dl=Math.sin(fl),dh=Math.cos(fl);vs[0]=dh,vs[1]=dl,vs[2]=0,vs[3]=-dl,vs[4]=dh,vs[5]=0,vs[6]=0,vs[7]=0,vs[8]=1}(ds,-g.transform.angle),function(vs,fl,dl){var dh=fl[0],Ah=fl[1],hh=fl[2];vs[0]=dh*dl[0]+Ah*dl[3]+hh*dl[6],vs[1]=dh*dl[1]+Ah*dl[4]+hh*dl[7],vs[2]=dh*dl[2]+Ah*dl[5]+hh*dl[8]}(In,In,ds);const hs=ct.properties.get("color");return{u_matrix:Ve,u_lightpos:In,u_lightintensity:ct.properties.get("intensity"),u_lightcolor:[hs.r,hs.g,hs.b],u_vertical_gradient:+A,u_opacity:_e}},Kf=(Ve,g,A,_e,ct,pi,In)=>s.extend(__(Ve,g,A,_e),Wm(pi,g,In),{u_height_factor:-Math.pow(2,ct.overscaledZ)/In.tileSize/8}),qm=Ve=>({u_matrix:Ve}),Ny=(Ve,g,A,_e)=>s.extend(qm(Ve),Wm(A,g,_e)),ky=(Ve,g)=>({u_matrix:Ve,u_world:g}),a_=(Ve,g,A,_e,ct)=>s.extend(Ny(Ve,g,A,_e),{u_world:ct}),Lg=(Ve,g,A,_e)=>{const ct=Ve.transform;let pi,In;if(_e.paint.get("circle-pitch-alignment")==="map"){const ds=vh(A,1,ct.zoom);pi=!0,In=[ds,ds]}else pi=!1,In=ct.pixelsToGLUnits;return{u_camera_to_center_distance:ct.cameraToCenterDistance,u_scale_with_map:+(_e.paint.get("circle-pitch-scale")==="map"),u_matrix:Ve.translatePosMatrix(g.posMatrix,A,_e.paint.get("circle-translate"),_e.paint.get("circle-translate-anchor")),u_pitch_with_map:+pi,u_device_pixel_ratio:Ve.pixelRatio,u_extrude_scale:In}},B0=(Ve,g,A)=>{const _e=vh(A,1,g.zoom),ct=Math.pow(2,g.zoom-A.tileID.overscaledZ),pi=A.tileID.overscaleFactor();return{u_matrix:Ve,u_camera_to_center_distance:g.cameraToCenterDistance,u_pixels_to_tile_units:_e,u_extrude_scale:[g.pixelsToGLUnits[0]/(_e*ct),g.pixelsToGLUnits[1]/(_e*ct)],u_overscale_factor:pi}},E_=(Ve,g,A=1)=>({u_matrix:Ve,u_color:g,u_overlay:0,u_overlay_scale:A}),By=Ve=>({u_matrix:Ve}),bv=(Ve,g,A,_e)=>({u_matrix:Ve,u_extrude_scale:vh(g,1,A),u_intensity:_e});function G0(Ve,g){const A=Math.pow(2,g.canonical.z),_e=g.canonical.y;return[new s.MercatorCoordinate(0,_e/A).toLngLat().lat,new s.MercatorCoordinate(0,(_e+1)/A).toLngLat().lat]}const O_=(Ve,g,A,_e)=>{const ct=Ve.transform;return{u_matrix:dm(Ve,g,A,_e),u_ratio:1/vh(g,1,ct.zoom),u_device_pixel_ratio:Ve.pixelRatio,u_units_to_pixels:[1/ct.pixelsToGLUnits[0],1/ct.pixelsToGLUnits[1]]}},cy=(Ve,g,A,_e,ct)=>s.extend(O_(Ve,g,A,ct),{u_image:0,u_image_height:_e}),Fm=(Ve,g,A,_e,ct)=>{const pi=Ve.transform,In=F_(g,pi);return{u_matrix:dm(Ve,g,A,ct),u_texsize:g.imageAtlasTexture.size,u_ratio:1/vh(g,1,pi.zoom),u_device_pixel_ratio:Ve.pixelRatio,u_image:0,u_scale:[In,_e.fromScale,_e.toScale],u_fade:_e.t,u_units_to_pixels:[1/pi.pixelsToGLUnits[0],1/pi.pixelsToGLUnits[1]]}},zy=(Ve,g,A,_e,ct,pi)=>{const In=Ve.lineAtlas,ds=F_(g,Ve.transform),hs=A.layout.get("line-cap")==="round",vs=In.getDash(_e.from,hs),fl=In.getDash(_e.to,hs),dl=vs.width*ct.fromScale,dh=fl.width*ct.toScale;return s.extend(O_(Ve,g,A,pi),{u_patternscale_a:[ds/dl,-vs.height/2],u_patternscale_b:[ds/dh,-fl.height/2],u_sdfgamma:In.width/(256*Math.min(dl,dh)*Ve.pixelRatio)/2,u_image:0,u_tex_y_a:vs.y,u_tex_y_b:fl.y,u_mix:ct.t})};function F_(Ve,g){return 1/vh(Ve,1,g.tileZoom)}function dm(Ve,g,A,_e){return Ve.translatePosMatrix(_e?_e.posMatrix:g.tileID.posMatrix,g,A.paint.get("line-translate"),A.paint.get("line-translate-anchor"))}const Gg=(Ve,g,A,_e,ct)=>{return{u_matrix:Ve,u_tl_parent:g,u_scale_parent:A,u_buffer_scale:1,u_fade_t:_e.mix,u_opacity:_e.opacity*ct.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:ct.paint.get("raster-brightness-min"),u_brightness_high:ct.paint.get("raster-brightness-max"),u_saturation_factor:(In=ct.paint.get("raster-saturation"),In>0?1-1/(1.001-In):-In),u_contrast_factor:(pi=ct.paint.get("raster-contrast"),pi>0?1/(1-pi):1+pi),u_spin_weights:Cv(ct.paint.get("raster-hue-rotate"))};var pi,In};function Cv(Ve){Ve*=Math.PI/180;const g=Math.sin(Ve),A=Math.cos(Ve);return[(2*A+1)/3,(-Math.sqrt(3)*g-A+1)/3,(Math.sqrt(3)*g-A+1)/3]}const uy=(Ve,g,A,_e,ct,pi,In,ds,hs,vs)=>{const fl=ct.transform;return{u_is_size_zoom_constant:+(Ve==="constant"||Ve==="source"),u_is_size_feature_constant:+(Ve==="constant"||Ve==="camera"),u_size_t:g?g.uSizeT:0,u_size:g?g.uSize:0,u_camera_to_center_distance:fl.cameraToCenterDistance,u_pitch:fl.pitch/360*2*Math.PI,u_rotate_symbol:+A,u_aspect_ratio:fl.width/fl.height,u_fade_change:ct.options.fadeDuration?ct.symbolFadeChange:1,u_matrix:pi,u_label_plane_matrix:In,u_coord_matrix:ds,u_is_text:+hs,u_pitch_with_map:+_e,u_texsize:vs,u_texture:0}},pm=(Ve,g,A,_e,ct,pi,In,ds,hs,vs,fl)=>{const dl=ct.transform;return s.extend(uy(Ve,g,A,_e,ct,pi,In,ds,hs,vs),{u_gamma_scale:_e?Math.cos(dl._pitch)*dl.cameraToCenterDistance:1,u_device_pixel_ratio:ct.pixelRatio,u_is_halo:+fl})},Vm=(Ve,g,A,_e,ct,pi,In,ds,hs,vs)=>s.extend(pm(Ve,g,A,_e,ct,pi,In,ds,!0,hs,!0),{u_texsize_icon:vs,u_texture_icon:1}),Km=(Ve,g,A)=>({u_matrix:Ve,u_opacity:g,u_color:A}),Em=(Ve,g,A,_e,ct,pi)=>s.extend(function(In,ds,hs,vs){const fl=hs.imageManager.getPattern(In.from.toString()),dl=hs.imageManager.getPattern(In.to.toString()),{width:dh,height:Ah}=hs.imageManager.getPixelSize(),hh=Math.pow(2,vs.tileID.overscaledZ),Rh=vs.tileSize*Math.pow(2,hs.transform.tileZoom)/hh,zh=Rh*(vs.tileID.canonical.x+vs.tileID.wrap*hh),Kh=Rh*vs.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:fl.tl,u_pattern_br_a:fl.br,u_pattern_tl_b:dl.tl,u_pattern_br_b:dl.br,u_texsize:[dh,Ah],u_mix:ds.t,u_pattern_size_a:fl.displaySize,u_pattern_size_b:dl.displaySize,u_scale_a:ds.fromScale,u_scale_b:ds.toScale,u_tile_units_to_pixels:1/vh(vs,1,hs.transform.tileZoom),u_pixel_coord_upper:[zh>>16,Kh>>16],u_pixel_coord_lower:[65535&zh,65535&Kh]}}(_e,pi,A,ct),{u_matrix:Ve,u_opacity:g}),zg={fillExtrusion:(Ve,g)=>({u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix),u_lightpos:new s.Uniform3f(Ve,g.u_lightpos),u_lightintensity:new s.Uniform1f(Ve,g.u_lightintensity),u_lightcolor:new s.Uniform3f(Ve,g.u_lightcolor),u_vertical_gradient:new s.Uniform1f(Ve,g.u_vertical_gradient),u_opacity:new s.Uniform1f(Ve,g.u_opacity)}),fillExtrusionPattern:(Ve,g)=>({u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix),u_lightpos:new s.Uniform3f(Ve,g.u_lightpos),u_lightintensity:new s.Uniform1f(Ve,g.u_lightintensity),u_lightcolor:new s.Uniform3f(Ve,g.u_lightcolor),u_vertical_gradient:new s.Uniform1f(Ve,g.u_vertical_gradient),u_height_factor:new s.Uniform1f(Ve,g.u_height_factor),u_image:new s.Uniform1i(Ve,g.u_image),u_texsize:new s.Uniform2f(Ve,g.u_texsize),u_pixel_coord_upper:new s.Uniform2f(Ve,g.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(Ve,g.u_pixel_coord_lower),u_scale:new s.Uniform3f(Ve,g.u_scale),u_fade:new s.Uniform1f(Ve,g.u_fade),u_opacity:new s.Uniform1f(Ve,g.u_opacity)}),fill:(Ve,g)=>({u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix)}),fillPattern:(Ve,g)=>({u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix),u_image:new s.Uniform1i(Ve,g.u_image),u_texsize:new s.Uniform2f(Ve,g.u_texsize),u_pixel_coord_upper:new s.Uniform2f(Ve,g.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(Ve,g.u_pixel_coord_lower),u_scale:new s.Uniform3f(Ve,g.u_scale),u_fade:new s.Uniform1f(Ve,g.u_fade)}),fillOutline:(Ve,g)=>({u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix),u_world:new s.Uniform2f(Ve,g.u_world)}),fillOutlinePattern:(Ve,g)=>({u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix),u_world:new s.Uniform2f(Ve,g.u_world),u_image:new s.Uniform1i(Ve,g.u_image),u_texsize:new s.Uniform2f(Ve,g.u_texsize),u_pixel_coord_upper:new s.Uniform2f(Ve,g.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(Ve,g.u_pixel_coord_lower),u_scale:new s.Uniform3f(Ve,g.u_scale),u_fade:new s.Uniform1f(Ve,g.u_fade)}),circle:(Ve,g)=>({u_camera_to_center_distance:new s.Uniform1f(Ve,g.u_camera_to_center_distance),u_scale_with_map:new s.Uniform1i(Ve,g.u_scale_with_map),u_pitch_with_map:new s.Uniform1i(Ve,g.u_pitch_with_map),u_extrude_scale:new s.Uniform2f(Ve,g.u_extrude_scale),u_device_pixel_ratio:new s.Uniform1f(Ve,g.u_device_pixel_ratio),u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix)}),collisionBox:(Ve,g)=>({u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix),u_camera_to_center_distance:new s.Uniform1f(Ve,g.u_camera_to_center_distance),u_pixels_to_tile_units:new s.Uniform1f(Ve,g.u_pixels_to_tile_units),u_extrude_scale:new s.Uniform2f(Ve,g.u_extrude_scale),u_overscale_factor:new s.Uniform1f(Ve,g.u_overscale_factor)}),collisionCircle:(Ve,g)=>({u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix),u_inv_matrix:new s.UniformMatrix4f(Ve,g.u_inv_matrix),u_camera_to_center_distance:new s.Uniform1f(Ve,g.u_camera_to_center_distance),u_viewport_size:new s.Uniform2f(Ve,g.u_viewport_size)}),debug:(Ve,g)=>({u_color:new s.UniformColor(Ve,g.u_color),u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix),u_overlay:new s.Uniform1i(Ve,g.u_overlay),u_overlay_scale:new s.Uniform1f(Ve,g.u_overlay_scale)}),clippingMask:(Ve,g)=>({u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix)}),heatmap:(Ve,g)=>({u_extrude_scale:new s.Uniform1f(Ve,g.u_extrude_scale),u_intensity:new s.Uniform1f(Ve,g.u_intensity),u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix)}),heatmapTexture:(Ve,g)=>({u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix),u_world:new s.Uniform2f(Ve,g.u_world),u_image:new s.Uniform1i(Ve,g.u_image),u_color_ramp:new s.Uniform1i(Ve,g.u_color_ramp),u_opacity:new s.Uniform1f(Ve,g.u_opacity)}),hillshade:(Ve,g)=>({u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix),u_image:new s.Uniform1i(Ve,g.u_image),u_latrange:new s.Uniform2f(Ve,g.u_latrange),u_light:new s.Uniform2f(Ve,g.u_light),u_shadow:new s.UniformColor(Ve,g.u_shadow),u_highlight:new s.UniformColor(Ve,g.u_highlight),u_accent:new s.UniformColor(Ve,g.u_accent)}),hillshadePrepare:(Ve,g)=>({u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix),u_image:new s.Uniform1i(Ve,g.u_image),u_dimension:new s.Uniform2f(Ve,g.u_dimension),u_zoom:new s.Uniform1f(Ve,g.u_zoom),u_unpack:new s.Uniform4f(Ve,g.u_unpack)}),line:(Ve,g)=>({u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix),u_ratio:new s.Uniform1f(Ve,g.u_ratio),u_device_pixel_ratio:new s.Uniform1f(Ve,g.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(Ve,g.u_units_to_pixels)}),lineGradient:(Ve,g)=>({u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix),u_ratio:new s.Uniform1f(Ve,g.u_ratio),u_device_pixel_ratio:new s.Uniform1f(Ve,g.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(Ve,g.u_units_to_pixels),u_image:new s.Uniform1i(Ve,g.u_image),u_image_height:new s.Uniform1f(Ve,g.u_image_height)}),linePattern:(Ve,g)=>({u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix),u_texsize:new s.Uniform2f(Ve,g.u_texsize),u_ratio:new s.Uniform1f(Ve,g.u_ratio),u_device_pixel_ratio:new s.Uniform1f(Ve,g.u_device_pixel_ratio),u_image:new s.Uniform1i(Ve,g.u_image),u_units_to_pixels:new s.Uniform2f(Ve,g.u_units_to_pixels),u_scale:new s.Uniform3f(Ve,g.u_scale),u_fade:new s.Uniform1f(Ve,g.u_fade)}),lineSDF:(Ve,g)=>({u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix),u_ratio:new s.Uniform1f(Ve,g.u_ratio),u_device_pixel_ratio:new s.Uniform1f(Ve,g.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(Ve,g.u_units_to_pixels),u_patternscale_a:new s.Uniform2f(Ve,g.u_patternscale_a),u_patternscale_b:new s.Uniform2f(Ve,g.u_patternscale_b),u_sdfgamma:new s.Uniform1f(Ve,g.u_sdfgamma),u_image:new s.Uniform1i(Ve,g.u_image),u_tex_y_a:new s.Uniform1f(Ve,g.u_tex_y_a),u_tex_y_b:new s.Uniform1f(Ve,g.u_tex_y_b),u_mix:new s.Uniform1f(Ve,g.u_mix)}),raster:(Ve,g)=>({u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix),u_tl_parent:new s.Uniform2f(Ve,g.u_tl_parent),u_scale_parent:new s.Uniform1f(Ve,g.u_scale_parent),u_buffer_scale:new s.Uniform1f(Ve,g.u_buffer_scale),u_fade_t:new s.Uniform1f(Ve,g.u_fade_t),u_opacity:new s.Uniform1f(Ve,g.u_opacity),u_image0:new s.Uniform1i(Ve,g.u_image0),u_image1:new s.Uniform1i(Ve,g.u_image1),u_brightness_low:new s.Uniform1f(Ve,g.u_brightness_low),u_brightness_high:new s.Uniform1f(Ve,g.u_brightness_high),u_saturation_factor:new s.Uniform1f(Ve,g.u_saturation_factor),u_contrast_factor:new s.Uniform1f(Ve,g.u_contrast_factor),u_spin_weights:new s.Uniform3f(Ve,g.u_spin_weights)}),symbolIcon:(Ve,g)=>({u_is_size_zoom_constant:new s.Uniform1i(Ve,g.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(Ve,g.u_is_size_feature_constant),u_size_t:new s.Uniform1f(Ve,g.u_size_t),u_size:new s.Uniform1f(Ve,g.u_size),u_camera_to_center_distance:new s.Uniform1f(Ve,g.u_camera_to_center_distance),u_pitch:new s.Uniform1f(Ve,g.u_pitch),u_rotate_symbol:new s.Uniform1i(Ve,g.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(Ve,g.u_aspect_ratio),u_fade_change:new s.Uniform1f(Ve,g.u_fade_change),u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(Ve,g.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(Ve,g.u_coord_matrix),u_is_text:new s.Uniform1i(Ve,g.u_is_text),u_pitch_with_map:new s.Uniform1i(Ve,g.u_pitch_with_map),u_texsize:new s.Uniform2f(Ve,g.u_texsize),u_texture:new s.Uniform1i(Ve,g.u_texture)}),symbolSDF:(Ve,g)=>({u_is_size_zoom_constant:new s.Uniform1i(Ve,g.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(Ve,g.u_is_size_feature_constant),u_size_t:new s.Uniform1f(Ve,g.u_size_t),u_size:new s.Uniform1f(Ve,g.u_size),u_camera_to_center_distance:new s.Uniform1f(Ve,g.u_camera_to_center_distance),u_pitch:new s.Uniform1f(Ve,g.u_pitch),u_rotate_symbol:new s.Uniform1i(Ve,g.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(Ve,g.u_aspect_ratio),u_fade_change:new s.Uniform1f(Ve,g.u_fade_change),u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(Ve,g.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(Ve,g.u_coord_matrix),u_is_text:new s.Uniform1i(Ve,g.u_is_text),u_pitch_with_map:new s.Uniform1i(Ve,g.u_pitch_with_map),u_texsize:new s.Uniform2f(Ve,g.u_texsize),u_texture:new s.Uniform1i(Ve,g.u_texture),u_gamma_scale:new s.Uniform1f(Ve,g.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(Ve,g.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(Ve,g.u_is_halo)}),symbolTextAndIcon:(Ve,g)=>({u_is_size_zoom_constant:new s.Uniform1i(Ve,g.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(Ve,g.u_is_size_feature_constant),u_size_t:new s.Uniform1f(Ve,g.u_size_t),u_size:new s.Uniform1f(Ve,g.u_size),u_camera_to_center_distance:new s.Uniform1f(Ve,g.u_camera_to_center_distance),u_pitch:new s.Uniform1f(Ve,g.u_pitch),u_rotate_symbol:new s.Uniform1i(Ve,g.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(Ve,g.u_aspect_ratio),u_fade_change:new s.Uniform1f(Ve,g.u_fade_change),u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(Ve,g.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(Ve,g.u_coord_matrix),u_is_text:new s.Uniform1i(Ve,g.u_is_text),u_pitch_with_map:new s.Uniform1i(Ve,g.u_pitch_with_map),u_texsize:new s.Uniform2f(Ve,g.u_texsize),u_texsize_icon:new s.Uniform2f(Ve,g.u_texsize_icon),u_texture:new s.Uniform1i(Ve,g.u_texture),u_texture_icon:new s.Uniform1i(Ve,g.u_texture_icon),u_gamma_scale:new s.Uniform1f(Ve,g.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(Ve,g.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(Ve,g.u_is_halo)}),background:(Ve,g)=>({u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix),u_opacity:new s.Uniform1f(Ve,g.u_opacity),u_color:new s.UniformColor(Ve,g.u_color)}),backgroundPattern:(Ve,g)=>({u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix),u_opacity:new s.Uniform1f(Ve,g.u_opacity),u_image:new s.Uniform1i(Ve,g.u_image),u_pattern_tl_a:new s.Uniform2f(Ve,g.u_pattern_tl_a),u_pattern_br_a:new s.Uniform2f(Ve,g.u_pattern_br_a),u_pattern_tl_b:new s.Uniform2f(Ve,g.u_pattern_tl_b),u_pattern_br_b:new s.Uniform2f(Ve,g.u_pattern_br_b),u_texsize:new s.Uniform2f(Ve,g.u_texsize),u_mix:new s.Uniform1f(Ve,g.u_mix),u_pattern_size_a:new s.Uniform2f(Ve,g.u_pattern_size_a),u_pattern_size_b:new s.Uniform2f(Ve,g.u_pattern_size_b),u_scale_a:new s.Uniform1f(Ve,g.u_scale_a),u_scale_b:new s.Uniform1f(Ve,g.u_scale_b),u_pixel_coord_upper:new s.Uniform2f(Ve,g.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(Ve,g.u_pixel_coord_lower),u_tile_units_to_pixels:new s.Uniform1f(Ve,g.u_tile_units_to_pixels)}),terrain:(Ve,g)=>({u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix),u_texture:new s.Uniform1i(Ve,g.u_texture),u_ele_delta:new s.Uniform1f(Ve,g.u_ele_delta)}),terrainDepth:(Ve,g)=>({u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix),u_ele_delta:new s.Uniform1f(Ve,g.u_ele_delta)}),terrainCoords:(Ve,g)=>({u_matrix:new s.UniformMatrix4f(Ve,g.u_matrix),u_texture:new s.Uniform1i(Ve,g.u_texture),u_terrain_coords_id:new s.Uniform1f(Ve,g.u_terrain_coords_id),u_ele_delta:new s.Uniform1f(Ve,g.u_ele_delta)})};class hy{constructor(g,A,_e){this.context=g;const ct=g.gl;this.buffer=ct.createBuffer(),this.dynamicDraw=!!_e,this.context.unbindVAO(),g.bindElementBuffer.set(this.buffer),ct.bufferData(ct.ELEMENT_ARRAY_BUFFER,A.arrayBuffer,this.dynamicDraw?ct.DYNAMIC_DRAW:ct.STATIC_DRAW),this.dynamicDraw||delete A.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(g){const A=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),A.bufferSubData(A.ELEMENT_ARRAY_BUFFER,0,g.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ev={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class q_{constructor(g,A,_e,ct){this.length=A.length,this.attributes=_e,this.itemSize=A.bytesPerElement,this.dynamicDraw=ct,this.context=g;const pi=g.gl;this.buffer=pi.createBuffer(),g.bindVertexBuffer.set(this.buffer),pi.bufferData(pi.ARRAY_BUFFER,A.arrayBuffer,this.dynamicDraw?pi.DYNAMIC_DRAW:pi.STATIC_DRAW),this.dynamicDraw||delete A.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(g){if(g.length!==this.length)throw new Error(`Length of new data is ${g.length}, which doesn't match current length of ${this.length}`);const A=this.context.gl;this.bind(),A.bufferSubData(A.ARRAY_BUFFER,0,g.arrayBuffer)}enableAttributes(g,A){for(let _e=0;_e<this.attributes.length;_e++){const ct=A.attributes[this.attributes[_e].name];ct!==void 0&&g.enableVertexAttribArray(ct)}}setVertexAttribPointers(g,A,_e){for(let ct=0;ct<this.attributes.length;ct++){const pi=this.attributes[ct],In=A.attributes[pi.name];In!==void 0&&g.vertexAttribPointer(In,pi.components,g[Ev[pi.type]],!1,this.itemSize,pi.offset+this.itemSize*(_e||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const em=new WeakMap;function K_(Ve){if(em.has(Ve))return em.get(Ve);{const g=Ve.getParameter(Ve.VERSION).startsWith("WebGL 2.0");return em.set(Ve,g),g}}class cg{constructor(g){this.gl=g.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(g){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class S_ extends cg{getDefault(){return s.Color.transparent}set(g){const A=this.current;(g.r!==A.r||g.g!==A.g||g.b!==A.b||g.a!==A.a||this.dirty)&&(this.gl.clearColor(g.r,g.g,g.b,g.a),this.current=g,this.dirty=!1)}}class T_ extends cg{getDefault(){return 1}set(g){(g!==this.current||this.dirty)&&(this.gl.clearDepth(g),this.current=g,this.dirty=!1)}}class a0 extends cg{getDefault(){return 0}set(g){(g!==this.current||this.dirty)&&(this.gl.clearStencil(g),this.current=g,this.dirty=!1)}}class zx extends cg{getDefault(){return[!0,!0,!0,!0]}set(g){const A=this.current;(g[0]!==A[0]||g[1]!==A[1]||g[2]!==A[2]||g[3]!==A[3]||this.dirty)&&(this.gl.colorMask(g[0],g[1],g[2],g[3]),this.current=g,this.dirty=!1)}}class dy extends cg{getDefault(){return!0}set(g){(g!==this.current||this.dirty)&&(this.gl.depthMask(g),this.current=g,this.dirty=!1)}}class Sv extends cg{getDefault(){return 255}set(g){(g!==this.current||this.dirty)&&(this.gl.stencilMask(g),this.current=g,this.dirty=!1)}}class N_ extends cg{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(g){const A=this.current;(g.func!==A.func||g.ref!==A.ref||g.mask!==A.mask||this.dirty)&&(this.gl.stencilFunc(g.func,g.ref,g.mask),this.current=g,this.dirty=!1)}}class xx extends cg{getDefault(){const g=this.gl;return[g.KEEP,g.KEEP,g.KEEP]}set(g){const A=this.current;(g[0]!==A[0]||g[1]!==A[1]||g[2]!==A[2]||this.dirty)&&(this.gl.stencilOp(g[0],g[1],g[2]),this.current=g,this.dirty=!1)}}class Vy extends cg{getDefault(){return!1}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;g?A.enable(A.STENCIL_TEST):A.disable(A.STENCIL_TEST),this.current=g,this.dirty=!1}}class Z_ extends cg{getDefault(){return[0,1]}set(g){const A=this.current;(g[0]!==A[0]||g[1]!==A[1]||this.dirty)&&(this.gl.depthRange(g[0],g[1]),this.current=g,this.dirty=!1)}}class l0 extends cg{getDefault(){return!1}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;g?A.enable(A.DEPTH_TEST):A.disable(A.DEPTH_TEST),this.current=g,this.dirty=!1}}class A_ extends cg{getDefault(){return this.gl.LESS}set(g){(g!==this.current||this.dirty)&&(this.gl.depthFunc(g),this.current=g,this.dirty=!1)}}class Uy extends cg{getDefault(){return!1}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;g?A.enable(A.BLEND):A.disable(A.BLEND),this.current=g,this.dirty=!1}}class py extends cg{getDefault(){const g=this.gl;return[g.ONE,g.ZERO]}set(g){const A=this.current;(g[0]!==A[0]||g[1]!==A[1]||this.dirty)&&(this.gl.blendFunc(g[0],g[1]),this.current=g,this.dirty=!1)}}class $y extends cg{getDefault(){return s.Color.transparent}set(g){const A=this.current;(g.r!==A.r||g.g!==A.g||g.b!==A.b||g.a!==A.a||this.dirty)&&(this.gl.blendColor(g.r,g.g,g.b,g.a),this.current=g,this.dirty=!1)}}class Hy extends cg{getDefault(){return this.gl.FUNC_ADD}set(g){(g!==this.current||this.dirty)&&(this.gl.blendEquation(g),this.current=g,this.dirty=!1)}}class c0 extends cg{getDefault(){return!1}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;g?A.enable(A.CULL_FACE):A.disable(A.CULL_FACE),this.current=g,this.dirty=!1}}class z0 extends cg{getDefault(){return this.gl.BACK}set(g){(g!==this.current||this.dirty)&&(this.gl.cullFace(g),this.current=g,this.dirty=!1)}}class u0 extends cg{getDefault(){return this.gl.CCW}set(g){(g!==this.current||this.dirty)&&(this.gl.frontFace(g),this.current=g,this.dirty=!1)}}class y_ extends cg{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}}class hg extends cg{getDefault(){return this.gl.TEXTURE0}set(g){(g!==this.current||this.dirty)&&(this.gl.activeTexture(g),this.current=g,this.dirty=!1)}}class Tv extends cg{getDefault(){const g=this.gl;return[0,0,g.drawingBufferWidth,g.drawingBufferHeight]}set(g){const A=this.current;(g[0]!==A[0]||g[1]!==A[1]||g[2]!==A[2]||g[3]!==A[3]||this.dirty)&&(this.gl.viewport(g[0],g[1],g[2],g[3]),this.current=g,this.dirty=!1)}}class fy extends cg{getDefault(){return null}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.bindFramebuffer(A.FRAMEBUFFER,g),this.current=g,this.dirty=!1}}class wx extends cg{getDefault(){return null}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.bindRenderbuffer(A.RENDERBUFFER,g),this.current=g,this.dirty=!1}}class h0 extends cg{getDefault(){return null}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.bindTexture(A.TEXTURE_2D,g),this.current=g,this.dirty=!1}}class _g extends cg{getDefault(){return null}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.bindBuffer(A.ARRAY_BUFFER,g),this.current=g,this.dirty=!1}}class Av extends cg{getDefault(){return null}set(g){const A=this.gl;A.bindBuffer(A.ELEMENT_ARRAY_BUFFER,g),this.current=g,this.dirty=!1}}class Rv extends cg{getDefault(){return null}set(g){var A;if(g===this.current&&!this.dirty)return;const _e=this.gl;K_(_e)?_e.bindVertexArray(g):(A=_e.getExtension("OES_vertex_array_object"))===null||A===void 0||A.bindVertexArrayOES(g),this.current=g,this.dirty=!1}}class d0 extends cg{getDefault(){return 4}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.pixelStorei(A.UNPACK_ALIGNMENT,g),this.current=g,this.dirty=!1}}class k_ extends cg{getDefault(){return!1}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.pixelStorei(A.UNPACK_PREMULTIPLY_ALPHA_WEBGL,g),this.current=g,this.dirty=!1}}class X_ extends cg{getDefault(){return!1}set(g){if(g===this.current&&!this.dirty)return;const A=this.gl;A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,g),this.current=g,this.dirty=!1}}class Y_ extends cg{constructor(g,A){super(g),this.context=g,this.parent=A}getDefault(){return null}}class p0 extends Y_{setDirty(){this.dirty=!0}set(g){if(g===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const A=this.gl;A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_2D,g,0),this.current=g,this.dirty=!1}}class Vx extends Y_{set(g){if(g===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const A=this.gl;A.framebufferRenderbuffer(A.FRAMEBUFFER,A.DEPTH_ATTACHMENT,A.RENDERBUFFER,g),this.current=g,this.dirty=!1}}class jy extends Y_{set(g){if(g===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const A=this.gl;A.framebufferRenderbuffer(A.FRAMEBUFFER,A.DEPTH_STENCIL_ATTACHMENT,A.RENDERBUFFER,g),this.current=g,this.dirty=!1}}class Iv{constructor(g,A,_e,ct,pi){this.context=g,this.width=A,this.height=_e;const In=g.gl,ds=this.framebuffer=In.createFramebuffer();if(this.colorAttachment=new p0(g,ds),ct)this.depthAttachment=pi?new jy(g,ds):new Vx(g,ds);else if(pi)throw new Error("Stencil cannot be setted without depth");if(In.checkFramebufferStatus(In.FRAMEBUFFER)!==In.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const g=this.context.gl,A=this.colorAttachment.get();if(A&&g.deleteTexture(A),this.depthAttachment){const _e=this.depthAttachment.get();_e&&g.deleteRenderbuffer(_e)}g.deleteFramebuffer(this.framebuffer)}}class Og{constructor(g,A,_e){this.blendFunction=g,this.blendColor=A,this.mask=_e}}Og.Replace=[1,0],Og.disabled=new Og(Og.Replace,s.Color.transparent,[!1,!1,!1,!1]),Og.unblended=new Og(Og.Replace,s.Color.transparent,[!0,!0,!0,!0]),Og.alphaBlended=new Og([1,771],s.Color.transparent,[!0,!0,!0,!0]);class Mv{constructor(g){var A,_e;if(this.gl=g,this.clearColor=new S_(this),this.clearDepth=new T_(this),this.clearStencil=new a0(this),this.colorMask=new zx(this),this.depthMask=new dy(this),this.stencilMask=new Sv(this),this.stencilFunc=new N_(this),this.stencilOp=new xx(this),this.stencilTest=new Vy(this),this.depthRange=new Z_(this),this.depthTest=new l0(this),this.depthFunc=new A_(this),this.blend=new Uy(this),this.blendFunc=new py(this),this.blendColor=new $y(this),this.blendEquation=new Hy(this),this.cullFace=new c0(this),this.cullFaceSide=new z0(this),this.frontFace=new u0(this),this.program=new y_(this),this.activeTexture=new hg(this),this.viewport=new Tv(this),this.bindFramebuffer=new fy(this),this.bindRenderbuffer=new wx(this),this.bindTexture=new h0(this),this.bindVertexBuffer=new _g(this),this.bindElementBuffer=new Av(this),this.bindVertexArray=new Rv(this),this.pixelStoreUnpack=new d0(this),this.pixelStoreUnpackPremultiplyAlpha=new k_(this),this.pixelStoreUnpackFlipY=new X_(this),this.extTextureFilterAnisotropic=g.getExtension("EXT_texture_filter_anisotropic")||g.getExtension("MOZ_EXT_texture_filter_anisotropic")||g.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=g.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=g.getParameter(g.MAX_TEXTURE_SIZE),K_(g)){this.HALF_FLOAT=g.HALF_FLOAT;const ct=g.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(A=g.RGBA16F)!==null&&A!==void 0?A:ct==null?void 0:ct.RGBA16F_EXT,this.RGB16F=(_e=g.RGB16F)!==null&&_e!==void 0?_e:ct==null?void 0:ct.RGB16F_EXT,g.getExtension("EXT_color_buffer_float")}else{g.getExtension("EXT_color_buffer_half_float"),g.getExtension("OES_texture_half_float_linear");const ct=g.getExtension("OES_texture_half_float");this.HALF_FLOAT=ct==null?void 0:ct.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(g,A){return new hy(this,g,A)}createVertexBuffer(g,A,_e){return new q_(this,g,A,_e)}createRenderbuffer(g,A,_e){const ct=this.gl,pi=ct.createRenderbuffer();return this.bindRenderbuffer.set(pi),ct.renderbufferStorage(ct.RENDERBUFFER,g,A,_e),this.bindRenderbuffer.set(null),pi}createFramebuffer(g,A,_e,ct){return new Iv(this,g,A,_e,ct)}clear({color:g,depth:A,stencil:_e}){const ct=this.gl;let pi=0;g&&(pi|=ct.COLOR_BUFFER_BIT,this.clearColor.set(g),this.colorMask.set([!0,!0,!0,!0])),A!==void 0&&(pi|=ct.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(A),this.depthMask.set(!0)),_e!==void 0&&(pi|=ct.STENCIL_BUFFER_BIT,this.clearStencil.set(_e),this.stencilMask.set(255)),ct.clear(pi)}setCullFace(g){g.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(g.mode),this.frontFace.set(g.frontFace))}setDepthMode(g){g.func!==this.gl.ALWAYS||g.mask?(this.depthTest.set(!0),this.depthFunc.set(g.func),this.depthMask.set(g.mask),this.depthRange.set(g.range)):this.depthTest.set(!1)}setStencilMode(g){g.test.func!==this.gl.ALWAYS||g.mask?(this.stencilTest.set(!0),this.stencilMask.set(g.mask),this.stencilOp.set([g.fail,g.depthFail,g.pass]),this.stencilFunc.set({func:g.test.func,ref:g.ref,mask:g.test.mask})):this.stencilTest.set(!1)}setColorMode(g){s.deepEqual(g.blendFunction,Og.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(g.blendFunction),this.blendColor.set(g.blendColor)),this.colorMask.set(g.mask)}createVertexArray(){var g;return K_(this.gl)?this.gl.createVertexArray():(g=this.gl.getExtension("OES_vertex_array_object"))===null||g===void 0?void 0:g.createVertexArrayOES()}deleteVertexArray(g){var A;return K_(this.gl)?this.gl.deleteVertexArray(g):(A=this.gl.getExtension("OES_vertex_array_object"))===null||A===void 0?void 0:A.deleteVertexArrayOES(g)}unbindVAO(){this.bindVertexArray.set(null)}}class ig{constructor(g,A,_e){this.func=g,this.mask=A,this.range=_e}}ig.ReadOnly=!1,ig.ReadWrite=!0,ig.disabled=new ig(519,ig.ReadOnly,[0,1]);const Pv=7680;class Hp{constructor(g,A,_e,ct,pi,In){this.test=g,this.ref=A,this.mask=_e,this.fail=ct,this.depthFail=pi,this.pass=In}}Hp.disabled=new Hp({func:519,mask:0},0,0,Pv,Pv,Pv);class yg{constructor(g,A,_e){this.enable=g,this.mode=A,this.frontFace=_e}}let Wy;function V0(Ve,g,A,_e,ct,pi,In){const ds=Ve.context,hs=ds.gl,vs=Ve.useProgram("collisionBox"),fl=[];let dl=0,dh=0;for(let Lh=0;Lh<_e.length;Lh++){const od=_e[Lh],md=g.getTile(od),Nd=md.getBucket(A);if(!Nd)continue;let Hd=od.posMatrix;ct[0]===0&&ct[1]===0||(Hd=Ve.translatePosMatrix(od.posMatrix,md,ct,pi));const tp=In?Nd.textCollisionBox:Nd.iconCollisionBox,Vd=Nd.collisionCircleArray;if(Vd.length>0){const gp=s.create(),L=Hd;s.mul(gp,Nd.placementInvProjMatrix,Ve.transform.glCoordMatrix),s.mul(gp,gp,Nd.placementViewportMatrix),fl.push({circleArray:Vd,circleOffset:dh,transform:L,invTransform:gp,coord:od}),dl+=Vd.length/4,dh=dl}tp&&vs.draw(ds,hs.LINES,ig.disabled,Hp.disabled,Ve.colorModeForRenderPass(),yg.disabled,B0(Hd,Ve.transform,md),Ve.style.map.terrain&&Ve.style.map.terrain.getTerrainData(od),A.id,tp.layoutVertexBuffer,tp.indexBuffer,tp.segments,null,Ve.transform.zoom,null,null,tp.collisionVertexBuffer)}if(!In||!fl.length)return;const Ah=Ve.useProgram("collisionCircle"),hh=new s.CollisionCircleLayoutArray;hh.resize(4*dl),hh._trim();let Rh=0;for(const Lh of fl)for(let od=0;od<Lh.circleArray.length/4;od++){const md=4*od,Nd=Lh.circleArray[md+0],Hd=Lh.circleArray[md+1],tp=Lh.circleArray[md+2],Vd=Lh.circleArray[md+3];hh.emplace(Rh++,Nd,Hd,tp,Vd,0),hh.emplace(Rh++,Nd,Hd,tp,Vd,1),hh.emplace(Rh++,Nd,Hd,tp,Vd,2),hh.emplace(Rh++,Nd,Hd,tp,Vd,3)}(!Wy||Wy.length<2*dl)&&(Wy=function(Lh){const od=2*Lh,md=new s.QuadTriangleArray;md.resize(od),md._trim();for(let Nd=0;Nd<od;Nd++){const Hd=6*Nd;md.uint16[Hd+0]=4*Nd+0,md.uint16[Hd+1]=4*Nd+1,md.uint16[Hd+2]=4*Nd+2,md.uint16[Hd+3]=4*Nd+2,md.uint16[Hd+4]=4*Nd+3,md.uint16[Hd+5]=4*Nd+0}return md}(dl));const zh=ds.createIndexBuffer(Wy,!0),Kh=ds.createVertexBuffer(hh,s.collisionCircleLayout.members,!0);for(const Lh of fl){const od={u_matrix:Lh.transform,u_inv_matrix:Lh.invTransform,u_camera_to_center_distance:(ad=Ve.transform).cameraToCenterDistance,u_viewport_size:[ad.width,ad.height]};Ah.draw(ds,hs.TRIANGLES,ig.disabled,Hp.disabled,Ve.colorModeForRenderPass(),yg.disabled,od,Ve.style.map.terrain&&Ve.style.map.terrain.getTerrainData(Lh.coord),A.id,Kh,zh,s.SegmentVector.simpleSegment(0,2*Lh.circleOffset,Lh.circleArray.length,Lh.circleArray.length/2),null,Ve.transform.zoom,null,null,null)}var ad;Kh.destroy(),zh.destroy()}yg.disabled=new yg(!1,1029,2305),yg.backCCW=new yg(!0,1029,2305);const U0=s.identity(new Float32Array(16));function qy(Ve,g,A,_e,ct,pi){const{horizontalAlign:In,verticalAlign:ds}=s.getAnchorAlignment(Ve),hs=-(In-.5)*g,vs=-(ds-.5)*A,fl=s.evaluateVariableOffset(Ve,_e);return new s.Point((hs/ct+fl[0])*pi,(vs/ct+fl[1])*pi)}function $0(Ve,g,A,_e,ct,pi,In,ds,hs,vs,fl){const dl=Ve.text.placedSymbolArray,dh=Ve.text.dynamicLayoutVertexArray,Ah=Ve.icon.dynamicLayoutVertexArray,hh={};dh.clear();for(let Rh=0;Rh<dl.length;Rh++){const zh=dl.get(Rh),Kh=zh.hidden||!zh.crossTileID||Ve.allowVerticalPlacement&&!zh.placedOrientation?null:_e[zh.crossTileID];if(Kh){const ad=new s.Point(zh.anchorX,zh.anchorY),Lh=Qp(ad,A?In:pi,fl),od=Rp(ct.cameraToCenterDistance,Lh.signedDistanceFromCamera);let md=s.evaluateSizeForFeature(Ve.textSizeData,hs,zh)*od/s.ONE_EM;A&&(md*=Ve.tilePixelRatio/ds);const{width:Nd,height:Hd,anchor:tp,textOffset:Vd,textBoxScale:gp}=Kh,L=qy(tp,Nd,Hd,Vd,gp,md),p=A?Qp(ad.add(L),pi,fl).point:Lh.point.add(g?L.rotate(-ct.angle):L),S=Ve.allowVerticalPlacement&&zh.placedOrientation===s.WritingMode.vertical?Math.PI/2:0;for(let X=0;X<zh.numGlyphs;X++)s.addDynamicAttributes(dh,p,S);vs&&zh.associatedIconIndex>=0&&(hh[zh.associatedIconIndex]={shiftedAnchor:p,angle:S})}else fs(zh.numGlyphs,dh)}if(vs){Ah.clear();const Rh=Ve.icon.placedSymbolArray;for(let zh=0;zh<Rh.length;zh++){const Kh=Rh.get(zh);if(Kh.hidden)fs(Kh.numGlyphs,Ah);else{const ad=hh[zh];if(ad)for(let Lh=0;Lh<Kh.numGlyphs;Lh++)s.addDynamicAttributes(Ah,ad.shiftedAnchor,ad.angle);else fs(Kh.numGlyphs,Ah)}}Ve.icon.dynamicLayoutVertexBuffer.updateData(Ah)}Ve.text.dynamicLayoutVertexBuffer.updateData(dh)}function H0(Ve,g,A){return A.iconsInText&&g?"symbolTextAndIcon":Ve?"symbolSDF":"symbolIcon"}function j0(Ve,g,A,_e,ct,pi,In,ds,hs,vs,fl,dl){const dh=Ve.context,Ah=dh.gl,hh=Ve.transform,Rh=ds==="map",zh=hs==="map",Kh=ds!=="viewport"&&A.layout.get("symbol-placement")!=="point",ad=Rh&&!zh&&!Kh,Lh=!A.layout.get("symbol-sort-key").isConstant();let od=!1;const md=Ve.depthModeForSublayer(0,ig.ReadOnly),Nd=A.layout.get("text-variable-anchor"),Hd=[];for(const tp of _e){const Vd=g.getTile(tp),gp=Vd.getBucket(A);if(!gp)continue;const L=ct?gp.text:gp.icon;if(!L||!L.segments.get().length||!L.hasVisibleVertices)continue;const p=L.programConfigurations.get(A.id),S=ct||gp.sdfIcons,X=ct?gp.textSizeData:gp.iconSizeData,ze=zh||hh.pitch!==0,kt=Ve.useProgram(H0(S,ct,gp),p),vi=s.evaluateSizeForZoom(X,hh.zoom),or=Ve.style.map.terrain&&Ve.style.map.terrain.getTerrainData(tp);let Gn,ia,oa,pl,lh=[0,0],gh=null;if(ct)ia=Vd.glyphAtlasTexture,oa=Ah.LINEAR,Gn=Vd.glyphAtlasTexture.size,gp.iconsInText&&(lh=Vd.imageAtlasTexture.size,gh=Vd.imageAtlasTexture,pl=ze||Ve.options.rotating||Ve.options.zooming||X.kind==="composite"||X.kind==="camera"?Ah.LINEAR:Ah.NEAREST);else{const Zh=A.layout.get("icon-size").constantOr(0)!==1||gp.iconsNeedLinear;ia=Vd.imageAtlasTexture,oa=S||Ve.options.rotating||Ve.options.zooming||Zh||ze?Ah.LINEAR:Ah.NEAREST,Gn=Vd.imageAtlasTexture.size}const yh=vh(Vd,1,Ve.transform.zoom),_h=np(tp.posMatrix,zh,Rh,Ve.transform,yh),xh=Up(tp.posMatrix,zh,Rh,Ve.transform,yh),_l=Nd&&gp.hasTextData(),mh=A.layout.get("icon-text-fit")!=="none"&&_l&&gp.hasIconData();if(Kh){const Zh=Ve.style.map.terrain?(Bd,ed)=>Ve.style.map.terrain.getElevation(tp,Bd,ed):null,id=A.layout.get("text-rotation-alignment")==="map";bg(gp,tp.posMatrix,Ve,ct,_h,xh,zh,vs,id,Zh)}const wh=Ve.translatePosMatrix(tp.posMatrix,Vd,pi,In),Sh=Kh||ct&&Nd||mh?U0:_h,Oh=Ve.translatePosMatrix(xh,Vd,pi,In,!0),Uh=S&&A.paint.get(ct?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Vh;Vh=S?gp.iconsInText?Vm(X.kind,vi,ad,zh,Ve,wh,Sh,Oh,Gn,lh):pm(X.kind,vi,ad,zh,Ve,wh,Sh,Oh,ct,Gn,!0):uy(X.kind,vi,ad,zh,Ve,wh,Sh,Oh,ct,Gn);const Wh={program:kt,buffers:L,uniformValues:Vh,atlasTexture:ia,atlasTextureIcon:gh,atlasInterpolation:oa,atlasInterpolationIcon:pl,isSDF:S,hasHalo:Uh};if(Lh&&gp.canOverlap){od=!0;const Zh=L.segments.get();for(const id of Zh)Hd.push({segments:new s.SegmentVector([id]),sortKey:id.sortKey,state:Wh,terrainData:or})}else Hd.push({segments:L.segments,sortKey:0,state:Wh,terrainData:or})}od&&Hd.sort((tp,Vd)=>tp.sortKey-Vd.sortKey);for(const tp of Hd){const Vd=tp.state;if(dh.activeTexture.set(Ah.TEXTURE0),Vd.atlasTexture.bind(Vd.atlasInterpolation,Ah.CLAMP_TO_EDGE),Vd.atlasTextureIcon&&(dh.activeTexture.set(Ah.TEXTURE1),Vd.atlasTextureIcon&&Vd.atlasTextureIcon.bind(Vd.atlasInterpolationIcon,Ah.CLAMP_TO_EDGE)),Vd.isSDF){const gp=Vd.uniformValues;Vd.hasHalo&&(gp.u_is_halo=1,bx(Vd.buffers,tp.segments,A,Ve,Vd.program,md,fl,dl,gp,tp.terrainData)),gp.u_is_halo=0}bx(Vd.buffers,tp.segments,A,Ve,Vd.program,md,fl,dl,Vd.uniformValues,tp.terrainData)}}function bx(Ve,g,A,_e,ct,pi,In,ds,hs,vs){const fl=_e.context;ct.draw(fl,fl.gl.TRIANGLES,pi,In,ds,yg.disabled,hs,vs,A.id,Ve.layoutVertexBuffer,Ve.indexBuffer,g,A.paint,_e.transform.zoom,Ve.programConfigurations.get(A.id),Ve.dynamicLayoutVertexBuffer,Ve.opacityVertexBuffer)}function f0(Ve,g,A,_e,ct){if(!A||!_e||!_e.imageAtlas)return;const pi=_e.imageAtlas.patternPositions;let In=pi[A.to.toString()],ds=pi[A.from.toString()];if(!In||!ds){const hs=ct.getPaintProperty(g);In=pi[hs],ds=pi[hs]}In&&ds&&Ve.setConstantPatternPositions(In,ds)}function Ky(Ve,g,A,_e,ct,pi,In){const ds=Ve.context.gl,hs="fill-pattern",vs=A.paint.get(hs),fl=vs&&vs.constantOr(1),dl=A.getCrossfadeParameters();let dh,Ah,hh,Rh,zh;In?(Ah=fl&&!A.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",dh=ds.LINES):(Ah=fl?"fillPattern":"fill",dh=ds.TRIANGLES);const Kh=vs.constantOr(null);for(const ad of _e){const Lh=g.getTile(ad);if(fl&&!Lh.patternsLoaded())continue;const od=Lh.getBucket(A);if(!od)continue;const md=od.programConfigurations.get(A.id),Nd=Ve.useProgram(Ah,md),Hd=Ve.style.map.terrain&&Ve.style.map.terrain.getTerrainData(ad);fl&&(Ve.context.activeTexture.set(ds.TEXTURE0),Lh.imageAtlasTexture.bind(ds.LINEAR,ds.CLAMP_TO_EDGE),md.updatePaintBuffers(dl)),f0(md,hs,Kh,Lh,A);const tp=Hd?ad:null,Vd=Ve.translatePosMatrix(tp?tp.posMatrix:ad.posMatrix,Lh,A.paint.get("fill-translate"),A.paint.get("fill-translate-anchor"));if(In){Rh=od.indexBuffer2,zh=od.segments2;const gp=[ds.drawingBufferWidth,ds.drawingBufferHeight];hh=Ah==="fillOutlinePattern"&&fl?a_(Vd,Ve,dl,Lh,gp):ky(Vd,gp)}else Rh=od.indexBuffer,zh=od.segments,hh=fl?Ny(Vd,Ve,dl,Lh):qm(Vd);Nd.draw(Ve.context,dh,ct,Ve.stencilModeForClipping(ad),pi,yg.disabled,hh,Hd,A.id,od.layoutVertexBuffer,Rh,zh,A.paint,Ve.transform.zoom,md)}}function Zy(Ve,g,A,_e,ct,pi,In){const ds=Ve.context,hs=ds.gl,vs="fill-extrusion-pattern",fl=A.paint.get(vs),dl=fl.constantOr(1),dh=A.getCrossfadeParameters(),Ah=A.paint.get("fill-extrusion-opacity"),hh=fl.constantOr(null);for(const Rh of _e){const zh=g.getTile(Rh),Kh=zh.getBucket(A);if(!Kh)continue;const ad=Ve.style.map.terrain&&Ve.style.map.terrain.getTerrainData(Rh),Lh=Kh.programConfigurations.get(A.id),od=Ve.useProgram(dl?"fillExtrusionPattern":"fillExtrusion",Lh);dl&&(Ve.context.activeTexture.set(hs.TEXTURE0),zh.imageAtlasTexture.bind(hs.LINEAR,hs.CLAMP_TO_EDGE),Lh.updatePaintBuffers(dh)),f0(Lh,vs,hh,zh,A);const md=Ve.translatePosMatrix(Rh.posMatrix,zh,A.paint.get("fill-extrusion-translate"),A.paint.get("fill-extrusion-translate-anchor")),Nd=A.paint.get("fill-extrusion-vertical-gradient"),Hd=dl?Kf(md,Ve,Nd,Ah,Rh,dh,zh):__(md,Ve,Nd,Ah);od.draw(ds,ds.gl.TRIANGLES,ct,pi,In,yg.backCCW,Hd,ad,A.id,Kh.layoutVertexBuffer,Kh.indexBuffer,Kh.segments,A.paint,Ve.transform.zoom,Lh,Ve.style.map.terrain&&Kh.centroidVertexBuffer)}}function W0(Ve,g,A,_e,ct,pi,In){const ds=Ve.context,hs=ds.gl,vs=A.fbo;if(!vs)return;const fl=Ve.useProgram("hillshade"),dl=Ve.style.map.terrain&&Ve.style.map.terrain.getTerrainData(g);ds.activeTexture.set(hs.TEXTURE0),hs.bindTexture(hs.TEXTURE_2D,vs.colorAttachment.get()),fl.draw(ds,hs.TRIANGLES,ct,pi,In,yg.disabled,((dh,Ah,hh,Rh)=>{const zh=hh.paint.get("hillshade-shadow-color"),Kh=hh.paint.get("hillshade-highlight-color"),ad=hh.paint.get("hillshade-accent-color");let Lh=hh.paint.get("hillshade-illumination-direction")*(Math.PI/180);hh.paint.get("hillshade-illumination-anchor")==="viewport"&&(Lh-=dh.transform.angle);const od=!dh.options.moving;return{u_matrix:Rh?Rh.posMatrix:dh.transform.calculatePosMatrix(Ah.tileID.toUnwrapped(),od),u_image:0,u_latrange:G0(0,Ah.tileID),u_light:[hh.paint.get("hillshade-exaggeration"),Lh],u_shadow:zh,u_highlight:Kh,u_accent:ad}})(Ve,A,_e,dl?g:null),dl,_e.id,Ve.rasterBoundsBuffer,Ve.quadTriangleIndexBuffer,Ve.rasterBoundsSegments)}function Cx(Ve,g,A,_e,ct,pi){const In=Ve.context,ds=In.gl,hs=g.dem;if(hs&&hs.data){const vs=hs.dim,fl=hs.stride,dl=hs.getPixels();if(In.activeTexture.set(ds.TEXTURE1),In.pixelStoreUnpackPremultiplyAlpha.set(!1),g.demTexture=g.demTexture||Ve.getTileTexture(fl),g.demTexture){const Ah=g.demTexture;Ah.update(dl,{premultiply:!1}),Ah.bind(ds.NEAREST,ds.CLAMP_TO_EDGE)}else g.demTexture=new th(In,dl,ds.RGBA,{premultiply:!1}),g.demTexture.bind(ds.NEAREST,ds.CLAMP_TO_EDGE);In.activeTexture.set(ds.TEXTURE0);let dh=g.fbo;if(!dh){const Ah=new th(In,{width:vs,height:vs,data:null},ds.RGBA);Ah.bind(ds.LINEAR,ds.CLAMP_TO_EDGE),dh=g.fbo=In.createFramebuffer(vs,vs,!0,!1),dh.colorAttachment.set(Ah.texture)}In.bindFramebuffer.set(dh.framebuffer),In.viewport.set([0,0,vs,vs]),Ve.useProgram("hillshadePrepare").draw(In,ds.TRIANGLES,_e,ct,pi,yg.disabled,((Ah,hh)=>{const Rh=hh.stride,zh=s.create();return s.ortho(zh,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(zh,zh,[0,-s.EXTENT,0]),{u_matrix:zh,u_image:1,u_dimension:[Rh,Rh],u_zoom:Ah.overscaledZ,u_unpack:hh.getUnpackVector()}})(g.tileID,hs),null,A.id,Ve.rasterBoundsBuffer,Ve.quadTriangleIndexBuffer,Ve.rasterBoundsSegments),g.needsHillshadePrepare=!1}}function Yg(Ve,g,A,_e,ct,pi){const In=_e.paint.get("raster-fade-duration");if(!pi&&In>0){const ds=s.exported.now(),hs=(ds-Ve.timeAdded)/In,vs=g?(ds-g.timeAdded)/In:-1,fl=A.getSource(),dl=ct.coveringZoomLevel({tileSize:fl.tileSize,roundZoom:fl.roundZoom}),dh=!g||Math.abs(g.tileID.overscaledZ-dl)>Math.abs(Ve.tileID.overscaledZ-dl),Ah=dh&&Ve.refreshedUponExpiration?1:s.clamp(dh?hs:1-vs,0,1);return Ve.refreshedUponExpiration&&hs>=1&&(Ve.refreshedUponExpiration=!1),g?{opacity:1,mix:1-Ah}:{opacity:Ah,mix:0}}return{opacity:1,mix:0}}const Xy=new s.Color(1,0,0,1),Nm=new s.Color(0,1,0,1),Yy=new s.Color(0,0,1,1),g0=new s.Color(1,0,1,1),Dv=new s.Color(0,1,1,1);function J_(Ve,g,A,_e){Q_(Ve,0,g+A/2,Ve.transform.width,A,_e)}function Zm(Ve,g,A,_e){Q_(Ve,g-A/2,0,A,Ve.transform.height,_e)}function Q_(Ve,g,A,_e,ct,pi){const In=Ve.context,ds=In.gl;ds.enable(ds.SCISSOR_TEST),ds.scissor(g*Ve.pixelRatio,A*Ve.pixelRatio,_e*Ve.pixelRatio,ct*Ve.pixelRatio),In.clear({color:pi}),ds.disable(ds.SCISSOR_TEST)}function q0(Ve,g,A){const _e=Ve.context,ct=_e.gl,pi=A.posMatrix,In=Ve.useProgram("debug"),ds=ig.disabled,hs=Hp.disabled,vs=Ve.colorModeForRenderPass(),fl="$debug",dl=Ve.style.map.terrain&&Ve.style.map.terrain.getTerrainData(A);_e.activeTexture.set(ct.TEXTURE0);const dh=g.getTileByID(A.key).latestRawTileData,Ah=Math.floor((dh&&dh.byteLength||0)/1024),hh=g.getTile(A).tileSize,Rh=512/Math.min(hh,512)*(A.overscaledZ/Ve.transform.zoom)*.5;let zh=A.canonical.toString();A.overscaledZ!==A.canonical.z&&(zh+=` => ${A.overscaledZ}`),function(Kh,ad){Kh.initDebugOverlayCanvas();const Lh=Kh.debugOverlayCanvas,od=Kh.context.gl,md=Kh.debugOverlayCanvas.getContext("2d");md.clearRect(0,0,Lh.width,Lh.height),md.shadowColor="white",md.shadowBlur=2,md.lineWidth=1.5,md.strokeStyle="white",md.textBaseline="top",md.font="bold 36px Open Sans, sans-serif",md.fillText(ad,5,5),md.strokeText(ad,5,5),Kh.debugOverlayTexture.update(Lh),Kh.debugOverlayTexture.bind(od.LINEAR,od.CLAMP_TO_EDGE)}(Ve,`${zh} ${Ah}kB`),In.draw(_e,ct.TRIANGLES,ds,hs,Og.alphaBlended,yg.disabled,E_(pi,s.Color.transparent,Rh),null,fl,Ve.debugBuffer,Ve.quadTriangleIndexBuffer,Ve.debugSegments),In.draw(_e,ct.LINE_STRIP,ds,hs,vs,yg.disabled,E_(pi,s.Color.red),dl,fl,Ve.debugBuffer,Ve.tileBorderIndexBuffer,Ve.debugSegments)}function Lv(Ve,g,A){const _e=Ve.context,ct=_e.gl,pi=Ve.colorModeForRenderPass(),In=new ig(ct.LEQUAL,ig.ReadWrite,Ve.depthRangeFor3D),ds=Ve.useProgram("terrain"),hs=g.getTerrainMesh();_e.bindFramebuffer.set(null),_e.viewport.set([0,0,Ve.width,Ve.height]);for(const vs of A){const fl=Ve.renderToTexture.getTexture(vs),dl=g.getTerrainData(vs.tileID);_e.activeTexture.set(ct.TEXTURE0),ct.bindTexture(ct.TEXTURE_2D,fl.texture);const dh={u_matrix:Ve.transform.calculatePosMatrix(vs.tileID.toUnwrapped()),u_texture:0,u_ele_delta:g.getMeshFrameDelta(Ve.transform.zoom)};ds.draw(_e,ct.TRIANGLES,In,Hp.disabled,pi,yg.backCCW,dh,dl,"terrain",hs.vertexBuffer,hs.indexBuffer,hs.segments)}}const K0={symbol:function(Ve,g,A,_e,ct){if(Ve.renderPass!=="translucent")return;const pi=Hp.disabled,In=Ve.colorModeForRenderPass();A.layout.get("text-variable-anchor")&&function(ds,hs,vs,fl,dl,dh,Ah){const hh=hs.transform,Rh=dl==="map",zh=dh==="map";for(const Kh of ds){const ad=fl.getTile(Kh),Lh=ad.getBucket(vs);if(!Lh||!Lh.text||!Lh.text.segments.get().length)continue;const od=s.evaluateSizeForZoom(Lh.textSizeData,hh.zoom),md=vh(ad,1,hs.transform.zoom),Nd=np(Kh.posMatrix,zh,Rh,hs.transform,md),Hd=vs.layout.get("icon-text-fit")!=="none"&&Lh.hasIconData();if(od){const tp=Math.pow(2,hh.zoom-ad.tileID.overscaledZ);$0(Lh,Rh,zh,Ah,hh,Nd,Kh.posMatrix,tp,od,Hd,hs.style.map.terrain?(Vd,gp)=>hs.style.map.terrain.getElevation(Kh,Vd,gp):null)}}}(_e,Ve,A,g,A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),ct),A.paint.get("icon-opacity").constantOr(1)!==0&&j0(Ve,g,A,_e,!1,A.paint.get("icon-translate"),A.paint.get("icon-translate-anchor"),A.layout.get("icon-rotation-alignment"),A.layout.get("icon-pitch-alignment"),A.layout.get("icon-keep-upright"),pi,In),A.paint.get("text-opacity").constantOr(1)!==0&&j0(Ve,g,A,_e,!0,A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),A.layout.get("text-keep-upright"),pi,In),g.map.showCollisionBoxes&&(V0(Ve,g,A,_e,A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),!0),V0(Ve,g,A,_e,A.paint.get("icon-translate"),A.paint.get("icon-translate-anchor"),!1))},circle:function(Ve,g,A,_e){if(Ve.renderPass!=="translucent")return;const ct=A.paint.get("circle-opacity"),pi=A.paint.get("circle-stroke-width"),In=A.paint.get("circle-stroke-opacity"),ds=!A.layout.get("circle-sort-key").isConstant();if(ct.constantOr(1)===0&&(pi.constantOr(1)===0||In.constantOr(1)===0))return;const hs=Ve.context,vs=hs.gl,fl=Ve.depthModeForSublayer(0,ig.ReadOnly),dl=Hp.disabled,dh=Ve.colorModeForRenderPass(),Ah=[];for(let hh=0;hh<_e.length;hh++){const Rh=_e[hh],zh=g.getTile(Rh),Kh=zh.getBucket(A);if(!Kh)continue;const ad=Kh.programConfigurations.get(A.id),Lh=Ve.useProgram("circle",ad),od=Kh.layoutVertexBuffer,md=Kh.indexBuffer,Nd=Ve.style.map.terrain&&Ve.style.map.terrain.getTerrainData(Rh),Hd={programConfiguration:ad,program:Lh,layoutVertexBuffer:od,indexBuffer:md,uniformValues:Lg(Ve,Rh,zh,A),terrainData:Nd};if(ds){const tp=Kh.segments.get();for(const Vd of tp)Ah.push({segments:new s.SegmentVector([Vd]),sortKey:Vd.sortKey,state:Hd})}else Ah.push({segments:Kh.segments,sortKey:0,state:Hd})}ds&&Ah.sort((hh,Rh)=>hh.sortKey-Rh.sortKey);for(const hh of Ah){const{programConfiguration:Rh,program:zh,layoutVertexBuffer:Kh,indexBuffer:ad,uniformValues:Lh,terrainData:od}=hh.state;zh.draw(hs,vs.TRIANGLES,fl,dl,dh,yg.disabled,Lh,od,A.id,Kh,ad,hh.segments,A.paint,Ve.transform.zoom,Rh)}},heatmap:function(Ve,g,A,_e){if(A.paint.get("heatmap-opacity")!==0)if(Ve.renderPass==="offscreen"){const ct=Ve.context,pi=ct.gl,In=Hp.disabled,ds=new Og([pi.ONE,pi.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(hs,vs,fl){const dl=hs.gl;hs.activeTexture.set(dl.TEXTURE1),hs.viewport.set([0,0,vs.width/4,vs.height/4]);let dh=fl.heatmapFbo;if(dh)dl.bindTexture(dl.TEXTURE_2D,dh.colorAttachment.get()),hs.bindFramebuffer.set(dh.framebuffer);else{const Ah=dl.createTexture();dl.bindTexture(dl.TEXTURE_2D,Ah),dl.texParameteri(dl.TEXTURE_2D,dl.TEXTURE_WRAP_S,dl.CLAMP_TO_EDGE),dl.texParameteri(dl.TEXTURE_2D,dl.TEXTURE_WRAP_T,dl.CLAMP_TO_EDGE),dl.texParameteri(dl.TEXTURE_2D,dl.TEXTURE_MIN_FILTER,dl.LINEAR),dl.texParameteri(dl.TEXTURE_2D,dl.TEXTURE_MAG_FILTER,dl.LINEAR),dh=fl.heatmapFbo=hs.createFramebuffer(vs.width/4,vs.height/4,!1,!1),function(hh,Rh,zh,Kh){var ad,Lh;const od=hh.gl,md=(ad=hh.HALF_FLOAT)!==null&&ad!==void 0?ad:od.UNSIGNED_BYTE,Nd=(Lh=hh.RGBA16F)!==null&&Lh!==void 0?Lh:od.RGBA;od.texImage2D(od.TEXTURE_2D,0,Nd,Rh.width/4,Rh.height/4,0,od.RGBA,md,null),Kh.colorAttachment.set(zh)}(hs,vs,Ah,dh)}})(ct,Ve,A),ct.clear({color:s.Color.transparent});for(let hs=0;hs<_e.length;hs++){const vs=_e[hs];if(g.hasRenderableParent(vs))continue;const fl=g.getTile(vs),dl=fl.getBucket(A);if(!dl)continue;const dh=dl.programConfigurations.get(A.id),Ah=Ve.useProgram("heatmap",dh),{zoom:hh}=Ve.transform;Ah.draw(ct,pi.TRIANGLES,ig.disabled,In,ds,yg.disabled,bv(vs.posMatrix,fl,hh,A.paint.get("heatmap-intensity")),null,A.id,dl.layoutVertexBuffer,dl.indexBuffer,dl.segments,A.paint,Ve.transform.zoom,dh)}ct.viewport.set([0,0,Ve.width,Ve.height])}else Ve.renderPass==="translucent"&&(Ve.context.setColorMode(Ve.colorModeForRenderPass()),function(ct,pi){const In=ct.context,ds=In.gl,hs=pi.heatmapFbo;if(!hs)return;In.activeTexture.set(ds.TEXTURE0),ds.bindTexture(ds.TEXTURE_2D,hs.colorAttachment.get()),In.activeTexture.set(ds.TEXTURE1);let vs=pi.colorRampTexture;vs||(vs=pi.colorRampTexture=new th(In,pi.colorRamp,ds.RGBA)),vs.bind(ds.LINEAR,ds.CLAMP_TO_EDGE),ct.useProgram("heatmapTexture").draw(In,ds.TRIANGLES,ig.disabled,Hp.disabled,ct.colorModeForRenderPass(),yg.disabled,((fl,dl,dh,Ah)=>{const hh=s.create();s.ortho(hh,0,fl.width,fl.height,0,0,1);const Rh=fl.context.gl;return{u_matrix:hh,u_world:[Rh.drawingBufferWidth,Rh.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:dl.paint.get("heatmap-opacity")}})(ct,pi),null,pi.id,ct.viewportBuffer,ct.quadTriangleIndexBuffer,ct.viewportSegments,pi.paint,ct.transform.zoom)}(Ve,A))},line:function(Ve,g,A,_e){if(Ve.renderPass!=="translucent")return;const ct=A.paint.get("line-opacity"),pi=A.paint.get("line-width");if(ct.constantOr(1)===0||pi.constantOr(1)===0)return;const In=Ve.depthModeForSublayer(0,ig.ReadOnly),ds=Ve.colorModeForRenderPass(),hs=A.paint.get("line-dasharray"),vs=A.paint.get("line-pattern"),fl=vs.constantOr(1),dl=A.paint.get("line-gradient"),dh=A.getCrossfadeParameters(),Ah=fl?"linePattern":hs?"lineSDF":dl?"lineGradient":"line",hh=Ve.context,Rh=hh.gl;let zh=!0;for(const Kh of _e){const ad=g.getTile(Kh);if(fl&&!ad.patternsLoaded())continue;const Lh=ad.getBucket(A);if(!Lh)continue;const od=Lh.programConfigurations.get(A.id),md=Ve.context.program.get(),Nd=Ve.useProgram(Ah,od),Hd=zh||Nd.program!==md,tp=Ve.style.map.terrain&&Ve.style.map.terrain.getTerrainData(Kh),Vd=vs.constantOr(null);if(Vd&&ad.imageAtlas){const p=ad.imageAtlas,S=p.patternPositions[Vd.to.toString()],X=p.patternPositions[Vd.from.toString()];S&&X&&od.setConstantPatternPositions(S,X)}const gp=tp?Kh:null,L=fl?Fm(Ve,ad,A,dh,gp):hs?zy(Ve,ad,A,hs,dh,gp):dl?cy(Ve,ad,A,Lh.lineClipsArray.length,gp):O_(Ve,ad,A,gp);if(fl)hh.activeTexture.set(Rh.TEXTURE0),ad.imageAtlasTexture.bind(Rh.LINEAR,Rh.CLAMP_TO_EDGE),od.updatePaintBuffers(dh);else if(hs&&(Hd||Ve.lineAtlas.dirty))hh.activeTexture.set(Rh.TEXTURE0),Ve.lineAtlas.bind(hh);else if(dl){const p=Lh.gradients[A.id];let S=p.texture;if(A.gradientVersion!==p.version){let X=256;if(A.stepInterpolant){const ze=g.getSource().maxzoom,kt=Kh.canonical.z===ze?Math.ceil(1<<Ve.transform.maxZoom-Kh.canonical.z):1;X=s.clamp(s.nextPowerOfTwo(Lh.maxLineLength/s.EXTENT*1024*kt),256,hh.maxTextureSize)}p.gradient=s.renderColorRamp({expression:A.gradientExpression(),evaluationKey:"lineProgress",resolution:X,image:p.gradient||void 0,clips:Lh.lineClipsArray}),p.texture?p.texture.update(p.gradient):p.texture=new th(hh,p.gradient,Rh.RGBA),p.version=A.gradientVersion,S=p.texture}hh.activeTexture.set(Rh.TEXTURE0),S.bind(A.stepInterpolant?Rh.NEAREST:Rh.LINEAR,Rh.CLAMP_TO_EDGE)}Nd.draw(hh,Rh.TRIANGLES,In,Ve.stencilModeForClipping(Kh),ds,yg.disabled,L,tp,A.id,Lh.layoutVertexBuffer,Lh.indexBuffer,Lh.segments,A.paint,Ve.transform.zoom,od,Lh.layoutVertexBuffer2),zh=!1}},fill:function(Ve,g,A,_e){const ct=A.paint.get("fill-color"),pi=A.paint.get("fill-opacity");if(pi.constantOr(1)===0)return;const In=Ve.colorModeForRenderPass(),ds=A.paint.get("fill-pattern"),hs=Ve.opaquePassEnabledForLayer()&&!ds.constantOr(1)&&ct.constantOr(s.Color.transparent).a===1&&pi.constantOr(0)===1?"opaque":"translucent";if(Ve.renderPass===hs){const vs=Ve.depthModeForSublayer(1,Ve.renderPass==="opaque"?ig.ReadWrite:ig.ReadOnly);Ky(Ve,g,A,_e,vs,In,!1)}if(Ve.renderPass==="translucent"&&A.paint.get("fill-antialias")){const vs=Ve.depthModeForSublayer(A.getPaintProperty("fill-outline-color")?2:0,ig.ReadOnly);Ky(Ve,g,A,_e,vs,In,!0)}},"fill-extrusion":function(Ve,g,A,_e){const ct=A.paint.get("fill-extrusion-opacity");if(ct!==0&&Ve.renderPass==="translucent"){const pi=new ig(Ve.context.gl.LEQUAL,ig.ReadWrite,Ve.depthRangeFor3D);if(ct!==1||A.paint.get("fill-extrusion-pattern").constantOr(1))Zy(Ve,g,A,_e,pi,Hp.disabled,Og.disabled),Zy(Ve,g,A,_e,pi,Ve.stencilModeFor3D(),Ve.colorModeForRenderPass());else{const In=Ve.colorModeForRenderPass();Zy(Ve,g,A,_e,pi,Hp.disabled,In)}}},hillshade:function(Ve,g,A,_e){if(Ve.renderPass!=="offscreen"&&Ve.renderPass!=="translucent")return;const ct=Ve.context,pi=Ve.depthModeForSublayer(0,ig.ReadOnly),In=Ve.colorModeForRenderPass(),[ds,hs]=Ve.renderPass==="translucent"?Ve.stencilConfigForOverlap(_e):[{},_e];for(const vs of hs){const fl=g.getTile(vs);fl.needsHillshadePrepare!==void 0&&fl.needsHillshadePrepare&&Ve.renderPass==="offscreen"?Cx(Ve,fl,A,pi,Hp.disabled,In):Ve.renderPass==="translucent"&&W0(Ve,vs,fl,A,pi,ds[vs.overscaledZ],In)}ct.viewport.set([0,0,Ve.width,Ve.height])},raster:function(Ve,g,A,_e){if(Ve.renderPass!=="translucent"||A.paint.get("raster-opacity")===0||!_e.length)return;const ct=Ve.context,pi=ct.gl,In=g.getSource(),ds=Ve.useProgram("raster"),hs=Ve.colorModeForRenderPass(),[vs,fl]=In instanceof Ap?[{},_e]:Ve.stencilConfigForOverlap(_e),dl=fl[fl.length-1].overscaledZ,dh=!Ve.options.moving;for(const Ah of fl){const hh=Ve.depthModeForSublayer(Ah.overscaledZ-dl,A.paint.get("raster-opacity")===1?ig.ReadWrite:ig.ReadOnly,pi.LESS),Rh=g.getTile(Ah);Rh.registerFadeDuration(A.paint.get("raster-fade-duration"));const zh=g.findLoadedParent(Ah,0),Kh=Yg(Rh,zh,g,A,Ve.transform,Ve.style.map.terrain);let ad,Lh;const od=A.paint.get("raster-resampling")==="nearest"?pi.NEAREST:pi.LINEAR;ct.activeTexture.set(pi.TEXTURE0),Rh.texture.bind(od,pi.CLAMP_TO_EDGE,pi.LINEAR_MIPMAP_NEAREST),ct.activeTexture.set(pi.TEXTURE1),zh?(zh.texture.bind(od,pi.CLAMP_TO_EDGE,pi.LINEAR_MIPMAP_NEAREST),ad=Math.pow(2,zh.tileID.overscaledZ-Rh.tileID.overscaledZ),Lh=[Rh.tileID.canonical.x*ad%1,Rh.tileID.canonical.y*ad%1]):Rh.texture.bind(od,pi.CLAMP_TO_EDGE,pi.LINEAR_MIPMAP_NEAREST);const md=Ve.style.map.terrain&&Ve.style.map.terrain.getTerrainData(Ah),Nd=md?Ah:null,Hd=Nd?Nd.posMatrix:Ve.transform.calculatePosMatrix(Ah.toUnwrapped(),dh),tp=Gg(Hd,Lh||[0,0],ad||1,Kh,A);In instanceof Ap?ds.draw(ct,pi.TRIANGLES,hh,Hp.disabled,hs,yg.disabled,tp,md,A.id,In.boundsBuffer,Ve.quadTriangleIndexBuffer,In.boundsSegments):ds.draw(ct,pi.TRIANGLES,hh,vs[Ah.overscaledZ],hs,yg.disabled,tp,md,A.id,Ve.rasterBoundsBuffer,Ve.quadTriangleIndexBuffer,Ve.rasterBoundsSegments)}},background:function(Ve,g,A,_e){const ct=A.paint.get("background-color"),pi=A.paint.get("background-opacity");if(pi===0)return;const In=Ve.context,ds=In.gl,hs=Ve.transform,vs=hs.tileSize,fl=A.paint.get("background-pattern");if(Ve.isPatternMissing(fl))return;const dl=!fl&&ct.a===1&&pi===1&&Ve.opaquePassEnabledForLayer()?"opaque":"translucent";if(Ve.renderPass!==dl)return;const dh=Hp.disabled,Ah=Ve.depthModeForSublayer(0,dl==="opaque"?ig.ReadWrite:ig.ReadOnly),hh=Ve.colorModeForRenderPass(),Rh=Ve.useProgram(fl?"backgroundPattern":"background"),zh=_e||hs.coveringTiles({tileSize:vs,terrain:Ve.style.map.terrain});fl&&(In.activeTexture.set(ds.TEXTURE0),Ve.imageManager.bind(Ve.context));const Kh=A.getCrossfadeParameters();for(const ad of zh){const Lh=_e?ad.posMatrix:Ve.transform.calculatePosMatrix(ad.toUnwrapped()),od=fl?Em(Lh,pi,Ve,fl,{tileID:ad,tileSize:vs},Kh):Km(Lh,pi,ct),md=Ve.style.map.terrain&&Ve.style.map.terrain.getTerrainData(ad);Rh.draw(In,ds.TRIANGLES,Ah,dh,hh,yg.disabled,od,md,A.id,Ve.tileExtentBuffer,Ve.quadTriangleIndexBuffer,Ve.tileExtentSegments)}},debug:function(Ve,g,A){for(let _e=0;_e<A.length;_e++)q0(Ve,g,A[_e])},custom:function(Ve,g,A){const _e=Ve.context,ct=A.implementation;if(Ve.renderPass==="offscreen"){const pi=ct.prerender;pi&&(Ve.setCustomLayerDefaults(),_e.setColorMode(Ve.colorModeForRenderPass()),pi.call(ct,_e.gl,Ve.transform.customLayerMatrix()),_e.setDirty(),Ve.setBaseState())}else if(Ve.renderPass==="translucent"){Ve.setCustomLayerDefaults(),_e.setColorMode(Ve.colorModeForRenderPass()),_e.setStencilMode(Hp.disabled);const pi=ct.renderingMode==="3d"?new ig(Ve.context.gl.LEQUAL,ig.ReadWrite,Ve.depthRangeFor3D):Ve.depthModeForSublayer(0,ig.ReadOnly);_e.setDepthMode(pi),ct.render(_e.gl,Ve.transform.customLayerMatrix()),_e.setDirty(),Ve.setBaseState(),_e.bindFramebuffer.set(null)}}};class Z0{constructor(g,A){this.context=new Mv(g),this.transform=A,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.create(),renderTime:0},this.setup(),this.numSublayers=_p.maxUnderzooming+_p.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new f_}resize(g,A,_e){if(this.width=g*_e,this.height=A*_e,this.pixelRatio=_e,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const ct of this.style._order)this.style._layers[ct].resize()}setup(){const g=this.context,A=new s.PosArray;A.emplaceBack(0,0),A.emplaceBack(s.EXTENT,0),A.emplaceBack(0,s.EXTENT),A.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=g.createVertexBuffer(A,m_.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);const _e=new s.PosArray;_e.emplaceBack(0,0),_e.emplaceBack(s.EXTENT,0),_e.emplaceBack(0,s.EXTENT),_e.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=g.createVertexBuffer(_e,m_.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);const ct=new s.RasterBoundsArray;ct.emplaceBack(0,0,0,0),ct.emplaceBack(s.EXTENT,0,s.EXTENT,0),ct.emplaceBack(0,s.EXTENT,0,s.EXTENT),ct.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.rasterBoundsBuffer=g.createVertexBuffer(ct,Kd.members),this.rasterBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);const pi=new s.PosArray;pi.emplaceBack(0,0),pi.emplaceBack(1,0),pi.emplaceBack(0,1),pi.emplaceBack(1,1),this.viewportBuffer=g.createVertexBuffer(pi,m_.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);const In=new s.LineStripIndexArray;In.emplaceBack(0),In.emplaceBack(1),In.emplaceBack(3),In.emplaceBack(2),In.emplaceBack(0),this.tileBorderIndexBuffer=g.createIndexBuffer(In);const ds=new s.TriangleIndexArray;ds.emplaceBack(0,1,2),ds.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=g.createIndexBuffer(ds);const hs=this.context.gl;this.stencilClearMode=new Hp({func:hs.ALWAYS,mask:0},0,255,hs.ZERO,hs.ZERO,hs.ZERO)}clearStencil(){const g=this.context,A=g.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const _e=s.create();s.ortho(_e,0,this.width,this.height,0,0,1),s.scale(_e,_e,[A.drawingBufferWidth,A.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(g,A.TRIANGLES,ig.disabled,this.stencilClearMode,Og.disabled,yg.disabled,By(_e),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(g,A){if(this.currentStencilSource===g.source||!g.isTileClipped()||!A||!A.length)return;this.currentStencilSource=g.source;const _e=this.context,ct=_e.gl;this.nextStencilID+A.length>256&&this.clearStencil(),_e.setColorMode(Og.disabled),_e.setDepthMode(ig.disabled);const pi=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const In of A){const ds=this._tileClippingMaskIDs[In.key]=this.nextStencilID++,hs=this.style.map.terrain&&this.style.map.terrain.getTerrainData(In);pi.draw(_e,ct.TRIANGLES,ig.disabled,new Hp({func:ct.ALWAYS,mask:0},ds,255,ct.KEEP,ct.KEEP,ct.REPLACE),Og.disabled,yg.disabled,By(In.posMatrix),hs,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const g=this.nextStencilID++,A=this.context.gl;return new Hp({func:A.NOTEQUAL,mask:255},g,255,A.KEEP,A.KEEP,A.REPLACE)}stencilModeForClipping(g){const A=this.context.gl;return new Hp({func:A.EQUAL,mask:255},this._tileClippingMaskIDs[g.key],0,A.KEEP,A.KEEP,A.REPLACE)}stencilConfigForOverlap(g){const A=this.context.gl,_e=g.sort((In,ds)=>ds.overscaledZ-In.overscaledZ),ct=_e[_e.length-1].overscaledZ,pi=_e[0].overscaledZ-ct+1;if(pi>1){this.currentStencilSource=void 0,this.nextStencilID+pi>256&&this.clearStencil();const In={};for(let ds=0;ds<pi;ds++)In[ds+ct]=new Hp({func:A.GEQUAL,mask:255},ds+this.nextStencilID,255,A.KEEP,A.KEEP,A.REPLACE);return this.nextStencilID+=pi,[In,_e]}return[{[ct]:Hp.disabled},_e]}colorModeForRenderPass(){const g=this.context.gl;return this._showOverdrawInspector?new Og([g.CONSTANT_COLOR,g.ONE],new s.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Og.unblended:Og.alphaBlended}depthModeForSublayer(g,A,_e){if(!this.opaquePassEnabledForLayer())return ig.disabled;const ct=1-((1+this.currentLayer)*this.numSublayers+g)*this.depthEpsilon;return new ig(_e||this.context.gl.LEQUAL,A,[ct,ct])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(g,A){this.style=g,this.options=A,this.lineAtlas=g.lineAtlas,this.imageManager=g.imageManager,this.glyphManager=g.glyphManager,this.symbolFadeChange=g.placement.symbolFadeChange(s.exported.now()),this.imageManager.beginFrame();const _e=this.style._order,ct=this.style.sourceCaches,pi={},In={},ds={};for(const hs in ct){const vs=ct[hs];vs.used&&vs.prepare(this.context),pi[hs]=vs.getVisibleCoordinates(),In[hs]=pi[hs].slice().reverse(),ds[hs]=vs.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let hs=0;hs<_e.length;hs++)if(this.style._layers[_e[hs]].is3D()){this.opaquePassCutoff=hs;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const hs=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!s.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||hs.length)&&(s.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(vs,fl){const dl=vs.context,dh=dl.gl,Ah=Og.unblended,hh=new ig(dh.LEQUAL,ig.ReadWrite,[0,1]),Rh=fl.getTerrainMesh(),zh=fl.sourceCache.getRenderableTiles(),Kh=vs.useProgram("terrainDepth");dl.bindFramebuffer.set(fl.getFramebuffer("depth").framebuffer),dl.viewport.set([0,0,vs.width/devicePixelRatio,vs.height/devicePixelRatio]),dl.clear({color:s.Color.transparent,depth:1});for(const ad of zh){const Lh=fl.getTerrainData(ad.tileID),od={u_matrix:vs.transform.calculatePosMatrix(ad.tileID.toUnwrapped()),u_ele_delta:fl.getMeshFrameDelta(vs.transform.zoom)};Kh.draw(dl,dh.TRIANGLES,hh,Hp.disabled,Ah,yg.backCCW,od,Lh,"terrain",Rh.vertexBuffer,Rh.indexBuffer,Rh.segments)}dl.bindFramebuffer.set(null),dl.viewport.set([0,0,vs.width,vs.height])}(this,this.style.map.terrain),function(vs,fl){const dl=vs.context,dh=dl.gl,Ah=Og.unblended,hh=new ig(dh.LEQUAL,ig.ReadWrite,[0,1]),Rh=fl.getTerrainMesh(),zh=fl.getCoordsTexture(),Kh=fl.sourceCache.getRenderableTiles(),ad=vs.useProgram("terrainCoords");dl.bindFramebuffer.set(fl.getFramebuffer("coords").framebuffer),dl.viewport.set([0,0,vs.width/devicePixelRatio,vs.height/devicePixelRatio]),dl.clear({color:s.Color.transparent,depth:1}),fl.coordsIndex=[];for(const Lh of Kh){const od=fl.getTerrainData(Lh.tileID);dl.activeTexture.set(dh.TEXTURE0),dh.bindTexture(dh.TEXTURE_2D,zh.texture);const md={u_matrix:vs.transform.calculatePosMatrix(Lh.tileID.toUnwrapped()),u_terrain_coords_id:(255-fl.coordsIndex.length)/255,u_texture:0,u_ele_delta:fl.getMeshFrameDelta(vs.transform.zoom)};ad.draw(dl,dh.TRIANGLES,hh,Hp.disabled,Ah,yg.backCCW,md,od,"terrain",Rh.vertexBuffer,Rh.indexBuffer,Rh.segments),fl.coordsIndex.push(Lh.tileID.key)}dl.bindFramebuffer.set(null),dl.viewport.set([0,0,vs.width,vs.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const hs of _e){const vs=this.style._layers[hs];if(!vs.hasOffscreenPass()||vs.isHidden(this.transform.zoom))continue;const fl=In[vs.source];(vs.type==="custom"||fl.length)&&this.renderLayer(this,ct[vs.source],vs,fl)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:A.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=A.showOverdrawInspector,this.depthRangeFor3D=[0,1-(g._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_e.length-1;this.currentLayer>=0;this.currentLayer--){const hs=this.style._layers[_e[this.currentLayer]],vs=ct[hs.source],fl=pi[hs.source];this._renderTileClippingMasks(hs,fl),this.renderLayer(this,vs,hs,fl)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_e.length;this.currentLayer++){const hs=this.style._layers[_e[this.currentLayer]],vs=ct[hs.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(hs))continue;const fl=(hs.type==="symbol"?ds:In)[hs.source];this._renderTileClippingMasks(hs,pi[hs.source]),this.renderLayer(this,vs,hs,fl)}if(this.options.showTileBoundaries){const hs=function(vs,fl){let dl=null;const dh=Object.values(vs._layers).flatMap(zh=>zh.source&&!zh.isHidden(fl)?[vs.sourceCaches[zh.source]]:[]),Ah=dh.filter(zh=>zh.getSource().type==="vector"),hh=dh.filter(zh=>zh.getSource().type!=="vector"),Rh=zh=>{(!dl||dl.getSource().maxzoom<zh.getSource().maxzoom)&&(dl=zh)};return Ah.forEach(zh=>Rh(zh)),dl||hh.forEach(zh=>Rh(zh)),dl}(this.style,this.transform.zoom);hs&&K0.debug(this,hs,hs.getVisibleCoordinates())}this.options.showPadding&&function(hs){const vs=hs.transform.padding;J_(hs,hs.transform.height-(vs.top||0),3,Xy),J_(hs,vs.bottom||0,3,Nm),Zm(hs,vs.left||0,3,Yy),Zm(hs,hs.transform.width-(vs.right||0),3,g0);const fl=hs.transform.centerPoint;(function(dl,dh,Ah,hh){Q_(dl,dh-1,Ah-10,2,20,hh),Q_(dl,dh-10,Ah-1,20,2,hh)})(hs,fl.x,hs.transform.height-fl.y,Dv)}(this),this.context.setDefault()}renderLayer(g,A,_e,ct){_e.isHidden(this.transform.zoom)||(_e.type==="background"||_e.type==="custom"||(ct||[]).length)&&(this.id=_e.id,K0[_e.type](g,A,_e,ct,this.style.placement.variableOffsets))}translatePosMatrix(g,A,_e,ct,pi){if(!_e[0]&&!_e[1])return g;const In=pi?ct==="map"?this.transform.angle:0:ct==="viewport"?-this.transform.angle:0;if(In){const vs=Math.sin(In),fl=Math.cos(In);_e=[_e[0]*fl-_e[1]*vs,_e[0]*vs+_e[1]*fl]}const ds=[pi?_e[0]:vh(A,_e[0],this.transform.zoom),pi?_e[1]:vh(A,_e[1],this.transform.zoom),0],hs=new Float32Array(16);return s.translate(hs,g,ds),hs}saveTileTexture(g){const A=this._tileTextures[g.size[0]];A?A.push(g):this._tileTextures[g.size[0]]=[g]}getTileTexture(g){const A=this._tileTextures[g];return A&&A.length>0?A.pop():null}isPatternMissing(g){if(!g)return!1;if(!g.from||!g.to)return!0;const A=this.imageManager.getPattern(g.from.toString()),_e=this.imageManager.getPattern(g.to.toString());return!A||!_e}useProgram(g,A){this.cache=this.cache||{};const _e=g+(A?A.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[_e]||(this.cache[_e]=new jf(this.context,g,W_[g],A,zg[g],this._showOverdrawInspector,this.style.map.terrain)),this.cache[_e]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const g=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(g.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new th(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class X0{constructor(g,A){this.points=g,this.planes=A}static fromInvProjectionMatrix(g,A,_e){const ct=Math.pow(2,_e),pi=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(ds=>{const hs=1/(ds=s.transformMat4([],ds,g))[3]/A*ct;return s.mul$1(ds,ds,[hs,hs,1/ds[3],hs])}),In=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(ds=>{const hs=function(dh,Ah){var hh=Ah[0],Rh=Ah[1],zh=Ah[2],Kh=hh*hh+Rh*Rh+zh*zh;return Kh>0&&(Kh=1/Math.sqrt(Kh)),dh[0]=Ah[0]*Kh,dh[1]=Ah[1]*Kh,dh[2]=Ah[2]*Kh,dh}([],function(dh,Ah,hh){var Rh=Ah[0],zh=Ah[1],Kh=Ah[2],ad=hh[0],Lh=hh[1],od=hh[2];return dh[0]=zh*od-Kh*Lh,dh[1]=Kh*ad-Rh*od,dh[2]=Rh*Lh-zh*ad,dh}([],ml([],pi[ds[0]],pi[ds[1]]),ml([],pi[ds[2]],pi[ds[1]]))),vs=-((fl=hs)[0]*(dl=pi[ds[1]])[0]+fl[1]*dl[1]+fl[2]*dl[2]);var fl,dl;return hs.concat(vs)});return new X0(pi,In)}}class v_{constructor(g,A){this.min=g,this.max=A,this.center=function(_e,ct,pi){return _e[0]=.5*ct[0],_e[1]=.5*ct[1],_e[2]=.5*ct[2],_e}([],function(_e,ct,pi){return _e[0]=ct[0]+pi[0],_e[1]=ct[1]+pi[1],_e[2]=ct[2]+pi[2],_e}([],this.min,this.max))}quadrant(g){const A=[g%2==0,g<2],_e=il(this.min),ct=il(this.max);for(let pi=0;pi<A.length;pi++)_e[pi]=A[pi]?this.min[pi]:this.center[pi],ct[pi]=A[pi]?this.center[pi]:this.max[pi];return ct[2]=this.max[2],new v_(_e,ct)}distanceX(g){return Math.max(Math.min(this.max[0],g[0]),this.min[0])-g[0]}distanceY(g){return Math.max(Math.min(this.max[1],g[1]),this.min[1])-g[1]}intersects(g){const A=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let _e=!0;for(let ct=0;ct<g.planes.length;ct++){const pi=g.planes[ct];let In=0;for(let ds=0;ds<A.length;ds++)s.dot(pi,A[ds])>=0&&In++;if(In===0)return 0;In!==A.length&&(_e=!1)}if(_e)return 2;for(let ct=0;ct<3;ct++){let pi=Number.MAX_VALUE,In=-Number.MAX_VALUE;for(let ds=0;ds<g.points.length;ds++){const hs=g.points[ds][ct]-this.min[ct];pi=Math.min(pi,hs),In=Math.max(In,hs)}if(In<0||pi>this.max[ct]-this.min[ct])return 0}return 1}}class Jy{constructor(g=0,A=0,_e=0,ct=0){if(isNaN(g)||g<0||isNaN(A)||A<0||isNaN(_e)||_e<0||isNaN(ct)||ct<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=g,this.bottom=A,this.left=_e,this.right=ct}interpolate(g,A,_e){return A.top!=null&&g.top!=null&&(this.top=s.interpolate.number(g.top,A.top,_e)),A.bottom!=null&&g.bottom!=null&&(this.bottom=s.interpolate.number(g.bottom,A.bottom,_e)),A.left!=null&&g.left!=null&&(this.left=s.interpolate.number(g.left,A.left,_e)),A.right!=null&&g.right!=null&&(this.right=s.interpolate.number(g.right,A.right,_e)),this}getCenter(g,A){const _e=s.clamp((this.left+g-this.right)/2,0,g),ct=s.clamp((this.top+A-this.bottom)/2,0,A);return new s.Point(_e,ct)}equals(g){return this.top===g.top&&this.bottom===g.bottom&&this.left===g.left&&this.right===g.right}clone(){return new Jy(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class gy{constructor(g,A,_e,ct,pi){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=pi===void 0||!!pi,this._minZoom=g||0,this._maxZoom=A||22,this._minPitch=_e??0,this._maxPitch=ct??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Jy,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const g=new gy(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return g.apply(this),g}apply(g){this.tileSize=g.tileSize,this.latRange=g.latRange,this.width=g.width,this.height=g.height,this._center=g._center,this._elevation=g._elevation,this.zoom=g.zoom,this.angle=g.angle,this._fov=g._fov,this._pitch=g._pitch,this._unmodified=g._unmodified,this._edgeInsets=g._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(g){this._minZoom!==g&&(this._minZoom=g,this.zoom=Math.max(this.zoom,g))}get maxZoom(){return this._maxZoom}set maxZoom(g){this._maxZoom!==g&&(this._maxZoom=g,this.zoom=Math.min(this.zoom,g))}get minPitch(){return this._minPitch}set minPitch(g){this._minPitch!==g&&(this._minPitch=g,this.pitch=Math.max(this.pitch,g))}get maxPitch(){return this._maxPitch}set maxPitch(g){this._maxPitch!==g&&(this._maxPitch=g,this.pitch=Math.min(this.pitch,g))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(g){g===void 0?g=!0:g===null&&(g=!1),this._renderWorldCopies=g}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.Point(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(g){const A=-s.wrap(g,-180,180)*Math.PI/180;this.angle!==A&&(this._unmodified=!1,this.angle=A,this._calcMatrices(),this.rotationMatrix=function(){var _e=new s.ARRAY_TYPE(4);return s.ARRAY_TYPE!=Float32Array&&(_e[1]=0,_e[2]=0),_e[0]=1,_e[3]=1,_e}(),function(_e,ct,pi){var In=ct[0],ds=ct[1],hs=ct[2],vs=ct[3],fl=Math.sin(pi),dl=Math.cos(pi);_e[0]=In*dl+hs*fl,_e[1]=ds*dl+vs*fl,_e[2]=In*-fl+hs*dl,_e[3]=ds*-fl+vs*dl}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(g){const A=s.clamp(g,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==A&&(this._unmodified=!1,this._pitch=A,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(g){g=Math.max(.01,Math.min(60,g)),this._fov!==g&&(this._unmodified=!1,this._fov=g/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(g){const A=Math.min(Math.max(g,this.minZoom),this.maxZoom);this._zoom!==A&&(this._unmodified=!1,this._zoom=A,this.tileZoom=Math.max(0,Math.floor(A)),this.scale=this.zoomScale(A),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(g){g.lat===this._center.lat&&g.lng===this._center.lng||(this._unmodified=!1,this._center=g,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(g){g!==this._elevation&&(this._elevation=g,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(g){this._edgeInsets.equals(g)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,g,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(g){return this._edgeInsets.equals(g)}interpolatePadding(g,A,_e){this._unmodified=!1,this._edgeInsets.interpolate(g,A,_e),this._constrain(),this._calcMatrices()}coveringZoomLevel(g){const A=(g.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/g.tileSize));return Math.max(0,A)}getVisibleUnwrappedCoordinates(g){const A=[new s.UnwrappedTileID(0,g)];if(this._renderWorldCopies){const _e=this.pointCoordinate(new s.Point(0,0)),ct=this.pointCoordinate(new s.Point(this.width,0)),pi=this.pointCoordinate(new s.Point(this.width,this.height)),In=this.pointCoordinate(new s.Point(0,this.height)),ds=Math.floor(Math.min(_e.x,ct.x,pi.x,In.x)),hs=Math.floor(Math.max(_e.x,ct.x,pi.x,In.x)),vs=1;for(let fl=ds-vs;fl<=hs+vs;fl++)fl!==0&&A.push(new s.UnwrappedTileID(fl,g))}return A}coveringTiles(g){var A,_e;let ct=this.coveringZoomLevel(g);const pi=ct;if(g.minzoom!==void 0&&ct<g.minzoom)return[];g.maxzoom!==void 0&&ct>g.maxzoom&&(ct=g.maxzoom);const In=this.pointCoordinate(this.getCameraPoint()),ds=s.MercatorCoordinate.fromLngLat(this.center),hs=Math.pow(2,ct),vs=[hs*In.x,hs*In.y,0],fl=[hs*ds.x,hs*ds.y,0],dl=X0.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,ct);let dh=g.minzoom||0;!g.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(dh=ct);const Ah=g.terrain?2/Math.min(this.tileSize,g.tileSize)*this.tileSize:3,hh=Lh=>({aabb:new v_([Lh*hs,0,0],[(Lh+1)*hs,hs,0]),zoom:0,x:0,y:0,wrap:Lh,fullyVisible:!1}),Rh=[],zh=[],Kh=ct,ad=g.reparseOverscaled?pi:ct;if(this._renderWorldCopies)for(let Lh=1;Lh<=3;Lh++)Rh.push(hh(-Lh)),Rh.push(hh(Lh));for(Rh.push(hh(0));Rh.length>0;){const Lh=Rh.pop(),od=Lh.x,md=Lh.y;let Nd=Lh.fullyVisible;if(!Nd){const L=Lh.aabb.intersects(dl);if(L===0)continue;Nd=L===2}const Hd=g.terrain?vs:fl,tp=Lh.aabb.distanceX(Hd),Vd=Lh.aabb.distanceY(Hd),gp=Math.max(Math.abs(tp),Math.abs(Vd));if(Lh.zoom===Kh||gp>Ah+(1<<Kh-Lh.zoom)-2&&Lh.zoom>=dh){const L=Kh-Lh.zoom,p=vs[0]-.5-(od<<L),S=vs[1]-.5-(md<<L);zh.push({tileID:new s.OverscaledTileID(Lh.zoom===Kh?ad:Lh.zoom,Lh.wrap,Lh.zoom,od,md),distanceSq:sl([fl[0]-.5-od,fl[1]-.5-md]),tileDistanceToCamera:Math.sqrt(p*p+S*S)})}else for(let L=0;L<4;L++){const p=(od<<1)+L%2,S=(md<<1)+(L>>1),X=Lh.zoom+1;let ze=Lh.aabb.quadrant(L);if(g.terrain){const kt=new s.OverscaledTileID(X,Lh.wrap,X,p,S),vi=g.terrain.getMinMaxElevation(kt),or=(A=vi.minElevation)!==null&&A!==void 0?A:this.elevation,Gn=(_e=vi.maxElevation)!==null&&_e!==void 0?_e:this.elevation;ze=new v_([ze.min[0],ze.min[1],or],[ze.max[0],ze.max[1],Gn])}Rh.push({aabb:ze,zoom:X,x:p,y:S,wrap:Lh.wrap,fullyVisible:Nd})}}return zh.sort((Lh,od)=>Lh.distanceSq-od.distanceSq).map(Lh=>Lh.tileID)}resize(g,A){this.width=g,this.height=A,this.pixelsToGLUnits=[2/g,-2/A],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(g){return Math.pow(2,g)}scaleZoom(g){return Math.log(g)/Math.LN2}project(g){const A=s.clamp(g.lat,-this.maxValidLatitude,this.maxValidLatitude);return new s.Point(s.mercatorXfromLng(g.lng)*this.worldSize,s.mercatorYfromLat(A)*this.worldSize)}unproject(g){return new s.MercatorCoordinate(g.x/this.worldSize,g.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(g){this.freezeElevation||(this.elevation=g?this.getElevation(this._center,g):0)}getElevation(g,A){const _e=s.MercatorCoordinate.fromLngLat(g.wrap()),ct=(1<<this.tileZoom)*s.EXTENT,pi=_e.x*ct,In=_e.y*ct,ds=Math.floor(pi/s.EXTENT),hs=Math.floor(In/s.EXTENT),vs=new s.OverscaledTileID(this.tileZoom,0,this.tileZoom,ds,hs);return A.getElevation(vs,pi%s.EXTENT,In%s.EXTENT,s.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(g){const A=this.pointLocation(this.centerPoint,g),_e=this.getElevation(A,g);if(!(this.elevation-_e))return;const ct=this.getCameraPosition(),pi=s.MercatorCoordinate.fromLngLat(ct.lngLat,ct.altitude),In=s.MercatorCoordinate.fromLngLat(A,_e),ds=pi.x-In.x,hs=pi.y-In.y,vs=pi.z-In.z,fl=Math.sqrt(ds*ds+hs*hs+vs*vs),dl=this.scaleZoom(this.cameraToCenterDistance/fl/this.tileSize);this._elevation=_e,this._center=A,this.zoom=dl}setLocationAtPoint(g,A){const _e=this.pointCoordinate(A),ct=this.pointCoordinate(this.centerPoint),pi=this.locationCoordinate(g),In=new s.MercatorCoordinate(pi.x-(_e.x-ct.x),pi.y-(_e.y-ct.y));this.center=this.coordinateLocation(In),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(g,A){return A?this.coordinatePoint(this.locationCoordinate(g),this.getElevation(g,A),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(g))}pointLocation(g,A){return this.coordinateLocation(this.pointCoordinate(g,A))}locationCoordinate(g){return s.MercatorCoordinate.fromLngLat(g)}coordinateLocation(g){return g&&g.toLngLat()}pointCoordinate(g,A){if(A){const dh=A.pointCoordinate(g);if(dh!=null)return dh}const _e=[g.x,g.y,0,1],ct=[g.x,g.y,1,1];s.transformMat4(_e,_e,this.pixelMatrixInverse),s.transformMat4(ct,ct,this.pixelMatrixInverse);const pi=_e[3],In=ct[3],ds=_e[1]/pi,hs=ct[1]/In,vs=_e[2]/pi,fl=ct[2]/In,dl=vs===fl?0:(0-vs)/(fl-vs);return new s.MercatorCoordinate(s.interpolate.number(_e[0]/pi,ct[0]/In,dl)/this.worldSize,s.interpolate.number(ds,hs,dl)/this.worldSize)}coordinatePoint(g,A=0,_e=this.pixelMatrix){const ct=[g.x*this.worldSize,g.y*this.worldSize,A,1];return s.transformMat4(ct,ct,_e),new s.Point(ct[0]/ct[3],ct[1]/ct[3])}getBounds(){const g=Math.max(0,this.height/2-this.getHorizon());return new Rd().extend(this.pointLocation(new s.Point(0,g))).extend(this.pointLocation(new s.Point(this.width,g))).extend(this.pointLocation(new s.Point(this.width,this.height))).extend(this.pointLocation(new s.Point(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Rd([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(g){g?(this.lngRange=[g.getWest(),g.getEast()],this.latRange=[g.getSouth(),g.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(g,A=!1){const _e=g.key,ct=A?this._alignedPosMatrixCache:this._posMatrixCache;if(ct[_e])return ct[_e];const pi=g.canonical,In=this.worldSize/this.zoomScale(pi.z),ds=pi.x+Math.pow(2,pi.z)*g.wrap,hs=s.identity(new Float64Array(16));return s.translate(hs,hs,[ds*In,pi.y*In,0]),s.scale(hs,hs,[In/s.EXTENT,In/s.EXTENT,1]),s.multiply(hs,A?this.alignedProjMatrix:this.projMatrix,hs),ct[_e]=new Float32Array(hs),ct[_e]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let g,A,_e,ct,pi=-90,In=90,ds=-180,hs=180;const vs=this.size,fl=this._unmodified;if(this.latRange){const Ah=this.latRange;pi=s.mercatorYfromLat(Ah[1])*this.worldSize,In=s.mercatorYfromLat(Ah[0])*this.worldSize,g=In-pi<vs.y?vs.y/(In-pi):0}if(this.lngRange){const Ah=this.lngRange;ds=s.wrap(s.mercatorXfromLng(Ah[0])*this.worldSize,0,this.worldSize),hs=s.wrap(s.mercatorXfromLng(Ah[1])*this.worldSize,0,this.worldSize),hs<ds&&(hs+=this.worldSize),A=hs-ds<vs.x?vs.x/(hs-ds):0}const dl=this.point,dh=Math.max(A||0,g||0);if(dh)return this.center=this.unproject(new s.Point(A?(hs+ds)/2:dl.x,g?(In+pi)/2:dl.y)),this.zoom+=this.scaleZoom(dh),this._unmodified=fl,void(this._constraining=!1);if(this.latRange){const Ah=dl.y,hh=vs.y/2;Ah-hh<pi&&(ct=pi+hh),Ah+hh>In&&(ct=In-hh)}if(this.lngRange){const Ah=(ds+hs)/2,hh=s.wrap(dl.x,Ah-this.worldSize/2,Ah+this.worldSize/2),Rh=vs.x/2;hh-Rh<ds&&(_e=ds+Rh),hh+Rh>hs&&(_e=hs-Rh)}_e===void 0&&ct===void 0||(this.center=this.unproject(new s.Point(_e!==void 0?_e:dl.x,ct!==void 0?ct:dl.y)).wrap()),this._unmodified=fl,this._constraining=!1}_calcMatrices(){if(!this.height)return;const g=this.centerOffset,A=this.point.x,_e=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=s.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let ct=s.identity(new Float64Array(16));s.scale(ct,ct,[this.width/2,-this.height/2,1]),s.translate(ct,ct,[1,-1,0]),this.labelPlaneMatrix=ct,ct=s.identity(new Float64Array(16)),s.scale(ct,ct,[1,-1,1]),s.translate(ct,ct,[-1,-1,0]),s.scale(ct,ct,[2/this.width,2/this.height,1]),this.glCoordMatrix=ct,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const pi=this._elevation<0?this.cameraToCenterDistance:this.cameraToSeaLevelDistance,In=Math.PI/2+this._pitch,ds=this._fov*(.5+g.y/this.height),hs=Math.sin(ds)*pi/Math.sin(s.clamp(Math.PI-In-ds,.01,Math.PI-.01)),vs=this.getHorizon(),fl=2*Math.atan(vs/this.cameraToCenterDistance)*(.5+g.y/(2*vs)),dl=Math.sin(fl)*pi/Math.sin(s.clamp(Math.PI-In-fl,.01,Math.PI-.01)),dh=Math.min(hs,dl),Ah=1.01*(Math.cos(Math.PI/2-this._pitch)*dh+pi),hh=this.height/50;ct=new Float64Array(16),s.perspective(ct,this._fov,this.width/this.height,hh,Ah),ct[8]=2*-g.x/this.width,ct[9]=2*g.y/this.height,s.scale(ct,ct,[1,-1,1]),s.translate(ct,ct,[0,0,-this.cameraToCenterDistance]),s.rotateX(ct,ct,this._pitch),s.rotateZ(ct,ct,this.angle),s.translate(ct,ct,[-A,-_e,0]),this.mercatorMatrix=s.scale([],ct,[this.worldSize,this.worldSize,this.worldSize]),s.scale(ct,ct,[1,1,this._pixelPerMeter]),this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,ct),s.translate(ct,ct,[0,0,-this.elevation]),this.projMatrix=ct,this.invProjMatrix=s.invert([],ct),this.pixelMatrix3D=s.multiply(new Float64Array(16),this.labelPlaneMatrix,ct);const Rh=this.width%2/2,zh=this.height%2/2,Kh=Math.cos(this.angle),ad=Math.sin(this.angle),Lh=A-Math.round(A)+Kh*Rh+ad*zh,od=_e-Math.round(_e)+Kh*zh+ad*Rh,md=new Float64Array(ct);if(s.translate(md,md,[Lh>.5?Lh-1:Lh,od>.5?od-1:od,0]),this.alignedProjMatrix=md,ct=s.invert(new Float64Array(16),this.pixelMatrix),!ct)throw new Error("failed to invert matrix");this.pixelMatrixInverse=ct,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const g=this.pointCoordinate(new s.Point(0,0)),A=[g.x*this.worldSize,g.y*this.worldSize,0,1];return s.transformMat4(A,A,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const g=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.Point(0,g))}getCameraQueryGeometry(g){const A=this.getCameraPoint();if(g.length===1)return[g[0],A];{let _e=A.x,ct=A.y,pi=A.x,In=A.y;for(const ds of g)_e=Math.min(_e,ds.x),ct=Math.min(ct,ds.y),pi=Math.max(pi,ds.x),In=Math.max(In,ds.y);return[new s.Point(_e,ct),new s.Point(pi,ct),new s.Point(pi,In),new s.Point(_e,In),new s.Point(_e,ct)]}}}class Ex{constructor(g){this._hashName=g&&encodeURIComponent(g),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(A,_e){let ct=!1,pi=null;const In=()=>{pi=null,ct&&(A(),pi=setTimeout(In,300),ct=!1)};return()=>(ct=!0,pi||In(),pi)}(this._updateHashUnthrottled.bind(this))}addTo(g){return this._map=g,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(g){const A=this._map.getCenter(),_e=Math.round(100*this._map.getZoom())/100,ct=Math.ceil((_e*Math.LN2+Math.log(512/360/.5))/Math.LN10),pi=Math.pow(10,ct),In=Math.round(A.lng*pi)/pi,ds=Math.round(A.lat*pi)/pi,hs=this._map.getBearing(),vs=this._map.getPitch();let fl="";if(fl+=g?`/${In}/${ds}/${_e}`:`${_e}/${ds}/${In}`,(hs||vs)&&(fl+="/"+Math.round(10*hs)/10),vs&&(fl+=`/${Math.round(vs)}`),this._hashName){const dl=this._hashName;let dh=!1;const Ah=window.location.hash.slice(1).split("&").map(hh=>{const Rh=hh.split("=")[0];return Rh===dl?(dh=!0,`${Rh}=${fl}`):hh}).filter(hh=>hh);return dh||Ah.push(`${dl}=${fl}`),`#${Ah.join("&")}`}return`#${fl}`}_getCurrentHash(){const g=window.location.hash.replace("#","");if(this._hashName){let A;return g.split("&").map(_e=>_e.split("=")).forEach(_e=>{_e[0]===this._hashName&&(A=_e)}),(A&&A[1]||"").split("/")}return g.split("/")}_onHashChange(){const g=this._getCurrentHash();if(g.length>=3&&!g.some(A=>isNaN(A))){const A=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(g[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+g[2],+g[1]],zoom:+g[0],bearing:A,pitch:+(g[4]||0)}),!0}return!1}_updateHashUnthrottled(){const g=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,g)}catch{}}}const Qy={linearity:.3,easing:s.bezier(0,0,.3,1)},Ux=s.extend({deceleration:2500,maxSpeed:1400},Qy),Y0=s.extend({deceleration:20,maxSpeed:1400},Qy),Ov=s.extend({deceleration:1e3,maxSpeed:360},Qy),Fv=s.extend({deceleration:1e3,maxSpeed:90},Qy);class R_{constructor(g){this._map=g,this.clear()}clear(){this._inertiaBuffer=[]}record(g){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.exported.now(),settings:g})}_drainInertiaBuffer(){const g=this._inertiaBuffer,A=s.exported.now();for(;g.length>0&&A-g[0].time>160;)g.shift()}_onMoveEnd(g){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const A={zoom:0,bearing:0,pitch:0,pan:new s.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:pi}of this._inertiaBuffer)A.zoom+=pi.zoomDelta||0,A.bearing+=pi.bearingDelta||0,A.pitch+=pi.pitchDelta||0,pi.panDelta&&A.pan._add(pi.panDelta),pi.around&&(A.around=pi.around),pi.pinchAround&&(A.pinchAround=pi.pinchAround);const _e=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,ct={};if(A.pan.mag()){const pi=Nv(A.pan.mag(),_e,s.extend({},Ux,g||{}));ct.offset=A.pan.mult(pi.amount/A.pan.mag()),ct.center=this._map.transform.center,Um(ct,pi)}if(A.zoom){const pi=Nv(A.zoom,_e,Y0);ct.zoom=this._map.transform.zoom+pi.amount,Um(ct,pi)}if(A.bearing){const pi=Nv(A.bearing,_e,Ov);ct.bearing=this._map.transform.bearing+s.clamp(pi.amount,-179,179),Um(ct,pi)}if(A.pitch){const pi=Nv(A.pitch,_e,Fv);ct.pitch=this._map.transform.pitch+pi.amount,Um(ct,pi)}if(ct.zoom||ct.bearing){const pi=A.pinchAround===void 0?A.around:A.pinchAround;ct.around=pi?this._map.unproject(pi):this._map.getCenter()}return this.clear(),s.extend(ct,{noMoveStart:!0})}}function Um(Ve,g){(!Ve.duration||Ve.duration<g.duration)&&(Ve.duration=g.duration,Ve.easing=g.easing)}function Nv(Ve,g,A){const{maxSpeed:_e,linearity:ct,deceleration:pi}=A,In=s.clamp(Ve*ct/(g/1e3),-_e,_e),ds=Math.abs(In)/(pi*ct);return{easing:A.easing,duration:1e3*ds,amount:In*(ds/2)}}class Vg extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(g,A,_e,ct={}){const pi=y.mousePos(A.getCanvasContainer(),_e),In=A.unproject(pi);super(g,s.extend({point:pi,lngLat:In,originalEvent:_e},ct)),this._defaultPrevented=!1,this.target=A}}class my extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(g,A,_e){const ct=g==="touchend"?_e.changedTouches:_e.touches,pi=y.touchPos(A.getCanvasContainer(),ct),In=pi.map(hs=>A.unproject(hs)),ds=pi.reduce((hs,vs,fl,dl)=>hs.add(vs.div(dl.length)),new s.Point(0,0));super(g,{points:pi,point:ds,lngLats:In,lngLat:A.unproject(ds),originalEvent:_e}),this._defaultPrevented=!1}}class xw extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(g,A,_e){super(g,{originalEvent:_e}),this._defaultPrevented=!1}}class ww{constructor(g,A){this._map=g,this._clickTolerance=A.clickTolerance}reset(){delete this._mousedownPos}wheel(g){return this._firePreventable(new xw(g.type,this._map,g))}mousedown(g,A){return this._mousedownPos=A,this._firePreventable(new Vg(g.type,this._map,g))}mouseup(g){this._map.fire(new Vg(g.type,this._map,g))}click(g,A){this._mousedownPos&&this._mousedownPos.dist(A)>=this._clickTolerance||this._map.fire(new Vg(g.type,this._map,g))}dblclick(g){return this._firePreventable(new Vg(g.type,this._map,g))}mouseover(g){this._map.fire(new Vg(g.type,this._map,g))}mouseout(g){this._map.fire(new Vg(g.type,this._map,g))}touchstart(g){return this._firePreventable(new my(g.type,this._map,g))}touchmove(g){this._map.fire(new my(g.type,this._map,g))}touchend(g){this._map.fire(new my(g.type,this._map,g))}touchcancel(g){this._map.fire(new my(g.type,this._map,g))}_firePreventable(g){if(this._map.fire(g),g.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bw{constructor(g){this._map=g}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(g){this._map.fire(new Vg(g.type,this._map,g))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Vg("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(g){this._delayContextMenu?this._contextMenuEvent=g:this._ignoreContextMenu||this._map.fire(new Vg(g.type,this._map,g)),this._map.listens("contextmenu")&&g.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class kv{constructor(g){this._map=g}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(g){return this.transform.pointLocation(s.Point.convert(g),this._map.terrain)}}class Bv{constructor(g,A){this._map=g,this._tr=new kv(g),this._el=g.getCanvasContainer(),this._container=g.getContainer(),this._clickTolerance=A.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(g,A){this.isEnabled()&&g.shiftKey&&g.button===0&&(y.disableDrag(),this._startPos=this._lastPos=A,this._active=!0)}mousemoveWindow(g,A){if(!this._active)return;const _e=A;if(this._lastPos.equals(_e)||!this._box&&_e.dist(this._startPos)<this._clickTolerance)return;const ct=this._startPos;this._lastPos=_e,this._box||(this._box=y.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",g));const pi=Math.min(ct.x,_e.x),In=Math.max(ct.x,_e.x),ds=Math.min(ct.y,_e.y),hs=Math.max(ct.y,_e.y);y.setTransform(this._box,`translate(${pi}px,${ds}px)`),this._box.style.width=In-pi+"px",this._box.style.height=hs-ds+"px"}mouseupWindow(g,A){if(!this._active||g.button!==0)return;const _e=this._startPos,ct=A;if(this.reset(),y.suppressClick(),_e.x!==ct.x||_e.y!==ct.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:g})),{cameraAnimation:pi=>pi.fitScreenCoordinates(_e,ct,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",g)}keydown(g){this._active&&g.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",g))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(y.remove(this._box),this._box=null),y.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(g,A){return this._map.fire(new s.Event(g,{originalEvent:A}))}}function l_(Ve,g){if(Ve.length!==g.length)throw new Error(`The number of touches and points are not equal - touches ${Ve.length}, points ${g.length}`);const A={};for(let _e=0;_e<Ve.length;_e++)A[Ve[_e].identifier]=g[_e];return A}class Tp{constructor(g){this.reset(),this.numTouches=g.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(g,A,_e){(this.centroid||_e.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=g.timeStamp),_e.length===this.numTouches&&(this.centroid=function(ct){const pi=new s.Point(0,0);for(const In of ct)pi._add(In);return pi.div(ct.length)}(A),this.touches=l_(_e,A)))}touchmove(g,A,_e){if(this.aborted||!this.centroid)return;const ct=l_(_e,A);for(const pi in this.touches){const In=ct[pi];(!In||In.dist(this.touches[pi])>30)&&(this.aborted=!0)}}touchend(g,A,_e){if((!this.centroid||g.timeStamp-this.startTime>500)&&(this.aborted=!0),_e.length===0){const ct=!this.aborted&&this.centroid;if(this.reset(),ct)return ct}}}class m0{constructor(g){this.singleTap=new Tp(g),this.numTaps=g.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(g,A,_e){this.singleTap.touchstart(g,A,_e)}touchmove(g,A,_e){this.singleTap.touchmove(g,A,_e)}touchend(g,A,_e){const ct=this.singleTap.touchend(g,A,_e);if(ct){const pi=g.timeStamp-this.lastTime<500,In=!this.lastTap||this.lastTap.dist(ct)<30;if(pi&&In||this.reset(),this.count++,this.lastTime=g.timeStamp,this.lastTap=ct,this.count===this.numTaps)return this.reset(),ct}}}class Gv{constructor(g){this._tr=new kv(g),this._zoomIn=new m0({numTouches:1,numTaps:2}),this._zoomOut=new m0({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(g,A,_e){this._zoomIn.touchstart(g,A,_e),this._zoomOut.touchstart(g,A,_e)}touchmove(g,A,_e){this._zoomIn.touchmove(g,A,_e),this._zoomOut.touchmove(g,A,_e)}touchend(g,A,_e){const ct=this._zoomIn.touchend(g,A,_e),pi=this._zoomOut.touchend(g,A,_e),In=this._tr;return ct?(this._active=!0,g.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:ds=>ds.easeTo({duration:300,zoom:In.zoom+1,around:In.unproject(ct)},{originalEvent:g})}):pi?(this._active=!0,g.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:ds=>ds.easeTo({duration:300,zoom:In.zoom-1,around:In.unproject(pi)},{originalEvent:g})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sm{constructor(g){this._enabled=!!g.enable,this._moveStateManager=g.moveStateManager,this._clickTolerance=g.clickTolerance||1,this._moveFunction=g.move,this._activateOnStart=!!g.activateOnStart,g.assignEvents(this),this.reset()}reset(g){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(g)}_move(...g){const A=this._moveFunction(...g);if(A.bearingDelta||A.pitchDelta||A.around||A.panDelta)return this._active=!0,A}dragStart(g,A){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(g)&&(this._moveStateManager.startMove(g),this._lastPoint=A.length?A[0]:A,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(g,A){if(!this.isEnabled())return;const _e=this._lastPoint;if(!_e)return;if(g.preventDefault(),!this._moveStateManager.isValidMoveEvent(g))return void this.reset(g);const ct=A.length?A[0]:A;return!this._moved&&ct.dist(_e)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=ct,this._move(_e,ct))}dragEnd(g){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(g)&&(this._moved&&y.suppressClick(),this.reset(g))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const _0={0:1,2:2};class sp{constructor(g){this._correctEvent=g.checkCorrectEvent}startMove(g){const A=y.mouseButton(g);this._eventButton=A}endMove(g){delete this._eventButton}isValidStartEvent(g){return this._correctEvent(g)}isValidMoveEvent(g){return!function(A,_e){const ct=_0[_e];return A.buttons===void 0||(A.buttons&ct)!==ct}(g,this._eventButton)}isValidEndEvent(g){return y.mouseButton(g)===this._eventButton}}class _y{constructor(){this._firstTouch=void 0}_isOneFingerTouch(g){return g.targetTouches.length===1}_isSameTouchEvent(g){return g.targetTouches[0].identifier===this._firstTouch}startMove(g){this._firstTouch=g.targetTouches[0].identifier}endMove(g){delete this._firstTouch}isValidStartEvent(g){return this._isOneFingerTouch(g)}isValidMoveEvent(g){return this._isOneFingerTouch(g)&&this._isSameTouchEvent(g)}isValidEndEvent(g){return this._isOneFingerTouch(g)&&this._isSameTouchEvent(g)}}const J0=Ve=>{Ve.mousedown=Ve.dragStart,Ve.mousemoveWindow=Ve.dragMove,Ve.mouseup=Ve.dragEnd,Ve.contextmenu=function(g){g.preventDefault()}},yy=({enable:Ve,clickTolerance:g,bearingDegreesPerPixelMoved:A=.8})=>{const _e=new sp({checkCorrectEvent:ct=>y.mouseButton(ct)===0&&ct.ctrlKey||y.mouseButton(ct)===2});return new Sm({clickTolerance:g,move:(ct,pi)=>({bearingDelta:(pi.x-ct.x)*A}),moveStateManager:_e,enable:Ve,assignEvents:J0})},ey=({enable:Ve,clickTolerance:g,pitchDegreesPerPixelMoved:A=-.5})=>{const _e=new sp({checkCorrectEvent:ct=>y.mouseButton(ct)===0&&ct.ctrlKey||y.mouseButton(ct)===2});return new Sm({clickTolerance:g,move:(ct,pi)=>({pitchDelta:(pi.y-ct.y)*A}),moveStateManager:_e,enable:Ve,assignEvents:J0})};class y0{constructor(g,A){this._minTouches=g.cooperativeGestures?2:1,this._clickTolerance=g.clickTolerance||1,this._map=A,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.Point(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(g,A,_e){return this._calculateTransform(g,A,_e)}touchmove(g,A,_e){if(this._map._cooperativeGestures&&(this._minTouches===2&&_e.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(g,!1,_e.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(_e.length<this._minTouches))return g.preventDefault(),this._calculateTransform(g,A,_e)}touchend(g,A,_e){this._calculateTransform(g,A,_e),this._active&&_e.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(g,A,_e){_e.length>0&&(this._active=!0);const ct=l_(_e,A),pi=new s.Point(0,0),In=new s.Point(0,0);let ds=0;for(const vs in ct){const fl=ct[vs],dl=this._touches[vs];dl&&(pi._add(fl),In._add(fl.sub(dl)),ds++,ct[vs]=fl)}if(this._touches=ct,ds<this._minTouches||!In.mag())return;const hs=In.div(ds);return this._sum._add(hs),this._sum.mag()<this._clickTolerance?void 0:{around:pi.div(ds),panDelta:hs}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ev{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(g){}_move(g,A,_e){return{}}touchstart(g,A,_e){this._firstTwoTouches||_e.length<2||(this._firstTwoTouches=[_e[0].identifier,_e[1].identifier],this._start([A[0],A[1]]))}touchmove(g,A,_e){if(!this._firstTwoTouches)return;g.preventDefault();const[ct,pi]=this._firstTwoTouches,In=og(_e,A,ct),ds=og(_e,A,pi);if(!In||!ds)return;const hs=this._aroundCenter?null:In.add(ds).div(2);return this._move([In,ds],hs,g)}touchend(g,A,_e){if(!this._firstTwoTouches)return;const[ct,pi]=this._firstTwoTouches,In=og(_e,A,ct),ds=og(_e,A,pi);In&&ds||(this._active&&y.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(g){this._enabled=!0,this._aroundCenter=!!g&&g.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function og(Ve,g,A){for(let _e=0;_e<Ve.length;_e++)if(Ve[_e].identifier===A)return g[_e]}function zv(Ve,g){return Math.log(Ve/g)/Math.LN2}class Q0 extends ev{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(g){this._startDistance=this._distance=g[0].dist(g[1])}_move(g,A){const _e=this._distance;if(this._distance=g[0].dist(g[1]),this._active||!(Math.abs(zv(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:zv(this._distance,_e),pinchAround:A}}}function tv(Ve,g){return 180*Ve.angleWith(g)/Math.PI}class vy extends ev{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(g){this._startVector=this._vector=g[0].sub(g[1]),this._minDiameter=g[0].dist(g[1])}_move(g,A){const _e=this._vector;if(this._vector=g[0].sub(g[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:tv(this._vector,_e),pinchAround:A}}_isBelowThreshold(g){this._minDiameter=Math.min(this._minDiameter,g.mag());const A=25/(Math.PI*this._minDiameter)*360,_e=tv(g,this._startVector);return Math.abs(_e)<A}}function Vv(Ve){return Math.abs(Ve.y)>Math.abs(Ve.x)}class Tm extends ev{constructor(g){super(),this._map=g}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(g,A,_e){super.touchstart(g,A,_e),this._currentTouchCount=_e.length}_start(g){this._lastPoints=g,Vv(g[0].sub(g[1]))&&(this._valid=!1)}_move(g,A,_e){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const ct=g[0].sub(this._lastPoints[0]),pi=g[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(ct,pi,_e.timeStamp),this._valid?(this._lastPoints=g,this._active=!0,{pitchDelta:(ct.y+pi.y)/2*-.5}):void 0}gestureBeginsVertically(g,A,_e){if(this._valid!==void 0)return this._valid;const ct=g.mag()>=2,pi=A.mag()>=2;if(!ct&&!pi)return;if(!ct||!pi)return this._firstMove===void 0&&(this._firstMove=_e),_e-this._firstMove<100&&void 0;const In=g.y>0==A.y>0;return Vv(g)&&Vv(A)&&In}}const km={panStep:100,bearingStep:15,pitchStep:10};class Sx{constructor(g){this._tr=new kv(g);const A=km;this._panStep=A.panStep,this._bearingStep=A.bearingStep,this._pitchStep=A.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(g){if(g.altKey||g.ctrlKey||g.metaKey)return;let A=0,_e=0,ct=0,pi=0,In=0;switch(g.keyCode){case 61:case 107:case 171:case 187:A=1;break;case 189:case 109:case 173:A=-1;break;case 37:g.shiftKey?_e=-1:(g.preventDefault(),pi=-1);break;case 39:g.shiftKey?_e=1:(g.preventDefault(),pi=1);break;case 38:g.shiftKey?ct=1:(g.preventDefault(),In=-1);break;case 40:g.shiftKey?ct=-1:(g.preventDefault(),In=1);break;default:return}return this._rotationDisabled&&(_e=0,ct=0),{cameraAnimation:ds=>{const hs=this._tr;ds.easeTo({duration:300,easeId:"keyboardHandler",easing:Uv,zoom:A?Math.round(hs.zoom)+A*(g.shiftKey?2:1):hs.zoom,bearing:hs.bearing+_e*this._bearingStep,pitch:hs.pitch+ct*this._pitchStep,offset:[-pi*this._panStep,-In*this._panStep],center:hs.center},{originalEvent:g})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Uv(Ve){return Ve*(2-Ve)}const ty=4.000244140625;class xy{constructor(g,A){this._map=g,this._tr=new kv(g),this._el=g.getCanvasContainer(),this._handler=A,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.bindAll(["_onTimeout"],this)}setZoomRate(g){this._defaultZoomRate=g}setWheelZoomRate(g){this._wheelZoomRate=g}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(g){this.isEnabled()||(this._enabled=!0,this._aroundCenter=g&&g.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(g){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!g[this._map._metaKey])return;g.preventDefault()}let A=g.deltaMode===WheelEvent.DOM_DELTA_LINE?40*g.deltaY:g.deltaY;const _e=s.exported.now(),ct=_e-(this._lastWheelEventTime||0);this._lastWheelEventTime=_e,A!==0&&A%ty==0?this._type="wheel":A!==0&&Math.abs(A)<4?this._type="trackpad":ct>400?(this._type=null,this._lastValue=A,this._timeout=setTimeout(this._onTimeout,40,g)):this._type||(this._type=Math.abs(ct*A)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,A+=this._lastValue)),g.shiftKey&&A&&(A/=4),this._type&&(this._lastWheelEvent=g,this._delta-=A,this._active||this._start(g)),g.preventDefault()}_onTimeout(g){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(g)}_start(g){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const A=y.mousePos(this._el,g),_e=this._tr;this._around=s.LngLat.convert(this._aroundCenter?_e.center:_e.unproject(A)),this._aroundPoint=_e.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const g=this._tr.transform;if(this._delta!==0){const ds=this._type==="wheel"&&Math.abs(this._delta)>ty?this._wheelZoomRate:this._defaultZoomRate;let hs=2/(1+Math.exp(-Math.abs(this._delta*ds)));this._delta<0&&hs!==0&&(hs=1/hs);const vs=typeof this._targetZoom=="number"?g.zoomScale(this._targetZoom):g.scale;this._targetZoom=Math.min(g.maxZoom,Math.max(g.minZoom,g.scaleZoom(vs*hs))),this._type==="wheel"&&(this._startZoom=g.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const A=typeof this._targetZoom=="number"?this._targetZoom:g.zoom,_e=this._startZoom,ct=this._easing;let pi,In=!1;if(this._type==="wheel"&&_e&&ct){const ds=Math.min((s.exported.now()-this._lastWheelEventTime)/200,1),hs=ct(ds);pi=s.interpolate.number(_e,A,hs),ds<1?this._frameId||(this._frameId=!0):In=!0}else pi=A,In=!0;return this._active=!0,In&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!In,zoomDelta:pi-g.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(g){let A=s.ease;if(this._prevEase){const _e=this._prevEase,ct=(s.exported.now()-_e.start)/_e.duration,pi=_e.easing(ct+.01)-_e.easing(ct),In=.27/Math.sqrt(pi*pi+1e-4)*.01,ds=Math.sqrt(.0729-In*In);A=s.bezier(In,ds,.25,1)}return this._prevEase={start:s.exported.now(),duration:g,easing:A},A}reset(){this._active=!1}}class ex{constructor(g,A){this._clickZoom=g,this._tapZoom=A}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Bm{constructor(g){this._tr=new kv(g),this.reset()}reset(){this._active=!1}dblclick(g,A){return g.preventDefault(),{cameraAnimation:_e=>{_e.easeTo({duration:300,zoom:this._tr.zoom+(g.shiftKey?-1:1),around:this._tr.unproject(A)},{originalEvent:g})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Eg{constructor(){this._tap=new m0({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(g,A,_e){this._swipePoint||(this._tapTime&&g.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_e.length>0&&(this._swipePoint=A[0],this._swipeTouch=_e[0].identifier):this._tap.touchstart(g,A,_e))}touchmove(g,A,_e){if(this._tapTime){if(this._swipePoint){if(_e[0].identifier!==this._swipeTouch)return;const ct=A[0],pi=ct.y-this._swipePoint.y;return this._swipePoint=ct,g.preventDefault(),this._active=!0,{zoomDelta:pi/128}}}else this._tap.touchmove(g,A,_e)}touchend(g,A,_e){this._tapTime?this._swipePoint&&_e.length===0&&this.reset():this._tap.touchend(g,A,_e)&&(this._tapTime=g.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class iv{constructor(g,A,_e){this._el=g,this._mousePan=A,this._touchPan=_e}enable(g){this._inertiaOptions=g||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class $v{constructor(g,A,_e){this._pitchWithRotate=g.pitchWithRotate,this._mouseRotate=A,this._mousePitch=_e}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class fp{constructor(g,A,_e,ct){this._el=g,this._touchZoom=A,this._touchRotate=_e,this._tapDragZoom=ct,this._rotationDisabled=!1,this._enabled=!0}enable(g){this._touchZoom.enable(g),this._rotationDisabled||this._touchRotate.enable(g),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const $m=Ve=>Ve.zoom||Ve.drag||Ve.pitch||Ve.rotate;class Tx extends s.Event{}function rv(Ve){return Ve.panDelta&&Ve.panDelta.mag()||Ve.zoomDelta||Ve.bearingDelta||Ve.pitchDelta}class Xm{constructor(g,A){this._map=g,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new R_(g),this._bearingSnap=A.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(A),s.bindAll(["handleEvent","handleWindowEvent"],this);const _e=this._el;this._listeners=[[_e,"touchstart",{passive:!0}],[_e,"touchmove",{passive:!1}],[_e,"touchend",void 0],[_e,"touchcancel",void 0],[_e,"mousedown",void 0],[_e,"mousemove",void 0],[_e,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_e,"mouseover",void 0],[_e,"mouseout",void 0],[_e,"dblclick",void 0],[_e,"click",void 0],[_e,"keydown",{capture:!1}],[_e,"keyup",void 0],[_e,"wheel",{passive:!1}],[_e,"contextmenu",void 0],[window,"blur",void 0]];for(const[ct,pi,In]of this._listeners)y.addEventListener(ct,pi,ct===document?this.handleWindowEvent:this.handleEvent,In)}destroy(){for(const[g,A,_e]of this._listeners)y.removeEventListener(g,A,g===document?this.handleWindowEvent:this.handleEvent,_e)}_addDefaultHandlers(g){const A=this._map,_e=A.getCanvasContainer();this._add("mapEvent",new ww(A,g));const ct=A.boxZoom=new Bv(A,g);this._add("boxZoom",ct);const pi=new Gv(A),In=new Bm(A);A.doubleClickZoom=new ex(In,pi),this._add("tapZoom",pi),this._add("clickZoom",In);const ds=new Eg;this._add("tapDragZoom",ds);const hs=A.touchPitch=new Tm(A);this._add("touchPitch",hs);const vs=yy(g),fl=ey(g);A.dragRotate=new $v(g,vs,fl),this._add("mouseRotate",vs,["mousePitch"]),this._add("mousePitch",fl,["mouseRotate"]);const dl=(({enable:Kh,clickTolerance:ad})=>{const Lh=new sp({checkCorrectEvent:od=>y.mouseButton(od)===0&&!od.ctrlKey});return new Sm({clickTolerance:ad,move:(od,md)=>({around:md,panDelta:md.sub(od)}),activateOnStart:!0,moveStateManager:Lh,enable:Kh,assignEvents:J0})})(g),dh=new y0(g,A);A.dragPan=new iv(_e,dl,dh),this._add("mousePan",dl),this._add("touchPan",dh,["touchZoom","touchRotate"]);const Ah=new vy,hh=new Q0;A.touchZoomRotate=new fp(_e,hh,Ah,ds),this._add("touchRotate",Ah,["touchPan","touchZoom"]),this._add("touchZoom",hh,["touchPan","touchRotate"]);const Rh=A.scrollZoom=new xy(A,this);this._add("scrollZoom",Rh,["mousePan"]);const zh=A.keyboard=new Sx(A);this._add("keyboard",zh),this._add("blockableMapEvent",new bw(A));for(const Kh of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])g.interactive&&g[Kh]&&A[Kh].enable(g[Kh])}_add(g,A,_e){this._handlers.push({handlerName:g,handler:A,allowed:_e}),this._handlersById[g]=A}stop(g){if(!this._updatingCamera){for(const{handler:A}of this._handlers)A.reset();this._inertia.clear(),this._fireEvents({},{},g),this._changes=[]}}isActive(){for(const{handler:g}of this._handlers)if(g.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!$m(this._eventsInProgress)||this.isZooming()}_blockedByActive(g,A,_e){for(const ct in g)if(ct!==_e&&(!A||A.indexOf(ct)<0))return!0;return!1}handleWindowEvent(g){this.handleEvent(g,`${g.type}Window`)}_getMapTouches(g){const A=[];for(const _e of g)this._el.contains(_e.target)&&A.push(_e);return A}handleEvent(g,A){if(g.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const _e=g.type==="renderFrame"?void 0:g,ct={needsRenderFrame:!1},pi={},In={},ds=g.touches,hs=ds?this._getMapTouches(ds):void 0,vs=hs?y.touchPos(this._el,hs):y.mousePos(this._el,g);for(const{handlerName:dh,handler:Ah,allowed:hh}of this._handlers){if(!Ah.isEnabled())continue;let Rh;this._blockedByActive(In,hh,dh)?Ah.reset():Ah[A||g.type]&&(Rh=Ah[A||g.type](g,vs,hs),this.mergeHandlerResult(ct,pi,Rh,dh,_e),Rh&&Rh.needsRenderFrame&&this._triggerRenderFrame()),(Rh||Ah.isActive())&&(In[dh]=Ah)}const fl={};for(const dh in this._previousActiveHandlers)In[dh]||(fl[dh]=_e);this._previousActiveHandlers=In,(Object.keys(fl).length||rv(ct))&&(this._changes.push([ct,pi,fl]),this._triggerRenderFrame()),(Object.keys(In).length||rv(ct))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:dl}=ct;dl&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],dl(this._map))}mergeHandlerResult(g,A,_e,ct,pi){if(!_e)return;s.extend(g,_e);const In={handlerName:ct,originalEvent:_e.originalEvent||pi};_e.zoomDelta!==void 0&&(A.zoom=In),_e.panDelta!==void 0&&(A.drag=In),_e.pitchDelta!==void 0&&(A.pitch=In),_e.bearingDelta!==void 0&&(A.rotate=In)}_applyChanges(){const g={},A={},_e={};for(const[ct,pi,In]of this._changes)ct.panDelta&&(g.panDelta=(g.panDelta||new s.Point(0,0))._add(ct.panDelta)),ct.zoomDelta&&(g.zoomDelta=(g.zoomDelta||0)+ct.zoomDelta),ct.bearingDelta&&(g.bearingDelta=(g.bearingDelta||0)+ct.bearingDelta),ct.pitchDelta&&(g.pitchDelta=(g.pitchDelta||0)+ct.pitchDelta),ct.around!==void 0&&(g.around=ct.around),ct.pinchAround!==void 0&&(g.pinchAround=ct.pinchAround),ct.noInertia&&(g.noInertia=ct.noInertia),s.extend(A,pi),s.extend(_e,In);this._updateMapTransform(g,A,_e),this._changes=[]}_updateMapTransform(g,A,_e){const ct=this._map,pi=ct._getTransformForUpdate(),In=ct.terrain;if(!(rv(g)||In&&this._terrainMovement))return this._fireEvents(A,_e,!0);let{panDelta:ds,zoomDelta:hs,bearingDelta:vs,pitchDelta:fl,around:dl,pinchAround:dh}=g;dh!==void 0&&(dl=dh),ct._stop(!0),dl=dl||ct.transform.centerPoint;const Ah=pi.pointLocation(ds?dl.sub(ds):dl);vs&&(pi.bearing+=vs),fl&&(pi.pitch+=fl),hs&&(pi.zoom+=hs),In?this._terrainMovement||!A.drag&&!A.zoom?A.drag&&this._terrainMovement?pi.center=pi.pointLocation(pi.centerPoint.sub(ds)):pi.setLocationAtPoint(Ah,dl):(this._terrainMovement=!0,pi.freezeElevation=!0,pi.setLocationAtPoint(Ah,dl),this._map.once("moveend",()=>{pi.freezeElevation=!1,this._terrainMovement=!1,pi.recalculateZoom(ct.terrain)})):pi.setLocationAtPoint(Ah,dl),ct._applyUpdatedTransform(pi),this._map._update(),g.noInertia||this._inertia.record(g),this._fireEvents(A,_e,!0)}_fireEvents(g,A,_e){const ct=$m(this._eventsInProgress),pi=$m(g),In={};for(const fl in g){const{originalEvent:dl}=g[fl];this._eventsInProgress[fl]||(In[`${fl}start`]=dl),this._eventsInProgress[fl]=g[fl]}!ct&&pi&&this._fireEvent("movestart",pi.originalEvent);for(const fl in In)this._fireEvent(fl,In[fl]);pi&&this._fireEvent("move",pi.originalEvent);for(const fl in g){const{originalEvent:dl}=g[fl];this._fireEvent(fl,dl)}const ds={};let hs;for(const fl in this._eventsInProgress){const{handlerName:dl,originalEvent:dh}=this._eventsInProgress[fl];this._handlersById[dl].isActive()||(delete this._eventsInProgress[fl],hs=A[dl]||dh,ds[`${fl}end`]=hs)}for(const fl in ds)this._fireEvent(fl,ds[fl]);const vs=$m(this._eventsInProgress);if(_e&&(ct||pi)&&!vs){this._updatingCamera=!0;const fl=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),dl=dh=>dh!==0&&-this._bearingSnap<dh&&dh<this._bearingSnap;fl?(dl(fl.bearing||this._map.getBearing())&&(fl.bearing=0),fl.freezeElevation=!0,this._map.easeTo(fl,{originalEvent:hs})):(this._map.fire(new s.Event("moveend",{originalEvent:hs})),dl(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(g,A){this._map.fire(new s.Event(g,A?{originalEvent:A}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(g=>{delete this._frameId,this.handleEvent(new Tx("renderFrame",{timeStamp:g})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const tm={extend:(Ve,...g)=>s.extend(Ve,...g),run(Ve){Ve()},logToElement(Ve,g=!1,A="log"){const _e=window.document.getElementById(A);_e&&(g&&(_e.innerHTML=""),_e.innerHTML+=`<br>${Ve}`)}};class Np extends s.Evented{constructor(g,A){super(),this._moving=!1,this._zooming=!1,this.transform=g,this._bearingSnap=A.bearingSnap,s.bindAll(["_renderFrameCallback"],this),this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(g,A){return this.jumpTo({center:g},A)}panBy(g,A,_e){return g=s.Point.convert(g).mult(-1),this.panTo(this.transform.center,s.extend({offset:g},A),_e)}panTo(g,A,_e){return this.easeTo(s.extend({center:g},A),_e)}getZoom(){return this.transform.zoom}setZoom(g,A){return this.jumpTo({zoom:g},A),this}zoomTo(g,A,_e){return this.easeTo(s.extend({zoom:g},A),_e)}zoomIn(g,A){return this.zoomTo(this.getZoom()+1,g,A),this}zoomOut(g,A){return this.zoomTo(this.getZoom()-1,g,A),this}getBearing(){return this.transform.bearing}setBearing(g,A){return this.jumpTo({bearing:g},A),this}getPadding(){return this.transform.padding}setPadding(g,A){return this.jumpTo({padding:g},A),this}rotateTo(g,A,_e){return this.easeTo(s.extend({bearing:g},A),_e)}resetNorth(g,A){return this.rotateTo(0,s.extend({duration:1e3},g),A),this}resetNorthPitch(g,A){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},g),A),this}snapToNorth(g,A){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(g,A):this}getPitch(){return this.transform.pitch}setPitch(g,A){return this.jumpTo({pitch:g},A),this}cameraForBounds(g,A){g=Rd.convert(g);const _e=A&&A.bearing||0;return this._cameraForBoxAndBearing(g.getNorthWest(),g.getSouthEast(),_e,A)}_cameraForBoxAndBearing(g,A,_e,ct){const pi={top:0,bottom:0,right:0,left:0};if(typeof(ct=s.extend({padding:pi,offset:[0,0],maxZoom:this.transform.maxZoom},ct)).padding=="number"){const md=ct.padding;ct.padding={top:md,bottom:md,right:md,left:md}}ct.padding=s.extend(pi,ct.padding);const In=this.transform,ds=In.padding,hs=In.project(s.LngLat.convert(g)),vs=In.project(s.LngLat.convert(A)),fl=hs.rotate(-_e*Math.PI/180),dl=vs.rotate(-_e*Math.PI/180),dh=new s.Point(Math.max(fl.x,dl.x),Math.max(fl.y,dl.y)),Ah=new s.Point(Math.min(fl.x,dl.x),Math.min(fl.y,dl.y)),hh=dh.sub(Ah),Rh=(In.width-(ds.left+ds.right+ct.padding.left+ct.padding.right))/hh.x,zh=(In.height-(ds.top+ds.bottom+ct.padding.top+ct.padding.bottom))/hh.y;if(zh<0||Rh<0)return void s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Kh=Math.min(In.scaleZoom(In.scale*Math.min(Rh,zh)),ct.maxZoom),ad=s.Point.convert(ct.offset),Lh=new s.Point((ct.padding.left-ct.padding.right)/2,(ct.padding.top-ct.padding.bottom)/2).rotate(_e*Math.PI/180),od=ad.add(Lh).mult(In.scale/In.zoomScale(Kh));return{center:In.unproject(hs.add(vs).div(2).sub(od)),zoom:Kh,bearing:_e}}fitBounds(g,A,_e){return this._fitInternal(this.cameraForBounds(g,A),A,_e)}fitScreenCoordinates(g,A,_e,ct,pi){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.Point.convert(g)),this.transform.pointLocation(s.Point.convert(A)),_e,ct),ct,pi)}_fitInternal(g,A,_e){return g?(delete(A=s.extend(g,A)).padding,A.linear?this.easeTo(A,_e):this.flyTo(A,_e)):this}jumpTo(g,A){this.stop();const _e=this._getTransformForUpdate();let ct=!1,pi=!1,In=!1;return"zoom"in g&&_e.zoom!==+g.zoom&&(ct=!0,_e.zoom=+g.zoom),g.center!==void 0&&(_e.center=s.LngLat.convert(g.center)),"bearing"in g&&_e.bearing!==+g.bearing&&(pi=!0,_e.bearing=+g.bearing),"pitch"in g&&_e.pitch!==+g.pitch&&(In=!0,_e.pitch=+g.pitch),g.padding==null||_e.isPaddingEqual(g.padding)||(_e.padding=g.padding),this._applyUpdatedTransform(_e),this.fire(new s.Event("movestart",A)).fire(new s.Event("move",A)),ct&&this.fire(new s.Event("zoomstart",A)).fire(new s.Event("zoom",A)).fire(new s.Event("zoomend",A)),pi&&this.fire(new s.Event("rotatestart",A)).fire(new s.Event("rotate",A)).fire(new s.Event("rotateend",A)),In&&this.fire(new s.Event("pitchstart",A)).fire(new s.Event("pitch",A)).fire(new s.Event("pitchend",A)),this.fire(new s.Event("moveend",A))}calculateCameraOptionsFromTo(g,A,_e,ct=0){const pi=s.MercatorCoordinate.fromLngLat(g,A),In=s.MercatorCoordinate.fromLngLat(_e,ct),ds=In.x-pi.x,hs=In.y-pi.y,vs=In.z-pi.z,fl=Math.hypot(ds,hs,vs);if(fl===0)throw new Error("Can't calculate camera options with same From and To");const dl=Math.hypot(ds,hs),dh=this.transform.scaleZoom(this.transform.cameraToCenterDistance/fl/this.transform.tileSize),Ah=180*Math.atan2(ds,-hs)/Math.PI;let hh=180*Math.acos(dl/fl)/Math.PI;return hh=vs<0?90-hh:90+hh,{center:In.toLngLat(),zoom:dh,pitch:hh,bearing:Ah}}easeTo(g,A){this._stop(!1,g.easeId),((g=s.extend({offset:[0,0],duration:500,easing:s.ease},g)).animate===!1||!g.essential&&s.exported.prefersReducedMotion)&&(g.duration=0);const _e=this._getTransformForUpdate(),ct=this.getZoom(),pi=this.getBearing(),In=this.getPitch(),ds=this.getPadding(),hs="zoom"in g?+g.zoom:ct,vs="bearing"in g?this._normalizeBearing(g.bearing,pi):pi,fl="pitch"in g?+g.pitch:In,dl="padding"in g?g.padding:_e.padding,dh=s.Point.convert(g.offset);let Ah=_e.centerPoint.add(dh);const hh=_e.pointLocation(Ah),Rh=s.LngLat.convert(g.center||hh);this._normalizeCenter(Rh);const zh=_e.project(hh),Kh=_e.project(Rh).sub(zh),ad=_e.zoomScale(hs-ct);let Lh,od;g.around&&(Lh=s.LngLat.convert(g.around),od=_e.locationPoint(Lh));const md={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||hs!==ct,this._rotating=this._rotating||pi!==vs,this._pitching=this._pitching||fl!==In,this._padding=!_e.isPaddingEqual(dl),this._easeId=g.easeId,this._prepareEase(A,g.noMoveStart,md),this.terrain&&this._prepareElevation(Rh),this._ease(Nd=>{if(this._zooming&&(_e.zoom=s.interpolate.number(ct,hs,Nd)),this._rotating&&(_e.bearing=s.interpolate.number(pi,vs,Nd)),this._pitching&&(_e.pitch=s.interpolate.number(In,fl,Nd)),this._padding&&(_e.interpolatePadding(ds,dl,Nd),Ah=_e.centerPoint.add(dh)),this.terrain&&!g.freezeElevation&&this._updateElevation(Nd),Lh)_e.setLocationAtPoint(Lh,od);else{const Hd=_e.zoomScale(_e.zoom-ct),tp=hs>ct?Math.min(2,ad):Math.max(.5,ad),Vd=Math.pow(tp,1-Nd),gp=_e.unproject(zh.add(Kh.mult(Nd*Vd)).mult(Hd));_e.setLocationAtPoint(_e.renderWorldCopies?gp.wrap():gp,Ah)}this._applyUpdatedTransform(_e),this._fireMoveEvents(A)},Nd=>{this.terrain&&this._finalizeElevation(),this._afterEase(A,Nd)},g),this}_prepareEase(g,A,_e={}){this._moving=!0,A||_e.moving||this.fire(new s.Event("movestart",g)),this._zooming&&!_e.zooming&&this.fire(new s.Event("zoomstart",g)),this._rotating&&!_e.rotating&&this.fire(new s.Event("rotatestart",g)),this._pitching&&!_e.pitching&&this.fire(new s.Event("pitchstart",g))}_prepareElevation(g){this._elevationCenter=g,this._elevationStart=this.transform.elevation,this._elevationTarget=this.transform.getElevation(g,this.terrain),this.transform.freezeElevation=!0}_updateElevation(g){const A=this.transform.getElevation(this._elevationCenter,this.terrain);if(g<1&&A!==this._elevationTarget){const _e=this._elevationTarget-this._elevationStart;this._elevationStart+=g*(_e-(A-(_e*g+this._elevationStart))/(1-g)),this._elevationTarget=A}this.transform.elevation=s.interpolate.number(this._elevationStart,this._elevationTarget,g)}_finalizeElevation(){this.transform.freezeElevation=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(g){if(!this.transformCameraUpdate)return;const A=g.clone(),{center:_e,zoom:ct,pitch:pi,bearing:In,elevation:ds}=this.transformCameraUpdate(A);_e&&(A.center=_e),ct!==void 0&&(A.zoom=ct),pi!==void 0&&(A.pitch=pi),In!==void 0&&(A.bearing=In),ds!==void 0&&(A.elevation=ds),this.transform.apply(A)}_fireMoveEvents(g){this.fire(new s.Event("move",g)),this._zooming&&this.fire(new s.Event("zoom",g)),this._rotating&&this.fire(new s.Event("rotate",g)),this._pitching&&this.fire(new s.Event("pitch",g))}_afterEase(g,A){if(this._easeId&&A&&this._easeId===A)return;delete this._easeId;const _e=this._zooming,ct=this._rotating,pi=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_e&&this.fire(new s.Event("zoomend",g)),ct&&this.fire(new s.Event("rotateend",g)),pi&&this.fire(new s.Event("pitchend",g)),this.fire(new s.Event("moveend",g))}flyTo(g,A){if(!g.essential&&s.exported.prefersReducedMotion){const ze=s.pick(g,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ze,A)}this.stop(),g=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},g);const _e=this._getTransformForUpdate(),ct=this.getZoom(),pi=this.getBearing(),In=this.getPitch(),ds=this.getPadding(),hs="zoom"in g?s.clamp(+g.zoom,_e.minZoom,_e.maxZoom):ct,vs="bearing"in g?this._normalizeBearing(g.bearing,pi):pi,fl="pitch"in g?+g.pitch:In,dl="padding"in g?g.padding:_e.padding,dh=_e.zoomScale(hs-ct),Ah=s.Point.convert(g.offset);let hh=_e.centerPoint.add(Ah);const Rh=_e.pointLocation(hh),zh=s.LngLat.convert(g.center||Rh);this._normalizeCenter(zh);const Kh=_e.project(Rh),ad=_e.project(zh).sub(Kh);let Lh=g.curve;const od=Math.max(_e.width,_e.height),md=od/dh,Nd=ad.mag();if("minZoom"in g){const ze=s.clamp(Math.min(g.minZoom,ct,hs),_e.minZoom,_e.maxZoom),kt=od/_e.zoomScale(ze-ct);Lh=Math.sqrt(kt/Nd*2)}const Hd=Lh*Lh;function tp(ze){const kt=(md*md-od*od+(ze?-1:1)*Hd*Hd*Nd*Nd)/(2*(ze?md:od)*Hd*Nd);return Math.log(Math.sqrt(kt*kt+1)-kt)}function Vd(ze){return(Math.exp(ze)-Math.exp(-ze))/2}function gp(ze){return(Math.exp(ze)+Math.exp(-ze))/2}const L=tp(0);let p=function(ze){return gp(L)/gp(L+Lh*ze)},S=function(ze){return od*((gp(L)*(Vd(kt=L+Lh*ze)/gp(kt))-Vd(L))/Hd)/Nd;var kt},X=(tp(1)-L)/Lh;if(Math.abs(Nd)<1e-6||!isFinite(X)){if(Math.abs(od-md)<1e-6)return this.easeTo(g,A);const ze=md<od?-1:1;X=Math.abs(Math.log(md/od))/Lh,S=function(){return 0},p=function(kt){return Math.exp(ze*Lh*kt)}}return g.duration="duration"in g?+g.duration:1e3*X/("screenSpeed"in g?+g.screenSpeed/Lh:+g.speed),g.maxDuration&&g.duration>g.maxDuration&&(g.duration=0),this._zooming=!0,this._rotating=pi!==vs,this._pitching=fl!==In,this._padding=!_e.isPaddingEqual(dl),this._prepareEase(A,!1),this.terrain&&this._prepareElevation(zh),this._ease(ze=>{const kt=ze*X,vi=1/p(kt);_e.zoom=ze===1?hs:ct+_e.scaleZoom(vi),this._rotating&&(_e.bearing=s.interpolate.number(pi,vs,ze)),this._pitching&&(_e.pitch=s.interpolate.number(In,fl,ze)),this._padding&&(_e.interpolatePadding(ds,dl,ze),hh=_e.centerPoint.add(Ah)),this.terrain&&!g.freezeElevation&&this._updateElevation(ze);const or=ze===1?zh:_e.unproject(Kh.add(ad.mult(S(kt))).mult(vi));_e.setLocationAtPoint(_e.renderWorldCopies?or.wrap():or,hh),this._applyUpdatedTransform(_e),this._fireMoveEvents(A)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(A)},g),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(g,A){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const _e=this._onEaseEnd;delete this._onEaseEnd,_e.call(this,A)}if(!g){const _e=this.handlers;_e&&_e.stop(!1)}return this}_ease(g,A,_e){_e.animate===!1||_e.duration===0?(g(1),A()):(this._easeStart=s.exported.now(),this._easeOptions=_e,this._onEaseFrame=g,this._onEaseEnd=A,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const g=Math.min((s.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(g)),g<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(g,A){g=s.wrap(g,-180,180);const _e=Math.abs(g-A);return Math.abs(g-360-A)<_e&&(g-=360),Math.abs(g+360-A)<_e&&(g+=360),g}_normalizeCenter(g){const A=this.transform;if(!A.renderWorldCopies||A.lngRange)return;const _e=g.lng-A.center.lng;g.lng+=_e>180?-360:_e<-180?360:0}queryTerrainElevation(g){return this.terrain?this.transform.getElevation(s.LngLat.convert(g),this.terrain)-this.transform.elevation:null}}class Kp{constructor(g={}){this.options=g,s.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(g){return this._map=g,this._compact=this.options&&this.options.compact,this._container=y.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=y.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=y.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){y.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(g,A){const _e=this._map._getUIString(`AttributionControl.${A}`);g.title=_e,g.setAttribute("aria-label",_e)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))}_updateData(g){!g||g.sourceDataType!=="metadata"&&g.sourceDataType!=="visibility"&&g.dataType!=="style"&&g.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let g=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?g=g.concat(this.options.customAttribution.map(ct=>typeof ct!="string"?"":ct)):typeof this.options.customAttribution=="string"&&g.push(this.options.customAttribution)),this._map.style.stylesheet){const ct=this._map.style.stylesheet;this.styleOwner=ct.owner,this.styleId=ct.id}const A=this._map.style.sourceCaches;for(const ct in A){const pi=A[ct];if(pi.used||pi.usedForTerrain){const In=pi.getSource();In.attribution&&g.indexOf(In.attribution)<0&&g.push(In.attribution)}}g=g.filter(ct=>String(ct).trim()),g.sort((ct,pi)=>ct.length-pi.length),g=g.filter((ct,pi)=>{for(let In=pi+1;In<g.length;In++)if(g[In].indexOf(ct)>=0)return!1;return!0});const _e=g.join(" | ");_e!==this._attribHTML&&(this._attribHTML=_e,g.length?(this._innerContainer.innerHTML=_e,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")}}class nv{constructor(g={}){this.options=g,s.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(g){this._map=g,this._compact=this.options&&this.options.compact,this._container=y.create("div","maplibregl-ctrl");const A=y.create("a","maplibregl-ctrl-logo");return A.target="_blank",A.rel="noopener nofollow",A.href="https://maplibre.org/",A.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),A.setAttribute("rel","noopener nofollow"),this._container.appendChild(A),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){y.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const g=this._container.children;if(g.length){const A=g[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&A.classList.add("maplibregl-compact"):A.classList.remove("maplibregl-compact")}}}class Hv{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(g){const A=++this._id;return this._queue.push({callback:g,id:A,cancelled:!1}),A}remove(g){const A=this._currentlyRunning,_e=A?this._queue.concat(A):this._queue;for(const ct of _e)if(ct.id===g)return void(ct.cancelled=!0)}run(g=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const A=this._currentlyRunning=this._queue;this._queue=[];for(const _e of A)if(!_e.cancelled&&(_e.callback(g),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const tx={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Am=s.createLayout([{name:"a_pos3d",type:"Int16",components:3}]);class ov extends s.Evented{constructor(g){super(),this.sourceCache=g,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,g.usedForTerrain=!0,g.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(g,A){this.sourceCache.update(g,A),this._renderableTilesKeys=[];const _e={};for(const ct of g.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:A}))_e[ct.key]=!0,this._renderableTilesKeys.push(ct.key),this._tiles[ct.key]||(ct.posMatrix=new Float64Array(16),s.ortho(ct.posMatrix,0,s.EXTENT,0,s.EXTENT,0,1),this._tiles[ct.key]=new fd(ct,this.tileSize));for(const ct in this._tiles)_e[ct]||delete this._tiles[ct]}freeRtt(g){for(const A in this._tiles){const _e=this._tiles[A];(!g||_e.tileID.equals(g)||_e.tileID.isChildOf(g)||g.isChildOf(_e.tileID))&&(_e.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(g=>this.getTileByID(g))}getTileByID(g){return this._tiles[g]}getTerrainCoords(g){const A={};for(const _e of this._renderableTilesKeys){const ct=this._tiles[_e].tileID;if(ct.canonical.equals(g.canonical)){const pi=g.clone();pi.posMatrix=new Float64Array(16),s.ortho(pi.posMatrix,0,s.EXTENT,0,s.EXTENT,0,1),A[_e]=pi}else if(ct.canonical.isChildOf(g.canonical)){const pi=g.clone();pi.posMatrix=new Float64Array(16);const In=ct.canonical.z-g.canonical.z,ds=ct.canonical.x-(ct.canonical.x>>In<<In),hs=ct.canonical.y-(ct.canonical.y>>In<<In),vs=s.EXTENT>>In;s.ortho(pi.posMatrix,0,vs,0,vs,0,1),s.translate(pi.posMatrix,pi.posMatrix,[-ds*vs,-hs*vs,0]),A[_e]=pi}else if(g.canonical.isChildOf(ct.canonical)){const pi=g.clone();pi.posMatrix=new Float64Array(16);const In=g.canonical.z-ct.canonical.z,ds=g.canonical.x-(g.canonical.x>>In<<In),hs=g.canonical.y-(g.canonical.y>>In<<In),vs=s.EXTENT>>In;s.ortho(pi.posMatrix,0,s.EXTENT,0,s.EXTENT,0,1),s.translate(pi.posMatrix,pi.posMatrix,[ds*vs,hs*vs,0]),s.scale(pi.posMatrix,pi.posMatrix,[1/2**In,1/2**In,0]),A[_e]=pi}}return A}getSourceTile(g,A){const _e=this.sourceCache._source;let ct=g.overscaledZ-this.deltaZoom;if(ct>_e.maxzoom&&(ct=_e.maxzoom),ct<_e.minzoom)return null;this._sourceTileCache[g.key]||(this._sourceTileCache[g.key]=g.scaledTo(ct).key);let pi=this.sourceCache.getTileByID(this._sourceTileCache[g.key]);if((!pi||!pi.dem)&&A)for(;ct>=_e.minzoom&&(!pi||!pi.dem);)pi=this.sourceCache.getTileByID(g.scaledTo(ct--).key);return pi}tilesAfterTime(g=Date.now()){return Object.values(this._tiles).filter(A=>A.timeAdded>=g)}}class x_{constructor(g,A,_e){this.painter=g,this.sourceCache=new ov(A),this.options=_e,this.exaggeration=typeof _e.exaggeration=="number"?_e.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(g,A,_e,ct=s.EXTENT){if(!(A>=0&&A<ct&&_e>=0&&_e<ct))return 0;let pi=0;const In=this.getTerrainData(g);if(In.tile&&In.tile.dem){const ds=function(hh,Rh,zh){var Kh=Rh[0],ad=Rh[1];return hh[0]=zh[0]*Kh+zh[4]*ad+zh[12],hh[1]=zh[1]*Kh+zh[5]*ad+zh[13],hh}([],[A/ct*s.EXTENT,_e/ct*s.EXTENT],In.u_terrain_matrix),hs=[ds[0]*In.tile.dem.dim,ds[1]*In.tile.dem.dim],vs=[Math.floor(hs[0]),Math.floor(hs[1])],fl=In.tile.dem.get(vs[0],vs[1]),dl=In.tile.dem.get(vs[0],vs[1]+1),dh=In.tile.dem.get(vs[0]+1,vs[1]),Ah=In.tile.dem.get(vs[0]+1,vs[1]+1);pi=s.interpolate.number(s.interpolate.number(fl,dl,hs[0]-vs[0]),s.interpolate.number(dh,Ah,hs[0]-vs[0]),hs[1]-vs[1])}return pi}getElevation(g,A,_e,ct=s.EXTENT){return this.getDEMElevation(g,A,_e,ct)*this.exaggeration}getTerrainData(g){if(!this._emptyDemTexture){const ct=this.painter.context,pi=new s.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new th(ct,pi,ct.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new th(ct,new s.RGBAImage({width:1,height:1}),ct.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(ct.gl.NEAREST,ct.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.identity([])}const A=this.sourceCache.getSourceTile(g,!0);if(A&&A.dem&&(!A.demTexture||A.needsTerrainPrepare)){const ct=this.painter.context;A.demTexture=this.painter.getTileTexture(A.dem.stride),A.demTexture?A.demTexture.update(A.dem.getPixels(),{premultiply:!1}):A.demTexture=new th(ct,A.dem.getPixels(),ct.gl.RGBA,{premultiply:!1}),A.demTexture.bind(ct.gl.NEAREST,ct.gl.CLAMP_TO_EDGE),A.needsTerrainPrepare=!1}const _e=A&&A+A.tileID.key+g.key;if(_e&&!this._demMatrixCache[_e]){const ct=this.sourceCache.sourceCache._source.maxzoom;let pi=g.canonical.z-A.tileID.canonical.z;g.overscaledZ>g.canonical.z&&(g.canonical.z>=ct?pi=g.canonical.z-ct:s.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const In=g.canonical.x-(g.canonical.x>>pi<<pi),ds=g.canonical.y-(g.canonical.y>>pi<<pi),hs=s.fromScaling(new Float64Array(16),[1/(s.EXTENT<<pi),1/(s.EXTENT<<pi),0]);s.translate(hs,hs,[In*s.EXTENT,ds*s.EXTENT,0]),this._demMatrixCache[g.key]={matrix:hs,coord:g}}return{u_depth:2,u_terrain:3,u_terrain_dim:A&&A.dem&&A.dem.dim||1,u_terrain_matrix:_e?this._demMatrixCache[g.key].matrix:this._emptyDemMatrix,u_terrain_unpack:A&&A.dem&&A.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(A&&A.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:A}}getFramebuffer(g){const A=this.painter,_e=A.width/devicePixelRatio,ct=A.height/devicePixelRatio;return!this._fbo||this._fbo.width===_e&&this._fbo.height===ct||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new th(A.context,{width:_e,height:ct,data:null},A.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(A.context.gl.NEAREST,A.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new th(A.context,{width:_e,height:ct,data:null},A.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(A.context.gl.NEAREST,A.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=A.context.createFramebuffer(_e,ct,!0,!1),this._fbo.depthAttachment.set(A.context.createRenderbuffer(A.context.gl.DEPTH_COMPONENT16,_e,ct))),this._fbo.colorAttachment.set(g==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const g=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const A=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let pi=0,In=0;pi<this._coordsTextureSize;pi++)for(let ds=0;ds<this._coordsTextureSize;ds++,In+=4)A[In+0]=255&ds,A[In+1]=255&pi,A[In+2]=ds>>8<<4|pi>>8,A[In+3]=0;const _e=new s.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(A.buffer)),ct=new th(g,_e,g.gl.RGBA,{premultiply:!1});return ct.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._coordsTexture=ct,ct}pointCoordinate(g){const A=new Uint8Array(4),_e=this.painter.context,ct=_e.gl;_e.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),ct.readPixels(g.x,this.painter.height/devicePixelRatio-g.y-1,1,1,ct.RGBA,ct.UNSIGNED_BYTE,A),_e.bindFramebuffer.set(null);const pi=A[0]+(A[2]>>4<<8),In=A[1]+((15&A[2])<<8),ds=this.coordsIndex[255-A[3]],hs=ds&&this.sourceCache.getTileByID(ds);if(!hs)return null;const vs=this._coordsTextureSize,fl=(1<<hs.tileID.canonical.z)*vs;return new s.MercatorCoordinate((hs.tileID.canonical.x*vs+pi)/fl,(hs.tileID.canonical.y*vs+In)/fl,this.getElevation(hs.tileID,pi,In,vs))}getTerrainMesh(){if(this._mesh)return this._mesh;const g=this.painter.context,A=new s.Pos3dArray,_e=new s.TriangleIndexArray,ct=this.meshSize,pi=s.EXTENT/ct,In=ct*ct;for(let dl=0;dl<=ct;dl++)for(let dh=0;dh<=ct;dh++)A.emplaceBack(dh*pi,dl*pi,0);for(let dl=0;dl<In;dl+=ct+1)for(let dh=0;dh<ct;dh++)_e.emplaceBack(dh+dl,ct+dh+dl+1,ct+dh+dl+2),_e.emplaceBack(dh+dl,ct+dh+dl+2,dh+dl+1);const ds=A.length,hs=ds+2*(ct+1);for(const dl of[0,1])for(let dh=0;dh<=ct;dh++)for(const Ah of[0,1])A.emplaceBack(dh*pi,dl*s.EXTENT,Ah);for(let dl=0;dl<2*ct;dl+=2)_e.emplaceBack(hs+dl,hs+dl+1,hs+dl+3),_e.emplaceBack(hs+dl,hs+dl+3,hs+dl+2),_e.emplaceBack(ds+dl,ds+dl+3,ds+dl+1),_e.emplaceBack(ds+dl,ds+dl+2,ds+dl+3);const vs=A.length,fl=vs+2*(ct+1);for(const dl of[0,1])for(let dh=0;dh<=ct;dh++)for(const Ah of[0,1])A.emplaceBack(dl*s.EXTENT,dh*pi,Ah);for(let dl=0;dl<2*ct;dl+=2)_e.emplaceBack(vs+dl,vs+dl+1,vs+dl+3),_e.emplaceBack(vs+dl,vs+dl+3,vs+dl+2),_e.emplaceBack(fl+dl,fl+dl+3,fl+dl+1),_e.emplaceBack(fl+dl,fl+dl+2,fl+dl+3);return this._mesh={indexBuffer:g.createIndexBuffer(_e),vertexBuffer:g.createVertexBuffer(A,Am.members),segments:s.SegmentVector.simpleSegment(0,0,A.length,_e.length)},this._mesh}getMeshFrameDelta(g){return 2*Math.PI*s.earthRadius/Math.pow(2,g)/5}getMinMaxElevation(g){const A=this.getTerrainData(g).tile,_e={minElevation:null,maxElevation:null};return A&&A.dem&&(_e.minElevation=A.dem.min*this.exaggeration,_e.maxElevation=A.dem.max*this.exaggeration),_e}}class Cw{constructor(g,A,_e){this._context=g,this._size=A,this._tileSize=_e,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const g of this._objects)g.texture.destroy(),g.fbo.destroy()}_createObject(g){const A=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),_e=new th(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return _e.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),A.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),A.colorAttachment.set(_e.texture),{id:g,fbo:A,texture:_e,stamp:-1,inUse:!1}}getObjectForId(g){return this._objects[g]}useObject(g){g.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(A=>g.id!==A),this._recentlyUsed.push(g.id)}stampObject(g){g.stamp=++this._stamp}getOrCreateFreeObject(){for(const A of this._recentlyUsed)if(!this._objects[A].inUse)return this._objects[A];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const g=this._createObject(this._objects.length);return this._objects.push(g),g}freeObject(g){g.inUse=!1}freeAllObjects(){for(const g of this._objects)this.freeObject(g)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(g=>!g.inUse)===!1}}const B_={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Mg{constructor(g,A){this.painter=g,this.terrain=A,this.pool=new Cw(g.context,30,A.sourceCache.tileSize*A.qualityFactor)}destruct(){this.pool.destruct()}getTexture(g){return this.pool.getObjectForId(g.rtt[this._stacks.length-1].id).texture}prepareForRender(g,A){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=g._order.filter(_e=>!g._layers[_e].isHidden(A)),this._coordsDescendingInv={};for(const _e in g.sourceCaches){this._coordsDescendingInv[_e]={};const ct=g.sourceCaches[_e].getVisibleCoordinates();for(const pi of ct){const In=this.terrain.sourceCache.getTerrainCoords(pi);for(const ds in In)this._coordsDescendingInv[_e][ds]||(this._coordsDescendingInv[_e][ds]=[]),this._coordsDescendingInv[_e][ds].push(In[ds])}}this._coordsDescendingInvStr={};for(const _e of g._order){const ct=g._layers[_e],pi=ct.source;if(B_[ct.type]&&!this._coordsDescendingInvStr[pi]){this._coordsDescendingInvStr[pi]={};for(const In in this._coordsDescendingInv[pi])this._coordsDescendingInvStr[pi][In]=this._coordsDescendingInv[pi][In].map(ds=>ds.key).sort().join()}}for(const _e of this._renderableTiles)for(const ct in this._coordsDescendingInvStr){const pi=this._coordsDescendingInvStr[ct][_e.tileID.key];pi&&pi!==_e.rttCoords[ct]&&(_e.rtt=[])}}renderLayer(g){if(g.isHidden(this.painter.transform.zoom))return!1;const A=g.type,_e=this.painter,ct=this._renderableLayerIds[this._renderableLayerIds.length-1]===g.id;if(B_[A]&&(this._prevType&&B_[this._prevType]||this._stacks.push([]),this._prevType=A,this._stacks[this._stacks.length-1].push(g.id),!ct))return!0;if(B_[this._prevType]||B_[A]&&ct){this._prevType=A;const pi=this._stacks.length-1,In=this._stacks[pi]||[];for(const ds of this._renderableTiles){if(this.pool.isFull()&&(Lv(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(ds),ds.rtt[pi]){const vs=this.pool.getObjectForId(ds.rtt[pi].id);if(vs.stamp===ds.rtt[pi].stamp){this.pool.useObject(vs);continue}}const hs=this.pool.getOrCreateFreeObject();this.pool.useObject(hs),this.pool.stampObject(hs),ds.rtt[pi]={id:hs.id,stamp:hs.stamp},_e.context.bindFramebuffer.set(hs.fbo.framebuffer),_e.context.clear({color:s.Color.transparent,stencil:0}),_e.currentStencilSource=void 0;for(let vs=0;vs<In.length;vs++){const fl=_e.style._layers[In[vs]],dl=fl.source?this._coordsDescendingInv[fl.source][ds.tileID.key]:[ds.tileID];_e.context.viewport.set([0,0,hs.fbo.width,hs.fbo.height]),_e._renderTileClippingMasks(fl,dl),_e.renderLayer(_e,_e.style.sourceCaches[fl.source],fl,dl),fl.source&&(ds.rttCoords[fl.source]=this._coordsDescendingInvStr[fl.source][ds.tileID.key])}}return Lv(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),B_[A]}return!1}}const Jg=m,ix={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.config.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0},wy=Ve=>{Ve.touchstart=Ve.dragStart,Ve.touchmoveWindow=Ve.dragMove,Ve.touchend=Ve.dragEnd},sv={showCompass:!0,showZoom:!0,visualizePitch:!1};class av{constructor(g,A,_e=!1){this._clickTolerance=10;const ct=g.dragRotate._mouseRotate.getClickTolerance(),pi=g.dragRotate._mousePitch.getClickTolerance();this.element=A,this.mouseRotate=yy({clickTolerance:ct,enable:!0}),this.touchRotate=(({enable:In,clickTolerance:ds,bearingDegreesPerPixelMoved:hs=.8})=>{const vs=new _y;return new Sm({clickTolerance:ds,move:(fl,dl)=>({bearingDelta:(dl.x-fl.x)*hs}),moveStateManager:vs,enable:In,assignEvents:wy})})({clickTolerance:ct,enable:!0}),this.map=g,_e&&(this.mousePitch=ey({clickTolerance:pi,enable:!0}),this.touchPitch=(({enable:In,clickTolerance:ds,pitchDegreesPerPixelMoved:hs=-.5})=>{const vs=new _y;return new Sm({clickTolerance:ds,move:(fl,dl)=>({pitchDelta:(dl.y-fl.y)*hs}),moveStateManager:vs,enable:In,assignEvents:wy})})({clickTolerance:pi,enable:!0})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),y.addEventListener(A,"mousedown",this.mousedown),y.addEventListener(A,"touchstart",this.touchstart,{passive:!1}),y.addEventListener(A,"touchcancel",this.reset)}startMouse(g,A){this.mouseRotate.dragStart(g,A),this.mousePitch&&this.mousePitch.dragStart(g,A),y.disableDrag()}startTouch(g,A){this.touchRotate.dragStart(g,A),this.touchPitch&&this.touchPitch.dragStart(g,A),y.disableDrag()}moveMouse(g,A){const _e=this.map,{bearingDelta:ct}=this.mouseRotate.dragMove(g,A)||{};if(ct&&_e.setBearing(_e.getBearing()+ct),this.mousePitch){const{pitchDelta:pi}=this.mousePitch.dragMove(g,A)||{};pi&&_e.setPitch(_e.getPitch()+pi)}}moveTouch(g,A){const _e=this.map,{bearingDelta:ct}=this.touchRotate.dragMove(g,A)||{};if(ct&&_e.setBearing(_e.getBearing()+ct),this.touchPitch){const{pitchDelta:pi}=this.touchPitch.dragMove(g,A)||{};pi&&_e.setPitch(_e.getPitch()+pi)}}off(){const g=this.element;y.removeEventListener(g,"mousedown",this.mousedown),y.removeEventListener(g,"touchstart",this.touchstart,{passive:!1}),y.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),y.removeEventListener(window,"touchend",this.touchend),y.removeEventListener(g,"touchcancel",this.reset),this.offTemp()}offTemp(){y.enableDrag(),y.removeEventListener(window,"mousemove",this.mousemove),y.removeEventListener(window,"mouseup",this.mouseup),y.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),y.removeEventListener(window,"touchend",this.touchend)}mousedown(g){this.startMouse(s.extend({},g,{ctrlKey:!0,preventDefault:()=>g.preventDefault()}),y.mousePos(this.element,g)),y.addEventListener(window,"mousemove",this.mousemove),y.addEventListener(window,"mouseup",this.mouseup)}mousemove(g){this.moveMouse(g,y.mousePos(this.element,g))}mouseup(g){this.mouseRotate.dragEnd(g),this.mousePitch&&this.mousePitch.dragEnd(g),this.offTemp()}touchstart(g){g.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=y.touchPos(this.element,g.targetTouches)[0],this.startTouch(g,this._startPos),y.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),y.addEventListener(window,"touchend",this.touchend))}touchmove(g){g.targetTouches.length!==1?this.reset():(this._lastPos=y.touchPos(this.element,g.targetTouches)[0],this.moveTouch(g,this._lastPos))}touchend(g){g.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let Ym;function jv(Ve,g,A){if(Ve=new s.LngLat(Ve.lng,Ve.lat),g){const _e=new s.LngLat(Ve.lng-360,Ve.lat),ct=new s.LngLat(Ve.lng+360,Ve.lat),pi=A.locationPoint(Ve).distSqr(g);A.locationPoint(_e).distSqr(g)<pi?Ve=_e:A.locationPoint(ct).distSqr(g)<pi&&(Ve=ct)}for(;Math.abs(Ve.lng-A.center.lng)>180;){const _e=A.locationPoint(Ve);if(_e.x>=0&&_e.y>=0&&_e.x<=A.width&&_e.y<=A.height)break;Ve.lng>A.center.lng?Ve.lng-=360:Ve.lng+=360}return Ve}const by={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Wv(Ve,g,A){const _e=Ve.classList;for(const ct in by)_e.remove(`maplibregl-${A}-anchor-${ct}`);_e.add(`maplibregl-${A}-anchor-${g}`)}class qv extends s.Evented{constructor(g,A){if(super(),(g instanceof HTMLElement||A)&&(g=s.extend({element:g},A)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=g&&g.anchor||"center",this._color=g&&g.color||"#3FB1CE",this._scale=g&&g.scale||1,this._draggable=g&&g.draggable||!1,this._clickTolerance=g&&g.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=g&&g.rotation||0,this._rotationAlignment=g&&g.rotationAlignment||"auto",this._pitchAlignment=g&&g.pitchAlignment&&g.pitchAlignment!=="auto"?g.pitchAlignment:this._rotationAlignment,g&&g.element)this._element=g.element,this._offset=s.Point.convert(g&&g.offset||[0,0]);else{this._defaultMarker=!0,this._element=y.create("div"),this._element.setAttribute("aria-label","Map marker");const _e=y.createNS("http://www.w3.org/2000/svg","svg"),ct=41,pi=27;_e.setAttributeNS(null,"display","block"),_e.setAttributeNS(null,"height",`${ct}px`),_e.setAttributeNS(null,"width",`${pi}px`),_e.setAttributeNS(null,"viewBox",`0 0 ${pi} ${ct}`);const In=y.createNS("http://www.w3.org/2000/svg","g");In.setAttributeNS(null,"stroke","none"),In.setAttributeNS(null,"stroke-width","1"),In.setAttributeNS(null,"fill","none"),In.setAttributeNS(null,"fill-rule","evenodd");const ds=y.createNS("http://www.w3.org/2000/svg","g");ds.setAttributeNS(null,"fill-rule","nonzero");const hs=y.createNS("http://www.w3.org/2000/svg","g");hs.setAttributeNS(null,"transform","translate(3.0, 29.0)"),hs.setAttributeNS(null,"fill","#000000");const vs=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ad of vs){const Lh=y.createNS("http://www.w3.org/2000/svg","ellipse");Lh.setAttributeNS(null,"opacity","0.04"),Lh.setAttributeNS(null,"cx","10.5"),Lh.setAttributeNS(null,"cy","5.80029008"),Lh.setAttributeNS(null,"rx",ad.rx),Lh.setAttributeNS(null,"ry",ad.ry),hs.appendChild(Lh)}const fl=y.createNS("http://www.w3.org/2000/svg","g");fl.setAttributeNS(null,"fill",this._color);const dl=y.createNS("http://www.w3.org/2000/svg","path");dl.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),fl.appendChild(dl);const dh=y.createNS("http://www.w3.org/2000/svg","g");dh.setAttributeNS(null,"opacity","0.25"),dh.setAttributeNS(null,"fill","#000000");const Ah=y.createNS("http://www.w3.org/2000/svg","path");Ah.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),dh.appendChild(Ah);const hh=y.createNS("http://www.w3.org/2000/svg","g");hh.setAttributeNS(null,"transform","translate(6.0, 7.0)"),hh.setAttributeNS(null,"fill","#FFFFFF");const Rh=y.createNS("http://www.w3.org/2000/svg","g");Rh.setAttributeNS(null,"transform","translate(8.0, 8.0)");const zh=y.createNS("http://www.w3.org/2000/svg","circle");zh.setAttributeNS(null,"fill","#000000"),zh.setAttributeNS(null,"opacity","0.25"),zh.setAttributeNS(null,"cx","5.5"),zh.setAttributeNS(null,"cy","5.5"),zh.setAttributeNS(null,"r","5.4999962");const Kh=y.createNS("http://www.w3.org/2000/svg","circle");Kh.setAttributeNS(null,"fill","#FFFFFF"),Kh.setAttributeNS(null,"cx","5.5"),Kh.setAttributeNS(null,"cy","5.5"),Kh.setAttributeNS(null,"r","5.4999962"),Rh.appendChild(zh),Rh.appendChild(Kh),ds.appendChild(hs),ds.appendChild(fl),ds.appendChild(dh),ds.appendChild(hh),ds.appendChild(Rh),_e.appendChild(ds),_e.setAttributeNS(null,"height",ct*this._scale+"px"),_e.setAttributeNS(null,"width",pi*this._scale+"px"),this._element.appendChild(_e),this._offset=s.Point.convert(g&&g.offset||[0,-14])}this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",_e=>{_e.preventDefault()}),this._element.addEventListener("mousedown",_e=>{_e.preventDefault()}),Wv(this._element,this._anchor,"marker"),this._popup=null}addTo(g){return this.remove(),this._map=g,g.getCanvasContainer().appendChild(this._element),g.on("move",this._update),g.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),y.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=s.LngLat.convert(g),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(g){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),g){if(!("offset"in g.options)){const ct=Math.sqrt(Math.pow(13.5,2)/2);g.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[ct,-1*(38.1-13.5+ct)],"bottom-right":[-ct,-1*(38.1-13.5+ct)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=g,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(g){const A=g.code,_e=g.charCode||g.keyCode;A!=="Space"&&A!=="Enter"&&_e!==32&&_e!==13||this.togglePopup()}_onMapClick(g){const A=g.originalEvent.target,_e=this._element;this._popup&&(A===_e||_e.contains(A))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const g=this._popup;return g?(g.isOpen()?g.remove():g.addTo(this._map),this):this}_update(g){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=jv(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let A="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?A=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(A=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let _e="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?_e="rotateX(0deg)":this._pitchAlignment==="map"&&(_e=`rotateX(${this._map.getPitch()}deg)`),g&&g.type!=="moveend"||(this._pos=this._pos.round()),y.setTransform(this._element,`${by[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${_e} ${A}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const ct=this._map.unproject(this._pos),pi=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=ct.distanceTo(this._lngLat)>20*pi?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(g){return this._offset=s.Point.convert(g),this._update(),this}_onMove(g){if(!this._isDragging){const A=this._clickTolerance||this._map._clickTolerance;this._isDragging=g.point.dist(this._pointerdownPos)>=A}this._isDragging&&(this._pos=g.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"}_addDragHandler(g){this._element.contains(g.originalEvent.target)&&(g.preventDefault(),this._positionDelta=g.point.sub(this._pos).add(this._offset),this._pointerdownPos=g.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(g){return this._draggable=!!g,this._map&&(g?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(g){return this._rotation=g||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(g){return this._rotationAlignment=g||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(g){return this._pitchAlignment=g&&g!=="auto"?g:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const G_={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let lv=0,Cy=!1;const Ax={maxWidth:100,unit:"metric"};function v0(Ve,g,A){const _e=A&&A.maxWidth||100,ct=Ve._container.clientHeight/2,pi=Ve.unproject([0,ct]),In=Ve.unproject([_e,ct]),ds=pi.distanceTo(In);if(A&&A.unit==="imperial"){const hs=3.2808*ds;hs>5280?iy(g,_e,hs/5280,Ve._getUIString("ScaleControl.Miles")):iy(g,_e,hs,Ve._getUIString("ScaleControl.Feet"))}else A&&A.unit==="nautical"?iy(g,_e,ds/1852,Ve._getUIString("ScaleControl.NauticalMiles")):ds>=1e3?iy(g,_e,ds/1e3,Ve._getUIString("ScaleControl.Kilometers")):iy(g,_e,ds,Ve._getUIString("ScaleControl.Meters"))}function iy(Ve,g,A,_e){const ct=function(pi){const In=Math.pow(10,`${Math.floor(pi)}`.length-1);let ds=pi/In;return ds=ds>=10?10:ds>=5?5:ds>=3?3:ds>=2?2:ds>=1?1:function(hs){const vs=Math.pow(10,Math.ceil(-Math.log(hs)/Math.LN10));return Math.round(hs*vs)/vs}(ds),In*ds}(A);Ve.style.width=g*(ct/A)+"px",Ve.innerHTML=`${ct}&nbsp;${_e}`}const x0={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},rx=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function fm(Ve){if(Ve){if(typeof Ve=="number"){const g=Math.round(Math.sqrt(.5*Math.pow(Ve,2)));return{center:new s.Point(0,0),top:new s.Point(0,Ve),"top-left":new s.Point(g,g),"top-right":new s.Point(-g,g),bottom:new s.Point(0,-Ve),"bottom-left":new s.Point(g,-g),"bottom-right":new s.Point(-g,-g),left:new s.Point(Ve,0),right:new s.Point(-Ve,0)}}if(Ve instanceof s.Point||Array.isArray(Ve)){const g=s.Point.convert(Ve);return{center:g,top:g,"top-left":g,"top-right":g,bottom:g,"bottom-left":g,"bottom-right":g,left:g,right:g}}return{center:s.Point.convert(Ve.center||[0,0]),top:s.Point.convert(Ve.top||[0,0]),"top-left":s.Point.convert(Ve["top-left"]||[0,0]),"top-right":s.Point.convert(Ve["top-right"]||[0,0]),bottom:s.Point.convert(Ve.bottom||[0,0]),"bottom-left":s.Point.convert(Ve["bottom-left"]||[0,0]),"bottom-right":s.Point.convert(Ve["bottom-right"]||[0,0]),left:s.Point.convert(Ve.left||[0,0]),right:s.Point.convert(Ve.right||[0,0])}}return fm(new s.Point(0,0))}const nx=m,w0={setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:class extends Np{constructor(Ve){var g;if(s.PerformanceUtils.mark(s.PerformanceMarkers.create),(Ve=s.extend({},ix,Ve)).minZoom!=null&&Ve.maxZoom!=null&&Ve.minZoom>Ve.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(Ve.minPitch!=null&&Ve.maxPitch!=null&&Ve.minPitch>Ve.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(Ve.minPitch!=null&&Ve.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(Ve.maxPitch!=null&&Ve.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new gy(Ve.minZoom,Ve.maxZoom,Ve.minPitch,Ve.maxPitch,Ve.renderWorldCopies),{bearingSnap:Ve.bearingSnap}),this._interactive=Ve.interactive,this._cooperativeGestures=Ve.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=Ve.maxTileCacheSize,this._maxTileCacheZoomLevels=Ve.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=Ve.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=Ve.preserveDrawingBuffer,this._antialias=Ve.antialias,this._trackResize=Ve.trackResize,this._bearingSnap=Ve.bearingSnap,this._refreshExpiredTiles=Ve.refreshExpiredTiles,this._fadeDuration=Ve.fadeDuration,this._crossSourceCollisions=Ve.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=Ve.collectResourceTiming,this._renderTaskQueue=new Hv,this._controls=[],this._mapId=s.uniqueId(),this._locale=s.extend({},tx,Ve.locale),this._clickTolerance=Ve.clickTolerance,this._pixelRatio=(g=Ve.pixelRatio)!==null&&g!==void 0?g:devicePixelRatio,this.transformCameraUpdate=Ve.transformCameraUpdate,this._imageQueueHandle=Vn.addThrottleControl(()=>this.isMoving()),this._requestManager=new Wr(Ve.transformRequest),typeof Ve.container=="string"){if(this._container=document.getElementById(Ve.container),!this._container)throw new Error(`Container '${Ve.container}' not found.`)}else{if(!(Ve.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=Ve.container}if(Ve.maxBounds&&this.setMaxBounds(Ve.maxBounds),s.bindAll(["_onWindowOnline","_onMapScroll","_cooperativeGesturesOnWheel","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let A=!1;this._resizeObserver=new ResizeObserver(_e=>{A?this._trackResize&&this.resize(_e)._update():A=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Xm(this,Ve),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=Ve.hash&&new Ex(typeof Ve.hash=="string"&&Ve.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:Ve.center,zoom:Ve.zoom,bearing:Ve.bearing,pitch:Ve.pitch}),Ve.bounds&&(this.resize(),this.fitBounds(Ve.bounds,s.extend({},Ve.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=Ve.localIdeographFontFamily,this._validateStyle=Ve.validateStyle,Ve.style&&this.setStyle(Ve.style,{localIdeographFontFamily:Ve.localIdeographFontFamily}),Ve.attributionControl&&this.addControl(new Kp({customAttribution:Ve.customAttribution})),Ve.maplibreLogo&&this.addControl(new nv,Ve.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",A=>{this._update(A.dataType==="style"),this.fire(new s.Event(`${A.dataType}data`,A))}),this.on("dataloading",A=>{this.fire(new s.Event(`${A.dataType}dataloading`,A))}),this.on("dataabort",A=>{this.fire(new s.Event("sourcedataabort",A))})}_getMapId(){return this._mapId}addControl(Ve,g){if(g===void 0&&(g=Ve.getDefaultPosition?Ve.getDefaultPosition():"top-right"),!Ve||!Ve.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const A=Ve.onAdd(this);this._controls.push(Ve);const _e=this._controlPositions[g];return g.indexOf("bottom")!==-1?_e.insertBefore(A,_e.firstChild):_e.appendChild(A),this}removeControl(Ve){if(!Ve||!Ve.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const g=this._controls.indexOf(Ve);return g>-1&&this._controls.splice(g,1),Ve.onRemove(this),this}hasControl(Ve){return this._controls.indexOf(Ve)>-1}calculateCameraOptionsFromTo(Ve,g,A,_e){return _e==null&&this.terrain&&(_e=this.transform.getElevation(A,this.terrain)),super.calculateCameraOptionsFromTo(Ve,g,A,_e)}resize(Ve){var g;const A=this._containerDimensions(),_e=A[0],ct=A[1];this._resizeCanvas(_e,ct,this.getPixelRatio()),this.transform.resize(_e,ct),(g=this._requestedCameraState)===null||g===void 0||g.resize(_e,ct),this.painter.resize(_e,ct,this.getPixelRatio());const pi=!this._moving;return pi&&(this.stop(),this.fire(new s.Event("movestart",Ve)).fire(new s.Event("move",Ve))),this.fire(new s.Event("resize",Ve)),pi&&this.fire(new s.Event("moveend",Ve)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(Ve){const[g,A]=this._containerDimensions();this._pixelRatio=Ve,this._resizeCanvas(g,A,Ve),this.painter.resize(g,A,Ve)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(Ve){return this.transform.setMaxBounds(Rd.convert(Ve)),this._update()}setMinZoom(Ve){if((Ve=Ve??-2)>=-2&&Ve<=this.transform.maxZoom)return this.transform.minZoom=Ve,this._update(),this.getZoom()<Ve&&this.setZoom(Ve),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(Ve){if((Ve=Ve??22)>=this.transform.minZoom)return this.transform.maxZoom=Ve,this._update(),this.getZoom()>Ve&&this.setZoom(Ve),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(Ve){if((Ve=Ve??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(Ve>=0&&Ve<=this.transform.maxPitch)return this.transform.minPitch=Ve,this._update(),this.getPitch()<Ve&&this.setPitch(Ve),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(Ve){if((Ve=Ve??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(Ve>=this.transform.minPitch)return this.transform.maxPitch=Ve,this._update(),this.getPitch()>Ve&&this.setPitch(Ve),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(Ve){return this.transform.renderWorldCopies=Ve,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(Ve){return this._cooperativeGestures=Ve,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(Ve){return this.transform.locationPoint(s.LngLat.convert(Ve),this.style&&this.terrain)}unproject(Ve){return this.transform.pointLocation(s.Point.convert(Ve),this.terrain)}isMoving(){var Ve;return this._moving||((Ve=this.handlers)===null||Ve===void 0?void 0:Ve.isMoving())}isZooming(){var Ve;return this._zooming||((Ve=this.handlers)===null||Ve===void 0?void 0:Ve.isZooming())}isRotating(){var Ve;return this._rotating||((Ve=this.handlers)===null||Ve===void 0?void 0:Ve.isRotating())}_createDelegatedListener(Ve,g,A){if(Ve==="mouseenter"||Ve==="mouseover"){let _e=!1;return{layer:g,listener:A,delegates:{mousemove:pi=>{const In=this.getLayer(g)?this.queryRenderedFeatures(pi.point,{layers:[g]}):[];In.length?_e||(_e=!0,A.call(this,new Vg(Ve,this,pi.originalEvent,{features:In}))):_e=!1},mouseout:()=>{_e=!1}}}}if(Ve==="mouseleave"||Ve==="mouseout"){let _e=!1;return{layer:g,listener:A,delegates:{mousemove:In=>{(this.getLayer(g)?this.queryRenderedFeatures(In.point,{layers:[g]}):[]).length?_e=!0:_e&&(_e=!1,A.call(this,new Vg(Ve,this,In.originalEvent)))},mouseout:In=>{_e&&(_e=!1,A.call(this,new Vg(Ve,this,In.originalEvent)))}}}}{const _e=ct=>{const pi=this.getLayer(g)?this.queryRenderedFeatures(ct.point,{layers:[g]}):[];pi.length&&(ct.features=pi,A.call(this,ct),delete ct.features)};return{layer:g,listener:A,delegates:{[Ve]:_e}}}}on(Ve,g,A){if(A===void 0)return super.on(Ve,g);const _e=this._createDelegatedListener(Ve,g,A);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[Ve]=this._delegatedListeners[Ve]||[],this._delegatedListeners[Ve].push(_e);for(const ct in _e.delegates)this.on(ct,_e.delegates[ct]);return this}once(Ve,g,A){if(A===void 0)return super.once(Ve,g);const _e=this._createDelegatedListener(Ve,g,A);for(const ct in _e.delegates)this.once(ct,_e.delegates[ct]);return this}off(Ve,g,A){return A===void 0?super.off(Ve,g):(this._delegatedListeners&&this._delegatedListeners[Ve]&&(_e=>{const ct=this._delegatedListeners[Ve];for(let pi=0;pi<ct.length;pi++){const In=ct[pi];if(In.layer===g&&In.listener===A){for(const ds in In.delegates)this.off(ds,In.delegates[ds]);return ct.splice(pi,1),this}}})(),this)}queryRenderedFeatures(Ve,g){if(!this.style)return[];let A;const _e=Ve instanceof s.Point||Array.isArray(Ve),ct=_e?Ve:[[0,0],[this.transform.width,this.transform.height]];if(g=g||(_e?{}:Ve)||{},ct instanceof s.Point||typeof ct[0]=="number")A=[s.Point.convert(ct)];else{const pi=s.Point.convert(ct[0]),In=s.Point.convert(ct[1]);A=[pi,new s.Point(In.x,pi.y),In,new s.Point(pi.x,In.y),pi]}return this.style.queryRenderedFeatures(A,g,this.transform)}querySourceFeatures(Ve,g){return this.style.querySourceFeatures(Ve,g)}setStyle(Ve,g){return(g=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},g)).diff!==!1&&g.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&Ve?(this._diffStyle(Ve,g),this):(this._localIdeographFontFamily=g.localIdeographFontFamily,this._updateStyle(Ve,g))}setTransformRequest(Ve){return this._requestManager.setTransformRequest(Ve),this}_getUIString(Ve){const g=this._locale[Ve];if(g==null)throw new Error(`Missing UI string '${Ve}'`);return g}_updateStyle(Ve,g){if(g.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(Ve,g));const A=this.style&&g.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!Ve)),Ve?(this.style=new xm(this,g||{}),this.style.setEventedParent(this,{style:this.style}),typeof Ve=="string"?this.style.loadURL(Ve,g,A):this.style.loadJSON(Ve,g,A),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new xm(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(Ve,g){if(typeof Ve=="string"){const A=this._requestManager.transformRequest(Ve,Bn.Style);s.getJSON(A,(_e,ct)=>{_e?this.fire(new s.ErrorEvent(_e)):ct&&this._updateDiff(ct,g)})}else typeof Ve=="object"&&this._updateDiff(Ve,g)}_updateDiff(Ve,g){try{this.style.setState(Ve,g)&&this._update(!0)}catch(A){s.warnOnce(`Unable to perform style diff: ${A.message||A.error||A}.  Rebuilding the style from scratch.`),this._updateStyle(Ve,g)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.warnOnce("There is no style added to the map.")}addSource(Ve,g){return this._lazyInitEmptyStyle(),this.style.addSource(Ve,g),this._update(!0)}isSourceLoaded(Ve){const g=this.style&&this.style.sourceCaches[Ve];if(g!==void 0)return g.loaded();this.fire(new s.ErrorEvent(new Error(`There is no source with ID '${Ve}'`)))}setTerrain(Ve){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),Ve){const g=this.style.sourceCaches[Ve.source];if(!g)throw new Error(`cannot load terrain, because there exists no source with ID: ${Ve.source}`);for(const A in this.style._layers){const _e=this.style._layers[A];_e.type==="hillshade"&&_e.source===Ve.source&&s.warnOnce("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new x_(this.painter,g,Ve),this.painter.renderToTexture=new Mg(this.painter,this.terrain),this.transform.updateElevation(this.terrain),this._terrainDataCallback=A=>{A.dataType==="style"?this.terrain.sourceCache.freeRtt():A.dataType==="source"&&A.tile&&(A.sourceId===Ve.source&&this.transform.updateElevation(this.terrain),this.terrain.sourceCache.freeRtt(A.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.updateElevation(this.terrain);return this.fire(new s.Event("terrain",{terrain:Ve})),this}getTerrain(){return this.terrain&&this.terrain.options}areTilesLoaded(){const Ve=this.style&&this.style.sourceCaches;for(const g in Ve){const A=Ve[g]._tiles;for(const _e in A){const ct=A[_e];if(ct.state!=="loaded"&&ct.state!=="errored")return!1}}return!0}addSourceType(Ve,g,A){return this._lazyInitEmptyStyle(),this.style.addSourceType(Ve,g,A)}removeSource(Ve){return this.style.removeSource(Ve),this._update(!0)}getSource(Ve){return this.style.getSource(Ve)}addImage(Ve,g,{pixelRatio:A=1,sdf:_e=!1,stretchX:ct,stretchY:pi,content:In}={}){if(this._lazyInitEmptyStyle(),g instanceof HTMLImageElement||s.isImageBitmap(g)){const{width:ds,height:hs,data:vs}=s.exported.getImageData(g);this.style.addImage(Ve,{data:new s.RGBAImage({width:ds,height:hs},vs),pixelRatio:A,stretchX:ct,stretchY:pi,content:In,sdf:_e,version:0})}else{if(g.width===void 0||g.height===void 0)return this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:ds,height:hs,data:vs}=g,fl=g;this.style.addImage(Ve,{data:new s.RGBAImage({width:ds,height:hs},new Uint8Array(vs)),pixelRatio:A,stretchX:ct,stretchY:pi,content:In,sdf:_e,version:0,userImage:fl}),fl.onAdd&&fl.onAdd(this,Ve)}}}updateImage(Ve,g){const A=this.style.getImage(Ve);if(!A)return this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _e=g instanceof HTMLImageElement||s.isImageBitmap(g)?s.exported.getImageData(g):g,{width:ct,height:pi,data:In}=_e;if(ct===void 0||pi===void 0)return this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(ct!==A.data.width||pi!==A.data.height)return this.fire(new s.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const ds=!(g instanceof HTMLImageElement||s.isImageBitmap(g));A.data.replace(In,ds),this.style.updateImage(Ve,A)}getImage(Ve){return this.style.getImage(Ve)}hasImage(Ve){return Ve?!!this.style.getImage(Ve):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(Ve){this.style.removeImage(Ve)}loadImage(Ve,g){Vn.getImage(this._requestManager.transformRequest(Ve,Bn.Image),g)}listImages(){return this.style.listImages()}addLayer(Ve,g){return this._lazyInitEmptyStyle(),this.style.addLayer(Ve,g),this._update(!0)}moveLayer(Ve,g){return this.style.moveLayer(Ve,g),this._update(!0)}removeLayer(Ve){return this.style.removeLayer(Ve),this._update(!0)}getLayer(Ve){return this.style.getLayer(Ve)}setLayerZoomRange(Ve,g,A){return this.style.setLayerZoomRange(Ve,g,A),this._update(!0)}setFilter(Ve,g,A={}){return this.style.setFilter(Ve,g,A),this._update(!0)}getFilter(Ve){return this.style.getFilter(Ve)}setPaintProperty(Ve,g,A,_e={}){return this.style.setPaintProperty(Ve,g,A,_e),this._update(!0)}getPaintProperty(Ve,g){return this.style.getPaintProperty(Ve,g)}setLayoutProperty(Ve,g,A,_e={}){return this.style.setLayoutProperty(Ve,g,A,_e),this._update(!0)}getLayoutProperty(Ve,g){return this.style.getLayoutProperty(Ve,g)}setGlyphs(Ve,g={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(Ve,g),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(Ve,g,A={}){return this._lazyInitEmptyStyle(),this.style.addSprite(Ve,g,A,_e=>{_e||this._update(!0)}),this}removeSprite(Ve){return this._lazyInitEmptyStyle(),this.style.removeSprite(Ve),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(Ve,g={}){return this._lazyInitEmptyStyle(),this.style.setSprite(Ve,g,A=>{A||this._update(!0)}),this}setLight(Ve,g={}){return this._lazyInitEmptyStyle(),this.style.setLight(Ve,g),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(Ve,g){return this.style.setFeatureState(Ve,g),this._update()}removeFeatureState(Ve,g){return this.style.removeFeatureState(Ve,g),this._update()}getFeatureState(Ve){return this.style.getFeatureState(Ve)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let Ve=0,g=0;return this._container&&(Ve=this._container.clientWidth||400,g=this._container.clientHeight||300),[Ve,g]}_setupContainer(){const Ve=this._container;Ve.classList.add("maplibregl-map");const g=this._canvasContainer=y.create("div","maplibregl-canvas-container",Ve);this._interactive&&g.classList.add("maplibregl-interactive"),this._canvas=y.create("canvas","maplibregl-canvas",g),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const A=this._containerDimensions();this._resizeCanvas(A[0],A[1],this.getPixelRatio());const _e=this._controlContainer=y.create("div","maplibregl-control-container",Ve),ct=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(pi=>{ct[pi]=y.create("div",`maplibregl-ctrl-${pi} `,_e)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_cooperativeGesturesOnWheel(Ve){this._onCooperativeGesture(Ve,Ve[this._metaKey],1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=y.create("div","maplibregl-cooperative-gesture-screen",this._container);let Ve=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(Ve=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${Ve}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){y.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(Ve,g,A){this._canvas.width=A*Ve,this._canvas.height=A*g,this._canvas.style.width=`${Ve}px`,this._canvas.style.height=`${g}px`}_setupPainter(){const Ve={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let g=null;this._canvas.addEventListener("webglcontextcreationerror",_e=>{g={requestedAttributes:Ve},_e&&(g.statusMessage=_e.statusMessage,g.type=_e.type)},{once:!0});const A=this._canvas.getContext("webgl2",Ve)||this._canvas.getContext("webgl",Ve);if(!A){const _e="Failed to initialize WebGL";throw g?(g.message=_e,new Error(JSON.stringify(g))):new Error(_e)}this.painter=new Z0(A,this.transform),D.testSupport(A)}_contextLost(Ve){Ve.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:Ve}))}_contextRestored(Ve){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:Ve}))}_onMapScroll(Ve){if(Ve.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(Ve,g,A){return!g&&A<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(Ve){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||Ve,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(Ve){return this._update(),this._renderTaskQueue.add(Ve)}_cancelRenderFrame(Ve){this._renderTaskQueue.remove(Ve)}_render(Ve){const g=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(Ve),this._removed)return;let A=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const ct=this.transform.zoom,pi=s.exported.now();this.style.zoomHistory.update(ct,pi);const In=new s.EvaluationParameters(ct,{now:pi,fadeDuration:g,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ds=In.crossFadingFactor();ds===1&&ds===this._crossFadingFactor||(A=!0,this._crossFadingFactor=ds),this.style.update(In)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain&&this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.updateElevation(this.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,g,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,showPadding:this.showPadding}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.PerformanceUtils.mark(s.PerformanceMarkers.load),this.fire(new s.Event("load"))),this.style&&(this.style.hasTransitions()||A)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const _e=this._sourcesDirty||this._styleDirty||this._placementDirty;return _e||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.Event("idle")),!this._loaded||this._fullyLoaded||_e||(this._fullyLoaded=!0,s.PerformanceUtils.mark(s.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var Ve;this._hash&&this._hash.remove();for(const A of this._controls)A.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Vn.removeThrottleControl(this._imageQueueHandle),(Ve=this._resizeObserver)===null||Ve===void 0||Ve.disconnect();const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),y.remove(this._canvasContainer),y.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),s.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new s.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=s.exported.frame(Ve=>{s.PerformanceUtils.frame(Ve),this._frame=null,this._render(Ve)}))}_onWindowOnline(){this._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(Ve){this._showTileBoundaries!==Ve&&(this._showTileBoundaries=Ve,this._update())}get showPadding(){return!!this._showPadding}set showPadding(Ve){this._showPadding!==Ve&&(this._showPadding=Ve,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(Ve){this._showCollisionBoxes!==Ve&&(this._showCollisionBoxes=Ve,Ve?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(Ve){this._showOverdrawInspector!==Ve&&(this._showOverdrawInspector=Ve,this._update())}get repaint(){return!!this._repaint}set repaint(Ve){this._repaint!==Ve&&(this._repaint=Ve,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(Ve){this._vertices=Ve,this._update()}get version(){return Jg}getCameraTargetElevation(){return this.transform.elevation}},NavigationControl:class{constructor(Ve){this.options=s.extend({},sv,Ve),this._container=y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",g=>g.preventDefault()),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",g=>this._map.zoomIn({},{originalEvent:g})),y.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",g=>this._map.zoomOut({},{originalEvent:g})),y.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass",g=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:g}):this._map.resetNorth({},{originalEvent:g})}),this._compassIcon=y.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const Ve=this._map.getZoom(),g=Ve===this._map.getMaxZoom(),A=Ve===this._map.getMinZoom();this._zoomInButton.disabled=g,this._zoomOutButton.disabled=A,this._zoomInButton.setAttribute("aria-disabled",g.toString()),this._zoomOutButton.setAttribute("aria-disabled",A.toString())}_rotateCompassArrow(){const Ve=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=Ve}onAdd(Ve){return this._map=Ve,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new av(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){y.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(Ve,g){const A=y.create("button",Ve,this._container);return A.type="button",A.addEventListener("click",g),A}_setButtonTitle(Ve,g){const A=this._map._getUIString(`NavigationControl.${g}`);Ve.title=A,Ve.setAttribute("aria-label",A)}},GeolocateControl:class extends s.Evented{constructor(Ve){super(),this.options=s.extend({},G_,Ve),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(Ve){return this._map=Ve,this._container=y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(g,A=!1){Ym===void 0||A?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(_e=>{Ym=_e.state!=="denied",g(Ym)}).catch(()=>{Ym=!!window.navigator.geolocation,g(Ym)}):(Ym=!!window.navigator.geolocation,g(Ym)):g(Ym)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),y.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,lv=0,Cy=!1}_isOutOfMapMaxBounds(Ve){const g=this._map.getMaxBounds(),A=Ve.coords;return g&&(A.longitude<g.getWest()||A.longitude>g.getEast()||A.latitude<g.getSouth()||A.latitude>g.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(Ve){if(this._map){if(this._isOutOfMapMaxBounds(Ve))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",Ve)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=Ve,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(Ve),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(Ve),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.Event("geolocate",Ve)),this._finish()}}_updateCamera(Ve){const g=new s.LngLat(Ve.coords.longitude,Ve.coords.latitude),A=Ve.coords.accuracy,_e=this._map.getBearing(),ct=s.extend({bearing:_e},this.options.fitBoundsOptions),pi=Rd.fromLngLat(g,A);this._map.fitBounds(pi,ct,{geolocateSource:!0})}_updateMarker(Ve){if(Ve){const g=new s.LngLat(Ve.coords.longitude,Ve.coords.latitude);this._accuracyCircleMarker.setLngLat(g).addTo(this._map),this._userLocationDotMarker.setLngLat(g).addTo(this._map),this._accuracy=Ve.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const Ve=this._map.getBounds(),g=Ve.getSouthEast(),A=Ve.getNorthEast(),_e=g.distanceTo(A),ct=Math.ceil(this._accuracy/(_e/this._map._container.clientHeight)*2);this._circleElement.style.width=`${ct}px`,this._circleElement.style.height=`${ct}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(Ve){if(this._map){if(this.options.trackUserLocation)if(Ve.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(Ve.code===3&&Cy)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.Event("error",Ve)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(Ve){if(this._map){if(this._container.addEventListener("contextmenu",g=>g.preventDefault()),this._geolocateButton=y.create("button","maplibregl-ctrl-geolocate",this._container),y.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",Ve===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g)}else{const g=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=y.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new qv(this._dotElement),this._circleElement=y.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new qv({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",g=>{g.geolocateSource||this._watchState!=="ACTIVE_LOCK"||g.originalEvent&&g.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.Event("trackuserlocationend")))})}}trigger(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":lv--,Cy=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let Ve;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),lv++,lv>1?(Ve={maximumAge:6e5,timeout:0},Cy=!0):(Ve=this.options.positionOptions,Cy=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,Ve)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Kp,LogoControl:nv,ScaleControl:class{constructor(Ve){this.options=s.extend({},Ax,Ve),s.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){v0(this._map,this._container,this.options)}onAdd(Ve){return this._map=Ve,this._container=y.create("div","maplibregl-ctrl maplibregl-ctrl-scale",Ve.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){y.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(Ve){this.options.unit=Ve,v0(this._map,this._container,this.options)}},FullscreenControl:class extends s.Evented{constructor(Ve={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,Ve&&Ve.container&&(Ve.container instanceof HTMLElement?this._container=Ve.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(Ve){return this._map=Ve,this._container||(this._container=this._map.getContainer()),this._controlContainer=y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){y.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const Ve=this._fullscreenButton=y.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);y.create("span","maplibregl-ctrl-icon",Ve).setAttribute("aria-hidden","true"),Ve.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const Ve=this._getTitle();this._fullscreenButton.setAttribute("aria-label",Ve),this._fullscreenButton.title=Ve}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.Event("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new s.Event("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},TerrainControl:class{constructor(Ve){this.options=Ve,s.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(Ve){return this._map=Ve,this._container=y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=y.create("button","maplibregl-ctrl-terrain",this._container),y.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){y.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends s.Evented{constructor(Ve){super(),this.options=s.extend(Object.create(x0),Ve),s.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(Ve){return this._map&&this.remove(),this._map=Ve,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&y.remove(this._content),this._container&&(y.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new s.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(Ve){return this._lngLat=s.LngLat.convert(Ve),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(Ve){return this.setDOMContent(document.createTextNode(Ve))}setHTML(Ve){const g=document.createDocumentFragment(),A=document.createElement("body");let _e;for(A.innerHTML=Ve;_e=A.firstChild,_e;)g.appendChild(_e);return this.setDOMContent(g)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(Ve){return this.options.maxWidth=Ve,this._update(),this}setDOMContent(Ve){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=y.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(Ve),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(Ve){this._container&&this._container.classList.add(Ve)}removeClassName(Ve){this._container&&this._container.classList.remove(Ve)}setOffset(Ve){return this.options.offset=Ve,this._update(),this}toggleClassName(Ve){if(this._container)return this._container.classList.toggle(Ve)}_createCloseButton(){this.options.closeButton&&(this._closeButton=y.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(Ve){this._update(Ve.point)}_onMouseMove(Ve){this._update(Ve.point)}_onDrag(Ve){this._update(Ve.point)}_update(Ve){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=y.create("div","maplibregl-popup",this._map.getContainer()),this._tip=y.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(pi=>this._container.classList.add(pi)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=jv(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!Ve))return;const g=this._pos=this._trackPointer&&Ve?Ve:this._map.project(this._lngLat);let A=this.options.anchor;const _e=fm(this.options.offset);if(!A){const pi=this._container.offsetWidth,In=this._container.offsetHeight;let ds;ds=g.y+_e.bottom.y<In?["top"]:g.y>this._map.transform.height-In?["bottom"]:[],g.x<pi/2?ds.push("left"):g.x>this._map.transform.width-pi/2&&ds.push("right"),A=ds.length===0?"bottom":ds.join("-")}const ct=g.add(_e[A]).round();y.setTransform(this._container,`${by[A]} translate(${ct.x}px,${ct.y}px)`),Wv(this._container,A,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const Ve=this._container.querySelector(rx);Ve&&Ve.focus()}_onClose(){this.remove()}},Marker:qv,Style:xm,LngLat:s.LngLat,LngLatBounds:Rd,Point:s.Point,MercatorCoordinate:s.MercatorCoordinate,Evented:s.Evented,AJAXError:s.AJAXError,config:s.config,CanvasSource:Yh,GeoJSONSource:zp,ImageSource:Ap,RasterDEMTileSource:ep,RasterTileSource:Op,VectorTileSource:Wd,VideoSource:Ip,prewarm:function(){Ep().acquire(Uf)},clearPrewarmedResources:function(){const Ve=xp;Ve&&(Ve.isPreloaded()&&Ve.numActive()===1?(Ve.release(Uf),xp=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return nx},get workerCount(){return cd.workerCount},set workerCount(Ve){cd.workerCount=Ve},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(Ve){s.config.MAX_PARALLEL_IMAGE_REQUESTS=Ve},get workerUrl(){return s.config.WORKER_URL},set workerUrl(Ve){s.config.WORKER_URL=Ve},addProtocol(Ve,g){s.config.REGISTERED_PROTOCOLS[Ve]=g},removeProtocol(Ve){delete s.config.REGISTERED_PROTOCOLS[Ve]}};return tm.extend(w0,{isSafari:s.isSafari,getPerformanceMetrics:s.PerformanceUtils.getPerformanceMetrics}),w0});var l=o;return l})})(maplibreGl);var maplibreGlExports=maplibreGl.exports;const maplibregl__default=getDefaultExportFromCjs(maplibreGlExports),version$2="3.7.5",VERSION$3=version$2,_hasatob=typeof atob=="function",_hasbtoa=typeof btoa=="function",_hasBuffer=typeof Buffer=="function",_TD=typeof TextDecoder=="function"?new TextDecoder:void 0,_TE=typeof TextEncoder=="function"?new TextEncoder:void 0,b64ch="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",b64chs=Array.prototype.slice.call(b64ch),b64tab=(r=>{let e={};return r.forEach((t,n)=>e[t]=n),e})(b64chs),b64re=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,_fromCC=String.fromCharCode.bind(String),_U8Afrom=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):r=>new Uint8Array(Array.prototype.slice.call(r,0)),_mkUriSafe=r=>r.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),_tidyB64=r=>r.replace(/[^A-Za-z0-9\+\/]/g,""),btoaPolyfill=r=>{let e,t,n,o,a="";const l=r.length%3;for(let s=0;s<r.length;){if((t=r.charCodeAt(s++))>255||(n=r.charCodeAt(s++))>255||(o=r.charCodeAt(s++))>255)throw new TypeError("invalid character found");e=t<<16|n<<8|o,a+=b64chs[e>>18&63]+b64chs[e>>12&63]+b64chs[e>>6&63]+b64chs[e&63]}return l?a.slice(0,l-3)+"===".substring(l):a},_btoa=_hasbtoa?r=>btoa(r):_hasBuffer?r=>Buffer.from(r,"binary").toString("base64"):btoaPolyfill,_fromUint8Array=_hasBuffer?r=>Buffer.from(r).toString("base64"):r=>{let t=[];for(let n=0,o=r.length;n<o;n+=4096)t.push(_fromCC.apply(null,r.subarray(n,n+4096)));return _btoa(t.join(""))},fromUint8Array=(r,e=!1)=>e?_mkUriSafe(_fromUint8Array(r)):_fromUint8Array(r),cb_utob=r=>{if(r.length<2){var e=r.charCodeAt(0);return e<128?r:e<2048?_fromCC(192|e>>>6)+_fromCC(128|e&63):_fromCC(224|e>>>12&15)+_fromCC(128|e>>>6&63)+_fromCC(128|e&63)}else{var e=65536+(r.charCodeAt(0)-55296)*1024+(r.charCodeAt(1)-56320);return _fromCC(240|e>>>18&7)+_fromCC(128|e>>>12&63)+_fromCC(128|e>>>6&63)+_fromCC(128|e&63)}},re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,utob=r=>r.replace(re_utob,cb_utob),_encode=_hasBuffer?r=>Buffer.from(r,"utf8").toString("base64"):_TE?r=>_fromUint8Array(_TE.encode(r)):r=>_btoa(utob(r)),encode$4=(r,e=!1)=>e?_mkUriSafe(_encode(r)):_encode(r),encodeURI=r=>encode$4(r,!0),re_btou=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,cb_btou=r=>{switch(r.length){case 4:var e=(7&r.charCodeAt(0))<<18|(63&r.charCodeAt(1))<<12|(63&r.charCodeAt(2))<<6|63&r.charCodeAt(3),t=e-65536;return _fromCC((t>>>10)+55296)+_fromCC((t&1023)+56320);case 3:return _fromCC((15&r.charCodeAt(0))<<12|(63&r.charCodeAt(1))<<6|63&r.charCodeAt(2));default:return _fromCC((31&r.charCodeAt(0))<<6|63&r.charCodeAt(1))}},btou=r=>r.replace(re_btou,cb_btou),atobPolyfill=r=>{if(r=r.replace(/\s+/g,""),!b64re.test(r))throw new TypeError("malformed base64.");r+="==".slice(2-(r.length&3));let e,t="",n,o;for(let a=0;a<r.length;)e=b64tab[r.charAt(a++)]<<18|b64tab[r.charAt(a++)]<<12|(n=b64tab[r.charAt(a++)])<<6|(o=b64tab[r.charAt(a++)]),t+=n===64?_fromCC(e>>16&255):o===64?_fromCC(e>>16&255,e>>8&255):_fromCC(e>>16&255,e>>8&255,e&255);return t},_atob=_hasatob?r=>atob(_tidyB64(r)):_hasBuffer?r=>Buffer.from(r,"base64").toString("binary"):atobPolyfill,_toUint8Array=_hasBuffer?r=>_U8Afrom(Buffer.from(r,"base64")):r=>_U8Afrom(_atob(r).split("").map(e=>e.charCodeAt(0))),toUint8Array=r=>_toUint8Array(_unURI(r)),_decode=_hasBuffer?r=>Buffer.from(r,"base64").toString("utf8"):_TD?r=>_TD.decode(_toUint8Array(r)):r=>btou(_atob(r)),_unURI=r=>_tidyB64(r.replace(/[-_]/g,e=>e=="-"?"+":"/")),decode$6=r=>_decode(_unURI(r)),isValid=r=>{if(typeof r!="string")return!1;const e=r.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(e)||!/[^\s0-9a-zA-Z\-_]/.test(e)},_noEnum=r=>({value:r,enumerable:!1,writable:!0,configurable:!0}),extendString=function(){const r=(e,t)=>Object.defineProperty(String.prototype,e,_noEnum(t));r("fromBase64",function(){return decode$6(this)}),r("toBase64",function(e){return encode$4(this,e)}),r("toBase64URI",function(){return encode$4(this,!0)}),r("toBase64URL",function(){return encode$4(this,!0)}),r("toUint8Array",function(){return toUint8Array(this)})},extendUint8Array=function(){const r=(e,t)=>Object.defineProperty(Uint8Array.prototype,e,_noEnum(t));r("toBase64",function(e){return fromUint8Array(this,e)}),r("toBase64URI",function(){return fromUint8Array(this,!0)}),r("toBase64URL",function(){return fromUint8Array(this,!0)})},extendBuiltins=()=>{extendString(),extendUint8Array()},gBase64={version:version$2,VERSION:VERSION$3,atob:_atob,atobPolyfill,btoa:_btoa,btoaPolyfill,fromBase64:decode$6,toBase64:encode$4,encode:encode$4,encodeURI,encodeURL:encodeURI,utob,btou,decode:decode$6,isValid,fromUint8Array,toUint8Array,extendString,extendUint8Array,extendBuiltins};function tryGettingFetch(){return typeof self<"u"?fetch.bind(self):typeof global<"u"&&global.fetch?global.fetch:null}class ClientConfig{constructor(){this._apiKey="",this._fetch=tryGettingFetch()}set apiKey(e){this._apiKey=e}get apiKey(){return this._apiKey}set fetch(e){this._fetch=e}get fetch(){return this._fetch}}const config$1=new ClientConfig,LanguageGeocoding={AUTO:"auto",ALBANIAN:"sq",ARABIC:"ar",ARMENIAN:"hy",AZERBAIJANI:"az",BELORUSSIAN:"be",BOSNIAN:"bs",BRETON:"br",BULGARIAN:"bg",CATALAN:"ca",CHINESE:"zh",CROATIAN:"hr",CZECH:"cs",DANISH:"da",DUTCH:"nl",ENGLISH:"en",ESPERANTO:"eo",ESTONIAN:"et",FINNISH:"fi",FRENCH:"fr",FRISIAN:"fy",GEORGIAN:"ka",GERMAN:"de",GREEK:"el",HEBREW:"he",HUNGARIAN:"hu",ICELANDIC:"is",IRISH:"ga",ITALIAN:"it",JAPANESE:"ja",KANNADA:"kn",KAZAKH:"kk",KOREAN:"ko",ROMAN_LATIN:"la",LATVIAN:"lv",LITHUANIAN:"lt",LUXEMBOURGISH:"lb",MACEDONIAN:"mk",MALTESE:"mt",NORWEGIAN:"no",POLISH:"pl",PORTUGUESE:"pt",ROMANIAN:"ro",ROMANSH:"rm",RUSSIAN:"ru",SCOTTISH_GAELIC:"gd",SERBIAN_CYRILLIC:"sr",SLOVAK:"sk",SLOVENE:"sl",SPANISH:"es",SWEDISH:"sv",THAI:"th",TURKISH:"tr",UKRAINIAN:"uk",WELSH:"cy"},languageCodeSet$1=new Set(Object.values(LanguageGeocoding));function getAutoLanguageGeocoding(){if(typeof navigator>"u")return Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];const r=Array.from(new Set(navigator.languages.map(e=>e.split("-")[0]))).filter(e=>languageCodeSet$1.has(e));return r.length?r[0]:LanguageGeocoding.ENGLISH}var __async$4=(r,e,t)=>new Promise((n,o)=>{var a=m=>{try{s(t.next(m))}catch(y){o(y)}},l=m=>{try{s(t.throw(m))}catch(y){o(y)}},s=m=>m.done?n(m.value):Promise.resolve(m.value).then(a,l);s((t=t.apply(r,e)).next())});function callFetch(r){return __async$4(this,arguments,function*(e,t={}){if(config$1.fetch===null)throw new Error("The fetch function was not found. If on NodeJS < 18 please specify the fetch function with config.fetch");if(new URL(e).searchParams.get("key").trim()==="")throw new Error("The MapTiler Cloud API key is missing. Set it in `config.apiKey` or get one for free at https://maptiler.com");return config$1.fetch(e,t)})}const defaults$1={maptilerApiURL:"https://api.maptiler.com/",mapStyle:"streets-v2"};Object.freeze(defaults$1);class ServiceError extends Error{constructor(e,t=""){super(`Call to enpoint ${e.url} failed with the status code ${e.status}. ${t}`),this.res=e}}var __async$3=(r,e,t)=>new Promise((n,o)=>{var a=m=>{try{s(t.next(m))}catch(y){o(y)}},l=m=>{try{s(t.throw(m))}catch(y){o(y)}},s=m=>m.done?n(m.value):Promise.resolve(m.value).then(a,l);s((t=t.apply(r,e)).next())});const customMessages$3={400:"Query too long / Invalid parameters",403:"Key is missing, invalid or restricted"};function addLanguageGeocodingOptions(r,e){if(e.language==null)return;const t=Array.from(new Set((Array.isArray(e.language)?e.language:[e.language]).map(n=>n===LanguageGeocoding.AUTO?getAutoLanguageGeocoding():n))).join(",");r.set("language",t)}function addCommonForwardAndReverseGeocodingOptions(r,e){var t;r.set("key",(t=e.apiKey)!=null?t:config$1.apiKey),e.limit!=null&&r.set("limit",String(e.limit)),e.types!=null&&r.set("types",e.types.join(",")),addLanguageGeocodingOptions(r,e)}function addForwardGeocodingOptions(r,e){addCommonForwardAndReverseGeocodingOptions(r,e),e.bbox!=null&&r.set("bbox",e.bbox.join(",")),e.proximity!=null&&r.set("proximity",e.proximity.join(",")),e.country!=null&&r.set("country",e.country.join(",")),e.fuzzyMatch!=null&&r.set("fuzzyMatch",e.fuzzyMatch?"true":"false"),e.autocomplete!=null&&r.set("autocomplete",e.autocomplete?"true":"false")}function forward(r){return __async$3(this,arguments,function*(e,t={}){var n;if(typeof e!="string"||e.trim().length===0)throw new Error("The query must be a non-empty string");const o=new URL(`geocoding/${encodeURIComponent(e)}.json`,defaults$1.maptilerApiURL),{searchParams:a}=o;addForwardGeocodingOptions(a,t);const l=o.toString(),s=yield callFetch(l);if(!s.ok)throw new ServiceError(s,(n=customMessages$3[s.status])!=null?n:"");return yield s.json()})}function reverse(r){return __async$3(this,arguments,function*(e,t={}){var n;if(!Array.isArray(e)||e.length<2)throw new Error("The position must be an array of form [lng, lat].");const o=new URL(`geocoding/${e[0]},${e[1]}.json`,defaults$1.maptilerApiURL);addCommonForwardAndReverseGeocodingOptions(o.searchParams,t);const a=o.toString(),l=yield callFetch(a);if(!l.ok)throw new ServiceError(l,(n=customMessages$3[l.status])!=null?n:"");return yield l.json()})}function byId(r){return __async$3(this,arguments,function*(e,t={}){var n;const o=new URL(`geocoding/${e}.json`,defaults$1.maptilerApiURL);addLanguageGeocodingOptions(o.searchParams,t);const a=o.toString(),l=yield callFetch(a);if(!l.ok)throw new ServiceError(l,(n=customMessages$3[l.status])!=null?n:"");return yield l.json()})}function batch(r){return __async$3(this,arguments,function*(e,t={}){var n;if(!e.length)return[];const o=e.map(D=>encodeURIComponent(D)).join(";"),a=new URL(`geocoding/${o}.json`,defaults$1.maptilerApiURL),{searchParams:l}=a;addForwardGeocodingOptions(l,t);const s=a.toString(),m=yield callFetch(s);if(!m.ok)throw new ServiceError(m,(n=customMessages$3[m.status])!=null?n:"");const y=yield m.json();return e.length===1?[y]:y})}const geocoding={forward,reverse,byId,batch,language:LanguageGeocoding};var __async$2=(r,e,t)=>new Promise((n,o)=>{var a=m=>{try{s(t.next(m))}catch(y){o(y)}},l=m=>{try{s(t.throw(m))}catch(y){o(y)}},s=m=>m.done?n(m.value):Promise.resolve(m.value).then(a,l);s((t=t.apply(r,e)).next())});const customMessages$2={403:"Key is missing, invalid or restricted"};function info(){return __async$2(this,arguments,function*(r={}){var e;const t=new URL("geolocation/ip.json",defaults$1.maptilerApiURL);t.searchParams.set("key",(e=r.apiKey)!=null?e:config$1.apiKey);const n=t.toString(),o=yield callFetch(n);if(!o.ok)throw new ServiceError(o,o.status in customMessages$2?customMessages$2[o.status]:"");return yield o.json()})}const geolocation={info};var __async$1=(r,e,t)=>new Promise((n,o)=>{var a=m=>{try{s(t.next(m))}catch(y){o(y)}},l=m=>{try{s(t.throw(m))}catch(y){o(y)}},s=m=>m.done?n(m.value):Promise.resolve(m.value).then(a,l);s((t=t.apply(r,e)).next())});const customMessages$1={403:"Key is missing, invalid or restricted"};function search(r){return __async$1(this,arguments,function*(e,t={}){var n;if(typeof e!="string"||e.trim().length===0)throw new Error("The query must be a non-empty string");const o=new URL(`coordinates/search/${e}.json`,defaults$1.maptilerApiURL);o.searchParams.set("key",(n=t.apiKey)!=null?n:config$1.apiKey),"limit"in t&&o.searchParams.set("limit",t.limit.toString()),"transformations"in t&&o.searchParams.set("transformations",t.transformations.toString()),"exports"in t&&o.searchParams.set("exports",t.exports.toString());const a=o.toString(),l=yield callFetch(a);if(!l.ok)throw new ServiceError(l,l.status in customMessages$1?customMessages$1[l.status]:"");return yield l.json()})}function transform(r){return __async$1(this,arguments,function*(e,t={}){var n;const o=(Array.isArray(e[0])?e:[e]).map(y=>`${y[0]},${y[1]}`).join(";"),a=new URL(`coordinates/transform/${o}.json`,defaults$1.maptilerApiURL);a.searchParams.set("key",(n=t.apiKey)!=null?n:config$1.apiKey),"sourceCrs"in t&&a.searchParams.set("s_srs",t.sourceCrs.toString()),"targetCrs"in t&&a.searchParams.set("t_srs",t.targetCrs.toString()),"operations"in t&&a.searchParams.set("ops",(Array.isArray(t.operations)?t.operations:[t.operations]).join("|"));const l=a.toString(),s=yield callFetch(l);if(!s.ok)throw new ServiceError(s,s.status in customMessages$1?customMessages$1[s.status]:"");return yield s.json()})}const coordinates={search,transform};var __async$5=(r,e,t)=>new Promise((n,o)=>{var a=m=>{try{s(t.next(m))}catch(y){o(y)}},l=m=>{try{s(t.throw(m))}catch(y){o(y)}},s=m=>m.done?n(m.value):Promise.resolve(m.value).then(a,l);s((t=t.apply(r,e)).next())});const customMessages={403:"Key is missing, invalid or restricted"};function get$2(r){return __async$5(this,arguments,function*(e,t={}){var n;if(typeof e!="string"||e.trim().length===0)throw new Error("The data ID must be a non-empty string");const o=new URL(`data/${encodeURIComponent(e)}/features.json`,defaults$1.maptilerApiURL);o.searchParams.set("key",(n=t.apiKey)!=null?n:config$1.apiKey);const a=o.toString(),l=yield callFetch(a);if(!l.ok)throw new ServiceError(l,l.status in customMessages?customMessages[l.status]:"");return yield l.json()})}const data={get:get$2};function expandMapStyle(r){const e=/^maptiler:\/\/(.*)/;let t;const n=r.trim();let o;return n.startsWith("http://")||n.startsWith("https://")?o=n:(t=e.exec(n))!==null?o=`https://api.maptiler.com/maps/${t[1]}/style.json`:o=`https://api.maptiler.com/maps/${n}/style.json`,o}class MapStyleVariant{constructor(e,t,n,o,a,l){this.name=e,this.variantType=t,this.id=n,this.referenceStyle=o,this.description=a,this.imageURL=l}getName(){return this.name}getFullName(){return`${this.referenceStyle.getName()} ${this.name}`}getType(){return this.variantType}getId(){return this.id}getDescription(){return this.description}getReferenceStyle(){return this.referenceStyle}hasVariant(e){return this.referenceStyle.hasVariant(e)}getVariant(e){return this.referenceStyle.getVariant(e)}getVariants(){return this.referenceStyle.getVariants().filter(e=>e!==this)}getImageURL(){return this.imageURL}getExpandedStyleURL(){return expandMapStyle(this.getId())}}class ReferenceMapStyle{constructor(e,t){this.name=e,this.id=t,this.variants={},this.orderedVariants=[]}getName(){return this.name}getId(){return this.id}addVariant(e){this.variants[e.getType()]=e,this.orderedVariants.push(e)}hasVariant(e){return e in this.variants}getVariant(e){return e in this.variants?this.variants[e]:this.orderedVariants[0]}getVariants(){return Object.values(this.variants)}getDefaultVariant(){return this.orderedVariants[0]}}const mapStylePresetList=[{referenceStyleID:"STREETS",name:"Streets",description:"",variants:[{id:"streets-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"streets-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"streets-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"streets-v2-night",name:"Night",variantType:"NIGHT",description:"",imageURL:""},{id:"streets-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OUTDOOR",name:"Outdoor",description:"",variants:[{id:"outdoor-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"outdoor-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"WINTER",name:"Winter",description:"",variants:[{id:"winter-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"winter-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"SATELLITE",name:"Satellite",description:"",variants:[{id:"satellite",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"HYBRID",name:"Hybrid",description:"",variants:[{id:"hybrid",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"BASIC",name:"Basic",description:"",variants:[{id:"basic-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"basic-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"basic-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BRIGHT",name:"Bright",description:"",variants:[{id:"bright-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"bright-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"bright-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"bright-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OPENSTREETMAP",name:"OpenStreetMap",description:"",variants:[{id:"openstreetmap",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"TOPO",name:"Topo",description:"",variants:[{id:"topo-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"topo-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"topo-v2-shiny",name:"Shiny",variantType:"SHINY",description:"",imageURL:""},{id:"topo-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""},{id:"topo-v2-topographique",name:"Topographique",variantType:"TOPOGRAPHIQUE",description:"",imageURL:""}]},{referenceStyleID:"VOYAGER",name:"Voyager",description:"",variants:[{id:"voyager-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"voyager-v2-darkmatter",name:"Darkmatter",variantType:"DARK",description:"",imageURL:""},{id:"voyager-v2-positron",name:"Positron",variantType:"LIGHT",description:"",imageURL:""},{id:"voyager-v2-vintage",name:"Vintage",variantType:"VINTAGE",description:"",imageURL:""}]},{referenceStyleID:"TONER",name:"Toner",description:"",variants:[{id:"toner-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"toner-v2-background",name:"Background",variantType:"BACKGROUND",description:"",imageURL:""},{id:"toner-v2-lite",name:"Lite",variantType:"LITE",description:"",imageURL:""},{id:"toner-v2-lines",name:"Lines",variantType:"LINES",description:"",imageURL:""}]},{referenceStyleID:"DATAVIZ",name:"Dataviz",description:"",variants:[{id:"dataviz",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"dataviz-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"dataviz-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BACKDROP",name:"Backdrop",description:"",variants:[{id:"backdrop",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"backdrop-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"backdrop-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"OCEAN",name:"Ocean",description:"",variants:[{id:"ocean",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]}];function makeReferenceStyleProxy(r){return new Proxy(r,{get(e,t,n){return e.hasVariant(t)?e.getVariant(t):t.toString().toUpperCase()===t?r.getDefaultVariant():Reflect.get(e,t,n)}})}function buildMapStyles(){const r={};for(let e=0;e<mapStylePresetList.length;e+=1){const t=mapStylePresetList[e],n=makeReferenceStyleProxy(new ReferenceMapStyle(t.name,t.referenceStyleID));for(let o=0;o<t.variants.length;o+=1){const a=t.variants[o],l=new MapStyleVariant(a.name,a.variantType,a.id,n,a.description,a.imageURL);n.addVariant(l)}r[t.referenceStyleID]=n}return r}function styleToStyle$1(r){if(!r)return MapStyle[mapStylePresetList[0].referenceStyleID].getDefaultVariant().getId();if(typeof r=="string"||r instanceof String)return r.trim().toLowerCase();if(r instanceof MapStyleVariant)return r.getId();if(r instanceof ReferenceMapStyle)return r.getDefaultVariant().getId()}const MapStyle=buildMapStyles();function getSqSegDist(r,e,t){let n=e[0],o=e[1],a=t[0]-n,l=t[1]-o;if(a!==0||l!==0){const s=((r[0]-n)*a+(r[1]-o)*l)/(a*a+l*l);s>1?(n=t[0],o=t[1]):s>0&&(n+=a*s,o+=l*s)}return a=r[0]-n,l=r[1]-o,a*a+l*l}function simplifyDPStep(r,e,t,n,o){let a=n,l;for(let s=e+1;s<t;s++){const m=getSqSegDist(r[s],r[e],r[t]);m>a&&(l=s,a=m)}a>n&&(l-e>1&&simplifyDPStep(r,e,l,n,o),o.push(r[l]),t-l>1&&simplifyDPStep(r,l,t,n,o))}function simplifyDouglasPeucker(r,e){const t=r.length-1,n=[r[0]];return simplifyDPStep(r,0,t,e,n),n.push(r[t]),n}function simplify(r,e){if(r.length<=2)return r;const t=e!==void 0?e*e:1;return simplifyDouglasPeucker(r,t)}function staticMapMarkerToString(r,e=!0){let t=`${r[0]},${r[1]}`;return r.length===3&&e&&(t+=`,${r[2]}`),t}function simplifyAndStringify(r,e=3e3){let t=r.map(a=>a.join(",")).join("|"),n=5e-6;const o=1e-5;for(;t.length>e;)t=simplify(r,n).map(l=>`${l[0]},${l[1]}`).join("|"),n+=o;return t}function centered(r,e,t={}){var n,o,a,l,s;const m=styleToStyle$1(t.style),y=t.hiDPI?"@2x":"",D=(n=t.format)!=null?n:"png";let W=~~((o=t.width)!=null?o:1024),Ee=~~((a=t.height)!=null?a:1024);t.hiDPI&&(W=~~(W/2),Ee=~~(Ee/2));const dt=new URL(`maps/${encodeURIComponent(m)}/static/${r[0]},${r[1]},${e}/${W}x${Ee}${y}.${D}`,defaults$1.maptilerApiURL);if("attribution"in t&&dt.searchParams.set("attribution",t.attribution.toString()),"markers"in t){let Ht="";const ir="markerIcon"in t;ir&&(Ht+=`icon:${t.markerIcon}|`),ir&&"markerAnchor"in t&&(Ht+=`anchor:${t.markerAnchor}|`),ir&&t.hiDPI&&(Ht+="scale:2|");const Hr=Array.isArray(t.markers[0])?t.markers:[t.markers];Ht+=Hr.map(Bn=>staticMapMarkerToString(Bn,!ir)).join("|"),dt.searchParams.set("markers",Ht)}if("path"in t){let Ht="";if(Ht+=`fill:${(l=t.pathFillColor)!=null?l:"none"}|`,"pathStrokeColor"in t&&(Ht+=`stroke:${t.pathStrokeColor}|`),"pathWidth"in t){const ir=t.pathWidth/(t.hiDPI?2:1);Ht+=`width:${ir.toString()}|`}Ht+=simplifyAndStringify(t.path),dt.searchParams.set("path",Ht)}return dt.searchParams.set("key",(s=t.apiKey)!=null?s:config$1.apiKey),dt.toString()}function bounded(r,e={}){var t,n,o,a,l;const s=styleToStyle$1(e.style),m=e.hiDPI?"@2x":"",y=(t=e.format)!=null?t:"png";let D=~~((n=e.width)!=null?n:1024),W=~~((o=e.height)!=null?o:1024);e.hiDPI&&(D=~~(D/2),W=~~(W/2));const Ee=new URL(`maps/${encodeURIComponent(s)}/static/${r[0]},${r[1]},${r[2]},${r[3]}/${D}x${W}${m}.${y}`,defaults$1.maptilerApiURL);if("attribution"in e&&Ee.searchParams.set("attribution",e.attribution.toString()),"padding"in e&&Ee.searchParams.set("padding",e.padding.toString()),"markers"in e){let dt="";const Ht="markerIcon"in e;Ht&&(dt+=`icon:${e.markerIcon}|`),Ht&&"markerAnchor"in e&&(dt+=`anchor:${e.markerAnchor}|`),Ht&&e.hiDPI&&(dt+="scale:2|");const ir=Array.isArray(e.markers[0])?e.markers:[e.markers];dt+=ir.map(Hr=>staticMapMarkerToString(Hr,!Ht)).join("|"),Ee.searchParams.set("markers",dt)}if("path"in e){let dt="";if(dt+=`fill:${(a=e.pathFillColor)!=null?a:"none"}|`,"pathStrokeColor"in e&&(dt+=`stroke:${e.pathStrokeColor}|`),"pathWidth"in e){const Ht=e.pathWidth/(e.hiDPI?2:1);dt+=`width:${Ht.toString()}|`}dt+=simplifyAndStringify(e.path),Ee.searchParams.set("path",dt)}return Ee.searchParams.set("key",(l=e.apiKey)!=null?l:config$1.apiKey),Ee.toString()}function automatic(r={}){var e,t,n,o,a;if(!("markers"in r)&&!("path"in r))throw new Error("Automatic static maps require markers and/or path to be created.");const l=styleToStyle$1(r.style),s=r.hiDPI?"@2x":"",m=(e=r.format)!=null?e:"png";let y=~~((t=r.width)!=null?t:1024),D=~~((n=r.height)!=null?n:1024);r.hiDPI&&(y=~~(y/2),D=~~(D/2));const W=new URL(`maps/${encodeURIComponent(l)}/static/auto/${y}x${D}${s}.${m}`,defaults$1.maptilerApiURL);if("attribution"in r&&W.searchParams.set("attribution",r.attribution.toString()),"padding"in r&&W.searchParams.set("padding",r.padding.toString()),"markers"in r){let Ee="";const dt="markerIcon"in r;dt&&(Ee+=`icon:${r.markerIcon}|`),dt&&"markerAnchor"in r&&(Ee+=`anchor:${r.markerAnchor}|`),dt&&r.hiDPI&&(Ee+="scale:2|");const Ht=Array.isArray(r.markers[0])?r.markers:[r.markers];Ee+=Ht.map(ir=>staticMapMarkerToString(ir,!dt)).join("|"),W.searchParams.set("markers",Ee)}if("path"in r){let Ee="";if(Ee+=`fill:${(o=r.pathFillColor)!=null?o:"none"}|`,"pathStrokeColor"in r&&(Ee+=`stroke:${r.pathStrokeColor}|`),"pathWidth"in r){const dt=r.pathWidth/(r.hiDPI?2:1);Ee+=`width:${dt.toString()}|`}Ee+=simplifyAndStringify(r.path),W.searchParams.set("path",Ee)}return W.searchParams.set("key",(a=r.apiKey)!=null?a:config$1.apiKey),W.toString()}const staticMaps={centered,bounded,automatic};let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let r=0;r<256;++r)byteToHex.push((r+256).toString(16).slice(1));function unsafeStringify(r,e=0){return(byteToHex[r[e+0]]+byteToHex[r[e+1]]+byteToHex[r[e+2]]+byteToHex[r[e+3]]+"-"+byteToHex[r[e+4]]+byteToHex[r[e+5]]+"-"+byteToHex[r[e+6]]+byteToHex[r[e+7]]+"-"+byteToHex[r[e+8]]+byteToHex[r[e+9]]+"-"+byteToHex[r[e+10]]+byteToHex[r[e+11]]+byteToHex[r[e+12]]+byteToHex[r[e+13]]+byteToHex[r[e+14]]+byteToHex[r[e+15]]).toLowerCase()}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID};function v4(r,e,t){if(native.randomUUID&&!e&&!r)return native.randomUUID();r=r||{};const n=r.random||(r.rng||rng)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(let o=0;o<16;++o)e[t+o]=n[o];return e}return unsafeStringify(n)}const Language={AUTO:"auto",STYLE_LOCK:"style_lock",LATIN:"latin",NON_LATIN:"nonlatin",LOCAL:"",ALBANIAN:"sq",AMHARIC:"am",ARABIC:"ar",ARMENIAN:"hy",AZERBAIJANI:"az",BASQUE:"eu",BELORUSSIAN:"be",BOSNIAN:"bs",BRETON:"br",BULGARIAN:"bg",CATALAN:"ca",CHINESE:"zh",CORSICAN:"co",CROATIAN:"hr",CZECH:"cs",DANISH:"da",DUTCH:"nl",ENGLISH:"en",ESPERANTO:"eo",ESTONIAN:"et",FINNISH:"fi",FRENCH:"fr",FRISIAN:"fy",GEORGIAN:"ka",GERMAN:"de",GREEK:"el",HEBREW:"he",HINDI:"hi",HUNGARIAN:"hu",ICELANDIC:"is",INDONESIAN:"id",IRISH:"ga",ITALIAN:"it",JAPANESE:"ja",JAPANESE_HIRAGANA:"ja-Hira",JAPANESE_KANA:"ja_kana",JAPANESE_LATIN:"ja_rm",JAPANESE_2018:"ja-Latn",KANNADA:"kn",KAZAKH:"kk",KOREAN:"ko",KOREAN_LATIN:"ko-Latn",KURDISH:"ku",ROMAN_LATIN:"la",LATVIAN:"lv",LITHUANIAN:"lt",LUXEMBOURGISH:"lb",MACEDONIAN:"mk",MALAYALAM:"ml",MALTESE:"mt",NORWEGIAN:"no",OCCITAN:"oc",POLISH:"pl",PORTUGUESE:"pt",ROMANIAN:"ro",ROMANSH:"rm",RUSSIAN:"ru",SCOTTISH_GAELIC:"gd",SERBIAN_CYRILLIC:"sr",SERBIAN_LATIN:"sr-Latn",SLOVAK:"sk",SLOVENE:"sl",SPANISH:"es",SWEDISH:"sv",TAMIL:"ta",TELUGU:"te",THAI:"th",TURKISH:"tr",UKRAINIAN:"uk",WELSH:"cy"},languagesIsoSet=new Set(Object.values(Language));function isLanguageSupported(r){return languagesIsoSet.has(r)}const languageCodeSet=new Set(Object.values(Language));function getBrowserLanguage(){if(typeof navigator>"u")return Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];const r=Array.from(new Set(navigator.languages.map(e=>e.split("-")[0]))).filter(e=>languageCodeSet.has(e));return r.length?r[0]:Language.LATIN}const MAPTILER_SESSION_ID=v4();class SdkConfig extends EventEmitter$3{constructor(){super(),this.primaryLanguage=Language.AUTO,this.secondaryLanguage=null,this.session=!0,this._unit="metric",this._apiKey=""}set unit(e){this._unit=e,this.emit("unit",e)}get unit(){return this._unit}set apiKey(e){this._apiKey=e,config$1.apiKey=e,this.emit("apiKey",e)}get apiKey(){return this._apiKey}set fetch(e){config$1.fetch=e}get fetch(){return config$1.fetch}}const config=new SdkConfig,defaults={maptilerLogoURL:"https://api.maptiler.com/resources/logo.svg",maptilerURL:"https://www.maptiler.com/",maptilerApiHost:"api.maptiler.com",rtlPluginURL:"https://cdn.maptiler.com/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.min.js",primaryLanguage:Language.AUTO,secondaryLanguage:Language.LOCAL,terrainSourceURL:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json",terrainSourceId:"maptiler-terrain"};Object.freeze(defaults);class LogoControl extends maplibregl__default.LogoControl{onAdd(e){return super.onAdd(e)}}class MaptilerLogoControl extends LogoControl{constructor(e={}){var t,n;super(e),this.logoURL="",this.linkURL="",this.logoURL=(t=e.logoURL)!=null?t:defaults.maptilerLogoURL,this.linkURL=(n=e.linkURL)!=null?n:defaults.maptilerURL}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=window.document.createElement("div"),this._container.className="maplibregl-ctrl";const t=window.document.createElement("a");return t.style.backgroundRepeat="no-repeat",t.style.cursor="pointer",t.style.display="block",t.style.height="23px",t.style.margin="0 0 -4px -4px",t.style.overflow="hidden",t.style.width="88px",t.style.backgroundImage=`url(${this.logoURL})`,t.style.backgroundSize="100px 30px",t.style.width="100px",t.style.height="30px",t.target="_blank",t.rel="noopener",t.href=this.linkURL,t.setAttribute("aria-label","MapTiler logo"),t.setAttribute("rel","noopener"),this._container.appendChild(t),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}}var __defProp$2=Object.defineProperty,__getOwnPropSymbols$2=Object.getOwnPropertySymbols,__hasOwnProp$2=Object.prototype.hasOwnProperty,__propIsEnum$2=Object.prototype.propertyIsEnumerable,__defNormalProp$2=(r,e,t)=>e in r?__defProp$2(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,__spreadValues$2=(r,e)=>{for(var t in e||(e={}))__hasOwnProp$2.call(e,t)&&__defNormalProp$2(r,t,e[t]);if(__getOwnPropSymbols$2)for(var t of __getOwnPropSymbols$2(e))__propIsEnum$2.call(e,t)&&__defNormalProp$2(r,t,e[t]);return r};function enableRTL(){maplibregl__default.getRTLTextPluginStatus()==="unavailable"&&maplibregl__default.setRTLTextPlugin(defaults.rtlPluginURL,null,!0)}function bindAll(r,e){r.forEach(t=>{e[t]&&(e[t]=e[t].bind(e))})}function DOMcreate(r,e,t){const n=window.document.createElement(r);return e!==void 0&&(n.className=e),t&&t.appendChild(n),n}function DOMremove(r){r.parentNode&&r.parentNode.removeChild(r)}function maptilerCloudTransformRequest(r,e){let t=null;try{t=new URL(r)}catch{return{url:r}}return t.host===defaults.maptilerApiHost&&(t.searchParams.has("key")||t.searchParams.append("key",config.apiKey),config.session&&t.searchParams.append("mtsid",MAPTILER_SESSION_ID)),{url:t.href}}function combineTransformRequest(r=null){return function(e,t){if(r){const n=r(e,t),o=maptilerCloudTransformRequest(n.url);return __spreadValues$2(__spreadValues$2({},n),o)}else return maptilerCloudTransformRequest(e)}}function styleToStyle(r){return r?typeof r=="string"||r instanceof String?!r.startsWith("http")&&r.toLowerCase().includes(".json")?r:expandMapStyle(r):r instanceof MapStyleVariant?r.getExpandedStyleURL():r instanceof ReferenceMapStyle?r.getDefaultVariant().getExpandedStyleURL():r:MapStyle[mapStylePresetList[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL()}class MaptilerTerrainControl{constructor(){bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(e){return this._map=e,this._container=DOMcreate("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=DOMcreate("button","maplibregl-ctrl-terrain",this._container),DOMcreate("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){DOMremove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.hasTerrain()?this._map.disableTerrain():this._map.enableTerrain(),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.hasTerrain()?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}}class NavigationControl extends maplibregl__default.NavigationControl{onAdd(e){return super.onAdd(e)}}class MaptilerNavigationControl extends NavigationControl{constructor(){super({showCompass:!0,showZoom:!0,visualizePitch:!0}),this._compass.removeEventListener("click",this._compass.clickFunction),this._compass.addEventListener("click",e=>{this._map.getPitch()===0?this._map.easeTo({pitch:Math.min(this._map.getMaxPitch(),80)}):this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})}_createButton(e,t){const n=super._createButton(e,t);return n.clickFunction=t,n}_rotateCompassArrow(){const e=this.options.visualizePitch?`scale(${Math.min(1.5,1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5))}) rotateX(${Math.min(70,this._map.transform.pitch)}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e}}class GeolocateControl extends maplibregl__default.GeolocateControl{onAdd(e){return super.onAdd(e)}}var __defProp$1=Object.defineProperty,__defProps$1=Object.defineProperties,__getOwnPropDescs$1=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1=Object.getOwnPropertySymbols,__hasOwnProp$1=Object.prototype.hasOwnProperty,__propIsEnum$1=Object.prototype.propertyIsEnumerable,__defNormalProp$1=(r,e,t)=>e in r?__defProp$1(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,__spreadValues$1=(r,e)=>{for(var t in e||(e={}))__hasOwnProp$1.call(e,t)&&__defNormalProp$1(r,t,e[t]);if(__getOwnPropSymbols$1)for(var t of __getOwnPropSymbols$1(e))__propIsEnum$1.call(e,t)&&__defNormalProp$1(r,t,e[t]);return r},__spreadProps$1=(r,e)=>__defProps$1(r,__getOwnPropDescs$1(e));const Marker$1=maplibregl__default.Marker,LngLat$1=maplibregl__default.LngLat,LngLatBounds$1=maplibregl__default.LngLatBounds;class MaptilerGeolocateControl extends GeolocateControl{constructor(){super(...arguments),this.lastUpdatedCenter=new LngLat$1(0,0)}_updateCamera(e){const t=new LngLat$1(e.coords.longitude,e.coords.latitude),n=e.coords.accuracy,o=this._map.getBearing(),a=__spreadProps$1(__spreadValues$1({bearing:o},this.options.fitBoundsOptions),{linear:!0}),l=this._map.getZoom();l>this.options.fitBoundsOptions.maxZoom&&(a.zoom=l),this._map.fitBounds(LngLatBounds$1.fromLngLat(t,n),a,{geolocateSource:!0});let s=!1;const m=()=>{s=!0};this._map.once("click",m),this._map.once("dblclick",m),this._map.once("dragstart",m),this._map.once("mousedown",m),this._map.once("touchstart",m),this._map.once("wheel",m),this._map.once("moveend",()=>{this._map.off("click",m),this._map.off("dblclick",m),this._map.off("dragstart",m),this._map.off("mousedown",m),this._map.off("touchstart",m),this._map.off("wheel",m),!s&&(this.lastUpdatedCenter=this._map.getCenter())})}_setupUI(e){if(this.lastUpdatedCenter=this._map.getCenter(),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=DOMcreate("button","maplibregl-ctrl-geolocate",this._container),DOMcreate("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",e===!1){const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=DOMcreate("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Marker$1(this._dotElement),this._circleElement=DOMcreate("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Marker$1({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("move",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("moveend",t=>{const n=t.originalEvent&&t.originalEvent.type==="resize",o=this.lastUpdatedCenter.distanceTo(this._map.getCenter());!t.geolocateSource&&this._watchState==="ACTIVE_LOCK"&&!n&&o>1&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Event("trackuserlocationend")))})}_updateCircleRadius(){if(this._watchState!=="BACKGROUND"&&this._watchState!=="ACTIVE_LOCK")return;const e=[this._lastKnownPosition.coords.longitude,this._lastKnownPosition.coords.latitude],t=this._map.project(e),n=this._map.unproject([t.x,t.y]),o=this._map.unproject([t.x+20,t.y]),a=n.distanceTo(o)/20,l=Math.ceil(2*this._accuracy/a);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}}class AttributionControl extends maplibregl__default.AttributionControl{onAdd(e){return super.onAdd(e)}}class ScaleControl extends maplibregl__default.ScaleControl{onAdd(e){return super.onAdd(e)}}class FullscreenControl extends maplibregl__default.FullscreenControl{onAdd(e){return super.onAdd(e)}}var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(r,e,t)=>e in r?__defProp(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,__spreadValues=(r,e)=>{for(var t in e||(e={}))__hasOwnProp.call(e,t)&&__defNormalProp(r,t,e[t]);if(__getOwnPropSymbols)for(var t of __getOwnPropSymbols(e))__propIsEnum.call(e,t)&&__defNormalProp(r,t,e[t]);return r},__spreadProps=(r,e)=>__defProps(r,__getOwnPropDescs(e)),__async=(r,e,t)=>new Promise((n,o)=>{var a=m=>{try{s(t.next(m))}catch(y){o(y)}},l=m=>{try{s(t.throw(m))}catch(y){o(y)}},s=m=>m.done?n(m.value):Promise.resolve(m.value).then(a,l);s((t=t.apply(r,e)).next())});const GeolocationType={POINT:"POINT",COUNTRY:"COUNTRY"};let Map$1=class extends maplibregl__default.Map{constructor(e){var t,n,o;e.apiKey&&(config.apiKey=e.apiKey);const a=styleToStyle(e.style),l=location.hash;config.apiKey||console.warn("MapTiler Cloud API key is not set. Visit https://maptiler.com and try Cloud for free!"),super(__spreadProps(__spreadValues({},e),{style:a,maplibreLogo:!1,transformRequest:combineTransformRequest(e.transformRequest)})),this.isTerrainEnabled=!1,this.terrainExaggeration=1,this.primaryLanguage=null,this.secondaryLanguage=null,this.terrainGrowing=!1,this.terrainFlattening=!1,this.primaryLanguage=(t=e.language)!=null?t:config.primaryLanguage,this.secondaryLanguage=config.secondaryLanguage,this.terrainExaggeration=(n=e.terrainExaggeration)!=null?n:this.terrainExaggeration,this.once("styledata",()=>__async(this,null,function*(){if(!e.geolocate||e.center||e.hash&&l)return;try{if(e.geolocate===GeolocationType.COUNTRY){yield this.fitToIpBounds();return}}catch(dt){console.warn(dt.message)}let W=null;try{yield this.centerOnIpPoint(e.zoom),W=this.getCameraHash()}catch(dt){console.warn(dt.message)}(yield navigator.permissions.query({name:"geolocation"})).state==="granted"&&navigator.geolocation.getCurrentPosition(dt=>{W===this.getCameraHash()&&(this.terrain?this.easeTo({center:[dt.coords.longitude,dt.coords.latitude],zoom:e.zoom||12,duration:2e3}):this.once("terrain",()=>{this.easeTo({center:[dt.coords.longitude,dt.coords.latitude],zoom:e.zoom||12,duration:2e3})}))},null,{maximumAge:24*3600*1e3,timeout:5e3,enableHighAccuracy:!1})})),this.on("styledata",()=>{this.setPrimaryLanguage(this.primaryLanguage),this.setSecondaryLanguage(this.secondaryLanguage)}),this.on("styledata",()=>{this.getTerrain()===null&&this.isTerrainEnabled&&this.enableTerrain(this.terrainExaggeration)}),this.once("load",()=>__async(this,null,function*(){enableRTL()})),this.once("load",()=>__async(this,null,function*(){let W={logo:null};try{const Ee=Object.keys(this.style.sourceCaches).map(ir=>this.getSource(ir)).filter(ir=>typeof ir.url=="string"&&ir.url.includes("tiles.json")),dt=new URL(Ee[0].url);dt.searchParams.has("key")||dt.searchParams.append("key",config.apiKey),W=yield(yield fetch(dt.href)).json()}catch{}if("logo"in W&&W.logo){const Ee=W.logo;this.addControl(new MaptilerLogoControl({logoURL:Ee}),e.logoPosition),e.attributionControl===!1&&this.addControl(new AttributionControl({customAttribution:e.customAttribution}))}else e.maptilerLogo&&this.addControl(new MaptilerLogoControl,e.logoPosition);if(e.scaleControl){const Ee=e.scaleControl===!0||e.scaleControl===void 0?"bottom-right":e.scaleControl,dt=new ScaleControl({unit:config.unit});this.addControl(dt,Ee),config.on("unit",Ht=>{dt.setUnit(Ht)})}if(e.navigationControl!==!1){const Ee=e.navigationControl===!0||e.navigationControl===void 0?"top-right":e.navigationControl;this.addControl(new MaptilerNavigationControl,Ee)}if(e.geolocateControl!==!1){const Ee=e.geolocateControl===!0||e.geolocateControl===void 0?"top-right":e.geolocateControl;this.addControl(new MaptilerGeolocateControl({positionOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!0,showAccuracyCircle:!0,showUserLocation:!0}),Ee)}if(e.terrainControl){const Ee=e.terrainControl===!0||e.terrainControl===void 0?"top-right":e.terrainControl;this.addControl(new MaptilerTerrainControl,Ee)}if(e.fullscreenControl){const Ee=e.fullscreenControl===!0||e.fullscreenControl===void 0?"top-right":e.fullscreenControl;this.addControl(new FullscreenControl({}),Ee)}}));let s=!1,m=!1,y=null;this.once("load",W=>{s=!0,m&&this.fire("loadWithTerrain",y)});const D=W=>{W.terrain&&(m=!0,y={type:"loadWithTerrain",target:this,terrain:W.terrain},this.off("terrain",D),s&&this.fire("loadWithTerrain",y))};this.on("terrain",D),e.terrain&&this.enableTerrain((o=e.terrainExaggeration)!=null?o:this.terrainExaggeration)}onLoadAsync(){return __async(this,null,function*(){return new Promise((e,t)=>{if(this.loaded())return e(this);this.once("load",n=>{e(this)})})})}onLoadWithTerrainAsync(){return __async(this,null,function*(){return new Promise((e,t)=>{if(this.loaded()&&this.terrain)return e(this);this.once("loadWithTerrain",n=>{e(this)})})})}setStyle(e,t){return super.setStyle(styleToStyle(e),t)}setLanguage(e=defaults.primaryLanguage){if(e===Language.AUTO)return this.setLanguage(getBrowserLanguage());this.setPrimaryLanguage(e)}setPrimaryLanguage(e=defaults.primaryLanguage){if(this.primaryLanguage===Language.STYLE_LOCK){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}isLanguageSupported(e)&&(this.primaryLanguage=e,this.onStyleReady(()=>{if(e===Language.AUTO)return this.setPrimaryLanguage(getBrowserLanguage());const t=this.getStyle().layers,n=/^\s*{\s*name\s*(:\s*(\S*))?\s*}$/,o=/^\s*name\s*(:\s*(\S*))?\s*$/,a=/^\s*{\s*name\s*(:\s*(\S*))?\s*}(\s*){\s*name\s*(:\s*(\S*))?\s*}$/,l=/^(.*)({\s*name\s*(:\s*(\S*))?\s*})(.*)$/,s=e?`name:${e}`:"name",m=["case",["has",s],["get",s],["get","name"]];for(let y=0;y<t.length;y+=1){const D=t[y],W=D.layout;if(!W||!W["text-field"])continue;const Ee=this.getLayoutProperty(D.id,"text-field");let dt;if(Array.isArray(Ee)&&Ee.length>=2&&Ee[0].trim().toLowerCase()==="concat"){const Ht=Ee.slice();for(let ir=0;ir<Ee.length;ir+=1){const Hr=Ee[ir];if((typeof Hr=="string"||Hr instanceof String)&&n.exec(Hr.toString())){Ht[ir]=m;break}else if(Array.isArray(Hr)&&Hr.length>=2&&Hr[0].trim().toLowerCase()==="get"&&o.exec(Hr[1].toString())){Ht[ir]=m;break}else if(Array.isArray(Hr)&&Hr.length===4&&Hr[0].trim().toLowerCase()==="case"){Ht[ir]=m;break}}this.setLayoutProperty(D.id,"text-field",Ht)}else if(Array.isArray(Ee)&&Ee.length>=2&&Ee[0].trim().toLowerCase()==="get"&&o.exec(Ee[1].toString())){const Ht=m;this.setLayoutProperty(D.id,"text-field",Ht)}else if((typeof Ee=="string"||Ee instanceof String)&&n.exec(Ee.toString())){const Ht=m;this.setLayoutProperty(D.id,"text-field",Ht)}else if(Array.isArray(Ee)&&Ee.length===4&&Ee[0].trim().toLowerCase()==="case"){const Ht=m;this.setLayoutProperty(D.id,"text-field",Ht)}else if((typeof Ee=="string"||Ee instanceof String)&&(dt=a.exec(Ee.toString()))!==null){const Ht=`{${s}}${dt[3]}{name${dt[4]||""}}`;this.setLayoutProperty(D.id,"text-field",Ht)}else if((typeof Ee=="string"||Ee instanceof String)&&(dt=l.exec(Ee.toString()))!==null){const Ht=`${dt[1]}{${s}}${dt[5]}`;this.setLayoutProperty(D.id,"text-field",Ht)}}}))}setSecondaryLanguage(e=defaults.secondaryLanguage){if(this.primaryLanguage===Language.STYLE_LOCK){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}isLanguageSupported(e)&&(this.secondaryLanguage=e,this.onStyleReady(()=>{if(e===Language.AUTO)return this.setSecondaryLanguage(getBrowserLanguage());const t=this.getStyle().layers,n=/^\s*{\s*name\s*(:\s*(\S*))?\s*}$/,o=/^\s*name\s*(:\s*(\S*))?\s*$/,a=/^\s*{\s*name\s*(:\s*(\S*))?\s*}(\s*){\s*name\s*(:\s*(\S*))?\s*}$/;let l;for(let s=0;s<t.length;s+=1){const m=t[s],y=m.layout;if(!y||!y["text-field"])continue;const D=this.getLayoutProperty(m.id,"text-field");let W;if(Array.isArray(D)&&D.length>=2&&D[0].trim().toLowerCase()==="concat"){W=D.slice();let Ee=0;for(let dt=0;dt<D.length;dt+=1){const Ht=D[dt];if((typeof Ht=="string"||Ht instanceof String)&&n.exec(Ht.toString())){if(Ee===1){W[dt]=`{name:${e}}`;break}Ee+=1}else if(Array.isArray(Ht)&&Ht.length>=2&&Ht[0].trim().toLowerCase()==="get"&&o.exec(Ht[1].toString())){if(Ee===1){W[dt][1]=`name:${e}`;break}Ee+=1}else if(Array.isArray(Ht)&&Ht.length===4&&Ht[0].trim().toLowerCase()==="case"){if(Ee===1){W[dt]=["get",`name:${e}`];break}Ee+=1}}this.setLayoutProperty(m.id,"text-field",W)}else if((typeof D=="string"||D instanceof String)&&(l=a.exec(D.toString()))!==null){const Ee=e?`name:${e}`:"name";W=`{name${l[1]||""}}${l[3]}{${Ee}}`,this.setLayoutProperty(m.id,"text-field",W)}}}))}getPrimaryLanguage(){return this.primaryLanguage}getSecondaryLanguage(){return this.secondaryLanguage}getTerrainExaggeration(){return this.terrainExaggeration}hasTerrain(){return this.isTerrainEnabled}growTerrain(e,t=1e3){if(!this.terrain)return;const n=performance.now(),o=this.terrain.exaggeration,a=e-o,l=()=>{if(!this.terrain||this.terrainFlattening)return;const s=(performance.now()-n)/t;if(s<.99){const m=1-Math.pow(1-s,4),y=o+m*a;this.terrain.exaggeration=y,requestAnimationFrame(l)}else this.terrainGrowing=!1,this.terrainFlattening=!1,this.terrain.exaggeration=e;this.triggerRepaint()};this.terrainGrowing=!0,this.terrainFlattening=!1,requestAnimationFrame(l)}enableTerrain(e=this.terrainExaggeration){if(e<0){console.warn("Terrain exaggeration cannot be negative.");return}const t=o=>__async(this,null,function*(){!this.terrain||o.type!=="data"||o.dataType!=="source"||!("source"in o)||o.sourceId!=="maptiler-terrain"||o.source.type!=="raster-dem"||o.isSourceLoaded&&(this.off("data",t),this.growTerrain(e))}),n=()=>{this.isTerrainEnabled=!0,this.terrainExaggeration=e,this.on("data",t),this.addSource(defaults.terrainSourceId,{type:"raster-dem",url:defaults.terrainSourceURL}),this.setTerrain({source:defaults.terrainSourceId,exaggeration:0})};if(this.getTerrain()){this.isTerrainEnabled=!0,this.growTerrain(e);return}this.loaded()||this.isTerrainEnabled?n():this.once("load",()=>{this.getTerrain()&&this.getSource(defaults.terrainSourceId)||n()})}disableTerrain(){if(!this.terrain)return;this.isTerrainEnabled=!1;const e=1*1e3,t=performance.now(),n=this.terrain.exaggeration,o=()=>{if(!this.terrain||this.terrainGrowing)return;const a=(performance.now()-t)/e;if(a<.99){const l=Math.pow(1-a,4),s=n*l;this.terrain.exaggeration=s,requestAnimationFrame(o)}else this.terrain.exaggeration=0,this.terrainGrowing=!1,this.terrainFlattening=!1,this.setTerrain(null),this.getSource(defaults.terrainSourceId)&&this.removeSource(defaults.terrainSourceId);this.triggerRepaint()};this.terrainGrowing=!1,this.terrainFlattening=!0,requestAnimationFrame(o)}setTerrainExaggeration(e,t=!0){!t&&this.terrain?(this.terrainExaggeration=e,this.terrain.exaggeration=e,this.triggerRepaint()):this.enableTerrain(e)}onStyleReady(e){this.isStyleLoaded()?e():this.once("styledata",()=>{e()})}fitToIpBounds(){return __async(this,null,function*(){const e=yield geolocation.info();this.fitBounds(e.country_bounds,{duration:0,padding:100})})}centerOnIpPoint(e){return __async(this,null,function*(){const t=yield geolocation.info();this.jumpTo({center:[t.longitude,t.latitude],zoom:e||11})})}getCameraHash(){const e=new Float32Array(5),t=this.getCenter();return e[0]=t.lng,e[1]=t.lat,e[2]=this.getZoom(),e[3]=this.getPitch(),e[4]=this.getBearing(),gBase64.fromUint8Array(new Uint8Array(e.buffer))}getSdkConfig(){return config}getMaptilerSessionId(){return MAPTILER_SESSION_ID}setTransformRequest(e){return super.setTransformRequest(combineTransformRequest(e)),this}};class Marker extends maplibregl__default.Marker{addTo(e){return super.addTo(e)}}class Popup extends maplibregl__default.Popup{addTo(e){return super.addTo(e)}}class Style extends maplibregl__default.Style{constructor(e,t={}){super(e,t)}}class CanvasSource extends maplibregl__default.CanvasSource{onAdd(e){super.onAdd(e)}}class GeoJSONSource extends maplibregl__default.GeoJSONSource{onAdd(e){super.onAdd(e)}}class ImageSource extends maplibregl__default.ImageSource{onAdd(e){super.onAdd(e)}}class RasterTileSource extends maplibregl__default.RasterTileSource{onAdd(e){super.onAdd(e)}}class RasterDEMTileSource extends maplibregl__default.RasterDEMTileSource{onAdd(e){super.onAdd(e)}}class VectorTileSource extends maplibregl__default.VectorTileSource{onAdd(e){super.onAdd(e)}}class VideoSource extends maplibregl__default.VideoSource{onAdd(e){super.onAdd(e)}}class TerrainControl extends maplibregl__default.TerrainControl{onAdd(e){return super.onAdd(e)}}let Point$2=class qC{constructor(e,t){this.x=e,this.y=t}_matMult(e){const t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this}_add(e){return this.x+=e.x,this.y+=e.y,this}_sub(e){return this.x-=e.x,this.y-=e.y,this}_mult(e){return this.x*=e,this.y*=e,this}_div(e){return this.x/=e,this.y/=e,this}_multByPoint(e){return this.x*=e.x,this.y*=e.y,this}_divByPoint(e){return this.x/=e.x,this.y/=e.y,this}_unit(){return this._div(this.mag()),this}_perp(){const e=this.y;return this.y=this.x,this.x=-e,this}_rotate(e){const t=Math.cos(e),n=Math.sin(e),o=t*this.x-n*this.y,a=n*this.x+t*this.y;return this.x=o,this.y=a,this}_rotateAround(e,t){const n=Math.cos(e),o=Math.sin(e),a=t.x+n*(this.x-t.x)-o*(this.y-t.y),l=t.y+o*(this.x-t.x)+n*(this.y-t.y);return this.x=a,this.y=l,this}_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}clone(){return new qC(this.x,this.y)}add(e){return this.clone()._add(e)}sub(e){return this.clone()._sub(e)}multByPoint(e){return this.clone()._multByPoint(e)}divByPoint(e){return this.clone()._divByPoint(e)}mult(e){return this.clone()._mult(e)}div(e){return this.clone()._div(e)}rotate(e){return this.clone()._rotate(e)}rotateAround(e,t){return this.clone()._rotateAround(e,t)}matMult(e){return this.clone()._matMult(e)}unit(){return this.clone()._unit()}perp(){return this.clone()._perp()}round(){return this.clone()._round()}mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}equals(e){return this.x===e.x&&this.y===e.y}dist(e){return Math.sqrt(this.distSqr(e))}distSqr(e){const t=e.x-this.x,n=e.y-this.y;return t*t+n*n}angle(){return Math.atan2(this.y,this.x)}angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)}angleWith(e){return this.angleWithSep(e.x,e.y)}angleWithSep(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)}static convert(e){return e instanceof qC?e:Array.isArray(e)?new qC(e[0],e[1]):e}};const{setRTLTextPlugin,getRTLTextPluginStatus,LngLat,LngLatBounds,MercatorCoordinate,Evented,AJAXError,prewarm,clearPrewarmedResources,version:version$1,workerCount,maxParallelImageRequests,workerUrl,addProtocol,removeProtocol}=maplibregl__default,MapMLGL=maplibregl__default.Map,MarkerMLGL=maplibregl__default.Marker,PopupMLGL=maplibregl__default.Popup,StyleMLGL=maplibregl__default.Style,CanvasSourceMLGL=maplibregl__default.CanvasSource,GeoJSONSourceMLGL=maplibregl__default.GeoJSONSource,ImageSourceMLGL=maplibregl__default.ImageSource,RasterTileSourceMLGL=maplibregl__default.RasterTileSource,RasterDEMTileSourceMLGL=maplibregl__default.RasterDEMTileSource,VectorTileSourceMLGL=maplibregl__default.VectorTileSource,VideoSourceMLGL=maplibregl__default.VideoSource;maplibregl__default.NavigationControl;maplibregl__default.GeolocateControl;maplibregl__default.AttributionControl;maplibregl__default.LogoControl;maplibregl__default.ScaleControl;maplibregl__default.FullscreenControl;maplibregl__default.TerrainControl;const Cl=_mergeNamespaces({__proto__:null,AJAXError,AttributionControl,CanvasSource,CanvasSourceMLGL,Evented,FullscreenControl,GeoJSONSource,GeoJSONSourceMLGL,GeolocateControl,GeolocationType,ImageSource,ImageSourceMLGL,Language,LanguageGeocoding,LngLat,LngLatBounds,LogoControl,Map:Map$1,MapMLGL,MapStyle,MapStyleVariant,MaptilerGeolocateControl,MaptilerLogoControl,MaptilerNavigationControl,MaptilerTerrainControl,Marker,MarkerMLGL,MercatorCoordinate,NavigationControl,Point:Point$2,Popup,PopupMLGL,RasterDEMTileSource,RasterDEMTileSourceMLGL,RasterTileSource,RasterTileSourceMLGL,ReferenceMapStyle,ScaleControl,SdkConfig,ServiceError,Style,StyleMLGL,TerrainControl,VectorTileSource,VectorTileSourceMLGL,VideoSource,VideoSourceMLGL,addProtocol,clearPrewarmedResources,config,coordinates,data,geocoding,geolocation,getRTLTextPluginStatus,maxParallelImageRequests,prewarm,removeProtocol,setRTLTextPlugin,staticMaps,version:version$1,workerCount,workerUrl},[maplibreGlExports]);var El=Object.defineProperty,Il=(r,e,t)=>e in r?El(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ys=(r,e,t)=>(Il(r,typeof e!="symbol"?e+"":e,t),t),aa=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)},zn=(r,e,t)=>(aa(r,e,"read from private field"),t?t.call(r):e.get(r)),ms=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},Lo=(r,e,t,n)=>(aa(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);function It(){}function Nl(r,e){for(const t in e)r[t]=e[t];return r}function eu(r){return r()}function ua(){return Object.create(null)}function Er(r){r.forEach(eu)}function nu(r){return typeof r=="function"}function zr(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let bo;function Me(r,e){return r===e?!0:(bo||(bo=document.createElement("a")),bo.href=e,r===bo.href)}function xl(r){return Object.keys(r).length===0}function Sl(r,e,t,n){if(r){const o=ru(r,e,t,n);return r[0](o)}}function ru(r,e,t,n){return r[1]&&n?Nl(t.ctx.slice(),r[1](n(e))):t.ctx}function wl(r,e,t,n){if(r[2]&&n){const o=r[2](n(t));if(e.dirty===void 0)return o;if(typeof o=="object"){const a=[],l=Math.max(e.dirty.length,o.length);for(let s=0;s<l;s+=1)a[s]=e.dirty[s]|o[s];return a}return e.dirty|o}return e.dirty}function Ll(r,e,t,n,o,a){if(o){const l=ru(e,t,n,a);r.p(l,o)}}function bl(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function la(r){return r??""}function nt(r,e){r.appendChild(e)}function Dt(r,e,t){r.insertBefore(e,t||null)}function Tt(r){r.parentNode&&r.parentNode.removeChild(r)}function ht(r){return document.createElement(r)}function Kn(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Pr(r){return document.createTextNode(r)}function nn(){return Pr(" ")}function Pl(){return Pr("")}function Ce(r,e,t,n){return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}function Rl(r){return function(e){return e.preventDefault(),r.call(this,e)}}function P(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function Ol(r){return Array.from(r.childNodes)}function to(r,e){e=""+e,r.data!==e&&(r.data=e)}function ca(r,e){r.value=e??""}function on(r,e,t){r.classList.toggle(e,!!t)}function Tl(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}let eo;function Ji(r){eo=r}function iu(){if(!eo)throw new Error("Function called outside component initialization");return eo}function Dl(r){iu().$$.on_destroy.push(r)}function Ml(){const r=iu();return(e,t,{cancelable:n=!1}={})=>{const o=r.$$.callbacks[e];if(o){const a=Tl(e,t,{cancelable:n});return o.slice().forEach(l=>{l.call(r,a)}),!a.defaultPrevented}return!0}}function fa(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const _i=[],xs=[];let Ii=[];const ha=[],Al=Promise.resolve();let Ss=!1;function Fl(){Ss||(Ss=!0,Al.then(ou))}function ws(r){Ii.push(r)}const _s=new Set;let mi=0;function ou(){if(mi!==0)return;const r=eo;do{try{for(;mi<_i.length;){const e=_i[mi];mi++,Ji(e),Bl(e.$$)}}catch(e){throw _i.length=0,mi=0,e}for(Ji(null),_i.length=0,mi=0;xs.length;)xs.pop()();for(let e=0;e<Ii.length;e+=1){const t=Ii[e];_s.has(t)||(_s.add(t),t())}Ii.length=0}while(_i.length);for(;ha.length;)ha.pop()();Ss=!1,_s.clear(),Ji(r)}function Bl(r){if(r.fragment!==null){r.update(),Er(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(ws)}}function kl(r){const e=[],t=[];Ii.forEach(n=>r.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Ii=e}const Mo=new Set;let jr;function Ao(){jr={r:0,c:[],p:jr}}function Fo(){jr.r||Er(jr.c),jr=jr.p}function Gt(r,e){r&&r.i&&(Mo.delete(r),r.i(e))}function le(r,e,t,n){if(r&&r.o){if(Mo.has(r))return;Mo.add(r),jr.c.push(()=>{Mo.delete(r),n&&(t&&r.d(1),n())}),r.o(e)}else n&&n()}function ga(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function Gl(r,e){le(r,1,1,()=>{e.delete(r.key)})}function Vl(r,e,t,n,o,a,l,s,m,y,D,W){let Ee=r.length,dt=a.length,Ht=Ee;const ir={};for(;Ht--;)ir[r[Ht].key]=Ht;const Hr=[],Bn=new Map,Vn=new Map,Wr=[];for(Ht=dt;Ht--;){const ml=W(o,a,Ht),sl=t(ml);let ll=l.get(sl);ll?n&&Wr.push(()=>ll.p(ml,e)):(ll=y(sl,ml),ll.c()),Bn.set(sl,Hr[Ht]=ll),sl in ir&&Vn.set(sl,Math.abs(Ht-ir[sl]))}const ps=new Set,il=new Set;function gl(ml){Gt(ml,1),ml.m(s,D),l.set(ml.key,ml),D=ml.first,dt--}for(;Ee&&dt;){const ml=Hr[dt-1],sl=r[Ee-1],ll=ml.key,rl=sl.key;ml===sl?(D=ml.first,Ee--,dt--):Bn.has(rl)?!l.has(ll)||ps.has(ll)?gl(ml):il.has(rl)?Ee--:Vn.get(ll)>Vn.get(rl)?(il.add(ll),gl(ml)):(ps.add(rl),Ee--):(m(sl,l),Ee--)}for(;Ee--;){const ml=r[Ee];Bn.has(ml.key)||m(ml,l)}for(;dt;)gl(Hr[dt-1]);return Er(Wr),Hr}function Rr(r){r&&r.c()}function lr(r,e,t){const{fragment:n,after_update:o}=r.$$;n&&n.m(e,t),ws(()=>{const a=r.$$.on_mount.map(eu).filter(nu);r.$$.on_destroy?r.$$.on_destroy.push(...a):Er(a),r.$$.on_mount=[]}),o.forEach(ws)}function cr(r,e){const t=r.$$;t.fragment!==null&&(kl(t.after_update),Er(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function zl(r,e){r.$$.dirty[0]===-1&&(_i.push(r),Fl(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Ur(r,e,t,n,o,a,l,s=[-1]){const m=eo;Ji(r);const y=r.$$={fragment:null,ctx:[],props:a,update:It,not_equal:o,bound:ua(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(m?m.$$.context:[])),callbacks:ua(),dirty:s,skip_bound:!1,root:e.target||m.$$.root};l&&l(y.root);let D=!1;if(y.ctx=t?t(r,e.props||{},(W,Ee,...dt)=>{const Ht=dt.length?dt[0]:Ee;return y.ctx&&o(y.ctx[W],y.ctx[W]=Ht)&&(!y.skip_bound&&y.bound[W]&&y.bound[W](Ht),D&&zl(r,W)),Ee}):[],y.update(),D=!0,Er(y.before_update),y.fragment=n?n(y.ctx):!1,e.target){if(e.hydrate){const W=Ol(e.target);y.fragment&&y.fragment.l(W),W.forEach(Tt)}else y.fragment&&y.fragment.c();e.intro&&Gt(r.$$.fragment),lr(r,e.target,e.anchor),ou()}Ji(m)}class qr{constructor(){ys(this,"$$"),ys(this,"$$set")}$destroy(){cr(this,1),this.$destroy=It}$on(e,t){if(!nu(t))return It;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const o=n.indexOf(t);o!==-1&&n.splice(o,1)}}$set(e){this.$$set&&!xl(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Ul="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ul);function ql(r){let e,t;return{c(){e=Kn("svg"),t=Kn("path"),P(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),P(e,"viewBox","0 0 14 14"),P(e,"width","13"),P(e,"height","13"),P(e,"class","svelte-en2qvf")},m(n,o){Dt(n,e,o),nt(e,t)},p:It,i:It,o:It,d(n){n&&Tt(e)}}}class su extends qr{constructor(e){super(),Ur(this,e,null,ql,zr,{})}}function Xl(r){let e,t;return{c(){e=Kn("svg"),t=Kn("path"),P(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),P(e,"viewBox","0 0 30 30"),P(e,"fill","none"),P(e,"xmlns","http://www.w3.org/2000/svg"),P(e,"class","svelte-d2loi5")},m(n,o){Dt(n,e,o),nt(e,t)},p:It,i:It,o:It,d(n){n&&Tt(e)}}}class au extends qr{constructor(e){super(),Ur(this,e,null,Xl,zr,{})}}function Yl(r){let e,t;return{c(){e=ht("img"),Me(e.src,t=r[3]+"area.svg")||P(e,"src",t),P(e,"alt",r[6]),P(e,"class","svelte-ltkwvy")},m(n,o){Dt(n,e,o)},p(n,o){o&8&&!Me(e.src,t=n[3]+"area.svg")&&P(e,"src",t),o&64&&P(e,"alt",n[6])},d(n){n&&Tt(e)}}}function Wl(r){let e,t;return{c(){e=ht("img"),Me(e.src,t=r[3]+"poi.svg")||P(e,"src",t),P(e,"alt",r[6]),P(e,"class","svelte-ltkwvy")},m(n,o){Dt(n,e,o)},p(n,o){o&8&&!Me(e.src,t=n[3]+"poi.svg")&&P(e,"src",t),o&64&&P(e,"alt",n[6])},d(n){n&&Tt(e)}}}function Hl(r){let e,t;return{c(){e=ht("img"),Me(e.src,t=r[3]+"postal_code.svg")||P(e,"src",t),P(e,"alt",r[6]),P(e,"class","svelte-ltkwvy")},m(n,o){Dt(n,e,o)},p(n,o){o&8&&!Me(e.src,t=n[3]+"postal_code.svg")&&P(e,"src",t),o&64&&P(e,"alt",n[6])},d(n){n&&Tt(e)}}}function jl(r){let e,t;return{c(){e=ht("img"),Me(e.src,t=r[3]+"street.svg")||P(e,"src",t),P(e,"alt",r[6]),P(e,"class","svelte-ltkwvy")},m(n,o){Dt(n,e,o)},p(n,o){o&8&&!Me(e.src,t=n[3]+"street.svg")&&P(e,"src",t),o&64&&P(e,"alt",n[6])},d(n){n&&Tt(e)}}}function Kl(r){let e,t;return{c(){e=ht("img"),Me(e.src,t=r[3]+"road.svg")||P(e,"src",t),P(e,"alt",r[6]),P(e,"class","svelte-ltkwvy")},m(n,o){Dt(n,e,o)},p(n,o){o&8&&!Me(e.src,t=n[3]+"road.svg")&&P(e,"src",t),o&64&&P(e,"alt",n[6])},d(n){n&&Tt(e)}}}function Ql(r){let e,t;return{c(){e=ht("img"),Me(e.src,t=r[3]+"housenumber.svg")||P(e,"src",t),P(e,"alt",r[6]),P(e,"class","svelte-ltkwvy")},m(n,o){Dt(n,e,o)},p(n,o){o&8&&!Me(e.src,t=n[3]+"housenumber.svg")&&P(e,"src",t),o&64&&P(e,"alt",n[6])},d(n){n&&Tt(e)}}}function Zl(r){let e,t,n,o;return{c(){e=ht("img"),Me(e.src,t=r[5])||P(e,"src",t),P(e,"alt",r[4]),P(e,"class","svelte-ltkwvy")},m(a,l){Dt(a,e,l),n||(o=Ce(e,"error",r[12]),n=!0)},p(a,l){l&32&&!Me(e.src,t=a[5])&&P(e,"src",t),l&16&&P(e,"alt",a[4])},d(a){a&&Tt(e),n=!1,o()}}}function pa(r){let e,t;return{c(){e=ht("span"),t=Pr(r[6]),P(e,"class","secondary svelte-ltkwvy")},m(n,o){Dt(n,e,o),nt(e,t)},p(n,o){o&64&&to(t,n[6])},d(n){n&&Tt(e)}}}function Jl(r){var e,t;let n,o,a,l,s,m,y,D,W=r[0].place_name.replace(/,.*/,"")+"",Ee,dt,Ht=r[2]==="always"||r[2]&&!r[0].address&&((e=r[0].properties)==null?void 0:e.kind)!=="road"&&((t=r[0].properties)==null?void 0:t.kind)!=="road_relation"&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5]),ir,Hr,Bn=r[0].place_name.replace(/[^,]*,?\s*/,"")+"",Vn,Wr,ps;function il(ll,rl){var th,nh;return rl&1&&(o=null),rl&1&&(a=null),rl&1&&(l=null),ll[5]?Zl:ll[0].address?Ql:((th=ll[0].properties)==null?void 0:th.kind)==="road"||((nh=ll[0].properties)==null?void 0:nh.kind)==="road_relation"?Kl:(o==null&&(o=!!ll[0].id.startsWith("address.")),o?jl:(a==null&&(a=!!ll[0].id.startsWith("postal_code.")),a?Hl:(l==null&&(l=!!ll[0].id.startsWith("poi.")),l?Wl:Yl)))}let gl=il(r,-1),ml=gl(r),sl=Ht&&pa(r);return{c(){n=ht("li"),ml.c(),s=nn(),m=ht("span"),y=ht("span"),D=ht("span"),Ee=Pr(W),dt=nn(),sl&&sl.c(),ir=nn(),Hr=ht("span"),Vn=Pr(Bn),P(D,"class","primary svelte-ltkwvy"),P(y,"class","svelte-ltkwvy"),P(Hr,"class","line2 svelte-ltkwvy"),P(m,"class","texts svelte-ltkwvy"),P(n,"tabindex","0"),P(n,"data-selected",r[1]),P(n,"class","svelte-ltkwvy"),on(n,"selected",r[1])},m(ll,rl){Dt(ll,n,rl),ml.m(n,null),nt(n,s),nt(n,m),nt(m,y),nt(y,D),nt(D,Ee),nt(y,dt),sl&&sl.m(y,null),nt(m,ir),nt(m,Hr),nt(Hr,Vn),Wr||(ps=[Ce(n,"mouseenter",r[10]),Ce(n,"focus",r[11])],Wr=!0)},p(ll,[rl]){var th,nh;gl===(gl=il(ll,rl))&&ml?ml.p(ll,rl):(ml.d(1),ml=gl(ll),ml&&(ml.c(),ml.m(n,s))),rl&1&&W!==(W=ll[0].place_name.replace(/,.*/,"")+"")&&to(Ee,W),rl&37&&(Ht=ll[2]==="always"||ll[2]&&!ll[0].address&&((th=ll[0].properties)==null?void 0:th.kind)!=="road"&&((nh=ll[0].properties)==null?void 0:nh.kind)!=="road_relation"&&!ll[0].id.startsWith("address.")&&!ll[0].id.startsWith("postal_code.")&&(!ll[0].id.startsWith("poi.")||!ll[5])),Ht?sl?sl.p(ll,rl):(sl=pa(ll),sl.c(),sl.m(y,null)):sl&&(sl.d(1),sl=null),rl&1&&Bn!==(Bn=ll[0].place_name.replace(/[^,]*,?\s*/,"")+"")&&to(Vn,Bn),rl&2&&P(n,"data-selected",ll[1]),rl&2&&on(n,"selected",ll[1])},i:It,o:It,d(ll){ll&&Tt(n),ml.d(),sl&&sl.d(),Wr=!1,Er(ps)}}}function $l(r,e,t){var n;let o,a,{feature:l}=e,{selected:s=!1}=e,{showPlaceType:m}=e,{missingIconsCache:y}=e,{iconsBaseUrl:D}=e;const W=(n=l.properties)==null?void 0:n.categories;let Ee,dt;function Ht(Vn){dt&&y.add(dt),t(9,o--,o)}function ir(Vn){fa.call(this,r,Vn)}function Hr(Vn){fa.call(this,r,Vn)}const Bn=Vn=>Ht(Vn.currentTarget);return r.$$set=Vn=>{"feature"in Vn&&t(0,l=Vn.feature),"selected"in Vn&&t(1,s=Vn.selected),"showPlaceType"in Vn&&t(2,m=Vn.showPlaceType),"missingIconsCache"in Vn&&t(8,y=Vn.missingIconsCache),"iconsBaseUrl"in Vn&&t(3,D=Vn.iconsBaseUrl)},r.$$.update=()=>{var Vn,Wr,ps,il;if(r.$$.dirty&824)do t(9,o--,o),t(4,Ee=W==null?void 0:W[o]),t(5,dt=Ee?D+Ee.replace(/ /g,"_")+".svg":void 0);while(o>-1&&(!dt||y.has(dt)));r.$$.dirty&1&&t(6,a=l.id.startsWith("poi.")?(Wr=(Vn=l.properties)==null?void 0:Vn.categories)==null?void 0:Wr.join(", "):((il=(ps=l.properties)==null?void 0:ps.place_type_name)==null?void 0:il[0])??l.place_type[0])},t(9,o=(W==null?void 0:W.length)??0),[l,s,m,D,Ee,dt,a,Ht,y,o,ir,Hr,Bn]}class tc extends qr{constructor(e){super(),Ur(this,e,$l,Jl,zr,{feature:0,selected:1,showPlaceType:2,missingIconsCache:8,iconsBaseUrl:3})}}function ec(r){let e;return{c(){e=ht("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',P(e,"class","svelte-7cmwmc")},m(t,n){Dt(t,e,n)},p:It,i:It,o:It,d(t){t&&Tt(e)}}}class nc extends qr{constructor(e){super(),Ur(this,e,null,ec,zr,{})}}function rc(r){let e,t;return{c(){e=Kn("svg"),t=Kn("path"),P(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),P(e,"viewBox","0 0 60.006 21.412"),P(e,"width","14"),P(e,"height","20"),P(e,"class","svelte-en2qvf")},m(n,o){Dt(n,e,o),nt(e,t)},p:It,i:It,o:It,d(n){n&&Tt(e)}}}class ic extends qr{constructor(e){super(),Ur(this,e,null,rc,zr,{})}}function oc(r){let e,t;return{c(){e=Kn("svg"),t=Kn("path"),P(t,"d","M13.101 14.261 8.74 9.899a4.797 4.797 0 0 1-1.425.748 5.165 5.165 0 0 1-1.603.248c-1.446 0-2.677-.5-3.693-1.503S.495 7.164.495 5.717c0-1.446.508-2.678 1.524-3.693C3.035 1.008 4.266.5 5.712.5c1.448 0 2.672.508 3.675 1.524 1.002 1.015 1.503 2.247 1.503 3.693 0 .558-.08 1.092-.239 1.603-.159.512-.411.98-.757 1.405l4.382 4.4a.74.74 0 0 1 .229.568.81.81 0 0 1-.249.568.787.787 0 0 1-.577.239.787.787 0 0 1-.578-.239ZM5.712 9.223c.97 0 1.796-.342 2.48-1.026a3.378 3.378 0 0 0 1.026-2.48c0-.982-.34-1.818-1.016-2.509-.677-.69-1.507-1.035-2.49-1.035a3.42 3.42 0 0 0-2.509 1.035 3.42 3.42 0 0 0-1.035 2.51c0 .982.345 1.812 1.035 2.488.691.678 1.527 1.017 2.51 1.017Z"),P(e,"width","14"),P(e,"height","14"),P(e,"viewBox","0 0 15 15"),P(e,"class","svelte-en2qvf")},m(n,o){Dt(n,e,o),nt(e,t)},p:It,i:It,o:It,d(n){n&&Tt(e)}}}class sc extends qr{constructor(e){super(),Ur(this,e,null,oc,zr,{})}}function da(r,e,t){const n=r.slice();return n[75]=e[t],n[77]=t,n}function va(r){let e,t;return e=new nc({}),{c(){Rr(e.$$.fragment)},m(n,o){lr(e,n,o),t=!0},i(n){t||(Gt(e.$$.fragment,n),t=!0)},o(n){le(e.$$.fragment,n),t=!1},d(n){cr(e,n)}}}function ya(r){let e,t,n,o,a;return t=new ic({}),{c(){e=ht("button"),Rr(t.$$.fragment),P(e,"type","button"),P(e,"title",r[9]),P(e,"class","svelte-1r7dvt7"),on(e,"active",r[0])},m(l,s){Dt(l,e,s),lr(t,e,null),n=!0,o||(a=Ce(e,"click",r[61]),o=!0)},p(l,s){(!n||s[0]&512)&&P(e,"title",l[9]),(!n||s[0]&1)&&on(e,"active",l[0])},i(l){n||(Gt(t.$$.fragment,l),n=!0)},o(l){le(t.$$.fragment,l),n=!1},d(l){l&&Tt(e),cr(t),o=!1,a()}}}function ac(r){let e,t=[],n=new Map,o,a,l,s=ga(r[13]);const m=y=>y[75].id+(y[75].address?","+y[75].address:"");for(let y=0;y<s.length;y+=1){let D=da(r,s,y),W=m(D);n.set(W,t[y]=ma(W,D))}return{c(){e=ht("ul");for(let y=0;y<t.length;y+=1)t[y].c();P(e,"class","svelte-1r7dvt7")},m(y,D){Dt(y,e,D);for(let W=0;W<t.length;W+=1)t[W]&&t[W].m(e,null);o=!0,a||(l=[Ce(e,"mouseleave",r[65]),Ce(e,"blur",r[66])],a=!0)},p(y,D){D[0]&8940544&&(s=ga(y[13]),Ao(),t=Vl(t,D,m,1,y,s,n,e,Gl,ma,null,da),Fo())},i(y){if(!o){for(let D=0;D<s.length;D+=1)Gt(t[D]);o=!0}},o(y){for(let D=0;D<t.length;D+=1)le(t[D]);o=!1},d(y){y&&Tt(e);for(let D=0;D<t.length;D+=1)t[D].d();a=!1,Er(l)}}}function uc(r){let e,t,n,o,a,l;return t=new au({}),{c(){e=ht("div"),Rr(t.$$.fragment),n=nn(),o=ht("div"),a=Pr(r[7]),P(o,"class","svelte-1r7dvt7"),P(e,"class","no-results svelte-1r7dvt7")},m(s,m){Dt(s,e,m),lr(t,e,null),nt(e,n),nt(e,o),nt(o,a),l=!0},p(s,m){(!l||m[0]&128)&&to(a,s[7])},i(s){l||(Gt(t.$$.fragment,s),l=!0)},o(s){le(t.$$.fragment,s),l=!1},d(s){s&&Tt(e),cr(t)}}}function lc(r){let e="",t;return{c(){t=Pr(e)},m(n,o){Dt(n,t,o)},p:It,i:It,o:It,d(n){n&&Tt(t)}}}function cc(r){let e,t,n,o,a,l,s,m,y,D,W;return t=new au({}),m=new su({}),{c(){e=ht("div"),Rr(t.$$.fragment),n=nn(),o=ht("div"),a=Pr(r[6]),l=nn(),s=ht("button"),Rr(m.$$.fragment),P(o,"class","svelte-1r7dvt7"),P(s,"class","svelte-1r7dvt7"),P(e,"class","error svelte-1r7dvt7")},m(Ee,dt){Dt(Ee,e,dt),lr(t,e,null),nt(e,n),nt(e,o),nt(o,a),nt(e,l),nt(e,s),lr(m,s,null),y=!0,D||(W=Ce(s,"click",r[62]),D=!0)},p(Ee,dt){(!y||dt[0]&64)&&to(a,Ee[6])},i(Ee){y||(Gt(t.$$.fragment,Ee),Gt(m.$$.fragment,Ee),y=!0)},o(Ee){le(t.$$.fragment,Ee),le(m.$$.fragment,Ee),y=!1},d(Ee){Ee&&Tt(e),cr(t),cr(m),D=!1,W()}}}function ma(r,e){let t,n,o;function a(){return e[63](e[77])}function l(){return e[64](e[75])}return n=new tc({props:{feature:e[75],showPlaceType:e[10],selected:e[14]===e[77],missingIconsCache:e[19],iconsBaseUrl:e[11]}}),n.$on("mouseenter",a),n.$on("focus",l),{key:r,first:null,c(){t=Pl(),Rr(n.$$.fragment),this.first=t},m(s,m){Dt(s,t,m),lr(n,s,m),o=!0},p(s,m){e=s;const y={};m[0]&8192&&(y.feature=e[75]),m[0]&1024&&(y.showPlaceType=e[10]),m[0]&24576&&(y.selected=e[14]===e[77]),m[0]&2048&&(y.iconsBaseUrl=e[11]),n.$set(y)},i(s){o||(Gt(n.$$.fragment,s),o=!0)},o(s){le(n.$$.fragment,s),o=!1},d(s){s&&Tt(t),cr(n,s)}}}function fc(r){let e,t,n,o,a,l,s,m,y,D,W,Ee,dt,Ht,ir,Hr,Bn,Vn,Wr,ps;o=new sc({}),D=new su({});let il=r[18]&&va(),gl=r[5]===!0&&ya(r);const ml=r[53].default,sl=Sl(ml,r,r[52],null),ll=[cc,lc,uc,ac],rl=[];function th(nh,bh){var Fh,Bh;return nh[17]?0:nh[15]?((Fh=nh[13])==null?void 0:Fh.length)===0?2:nh[15]&&(Bh=nh[13])!=null&&Bh.length?3:-1:1}return~(ir=th(r))&&(Hr=rl[ir]=ll[ir](r)),{c(){e=ht("form"),t=ht("div"),n=ht("button"),Rr(o.$$.fragment),a=nn(),l=ht("input"),s=nn(),m=ht("div"),y=ht("button"),Rr(D.$$.fragment),W=nn(),il&&il.c(),Ee=nn(),gl&&gl.c(),dt=nn(),sl&&sl.c(),Ht=nn(),Hr&&Hr.c(),P(n,"class","search-button svelte-1r7dvt7"),P(n,"type","button"),P(l,"placeholder",r[8]),P(l,"aria-label",r[8]),P(l,"class","svelte-1r7dvt7"),P(y,"type","button"),P(y,"title",r[3]),P(y,"class","svelte-1r7dvt7"),P(m,"class","clear-button-container svelte-1r7dvt7"),on(m,"displayable",r[1]!==""),P(t,"class","input-group svelte-1r7dvt7"),P(e,"tabindex","0"),P(e,"class",Bn=la(r[2])+" svelte-1r7dvt7"),on(e,"can-collapse",r[4]&&r[1]==="")},m(nh,bh){Dt(nh,e,bh),nt(e,t),nt(t,n),lr(o,n,null),nt(t,a),nt(t,l),r[55](l),ca(l,r[1]),nt(t,s),nt(t,m),nt(m,y),lr(D,y,null),nt(m,W),il&&il.m(m,null),nt(t,Ee),gl&&gl.m(t,null),nt(t,dt),sl&&sl.m(t,null),nt(e,Ht),~ir&&rl[ir].m(e,null),Vn=!0,Wr||(ps=[Ce(n,"click",r[54]),Ce(l,"input",r[56]),Ce(l,"focus",r[57]),Ce(l,"blur",r[58]),Ce(l,"keydown",r[21]),Ce(l,"input",r[59]),Ce(y,"click",r[60]),Ce(e,"submit",Rl(r[20]))],Wr=!0)},p(nh,bh){(!Vn||bh[0]&256)&&P(l,"placeholder",nh[8]),(!Vn||bh[0]&256)&&P(l,"aria-label",nh[8]),bh[0]&2&&l.value!==nh[1]&&ca(l,nh[1]),(!Vn||bh[0]&8)&&P(y,"title",nh[3]),nh[18]?il?bh[0]&262144&&Gt(il,1):(il=va(),il.c(),Gt(il,1),il.m(m,null)):il&&(Ao(),le(il,1,1,()=>{il=null}),Fo()),(!Vn||bh[0]&2)&&on(m,"displayable",nh[1]!==""),nh[5]===!0?gl?(gl.p(nh,bh),bh[0]&32&&Gt(gl,1)):(gl=ya(nh),gl.c(),Gt(gl,1),gl.m(t,dt)):gl&&(Ao(),le(gl,1,1,()=>{gl=null}),Fo()),sl&&sl.p&&(!Vn||bh[1]&2097152)&&Ll(sl,ml,nh,nh[52],Vn?wl(ml,nh[52],bh,null):bl(nh[52]),null);let Fh=ir;ir=th(nh),ir===Fh?~ir&&rl[ir].p(nh,bh):(Hr&&(Ao(),le(rl[Fh],1,1,()=>{rl[Fh]=null}),Fo()),~ir?(Hr=rl[ir],Hr?Hr.p(nh,bh):(Hr=rl[ir]=ll[ir](nh),Hr.c()),Gt(Hr,1),Hr.m(e,null)):Hr=null),(!Vn||bh[0]&4&&Bn!==(Bn=la(nh[2])+" svelte-1r7dvt7"))&&P(e,"class",Bn),(!Vn||bh[0]&22)&&on(e,"can-collapse",nh[4]&&nh[1]==="")},i(nh){Vn||(Gt(o.$$.fragment,nh),Gt(D.$$.fragment,nh),Gt(il),Gt(gl),Gt(sl,nh),Gt(Hr),Vn=!0)},o(nh){le(o.$$.fragment,nh),le(D.$$.fragment,nh),le(il),le(gl),le(sl,nh),le(Hr),Vn=!1},d(nh){nh&&Tt(e),cr(o),r[55](null),cr(D),il&&il.d(),gl&&gl.d(),sl&&sl.d(nh),~ir&&rl[ir].d(),Wr=!1,Er(ps)}}}function hc(r,e,t){const n=e[1],o=e[0],a=n-o;return r===n&&t?r:((r-o)%a+a)%a+o}function _a(r){let e=[...r];return e[2]<e[0]&&(e[2]+=360),e}function gc(r,e,t){let n,{$$slots:o={},$$scope:a}=e,{class:l=void 0}=e,{apiKey:s}=e,{bbox:m=void 0}=e,{clearButtonTitle:y="clear"}=e,{clearOnBlur:D=!1}=e,{collapsed:W=!1}=e,{country:Ee=void 0}=e,{debounceSearch:dt=200}=e,{enableReverse:Ht=!1}=e,{errorMessage:ir="Something went wrong"}=e,{filter:Hr=()=>!0}=e,{flyTo:Bn=!0}=e,{fuzzyMatch:Vn=!0}=e,{language:Wr=void 0}=e,{limit:ps=void 0}=e,{mapController:il=void 0}=e,{minLength:gl=2}=e,{noResultsMessage:ml="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:sl="Search"}=e,{proximity:ll=void 0}=e,{reverseActive:rl=Ht==="always"}=e,{reverseButtonTitle:th="toggle reverse geocoding"}=e,{searchValue:nh=""}=e,{showFullGeometry:bh=!0}=e,{showPlaceType:Fh="ifNeeded"}=e,{showResultsWhileTyping:Bh=!0}=e,{trackProximity:Ed=!0}=e,{types:Td=void 0}=e,{zoom:td=16}=e,{maxZoom:Fd=18}=e,{apiUrl:Ld="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Ud={}}=e,{iconsBaseUrl:Xd="https://cdn.maptiler.com/maptiler-geocoding-control/v0.0.97/icons/"}=e;function wd(){Kd.focus()}function zd(){Kd.blur()}function Rd(oh,Dh=!0){t(1,nh=oh),Dh?(t(14,Ap=-1),Fp()):(cp(),setTimeout(()=>{Kd.focus(),Kd.select()}))}let op=!1,Wd,Op,ep,zp="",Kd,Ap=-1,Ip,Yh=[],Ad,kp,up,rp;const fd=new Set,Cp=Ml();Dl(()=>{il&&(il.setEventHandler(void 0),il.indicateReverse(!1),il.setSelectedMarker(-1),il.setMarkers(void 0,void 0))});function Fp(oh){if(kp&&(clearTimeout(kp),kp=void 0),Ap>-1&&Wd)t(49,ep=Wd[Ap]),t(1,nh=ep.place_name.replace(/,.*/,"")),t(17,Ip=void 0),t(48,Op=void 0),t(14,Ap=-1);else if(nh){const Dh=oh||!_p();kd(nh,{exact:!0}).then(()=>{t(48,Op=Wd),t(49,ep=void 0),Dh&&$f()}).catch($h=>t(17,Ip=$h))}}function _p(){return/^-?\d+(\.\d+)?,-?\d+(\.\d+)?$/.test(nh)}async function kd(oh,{byId:Dh=!1,exact:$h=!1}={}){t(17,Ip=void 0);const yl=_p(),gs=new URLSearchParams;Wr!=null&&gs.set("language",Array.isArray(Wr)?Wr.join(","):Wr),Td&&gs.set("types",Td.join(",")),yl||(m&&gs.set("bbox",m.map(ch=>ch.toFixed(6)).join(",")),Ee&&gs.set("country",Array.isArray(Ee)?Ee.join(","):Ee)),Dh||(ll&&gs.set("proximity",ll.map(ch=>ch.toFixed(6)).join(",")),($h||!Bh)&&gs.set("autocomplete","false"),gs.set("fuzzyMatch",String(Vn))),ps!==void 0&&(!yl||(Td==null?void 0:Td.length)===1)&&gs.set("limit",String(ps)),gs.set("key",s);const Cr=Ld+"/"+encodeURIComponent(oh)+".json?"+gs.toString();if(Cr===zp){Dh?(t(13,Wd=void 0),t(49,ep=Yh[0])):t(13,Wd=Yh);return}zp=Cr,Ad==null||Ad.abort();const fs=new AbortController;t(18,Ad=fs);let ul;try{ul=await fetch(Cr,{signal:fs.signal,...Ud}).finally(()=>{fs===Ad&&t(18,Ad=void 0)})}catch(ch){if(ch&&typeof ch=="object"&&"name"in ch&&ch.name==="AbortError")return;throw new Error}if(!ul.ok)throw new Error;const ih=await ul.json();Cp("response",{url:Cr,featureCollection:ih}),Dh?(t(13,Wd=void 0),t(49,ep=ih.features[0]),Yh=[ep]):(t(13,Wd=ih.features.filter(Hr)),Yh=Wd,yl&&Kd.focus())}function $f(){var oh,Dh,$h,yl;if(!(Op!=null&&Op.length)||!Bn)return;const gs=[180,90,-180,-90],Cr=!Op.some(fs=>!fs.matching_text);for(const fs of Op)(Cr||!fs.matching_text)&&(gs[0]=Math.min(gs[0],((oh=fs.bbox)==null?void 0:oh[0])??fs.center[0]),gs[1]=Math.min(gs[1],((Dh=fs.bbox)==null?void 0:Dh[1])??fs.center[1]),gs[2]=Math.max(gs[2],(($h=fs.bbox)==null?void 0:$h[2])??fs.center[0]),gs[3]=Math.max(gs[3],((yl=fs.bbox)==null?void 0:yl[3])??fs.center[1]));il&&Op.length>0&&(ep&&gs[0]===gs[2]&&gs[1]===gs[3]?il.flyTo(ep.center,td):il.fitBounds(_a(gs),50,Fd))}function Uf(oh){t(0,rl=Ht==="always"),Rd(hc(oh[0],[-180,180],!0).toFixed(6)+","+oh[1].toFixed(6))}function cd(oh){if(!Wd)return;let Dh=oh.key==="ArrowDown"?1:oh.key==="ArrowUp"?-1:0;Dh?(Ap===-1&&Dh===-1&&t(14,Ap=Wd.length),t(14,Ap+=Dh),Ap>=Wd.length&&t(14,Ap=-1),oh.preventDefault()):["ArrowLeft","ArrowRight","Home","End"].includes(oh.key)&&t(14,Ap=-1)}function cp(oh=!0){if(t(17,Ip=void 0),Bh){if(kp&&clearTimeout(kp),nh.length<gl)return;const Dh=nh;kp=window.setTimeout(()=>{kd(Dh).catch($h=>t(17,Ip=$h))},oh?dt:0)}else t(13,Wd=void 0),t(17,Ip=void 0)}function xp(oh){t(49,ep=oh),t(1,nh=oh.place_name),t(14,Ap=-1)}const Ep=()=>Kd.focus();function Vp(oh){xs[oh?"unshift":"push"](()=>{Kd=oh,t(16,Kd)})}function bd(){nh=this.value,t(1,nh),t(12,op),t(27,D)}const Yd=()=>t(12,op=!0),np=()=>t(12,op=!1),Up=()=>cp(),Qp=()=>{t(1,nh=""),Kd.focus()},Rp=()=>t(0,rl=!rl),ng=()=>t(17,Ip=void 0),bg=oh=>t(14,Ap=oh),Ih=oh=>xp(oh),rh=()=>t(14,Ap=-1),sh=()=>{};return r.$$set=oh=>{"class"in oh&&t(2,l=oh.class),"apiKey"in oh&&t(25,s=oh.apiKey),"bbox"in oh&&t(26,m=oh.bbox),"clearButtonTitle"in oh&&t(3,y=oh.clearButtonTitle),"clearOnBlur"in oh&&t(27,D=oh.clearOnBlur),"collapsed"in oh&&t(4,W=oh.collapsed),"country"in oh&&t(28,Ee=oh.country),"debounceSearch"in oh&&t(29,dt=oh.debounceSearch),"enableReverse"in oh&&t(5,Ht=oh.enableReverse),"errorMessage"in oh&&t(6,ir=oh.errorMessage),"filter"in oh&&t(30,Hr=oh.filter),"flyTo"in oh&&t(31,Bn=oh.flyTo),"fuzzyMatch"in oh&&t(32,Vn=oh.fuzzyMatch),"language"in oh&&t(33,Wr=oh.language),"limit"in oh&&t(34,ps=oh.limit),"mapController"in oh&&t(35,il=oh.mapController),"minLength"in oh&&t(36,gl=oh.minLength),"noResultsMessage"in oh&&t(7,ml=oh.noResultsMessage),"placeholder"in oh&&t(8,sl=oh.placeholder),"proximity"in oh&&t(24,ll=oh.proximity),"reverseActive"in oh&&t(0,rl=oh.reverseActive),"reverseButtonTitle"in oh&&t(9,th=oh.reverseButtonTitle),"searchValue"in oh&&t(1,nh=oh.searchValue),"showFullGeometry"in oh&&t(37,bh=oh.showFullGeometry),"showPlaceType"in oh&&t(10,Fh=oh.showPlaceType),"showResultsWhileTyping"in oh&&t(38,Bh=oh.showResultsWhileTyping),"trackProximity"in oh&&t(39,Ed=oh.trackProximity),"types"in oh&&t(40,Td=oh.types),"zoom"in oh&&t(41,td=oh.zoom),"maxZoom"in oh&&t(42,Fd=oh.maxZoom),"apiUrl"in oh&&t(43,Ld=oh.apiUrl),"fetchParameters"in oh&&t(44,Ud=oh.fetchParameters),"iconsBaseUrl"in oh&&t(11,Xd=oh.iconsBaseUrl),"$$scope"in oh&&t(52,a=oh.$$scope)},r.$$.update=()=>{if(r.$$.dirty[1]&256&&(Ed||t(24,ll=void 0)),r.$$.dirty[0]&134221824&&setTimeout(()=>{t(15,up=op),D&&!op&&t(1,nh="")}),r.$$.dirty[0]&8194|r.$$.dirty[1]&32&&nh.length<gl&&(t(49,ep=void 0),t(13,Wd=void 0),t(17,Ip=void 0),t(48,Op=Wd)),r.$$.dirty[1]&262208&&bh&&ep&&!ep.address&&ep.geometry.type==="Point"&&kd(ep.id,{byId:!0}).catch(oh=>t(17,Ip=oh)),r.$$.dirty[1]&789521&&(il&&ep&&ep.id!==rp&&Bn&&(!ep.bbox||ep.bbox[0]===ep.bbox[2]&&ep.bbox[1]===ep.bbox[3]?il.flyTo(ep.center,ep.id.startsWith("poi.")||ep.id.startsWith("address.")?Fd:td):il.fitBounds(_a(ep.bbox),50,Fd),t(13,Wd=void 0),t(48,Op=void 0),t(14,Ap=-1)),t(50,rp=ep==null?void 0:ep.id)),r.$$.dirty[0]&8192|r.$$.dirty[1]&131072&&Op!==Wd&&t(48,Op=void 0),r.$$.dirty[1]&393232&&il&&il.setMarkers(Op,ep),r.$$.dirty[0]&2&&t(14,Ap=-1),r.$$.dirty[0]&40961|r.$$.dirty[1]&272&&il&&il.setEventHandler(oh=>{switch(oh.type){case"mapClick":rl&&Uf(oh.coordinates);break;case"proximityChange":t(24,ll=Ed?oh.proximity:void 0);break;case"markerClick":{const Dh=Wd==null?void 0:Wd.find($h=>$h.id===oh.id);Dh&&xp(Dh)}break;case"markerMouseEnter":t(14,Ap=up?(Wd==null?void 0:Wd.findIndex(Dh=>Dh.id===oh.id))??-1:-1);break;case"markerMouseLeave":t(14,Ap=-1);break}}),r.$$.dirty[0]&16384|r.$$.dirty[1]&16&&(il==null||il.setSelectedMarker(Ap)),r.$$.dirty[0]&24576&&t(51,n=Wd==null?void 0:Wd[Ap]),r.$$.dirty[0]&2|r.$$.dirty[1]&16){const oh=/^(-?\d+(?:\.\d*)?),(-?\d+(?:\.\d*)?)$/.exec(nh);il==null||il.setReverseMarker(oh?[Number(oh[1]),Number(oh[2])]:void 0)}r.$$.dirty[1]&1048576&&Cp("select",n),r.$$.dirty[1]&262144&&Cp("pick",ep),r.$$.dirty[0]&40960&&Cp("optionsVisibilityChange",up&&!!Wd),r.$$.dirty[0]&8192&&Cp("featuresListed",Wd),r.$$.dirty[1]&131072&&Cp("featuresMarked",Op),r.$$.dirty[0]&1&&Cp("reverseToggle",rl),r.$$.dirty[0]&2&&Cp("queryChange",nh),r.$$.dirty[0]&1|r.$$.dirty[1]&16&&il&&il.indicateReverse(rl)},[rl,nh,l,y,W,Ht,ir,ml,sl,th,Fh,Xd,op,Wd,Ap,up,Kd,Ip,Ad,fd,Fp,cd,cp,xp,ll,s,m,D,Ee,dt,Hr,Bn,Vn,Wr,ps,il,gl,bh,Bh,Ed,Td,td,Fd,Ld,Ud,wd,zd,Rd,Op,ep,rp,n,a,o,Ep,Vp,bd,Yd,np,Up,Qp,Rp,ng,bg,Ih,rh,sh]}let pc=class extends qr{constructor(r){super(),Ur(this,r,gc,fc,zr,{class:2,apiKey:25,bbox:26,clearButtonTitle:3,clearOnBlur:27,collapsed:4,country:28,debounceSearch:29,enableReverse:5,errorMessage:6,filter:30,flyTo:31,fuzzyMatch:32,language:33,limit:34,mapController:35,minLength:36,noResultsMessage:7,placeholder:8,proximity:24,reverseActive:0,reverseButtonTitle:9,searchValue:1,showFullGeometry:37,showPlaceType:10,showResultsWhileTyping:38,trackProximity:39,types:40,zoom:41,maxZoom:42,apiUrl:43,fetchParameters:44,iconsBaseUrl:11,focus:45,blur:46,setQuery:47},null,[-1,-1,-1])}get focus(){return this.$$.ctx[45]}get blur(){return this.$$.ctx[46]}get setQuery(){return this.$$.ctx[47]}};/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function dc(r,e){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,o,a,l;return l={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function s(y){return function(D){return m([y,D])}}function m(y){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,o&&(a=y[0]&2?o.return:y[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,y[1])).done)return a;switch(o=0,a&&(y=[y[0]&2,a.value]),y[0]){case 0:case 1:a=y;break;case 4:return t.label++,{value:y[1],done:!1};case 5:t.label++,o=y[1],y=[0];continue;case 7:y=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(y[0]===6||y[0]===2)){t=0;continue}if(y[0]===3&&(!a||y[1]>a[0]&&y[1]<a[3])){t.label=y[1];break}if(y[0]===6&&t.label<a[1]){t.label=a[1],a=y;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(y);break}a[2]&&t.ops.pop(),t.trys.pop();continue}y=e.call(r,t)}catch(D){y=[6,D],o=0}finally{n=a=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}var Or=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function vc(r,e){return r>e?1:r<e?-1:0}function Sr(r,e,t){for(var n=new Or(null,null),o=n,a=n;;){var l=t(r,e.key);if(l<0){if(e.left===null)break;if(t(r,e.left.key)<0){var s=e.left;if(e.left=s.right,s.right=e,e=s,e.left===null)break}a.left=e,a=e,e=e.left}else if(l>0){if(e.right===null)break;if(t(r,e.right.key)>0){var s=e.right;if(e.right=s.left,s.left=e,e=s,e.right===null)break}o.right=e,o=e,e=e.right}else break}return o.right=e.left,a.left=e.right,e.left=n.right,e.right=n.left,e}function Es(r,e,t,n){var o=new Or(r,e);if(t===null)return o.left=o.right=null,o;t=Sr(r,t,n);var a=n(r,t.key);return a<0?(o.left=t.left,o.right=t,t.left=null):a>=0&&(o.right=t.right,o.left=t,t.right=null),o}function Ea(r,e,t){var n=null,o=null;if(e){e=Sr(r,e,t);var a=t(e.key,r);a===0?(n=e.left,o=e.right):a<0?(o=e.right,e.right=null,n=e):(n=e.left,e.left=null,o=e)}return{left:n,right:o}}function yc(r,e,t){return e===null?r:(r===null||(e=Sr(r.key,e,t),e.left=r),e)}function Ls(r,e,t,n,o){if(r){n(""+e+(t?" ":" ")+o(r)+`
`);var a=e+(t?"    ":"   ");r.left&&Ls(r.left,a,!1,n,o),r.right&&Ls(r.right,a,!0,n,o)}}var zs=function(){function r(e){e===void 0&&(e=vc),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=Es(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Or(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var o=this._comparator,a=Sr(e,this._root,o),l=o(e,a.key);return l===0?this._root=a:(l<0?(n.left=a.left,n.right=a,a.left=null):l>0&&(n.right=a.right,n.left=a,a.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var o;if(t===null)return null;t=Sr(e,t,n);var a=n(e,t.key);return a===0?(t.left===null?o=t.right:(o=Sr(e,t.left,n),o.right=t.right),this._size--,o):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Sr(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var o=n(e,t.key);if(o===0)return t;o<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=Sr(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var o=n(e,t.key);if(o===0)return!0;o<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,o=[],a=!1;!a;)n!==null?(o.push(n),n=n.left):o.length!==0?(n=o.pop(),e.call(t,n),n=n.right):a=!0;return this},r.prototype.range=function(e,t,n,o){for(var a=[],l=this._comparator,s=this._root,m;a.length!==0||s;)if(s)a.push(s),s=s.left;else{if(s=a.pop(),m=l(s.key,t),m>0)break;if(l(s.key,e)>=0&&n.call(o,s))return this;s=s.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,o=0,a=[];!n;)if(t)a.push(t),t=t.left;else if(a.length>0){if(t=a.pop(),o===e)return t;o++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var o=this._comparator;t;){var a=o(e.key,t.key);if(a===0)break;a<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var o=this._comparator;t;){var a=o(e.key,t.key);if(a===0)break;a<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return _c(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var o=e.length,a=this._comparator;if(n&&Rs(e,t,0,o-1,a),this._root===null)this._root=bs(e,t,0,o),this._size=o;else{var l=Ec(this.toList(),mc(e,t),a);o=this._size+o,this._root=Ps({head:l},0,o)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return Ls(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var o=this._comparator,a=Ea(e,this._root,o),l=a.left,s=a.right;o(e,t)<0?s=Es(t,n,s,o):l=Es(t,n,l,o),this._root=yc(l,s,o)},r.prototype.split=function(e){return Ea(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return dc(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function bs(r,e,t,n){var o=n-t;if(o>0){var a=t+Math.floor(o/2),l=r[a],s=e[a],m=new Or(l,s);return m.left=bs(r,e,t,a),m.right=bs(r,e,a+1,n),m}return null}function mc(r,e){for(var t=new Or(null,null),n=t,o=0;o<r.length;o++)n=n.next=new Or(r[o],e[o]);return n.next=null,t.next}function _c(r){for(var e=r,t=[],n=!1,o=new Or(null,null),a=o;!n;)e?(t.push(e),e=e.left):t.length>0?(e=a=a.next=t.pop(),e=e.right):n=!0;return a.next=null,o.next}function Ps(r,e,t){var n=t-e;if(n>0){var o=e+Math.floor(n/2),a=Ps(r,e,o),l=r.head;return l.left=a,r.head=r.head.next,l.right=Ps(r,o+1,t),l}return null}function Ec(r,e,t){for(var n=new Or(null,null),o=n,a=r,l=e;a!==null&&l!==null;)t(a.key,l.key)<0?(o.next=a,a=a.next):(o.next=l,l=l.next),o=o.next;return a!==null?o.next=a:l!==null&&(o.next=l),n.next}function Rs(r,e,t,n,o){if(!(t>=n)){for(var a=r[t+n>>1],l=t-1,s=n+1;;){do l++;while(o(r[l],a)<0);do s--;while(o(r[s],a)>0);if(l>=s)break;var m=r[l];r[l]=r[s],r[s]=m,m=e[l],e[l]=e[s],e[s]=m}Rs(r,e,t,s,o),Rs(r,e,s+1,n,o)}}function mn(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Ia(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function Se(r,e,t){return e&&Ia(r.prototype,e),t&&Ia(r,t),r}var ji=function(r,e){return r.ll.x<=e.x&&e.x<=r.ur.x&&r.ll.y<=e.y&&e.y<=r.ur.y},Os=function(r,e){if(e.ur.x<r.ll.x||r.ur.x<e.ll.x||e.ur.y<r.ll.y||r.ur.y<e.ll.y)return null;var t=r.ll.x<e.ll.x?e.ll.x:r.ll.x,n=r.ur.x<e.ur.x?r.ur.x:e.ur.x,o=r.ll.y<e.ll.y?e.ll.y:r.ll.y,a=r.ur.y<e.ur.y?r.ur.y:e.ur.y;return{ll:{x:t,y:o},ur:{x:n,y:a}}},wr=Number.EPSILON;wr===void 0&&(wr=Math.pow(2,-52));var Ic=wr*wr,Ts=function(r,e){if(-wr<r&&r<wr&&-wr<e&&e<wr)return 0;var t=r-e;return t*t<Ic*r*e?0:r<e?-1:1},Cc=function(){function r(){mn(this,r),this.reset()}return Se(r,[{key:"reset",value:function(){this.xRounder=new Ca,this.yRounder=new Ca}},{key:"round",value:function(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}]),r}(),Ca=function(){function r(){mn(this,r),this.tree=new zs,this.round(0)}return Se(r,[{key:"round",value:function(e){var t=this.tree.add(e),n=this.tree.prev(t);if(n!==null&&Ts(t.key,n.key)===0)return this.tree.remove(e),n.key;var o=this.tree.next(t);return o!==null&&Ts(t.key,o.key)===0?(this.tree.remove(e),o.key):e}}]),r}(),no=new Cc,$i=function(r,e){return r.x*e.y-r.y*e.x},uu=function(r,e){return r.x*e.x+r.y*e.y},Na=function(r,e,t){var n={x:e.x-r.x,y:e.y-r.y},o={x:t.x-r.x,y:t.y-r.y},a=$i(n,o);return Ts(a,0)},Go=function(r){return Math.sqrt(uu(r,r))},Nc=function(r,e,t){var n={x:e.x-r.x,y:e.y-r.y},o={x:t.x-r.x,y:t.y-r.y};return $i(o,n)/Go(o)/Go(n)},xc=function(r,e,t){var n={x:e.x-r.x,y:e.y-r.y},o={x:t.x-r.x,y:t.y-r.y};return uu(o,n)/Go(o)/Go(n)},xa=function(r,e,t){return e.y===0?null:{x:r.x+e.x/e.y*(t-r.y),y:t}},Sa=function(r,e,t){return e.x===0?null:{x:t,y:r.y+e.y/e.x*(t-r.x)}},Sc=function(r,e,t,n){if(e.x===0)return Sa(t,n,r.x);if(n.x===0)return Sa(r,e,t.x);if(e.y===0)return xa(t,n,r.y);if(n.y===0)return xa(r,e,t.y);var o=$i(e,n);if(o==0)return null;var a={x:t.x-r.x,y:t.y-r.y},l=$i(a,e)/o,s=$i(a,n)/o,m=r.x+s*e.x,y=t.x+l*n.x,D=r.y+s*e.y,W=t.y+l*n.y,Ee=(m+y)/2,dt=(D+W)/2;return{x:Ee,y:dt}},Yn=function(){Se(r,null,[{key:"compare",value:function(e,t){var n=r.comparePoints(e.point,t.point);return n!==0?n:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:Vo.compare(e.segment,t.segment))}},{key:"comparePoints",value:function(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}}]);function r(e,t){mn(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return Se(r,[{key:"link",value:function(e){if(e.point===this.point)throw new Error("Tried to link already linked events");for(var t=e.point.events,n=0,o=t.length;n<o;n++){var a=t[n];this.point.events.push(a),a.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var e=this.point.events.length,t=0;t<e;t++){var n=this.point.events[t];if(n.segment.consumedBy===void 0)for(var o=t+1;o<e;o++){var a=this.point.events[o];a.consumedBy===void 0&&n.otherSE.point.events===a.otherSE.point.events&&n.segment.consume(a.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var e=[],t=0,n=this.point.events.length;t<n;t++){var o=this.point.events[t];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&e.push(o)}return e}},{key:"getLeftmostComparator",value:function(e){var t=this,n=new Map,o=function(a){var l=a.otherSE;n.set(a,{sine:Nc(t.point,e.point,l.point),cosine:xc(t.point,e.point,l.point)})};return function(a,l){n.has(a)||o(a),n.has(l)||o(l);var s=n.get(a),m=s.sine,y=s.cosine,D=n.get(l),W=D.sine,Ee=D.cosine;return m>=0&&W>=0?y<Ee?1:y>Ee?-1:0:m<0&&W<0?y<Ee?-1:y>Ee?1:0:W<m?-1:W>m?1:0}}}]),r}(),wc=0,Vo=function(){Se(r,null,[{key:"compare",value:function(e,t){var n=e.leftSE.point.x,o=t.leftSE.point.x,a=e.rightSE.point.x,l=t.rightSE.point.x;if(l<n)return 1;if(a<o)return-1;var s=e.leftSE.point.y,m=t.leftSE.point.y,y=e.rightSE.point.y,D=t.rightSE.point.y;if(n<o){if(m<s&&m<y)return 1;if(m>s&&m>y)return-1;var W=e.comparePoint(t.leftSE.point);if(W<0)return 1;if(W>0)return-1;var Ee=t.comparePoint(e.rightSE.point);return Ee!==0?Ee:-1}if(n>o){if(s<m&&s<D)return-1;if(s>m&&s>D)return 1;var dt=t.comparePoint(e.leftSE.point);if(dt!==0)return dt;var Ht=e.comparePoint(t.rightSE.point);return Ht<0?1:Ht>0?-1:1}if(s<m)return-1;if(s>m)return 1;if(a<l){var ir=t.comparePoint(e.rightSE.point);if(ir!==0)return ir}if(a>l){var Hr=e.comparePoint(t.rightSE.point);if(Hr<0)return 1;if(Hr>0)return-1}if(a!==l){var Bn=y-s,Vn=a-n,Wr=D-m,ps=l-o;if(Bn>Vn&&Wr<ps)return 1;if(Bn<Vn&&Wr>ps)return-1}return a>l?1:a<l||y<D?-1:y>D?1:e.id<t.id?-1:e.id>t.id?1:0}}]);function r(e,t,n,o){mn(this,r),this.id=++wc,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=o}return Se(r,[{key:"replaceRightSE",value:function(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}},{key:"comparePoint",value:function(e){if(this.isAnEndpoint(e))return 0;var t=this.leftSE.point,n=this.rightSE.point,o=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;var a=(e.y-t.y)/o.y,l=t.x+a*o.x;if(e.x===l)return 0;var s=(e.x-t.x)/o.x,m=t.y+s*o.y;return e.y===m?0:e.y<m?-1:1}},{key:"getIntersection",value:function(e){var t=this.bbox(),n=e.bbox(),o=Os(t,n);if(o===null)return null;var a=this.leftSE.point,l=this.rightSE.point,s=e.leftSE.point,m=e.rightSE.point,y=ji(t,s)&&this.comparePoint(s)===0,D=ji(n,a)&&e.comparePoint(a)===0,W=ji(t,m)&&this.comparePoint(m)===0,Ee=ji(n,l)&&e.comparePoint(l)===0;if(D&&y)return Ee&&!W?l:!Ee&&W?m:null;if(D)return W&&a.x===m.x&&a.y===m.y?null:a;if(y)return Ee&&l.x===s.x&&l.y===s.y?null:s;if(Ee&&W)return null;if(Ee)return l;if(W)return m;var dt=Sc(a,this.vector(),s,e.vector());return dt===null||!ji(o,dt)?null:no.round(dt.x,dt.y)}},{key:"split",value:function(e){var t=[],n=e.events!==void 0,o=new Yn(e,!0),a=new Yn(e,!1),l=this.rightSE;this.replaceRightSE(a),t.push(a),t.push(o);var s=new r(o,l,this.rings.slice(),this.windings.slice());return Yn.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),Yn.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(o.checkForConsuming(),a.checkForConsuming()),t}},{key:"swapEvents",value:function(){var e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}},{key:"consume",value:function(e){for(var t=this,n=e;t.consumedBy;)t=t.consumedBy;for(;n.consumedBy;)n=n.consumedBy;var o=r.compare(t,n);if(o!==0){if(o>0){var a=t;t=n,n=a}if(t.prev===n){var l=t;t=n,n=l}for(var s=0,m=n.rings.length;s<m;s++){var y=n.rings[s],D=n.windings[s],W=t.rings.indexOf(y);W===-1?(t.rings.push(y),t.windings.push(D)):t.windings[W]+=D}n.rings=null,n.windings=null,n.consumedBy=t,n.leftSE.consumedBy=t.leftSE,n.rightSE.consumedBy=t.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};for(var t=this._afterState.rings,n=this._afterState.windings,o=this._afterState.multiPolys,a=0,l=this.rings.length;a<l;a++){var s=this.rings[a],m=this.windings[a],y=t.indexOf(s);y===-1?(t.push(s),n.push(m)):n[y]+=m}for(var D=[],W=[],Ee=0,dt=t.length;Ee<dt;Ee++)if(n[Ee]!==0){var Ht=t[Ee],ir=Ht.poly;if(W.indexOf(ir)===-1)if(Ht.isExterior)D.push(ir);else{W.indexOf(ir)===-1&&W.push(ir);var Hr=D.indexOf(Ht.poly);Hr!==-1&&D.splice(Hr,1)}}for(var Bn=0,Vn=D.length;Bn<Vn;Bn++){var Wr=D[Bn].multiPoly;o.indexOf(Wr)===-1&&o.push(Wr)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(xn.type){case"union":{var n=e.length===0,o=t.length===0;this._isInResult=n!==o;break}case"intersection":{var a,l;e.length<t.length?(a=e.length,l=t.length):(a=t.length,l=e.length),this._isInResult=l===xn.numMultiPolys&&a<l;break}case"xor":{var s=Math.abs(e.length-t.length);this._isInResult=s%2===1;break}case"difference":{var m=function(y){return y.length===1&&y[0].isSubject};this._isInResult=m(e)!==m(t);break}default:throw new Error("Unrecognized operation type found ".concat(xn.type))}return this._isInResult}}],[{key:"fromRing",value:function(e,t,n){var o,a,l,s=Yn.comparePoints(e,t);if(s<0)o=e,a=t,l=1;else if(s>0)o=t,a=e,l=-1;else throw new Error("Tried to create degenerate segment at [".concat(e.x,", ").concat(e.y,"]"));var m=new Yn(o,!0),y=new Yn(a,!1);return new r(m,y,[n],[l])}}]),r}(),wa=function(){function r(e,t,n){if(mn(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var o=no.round(e[0][0],e[0][1]);this.bbox={ll:{x:o.x,y:o.y},ur:{x:o.x,y:o.y}};for(var a=o,l=1,s=e.length;l<s;l++){if(typeof e[l][0]!="number"||typeof e[l][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var m=no.round(e[l][0],e[l][1]);m.x===a.x&&m.y===a.y||(this.segments.push(Vo.fromRing(a,m,this)),m.x<this.bbox.ll.x&&(this.bbox.ll.x=m.x),m.y<this.bbox.ll.y&&(this.bbox.ll.y=m.y),m.x>this.bbox.ur.x&&(this.bbox.ur.x=m.x),m.y>this.bbox.ur.y&&(this.bbox.ur.y=m.y),a=m)}(o.x!==a.x||o.y!==a.y)&&this.segments.push(Vo.fromRing(a,o,this))}return Se(r,[{key:"getSweepEvents",value:function(){for(var e=[],t=0,n=this.segments.length;t<n;t++){var o=this.segments[t];e.push(o.leftSE),e.push(o.rightSE)}return e}}]),r}(),Lc=function(){function r(e,t){if(mn(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new wa(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,o=e.length;n<o;n++){var a=new wa(e[n],this,!1);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.interiorRings.push(a)}this.multiPoly=t}return Se(r,[{key:"getSweepEvents",value:function(){for(var e=this.exteriorRing.getSweepEvents(),t=0,n=this.interiorRings.length;t<n;t++)for(var o=this.interiorRings[t].getSweepEvents(),a=0,l=o.length;a<l;a++)e.push(o[a]);return e}}]),r}(),La=function(){function r(e,t){if(mn(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,o=e.length;n<o;n++){var a=new Lc(e[n],this);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.polys.push(a)}this.isSubject=t}return Se(r,[{key:"getSweepEvents",value:function(){for(var e=[],t=0,n=this.polys.length;t<n;t++)for(var o=this.polys[t].getSweepEvents(),a=0,l=o.length;a<l;a++)e.push(o[a]);return e}}]),r}(),bc=function(){Se(r,null,[{key:"factory",value:function(e){for(var t=[],n=0,o=e.length;n<o;n++){var a=e[n];if(!(!a.isInResult()||a.ringOut)){for(var l=null,s=a.leftSE,m=a.rightSE,y=[s],D=s.point,W=[];l=s,s=m,y.push(s),s.point!==D;)for(;;){var Ee=s.getAvailableLinkedEvents();if(Ee.length===0){var dt=y[0].point,Ht=y[y.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(dt.x,",")+" ".concat(dt.y,"]. Last matching segment found ends at")+" [".concat(Ht.x,", ").concat(Ht.y,"]."))}if(Ee.length===1){m=Ee[0].otherSE;break}for(var ir=null,Hr=0,Bn=W.length;Hr<Bn;Hr++)if(W[Hr].point===s.point){ir=Hr;break}if(ir!==null){var Vn=W.splice(ir)[0],Wr=y.splice(Vn.index);Wr.unshift(Wr[0].otherSE),t.push(new r(Wr.reverse()));continue}W.push({index:y.length,point:s.point});var ps=s.getLeftmostComparator(l);m=Ee.sort(ps)[0].otherSE;break}t.push(new r(y))}}return t}}]);function r(e){mn(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return Se(r,[{key:"getGeom",value:function(){for(var e=this.events[0].point,t=[e],n=1,o=this.events.length-1;n<o;n++){var a=this.events[n].point,l=this.events[n+1].point;Na(a,e,l)!==0&&(t.push(a),e=a)}if(t.length===1)return null;var s=t[0],m=t[1];Na(s,e,m)===0&&t.shift(),t.push(t[0]);for(var y=this.isExteriorRing()?1:-1,D=this.isExteriorRing()?0:t.length-1,W=this.isExteriorRing()?t.length:-1,Ee=[],dt=D;dt!=W;dt+=y)Ee.push([t[dt].x,t[dt].y]);return Ee}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var e=this.events[0],t=1,n=this.events.length;t<n;t++){var o=this.events[t];Yn.compare(e,o)>0&&(e=o)}for(var a=e.segment.prevInResult(),l=a?a.prevInResult():null;;){if(!a)return null;if(!l)return a.ringOut;if(l.ringOut!==a.ringOut)return l.ringOut.enclosingRing()!==a.ringOut?a.ringOut:a.ringOut.enclosingRing();a=l.prevInResult(),l=a?a.prevInResult():null}}}]),r}(),ba=function(){function r(e){mn(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Se(r,[{key:"addInterior",value:function(e){this.interiorRings.push(e),e.poly=this}},{key:"getGeom",value:function(){var e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(var t=0,n=this.interiorRings.length;t<n;t++){var o=this.interiorRings[t].getGeom();o!==null&&e.push(o)}return e}}]),r}(),Pc=function(){function r(e){mn(this,r),this.rings=e,this.polys=this._composePolys(e)}return Se(r,[{key:"getGeom",value:function(){for(var e=[],t=0,n=this.polys.length;t<n;t++){var o=this.polys[t].getGeom();o!==null&&e.push(o)}return e}},{key:"_composePolys",value:function(e){for(var t=[],n=0,o=e.length;n<o;n++){var a=e[n];if(!a.poly)if(a.isExteriorRing())t.push(new ba(a));else{var l=a.enclosingRing();l.poly||t.push(new ba(l)),l.poly.addInterior(a)}}return t}}]),r}(),Rc=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Vo.compare;mn(this,r),this.queue=e,this.tree=new zs(t),this.segments=[]}return Se(r,[{key:"process",value:function(e){var t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;var o=e.isLeft?this.tree.insert(t):this.tree.find(t);if(!o)throw new Error("Unable to find segment #".concat(t.id," ")+"[".concat(t.leftSE.point.x,", ").concat(t.leftSE.point.y,"] -> ")+"[".concat(t.rightSE.point.x,", ").concat(t.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var a=o,l=o,s=void 0,m=void 0;s===void 0;)a=this.tree.prev(a),a===null?s=null:a.key.consumedBy===void 0&&(s=a.key);for(;m===void 0;)l=this.tree.next(l),l===null?m=null:l.key.consumedBy===void 0&&(m=l.key);if(e.isLeft){var y=null;if(s){var D=s.getIntersection(t);if(D!==null&&(t.isAnEndpoint(D)||(y=D),!s.isAnEndpoint(D)))for(var W=this._splitSafely(s,D),Ee=0,dt=W.length;Ee<dt;Ee++)n.push(W[Ee])}var Ht=null;if(m){var ir=m.getIntersection(t);if(ir!==null&&(t.isAnEndpoint(ir)||(Ht=ir),!m.isAnEndpoint(ir)))for(var Hr=this._splitSafely(m,ir),Bn=0,Vn=Hr.length;Bn<Vn;Bn++)n.push(Hr[Bn])}if(y!==null||Ht!==null){var Wr=null;if(y===null)Wr=Ht;else if(Ht===null)Wr=y;else{var ps=Yn.comparePoints(y,Ht);Wr=ps<=0?y:Ht}this.queue.remove(t.rightSE),n.push(t.rightSE);for(var il=t.split(Wr),gl=0,ml=il.length;gl<ml;gl++)n.push(il[gl])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=s)}else{if(s&&m){var sl=s.getIntersection(m);if(sl!==null){if(!s.isAnEndpoint(sl))for(var ll=this._splitSafely(s,sl),rl=0,th=ll.length;rl<th;rl++)n.push(ll[rl]);if(!m.isAnEndpoint(sl))for(var nh=this._splitSafely(m,sl),bh=0,Fh=nh.length;bh<Fh;bh++)n.push(nh[bh])}}this.tree.remove(t)}return n}},{key:"_splitSafely",value:function(e,t){this.tree.remove(e);var n=e.rightSE;this.queue.remove(n);var o=e.split(t);return o.push(n),e.consumedBy===void 0&&this.tree.insert(e),o}}]),r}(),Pa=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Oc=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Tc=function(){function r(){mn(this,r)}return Se(r,[{key:"run",value:function(e,t,n){xn.type=e,no.reset();for(var o=[new La(t,!0)],a=0,l=n.length;a<l;a++)o.push(new La(n[a],!1));if(xn.numMultiPolys=o.length,xn.type==="difference")for(var s=o[0],m=1;m<o.length;)Os(o[m].bbox,s.bbox)!==null?m++:o.splice(m,1);if(xn.type==="intersection"){for(var y=0,D=o.length;y<D;y++)for(var W=o[y],Ee=y+1,dt=o.length;Ee<dt;Ee++)if(Os(W.bbox,o[Ee].bbox)===null)return[]}for(var Ht=new zs(Yn.compare),ir=0,Hr=o.length;ir<Hr;ir++)for(var Bn=o[ir].getSweepEvents(),Vn=0,Wr=Bn.length;Vn<Wr;Vn++)if(Ht.insert(Bn[Vn]),Ht.size>Pa)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var ps=new Rc(Ht),il=Ht.size,gl=Ht.pop();gl;){var ml=gl.key;if(Ht.size===il){var sl=ml.segment;throw new Error("Unable to pop() ".concat(ml.isLeft?"left":"right"," SweepEvent ")+"[".concat(ml.point.x,", ").concat(ml.point.y,"] from segment #").concat(sl.id," ")+"[".concat(sl.leftSE.point.x,", ").concat(sl.leftSE.point.y,"] -> ")+"[".concat(sl.rightSE.point.x,", ").concat(sl.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(Ht.size>Pa)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(ps.segments.length>Oc)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var ll=ps.process(ml),rl=0,th=ll.length;rl<th;rl++){var nh=ll[rl];nh.consumedBy===void 0&&Ht.insert(nh)}il=Ht.size,gl=Ht.pop()}no.reset();var bh=bc.factory(ps.segments),Fh=new Pc(bh);return Fh.getGeom()}}]),r}(),xn=new Tc,Dc=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return xn.run("union",r,t)},Mc=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return xn.run("intersection",r,t)},Ac=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return xn.run("xor",r,t)},Fc=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return xn.run("difference",r,t)},lu={union:Dc,intersection:Mc,xor:Ac,difference:Fc},Ie=63710088e-1,cu={centimeters:Ie*100,centimetres:Ie*100,degrees:Ie/111325,feet:Ie*3.28084,inches:Ie*39.37,kilometers:Ie/1e3,kilometres:Ie/1e3,meters:Ie,metres:Ie,miles:Ie/1609.344,millimeters:Ie*1e3,millimetres:Ie*1e3,nauticalmiles:Ie/1852,radians:1,yards:Ie*1.0936};function Jo(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Bc(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ra(r[0])||!Ra(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return Jo(n,e,t)}function fu(r,e,t){t===void 0&&(t={});for(var n=0,o=r;n<o.length;n++){var a=o[n];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var l=0;l<a[a.length-1].length;l++)if(a[a.length-1][l]!==a[0][l])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:r};return Jo(s,e,t)}function Ds(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function hu(r,e,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:r};return Jo(n,e,t)}function kc(r,e){e===void 0&&(e="kilometers");var t=cu[e];if(!t)throw new Error(e+" units is invalid");return r*t}function Gc(r,e){e===void 0&&(e="kilometers");var t=cu[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Ra(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function zo(r){return r.type==="Feature"?r.geometry:r}function Vc(r,e,t){t===void 0&&(t={});var n=zo(r),o=zo(e),a=lu.union(n.coordinates,o.coordinates);return a.length===0?null:a.length===1?fu(a[0],t.properties):hu(a,t.properties)}function zc(r){let e,t,n;return{c(){e=Kn("svg"),t=Kn("path"),P(t,"stroke-width","4"),P(t,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),P(t,"class","svelte-gzo3ar"),P(e,"width",n=r[0]==="list"?20:void 0),P(e,"viewBox","0 0 70 85"),P(e,"fill","none"),P(e,"class","svelte-gzo3ar"),on(e,"in-map",r[0]!=="list"),on(e,"list-icon",r[0]==="list")},m(o,a){Dt(o,e,a),nt(e,t)},p(o,[a]){a&1&&n!==(n=o[0]==="list"?20:void 0)&&P(e,"width",n),a&1&&on(e,"in-map",o[0]!=="list"),a&1&&on(e,"list-icon",o[0]==="list")},i:It,o:It,d(o){o&&Tt(e)}}}function Uc(r,e,t){let{displayIn:n}=e;return r.$$set=o=>{"displayIn"in o&&t(0,n=o.displayIn)},[n]}class qc extends qr{constructor(e){super(),Ur(this,e,Uc,zc,zr,{displayIn:0})}}function gu(r,e,t){if(r!==null)for(var n,o,a,l,s,m,y,D=0,W=0,Ee,dt=r.type,Ht=dt==="FeatureCollection",ir=dt==="Feature",Hr=Ht?r.features.length:1,Bn=0;Bn<Hr;Bn++){y=Ht?r.features[Bn].geometry:ir?r.geometry:r,Ee=y?y.type==="GeometryCollection":!1,s=Ee?y.geometries.length:1;for(var Vn=0;Vn<s;Vn++){var Wr=0,ps=0;if(l=Ee?y.geometries[Vn]:y,l!==null){m=l.coordinates;var il=l.type;switch(D=t&&(il==="Polygon"||il==="MultiPolygon")?1:0,il){case null:break;case"Point":if(e(m,W,Bn,Wr,ps)===!1)return!1;W++,Wr++;break;case"LineString":case"MultiPoint":for(n=0;n<m.length;n++){if(e(m[n],W,Bn,Wr,ps)===!1)return!1;W++,il==="MultiPoint"&&Wr++}il==="LineString"&&Wr++;break;case"Polygon":case"MultiLineString":for(n=0;n<m.length;n++){for(o=0;o<m[n].length-D;o++){if(e(m[n][o],W,Bn,Wr,ps)===!1)return!1;W++}il==="MultiLineString"&&Wr++,il==="Polygon"&&ps++}il==="Polygon"&&Wr++;break;case"MultiPolygon":for(n=0;n<m.length;n++){for(ps=0,o=0;o<m[n].length;o++){for(a=0;a<m[n][o].length-D;a++){if(e(m[n][o][a],W,Bn,Wr,ps)===!1)return!1;W++}ps++}Wr++}break;case"GeometryCollection":for(n=0;n<l.geometries.length;n++)if(gu(l.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Oa(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function pu(r,e){var t,n,o,a,l,s,m,y,D,W,Ee=0,dt=r.type==="FeatureCollection",Ht=r.type==="Feature",ir=dt?r.features.length:1;for(t=0;t<ir;t++){for(s=dt?r.features[t].geometry:Ht?r.geometry:r,y=dt?r.features[t].properties:Ht?r.properties:{},D=dt?r.features[t].bbox:Ht?r.bbox:void 0,W=dt?r.features[t].id:Ht?r.id:void 0,m=s?s.type==="GeometryCollection":!1,l=m?s.geometries.length:1,o=0;o<l;o++){if(a=m?s.geometries[o]:s,a===null){if(e(null,Ee,y,D,W)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(a,Ee,y,D,W)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<a.geometries.length;n++)if(e(a.geometries[n],Ee,y,D,W)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}Ee++}}function Ms(r){var e=[1/0,1/0,-1/0,-1/0];return gu(r,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}Ms.default=Ms;function Xc(r,e){e===void 0&&(e={});var t=Ms(r),n=(t[0]+t[2])/2,o=(t[1]+t[3])/2;return Bc([n,o],e.properties,e)}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(r){if(this===void 0||this===null)throw new TypeError(this+" is not an object");var e=Object(this),t=Math.max(Math.min(e.length,9007199254740991),0)||0,n=1 in arguments&&parseInt(Number(arguments[1]),10)||0;n=n<0?Math.max(t+n,0):Math.min(n,t);var o=2 in arguments&&arguments[2]!==void 0?parseInt(Number(arguments[2]),10)||0:t;for(o=o<0?Math.max(t+arguments[2],0):Math.min(o,t);n<o;)e[n]=r,++n;return e},writable:!0});Number.isFinite=Number.isFinite||function(r){return typeof r=="number"&&isFinite(r)};Number.isInteger=Number.isInteger||function(r){return typeof r=="number"&&isFinite(r)&&Math.floor(r)===r};Number.parseFloat=Number.parseFloat||parseFloat;Number.isNaN=Number.isNaN||function(r){return r!==r};Math.trunc=Math.trunc||function(r){return r<0?Math.ceil(r):Math.floor(r)};var Qr=function(){};Qr.prototype.interfaces_=function(){return[]};Qr.prototype.getClass=function(){return Qr};Qr.prototype.equalsWithTolerance=function(r,e,t){return Math.abs(r-e)<=t};var ft=function(r){function e(t){r.call(this,t),this.name="IllegalArgumentException",this.message=t,this.stack=new r().stack}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e}(Error),z=function(){},du={MAX_VALUE:{configurable:!0}};z.isNaN=function(r){return Number.isNaN(r)};z.doubleToLongBits=function(r){return r};z.longBitsToDouble=function(r){return r};z.isInfinite=function(r){return!Number.isFinite(r)};du.MAX_VALUE.get=function(){return Number.MAX_VALUE};Object.defineProperties(z,du);var ke=function(){},$o=function(){},Ci=function(){};function Ge(){}var d=function r(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)this.x=0,this.y=0,this.z=r.NULL_ORDINATE;else if(arguments.length===1){var e=arguments[0];this.x=e.x,this.y=e.y,this.z=e.z}else arguments.length===2?(this.x=arguments[0],this.y=arguments[1],this.z=r.NULL_ORDINATE):arguments.length===3&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},li$1={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};d.prototype.setOrdinate=function(r,e){switch(r){case d.X:this.x=e;break;case d.Y:this.y=e;break;case d.Z:this.z=e;break;default:throw new ft("Invalid ordinate index: "+r)}};d.prototype.equals2D=function(){if(arguments.length===1){var r=arguments[0];return!(this.x!==r.x||this.y!==r.y)}else if(arguments.length===2){var e=arguments[0],t=arguments[1];return!(!Qr.equalsWithTolerance(this.x,e.x,t)||!Qr.equalsWithTolerance(this.y,e.y,t))}};d.prototype.getOrdinate=function(r){switch(r){case d.X:return this.x;case d.Y:return this.y;case d.Z:return this.z}throw new ft("Invalid ordinate index: "+r)};d.prototype.equals3D=function(r){return this.x===r.x&&this.y===r.y&&(this.z===r.z||z.isNaN(this.z))&&z.isNaN(r.z)};d.prototype.equals=function(r){return r instanceof d?this.equals2D(r):!1};d.prototype.equalInZ=function(r,e){return Qr.equalsWithTolerance(this.z,r.z,e)};d.prototype.compareTo=function(r){var e=r;return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0};d.prototype.clone=function(){};d.prototype.copy=function(){return new d(this)};d.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};d.prototype.distance3D=function(r){var e=this.x-r.x,t=this.y-r.y,n=this.z-r.z;return Math.sqrt(e*e+t*t+n*n)};d.prototype.distance=function(r){var e=this.x-r.x,t=this.y-r.y;return Math.sqrt(e*e+t*t)};d.prototype.hashCode=function(){var r=17;return r=37*r+d.hashCode(this.x),r=37*r+d.hashCode(this.y),r};d.prototype.setCoordinate=function(r){this.x=r.x,this.y=r.y,this.z=r.z};d.prototype.interfaces_=function(){return[ke,$o,Ge]};d.prototype.getClass=function(){return d};d.hashCode=function(){if(arguments.length===1){var r=arguments[0],e=z.doubleToLongBits(r);return Math.trunc((e^e)>>>32)}};li$1.DimensionalComparator.get=function(){return sr};li$1.serialVersionUID.get=function(){return 6683108902428367e3};li$1.NULL_ORDINATE.get=function(){return z.NaN};li$1.X.get=function(){return 0};li$1.Y.get=function(){return 1};li$1.Z.get=function(){return 2};Object.defineProperties(d,li$1);var sr=function(r){if(this._dimensionsToTest=2,arguments.length!==0&&arguments.length===1){var e=arguments[0];if(e!==2&&e!==3)throw new ft("only 2 or 3 dimensions may be specified");this._dimensionsToTest=e}};sr.prototype.compare=function(r,e){var t=r,n=e,o=sr.compare(t.x,n.x);if(o!==0)return o;var a=sr.compare(t.y,n.y);if(a!==0)return a;if(this._dimensionsToTest<=2)return 0;var l=sr.compare(t.z,n.z);return l};sr.prototype.interfaces_=function(){return[Ci]};sr.prototype.getClass=function(){return sr};sr.compare=function(r,e){return r<e?-1:r>e?1:z.isNaN(r)?z.isNaN(e)?0:-1:z.isNaN(e)?1:0};var Ni=function(){};Ni.prototype.create=function(){};Ni.prototype.interfaces_=function(){return[]};Ni.prototype.getClass=function(){return Ni};var E=function(){},mo={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};E.prototype.interfaces_=function(){return[]};E.prototype.getClass=function(){return E};E.toLocationSymbol=function(r){switch(r){case E.EXTERIOR:return"e";case E.BOUNDARY:return"b";case E.INTERIOR:return"i";case E.NONE:return"-"}throw new ft("Unknown location value: "+r)};mo.INTERIOR.get=function(){return 0};mo.BOUNDARY.get=function(){return 1};mo.EXTERIOR.get=function(){return 2};mo.NONE.get=function(){return-1};Object.defineProperties(E,mo);var V=function(r,e){return r.interfaces_&&r.interfaces_().indexOf(e)>-1},we=function(){},vu={LOG_10:{configurable:!0}};we.prototype.interfaces_=function(){return[]};we.prototype.getClass=function(){return we};we.log10=function(r){var e=Math.log(r);return z.isInfinite(e)||z.isNaN(e)?e:e/we.LOG_10};we.min=function(r,e,t,n){var o=r;return e<o&&(o=e),t<o&&(o=t),n<o&&(o=n),o};we.clamp=function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var r=arguments[0],e=arguments[1],t=arguments[2];return r<e?e:r>t?t:r}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var n=arguments[0],o=arguments[1],a=arguments[2];return n<o?o:n>a?a:n}};we.wrap=function(r,e){return r<0?e- -r%e:r%e};we.max=function(){if(arguments.length===3){var r=arguments[0],e=arguments[1],t=arguments[2],n=r;return e>n&&(n=e),t>n&&(n=t),n}else if(arguments.length===4){var o=arguments[0],a=arguments[1],l=arguments[2],s=arguments[3],m=o;return a>m&&(m=a),l>m&&(m=l),s>m&&(m=s),m}};we.average=function(r,e){return(r+e)/2};vu.LOG_10.get=function(){return Math.log(10)};Object.defineProperties(we,vu);var _n=function(r){this.str=r};_n.prototype.append=function(r){this.str+=r};_n.prototype.setCharAt=function(r,e){this.str=this.str.substr(0,r)+e+this.str.substr(r+1)};_n.prototype.toString=function(r){return this.str};var un=function(r){this.value=r};un.prototype.intValue=function(){return this.value};un.prototype.compareTo=function(r){return this.value<r?-1:this.value>r?1:0};un.isNaN=function(r){return Number.isNaN(r)};var ro=function(){};ro.isWhitespace=function(r){return r<=32&&r>=0||r===127};ro.toUpperCase=function(r){return r.toUpperCase()};var I=function r(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];this.init(e)}else if(arguments[0]instanceof r){var t=arguments[0];this.init(t)}else if(typeof arguments[0]=="string"){var n=arguments[0];r.call(this,r.parse(n))}}else if(arguments.length===2){var o=arguments[0],a=arguments[1];this.init(o,a)}},Ze={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};I.prototype.le=function(r){return(this._hi<r._hi||this._hi===r._hi)&&this._lo<=r._lo};I.prototype.extractSignificantDigits=function(r,e){var t=this.abs(),n=I.magnitude(t._hi),o=I.TEN.pow(n);t=t.divide(o),t.gt(I.TEN)?(t=t.divide(I.TEN),n+=1):t.lt(I.ONE)&&(t=t.multiply(I.TEN),n-=1);for(var a=n+1,l=new _n,s=I.MAX_PRINT_DIGITS-1,m=0;m<=s;m++){r&&m===a&&l.append(".");var y=Math.trunc(t._hi);if(y<0)break;var D=!1,W=0;y>9?(D=!0,W="9"):W="0"+y,l.append(W),t=t.subtract(I.valueOf(y)).multiply(I.TEN),D&&t.selfAdd(I.TEN);var Ee=!0,dt=I.magnitude(t._hi);if(dt<0&&Math.abs(dt)>=s-m&&(Ee=!1),!Ee)break}return e[0]=n,l.toString()};I.prototype.sqr=function(){return this.multiply(this)};I.prototype.doubleValue=function(){return this._hi+this._lo};I.prototype.subtract=function(){if(arguments[0]instanceof I){var r=arguments[0];return this.add(r.negate())}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.add(-e)}};I.prototype.equals=function(){if(arguments.length===1){var r=arguments[0];return this._hi===r._hi&&this._lo===r._lo}};I.prototype.isZero=function(){return this._hi===0&&this._lo===0};I.prototype.selfSubtract=function(){if(arguments[0]instanceof I){var r=arguments[0];return this.isNaN()?this:this.selfAdd(-r._hi,-r._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e,0)}};I.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null};I.prototype.min=function(r){return this.le(r)?this:r};I.prototype.selfDivide=function(){if(arguments.length===1){if(arguments[0]instanceof I){var r=arguments[0];return this.selfDivide(r._hi,r._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.selfDivide(e,0)}}else if(arguments.length===2){var t=arguments[0],n=arguments[1],o=null,a=null,l=null,s=null,m=null,y=null,D=null,W=null;return m=this._hi/t,y=I.SPLIT*m,o=y-m,W=I.SPLIT*t,o=y-o,a=m-o,l=W-t,D=m*t,l=W-l,s=t-l,W=o*l-D+o*s+a*l+a*s,y=(this._hi-D-W+this._lo-m*n)/t,W=m+y,this._hi=W,this._lo=m-W+y,this}};I.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"};I.prototype.divide=function(){if(arguments[0]instanceof I){var r=arguments[0],e=null,t=null,n=null,o=null,a=null,l=null,s=null,m=null;a=this._hi/r._hi,l=I.SPLIT*a,e=l-a,m=I.SPLIT*r._hi,e=l-e,t=a-e,n=m-r._hi,s=a*r._hi,n=m-n,o=r._hi-n,m=e*n-s+e*o+t*n+t*o,l=(this._hi-s-m+this._lo-a*r._lo)/r._hi,m=a+l;var y=m,D=a-m+l;return new I(y,D)}else if(typeof arguments[0]=="number"){var W=arguments[0];return z.isNaN(W)?I.createNaN():I.copy(this).selfDivide(W,0)}};I.prototype.ge=function(r){return(this._hi>r._hi||this._hi===r._hi)&&this._lo>=r._lo};I.prototype.pow=function(r){if(r===0)return I.valueOf(1);var e=new I(this),t=I.valueOf(1),n=Math.abs(r);if(n>1)for(;n>0;)n%2===1&&t.selfMultiply(e),n/=2,n>0&&(e=e.sqr());else t=e;return r<0?t.reciprocal():t};I.prototype.ceil=function(){if(this.isNaN())return I.NaN;var r=Math.ceil(this._hi),e=0;return r===this._hi&&(e=Math.ceil(this._lo)),new I(r,e)};I.prototype.compareTo=function(r){var e=r;return this._hi<e._hi?-1:this._hi>e._hi?1:this._lo<e._lo?-1:this._lo>e._lo?1:0};I.prototype.rint=function(){if(this.isNaN())return this;var r=this.add(.5);return r.floor()};I.prototype.setValue=function(){if(arguments[0]instanceof I){var r=arguments[0];return this.init(r),this}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.init(e),this}};I.prototype.max=function(r){return this.ge(r)?this:r};I.prototype.sqrt=function(){if(this.isZero())return I.valueOf(0);if(this.isNegative())return I.NaN;var r=1/Math.sqrt(this._hi),e=this._hi*r,t=I.valueOf(e),n=this.subtract(t.sqr()),o=n._hi*(r*.5);return t.add(o)};I.prototype.selfAdd=function(){if(arguments.length===1){if(arguments[0]instanceof I){var r=arguments[0];return this.selfAdd(r._hi,r._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0],t=null,n=null,o=null,a=null,l=null,s=null;return o=this._hi+e,l=o-this._hi,a=o-l,a=e-l+(this._hi-a),s=a+this._lo,t=o+s,n=s+(o-t),this._hi=t+n,this._lo=n+(t-this._hi),this}}else if(arguments.length===2){var m=arguments[0],y=arguments[1],D=null,W=null,Ee=null,dt=null,Ht=null,ir=null,Hr=null,Bn=null;Ht=this._hi+m,Ee=this._lo+y,Hr=Ht-this._hi,Bn=Ee-this._lo,ir=Ht-Hr,dt=Ee-Bn,ir=m-Hr+(this._hi-ir),dt=y-Bn+(this._lo-dt),Hr=ir+Ee,D=Ht+Hr,W=Hr+(Ht-D),Hr=dt+W;var Vn=D+Hr,Wr=Hr+(D-Vn);return this._hi=Vn,this._lo=Wr,this}};I.prototype.selfMultiply=function(){if(arguments.length===1){if(arguments[0]instanceof I){var r=arguments[0];return this.selfMultiply(r._hi,r._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.selfMultiply(e,0)}}else if(arguments.length===2){var t=arguments[0],n=arguments[1],o=null,a=null,l=null,s=null,m=null,y=null;m=I.SPLIT*this._hi,o=m-this._hi,y=I.SPLIT*t,o=m-o,a=this._hi-o,l=y-t,m=this._hi*t,l=y-l,s=t-l,y=o*l-m+o*s+a*l+a*s+(this._hi*n+this._lo*t);var D=m+y;o=m-D;var W=y+o;return this._hi=D,this._lo=W,this}};I.prototype.selfSqr=function(){return this.selfMultiply(this)};I.prototype.floor=function(){if(this.isNaN())return I.NaN;var r=Math.floor(this._hi),e=0;return r===this._hi&&(e=Math.floor(this._lo)),new I(r,e)};I.prototype.negate=function(){return this.isNaN()?this:new I(-this._hi,-this._lo)};I.prototype.clone=function(){};I.prototype.multiply=function(){if(arguments[0]instanceof I){var r=arguments[0];return r.isNaN()?I.createNaN():I.copy(this).selfMultiply(r)}else if(typeof arguments[0]=="number"){var e=arguments[0];return z.isNaN(e)?I.createNaN():I.copy(this).selfMultiply(e,0)}};I.prototype.isNaN=function(){return z.isNaN(this._hi)};I.prototype.intValue=function(){return Math.trunc(this._hi)};I.prototype.toString=function(){var r=I.magnitude(this._hi);return r>=-3&&r<=20?this.toStandardNotation():this.toSciNotation()};I.prototype.toStandardNotation=function(){var r=this.getSpecialNumberString();if(r!==null)return r;var e=new Array(1).fill(null),t=this.extractSignificantDigits(!0,e),n=e[0]+1,o=t;if(t.charAt(0)===".")o="0"+t;else if(n<0)o="0."+I.stringOfChar("0",-n)+t;else if(t.indexOf(".")===-1){var a=n-t.length,l=I.stringOfChar("0",a);o=t+l+".0"}return this.isNegative()?"-"+o:o};I.prototype.reciprocal=function(){var r=null,e=null,t=null,n=null,o=null,a=null,l=null,s=null;o=1/this._hi,a=I.SPLIT*o,r=a-o,s=I.SPLIT*this._hi,r=a-r,e=o-r,t=s-this._hi,l=o*this._hi,t=s-t,n=this._hi-t,s=r*t-l+r*n+e*t+e*n,a=(1-l-s-o*this._lo)/this._hi;var m=o+a,y=o-m+a;return new I(m,y)};I.prototype.toSciNotation=function(){if(this.isZero())return I.SCI_NOT_ZERO;var r=this.getSpecialNumberString();if(r!==null)return r;var e=new Array(1).fill(null),t=this.extractSignificantDigits(!1,e),n=I.SCI_NOT_EXPONENT_CHAR+e[0];if(t.charAt(0)==="0")throw new Error("Found leading zero: "+t);var o="";t.length>1&&(o=t.substring(1));var a=t.charAt(0)+"."+o;return this.isNegative()?"-"+a+n:a+n};I.prototype.abs=function(){return this.isNaN()?I.NaN:this.isNegative()?this.negate():new I(this)};I.prototype.isPositive=function(){return(this._hi>0||this._hi===0)&&this._lo>0};I.prototype.lt=function(r){return(this._hi<r._hi||this._hi===r._hi)&&this._lo<r._lo};I.prototype.add=function(){if(arguments[0]instanceof I){var r=arguments[0];return I.copy(this).selfAdd(r)}else if(typeof arguments[0]=="number"){var e=arguments[0];return I.copy(this).selfAdd(e)}};I.prototype.init=function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var r=arguments[0];this._hi=r,this._lo=0}else if(arguments[0]instanceof I){var e=arguments[0];this._hi=e._hi,this._lo=e._lo}}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this._hi=t,this._lo=n}};I.prototype.gt=function(r){return(this._hi>r._hi||this._hi===r._hi)&&this._lo>r._lo};I.prototype.isNegative=function(){return(this._hi<0||this._hi===0)&&this._lo<0};I.prototype.trunc=function(){return this.isNaN()?I.NaN:this.isPositive()?this.floor():this.ceil()};I.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0};I.prototype.interfaces_=function(){return[Ge,ke,$o]};I.prototype.getClass=function(){return I};I.sqr=function(r){return I.valueOf(r).selfMultiply(r)};I.valueOf=function(){if(typeof arguments[0]=="string"){var r=arguments[0];return I.parse(r)}else if(typeof arguments[0]=="number"){var e=arguments[0];return new I(e)}};I.sqrt=function(r){return I.valueOf(r).sqrt()};I.parse=function(r){for(var e=0,t=r.length;ro.isWhitespace(r.charAt(e));)e++;var n=!1;if(e<t){var o=r.charAt(e);(o==="-"||o==="+")&&(e++,o==="-"&&(n=!0))}for(var a=new I,l=0,s=0,m=0;!(e>=t);){var y=r.charAt(e);if(e++,ro.isDigit(y)){var D=y-"0";a.selfMultiply(I.TEN),a.selfAdd(D),l++;continue}if(y==="."){s=l;continue}if(y==="e"||y==="E"){var W=r.substring(e);try{m=un.parseInt(W)}catch(Hr){throw Hr instanceof Error?new Error("Invalid exponent "+W+" in string "+r):Hr}finally{}break}throw new Error("Unexpected character '"+y+"' at position "+e+" in string "+r)}var Ee=a,dt=l-s-m;if(dt===0)Ee=a;else if(dt>0){var Ht=I.TEN.pow(dt);Ee=a.divide(Ht)}else if(dt<0){var ir=I.TEN.pow(-dt);Ee=a.multiply(ir)}return n?Ee.negate():Ee};I.createNaN=function(){return new I(z.NaN,z.NaN)};I.copy=function(r){return new I(r)};I.magnitude=function(r){var e=Math.abs(r),t=Math.log(e)/Math.log(10),n=Math.trunc(Math.floor(t)),o=Math.pow(10,n);return o*10<=e&&(n+=1),n};I.stringOfChar=function(r,e){for(var t=new _n,n=0;n<e;n++)t.append(r);return t.toString()};Ze.PI.get=function(){return new I(3.141592653589793,12246467991473532e-32)};Ze.TWO_PI.get=function(){return new I(6.283185307179586,24492935982947064e-32)};Ze.PI_2.get=function(){return new I(1.5707963267948966,6123233995736766e-32)};Ze.E.get=function(){return new I(2.718281828459045,14456468917292502e-32)};Ze.NaN.get=function(){return new I(z.NaN,z.NaN)};Ze.EPS.get=function(){return 123259516440783e-46};Ze.SPLIT.get=function(){return 134217729};Ze.MAX_PRINT_DIGITS.get=function(){return 32};Ze.TEN.get=function(){return I.valueOf(10)};Ze.ONE.get=function(){return I.valueOf(1)};Ze.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"};Ze.SCI_NOT_ZERO.get=function(){return"0.0E0"};Object.defineProperties(I,Ze);var ce=function(){},yu={DP_SAFE_EPSILON:{configurable:!0}};ce.prototype.interfaces_=function(){return[]};ce.prototype.getClass=function(){return ce};ce.orientationIndex=function(r,e,t){var n=ce.orientationIndexFilter(r,e,t);if(n<=1)return n;var o=I.valueOf(e.x).selfAdd(-r.x),a=I.valueOf(e.y).selfAdd(-r.y),l=I.valueOf(t.x).selfAdd(-e.x),s=I.valueOf(t.y).selfAdd(-e.y);return o.selfMultiply(s).selfSubtract(a.selfMultiply(l)).signum()};ce.signOfDet2x2=function(r,e,t,n){var o=r.multiply(n).selfSubtract(e.multiply(t));return o.signum()};ce.intersection=function(r,e,t,n){var o=I.valueOf(n.y).selfSubtract(t.y).selfMultiply(I.valueOf(e.x).selfSubtract(r.x)),a=I.valueOf(n.x).selfSubtract(t.x).selfMultiply(I.valueOf(e.y).selfSubtract(r.y)),l=o.subtract(a),s=I.valueOf(n.x).selfSubtract(t.x).selfMultiply(I.valueOf(r.y).selfSubtract(t.y)),m=I.valueOf(n.y).selfSubtract(t.y).selfMultiply(I.valueOf(r.x).selfSubtract(t.x)),y=s.subtract(m),D=y.selfDivide(l).doubleValue(),W=I.valueOf(r.x).selfAdd(I.valueOf(e.x).selfSubtract(r.x).selfMultiply(D)).doubleValue(),Ee=I.valueOf(e.x).selfSubtract(r.x).selfMultiply(I.valueOf(r.y).selfSubtract(t.y)),dt=I.valueOf(e.y).selfSubtract(r.y).selfMultiply(I.valueOf(r.x).selfSubtract(t.x)),Ht=Ee.subtract(dt),ir=Ht.selfDivide(l).doubleValue(),Hr=I.valueOf(t.y).selfAdd(I.valueOf(n.y).selfSubtract(t.y).selfMultiply(ir)).doubleValue();return new d(W,Hr)};ce.orientationIndexFilter=function(r,e,t){var n=null,o=(r.x-t.x)*(e.y-t.y),a=(r.y-t.y)*(e.x-t.x),l=o-a;if(o>0){if(a<=0)return ce.signum(l);n=o+a}else if(o<0){if(a>=0)return ce.signum(l);n=-o-a}else return ce.signum(l);var s=ce.DP_SAFE_EPSILON*n;return l>=s||-l>=s?ce.signum(l):2};ce.signum=function(r){return r>0?1:r<0?-1:0};yu.DP_SAFE_EPSILON.get=function(){return 1e-15};Object.defineProperties(ce,yu);var Q=function(){},_o={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};_o.X.get=function(){return 0};_o.Y.get=function(){return 1};_o.Z.get=function(){return 2};_o.M.get=function(){return 3};Q.prototype.setOrdinate=function(r,e,t){};Q.prototype.size=function(){};Q.prototype.getOrdinate=function(r,e){};Q.prototype.getCoordinate=function(){};Q.prototype.getCoordinateCopy=function(r){};Q.prototype.getDimension=function(){};Q.prototype.getX=function(r){};Q.prototype.clone=function(){};Q.prototype.expandEnvelope=function(r){};Q.prototype.copy=function(){};Q.prototype.getY=function(r){};Q.prototype.toCoordinateArray=function(){};Q.prototype.interfaces_=function(){return[$o]};Q.prototype.getClass=function(){return Q};Object.defineProperties(Q,_o);var mu=function(){},qi=function(r){function e(){r.call(this,"Projective point not representable on the Cartesian plane.")}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(mu),qt=function(){};qt.arraycopy=function(r,e,t,n,o){for(var a=0,l=e;l<e+o;l++)t[n+a]=r[l],a++};qt.getProperty=function(r){return{"line.separator":`
`}[r]};var Ue=function r(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var e=arguments[0];this.x=e.x,this.y=e.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],n=arguments[1];this.x=t,this.y=n,this.w=1}else if(arguments[0]instanceof r&&arguments[1]instanceof r){var o=arguments[0],a=arguments[1];this.x=o.y*a.w-a.y*o.w,this.y=a.x*o.w-o.x*a.w,this.w=o.x*a.y-a.x*o.y}else if(arguments[0]instanceof d&&arguments[1]instanceof d){var l=arguments[0],s=arguments[1];this.x=l.y-s.y,this.y=s.x-l.x,this.w=l.x*s.y-s.x*l.y}}else if(arguments.length===3){var m=arguments[0],y=arguments[1],D=arguments[2];this.x=m,this.y=y,this.w=D}else if(arguments.length===4){var W=arguments[0],Ee=arguments[1],dt=arguments[2],Ht=arguments[3],ir=W.y-Ee.y,Hr=Ee.x-W.x,Bn=W.x*Ee.y-Ee.x*W.y,Vn=dt.y-Ht.y,Wr=Ht.x-dt.x,ps=dt.x*Ht.y-Ht.x*dt.y;this.x=Hr*ps-Wr*Bn,this.y=Vn*Bn-ir*ps,this.w=ir*Wr-Vn*Hr}};Ue.prototype.getY=function(){var r=this.y/this.w;if(z.isNaN(r)||z.isInfinite(r))throw new qi;return r};Ue.prototype.getX=function(){var r=this.x/this.w;if(z.isNaN(r)||z.isInfinite(r))throw new qi;return r};Ue.prototype.getCoordinate=function(){var r=new d;return r.x=this.getX(),r.y=this.getY(),r};Ue.prototype.interfaces_=function(){return[]};Ue.prototype.getClass=function(){return Ue};Ue.intersection=function(r,e,t,n){var o=r.y-e.y,a=e.x-r.x,l=r.x*e.y-e.x*r.y,s=t.y-n.y,m=n.x-t.x,y=t.x*n.y-n.x*t.y,D=a*y-m*l,W=s*l-o*y,Ee=o*m-s*a,dt=D/Ee,Ht=W/Ee;if(z.isNaN(dt)||z.isInfinite(dt)||z.isNaN(Ht)||z.isInfinite(Ht))throw new qi;return new d(dt,Ht)};var B=function r(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof d){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof r){var t=arguments[0];this.init(t)}}else if(arguments.length===2){var n=arguments[0],o=arguments[1];this.init(n.x,o.x,n.y,o.y)}else if(arguments.length===4){var a=arguments[0],l=arguments[1],s=arguments[2],m=arguments[3];this.init(a,l,s,m)}},_u={serialVersionUID:{configurable:!0}};B.prototype.getArea=function(){return this.getWidth()*this.getHeight()};B.prototype.equals=function(r){if(!(r instanceof B))return!1;var e=r;return this.isNull()?e.isNull():this._maxx===e.getMaxX()&&this._maxy===e.getMaxY()&&this._minx===e.getMinX()&&this._miny===e.getMinY()};B.prototype.intersection=function(r){if(this.isNull()||r.isNull()||!this.intersects(r))return new B;var e=this._minx>r._minx?this._minx:r._minx,t=this._miny>r._miny?this._miny:r._miny,n=this._maxx<r._maxx?this._maxx:r._maxx,o=this._maxy<r._maxy?this._maxy:r._maxy;return new B(e,n,t,o)};B.prototype.isNull=function(){return this._maxx<this._minx};B.prototype.getMaxX=function(){return this._maxx};B.prototype.covers=function(){if(arguments.length===1){if(arguments[0]instanceof d){var r=arguments[0];return this.covers(r.x,r.y)}else if(arguments[0]instanceof B){var e=arguments[0];return this.isNull()||e.isNull()?!1:e.getMinX()>=this._minx&&e.getMaxX()<=this._maxx&&e.getMinY()>=this._miny&&e.getMaxY()<=this._maxy}}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return this.isNull()?!1:t>=this._minx&&t<=this._maxx&&n>=this._miny&&n<=this._maxy}};B.prototype.intersects=function(){if(arguments.length===1){if(arguments[0]instanceof B){var r=arguments[0];return this.isNull()||r.isNull()?!1:!(r._minx>this._maxx||r._maxx<this._minx||r._miny>this._maxy||r._maxy<this._miny)}else if(arguments[0]instanceof d){var e=arguments[0];return this.intersects(e.x,e.y)}}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return this.isNull()?!1:!(t>this._maxx||t<this._minx||n>this._maxy||n<this._miny)}};B.prototype.getMinY=function(){return this._miny};B.prototype.getMinX=function(){return this._minx};B.prototype.expandToInclude=function(){if(arguments.length===1){if(arguments[0]instanceof d){var r=arguments[0];this.expandToInclude(r.x,r.y)}else if(arguments[0]instanceof B){var e=arguments[0];if(e.isNull())return null;this.isNull()?(this._minx=e.getMinX(),this._maxx=e.getMaxX(),this._miny=e.getMinY(),this._maxy=e.getMaxY()):(e._minx<this._minx&&(this._minx=e._minx),e._maxx>this._maxx&&(this._maxx=e._maxx),e._miny<this._miny&&(this._miny=e._miny),e._maxy>this._maxy&&(this._maxy=e._maxy))}}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this.isNull()?(this._minx=t,this._maxx=t,this._miny=n,this._maxy=n):(t<this._minx&&(this._minx=t),t>this._maxx&&(this._maxx=t),n<this._miny&&(this._miny=n),n>this._maxy&&(this._maxy=n))}};B.prototype.minExtent=function(){if(this.isNull())return 0;var r=this.getWidth(),e=this.getHeight();return r<e?r:e};B.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx};B.prototype.compareTo=function(r){var e=r;return this.isNull()?e.isNull()?0:-1:e.isNull()?1:this._minx<e._minx?-1:this._minx>e._minx?1:this._miny<e._miny?-1:this._miny>e._miny?1:this._maxx<e._maxx?-1:this._maxx>e._maxx?1:this._maxy<e._maxy?-1:this._maxy>e._maxy?1:0};B.prototype.translate=function(r,e){if(this.isNull())return null;this.init(this.getMinX()+r,this.getMaxX()+r,this.getMinY()+e,this.getMaxY()+e)};B.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"};B.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1};B.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny};B.prototype.maxExtent=function(){if(this.isNull())return 0;var r=this.getWidth(),e=this.getHeight();return r>e?r:e};B.prototype.expandBy=function(){if(arguments.length===1){var r=arguments[0];this.expandBy(r,r)}else if(arguments.length===2){var e=arguments[0],t=arguments[1];if(this.isNull())return null;this._minx-=e,this._maxx+=e,this._miny-=t,this._maxy+=t,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}};B.prototype.contains=function(){if(arguments.length===1){if(arguments[0]instanceof B){var r=arguments[0];return this.covers(r)}else if(arguments[0]instanceof d){var e=arguments[0];return this.covers(e)}}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return this.covers(t,n)}};B.prototype.centre=function(){return this.isNull()?null:new d((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)};B.prototype.init=function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof d){var r=arguments[0];this.init(r.x,r.x,r.y,r.y)}else if(arguments[0]instanceof B){var e=arguments[0];this._minx=e._minx,this._maxx=e._maxx,this._miny=e._miny,this._maxy=e._maxy}}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this.init(t.x,n.x,t.y,n.y)}else if(arguments.length===4){var o=arguments[0],a=arguments[1],l=arguments[2],s=arguments[3];o<a?(this._minx=o,this._maxx=a):(this._minx=a,this._maxx=o),l<s?(this._miny=l,this._maxy=s):(this._miny=s,this._maxy=l)}};B.prototype.getMaxY=function(){return this._maxy};B.prototype.distance=function(r){if(this.intersects(r))return 0;var e=0;this._maxx<r._minx?e=r._minx-this._maxx:this._minx>r._maxx&&(e=this._minx-r._maxx);var t=0;return this._maxy<r._miny?t=r._miny-this._maxy:this._miny>r._maxy&&(t=this._miny-r._maxy),e===0?t:t===0?e:Math.sqrt(e*e+t*t)};B.prototype.hashCode=function(){var r=17;return r=37*r+d.hashCode(this._minx),r=37*r+d.hashCode(this._maxx),r=37*r+d.hashCode(this._miny),r=37*r+d.hashCode(this._maxy),r};B.prototype.interfaces_=function(){return[ke,Ge]};B.prototype.getClass=function(){return B};B.intersects=function(){if(arguments.length===3){var r=arguments[0],e=arguments[1],t=arguments[2];return t.x>=(r.x<e.x?r.x:e.x)&&t.x<=(r.x>e.x?r.x:e.x)&&t.y>=(r.y<e.y?r.y:e.y)&&t.y<=(r.y>e.y?r.y:e.y)}else if(arguments.length===4){var n=arguments[0],o=arguments[1],a=arguments[2],l=arguments[3],s=Math.min(a.x,l.x),m=Math.max(a.x,l.x),y=Math.min(n.x,o.x),D=Math.max(n.x,o.x);return!(y>m||D<s||(s=Math.min(a.y,l.y),m=Math.max(a.y,l.y),y=Math.min(n.y,o.y),D=Math.max(n.y,o.y),y>m)||D<s)}};_u.serialVersionUID.get=function(){return 5873921885273102e3};Object.defineProperties(B,_u);var $e={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},ts=function(r){this.geometryFactory=r||new H};ts.prototype.read=function(r){var e,t,n;r=r.replace(/[\n\r]/g," ");var o=$e.typeStr.exec(r);if(r.search("EMPTY")!==-1&&(o=$e.emptyTypeStr.exec(r),o[2]=void 0),o&&(t=o[1].toLowerCase(),n=o[2],Ei[t]&&(e=Ei[t].apply(this,[n]))),e===void 0)throw new Error("Could not parse WKT "+r);return e};ts.prototype.write=function(r){return this.extractGeometry(r)};ts.prototype.extractGeometry=function(r){var e=r.getGeometryType().toLowerCase();if(!qn[e])return null;var t=e.toUpperCase(),n;return r.isEmpty()?n=t+" EMPTY":n=t+"("+qn[e].apply(this,[r])+")",n};var qn={coordinate:function(r){return r.x+" "+r.y},point:function(r){return qn.coordinate.call(this,r._coordinates._coordinates[0])},multipoint:function(r){for(var e=this,t=[],n=0,o=r._geometries.length;n<o;++n)t.push("("+qn.point.apply(e,[r._geometries[n]])+")");return t.join(",")},linestring:function(r){for(var e=this,t=[],n=0,o=r._points._coordinates.length;n<o;++n)t.push(qn.coordinate.apply(e,[r._points._coordinates[n]]));return t.join(",")},linearring:function(r){for(var e=this,t=[],n=0,o=r._points._coordinates.length;n<o;++n)t.push(qn.coordinate.apply(e,[r._points._coordinates[n]]));return t.join(",")},multilinestring:function(r){for(var e=this,t=[],n=0,o=r._geometries.length;n<o;++n)t.push("("+qn.linestring.apply(e,[r._geometries[n]])+")");return t.join(",")},polygon:function(r){var e=this,t=[];t.push("("+qn.linestring.apply(this,[r._shell])+")");for(var n=0,o=r._holes.length;n<o;++n)t.push("("+qn.linestring.apply(e,[r._holes[n]])+")");return t.join(",")},multipolygon:function(r){for(var e=this,t=[],n=0,o=r._geometries.length;n<o;++n)t.push("("+qn.polygon.apply(e,[r._geometries[n]])+")");return t.join(",")},geometrycollection:function(r){for(var e=this,t=[],n=0,o=r._geometries.length;n<o;++n)t.push(e.extractGeometry(r._geometries[n]));return t.join(",")}},Ei={point:function(r){if(r===void 0)return this.geometryFactory.createPoint();var e=r.trim().split($e.spaces);return this.geometryFactory.createPoint(new d(Number.parseFloat(e[0]),Number.parseFloat(e[1])))},multipoint:function(r){var e=this;if(r===void 0)return this.geometryFactory.createMultiPoint();for(var t,n=r.trim().split(","),o=[],a=0,l=n.length;a<l;++a)t=n[a].replace($e.trimParens,"$1"),o.push(Ei.point.apply(e,[t]));return this.geometryFactory.createMultiPoint(o)},linestring:function(r){if(r===void 0)return this.geometryFactory.createLineString();for(var e=r.trim().split(","),t=[],n,o=0,a=e.length;o<a;++o)n=e[o].trim().split($e.spaces),t.push(new d(Number.parseFloat(n[0]),Number.parseFloat(n[1])));return this.geometryFactory.createLineString(t)},linearring:function(r){if(r===void 0)return this.geometryFactory.createLinearRing();for(var e=r.trim().split(","),t=[],n,o=0,a=e.length;o<a;++o)n=e[o].trim().split($e.spaces),t.push(new d(Number.parseFloat(n[0]),Number.parseFloat(n[1])));return this.geometryFactory.createLinearRing(t)},multilinestring:function(r){var e=this;if(r===void 0)return this.geometryFactory.createMultiLineString();for(var t,n=r.trim().split($e.parenComma),o=[],a=0,l=n.length;a<l;++a)t=n[a].replace($e.trimParens,"$1"),o.push(Ei.linestring.apply(e,[t]));return this.geometryFactory.createMultiLineString(o)},polygon:function(r){var e=this;if(r===void 0)return this.geometryFactory.createPolygon();for(var t,n,o,a=r.trim().split($e.parenComma),l,s=[],m=0,y=a.length;m<y;++m)t=a[m].replace($e.trimParens,"$1"),n=Ei.linestring.apply(e,[t]),o=e.geometryFactory.createLinearRing(n._points),m===0?l=o:s.push(o);return this.geometryFactory.createPolygon(l,s)},multipolygon:function(r){var e=this;if(r===void 0)return this.geometryFactory.createMultiPolygon();for(var t,n=r.trim().split($e.doubleParenComma),o=[],a=0,l=n.length;a<l;++a)t=n[a].replace($e.trimParens,"$1"),o.push(Ei.polygon.apply(e,[t]));return this.geometryFactory.createMultiPolygon(o)},geometrycollection:function(r){var e=this;if(r===void 0)return this.geometryFactory.createGeometryCollection();r=r.replace(/,\s*([A-Za-z])/g,"|$1");for(var t=r.trim().split("|"),n=[],o=0,a=t.length;o<a;++o)n.push(e.read(t[o]));return this.geometryFactory.createGeometryCollection(n)}},Xe=function(r){this.parser=new ts(r)};Xe.prototype.write=function(r){return this.parser.write(r)};Xe.toLineString=function(r,e){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+r.x+" "+r.y+", "+e.x+" "+e.y+" )"};var Qn=function(r){function e(t){r.call(this,t),this.name="RuntimeException",this.message=t,this.stack=new r().stack}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e}(Error),Uo=function(r){function e(){if(r.call(this),arguments.length===0)r.call(this);else if(arguments.length===1){var t=arguments[0];r.call(this,t)}}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Qn),q=function(){};q.prototype.interfaces_=function(){return[]};q.prototype.getClass=function(){return q};q.shouldNeverReachHere=function(){if(arguments.length===0)q.shouldNeverReachHere(null);else if(arguments.length===1){var r=arguments[0];throw new Uo("Should never reach here"+(r!==null?": "+r:""))}};q.isTrue=function(){var r,e;if(arguments.length===1)r=arguments[0],q.isTrue(r,null);else if(arguments.length===2&&(r=arguments[0],e=arguments[1],!r))throw e===null?new Uo:new Uo(e)};q.equals=function(){var r,e,t;if(arguments.length===2)r=arguments[0],e=arguments[1],q.equals(r,e,null);else if(arguments.length===3&&(r=arguments[0],e=arguments[1],t=arguments[2],!e.equals(r)))throw new Uo("Expected "+r+" but encountered "+e+(t!==null?": "+t:""))};var gt=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new d,this._intPt[1]=new d,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},ci={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};gt.prototype.getIndexAlongSegment=function(r,e){return this.computeIntLineIndex(),this._intLineIndex[r][e]};gt.prototype.getTopologySummary=function(){var r=new _n;return this.isEndPoint()&&r.append(" endpoint"),this._isProper&&r.append(" proper"),this.isCollinear()&&r.append(" collinear"),r.toString()};gt.prototype.computeIntersection=function(r,e,t,n){this._inputLines[0][0]=r,this._inputLines[0][1]=e,this._inputLines[1][0]=t,this._inputLines[1][1]=n,this._result=this.computeIntersect(r,e,t,n)};gt.prototype.getIntersectionNum=function(){return this._result};gt.prototype.computeIntLineIndex=function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var r=arguments[0],e=this.getEdgeDistance(r,0),t=this.getEdgeDistance(r,1);e>t?(this._intLineIndex[r][0]=0,this._intLineIndex[r][1]=1):(this._intLineIndex[r][0]=1,this._intLineIndex[r][1]=0)}};gt.prototype.isProper=function(){return this.hasIntersection()&&this._isProper};gt.prototype.setPrecisionModel=function(r){this._precisionModel=r};gt.prototype.isInteriorIntersection=function(){var r=this;if(arguments.length===0)return!!(this.isInteriorIntersection(0)||this.isInteriorIntersection(1));if(arguments.length===1){for(var e=arguments[0],t=0;t<this._result;t++)if(!(r._intPt[t].equals2D(r._inputLines[e][0])||r._intPt[t].equals2D(r._inputLines[e][1])))return!0;return!1}};gt.prototype.getIntersection=function(r){return this._intPt[r]};gt.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper};gt.prototype.hasIntersection=function(){return this._result!==gt.NO_INTERSECTION};gt.prototype.getEdgeDistance=function(r,e){var t=gt.computeEdgeDistance(this._intPt[e],this._inputLines[r][0],this._inputLines[r][1]);return t};gt.prototype.isCollinear=function(){return this._result===gt.COLLINEAR_INTERSECTION};gt.prototype.toString=function(){return Xe.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Xe.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()};gt.prototype.getEndpoint=function(r,e){return this._inputLines[r][e]};gt.prototype.isIntersection=function(r){for(var e=this,t=0;t<this._result;t++)if(e._intPt[t].equals2D(r))return!0;return!1};gt.prototype.getIntersectionAlongSegment=function(r,e){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[r][e]]};gt.prototype.interfaces_=function(){return[]};gt.prototype.getClass=function(){return gt};gt.computeEdgeDistance=function(r,e,t){var n=Math.abs(t.x-e.x),o=Math.abs(t.y-e.y),a=-1;if(r.equals(e))a=0;else if(r.equals(t))n>o?a=n:a=o;else{var l=Math.abs(r.x-e.x),s=Math.abs(r.y-e.y);n>o?a=l:a=s,a===0&&!r.equals(e)&&(a=Math.max(l,s))}return q.isTrue(!(a===0&&!r.equals(e)),"Bad distance calculation"),a};gt.nonRobustComputeEdgeDistance=function(r,e,t){var n=r.x-e.x,o=r.y-e.y,a=Math.sqrt(n*n+o*o);return q.isTrue(!(a===0&&!r.equals(e)),"Invalid distance calculation"),a};ci.DONT_INTERSECT.get=function(){return 0};ci.DO_INTERSECT.get=function(){return 1};ci.COLLINEAR.get=function(){return 2};ci.NO_INTERSECTION.get=function(){return 0};ci.POINT_INTERSECTION.get=function(){return 1};ci.COLLINEAR_INTERSECTION.get=function(){return 2};Object.defineProperties(gt,ci);var Xr=function(r){function e(){r.apply(this,arguments)}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.isInSegmentEnvelopes=function(t){var n=new B(this._inputLines[0][0],this._inputLines[0][1]),o=new B(this._inputLines[1][0],this._inputLines[1][1]);return n.contains(t)&&o.contains(t)},e.prototype.computeIntersection=function(){if(arguments.length===3){var t=arguments[0],n=arguments[1],o=arguments[2];if(this._isProper=!1,B.intersects(n,o,t)&&M.orientationIndex(n,o,t)===0&&M.orientationIndex(o,n,t)===0)return this._isProper=!0,(t.equals(n)||t.equals(o))&&(this._isProper=!1),this._result=r.POINT_INTERSECTION,null;this._result=r.NO_INTERSECTION}else return r.prototype.computeIntersection.apply(this,arguments)},e.prototype.normalizeToMinimum=function(t,n,o,a,l){l.x=this.smallestInAbsValue(t.x,n.x,o.x,a.x),l.y=this.smallestInAbsValue(t.y,n.y,o.y,a.y),t.x-=l.x,t.y-=l.y,n.x-=l.x,n.y-=l.y,o.x-=l.x,o.y-=l.y,a.x-=l.x,a.y-=l.y},e.prototype.safeHCoordinateIntersection=function(t,n,o,a){var l=null;try{l=Ue.intersection(t,n,o,a)}catch(s){if(s instanceof qi)l=e.nearestEndpoint(t,n,o,a);else throw s}finally{}return l},e.prototype.intersection=function(t,n,o,a){var l=this.intersectionWithNormalization(t,n,o,a);return this.isInSegmentEnvelopes(l)||(l=new d(e.nearestEndpoint(t,n,o,a))),this._precisionModel!==null&&this._precisionModel.makePrecise(l),l},e.prototype.smallestInAbsValue=function(t,n,o,a){var l=t,s=Math.abs(l);return Math.abs(n)<s&&(l=n,s=Math.abs(n)),Math.abs(o)<s&&(l=o,s=Math.abs(o)),Math.abs(a)<s&&(l=a),l},e.prototype.checkDD=function(t,n,o,a,l){var s=ce.intersection(t,n,o,a),m=this.isInSegmentEnvelopes(s);qt.out.println("DD in env = "+m+"  --------------------- "+s),l.distance(s)>1e-4&&qt.out.println("Distance = "+l.distance(s))},e.prototype.intersectionWithNormalization=function(t,n,o,a){var l=new d(t),s=new d(n),m=new d(o),y=new d(a),D=new d;this.normalizeToEnvCentre(l,s,m,y,D);var W=this.safeHCoordinateIntersection(l,s,m,y);return W.x+=D.x,W.y+=D.y,W},e.prototype.computeCollinearIntersection=function(t,n,o,a){var l=B.intersects(t,n,o),s=B.intersects(t,n,a),m=B.intersects(o,a,t),y=B.intersects(o,a,n);return l&&s?(this._intPt[0]=o,this._intPt[1]=a,r.COLLINEAR_INTERSECTION):m&&y?(this._intPt[0]=t,this._intPt[1]=n,r.COLLINEAR_INTERSECTION):l&&m?(this._intPt[0]=o,this._intPt[1]=t,o.equals(t)&&!s&&!y?r.POINT_INTERSECTION:r.COLLINEAR_INTERSECTION):l&&y?(this._intPt[0]=o,this._intPt[1]=n,o.equals(n)&&!s&&!m?r.POINT_INTERSECTION:r.COLLINEAR_INTERSECTION):s&&m?(this._intPt[0]=a,this._intPt[1]=t,a.equals(t)&&!l&&!y?r.POINT_INTERSECTION:r.COLLINEAR_INTERSECTION):s&&y?(this._intPt[0]=a,this._intPt[1]=n,a.equals(n)&&!l&&!m?r.POINT_INTERSECTION:r.COLLINEAR_INTERSECTION):r.NO_INTERSECTION},e.prototype.normalizeToEnvCentre=function(t,n,o,a,l){var s=t.x<n.x?t.x:n.x,m=t.y<n.y?t.y:n.y,y=t.x>n.x?t.x:n.x,D=t.y>n.y?t.y:n.y,W=o.x<a.x?o.x:a.x,Ee=o.y<a.y?o.y:a.y,dt=o.x>a.x?o.x:a.x,Ht=o.y>a.y?o.y:a.y,ir=s>W?s:W,Hr=y<dt?y:dt,Bn=m>Ee?m:Ee,Vn=D<Ht?D:Ht,Wr=(ir+Hr)/2,ps=(Bn+Vn)/2;l.x=Wr,l.y=ps,t.x-=l.x,t.y-=l.y,n.x-=l.x,n.y-=l.y,o.x-=l.x,o.y-=l.y,a.x-=l.x,a.y-=l.y},e.prototype.computeIntersect=function(t,n,o,a){if(this._isProper=!1,!B.intersects(t,n,o,a))return r.NO_INTERSECTION;var l=M.orientationIndex(t,n,o),s=M.orientationIndex(t,n,a);if(l>0&&s>0||l<0&&s<0)return r.NO_INTERSECTION;var m=M.orientationIndex(o,a,t),y=M.orientationIndex(o,a,n);if(m>0&&y>0||m<0&&y<0)return r.NO_INTERSECTION;var D=l===0&&s===0&&m===0&&y===0;return D?this.computeCollinearIntersection(t,n,o,a):(l===0||s===0||m===0||y===0?(this._isProper=!1,t.equals2D(o)||t.equals2D(a)?this._intPt[0]=t:n.equals2D(o)||n.equals2D(a)?this._intPt[0]=n:l===0?this._intPt[0]=new d(o):s===0?this._intPt[0]=new d(a):m===0?this._intPt[0]=new d(t):y===0&&(this._intPt[0]=new d(n))):(this._isProper=!0,this._intPt[0]=this.intersection(t,n,o,a)),r.POINT_INTERSECTION)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.nearestEndpoint=function(t,n,o,a){var l=t,s=M.distancePointLine(t,o,a),m=M.distancePointLine(n,o,a);return m<s&&(s=m,l=n),m=M.distancePointLine(o,t,n),m<s&&(s=m,l=o),m=M.distancePointLine(a,t,n),m<s&&(s=m,l=a),l},e}(gt),Zr=function(){};Zr.prototype.interfaces_=function(){return[]};Zr.prototype.getClass=function(){return Zr};Zr.orientationIndex=function(r,e,t){var n=e.x-r.x,o=e.y-r.y,a=t.x-e.x,l=t.y-e.y;return Zr.signOfDet2x2(n,o,a,l)};Zr.signOfDet2x2=function(r,e,t,n){var o=null,a=null,l=null;if(o=1,r===0||n===0)return e===0||t===0?0:e>0?t>0?-o:o:t>0?o:-o;if(e===0||t===0)return n>0?r>0?o:-o:r>0?-o:o;if(e>0?n>0?e<=n||(o=-o,a=r,r=t,t=a,a=e,e=n,n=a):e<=-n?(o=-o,t=-t,n=-n):(a=r,r=-t,t=a,a=e,e=-n,n=a):n>0?-e<=n?(o=-o,r=-r,e=-e):(a=-r,r=t,t=a,a=-e,e=n,n=a):e>=n?(r=-r,e=-e,t=-t,n=-n):(o=-o,a=-r,r=-t,t=a,a=-e,e=-n,n=a),r>0)if(t>0){if(!(r<=t))return o}else return o;else{if(t>0)return-o;if(r>=t)o=-o,r=-r,t=-t;else return-o}for(;;){if(l=Math.floor(t/r),t=t-l*r,n=n-l*e,n<0)return-o;if(n>e)return o;if(r>t+t){if(e<n+n)return o}else{if(e>n+n)return-o;t=r-t,n=e-n,o=-o}if(n===0)return t===0?0:-o;if(t===0||(l=Math.floor(r/t),r=r-l*t,e=e-l*n,e<0))return o;if(e>n)return-o;if(t>r+r){if(n<e+e)return-o}else{if(n>e+e)return o;r=t-r,e=n-e,o=-o}if(e===0)return r===0?0:o;if(r===0)return-o}};var sn=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var r=arguments[0];this._p=r};sn.prototype.countSegment=function(r,e){if(r.x<this._p.x&&e.x<this._p.x)return null;if(this._p.x===e.x&&this._p.y===e.y)return this._isPointOnSegment=!0,null;if(r.y===this._p.y&&e.y===this._p.y){var t=r.x,n=e.x;return t>n&&(t=e.x,n=r.x),this._p.x>=t&&this._p.x<=n&&(this._isPointOnSegment=!0),null}if(r.y>this._p.y&&e.y<=this._p.y||e.y>this._p.y&&r.y<=this._p.y){var o=r.x-this._p.x,a=r.y-this._p.y,l=e.x-this._p.x,s=e.y-this._p.y,m=Zr.signOfDet2x2(o,a,l,s);if(m===0)return this._isPointOnSegment=!0,null;s<a&&(m=-m),m>0&&this._crossingCount++}};sn.prototype.isPointInPolygon=function(){return this.getLocation()!==E.EXTERIOR};sn.prototype.getLocation=function(){return this._isPointOnSegment?E.BOUNDARY:this._crossingCount%2===1?E.INTERIOR:E.EXTERIOR};sn.prototype.isOnSegment=function(){return this._isPointOnSegment};sn.prototype.interfaces_=function(){return[]};sn.prototype.getClass=function(){return sn};sn.locatePointInRing=function(){if(arguments[0]instanceof d&&V(arguments[1],Q)){for(var r=arguments[0],e=arguments[1],t=new sn(r),n=new d,o=new d,a=1;a<e.size();a++)if(e.getCoordinate(a,n),e.getCoordinate(a-1,o),t.countSegment(n,o),t.isOnSegment())return t.getLocation();return t.getLocation()}else if(arguments[0]instanceof d&&arguments[1]instanceof Array){for(var l=arguments[0],s=arguments[1],m=new sn(l),y=1;y<s.length;y++){var D=s[y],W=s[y-1];if(m.countSegment(D,W),m.isOnSegment())return m.getLocation()}return m.getLocation()}};var M=function(){},fi={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};M.prototype.interfaces_=function(){return[]};M.prototype.getClass=function(){return M};M.orientationIndex=function(r,e,t){return ce.orientationIndex(r,e,t)};M.signedArea=function(){if(arguments[0]instanceof Array){var r=arguments[0];if(r.length<3)return 0;for(var e=0,t=r[0].x,n=1;n<r.length-1;n++){var o=r[n].x-t,a=r[n+1].y,l=r[n-1].y;e+=o*(l-a)}return e/2}else if(V(arguments[0],Q)){var s=arguments[0],m=s.size();if(m<3)return 0;var y=new d,D=new d,W=new d;s.getCoordinate(0,D),s.getCoordinate(1,W);var Ee=D.x;W.x-=Ee;for(var dt=0,Ht=1;Ht<m-1;Ht++)y.y=D.y,D.x=W.x,D.y=W.y,s.getCoordinate(Ht+1,W),W.x-=Ee,dt+=D.x*(y.y-W.y);return dt/2}};M.distanceLineLine=function(r,e,t,n){if(r.equals(e))return M.distancePointLine(r,t,n);if(t.equals(n))return M.distancePointLine(n,r,e);var o=!1;if(!B.intersects(r,e,t,n))o=!0;else{var a=(e.x-r.x)*(n.y-t.y)-(e.y-r.y)*(n.x-t.x);if(a===0)o=!0;else{var l=(r.y-t.y)*(n.x-t.x)-(r.x-t.x)*(n.y-t.y),s=(r.y-t.y)*(e.x-r.x)-(r.x-t.x)*(e.y-r.y),m=s/a,y=l/a;(y<0||y>1||m<0||m>1)&&(o=!0)}}return o?we.min(M.distancePointLine(r,t,n),M.distancePointLine(e,t,n),M.distancePointLine(t,r,e),M.distancePointLine(n,r,e)):0};M.isPointInRing=function(r,e){return M.locatePointInRing(r,e)!==E.EXTERIOR};M.computeLength=function(r){var e=r.size();if(e<=1)return 0;var t=0,n=new d;r.getCoordinate(0,n);for(var o=n.x,a=n.y,l=1;l<e;l++){r.getCoordinate(l,n);var s=n.x,m=n.y,y=s-o,D=m-a;t+=Math.sqrt(y*y+D*D),o=s,a=m}return t};M.isCCW=function(r){var e=r.length-1;if(e<3)throw new ft("Ring has fewer than 4 points, so orientation cannot be determined");for(var t=r[0],n=0,o=1;o<=e;o++){var a=r[o];a.y>t.y&&(t=a,n=o)}var l=n;do l=l-1,l<0&&(l=e);while(r[l].equals2D(t)&&l!==n);var s=n;do s=(s+1)%e;while(r[s].equals2D(t)&&s!==n);var m=r[l],y=r[s];if(m.equals2D(t)||y.equals2D(t)||m.equals2D(y))return!1;var D=M.computeOrientation(m,t,y),W=!1;return D===0?W=m.x>y.x:W=D>0,W};M.locatePointInRing=function(r,e){return sn.locatePointInRing(r,e)};M.distancePointLinePerpendicular=function(r,e,t){var n=(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y),o=((e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y))/n;return Math.abs(o)*Math.sqrt(n)};M.computeOrientation=function(r,e,t){return M.orientationIndex(r,e,t)};M.distancePointLine=function(){if(arguments.length===2){var r=arguments[0],e=arguments[1];if(e.length===0)throw new ft("Line array must contain at least one vertex");for(var t=r.distance(e[0]),n=0;n<e.length-1;n++){var o=M.distancePointLine(r,e[n],e[n+1]);o<t&&(t=o)}return t}else if(arguments.length===3){var a=arguments[0],l=arguments[1],s=arguments[2];if(l.x===s.x&&l.y===s.y)return a.distance(l);var m=(s.x-l.x)*(s.x-l.x)+(s.y-l.y)*(s.y-l.y),y=((a.x-l.x)*(s.x-l.x)+(a.y-l.y)*(s.y-l.y))/m;if(y<=0)return a.distance(l);if(y>=1)return a.distance(s);var D=((l.y-a.y)*(s.x-l.x)-(l.x-a.x)*(s.y-l.y))/m;return Math.abs(D)*Math.sqrt(m)}};M.isOnLine=function(r,e){for(var t=new Xr,n=1;n<e.length;n++){var o=e[n-1],a=e[n];if(t.computeIntersection(r,o,a),t.hasIntersection())return!0}return!1};fi.CLOCKWISE.get=function(){return-1};fi.RIGHT.get=function(){return M.CLOCKWISE};fi.COUNTERCLOCKWISE.get=function(){return 1};fi.LEFT.get=function(){return M.COUNTERCLOCKWISE};fi.COLLINEAR.get=function(){return 0};fi.STRAIGHT.get=function(){return M.COLLINEAR};Object.defineProperties(M,fi);var Zn=function(){};Zn.prototype.filter=function(r){};Zn.prototype.interfaces_=function(){return[]};Zn.prototype.getClass=function(){return Zn};var G=function(){var r=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=r,this._SRID=r.getSRID()},Fn={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};G.prototype.isGeometryCollection=function(){return this.getSortIndex()===G.SORTINDEX_GEOMETRYCOLLECTION};G.prototype.getFactory=function(){return this._factory};G.prototype.getGeometryN=function(r){return this};G.prototype.getArea=function(){return 0};G.prototype.isRectangle=function(){return!1};G.prototype.equals=function(){if(arguments[0]instanceof G){var r=arguments[0];return r===null?!1:this.equalsTopo(r)}else if(arguments[0]instanceof Object){var e=arguments[0];if(!(e instanceof G))return!1;var t=e;return this.equalsExact(t)}};G.prototype.equalsExact=function(r){return this===r||this.equalsExact(r,0)};G.prototype.geometryChanged=function(){this.apply(G.geometryChangedFilter)};G.prototype.geometryChangedAction=function(){this._envelope=null};G.prototype.equalsNorm=function(r){return r===null?!1:this.norm().equalsExact(r.norm())};G.prototype.getLength=function(){return 0};G.prototype.getNumGeometries=function(){return 1};G.prototype.compareTo=function(){if(arguments.length===1){var r=arguments[0],e=r;return this.getSortIndex()!==e.getSortIndex()?this.getSortIndex()-e.getSortIndex():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(r)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return this.getSortIndex()!==t.getSortIndex()?this.getSortIndex()-t.getSortIndex():this.isEmpty()&&t.isEmpty()?0:this.isEmpty()?-1:t.isEmpty()?1:this.compareToSameClass(t,n)}};G.prototype.getUserData=function(){return this._userData};G.prototype.getSRID=function(){return this._SRID};G.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())};G.prototype.checkNotGeometryCollection=function(r){if(r.getSortIndex()===G.SORTINDEX_GEOMETRYCOLLECTION)throw new ft("This method does not support GeometryCollection arguments")};G.prototype.equal=function(r,e,t){return t===0?r.equals(e):r.distance(e)<=t};G.prototype.norm=function(){var r=this.copy();return r.normalize(),r};G.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()};G.prototype.getEnvelopeInternal=function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new B(this._envelope)};G.prototype.setSRID=function(r){this._SRID=r};G.prototype.setUserData=function(r){this._userData=r};G.prototype.compare=function(r,e){for(var t=r.iterator(),n=e.iterator();t.hasNext()&&n.hasNext();){var o=t.next(),a=n.next(),l=o.compareTo(a);if(l!==0)return l}return t.hasNext()?1:n.hasNext()?-1:0};G.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()};G.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===G.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===G.SORTINDEX_MULTIPOINT||this.getSortIndex()===G.SORTINDEX_MULTILINESTRING||this.getSortIndex()===G.SORTINDEX_MULTIPOLYGON};G.prototype.interfaces_=function(){return[$o,ke,Ge]};G.prototype.getClass=function(){return G};G.hasNonEmptyElements=function(r){for(var e=0;e<r.length;e++)if(!r[e].isEmpty())return!0;return!1};G.hasNullElements=function(r){for(var e=0;e<r.length;e++)if(r[e]===null)return!0;return!1};Fn.serialVersionUID.get=function(){return 8763622679187377e3};Fn.SORTINDEX_POINT.get=function(){return 0};Fn.SORTINDEX_MULTIPOINT.get=function(){return 1};Fn.SORTINDEX_LINESTRING.get=function(){return 2};Fn.SORTINDEX_LINEARRING.get=function(){return 3};Fn.SORTINDEX_MULTILINESTRING.get=function(){return 4};Fn.SORTINDEX_POLYGON.get=function(){return 5};Fn.SORTINDEX_MULTIPOLYGON.get=function(){return 6};Fn.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7};Fn.geometryChangedFilter.get=function(){return Us};Object.defineProperties(G,Fn);var Us=function(){};Us.interfaces_=function(){return[Zn]};Us.filter=function(r){r.geometryChangedAction()};var Ln=function(){};Ln.prototype.filter=function(r){};Ln.prototype.interfaces_=function(){return[]};Ln.prototype.getClass=function(){return Ln};var Ae=function(){},nr={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};Ae.prototype.isInBoundary=function(r){};Ae.prototype.interfaces_=function(){return[]};Ae.prototype.getClass=function(){return Ae};nr.Mod2BoundaryNodeRule.get=function(){return xi};nr.EndPointBoundaryNodeRule.get=function(){return Si};nr.MultiValentEndPointBoundaryNodeRule.get=function(){return wi};nr.MonoValentEndPointBoundaryNodeRule.get=function(){return Li};nr.MOD2_BOUNDARY_RULE.get=function(){return new xi};nr.ENDPOINT_BOUNDARY_RULE.get=function(){return new Si};nr.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new wi};nr.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Li};nr.OGC_SFS_BOUNDARY_RULE.get=function(){return Ae.MOD2_BOUNDARY_RULE};Object.defineProperties(Ae,nr);var xi=function(){};xi.prototype.isInBoundary=function(r){return r%2===1};xi.prototype.interfaces_=function(){return[Ae]};xi.prototype.getClass=function(){return xi};var Si=function(){};Si.prototype.isInBoundary=function(r){return r>0};Si.prototype.interfaces_=function(){return[Ae]};Si.prototype.getClass=function(){return Si};var wi=function(){};wi.prototype.isInBoundary=function(r){return r>1};wi.prototype.interfaces_=function(){return[Ae]};wi.prototype.getClass=function(){return wi};var Li=function(){};Li.prototype.isInBoundary=function(r){return r===1};Li.prototype.interfaces_=function(){return[Ae]};Li.prototype.getClass=function(){return Li};var Lt=function(){};Lt.prototype.add=function(){};Lt.prototype.addAll=function(){};Lt.prototype.isEmpty=function(){};Lt.prototype.iterator=function(){};Lt.prototype.size=function(){};Lt.prototype.toArray=function(){};Lt.prototype.remove=function(){};function qs(r){this.message=r||""}qs.prototype=new Error;qs.prototype.name="IndexOutOfBoundsException";var Xi=function(){};Xi.prototype.hasNext=function(){};Xi.prototype.next=function(){};Xi.prototype.remove=function(){};var qe=function(r){function e(){r.apply(this,arguments)}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.get=function(){},e.prototype.set=function(){},e.prototype.isEmpty=function(){},e}(Lt);function Yi(r){this.message=r||""}Yi.prototype=new Error;Yi.prototype.name="NoSuchElementException";var O=function(r){function e(){r.call(this),this.array_=[],arguments[0]instanceof Lt&&this.addAll(arguments[0])}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.ensureCapacity=function(){},e.prototype.interfaces_=function(){return[r,Lt]},e.prototype.add=function(t){return arguments.length===1?this.array_.push(t):this.array_.splice(arguments[0],arguments[1]),!0},e.prototype.clear=function(){this.array_=[]},e.prototype.addAll=function(t){for(var n=this,o=t.iterator();o.hasNext();)n.add(o.next());return!0},e.prototype.set=function(t,n){var o=this.array_[t];return this.array_[t]=n,o},e.prototype.iterator=function(){return new Yc(this)},e.prototype.get=function(t){if(t<0||t>=this.size())throw new qs;return this.array_[t]},e.prototype.isEmpty=function(){return this.array_.length===0},e.prototype.size=function(){return this.array_.length},e.prototype.toArray=function(){for(var t=this,n=[],o=0,a=this.array_.length;o<a;o++)n.push(t.array_[o]);return n},e.prototype.remove=function(t){for(var n=this,o=!1,a=0,l=this.array_.length;a<l;a++)if(n.array_[a]===t){n.array_.splice(a,1),o=!0;break}return o},e}(qe),Yc=function(r){function e(t){r.call(this),this.arrayList_=t,this.position_=0}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new Yi;return this.arrayList_.get(this.position_++)},e.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},e.prototype.set=function(t){return this.arrayList_.set(this.position_-1,t)},e.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},e}(Xi),Eo=function(r){function e(){if(r.call(this),arguments.length!==0){if(arguments.length===1){var n=arguments[0];this.ensureCapacity(n.length),this.add(n,!0)}else if(arguments.length===2){var o=arguments[0],a=arguments[1];this.ensureCapacity(o.length),this.add(o,a)}}}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={coordArrayType:{configurable:!0}};return t.coordArrayType.get=function(){return new Array(0).fill(null)},e.prototype.getCoordinate=function(n){return this.get(n)},e.prototype.addAll=function(){var n=this;if(arguments.length===2){for(var o=arguments[0],a=arguments[1],l=!1,s=o.iterator();s.hasNext();)n.add(s.next(),a),l=!0;return l}else return r.prototype.addAll.apply(this,arguments)},e.prototype.clone=function(){for(var n=this,o=r.prototype.clone.call(this),a=0;a<this.size();a++)o.add(a,n.get(a).copy());return o},e.prototype.toCoordinateArray=function(){return this.toArray(e.coordArrayType)},e.prototype.add=function(){var n=this;if(arguments.length===1){var o=arguments[0];r.prototype.add.call(this,o)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var a=arguments[0],l=arguments[1];return this.add(a,l,!0),!0}else if(arguments[0]instanceof d&&typeof arguments[1]=="boolean"){var s=arguments[0],m=arguments[1];if(!m&&this.size()>=1){var y=this.get(this.size()-1);if(y.equals2D(s))return null}r.prototype.add.call(this,s)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var D=arguments[0],W=arguments[1];return this.add(D,W),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var Ee=arguments[0],dt=arguments[1],Ht=arguments[2];if(Ht)for(var ir=0;ir<Ee.length;ir++)n.add(Ee[ir],dt);else for(var Hr=Ee.length-1;Hr>=0;Hr--)n.add(Ee[Hr],dt);return!0}else if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof d){var Bn=arguments[0],Vn=arguments[1],Wr=arguments[2];if(!Wr){var ps=this.size();if(ps>0){if(Bn>0){var il=this.get(Bn-1);if(il.equals2D(Vn))return null}if(Bn<ps){var gl=this.get(Bn);if(gl.equals2D(Vn))return null}}}r.prototype.add.call(this,Bn,Vn)}}else if(arguments.length===4){var ml=arguments[0],sl=arguments[1],ll=arguments[2],rl=arguments[3],th=1;ll>rl&&(th=-1);for(var nh=ll;nh!==rl;nh+=th)n.add(ml[nh],sl);return!0}},e.prototype.closeRing=function(){this.size()>0&&this.add(new d(this.get(0)),!1)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},Object.defineProperties(e,t),e}(O),j=function(){},es$3={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};es$3.ForwardComparator.get=function(){return io};es$3.BidirectionalComparator.get=function(){return bi};es$3.coordArrayType.get=function(){return new Array(0).fill(null)};j.prototype.interfaces_=function(){return[]};j.prototype.getClass=function(){return j};j.isRing=function(r){return!(r.length<4||!r[0].equals2D(r[r.length-1]))};j.ptNotInList=function(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(j.indexOf(n,e)<0)return n}return null};j.scroll=function(r,e){var t=j.indexOf(e,r);if(t<0)return null;var n=new Array(r.length).fill(null);qt.arraycopy(r,t,n,0,r.length-t),qt.arraycopy(r,0,n,r.length-t,t),qt.arraycopy(n,0,r,0,r.length)};j.equals=function(){if(arguments.length===2){var r=arguments[0],e=arguments[1];if(r===e)return!0;if(r===null||e===null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(!r[t].equals(e[t]))return!1;return!0}else if(arguments.length===3){var n=arguments[0],o=arguments[1],a=arguments[2];if(n===o)return!0;if(n===null||o===null||n.length!==o.length)return!1;for(var l=0;l<n.length;l++)if(a.compare(n[l],o[l])!==0)return!1;return!0}};j.intersection=function(r,e){for(var t=new Eo,n=0;n<r.length;n++)e.intersects(r[n])&&t.add(r[n],!0);return t.toCoordinateArray()};j.hasRepeatedPoints=function(r){for(var e=1;e<r.length;e++)if(r[e-1].equals(r[e]))return!0;return!1};j.removeRepeatedPoints=function(r){if(!j.hasRepeatedPoints(r))return r;var e=new Eo(r,!1);return e.toCoordinateArray()};j.reverse=function(r){for(var e=r.length-1,t=Math.trunc(e/2),n=0;n<=t;n++){var o=r[n];r[n]=r[e-n],r[e-n]=o}};j.removeNull=function(r){for(var e=0,t=0;t<r.length;t++)r[t]!==null&&e++;var n=new Array(e).fill(null);if(e===0)return n;for(var o=0,a=0;a<r.length;a++)r[a]!==null&&(n[o++]=r[a]);return n};j.copyDeep=function(){if(arguments.length===1){for(var r=arguments[0],e=new Array(r.length).fill(null),t=0;t<r.length;t++)e[t]=new d(r[t]);return e}else if(arguments.length===5)for(var n=arguments[0],o=arguments[1],a=arguments[2],l=arguments[3],s=arguments[4],m=0;m<s;m++)a[l+m]=new d(n[o+m])};j.isEqualReversed=function(r,e){for(var t=0;t<r.length;t++){var n=r[t],o=e[r.length-t-1];if(n.compareTo(o)!==0)return!1}return!0};j.envelope=function(r){for(var e=new B,t=0;t<r.length;t++)e.expandToInclude(r[t]);return e};j.toCoordinateArray=function(r){return r.toArray(j.coordArrayType)};j.atLeastNCoordinatesOrNothing=function(r,e){return e.length>=r?e:[]};j.indexOf=function(r,e){for(var t=0;t<e.length;t++)if(r.equals(e[t]))return t;return-1};j.increasingDirection=function(r){for(var e=0;e<Math.trunc(r.length/2);e++){var t=r.length-1-e,n=r[e].compareTo(r[t]);if(n!==0)return n}return 1};j.compare=function(r,e){for(var t=0;t<r.length&&t<e.length;){var n=r[t].compareTo(e[t]);if(n!==0)return n;t++}return t<e.length?-1:t<r.length?1:0};j.minCoordinate=function(r){for(var e=null,t=0;t<r.length;t++)(e===null||e.compareTo(r[t])>0)&&(e=r[t]);return e};j.extract=function(r,e,t){e=we.clamp(e,0,r.length),t=we.clamp(t,-1,r.length);var n=t-e+1;t<0&&(n=0),e>=r.length&&(n=0),t<e&&(n=0);var o=new Array(n).fill(null);if(n===0)return o;for(var a=0,l=e;l<=t;l++)o[a++]=r[l];return o};Object.defineProperties(j,es$3);var io=function(){};io.prototype.compare=function(r,e){var t=r,n=e;return j.compare(t,n)};io.prototype.interfaces_=function(){return[Ci]};io.prototype.getClass=function(){return io};var bi=function(){};bi.prototype.compare=function(r,e){var t=r,n=e;if(t.length<n.length)return-1;if(t.length>n.length)return 1;if(t.length===0)return 0;var o=j.compare(t,n),a=j.isEqualReversed(t,n);return a?0:o};bi.prototype.OLDcompare=function(r,e){var t=r,n=e;if(t.length<n.length)return-1;if(t.length>n.length)return 1;if(t.length===0)return 0;for(var o=j.increasingDirection(t),a=j.increasingDirection(n),l=o>0?0:t.length-1,s=a>0?0:t.length-1,m=0;m<t.length;m++){var y=t[l].compareTo(n[s]);if(y!==0)return y;l+=o,s+=a}return 0};bi.prototype.interfaces_=function(){return[Ci]};bi.prototype.getClass=function(){return bi};var hi=function(){};hi.prototype.get=function(){};hi.prototype.put=function(){};hi.prototype.size=function(){};hi.prototype.values=function(){};hi.prototype.entrySet=function(){};var Wc=function(r){function e(){r.apply(this,arguments)}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e}(hi);function Io(r){this.message=r||""}Io.prototype=new Error;Io.prototype.name="OperationNotSupported";function ns(){}ns.prototype=new Lt;ns.prototype.contains=function(){};var Xs=function(r){function e(){r.call(this),this.array_=[],arguments[0]instanceof Lt&&this.addAll(arguments[0])}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.contains=function(t){for(var n=this,o=0,a=this.array_.length;o<a;o++){var l=n.array_[o];if(l===t)return!0}return!1},e.prototype.add=function(t){return this.contains(t)?!1:(this.array_.push(t),!0)},e.prototype.addAll=function(t){for(var n=this,o=t.iterator();o.hasNext();)n.add(o.next());return!0},e.prototype.remove=function(t){throw new Error},e.prototype.size=function(){return this.array_.length},e.prototype.isEmpty=function(){return this.array_.length===0},e.prototype.toArray=function(){for(var t=this,n=[],o=0,a=this.array_.length;o<a;o++)n.push(t.array_[o]);return n},e.prototype.iterator=function(){return new Hc(this)},e}(ns),Hc=function(r){function e(t){r.call(this),this.hashSet_=t,this.position_=0}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new Yi;return this.hashSet_.array_[this.position_++]},e.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},e.prototype.remove=function(){throw new Io},e}(Xi),Wn=0,Nr=1;function Ta(r){return r===null?Wn:r.color}function st(r){return r===null?null:r.parent}function Un(r,e){r!==null&&(r.color=e)}function Is(r){return r===null?null:r.left}function Da(r){return r===null?null:r.right}function Kt(){this.root_=null,this.size_=0}Kt.prototype=new Wc;Kt.prototype.get=function(r){for(var e=this.root_;e!==null;){var t=r.compareTo(e.key);if(t<0)e=e.left;else if(t>0)e=e.right;else return e.value}return null};Kt.prototype.put=function(r,e){if(this.root_===null)return this.root_={key:r,value:e,left:null,right:null,parent:null,color:Wn,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var t=this.root_,n,o;do if(n=t,o=r.compareTo(t.key),o<0)t=t.left;else if(o>0)t=t.right;else{var a=t.value;return t.value=e,a}while(t!==null);var l={key:r,left:null,right:null,value:e,parent:n,color:Wn,getValue:function(){return this.value},getKey:function(){return this.key}};return o<0?n.left=l:n.right=l,this.fixAfterInsertion(l),this.size_++,null};Kt.prototype.fixAfterInsertion=function(r){var e=this;for(r.color=Nr;r!=null&&r!==this.root_&&r.parent.color===Nr;)if(st(r)===Is(st(st(r)))){var t=Da(st(st(r)));Ta(t)===Nr?(Un(st(r),Wn),Un(t,Wn),Un(st(st(r)),Nr),r=st(st(r))):(r===Da(st(r))&&(r=st(r),e.rotateLeft(r)),Un(st(r),Wn),Un(st(st(r)),Nr),e.rotateRight(st(st(r))))}else{var n=Is(st(st(r)));Ta(n)===Nr?(Un(st(r),Wn),Un(n,Wn),Un(st(st(r)),Nr),r=st(st(r))):(r===Is(st(r))&&(r=st(r),e.rotateRight(r)),Un(st(r),Wn),Un(st(st(r)),Nr),e.rotateLeft(st(st(r))))}this.root_.color=Wn};Kt.prototype.values=function(){var r=new O,e=this.getFirstEntry();if(e!==null)for(r.add(e.value);(e=Kt.successor(e))!==null;)r.add(e.value);return r};Kt.prototype.entrySet=function(){var r=new Xs,e=this.getFirstEntry();if(e!==null)for(r.add(e);(e=Kt.successor(e))!==null;)r.add(e);return r};Kt.prototype.rotateLeft=function(r){if(r!=null){var e=r.right;r.right=e.left,e.left!=null&&(e.left.parent=r),e.parent=r.parent,r.parent===null?this.root_=e:r.parent.left===r?r.parent.left=e:r.parent.right=e,e.left=r,r.parent=e}};Kt.prototype.rotateRight=function(r){if(r!=null){var e=r.left;r.left=e.right,e.right!=null&&(e.right.parent=r),e.parent=r.parent,r.parent===null?this.root_=e:r.parent.right===r?r.parent.right=e:r.parent.left=e,e.right=r,r.parent=e}};Kt.prototype.getFirstEntry=function(){var r=this.root_;if(r!=null)for(;r.left!=null;)r=r.left;return r};Kt.successor=function(r){if(r===null)return null;if(r.right!==null){for(var e=r.right;e.left!==null;)e=e.left;return e}else{for(var t=r.parent,n=r;t!==null&&n===t.right;)n=t,t=t.parent;return t}};Kt.prototype.size=function(){return this.size_};var oo=function(){};oo.prototype.interfaces_=function(){return[]};oo.prototype.getClass=function(){return oo};function Eu(){}Eu.prototype=new ns;function ln(){this.array_=[],arguments[0]instanceof Lt&&this.addAll(arguments[0])}ln.prototype=new Eu;ln.prototype.contains=function(r){for(var e=this,t=0,n=this.array_.length;t<n;t++){var o=e.array_[t];if(o.compareTo(r)===0)return!0}return!1};ln.prototype.add=function(r){var e=this;if(this.contains(r))return!1;for(var t=0,n=this.array_.length;t<n;t++){var o=e.array_[t];if(o.compareTo(r)===1)return e.array_.splice(t,0,r),!0}return this.array_.push(r),!0};ln.prototype.addAll=function(r){for(var e=this,t=r.iterator();t.hasNext();)e.add(t.next());return!0};ln.prototype.remove=function(r){throw new Io};ln.prototype.size=function(){return this.array_.length};ln.prototype.isEmpty=function(){return this.array_.length===0};ln.prototype.toArray=function(){for(var r=this,e=[],t=0,n=this.array_.length;t<n;t++)e.push(r.array_[t]);return e};ln.prototype.iterator=function(){return new rs(this)};var rs=function(r){this.treeSet_=r,this.position_=0};rs.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new Yi;return this.treeSet_.array_[this.position_++]};rs.prototype.hasNext=function(){return this.position_<this.treeSet_.size()};rs.prototype.remove=function(){throw new Io};var Lr=function(){};Lr.sort=function(){var r=arguments[0],e,t,n,o;if(arguments.length===1)o=function(l,s){return l.compareTo(s)},r.sort(o);else if(arguments.length===2)n=arguments[1],o=function(l,s){return n.compare(l,s)},r.sort(o);else if(arguments.length===3){t=r.slice(arguments[1],arguments[2]),t.sort();var a=r.slice(0,arguments[1]).concat(t,r.slice(arguments[2],r.length));for(r.splice(0,r.length),e=0;e<a.length;e++)r.push(a[e])}else if(arguments.length===4)for(t=r.slice(arguments[1],arguments[2]),n=arguments[3],o=function(l,s){return n.compare(l,s)},t.sort(o),a=r.slice(0,arguments[1]).concat(t,r.slice(arguments[2],r.length)),r.splice(0,r.length),e=0;e<a.length;e++)r.push(a[e])};Lr.asList=function(r){for(var e=new O,t=0,n=r.length;t<n;t++)e.add(r[t]);return e};var Z=function(){},Je={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Je.P.get=function(){return 0};Je.L.get=function(){return 1};Je.A.get=function(){return 2};Je.FALSE.get=function(){return-1};Je.TRUE.get=function(){return-2};Je.DONTCARE.get=function(){return-3};Je.SYM_FALSE.get=function(){return"F"};Je.SYM_TRUE.get=function(){return"T"};Je.SYM_DONTCARE.get=function(){return"*"};Je.SYM_P.get=function(){return"0"};Je.SYM_L.get=function(){return"1"};Je.SYM_A.get=function(){return"2"};Z.prototype.interfaces_=function(){return[]};Z.prototype.getClass=function(){return Z};Z.toDimensionSymbol=function(r){switch(r){case Z.FALSE:return Z.SYM_FALSE;case Z.TRUE:return Z.SYM_TRUE;case Z.DONTCARE:return Z.SYM_DONTCARE;case Z.P:return Z.SYM_P;case Z.L:return Z.SYM_L;case Z.A:return Z.SYM_A}throw new ft("Unknown dimension value: "+r)};Z.toDimensionValue=function(r){switch(ro.toUpperCase(r)){case Z.SYM_FALSE:return Z.FALSE;case Z.SYM_TRUE:return Z.TRUE;case Z.SYM_DONTCARE:return Z.DONTCARE;case Z.SYM_P:return Z.P;case Z.SYM_L:return Z.L;case Z.SYM_A:return Z.A}throw new ft("Unknown dimension symbol: "+r)};Object.defineProperties(Z,Je);var cn=function(){};cn.prototype.filter=function(r){};cn.prototype.interfaces_=function(){return[]};cn.prototype.getClass=function(){return cn};var Ye=function(){};Ye.prototype.filter=function(r,e){};Ye.prototype.isDone=function(){};Ye.prototype.isGeometryChanged=function(){};Ye.prototype.interfaces_=function(){return[]};Ye.prototype.getClass=function(){return Ye};var ie=function(r){function e(n,o){if(r.call(this,o),this._geometries=n||[],r.hasNullElements(this._geometries))throw new ft("geometries must not contain null elements")}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){for(var n=this,o=new B,a=0;a<this._geometries.length;a++)o.expandToInclude(n._geometries[a].getEnvelopeInternal());return o},e.prototype.getGeometryN=function(n){return this._geometries[n]},e.prototype.getSortIndex=function(){return r.SORTINDEX_GEOMETRYCOLLECTION},e.prototype.getCoordinates=function(){for(var n=this,o=new Array(this.getNumPoints()).fill(null),a=-1,l=0;l<this._geometries.length;l++)for(var s=n._geometries[l].getCoordinates(),m=0;m<s.length;m++)a++,o[a]=s[m];return o},e.prototype.getArea=function(){for(var n=this,o=0,a=0;a<this._geometries.length;a++)o+=n._geometries[a].getArea();return o},e.prototype.equalsExact=function(){var n=this;if(arguments.length===2){var o=arguments[0],a=arguments[1];if(!this.isEquivalentClass(o))return!1;var l=o;if(this._geometries.length!==l._geometries.length)return!1;for(var s=0;s<this._geometries.length;s++)if(!n._geometries[s].equalsExact(l._geometries[s],a))return!1;return!0}else return r.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var n=this,o=0;o<this._geometries.length;o++)n._geometries[o].normalize();Lr.sort(this._geometries)},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},e.prototype.getBoundaryDimension=function(){for(var n=this,o=Z.FALSE,a=0;a<this._geometries.length;a++)o=Math.max(o,n._geometries[a].getBoundaryDimension());return o},e.prototype.getDimension=function(){for(var n=this,o=Z.FALSE,a=0;a<this._geometries.length;a++)o=Math.max(o,n._geometries[a].getDimension());return o},e.prototype.getLength=function(){for(var n=this,o=0,a=0;a<this._geometries.length;a++)o+=n._geometries[a].getLength();return o},e.prototype.getNumPoints=function(){for(var n=this,o=0,a=0;a<this._geometries.length;a++)o+=n._geometries[a].getNumPoints();return o},e.prototype.getNumGeometries=function(){return this._geometries.length},e.prototype.reverse=function(){for(var n=this,o=this._geometries.length,a=new Array(o).fill(null),l=0;l<this._geometries.length;l++)a[l]=n._geometries[l].reverse();return this.getFactory().createGeometryCollection(a)},e.prototype.compareToSameClass=function(){var n=this;if(arguments.length===1){var o=arguments[0],a=new ln(Lr.asList(this._geometries)),l=new ln(Lr.asList(o._geometries));return this.compare(a,l)}else if(arguments.length===2){for(var s=arguments[0],m=arguments[1],y=s,D=this.getNumGeometries(),W=y.getNumGeometries(),Ee=0;Ee<D&&Ee<W;){var dt=n.getGeometryN(Ee),Ht=y.getGeometryN(Ee),ir=dt.compareToSameClass(Ht,m);if(ir!==0)return ir;Ee++}return Ee<D?1:Ee<W?-1:0}},e.prototype.apply=function(){var n=this;if(V(arguments[0],Ln))for(var o=arguments[0],a=0;a<this._geometries.length;a++)n._geometries[a].apply(o);else if(V(arguments[0],Ye)){var l=arguments[0];if(this._geometries.length===0)return null;for(var s=0;s<this._geometries.length&&(n._geometries[s].apply(l),!l.isDone());s++);l.isGeometryChanged()&&this.geometryChanged()}else if(V(arguments[0],cn)){var m=arguments[0];m.filter(this);for(var y=0;y<this._geometries.length;y++)n._geometries[y].apply(m)}else if(V(arguments[0],Zn)){var D=arguments[0];D.filter(this);for(var W=0;W<this._geometries.length;W++)n._geometries[W].apply(D)}},e.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),q.shouldNeverReachHere(),null},e.prototype.clone=function(){var n=this,o=r.prototype.clone.call(this);o._geometries=new Array(this._geometries.length).fill(null);for(var a=0;a<this._geometries.length;a++)o._geometries[a]=n._geometries[a].clone();return o},e.prototype.getGeometryType=function(){return"GeometryCollection"},e.prototype.copy=function(){for(var n=this,o=new Array(this._geometries.length).fill(null),a=0;a<o.length;a++)o[a]=n._geometries[a].copy();return new e(o,this._factory)},e.prototype.isEmpty=function(){for(var n=this,o=0;o<this._geometries.length;o++)if(!n._geometries[o].isEmpty())return!1;return!0},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},t.serialVersionUID.get=function(){return-5694727726395021e3},Object.defineProperties(e,t),e}(G),Tr=function(r){function e(){r.apply(this,arguments)}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return G.SORTINDEX_MULTILINESTRING},e.prototype.equalsExact=function(){if(arguments.length===2){var n=arguments[0],o=arguments[1];return this.isEquivalentClass(n)?r.prototype.equalsExact.call(this,n,o):!1}else return r.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Z.FALSE:0},e.prototype.isClosed=function(){var n=this;if(this.isEmpty())return!1;for(var o=0;o<this._geometries.length;o++)if(!n._geometries[o].isClosed())return!1;return!0},e.prototype.getDimension=function(){return 1},e.prototype.reverse=function(){for(var n=this,o=this._geometries.length,a=new Array(o).fill(null),l=0;l<this._geometries.length;l++)a[o-1-l]=n._geometries[l].reverse();return this.getFactory().createMultiLineString(a)},e.prototype.getBoundary=function(){return new Oe(this).getBoundary()},e.prototype.getGeometryType=function(){return"MultiLineString"},e.prototype.copy=function(){for(var n=this,o=new Array(this._geometries.length).fill(null),a=0;a<o.length;a++)o[a]=n._geometries[a].copy();return new e(o,this._factory)},e.prototype.interfaces_=function(){return[oo]},e.prototype.getClass=function(){return e},t.serialVersionUID.get=function(){return 8166665132445434e3},Object.defineProperties(e,t),e}(ie),Oe=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,arguments.length===1){var r=arguments[0],e=Ae.MOD2_BOUNDARY_RULE;this._geom=r,this._geomFact=r.getFactory(),this._bnRule=e}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this._geom=t,this._geomFact=t.getFactory(),this._bnRule=n}};Oe.prototype.boundaryMultiLineString=function(r){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var e=this.computeBoundaryCoordinates(r);return e.length===1?this._geomFact.createPoint(e[0]):this._geomFact.createMultiPointFromCoords(e)};Oe.prototype.getBoundary=function(){return this._geom instanceof yt?this.boundaryLineString(this._geom):this._geom instanceof Tr?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()};Oe.prototype.boundaryLineString=function(r){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(r.isClosed()){var e=this._bnRule.isInBoundary(2);return e?r.getStartPoint():this._geomFact.createMultiPoint()}return this._geomFact.createMultiPoint([r.getStartPoint(),r.getEndPoint()])};Oe.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()};Oe.prototype.computeBoundaryCoordinates=function(r){var e=this,t=new O;this._endpointMap=new Kt;for(var n=0;n<r.getNumGeometries();n++){var o=r.getGeometryN(n);o.getNumPoints()!==0&&(e.addEndpoint(o.getCoordinateN(0)),e.addEndpoint(o.getCoordinateN(o.getNumPoints()-1)))}for(var a=this._endpointMap.entrySet().iterator();a.hasNext();){var l=a.next(),s=l.getValue(),m=s.count;e._bnRule.isInBoundary(m)&&t.add(l.getKey())}return j.toCoordinateArray(t)};Oe.prototype.addEndpoint=function(r){var e=this._endpointMap.get(r);e===null&&(e=new qo,this._endpointMap.put(r,e)),e.count++};Oe.prototype.interfaces_=function(){return[]};Oe.prototype.getClass=function(){return Oe};Oe.getBoundary=function(){if(arguments.length===1){var r=arguments[0],e=new Oe(r);return e.getBoundary()}else if(arguments.length===2){var t=arguments[0],n=arguments[1],o=new Oe(t,n);return o.getBoundary()}};var qo=function(){this.count=null};qo.prototype.interfaces_=function(){return[]};qo.prototype.getClass=function(){return qo};function jc(){}function Kc(){}var Qc=function(){};function Zc(){}function Jc(){}function $c(){}var Te=function(){},Ys={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};Te.prototype.interfaces_=function(){return[]};Te.prototype.getClass=function(){return Te};Te.chars=function(r,e){for(var t=new Array(e).fill(null),n=0;n<e;n++)t[n]=r;return String(t)};Te.getStackTrace=function(){if(arguments.length===1){var r=arguments[0],e=new Zc,t=new jc;return r.printStackTrace(t),e.toString()}else if(arguments.length===2){var n=arguments[0],o=arguments[1],a="";new Kc(Te.getStackTrace(n));for(var l=new $c,s=0;s<o;s++)try{a+=l.readLine()+Te.NEWLINE}catch(m){if(m instanceof Jc)q.shouldNeverReachHere();else throw m}finally{}return a}};Te.split=function(r,e){for(var t=e.length,n=new O,o=""+r,a=o.indexOf(e);a>=0;){var l=o.substring(0,a);n.add(l),o=o.substring(a+t),a=o.indexOf(e)}o.length>0&&n.add(o);for(var s=new Array(n.size()).fill(null),m=0;m<s.length;m++)s[m]=n.get(m);return s};Te.toString=function(){if(arguments.length===1){var r=arguments[0];return Te.SIMPLE_ORDINATE_FORMAT.format(r)}};Te.spaces=function(r){return Te.chars(" ",r)};Ys.NEWLINE.get=function(){return qt.getProperty("line.separator")};Ys.SIMPLE_ORDINATE_FORMAT.get=function(){return new Qc};Object.defineProperties(Te,Ys);var Ct=function(){};Ct.prototype.interfaces_=function(){return[]};Ct.prototype.getClass=function(){return Ct};Ct.copyCoord=function(r,e,t,n){for(var o=Math.min(r.getDimension(),t.getDimension()),a=0;a<o;a++)t.setOrdinate(n,a,r.getOrdinate(e,a))};Ct.isRing=function(r){var e=r.size();return e===0?!0:e<=3?!1:r.getOrdinate(0,Q.X)===r.getOrdinate(e-1,Q.X)&&r.getOrdinate(0,Q.Y)===r.getOrdinate(e-1,Q.Y)};Ct.isEqual=function(r,e){var t=r.size(),n=e.size();if(t!==n)return!1;for(var o=Math.min(r.getDimension(),e.getDimension()),a=0;a<t;a++)for(var l=0;l<o;l++){var s=r.getOrdinate(a,l),m=e.getOrdinate(a,l);if(r.getOrdinate(a,l)!==e.getOrdinate(a,l)&&!(z.isNaN(s)&&z.isNaN(m)))return!1}return!0};Ct.extend=function(r,e,t){var n=r.create(t,e.getDimension()),o=e.size();if(Ct.copy(e,0,n,0,o),o>0)for(var a=o;a<t;a++)Ct.copy(e,o-1,n,a,1);return n};Ct.reverse=function(r){for(var e=r.size()-1,t=Math.trunc(e/2),n=0;n<=t;n++)Ct.swap(r,n,e-n)};Ct.swap=function(r,e,t){if(e===t)return null;for(var n=0;n<r.getDimension();n++){var o=r.getOrdinate(e,n);r.setOrdinate(e,n,r.getOrdinate(t,n)),r.setOrdinate(t,n,o)}};Ct.copy=function(r,e,t,n,o){for(var a=0;a<o;a++)Ct.copyCoord(r,e+a,t,n+a)};Ct.toString=function(){if(arguments.length===1){var r=arguments[0],e=r.size();if(e===0)return"()";var t=r.getDimension(),n=new _n;n.append("(");for(var o=0;o<e;o++){o>0&&n.append(" ");for(var a=0;a<t;a++)a>0&&n.append(","),n.append(Te.toString(r.getOrdinate(o,a)))}return n.append(")"),n.toString()}};Ct.ensureValidRing=function(r,e){var t=e.size();if(t===0)return e;if(t<=3)return Ct.createClosedRing(r,e,4);var n=e.getOrdinate(0,Q.X)===e.getOrdinate(t-1,Q.X)&&e.getOrdinate(0,Q.Y)===e.getOrdinate(t-1,Q.Y);return n?e:Ct.createClosedRing(r,e,t+1)};Ct.createClosedRing=function(r,e,t){var n=r.create(t,e.getDimension()),o=e.size();Ct.copy(e,0,n,0,o);for(var a=o;a<t;a++)Ct.copy(e,0,n,a,1);return n};var yt=function(r){function e(n,o){r.call(this,o),this._points=null,this.init(n)}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new B:this._points.expandEnvelope(new B)},e.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},e.prototype.getSortIndex=function(){return r.SORTINDEX_LINESTRING},e.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},e.prototype.equalsExact=function(){var n=this;if(arguments.length===2){var o=arguments[0],a=arguments[1];if(!this.isEquivalentClass(o))return!1;var l=o;if(this._points.size()!==l._points.size())return!1;for(var s=0;s<this._points.size();s++)if(!n.equal(n._points.getCoordinate(s),l._points.getCoordinate(s),a))return!1;return!0}else return r.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var n=this,o=0;o<Math.trunc(this._points.size()/2);o++){var a=n._points.size()-1-o;if(!n._points.getCoordinate(o).equals(n._points.getCoordinate(a)))return n._points.getCoordinate(o).compareTo(n._points.getCoordinate(a))>0&&Ct.reverse(n._points),null}},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Z.FALSE:0},e.prototype.isClosed=function(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},e.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},e.prototype.getDimension=function(){return 1},e.prototype.getLength=function(){return M.computeLength(this._points)},e.prototype.getNumPoints=function(){return this._points.size()},e.prototype.reverse=function(){var n=this._points.copy();Ct.reverse(n);var o=this.getFactory().createLineString(n);return o},e.prototype.compareToSameClass=function(){var n=this;if(arguments.length===1){for(var o=arguments[0],a=o,l=0,s=0;l<this._points.size()&&s<a._points.size();){var m=n._points.getCoordinate(l).compareTo(a._points.getCoordinate(s));if(m!==0)return m;l++,s++}return l<this._points.size()?1:s<a._points.size()?-1:0}else if(arguments.length===2){var y=arguments[0],D=arguments[1],W=y;return D.compare(this._points,W._points)}},e.prototype.apply=function(){var n=this;if(V(arguments[0],Ln))for(var o=arguments[0],a=0;a<this._points.size();a++)o.filter(n._points.getCoordinate(a));else if(V(arguments[0],Ye)){var l=arguments[0];if(this._points.size()===0)return null;for(var s=0;s<this._points.size()&&(l.filter(n._points,s),!l.isDone());s++);l.isGeometryChanged()&&this.geometryChanged()}else if(V(arguments[0],cn)){var m=arguments[0];m.filter(this)}else if(V(arguments[0],Zn)){var y=arguments[0];y.filter(this)}},e.prototype.getBoundary=function(){return new Oe(this).getBoundary()},e.prototype.isEquivalentClass=function(n){return n instanceof e},e.prototype.clone=function(){var n=r.prototype.clone.call(this);return n._points=this._points.clone(),n},e.prototype.getCoordinateN=function(n){return this._points.getCoordinate(n)},e.prototype.getGeometryType=function(){return"LineString"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._points},e.prototype.isEmpty=function(){return this._points.size()===0},e.prototype.init=function(n){if(n===null&&(n=this.getFactory().getCoordinateSequenceFactory().create([])),n.size()===1)throw new ft("Invalid number of points in LineString (found "+n.size()+" - must be 0 or >= 2)");this._points=n},e.prototype.isCoordinate=function(n){for(var o=this,a=0;a<this._points.size();a++)if(o._points.getCoordinate(a).equals(n))return!0;return!1},e.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},e.prototype.getPointN=function(n){return this.getFactory().createPoint(this._points.getCoordinate(n))},e.prototype.interfaces_=function(){return[oo]},e.prototype.getClass=function(){return e},t.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(e,t),e}(G),so=function(){};so.prototype.interfaces_=function(){return[]};so.prototype.getClass=function(){return so};var de=function(r){function e(n,o){r.call(this,o),this._coordinates=n||null,this.init(this._coordinates)}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new B;var n=new B;return n.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),n},e.prototype.getSortIndex=function(){return r.SORTINDEX_POINT},e.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},e.prototype.equalsExact=function(){if(arguments.length===2){var n=arguments[0],o=arguments[1];return this.isEquivalentClass(n)?this.isEmpty()&&n.isEmpty()?!0:this.isEmpty()!==n.isEmpty()?!1:this.equal(n.getCoordinate(),this.getCoordinate(),o):!1}else return r.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){},e.prototype.getCoordinate=function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null},e.prototype.getBoundaryDimension=function(){return Z.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getNumPoints=function(){return this.isEmpty()?0:1},e.prototype.reverse=function(){return this.copy()},e.prototype.getX=function(){if(this.getCoordinate()===null)throw new Error("getX called on empty Point");return this.getCoordinate().x},e.prototype.compareToSameClass=function(){if(arguments.length===1){var n=arguments[0],o=n;return this.getCoordinate().compareTo(o.getCoordinate())}else if(arguments.length===2){var a=arguments[0],l=arguments[1],s=a;return l.compare(this._coordinates,s._coordinates)}},e.prototype.apply=function(){if(V(arguments[0],Ln)){var n=arguments[0];if(this.isEmpty())return null;n.filter(this.getCoordinate())}else if(V(arguments[0],Ye)){var o=arguments[0];if(this.isEmpty())return null;o.filter(this._coordinates,0),o.isGeometryChanged()&&this.geometryChanged()}else if(V(arguments[0],cn)){var a=arguments[0];a.filter(this)}else if(V(arguments[0],Zn)){var l=arguments[0];l.filter(this)}},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.clone=function(){var n=r.prototype.clone.call(this);return n._coordinates=this._coordinates.clone(),n},e.prototype.getGeometryType=function(){return"Point"},e.prototype.copy=function(){return new e(this._coordinates.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._coordinates},e.prototype.getY=function(){if(this.getCoordinate()===null)throw new Error("getY called on empty Point");return this.getCoordinate().y},e.prototype.isEmpty=function(){return this._coordinates.size()===0},e.prototype.init=function(n){n===null&&(n=this.getFactory().getCoordinateSequenceFactory().create([])),q.isTrue(n.size()<=1),this._coordinates=n},e.prototype.isSimple=function(){return!0},e.prototype.interfaces_=function(){return[so]},e.prototype.getClass=function(){return e},t.serialVersionUID.get=function(){return 4902022702746615e3},Object.defineProperties(e,t),e}(G),fr=function(){};fr.prototype.interfaces_=function(){return[]};fr.prototype.getClass=function(){return fr};var Ot=function(r){function e(n,o,a){if(r.call(this,a),this._shell=null,this._holes=null,n===null&&(n=this.getFactory().createLinearRing()),o===null&&(o=[]),r.hasNullElements(o))throw new ft("holes must not contain null elements");if(n.isEmpty()&&r.hasNonEmptyElements(o))throw new ft("shell is empty but holes are not");this._shell=n,this._holes=o}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},e.prototype.getSortIndex=function(){return r.SORTINDEX_POLYGON},e.prototype.getCoordinates=function(){var n=this;if(this.isEmpty())return[];for(var o=new Array(this.getNumPoints()).fill(null),a=-1,l=this._shell.getCoordinates(),s=0;s<l.length;s++)a++,o[a]=l[s];for(var m=0;m<this._holes.length;m++)for(var y=n._holes[m].getCoordinates(),D=0;D<y.length;D++)a++,o[a]=y[D];return o},e.prototype.getArea=function(){var n=this,o=0;o+=Math.abs(M.signedArea(this._shell.getCoordinateSequence()));for(var a=0;a<this._holes.length;a++)o-=Math.abs(M.signedArea(n._holes[a].getCoordinateSequence()));return o},e.prototype.isRectangle=function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var n=this._shell.getCoordinateSequence(),o=this.getEnvelopeInternal(),a=0;a<5;a++){var l=n.getX(a);if(!(l===o.getMinX()||l===o.getMaxX()))return!1;var s=n.getY(a);if(!(s===o.getMinY()||s===o.getMaxY()))return!1}for(var m=n.getX(0),y=n.getY(0),D=1;D<=4;D++){var W=n.getX(D),Ee=n.getY(D),dt=W!==m,Ht=Ee!==y;if(dt===Ht)return!1;m=W,y=Ee}return!0},e.prototype.equalsExact=function(){var n=this;if(arguments.length===2){var o=arguments[0],a=arguments[1];if(!this.isEquivalentClass(o))return!1;var l=o,s=this._shell,m=l._shell;if(!s.equalsExact(m,a)||this._holes.length!==l._holes.length)return!1;for(var y=0;y<this._holes.length;y++)if(!n._holes[y].equalsExact(l._holes[y],a))return!1;return!0}else return r.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){var n=this;if(arguments.length===0){this.normalize(this._shell,!0);for(var o=0;o<this._holes.length;o++)n.normalize(n._holes[o],!1);Lr.sort(this._holes)}else if(arguments.length===2){var a=arguments[0],l=arguments[1];if(a.isEmpty())return null;var s=new Array(a.getCoordinates().length-1).fill(null);qt.arraycopy(a.getCoordinates(),0,s,0,s.length);var m=j.minCoordinate(a.getCoordinates());j.scroll(s,m),qt.arraycopy(s,0,a.getCoordinates(),0,s.length),a.getCoordinates()[s.length]=s[0],M.isCCW(a.getCoordinates())===l&&j.reverse(a.getCoordinates())}},e.prototype.getCoordinate=function(){return this._shell.getCoordinate()},e.prototype.getNumInteriorRing=function(){return this._holes.length},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.getLength=function(){var n=this,o=0;o+=this._shell.getLength();for(var a=0;a<this._holes.length;a++)o+=n._holes[a].getLength();return o},e.prototype.getNumPoints=function(){for(var n=this,o=this._shell.getNumPoints(),a=0;a<this._holes.length;a++)o+=n._holes[a].getNumPoints();return o},e.prototype.reverse=function(){var n=this,o=this.copy();o._shell=this._shell.copy().reverse(),o._holes=new Array(this._holes.length).fill(null);for(var a=0;a<this._holes.length;a++)o._holes[a]=n._holes[a].copy().reverse();return o},e.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},e.prototype.compareToSameClass=function(){var n=this;if(arguments.length===1){var o=arguments[0],a=this._shell,l=o._shell;return a.compareToSameClass(l)}else if(arguments.length===2){var s=arguments[0],m=arguments[1],y=s,D=this._shell,W=y._shell,Ee=D.compareToSameClass(W,m);if(Ee!==0)return Ee;for(var dt=this.getNumInteriorRing(),Ht=y.getNumInteriorRing(),ir=0;ir<dt&&ir<Ht;){var Hr=n.getInteriorRingN(ir),Bn=y.getInteriorRingN(ir),Vn=Hr.compareToSameClass(Bn,m);if(Vn!==0)return Vn;ir++}return ir<dt?1:ir<Ht?-1:0}},e.prototype.apply=function(n){var o=this;if(V(n,Ln)){this._shell.apply(n);for(var a=0;a<this._holes.length;a++)o._holes[a].apply(n)}else if(V(n,Ye)){if(this._shell.apply(n),!n.isDone())for(var l=0;l<this._holes.length&&(o._holes[l].apply(n),!n.isDone());l++);n.isGeometryChanged()&&this.geometryChanged()}else if(V(n,cn))n.filter(this);else if(V(n,Zn)){n.filter(this),this._shell.apply(n);for(var s=0;s<this._holes.length;s++)o._holes[s].apply(n)}},e.prototype.getBoundary=function(){var n=this;if(this.isEmpty())return this.getFactory().createMultiLineString();var o=new Array(this._holes.length+1).fill(null);o[0]=this._shell;for(var a=0;a<this._holes.length;a++)o[a+1]=n._holes[a];return o.length<=1?this.getFactory().createLinearRing(o[0].getCoordinateSequence()):this.getFactory().createMultiLineString(o)},e.prototype.clone=function(){var n=this,o=r.prototype.clone.call(this);o._shell=this._shell.clone(),o._holes=new Array(this._holes.length).fill(null);for(var a=0;a<this._holes.length;a++)o._holes[a]=n._holes[a].clone();return o},e.prototype.getGeometryType=function(){return"Polygon"},e.prototype.copy=function(){for(var n=this,o=this._shell.copy(),a=new Array(this._holes.length).fill(null),l=0;l<a.length;l++)a[l]=n._holes[l].copy();return new e(o,a,this._factory)},e.prototype.getExteriorRing=function(){return this._shell},e.prototype.isEmpty=function(){return this._shell.isEmpty()},e.prototype.getInteriorRingN=function(n){return this._holes[n]},e.prototype.interfaces_=function(){return[fr]},e.prototype.getClass=function(){return e},t.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(e,t),e}(G),Pi=function(r){function e(){r.apply(this,arguments)}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return G.SORTINDEX_MULTIPOINT},e.prototype.isValid=function(){return!0},e.prototype.equalsExact=function(){if(arguments.length===2){var n=arguments[0],o=arguments[1];return this.isEquivalentClass(n)?r.prototype.equalsExact.call(this,n,o):!1}else return r.prototype.equalsExact.apply(this,arguments)},e.prototype.getCoordinate=function(){if(arguments.length===1){var n=arguments[0];return this._geometries[n].getCoordinate()}else return r.prototype.getCoordinate.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return Z.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.getGeometryType=function(){return"MultiPoint"},e.prototype.copy=function(){for(var n=this,o=new Array(this._geometries.length).fill(null),a=0;a<o.length;a++)o[a]=n._geometries[a].copy();return new e(o,this._factory)},e.prototype.interfaces_=function(){return[so]},e.prototype.getClass=function(){return e},t.serialVersionUID.get=function(){return-8048474874175356e3},Object.defineProperties(e,t),e}(ie),bn=function(r){function e(n,o){n instanceof d&&o instanceof H&&(n=o.getCoordinateSequenceFactory().create(n)),r.call(this,n,o),this.validateConstruction()}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return G.SORTINDEX_LINEARRING},e.prototype.getBoundaryDimension=function(){return Z.FALSE},e.prototype.isClosed=function(){return this.isEmpty()?!0:r.prototype.isClosed.call(this)},e.prototype.reverse=function(){var n=this._points.copy();Ct.reverse(n);var o=this.getFactory().createLinearRing(n);return o},e.prototype.validateConstruction=function(){if(!this.isEmpty()&&!r.prototype.isClosed.call(this))throw new ft("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<e.MINIMUM_VALID_SIZE)throw new ft("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},e.prototype.getGeometryType=function(){return"LinearRing"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},t.MINIMUM_VALID_SIZE.get=function(){return 4},t.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(e,t),e}(yt),Sn=function(r){function e(){r.apply(this,arguments)}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return G.SORTINDEX_MULTIPOLYGON},e.prototype.equalsExact=function(){if(arguments.length===2){var n=arguments[0],o=arguments[1];return this.isEquivalentClass(n)?r.prototype.equalsExact.call(this,n,o):!1}else return r.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.reverse=function(){for(var n=this,o=this._geometries.length,a=new Array(o).fill(null),l=0;l<this._geometries.length;l++)a[l]=n._geometries[l].reverse();return this.getFactory().createMultiPolygon(a)},e.prototype.getBoundary=function(){var n=this;if(this.isEmpty())return this.getFactory().createMultiLineString();for(var o=new O,a=0;a<this._geometries.length;a++)for(var l=n._geometries[a],s=l.getBoundary(),m=0;m<s.getNumGeometries();m++)o.add(s.getGeometryN(m));var y=new Array(o.size()).fill(null);return this.getFactory().createMultiLineString(o.toArray(y))},e.prototype.getGeometryType=function(){return"MultiPolygon"},e.prototype.copy=function(){for(var n=this,o=new Array(this._geometries.length).fill(null),a=0;a<o.length;a++)o[a]=n._geometries[a].copy();return new e(o,this._factory)},e.prototype.interfaces_=function(){return[fr]},e.prototype.getClass=function(){return e},t.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(e,t),e}(ie),Fe=function(r){this._factory=r||null,this._isUserDataCopied=!1},is={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};Fe.prototype.setCopyUserData=function(r){this._isUserDataCopied=r};Fe.prototype.edit=function(r,e){if(r===null)return null;var t=this.editInternal(r,e);return this._isUserDataCopied&&t.setUserData(r.getUserData()),t};Fe.prototype.editInternal=function(r,e){return this._factory===null&&(this._factory=r.getFactory()),r instanceof ie?this.editGeometryCollection(r,e):r instanceof Ot?this.editPolygon(r,e):r instanceof de?e.edit(r,this._factory):r instanceof yt?e.edit(r,this._factory):(q.shouldNeverReachHere("Unsupported Geometry class: "+r.getClass().getName()),null)};Fe.prototype.editGeometryCollection=function(r,e){for(var t=this,n=e.edit(r,this._factory),o=new O,a=0;a<n.getNumGeometries();a++){var l=t.edit(n.getGeometryN(a),e);l===null||l.isEmpty()||o.add(l)}return n.getClass()===Pi?this._factory.createMultiPoint(o.toArray([])):n.getClass()===Tr?this._factory.createMultiLineString(o.toArray([])):n.getClass()===Sn?this._factory.createMultiPolygon(o.toArray([])):this._factory.createGeometryCollection(o.toArray([]))};Fe.prototype.editPolygon=function(r,e){var t=this,n=e.edit(r,this._factory);if(n===null&&(n=this._factory.createPolygon(null)),n.isEmpty())return n;var o=this.edit(n.getExteriorRing(),e);if(o===null||o.isEmpty())return this._factory.createPolygon();for(var a=new O,l=0;l<n.getNumInteriorRing();l++){var s=t.edit(n.getInteriorRingN(l),e);s===null||s.isEmpty()||a.add(s)}return this._factory.createPolygon(o,a.toArray([]))};Fe.prototype.interfaces_=function(){return[]};Fe.prototype.getClass=function(){return Fe};Fe.GeometryEditorOperation=function(){};is.NoOpGeometryOperation.get=function(){return ao};is.CoordinateOperation.get=function(){return uo};is.CoordinateSequenceOperation.get=function(){return lo};Object.defineProperties(Fe,is);var ao=function(){};ao.prototype.edit=function(r,e){return r};ao.prototype.interfaces_=function(){return[Fe.GeometryEditorOperation]};ao.prototype.getClass=function(){return ao};var uo=function(){};uo.prototype.edit=function(r,e){var t=this.editCoordinates(r.getCoordinates(),r);return t===null?r:r instanceof bn?e.createLinearRing(t):r instanceof yt?e.createLineString(t):r instanceof de?t.length>0?e.createPoint(t[0]):e.createPoint():r};uo.prototype.interfaces_=function(){return[Fe.GeometryEditorOperation]};uo.prototype.getClass=function(){return uo};var lo=function(){};lo.prototype.edit=function(r,e){return r instanceof bn?e.createLinearRing(this.edit(r.getCoordinateSequence(),r)):r instanceof yt?e.createLineString(this.edit(r.getCoordinateSequence(),r)):r instanceof de?e.createPoint(this.edit(r.getCoordinateSequence(),r)):r};lo.prototype.interfaces_=function(){return[Fe.GeometryEditorOperation]};lo.prototype.getClass=function(){return lo};var _t=function(){var r=this;if(this._dimension=3,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var e=arguments[0];this._coordinates=new Array(e).fill(null);for(var t=0;t<e;t++)r._coordinates[t]=new d}else if(V(arguments[0],Q)){var n=arguments[0];if(n===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=n.getDimension(),this._coordinates=new Array(n.size()).fill(null);for(var o=0;o<this._coordinates.length;o++)r._coordinates[o]=n.getCoordinateCopy(o)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var a=arguments[0],l=arguments[1];this._coordinates=a,this._dimension=l,a===null&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var s=arguments[0],m=arguments[1];this._coordinates=new Array(s).fill(null),this._dimension=m;for(var y=0;y<s;y++)r._coordinates[y]=new d}}},Iu={serialVersionUID:{configurable:!0}};_t.prototype.setOrdinate=function(r,e,t){switch(e){case Q.X:this._coordinates[r].x=t;break;case Q.Y:this._coordinates[r].y=t;break;case Q.Z:this._coordinates[r].z=t;break;default:throw new ft("invalid ordinateIndex")}};_t.prototype.size=function(){return this._coordinates.length};_t.prototype.getOrdinate=function(r,e){switch(e){case Q.X:return this._coordinates[r].x;case Q.Y:return this._coordinates[r].y;case Q.Z:return this._coordinates[r].z}return z.NaN};_t.prototype.getCoordinate=function(){if(arguments.length===1){var r=arguments[0];return this._coordinates[r]}else if(arguments.length===2){var e=arguments[0],t=arguments[1];t.x=this._coordinates[e].x,t.y=this._coordinates[e].y,t.z=this._coordinates[e].z}};_t.prototype.getCoordinateCopy=function(r){return new d(this._coordinates[r])};_t.prototype.getDimension=function(){return this._dimension};_t.prototype.getX=function(r){return this._coordinates[r].x};_t.prototype.clone=function(){for(var r=this,e=new Array(this.size()).fill(null),t=0;t<this._coordinates.length;t++)e[t]=r._coordinates[t].clone();return new _t(e,this._dimension)};_t.prototype.expandEnvelope=function(r){for(var e=this,t=0;t<this._coordinates.length;t++)r.expandToInclude(e._coordinates[t]);return r};_t.prototype.copy=function(){for(var r=this,e=new Array(this.size()).fill(null),t=0;t<this._coordinates.length;t++)e[t]=r._coordinates[t].copy();return new _t(e,this._dimension)};_t.prototype.toString=function(){var r=this;if(this._coordinates.length>0){var e=new _n(17*this._coordinates.length);e.append("("),e.append(this._coordinates[0]);for(var t=1;t<this._coordinates.length;t++)e.append(", "),e.append(r._coordinates[t]);return e.append(")"),e.toString()}else return"()"};_t.prototype.getY=function(r){return this._coordinates[r].y};_t.prototype.toCoordinateArray=function(){return this._coordinates};_t.prototype.interfaces_=function(){return[Q,Ge]};_t.prototype.getClass=function(){return _t};Iu.serialVersionUID.get=function(){return-0xcb44a778db18e00};Object.defineProperties(_t,Iu);var Pn=function(){},Ws={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};Pn.prototype.readResolve=function(){return Pn.instance()};Pn.prototype.create=function(){if(arguments.length===1){if(arguments[0]instanceof Array){var r=arguments[0];return new _t(r)}else if(V(arguments[0],Q)){var e=arguments[0];return new _t(e)}}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return n>3&&(n=3),n<2?new _t(t):new _t(t,n)}};Pn.prototype.interfaces_=function(){return[Ni,Ge]};Pn.prototype.getClass=function(){return Pn};Pn.instance=function(){return Pn.instanceObject};Ws.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00};Ws.instanceObject.get=function(){return new Pn};Object.defineProperties(Pn,Ws);var Cu=function(r){function e(){r.call(this),this.map_=new Map}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return this.map_.get(t)||null},e.prototype.put=function(t,n){return this.map_.set(t,n),n},e.prototype.values=function(){for(var t=new O,n=this.map_.values(),o=n.next();!o.done;)t.add(o.value),o=n.next();return t},e.prototype.entrySet=function(){var t=new Xs;return this.map_.entries().forEach(function(n){return t.add(n)}),t},e.prototype.size=function(){return this.map_.size()},e}(hi),$=function r(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=r.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof fn){var e=arguments[0];this._modelType=e,e===r.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var t=arguments[0];this._modelType=r.FIXED,this.setScale(t)}else if(arguments[0]instanceof r){var n=arguments[0];this._modelType=n._modelType,this._scale=n._scale}}},Hs={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};$.prototype.equals=function(r){if(!(r instanceof $))return!1;var e=r;return this._modelType===e._modelType&&this._scale===e._scale};$.prototype.compareTo=function(r){var e=r,t=this.getMaximumSignificantDigits(),n=e.getMaximumSignificantDigits();return new un(t).compareTo(new un(n))};$.prototype.getScale=function(){return this._scale};$.prototype.isFloating=function(){return this._modelType===$.FLOATING||this._modelType===$.FLOATING_SINGLE};$.prototype.getType=function(){return this._modelType};$.prototype.toString=function(){var r="UNKNOWN";return this._modelType===$.FLOATING?r="Floating":this._modelType===$.FLOATING_SINGLE?r="Floating-Single":this._modelType===$.FIXED&&(r="Fixed (Scale="+this.getScale()+")"),r};$.prototype.makePrecise=function(){if(typeof arguments[0]=="number"){var r=arguments[0];if(z.isNaN(r))return r;if(this._modelType===$.FLOATING_SINGLE){var e=r;return e}return this._modelType===$.FIXED?Math.round(r*this._scale)/this._scale:r}else if(arguments[0]instanceof d){var t=arguments[0];if(this._modelType===$.FLOATING)return null;t.x=this.makePrecise(t.x),t.y=this.makePrecise(t.y)}};$.prototype.getMaximumSignificantDigits=function(){var r=16;return this._modelType===$.FLOATING?r=16:this._modelType===$.FLOATING_SINGLE?r=6:this._modelType===$.FIXED&&(r=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),r};$.prototype.setScale=function(r){this._scale=Math.abs(r)};$.prototype.interfaces_=function(){return[Ge,ke]};$.prototype.getClass=function(){return $};$.mostPrecise=function(r,e){return r.compareTo(e)>=0?r:e};Hs.serialVersionUID.get=function(){return 7777263578777804e3};Hs.maximumPreciseValue.get=function(){return 9007199254740992};Object.defineProperties($,Hs);var fn=function r(e){this._name=e||null,r.nameToTypeMap.put(e,this)},js={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};fn.prototype.readResolve=function(){return fn.nameToTypeMap.get(this._name)};fn.prototype.toString=function(){return this._name};fn.prototype.interfaces_=function(){return[Ge]};fn.prototype.getClass=function(){return fn};js.serialVersionUID.get=function(){return-552860263173159e4};js.nameToTypeMap.get=function(){return new Cu};Object.defineProperties(fn,js);$.Type=fn;$.FIXED=new fn("FIXED");$.FLOATING=new fn("FLOATING");$.FLOATING_SINGLE=new fn("FLOATING SINGLE");var H=function r(){this._precisionModel=new $,this._SRID=0,this._coordinateSequenceFactory=r.getDefaultCoordinateSequenceFactory(),arguments.length===0||(arguments.length===1?V(arguments[0],Ni)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof $&&(this._precisionModel=arguments[0]):arguments.length===2?(this._precisionModel=arguments[0],this._SRID=arguments[1]):arguments.length===3&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},Nu={serialVersionUID:{configurable:!0}};H.prototype.toGeometry=function(r){return r.isNull()?this.createPoint(null):r.getMinX()===r.getMaxX()&&r.getMinY()===r.getMaxY()?this.createPoint(new d(r.getMinX(),r.getMinY())):r.getMinX()===r.getMaxX()||r.getMinY()===r.getMaxY()?this.createLineString([new d(r.getMinX(),r.getMinY()),new d(r.getMaxX(),r.getMaxY())]):this.createPolygon(this.createLinearRing([new d(r.getMinX(),r.getMinY()),new d(r.getMinX(),r.getMaxY()),new d(r.getMaxX(),r.getMaxY()),new d(r.getMaxX(),r.getMinY()),new d(r.getMinX(),r.getMinY())]),null)};H.prototype.createLineString=function(r){if(r){if(r instanceof Array)return new yt(this.getCoordinateSequenceFactory().create(r),this);if(V(r,Q))return new yt(r,this)}else return new yt(this.getCoordinateSequenceFactory().create([]),this)};H.prototype.createMultiLineString=function(){if(arguments.length===0)return new Tr(null,this);if(arguments.length===1){var r=arguments[0];return new Tr(r,this)}};H.prototype.buildGeometry=function(r){for(var e=null,t=!1,n=!1,o=r.iterator();o.hasNext();){var a=o.next(),l=a.getClass();e===null&&(e=l),l!==e&&(t=!0),a.isGeometryCollectionOrDerived()&&(n=!0)}if(e===null)return this.createGeometryCollection();if(t||n)return this.createGeometryCollection(H.toGeometryArray(r));var s=r.iterator().next(),m=r.size()>1;if(m){if(s instanceof Ot)return this.createMultiPolygon(H.toPolygonArray(r));if(s instanceof yt)return this.createMultiLineString(H.toLineStringArray(r));if(s instanceof de)return this.createMultiPoint(H.toPointArray(r));q.shouldNeverReachHere("Unhandled class: "+s.getClass().getName())}return s};H.prototype.createMultiPointFromCoords=function(r){return this.createMultiPoint(r!==null?this.getCoordinateSequenceFactory().create(r):null)};H.prototype.createPoint=function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof d){var r=arguments[0];return this.createPoint(r!==null?this.getCoordinateSequenceFactory().create([r]):null)}else if(V(arguments[0],Q)){var e=arguments[0];return new de(e,this)}}};H.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory};H.prototype.createPolygon=function(){if(arguments.length===0)return new Ot(null,null,this);if(arguments.length===1){if(V(arguments[0],Q)){var r=arguments[0];return this.createPolygon(this.createLinearRing(r))}else if(arguments[0]instanceof Array){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}else if(arguments[0]instanceof bn){var t=arguments[0];return this.createPolygon(t,null)}}else if(arguments.length===2){var n=arguments[0],o=arguments[1];return new Ot(n,o,this)}};H.prototype.getSRID=function(){return this._SRID};H.prototype.createGeometryCollection=function(){if(arguments.length===0)return new ie(null,this);if(arguments.length===1){var r=arguments[0];return new ie(r,this)}};H.prototype.createGeometry=function(r){var e=new Fe(this);return e.edit(r,{edit:function(){if(arguments.length===2){var t=arguments[0];return this._coordinateSequenceFactory.create(t)}}})};H.prototype.getPrecisionModel=function(){return this._precisionModel};H.prototype.createLinearRing=function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var r=arguments[0];return this.createLinearRing(r!==null?this.getCoordinateSequenceFactory().create(r):null)}else if(V(arguments[0],Q)){var e=arguments[0];return new bn(e,this)}}};H.prototype.createMultiPolygon=function(){if(arguments.length===0)return new Sn(null,this);if(arguments.length===1){var r=arguments[0];return new Sn(r,this)}};H.prototype.createMultiPoint=function(){var r=this;if(arguments.length===0)return new Pi(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return new Pi(e,this)}else if(arguments[0]instanceof Array){var t=arguments[0];return this.createMultiPoint(t!==null?this.getCoordinateSequenceFactory().create(t):null)}else if(V(arguments[0],Q)){var n=arguments[0];if(n===null)return this.createMultiPoint(new Array(0).fill(null));for(var o=new Array(n.size()).fill(null),a=0;a<n.size();a++){var l=r.getCoordinateSequenceFactory().create(1,n.getDimension());Ct.copy(n,a,l,0,1),o[a]=r.createPoint(l)}return this.createMultiPoint(o)}}};H.prototype.interfaces_=function(){return[Ge]};H.prototype.getClass=function(){return H};H.toMultiPolygonArray=function(r){var e=new Array(r.size()).fill(null);return r.toArray(e)};H.toGeometryArray=function(r){if(r===null)return null;var e=new Array(r.size()).fill(null);return r.toArray(e)};H.getDefaultCoordinateSequenceFactory=function(){return Pn.instance()};H.toMultiLineStringArray=function(r){var e=new Array(r.size()).fill(null);return r.toArray(e)};H.toLineStringArray=function(r){var e=new Array(r.size()).fill(null);return r.toArray(e)};H.toMultiPointArray=function(r){var e=new Array(r.size()).fill(null);return r.toArray(e)};H.toLinearRingArray=function(r){var e=new Array(r.size()).fill(null);return r.toArray(e)};H.toPointArray=function(r){var e=new Array(r.size()).fill(null);return r.toArray(e)};H.toPolygonArray=function(r){var e=new Array(r.size()).fill(null);return r.toArray(e)};H.createPointFromInternalCoord=function(r,e){return e.getPrecisionModel().makePrecise(r),e.getFactory().createPoint(r)};Nu.serialVersionUID.get=function(){return-6820524753094096e3};Object.defineProperties(H,Nu);var tf=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],os=function(r){this.geometryFactory=r||new H};os.prototype.read=function(r){var e;typeof r=="string"?e=JSON.parse(r):e=r;var t=e.type;if(!en[t])throw new Error("Unknown GeoJSON type: "+e.type);return tf.indexOf(t)!==-1?en[t].apply(this,[e.coordinates]):t==="GeometryCollection"?en[t].apply(this,[e.geometries]):en[t].apply(this,[e])};os.prototype.write=function(r){var e=r.getGeometryType();if(!Xn[e])throw new Error("Geometry is not supported");return Xn[e].apply(this,[r])};var en={Feature:function(r){var e={};for(var t in r)e[t]=r[t];if(r.geometry){var n=r.geometry.type;if(!en[n])throw new Error("Unknown GeoJSON type: "+r.type);e.geometry=this.read(r.geometry)}return r.bbox&&(e.bbox=en.bbox.apply(this,[r.bbox])),e},FeatureCollection:function(r){var e=this,t={};if(r.features){t.features=[];for(var n=0;n<r.features.length;++n)t.features.push(e.read(r.features[n]))}return r.bbox&&(t.bbox=this.parse.bbox.apply(this,[r.bbox])),t},coordinates:function(r){for(var e=[],t=0;t<r.length;++t){var n=r[t];e.push(new d(n[0],n[1]))}return e},bbox:function(r){return this.geometryFactory.createLinearRing([new d(r[0],r[1]),new d(r[2],r[1]),new d(r[2],r[3]),new d(r[0],r[3]),new d(r[0],r[1])])},Point:function(r){var e=new d(r[0],r[1]);return this.geometryFactory.createPoint(e)},MultiPoint:function(r){for(var e=this,t=[],n=0;n<r.length;++n)t.push(en.Point.apply(e,[r[n]]));return this.geometryFactory.createMultiPoint(t)},LineString:function(r){var e=en.coordinates.apply(this,[r]);return this.geometryFactory.createLineString(e)},MultiLineString:function(r){for(var e=this,t=[],n=0;n<r.length;++n)t.push(en.LineString.apply(e,[r[n]]));return this.geometryFactory.createMultiLineString(t)},Polygon:function(r){for(var e=this,t=en.coordinates.apply(this,[r[0]]),n=this.geometryFactory.createLinearRing(t),o=[],a=1;a<r.length;++a){var l=r[a],s=en.coordinates.apply(e,[l]),m=e.geometryFactory.createLinearRing(s);o.push(m)}return this.geometryFactory.createPolygon(n,o)},MultiPolygon:function(r){for(var e=this,t=[],n=0;n<r.length;++n){var o=r[n];t.push(en.Polygon.apply(e,[o]))}return this.geometryFactory.createMultiPolygon(t)},GeometryCollection:function(r){for(var e=this,t=[],n=0;n<r.length;++n){var o=r[n];t.push(e.read(o))}return this.geometryFactory.createGeometryCollection(t)}},Xn={coordinate:function(r){return[r.x,r.y]},Point:function(r){var e=Xn.coordinate.apply(this,[r.getCoordinate()]);return{type:"Point",coordinates:e}},MultiPoint:function(r){for(var e=this,t=[],n=0;n<r._geometries.length;++n){var o=r._geometries[n],a=Xn.Point.apply(e,[o]);t.push(a.coordinates)}return{type:"MultiPoint",coordinates:t}},LineString:function(r){for(var e=this,t=[],n=r.getCoordinates(),o=0;o<n.length;++o){var a=n[o];t.push(Xn.coordinate.apply(e,[a]))}return{type:"LineString",coordinates:t}},MultiLineString:function(r){for(var e=this,t=[],n=0;n<r._geometries.length;++n){var o=r._geometries[n],a=Xn.LineString.apply(e,[o]);t.push(a.coordinates)}return{type:"MultiLineString",coordinates:t}},Polygon:function(r){var e=this,t=[],n=Xn.LineString.apply(this,[r._shell]);t.push(n.coordinates);for(var o=0;o<r._holes.length;++o){var a=r._holes[o],l=Xn.LineString.apply(e,[a]);t.push(l.coordinates)}return{type:"Polygon",coordinates:t}},MultiPolygon:function(r){for(var e=this,t=[],n=0;n<r._geometries.length;++n){var o=r._geometries[n],a=Xn.Polygon.apply(e,[o]);t.push(a.coordinates)}return{type:"MultiPolygon",coordinates:t}},GeometryCollection:function(r){for(var e=this,t=[],n=0;n<r._geometries.length;++n){var o=r._geometries[n],a=o.getGeometryType();t.push(Xn[a].apply(e,[o]))}return{type:"GeometryCollection",geometries:t}}},Ks=function(r){this.geometryFactory=r||new H,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new os(this.geometryFactory)};Ks.prototype.read=function(r){var e=this.parser.read(r);return this.precisionModel.getType()===$.FIXED&&this.reducePrecision(e),e};Ks.prototype.reducePrecision=function(r){var e=this,t,n;if(r.coordinate)this.precisionModel.makePrecise(r.coordinate);else if(r.points)for(t=0,n=r.points.length;t<n;t++)e.precisionModel.makePrecise(r.points[t]);else if(r.geometries)for(t=0,n=r.geometries.length;t<n;t++)e.reducePrecision(r.geometries[t])};var xu=function(){this.parser=new os(this.geometryFactory)};xu.prototype.write=function(r){return this.parser.write(r)};var b=function(){},ss={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};b.prototype.interfaces_=function(){return[]};b.prototype.getClass=function(){return b};b.opposite=function(r){return r===b.LEFT?b.RIGHT:r===b.RIGHT?b.LEFT:r};ss.ON.get=function(){return 0};ss.LEFT.get=function(){return 1};ss.RIGHT.get=function(){return 2};Object.defineProperties(b,ss);function as(r){this.message=r||""}as.prototype=new Error;as.prototype.name="EmptyStackException";function En(){this.array_=[]}En.prototype=new qe;En.prototype.add=function(r){return this.array_.push(r),!0};En.prototype.get=function(r){if(r<0||r>=this.size())throw new Error;return this.array_[r]};En.prototype.push=function(r){return this.array_.push(r),r};En.prototype.pop=function(r){if(this.array_.length===0)throw new as;return this.array_.pop()};En.prototype.peek=function(){if(this.array_.length===0)throw new as;return this.array_[this.array_.length-1]};En.prototype.empty=function(){return this.array_.length===0};En.prototype.isEmpty=function(){return this.empty()};En.prototype.search=function(r){return this.array_.indexOf(r)};En.prototype.size=function(){return this.array_.length};En.prototype.toArray=function(){for(var r=this,e=[],t=0,n=this.array_.length;t<n;t++)e.push(r.array_[t]);return e};var hn=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};hn.prototype.getCoordinate=function(){return this._minCoord};hn.prototype.getRightmostSide=function(r,e){var t=this.getRightmostSideOfSegment(r,e);return t<0&&(t=this.getRightmostSideOfSegment(r,e-1)),t<0&&(this._minCoord=null,this.checkForRightmostCoordinate(r)),t};hn.prototype.findRightmostEdgeAtVertex=function(){var r=this._minDe.getEdge().getCoordinates();q.isTrue(this._minIndex>0&&this._minIndex<r.length,"rightmost point expected to be interior vertex of edge");var e=r[this._minIndex-1],t=r[this._minIndex+1],n=M.computeOrientation(this._minCoord,t,e),o=!1;(e.y<this._minCoord.y&&t.y<this._minCoord.y&&n===M.COUNTERCLOCKWISE||e.y>this._minCoord.y&&t.y>this._minCoord.y&&n===M.CLOCKWISE)&&(o=!0),o&&(this._minIndex=this._minIndex-1)};hn.prototype.getRightmostSideOfSegment=function(r,e){var t=r.getEdge(),n=t.getCoordinates();if(e<0||e+1>=n.length||n[e].y===n[e+1].y)return-1;var o=b.LEFT;return n[e].y<n[e+1].y&&(o=b.RIGHT),o};hn.prototype.getEdge=function(){return this._orientedDe};hn.prototype.checkForRightmostCoordinate=function(r){for(var e=this,t=r.getEdge().getCoordinates(),n=0;n<t.length-1;n++)(e._minCoord===null||t[n].x>e._minCoord.x)&&(e._minDe=r,e._minIndex=n,e._minCoord=t[n])};hn.prototype.findRightmostEdgeAtNode=function(){var r=this._minDe.getNode(),e=r.getEdges();this._minDe=e.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)};hn.prototype.findEdge=function(r){for(var e=this,t=r.iterator();t.hasNext();){var n=t.next();n.isForward()&&e.checkForRightmostCoordinate(n)}q.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;var o=this.getRightmostSide(this._minDe,this._minIndex);o===b.LEFT&&(this._orientedDe=this._minDe.getSym())};hn.prototype.interfaces_=function(){return[]};hn.prototype.getClass=function(){return hn};var Jn=function(r){function e(t,n){r.call(this,e.msgWithCoord(t,n)),this.pt=n?new d(n):null,this.name="TopologyException"}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.getCoordinate=function(){return this.pt},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.msgWithCoord=function(t,n){return n?t:t+" [ "+n+" ]"},e}(Qn),us=function(){this.array_=[]};us.prototype.addLast=function(r){this.array_.push(r)};us.prototype.removeFirst=function(){return this.array_.shift()};us.prototype.isEmpty=function(){return this.array_.length===0};var oe=function(){this._finder=null,this._dirEdgeList=new O,this._nodes=new O,this._rightMostCoord=null,this._env=null,this._finder=new hn};oe.prototype.clearVisitedEdges=function(){for(var r=this._dirEdgeList.iterator();r.hasNext();){var e=r.next();e.setVisited(!1)}};oe.prototype.getRightmostCoordinate=function(){return this._rightMostCoord};oe.prototype.computeNodeDepth=function(r){for(var e=this,t=null,n=r.getEdges().iterator();n.hasNext();){var o=n.next();if(o.isVisited()||o.getSym().isVisited()){t=o;break}}if(t===null)throw new Jn("unable to find edge to compute depths at "+r.getCoordinate());r.getEdges().computeDepths(t);for(var a=r.getEdges().iterator();a.hasNext();){var l=a.next();l.setVisited(!0),e.copySymDepths(l)}};oe.prototype.computeDepth=function(r){this.clearVisitedEdges();var e=this._finder.getEdge();e.setEdgeDepths(b.RIGHT,r),this.copySymDepths(e),this.computeDepths(e)};oe.prototype.create=function(r){this.addReachable(r),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()};oe.prototype.findResultEdges=function(){for(var r=this._dirEdgeList.iterator();r.hasNext();){var e=r.next();e.getDepth(b.RIGHT)>=1&&e.getDepth(b.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}};oe.prototype.computeDepths=function(r){var e=this,t=new Xs,n=new us,o=r.getNode();for(n.addLast(o),t.add(o),r.setVisited(!0);!n.isEmpty();){var a=n.removeFirst();t.add(a),e.computeNodeDepth(a);for(var l=a.getEdges().iterator();l.hasNext();){var s=l.next(),m=s.getSym();if(!m.isVisited()){var y=m.getNode();t.contains(y)||(n.addLast(y),t.add(y))}}}};oe.prototype.compareTo=function(r){var e=r;return this._rightMostCoord.x<e._rightMostCoord.x?-1:this._rightMostCoord.x>e._rightMostCoord.x?1:0};oe.prototype.getEnvelope=function(){if(this._env===null){for(var r=new B,e=this._dirEdgeList.iterator();e.hasNext();)for(var t=e.next(),n=t.getEdge().getCoordinates(),o=0;o<n.length-1;o++)r.expandToInclude(n[o]);this._env=r}return this._env};oe.prototype.addReachable=function(r){var e=this,t=new En;for(t.add(r);!t.empty();){var n=t.pop();e.add(n,t)}};oe.prototype.copySymDepths=function(r){var e=r.getSym();e.setDepth(b.LEFT,r.getDepth(b.RIGHT)),e.setDepth(b.RIGHT,r.getDepth(b.LEFT))};oe.prototype.add=function(r,e){var t=this;r.setVisited(!0),this._nodes.add(r);for(var n=r.getEdges().iterator();n.hasNext();){var o=n.next();t._dirEdgeList.add(o);var a=o.getSym(),l=a.getNode();l.isVisited()||e.push(l)}};oe.prototype.getNodes=function(){return this._nodes};oe.prototype.getDirectedEdges=function(){return this._dirEdgeList};oe.prototype.interfaces_=function(){return[ke]};oe.prototype.getClass=function(){return oe};var at=function r(){var e=this;if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];this.init(t.length)}else if(Number.isInteger(arguments[0])){var n=arguments[0];this.init(1),this.location[b.ON]=n}else if(arguments[0]instanceof r){var o=arguments[0];if(this.init(o.location.length),o!==null)for(var a=0;a<this.location.length;a++)e.location[a]=o.location[a]}}else if(arguments.length===3){var l=arguments[0],s=arguments[1],m=arguments[2];this.init(3),this.location[b.ON]=l,this.location[b.LEFT]=s,this.location[b.RIGHT]=m}};at.prototype.setAllLocations=function(r){for(var e=this,t=0;t<this.location.length;t++)e.location[t]=r};at.prototype.isNull=function(){for(var r=this,e=0;e<this.location.length;e++)if(r.location[e]!==E.NONE)return!1;return!0};at.prototype.setAllLocationsIfNull=function(r){for(var e=this,t=0;t<this.location.length;t++)e.location[t]===E.NONE&&(e.location[t]=r)};at.prototype.isLine=function(){return this.location.length===1};at.prototype.merge=function(r){var e=this;if(r.location.length>this.location.length){var t=new Array(3).fill(null);t[b.ON]=this.location[b.ON],t[b.LEFT]=E.NONE,t[b.RIGHT]=E.NONE,this.location=t}for(var n=0;n<this.location.length;n++)e.location[n]===E.NONE&&n<r.location.length&&(e.location[n]=r.location[n])};at.prototype.getLocations=function(){return this.location};at.prototype.flip=function(){if(this.location.length<=1)return null;var r=this.location[b.LEFT];this.location[b.LEFT]=this.location[b.RIGHT],this.location[b.RIGHT]=r};at.prototype.toString=function(){var r=new _n;return this.location.length>1&&r.append(E.toLocationSymbol(this.location[b.LEFT])),r.append(E.toLocationSymbol(this.location[b.ON])),this.location.length>1&&r.append(E.toLocationSymbol(this.location[b.RIGHT])),r.toString()};at.prototype.setLocations=function(r,e,t){this.location[b.ON]=r,this.location[b.LEFT]=e,this.location[b.RIGHT]=t};at.prototype.get=function(r){return r<this.location.length?this.location[r]:E.NONE};at.prototype.isArea=function(){return this.location.length>1};at.prototype.isAnyNull=function(){for(var r=this,e=0;e<this.location.length;e++)if(r.location[e]===E.NONE)return!0;return!1};at.prototype.setLocation=function(){if(arguments.length===1){var r=arguments[0];this.setLocation(b.ON,r)}else if(arguments.length===2){var e=arguments[0],t=arguments[1];this.location[e]=t}};at.prototype.init=function(r){this.location=new Array(r).fill(null),this.setAllLocations(E.NONE)};at.prototype.isEqualOnSide=function(r,e){return this.location[e]===r.location[e]};at.prototype.allPositionsEqual=function(r){for(var e=this,t=0;t<this.location.length;t++)if(e.location[t]!==r)return!1;return!0};at.prototype.interfaces_=function(){return[]};at.prototype.getClass=function(){return at};var et=function r(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var e=arguments[0];this.elt[0]=new at(e),this.elt[1]=new at(e)}else if(arguments[0]instanceof r){var t=arguments[0];this.elt[0]=new at(t.elt[0]),this.elt[1]=new at(t.elt[1])}}else if(arguments.length===2){var n=arguments[0],o=arguments[1];this.elt[0]=new at(E.NONE),this.elt[1]=new at(E.NONE),this.elt[n].setLocation(o)}else if(arguments.length===3){var a=arguments[0],l=arguments[1],s=arguments[2];this.elt[0]=new at(a,l,s),this.elt[1]=new at(a,l,s)}else if(arguments.length===4){var m=arguments[0],y=arguments[1],D=arguments[2],W=arguments[3];this.elt[0]=new at(E.NONE,E.NONE,E.NONE),this.elt[1]=new at(E.NONE,E.NONE,E.NONE),this.elt[m].setLocations(y,D,W)}};et.prototype.getGeometryCount=function(){var r=0;return this.elt[0].isNull()||r++,this.elt[1].isNull()||r++,r};et.prototype.setAllLocations=function(r,e){this.elt[r].setAllLocations(e)};et.prototype.isNull=function(r){return this.elt[r].isNull()};et.prototype.setAllLocationsIfNull=function(){if(arguments.length===1){var r=arguments[0];this.setAllLocationsIfNull(0,r),this.setAllLocationsIfNull(1,r)}else if(arguments.length===2){var e=arguments[0],t=arguments[1];this.elt[e].setAllLocationsIfNull(t)}};et.prototype.isLine=function(r){return this.elt[r].isLine()};et.prototype.merge=function(r){for(var e=this,t=0;t<2;t++)e.elt[t]===null&&r.elt[t]!==null?e.elt[t]=new at(r.elt[t]):e.elt[t].merge(r.elt[t])};et.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()};et.prototype.getLocation=function(){if(arguments.length===1){var r=arguments[0];return this.elt[r].get(b.ON)}else if(arguments.length===2){var e=arguments[0],t=arguments[1];return this.elt[e].get(t)}};et.prototype.toString=function(){var r=new _n;return this.elt[0]!==null&&(r.append("A:"),r.append(this.elt[0].toString())),this.elt[1]!==null&&(r.append(" B:"),r.append(this.elt[1].toString())),r.toString()};et.prototype.isArea=function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var r=arguments[0];return this.elt[r].isArea()}};et.prototype.isAnyNull=function(r){return this.elt[r].isAnyNull()};et.prototype.setLocation=function(){if(arguments.length===2){var r=arguments[0],e=arguments[1];this.elt[r].setLocation(b.ON,e)}else if(arguments.length===3){var t=arguments[0],n=arguments[1],o=arguments[2];this.elt[t].setLocation(n,o)}};et.prototype.isEqualOnSide=function(r,e){return this.elt[0].isEqualOnSide(r.elt[0],e)&&this.elt[1].isEqualOnSide(r.elt[1],e)};et.prototype.allPositionsEqual=function(r,e){return this.elt[r].allPositionsEqual(e)};et.prototype.toLine=function(r){this.elt[r].isArea()&&(this.elt[r]=new at(this.elt[r].location[0]))};et.prototype.interfaces_=function(){return[]};et.prototype.getClass=function(){return et};et.toLineLabel=function(r){for(var e=new et(E.NONE),t=0;t<2;t++)e.setLocation(t,r.getLocation(t));return e};var wt=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new O,this._pts=new O,this._label=new et(E.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new O,this._geometryFactory=null;var r=arguments[0],e=arguments[1];this._geometryFactory=e,this.computePoints(r),this.computeRing()};wt.prototype.computeRing=function(){var r=this;if(this._ring!==null)return null;for(var e=new Array(this._pts.size()).fill(null),t=0;t<this._pts.size();t++)e[t]=r._pts.get(t);this._ring=this._geometryFactory.createLinearRing(e),this._isHole=M.isCCW(this._ring.getCoordinates())};wt.prototype.isIsolated=function(){return this._label.getGeometryCount()===1};wt.prototype.computePoints=function(r){var e=this;this._startDe=r;var t=r,n=!0;do{if(t===null)throw new Jn("Found null DirectedEdge");if(t.getEdgeRing()===e)throw new Jn("Directed Edge visited twice during ring-building at "+t.getCoordinate());e._edges.add(t);var o=t.getLabel();q.isTrue(o.isArea()),e.mergeLabel(o),e.addPoints(t.getEdge(),t.isForward(),n),n=!1,e.setEdgeRing(t,e),t=e.getNext(t)}while(t!==this._startDe)};wt.prototype.getLinearRing=function(){return this._ring};wt.prototype.getCoordinate=function(r){return this._pts.get(r)};wt.prototype.computeMaxNodeDegree=function(){var r=this;this._maxNodeDegree=0;var e=this._startDe;do{var t=e.getNode(),n=t.getEdges().getOutgoingDegree(r);n>r._maxNodeDegree&&(r._maxNodeDegree=n),e=r.getNext(e)}while(e!==this._startDe);this._maxNodeDegree*=2};wt.prototype.addPoints=function(r,e,t){var n=this,o=r.getCoordinates();if(e){var a=1;t&&(a=0);for(var l=a;l<o.length;l++)n._pts.add(o[l])}else{var s=o.length-2;t&&(s=o.length-1);for(var m=s;m>=0;m--)n._pts.add(o[m])}};wt.prototype.isHole=function(){return this._isHole};wt.prototype.setInResult=function(){var r=this._startDe;do r.getEdge().setInResult(!0),r=r.getNext();while(r!==this._startDe)};wt.prototype.containsPoint=function(r){var e=this.getLinearRing(),t=e.getEnvelopeInternal();if(!t.contains(r)||!M.isPointInRing(r,e.getCoordinates()))return!1;for(var n=this._holes.iterator();n.hasNext();){var o=n.next();if(o.containsPoint(r))return!1}return!0};wt.prototype.addHole=function(r){this._holes.add(r)};wt.prototype.isShell=function(){return this._shell===null};wt.prototype.getLabel=function(){return this._label};wt.prototype.getEdges=function(){return this._edges};wt.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree};wt.prototype.getShell=function(){return this._shell};wt.prototype.mergeLabel=function(){if(arguments.length===1){var r=arguments[0];this.mergeLabel(r,0),this.mergeLabel(r,1)}else if(arguments.length===2){var e=arguments[0],t=arguments[1],n=e.getLocation(t,b.RIGHT);if(n===E.NONE)return null;if(this._label.getLocation(t)===E.NONE)return this._label.setLocation(t,n),null}};wt.prototype.setShell=function(r){this._shell=r,r!==null&&r.addHole(this)};wt.prototype.toPolygon=function(r){for(var e=this,t=new Array(this._holes.size()).fill(null),n=0;n<this._holes.size();n++)t[n]=e._holes.get(n).getLinearRing();var o=r.createPolygon(this.getLinearRing(),t);return o};wt.prototype.interfaces_=function(){return[]};wt.prototype.getClass=function(){return wt};var ef=function(r){function e(){var t=arguments[0],n=arguments[1];r.call(this,t,n)}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.setEdgeRing=function(t,n){t.setMinEdgeRing(n)},e.prototype.getNext=function(t){return t.getNextMin()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(wt),nf=function(r){function e(){var t=arguments[0],n=arguments[1];r.call(this,t,n)}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.buildMinimalRings=function(){var t=this,n=new O,o=this._startDe;do{if(o.getMinEdgeRing()===null){var a=new ef(o,t._geometryFactory);n.add(a)}o=o.getNext()}while(o!==this._startDe);return n},e.prototype.setEdgeRing=function(t,n){t.setEdgeRing(n)},e.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var t=this,n=this._startDe;do{var o=n.getNode();o.getEdges().linkMinimalDirectedEdges(t),n=n.getNext()}while(n!==this._startDe)},e.prototype.getNext=function(t){return t.getNext()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(wt),Le=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0&&arguments.length===1){var r=arguments[0];this._label=r}};Le.prototype.setVisited=function(r){this._isVisited=r};Le.prototype.setInResult=function(r){this._isInResult=r};Le.prototype.isCovered=function(){return this._isCovered};Le.prototype.isCoveredSet=function(){return this._isCoveredSet};Le.prototype.setLabel=function(r){this._label=r};Le.prototype.getLabel=function(){return this._label};Le.prototype.setCovered=function(r){this._isCovered=r,this._isCoveredSet=!0};Le.prototype.updateIM=function(r){q.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(r)};Le.prototype.isInResult=function(){return this._isInResult};Le.prototype.isVisited=function(){return this._isVisited};Le.prototype.interfaces_=function(){return[]};Le.prototype.getClass=function(){return Le};var ls=function(r){function e(){r.call(this),this._coord=null,this._edges=null;var t=arguments[0],n=arguments[1];this._coord=t,this._edges=n,this._label=new et(0,E.NONE)}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.isIncidentEdgeInResult=function(){for(var t=this.getEdges().getEdges().iterator();t.hasNext();){var n=t.next();if(n.getEdge().isInResult())return!0}return!1},e.prototype.isIsolated=function(){return this._label.getGeometryCount()===1},e.prototype.getCoordinate=function(){return this._coord},e.prototype.print=function(t){t.println("node "+this._coord+" lbl: "+this._label)},e.prototype.computeIM=function(t){},e.prototype.computeMergedLocation=function(t,n){var o=E.NONE;if(o=this._label.getLocation(n),!t.isNull(n)){var a=t.getLocation(n);o!==E.BOUNDARY&&(o=a)}return o},e.prototype.setLabel=function(){if(arguments.length===2){var t=arguments[0],n=arguments[1];this._label===null?this._label=new et(t,n):this._label.setLocation(t,n)}else return r.prototype.setLabel.apply(this,arguments)},e.prototype.getEdges=function(){return this._edges},e.prototype.mergeLabel=function(){var t=this;if(arguments[0]instanceof e){var n=arguments[0];this.mergeLabel(n._label)}else if(arguments[0]instanceof et)for(var o=arguments[0],a=0;a<2;a++){var l=t.computeMergedLocation(o,a),s=t._label.getLocation(a);s===E.NONE&&t._label.setLocation(a,l)}},e.prototype.add=function(t){this._edges.insert(t),t.setNode(this)},e.prototype.setLabelBoundary=function(t){if(this._label===null)return null;var n=E.NONE;this._label!==null&&(n=this._label.getLocation(t));var o=null;switch(n){case E.BOUNDARY:o=E.INTERIOR;break;case E.INTERIOR:o=E.BOUNDARY;break;default:o=E.BOUNDARY;break}this._label.setLocation(t,o)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Le),gn=function(){this.nodeMap=new Kt,this.nodeFact=null;var r=arguments[0];this.nodeFact=r};gn.prototype.find=function(r){return this.nodeMap.get(r)};gn.prototype.addNode=function(){if(arguments[0]instanceof d){var r=arguments[0],e=this.nodeMap.get(r);return e===null&&(e=this.nodeFact.createNode(r),this.nodeMap.put(r,e)),e}else if(arguments[0]instanceof ls){var t=arguments[0],n=this.nodeMap.get(t.getCoordinate());return n===null?(this.nodeMap.put(t.getCoordinate(),t),t):(n.mergeLabel(t),n)}};gn.prototype.print=function(r){for(var e=this.iterator();e.hasNext();){var t=e.next();t.print(r)}};gn.prototype.iterator=function(){return this.nodeMap.values().iterator()};gn.prototype.values=function(){return this.nodeMap.values()};gn.prototype.getBoundaryNodes=function(r){for(var e=new O,t=this.iterator();t.hasNext();){var n=t.next();n.getLabel().getLocation(r)===E.BOUNDARY&&e.add(n)}return e};gn.prototype.add=function(r){var e=r.getCoordinate(),t=this.addNode(e);t.add(r)};gn.prototype.interfaces_=function(){return[]};gn.prototype.getClass=function(){return gn};var rt=function(){},Co={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};rt.prototype.interfaces_=function(){return[]};rt.prototype.getClass=function(){return rt};rt.isNorthern=function(r){return r===rt.NE||r===rt.NW};rt.isOpposite=function(r,e){if(r===e)return!1;var t=(r-e+4)%4;return t===2};rt.commonHalfPlane=function(r,e){if(r===e)return r;var t=(r-e+4)%4;if(t===2)return-1;var n=r<e?r:e,o=r>e?r:e;return n===0&&o===3?3:n};rt.isInHalfPlane=function(r,e){return e===rt.SE?r===rt.SE||r===rt.SW:r===e||r===e+1};rt.quadrant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var r=arguments[0],e=arguments[1];if(r===0&&e===0)throw new ft("Cannot compute the quadrant for point ( "+r+", "+e+" )");return r>=0?e>=0?rt.NE:rt.SE:e>=0?rt.NW:rt.SW}else if(arguments[0]instanceof d&&arguments[1]instanceof d){var t=arguments[0],n=arguments[1];if(n.x===t.x&&n.y===t.y)throw new ft("Cannot compute the quadrant for two identical points "+t);return n.x>=t.x?n.y>=t.y?rt.NE:rt.SE:n.y>=t.y?rt.NW:rt.SW}};Co.NE.get=function(){return 0};Co.NW.get=function(){return 1};Co.SW.get=function(){return 2};Co.SE.get=function(){return 3};Object.defineProperties(rt,Co);var Qt=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var r=arguments[0];this._edge=r}else if(arguments.length===3){var e=arguments[0],t=arguments[1],n=arguments[2],o=null;this._edge=e,this.init(t,n),this._label=o}else if(arguments.length===4){var a=arguments[0],l=arguments[1],s=arguments[2],m=arguments[3];this._edge=a,this.init(l,s),this._label=m}};Qt.prototype.compareDirection=function(r){return this._dx===r._dx&&this._dy===r._dy?0:this._quadrant>r._quadrant?1:this._quadrant<r._quadrant?-1:M.computeOrientation(r._p0,r._p1,this._p1)};Qt.prototype.getDy=function(){return this._dy};Qt.prototype.getCoordinate=function(){return this._p0};Qt.prototype.setNode=function(r){this._node=r};Qt.prototype.print=function(r){var e=Math.atan2(this._dy,this._dx),t=this.getClass().getName(),n=t.lastIndexOf("."),o=t.substring(n+1);r.print("  "+o+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label)};Qt.prototype.compareTo=function(r){var e=r;return this.compareDirection(e)};Qt.prototype.getDirectedCoordinate=function(){return this._p1};Qt.prototype.getDx=function(){return this._dx};Qt.prototype.getLabel=function(){return this._label};Qt.prototype.getEdge=function(){return this._edge};Qt.prototype.getQuadrant=function(){return this._quadrant};Qt.prototype.getNode=function(){return this._node};Qt.prototype.toString=function(){var r=Math.atan2(this._dy,this._dx),e=this.getClass().getName(),t=e.lastIndexOf("."),n=e.substring(t+1);return"  "+n+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+r+"   "+this._label};Qt.prototype.computeLabel=function(r){};Qt.prototype.init=function(r,e){this._p0=r,this._p1=e,this._dx=e.x-r.x,this._dy=e.y-r.y,this._quadrant=rt.quadrant(this._dx,this._dy),q.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")};Qt.prototype.interfaces_=function(){return[ke]};Qt.prototype.getClass=function(){return Qt};var As=function(r){function e(){var t=arguments[0],n=arguments[1];if(r.call(this,t),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=n,n)this.init(t.getCoordinate(0),t.getCoordinate(1));else{var o=t.getNumPoints()-1;this.init(t.getCoordinate(o),t.getCoordinate(o-1))}this.computeDirectedLabel()}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.getNextMin=function(){return this._nextMin},e.prototype.getDepth=function(t){return this._depth[t]},e.prototype.setVisited=function(t){this._isVisited=t},e.prototype.computeDirectedLabel=function(){this._label=new et(this._edge.getLabel()),this._isForward||this._label.flip()},e.prototype.getNext=function(){return this._next},e.prototype.setDepth=function(t,n){if(this._depth[t]!==-999&&this._depth[t]!==n)throw new Jn("assigned depths do not match",this.getCoordinate());this._depth[t]=n},e.prototype.isInteriorAreaEdge=function(){for(var t=this,n=!0,o=0;o<2;o++)t._label.isArea(o)&&t._label.getLocation(o,b.LEFT)===E.INTERIOR&&t._label.getLocation(o,b.RIGHT)===E.INTERIOR||(n=!1);return n},e.prototype.setNextMin=function(t){this._nextMin=t},e.prototype.print=function(t){r.prototype.print.call(this,t),t.print(" "+this._depth[b.LEFT]+"/"+this._depth[b.RIGHT]),t.print(" ("+this.getDepthDelta()+")"),this._isInResult&&t.print(" inResult")},e.prototype.setMinEdgeRing=function(t){this._minEdgeRing=t},e.prototype.isLineEdge=function(){var t=this._label.isLine(0)||this._label.isLine(1),n=!this._label.isArea(0)||this._label.allPositionsEqual(0,E.EXTERIOR),o=!this._label.isArea(1)||this._label.allPositionsEqual(1,E.EXTERIOR);return t&&n&&o},e.prototype.setEdgeRing=function(t){this._edgeRing=t},e.prototype.getMinEdgeRing=function(){return this._minEdgeRing},e.prototype.getDepthDelta=function(){var t=this._edge.getDepthDelta();return this._isForward||(t=-t),t},e.prototype.setInResult=function(t){this._isInResult=t},e.prototype.getSym=function(){return this._sym},e.prototype.isForward=function(){return this._isForward},e.prototype.getEdge=function(){return this._edge},e.prototype.printEdge=function(t){this.print(t),t.print(" "),this._isForward?this._edge.print(t):this._edge.printReverse(t)},e.prototype.setSym=function(t){this._sym=t},e.prototype.setVisitedEdge=function(t){this.setVisited(t),this._sym.setVisited(t)},e.prototype.setEdgeDepths=function(t,n){var o=this.getEdge().getDepthDelta();this._isForward||(o=-o);var a=1;t===b.LEFT&&(a=-1);var l=b.opposite(t),s=o*a,m=n+s;this.setDepth(t,n),this.setDepth(l,m)},e.prototype.getEdgeRing=function(){return this._edgeRing},e.prototype.isInResult=function(){return this._isInResult},e.prototype.setNext=function(t){this._next=t},e.prototype.isVisited=function(){return this._isVisited},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.depthFactor=function(t,n){return t===E.EXTERIOR&&n===E.INTERIOR?1:t===E.INTERIOR&&n===E.EXTERIOR?-1:0},e}(Qt),Ri=function(){};Ri.prototype.createNode=function(r){return new ls(r,null)};Ri.prototype.interfaces_=function(){return[]};Ri.prototype.getClass=function(){return Ri};var pt=function(){if(this._edges=new O,this._nodes=null,this._edgeEndList=new O,arguments.length===0)this._nodes=new gn(new Ri);else if(arguments.length===1){var r=arguments[0];this._nodes=new gn(r)}};pt.prototype.printEdges=function(r){var e=this;r.println("Edges:");for(var t=0;t<this._edges.size();t++){r.println("edge "+t+":");var n=e._edges.get(t);n.print(r),n.eiList.print(r)}};pt.prototype.find=function(r){return this._nodes.find(r)};pt.prototype.addNode=function(){if(arguments[0]instanceof ls){var r=arguments[0];return this._nodes.addNode(r)}else if(arguments[0]instanceof d){var e=arguments[0];return this._nodes.addNode(e)}};pt.prototype.getNodeIterator=function(){return this._nodes.iterator()};pt.prototype.linkResultDirectedEdges=function(){for(var r=this._nodes.iterator();r.hasNext();){var e=r.next();e.getEdges().linkResultDirectedEdges()}};pt.prototype.debugPrintln=function(r){qt.out.println(r)};pt.prototype.isBoundaryNode=function(r,e){var t=this._nodes.find(e);if(t===null)return!1;var n=t.getLabel();return n!==null&&n.getLocation(r)===E.BOUNDARY};pt.prototype.linkAllDirectedEdges=function(){for(var r=this._nodes.iterator();r.hasNext();){var e=r.next();e.getEdges().linkAllDirectedEdges()}};pt.prototype.matchInSameDirection=function(r,e,t,n){return r.equals(t)?M.computeOrientation(r,e,n)===M.COLLINEAR&&rt.quadrant(r,e)===rt.quadrant(t,n):!1};pt.prototype.getEdgeEnds=function(){return this._edgeEndList};pt.prototype.debugPrint=function(r){qt.out.print(r)};pt.prototype.getEdgeIterator=function(){return this._edges.iterator()};pt.prototype.findEdgeInSameDirection=function(r,e){for(var t=this,n=0;n<this._edges.size();n++){var o=t._edges.get(n),a=o.getCoordinates();if(t.matchInSameDirection(r,e,a[0],a[1])||t.matchInSameDirection(r,e,a[a.length-1],a[a.length-2]))return o}return null};pt.prototype.insertEdge=function(r){this._edges.add(r)};pt.prototype.findEdgeEnd=function(r){for(var e=this.getEdgeEnds().iterator();e.hasNext();){var t=e.next();if(t.getEdge()===r)return t}return null};pt.prototype.addEdges=function(r){for(var e=this,t=r.iterator();t.hasNext();){var n=t.next();e._edges.add(n);var o=new As(n,!0),a=new As(n,!1);o.setSym(a),a.setSym(o),e.add(o),e.add(a)}};pt.prototype.add=function(r){this._nodes.add(r),this._edgeEndList.add(r)};pt.prototype.getNodes=function(){return this._nodes.values()};pt.prototype.findEdge=function(r,e){for(var t=this,n=0;n<this._edges.size();n++){var o=t._edges.get(n),a=o.getCoordinates();if(r.equals(a[0])&&e.equals(a[1]))return o}return null};pt.prototype.interfaces_=function(){return[]};pt.prototype.getClass=function(){return pt};pt.linkResultDirectedEdges=function(r){for(var e=r.iterator();e.hasNext();){var t=e.next();t.getEdges().linkResultDirectedEdges()}};var ve=function(){this._geometryFactory=null,this._shellList=new O;var r=arguments[0];this._geometryFactory=r};ve.prototype.sortShellsAndHoles=function(r,e,t){for(var n=r.iterator();n.hasNext();){var o=n.next();o.isHole()?t.add(o):e.add(o)}};ve.prototype.computePolygons=function(r){for(var e=this,t=new O,n=r.iterator();n.hasNext();){var o=n.next(),a=o.toPolygon(e._geometryFactory);t.add(a)}return t};ve.prototype.placeFreeHoles=function(r,e){for(var t=this,n=e.iterator();n.hasNext();){var o=n.next();if(o.getShell()===null){var a=t.findEdgeRingContaining(o,r);if(a===null)throw new Jn("unable to assign hole to a shell",o.getCoordinate(0));o.setShell(a)}}};ve.prototype.buildMinimalEdgeRings=function(r,e,t){for(var n=this,o=new O,a=r.iterator();a.hasNext();){var l=a.next();if(l.getMaxNodeDegree()>2){l.linkDirectedEdgesForMinimalEdgeRings();var s=l.buildMinimalRings(),m=n.findShell(s);m!==null?(n.placePolygonHoles(m,s),e.add(m)):t.addAll(s)}else o.add(l)}return o};ve.prototype.containsPoint=function(r){for(var e=this._shellList.iterator();e.hasNext();){var t=e.next();if(t.containsPoint(r))return!0}return!1};ve.prototype.buildMaximalEdgeRings=function(r){for(var e=this,t=new O,n=r.iterator();n.hasNext();){var o=n.next();if(o.isInResult()&&o.getLabel().isArea()&&o.getEdgeRing()===null){var a=new nf(o,e._geometryFactory);t.add(a),a.setInResult()}}return t};ve.prototype.placePolygonHoles=function(r,e){for(var t=e.iterator();t.hasNext();){var n=t.next();n.isHole()&&n.setShell(r)}};ve.prototype.getPolygons=function(){var r=this.computePolygons(this._shellList);return r};ve.prototype.findEdgeRingContaining=function(r,e){for(var t=r.getLinearRing(),n=t.getEnvelopeInternal(),o=t.getCoordinateN(0),a=null,l=null,s=e.iterator();s.hasNext();){var m=s.next(),y=m.getLinearRing(),D=y.getEnvelopeInternal();a!==null&&(l=a.getLinearRing().getEnvelopeInternal());var W=!1;D.contains(n)&&M.isPointInRing(o,y.getCoordinates())&&(W=!0),W&&(a===null||l.contains(D))&&(a=m)}return a};ve.prototype.findShell=function(r){for(var e=0,t=null,n=r.iterator();n.hasNext();){var o=n.next();o.isHole()||(t=o,e++)}return q.isTrue(e<=1,"found two shells in MinimalEdgeRing list"),t};ve.prototype.add=function(){if(arguments.length===1){var r=arguments[0];this.add(r.getEdgeEnds(),r.getNodes())}else if(arguments.length===2){var e=arguments[0],t=arguments[1];pt.linkResultDirectedEdges(t);var n=this.buildMaximalEdgeRings(e),o=new O,a=this.buildMinimalEdgeRings(n,this._shellList,o);this.sortShellsAndHoles(a,this._shellList,o),this.placeFreeHoles(this._shellList,o)}};ve.prototype.interfaces_=function(){return[]};ve.prototype.getClass=function(){return ve};var Oi=function(){};Oi.prototype.getBounds=function(){};Oi.prototype.interfaces_=function(){return[]};Oi.prototype.getClass=function(){return Oi};var We=function(){this._bounds=null,this._item=null;var r=arguments[0],e=arguments[1];this._bounds=r,this._item=e};We.prototype.getItem=function(){return this._item};We.prototype.getBounds=function(){return this._bounds};We.prototype.interfaces_=function(){return[Oi,Ge]};We.prototype.getClass=function(){return We};var $n=function(){this._size=null,this._items=null,this._size=0,this._items=new O,this._items.add(null)};$n.prototype.poll=function(){if(this.isEmpty())return null;var r=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),r};$n.prototype.size=function(){return this._size};$n.prototype.reorder=function(r){for(var e=this,t=null,n=this._items.get(r);r*2<=this._size&&(t=r*2,t!==e._size&&e._items.get(t+1).compareTo(e._items.get(t))<0&&t++,e._items.get(t).compareTo(n)<0);r=t)e._items.set(r,e._items.get(t));this._items.set(r,n)};$n.prototype.clear=function(){this._size=0,this._items.clear()};$n.prototype.isEmpty=function(){return this._size===0};$n.prototype.add=function(r){var e=this;this._items.add(null),this._size+=1;var t=this._size;for(this._items.set(0,r);r.compareTo(this._items.get(Math.trunc(t/2)))<0;t/=2)e._items.set(t,e._items.get(Math.trunc(t/2)));this._items.set(t,r)};$n.prototype.interfaces_=function(){return[]};$n.prototype.getClass=function(){return $n};var hr=function(){};hr.prototype.visitItem=function(r){};hr.prototype.interfaces_=function(){return[]};hr.prototype.getClass=function(){return hr};var Jr=function(){};Jr.prototype.insert=function(r,e){};Jr.prototype.remove=function(r,e){};Jr.prototype.query=function(){};Jr.prototype.interfaces_=function(){return[]};Jr.prototype.getClass=function(){return Jr};var Rt=function(){if(this._childBoundables=new O,this._bounds=null,this._level=null,arguments.length!==0&&arguments.length===1){var r=arguments[0];this._level=r}},Su={serialVersionUID:{configurable:!0}};Rt.prototype.getLevel=function(){return this._level};Rt.prototype.size=function(){return this._childBoundables.size()};Rt.prototype.getChildBoundables=function(){return this._childBoundables};Rt.prototype.addChildBoundable=function(r){q.isTrue(this._bounds===null),this._childBoundables.add(r)};Rt.prototype.isEmpty=function(){return this._childBoundables.isEmpty()};Rt.prototype.getBounds=function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds};Rt.prototype.interfaces_=function(){return[Oi,Ge]};Rt.prototype.getClass=function(){return Rt};Su.serialVersionUID.get=function(){return 6493722185909574e3};Object.defineProperties(Rt,Su);var He=function(){};He.reverseOrder=function(){return{compare:function(r,e){return e.compareTo(r)}}};He.min=function(r){return He.sort(r),r.get(0)};He.sort=function(r,e){var t=r.toArray();e?Lr.sort(t,e):Lr.sort(t);for(var n=r.iterator(),o=0,a=t.length;o<a;o++)n.next(),n.set(t[o])};He.singletonList=function(r){var e=new O;return e.add(r),e};var xt=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var r=arguments[0],e=arguments[1],t=arguments[2];this._boundable1=r,this._boundable2=e,this._itemDistance=t,this._distance=this.distance()};xt.prototype.expandToQueue=function(r,e){var t=xt.isComposite(this._boundable1),n=xt.isComposite(this._boundable2);if(t&&n)return xt.area(this._boundable1)>xt.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,r,e),null):(this.expand(this._boundable2,this._boundable1,r,e),null);if(t)return this.expand(this._boundable1,this._boundable2,r,e),null;if(n)return this.expand(this._boundable2,this._boundable1,r,e),null;throw new ft("neither boundable is composite")};xt.prototype.isLeaves=function(){return!(xt.isComposite(this._boundable1)||xt.isComposite(this._boundable2))};xt.prototype.compareTo=function(r){var e=r;return this._distance<e._distance?-1:this._distance>e._distance?1:0};xt.prototype.expand=function(r,e,t,n){for(var o=this,a=r.getChildBoundables(),l=a.iterator();l.hasNext();){var s=l.next(),m=new xt(s,e,o._itemDistance);m.getDistance()<n&&t.add(m)}};xt.prototype.getBoundable=function(r){return r===0?this._boundable1:this._boundable2};xt.prototype.getDistance=function(){return this._distance};xt.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())};xt.prototype.interfaces_=function(){return[ke]};xt.prototype.getClass=function(){return xt};xt.area=function(r){return r.getBounds().getArea()};xt.isComposite=function(r){return r instanceof Rt};var Mt=function r(){if(this._root=null,this._built=!1,this._itemBoundables=new O,this._nodeCapacity=null,arguments.length===0){var e=r.DEFAULT_NODE_CAPACITY;this._nodeCapacity=e}else if(arguments.length===1){var t=arguments[0];q.isTrue(t>1,"Node capacity must be greater than 1"),this._nodeCapacity=t}},cs={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};Mt.prototype.getNodeCapacity=function(){return this._nodeCapacity};Mt.prototype.lastNode=function(r){return r.get(r.size()-1)};Mt.prototype.size=function(){var r=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var e=arguments[0],t=0,n=e.getChildBoundables().iterator();n.hasNext();){var o=n.next();o instanceof Rt?t+=r.size(o):o instanceof We&&(t+=1)}return t}};Mt.prototype.removeItem=function(r,e){for(var t=null,n=r.getChildBoundables().iterator();n.hasNext();){var o=n.next();o instanceof We&&o.getItem()===e&&(t=o)}return t!==null?(r.getChildBoundables().remove(t),!0):!1};Mt.prototype.itemsTree=function(){var r=this;if(arguments.length===0){this.build();var e=this.itemsTree(this._root);return e===null?new O:e}else if(arguments.length===1){for(var t=arguments[0],n=new O,o=t.getChildBoundables().iterator();o.hasNext();){var a=o.next();if(a instanceof Rt){var l=r.itemsTree(a);l!==null&&n.add(l)}else a instanceof We?n.add(a.getItem()):q.shouldNeverReachHere()}return n.size()<=0?null:n}};Mt.prototype.insert=function(r,e){q.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new We(r,e))};Mt.prototype.boundablesAtLevel=function(){var r=this;if(arguments.length===1){var e=arguments[0],t=new O;return this.boundablesAtLevel(e,this._root,t),t}else if(arguments.length===3){var n=arguments[0],o=arguments[1],a=arguments[2];if(q.isTrue(n>-2),o.getLevel()===n)return a.add(o),null;for(var l=o.getChildBoundables().iterator();l.hasNext();){var s=l.next();s instanceof Rt?r.boundablesAtLevel(n,s,a):(q.isTrue(s instanceof We),n===-1&&a.add(s))}return null}};Mt.prototype.query=function(){var r=this;if(arguments.length===1){var e=arguments[0];this.build();var t=new O;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.query(e,this._root,t),t}else if(arguments.length===2){var n=arguments[0],o=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),n)&&this.query(n,this._root,o)}else if(arguments.length===3){if(V(arguments[2],hr)&&arguments[0]instanceof Object&&arguments[1]instanceof Rt)for(var a=arguments[0],l=arguments[1],s=arguments[2],m=l.getChildBoundables(),y=0;y<m.size();y++){var D=m.get(y);r.getIntersectsOp().intersects(D.getBounds(),a)&&(D instanceof Rt?r.query(a,D,s):D instanceof We?s.visitItem(D.getItem()):q.shouldNeverReachHere())}else if(V(arguments[2],qe)&&arguments[0]instanceof Object&&arguments[1]instanceof Rt)for(var W=arguments[0],Ee=arguments[1],dt=arguments[2],Ht=Ee.getChildBoundables(),ir=0;ir<Ht.size();ir++){var Hr=Ht.get(ir);r.getIntersectsOp().intersects(Hr.getBounds(),W)&&(Hr instanceof Rt?r.query(W,Hr,dt):Hr instanceof We?dt.add(Hr.getItem()):q.shouldNeverReachHere())}}};Mt.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0};Mt.prototype.getRoot=function(){return this.build(),this._root};Mt.prototype.remove=function(){var r=this;if(arguments.length===2){var e=arguments[0],t=arguments[1];return this.build(),this.getIntersectsOp().intersects(this._root.getBounds(),e)?this.remove(e,this._root,t):!1}else if(arguments.length===3){var n=arguments[0],o=arguments[1],a=arguments[2],l=this.removeItem(o,a);if(l)return!0;for(var s=null,m=o.getChildBoundables().iterator();m.hasNext();){var y=m.next();if(r.getIntersectsOp().intersects(y.getBounds(),n)&&y instanceof Rt&&(l=r.remove(n,y,a),l)){s=y;break}}return s!==null&&s.getChildBoundables().isEmpty()&&o.getChildBoundables().remove(s),l}};Mt.prototype.createHigherLevels=function(r,e){q.isTrue(!r.isEmpty());var t=this.createParentBoundables(r,e+1);return t.size()===1?t.get(0):this.createHigherLevels(t,e+1)};Mt.prototype.depth=function(){var r=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var e=arguments[0],t=0,n=e.getChildBoundables().iterator();n.hasNext();){var o=n.next();if(o instanceof Rt){var a=r.depth(o);a>t&&(t=a)}}return t+1}};Mt.prototype.createParentBoundables=function(r,e){var t=this;q.isTrue(!r.isEmpty());var n=new O;n.add(this.createNode(e));var o=new O(r);He.sort(o,this.getComparator());for(var a=o.iterator();a.hasNext();){var l=a.next();t.lastNode(n).getChildBoundables().size()===t.getNodeCapacity()&&n.add(t.createNode(e)),t.lastNode(n).addChildBoundable(l)}return n};Mt.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()};Mt.prototype.interfaces_=function(){return[Ge]};Mt.prototype.getClass=function(){return Mt};Mt.compareDoubles=function(r,e){return r>e?1:r<e?-1:0};cs.IntersectsOp.get=function(){return rf};cs.serialVersionUID.get=function(){return-3886435814360241e3};cs.DEFAULT_NODE_CAPACITY.get=function(){return 10};Object.defineProperties(Mt,cs);var rf=function(){},Ti=function(){};Ti.prototype.distance=function(r,e){};Ti.prototype.interfaces_=function(){return[]};Ti.prototype.getClass=function(){return Ti};var wu=function(r){function e(n){n=n||e.DEFAULT_NODE_CAPACITY,r.call(this,n)}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return e.prototype.createParentBoundablesFromVerticalSlices=function(n,o){var a=this;q.isTrue(n.length>0);for(var l=new O,s=0;s<n.length;s++)l.addAll(a.createParentBoundablesFromVerticalSlice(n[s],o));return l},e.prototype.createNode=function(n){return new Ma(n)},e.prototype.size=function(){return arguments.length===0?r.prototype.size.call(this):r.prototype.size.apply(this,arguments)},e.prototype.insert=function(){if(arguments.length===2){var n=arguments[0],o=arguments[1];if(n.isNull())return null;r.prototype.insert.call(this,n,o)}else return r.prototype.insert.apply(this,arguments)},e.prototype.getIntersectsOp=function(){return e.intersectsOp},e.prototype.verticalSlices=function(n,o){for(var a=Math.trunc(Math.ceil(n.size()/o)),l=new Array(o).fill(null),s=n.iterator(),m=0;m<o;m++){l[m]=new O;for(var y=0;s.hasNext()&&y<a;){var D=s.next();l[m].add(D),y++}}return l},e.prototype.query=function(){if(arguments.length===1){var n=arguments[0];return r.prototype.query.call(this,n)}else if(arguments.length===2){var o=arguments[0],a=arguments[1];r.prototype.query.call(this,o,a)}else if(arguments.length===3){if(V(arguments[2],hr)&&arguments[0]instanceof Object&&arguments[1]instanceof Rt){var l=arguments[0],s=arguments[1],m=arguments[2];r.prototype.query.call(this,l,s,m)}else if(V(arguments[2],qe)&&arguments[0]instanceof Object&&arguments[1]instanceof Rt){var y=arguments[0],D=arguments[1],W=arguments[2];r.prototype.query.call(this,y,D,W)}}},e.prototype.getComparator=function(){return e.yComparator},e.prototype.createParentBoundablesFromVerticalSlice=function(n,o){return r.prototype.createParentBoundables.call(this,n,o)},e.prototype.remove=function(){if(arguments.length===2){var n=arguments[0],o=arguments[1];return r.prototype.remove.call(this,n,o)}else return r.prototype.remove.apply(this,arguments)},e.prototype.depth=function(){return arguments.length===0?r.prototype.depth.call(this):r.prototype.depth.apply(this,arguments)},e.prototype.createParentBoundables=function(n,o){q.isTrue(!n.isEmpty());var a=Math.trunc(Math.ceil(n.size()/this.getNodeCapacity())),l=new O(n);He.sort(l,e.xComparator);var s=this.verticalSlices(l,Math.trunc(Math.ceil(Math.sqrt(a))));return this.createParentBoundablesFromVerticalSlices(s,o)},e.prototype.nearestNeighbour=function(){if(arguments.length===1){if(V(arguments[0],Ti)){var n=arguments[0],o=new xt(this.getRoot(),this.getRoot(),n);return this.nearestNeighbour(o)}else if(arguments[0]instanceof xt){var a=arguments[0];return this.nearestNeighbour(a,z.POSITIVE_INFINITY)}}else if(arguments.length===2){if(arguments[0]instanceof e&&V(arguments[1],Ti)){var l=arguments[0],s=arguments[1],m=new xt(this.getRoot(),l.getRoot(),s);return this.nearestNeighbour(m)}else if(arguments[0]instanceof xt&&typeof arguments[1]=="number"){var y=arguments[0],D=arguments[1],W=D,Ee=null,dt=new $n;for(dt.add(y);!dt.isEmpty()&&W>0;){var Ht=dt.poll(),ir=Ht.getDistance();if(ir>=W)break;Ht.isLeaves()?(W=ir,Ee=Ht):Ht.expandToQueue(dt,W)}return[Ee.getBoundable(0).getItem(),Ee.getBoundable(1).getItem()]}}else if(arguments.length===3){var Hr=arguments[0],Bn=arguments[1],Vn=arguments[2],Wr=new We(Hr,Bn),ps=new xt(this.getRoot(),Wr,Vn);return this.nearestNeighbour(ps)[0]}},e.prototype.interfaces_=function(){return[Jr,Ge]},e.prototype.getClass=function(){return e},e.centreX=function(n){return e.avg(n.getMinX(),n.getMaxX())},e.avg=function(n,o){return(n+o)/2},e.centreY=function(n){return e.avg(n.getMinY(),n.getMaxY())},t.STRtreeNode.get=function(){return Ma},t.serialVersionUID.get=function(){return 0x39920f7d5f261e0},t.xComparator.get=function(){return{interfaces_:function(){return[Ci]},compare:function(n,o){return r.compareDoubles(e.centreX(n.getBounds()),e.centreX(o.getBounds()))}}},t.yComparator.get=function(){return{interfaces_:function(){return[Ci]},compare:function(n,o){return r.compareDoubles(e.centreY(n.getBounds()),e.centreY(o.getBounds()))}}},t.intersectsOp.get=function(){return{interfaces_:function(){return[r.IntersectsOp]},intersects:function(n,o){return n.intersects(o)}}},t.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(e,t),e}(Mt),Ma=function(r){function e(){var t=arguments[0];r.call(this,t)}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.computeBounds=function(){for(var t=null,n=this.getChildBoundables().iterator();n.hasNext();){var o=n.next();t===null?t=new B(o.getBounds()):t.expandToInclude(o.getBounds())}return t},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Rt),ue=function(){};ue.prototype.interfaces_=function(){return[]};ue.prototype.getClass=function(){return ue};ue.relativeSign=function(r,e){return r<e?-1:r>e?1:0};ue.compare=function(r,e,t){if(e.equals2D(t))return 0;var n=ue.relativeSign(e.x,t.x),o=ue.relativeSign(e.y,t.y);switch(r){case 0:return ue.compareValue(n,o);case 1:return ue.compareValue(o,n);case 2:return ue.compareValue(o,-n);case 3:return ue.compareValue(-n,o);case 4:return ue.compareValue(-n,-o);case 5:return ue.compareValue(-o,-n);case 6:return ue.compareValue(-o,n);case 7:return ue.compareValue(n,-o)}return q.shouldNeverReachHere("invalid octant value"),0};ue.compareValue=function(r,e){return r<0?-1:r>0?1:e<0?-1:e>0?1:0};var gr=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var r=arguments[0],e=arguments[1],t=arguments[2],n=arguments[3];this._segString=r,this.coord=new d(e),this.segmentIndex=t,this._segmentOctant=n,this._isInterior=!e.equals2D(r.getCoordinate(t))};gr.prototype.getCoordinate=function(){return this.coord};gr.prototype.print=function(r){r.print(this.coord),r.print(" seg # = "+this.segmentIndex)};gr.prototype.compareTo=function(r){var e=r;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:ue.compare(this._segmentOctant,this.coord,e.coord)};gr.prototype.isEndPoint=function(r){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===r};gr.prototype.isInterior=function(){return this._isInterior};gr.prototype.interfaces_=function(){return[ke]};gr.prototype.getClass=function(){return gr};var se=function(){this._nodeMap=new Kt,this._edge=null;var r=arguments[0];this._edge=r};se.prototype.getSplitCoordinates=function(){var r=this,e=new Eo;this.addEndpoints();for(var t=this.iterator(),n=t.next();t.hasNext();){var o=t.next();r.addEdgeCoordinates(n,o,e),n=o}return e.toCoordinateArray()};se.prototype.addCollapsedNodes=function(){var r=this,e=new O;this.findCollapsesFromInsertedNodes(e),this.findCollapsesFromExistingVertices(e);for(var t=e.iterator();t.hasNext();){var n=t.next().intValue();r.add(r._edge.getCoordinate(n),n)}};se.prototype.print=function(r){r.println("Intersections:");for(var e=this.iterator();e.hasNext();){var t=e.next();t.print(r)}};se.prototype.findCollapsesFromExistingVertices=function(r){for(var e=this,t=0;t<this._edge.size()-2;t++){var n=e._edge.getCoordinate(t),o=e._edge.getCoordinate(t+2);n.equals2D(o)&&r.add(new un(t+1))}};se.prototype.addEdgeCoordinates=function(r,e,t){var n=this,o=this._edge.getCoordinate(e.segmentIndex),a=e.isInterior()||!e.coord.equals2D(o);t.add(new d(r.coord),!1);for(var l=r.segmentIndex+1;l<=e.segmentIndex;l++)t.add(n._edge.getCoordinate(l));a&&t.add(new d(e.coord))};se.prototype.iterator=function(){return this._nodeMap.values().iterator()};se.prototype.addSplitEdges=function(r){var e=this;this.addEndpoints(),this.addCollapsedNodes();for(var t=this.iterator(),n=t.next();t.hasNext();){var o=t.next(),a=e.createSplitEdge(n,o);r.add(a),n=o}};se.prototype.findCollapseIndex=function(r,e,t){if(!r.coord.equals2D(e.coord))return!1;var n=e.segmentIndex-r.segmentIndex;return e.isInterior()||n--,n===1?(t[0]=r.segmentIndex+1,!0):!1};se.prototype.findCollapsesFromInsertedNodes=function(r){for(var e=this,t=new Array(1).fill(null),n=this.iterator(),o=n.next();n.hasNext();){var a=n.next(),l=e.findCollapseIndex(o,a,t);l&&r.add(new un(t[0])),o=a}};se.prototype.getEdge=function(){return this._edge};se.prototype.addEndpoints=function(){var r=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(r),r)};se.prototype.createSplitEdge=function(r,e){var t=this,n=e.segmentIndex-r.segmentIndex+2,o=this._edge.getCoordinate(e.segmentIndex),a=e.isInterior()||!e.coord.equals2D(o);a||n--;var l=new Array(n).fill(null),s=0;l[s++]=new d(r.coord);for(var m=r.segmentIndex+1;m<=e.segmentIndex;m++)l[s++]=t._edge.getCoordinate(m);return a&&(l[s]=new d(e.coord)),new Nt(l,this._edge.getData())};se.prototype.add=function(r,e){var t=new gr(this._edge,r,e,this._edge.getSegmentOctant(e)),n=this._nodeMap.get(t);return n!==null?(q.isTrue(n.coord.equals2D(r),"Found equal nodes with different coordinates"),n):(this._nodeMap.put(t,t),t)};se.prototype.checkSplitEdgesCorrectness=function(r){var e=this._edge.getCoordinates(),t=r.get(0),n=t.getCoordinate(0);if(!n.equals2D(e[0]))throw new Qn("bad split edge start point at "+n);var o=r.get(r.size()-1),a=o.getCoordinates(),l=a[a.length-1];if(!l.equals2D(e[e.length-1]))throw new Qn("bad split edge end point at "+l)};se.prototype.interfaces_=function(){return[]};se.prototype.getClass=function(){return se};var $r=function(){};$r.prototype.interfaces_=function(){return[]};$r.prototype.getClass=function(){return $r};$r.octant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var r=arguments[0],e=arguments[1];if(r===0&&e===0)throw new ft("Cannot compute the octant for point ( "+r+", "+e+" )");var t=Math.abs(r),n=Math.abs(e);return r>=0?e>=0?t>=n?0:1:t>=n?7:6:e>=0?t>=n?3:2:t>=n?4:5}else if(arguments[0]instanceof d&&arguments[1]instanceof d){var o=arguments[0],a=arguments[1],l=a.x-o.x,s=a.y-o.y;if(l===0&&s===0)throw new ft("Cannot compute the octant for two identical points "+o);return $r.octant(l,s)}};var Rn=function(){};Rn.prototype.getCoordinates=function(){};Rn.prototype.size=function(){};Rn.prototype.getCoordinate=function(r){};Rn.prototype.isClosed=function(){};Rn.prototype.setData=function(r){};Rn.prototype.getData=function(){};Rn.prototype.interfaces_=function(){return[]};Rn.prototype.getClass=function(){return Rn};var co=function(){};co.prototype.addIntersection=function(r,e){};co.prototype.interfaces_=function(){return[Rn]};co.prototype.getClass=function(){return co};var Nt=function(){this._nodeList=new se(this),this._pts=null,this._data=null;var r=arguments[0],e=arguments[1];this._pts=r,this._data=e};Nt.prototype.getCoordinates=function(){return this._pts};Nt.prototype.size=function(){return this._pts.length};Nt.prototype.getCoordinate=function(r){return this._pts[r]};Nt.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};Nt.prototype.getSegmentOctant=function(r){return r===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(r),this.getCoordinate(r+1))};Nt.prototype.setData=function(r){this._data=r};Nt.prototype.safeOctant=function(r,e){return r.equals2D(e)?0:$r.octant(r,e)};Nt.prototype.getData=function(){return this._data};Nt.prototype.addIntersection=function(){if(arguments.length===2){var r=arguments[0],e=arguments[1];this.addIntersectionNode(r,e)}else if(arguments.length===4){var t=arguments[0],n=arguments[1],o=arguments[3],a=new d(t.getIntersection(o));this.addIntersection(a,n)}};Nt.prototype.toString=function(){return Xe.toLineString(new _t(this._pts))};Nt.prototype.getNodeList=function(){return this._nodeList};Nt.prototype.addIntersectionNode=function(r,e){var t=e,n=t+1;if(n<this._pts.length){var o=this._pts[n];r.equals2D(o)&&(t=n)}var a=this._nodeList.add(r,t);return a};Nt.prototype.addIntersections=function(r,e,t){for(var n=this,o=0;o<r.getIntersectionNum();o++)n.addIntersection(r,e,t,o)};Nt.prototype.interfaces_=function(){return[co]};Nt.prototype.getClass=function(){return Nt};Nt.getNodedSubstrings=function(){if(arguments.length===1){var r=arguments[0],e=new O;return Nt.getNodedSubstrings(r,e),e}else if(arguments.length===2)for(var t=arguments[0],n=arguments[1],o=t.iterator();o.hasNext();){var a=o.next();a.getNodeList().addSplitEdges(n)}};var k=function(){if(this.p0=null,this.p1=null,arguments.length===0)this.p0=new d,this.p1=new d;else if(arguments.length===1){var r=arguments[0];this.p0=new d(r.p0),this.p1=new d(r.p1)}else if(arguments.length===2)this.p0=arguments[0],this.p1=arguments[1];else if(arguments.length===4){var e=arguments[0],t=arguments[1],n=arguments[2],o=arguments[3];this.p0=new d(e,t),this.p1=new d(n,o)}},Lu={serialVersionUID:{configurable:!0}};k.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)};k.prototype.orientationIndex=function(){if(arguments[0]instanceof k){var r=arguments[0],e=M.orientationIndex(this.p0,this.p1,r.p0),t=M.orientationIndex(this.p0,this.p1,r.p1);return e>=0&&t>=0||e<=0&&t<=0?Math.max(e,t):0}else if(arguments[0]instanceof d){var n=arguments[0];return M.orientationIndex(this.p0,this.p1,n)}};k.prototype.toGeometry=function(r){return r.createLineString([this.p0,this.p1])};k.prototype.isVertical=function(){return this.p0.x===this.p1.x};k.prototype.equals=function(r){if(!(r instanceof k))return!1;var e=r;return this.p0.equals(e.p0)&&this.p1.equals(e.p1)};k.prototype.intersection=function(r){var e=new Xr;return e.computeIntersection(this.p0,this.p1,r.p0,r.p1),e.hasIntersection()?e.getIntersection(0):null};k.prototype.project=function(){if(arguments[0]instanceof d){var r=arguments[0];if(r.equals(this.p0)||r.equals(this.p1))return new d(r);var e=this.projectionFactor(r),t=new d;return t.x=this.p0.x+e*(this.p1.x-this.p0.x),t.y=this.p0.y+e*(this.p1.y-this.p0.y),t}else if(arguments[0]instanceof k){var n=arguments[0],o=this.projectionFactor(n.p0),a=this.projectionFactor(n.p1);if(o>=1&&a>=1||o<=0&&a<=0)return null;var l=this.project(n.p0);o<0&&(l=this.p0),o>1&&(l=this.p1);var s=this.project(n.p1);return a<0&&(s=this.p0),a>1&&(s=this.p1),new k(l,s)}};k.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()};k.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)};k.prototype.getCoordinate=function(r){return r===0?this.p0:this.p1};k.prototype.distancePerpendicular=function(r){return M.distancePointLinePerpendicular(r,this.p0,this.p1)};k.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)};k.prototype.midPoint=function(){return k.midPoint(this.p0,this.p1)};k.prototype.projectionFactor=function(r){if(r.equals(this.p0))return 0;if(r.equals(this.p1))return 1;var e=this.p1.x-this.p0.x,t=this.p1.y-this.p0.y,n=e*e+t*t;if(n<=0)return z.NaN;var o=((r.x-this.p0.x)*e+(r.y-this.p0.y)*t)/n;return o};k.prototype.closestPoints=function(r){var e=this.intersection(r);if(e!==null)return[e,e];var t=new Array(2).fill(null),n=z.MAX_VALUE,o=null,a=this.closestPoint(r.p0);n=a.distance(r.p0),t[0]=a,t[1]=r.p0;var l=this.closestPoint(r.p1);o=l.distance(r.p1),o<n&&(n=o,t[0]=l,t[1]=r.p1);var s=r.closestPoint(this.p0);o=s.distance(this.p0),o<n&&(n=o,t[0]=this.p0,t[1]=s);var m=r.closestPoint(this.p1);return o=m.distance(this.p1),o<n&&(n=o,t[0]=this.p1,t[1]=m),t};k.prototype.closestPoint=function(r){var e=this.projectionFactor(r);if(e>0&&e<1)return this.project(r);var t=this.p0.distance(r),n=this.p1.distance(r);return t<n?this.p0:this.p1};k.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)};k.prototype.getLength=function(){return this.p0.distance(this.p1)};k.prototype.compareTo=function(r){var e=r,t=this.p0.compareTo(e.p0);return t!==0?t:this.p1.compareTo(e.p1)};k.prototype.reverse=function(){var r=this.p0;this.p0=this.p1,this.p1=r};k.prototype.equalsTopo=function(r){return this.p0.equals(r.p0)&&(this.p1.equals(r.p1)||this.p0.equals(r.p1))&&this.p1.equals(r.p0)};k.prototype.lineIntersection=function(r){try{var e=Ue.intersection(this.p0,this.p1,r.p0,r.p1);return e}catch(t){if(!(t instanceof qi))throw t}finally{}return null};k.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)};k.prototype.pointAlongOffset=function(r,e){var t=this.p0.x+r*(this.p1.x-this.p0.x),n=this.p0.y+r*(this.p1.y-this.p0.y),o=this.p1.x-this.p0.x,a=this.p1.y-this.p0.y,l=Math.sqrt(o*o+a*a),s=0,m=0;if(e!==0){if(l<=0)throw new Error("Cannot compute offset from zero-length line segment");s=e*o/l,m=e*a/l}var y=t-m,D=n+s,W=new d(y,D);return W};k.prototype.setCoordinates=function(){if(arguments.length===1){var r=arguments[0];this.setCoordinates(r.p0,r.p1)}else if(arguments.length===2){var e=arguments[0],t=arguments[1];this.p0.x=e.x,this.p0.y=e.y,this.p1.x=t.x,this.p1.y=t.y}};k.prototype.segmentFraction=function(r){var e=this.projectionFactor(r);return e<0?e=0:(e>1||z.isNaN(e))&&(e=1),e};k.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"};k.prototype.isHorizontal=function(){return this.p0.y===this.p1.y};k.prototype.distance=function(){if(arguments[0]instanceof k){var r=arguments[0];return M.distanceLineLine(this.p0,this.p1,r.p0,r.p1)}else if(arguments[0]instanceof d){var e=arguments[0];return M.distancePointLine(e,this.p0,this.p1)}};k.prototype.pointAlong=function(r){var e=new d;return e.x=this.p0.x+r*(this.p1.x-this.p0.x),e.y=this.p0.y+r*(this.p1.y-this.p0.y),e};k.prototype.hashCode=function(){var r=z.doubleToLongBits(this.p0.x);r^=z.doubleToLongBits(this.p0.y)*31;var e=Math.trunc(r)^Math.trunc(r>>32),t=z.doubleToLongBits(this.p1.x);t^=z.doubleToLongBits(this.p1.y)*31;var n=Math.trunc(t)^Math.trunc(t>>32);return e^n};k.prototype.interfaces_=function(){return[ke,Ge]};k.prototype.getClass=function(){return k};k.midPoint=function(r,e){return new d((r.x+e.x)/2,(r.y+e.y)/2)};Lu.serialVersionUID.get=function(){return 0x2d2172135f411c00};Object.defineProperties(k,Lu);var fo=function(){this.tempEnv1=new B,this.tempEnv2=new B,this._overlapSeg1=new k,this._overlapSeg2=new k};fo.prototype.overlap=function(){if(arguments.length!==2&&arguments.length===4){var r=arguments[0],e=arguments[1],t=arguments[2],n=arguments[3];r.getLineSegment(e,this._overlapSeg1),t.getLineSegment(n,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}};fo.prototype.interfaces_=function(){return[]};fo.prototype.getClass=function(){return fo};var ye=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var r=arguments[0],e=arguments[1],t=arguments[2],n=arguments[3];this._pts=r,this._start=e,this._end=t,this._context=n};ye.prototype.getLineSegment=function(r,e){e.p0=this._pts[r],e.p1=this._pts[r+1]};ye.prototype.computeSelect=function(r,e,t,n){var o=this._pts[e],a=this._pts[t];if(n.tempEnv1.init(o,a),t-e===1)return n.select(this,e),null;if(!r.intersects(n.tempEnv1))return null;var l=Math.trunc((e+t)/2);e<l&&this.computeSelect(r,e,l,n),l<t&&this.computeSelect(r,l,t,n)};ye.prototype.getCoordinates=function(){for(var r=this,e=new Array(this._end-this._start+1).fill(null),t=0,n=this._start;n<=this._end;n++)e[t++]=r._pts[n];return e};ye.prototype.computeOverlaps=function(r,e){this.computeOverlapsInternal(this._start,this._end,r,r._start,r._end,e)};ye.prototype.setId=function(r){this._id=r};ye.prototype.select=function(r,e){this.computeSelect(r,this._start,this._end,e)};ye.prototype.getEnvelope=function(){if(this._env===null){var r=this._pts[this._start],e=this._pts[this._end];this._env=new B(r,e)}return this._env};ye.prototype.getEndIndex=function(){return this._end};ye.prototype.getStartIndex=function(){return this._start};ye.prototype.getContext=function(){return this._context};ye.prototype.getId=function(){return this._id};ye.prototype.computeOverlapsInternal=function(r,e,t,n,o,a){var l=this._pts[r],s=this._pts[e],m=t._pts[n],y=t._pts[o];if(e-r===1&&o-n===1)return a.overlap(this,r,t,n),null;if(a.tempEnv1.init(l,s),a.tempEnv2.init(m,y),!a.tempEnv1.intersects(a.tempEnv2))return null;var D=Math.trunc((r+e)/2),W=Math.trunc((n+o)/2);r<D&&(n<W&&this.computeOverlapsInternal(r,D,t,n,W,a),W<o&&this.computeOverlapsInternal(r,D,t,W,o,a)),D<e&&(n<W&&this.computeOverlapsInternal(D,e,t,n,W,a),W<o&&this.computeOverlapsInternal(D,e,t,W,o,a))};ye.prototype.interfaces_=function(){return[]};ye.prototype.getClass=function(){return ye};var an=function(){};an.prototype.interfaces_=function(){return[]};an.prototype.getClass=function(){return an};an.getChainStartIndices=function(r){var e=0,t=new O;t.add(new un(e));do{var n=an.findChainEnd(r,e);t.add(new un(n)),e=n}while(e<r.length-1);var o=an.toIntArray(t);return o};an.findChainEnd=function(r,e){for(var t=e;t<r.length-1&&r[t].equals2D(r[t+1]);)t++;if(t>=r.length-1)return r.length-1;for(var n=rt.quadrant(r[t],r[t+1]),o=e+1;o<r.length;){if(!r[o-1].equals2D(r[o])){var a=rt.quadrant(r[o-1],r[o]);if(a!==n)break}o++}return o-1};an.getChains=function(){if(arguments.length===1){var r=arguments[0];return an.getChains(r,null)}else if(arguments.length===2){for(var e=arguments[0],t=arguments[1],n=new O,o=an.getChainStartIndices(e),a=0;a<o.length-1;a++){var l=new ye(e,o[a],o[a+1],t);n.add(l)}return n}};an.toIntArray=function(r){for(var e=new Array(r.size()).fill(null),t=0;t<e.length;t++)e[t]=r.get(t).intValue();return e};var Dr=function(){};Dr.prototype.computeNodes=function(r){};Dr.prototype.getNodedSubstrings=function(){};Dr.prototype.interfaces_=function(){return[]};Dr.prototype.getClass=function(){return Dr};var ho=function(){if(this._segInt=null,arguments.length!==0&&arguments.length===1){var r=arguments[0];this.setSegmentIntersector(r)}};ho.prototype.setSegmentIntersector=function(r){this._segInt=r};ho.prototype.interfaces_=function(){return[Dr]};ho.prototype.getClass=function(){return ho};var Qs=function(r){function e(n){n?r.call(this,n):r.call(this),this._monoChains=new O,this._index=new wu,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={SegmentOverlapAction:{configurable:!0}};return e.prototype.getMonotoneChains=function(){return this._monoChains},e.prototype.getNodedSubstrings=function(){return Nt.getNodedSubstrings(this._nodedSegStrings)},e.prototype.getIndex=function(){return this._index},e.prototype.add=function(n){for(var o=this,a=an.getChains(n.getCoordinates(),n),l=a.iterator();l.hasNext();){var s=l.next();s.setId(o._idCounter++),o._index.insert(s.getEnvelope(),s),o._monoChains.add(s)}},e.prototype.computeNodes=function(n){var o=this;this._nodedSegStrings=n;for(var a=n.iterator();a.hasNext();)o.add(a.next());this.intersectChains()},e.prototype.intersectChains=function(){for(var n=this,o=new Aa(this._segInt),a=this._monoChains.iterator();a.hasNext();)for(var l=a.next(),s=n._index.query(l.getEnvelope()),m=s.iterator();m.hasNext();){var y=m.next();if(y.getId()>l.getId()&&(l.computeOverlaps(y,o),n._nOverlaps++),n._segInt.isDone())return null}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},t.SegmentOverlapAction.get=function(){return Aa},Object.defineProperties(e,t),e}(ho),Aa=function(r){function e(){r.call(this),this._si=null;var t=arguments[0];this._si=t}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.overlap=function(){if(arguments.length===4){var t=arguments[0],n=arguments[1],o=arguments[2],a=arguments[3],l=t.getContext(),s=o.getContext();this._si.processIntersections(l,n,s,a)}else return r.prototype.overlap.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(fo),J=function r(){if(this._quadrantSegments=r.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=r.CAP_ROUND,this._joinStyle=r.JOIN_ROUND,this._mitreLimit=r.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=r.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this.setQuadrantSegments(e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this.setQuadrantSegments(t),this.setEndCapStyle(n)}else if(arguments.length===4){var o=arguments[0],a=arguments[1],l=arguments[2],s=arguments[3];this.setQuadrantSegments(o),this.setEndCapStyle(a),this.setJoinStyle(l),this.setMitreLimit(s)}}},rr={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};J.prototype.getEndCapStyle=function(){return this._endCapStyle};J.prototype.isSingleSided=function(){return this._isSingleSided};J.prototype.setQuadrantSegments=function(r){this._quadrantSegments=r,this._quadrantSegments===0&&(this._joinStyle=J.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=J.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),r<=0&&(this._quadrantSegments=1),this._joinStyle!==J.JOIN_ROUND&&(this._quadrantSegments=J.DEFAULT_QUADRANT_SEGMENTS)};J.prototype.getJoinStyle=function(){return this._joinStyle};J.prototype.setJoinStyle=function(r){this._joinStyle=r};J.prototype.setSimplifyFactor=function(r){this._simplifyFactor=r<0?0:r};J.prototype.getSimplifyFactor=function(){return this._simplifyFactor};J.prototype.getQuadrantSegments=function(){return this._quadrantSegments};J.prototype.setEndCapStyle=function(r){this._endCapStyle=r};J.prototype.getMitreLimit=function(){return this._mitreLimit};J.prototype.setMitreLimit=function(r){this._mitreLimit=r};J.prototype.setSingleSided=function(r){this._isSingleSided=r};J.prototype.interfaces_=function(){return[]};J.prototype.getClass=function(){return J};J.bufferDistanceError=function(r){var e=Math.PI/2/r;return 1-Math.cos(e/2)};rr.CAP_ROUND.get=function(){return 1};rr.CAP_FLAT.get=function(){return 2};rr.CAP_SQUARE.get=function(){return 3};rr.JOIN_ROUND.get=function(){return 1};rr.JOIN_MITRE.get=function(){return 2};rr.JOIN_BEVEL.get=function(){return 3};rr.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8};rr.DEFAULT_MITRE_LIMIT.get=function(){return 5};rr.DEFAULT_SIMPLIFY_FACTOR.get=function(){return .01};Object.defineProperties(J,rr);var mt=function(r){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=M.COUNTERCLOCKWISE,this._inputLine=r||null},No={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};mt.prototype.isDeletable=function(r,e,t,n){var o=this._inputLine[r],a=this._inputLine[e],l=this._inputLine[t];return!this.isConcave(o,a,l)||!this.isShallow(o,a,l,n)?!1:this.isShallowSampled(o,a,r,t,n)};mt.prototype.deleteShallowConcavities=function(){for(var r=this,e=1,t=this.findNextNonDeletedIndex(e),n=this.findNextNonDeletedIndex(t),o=!1;n<this._inputLine.length;){var a=!1;r.isDeletable(e,t,n,r._distanceTol)&&(r._isDeleted[t]=mt.DELETE,a=!0,o=!0),a?e=n:e=t,t=r.findNextNonDeletedIndex(e),n=r.findNextNonDeletedIndex(t)}return o};mt.prototype.isShallowConcavity=function(r,e,t,n){var o=M.computeOrientation(r,e,t),a=o===this._angleOrientation;if(!a)return!1;var l=M.distancePointLine(e,r,t);return l<n};mt.prototype.isShallowSampled=function(r,e,t,n,o){var a=this,l=Math.trunc((n-t)/mt.NUM_PTS_TO_CHECK);l<=0&&(l=1);for(var s=t;s<n;s+=l)if(!a.isShallow(r,e,a._inputLine[s],o))return!1;return!0};mt.prototype.isConcave=function(r,e,t){var n=M.computeOrientation(r,e,t),o=n===this._angleOrientation;return o};mt.prototype.simplify=function(r){var e=this;this._distanceTol=Math.abs(r),r<0&&(this._angleOrientation=M.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var t=!1;do t=e.deleteShallowConcavities();while(t);return this.collapseLine()};mt.prototype.findNextNonDeletedIndex=function(r){for(var e=r+1;e<this._inputLine.length&&this._isDeleted[e]===mt.DELETE;)e++;return e};mt.prototype.isShallow=function(r,e,t,n){var o=M.distancePointLine(e,r,t);return o<n};mt.prototype.collapseLine=function(){for(var r=this,e=new Eo,t=0;t<this._inputLine.length;t++)r._isDeleted[t]!==mt.DELETE&&e.add(r._inputLine[t]);return e.toCoordinateArray()};mt.prototype.interfaces_=function(){return[]};mt.prototype.getClass=function(){return mt};mt.simplify=function(r,e){var t=new mt(r);return t.simplify(e)};No.INIT.get=function(){return 0};No.DELETE.get=function(){return 1};No.KEEP.get=function(){return 1};No.NUM_PTS_TO_CHECK.get=function(){return 10};Object.defineProperties(mt,No);var be=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new O},bu={COORDINATE_ARRAY_TYPE:{configurable:!0}};be.prototype.getCoordinates=function(){var r=this._ptList.toArray(be.COORDINATE_ARRAY_TYPE);return r};be.prototype.setPrecisionModel=function(r){this._precisionModel=r};be.prototype.addPt=function(r){var e=new d(r);if(this._precisionModel.makePrecise(e),this.isRedundant(e))return null;this._ptList.add(e)};be.prototype.revere=function(){};be.prototype.addPts=function(r,e){var t=this;if(e)for(var n=0;n<r.length;n++)t.addPt(r[n]);else for(var o=r.length-1;o>=0;o--)t.addPt(r[o])};be.prototype.isRedundant=function(r){if(this._ptList.size()<1)return!1;var e=this._ptList.get(this._ptList.size()-1),t=r.distance(e);return t<this._minimimVertexDistance};be.prototype.toString=function(){var r=new H,e=r.createLineString(this.getCoordinates());return e.toString()};be.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var r=new d(this._ptList.get(0)),e=this._ptList.get(this._ptList.size()-1);if(r.equals(e))return null;this._ptList.add(r)};be.prototype.setMinimumVertexDistance=function(r){this._minimimVertexDistance=r};be.prototype.interfaces_=function(){return[]};be.prototype.getClass=function(){return be};bu.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)};Object.defineProperties(be,bu);var K=function(){},gi={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};K.prototype.interfaces_=function(){return[]};K.prototype.getClass=function(){return K};K.toDegrees=function(r){return r*180/Math.PI};K.normalize=function(r){for(;r>Math.PI;)r-=K.PI_TIMES_2;for(;r<=-Math.PI;)r+=K.PI_TIMES_2;return r};K.angle=function(){if(arguments.length===1){var r=arguments[0];return Math.atan2(r.y,r.x)}else if(arguments.length===2){var e=arguments[0],t=arguments[1],n=t.x-e.x,o=t.y-e.y;return Math.atan2(o,n)}};K.isAcute=function(r,e,t){var n=r.x-e.x,o=r.y-e.y,a=t.x-e.x,l=t.y-e.y,s=n*a+o*l;return s>0};K.isObtuse=function(r,e,t){var n=r.x-e.x,o=r.y-e.y,a=t.x-e.x,l=t.y-e.y,s=n*a+o*l;return s<0};K.interiorAngle=function(r,e,t){var n=K.angle(e,r),o=K.angle(e,t);return Math.abs(o-n)};K.normalizePositive=function(r){if(r<0){for(;r<0;)r+=K.PI_TIMES_2;r>=K.PI_TIMES_2&&(r=0)}else{for(;r>=K.PI_TIMES_2;)r-=K.PI_TIMES_2;r<0&&(r=0)}return r};K.angleBetween=function(r,e,t){var n=K.angle(e,r),o=K.angle(e,t);return K.diff(n,o)};K.diff=function(r,e){var t=null;return r<e?t=e-r:t=r-e,t>Math.PI&&(t=2*Math.PI-t),t};K.toRadians=function(r){return r*Math.PI/180};K.getTurn=function(r,e){var t=Math.sin(e-r);return t>0?K.COUNTERCLOCKWISE:t<0?K.CLOCKWISE:K.NONE};K.angleBetweenOriented=function(r,e,t){var n=K.angle(e,r),o=K.angle(e,t),a=o-n;return a<=-Math.PI?a+K.PI_TIMES_2:a>Math.PI?a-K.PI_TIMES_2:a};gi.PI_TIMES_2.get=function(){return 2*Math.PI};gi.PI_OVER_2.get=function(){return Math.PI/2};gi.PI_OVER_4.get=function(){return Math.PI/4};gi.COUNTERCLOCKWISE.get=function(){return M.COUNTERCLOCKWISE};gi.CLOCKWISE.get=function(){return M.CLOCKWISE};gi.NONE.get=function(){return M.COLLINEAR};Object.defineProperties(K,gi);var lt=function r(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new k,this._seg1=new k,this._offset0=new k,this._offset1=new k,this._side=0,this._hasNarrowConcaveAngle=!1;var e=arguments[0],t=arguments[1],n=arguments[2];this._precisionModel=e,this._bufParams=t,this._li=new Xr,this._filletAngleQuantum=Math.PI/2/t.getQuadrantSegments(),t.getQuadrantSegments()>=8&&t.getJoinStyle()===J.JOIN_ROUND&&(this._closingSegLengthFactor=r.MAX_CLOSING_SEG_LEN_FACTOR),this.init(n)},xo={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};lt.prototype.addNextSegment=function(r,e){if(this._s0=this._s1,this._s1=this._s2,this._s2=r,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var t=M.computeOrientation(this._s0,this._s1,this._s2),n=t===M.CLOCKWISE&&this._side===b.LEFT||t===M.COUNTERCLOCKWISE&&this._side===b.RIGHT;t===0?this.addCollinear(e):n?this.addOutsideTurn(t,e):this.addInsideTurn(t,e)};lt.prototype.addLineEndCap=function(r,e){var t=new k(r,e),n=new k;this.computeOffsetSegment(t,b.LEFT,this._distance,n);var o=new k;this.computeOffsetSegment(t,b.RIGHT,this._distance,o);var a=e.x-r.x,l=e.y-r.y,s=Math.atan2(l,a);switch(this._bufParams.getEndCapStyle()){case J.CAP_ROUND:this._segList.addPt(n.p1),this.addFilletArc(e,s+Math.PI/2,s-Math.PI/2,M.CLOCKWISE,this._distance),this._segList.addPt(o.p1);break;case J.CAP_FLAT:this._segList.addPt(n.p1),this._segList.addPt(o.p1);break;case J.CAP_SQUARE:var m=new d;m.x=Math.abs(this._distance)*Math.cos(s),m.y=Math.abs(this._distance)*Math.sin(s);var y=new d(n.p1.x+m.x,n.p1.y+m.y),D=new d(o.p1.x+m.x,o.p1.y+m.y);this._segList.addPt(y),this._segList.addPt(D);break}};lt.prototype.getCoordinates=function(){var r=this._segList.getCoordinates();return r};lt.prototype.addMitreJoin=function(r,e,t,n){var o=!0,a=null;try{a=Ue.intersection(e.p0,e.p1,t.p0,t.p1);var l=n<=0?1:a.distance(r)/Math.abs(n);l>this._bufParams.getMitreLimit()&&(o=!1)}catch(s){if(s instanceof qi)a=new d(0,0),o=!1;else throw s}finally{}o?this._segList.addPt(a):this.addLimitedMitreJoin(e,t,n,this._bufParams.getMitreLimit())};lt.prototype.addFilletCorner=function(r,e,t,n,o){var a=e.x-r.x,l=e.y-r.y,s=Math.atan2(l,a),m=t.x-r.x,y=t.y-r.y,D=Math.atan2(y,m);n===M.CLOCKWISE?s<=D&&(s+=2*Math.PI):s>=D&&(s-=2*Math.PI),this._segList.addPt(e),this.addFilletArc(r,s,D,n,o),this._segList.addPt(t)};lt.prototype.addOutsideTurn=function(r,e){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*lt.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===J.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===J.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(e&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,r,this._distance),this._segList.addPt(this._offset1.p0))};lt.prototype.createSquare=function(r){this._segList.addPt(new d(r.x+this._distance,r.y+this._distance)),this._segList.addPt(new d(r.x+this._distance,r.y-this._distance)),this._segList.addPt(new d(r.x-this._distance,r.y-this._distance)),this._segList.addPt(new d(r.x-this._distance,r.y+this._distance)),this._segList.closeRing()};lt.prototype.addSegments=function(r,e){this._segList.addPts(r,e)};lt.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)};lt.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)};lt.prototype.initSideSegments=function(r,e,t){this._s1=r,this._s2=e,this._side=t,this._seg1.setCoordinates(r,e),this.computeOffsetSegment(this._seg1,t,this._distance,this._offset1)};lt.prototype.addLimitedMitreJoin=function(r,e,t,n){var o=this._seg0.p1,a=K.angle(o,this._seg0.p0),l=K.angleBetweenOriented(this._seg0.p0,o,this._seg1.p1),s=l/2,m=K.normalize(a+s),y=K.normalize(m+Math.PI),D=n*t,W=D*Math.abs(Math.sin(s)),Ee=t-W,dt=o.x+D*Math.cos(y),Ht=o.y+D*Math.sin(y),ir=new d(dt,Ht),Hr=new k(o,ir),Bn=Hr.pointAlongOffset(1,Ee),Vn=Hr.pointAlongOffset(1,-Ee);this._side===b.LEFT?(this._segList.addPt(Bn),this._segList.addPt(Vn)):(this._segList.addPt(Vn),this._segList.addPt(Bn))};lt.prototype.computeOffsetSegment=function(r,e,t,n){var o=e===b.LEFT?1:-1,a=r.p1.x-r.p0.x,l=r.p1.y-r.p0.y,s=Math.sqrt(a*a+l*l),m=o*t*a/s,y=o*t*l/s;n.p0.x=r.p0.x-y,n.p0.y=r.p0.y+m,n.p1.x=r.p1.x-y,n.p1.y=r.p1.y+m};lt.prototype.addFilletArc=function(r,e,t,n,o){var a=this,l=n===M.CLOCKWISE?-1:1,s=Math.abs(e-t),m=Math.trunc(s/this._filletAngleQuantum+.5);if(m<1)return null;for(var y=0,D=s/m,W=y,Ee=new d;W<s;){var dt=e+l*W;Ee.x=r.x+o*Math.cos(dt),Ee.y=r.y+o*Math.sin(dt),a._segList.addPt(Ee),W+=D}};lt.prototype.addInsideTurn=function(r,e){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*lt.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var t=new d((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(t);var n=new d((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}};lt.prototype.createCircle=function(r){var e=new d(r.x+this._distance,r.y);this._segList.addPt(e),this.addFilletArc(r,0,2*Math.PI,-1,this._distance),this._segList.closeRing()};lt.prototype.addBevelJoin=function(r,e){this._segList.addPt(r.p1),this._segList.addPt(e.p0)};lt.prototype.init=function(r){this._distance=r,this._maxCurveSegmentError=r*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new be,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(r*lt.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)};lt.prototype.addCollinear=function(r){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);var e=this._li.getIntersectionNum();e>=2&&(this._bufParams.getJoinStyle()===J.JOIN_BEVEL||this._bufParams.getJoinStyle()===J.JOIN_MITRE?(r&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,M.CLOCKWISE,this._distance))};lt.prototype.closeRing=function(){this._segList.closeRing()};lt.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle};lt.prototype.interfaces_=function(){return[]};lt.prototype.getClass=function(){return lt};xo.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return .001};xo.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return .001};xo.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6};xo.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80};Object.defineProperties(lt,xo);var fe=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var r=arguments[0],e=arguments[1];this._precisionModel=r,this._bufParams=e};fe.prototype.getOffsetCurve=function(r,e){if(this._distance=e,e===0)return null;var t=e<0,n=Math.abs(e),o=this.getSegGen(n);r.length<=1?this.computePointCurve(r[0],o):this.computeOffsetCurve(r,t,o);var a=o.getCoordinates();return t&&j.reverse(a),a};fe.prototype.computeSingleSidedBufferCurve=function(r,e,t){var n=this.simplifyTolerance(this._distance);if(e){t.addSegments(r,!0);var o=mt.simplify(r,-n),a=o.length-1;t.initSideSegments(o[a],o[a-1],b.LEFT),t.addFirstSegment();for(var l=a-2;l>=0;l--)t.addNextSegment(o[l],!0)}else{t.addSegments(r,!1);var s=mt.simplify(r,n),m=s.length-1;t.initSideSegments(s[0],s[1],b.LEFT),t.addFirstSegment();for(var y=2;y<=m;y++)t.addNextSegment(s[y],!0)}t.addLastSegment(),t.closeRing()};fe.prototype.computeRingBufferCurve=function(r,e,t){var n=this.simplifyTolerance(this._distance);e===b.RIGHT&&(n=-n);var o=mt.simplify(r,n),a=o.length-1;t.initSideSegments(o[a-1],o[0],e);for(var l=1;l<=a;l++){var s=l!==1;t.addNextSegment(o[l],s)}t.closeRing()};fe.prototype.computeLineBufferCurve=function(r,e){var t=this.simplifyTolerance(this._distance),n=mt.simplify(r,t),o=n.length-1;e.initSideSegments(n[0],n[1],b.LEFT);for(var a=2;a<=o;a++)e.addNextSegment(n[a],!0);e.addLastSegment(),e.addLineEndCap(n[o-1],n[o]);var l=mt.simplify(r,-t),s=l.length-1;e.initSideSegments(l[s],l[s-1],b.LEFT);for(var m=s-2;m>=0;m--)e.addNextSegment(l[m],!0);e.addLastSegment(),e.addLineEndCap(l[1],l[0]),e.closeRing()};fe.prototype.computePointCurve=function(r,e){switch(this._bufParams.getEndCapStyle()){case J.CAP_ROUND:e.createCircle(r);break;case J.CAP_SQUARE:e.createSquare(r);break}};fe.prototype.getLineCurve=function(r,e){if(this._distance=e,e<0&&!this._bufParams.isSingleSided()||e===0)return null;var t=Math.abs(e),n=this.getSegGen(t);if(r.length<=1)this.computePointCurve(r[0],n);else if(this._bufParams.isSingleSided()){var o=e<0;this.computeSingleSidedBufferCurve(r,o,n)}else this.computeLineBufferCurve(r,n);var a=n.getCoordinates();return a};fe.prototype.getBufferParameters=function(){return this._bufParams};fe.prototype.simplifyTolerance=function(r){return r*this._bufParams.getSimplifyFactor()};fe.prototype.getRingCurve=function(r,e,t){if(this._distance=t,r.length<=2)return this.getLineCurve(r,t);if(t===0)return fe.copyCoordinates(r);var n=this.getSegGen(t);return this.computeRingBufferCurve(r,e,n),n.getCoordinates()};fe.prototype.computeOffsetCurve=function(r,e,t){var n=this.simplifyTolerance(this._distance);if(e){var o=mt.simplify(r,-n),a=o.length-1;t.initSideSegments(o[a],o[a-1],b.LEFT),t.addFirstSegment();for(var l=a-2;l>=0;l--)t.addNextSegment(o[l],!0)}else{var s=mt.simplify(r,n),m=s.length-1;t.initSideSegments(s[0],s[1],b.LEFT),t.addFirstSegment();for(var y=2;y<=m;y++)t.addNextSegment(s[y],!0)}t.addLastSegment()};fe.prototype.getSegGen=function(r){return new lt(this._precisionModel,this._bufParams,r)};fe.prototype.interfaces_=function(){return[]};fe.prototype.getClass=function(){return fe};fe.copyCoordinates=function(r){for(var e=new Array(r.length).fill(null),t=0;t<e.length;t++)e[t]=new d(r[t]);return e};var ti=function(){this._subgraphs=null,this._seg=new k,this._cga=new M;var r=arguments[0];this._subgraphs=r},Pu={DepthSegment:{configurable:!0}};ti.prototype.findStabbedSegments=function(){var r=this;if(arguments.length===1){for(var e=arguments[0],t=new O,n=this._subgraphs.iterator();n.hasNext();){var o=n.next(),a=o.getEnvelope();e.y<a.getMinY()||e.y>a.getMaxY()||r.findStabbedSegments(e,o.getDirectedEdges(),t)}return t}else if(arguments.length===3){if(V(arguments[2],qe)&&arguments[0]instanceof d&&arguments[1]instanceof As)for(var l=arguments[0],s=arguments[1],m=arguments[2],y=s.getEdge().getCoordinates(),D=0;D<y.length-1;D++){r._seg.p0=y[D],r._seg.p1=y[D+1],r._seg.p0.y>r._seg.p1.y&&r._seg.reverse();var W=Math.max(r._seg.p0.x,r._seg.p1.x);if(!(W<l.x)&&!r._seg.isHorizontal()&&!(l.y<r._seg.p0.y||l.y>r._seg.p1.y)&&M.computeOrientation(r._seg.p0,r._seg.p1,l)!==M.RIGHT){var Ee=s.getDepth(b.LEFT);r._seg.p0.equals(y[D])||(Ee=s.getDepth(b.RIGHT));var dt=new Mr(r._seg,Ee);m.add(dt)}}else if(V(arguments[2],qe)&&arguments[0]instanceof d&&V(arguments[1],qe))for(var Ht=arguments[0],ir=arguments[1],Hr=arguments[2],Bn=ir.iterator();Bn.hasNext();){var Vn=Bn.next();Vn.isForward()&&r.findStabbedSegments(Ht,Vn,Hr)}}};ti.prototype.getDepth=function(r){var e=this.findStabbedSegments(r);if(e.size()===0)return 0;var t=He.min(e);return t._leftDepth};ti.prototype.interfaces_=function(){return[]};ti.prototype.getClass=function(){return ti};Pu.DepthSegment.get=function(){return Mr};Object.defineProperties(ti,Pu);var Mr=function(){this._upwardSeg=null,this._leftDepth=null;var r=arguments[0],e=arguments[1];this._upwardSeg=new k(r),this._leftDepth=e};Mr.prototype.compareTo=function(r){var e=r;if(this._upwardSeg.minX()>=e._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=e._upwardSeg.minX())return-1;var t=this._upwardSeg.orientationIndex(e._upwardSeg);return t!==0||(t=-1*e._upwardSeg.orientationIndex(this._upwardSeg),t!==0)?t:this._upwardSeg.compareTo(e._upwardSeg)};Mr.prototype.compareX=function(r,e){var t=r.p0.compareTo(e.p0);return t!==0?t:r.p1.compareTo(e.p1)};Mr.prototype.toString=function(){return this._upwardSeg.toString()};Mr.prototype.interfaces_=function(){return[ke]};Mr.prototype.getClass=function(){return Mr};var tt=function(r,e,t){this.p0=r||null,this.p1=e||null,this.p2=t||null};tt.prototype.area=function(){return tt.area(this.p0,this.p1,this.p2)};tt.prototype.signedArea=function(){return tt.signedArea(this.p0,this.p1,this.p2)};tt.prototype.interpolateZ=function(r){if(r===null)throw new ft("Supplied point is null.");return tt.interpolateZ(r,this.p0,this.p1,this.p2)};tt.prototype.longestSideLength=function(){return tt.longestSideLength(this.p0,this.p1,this.p2)};tt.prototype.isAcute=function(){return tt.isAcute(this.p0,this.p1,this.p2)};tt.prototype.circumcentre=function(){return tt.circumcentre(this.p0,this.p1,this.p2)};tt.prototype.area3D=function(){return tt.area3D(this.p0,this.p1,this.p2)};tt.prototype.centroid=function(){return tt.centroid(this.p0,this.p1,this.p2)};tt.prototype.inCentre=function(){return tt.inCentre(this.p0,this.p1,this.p2)};tt.prototype.interfaces_=function(){return[]};tt.prototype.getClass=function(){return tt};tt.area=function(r,e,t){return Math.abs(((t.x-r.x)*(e.y-r.y)-(e.x-r.x)*(t.y-r.y))/2)};tt.signedArea=function(r,e,t){return((t.x-r.x)*(e.y-r.y)-(e.x-r.x)*(t.y-r.y))/2};tt.det=function(r,e,t,n){return r*n-e*t};tt.interpolateZ=function(r,e,t,n){var o=e.x,a=e.y,l=t.x-o,s=n.x-o,m=t.y-a,y=n.y-a,D=l*y-s*m,W=r.x-o,Ee=r.y-a,dt=(y*W-s*Ee)/D,Ht=(-m*W+l*Ee)/D,ir=e.z+dt*(t.z-e.z)+Ht*(n.z-e.z);return ir};tt.longestSideLength=function(r,e,t){var n=r.distance(e),o=e.distance(t),a=t.distance(r),l=n;return o>l&&(l=o),a>l&&(l=a),l};tt.isAcute=function(r,e,t){return!(!K.isAcute(r,e,t)||!K.isAcute(e,t,r)||!K.isAcute(t,r,e))};tt.circumcentre=function(r,e,t){var n=t.x,o=t.y,a=r.x-n,l=r.y-o,s=e.x-n,m=e.y-o,y=2*tt.det(a,l,s,m),D=tt.det(l,a*a+l*l,m,s*s+m*m),W=tt.det(a,a*a+l*l,s,s*s+m*m),Ee=n-D/y,dt=o+W/y;return new d(Ee,dt)};tt.perpendicularBisector=function(r,e){var t=e.x-r.x,n=e.y-r.y,o=new Ue(r.x+t/2,r.y+n/2,1),a=new Ue(r.x-n+t/2,r.y+t+n/2,1);return new Ue(o,a)};tt.angleBisector=function(r,e,t){var n=e.distance(r),o=e.distance(t),a=n/(n+o),l=t.x-r.x,s=t.y-r.y,m=new d(r.x+a*l,r.y+a*s);return m};tt.area3D=function(r,e,t){var n=e.x-r.x,o=e.y-r.y,a=e.z-r.z,l=t.x-r.x,s=t.y-r.y,m=t.z-r.z,y=o*m-a*s,D=a*l-n*m,W=n*s-o*l,Ee=y*y+D*D+W*W,dt=Math.sqrt(Ee)/2;return dt};tt.centroid=function(r,e,t){var n=(r.x+e.x+t.x)/3,o=(r.y+e.y+t.y)/3;return new d(n,o)};tt.inCentre=function(r,e,t){var n=e.distance(t),o=r.distance(t),a=r.distance(e),l=n+o+a,s=(n*r.x+o*e.x+a*t.x)/l,m=(n*r.y+o*e.y+a*t.y)/l;return new d(s,m)};var Be=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new O;var r=arguments[0],e=arguments[1],t=arguments[2];this._inputGeom=r,this._distance=e,this._curveBuilder=t};Be.prototype.addPoint=function(r){if(this._distance<=0)return null;var e=r.getCoordinates(),t=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(t,E.EXTERIOR,E.INTERIOR)};Be.prototype.addPolygon=function(r){var e=this,t=this._distance,n=b.LEFT;this._distance<0&&(t=-this._distance,n=b.RIGHT);var o=r.getExteriorRing(),a=j.removeRepeatedPoints(o.getCoordinates());if(this._distance<0&&this.isErodedCompletely(o,this._distance)||this._distance<=0&&a.length<3)return null;this.addPolygonRing(a,t,n,E.EXTERIOR,E.INTERIOR);for(var l=0;l<r.getNumInteriorRing();l++){var s=r.getInteriorRingN(l),m=j.removeRepeatedPoints(s.getCoordinates());e._distance>0&&e.isErodedCompletely(s,-e._distance)||e.addPolygonRing(m,t,b.opposite(n),E.INTERIOR,E.EXTERIOR)}};Be.prototype.isTriangleErodedCompletely=function(r,e){var t=new tt(r[0],r[1],r[2]),n=t.inCentre(),o=M.distancePointLine(n,t.p0,t.p1);return o<Math.abs(e)};Be.prototype.addLineString=function(r){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var e=j.removeRepeatedPoints(r.getCoordinates()),t=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(t,E.EXTERIOR,E.INTERIOR)};Be.prototype.addCurve=function(r,e,t){if(r===null||r.length<2)return null;var n=new Nt(r,new et(0,E.BOUNDARY,e,t));this._curveList.add(n)};Be.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList};Be.prototype.addPolygonRing=function(r,e,t,n,o){if(e===0&&r.length<bn.MINIMUM_VALID_SIZE)return null;var a=n,l=o;r.length>=bn.MINIMUM_VALID_SIZE&&M.isCCW(r)&&(a=o,l=n,t=b.opposite(t));var s=this._curveBuilder.getRingCurve(r,t,e);this.addCurve(s,a,l)};Be.prototype.add=function(r){if(r.isEmpty())return null;r instanceof Ot?this.addPolygon(r):r instanceof yt?this.addLineString(r):r instanceof de?this.addPoint(r):r instanceof Pi?this.addCollection(r):r instanceof Tr?this.addCollection(r):r instanceof Sn?this.addCollection(r):r instanceof ie&&this.addCollection(r)};Be.prototype.isErodedCompletely=function(r,e){var t=r.getCoordinates();if(t.length<4)return e<0;if(t.length===4)return this.isTriangleErodedCompletely(t,e);var n=r.getEnvelopeInternal(),o=Math.min(n.getHeight(),n.getWidth());return e<0&&2*Math.abs(e)>o};Be.prototype.addCollection=function(r){for(var e=this,t=0;t<r.getNumGeometries();t++){var n=r.getGeometryN(t);e.add(n)}};Be.prototype.interfaces_=function(){return[]};Be.prototype.getClass=function(){return Be};var Di=function(){};Di.prototype.locate=function(r){};Di.prototype.interfaces_=function(){return[]};Di.prototype.getClass=function(){return Di};var wn=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var r=arguments[0];this._parent=r,this._atStart=!0,this._index=0,this._max=r.getNumGeometries()};wn.prototype.next=function(){if(this._atStart)return this._atStart=!1,wn.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Yi;var r=this._parent.getGeometryN(this._index++);return r instanceof ie?(this._subcollectionIterator=new wn(r),this._subcollectionIterator.next()):r};wn.prototype.remove=function(){throw new Error(this.getClass().getName())};wn.prototype.hasNext=function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)};wn.prototype.interfaces_=function(){return[Xi]};wn.prototype.getClass=function(){return wn};wn.isAtomic=function(r){return!(r instanceof ie)};var xe=function(){this._geom=null;var r=arguments[0];this._geom=r};xe.prototype.locate=function(r){return xe.locate(r,this._geom)};xe.prototype.interfaces_=function(){return[Di]};xe.prototype.getClass=function(){return xe};xe.isPointInRing=function(r,e){return e.getEnvelopeInternal().intersects(r)?M.isPointInRing(r,e.getCoordinates()):!1};xe.containsPointInPolygon=function(r,e){if(e.isEmpty())return!1;var t=e.getExteriorRing();if(!xe.isPointInRing(r,t))return!1;for(var n=0;n<e.getNumInteriorRing();n++){var o=e.getInteriorRingN(n);if(xe.isPointInRing(r,o))return!1}return!0};xe.containsPoint=function(r,e){if(e instanceof Ot)return xe.containsPointInPolygon(r,e);if(e instanceof ie)for(var t=new wn(e);t.hasNext();){var n=t.next();if(n!==e&&xe.containsPoint(r,n))return!0}return!1};xe.locate=function(r,e){return e.isEmpty()?E.EXTERIOR:xe.containsPoint(r,e)?E.INTERIOR:E.EXTERIOR};var Zt=function(){this._edgeMap=new Kt,this._edgeList=null,this._ptInAreaLocation=[E.NONE,E.NONE]};Zt.prototype.getNextCW=function(r){this.getEdges();var e=this._edgeList.indexOf(r),t=e-1;return e===0&&(t=this._edgeList.size()-1),this._edgeList.get(t)};Zt.prototype.propagateSideLabels=function(r){for(var e=E.NONE,t=this.iterator();t.hasNext();){var n=t.next(),o=n.getLabel();o.isArea(r)&&o.getLocation(r,b.LEFT)!==E.NONE&&(e=o.getLocation(r,b.LEFT))}if(e===E.NONE)return null;for(var a=e,l=this.iterator();l.hasNext();){var s=l.next(),m=s.getLabel();if(m.getLocation(r,b.ON)===E.NONE&&m.setLocation(r,b.ON,a),m.isArea(r)){var y=m.getLocation(r,b.LEFT),D=m.getLocation(r,b.RIGHT);if(D!==E.NONE){if(D!==a)throw new Jn("side location conflict",s.getCoordinate());y===E.NONE&&q.shouldNeverReachHere("found single null side (at "+s.getCoordinate()+")"),a=y}else q.isTrue(m.getLocation(r,b.LEFT)===E.NONE,"found single null side"),m.setLocation(r,b.RIGHT,a),m.setLocation(r,b.LEFT,a)}}};Zt.prototype.getCoordinate=function(){var r=this.iterator();if(!r.hasNext())return null;var e=r.next();return e.getCoordinate()};Zt.prototype.print=function(r){qt.out.println("EdgeEndStar:   "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){var t=e.next();t.print(r)}};Zt.prototype.isAreaLabelsConsistent=function(r){return this.computeEdgeEndLabels(r.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)};Zt.prototype.checkAreaLabelsConsistent=function(r){var e=this.getEdges();if(e.size()<=0)return!0;var t=e.size()-1,n=e.get(t).getLabel(),o=n.getLocation(r,b.LEFT);q.isTrue(o!==E.NONE,"Found unlabelled area edge");for(var a=o,l=this.iterator();l.hasNext();){var s=l.next(),m=s.getLabel();q.isTrue(m.isArea(r),"Found non-area edge");var y=m.getLocation(r,b.LEFT),D=m.getLocation(r,b.RIGHT);if(y===D||D!==a)return!1;a=y}return!0};Zt.prototype.findIndex=function(r){var e=this;this.iterator();for(var t=0;t<this._edgeList.size();t++){var n=e._edgeList.get(t);if(n===r)return t}return-1};Zt.prototype.iterator=function(){return this.getEdges().iterator()};Zt.prototype.getEdges=function(){return this._edgeList===null&&(this._edgeList=new O(this._edgeMap.values())),this._edgeList};Zt.prototype.getLocation=function(r,e,t){return this._ptInAreaLocation[r]===E.NONE&&(this._ptInAreaLocation[r]=xe.locate(e,t[r].getGeometry())),this._ptInAreaLocation[r]};Zt.prototype.toString=function(){var r=new _n;r.append("EdgeEndStar:   "+this.getCoordinate()),r.append(`
`);for(var e=this.iterator();e.hasNext();){var t=e.next();r.append(t),r.append(`
`)}return r.toString()};Zt.prototype.computeEdgeEndLabels=function(r){for(var e=this.iterator();e.hasNext();){var t=e.next();t.computeLabel(r)}};Zt.prototype.computeLabelling=function(r){var e=this;this.computeEdgeEndLabels(r[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var t=[!1,!1],n=this.iterator();n.hasNext();)for(var o=n.next(),a=o.getLabel(),l=0;l<2;l++)a.isLine(l)&&a.getLocation(l)===E.BOUNDARY&&(t[l]=!0);for(var s=this.iterator();s.hasNext();)for(var m=s.next(),y=m.getLabel(),D=0;D<2;D++)if(y.isAnyNull(D)){var W=E.NONE;if(t[D])W=E.EXTERIOR;else{var Ee=m.getCoordinate();W=e.getLocation(D,Ee,r)}y.setAllLocationsIfNull(D,W)}};Zt.prototype.getDegree=function(){return this._edgeMap.size()};Zt.prototype.insertEdgeEnd=function(r,e){this._edgeMap.put(r,e),this._edgeList=null};Zt.prototype.interfaces_=function(){return[]};Zt.prototype.getClass=function(){return Zt};var of=function(r){function e(){r.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.linkResultDirectedEdges=function(){var t=this;this.getResultAreaEdges();for(var n=null,o=null,a=this._SCANNING_FOR_INCOMING,l=0;l<this._resultAreaEdgeList.size();l++){var s=t._resultAreaEdgeList.get(l),m=s.getSym();if(s.getLabel().isArea())switch(n===null&&s.isInResult()&&(n=s),a){case t._SCANNING_FOR_INCOMING:if(!m.isInResult())continue;o=m,a=t._LINKING_TO_OUTGOING;break;case t._LINKING_TO_OUTGOING:if(!s.isInResult())continue;o.setNext(s),a=t._SCANNING_FOR_INCOMING;break}}if(a===this._LINKING_TO_OUTGOING){if(n===null)throw new Jn("no outgoing dirEdge found",this.getCoordinate());q.isTrue(n.isInResult(),"unable to link last incoming dirEdge"),o.setNext(n)}},e.prototype.insert=function(t){var n=t;this.insertEdgeEnd(n,n)},e.prototype.getRightmostEdge=function(){var t=this.getEdges(),n=t.size();if(n<1)return null;var o=t.get(0);if(n===1)return o;var a=t.get(n-1),l=o.getQuadrant(),s=a.getQuadrant();return rt.isNorthern(l)&&rt.isNorthern(s)?o:!rt.isNorthern(l)&&!rt.isNorthern(s)?a:o.getDy()!==0?o:a.getDy()!==0?a:(q.shouldNeverReachHere("found two horizontal edges incident on node"),null)},e.prototype.print=function(t){qt.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var n=this.iterator();n.hasNext();){var o=n.next();t.print("out "),o.print(t),t.println(),t.print("in "),o.getSym().print(t),t.println()}},e.prototype.getResultAreaEdges=function(){var t=this;if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new O;for(var n=this.iterator();n.hasNext();){var o=n.next();(o.isInResult()||o.getSym().isInResult())&&t._resultAreaEdgeList.add(o)}return this._resultAreaEdgeList},e.prototype.updateLabelling=function(t){for(var n=this.iterator();n.hasNext();){var o=n.next(),a=o.getLabel();a.setAllLocationsIfNull(0,t.getLocation(0)),a.setAllLocationsIfNull(1,t.getLocation(1))}},e.prototype.linkAllDirectedEdges=function(){var t=this;this.getEdges();for(var n=null,o=null,a=this._edgeList.size()-1;a>=0;a--){var l=t._edgeList.get(a),s=l.getSym();o===null&&(o=s),n!==null&&s.setNext(n),n=l}o.setNext(n)},e.prototype.computeDepths=function(){var t=this;if(arguments.length===1){var n=arguments[0],o=this.findIndex(n),a=n.getDepth(b.LEFT),l=n.getDepth(b.RIGHT),s=this.computeDepths(o+1,this._edgeList.size(),a),m=this.computeDepths(0,o,s);if(m!==l)throw new Jn("depth mismatch at "+n.getCoordinate())}else if(arguments.length===3){for(var y=arguments[0],D=arguments[1],W=arguments[2],Ee=W,dt=y;dt<D;dt++){var Ht=t._edgeList.get(dt);Ht.setEdgeDepths(b.RIGHT,Ee),Ee=Ht.getDepth(b.LEFT)}return Ee}},e.prototype.mergeSymLabels=function(){for(var t=this.iterator();t.hasNext();){var n=t.next(),o=n.getLabel();o.merge(n.getSym().getLabel())}},e.prototype.linkMinimalDirectedEdges=function(t){for(var n=this,o=null,a=null,l=this._SCANNING_FOR_INCOMING,s=this._resultAreaEdgeList.size()-1;s>=0;s--){var m=n._resultAreaEdgeList.get(s),y=m.getSym();switch(o===null&&m.getEdgeRing()===t&&(o=m),l){case n._SCANNING_FOR_INCOMING:if(y.getEdgeRing()!==t)continue;a=y,l=n._LINKING_TO_OUTGOING;break;case n._LINKING_TO_OUTGOING:if(m.getEdgeRing()!==t)continue;a.setNextMin(m),l=n._SCANNING_FOR_INCOMING;break}}l===this._LINKING_TO_OUTGOING&&(q.isTrue(o!==null,"found null for first outgoing dirEdge"),q.isTrue(o.getEdgeRing()===t,"unable to link last incoming dirEdge"),a.setNextMin(o))},e.prototype.getOutgoingDegree=function(){if(arguments.length===0){for(var t=0,n=this.iterator();n.hasNext();){var o=n.next();o.isInResult()&&t++}return t}else if(arguments.length===1){for(var a=arguments[0],l=0,s=this.iterator();s.hasNext();){var m=s.next();m.getEdgeRing()===a&&l++}return l}},e.prototype.getLabel=function(){return this._label},e.prototype.findCoveredLineEdges=function(){for(var t=E.NONE,n=this.iterator();n.hasNext();){var o=n.next(),a=o.getSym();if(!o.isLineEdge()){if(o.isInResult()){t=E.INTERIOR;break}if(a.isInResult()){t=E.EXTERIOR;break}}}if(t===E.NONE)return null;for(var l=t,s=this.iterator();s.hasNext();){var m=s.next(),y=m.getSym();m.isLineEdge()?m.getEdge().setCovered(l===E.INTERIOR):(m.isInResult()&&(l=E.EXTERIOR),y.isInResult()&&(l=E.INTERIOR))}},e.prototype.computeLabelling=function(t){var n=this;r.prototype.computeLabelling.call(this,t),this._label=new et(E.NONE);for(var o=this.iterator();o.hasNext();)for(var a=o.next(),l=a.getEdge(),s=l.getLabel(),m=0;m<2;m++){var y=s.getLocation(m);(y===E.INTERIOR||y===E.BOUNDARY)&&n._label.setLocation(m,E.INTERIOR)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Zt),Ru=function(r){function e(){r.apply(this,arguments)}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.createNode=function(t){return new ls(t,new of)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ri),pr=function r(){this._pts=null,this._orientation=null;var e=arguments[0];this._pts=e,this._orientation=r.orientation(e)};pr.prototype.compareTo=function(r){var e=r,t=pr.compareOriented(this._pts,this._orientation,e._pts,e._orientation);return t};pr.prototype.interfaces_=function(){return[ke]};pr.prototype.getClass=function(){return pr};pr.orientation=function(r){return j.increasingDirection(r)===1};pr.compareOriented=function(r,e,t,n){for(var o=e?1:-1,a=n?1:-1,l=e?r.length:-1,s=n?t.length:-1,m=e?0:r.length-1,y=n?0:t.length-1;;){var D=r[m].compareTo(t[y]);if(D!==0)return D;m+=o,y+=a;var W=m===l,Ee=y===s;if(W&&!Ee)return-1;if(!W&&Ee)return 1;if(W&&Ee)return 0}};var je=function(){this._edges=new O,this._ocaMap=new Kt};je.prototype.print=function(r){var e=this;r.print("MULTILINESTRING ( ");for(var t=0;t<this._edges.size();t++){var n=e._edges.get(t);t>0&&r.print(","),r.print("(");for(var o=n.getCoordinates(),a=0;a<o.length;a++)a>0&&r.print(","),r.print(o[a].x+" "+o[a].y);r.println(")")}r.print(")  ")};je.prototype.addAll=function(r){for(var e=this,t=r.iterator();t.hasNext();)e.add(t.next())};je.prototype.findEdgeIndex=function(r){for(var e=this,t=0;t<this._edges.size();t++)if(e._edges.get(t).equals(r))return t;return-1};je.prototype.iterator=function(){return this._edges.iterator()};je.prototype.getEdges=function(){return this._edges};je.prototype.get=function(r){return this._edges.get(r)};je.prototype.findEqualEdge=function(r){var e=new pr(r.getCoordinates()),t=this._ocaMap.get(e);return t};je.prototype.add=function(r){this._edges.add(r);var e=new pr(r.getCoordinates());this._ocaMap.put(e,r)};je.prototype.interfaces_=function(){return[]};je.prototype.getClass=function(){return je};var Ar=function(){};Ar.prototype.processIntersections=function(r,e,t,n){};Ar.prototype.isDone=function(){};Ar.prototype.interfaces_=function(){return[]};Ar.prototype.getClass=function(){return Ar};var Pe=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var r=arguments[0];this._li=r};Pe.prototype.isTrivialIntersection=function(r,e,t,n){if(r===t&&this._li.getIntersectionNum()===1){if(Pe.isAdjacentSegments(e,n))return!0;if(r.isClosed()){var o=r.size()-1;if(e===0&&n===o||n===0&&e===o)return!0}}return!1};Pe.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Pe.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Pe.prototype.getLineIntersector=function(){return this._li};Pe.prototype.hasProperIntersection=function(){return this._hasProper};Pe.prototype.processIntersections=function(r,e,t,n){if(r===t&&e===n)return null;this.numTests++;var o=r.getCoordinates()[e],a=r.getCoordinates()[e+1],l=t.getCoordinates()[n],s=t.getCoordinates()[n+1];this._li.computeIntersection(o,a,l,s),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(r,e,t,n)||(this._hasIntersection=!0,r.addIntersections(this._li,e,0),t.addIntersections(this._li,n,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))};Pe.prototype.hasIntersection=function(){return this._hasIntersection};Pe.prototype.isDone=function(){return!1};Pe.prototype.hasInteriorIntersection=function(){return this._hasInterior};Pe.prototype.interfaces_=function(){return[Ar]};Pe.prototype.getClass=function(){return Pe};Pe.isAdjacentSegments=function(r,e){return Math.abs(r-e)===1};var pn=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var r=arguments[0],e=arguments[1],t=arguments[2];this.coord=new d(r),this.segmentIndex=e,this.dist=t};pn.prototype.getSegmentIndex=function(){return this.segmentIndex};pn.prototype.getCoordinate=function(){return this.coord};pn.prototype.print=function(r){r.print(this.coord),r.print(" seg # = "+this.segmentIndex),r.println(" dist = "+this.dist)};pn.prototype.compareTo=function(r){var e=r;return this.compare(e.segmentIndex,e.dist)};pn.prototype.isEndPoint=function(r){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===r};pn.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist};pn.prototype.getDistance=function(){return this.dist};pn.prototype.compare=function(r,e){return this.segmentIndex<r?-1:this.segmentIndex>r?1:this.dist<e?-1:this.dist>e?1:0};pn.prototype.interfaces_=function(){return[ke]};pn.prototype.getClass=function(){return pn};var On=function(){this._nodeMap=new Kt,this.edge=null;var r=arguments[0];this.edge=r};On.prototype.print=function(r){r.println("Intersections:");for(var e=this.iterator();e.hasNext();){var t=e.next();t.print(r)}};On.prototype.iterator=function(){return this._nodeMap.values().iterator()};On.prototype.addSplitEdges=function(r){var e=this;this.addEndpoints();for(var t=this.iterator(),n=t.next();t.hasNext();){var o=t.next(),a=e.createSplitEdge(n,o);r.add(a),n=o}};On.prototype.addEndpoints=function(){var r=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[r],r,0)};On.prototype.createSplitEdge=function(r,e){var t=this,n=e.segmentIndex-r.segmentIndex+2,o=this.edge.pts[e.segmentIndex],a=e.dist>0||!e.coord.equals2D(o);a||n--;var l=new Array(n).fill(null),s=0;l[s++]=new d(r.coord);for(var m=r.segmentIndex+1;m<=e.segmentIndex;m++)l[s++]=t.edge.pts[m];return a&&(l[s]=e.coord),new Xo(l,new et(this.edge._label))};On.prototype.add=function(r,e,t){var n=new pn(r,e,t),o=this._nodeMap.get(n);return o!==null?o:(this._nodeMap.put(n,n),n)};On.prototype.isIntersection=function(r){for(var e=this.iterator();e.hasNext();){var t=e.next();if(t.coord.equals(r))return!0}return!1};On.prototype.interfaces_=function(){return[]};On.prototype.getClass=function(){return On};var Fr=function(){};Fr.prototype.getChainStartIndices=function(r){var e=this,t=0,n=new O;n.add(new un(t));do{var o=e.findChainEnd(r,t);n.add(new un(o)),t=o}while(t<r.length-1);var a=Fr.toIntArray(n);return a};Fr.prototype.findChainEnd=function(r,e){for(var t=rt.quadrant(r[e],r[e+1]),n=e+1;n<r.length;){var o=rt.quadrant(r[n-1],r[n]);if(o!==t)break;n++}return n-1};Fr.prototype.interfaces_=function(){return[]};Fr.prototype.getClass=function(){return Fr};Fr.toIntArray=function(r){for(var e=new Array(r.size()).fill(null),t=0;t<e.length;t++)e[t]=r.get(t).intValue();return e};var tr=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new B,this.env2=new B;var r=arguments[0];this.e=r,this.pts=r.getCoordinates();var e=new Fr;this.startIndex=e.getChainStartIndices(this.pts)};tr.prototype.getCoordinates=function(){return this.pts};tr.prototype.getMaxX=function(r){var e=this.pts[this.startIndex[r]].x,t=this.pts[this.startIndex[r+1]].x;return e>t?e:t};tr.prototype.getMinX=function(r){var e=this.pts[this.startIndex[r]].x,t=this.pts[this.startIndex[r+1]].x;return e<t?e:t};tr.prototype.computeIntersectsForChain=function(){if(arguments.length===4){var r=arguments[0],e=arguments[1],t=arguments[2],n=arguments[3];this.computeIntersectsForChain(this.startIndex[r],this.startIndex[r+1],e,e.startIndex[t],e.startIndex[t+1],n)}else if(arguments.length===6){var o=arguments[0],a=arguments[1],l=arguments[2],s=arguments[3],m=arguments[4],y=arguments[5],D=this.pts[o],W=this.pts[a],Ee=l.pts[s],dt=l.pts[m];if(a-o===1&&m-s===1)return y.addIntersections(this.e,o,l.e,s),null;if(this.env1.init(D,W),this.env2.init(Ee,dt),!this.env1.intersects(this.env2))return null;var Ht=Math.trunc((o+a)/2),ir=Math.trunc((s+m)/2);o<Ht&&(s<ir&&this.computeIntersectsForChain(o,Ht,l,s,ir,y),ir<m&&this.computeIntersectsForChain(o,Ht,l,ir,m,y)),Ht<a&&(s<ir&&this.computeIntersectsForChain(Ht,a,l,s,ir,y),ir<m&&this.computeIntersectsForChain(Ht,a,l,ir,m,y))}};tr.prototype.getStartIndexes=function(){return this.startIndex};tr.prototype.computeIntersects=function(r,e){for(var t=this,n=0;n<this.startIndex.length-1;n++)for(var o=0;o<r.startIndex.length-1;o++)t.computeIntersectsForChain(n,r,o,e)};tr.prototype.interfaces_=function(){return[]};tr.prototype.getClass=function(){return tr};var Ut=function r(){var e=this;this._depth=Array(2).fill().map(function(){return Array(3)});for(var t=0;t<2;t++)for(var n=0;n<3;n++)e._depth[t][n]=r.NULL_VALUE},Ou={NULL_VALUE:{configurable:!0}};Ut.prototype.getDepth=function(r,e){return this._depth[r][e]};Ut.prototype.setDepth=function(r,e,t){this._depth[r][e]=t};Ut.prototype.isNull=function(){var r=this;if(arguments.length===0){for(var e=0;e<2;e++)for(var t=0;t<3;t++)if(r._depth[e][t]!==Ut.NULL_VALUE)return!1;return!0}else if(arguments.length===1){var n=arguments[0];return this._depth[n][1]===Ut.NULL_VALUE}else if(arguments.length===2){var o=arguments[0],a=arguments[1];return this._depth[o][a]===Ut.NULL_VALUE}};Ut.prototype.normalize=function(){for(var r=this,e=0;e<2;e++)if(!r.isNull(e)){var t=r._depth[e][1];r._depth[e][2]<t&&(t=r._depth[e][2]),t<0&&(t=0);for(var n=1;n<3;n++){var o=0;r._depth[e][n]>t&&(o=1),r._depth[e][n]=o}}};Ut.prototype.getDelta=function(r){return this._depth[r][b.RIGHT]-this._depth[r][b.LEFT]};Ut.prototype.getLocation=function(r,e){return this._depth[r][e]<=0?E.EXTERIOR:E.INTERIOR};Ut.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]};Ut.prototype.add=function(){var r=this;if(arguments.length===1)for(var e=arguments[0],t=0;t<2;t++)for(var n=1;n<3;n++){var o=e.getLocation(t,n);(o===E.EXTERIOR||o===E.INTERIOR)&&(r.isNull(t,n)?r._depth[t][n]=Ut.depthAtLocation(o):r._depth[t][n]+=Ut.depthAtLocation(o))}else if(arguments.length===3){var a=arguments[0],l=arguments[1],s=arguments[2];s===E.INTERIOR&&this._depth[a][l]++}};Ut.prototype.interfaces_=function(){return[]};Ut.prototype.getClass=function(){return Ut};Ut.depthAtLocation=function(r){return r===E.EXTERIOR?0:r===E.INTERIOR?1:Ut.NULL_VALUE};Ou.NULL_VALUE.get=function(){return-1};Object.defineProperties(Ut,Ou);var Xo=function(r){function e(){if(r.call(this),this.pts=null,this._env=null,this.eiList=new On(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Ut,this._depthDelta=0,arguments.length===1){var t=arguments[0];e.call(this,t,null)}else if(arguments.length===2){var n=arguments[0],o=arguments[1];this.pts=n,this._label=o}}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.getDepth=function(){return this._depth},e.prototype.getCollapsedEdge=function(){var t=new Array(2).fill(null);t[0]=this.pts[0],t[1]=this.pts[1];var n=new e(t,et.toLineLabel(this._label));return n},e.prototype.isIsolated=function(){return this._isIsolated},e.prototype.getCoordinates=function(){return this.pts},e.prototype.setIsolated=function(t){this._isIsolated=t},e.prototype.setName=function(t){this._name=t},e.prototype.equals=function(t){var n=this;if(!(t instanceof e))return!1;var o=t;if(this.pts.length!==o.pts.length)return!1;for(var a=!0,l=!0,s=this.pts.length,m=0;m<this.pts.length;m++)if(n.pts[m].equals2D(o.pts[m])||(a=!1),n.pts[m].equals2D(o.pts[--s])||(l=!1),!a&&!l)return!1;return!0},e.prototype.getCoordinate=function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var t=arguments[0];return this.pts[t]}},e.prototype.print=function(t){var n=this;t.print("edge "+this._name+": "),t.print("LINESTRING (");for(var o=0;o<this.pts.length;o++)o>0&&t.print(","),t.print(n.pts[o].x+" "+n.pts[o].y);t.print(")  "+this._label+" "+this._depthDelta)},e.prototype.computeIM=function(t){e.updateIM(this._label,t)},e.prototype.isCollapsed=function(){return!this._label.isArea()||this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2])},e.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},e.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},e.prototype.getDepthDelta=function(){return this._depthDelta},e.prototype.getNumPoints=function(){return this.pts.length},e.prototype.printReverse=function(t){var n=this;t.print("edge "+this._name+": ");for(var o=this.pts.length-1;o>=0;o--)t.print(n.pts[o]+" ");t.println("")},e.prototype.getMonotoneChainEdge=function(){return this._mce===null&&(this._mce=new tr(this)),this._mce},e.prototype.getEnvelope=function(){var t=this;if(this._env===null){this._env=new B;for(var n=0;n<this.pts.length;n++)t._env.expandToInclude(t.pts[n])}return this._env},e.prototype.addIntersection=function(t,n,o,a){var l=new d(t.getIntersection(a)),s=n,m=t.getEdgeDistance(o,a),y=s+1;if(y<this.pts.length){var D=this.pts[y];l.equals2D(D)&&(s=y,m=0)}this.eiList.add(l,s,m)},e.prototype.toString=function(){var t=this,n=new _n;n.append("edge "+this._name+": "),n.append("LINESTRING (");for(var o=0;o<this.pts.length;o++)o>0&&n.append(","),n.append(t.pts[o].x+" "+t.pts[o].y);return n.append(")  "+this._label+" "+this._depthDelta),n.toString()},e.prototype.isPointwiseEqual=function(t){var n=this;if(this.pts.length!==t.pts.length)return!1;for(var o=0;o<this.pts.length;o++)if(!n.pts[o].equals2D(t.pts[o]))return!1;return!0},e.prototype.setDepthDelta=function(t){this._depthDelta=t},e.prototype.getEdgeIntersectionList=function(){return this.eiList},e.prototype.addIntersections=function(t,n,o){for(var a=this,l=0;l<t.getIntersectionNum();l++)a.addIntersection(t,n,o,l)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.updateIM=function(){if(arguments.length===2){var t=arguments[0],n=arguments[1];n.setAtLeastIfValid(t.getLocation(0,b.ON),t.getLocation(1,b.ON),1),t.isArea()&&(n.setAtLeastIfValid(t.getLocation(0,b.LEFT),t.getLocation(1,b.LEFT),2),n.setAtLeastIfValid(t.getLocation(0,b.RIGHT),t.getLocation(1,b.RIGHT),2))}else return r.prototype.updateIM.apply(this,arguments)},e}(Le),re=function(r){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new je,this._bufParams=r||null};re.prototype.setWorkingPrecisionModel=function(r){this._workingPrecisionModel=r};re.prototype.insertUniqueEdge=function(r){var e=this._edgeList.findEqualEdge(r);if(e!==null){var t=e.getLabel(),n=r.getLabel();e.isPointwiseEqual(r)||(n=new et(r.getLabel()),n.flip()),t.merge(n);var o=re.depthDelta(n),a=e.getDepthDelta(),l=a+o;e.setDepthDelta(l)}else this._edgeList.add(r),r.setDepthDelta(re.depthDelta(r.getLabel()))};re.prototype.buildSubgraphs=function(r,e){for(var t=new O,n=r.iterator();n.hasNext();){var o=n.next(),a=o.getRightmostCoordinate(),l=new ti(t),s=l.getDepth(a);o.computeDepth(s),o.findResultEdges(),t.add(o),e.add(o.getDirectedEdges(),o.getNodes())}};re.prototype.createSubgraphs=function(r){for(var e=new O,t=r.getNodes().iterator();t.hasNext();){var n=t.next();if(!n.isVisited()){var o=new oe;o.create(n),e.add(o)}}return He.sort(e,He.reverseOrder()),e};re.prototype.createEmptyResultGeometry=function(){var r=this._geomFact.createPolygon();return r};re.prototype.getNoder=function(r){if(this._workingNoder!==null)return this._workingNoder;var e=new Qs,t=new Xr;return t.setPrecisionModel(r),e.setSegmentIntersector(new Pe(t)),e};re.prototype.buffer=function(r,e){var t=this._workingPrecisionModel;t===null&&(t=r.getPrecisionModel()),this._geomFact=r.getFactory();var n=new fe(t,this._bufParams),o=new Be(r,e,n),a=o.getCurves();if(a.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(a,t),this._graph=new pt(new Ru),this._graph.addEdges(this._edgeList.getEdges());var l=this.createSubgraphs(this._graph),s=new ve(this._geomFact);this.buildSubgraphs(l,s);var m=s.getPolygons();if(m.size()<=0)return this.createEmptyResultGeometry();var y=this._geomFact.buildGeometry(m);return y};re.prototype.computeNodedEdges=function(r,e){var t=this,n=this.getNoder(e);n.computeNodes(r);for(var o=n.getNodedSubstrings(),a=o.iterator();a.hasNext();){var l=a.next(),s=l.getCoordinates();if(!(s.length===2&&s[0].equals2D(s[1]))){var m=l.getData(),y=new Xo(l.getCoordinates(),new et(m));t.insertUniqueEdge(y)}}};re.prototype.setNoder=function(r){this._workingNoder=r};re.prototype.interfaces_=function(){return[]};re.prototype.getClass=function(){return re};re.depthDelta=function(r){var e=r.getLocation(0,b.LEFT),t=r.getLocation(0,b.RIGHT);return e===E.INTERIOR&&t===E.EXTERIOR?1:e===E.EXTERIOR&&t===E.INTERIOR?-1:0};re.convertSegStrings=function(r){for(var e=new H,t=new O;r.hasNext();){var n=r.next(),o=e.createLineString(n.getCoordinates());t.add(o)}return e.buildGeometry(t)};var dr=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var r=arguments[0],e=arguments[1];this._noder=r,this._scaleFactor=e,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(arguments.length===4){var t=arguments[0],n=arguments[1],o=arguments[2],a=arguments[3];this._noder=t,this._scaleFactor=n,this._offsetX=o,this._offsetY=a,this._isScaled=!this.isIntegerPrecision()}};dr.prototype.rescale=function(){var r=this;if(V(arguments[0],Lt))for(var e=arguments[0],t=e.iterator();t.hasNext();){var n=t.next();r.rescale(n.getCoordinates())}else if(arguments[0]instanceof Array){for(var o=arguments[0],a=0;a<o.length;a++)o[a].x=o[a].x/r._scaleFactor+r._offsetX,o[a].y=o[a].y/r._scaleFactor+r._offsetY;o.length===2&&o[0].equals2D(o[1])&&qt.out.println(o)}};dr.prototype.scale=function(){var r=this;if(V(arguments[0],Lt)){for(var e=arguments[0],t=new O,n=e.iterator();n.hasNext();){var o=n.next();t.add(new Nt(r.scale(o.getCoordinates()),o.getData()))}return t}else if(arguments[0]instanceof Array){for(var a=arguments[0],l=new Array(a.length).fill(null),s=0;s<a.length;s++)l[s]=new d(Math.round((a[s].x-r._offsetX)*r._scaleFactor),Math.round((a[s].y-r._offsetY)*r._scaleFactor),a[s].z);var m=j.removeRepeatedPoints(l);return m}};dr.prototype.isIntegerPrecision=function(){return this._scaleFactor===1};dr.prototype.getNodedSubstrings=function(){var r=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(r),r};dr.prototype.computeNodes=function(r){var e=r;this._isScaled&&(e=this.scale(r)),this._noder.computeNodes(e)};dr.prototype.interfaces_=function(){return[Dr]};dr.prototype.getClass=function(){return dr};var dn=function(){this._li=new Xr,this._segStrings=null;var r=arguments[0];this._segStrings=r},Tu={fact:{configurable:!0}};dn.prototype.checkEndPtVertexIntersections=function(){var r=this;if(arguments.length===0)for(var e=this._segStrings.iterator();e.hasNext();){var t=e.next(),n=t.getCoordinates();r.checkEndPtVertexIntersections(n[0],r._segStrings),r.checkEndPtVertexIntersections(n[n.length-1],r._segStrings)}else if(arguments.length===2){for(var o=arguments[0],a=arguments[1],l=a.iterator();l.hasNext();)for(var s=l.next(),m=s.getCoordinates(),y=1;y<m.length-1;y++)if(m[y].equals(o))throw new Qn("found endpt/interior pt intersection at index "+y+" :pt "+o)}};dn.prototype.checkInteriorIntersections=function(){var r=this;if(arguments.length===0)for(var e=this._segStrings.iterator();e.hasNext();)for(var t=e.next(),n=this._segStrings.iterator();n.hasNext();){var o=n.next();r.checkInteriorIntersections(t,o)}else if(arguments.length===2)for(var a=arguments[0],l=arguments[1],s=a.getCoordinates(),m=l.getCoordinates(),y=0;y<s.length-1;y++)for(var D=0;D<m.length-1;D++)r.checkInteriorIntersections(a,y,l,D);else if(arguments.length===4){var W=arguments[0],Ee=arguments[1],dt=arguments[2],Ht=arguments[3];if(W===dt&&Ee===Ht)return null;var ir=W.getCoordinates()[Ee],Hr=W.getCoordinates()[Ee+1],Bn=dt.getCoordinates()[Ht],Vn=dt.getCoordinates()[Ht+1];if(this._li.computeIntersection(ir,Hr,Bn,Vn),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,ir,Hr)||this.hasInteriorIntersection(this._li,Bn,Vn)))throw new Qn("found non-noded intersection at "+ir+"-"+Hr+" and "+Bn+"-"+Vn)}};dn.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()};dn.prototype.checkCollapses=function(){var r=this;if(arguments.length===0)for(var e=this._segStrings.iterator();e.hasNext();){var t=e.next();r.checkCollapses(t)}else if(arguments.length===1)for(var n=arguments[0],o=n.getCoordinates(),a=0;a<o.length-2;a++)r.checkCollapse(o[a],o[a+1],o[a+2])};dn.prototype.hasInteriorIntersection=function(r,e,t){for(var n=0;n<r.getIntersectionNum();n++){var o=r.getIntersection(n);if(!(o.equals(e)||o.equals(t)))return!0}return!1};dn.prototype.checkCollapse=function(r,e,t){if(r.equals(t))throw new Qn("found non-noded collapse at "+dn.fact.createLineString([r,e,t]))};dn.prototype.interfaces_=function(){return[]};dn.prototype.getClass=function(){return dn};Tu.fact.get=function(){return new H};Object.defineProperties(dn,Tu);var he=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var r=arguments[0],e=arguments[1],t=arguments[2];if(this._originalPt=r,this._pt=r,this._scaleFactor=e,this._li=t,e<=0)throw new ft("Scale factor must be non-zero");e!==1&&(this._pt=new d(this.scale(r.x),this.scale(r.y)),this._p0Scaled=new d,this._p1Scaled=new d),this.initCorners(this._pt)},Du={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};he.prototype.intersectsScaled=function(r,e){var t=Math.min(r.x,e.x),n=Math.max(r.x,e.x),o=Math.min(r.y,e.y),a=Math.max(r.y,e.y),l=this._maxx<t||this._minx>n||this._maxy<o||this._miny>a;if(l)return!1;var s=this.intersectsToleranceSquare(r,e);return q.isTrue(!(l&&s),"Found bad envelope test"),s};he.prototype.initCorners=function(r){var e=.5;this._minx=r.x-e,this._maxx=r.x+e,this._miny=r.y-e,this._maxy=r.y+e,this._corner[0]=new d(this._maxx,this._maxy),this._corner[1]=new d(this._minx,this._maxy),this._corner[2]=new d(this._minx,this._miny),this._corner[3]=new d(this._maxx,this._miny)};he.prototype.intersects=function(r,e){return this._scaleFactor===1?this.intersectsScaled(r,e):(this.copyScaled(r,this._p0Scaled),this.copyScaled(e,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))};he.prototype.scale=function(r){return Math.round(r*this._scaleFactor)};he.prototype.getCoordinate=function(){return this._originalPt};he.prototype.copyScaled=function(r,e){e.x=this.scale(r.x),e.y=this.scale(r.y)};he.prototype.getSafeEnvelope=function(){if(this._safeEnv===null){var r=he.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new B(this._originalPt.x-r,this._originalPt.x+r,this._originalPt.y-r,this._originalPt.y+r)}return this._safeEnv};he.prototype.intersectsPixelClosure=function(r,e){return this._li.computeIntersection(r,e,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(r,e,this._corner[1],this._corner[2]),this._li.hasIntersection())||(this._li.computeIntersection(r,e,this._corner[2],this._corner[3]),this._li.hasIntersection())||(this._li.computeIntersection(r,e,this._corner[3],this._corner[0]),this._li.hasIntersection()))};he.prototype.intersectsToleranceSquare=function(r,e){var t=!1,n=!1;return this._li.computeIntersection(r,e,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(r,e,this._corner[1],this._corner[2]),this._li.isProper())||(this._li.hasIntersection()&&(t=!0),this._li.computeIntersection(r,e,this._corner[2],this._corner[3]),this._li.isProper())||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(r,e,this._corner[3],this._corner[0]),this._li.isProper())||t&&n||r.equals(this._pt)||e.equals(this._pt))};he.prototype.addSnappedNode=function(r,e){var t=r.getCoordinate(e),n=r.getCoordinate(e+1);return this.intersects(t,n)?(r.addIntersection(this.getCoordinate(),e),!0):!1};he.prototype.interfaces_=function(){return[]};he.prototype.getClass=function(){return he};Du.SAFE_ENV_EXPANSION_FACTOR.get=function(){return .75};Object.defineProperties(he,Du);var go=function(){this.tempEnv1=new B,this.selectedSegment=new k};go.prototype.select=function(){if(arguments.length!==1&&arguments.length===2){var r=arguments[0],e=arguments[1];r.getLineSegment(e,this.selectedSegment),this.select(this.selectedSegment)}};go.prototype.interfaces_=function(){return[]};go.prototype.getClass=function(){return go};var Mi=function(){this._index=null;var r=arguments[0];this._index=r},Mu={HotPixelSnapAction:{configurable:!0}};Mi.prototype.snap=function(){if(arguments.length===1){var r=arguments[0];return this.snap(r,null,-1)}else if(arguments.length===3){var e=arguments[0],t=arguments[1],n=arguments[2],o=e.getSafeEnvelope(),a=new Au(e,t,n);return this._index.query(o,{interfaces_:function(){return[hr]},visitItem:function(l){var s=l;s.select(o,a)}}),a.isNodeAdded()}};Mi.prototype.interfaces_=function(){return[]};Mi.prototype.getClass=function(){return Mi};Mu.HotPixelSnapAction.get=function(){return Au};Object.defineProperties(Mi,Mu);var Au=function(r){function e(){r.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var t=arguments[0],n=arguments[1],o=arguments[2];this._hotPixel=t,this._parentEdge=n,this._hotPixelVertexIndex=o}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.isNodeAdded=function(){return this._isNodeAdded},e.prototype.select=function(){if(arguments.length===2){var t=arguments[0],n=arguments[1],o=t.getContext();if(this._parentEdge!==null&&o===this._parentEdge&&n===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(o,n)}else return r.prototype.select.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(go),ei=function(){this._li=null,this._interiorIntersections=null;var r=arguments[0];this._li=r,this._interiorIntersections=new O};ei.prototype.processIntersections=function(r,e,t,n){var o=this;if(r===t&&e===n)return null;var a=r.getCoordinates()[e],l=r.getCoordinates()[e+1],s=t.getCoordinates()[n],m=t.getCoordinates()[n+1];if(this._li.computeIntersection(a,l,s,m),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var y=0;y<this._li.getIntersectionNum();y++)o._interiorIntersections.add(o._li.getIntersection(y));r.addIntersections(this._li,e,0),t.addIntersections(this._li,n,1)}};ei.prototype.isDone=function(){return!1};ei.prototype.getInteriorIntersections=function(){return this._interiorIntersections};ei.prototype.interfaces_=function(){return[Ar]};ei.prototype.getClass=function(){return ei};var Tn=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var r=arguments[0];this._pm=r,this._li=new Xr,this._li.setPrecisionModel(r),this._scaleFactor=r.getScale()};Tn.prototype.checkCorrectness=function(r){var e=Nt.getNodedSubstrings(r),t=new dn(e);try{t.checkValid()}catch(n){if(n instanceof mu)n.printStackTrace();else throw n}finally{}};Tn.prototype.getNodedSubstrings=function(){return Nt.getNodedSubstrings(this._nodedSegStrings)};Tn.prototype.snapRound=function(r,e){var t=this.findInteriorIntersections(r,e);this.computeIntersectionSnaps(t),this.computeVertexSnaps(r)};Tn.prototype.findInteriorIntersections=function(r,e){var t=new ei(e);return this._noder.setSegmentIntersector(t),this._noder.computeNodes(r),t.getInteriorIntersections()};Tn.prototype.computeVertexSnaps=function(){var r=this;if(V(arguments[0],Lt))for(var e=arguments[0],t=e.iterator();t.hasNext();){var n=t.next();r.computeVertexSnaps(n)}else if(arguments[0]instanceof Nt)for(var o=arguments[0],a=o.getCoordinates(),l=0;l<a.length;l++){var s=new he(a[l],r._scaleFactor,r._li),m=r._pointSnapper.snap(s,o,l);m&&o.addIntersection(a[l],l)}};Tn.prototype.computeNodes=function(r){this._nodedSegStrings=r,this._noder=new Qs,this._pointSnapper=new Mi(this._noder.getIndex()),this.snapRound(r,this._li)};Tn.prototype.computeIntersectionSnaps=function(r){for(var e=this,t=r.iterator();t.hasNext();){var n=t.next(),o=new he(n,e._scaleFactor,e._li);e._pointSnapper.snap(o)}};Tn.prototype.interfaces_=function(){return[Dr]};Tn.prototype.getClass=function(){return Tn};var zt=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new J,this._resultGeometry=null,this._saveException=null,arguments.length===1){var r=arguments[0];this._argGeom=r}else if(arguments.length===2){var e=arguments[0],t=arguments[1];this._argGeom=e,this._bufParams=t}},Wi={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};zt.prototype.bufferFixedPrecision=function(r){var e=new dr(new Tn(new $(1)),r.getScale()),t=new re(this._bufParams);t.setWorkingPrecisionModel(r),t.setNoder(e),this._resultGeometry=t.buffer(this._argGeom,this._distance)};zt.prototype.bufferReducedPrecision=function(){var r=this;if(arguments.length===0){for(var e=zt.MAX_PRECISION_DIGITS;e>=0;e--){try{r.bufferReducedPrecision(e)}catch(a){if(a instanceof Jn)r._saveException=a;else throw a}finally{}if(r._resultGeometry!==null)return null}throw this._saveException}else if(arguments.length===1){var t=arguments[0],n=zt.precisionScaleFactor(this._argGeom,this._distance,t),o=new $(n);this.bufferFixedPrecision(o)}};zt.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var r=this._argGeom.getFactory().getPrecisionModel();r.getType()===$.FIXED?this.bufferFixedPrecision(r):this.bufferReducedPrecision()};zt.prototype.setQuadrantSegments=function(r){this._bufParams.setQuadrantSegments(r)};zt.prototype.bufferOriginalPrecision=function(){try{var r=new re(this._bufParams);this._resultGeometry=r.buffer(this._argGeom,this._distance)}catch(e){if(e instanceof Qn)this._saveException=e;else throw e}finally{}};zt.prototype.getResultGeometry=function(r){return this._distance=r,this.computeGeometry(),this._resultGeometry};zt.prototype.setEndCapStyle=function(r){this._bufParams.setEndCapStyle(r)};zt.prototype.interfaces_=function(){return[]};zt.prototype.getClass=function(){return zt};zt.bufferOp=function(){if(arguments.length===2){var r=arguments[0],e=arguments[1],t=new zt(r),n=t.getResultGeometry(e);return n}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof G&&typeof arguments[1]=="number"){var o=arguments[0],a=arguments[1],l=arguments[2],s=new zt(o);s.setQuadrantSegments(l);var m=s.getResultGeometry(a);return m}else if(arguments[2]instanceof J&&arguments[0]instanceof G&&typeof arguments[1]=="number"){var y=arguments[0],D=arguments[1],W=arguments[2],Ee=new zt(y,W),dt=Ee.getResultGeometry(D);return dt}}else if(arguments.length===4){var Ht=arguments[0],ir=arguments[1],Hr=arguments[2],Bn=arguments[3],Vn=new zt(Ht);Vn.setQuadrantSegments(Hr),Vn.setEndCapStyle(Bn);var Wr=Vn.getResultGeometry(ir);return Wr}};zt.precisionScaleFactor=function(r,e,t){var n=r.getEnvelopeInternal(),o=we.max(Math.abs(n.getMaxX()),Math.abs(n.getMaxY()),Math.abs(n.getMinX()),Math.abs(n.getMinY())),a=e>0?e:0,l=o+2*a,s=Math.trunc(Math.log(l)/Math.log(10)+1),m=t-s,y=Math.pow(10,m);return y};Wi.CAP_ROUND.get=function(){return J.CAP_ROUND};Wi.CAP_BUTT.get=function(){return J.CAP_FLAT};Wi.CAP_FLAT.get=function(){return J.CAP_FLAT};Wi.CAP_SQUARE.get=function(){return J.CAP_SQUARE};Wi.MAX_PRECISION_DIGITS.get=function(){return 12};Object.defineProperties(zt,Wi);var te=function(){this._pt=[new d,new d],this._distance=z.NaN,this._isNull=!0};te.prototype.getCoordinates=function(){return this._pt};te.prototype.getCoordinate=function(r){return this._pt[r]};te.prototype.setMinimum=function(){if(arguments.length===1){var r=arguments[0];this.setMinimum(r._pt[0],r._pt[1])}else if(arguments.length===2){var e=arguments[0],t=arguments[1];if(this._isNull)return this.initialize(e,t),null;var n=e.distance(t);n<this._distance&&this.initialize(e,t,n)}};te.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var r=arguments[0],e=arguments[1];this._pt[0].setCoordinate(r),this._pt[1].setCoordinate(e),this._distance=r.distance(e),this._isNull=!1}else if(arguments.length===3){var t=arguments[0],n=arguments[1],o=arguments[2];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(n),this._distance=o,this._isNull=!1}};te.prototype.getDistance=function(){return this._distance};te.prototype.setMaximum=function(){if(arguments.length===1){var r=arguments[0];this.setMaximum(r._pt[0],r._pt[1])}else if(arguments.length===2){var e=arguments[0],t=arguments[1];if(this._isNull)return this.initialize(e,t),null;var n=e.distance(t);n>this._distance&&this.initialize(e,t,n)}};te.prototype.interfaces_=function(){return[]};te.prototype.getClass=function(){return te};var Nn=function(){};Nn.prototype.interfaces_=function(){return[]};Nn.prototype.getClass=function(){return Nn};Nn.computeDistance=function(){if(arguments[2]instanceof te&&arguments[0]instanceof yt&&arguments[1]instanceof d)for(var r=arguments[0],e=arguments[1],t=arguments[2],n=r.getCoordinates(),o=new k,a=0;a<n.length-1;a++){o.setCoordinates(n[a],n[a+1]);var l=o.closestPoint(e);t.setMinimum(l,e)}else if(arguments[2]instanceof te&&arguments[0]instanceof Ot&&arguments[1]instanceof d){var s=arguments[0],m=arguments[1],y=arguments[2];Nn.computeDistance(s.getExteriorRing(),m,y);for(var D=0;D<s.getNumInteriorRing();D++)Nn.computeDistance(s.getInteriorRingN(D),m,y)}else if(arguments[2]instanceof te&&arguments[0]instanceof G&&arguments[1]instanceof d){var W=arguments[0],Ee=arguments[1],dt=arguments[2];if(W instanceof yt)Nn.computeDistance(W,Ee,dt);else if(W instanceof Ot)Nn.computeDistance(W,Ee,dt);else if(W instanceof ie)for(var Ht=W,ir=0;ir<Ht.getNumGeometries();ir++){var Hr=Ht.getGeometryN(ir);Nn.computeDistance(Hr,Ee,dt)}else dt.setMinimum(W.getCoordinate(),Ee)}else if(arguments[2]instanceof te&&arguments[0]instanceof k&&arguments[1]instanceof d){var Bn=arguments[0],Vn=arguments[1],Wr=arguments[2],ps=Bn.closestPoint(Vn);Wr.setMinimum(ps,Vn)}};var Br=function(r){this._maxPtDist=new te,this._inputGeom=r||null},Zs={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};Br.prototype.computeMaxMidpointDistance=function(r){var e=new vr(this._inputGeom);r.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())};Br.prototype.computeMaxVertexDistance=function(r){var e=new ni(this._inputGeom);r.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())};Br.prototype.findDistance=function(r){return this.computeMaxVertexDistance(r),this.computeMaxMidpointDistance(r),this._maxPtDist.getDistance()};Br.prototype.getDistancePoints=function(){return this._maxPtDist};Br.prototype.interfaces_=function(){return[]};Br.prototype.getClass=function(){return Br};Zs.MaxPointDistanceFilter.get=function(){return ni};Zs.MaxMidpointDistanceFilter.get=function(){return vr};Object.defineProperties(Br,Zs);var ni=function(r){this._maxPtDist=new te,this._minPtDist=new te,this._geom=r||null};ni.prototype.filter=function(r){this._minPtDist.initialize(),Nn.computeDistance(this._geom,r,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};ni.prototype.getMaxPointDistance=function(){return this._maxPtDist};ni.prototype.interfaces_=function(){return[Ln]};ni.prototype.getClass=function(){return ni};var vr=function(r){this._maxPtDist=new te,this._minPtDist=new te,this._geom=r||null};vr.prototype.filter=function(r,e){if(e===0)return null;var t=r.getCoordinate(e-1),n=r.getCoordinate(e),o=new d((t.x+n.x)/2,(t.y+n.y)/2);this._minPtDist.initialize(),Nn.computeDistance(this._geom,o,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};vr.prototype.isDone=function(){return!1};vr.prototype.isGeometryChanged=function(){return!1};vr.prototype.getMaxPointDistance=function(){return this._maxPtDist};vr.prototype.interfaces_=function(){return[Ye]};vr.prototype.getClass=function(){return vr};var jn=function(r){this._comps=r||null};jn.prototype.filter=function(r){r instanceof Ot&&this._comps.add(r)};jn.prototype.interfaces_=function(){return[cn]};jn.prototype.getClass=function(){return jn};jn.getPolygons=function(){if(arguments.length===1){var r=arguments[0];return jn.getPolygons(r,new O)}else if(arguments.length===2){var e=arguments[0],t=arguments[1];return e instanceof Ot?t.add(e):e instanceof ie&&e.apply(new jn(t)),t}};var Vt=function(){if(this._lines=null,this._isForcedToLineString=!1,arguments.length===1){var r=arguments[0];this._lines=r}else if(arguments.length===2){var e=arguments[0],t=arguments[1];this._lines=e,this._isForcedToLineString=t}};Vt.prototype.filter=function(r){if(this._isForcedToLineString&&r instanceof bn){var e=r.getFactory().createLineString(r.getCoordinateSequence());return this._lines.add(e),null}r instanceof yt&&this._lines.add(r)};Vt.prototype.setForceToLineString=function(r){this._isForcedToLineString=r};Vt.prototype.interfaces_=function(){return[Zn]};Vt.prototype.getClass=function(){return Vt};Vt.getGeometry=function(){if(arguments.length===1){var r=arguments[0];return r.getFactory().buildGeometry(Vt.getLines(r))}else if(arguments.length===2){var e=arguments[0],t=arguments[1];return e.getFactory().buildGeometry(Vt.getLines(e,t))}};Vt.getLines=function(){if(arguments.length===1){var r=arguments[0];return Vt.getLines(r,!1)}else if(arguments.length===2){if(V(arguments[0],Lt)&&V(arguments[1],Lt)){for(var e=arguments[0],t=arguments[1],n=e.iterator();n.hasNext();){var o=n.next();Vt.getLines(o,t)}return t}else if(arguments[0]instanceof G&&typeof arguments[1]=="boolean"){var a=arguments[0],l=arguments[1],s=new O;return a.apply(new Vt(s,l)),s}else if(arguments[0]instanceof G&&V(arguments[1],Lt)){var m=arguments[0],y=arguments[1];return m instanceof yt?y.add(m):m.apply(new Vt(y)),y}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&V(arguments[0],Lt)&&V(arguments[1],Lt)){for(var D=arguments[0],W=arguments[1],Ee=arguments[2],dt=D.iterator();dt.hasNext();){var Ht=dt.next();Vt.getLines(Ht,W,Ee)}return W}else if(typeof arguments[2]=="boolean"&&arguments[0]instanceof G&&V(arguments[1],Lt)){var ir=arguments[0],Hr=arguments[1],Bn=arguments[2];return ir.apply(new Vt(Hr,Bn)),Hr}}};var Ke=function(){if(this._boundaryRule=Ae.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,arguments.length!==0&&arguments.length===1){var r=arguments[0];if(r===null)throw new ft("Rule must be non-null");this._boundaryRule=r}};Ke.prototype.locateInternal=function(){var r=this;if(arguments[0]instanceof d&&arguments[1]instanceof Ot){var e=arguments[0],t=arguments[1];if(t.isEmpty())return E.EXTERIOR;var n=t.getExteriorRing(),o=this.locateInPolygonRing(e,n);if(o===E.EXTERIOR)return E.EXTERIOR;if(o===E.BOUNDARY)return E.BOUNDARY;for(var a=0;a<t.getNumInteriorRing();a++){var l=t.getInteriorRingN(a),s=r.locateInPolygonRing(e,l);if(s===E.INTERIOR)return E.EXTERIOR;if(s===E.BOUNDARY)return E.BOUNDARY}return E.INTERIOR}else if(arguments[0]instanceof d&&arguments[1]instanceof yt){var m=arguments[0],y=arguments[1];if(!y.getEnvelopeInternal().intersects(m))return E.EXTERIOR;var D=y.getCoordinates();return!y.isClosed()&&(m.equals(D[0])||m.equals(D[D.length-1]))?E.BOUNDARY:M.isOnLine(m,D)?E.INTERIOR:E.EXTERIOR}else if(arguments[0]instanceof d&&arguments[1]instanceof de){var W=arguments[0],Ee=arguments[1],dt=Ee.getCoordinate();return dt.equals2D(W)?E.INTERIOR:E.EXTERIOR}};Ke.prototype.locateInPolygonRing=function(r,e){return e.getEnvelopeInternal().intersects(r)?M.locatePointInRing(r,e.getCoordinates()):E.EXTERIOR};Ke.prototype.intersects=function(r,e){return this.locate(r,e)!==E.EXTERIOR};Ke.prototype.updateLocationInfo=function(r){r===E.INTERIOR&&(this._isIn=!0),r===E.BOUNDARY&&this._numBoundaries++};Ke.prototype.computeLocation=function(r,e){var t=this;if(e instanceof de&&this.updateLocationInfo(this.locateInternal(r,e)),e instanceof yt)this.updateLocationInfo(this.locateInternal(r,e));else if(e instanceof Ot)this.updateLocationInfo(this.locateInternal(r,e));else if(e instanceof Tr)for(var n=e,o=0;o<n.getNumGeometries();o++){var a=n.getGeometryN(o);t.updateLocationInfo(t.locateInternal(r,a))}else if(e instanceof Sn)for(var l=e,s=0;s<l.getNumGeometries();s++){var m=l.getGeometryN(s);t.updateLocationInfo(t.locateInternal(r,m))}else if(e instanceof ie)for(var y=new wn(e);y.hasNext();){var D=y.next();D!==e&&t.computeLocation(r,D)}};Ke.prototype.locate=function(r,e){return e.isEmpty()?E.EXTERIOR:e instanceof yt?this.locateInternal(r,e):e instanceof Ot?this.locateInternal(r,e):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(r,e),this._boundaryRule.isInBoundary(this._numBoundaries)?E.BOUNDARY:this._numBoundaries>0||this._isIn?E.INTERIOR:E.EXTERIOR)};Ke.prototype.interfaces_=function(){return[]};Ke.prototype.getClass=function(){return Ke};var ee=function r(){if(this._component=null,this._segIndex=null,this._pt=null,arguments.length===2){var e=arguments[0],t=arguments[1];r.call(this,e,r.INSIDE_AREA,t)}else if(arguments.length===3){var n=arguments[0],o=arguments[1],a=arguments[2];this._component=n,this._segIndex=o,this._pt=a}},Fu={INSIDE_AREA:{configurable:!0}};ee.prototype.isInsideArea=function(){return this._segIndex===ee.INSIDE_AREA};ee.prototype.getCoordinate=function(){return this._pt};ee.prototype.getGeometryComponent=function(){return this._component};ee.prototype.getSegmentIndex=function(){return this._segIndex};ee.prototype.interfaces_=function(){return[]};ee.prototype.getClass=function(){return ee};Fu.INSIDE_AREA.get=function(){return-1};Object.defineProperties(ee,Fu);var ar=function(r){this._pts=r||null};ar.prototype.filter=function(r){r instanceof de&&this._pts.add(r)};ar.prototype.interfaces_=function(){return[cn]};ar.prototype.getClass=function(){return ar};ar.getPoints=function(){if(arguments.length===1){var r=arguments[0];return r instanceof de?He.singletonList(r):ar.getPoints(r,new O)}else if(arguments.length===2){var e=arguments[0],t=arguments[1];return e instanceof de?t.add(e):e instanceof ie&&e.apply(new ar(t)),t}};var ri=function(){this._locations=null;var r=arguments[0];this._locations=r};ri.prototype.filter=function(r){(r instanceof de||r instanceof yt||r instanceof Ot)&&this._locations.add(new ee(r,0,r.getCoordinate()))};ri.prototype.interfaces_=function(){return[cn]};ri.prototype.getClass=function(){return ri};ri.getLocations=function(r){var e=new O;return r.apply(new ri(e)),e};var Xt=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Ke,this._minDistanceLocation=null,this._minDistance=z.MAX_VALUE,arguments.length===2){var r=arguments[0],e=arguments[1];this._geom=[r,e],this._terminateDistance=0}else if(arguments.length===3){var t=arguments[0],n=arguments[1],o=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=t,this._geom[1]=n,this._terminateDistance=o}};Xt.prototype.computeContainmentDistance=function(){var r=this;if(arguments.length===0){var e=new Array(2).fill(null);if(this.computeContainmentDistance(0,e),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1],o=1-t,a=jn.getPolygons(this._geom[t]);if(a.size()>0){var l=ri.getLocations(this._geom[o]);if(this.computeContainmentDistance(l,a,n),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[o]=n[0],this._minDistanceLocation[t]=n[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&V(arguments[0],qe)&&V(arguments[1],qe)){for(var s=arguments[0],m=arguments[1],y=arguments[2],D=0;D<s.size();D++)for(var W=s.get(D),Ee=0;Ee<m.size();Ee++)if(r.computeContainmentDistance(W,m.get(Ee),y),r._minDistance<=r._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof ee&&arguments[1]instanceof Ot){var dt=arguments[0],Ht=arguments[1],ir=arguments[2],Hr=dt.getCoordinate();if(E.EXTERIOR!==this._ptLocator.locate(Hr,Ht))return this._minDistance=0,ir[0]=dt,ir[1]=new ee(Ht,Hr),null}}};Xt.prototype.computeMinDistanceLinesPoints=function(r,e,t){for(var n=this,o=0;o<r.size();o++)for(var a=r.get(o),l=0;l<e.size();l++){var s=e.get(l);if(n.computeMinDistance(a,s,t),n._minDistance<=n._terminateDistance)return null}};Xt.prototype.computeFacetDistance=function(){var r=new Array(2).fill(null),e=Vt.getLines(this._geom[0]),t=Vt.getLines(this._geom[1]),n=ar.getPoints(this._geom[0]),o=ar.getPoints(this._geom[1]);if(this.computeMinDistanceLines(e,t,r),this.updateMinDistance(r,!1),this._minDistance<=this._terminateDistance||(r[0]=null,r[1]=null,this.computeMinDistanceLinesPoints(e,o,r),this.updateMinDistance(r,!1),this._minDistance<=this._terminateDistance)||(r[0]=null,r[1]=null,this.computeMinDistanceLinesPoints(t,n,r),this.updateMinDistance(r,!0),this._minDistance<=this._terminateDistance))return null;r[0]=null,r[1]=null,this.computeMinDistancePoints(n,o,r),this.updateMinDistance(r,!1)};Xt.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation};Xt.prototype.updateMinDistance=function(r,e){if(r[0]===null)return null;e?(this._minDistanceLocation[0]=r[1],this._minDistanceLocation[1]=r[0]):(this._minDistanceLocation[0]=r[0],this._minDistanceLocation[1]=r[1])};Xt.prototype.nearestPoints=function(){this.computeMinDistance();var r=[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()];return r};Xt.prototype.computeMinDistance=function(){var r=this;if(arguments.length===0){if(this._minDistanceLocation!==null||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof yt&&arguments[1]instanceof de){var e=arguments[0],t=arguments[1],n=arguments[2];if(e.getEnvelopeInternal().distance(t.getEnvelopeInternal())>this._minDistance)return null;for(var o=e.getCoordinates(),a=t.getCoordinate(),l=0;l<o.length-1;l++){var s=M.distancePointLine(a,o[l],o[l+1]);if(s<r._minDistance){r._minDistance=s;var m=new k(o[l],o[l+1]),y=m.closestPoint(a);n[0]=new ee(e,l,y),n[1]=new ee(t,0,a)}if(r._minDistance<=r._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof yt&&arguments[1]instanceof yt){var D=arguments[0],W=arguments[1],Ee=arguments[2];if(D.getEnvelopeInternal().distance(W.getEnvelopeInternal())>this._minDistance)return null;for(var dt=D.getCoordinates(),Ht=W.getCoordinates(),ir=0;ir<dt.length-1;ir++)for(var Hr=0;Hr<Ht.length-1;Hr++){var Bn=M.distanceLineLine(dt[ir],dt[ir+1],Ht[Hr],Ht[Hr+1]);if(Bn<r._minDistance){r._minDistance=Bn;var Vn=new k(dt[ir],dt[ir+1]),Wr=new k(Ht[Hr],Ht[Hr+1]),ps=Vn.closestPoints(Wr);Ee[0]=new ee(D,ir,ps[0]),Ee[1]=new ee(W,Hr,ps[1])}if(r._minDistance<=r._terminateDistance)return null}}}};Xt.prototype.computeMinDistancePoints=function(r,e,t){for(var n=this,o=0;o<r.size();o++)for(var a=r.get(o),l=0;l<e.size();l++){var s=e.get(l),m=a.getCoordinate().distance(s.getCoordinate());if(m<n._minDistance&&(n._minDistance=m,t[0]=new ee(a,0,a.getCoordinate()),t[1]=new ee(s,0,s.getCoordinate())),n._minDistance<=n._terminateDistance)return null}};Xt.prototype.distance=function(){if(this._geom[0]===null||this._geom[1]===null)throw new ft("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)};Xt.prototype.computeMinDistanceLines=function(r,e,t){for(var n=this,o=0;o<r.size();o++)for(var a=r.get(o),l=0;l<e.size();l++){var s=e.get(l);if(n.computeMinDistance(a,s,t),n._minDistance<=n._terminateDistance)return null}};Xt.prototype.interfaces_=function(){return[]};Xt.prototype.getClass=function(){return Xt};Xt.distance=function(r,e){var t=new Xt(r,e);return t.distance()};Xt.isWithinDistance=function(r,e,t){var n=new Xt(r,e,t);return n.distance()<=t};Xt.nearestPoints=function(r,e){var t=new Xt(r,e);return t.nearestPoints()};var jt=function(){this._pt=[new d,new d],this._distance=z.NaN,this._isNull=!0};jt.prototype.getCoordinates=function(){return this._pt};jt.prototype.getCoordinate=function(r){return this._pt[r]};jt.prototype.setMinimum=function(){if(arguments.length===1){var r=arguments[0];this.setMinimum(r._pt[0],r._pt[1])}else if(arguments.length===2){var e=arguments[0],t=arguments[1];if(this._isNull)return this.initialize(e,t),null;var n=e.distance(t);n<this._distance&&this.initialize(e,t,n)}};jt.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var r=arguments[0],e=arguments[1];this._pt[0].setCoordinate(r),this._pt[1].setCoordinate(e),this._distance=r.distance(e),this._isNull=!1}else if(arguments.length===3){var t=arguments[0],n=arguments[1],o=arguments[2];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(n),this._distance=o,this._isNull=!1}};jt.prototype.toString=function(){return Xe.toLineString(this._pt[0],this._pt[1])};jt.prototype.getDistance=function(){return this._distance};jt.prototype.setMaximum=function(){if(arguments.length===1){var r=arguments[0];this.setMaximum(r._pt[0],r._pt[1])}else if(arguments.length===2){var e=arguments[0],t=arguments[1];if(this._isNull)return this.initialize(e,t),null;var n=e.distance(t);n>this._distance&&this.initialize(e,t,n)}};jt.prototype.interfaces_=function(){return[]};jt.prototype.getClass=function(){return jt};var rn=function(){};rn.prototype.interfaces_=function(){return[]};rn.prototype.getClass=function(){return rn};rn.computeDistance=function(){if(arguments[2]instanceof jt&&arguments[0]instanceof yt&&arguments[1]instanceof d)for(var r=arguments[0],e=arguments[1],t=arguments[2],n=new k,o=r.getCoordinates(),a=0;a<o.length-1;a++){n.setCoordinates(o[a],o[a+1]);var l=n.closestPoint(e);t.setMinimum(l,e)}else if(arguments[2]instanceof jt&&arguments[0]instanceof Ot&&arguments[1]instanceof d){var s=arguments[0],m=arguments[1],y=arguments[2];rn.computeDistance(s.getExteriorRing(),m,y);for(var D=0;D<s.getNumInteriorRing();D++)rn.computeDistance(s.getInteriorRingN(D),m,y)}else if(arguments[2]instanceof jt&&arguments[0]instanceof G&&arguments[1]instanceof d){var W=arguments[0],Ee=arguments[1],dt=arguments[2];if(W instanceof yt)rn.computeDistance(W,Ee,dt);else if(W instanceof Ot)rn.computeDistance(W,Ee,dt);else if(W instanceof ie)for(var Ht=W,ir=0;ir<Ht.getNumGeometries();ir++){var Hr=Ht.getGeometryN(ir);rn.computeDistance(Hr,Ee,dt)}else dt.setMinimum(W.getCoordinate(),Ee)}else if(arguments[2]instanceof jt&&arguments[0]instanceof k&&arguments[1]instanceof d){var Bn=arguments[0],Vn=arguments[1],Wr=arguments[2],ps=Bn.closestPoint(Vn);Wr.setMinimum(ps,Vn)}};var De=function(){this._g0=null,this._g1=null,this._ptDist=new jt,this._densifyFrac=0;var r=arguments[0],e=arguments[1];this._g0=r,this._g1=e},Js={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};De.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()};De.prototype.setDensifyFraction=function(r){if(r>1||r<=0)throw new ft("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=r};De.prototype.compute=function(r,e){this.computeOrientedDistance(r,e,this._ptDist),this.computeOrientedDistance(e,r,this._ptDist)};De.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()};De.prototype.computeOrientedDistance=function(r,e,t){var n=new ii(e);if(r.apply(n),t.setMaximum(n.getMaxPointDistance()),this._densifyFrac>0){var o=new yr(e,this._densifyFrac);r.apply(o),t.setMaximum(o.getMaxPointDistance())}};De.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()};De.prototype.interfaces_=function(){return[]};De.prototype.getClass=function(){return De};De.distance=function(){if(arguments.length===2){var r=arguments[0],e=arguments[1],t=new De(r,e);return t.distance()}else if(arguments.length===3){var n=arguments[0],o=arguments[1],a=arguments[2],l=new De(n,o);return l.setDensifyFraction(a),l.distance()}};Js.MaxPointDistanceFilter.get=function(){return ii};Js.MaxDensifiedByFractionDistanceFilter.get=function(){return yr};Object.defineProperties(De,Js);var ii=function(){this._maxPtDist=new jt,this._minPtDist=new jt,this._euclideanDist=new rn,this._geom=null;var r=arguments[0];this._geom=r};ii.prototype.filter=function(r){this._minPtDist.initialize(),rn.computeDistance(this._geom,r,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};ii.prototype.getMaxPointDistance=function(){return this._maxPtDist};ii.prototype.interfaces_=function(){return[Ln]};ii.prototype.getClass=function(){return ii};var yr=function(){this._maxPtDist=new jt,this._minPtDist=new jt,this._geom=null,this._numSubSegs=0;var r=arguments[0],e=arguments[1];this._geom=r,this._numSubSegs=Math.trunc(Math.round(1/e))};yr.prototype.filter=function(r,e){var t=this;if(e===0)return null;for(var n=r.getCoordinate(e-1),o=r.getCoordinate(e),a=(o.x-n.x)/this._numSubSegs,l=(o.y-n.y)/this._numSubSegs,s=0;s<this._numSubSegs;s++){var m=n.x+s*a,y=n.y+s*l,D=new d(m,y);t._minPtDist.initialize(),rn.computeDistance(t._geom,D,t._minPtDist),t._maxPtDist.setMaximum(t._minPtDist)}};yr.prototype.isDone=function(){return!1};yr.prototype.isGeometryChanged=function(){return!1};yr.prototype.getMaxPointDistance=function(){return this._maxPtDist};yr.prototype.interfaces_=function(){return[Ye]};yr.prototype.getClass=function(){return yr};var pe=function(r,e,t){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=r||null,this._bufDistance=e||null,this._result=t||null},$s={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};pe.prototype.checkMaximumDistance=function(r,e,t){var n=new De(e,r);if(n.setDensifyFraction(.25),this._maxDistanceFound=n.orientedDistance(),this._maxDistanceFound>t){this._isValid=!1;var o=n.getCoordinates();this._errorLocation=o[1],this._errorIndicator=r.getFactory().createLineString(o),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+Xe.toLineString(o[0],o[1])+")"}};pe.prototype.isValid=function(){var r=Math.abs(this._bufDistance),e=pe.MAX_DISTANCE_DIFF_FRAC*r;return this._minValidDistance=r-e,this._maxValidDistance=r+e,this._input.isEmpty()||this._result.isEmpty()?!0:(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),pe.VERBOSE&&qt.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)};pe.prototype.checkNegativeValid=function(){if(!(this._input instanceof Ot||this._input instanceof Sn||this._input instanceof ie))return null;var r=this.getPolygonLines(this._input);if(this.checkMinimumDistance(r,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(r,this._result,this._maxValidDistance)};pe.prototype.getErrorIndicator=function(){return this._errorIndicator};pe.prototype.checkMinimumDistance=function(r,e,t){var n=new Xt(r,e,t);if(this._minDistanceFound=n.distance(),this._minDistanceFound<t){this._isValid=!1;var o=n.nearestPoints();this._errorLocation=n.nearestPoints()[1],this._errorIndicator=r.getFactory().createLineString(o),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+Xe.toLineString(o[0],o[1])+" )"}};pe.prototype.checkPositiveValid=function(){var r=this._result.getBoundary();if(this.checkMinimumDistance(this._input,r,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,r,this._maxValidDistance)};pe.prototype.getErrorLocation=function(){return this._errorLocation};pe.prototype.getPolygonLines=function(r){for(var e=new O,t=new Vt(e),n=jn.getPolygons(r),o=n.iterator();o.hasNext();){var a=o.next();a.apply(t)}return r.getFactory().buildGeometry(e)};pe.prototype.getErrorMessage=function(){return this._errMsg};pe.prototype.interfaces_=function(){return[]};pe.prototype.getClass=function(){return pe};$s.VERBOSE.get=function(){return!1};$s.MAX_DISTANCE_DIFF_FRAC.get=function(){return .012};Object.defineProperties(pe,$s);var Yt=function(r,e,t){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=r||null,this._distance=e||null,this._result=t||null},ta={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};Yt.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid};Yt.prototype.checkEnvelope=function(){if(this._distance<0)return null;var r=this._distance*Yt.MAX_ENV_DIFF_FRAC;r===0&&(r=.001);var e=new B(this._input.getEnvelopeInternal());e.expandBy(this._distance);var t=new B(this._result.getEnvelopeInternal());t.expandBy(r),t.contains(e)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(t)),this.report("Envelope")};Yt.prototype.checkDistance=function(){var r=new pe(this._input,this._distance,this._result);r.isValid()||(this._isValid=!1,this._errorMsg=r.getErrorMessage(),this._errorLocation=r.getErrorLocation(),this._errorIndicator=r.getErrorIndicator()),this.report("Distance")};Yt.prototype.checkArea=function(){var r=this._input.getArea(),e=this._result.getArea();this._distance>0&&r>e&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&r<e&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")};Yt.prototype.checkPolygonal=function(){this._result instanceof Ot||this._result instanceof Sn||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")};Yt.prototype.getErrorIndicator=function(){return this._errorIndicator};Yt.prototype.getErrorLocation=function(){return this._errorLocation};Yt.prototype.checkExpectedEmpty=function(){if(this._input.getDimension()>=2||this._distance>0)return null;this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),this.report("ExpectedEmpty")};Yt.prototype.report=function(r){if(!Yt.VERBOSE)return null;qt.out.println("Check "+r+": "+(this._isValid?"passed":"FAILED"))};Yt.prototype.getErrorMessage=function(){return this._errorMsg};Yt.prototype.interfaces_=function(){return[]};Yt.prototype.getClass=function(){return Yt};Yt.isValidMsg=function(r,e,t){var n=new Yt(r,e,t);return n.isValid()?null:n.getErrorMessage()};Yt.isValid=function(r,e,t){var n=new Yt(r,e,t);return!!n.isValid()};ta.VERBOSE.get=function(){return!1};ta.MAX_ENV_DIFF_FRAC.get=function(){return .012};Object.defineProperties(Yt,ta);var vn=function(){this._pts=null,this._data=null;var r=arguments[0],e=arguments[1];this._pts=r,this._data=e};vn.prototype.getCoordinates=function(){return this._pts};vn.prototype.size=function(){return this._pts.length};vn.prototype.getCoordinate=function(r){return this._pts[r]};vn.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};vn.prototype.getSegmentOctant=function(r){return r===this._pts.length-1?-1:$r.octant(this.getCoordinate(r),this.getCoordinate(r+1))};vn.prototype.setData=function(r){this._data=r};vn.prototype.getData=function(){return this._data};vn.prototype.toString=function(){return Xe.toLineString(new _t(this._pts))};vn.prototype.interfaces_=function(){return[Rn]};vn.prototype.getClass=function(){return vn};var At=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new O,this._intersectionCount=0,this._keepIntersections=!0;var r=arguments[0];this._li=r,this._interiorIntersection=null};At.prototype.getInteriorIntersection=function(){return this._interiorIntersection};At.prototype.setCheckEndSegmentsOnly=function(r){this._isCheckEndSegmentsOnly=r};At.prototype.getIntersectionSegments=function(){return this._intSegments};At.prototype.count=function(){return this._intersectionCount};At.prototype.getIntersections=function(){return this._intersections};At.prototype.setFindAllIntersections=function(r){this._findAllIntersections=r};At.prototype.setKeepIntersections=function(r){this._keepIntersections=r};At.prototype.processIntersections=function(r,e,t,n){if(!this._findAllIntersections&&this.hasIntersection()||r===t&&e===n)return null;if(this._isCheckEndSegmentsOnly){var o=this.isEndSegment(r,e)||this.isEndSegment(t,n);if(!o)return null}var a=r.getCoordinates()[e],l=r.getCoordinates()[e+1],s=t.getCoordinates()[n],m=t.getCoordinates()[n+1];this._li.computeIntersection(a,l,s,m),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=a,this._intSegments[1]=l,this._intSegments[2]=s,this._intSegments[3]=m,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)};At.prototype.isEndSegment=function(r,e){return e===0||e>=r.size()-2};At.prototype.hasIntersection=function(){return this._interiorIntersection!==null};At.prototype.isDone=function(){return this._findAllIntersections?!1:this._interiorIntersection!==null};At.prototype.interfaces_=function(){return[Ar]};At.prototype.getClass=function(){return At};At.createAllIntersectionsFinder=function(r){var e=new At(r);return e.setFindAllIntersections(!0),e};At.createAnyIntersectionFinder=function(r){return new At(r)};At.createIntersectionCounter=function(r){var e=new At(r);return e.setFindAllIntersections(!0),e.setKeepIntersections(!1),e};var Qe=function(){this._li=new Xr,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var r=arguments[0];this._segStrings=r};Qe.prototype.execute=function(){if(this._segInt!==null)return null;this.checkInteriorIntersections()};Qe.prototype.getIntersections=function(){return this._segInt.getIntersections()};Qe.prototype.isValid=function(){return this.execute(),this._isValid};Qe.prototype.setFindAllIntersections=function(r){this._findAllIntersections=r};Qe.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new At(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var r=new Qs;if(r.setSegmentIntersector(this._segInt),r.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null};Qe.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Jn(this.getErrorMessage(),this._segInt.getInteriorIntersection())};Qe.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var r=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+Xe.toLineString(r[0],r[1])+" and "+Xe.toLineString(r[2],r[3])};Qe.prototype.interfaces_=function(){return[]};Qe.prototype.getClass=function(){return Qe};Qe.computeIntersections=function(r){var e=new Qe(r);return e.setFindAllIntersections(!0),e.isValid(),e.getIntersections()};var kr=function r(){this._nv=null;var e=arguments[0];this._nv=new Qe(r.toSegmentStrings(e))};kr.prototype.checkValid=function(){this._nv.checkValid()};kr.prototype.interfaces_=function(){return[]};kr.prototype.getClass=function(){return kr};kr.toSegmentStrings=function(r){for(var e=new O,t=r.iterator();t.hasNext();){var n=t.next();e.add(new vn(n.getCoordinates(),n))}return e};kr.checkValid=function(r){var e=new kr(r);e.checkValid()};var oi=function(r){this._mapOp=r};oi.prototype.map=function(r){for(var e=this,t=new O,n=0;n<r.getNumGeometries();n++){var o=e._mapOp.map(r.getGeometryN(n));o.isEmpty()||t.add(o)}return r.getFactory().createGeometryCollection(H.toGeometryArray(t))};oi.prototype.interfaces_=function(){return[]};oi.prototype.getClass=function(){return oi};oi.map=function(r,e){var t=new oi(e);return t.map(r)};var yn=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new O,this._resultLineList=new O;var r=arguments[0],e=arguments[1],t=arguments[2];this._op=r,this._geometryFactory=e,this._ptLocator=t};yn.prototype.collectLines=function(r){for(var e=this,t=this._op.getGraph().getEdgeEnds().iterator();t.hasNext();){var n=t.next();e.collectLineEdge(n,r,e._lineEdgesList),e.collectBoundaryTouchEdge(n,r,e._lineEdgesList)}};yn.prototype.labelIsolatedLine=function(r,e){var t=this._ptLocator.locate(r.getCoordinate(),this._op.getArgGeometry(e));r.getLabel().setLocation(e,t)};yn.prototype.build=function(r){return this.findCoveredLineEdges(),this.collectLines(r),this.buildLines(r),this._resultLineList};yn.prototype.collectLineEdge=function(r,e,t){var n=r.getLabel(),o=r.getEdge();r.isLineEdge()&&!r.isVisited()&&U.isResultOfOp(n,e)&&!o.isCovered()&&(t.add(o),r.setVisitedEdge(!0))};yn.prototype.findCoveredLineEdges=function(){for(var r=this,e=this._op.getGraph().getNodes().iterator();e.hasNext();){var t=e.next();t.getEdges().findCoveredLineEdges()}for(var n=this._op.getGraph().getEdgeEnds().iterator();n.hasNext();){var o=n.next(),a=o.getEdge();if(o.isLineEdge()&&!a.isCoveredSet()){var l=r._op.isCoveredByA(o.getCoordinate());a.setCovered(l)}}};yn.prototype.labelIsolatedLines=function(r){for(var e=this,t=r.iterator();t.hasNext();){var n=t.next(),o=n.getLabel();n.isIsolated()&&(o.isNull(0)?e.labelIsolatedLine(n,0):e.labelIsolatedLine(n,1))}};yn.prototype.buildLines=function(r){for(var e=this,t=this._lineEdgesList.iterator();t.hasNext();){var n=t.next(),o=e._geometryFactory.createLineString(n.getCoordinates());e._resultLineList.add(o),n.setInResult(!0)}};yn.prototype.collectBoundaryTouchEdge=function(r,e,t){var n=r.getLabel();if(r.isLineEdge()||r.isVisited()||r.isInteriorAreaEdge()||r.getEdge().isInResult())return null;q.isTrue(!(r.isInResult()||r.getSym().isInResult())||!r.getEdge().isInResult()),U.isResultOfOp(n,e)&&e===U.INTERSECTION&&(t.add(r.getEdge()),r.setVisitedEdge(!0))};yn.prototype.interfaces_=function(){return[]};yn.prototype.getClass=function(){return yn};var si=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new O;var r=arguments[0],e=arguments[1];this._op=r,this._geometryFactory=e};si.prototype.filterCoveredNodeToPoint=function(r){var e=r.getCoordinate();if(!this._op.isCoveredByLA(e)){var t=this._geometryFactory.createPoint(e);this._resultPointList.add(t)}};si.prototype.extractNonCoveredResultNodes=function(r){for(var e=this,t=this._op.getGraph().getNodes().iterator();t.hasNext();){var n=t.next();if(!n.isInResult()&&!n.isIncidentEdgeInResult()&&(n.getEdges().getDegree()===0||r===U.INTERSECTION)){var o=n.getLabel();U.isResultOfOp(o,r)&&e.filterCoveredNodeToPoint(n)}}};si.prototype.build=function(r){return this.extractNonCoveredResultNodes(r),this._resultPointList};si.prototype.interfaces_=function(){return[]};si.prototype.getClass=function(){return si};var ge=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};ge.prototype.transformPoint=function(r,e){return this._factory.createPoint(this.transformCoordinates(r.getCoordinateSequence(),r))};ge.prototype.transformPolygon=function(r,e){var t=this,n=!0,o=this.transformLinearRing(r.getExteriorRing(),r);(o===null||!(o instanceof bn)||o.isEmpty())&&(n=!1);for(var a=new O,l=0;l<r.getNumInteriorRing();l++){var s=t.transformLinearRing(r.getInteriorRingN(l),r);s===null||s.isEmpty()||(s instanceof bn||(n=!1),a.add(s))}if(n)return this._factory.createPolygon(o,a.toArray([]));var m=new O;return o!==null&&m.add(o),m.addAll(a),this._factory.buildGeometry(m)};ge.prototype.createCoordinateSequence=function(r){return this._factory.getCoordinateSequenceFactory().create(r)};ge.prototype.getInputGeometry=function(){return this._inputGeom};ge.prototype.transformMultiLineString=function(r,e){for(var t=this,n=new O,o=0;o<r.getNumGeometries();o++){var a=t.transformLineString(r.getGeometryN(o),r);a!==null&&(a.isEmpty()||n.add(a))}return this._factory.buildGeometry(n)};ge.prototype.transformCoordinates=function(r,e){return this.copy(r)};ge.prototype.transformLineString=function(r,e){return this._factory.createLineString(this.transformCoordinates(r.getCoordinateSequence(),r))};ge.prototype.transformMultiPoint=function(r,e){for(var t=this,n=new O,o=0;o<r.getNumGeometries();o++){var a=t.transformPoint(r.getGeometryN(o),r);a!==null&&(a.isEmpty()||n.add(a))}return this._factory.buildGeometry(n)};ge.prototype.transformMultiPolygon=function(r,e){for(var t=this,n=new O,o=0;o<r.getNumGeometries();o++){var a=t.transformPolygon(r.getGeometryN(o),r);a!==null&&(a.isEmpty()||n.add(a))}return this._factory.buildGeometry(n)};ge.prototype.copy=function(r){return r.copy()};ge.prototype.transformGeometryCollection=function(r,e){for(var t=this,n=new O,o=0;o<r.getNumGeometries();o++){var a=t.transform(r.getGeometryN(o));a!==null&&(t._pruneEmptyGeometry&&a.isEmpty()||n.add(a))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(H.toGeometryArray(n)):this._factory.buildGeometry(n)};ge.prototype.transform=function(r){if(this._inputGeom=r,this._factory=r.getFactory(),r instanceof de)return this.transformPoint(r,null);if(r instanceof Pi)return this.transformMultiPoint(r,null);if(r instanceof bn)return this.transformLinearRing(r,null);if(r instanceof yt)return this.transformLineString(r,null);if(r instanceof Tr)return this.transformMultiLineString(r,null);if(r instanceof Ot)return this.transformPolygon(r,null);if(r instanceof Sn)return this.transformMultiPolygon(r,null);if(r instanceof ie)return this.transformGeometryCollection(r,null);throw new ft("Unknown Geometry subtype: "+r.getClass().getName())};ge.prototype.transformLinearRing=function(r,e){var t=this.transformCoordinates(r.getCoordinateSequence(),r);if(t===null)return this._factory.createLinearRing(null);var n=t.size();return n>0&&n<4&&!this._preserveType?this._factory.createLineString(t):this._factory.createLinearRing(t)};ge.prototype.interfaces_=function(){return[]};ge.prototype.getClass=function(){return ge};var Dn=function r(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new k,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof yt&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1];r.call(this,e.getCoordinates(),t)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){var n=arguments[0],o=arguments[1];this._srcPts=n,this._isClosed=r.isClosed(n),this._snapTolerance=o}};Dn.prototype.snapVertices=function(r,e){for(var t=this,n=this._isClosed?r.size()-1:r.size(),o=0;o<n;o++){var a=r.get(o),l=t.findSnapForVertex(a,e);l!==null&&(r.set(o,new d(l)),o===0&&t._isClosed&&r.set(r.size()-1,new d(l)))}};Dn.prototype.findSnapForVertex=function(r,e){for(var t=this,n=0;n<e.length;n++){if(r.equals2D(e[n]))return null;if(r.distance(e[n])<t._snapTolerance)return e[n]}return null};Dn.prototype.snapTo=function(r){var e=new Eo(this._srcPts);this.snapVertices(e,r),this.snapSegments(e,r);var t=e.toCoordinateArray();return t};Dn.prototype.snapSegments=function(r,e){var t=this;if(e.length===0)return null;var n=e.length;e[0].equals2D(e[e.length-1])&&(n=e.length-1);for(var o=0;o<n;o++){var a=e[o],l=t.findSegmentIndexToSnap(a,r);l>=0&&r.add(l+1,new d(a),!1)}};Dn.prototype.findSegmentIndexToSnap=function(r,e){for(var t=this,n=z.MAX_VALUE,o=-1,a=0;a<e.size()-1;a++){if(t._seg.p0=e.get(a),t._seg.p1=e.get(a+1),t._seg.p0.equals2D(r)||t._seg.p1.equals2D(r)){if(t._allowSnappingToSourceVertices)continue;return-1}var l=t._seg.distance(r);l<t._snapTolerance&&l<n&&(n=l,o=a)}return o};Dn.prototype.setAllowSnappingToSourceVertices=function(r){this._allowSnappingToSourceVertices=r};Dn.prototype.interfaces_=function(){return[]};Dn.prototype.getClass=function(){return Dn};Dn.isClosed=function(r){return r.length<=1?!1:r[0].equals2D(r[r.length-1])};var Et=function(r){this._srcGeom=r||null},Bu={SNAP_PRECISION_FACTOR:{configurable:!0}};Et.prototype.snapTo=function(r,e){var t=this.extractTargetCoordinates(r),n=new ku(e,t);return n.transform(this._srcGeom)};Et.prototype.snapToSelf=function(r,e){var t=this.extractTargetCoordinates(this._srcGeom),n=new ku(r,t,!0),o=n.transform(this._srcGeom),a=o;return e&&V(a,fr)&&(a=o.buffer(0)),a};Et.prototype.computeSnapTolerance=function(r){var e=this.computeMinimumSegmentLength(r),t=e/10;return t};Et.prototype.extractTargetCoordinates=function(r){for(var e=new ln,t=r.getCoordinates(),n=0;n<t.length;n++)e.add(t[n]);return e.toArray(new Array(0).fill(null))};Et.prototype.computeMinimumSegmentLength=function(r){for(var e=z.MAX_VALUE,t=0;t<r.length-1;t++){var n=r[t].distance(r[t+1]);n<e&&(e=n)}return e};Et.prototype.interfaces_=function(){return[]};Et.prototype.getClass=function(){return Et};Et.snap=function(r,e,t){var n=new Array(2).fill(null),o=new Et(r);n[0]=o.snapTo(e,t);var a=new Et(e);return n[1]=a.snapTo(n[0],t),n};Et.computeOverlaySnapTolerance=function(){if(arguments.length===1){var r=arguments[0],e=Et.computeSizeBasedSnapTolerance(r),t=r.getPrecisionModel();if(t.getType()===$.FIXED){var n=1/t.getScale()*2/1.415;n>e&&(e=n)}return e}else if(arguments.length===2){var o=arguments[0],a=arguments[1];return Math.min(Et.computeOverlaySnapTolerance(o),Et.computeOverlaySnapTolerance(a))}};Et.computeSizeBasedSnapTolerance=function(r){var e=r.getEnvelopeInternal(),t=Math.min(e.getHeight(),e.getWidth()),n=t*Et.SNAP_PRECISION_FACTOR;return n};Et.snapToSelf=function(r,e,t){var n=new Et(r);return n.snapToSelf(e,t)};Bu.SNAP_PRECISION_FACTOR.get=function(){return 1e-9};Object.defineProperties(Et,Bu);var ku=function(r){function e(t,n,o){r.call(this),this._snapTolerance=t||null,this._snapPts=n||null,this._isSelfSnap=o!==void 0?o:!1}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.snapLine=function(t,n){var o=new Dn(t,this._snapTolerance);return o.setAllowSnappingToSourceVertices(this._isSelfSnap),o.snapTo(n)},e.prototype.transformCoordinates=function(t,n){var o=t.toCoordinateArray(),a=this.snapLine(o,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(a)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(ge),$t=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};$t.prototype.getCommon=function(){return z.longBitsToDouble(this._commonBits)};$t.prototype.add=function(r){var e=z.doubleToLongBits(r);if(this._isFirst)return this._commonBits=e,this._commonSignExp=$t.signExpBits(this._commonBits),this._isFirst=!1,null;var t=$t.signExpBits(e);if(t!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=$t.numCommonMostSigMantissaBits(this._commonBits,e),this._commonBits=$t.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))};$t.prototype.toString=function(){if(arguments.length===1){var r=arguments[0],e=z.longBitsToDouble(r),t=z.toBinaryString(r),n="0000000000000000000000000000000000000000000000000000000000000000"+t,o=n.substring(n.length-64),a=o.substring(0,1)+"  "+o.substring(1,12)+"(exp) "+o.substring(12)+" [ "+e+" ]";return a}};$t.prototype.interfaces_=function(){return[]};$t.prototype.getClass=function(){return $t};$t.getBit=function(r,e){var t=1<<e;return r&t?1:0};$t.signExpBits=function(r){return r>>52};$t.zeroLowerBits=function(r,e){var t=(1<<e)-1,n=~t,o=r&n;return o};$t.numCommonMostSigMantissaBits=function(r,e){for(var t=0,n=52;n>=0;n--){if($t.getBit(r,n)!==$t.getBit(e,n))return t;t++}return 52};var mr=function(){this._commonCoord=null,this._ccFilter=new ai},ea={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};mr.prototype.addCommonBits=function(r){var e=new _r(this._commonCoord);r.apply(e),r.geometryChanged()};mr.prototype.removeCommonBits=function(r){if(this._commonCoord.x===0&&this._commonCoord.y===0)return r;var e=new d(this._commonCoord);e.x=-e.x,e.y=-e.y;var t=new _r(e);return r.apply(t),r.geometryChanged(),r};mr.prototype.getCommonCoordinate=function(){return this._commonCoord};mr.prototype.add=function(r){r.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()};mr.prototype.interfaces_=function(){return[]};mr.prototype.getClass=function(){return mr};ea.CommonCoordinateFilter.get=function(){return ai};ea.Translater.get=function(){return _r};Object.defineProperties(mr,ea);var ai=function(){this._commonBitsX=new $t,this._commonBitsY=new $t};ai.prototype.filter=function(r){this._commonBitsX.add(r.x),this._commonBitsY.add(r.y)};ai.prototype.getCommonCoordinate=function(){return new d(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())};ai.prototype.interfaces_=function(){return[Ln]};ai.prototype.getClass=function(){return ai};var _r=function(){this.trans=null;var r=arguments[0];this.trans=r};_r.prototype.filter=function(r,e){var t=r.getOrdinate(e,0)+this.trans.x,n=r.getOrdinate(e,1)+this.trans.y;r.setOrdinate(e,0,t),r.setOrdinate(e,1,n)};_r.prototype.isDone=function(){return!1};_r.prototype.isGeometryChanged=function(){return!0};_r.prototype.interfaces_=function(){return[Ye]};_r.prototype.getClass=function(){return _r};var Ft=function(r,e){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=r,this._geom[1]=e,this.computeSnapTolerance()};Ft.prototype.selfSnap=function(r){var e=new Et(r),t=e.snapTo(r,this._snapTolerance);return t};Ft.prototype.removeCommonBits=function(r){this._cbr=new mr,this._cbr.add(r[0]),this._cbr.add(r[1]);var e=new Array(2).fill(null);return e[0]=this._cbr.removeCommonBits(r[0].copy()),e[1]=this._cbr.removeCommonBits(r[1].copy()),e};Ft.prototype.prepareResult=function(r){return this._cbr.addCommonBits(r),r};Ft.prototype.getResultGeometry=function(r){var e=this.snap(this._geom),t=U.overlayOp(e[0],e[1],r);return this.prepareResult(t)};Ft.prototype.checkValid=function(r){r.isValid()||qt.out.println("Snapped geometry is invalid")};Ft.prototype.computeSnapTolerance=function(){this._snapTolerance=Et.computeOverlaySnapTolerance(this._geom[0],this._geom[1])};Ft.prototype.snap=function(r){var e=this.removeCommonBits(r),t=Et.snap(e[0],e[1],this._snapTolerance);return t};Ft.prototype.interfaces_=function(){return[]};Ft.prototype.getClass=function(){return Ft};Ft.overlayOp=function(r,e,t){var n=new Ft(r,e);return n.getResultGeometry(t)};Ft.union=function(r,e){return Ft.overlayOp(r,e,U.UNION)};Ft.intersection=function(r,e){return Ft.overlayOp(r,e,U.INTERSECTION)};Ft.symDifference=function(r,e){return Ft.overlayOp(r,e,U.SYMDIFFERENCE)};Ft.difference=function(r,e){return Ft.overlayOp(r,e,U.DIFFERENCE)};var ae=function(r,e){this._geom=new Array(2).fill(null),this._geom[0]=r,this._geom[1]=e};ae.prototype.getResultGeometry=function(r){var e=null,t=!1,n=null;try{e=U.overlayOp(this._geom[0],this._geom[1],r);var o=!0;o&&(t=!0)}catch(a){if(a instanceof Qn)n=a;else throw a}finally{}if(!t)try{e=Ft.overlayOp(this._geom[0],this._geom[1],r)}catch(a){throw a instanceof Qn?n:a}finally{}return e};ae.prototype.interfaces_=function(){return[]};ae.prototype.getClass=function(){return ae};ae.overlayOp=function(r,e,t){var n=new ae(r,e);return n.getResultGeometry(t)};ae.union=function(r,e){return ae.overlayOp(r,e,U.UNION)};ae.intersection=function(r,e){return ae.overlayOp(r,e,U.INTERSECTION)};ae.symDifference=function(r,e){return ae.overlayOp(r,e,U.SYMDIFFERENCE)};ae.difference=function(r,e){return ae.overlayOp(r,e,U.DIFFERENCE)};var po=function(){this.mce=null,this.chainIndex=null;var r=arguments[0],e=arguments[1];this.mce=r,this.chainIndex=e};po.prototype.computeIntersections=function(r,e){this.mce.computeIntersectsForChain(this.chainIndex,r.mce,r.chainIndex,e)};po.prototype.interfaces_=function(){return[]};po.prototype.getClass=function(){return po};var me=function r(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,arguments.length===2){var e=arguments[0],t=arguments[1];this._eventType=r.DELETE,this._xValue=e,this._insertEvent=t}else if(arguments.length===3){var n=arguments[0],o=arguments[1],a=arguments[2];this._eventType=r.INSERT,this._label=n,this._xValue=o,this._obj=a}},na={INSERT:{configurable:!0},DELETE:{configurable:!0}};me.prototype.isDelete=function(){return this._eventType===me.DELETE};me.prototype.setDeleteEventIndex=function(r){this._deleteEventIndex=r};me.prototype.getObject=function(){return this._obj};me.prototype.compareTo=function(r){var e=r;return this._xValue<e._xValue?-1:this._xValue>e._xValue?1:this._eventType<e._eventType?-1:this._eventType>e._eventType?1:0};me.prototype.getInsertEvent=function(){return this._insertEvent};me.prototype.isInsert=function(){return this._eventType===me.INSERT};me.prototype.isSameLabel=function(r){return this._label===null?!1:this._label===r._label};me.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex};me.prototype.interfaces_=function(){return[ke]};me.prototype.getClass=function(){return me};na.INSERT.get=function(){return 1};na.DELETE.get=function(){return 2};Object.defineProperties(me,na);var Yo=function(){};Yo.prototype.interfaces_=function(){return[]};Yo.prototype.getClass=function(){return Yo};var Wt=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var r=arguments[0],e=arguments[1],t=arguments[2];this._li=r,this._includeProper=e,this._recordIsolated=t};Wt.prototype.isTrivialIntersection=function(r,e,t,n){if(r===t&&this._li.getIntersectionNum()===1){if(Wt.isAdjacentSegments(e,n))return!0;if(r.isClosed()){var o=r.getNumPoints()-1;if(e===0&&n===o||n===0&&e===o)return!0}}return!1};Wt.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Wt.prototype.setIsDoneIfProperInt=function(r){this._isDoneWhenProperInt=r};Wt.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Wt.prototype.isBoundaryPointInternal=function(r,e){for(var t=e.iterator();t.hasNext();){var n=t.next(),o=n.getCoordinate();if(r.isIntersection(o))return!0}return!1};Wt.prototype.hasProperIntersection=function(){return this._hasProper};Wt.prototype.hasIntersection=function(){return this._hasIntersection};Wt.prototype.isDone=function(){return this._isDone};Wt.prototype.isBoundaryPoint=function(r,e){return e===null?!1:!!(this.isBoundaryPointInternal(r,e[0])||this.isBoundaryPointInternal(r,e[1]))};Wt.prototype.setBoundaryNodes=function(r,e){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=r,this._bdyNodes[1]=e};Wt.prototype.addIntersections=function(r,e,t,n){if(r===t&&e===n)return null;this.numTests++;var o=r.getCoordinates()[e],a=r.getCoordinates()[e+1],l=t.getCoordinates()[n],s=t.getCoordinates()[n+1];this._li.computeIntersection(o,a,l,s),this._li.hasIntersection()&&(this._recordIsolated&&(r.setIsolated(!1),t.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(r,e,t,n)||(this._hasIntersection=!0,(this._includeProper||!this._li.isProper())&&(r.addIntersections(this._li,e,0),t.addIntersections(this._li,n,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))};Wt.prototype.interfaces_=function(){return[]};Wt.prototype.getClass=function(){return Wt};Wt.isAdjacentSegments=function(r,e){return Math.abs(r-e)===1};var sf=function(r){function e(){r.call(this),this.events=new O,this.nOverlaps=null}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.prepareEvents=function(){var t=this;He.sort(this.events);for(var n=0;n<this.events.size();n++){var o=t.events.get(n);o.isDelete()&&o.getInsertEvent().setDeleteEventIndex(n)}},e.prototype.computeIntersections=function(){var t=this;if(arguments.length===1){var n=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var o=0;o<this.events.size();o++){var a=t.events.get(o);if(a.isInsert()&&t.processOverlaps(o,a.getDeleteEventIndex(),a,n),n.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof Wt&&V(arguments[0],qe)&&V(arguments[1],qe)){var l=arguments[0],s=arguments[1],m=arguments[2];this.addEdges(l,l),this.addEdges(s,s),this.computeIntersections(m)}else if(typeof arguments[2]=="boolean"&&V(arguments[0],qe)&&arguments[1]instanceof Wt){var y=arguments[0],D=arguments[1],W=arguments[2];W?this.addEdges(y,null):this.addEdges(y),this.computeIntersections(D)}}},e.prototype.addEdge=function(t,n){for(var o=this,a=t.getMonotoneChainEdge(),l=a.getStartIndexes(),s=0;s<l.length-1;s++){var m=new po(a,s),y=new me(n,a.getMinX(s),m);o.events.add(y),o.events.add(new me(a.getMaxX(s),y))}},e.prototype.processOverlaps=function(t,n,o,a){for(var l=this,s=o.getObject(),m=t;m<n;m++){var y=l.events.get(m);if(y.isInsert()){var D=y.getObject();o.isSameLabel(y)||(s.computeIntersections(D,a),l.nOverlaps++)}}},e.prototype.addEdges=function(){var t=this;if(arguments.length===1)for(var n=arguments[0],o=n.iterator();o.hasNext();){var a=o.next();t.addEdge(a,a)}else if(arguments.length===2)for(var l=arguments[0],s=arguments[1],m=l.iterator();m.hasNext();){var y=m.next();t.addEdge(y,s)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Yo),Mn=function(){this._min=z.POSITIVE_INFINITY,this._max=z.NEGATIVE_INFINITY},Gu={NodeComparator:{configurable:!0}};Mn.prototype.getMin=function(){return this._min};Mn.prototype.intersects=function(r,e){return!(this._min>e||this._max<r)};Mn.prototype.getMax=function(){return this._max};Mn.prototype.toString=function(){return Xe.toLineString(new d(this._min,0),new d(this._max,0))};Mn.prototype.interfaces_=function(){return[]};Mn.prototype.getClass=function(){return Mn};Gu.NodeComparator.get=function(){return vo};Object.defineProperties(Mn,Gu);var vo=function(){};vo.prototype.compare=function(r,e){var t=r,n=e,o=(t._min+t._max)/2,a=(n._min+n._max)/2;return o<a?-1:o>a?1:0};vo.prototype.interfaces_=function(){return[Ci]};vo.prototype.getClass=function(){return vo};var af=function(r){function e(){r.call(this),this._item=null;var t=arguments[0],n=arguments[1],o=arguments[2];this._min=t,this._max=n,this._item=o}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.query=function(t,n,o){if(!this.intersects(t,n))return null;o.visitItem(this._item)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Mn),uf=function(r){function e(){r.call(this),this._node1=null,this._node2=null;var t=arguments[0],n=arguments[1];this._node1=t,this._node2=n,this.buildExtent(this._node1,this._node2)}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.buildExtent=function(t,n){this._min=Math.min(t._min,n._min),this._max=Math.max(t._max,n._max)},e.prototype.query=function(t,n,o){if(!this.intersects(t,n))return null;this._node1!==null&&this._node1.query(t,n,o),this._node2!==null&&this._node2.query(t,n,o)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Mn),An=function(){this._leaves=new O,this._root=null,this._level=0};An.prototype.buildTree=function(){var r=this;He.sort(this._leaves,new Mn.NodeComparator);for(var e=this._leaves,t=null,n=new O;;){if(r.buildLevel(e,n),n.size()===1)return n.get(0);t=e,e=n,n=t}};An.prototype.insert=function(r,e,t){if(this._root!==null)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new af(r,e,t))};An.prototype.query=function(r,e,t){this.init(),this._root.query(r,e,t)};An.prototype.buildRoot=function(){if(this._root!==null)return null;this._root=this.buildTree()};An.prototype.printNode=function(r){qt.out.println(Xe.toLineString(new d(r._min,this._level),new d(r._max,this._level)))};An.prototype.init=function(){if(this._root!==null)return null;this.buildRoot()};An.prototype.buildLevel=function(r,e){this._level++,e.clear();for(var t=0;t<r.size();t+=2){var n=r.get(t),o=t+1<r.size()?r.get(t):null;if(o===null)e.add(n);else{var a=new uf(r.get(t),r.get(t+1));e.add(a)}}};An.prototype.interfaces_=function(){return[]};An.prototype.getClass=function(){return An};var Ai=function(){this._items=new O};Ai.prototype.visitItem=function(r){this._items.add(r)};Ai.prototype.getItems=function(){return this._items};Ai.prototype.interfaces_=function(){return[hr]};Ai.prototype.getClass=function(){return Ai};var Fi=function(){this._index=null;var r=arguments[0];if(!V(r,fr))throw new ft("Argument must be Polygonal");this._index=new Gr(r)},ra={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};Fi.prototype.locate=function(r){var e=new sn(r),t=new Bi(e);return this._index.query(r.y,r.y,t),e.getLocation()};Fi.prototype.interfaces_=function(){return[Di]};Fi.prototype.getClass=function(){return Fi};ra.SegmentVisitor.get=function(){return Bi};ra.IntervalIndexedGeometry.get=function(){return Gr};Object.defineProperties(Fi,ra);var Bi=function(){this._counter=null;var r=arguments[0];this._counter=r};Bi.prototype.visitItem=function(r){var e=r;this._counter.countSegment(e.getCoordinate(0),e.getCoordinate(1))};Bi.prototype.interfaces_=function(){return[hr]};Bi.prototype.getClass=function(){return Bi};var Gr=function(){this._index=new An;var r=arguments[0];this.init(r)};Gr.prototype.init=function(r){for(var e=this,t=Vt.getLines(r),n=t.iterator();n.hasNext();){var o=n.next(),a=o.getCoordinates();e.addLine(a)}};Gr.prototype.addLine=function(r){for(var e=this,t=1;t<r.length;t++){var n=new k(r[t-1],r[t]),o=Math.min(n.p0.y,n.p1.y),a=Math.max(n.p0.y,n.p1.y);e._index.insert(o,a,n)}};Gr.prototype.query=function(){if(arguments.length===2){var r=arguments[0],e=arguments[1],t=new Ai;return this._index.query(r,e,t),t.getItems()}else if(arguments.length===3){var n=arguments[0],o=arguments[1],a=arguments[2];this._index.query(n,o,a)}};Gr.prototype.interfaces_=function(){return[]};Gr.prototype.getClass=function(){return Gr};var Ki=function(r){function e(){if(r.call(this),this._parentGeom=null,this._lineEdgeMap=new Cu,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Ke,arguments.length===2){var t=arguments[0],n=arguments[1],o=Ae.OGC_SFS_BOUNDARY_RULE;this._argIndex=t,this._parentGeom=n,this._boundaryNodeRule=o,n!==null&&this.add(n)}else if(arguments.length===3){var a=arguments[0],l=arguments[1],s=arguments[2];this._argIndex=a,this._parentGeom=l,this._boundaryNodeRule=s,l!==null&&this.add(l)}}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.insertBoundaryPoint=function(t,n){var o=this._nodes.addNode(n),a=o.getLabel(),l=1,s=E.NONE;s=a.getLocation(t,b.ON),s===E.BOUNDARY&&l++;var m=e.determineBoundary(this._boundaryNodeRule,l);a.setLocation(t,m)},e.prototype.computeSelfNodes=function(){if(arguments.length===2){var t=arguments[0],n=arguments[1];return this.computeSelfNodes(t,n,!1)}else if(arguments.length===3){var o=arguments[0],a=arguments[1],l=arguments[2],s=new Wt(o,!0,!1);s.setIsDoneIfProperInt(l);var m=this.createEdgeSetIntersector(),y=this._parentGeom instanceof bn||this._parentGeom instanceof Ot||this._parentGeom instanceof Sn,D=a||!y;return m.computeIntersections(this._edges,s,D),this.addSelfIntersectionNodes(this._argIndex),s}},e.prototype.computeSplitEdges=function(t){for(var n=this._edges.iterator();n.hasNext();){var o=n.next();o.eiList.addSplitEdges(t)}},e.prototype.computeEdgeIntersections=function(t,n,o){var a=new Wt(n,o,!0);a.setBoundaryNodes(this.getBoundaryNodes(),t.getBoundaryNodes());var l=this.createEdgeSetIntersector();return l.computeIntersections(this._edges,t._edges,a),a},e.prototype.getGeometry=function(){return this._parentGeom},e.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},e.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},e.prototype.addPoint=function(){if(arguments[0]instanceof de){var t=arguments[0],n=t.getCoordinate();this.insertPoint(this._argIndex,n,E.INTERIOR)}else if(arguments[0]instanceof d){var o=arguments[0];this.insertPoint(this._argIndex,o,E.INTERIOR)}},e.prototype.addPolygon=function(t){var n=this;this.addPolygonRing(t.getExteriorRing(),E.EXTERIOR,E.INTERIOR);for(var o=0;o<t.getNumInteriorRing();o++){var a=t.getInteriorRingN(o);n.addPolygonRing(a,E.INTERIOR,E.EXTERIOR)}},e.prototype.addEdge=function(t){this.insertEdge(t);var n=t.getCoordinates();this.insertPoint(this._argIndex,n[0],E.BOUNDARY),this.insertPoint(this._argIndex,n[n.length-1],E.BOUNDARY)},e.prototype.addLineString=function(t){var n=j.removeRepeatedPoints(t.getCoordinates());if(n.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=n[0],null;var o=new Xo(n,new et(this._argIndex,E.INTERIOR));this._lineEdgeMap.put(t,o),this.insertEdge(o),q.isTrue(n.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,n[0]),this.insertBoundaryPoint(this._argIndex,n[n.length-1])},e.prototype.getInvalidPoint=function(){return this._invalidPoint},e.prototype.getBoundaryPoints=function(){for(var t=this.getBoundaryNodes(),n=new Array(t.size()).fill(null),o=0,a=t.iterator();a.hasNext();){var l=a.next();n[o++]=l.getCoordinate().copy()}return n},e.prototype.getBoundaryNodes=function(){return this._boundaryNodes===null&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},e.prototype.addSelfIntersectionNode=function(t,n,o){if(this.isBoundaryNode(t,n))return null;o===E.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(t,n):this.insertPoint(t,n,o)},e.prototype.addPolygonRing=function(t,n,o){if(t.isEmpty())return null;var a=j.removeRepeatedPoints(t.getCoordinates());if(a.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=a[0],null;var l=n,s=o;M.isCCW(a)&&(l=o,s=n);var m=new Xo(a,new et(this._argIndex,E.BOUNDARY,l,s));this._lineEdgeMap.put(t,m),this.insertEdge(m),this.insertPoint(this._argIndex,a[0],E.BOUNDARY)},e.prototype.insertPoint=function(t,n,o){var a=this._nodes.addNode(n),l=a.getLabel();l===null?a._label=new et(t,o):l.setLocation(t,o)},e.prototype.createEdgeSetIntersector=function(){return new sf},e.prototype.addSelfIntersectionNodes=function(t){for(var n=this,o=this._edges.iterator();o.hasNext();)for(var a=o.next(),l=a.getLabel().getLocation(t),s=a.eiList.iterator();s.hasNext();){var m=s.next();n.addSelfIntersectionNode(t,m.coord,l)}},e.prototype.add=function(){if(arguments.length===1){var t=arguments[0];if(t.isEmpty())return null;if(t instanceof Sn&&(this._useBoundaryDeterminationRule=!1),t instanceof Ot)this.addPolygon(t);else if(t instanceof yt)this.addLineString(t);else if(t instanceof de)this.addPoint(t);else if(t instanceof Pi)this.addCollection(t);else if(t instanceof Tr)this.addCollection(t);else if(t instanceof Sn)this.addCollection(t);else if(t instanceof ie)this.addCollection(t);else throw new Error(t.getClass().getName())}else return r.prototype.add.apply(this,arguments)},e.prototype.addCollection=function(t){for(var n=this,o=0;o<t.getNumGeometries();o++){var a=t.getGeometryN(o);n.add(a)}},e.prototype.locate=function(t){return V(this._parentGeom,fr)&&this._parentGeom.getNumGeometries()>50?(this._areaPtLocator===null&&(this._areaPtLocator=new Fi(this._parentGeom)),this._areaPtLocator.locate(t)):this._ptLocator.locate(t,this._parentGeom)},e.prototype.findEdge=function(){if(arguments.length===1){var t=arguments[0];return this._lineEdgeMap.get(t)}else return r.prototype.findEdge.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.determineBoundary=function(t,n){return t.isInBoundary(n)?E.BOUNDARY:E.INTERIOR},e}(pt),ki=function(){if(this._li=new Xr,this._resultPrecisionModel=null,this._arg=null,arguments.length===1){var r=arguments[0];this.setComputationPrecision(r.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new Ki(0,r)}else if(arguments.length===2){var e=arguments[0],t=arguments[1],n=Ae.OGC_SFS_BOUNDARY_RULE;e.getPrecisionModel().compareTo(t.getPrecisionModel())>=0?this.setComputationPrecision(e.getPrecisionModel()):this.setComputationPrecision(t.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Ki(0,e,n),this._arg[1]=new Ki(1,t,n)}else if(arguments.length===3){var o=arguments[0],a=arguments[1],l=arguments[2];o.getPrecisionModel().compareTo(a.getPrecisionModel())>=0?this.setComputationPrecision(o.getPrecisionModel()):this.setComputationPrecision(a.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Ki(0,o,l),this._arg[1]=new Ki(1,a,l)}};ki.prototype.getArgGeometry=function(r){return this._arg[r].getGeometry()};ki.prototype.setComputationPrecision=function(r){this._resultPrecisionModel=r,this._li.setPrecisionModel(this._resultPrecisionModel)};ki.prototype.interfaces_=function(){return[]};ki.prototype.getClass=function(){return ki};var br=function(){};br.prototype.interfaces_=function(){return[]};br.prototype.getClass=function(){return br};br.map=function(){if(arguments[0]instanceof G&&V(arguments[1],br.MapOp)){for(var r=arguments[0],e=arguments[1],t=new O,n=0;n<r.getNumGeometries();n++){var o=e.map(r.getGeometryN(n));o!==null&&t.add(o)}return r.getFactory().buildGeometry(t)}else if(V(arguments[0],Lt)&&V(arguments[1],br.MapOp)){for(var a=arguments[0],l=arguments[1],s=new O,m=a.iterator();m.hasNext();){var y=m.next(),D=l.map(y);D!==null&&s.add(D)}return s}};br.MapOp=function(){};var U=function(r){function e(){var t=arguments[0],n=arguments[1];r.call(this,t,n),this._ptLocator=new Ke,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new je,this._resultPolyList=new O,this._resultLineList=new O,this._resultPointList=new O,this._graph=new pt(new Ru),this._geomFact=t.getFactory()}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.insertUniqueEdge=function(t){var n=this._edgeList.findEqualEdge(t);if(n!==null){var o=n.getLabel(),a=t.getLabel();n.isPointwiseEqual(t)||(a=new et(t.getLabel()),a.flip());var l=n.getDepth();l.isNull()&&l.add(o),l.add(a),o.merge(a)}else this._edgeList.add(t)},e.prototype.getGraph=function(){return this._graph},e.prototype.cancelDuplicateResultEdges=function(){for(var t=this._graph.getEdgeEnds().iterator();t.hasNext();){var n=t.next(),o=n.getSym();n.isInResult()&&o.isInResult()&&(n.setInResult(!1),o.setInResult(!1))}},e.prototype.isCoveredByLA=function(t){return!!(this.isCovered(t,this._resultLineList)||this.isCovered(t,this._resultPolyList))},e.prototype.computeGeometry=function(t,n,o,a){var l=new O;return l.addAll(t),l.addAll(n),l.addAll(o),l.isEmpty()?e.createEmptyResult(a,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(l)},e.prototype.mergeSymLabels=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var n=t.next();n.getEdges().mergeSymLabels()}},e.prototype.isCovered=function(t,n){for(var o=this,a=n.iterator();a.hasNext();){var l=a.next(),s=o._ptLocator.locate(t,l);if(s!==E.EXTERIOR)return!0}return!1},e.prototype.replaceCollapsedEdges=function(){for(var t=new O,n=this._edgeList.iterator();n.hasNext();){var o=n.next();o.isCollapsed()&&(n.remove(),t.add(o.getCollapsedEdge()))}this._edgeList.addAll(t)},e.prototype.updateNodeLabelling=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var n=t.next(),o=n.getEdges().getLabel();n.getLabel().merge(o)}},e.prototype.getResultGeometry=function(t){return this.computeOverlay(t),this._resultGeom},e.prototype.insertUniqueEdges=function(t){for(var n=this,o=t.iterator();o.hasNext();){var a=o.next();n.insertUniqueEdge(a)}},e.prototype.computeOverlay=function(t){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var n=new O;this._arg[0].computeSplitEdges(n),this._arg[1].computeSplitEdges(n),this.insertUniqueEdges(n),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),kr.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(t),this.cancelDuplicateResultEdges();var o=new ve(this._geomFact);o.add(this._graph),this._resultPolyList=o.getPolygons();var a=new yn(this,this._geomFact,this._ptLocator);this._resultLineList=a.build(t);var l=new si(this,this._geomFact,this._ptLocator);this._resultPointList=l.build(t),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,t)},e.prototype.labelIncompleteNode=function(t,n){var o=this._ptLocator.locate(t.getCoordinate(),this._arg[n].getGeometry());t.getLabel().setLocation(n,o)},e.prototype.copyPoints=function(t){for(var n=this,o=this._arg[t].getNodeIterator();o.hasNext();){var a=o.next(),l=n._graph.addNode(a.getCoordinate());l.setLabel(t,a.getLabel().getLocation(t))}},e.prototype.findResultAreaEdges=function(t){for(var n=this._graph.getEdgeEnds().iterator();n.hasNext();){var o=n.next(),a=o.getLabel();a.isArea()&&!o.isInteriorAreaEdge()&&e.isResultOfOp(a.getLocation(0,b.RIGHT),a.getLocation(1,b.RIGHT),t)&&o.setInResult(!0)}},e.prototype.computeLabelsFromDepths=function(){for(var t=this._edgeList.iterator();t.hasNext();){var n=t.next(),o=n.getLabel(),a=n.getDepth();if(!a.isNull()){a.normalize();for(var l=0;l<2;l++)!o.isNull(l)&&o.isArea()&&!a.isNull(l)&&(a.getDelta(l)===0?o.toLine(l):(q.isTrue(!a.isNull(l,b.LEFT),"depth of LEFT side has not been initialized"),o.setLocation(l,b.LEFT,a.getLocation(l,b.LEFT)),q.isTrue(!a.isNull(l,b.RIGHT),"depth of RIGHT side has not been initialized"),o.setLocation(l,b.RIGHT,a.getLocation(l,b.RIGHT))))}}},e.prototype.computeLabelling=function(){for(var t=this,n=this._graph.getNodes().iterator();n.hasNext();){var o=n.next();o.getEdges().computeLabelling(t._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},e.prototype.labelIncompleteNodes=function(){for(var t=this,n=this._graph.getNodes().iterator();n.hasNext();){var o=n.next(),a=o.getLabel();o.isIsolated()&&(a.isNull(0)?t.labelIncompleteNode(o,0):t.labelIncompleteNode(o,1)),o.getEdges().updateLabelling(a)}},e.prototype.isCoveredByA=function(t){return!!this.isCovered(t,this._resultPolyList)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(ki);U.overlayOp=function(r,e,t){var n=new U(r,e),o=n.getResultGeometry(t);return o};U.intersection=function(r,e){if(r.isEmpty()||e.isEmpty())return U.createEmptyResult(U.INTERSECTION,r,e,r.getFactory());if(r.isGeometryCollection()){var t=e;return oi.map(r,{interfaces_:function(){return[br.MapOp]},map:function(n){return n.intersection(t)}})}return r.checkNotGeometryCollection(r),r.checkNotGeometryCollection(e),ae.overlayOp(r,e,U.INTERSECTION)};U.symDifference=function(r,e){if(r.isEmpty()||e.isEmpty()){if(r.isEmpty()&&e.isEmpty())return U.createEmptyResult(U.SYMDIFFERENCE,r,e,r.getFactory());if(r.isEmpty())return e.copy();if(e.isEmpty())return r.copy()}return r.checkNotGeometryCollection(r),r.checkNotGeometryCollection(e),ae.overlayOp(r,e,U.SYMDIFFERENCE)};U.resultDimension=function(r,e,t){var n=e.getDimension(),o=t.getDimension(),a=-1;switch(r){case U.INTERSECTION:a=Math.min(n,o);break;case U.UNION:a=Math.max(n,o);break;case U.DIFFERENCE:a=n;break;case U.SYMDIFFERENCE:a=Math.max(n,o);break}return a};U.createEmptyResult=function(r,e,t,n){var o=null;switch(U.resultDimension(r,e,t)){case-1:o=n.createGeometryCollection(new Array(0).fill(null));break;case 0:o=n.createPoint();break;case 1:o=n.createLineString();break;case 2:o=n.createPolygon();break}return o};U.difference=function(r,e){return r.isEmpty()?U.createEmptyResult(U.DIFFERENCE,r,e,r.getFactory()):e.isEmpty()?r.copy():(r.checkNotGeometryCollection(r),r.checkNotGeometryCollection(e),ae.overlayOp(r,e,U.DIFFERENCE))};U.isResultOfOp=function(){if(arguments.length===2){var r=arguments[0],e=arguments[1],t=r.getLocation(0),n=r.getLocation(1);return U.isResultOfOp(t,n,e)}else if(arguments.length===3){var o=arguments[0],a=arguments[1],l=arguments[2];switch(o===E.BOUNDARY&&(o=E.INTERIOR),a===E.BOUNDARY&&(a=E.INTERIOR),l){case U.INTERSECTION:return o===E.INTERIOR&&a===E.INTERIOR;case U.UNION:return o===E.INTERIOR||a===E.INTERIOR;case U.DIFFERENCE:return o===E.INTERIOR&&a!==E.INTERIOR;case U.SYMDIFFERENCE:return o===E.INTERIOR&&a!==E.INTERIOR||o!==E.INTERIOR&&a===E.INTERIOR}return!1}};U.INTERSECTION=1;U.UNION=2;U.DIFFERENCE=3;U.SYMDIFFERENCE=4;var ur=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new Ke,this._seg=new k;var r=arguments[0],e=arguments[1];this._g=r,this._boundaryDistanceTolerance=e,this._linework=this.extractLinework(r)};ur.prototype.isWithinToleranceOfBoundary=function(r){for(var e=this,t=0;t<this._linework.getNumGeometries();t++)for(var n=e._linework.getGeometryN(t),o=n.getCoordinateSequence(),a=0;a<o.size()-1;a++){o.getCoordinate(a,e._seg.p0),o.getCoordinate(a+1,e._seg.p1);var l=e._seg.distance(r);if(l<=e._boundaryDistanceTolerance)return!0}return!1};ur.prototype.getLocation=function(r){return this.isWithinToleranceOfBoundary(r)?E.BOUNDARY:this._ptLocator.locate(r,this._g)};ur.prototype.extractLinework=function(r){var e=new Gi;r.apply(e);var t=e.getLinework(),n=H.toLineStringArray(t);return r.getFactory().createMultiLineString(n)};ur.prototype.interfaces_=function(){return[]};ur.prototype.getClass=function(){return ur};var Gi=function(){this._linework=null,this._linework=new O};Gi.prototype.getLinework=function(){return this._linework};Gi.prototype.filter=function(r){var e=this;if(r instanceof Ot){var t=r;this._linework.add(t.getExteriorRing());for(var n=0;n<t.getNumInteriorRing();n++)e._linework.add(t.getInteriorRingN(n))}};Gi.prototype.interfaces_=function(){return[cn]};Gi.prototype.getClass=function(){return Gi};var Vr=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var r=arguments[0];this._g=r};Vr.prototype.extractPoints=function(r,e,t){for(var n=this,o=r.getCoordinates(),a=0;a<o.length-1;a++)n.computeOffsetPoints(o[a],o[a+1],e,t)};Vr.prototype.setSidesToGenerate=function(r,e){this._doLeft=r,this._doRight=e};Vr.prototype.getPoints=function(r){for(var e=this,t=new O,n=Vt.getLines(this._g),o=n.iterator();o.hasNext();){var a=o.next();e.extractPoints(a,r,t)}return t};Vr.prototype.computeOffsetPoints=function(r,e,t,n){var o=e.x-r.x,a=e.y-r.y,l=Math.sqrt(o*o+a*a),s=t*o/l,m=t*a/l,y=(e.x+r.x)/2,D=(e.y+r.y)/2;if(this._doLeft){var W=new d(y-m,D+s);n.add(W)}if(this._doRight){var Ee=new d(y+m,D-s);n.add(Ee)}};Vr.prototype.interfaces_=function(){return[]};Vr.prototype.getClass=function(){return Vr};var Re=function r(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=r.TOLERANCE,this._testCoords=new O;var e=arguments[0],t=arguments[1],n=arguments[2];this._boundaryDistanceTolerance=r.computeBoundaryDistanceTolerance(e,t),this._geom=[e,t,n],this._locFinder=[new ur(this._geom[0],this._boundaryDistanceTolerance),new ur(this._geom[1],this._boundaryDistanceTolerance),new ur(this._geom[2],this._boundaryDistanceTolerance)]},Vu={TOLERANCE:{configurable:!0}};Re.prototype.reportResult=function(r,e,t){qt.out.println("Overlay result invalid - A:"+E.toLocationSymbol(e[0])+" B:"+E.toLocationSymbol(e[1])+" expected:"+(t?"i":"e")+" actual:"+E.toLocationSymbol(e[2]))};Re.prototype.isValid=function(r){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var e=this.checkValid(r);return e};Re.prototype.checkValid=function(){var r=this;if(arguments.length===1){for(var e=arguments[0],t=0;t<this._testCoords.size();t++){var n=r._testCoords.get(t);if(!r.checkValid(e,n))return r._invalidLocation=n,!1}return!0}else if(arguments.length===2){var o=arguments[0],a=arguments[1];return this._location[0]=this._locFinder[0].getLocation(a),this._location[1]=this._locFinder[1].getLocation(a),this._location[2]=this._locFinder[2].getLocation(a),Re.hasLocation(this._location,E.BOUNDARY)?!0:this.isValidResult(o,this._location)}};Re.prototype.addTestPts=function(r){var e=new Vr(r);this._testCoords.addAll(e.getPoints(5*this._boundaryDistanceTolerance))};Re.prototype.isValidResult=function(r,e){var t=U.isResultOfOp(e[0],e[1],r),n=e[2]===E.INTERIOR,o=!(t^n);return o||this.reportResult(r,e,t),o};Re.prototype.getInvalidLocation=function(){return this._invalidLocation};Re.prototype.interfaces_=function(){return[]};Re.prototype.getClass=function(){return Re};Re.hasLocation=function(r,e){for(var t=0;t<3;t++)if(r[t]===e)return!0;return!1};Re.computeBoundaryDistanceTolerance=function(r,e){return Math.min(Et.computeSizeBasedSnapTolerance(r),Et.computeSizeBasedSnapTolerance(e))};Re.isValid=function(r,e,t,n){var o=new Re(r,e,n);return o.isValid(t)};Vu.TOLERANCE.get=function(){return 1e-6};Object.defineProperties(Re,Vu);var Ne=function r(e){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=r.extractFactory(e),this._inputGeoms=e};Ne.prototype.extractElements=function(r,e){var t=this;if(r===null)return null;for(var n=0;n<r.getNumGeometries();n++){var o=r.getGeometryN(n);t._skipEmpty&&o.isEmpty()||e.add(o)}};Ne.prototype.combine=function(){for(var r=this,e=new O,t=this._inputGeoms.iterator();t.hasNext();){var n=t.next();r.extractElements(n,e)}return e.size()===0?this._geomFactory!==null?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(e)};Ne.prototype.interfaces_=function(){return[]};Ne.prototype.getClass=function(){return Ne};Ne.combine=function(){if(arguments.length===1){var r=arguments[0],e=new Ne(r);return e.combine()}else if(arguments.length===2){var t=arguments[0],n=arguments[1],o=new Ne(Ne.createList(t,n));return o.combine()}else if(arguments.length===3){var a=arguments[0],l=arguments[1],s=arguments[2],m=new Ne(Ne.createList(a,l,s));return m.combine()}};Ne.extractFactory=function(r){return r.isEmpty()?null:r.iterator().next().getFactory()};Ne.createList=function(){if(arguments.length===2){var r=arguments[0],e=arguments[1],t=new O;return t.add(r),t.add(e),t}else if(arguments.length===3){var n=arguments[0],o=arguments[1],a=arguments[2],l=new O;return l.add(n),l.add(o),l.add(a),l}};var St=function(){this._inputPolys=null,this._geomFactory=null;var r=arguments[0];this._inputPolys=r,this._inputPolys===null&&(this._inputPolys=new O)},zu={STRTREE_NODE_CAPACITY:{configurable:!0}};St.prototype.reduceToGeometries=function(r){for(var e=this,t=new O,n=r.iterator();n.hasNext();){var o=n.next(),a=null;V(o,qe)?a=e.unionTree(o):o instanceof G&&(a=o),t.add(a)}return t};St.prototype.extractByEnvelope=function(r,e,t){for(var n=new O,o=0;o<e.getNumGeometries();o++){var a=e.getGeometryN(o);a.getEnvelopeInternal().intersects(r)?n.add(a):t.add(a)}return this._geomFactory.buildGeometry(n)};St.prototype.unionOptimized=function(r,e){var t=r.getEnvelopeInternal(),n=e.getEnvelopeInternal();if(!t.intersects(n)){var o=Ne.combine(r,e);return o}if(r.getNumGeometries()<=1&&e.getNumGeometries()<=1)return this.unionActual(r,e);var a=t.intersection(n);return this.unionUsingEnvelopeIntersection(r,e,a)};St.prototype.union=function(){if(this._inputPolys===null)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var r=new wu(St.STRTREE_NODE_CAPACITY),e=this._inputPolys.iterator();e.hasNext();){var t=e.next();r.insert(t.getEnvelopeInternal(),t)}this._inputPolys=null;var n=r.itemsTree(),o=this.unionTree(n);return o};St.prototype.binaryUnion=function(){if(arguments.length===1){var r=arguments[0];return this.binaryUnion(r,0,r.size())}else if(arguments.length===3){var e=arguments[0],t=arguments[1],n=arguments[2];if(n-t<=1){var o=St.getGeometry(e,t);return this.unionSafe(o,null)}else{if(n-t===2)return this.unionSafe(St.getGeometry(e,t),St.getGeometry(e,t+1));var a=Math.trunc((n+t)/2),l=this.binaryUnion(e,t,a),s=this.binaryUnion(e,a,n);return this.unionSafe(l,s)}}};St.prototype.repeatedUnion=function(r){for(var e=null,t=r.iterator();t.hasNext();){var n=t.next();e===null?e=n.copy():e=e.union(n)}return e};St.prototype.unionSafe=function(r,e){return r===null&&e===null?null:r===null?e.copy():e===null?r.copy():this.unionOptimized(r,e)};St.prototype.unionActual=function(r,e){return St.restrictToPolygons(r.union(e))};St.prototype.unionTree=function(r){var e=this.reduceToGeometries(r),t=this.binaryUnion(e);return t};St.prototype.unionUsingEnvelopeIntersection=function(r,e,t){var n=new O,o=this.extractByEnvelope(t,r,n),a=this.extractByEnvelope(t,e,n),l=this.unionActual(o,a);n.add(l);var s=Ne.combine(n);return s};St.prototype.bufferUnion=function(){if(arguments.length===1){var r=arguments[0],e=r.get(0).getFactory(),t=e.buildGeometry(r),n=t.buffer(0);return n}else if(arguments.length===2){var o=arguments[0],a=arguments[1],l=o.getFactory(),s=l.createGeometryCollection([o,a]),m=s.buffer(0);return m}};St.prototype.interfaces_=function(){return[]};St.prototype.getClass=function(){return St};St.restrictToPolygons=function(r){if(V(r,fr))return r;var e=jn.getPolygons(r);return e.size()===1?e.get(0):r.getFactory().createMultiPolygon(H.toPolygonArray(e))};St.getGeometry=function(r,e){return e>=r.size()?null:r.get(e)};St.union=function(r){var e=new St(r);return e.union()};zu.STRTREE_NODE_CAPACITY.get=function(){return 4};Object.defineProperties(St,zu);var Wo=function(){};Wo.prototype.interfaces_=function(){return[]};Wo.prototype.getClass=function(){return Wo};Wo.union=function(r,e){if(r.isEmpty()||e.isEmpty()){if(r.isEmpty()&&e.isEmpty())return U.createEmptyResult(U.UNION,r,e,r.getFactory());if(r.isEmpty())return e.copy();if(e.isEmpty())return r.copy()}return r.checkNotGeometryCollection(r),r.checkNotGeometryCollection(e),ae.overlayOp(r,e,U.UNION)};function Yr(){return new Ho}function Ho(){this.reset()}Ho.prototype={constructor:Ho,reset:function(){this.s=this.t=0},add:function(r){Fa(Po,r,this.t),Fa(this,Po.s,this.s),this.s?this.t+=Po.t:this.s=Po.t},valueOf:function(){return this.s}};var Po=new Ho;function Fa(r,e,t){var n=r.s=e+t,o=n-e,a=n-o;r.t=e-a+(t-o)}var vt=1e-6,it=Math.PI,Hn=it/2,Ba=it/4,er=it*2,xr=180/it,tn=it/180,ne=Math.abs,lf=Math.atan,Vi=Math.atan2,bt=Math.cos,Pt=Math.sin,Hi=Math.sqrt;function Uu(r){return r>1?0:r<-1?it:Math.acos(r)}function ui(r){return r>1?Hn:r<-1?-Hn:Math.asin(r)}function Qi(){}function jo(r,e){r&&Ga.hasOwnProperty(r.type)&&Ga[r.type](r,e)}var ka={Feature:function(r,e){jo(r.geometry,e)},FeatureCollection:function(r,e){for(var t=r.features,n=-1,o=t.length;++n<o;)jo(t[n].geometry,e)}},Ga={Sphere:function(r,e){e.sphere()},Point:function(r,e){r=r.coordinates,e.point(r[0],r[1],r[2])},MultiPoint:function(r,e){for(var t=r.coordinates,n=-1,o=t.length;++n<o;)r=t[n],e.point(r[0],r[1],r[2])},LineString:function(r,e){Fs(r.coordinates,e,0)},MultiLineString:function(r,e){for(var t=r.coordinates,n=-1,o=t.length;++n<o;)Fs(t[n],e,0)},Polygon:function(r,e){Va(r.coordinates,e)},MultiPolygon:function(r,e){for(var t=r.coordinates,n=-1,o=t.length;++n<o;)Va(t[n],e)},GeometryCollection:function(r,e){for(var t=r.geometries,n=-1,o=t.length;++n<o;)jo(t[n],e)}};function Fs(r,e,t){var n=-1,o=r.length-t,a;for(e.lineStart();++n<o;)a=r[n],e.point(a[0],a[1],a[2]);e.lineEnd()}function Va(r,e){var t=-1,n=r.length;for(e.polygonStart();++t<n;)Fs(r[t],e,1);e.polygonEnd()}function cf(r,e){r&&ka.hasOwnProperty(r.type)?ka[r.type](r,e):jo(r,e)}Yr();Yr();function Bs(r){return[Vi(r[1],r[0]),ui(r[2])]}function zi(r){var e=r[0],t=r[1],n=bt(t);return[n*bt(e),n*Pt(e),Pt(t)]}function Ro(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function Ko(r,e){return[r[1]*e[2]-r[2]*e[1],r[2]*e[0]-r[0]*e[2],r[0]*e[1]-r[1]*e[0]]}function Cs(r,e){r[0]+=e[0],r[1]+=e[1],r[2]+=e[2]}function Oo(r,e){return[r[0]*e,r[1]*e,r[2]*e]}function ks(r){var e=Hi(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);r[0]/=e,r[1]/=e,r[2]/=e}Yr();function qu(r,e){function t(n,o){return n=r(n,o),e(n[0],n[1])}return r.invert&&e.invert&&(t.invert=function(n,o){return n=e.invert(n,o),n&&r.invert(n[0],n[1])}),t}function Gs(r,e){return[r>it?r-er:r<-it?r+er:r,e]}Gs.invert=Gs;function ff(r,e,t){return(r%=er)?e||t?qu(Ua(r),qa(e,t)):Ua(r):e||t?qa(e,t):Gs}function za(r){return function(e,t){return e+=r,[e>it?e-er:e<-it?e+er:e,t]}}function Ua(r){var e=za(r);return e.invert=za(-r),e}function qa(r,e){var t=bt(r),n=Pt(r),o=bt(e),a=Pt(e);function l(s,m){var y=bt(m),D=bt(s)*y,W=Pt(s)*y,Ee=Pt(m),dt=Ee*t+D*n;return[Vi(W*o-dt*a,D*t-Ee*n),ui(dt*o+W*a)]}return l.invert=function(s,m){var y=bt(m),D=bt(s)*y,W=Pt(s)*y,Ee=Pt(m),dt=Ee*o-W*a;return[Vi(W*o+Ee*a,D*t+dt*n),ui(dt*t-D*n)]},l}function hf(r,e,t,n,o,a){if(t){var l=bt(e),s=Pt(e),m=n*t;o==null?(o=e+n*er,a=e-m/2):(o=Xa(l,o),a=Xa(l,a),(n>0?o<a:o>a)&&(o+=n*er));for(var y,D=o;n>0?D>a:D<a;D-=m)y=Bs([l,-s*bt(D),-s*Pt(D)]),r.point(y[0],y[1])}}function Xa(r,e){e=zi(e),e[0]-=r,ks(e);var t=Uu(-e[1]);return((-e[2]<0?-t:t)+er-vt)%er}function Xu(){var r=[],e;return{point:function(t,n){e.push([t,n])},lineStart:function(){r.push(e=[])},lineEnd:Qi,rejoin:function(){r.length>1&&r.push(r.pop().concat(r.shift()))},result:function(){var t=r;return r=[],e=null,t}}}function gf(r,e,t,n,o,a){var l=r[0],s=r[1],m=e[0],y=e[1],D=0,W=1,Ee=m-l,dt=y-s,Ht;if(Ht=t-l,!(!Ee&&Ht>0)){if(Ht/=Ee,Ee<0){if(Ht<D)return;Ht<W&&(W=Ht)}else if(Ee>0){if(Ht>W)return;Ht>D&&(D=Ht)}if(Ht=o-l,!(!Ee&&Ht<0)){if(Ht/=Ee,Ee<0){if(Ht>W)return;Ht>D&&(D=Ht)}else if(Ee>0){if(Ht<D)return;Ht<W&&(W=Ht)}if(Ht=n-s,!(!dt&&Ht>0)){if(Ht/=dt,dt<0){if(Ht<D)return;Ht<W&&(W=Ht)}else if(dt>0){if(Ht>W)return;Ht>D&&(D=Ht)}if(Ht=a-s,!(!dt&&Ht<0)){if(Ht/=dt,dt<0){if(Ht>W)return;Ht>D&&(D=Ht)}else if(dt>0){if(Ht<D)return;Ht<W&&(W=Ht)}return D>0&&(r[0]=l+D*Ee,r[1]=s+D*dt),W<1&&(e[0]=l+W*Ee,e[1]=s+W*dt),!0}}}}}function Bo(r,e){return ne(r[0]-e[0])<vt&&ne(r[1]-e[1])<vt}function To(r,e,t,n){this.x=r,this.z=e,this.o=t,this.e=n,this.v=!1,this.n=this.p=null}function Yu(r,e,t,n,o){var a=[],l=[],s,m;if(r.forEach(function(Ht){if(!((ir=Ht.length-1)<=0)){var ir,Hr=Ht[0],Bn=Ht[ir],Vn;if(Bo(Hr,Bn)){for(o.lineStart(),s=0;s<ir;++s)o.point((Hr=Ht[s])[0],Hr[1]);o.lineEnd();return}a.push(Vn=new To(Hr,Ht,null,!0)),l.push(Vn.o=new To(Hr,null,Vn,!1)),a.push(Vn=new To(Bn,Ht,null,!1)),l.push(Vn.o=new To(Bn,null,Vn,!0))}}),!!a.length){for(l.sort(e),Ya(a),Ya(l),s=0,m=l.length;s<m;++s)l[s].e=t=!t;for(var y=a[0],D,W;;){for(var Ee=y,dt=!0;Ee.v;)if((Ee=Ee.n)===y)return;D=Ee.z,o.lineStart();do{if(Ee.v=Ee.o.v=!0,Ee.e){if(dt)for(s=0,m=D.length;s<m;++s)o.point((W=D[s])[0],W[1]);else n(Ee.x,Ee.n.x,1,o);Ee=Ee.n}else{if(dt)for(D=Ee.p.z,s=D.length-1;s>=0;--s)o.point((W=D[s])[0],W[1]);else n(Ee.x,Ee.p.x,-1,o);Ee=Ee.p}Ee=Ee.o,D=Ee.z,dt=!dt}while(!Ee.v);o.lineEnd()}}}function Ya(r){if(e=r.length){for(var e,t=0,n=r[0],o;++t<e;)n.n=o=r[t],o.p=n,n=o;n.n=o=r[0],o.p=n}}function Wu(r,e){return r<e?-1:r>e?1:r>=e?0:NaN}function pf(r){return r.length===1&&(r=df(r)),{left:function(e,t,n,o){for(n==null&&(n=0),o==null&&(o=e.length);n<o;){var a=n+o>>>1;r(e[a],t)<0?n=a+1:o=a}return n},right:function(e,t,n,o){for(n==null&&(n=0),o==null&&(o=e.length);n<o;){var a=n+o>>>1;r(e[a],t)>0?o=a:n=a+1}return n}}}function df(r){return function(e,t){return Wu(r(e),t)}}pf(Wu);function Hu(r){for(var e=r.length,t,n=-1,o=0,a,l;++n<e;)o+=r[n].length;for(a=new Array(o);--e>=0;)for(l=r[e],t=l.length;--t>=0;)a[--o]=l[t];return a}var Zi=1e9,Do=-Zi;function vf(r,e,t,n){function o(y,D){return r<=y&&y<=t&&e<=D&&D<=n}function a(y,D,W,Ee){var dt=0,Ht=0;if(y==null||(dt=l(y,W))!==(Ht=l(D,W))||m(y,D)<0^W>0)do Ee.point(dt===0||dt===3?r:t,dt>1?n:e);while((dt=(dt+W+4)%4)!==Ht);else Ee.point(D[0],D[1])}function l(y,D){return ne(y[0]-r)<vt?D>0?0:3:ne(y[0]-t)<vt?D>0?2:1:ne(y[1]-e)<vt?D>0?1:0:D>0?3:2}function s(y,D){return m(y.x,D.x)}function m(y,D){var W=l(y,1),Ee=l(D,1);return W!==Ee?W-Ee:W===0?D[1]-y[1]:W===1?y[0]-D[0]:W===2?y[1]-D[1]:D[0]-y[0]}return function(y){var D=y,W=Xu(),Ee,dt,Ht,ir,Hr,Bn,Vn,Wr,ps,il,gl,ml={point:sl,lineStart:nh,lineEnd:bh,polygonStart:rl,polygonEnd:th};function sl(Bh,Ed){o(Bh,Ed)&&D.point(Bh,Ed)}function ll(){for(var Bh=0,Ed=0,Td=dt.length;Ed<Td;++Ed)for(var td=dt[Ed],Fd=1,Ld=td.length,Ud=td[0],Xd,wd,zd=Ud[0],Rd=Ud[1];Fd<Ld;++Fd)Xd=zd,wd=Rd,Ud=td[Fd],zd=Ud[0],Rd=Ud[1],wd<=n?Rd>n&&(zd-Xd)*(n-wd)>(Rd-wd)*(r-Xd)&&++Bh:Rd<=n&&(zd-Xd)*(n-wd)<(Rd-wd)*(r-Xd)&&--Bh;return Bh}function rl(){D=W,Ee=[],dt=[],gl=!0}function th(){var Bh=ll(),Ed=gl&&Bh,Td=(Ee=Hu(Ee)).length;(Ed||Td)&&(y.polygonStart(),Ed&&(y.lineStart(),a(null,null,1,y),y.lineEnd()),Td&&Yu(Ee,s,Bh,a,y),y.polygonEnd()),D=y,Ee=dt=Ht=null}function nh(){ml.point=Fh,dt&&dt.push(Ht=[]),il=!0,ps=!1,Vn=Wr=NaN}function bh(){Ee&&(Fh(ir,Hr),Bn&&ps&&W.rejoin(),Ee.push(W.result())),ml.point=sl,ps&&D.lineEnd()}function Fh(Bh,Ed){var Td=o(Bh,Ed);if(dt&&Ht.push([Bh,Ed]),il)ir=Bh,Hr=Ed,Bn=Td,il=!1,Td&&(D.lineStart(),D.point(Bh,Ed));else if(Td&&ps)D.point(Bh,Ed);else{var td=[Vn=Math.max(Do,Math.min(Zi,Vn)),Wr=Math.max(Do,Math.min(Zi,Wr))],Fd=[Bh=Math.max(Do,Math.min(Zi,Bh)),Ed=Math.max(Do,Math.min(Zi,Ed))];gf(td,Fd,r,e,t,n)?(ps||(D.lineStart(),D.point(td[0],td[1])),D.point(Fd[0],Fd[1]),Td||D.lineEnd(),gl=!1):Td&&(D.lineStart(),D.point(Bh,Ed),gl=!1)}Vn=Bh,Wr=Ed,ps=Td}return ml}}var Ns=Yr();function yf(r,e){var t=e[0],n=e[1],o=[Pt(t),-bt(t),0],a=0,l=0;Ns.reset();for(var s=0,m=r.length;s<m;++s)if(D=(y=r[s]).length)for(var y,D,W=y[D-1],Ee=W[0],dt=W[1]/2+Ba,Ht=Pt(dt),ir=bt(dt),Hr=0;Hr<D;++Hr,Ee=Vn,Ht=ps,ir=il,W=Bn){var Bn=y[Hr],Vn=Bn[0],Wr=Bn[1]/2+Ba,ps=Pt(Wr),il=bt(Wr),gl=Vn-Ee,ml=gl>=0?1:-1,sl=ml*gl,ll=sl>it,rl=Ht*ps;if(Ns.add(Vi(rl*ml*Pt(sl),ir*il+rl*bt(sl))),a+=ll?gl+ml*er:gl,ll^Ee>=t^Vn>=t){var th=Ko(zi(W),zi(Bn));ks(th);var nh=Ko(o,th);ks(nh);var bh=(ll^gl>=0?-1:1)*ui(nh[2]);(n>bh||n===bh&&(th[0]||th[1]))&&(l+=ll^gl>=0?1:-1)}}return(a<-vt||a<vt&&Ns<-vt)^l&1}Yr();function Wa(r){return r}Yr();Yr();var Ui=1/0,Qo=Ui,yo=-Ui,Zo=yo,Ha={point:mf,lineStart:Qi,lineEnd:Qi,polygonStart:Qi,polygonEnd:Qi,result:function(){var r=[[Ui,Qo],[yo,Zo]];return yo=Zo=-(Qo=Ui=1/0),r}};function mf(r,e){r<Ui&&(Ui=r),r>yo&&(yo=r),e<Qo&&(Qo=e),e>Zo&&(Zo=e)}Yr();function ju(r,e,t,n){return function(o,a){var l=e(a),s=o.invert(n[0],n[1]),m=Xu(),y=e(m),D=!1,W,Ee,dt,Ht={point:ir,lineStart:Bn,lineEnd:Vn,polygonStart:function(){Ht.point=Wr,Ht.lineStart=ps,Ht.lineEnd=il,Ee=[],W=[]},polygonEnd:function(){Ht.point=ir,Ht.lineStart=Bn,Ht.lineEnd=Vn,Ee=Hu(Ee);var gl=yf(W,s);Ee.length?(D||(a.polygonStart(),D=!0),Yu(Ee,Ef,gl,t,a)):gl&&(D||(a.polygonStart(),D=!0),a.lineStart(),t(null,null,1,a),a.lineEnd()),D&&(a.polygonEnd(),D=!1),Ee=W=null},sphere:function(){a.polygonStart(),a.lineStart(),t(null,null,1,a),a.lineEnd(),a.polygonEnd()}};function ir(gl,ml){var sl=o(gl,ml);r(gl=sl[0],ml=sl[1])&&a.point(gl,ml)}function Hr(gl,ml){var sl=o(gl,ml);l.point(sl[0],sl[1])}function Bn(){Ht.point=Hr,l.lineStart()}function Vn(){Ht.point=ir,l.lineEnd()}function Wr(gl,ml){dt.push([gl,ml]);var sl=o(gl,ml);y.point(sl[0],sl[1])}function ps(){y.lineStart(),dt=[]}function il(){Wr(dt[0][0],dt[0][1]),y.lineEnd();var gl=y.clean(),ml=m.result(),sl,ll=ml.length,rl,th,nh;if(dt.pop(),W.push(dt),dt=null,!!ll){if(gl&1){if(th=ml[0],(rl=th.length-1)>0){for(D||(a.polygonStart(),D=!0),a.lineStart(),sl=0;sl<rl;++sl)a.point((nh=th[sl])[0],nh[1]);a.lineEnd()}return}ll>1&&gl&2&&ml.push(ml.pop().concat(ml.shift())),Ee.push(ml.filter(_f))}}return Ht}}function _f(r){return r.length>1}function Ef(r,e){return((r=r.x)[0]<0?r[1]-Hn-vt:Hn-r[1])-((e=e.x)[0]<0?e[1]-Hn-vt:Hn-e[1])}const ja=ju(function(){return!0},If,Nf,[-it,-Hn]);function If(r){var e=NaN,t=NaN,n=NaN,o;return{lineStart:function(){r.lineStart(),o=1},point:function(a,l){var s=a>0?it:-it,m=ne(a-e);ne(m-it)<vt?(r.point(e,t=(t+l)/2>0?Hn:-Hn),r.point(n,t),r.lineEnd(),r.lineStart(),r.point(s,t),r.point(a,t),o=0):n!==s&&m>=it&&(ne(e-n)<vt&&(e-=n*vt),ne(a-s)<vt&&(a-=s*vt),t=Cf(e,t,a,l),r.point(n,t),r.lineEnd(),r.lineStart(),r.point(s,t),o=0),r.point(e=a,t=l),n=s},lineEnd:function(){r.lineEnd(),e=t=NaN},clean:function(){return 2-o}}}function Cf(r,e,t,n){var o,a,l=Pt(r-t);return ne(l)>vt?lf((Pt(e)*(a=bt(n))*Pt(t)-Pt(n)*(o=bt(e))*Pt(r))/(o*a*l)):(e+n)/2}function Nf(r,e,t,n){var o;if(r==null)o=t*Hn,n.point(-it,o),n.point(0,o),n.point(it,o),n.point(it,0),n.point(it,-o),n.point(0,-o),n.point(-it,-o),n.point(-it,0),n.point(-it,o);else if(ne(r[0]-e[0])>vt){var a=r[0]<e[0]?it:-it;o=t*a/2,n.point(-a,o),n.point(0,o),n.point(a,o)}else n.point(e[0],e[1])}function xf(r,e){var t=bt(r),n=t>0,o=ne(t)>vt;function a(D,W,Ee,dt){hf(dt,r,e,Ee,D,W)}function l(D,W){return bt(D)*bt(W)>t}function s(D){var W,Ee,dt,Ht,ir;return{lineStart:function(){Ht=dt=!1,ir=1},point:function(Hr,Bn){var Vn=[Hr,Bn],Wr,ps=l(Hr,Bn),il=n?ps?0:y(Hr,Bn):ps?y(Hr+(Hr<0?it:-it),Bn):0;if(!W&&(Ht=dt=ps)&&D.lineStart(),ps!==dt&&(Wr=m(W,Vn),(!Wr||Bo(W,Wr)||Bo(Vn,Wr))&&(Vn[0]+=vt,Vn[1]+=vt,ps=l(Vn[0],Vn[1]))),ps!==dt)ir=0,ps?(D.lineStart(),Wr=m(Vn,W),D.point(Wr[0],Wr[1])):(Wr=m(W,Vn),D.point(Wr[0],Wr[1]),D.lineEnd()),W=Wr;else if(o&&W&&n^ps){var gl;!(il&Ee)&&(gl=m(Vn,W,!0))&&(ir=0,n?(D.lineStart(),D.point(gl[0][0],gl[0][1]),D.point(gl[1][0],gl[1][1]),D.lineEnd()):(D.point(gl[1][0],gl[1][1]),D.lineEnd(),D.lineStart(),D.point(gl[0][0],gl[0][1])))}ps&&(!W||!Bo(W,Vn))&&D.point(Vn[0],Vn[1]),W=Vn,dt=ps,Ee=il},lineEnd:function(){dt&&D.lineEnd(),W=null},clean:function(){return ir|(Ht&&dt)<<1}}}function m(D,W,Ee){var dt=zi(D),Ht=zi(W),ir=[1,0,0],Hr=Ko(dt,Ht),Bn=Ro(Hr,Hr),Vn=Hr[0],Wr=Bn-Vn*Vn;if(!Wr)return!Ee&&D;var ps=t*Bn/Wr,il=-t*Vn/Wr,gl=Ko(ir,Hr),ml=Oo(ir,ps),sl=Oo(Hr,il);Cs(ml,sl);var ll=gl,rl=Ro(ml,ll),th=Ro(ll,ll),nh=rl*rl-th*(Ro(ml,ml)-1);if(!(nh<0)){var bh=Hi(nh),Fh=Oo(ll,(-rl-bh)/th);if(Cs(Fh,ml),Fh=Bs(Fh),!Ee)return Fh;var Bh=D[0],Ed=W[0],Td=D[1],td=W[1],Fd;Ed<Bh&&(Fd=Bh,Bh=Ed,Ed=Fd);var Ld=Ed-Bh,Ud=ne(Ld-it)<vt,Xd=Ud||Ld<vt;if(!Ud&&td<Td&&(Fd=Td,Td=td,td=Fd),Xd?Ud?Td+td>0^Fh[1]<(ne(Fh[0]-Bh)<vt?Td:td):Td<=Fh[1]&&Fh[1]<=td:Ld>it^(Bh<=Fh[0]&&Fh[0]<=Ed)){var wd=Oo(ll,(-rl+bh)/th);return Cs(wd,ml),[Fh,Bs(wd)]}}}function y(D,W){var Ee=n?r:it-r,dt=0;return D<-Ee?dt|=1:D>Ee&&(dt|=2),W<-Ee?dt|=4:W>Ee&&(dt|=8),dt}return ju(l,s,a,n?[0,-r]:[-it,r-it])}function Ku(r){return function(e){var t=new Vs;for(var n in r)t[n]=r[n];return t.stream=e,t}}function Vs(){}Vs.prototype={constructor:Vs,point:function(r,e){this.stream.point(r,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Qu(r,e,t){var n=e[1][0]-e[0][0],o=e[1][1]-e[0][1],a=r.clipExtent&&r.clipExtent();r.scale(150).translate([0,0]),a!=null&&r.clipExtent(null),cf(t,r.stream(Ha));var l=Ha.result(),s=Math.min(n/(l[1][0]-l[0][0]),o/(l[1][1]-l[0][1])),m=+e[0][0]+(n-s*(l[1][0]+l[0][0]))/2,y=+e[0][1]+(o-s*(l[1][1]+l[0][1]))/2;return a!=null&&r.clipExtent(a),r.scale(s*150).translate([m,y])}function Sf(r,e,t){return Qu(r,[[0,0],e],t)}var Ka=16,wf=bt(30*tn);function Qa(r,e){return+e?bf(r,e):Lf(r)}function Lf(r){return Ku({point:function(e,t){e=r(e,t),this.stream.point(e[0],e[1])}})}function bf(r,e){function t(n,o,a,l,s,m,y,D,W,Ee,dt,Ht,ir,Hr){var Bn=y-n,Vn=D-o,Wr=Bn*Bn+Vn*Vn;if(Wr>4*e&&ir--){var ps=l+Ee,il=s+dt,gl=m+Ht,ml=Hi(ps*ps+il*il+gl*gl),sl=ui(gl/=ml),ll=ne(ne(gl)-1)<vt||ne(a-W)<vt?(a+W)/2:Vi(il,ps),rl=r(ll,sl),th=rl[0],nh=rl[1],bh=th-n,Fh=nh-o,Bh=Vn*bh-Bn*Fh;(Bh*Bh/Wr>e||ne((Bn*bh+Vn*Fh)/Wr-.5)>.3||l*Ee+s*dt+m*Ht<wf)&&(t(n,o,a,l,s,m,th,nh,ll,ps/=ml,il/=ml,gl,ir,Hr),Hr.point(th,nh),t(th,nh,ll,ps,il,gl,y,D,W,Ee,dt,Ht,ir,Hr))}}return function(n){var o,a,l,s,m,y,D,W,Ee,dt,Ht,ir,Hr={point:Bn,lineStart:Vn,lineEnd:ps,polygonStart:function(){n.polygonStart(),Hr.lineStart=il},polygonEnd:function(){n.polygonEnd(),Hr.lineStart=Vn}};function Bn(sl,ll){sl=r(sl,ll),n.point(sl[0],sl[1])}function Vn(){W=NaN,Hr.point=Wr,n.lineStart()}function Wr(sl,ll){var rl=zi([sl,ll]),th=r(sl,ll);t(W,Ee,D,dt,Ht,ir,W=th[0],Ee=th[1],D=sl,dt=rl[0],Ht=rl[1],ir=rl[2],Ka,n),n.point(W,Ee)}function ps(){Hr.point=Bn,n.lineEnd()}function il(){Vn(),Hr.point=gl,Hr.lineEnd=ml}function gl(sl,ll){Wr(o=sl,ll),a=W,l=Ee,s=dt,m=Ht,y=ir,Hr.point=Wr}function ml(){t(W,Ee,D,dt,Ht,ir,a,l,o,s,m,y,Ka,n),Hr.lineEnd=ps,ps()}return Hr}}var Pf=Ku({point:function(r,e){this.stream.point(r*tn,e*tn)}});function Rf(r){return Of(function(){return r})()}function Of(r){var e,t=150,n=480,o=250,a,l,s=0,m=0,y=0,D=0,W=0,Ee,dt,Ht=null,ir=ja,Hr=null,Bn,Vn,Wr,ps=Wa,il=.5,gl=Qa(th,il),ml,sl;function ll(Fh){return Fh=dt(Fh[0]*tn,Fh[1]*tn),[Fh[0]*t+a,l-Fh[1]*t]}function rl(Fh){return Fh=dt.invert((Fh[0]-a)/t,(l-Fh[1])/t),Fh&&[Fh[0]*xr,Fh[1]*xr]}function th(Fh,Bh){return Fh=e(Fh,Bh),[Fh[0]*t+a,l-Fh[1]*t]}ll.stream=function(Fh){return ml&&sl===Fh?ml:ml=Pf(ir(Ee,gl(ps(sl=Fh))))},ll.clipAngle=function(Fh){return arguments.length?(ir=+Fh?xf(Ht=Fh*tn,6*tn):(Ht=null,ja),bh()):Ht*xr},ll.clipExtent=function(Fh){return arguments.length?(ps=Fh==null?(Hr=Bn=Vn=Wr=null,Wa):vf(Hr=+Fh[0][0],Bn=+Fh[0][1],Vn=+Fh[1][0],Wr=+Fh[1][1]),bh()):Hr==null?null:[[Hr,Bn],[Vn,Wr]]},ll.scale=function(Fh){return arguments.length?(t=+Fh,nh()):t},ll.translate=function(Fh){return arguments.length?(n=+Fh[0],o=+Fh[1],nh()):[n,o]},ll.center=function(Fh){return arguments.length?(s=Fh[0]%360*tn,m=Fh[1]%360*tn,nh()):[s*xr,m*xr]},ll.rotate=function(Fh){return arguments.length?(y=Fh[0]%360*tn,D=Fh[1]%360*tn,W=Fh.length>2?Fh[2]%360*tn:0,nh()):[y*xr,D*xr,W*xr]},ll.precision=function(Fh){return arguments.length?(gl=Qa(th,il=Fh*Fh),bh()):Hi(il)},ll.fitExtent=function(Fh,Bh){return Qu(ll,Fh,Bh)},ll.fitSize=function(Fh,Bh){return Sf(ll,Fh,Bh)};function nh(){dt=qu(Ee=ff(y,D,W),e);var Fh=e(s,m);return a=n-Fh[0]*t,l=o+Fh[1]*t,bh()}function bh(){return ml=sl=null,ll}return function(){return e=r.apply(this,arguments),ll.invert=e.invert&&rl,nh()}}function Zu(r){return function(e,t){var n=bt(e),o=bt(t),a=r(n*o);return[a*o*Pt(e),a*Pt(t)]}}function Ju(r){return function(e,t){var n=Hi(e*e+t*t),o=r(n),a=Pt(o),l=bt(o);return[Vi(e*a,n*l),ui(n&&t*a/n)]}}var Tf=Zu(function(r){return Hi(2/(1+r))});Tf.invert=Ju(function(r){return 2*ui(r/2)});var $u=Zu(function(r){return(r=Uu(r))&&r/Pt(r)});$u.invert=Ju(function(r){return r});function Df(){return Rf($u).scale(79.4188).clipAngle(180-.001)}function Za(r,e){return[r,e]}Za.invert=Za;function Mf(r,e,t){t=t||{};var n=t.units||"kilometers",o=t.steps||8;if(!r)throw new Error("geojson is required");if(typeof t!="object")throw new Error("options must be an object");if(typeof o!="number")throw new Error("steps must be an number");if(e===void 0)throw new Error("radius is required");if(o<=0)throw new Error("steps must be greater than 0");var a=[];switch(r.type){case"GeometryCollection":return pu(r,function(l){var s=ko(l,e,n,o);s&&a.push(s)}),Ds(a);case"FeatureCollection":return Oa(r,function(l){var s=ko(l,e,n,o);s&&Oa(s,function(m){m&&a.push(m)})}),Ds(a)}return ko(r,e,n,o)}function ko(r,e,t,n){var o=r.properties||{},a=r.type==="Feature"?r.geometry:r;if(a.type==="GeometryCollection"){var l=[];return pu(r,function(ir){var Hr=ko(ir,e,t,n);Hr&&l.push(Hr)}),Ds(l)}var s=Af(a),m={type:a.type,coordinates:el(a.coordinates,s)},y=new Ks,D=y.read(m),W=kc(Gc(e,t),"meters"),Ee=zt.bufferOp(D,W,n),dt=new xu;if(Ee=dt.write(Ee),!tl(Ee.coordinates)){var Ht={type:Ee.type,coordinates:nl(Ee.coordinates,s)};return Jo(Ht,o)}}function tl(r){return Array.isArray(r[0])?tl(r[0]):isNaN(r[0])}function el(r,e){return typeof r[0]!="object"?e(r):r.map(function(t){return el(t,e)})}function nl(r,e){return typeof r[0]!="object"?e.invert(r):r.map(function(t){return nl(t,e)})}function Af(r){var e=Xc(r).geometry.coordinates,t=[-e[0],-e[1]];return Df().rotate(t).scale(Ie)}function Ff(r,e){var t=zo(r),n=zo(e),o=r.properties||{},a=lu.difference(t.coordinates,n.coordinates);return a.length===0?null:a.length===1?fu(a[0],o):hu(a,o)}function Ja(r){let e;for(const t of r)e&&t[0]-e[0]>=180?t[0]-=360:e&&t[0]-e[0]<-180&&(t[0]+=360),e=t}function $a(r,e){const t=Ff({type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]},r);if(!t)return;t.properties={isMask:"y"};const n=Mf(r,0);if(n.geometry.type==="Polygon")for(const o of n.geometry.coordinates)Ja(o);else for(const o of n.geometry.coordinates)for(const a of o)Ja(a);e({type:"FeatureCollection",features:[n,t]})}let tu={type:"FeatureCollection",features:[]};function Bf(r,e,t=!0,n=!0,o={},a={},l={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}}){let s,m,y=[],D,W;function Ee(){(l!=null&&l.fill||l!=null&&l.line)&&r.addSource("full-geom",{type:"geojson",data:tu}),l!=null&&l.fill&&r.addLayer({...l==null?void 0:l.fill,id:"full-geom-fill",type:"fill",source:"full-geom"}),l!=null&&l.line&&r.addLayer({...l==null?void 0:l.line,id:"full-geom-line",type:"line",source:"full-geom"})}r.loaded()?Ee():r.once("load",()=>{Ee()});const dt=Hr=>{s==null||s({type:"mapClick",coordinates:[Hr.lngLat.lng,Hr.lngLat.lat]})},Ht=()=>{let Hr;const Bn=r.getZoom()>9?[(Hr=r.getCenter().wrap()).lng,Hr.lat]:void 0;m!==Bn&&(m=Bn,s==null||s({type:"proximityChange",proximity:Bn}))};function ir(Hr=!1){if(!e)throw new Error;const Bn=document.createElement("div");return Hr&&Bn.classList.add("marker-interactive"),new qc({props:{displayIn:"maplibre"},target:Bn}),new e.Marker({element:Bn,offset:[1,-13]})}return{setEventHandler(Hr){Hr?(s=Hr,r.on("moveend",Ht),Ht(),r.on("click",dt)):(r.off("moveend",Ht),s==null||s({type:"proximityChange",proximity:void 0}),s=void 0,r.off("click",dt))},flyTo(Hr,Bn){r.flyTo({center:Hr,zoom:Bn,...o})},fitBounds(Hr,Bn,Vn){r.fitBounds([[Hr[0],Hr[1]],[Hr[2],Hr[3]]],{padding:Bn,maxZoom:Vn,...a})},indicateReverse(Hr){r.getCanvasContainer().style.cursor=Hr?"crosshair":""},setReverseMarker(Hr){!e||!t||(W?Hr?W.setLngLat(Hr):(W.remove(),W=void 0):Hr&&(W=(typeof t=="object"?new e.Marker(t):ir()).setLngLat(Hr).addTo(r),W.getElement().classList.add("marker-reverse")))},setMarkers(Hr,Bn){if(!t)return;function Vn(Wr){var ps;(ps=r.getSource("full-geom"))==null||ps.setData(Wr)}for(const Wr of y)Wr.remove();if(y.length=0,Vn(tu),!!e){if(Bn){let Wr=!1;if(Bn.geometry.type==="GeometryCollection"){const ps=Bn.geometry.geometries.filter(il=>il.type==="Polygon"||il.type==="MultiPolygon");if(ps.length>0){let il=ps.pop();for(const gl of ps)il=Vc(il,gl);$a({...Bn,geometry:il},Vn),Wr=!0}else{const il=Bn.geometry.geometries.filter(gl=>gl.type==="LineString"||gl.type==="MultiLineString");il.length>0&&(Vn({...Bn,geometry:{type:"GeometryCollection",geometries:il}}),Wr=!0)}}if(!Wr){if(Bn.geometry.type==="Polygon"||Bn.geometry.type==="MultiPolygon")$a(Bn,Vn);else if(Bn.geometry.type==="LineString"||Bn.geometry.type==="MultiLineString"){Vn(Bn);return}}t&&y.push((typeof t=="object"?new e.Marker(t):ir()).setLngLat(Bn.center).addTo(r))}if(n)for(const Wr of Hr??[]){if(Wr===Bn)continue;const ps=(typeof n=="object"?new e.Marker(n):ir(!0)).setLngLat(Wr.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(Wr.place_name.replace(/,.*/,""))).addTo(r),il=ps.getElement();il.addEventListener("click",gl=>{gl.stopPropagation(),s==null||s({type:"markerClick",id:Wr.id})}),il.addEventListener("mouseenter",()=>{s==null||s({type:"markerMouseEnter",id:Wr.id}),ps.togglePopup()}),il.addEventListener("mouseleave",()=>{s==null||s({type:"markerMouseLeave",id:Wr.id}),ps.togglePopup()}),y.push(ps)}}},setSelectedMarker(Hr){D&&D.getElement().classList.toggle("marker-selected",!1),D=Hr>-1?y[Hr]:void 0,D==null||D.getElement().classList.toggle("marker-selected",!0)}}}var Cn,Kr;class kf extends EventTarget{constructor(e={}){super(),ms(this,Cn,void 0),ms(this,Kr,void 0),Lo(this,Kr,e)}onAdd(e){const t=document.createElement("div");t.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:n,showResultMarkers:o,flyTo:a,fullGeometryStyle:l,...s}=zn(this,Kr),m=typeof a=="boolean"?{}:a,y=this.getExtraProps(e,t),D={mapController:Bf(e,this.getMapLibreGl(),n,o,m,m,l),flyTo:a===void 0?!0:!!a,apiKey:"",...y,...s};if(!D.apiKey)throw new Error("no apiKey provided");Lo(this,Cn,new pc({target:t,props:D}));for(const W of["select","pick","featuresListed","featuresMarked","response","optionsVisibilityChange","reverseToggle","queryChange"])zn(this,Cn).$on(W,Ee=>this.dispatchEvent(Ee));return t}setOptions(e){var t;Lo(this,Kr,e);const{marker:n,showResultMarkers:o,flyTo:a,fullGeometryStyle:l,...s}=zn(this,Kr);(t=zn(this,Cn))==null||t.$set(s)}setQuery(e,t=!0){var n;(n=zn(this,Cn))==null||n.setQuery(e,t)}setReverseMode(e){var t;(t=zn(this,Cn))==null||t.$set({reverseActive:e})}focus(){var e;(e=zn(this,Cn))==null||e.focus()}blur(){var e;(e=zn(this,Cn))==null||e.blur()}onRemove(){var e;(e=zn(this,Cn))==null||e.$destroy()}}Cn=new WeakMap,Kr=new WeakMap;class zf extends kf{getMapLibreGl(){return Cl}getExtraProps(e,t){const n={};if(!("getSdkConfig"in e&&typeof e.getSdkConfig=="function"))throw new Error("MapTiler SDK not detected");const{primaryLanguage:o,apiKey:a}=e.getSdkConfig();n.apiKey=a;const l=/^([a-z]{2})($|_|-)/.exec(o);return l&&(n.language=l[1]),t.className+=" maptiler-ctrl",n}}const maptilerSdk="",style="";/**
          * @ag-grid-community/all-modules - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue * @version v30.0.5
          * @link https://www.ag-grid.com/
          * @license MIT
          */function makeNull(r){return r==null||r===""?null:r}function exists(r,e=!1){return r!=null&&(r!==""||e)}function missing(r){return!exists(r)}function missingOrEmpty(r){return r==null||r.length===0}function toStringOrNull(r){return r!=null&&typeof r.toString=="function"?r.toString():null}function attrToNumber(r){if(r===void 0)return;if(r===null||r==="")return null;if(typeof r=="number")return isNaN(r)?void 0:r;const e=parseInt(r,10);return isNaN(e)?void 0:e}function attrToBoolean(r){if(r!==void 0)return r===null||r===""?!1:typeof r=="boolean"?r:/true/i.test(r)}function attrToString(r){if(!(r==null||r===""))return r}function referenceCompare(r,e){return r==null&&e==null?!0:r==null&&e!=null||r!=null&&e==null?!1:r===e}function jsonEquals(r,e){const t=r?JSON.stringify(r):null,n=e?JSON.stringify(e):null;return t===n}function defaultComparator(r,e,t=!1){const n=r==null,o=e==null;if(r&&r.toNumber&&(r=r.toNumber()),e&&e.toNumber&&(e=e.toNumber()),n&&o)return 0;if(n)return-1;if(o)return 1;function a(l,s){return l>s?1:l<s?-1:0}if(typeof r!="string"||!t)return a(r,e);try{return r.localeCompare(e)}catch{return a(r,e)}}function values(r){if(r instanceof Set||r instanceof Map){const e=[];return r.forEach(t=>e.push(t)),e}return Object.values(r)}var GenericUtils=Object.freeze({__proto__:null,makeNull,exists,missing,missingOrEmpty,toStringOrNull,attrToNumber,attrToBoolean,attrToString,referenceCompare,jsonEquals,defaultComparator,values});class ColumnKeyCreator{constructor(){this.existingKeys={}}addExistingKeys(e){for(let t=0;t<e.length;t++)this.existingKeys[e[t]]=!0}getUniqueKey(e,t){e=toStringOrNull(e);let n=0;for(;;){let o;if(e?(o=e,n!==0&&(o+="_"+n)):t?(o=t,n!==0&&(o+="_"+n)):o=""+n,!this.existingKeys[o])return this.existingKeys[o]=!0,o;n++}}}function iterateObject(r,e){r!=null&&(Array.isArray(r)?r.forEach((t,n)=>e(`${n}`,t)):Object.keys(r).forEach(t=>e(t,r[t])))}function cloneObject(r){const e={},t=Object.keys(r);for(let n=0;n<t.length;n++){const o=t[n],a=r[o];e[o]=a}return e}function deepCloneObject(r){return JSON.parse(JSON.stringify(r))}function deepCloneDefinition(r,e){if(!r)return;const t=r,n={};return Object.keys(t).forEach(o=>{if(e&&e.indexOf(o)>=0)return;const a=t[o];isNonNullObject(a)&&a.constructor===Object?n[o]=deepCloneDefinition(a):n[o]=a}),n}function getProperty(r,e){return r[e]}function setProperty(r,e,t){r[e]=t}function copyPropertiesIfPresent(r,e,...t){t.forEach(n=>copyPropertyIfPresent(r,e,n))}function copyPropertyIfPresent(r,e,t,n){const o=getProperty(r,t);o!==void 0&&setProperty(e,t,n?n(o):o)}function getAllKeysInObjects(r){const e={};return r.filter(t=>t!=null).forEach(t=>{Object.keys(t).forEach(n=>e[n]=null)}),Object.keys(e)}function getAllValuesInObject(r){if(!r)return[];const e=Object;if(typeof e.values=="function")return e.values(r);const t=[];for(const n in r)r.hasOwnProperty(n)&&r.propertyIsEnumerable(n)&&t.push(r[n]);return t}function mergeDeep(r,e,t=!0,n=!1){exists(e)&&iterateObject(e,(o,a)=>{let l=r[o];l!==a&&(n&&l==null&&a!=null&&typeof a=="object"&&a.constructor===Object&&(l={},r[o]=l),isNonNullObject(a)&&isNonNullObject(l)&&!Array.isArray(l)?mergeDeep(l,a,t,n):(t||a!==void 0)&&(r[o]=a))})}function missingOrEmptyObject(r){return missing(r)||Object.keys(r).length===0}function get$1(r,e,t){if(r==null)return t;const n=e.split(".");let o=r;for(;n.length>1;)if(o=o[n.shift()],o==null)return t;const a=o[n[0]];return a??t}function set$1(r,e,t){if(r==null)return;const n=e.split(".");let o=r;n.forEach((a,l)=>{o[a]||(o[a]={}),l<n.length-1&&(o=o[a])}),o[n[n.length-1]]=t}function getValueUsingField(r,e,t){if(!e||!r)return;if(!t)return r[e];const n=e.split(".");let o=r;for(let a=0;a<n.length;a++){if(o==null)return;o=o[n[a]]}return o}function removeAllReferences(r,e){Object.keys(r).forEach(o=>{typeof r[o]=="object"&&(r[o]=void 0)});const t=Object.getPrototypeOf(r),n={};Object.keys(t).forEach(o=>{if(typeof t[o]=="function"){const l=()=>{console.warn(`AG Grid: ${e} function ${o}() cannot be called as the grid has been destroyed.
                     Please don't call grid API functions on destroyed grids - as a matter of fact you shouldn't
                     be keeping the API reference, your application has a memory leak! Remove the API reference
                     when the grid is destroyed.`)};n[o]={value:l,writable:!0}}}),Object.defineProperties(r,n)}function isNonNullObject(r){return typeof r=="object"&&r!==null}var ObjectUtils=Object.freeze({__proto__:null,iterateObject,cloneObject,deepCloneObject,deepCloneDefinition,getProperty,setProperty,copyPropertiesIfPresent,copyPropertyIfPresent,getAllKeysInObjects,getAllValuesInObject,mergeDeep,missingOrEmptyObject,get:get$1,set:set$1,getValueUsingField,removeAllReferences,isNonNullObject});const doOnceFlags={};function doOnce(r,e){doOnceFlags[e]||(r(),doOnceFlags[e]=!0)}function getFunctionName(r){if(r.name)return r.name;const e=/function\s+([^\(]+)/.exec(r.toString());return e&&e.length===2?e[1].trim():null}function isFunction(r){return!!(r&&r.constructor&&r.call&&r.apply)}function executeInAWhile(r){executeAfter(r,400)}const executeNextVMTurnFuncs=[];let executeNextVMTurnPending=!1;function executeNextVMTurn(r){executeNextVMTurnFuncs.push(r),!executeNextVMTurnPending&&(executeNextVMTurnPending=!0,window.setTimeout(()=>{const e=executeNextVMTurnFuncs.slice();executeNextVMTurnFuncs.length=0,executeNextVMTurnPending=!1,e.forEach(t=>t())},0))}function executeAfter(r,e=0){r.length>0&&window.setTimeout(()=>r.forEach(t=>t()),e)}function debounce(r,e){let t;return function(...n){const o=this;window.clearTimeout(t),t=window.setTimeout(function(){r.apply(o,n)},e)}}function throttle(r,e){let t=0;return function(...n){const o=this,a=new Date().getTime();a-t<e||(t=a,r.apply(o,n))}}function waitUntil(r,e,t=100,n){const o=new Date().getTime();let a=null,l=!1;const s=()=>{const m=new Date().getTime()-o>t;(r()||m)&&(e(),l=!0,a!=null&&(window.clearInterval(a),a=null),m&&n&&console.warn(n))};s(),l||(a=window.setInterval(s,10))}function compose(...r){return e=>r.reduce((t,n)=>n(t),e)}function callIfPresent(r){r&&r()}const noop=()=>{};var FunctionUtils=Object.freeze({__proto__:null,doOnce,getFunctionName,isFunction,executeInAWhile,executeNextVMTurn,executeAfter,debounce,throttle,waitUntil,compose,callIfPresent,noop}),ModuleNames;(function(r){r.CommunityCoreModule="@ag-grid-community/core",r.InfiniteRowModelModule="@ag-grid-community/infinite-row-model",r.ClientSideRowModelModule="@ag-grid-community/client-side-row-model",r.CsvExportModule="@ag-grid-community/csv-export",r.EnterpriseCoreModule="@ag-grid-enterprise/core",r.RowGroupingModule="@ag-grid-enterprise/row-grouping",r.ColumnsToolPanelModule="@ag-grid-enterprise/column-tool-panel",r.FiltersToolPanelModule="@ag-grid-enterprise/filter-tool-panel",r.MenuModule="@ag-grid-enterprise/menu",r.SetFilterModule="@ag-grid-enterprise/set-filter",r.MultiFilterModule="@ag-grid-enterprise/multi-filter",r.StatusBarModule="@ag-grid-enterprise/status-bar",r.SideBarModule="@ag-grid-enterprise/side-bar",r.RangeSelectionModule="@ag-grid-enterprise/range-selection",r.MasterDetailModule="@ag-grid-enterprise/master-detail",r.RichSelectModule="@ag-grid-enterprise/rich-select",r.GridChartsModule="@ag-grid-enterprise/charts",r.ViewportRowModelModule="@ag-grid-enterprise/viewport-row-model",r.ServerSideRowModelModule="@ag-grid-enterprise/server-side-row-model",r.ExcelExportModule="@ag-grid-enterprise/excel-export",r.ClipboardModule="@ag-grid-enterprise/clipboard",r.SparklinesModule="@ag-grid-enterprise/sparklines",r.AngularModule="@ag-grid-community/angular",r.ReactModule="@ag-grid-community/react",r.VueModule="@ag-grid-community/vue"})(ModuleNames||(ModuleNames={}));class ModuleRegistry{static register(e){ModuleRegistry.__register(e,!0,void 0)}static registerModules(e){ModuleRegistry.__registerModules(e,!0,void 0)}static __register(e,t,n){ModuleRegistry.runVersionChecks(e),n!==void 0?(ModuleRegistry.areGridScopedModules=!0,ModuleRegistry.gridModulesMap[n]===void 0&&(ModuleRegistry.gridModulesMap[n]={}),ModuleRegistry.gridModulesMap[n][e.moduleName]=e):ModuleRegistry.globalModulesMap[e.moduleName]=e,ModuleRegistry.setModuleBased(t)}static __unRegisterGridModules(e){delete ModuleRegistry.gridModulesMap[e]}static __registerModules(e,t,n){ModuleRegistry.setModuleBased(t),e&&e.forEach(o=>ModuleRegistry.__register(o,t,n))}static isValidModuleVersion(e){const[t,n]=e.version.split(".")||[],[o,a]=ModuleRegistry.currentModuleVersion.split(".")||[];return t===o&&n===a}static runVersionChecks(e){if(ModuleRegistry.currentModuleVersion||(ModuleRegistry.currentModuleVersion=e.version),e.version?ModuleRegistry.isValidModuleVersion(e)||console.error(`AG Grid: You are using incompatible versions of AG Grid modules. Major and minor versions should always match across modules. '${e.moduleName}' is version ${e.version} but the other modules are version ${this.currentModuleVersion}. Please update all modules to the same version.`):console.error(`AG Grid: You are using incompatible versions of AG Grid modules. Major and minor versions should always match across modules. '${e.moduleName}' is incompatible. Please update all modules to the same version.`),e.validate){const t=e.validate();t.isValid||console.error(`AG Grid: ${t.message}`)}}static setModuleBased(e){ModuleRegistry.moduleBased===void 0?ModuleRegistry.moduleBased=e:ModuleRegistry.moduleBased!==e&&doOnce(()=>{console.warn("AG Grid: You are mixing modules (i.e. @ag-grid-community/core) and packages (ag-grid-community) - you can only use one or the other of these mechanisms."),console.warn("Please see https://www.ag-grid.com/javascript-grid/packages-modules/ for more information.")},"ModulePackageCheck")}static __setIsBundled(){ModuleRegistry.isBundled=!0}static __assertRegistered(e,t,n){var o;if(this.__isRegistered(e,n))return!0;const a=t+e;let l;if(ModuleRegistry.isBundled)l=`AG Grid: unable to use ${t} as 'ag-grid-enterprise' has not been loaded. Check you are using the Enterprise bundle:
        
        <script src="https://cdn.jsdelivr.net/npm/ag-grid-enterprise@AG_GRID_VERSION/dist/ag-grid-enterprise.min.js"><\/script>
        
For more info see: https://ag-grid.com/javascript-data-grid/getting-started/#getting-started-with-ag-grid-enterprise`;else if(ModuleRegistry.moduleBased||ModuleRegistry.moduleBased===void 0){let s=(o=Object.entries(ModuleNames).find(([m,y])=>y===e))===null||o===void 0?void 0:o[0];l=`AG Grid: unable to use ${t} as the ${s} is not registered${ModuleRegistry.areGridScopedModules?` for gridId: ${n}`:""}. Check if you have registered the module:
           
    import { ModuleRegistry } from '@ag-grid-community/core';
    import { ${s} } from '${e}';
    
    ModuleRegistry.registerModules([ ${s} ]);

For more info see: https://www.ag-grid.com/javascript-grid/modules/`}else l=`AG Grid: unable to use ${t} as package 'ag-grid-enterprise' has not been imported. Check that you have imported the package:
            
    import 'ag-grid-enterprise';
            
For more info see: https://www.ag-grid.com/javascript-grid/packages/`;return doOnce(()=>{console.warn(l)},a),!1}static __isRegistered(e,t){var n;return!!ModuleRegistry.globalModulesMap[e]||!!(!((n=ModuleRegistry.gridModulesMap[t])===null||n===void 0)&&n[e])}static __getRegisteredModules(e){return[...values(ModuleRegistry.globalModulesMap),...values(ModuleRegistry.gridModulesMap[e]||{})]}static __getGridRegisteredModules(e){var t;return values((t=ModuleRegistry.gridModulesMap[e])!==null&&t!==void 0?t:{})||[]}static __isPackageBased(){return!ModuleRegistry.moduleBased}}ModuleRegistry.globalModulesMap={};ModuleRegistry.gridModulesMap={};ModuleRegistry.areGridScopedModules=!1;class Context{constructor(e,t){if(this.beanWrappers={},this.destroyed=!1,!e||!e.beanClasses)return;this.contextParams=e,this.logger=t,this.logger.log(">> creating ag-Application Context"),this.createBeans();const n=this.getBeanInstances();this.wireBeans(n),this.logger.log(">> ag-Application Context ready - component is alive")}getBeanInstances(){return values(this.beanWrappers).map(e=>e.beanInstance)}createBean(e,t){if(!e)throw Error("Can't wire to bean since it is null");return this.wireBeans([e],t),e}wireBeans(e,t){this.autoWireBeans(e),this.methodWireBeans(e),this.callLifeCycleMethods(e,"preConstructMethods"),exists(t)&&e.forEach(t),this.callLifeCycleMethods(e,"postConstructMethods")}createBeans(){this.contextParams.beanClasses.forEach(this.createBeanWrapper.bind(this)),iterateObject(this.beanWrappers,(t,n)=>{let o;n.bean.__agBeanMetaData&&n.bean.__agBeanMetaData.autowireMethods&&n.bean.__agBeanMetaData.autowireMethods.agConstructor&&(o=n.bean.__agBeanMetaData.autowireMethods.agConstructor);const a=this.getBeansForParameters(o,n.bean.name),l=new(n.bean.bind.apply(n.bean,[null,...a]));n.beanInstance=l});const e=Object.keys(this.beanWrappers).join(", ");this.logger.log(`created beans: ${e}`)}createBeanWrapper(e){const t=e.__agBeanMetaData;if(!t){let o;e.prototype.constructor?o=getFunctionName(e.prototype.constructor):o=""+e,console.error(`Context item ${o} is not a bean`);return}const n={bean:e,beanInstance:null,beanName:t.beanName};this.beanWrappers[t.beanName]=n}autoWireBeans(e){e.forEach(t=>{this.forEachMetaDataInHierarchy(t,(n,o)=>{const a=n.agClassAttributes;a&&a.forEach(l=>{const s=this.lookupBeanInstance(o,l.beanName,l.optional);t[l.attributeName]=s})})})}methodWireBeans(e){e.forEach(t=>{this.forEachMetaDataInHierarchy(t,(n,o)=>{iterateObject(n.autowireMethods,(a,l)=>{if(a==="agConstructor")return;const s=this.getBeansForParameters(l,o);t[a].apply(t,s)})})})}forEachMetaDataInHierarchy(e,t){let n=Object.getPrototypeOf(e);for(;n!=null;){const o=n.constructor;if(o.hasOwnProperty("__agBeanMetaData")){const a=o.__agBeanMetaData,l=this.getBeanName(o);t(a,l)}n=Object.getPrototypeOf(n)}}getBeanName(e){if(e.__agBeanMetaData&&e.__agBeanMetaData.beanName)return e.__agBeanMetaData.beanName;const t=e.toString();return t.substring(9,t.indexOf("("))}getBeansForParameters(e,t){const n=[];return e&&iterateObject(e,(o,a)=>{const l=this.lookupBeanInstance(t,a);n[Number(o)]=l}),n}lookupBeanInstance(e,t,n=!1){if(this.destroyed)return this.logger.log(`AG Grid: bean reference ${t} is used after the grid is destroyed!`),null;if(t==="context")return this;if(this.contextParams.providedBeanInstances&&this.contextParams.providedBeanInstances.hasOwnProperty(t))return this.contextParams.providedBeanInstances[t];const o=this.beanWrappers[t];return o?o.beanInstance:(n||console.error(`AG Grid: unable to find bean reference ${t} while initialising ${e}`),null)}callLifeCycleMethods(e,t){e.forEach(n=>this.callLifeCycleMethodsOnBean(n,t))}callLifeCycleMethodsOnBean(e,t,n){const o={};this.forEachMetaDataInHierarchy(e,l=>{const s=l[t];s&&s.forEach(m=>{m!=n&&(o[m]=!0)})}),Object.keys(o).forEach(l=>e[l]())}getBean(e){return this.lookupBeanInstance("getBean",e,!0)}destroy(){if(this.destroyed)return;this.logger.log(">> Shutting down ag-Application Context");const e=this.getBeanInstances();this.destroyBeans(e),this.contextParams.providedBeanInstances=null,ModuleRegistry.__unRegisterGridModules(this.contextParams.gridId),this.destroyed=!0,this.logger.log(">> ag-Application Context shut down - component is dead")}destroyBean(e){e&&this.destroyBeans([e])}destroyBeans(e){return e?(e.forEach(t=>{this.callLifeCycleMethodsOnBean(t,"preDestroyMethods","destroy");const n=t;typeof n.destroy=="function"&&n.destroy()}),[]):[]}isDestroyed(){return this.destroyed}getGridId(){return this.contextParams.gridId}}function PreConstruct(r,e,t){const n=getOrCreateProps$1(r.constructor);n.preConstructMethods||(n.preConstructMethods=[]),n.preConstructMethods.push(e)}function PostConstruct(r,e,t){const n=getOrCreateProps$1(r.constructor);n.postConstructMethods||(n.postConstructMethods=[]),n.postConstructMethods.push(e)}function PreDestroy(r,e,t){const n=getOrCreateProps$1(r.constructor);n.preDestroyMethods||(n.preDestroyMethods=[]),n.preDestroyMethods.push(e)}function Bean(r){return e=>{const t=getOrCreateProps$1(e);t.beanName=r}}function Autowired(r){return(e,t,n)=>{autowiredFunc(e,r,!1,e,t,null)}}function Optional(r){return(e,t,n)=>{autowiredFunc(e,r,!0,e,t,null)}}function autowiredFunc(r,e,t,n,o,a){if(e===null){console.error("AG Grid: Autowired name should not be null");return}if(typeof a=="number"){console.error("AG Grid: Autowired should be on an attribute");return}const l=getOrCreateProps$1(r.constructor);l.agClassAttributes||(l.agClassAttributes=[]),l.agClassAttributes.push({attributeName:o,beanName:e,optional:t})}function Qualifier(r){return(e,t,n)=>{const o=typeof e=="function"?e:e.constructor;let a;if(typeof n=="number"){let l;t?(a=getOrCreateProps$1(o),l=t):(a=getOrCreateProps$1(o),l="agConstructor"),a.autowireMethods||(a.autowireMethods={}),a.autowireMethods[l]||(a.autowireMethods[l]={}),a.autowireMethods[l][n]=r}}}function getOrCreateProps$1(r){return r.hasOwnProperty("__agBeanMetaData")||(r.__agBeanMetaData={}),r.__agBeanMetaData}var __decorate$2E=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},__param$a=function(r,e){return function(t,n){e(t,n,r)}};let EventService=class{constructor(){this.allSyncListeners=new Map,this.allAsyncListeners=new Map,this.globalSyncListeners=new Set,this.globalAsyncListeners=new Set,this.asyncFunctionsQueue=[],this.scheduled=!1,this.firedEvents={}}setBeans(e,t,n,o=null){if(this.frameworkOverrides=n,this.gridOptionsService=t,o){const a=t.useAsyncEvents();this.addGlobalListener(o,a)}}getListeners(e,t,n){const o=t?this.allAsyncListeners:this.allSyncListeners;let a=o.get(e);return!a&&n&&(a=new Set,o.set(e,a)),a}noRegisteredListenersExist(){return this.allSyncListeners.size===0&&this.allAsyncListeners.size===0&&this.globalSyncListeners.size===0&&this.globalAsyncListeners.size===0}addEventListener(e,t,n=!1){this.getListeners(e,n,!0).add(t)}removeEventListener(e,t,n=!1){const o=this.getListeners(e,n,!1);o&&(o.delete(t),o.size===0&&(n?this.allAsyncListeners:this.allSyncListeners).delete(e))}addGlobalListener(e,t=!1){(t?this.globalAsyncListeners:this.globalSyncListeners).add(e)}removeGlobalListener(e,t=!1){(t?this.globalAsyncListeners:this.globalSyncListeners).delete(e)}dispatchEvent(e){let t=e;if(this.gridOptionsService){const{api:n,columnApi:o,context:a}=this.gridOptionsService;t.api=n,t.columnApi=o,t.context=a}this.dispatchToListeners(t,!0),this.dispatchToListeners(t,!1),this.firedEvents[t.type]=!0}dispatchEventOnce(e){this.firedEvents[e.type]||this.dispatchEvent(e)}dispatchToListeners(e,t){const n=e.type;if(t&&"event"in e){const s=e.event;s instanceof Event&&(e.eventPath=s.composedPath())}const o=s=>s.forEach(m=>{t?this.dispatchAsync(()=>m(e)):m(e)}),a=new Set(this.getListeners(n,t,!1));a&&o(a),new Set(t?this.globalAsyncListeners:this.globalSyncListeners).forEach(s=>{t?this.dispatchAsync(()=>this.frameworkOverrides.dispatchEvent(n,()=>s(n,e),!0)):this.frameworkOverrides.dispatchEvent(n,()=>s(n,e),!0)})}dispatchAsync(e){this.asyncFunctionsQueue.push(e),this.scheduled||(window.setTimeout(this.flushAsyncQueue.bind(this),0),this.scheduled=!0)}flushAsyncQueue(){this.scheduled=!1;const e=this.asyncFunctionsQueue.slice();this.asyncFunctionsQueue=[],e.forEach(t=>t())}};__decorate$2E([__param$a(0,Qualifier("loggerFactory")),__param$a(1,Qualifier("gridOptionsService")),__param$a(2,Qualifier("frameworkOverrides")),__param$a(3,Qualifier("globalEventListener"))],EventService.prototype,"setBeans",null);EventService=__decorate$2E([Bean("eventService")],EventService);var __decorate$2D=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let instanceIdSequence$4=0;function getNextColInstanceId(){return instanceIdSequence$4++}class Column{constructor(e,t,n,o){this.instanceId=getNextColInstanceId(),this.autoHeaderHeight=null,this.moving=!1,this.menuVisible=!1,this.filterActive=!1,this.eventService=new EventService,this.tooltipEnabled=!1,this.rowGroupActive=!1,this.pivotActive=!1,this.aggregationActive=!1,this.colDef=e,this.userProvidedColDef=t,this.colId=n,this.primary=o,this.setState(e)}getInstanceId(){return this.instanceId}setState(e){e.sort!==void 0?(e.sort==="asc"||e.sort==="desc")&&(this.sort=e.sort):(e.initialSort==="asc"||e.initialSort==="desc")&&(this.sort=e.initialSort);const t=attrToNumber(e.sortIndex),n=attrToNumber(e.initialSortIndex);t!==void 0?t!==null&&(this.sortIndex=t):n!==null&&(this.sortIndex=n);const o=attrToBoolean(e.hide),a=attrToBoolean(e.initialHide);o!==void 0?this.visible=!o:this.visible=!a,e.pinned!==void 0?this.setPinned(e.pinned):this.setPinned(e.initialPinned);const l=attrToNumber(e.flex),s=attrToNumber(e.initialFlex);l!==void 0?this.flex=l:s!==void 0&&(this.flex=s)}setColDef(e,t){this.colDef=e,this.userProvidedColDef=t,this.initMinAndMaxWidths(),this.initDotNotation(),this.eventService.dispatchEvent(this.createColumnEvent("colDefChanged","api"))}getUserProvidedColDef(){return this.userProvidedColDef}setParent(e){this.parent=e}getParent(){return this.parent}setOriginalParent(e){this.originalParent=e}getOriginalParent(){return this.originalParent}initialise(){this.initMinAndMaxWidths(),this.resetActualWidth("gridInitializing"),this.initDotNotation(),this.initTooltip(),this.validate()}initDotNotation(){const e=this.gridOptionsService.is("suppressFieldDotNotation");this.fieldContainsDots=exists(this.colDef.field)&&this.colDef.field.indexOf(".")>=0&&!e,this.tooltipFieldContainsDots=exists(this.colDef.tooltipField)&&this.colDef.tooltipField.indexOf(".")>=0&&!e}initMinAndMaxWidths(){const e=this.colDef;this.minWidth=this.columnUtils.calculateColMinWidth(e),this.maxWidth=this.columnUtils.calculateColMaxWidth(e)}initTooltip(){this.tooltipEnabled=exists(this.colDef.tooltipField)||exists(this.colDef.tooltipValueGetter)||exists(this.colDef.tooltipComponent)}resetActualWidth(e="api"){const t=this.columnUtils.calculateColInitialWidth(this.colDef);this.setActualWidth(t,e,!0)}isEmptyGroup(){return!1}isRowGroupDisplayed(e){if(missing(this.colDef)||missing(this.colDef.showRowGroup))return!1;const t=this.colDef.showRowGroup===!0,n=this.colDef.showRowGroup===e;return t||n}isPrimary(){return this.primary}isFilterAllowed(){return!!this.colDef.filter}isFieldContainsDots(){return this.fieldContainsDots}isTooltipEnabled(){return this.tooltipEnabled}isTooltipFieldContainsDots(){return this.tooltipFieldContainsDots}validate(){const e=this.colDef;function t(o,a,l){doOnce(()=>{l?console.warn(o,l):doOnce(()=>console.warn(o),a)},a)}if(this.gridOptionsService.isRowModelType("clientSide")&&!ModuleRegistry.__isRegistered(ModuleNames.RowGroupingModule,this.gridOptionsService.getGridId())){const a=["enableRowGroup","rowGroup","rowGroupIndex","enablePivot","enableValue","pivot","pivotIndex","aggFunc"].filter(l=>exists(e[l]));a.length>0&&ModuleRegistry.__assertRegistered(ModuleNames.RowGroupingModule,a.map(l=>"colDef."+l).join(", "),this.gridOptionsService.getGridId())}if((this.colDef.cellEditor==="agRichSelect"||this.colDef.cellEditor==="agRichSelectCellEditor")&&ModuleRegistry.__assertRegistered(ModuleNames.RichSelectModule,this.colDef.cellEditor,this.gridOptionsService.getGridId()),this.gridOptionsService.isTreeData()){const a=["rowGroup","rowGroupIndex","pivot","pivotIndex"].filter(l=>exists(e[l]));a.length>0&&t(`AG Grid: ${a.join()} is not possible when doing tree data, your column definition should not have ${a.join()}`,"TreeDataCannotRowGroup")}if(exists(e.menuTabs))if(Array.isArray(e.menuTabs)){const o=["filterMenuTab"],a=["columnsMenuTab","generalMenuTab"],l=a.filter(s=>e.menuTabs.includes(s));l.length>0&&ModuleRegistry.__assertRegistered(ModuleNames.MenuModule,`menuTab(s): ${l.map(s=>`'${s}'`).join()}`,this.gridOptionsService.getGridId()),e.menuTabs.forEach(s=>{!a.includes(s)&&!o.includes(s)&&t(`AG Grid: '${s}' is not valid for 'colDef.menuTabs'. Valid values are: ${[...o,...a].map(m=>`'${m}'`).join()}.`,"wrongValue_menuTabs_"+s)})}else t("AG Grid: The typeof 'colDef.menuTabs' should be an array not:"+typeof e.menuTabs,"wrongType_menuTabs");exists(e.columnsMenuParams)&&ModuleRegistry.__assertRegistered(ModuleNames.MenuModule,"columnsMenuParams",this.gridOptionsService.getGridId()),exists(e.columnsMenuParams)&&ModuleRegistry.__assertRegistered(ModuleNames.ColumnsToolPanelModule,"columnsMenuParams",this.gridOptionsService.getGridId()),exists(this.colDef.width)&&typeof this.colDef.width!="number"&&t("AG Grid: colDef.width should be a number, not "+typeof this.colDef.width,"ColumnCheck"),exists(e.columnGroupShow)&&e.columnGroupShow!=="closed"&&e.columnGroupShow!=="open"&&t(`AG Grid: '${e.columnGroupShow}' is not valid for columnGroupShow. Valid values are 'open', 'closed', undefined, null`,"columnGroupShow_invalid")}addEventListener(e,t){this.eventService.addEventListener(e,t)}removeEventListener(e,t){this.eventService.removeEventListener(e,t)}createColumnFunctionCallbackParams(e){return{node:e,data:e.data,column:this,colDef:this.colDef,context:this.gridOptionsService.context,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi}}isSuppressNavigable(e){if(typeof this.colDef.suppressNavigable=="boolean")return this.colDef.suppressNavigable;if(typeof this.colDef.suppressNavigable=="function"){const t=this.createColumnFunctionCallbackParams(e),n=this.colDef.suppressNavigable;return n(t)}return!1}isCellEditable(e){return e.group&&!this.gridOptionsService.is("enableGroupEdit")?!1:this.isColumnFunc(e,this.colDef.editable)}isSuppressFillHandle(){return!!attrToBoolean(this.colDef.suppressFillHandle)}isAutoHeight(){return!!attrToBoolean(this.colDef.autoHeight)}isAutoHeaderHeight(){return!!attrToBoolean(this.colDef.autoHeaderHeight)}isRowDrag(e){return this.isColumnFunc(e,this.colDef.rowDrag)}isDndSource(e){return this.isColumnFunc(e,this.colDef.dndSource)}isCellCheckboxSelection(e){return this.isColumnFunc(e,this.colDef.checkboxSelection)}isSuppressPaste(e){return this.isColumnFunc(e,this.colDef?this.colDef.suppressPaste:null)}isResizable(){return!!attrToBoolean(this.colDef.resizable)}isColumnFunc(e,t){if(typeof t=="boolean")return t;if(typeof t=="function"){const n=this.createColumnFunctionCallbackParams(e);return t(n)}return!1}setMoving(e,t="api"){this.moving=e,this.eventService.dispatchEvent(this.createColumnEvent("movingChanged",t))}createColumnEvent(e,t){return{type:e,column:this,columns:[this],source:t,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context}}isMoving(){return this.moving}getSort(){return this.sort}setSort(e,t="api"){this.sort!==e&&(this.sort=e,this.eventService.dispatchEvent(this.createColumnEvent("sortChanged",t))),this.dispatchStateUpdatedEvent("sort")}setMenuVisible(e,t="api"){this.menuVisible!==e&&(this.menuVisible=e,this.eventService.dispatchEvent(this.createColumnEvent("menuVisibleChanged",t)))}isMenuVisible(){return this.menuVisible}isSortAscending(){return this.sort==="asc"}isSortDescending(){return this.sort==="desc"}isSortNone(){return missing(this.sort)}isSorting(){return exists(this.sort)}getSortIndex(){return this.sortIndex}setSortIndex(e){this.sortIndex=e,this.dispatchStateUpdatedEvent("sortIndex")}setAggFunc(e){this.aggFunc=e,this.dispatchStateUpdatedEvent("aggFunc")}getAggFunc(){return this.aggFunc}getLeft(){return this.left}getOldLeft(){return this.oldLeft}getRight(){return this.left+this.actualWidth}setLeft(e,t="api"){this.oldLeft=this.left,this.left!==e&&(this.left=e,this.eventService.dispatchEvent(this.createColumnEvent("leftChanged",t)))}isFilterActive(){return this.filterActive}setFilterActive(e,t="api",n){this.filterActive!==e&&(this.filterActive=e,this.eventService.dispatchEvent(this.createColumnEvent("filterActiveChanged",t)));const o=this.createColumnEvent("filterChanged",t);n&&mergeDeep(o,n),this.eventService.dispatchEvent(o)}isHovered(){return this.columnHoverService.isHovered(this)}setPinned(e){e===!0||e==="left"?this.pinned="left":e==="right"?this.pinned="right":this.pinned=null,this.dispatchStateUpdatedEvent("pinned")}setFirstRightPinned(e,t="api"){this.firstRightPinned!==e&&(this.firstRightPinned=e,this.eventService.dispatchEvent(this.createColumnEvent("firstRightPinnedChanged",t)))}setLastLeftPinned(e,t="api"){this.lastLeftPinned!==e&&(this.lastLeftPinned=e,this.eventService.dispatchEvent(this.createColumnEvent("lastLeftPinnedChanged",t)))}isFirstRightPinned(){return this.firstRightPinned}isLastLeftPinned(){return this.lastLeftPinned}isPinned(){return this.pinned==="left"||this.pinned==="right"}isPinnedLeft(){return this.pinned==="left"}isPinnedRight(){return this.pinned==="right"}getPinned(){return this.pinned}setVisible(e,t="api"){const n=e===!0;this.visible!==n&&(this.visible=n,this.eventService.dispatchEvent(this.createColumnEvent("visibleChanged",t))),this.dispatchStateUpdatedEvent("hide")}isVisible(){return this.visible}isSpanHeaderHeight(){const e=this.getColDef();return!e.suppressSpanHeaderHeight&&!e.autoHeaderHeight}getColDef(){return this.colDef}getColumnGroupShow(){return this.colDef.columnGroupShow}getColId(){return this.colId}getId(){return this.colId}getUniqueId(){return this.colId}getDefinition(){return this.colDef}getActualWidth(){return this.actualWidth}getAutoHeaderHeight(){return this.autoHeaderHeight}setAutoHeaderHeight(e){const t=e!==this.autoHeaderHeight;return this.autoHeaderHeight=e,t}createBaseColDefParams(e){return{node:e,data:e.data,colDef:this.colDef,column:this,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context}}getColSpan(e){if(missing(this.colDef.colSpan))return 1;const t=this.createBaseColDefParams(e),n=this.colDef.colSpan(t);return Math.max(n,1)}getRowSpan(e){if(missing(this.colDef.rowSpan))return 1;const t=this.createBaseColDefParams(e),n=this.colDef.rowSpan(t);return Math.max(n,1)}setActualWidth(e,t="api",n=!1){this.minWidth!=null&&(e=Math.max(e,this.minWidth)),this.maxWidth!=null&&(e=Math.min(e,this.maxWidth)),this.actualWidth!==e&&(this.actualWidth=e,this.flex&&t!=="flex"&&t!=="gridInitializing"&&(this.flex=null),n||this.fireColumnWidthChangedEvent(t)),this.dispatchStateUpdatedEvent("width")}fireColumnWidthChangedEvent(e){this.eventService.dispatchEvent(this.createColumnEvent("widthChanged",e))}isGreaterThanMax(e){return this.maxWidth!=null?e>this.maxWidth:!1}getMinWidth(){return this.minWidth}getMaxWidth(){return this.maxWidth}getFlex(){return this.flex||0}setFlex(e){this.flex!==e&&(this.flex=e),this.dispatchStateUpdatedEvent("flex")}setMinimum(e="api"){exists(this.minWidth)&&this.setActualWidth(this.minWidth,e)}setRowGroupActive(e,t="api"){this.rowGroupActive!==e&&(this.rowGroupActive=e,this.eventService.dispatchEvent(this.createColumnEvent("columnRowGroupChanged",t))),this.dispatchStateUpdatedEvent("rowGroup")}isRowGroupActive(){return this.rowGroupActive}setPivotActive(e,t="api"){this.pivotActive!==e&&(this.pivotActive=e,this.eventService.dispatchEvent(this.createColumnEvent("columnPivotChanged",t))),this.dispatchStateUpdatedEvent("pivot")}isPivotActive(){return this.pivotActive}isAnyFunctionActive(){return this.isPivotActive()||this.isRowGroupActive()||this.isValueActive()}isAnyFunctionAllowed(){return this.isAllowPivot()||this.isAllowRowGroup()||this.isAllowValue()}setValueActive(e,t="api"){this.aggregationActive!==e&&(this.aggregationActive=e,this.eventService.dispatchEvent(this.createColumnEvent("columnValueChanged",t)))}isValueActive(){return this.aggregationActive}isAllowPivot(){return this.colDef.enablePivot===!0}isAllowValue(){return this.colDef.enableValue===!0}isAllowRowGroup(){return this.colDef.enableRowGroup===!0}getMenuTabs(e){let t=this.getColDef().menuTabs;return t==null&&(t=e),t}dispatchStateUpdatedEvent(e){this.eventService.dispatchEvent({type:Column.EVENT_STATE_UPDATED,key:e})}}Column.EVENT_MOVING_CHANGED="movingChanged";Column.EVENT_LEFT_CHANGED="leftChanged";Column.EVENT_WIDTH_CHANGED="widthChanged";Column.EVENT_LAST_LEFT_PINNED_CHANGED="lastLeftPinnedChanged";Column.EVENT_FIRST_RIGHT_PINNED_CHANGED="firstRightPinnedChanged";Column.EVENT_VISIBLE_CHANGED="visibleChanged";Column.EVENT_FILTER_CHANGED="filterChanged";Column.EVENT_FILTER_ACTIVE_CHANGED="filterActiveChanged";Column.EVENT_SORT_CHANGED="sortChanged";Column.EVENT_COL_DEF_CHANGED="colDefChanged";Column.EVENT_MENU_VISIBLE_CHANGED="menuVisibleChanged";Column.EVENT_ROW_GROUP_CHANGED="columnRowGroupChanged";Column.EVENT_PIVOT_CHANGED="columnPivotChanged";Column.EVENT_VALUE_CHANGED="columnValueChanged";Column.EVENT_STATE_UPDATED="columnStateUpdated";__decorate$2D([Autowired("gridOptionsService")],Column.prototype,"gridOptionsService",void 0);__decorate$2D([Autowired("columnUtils")],Column.prototype,"columnUtils",void 0);__decorate$2D([Autowired("columnHoverService")],Column.prototype,"columnHoverService",void 0);__decorate$2D([PostConstruct],Column.prototype,"initialise",null);var __decorate$2C=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class ProvidedColumnGroup{constructor(e,t,n,o){this.localEventService=new EventService,this.expandable=!1,this.instanceId=getNextColInstanceId(),this.expandableListenerRemoveCallback=null,this.colGroupDef=e,this.groupId=t,this.expanded=!!e&&!!e.openByDefault,this.padding=n,this.level=o}destroy(){this.expandableListenerRemoveCallback&&this.reset(null,void 0)}reset(e,t){this.colGroupDef=e,this.level=t,this.originalParent=null,this.expandableListenerRemoveCallback&&this.expandableListenerRemoveCallback(),this.children=void 0,this.expandable=void 0}getInstanceId(){return this.instanceId}setOriginalParent(e){this.originalParent=e}getOriginalParent(){return this.originalParent}getLevel(){return this.level}isVisible(){return this.children?this.children.some(e=>e.isVisible()):!1}isPadding(){return this.padding}setExpanded(e){this.expanded=e===void 0?!1:e;const t={type:ProvidedColumnGroup.EVENT_EXPANDED_CHANGED};this.localEventService.dispatchEvent(t)}isExpandable(){return this.expandable}isExpanded(){return this.expanded}getGroupId(){return this.groupId}getId(){return this.getGroupId()}setChildren(e){this.children=e}getChildren(){return this.children}getColGroupDef(){return this.colGroupDef}getLeafColumns(){const e=[];return this.addLeafColumns(e),e}addLeafColumns(e){this.children&&this.children.forEach(t=>{t instanceof Column?e.push(t):t instanceof ProvidedColumnGroup&&t.addLeafColumns(e)})}getColumnGroupShow(){const e=this.colGroupDef;if(e)return e.columnGroupShow}setupExpandable(){this.setExpandable(),this.expandableListenerRemoveCallback&&this.expandableListenerRemoveCallback();const e=this.onColumnVisibilityChanged.bind(this);this.getLeafColumns().forEach(t=>t.addEventListener("visibleChanged",e)),this.expandableListenerRemoveCallback=()=>{this.getLeafColumns().forEach(t=>t.removeEventListener("visibleChanged",e)),this.expandableListenerRemoveCallback=null}}setExpandable(){if(this.isPadding())return;let e=!1,t=!1,n=!1;const o=this.findChildrenRemovingPadding();for(let l=0,s=o.length;l<s;l++){const m=o[l];if(!m.isVisible())continue;const y=m.getColumnGroupShow();y==="open"?(e=!0,n=!0):y==="closed"?(t=!0,n=!0):(e=!0,t=!0)}const a=e&&t&&n;if(this.expandable!==a){this.expandable=a;const l={type:ProvidedColumnGroup.EVENT_EXPANDABLE_CHANGED};this.localEventService.dispatchEvent(l)}}findChildrenRemovingPadding(){const e=[],t=n=>{n.forEach(o=>{o instanceof ProvidedColumnGroup&&o.isPadding()?t(o.children):e.push(o)})};return t(this.children),e}onColumnVisibilityChanged(){this.setExpandable()}addEventListener(e,t){this.localEventService.addEventListener(e,t)}removeEventListener(e,t){this.localEventService.removeEventListener(e,t)}}ProvidedColumnGroup.EVENT_EXPANDED_CHANGED="expandedChanged";ProvidedColumnGroup.EVENT_EXPANDABLE_CHANGED="expandableChanged";__decorate$2C([PreDestroy],ProvidedColumnGroup.prototype,"destroy",null);const DefaultColumnTypes={numericColumn:{headerClass:"ag-right-aligned-header",cellClass:"ag-right-aligned-cell"},rightAligned:{headerClass:"ag-right-aligned-header",cellClass:"ag-right-aligned-cell"}};function firstExistingValue(...r){for(let e=0;e<r.length;e++){const t=r[e];if(exists(t))return t}return null}function existsAndNotEmpty(r){return r!=null&&r.length>0}function last(r){if(!(!r||!r.length))return r[r.length-1]}function areEqual(r,e,t){return r==null&&e==null?!0:r!=null&&e!=null&&r.length===e.length&&r.every((n,o)=>t?t(n,e[o]):e[o]===n)}function shallowCompare(r,e){return areEqual(r,e)}function sortNumerically(r){return r.sort((e,t)=>e-t)}function removeRepeatsFromArray(r,e){if(r)for(let t=r.length-2;t>=0;t--){const n=r[t]===e,o=r[t+1]===e;n&&o&&r.splice(t+1,1)}}function removeFromArray(r,e){const t=r.indexOf(e);t>=0&&r.splice(t,1)}function removeAllFromArray(r,e){e.forEach(t=>removeFromArray(r,t))}function insertIntoArray(r,e,t){r.splice(t,0,e)}function insertArrayIntoArray(r,e,t){if(!(r==null||e==null))for(let n=e.length-1;n>=0;n--){const o=e[n];insertIntoArray(r,o,t)}}function moveInArray(r,e,t){removeAllFromArray(r,e),e.slice().reverse().forEach(n=>insertIntoArray(r,n,t))}function includes(r,e){return r.indexOf(e)>-1}function flatten(r){return[].concat.apply([],r)}function pushAll(r,e){e==null||r==null||e.forEach(t=>r.push(t))}function toStrings(r){return r.map(toStringOrNull)}function forEachReverse(r,e){if(r!=null)for(let t=r.length-1;t>=0;t--)e(r[t],t)}var ArrayUtils=Object.freeze({__proto__:null,firstExistingValue,existsAndNotEmpty,last,areEqual,shallowCompare,sortNumerically,removeRepeatsFromArray,removeFromArray,removeAllFromArray,insertIntoArray,insertArrayIntoArray,moveInArray,includes,flatten,pushAll,toStrings,forEachReverse});const AG_GRID_STOP_PROPAGATION="__ag_Grid_Stop_Propagation",PASSIVE_EVENTS$1=["touchstart","touchend","touchmove","touchcancel","scroll"],supports={};function stopPropagationForAgGrid(r){r[AG_GRID_STOP_PROPAGATION]=!0}function isStopPropagationForAgGrid(r){return r[AG_GRID_STOP_PROPAGATION]===!0}const isEventSupported=(()=>{const r={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return t=>{if(typeof supports[t]=="boolean")return supports[t];const n=document.createElement(r[t]||"div");return t="on"+t,supports[t]=t in n}})();function getCtrlForEventTarget(r,e,t){let n=e;for(;n;){const o=r.getDomData(n,t);if(o)return o;n=n.parentElement}return null}function isElementInEventPath(r,e){return!e||!r?!1:getEventPath(e).indexOf(r)>=0}function createEventPath(r){const e=[];let t=r.target;for(;t;)e.push(t),t=t.parentElement;return e}function getEventPath(r){const e=r;return e.path?e.path:e.composedPath?e.composedPath():createEventPath(e)}function addSafePassiveEventListener(r,e,t,n){const a=includes(PASSIVE_EVENTS$1,t)?{passive:!0}:void 0;r&&r.addEventListener&&r.addEventListener(e,t,n,a)}var EventUtils=Object.freeze({__proto__:null,stopPropagationForAgGrid,isStopPropagationForAgGrid,isEventSupported,getCtrlForEventTarget,isElementInEventPath,createEventPath,getEventPath,addSafePassiveEventListener}),__decorate$2B=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class BeanStub{constructor(){this.destroyFunctions=[],this.destroyed=!1,this.__v_skip=!0,this.isAlive=()=>!this.destroyed}getFrameworkOverrides(){return this.frameworkOverrides}getContext(){return this.context}destroy(){this.destroyFunctions.forEach(e=>e()),this.destroyFunctions.length=0,this.destroyed=!0,this.dispatchEvent({type:BeanStub.EVENT_DESTROYED})}addEventListener(e,t){this.localEventService||(this.localEventService=new EventService),this.localEventService.addEventListener(e,t)}removeEventListener(e,t){this.localEventService&&this.localEventService.removeEventListener(e,t)}dispatchEventAsync(e){window.setTimeout(()=>this.dispatchEvent(e),0)}dispatchEvent(e){this.localEventService&&this.localEventService.dispatchEvent(e)}addManagedListener(e,t,n){if(this.destroyed)return;e instanceof HTMLElement?addSafePassiveEventListener(this.getFrameworkOverrides(),e,t,n):e.addEventListener(t,n);const o=()=>(e.removeEventListener(t,n),this.destroyFunctions=this.destroyFunctions.filter(a=>a!==o),null);return this.destroyFunctions.push(o),o}addManagedPropertyListener(e,t){if(this.destroyed)return;this.gridOptionsService.addEventListener(e,t);const n=()=>(this.gridOptionsService.removeEventListener(e,t),this.destroyFunctions=this.destroyFunctions.filter(o=>o!==n),null);return this.destroyFunctions.push(n),n}addDestroyFunc(e){this.isAlive()?this.destroyFunctions.push(e):e()}createManagedBean(e,t){const n=this.createBean(e,t);return this.addDestroyFunc(this.destroyBean.bind(this,e,t)),n}createBean(e,t,n){return(t||this.getContext()).createBean(e,n)}destroyBean(e,t){return(t||this.getContext()).destroyBean(e)}destroyBeans(e,t){return e&&e.forEach(n=>this.destroyBean(n,t)),[]}}BeanStub.EVENT_DESTROYED="destroyed";__decorate$2B([Autowired("frameworkOverrides")],BeanStub.prototype,"frameworkOverrides",void 0);__decorate$2B([Autowired("context")],BeanStub.prototype,"context",void 0);__decorate$2B([Autowired("eventService")],BeanStub.prototype,"eventService",void 0);__decorate$2B([Autowired("gridOptionsService")],BeanStub.prototype,"gridOptionsService",void 0);__decorate$2B([Autowired("localeService")],BeanStub.prototype,"localeService",void 0);__decorate$2B([Autowired("environment")],BeanStub.prototype,"environment",void 0);__decorate$2B([PreDestroy],BeanStub.prototype,"destroy",null);var __decorate$2A=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},__param$9=function(r,e){return function(t,n){e(t,n,r)}};let ColumnFactory=class extends BeanStub{setBeans(e){this.logger=e.create("ColumnFactory")}createColumnTree(e,t,n){const o=new ColumnKeyCreator,{existingCols:a,existingGroups:l,existingColKeys:s}=this.extractExistingTreeData(n);o.addExistingKeys(s);const m=this.recursivelyCreateColumns(e,0,t,a,o,l),y=this.findMaxDept(m,0);this.logger.log("Number of levels for grouped columns is "+y);const D=this.balanceColumnTree(m,0,y,o),W=(Ee,dt)=>{Ee instanceof ProvidedColumnGroup&&Ee.setupExpandable(),Ee.setOriginalParent(dt)};return this.columnUtils.depthFirstOriginalTreeSearch(null,D,W),{columnTree:D,treeDept:y}}extractExistingTreeData(e){const t=[],n=[],o=[];return e&&this.columnUtils.depthFirstOriginalTreeSearch(null,e,a=>{if(a instanceof ProvidedColumnGroup){const l=a;n.push(l)}else{const l=a;o.push(l.getId()),t.push(l)}}),{existingCols:t,existingGroups:n,existingColKeys:o}}createForAutoGroups(e,t){return e.map(n=>this.createAutoGroupTreeItem(t,n))}createAutoGroupTreeItem(e,t){const n=this.findDepth(e);let o=t;for(let a=n-1;a>=0;a--){const l=new ProvidedColumnGroup(null,`FAKE_PATH_${t.getId()}}_${a}`,!0,a);this.createBean(l),l.setChildren([o]),o.setOriginalParent(l),o=l}return o}findDepth(e){let t=0,n=e;for(;n&&n[0]&&n[0]instanceof ProvidedColumnGroup;)t++,n=n[0].getChildren();return t}balanceColumnTree(e,t,n,o){const a=[];for(let l=0;l<e.length;l++){const s=e[l];if(s instanceof ProvidedColumnGroup){const m=s,y=this.balanceColumnTree(m.getChildren(),t+1,n,o);m.setChildren(y),a.push(m)}else{let m,y;for(let D=n-1;D>=t;D--){const W=o.getUniqueKey(null,null),Ee=this.createMergedColGroupDef(null),dt=new ProvidedColumnGroup(Ee,W,!0,t);this.createBean(dt),y&&y.setChildren([dt]),y=dt,m||(m=y)}if(m&&y)if(a.push(m),e.some(W=>W instanceof ProvidedColumnGroup)){y.setChildren([s]);continue}else{y.setChildren(e);break}a.push(s)}}return a}findMaxDept(e,t){let n=t;for(let o=0;o<e.length;o++){const a=e[o];if(a instanceof ProvidedColumnGroup){const l=a,s=this.findMaxDept(l.getChildren(),t+1);n<s&&(n=s)}}return n}recursivelyCreateColumns(e,t,n,o,a,l){return(e||[]).map(s=>this.isColumnGroup(s)?this.createColumnGroup(n,s,t,o,a,l):this.createColumn(n,s,o,a))}createColumnGroup(e,t,n,o,a,l){const s=this.createMergedColGroupDef(t),m=a.getUniqueKey(s.groupId||null,null),y=new ProvidedColumnGroup(s,m,!1,n);this.createBean(y);const D=this.findExistingGroup(t,l);D&&removeFromArray(l,D),D&&D.isExpanded()&&y.setExpanded(!0);const W=this.recursivelyCreateColumns(s.children,n+1,e,o,a,l);return y.setChildren(W),y}createMergedColGroupDef(e){const t={};return Object.assign(t,this.gridOptionsService.get("defaultColGroupDef")),Object.assign(t,e),t}createColumn(e,t,n,o){let a=this.findExistingColumn(t,n);if(n&&a&&removeFromArray(n,a),a){const l=this.mergeColDefs(t,a.getColId());a.setColDef(l,t),this.applyColumnState(a,l)}else{const l=o.getUniqueKey(t.colId,t.field),s=this.mergeColDefs(t,l);a=new Column(s,t,l,e),this.context.createBean(a)}return this.dataTypeService.addColumnListeners(a),a}applyColumnState(e,t){const n=attrToNumber(t.flex);if(n!==void 0&&e.setFlex(n),e.getFlex()<=0){const s=attrToNumber(t.width);if(s!=null)e.setActualWidth(s);else{const m=e.getActualWidth();e.setActualWidth(m)}}t.sort!==void 0&&(t.sort=="asc"||t.sort=="desc"?e.setSort(t.sort):e.setSort(void 0));const a=attrToNumber(t.sortIndex);a!==void 0&&e.setSortIndex(a);const l=attrToBoolean(t.hide);l!==void 0&&e.setVisible(!l),t.pinned!==void 0&&e.setPinned(t.pinned)}findExistingColumn(e,t){return(t||[]).find(n=>{const o=n.getUserProvidedColDef();if(!o)return!1;const a=e.colId!=null,l=e.field!=null;return a?n.getId()===e.colId:l?o.field===e.field:o===e})}findExistingGroup(e,t){return t.find(n=>n.getColGroupDef()&&e.groupId!=null?n.getId()===e.groupId:!1)}mergeColDefs(e,t){const n={},o=this.gridOptionsService.get("defaultColDef");mergeDeep(n,o,!1,!0);const a=this.dataTypeService.updateColDefAndGetColumnType(n,e,t);a&&this.assignColumnTypes(a,n),mergeDeep(n,e,!1,!0);const l=this.gridOptionsService.get("autoGroupColumnDef"),s=this.gridOptionsService.isColumnsSortingCoupledToGroup();return e.rowGroup&&l&&s&&mergeDeep(n,{sort:l.sort,initialSort:l.initialSort},!1,!0),this.dataTypeService.validateColDef(n),n}assignColumnTypes(e,t){if(!e.length)return;const n=Object.assign({},DefaultColumnTypes),o=this.gridOptionsService.get("columnTypes")||{};iterateObject(o,(a,l)=>{a in n?console.warn(`AG Grid: the column type '${a}' is a default column type and cannot be overridden.`):n[a]=l}),e.forEach(a=>{const l=n[a.trim()];l?mergeDeep(t,l,!1,!0):console.warn("AG Grid: colDef.type '"+a+"' does not correspond to defined gridOptions.columnTypes")})}isColumnGroup(e){return e.children!==void 0}};__decorate$2A([Autowired("columnUtils")],ColumnFactory.prototype,"columnUtils",void 0);__decorate$2A([Autowired("dataTypeService")],ColumnFactory.prototype,"dataTypeService",void 0);__decorate$2A([__param$9(0,Qualifier("loggerFactory"))],ColumnFactory.prototype,"setBeans",null);ColumnFactory=__decorate$2A([Bean("columnFactory")],ColumnFactory);var __decorate$2z=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class ColumnGroup{constructor(e,t,n,o){this.displayedChildren=[],this.localEventService=new EventService,this.groupId=t,this.partId=n,this.providedColumnGroup=e,this.pinned=o}static createUniqueId(e,t){return e+"_"+t}reset(){this.parent=null,this.children=null,this.displayedChildren=null}getParent(){return this.parent}setParent(e){this.parent=e}getUniqueId(){return ColumnGroup.createUniqueId(this.groupId,this.partId)}isEmptyGroup(){return this.displayedChildren.length===0}isMoving(){const e=this.getProvidedColumnGroup().getLeafColumns();return!e||e.length===0?!1:e.every(t=>t.isMoving())}checkLeft(){if(this.displayedChildren.forEach(e=>{e instanceof ColumnGroup&&e.checkLeft()}),this.displayedChildren.length>0)if(this.gridOptionsService.is("enableRtl")){const t=last(this.displayedChildren).getLeft();this.setLeft(t)}else{const e=this.displayedChildren[0].getLeft();this.setLeft(e)}else this.setLeft(null)}getLeft(){return this.left}getOldLeft(){return this.oldLeft}setLeft(e){this.oldLeft=e,this.left!==e&&(this.left=e,this.localEventService.dispatchEvent(this.createAgEvent(ColumnGroup.EVENT_LEFT_CHANGED)))}getPinned(){return this.pinned}createAgEvent(e){return{type:e}}addEventListener(e,t){this.localEventService.addEventListener(e,t)}removeEventListener(e,t){this.localEventService.removeEventListener(e,t)}getGroupId(){return this.groupId}getPartId(){return this.partId}isChildInThisGroupDeepSearch(e){let t=!1;return this.children.forEach(n=>{e===n&&(t=!0),n instanceof ColumnGroup&&n.isChildInThisGroupDeepSearch(e)&&(t=!0)}),t}getActualWidth(){let e=0;return this.displayedChildren&&this.displayedChildren.forEach(t=>{e+=t.getActualWidth()}),e}isResizable(){if(!this.displayedChildren)return!1;let e=!1;return this.displayedChildren.forEach(t=>{t.isResizable()&&(e=!0)}),e}getMinWidth(){let e=0;return this.displayedChildren.forEach(t=>{e+=t.getMinWidth()||0}),e}addChild(e){this.children||(this.children=[]),this.children.push(e)}getDisplayedChildren(){return this.displayedChildren}getLeafColumns(){const e=[];return this.addLeafColumns(e),e}getDisplayedLeafColumns(){const e=[];return this.addDisplayedLeafColumns(e),e}getDefinition(){return this.providedColumnGroup.getColGroupDef()}getColGroupDef(){return this.providedColumnGroup.getColGroupDef()}isPadding(){return this.providedColumnGroup.isPadding()}isExpandable(){return this.providedColumnGroup.isExpandable()}isExpanded(){return this.providedColumnGroup.isExpanded()}setExpanded(e){this.providedColumnGroup.setExpanded(e)}addDisplayedLeafColumns(e){this.displayedChildren.forEach(t=>{t instanceof Column?e.push(t):t instanceof ColumnGroup&&t.addDisplayedLeafColumns(e)})}addLeafColumns(e){this.children.forEach(t=>{t instanceof Column?e.push(t):t instanceof ColumnGroup&&t.addLeafColumns(e)})}getChildren(){return this.children}getColumnGroupShow(){return this.providedColumnGroup.getColumnGroupShow()}getProvidedColumnGroup(){return this.providedColumnGroup}getPaddingLevel(){const e=this.getParent();return!this.isPadding()||!e||!e.isPadding()?0:1+e.getPaddingLevel()}calculateDisplayedColumns(){this.displayedChildren=[];let e=this;for(;e!=null&&e.isPadding();)e=e.getParent();if(!(e?e.providedColumnGroup.isExpandable():!1)){this.displayedChildren=this.children,this.localEventService.dispatchEvent(this.createAgEvent(ColumnGroup.EVENT_DISPLAYED_CHILDREN_CHANGED));return}this.children.forEach(n=>{if(n instanceof ColumnGroup&&(!n.displayedChildren||!n.displayedChildren.length))return;switch(n.getColumnGroupShow()){case"open":e.providedColumnGroup.isExpanded()&&this.displayedChildren.push(n);break;case"closed":e.providedColumnGroup.isExpanded()||this.displayedChildren.push(n);break;default:this.displayedChildren.push(n);break}}),this.localEventService.dispatchEvent(this.createAgEvent(ColumnGroup.EVENT_DISPLAYED_CHILDREN_CHANGED))}}ColumnGroup.EVENT_LEFT_CHANGED="leftChanged";ColumnGroup.EVENT_DISPLAYED_CHILDREN_CHANGED="displayedChildrenChanged";__decorate$2z([Autowired("gridOptionsService")],ColumnGroup.prototype,"gridOptionsService",void 0);class Events{}Events.EVENT_COLUMN_EVERYTHING_CHANGED="columnEverythingChanged";Events.EVENT_NEW_COLUMNS_LOADED="newColumnsLoaded";Events.EVENT_COLUMN_PIVOT_MODE_CHANGED="columnPivotModeChanged";Events.EVENT_COLUMN_ROW_GROUP_CHANGED="columnRowGroupChanged";Events.EVENT_EXPAND_COLLAPSE_ALL="expandOrCollapseAll";Events.EVENT_COLUMN_PIVOT_CHANGED="columnPivotChanged";Events.EVENT_GRID_COLUMNS_CHANGED="gridColumnsChanged";Events.EVENT_COLUMN_VALUE_CHANGED="columnValueChanged";Events.EVENT_COLUMN_MOVED="columnMoved";Events.EVENT_COLUMN_VISIBLE="columnVisible";Events.EVENT_COLUMN_PINNED="columnPinned";Events.EVENT_COLUMN_GROUP_OPENED="columnGroupOpened";Events.EVENT_COLUMN_RESIZED="columnResized";Events.EVENT_DISPLAYED_COLUMNS_CHANGED="displayedColumnsChanged";Events.EVENT_VIRTUAL_COLUMNS_CHANGED="virtualColumnsChanged";Events.EVENT_ASYNC_TRANSACTIONS_FLUSHED="asyncTransactionsFlushed";Events.EVENT_ROW_GROUP_OPENED="rowGroupOpened";Events.EVENT_ROW_DATA_CHANGED="rowDataChanged";Events.EVENT_ROW_DATA_UPDATED="rowDataUpdated";Events.EVENT_PINNED_ROW_DATA_CHANGED="pinnedRowDataChanged";Events.EVENT_RANGE_SELECTION_CHANGED="rangeSelectionChanged";Events.EVENT_CHART_CREATED="chartCreated";Events.EVENT_CHART_RANGE_SELECTION_CHANGED="chartRangeSelectionChanged";Events.EVENT_CHART_OPTIONS_CHANGED="chartOptionsChanged";Events.EVENT_CHART_DESTROYED="chartDestroyed";Events.EVENT_TOOL_PANEL_VISIBLE_CHANGED="toolPanelVisibleChanged";Events.EVENT_TOOL_PANEL_SIZE_CHANGED="toolPanelSizeChanged";Events.EVENT_COLUMN_PANEL_ITEM_DRAG_START="columnPanelItemDragStart";Events.EVENT_COLUMN_PANEL_ITEM_DRAG_END="columnPanelItemDragEnd";Events.EVENT_MODEL_UPDATED="modelUpdated";Events.EVENT_CUT_START="cutStart";Events.EVENT_CUT_END="cutEnd";Events.EVENT_PASTE_START="pasteStart";Events.EVENT_PASTE_END="pasteEnd";Events.EVENT_FILL_START="fillStart";Events.EVENT_FILL_END="fillEnd";Events.EVENT_RANGE_DELETE_START="rangeDeleteStart";Events.EVENT_RANGE_DELETE_END="rangeDeleteEnd";Events.EVENT_UNDO_STARTED="undoStarted";Events.EVENT_UNDO_ENDED="undoEnded";Events.EVENT_REDO_STARTED="redoStarted";Events.EVENT_REDO_ENDED="redoEnded";Events.EVENT_KEY_SHORTCUT_CHANGED_CELL_START="keyShortcutChangedCellStart";Events.EVENT_KEY_SHORTCUT_CHANGED_CELL_END="keyShortcutChangedCellEnd";Events.EVENT_CELL_CLICKED="cellClicked";Events.EVENT_CELL_DOUBLE_CLICKED="cellDoubleClicked";Events.EVENT_CELL_MOUSE_DOWN="cellMouseDown";Events.EVENT_CELL_CONTEXT_MENU="cellContextMenu";Events.EVENT_CELL_VALUE_CHANGED="cellValueChanged";Events.EVENT_CELL_EDIT_REQUEST="cellEditRequest";Events.EVENT_ROW_VALUE_CHANGED="rowValueChanged";Events.EVENT_CELL_FOCUSED="cellFocused";Events.EVENT_CELL_FOCUS_CLEARED="cellFocusCleared";Events.EVENT_FULL_WIDTH_ROW_FOCUSED="fullWidthRowFocused";Events.EVENT_ROW_SELECTED="rowSelected";Events.EVENT_SELECTION_CHANGED="selectionChanged";Events.EVENT_CELL_KEY_DOWN="cellKeyDown";Events.EVENT_CELL_MOUSE_OVER="cellMouseOver";Events.EVENT_CELL_MOUSE_OUT="cellMouseOut";Events.EVENT_FILTER_CHANGED="filterChanged";Events.EVENT_FILTER_MODIFIED="filterModified";Events.EVENT_FILTER_OPENED="filterOpened";Events.EVENT_SORT_CHANGED="sortChanged";Events.EVENT_VIRTUAL_ROW_REMOVED="virtualRowRemoved";Events.EVENT_ROW_CLICKED="rowClicked";Events.EVENT_ROW_DOUBLE_CLICKED="rowDoubleClicked";Events.EVENT_GRID_READY="gridReady";Events.EVENT_GRID_SIZE_CHANGED="gridSizeChanged";Events.EVENT_VIEWPORT_CHANGED="viewportChanged";Events.EVENT_SCROLLBAR_WIDTH_CHANGED="scrollbarWidthChanged";Events.EVENT_FIRST_DATA_RENDERED="firstDataRendered";Events.EVENT_DRAG_STARTED="dragStarted";Events.EVENT_DRAG_STOPPED="dragStopped";Events.EVENT_CHECKBOX_CHANGED="checkboxChanged";Events.EVENT_ROW_EDITING_STARTED="rowEditingStarted";Events.EVENT_ROW_EDITING_STOPPED="rowEditingStopped";Events.EVENT_CELL_EDITING_STARTED="cellEditingStarted";Events.EVENT_CELL_EDITING_STOPPED="cellEditingStopped";Events.EVENT_BODY_SCROLL="bodyScroll";Events.EVENT_BODY_SCROLL_END="bodyScrollEnd";Events.EVENT_HEIGHT_SCALE_CHANGED="heightScaleChanged";Events.EVENT_PAGINATION_CHANGED="paginationChanged";Events.EVENT_COMPONENT_STATE_CHANGED="componentStateChanged";Events.EVENT_STORE_REFRESHED="storeRefreshed";Events.EVENT_BODY_HEIGHT_CHANGED="bodyHeightChanged";Events.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED="displayedColumnsWidthChanged";Events.EVENT_SCROLL_VISIBILITY_CHANGED="scrollVisibilityChanged";Events.EVENT_COLUMN_HOVER_CHANGED="columnHoverChanged";Events.EVENT_FLASH_CELLS="flashCells";Events.EVENT_PAGINATION_PIXEL_OFFSET_CHANGED="paginationPixelOffsetChanged";Events.EVENT_DISPLAYED_ROWS_CHANGED="displayedRowsChanged";Events.EVENT_LEFT_PINNED_WIDTH_CHANGED="leftPinnedWidthChanged";Events.EVENT_RIGHT_PINNED_WIDTH_CHANGED="rightPinnedWidthChanged";Events.EVENT_ROW_CONTAINER_HEIGHT_CHANGED="rowContainerHeightChanged";Events.EVENT_HEADER_HEIGHT_CHANGED="headerHeightChanged";Events.EVENT_COLUMN_HEADER_HEIGHT_CHANGED="columnHeaderHeightChanged";Events.EVENT_ROW_DRAG_ENTER="rowDragEnter";Events.EVENT_ROW_DRAG_MOVE="rowDragMove";Events.EVENT_ROW_DRAG_LEAVE="rowDragLeave";Events.EVENT_ROW_DRAG_END="rowDragEnd";Events.EVENT_GRID_STYLES_CHANGED="gridStylesChanged";Events.EVENT_POPUP_TO_FRONT="popupToFront";Events.EVENT_COLUMN_ROW_GROUP_CHANGE_REQUEST="columnRowGroupChangeRequest";Events.EVENT_COLUMN_PIVOT_CHANGE_REQUEST="columnPivotChangeRequest";Events.EVENT_COLUMN_VALUE_CHANGE_REQUEST="columnValueChangeRequest";Events.EVENT_COLUMN_AGG_FUNC_CHANGE_REQUEST="columnAggFuncChangeRequest";Events.EVENT_KEYBOARD_FOCUS="keyboardFocus";Events.EVENT_MOUSE_FOCUS="mouseFocus";Events.EVENT_STORE_UPDATED="storeUpdated";Events.EVENT_FILTER_DESTROYED="filterDestroyed";Events.EVENT_ROW_DATA_UPDATE_STARTED="rowDataUpdateStarted";class GroupInstanceIdCreator{constructor(){this.existingIds={}}getInstanceIdForKey(e){const t=this.existingIds[e];let n;return typeof t!="number"?n=0:n=t+1,this.existingIds[e]=n,n}}var __decorate$2y=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const GROUP_AUTO_COLUMN_ID="ag-Grid-AutoColumn";let AutoGroupColService=class extends BeanStub{createAutoGroupColumns(e,t){const n=[],o=this.gridOptionsService.isTreeData();let a=this.gridOptionsService.isGroupMultiAutoColumn();return o&&a&&(console.warn('AG Grid: you cannot mix groupDisplayType = "multipleColumns" with treeData, only one column can be used to display groups when doing tree data'),a=!1),a?t.forEach((l,s)=>{n.push(this.createOneAutoGroupColumn(e,l,s))}):n.push(this.createOneAutoGroupColumn(e)),n}createOneAutoGroupColumn(e,t,n){let o=this.generateDefaultColDef(t),a;t?a=`${GROUP_AUTO_COLUMN_ID}-${t.getId()}`:a=GROUP_AUTO_COLUMN_ID;const l=this.gridOptionsService.get("autoGroupColumnDef");mergeDeep(o,l),o=this.columnFactory.mergeColDefs(o,a),o.colId=a,this.gridOptionsService.isTreeData()||missing(o.field)&&missing(o.valueGetter)&&missing(o.filterValueGetter)&&o.filter!=="agGroupColumnFilter"&&(o.filter=!1),n&&n>0&&(o.headerCheckboxSelection=!1);const s=e.find(D=>D.getId()==a),m=this.gridOptionsService.isColumnsSortingCoupledToGroup();if(s)return m&&(o.sort=void 0,o.sortIndex=void 0),s.setColDef(o,null),this.columnFactory.applyColumnState(s,o),s;m&&(o.sort||o.initialSort||"sortIndex"in o)&&!o.field&&(o.sort=null,o.sortIndex=null,o.initialSort=null);const y=new Column(o,null,a,!0);return this.context.createBean(y),y}generateDefaultColDef(e){const t=this.gridOptionsService.get("autoGroupColumnDef"),o={headerName:this.localeService.getLocaleTextFunc()("group","Group")};if(t&&(t.cellRenderer||t.cellRendererSelector)||(o.cellRenderer="agGroupCellRenderer"),e){const l=e.getColDef();Object.assign(o,{headerName:this.columnModel.getDisplayNameForColumn(e,"header"),headerValueGetter:l.headerValueGetter}),l.cellRenderer&&Object.assign(o,{cellRendererParams:{innerRenderer:l.cellRenderer,innerRendererParams:l.cellRendererParams}}),o.showRowGroup=e.getColId()}else o.showRowGroup=!0;return o}};__decorate$2y([Autowired("columnModel")],AutoGroupColService.prototype,"columnModel",void 0);__decorate$2y([Autowired("columnFactory")],AutoGroupColService.prototype,"columnFactory",void 0);AutoGroupColService=__decorate$2y([Bean("autoGroupColService")],AutoGroupColService);const reUnescapedHtml=/[&<>"']/g,HTML_ESCAPES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function utf8_encode(r){const e=String.fromCharCode;function t(W){const Ee=[];if(!W)return[];const dt=W.length;let Ht=0,ir,Hr;for(;Ht<dt;)ir=W.charCodeAt(Ht++),ir>=55296&&ir<=56319&&Ht<dt?(Hr=W.charCodeAt(Ht++),(Hr&64512)==56320?Ee.push(((ir&1023)<<10)+(Hr&1023)+65536):(Ee.push(ir),Ht--)):Ee.push(ir);return Ee}function n(W){if(W>=55296&&W<=57343)throw Error("Lone surrogate U+"+W.toString(16).toUpperCase()+" is not a scalar value")}function o(W,Ee){return e(W>>Ee&63|128)}function a(W){if(W>=0&&W<=31&&W!==10)return`_x${W.toString(16).toUpperCase().padStart(4,"0")}_`;if(!(W&4294967168))return e(W);let Ee="";return W&4294965248?W&4294901760?W&4292870144||(Ee=e(W>>18&7|240),Ee+=o(W,12),Ee+=o(W,6)):(n(W),Ee=e(W>>12&15|224),Ee+=o(W,6)):Ee=e(W>>6&31|192),Ee+=e(W&63|128),Ee}const l=t(r),s=l.length;let m=-1,y,D="";for(;++m<s;)y=l[m],D+=a(y);return D}function capitalise(r){return r[0].toUpperCase()+r.substr(1).toLowerCase()}function escapeString(r,e){if(r==null)return null;const t=r.toString().toString();return e?t:t.replace(reUnescapedHtml,n=>HTML_ESCAPES[n])}function camelCaseToHumanText(r){if(!r||r==null)return null;const e=/([a-z])([A-Z])/g,t=/([A-Z]+)([A-Z])([a-z])/g;return r.replace(e,"$1 $2").replace(t,"$1 $2$3").replace(/\./g," ").split(" ").map(o=>o.substring(0,1).toUpperCase()+(o.length>1?o.substring(1,o.length):"")).join(" ")}function camelCaseToHyphenated(r){return r.replace(/[A-Z]/g,e=>`-${e.toLocaleLowerCase()}`)}var StringUtils=Object.freeze({__proto__:null,utf8_encode,capitalise,escapeString,camelCaseToHumanText,camelCaseToHyphenated});function convertToMap(r){const e=new Map;return r.forEach(t=>e.set(t[0],t[1])),e}function mapById(r,e){const t=new Map;return r.forEach(n=>t.set(e(n),n)),t}function keys$1(r){const e=[];return r.forEach((t,n)=>e.push(n)),e}var MapUtils=Object.freeze({__proto__:null,convertToMap,mapById,keys:keys$1});class ColDefUtil{}ColDefUtil.ColDefPropertyMap={headerName:void 0,columnGroupShow:void 0,headerClass:void 0,toolPanelClass:void 0,headerValueGetter:void 0,pivotKeys:void 0,groupId:void 0,colId:void 0,sort:void 0,initialSort:void 0,field:void 0,type:void 0,cellDataType:void 0,tooltipComponent:void 0,tooltipField:void 0,headerTooltip:void 0,cellClass:void 0,showRowGroup:void 0,filter:void 0,initialAggFunc:void 0,defaultAggFunc:void 0,aggFunc:void 0,pinned:void 0,initialPinned:void 0,chartDataType:void 0,cellEditorPopupPosition:void 0,headerGroupComponent:void 0,headerGroupComponentParams:void 0,cellStyle:void 0,cellRenderer:void 0,cellRendererParams:void 0,cellEditor:void 0,cellEditorParams:void 0,filterParams:void 0,pivotValueColumn:void 0,headerComponent:void 0,headerComponentParams:void 0,floatingFilterComponent:void 0,floatingFilterComponentParams:void 0,tooltipComponentParams:void 0,refData:void 0,columnsMenuParams:void 0,children:void 0,sortingOrder:void 0,allowedAggFuncs:void 0,menuTabs:void 0,pivotTotalColumnIds:void 0,cellClassRules:void 0,icons:void 0,sortIndex:void 0,initialSortIndex:void 0,flex:void 0,initialFlex:void 0,width:void 0,initialWidth:void 0,minWidth:void 0,maxWidth:void 0,rowGroupIndex:void 0,initialRowGroupIndex:void 0,pivotIndex:void 0,initialPivotIndex:void 0,suppressCellFlash:void 0,suppressColumnsToolPanel:void 0,suppressFiltersToolPanel:void 0,openByDefault:void 0,marryChildren:void 0,suppressStickyLabel:void 0,hide:void 0,initialHide:void 0,rowGroup:void 0,initialRowGroup:void 0,pivot:void 0,initialPivot:void 0,checkboxSelection:void 0,showDisabledCheckboxes:void 0,headerCheckboxSelection:void 0,headerCheckboxSelectionFilteredOnly:void 0,headerCheckboxSelectionCurrentPageOnly:void 0,suppressMenu:void 0,suppressMovable:void 0,lockPosition:void 0,lockVisible:void 0,lockPinned:void 0,unSortIcon:void 0,suppressSizeToFit:void 0,suppressAutoSize:void 0,enableRowGroup:void 0,enablePivot:void 0,enableValue:void 0,editable:void 0,suppressPaste:void 0,suppressNavigable:void 0,enableCellChangeFlash:void 0,rowDrag:void 0,dndSource:void 0,autoHeight:void 0,wrapText:void 0,sortable:void 0,resizable:void 0,singleClickEdit:void 0,floatingFilter:void 0,cellEditorPopup:void 0,suppressFillHandle:void 0,wrapHeaderText:void 0,autoHeaderHeight:void 0,dndSourceOnRowDrag:void 0,valueGetter:void 0,valueSetter:void 0,filterValueGetter:void 0,keyCreator:void 0,valueFormatter:void 0,valueParser:void 0,comparator:void 0,equals:void 0,pivotComparator:void 0,suppressKeyboardEvent:void 0,suppressHeaderKeyboardEvent:void 0,colSpan:void 0,rowSpan:void 0,getQuickFilterText:void 0,onCellValueChanged:void 0,onCellClicked:void 0,onCellDoubleClicked:void 0,onCellContextMenu:void 0,rowDragText:void 0,tooltipValueGetter:void 0,cellRendererSelector:void 0,cellEditorSelector:void 0,suppressSpanHeaderHeight:void 0,useValueFormatterForExport:void 0,useValueParserForImport:void 0};ColDefUtil.ALL_PROPERTIES=Object.keys(ColDefUtil.ColDefPropertyMap);class PropertyKeys{}PropertyKeys.STRING_PROPERTIES=["rowSelection","overlayLoadingTemplate","overlayNoRowsTemplate","gridId","quickFilterText","rowModelType","editType","domLayout","clipboardDelimiter","rowGroupPanelShow","multiSortKey","pivotColumnGroupTotals","pivotRowTotals","pivotPanelShow","fillHandleDirection","serverSideStoreType","groupDisplayType","treeDataDisplayType","colResizeDefault"];PropertyKeys.OBJECT_PROPERTIES=["components","rowStyle","context","autoGroupColumnDef","localeText","icons","datasource","serverSideDatasource","viewportDatasource","groupRowRendererParams","aggFuncs","fullWidthCellRendererParams","defaultColGroupDef","defaultColDef","defaultCsvExportParams","defaultExcelExportParams","columnTypes","rowClassRules","detailCellRendererParams","loadingCellRendererParams","loadingOverlayComponentParams","noRowsOverlayComponentParams","popupParent","statusBar","sideBar","chartThemeOverrides","customChartThemes","chartToolPanelsDef","dataTypeDefinitions"];PropertyKeys.ARRAY_PROPERTIES=["sortingOrder","alignedGrids","rowData","columnDefs","excelStyles","pinnedTopRowData","pinnedBottomRowData","chartThemes","rowClass"];PropertyKeys.NUMBER_PROPERTIES=["rowHeight","detailRowHeight","rowBuffer","headerHeight","groupHeaderHeight","floatingFiltersHeight","pivotHeaderHeight","pivotGroupHeaderHeight","groupDefaultExpanded","viewportRowModelPageSize","viewportRowModelBufferSize","autoSizePadding","maxBlocksInCache","maxConcurrentDatasourceRequests","tooltipShowDelay","tooltipHideDelay","cacheOverflowSize","paginationPageSize","cacheBlockSize","infiniteInitialRowCount","serverSideInitialRowCount","scrollbarWidth","asyncTransactionWaitMillis","blockLoadDebounceMillis","keepDetailRowsCount","undoRedoCellEditingLimit","cellFlashDelay","cellFadeDelay","tabIndex"];PropertyKeys.BOOLEAN_PROPERTIES=["suppressMakeColumnVisibleAfterUnGroup","suppressRowClickSelection","suppressCellFocus","suppressHorizontalScroll","alwaysShowHorizontalScroll","alwaysShowVerticalScroll","debug","enableBrowserTooltips","enableCellExpressions","groupSelectsChildren","groupIncludeFooter","groupIncludeTotalFooter","groupSuppressBlankHeader","suppressMenuHide","suppressRowDeselection","unSortIcon","suppressMultiSort","alwaysMultiSort","singleClickEdit","suppressLoadingOverlay","suppressNoRowsOverlay","suppressAutoSize","skipHeaderOnAutoSize","suppressParentsInRowNodes","suppressColumnMoveAnimation","suppressMovableColumns","suppressFieldDotNotation","enableRangeSelection","enableRangeHandle","enableFillHandle","suppressClearOnFillReduction","deltaSort","suppressTouch","suppressAsyncEvents","allowContextMenuWithControlKey","suppressContextMenu","rememberGroupStateWhenNewData","enableCellChangeFlash","suppressDragLeaveHidesColumns","suppressRowGroupHidesColumns","suppressMiddleClickScrolls","suppressPreventDefaultOnMouseWheel","suppressCopyRowsToClipboard","copyHeadersToClipboard","copyGroupHeadersToClipboard","pivotMode","suppressAggFuncInHeader","suppressColumnVirtualisation","alwaysAggregateAtRootLevel","suppressAggAtRootLevel","suppressFocusAfterRefresh","functionsPassive","functionsReadOnly","animateRows","groupSelectsFiltered","groupRemoveSingleChildren","groupRemoveLowestSingleChildren","enableRtl","suppressClickEdit","rowDragEntireRow","rowDragManaged","suppressRowDrag","suppressMoveWhenRowDragging","rowDragMultiRow","enableGroupEdit","embedFullWidthRows","suppressPaginationPanel","groupHideOpenParents","groupAllowUnbalanced","pagination","paginationAutoPageSize","suppressScrollOnNewData","suppressScrollWhenPopupsAreOpen","purgeClosedRowNodes","cacheQuickFilter","includeHiddenColumnsInQuickFilter","excludeHiddenColumnsFromQuickFilter","ensureDomOrder","accentedSort","suppressChangeDetection","valueCache","valueCacheNeverExpires","aggregateOnlyChangedColumns","suppressAnimationFrame","suppressExcelExport","suppressCsvExport","treeData","masterDetail","suppressMultiRangeSelection","enterMovesDown","enterMovesDownAfterEdit","enterNavigatesVerticallyAfterEdit","enterNavigatesVertically","suppressPropertyNamesCheck","rowMultiSelectWithClick","suppressRowHoverHighlight","suppressRowTransform","suppressClipboardPaste","suppressLastEmptyLineOnPaste","enableCharts","enableChartToolPanelsButton","suppressChartToolPanelsButton","suppressMaintainUnsortedOrder","enableCellTextSelection","suppressBrowserResizeObserver","suppressMaxRenderedRowRestriction","excludeChildrenWhenTreeDataFiltering","tooltipMouseTrack","keepDetailRows","paginateChildRows","preventDefaultOnContextMenu","undoRedoCellEditing","allowDragFromColumnsToolPanel","pivotSuppressAutoColumn","suppressExpandablePivotGroups","debounceVerticalScrollbar","detailRowAutoHeight","serverSideFilteringAlwaysResets","serverSideFilterAllLevels","serverSideSortingAlwaysResets","serverSideSortAllLevels","serverSideOnlyRefreshFilteredGroups","serverSideSortOnServer","serverSideFilterOnServer","suppressAggFilteredOnly","showOpenedGroup","suppressClipboardApi","suppressModelUpdateAfterUpdateTransaction","stopEditingWhenCellsLoseFocus","maintainColumnOrder","groupMaintainOrder","columnHoverHighlight","suppressReactUi","readOnlyEdit","suppressRowVirtualisation","enableCellEditingOnBackspace","resetRowDataOnUpdate","removePivotHeaderRowWhenSingleValueColumn","suppressCopySingleCellRanges","suppressGroupRowsSticky","suppressServerSideInfiniteScroll","rowGroupPanelSuppressSort","allowShowChangeAfterFilter","suppressCutToClipboard"];PropertyKeys.FUNCTIONAL_PROPERTIES=["doesExternalFilterPass","processSecondaryColDef","processSecondaryColGroupDef","processPivotResultColDef","processPivotResultColGroupDef","getBusinessKeyForNode","isRowSelectable","rowDragText","groupRowRenderer","fullWidthCellRenderer","loadingCellRenderer","loadingOverlayComponent","noRowsOverlayComponent","detailCellRenderer"];PropertyKeys.CALLBACK_PROPERTIES=["getLocaleText","isExternalFilterPresent","getRowHeight","getRowClass","getRowStyle","getContextMenuItems","getMainMenuItems","processRowPostCreate","processCellForClipboard","getGroupRowAgg","isFullWidthRow","sendToClipboard","navigateToNextHeader","tabToNextHeader","navigateToNextCell","tabToNextCell","processCellFromClipboard","getDocument","postProcessPopup","getChildCount","getDataPath","isRowMaster","postSortRows","processHeaderForClipboard","processGroupHeaderForClipboard","paginationNumberFormatter","processDataFromClipboard","getServerSideGroupKey","isServerSideGroup","createChartContainer","getChartToolbarItems","fillOperation","isApplyServerSideTransaction","getServerSideStoreParams","getServerSideGroupLevelParams","isServerSideGroupOpenByDefault","isGroupOpenByDefault","initialGroupOrderComparator","loadingCellRendererSelector","getRowId","groupAggFiltering"];PropertyKeys.FUNCTION_PROPERTIES=[...PropertyKeys.FUNCTIONAL_PROPERTIES,...PropertyKeys.CALLBACK_PROPERTIES];PropertyKeys.ALL_PROPERTIES=[...PropertyKeys.ARRAY_PROPERTIES,...PropertyKeys.OBJECT_PROPERTIES,...PropertyKeys.STRING_PROPERTIES,...PropertyKeys.NUMBER_PROPERTIES,...PropertyKeys.FUNCTION_PROPERTIES,...PropertyKeys.BOOLEAN_PROPERTIES];class ComponentUtil{static getCallbackForEvent(e){return!e||e.length<2?e:"on"+e[0].toUpperCase()+e.substr(1)}static getCoercionLookup(){let e={};return[...ComponentUtil.ARRAY_PROPERTIES,...ComponentUtil.OBJECT_PROPERTIES,...ComponentUtil.STRING_PROPERTIES,...ComponentUtil.FUNCTION_PROPERTIES,...ComponentUtil.EVENT_CALLBACKS].forEach(t=>e[t]="none"),ComponentUtil.BOOLEAN_PROPERTIES.forEach(t=>e[t]="boolean"),ComponentUtil.NUMBER_PROPERTIES.forEach(t=>e[t]="number"),e}static getValue(e,t){const n=ComponentUtil.coercionLookup[e];if(n){let o=t;switch(n){case"number":{o=ComponentUtil.toNumber(t);break}case"boolean":{o=ComponentUtil.toBoolean(t);break}case"none":{e==="groupAggFiltering"&&typeof t!="function"&&(o=ComponentUtil.toBoolean(t));break}}return o}}static getGridOptionKeys(e,t){return Object.keys(t?ComponentUtil.coercionLookup:e)}static copyAttributesToGridOptions(e,t,n=!1){typeof e!="object"&&(e={});const o=e;return ComponentUtil.getGridOptionKeys(t,n).forEach(l=>{const s=t[l];if(typeof s<"u"){const m=ComponentUtil.getValue(l,s);m!==void 0&&(o[l]=m)}}),e}static processOnChange(e,t){if(!e||Object.keys(e).length===0)return;const n=Object.assign({},e);n.columnTypes&&(t.setColumnTypes(n.columnTypes.currentValue,"gridOptionsChanged"),delete n.columnTypes),n.autoGroupColumnDef&&(t.setAutoGroupColumnDef(n.autoGroupColumnDef.currentValue,"gridOptionsChanged"),delete n.autoGroupColumnDef),n.defaultColDef&&(t.setDefaultColDef(n.defaultColDef.currentValue,"gridOptionsChanged"),delete n.defaultColDef),n.columnDefs&&(t.setColumnDefs(n.columnDefs.currentValue,"gridOptionsChanged"),delete n.columnDefs),Object.keys(n).forEach(a=>{const l=a,s=ComponentUtil.getValue(l,n[l].currentValue);t.__setProperty(l,s)});const o={type:Events.EVENT_COMPONENT_STATE_CHANGED};iterateObject(e,(a,l)=>{o[a]=l}),t.dispatchEvent(o)}static toBoolean(e){return typeof e=="boolean"?e:typeof e=="string"?e.toUpperCase()==="TRUE"||e=="":!1}static toNumber(e){if(typeof e=="number")return e;if(typeof e=="string")return Number(e)}}ComponentUtil.EVENTS=values(Events);ComponentUtil.EXCLUDED_INTERNAL_EVENTS=[Events.EVENT_SCROLLBAR_WIDTH_CHANGED,Events.EVENT_CHECKBOX_CHANGED,Events.EVENT_HEIGHT_SCALE_CHANGED,Events.EVENT_BODY_HEIGHT_CHANGED,Events.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED,Events.EVENT_SCROLL_VISIBILITY_CHANGED,Events.EVENT_COLUMN_HOVER_CHANGED,Events.EVENT_FLASH_CELLS,Events.EVENT_PAGINATION_PIXEL_OFFSET_CHANGED,Events.EVENT_DISPLAYED_ROWS_CHANGED,Events.EVENT_LEFT_PINNED_WIDTH_CHANGED,Events.EVENT_RIGHT_PINNED_WIDTH_CHANGED,Events.EVENT_ROW_CONTAINER_HEIGHT_CHANGED,Events.EVENT_POPUP_TO_FRONT,Events.EVENT_KEYBOARD_FOCUS,Events.EVENT_MOUSE_FOCUS,Events.EVENT_STORE_UPDATED,Events.EVENT_COLUMN_PANEL_ITEM_DRAG_START,Events.EVENT_COLUMN_PANEL_ITEM_DRAG_END,Events.EVENT_FILL_START,Events.EVENT_FILL_END,Events.EVENT_KEY_SHORTCUT_CHANGED_CELL_START,Events.EVENT_KEY_SHORTCUT_CHANGED_CELL_END,Events.EVENT_FULL_WIDTH_ROW_FOCUSED,Events.EVENT_HEADER_HEIGHT_CHANGED,Events.EVENT_COLUMN_HEADER_HEIGHT_CHANGED,Events.EVENT_CELL_FOCUS_CLEARED,Events.EVENT_GRID_STYLES_CHANGED,Events.EVENT_FILTER_DESTROYED,Events.EVENT_ROW_DATA_UPDATE_STARTED];ComponentUtil.PUBLIC_EVENTS=ComponentUtil.EVENTS.filter(r=>!includes(ComponentUtil.EXCLUDED_INTERNAL_EVENTS,r));ComponentUtil.EVENT_CALLBACKS=ComponentUtil.EVENTS.map(r=>ComponentUtil.getCallbackForEvent(r));ComponentUtil.STRING_PROPERTIES=PropertyKeys.STRING_PROPERTIES;ComponentUtil.OBJECT_PROPERTIES=PropertyKeys.OBJECT_PROPERTIES;ComponentUtil.ARRAY_PROPERTIES=PropertyKeys.ARRAY_PROPERTIES;ComponentUtil.NUMBER_PROPERTIES=PropertyKeys.NUMBER_PROPERTIES;ComponentUtil.BOOLEAN_PROPERTIES=PropertyKeys.BOOLEAN_PROPERTIES;ComponentUtil.FUNCTION_PROPERTIES=PropertyKeys.FUNCTION_PROPERTIES;ComponentUtil.ALL_PROPERTIES=PropertyKeys.ALL_PROPERTIES;ComponentUtil.ALL_PROPERTIES_SET=new Set(PropertyKeys.ALL_PROPERTIES);ComponentUtil.coercionLookup=ComponentUtil.getCoercionLookup();function fuzzyCheckStrings(r,e,t){const n={},o=r.filter(a=>!e.some(l=>l===a));return o.length>0&&o.forEach(a=>n[a]=fuzzySuggestions(a,t)),n}function fuzzySuggestions(r,e,t,n){let o=e.map(a=>({value:a,relevance:stringWeightedDistances(r.toLowerCase(),a.toLocaleLowerCase())}));if(o.sort((a,l)=>l.relevance-a.relevance),t&&(o=o.filter(a=>a.relevance!==0)),n&&n>0){const l=o[0].relevance*n;o=o.filter(s=>l-s.relevance<0)}return o.map(a=>a.value)}function stringWeightedDistances(r,e){const t=r.replace(/\s/g,""),n=e.replace(/\s/g,"");let o=0,a=-1;for(let l=0;l<t.length;l++){const s=n.indexOf(t[l],a+1);s!==-1&&(a=s,o+=100-a*100/1e4*100)}return o}var FuzzyMatchUtils=Object.freeze({__proto__:null,fuzzyCheckStrings,fuzzySuggestions}),__decorate$2x=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};function logDeprecation(r,e,t,n){const o=t?`Please use '${t}' instead. `:"";doOnce(()=>console.warn(`AG Grid: since v${r}, '${e}' is deprecated. ${o}${n??""}`),`Deprecated_${e}`)}const VUE_FRAMEWORK_PROPS=["__ob__","__v_skip","__metadata__"];let GridOptionsValidator=class{constructor(){this.deprecatedProperties={rememberGroupStateWhenNewData:{version:"24",message:"Now that transaction updates are possible and they keep group state, this feature is no longer needed."},serverSideFilteringAlwaysResets:{version:"28.0",newProp:"serverSideOnlyRefreshFilteredGroups",copyToNewProp:!0},serverSideSortingAlwaysResets:{version:"28.0",newProp:"serverSideSortAllLevels",copyToNewProp:!0},suppressReactUi:{version:"28",message:"The legacy React rendering engine is deprecated and will be removed in the next major version of the grid."},processSecondaryColDef:{version:"28",newProp:"processPivotResultColDef",copyToNewProp:!0},processSecondaryColGroupDef:{version:"28",newProp:"processPivotResultColGroupDef",copyToNewProp:!0},getServerSideStoreParams:{version:"28",newProp:"getServerSideGroupLevelParams",copyToNewProp:!0},serverSideInfiniteScroll:{version:"29",message:"Infinite Scrolling is now the default behaviour. This can be suppressed with `suppressServerSideInfiniteScroll`."},enableChartToolPanelsButton:{version:"29",message:"The Chart Tool Panels button is now enabled by default. To hide the Chart Tool Panels button and display the hamburger button instead, set suppressChartToolPanelsButton=true."},functionsPassive:{version:"29.2"},onColumnRowGroupChangeRequest:{version:"29.2"},onColumnPivotChangeRequest:{version:"29.2"},onColumnValueChangeRequest:{version:"29.2"},onColumnAggFuncChangeRequest:{version:"29.2"},serverSideFilterAllLevels:{version:"30",message:"All server-side group levels are now filtered by default. This can be toggled using `serverSideOnlyRefreshFilteredGroups`."},suppressAggAtRootLevel:{version:"30",message:"The root level aggregation is now suppressed by default. This can be toggled using  `alwaysAggregateAtRootLevel`."},excludeHiddenColumnsFromQuickFilter:{version:"30",message:"Hidden columns are now excluded from the Quick Filter by default. This can be toggled using `includeHiddenColumnsInQuickFilter`."},enterMovesDown:{version:"30",newProp:"enterNavigatesVertically",copyToNewProp:!0},enterMovesDownAfterEdit:{version:"30",newProp:"enterNavigatesVerticallyAfterEdit",copyToNewProp:!0}}}pickOneWarning(e,t){console.warn(`AG Grid: ${e} and ${t} do not work with each other, you need to pick one.`)}init(){if(this.checkForDeprecated(),this.checkForViolations(),this.gridOptions.suppressPropertyNamesCheck!==!0&&(this.checkGridOptionsProperties(),this.checkColumnDefProperties()),this.checkColumnDefViolations(),this.gridOptionsService.is("groupSelectsChildren")&&this.gridOptionsService.is("suppressParentsInRowNodes")&&console.warn("AG Grid: 'groupSelectsChildren' does not work with 'suppressParentsInRowNodes', this selection method needs the part in rowNode to work"),this.gridOptionsService.is("groupSelectsChildren")&&this.gridOptionsService.get("rowSelection")!=="multiple"&&console.warn("AG Grid: rowSelection must be 'multiple' for groupSelectsChildren to make sense"),this.gridOptionsService.is("groupRemoveSingleChildren")&&this.gridOptionsService.is("groupHideOpenParents")&&this.pickOneWarning("groupRemoveSingleChildren","groupHideOpenParents"),this.gridOptionsService.isRowModelType("serverSide")){const t=(n,o)=>`AG Grid: '${n}' is not supported on the Server-Side Row Model.`+(o?` Please use ${o} instead.`:"");this.gridOptionsService.exists("groupDefaultExpanded")&&console.warn(t("groupDefaultExpanded","isServerSideGroupOpenByDefault callback")),this.gridOptionsService.exists("groupIncludeFooter")&&this.gridOptionsService.is("suppressServerSideInfiniteScroll")&&console.warn(t("groupIncludeFooter")),this.gridOptionsService.exists("groupIncludeTotalFooter")&&console.warn(t("groupIncludeTotalFooter"))}this.gridOptionsService.is("enableRangeSelection")?ModuleRegistry.__assertRegistered(ModuleNames.RangeSelectionModule,"enableRangeSelection",this.gridOptionsService.getGridId()):(this.gridOptionsService.is("enableRangeHandle")||this.gridOptionsService.is("enableFillHandle"))&&console.warn("AG Grid: 'enableRangeHandle' or 'enableFillHandle' will not work unless 'enableRangeSelection' is set to true");const e=(t,n)=>this.gridOptionsService.exists(t)&&ModuleRegistry.__assertRegistered(n,t,this.gridOptionsService.getGridId());e("sideBar",ModuleNames.SideBarModule),e("statusBar",ModuleNames.StatusBarModule),e("enableCharts",ModuleNames.GridChartsModule),e("getMainMenuItems",ModuleNames.MenuModule),e("getContextMenuItems",ModuleNames.MenuModule),e("allowContextMenuWithControlKey",ModuleNames.MenuModule)}checkColumnDefProperties(){if(this.gridOptions.columnDefs==null)return;const e=ColDefUtil.ALL_PROPERTIES,t=(n,o)=>{const a=Object.getOwnPropertyNames(n);this.checkProperties(a,[...e,...VUE_FRAMEWORK_PROPS],e,o,"https://www.ag-grid.com/javascript-data-grid/column-properties/"),n.children&&n.children.forEach(l=>t(l,"columnDefs.children"))};this.gridOptions.columnDefs.forEach(n=>t(n,"columnDefs")),this.gridOptions.defaultColDef&&t(this.gridOptions.defaultColDef,"defaultColDef")}checkColumnDefViolations(){var e;const t=(e=this.gridOptionsService.get("rowModelType"))!==null&&e!==void 0?e:"clientSide",o={infinite:["headerCheckboxSelection","headerCheckboxSelectionFilteredOnly","headerCheckboxSelectionCurrentPageOnly"],viewport:["headerCheckboxSelection","headerCheckboxSelectionFilteredOnly","headerCheckboxSelectionCurrentPageOnly"],serverSide:["headerCheckboxSelectionFilteredOnly","headerCheckboxSelectionCurrentPageOnly"],clientSide:[]}[t];if(!(o!=null&&o.length))return;const a=l=>{o.forEach(s=>{s in l&&l[s]&&console.warn(`AG Grid: Column property ${s} is not supported with the row model type ${t}.`)})};this.gridOptions.columnDefs!=null&&this.gridOptions.columnDefs.forEach(l=>a(l)),this.gridOptions.autoGroupColumnDef!=null&&a(this.gridOptions.autoGroupColumnDef),this.gridOptions.defaultColDef!=null&&a(this.gridOptions.defaultColDef)}checkGridOptionsProperties(){const e=Object.getOwnPropertyNames(this.gridOptions),t=[...PropertyKeys.ALL_PROPERTIES,...ComponentUtil.EVENT_CALLBACKS],n=[...t,"api","columnApi",...VUE_FRAMEWORK_PROPS,...Object.keys(this.deprecatedProperties)];this.checkProperties(e,n,t,"gridOptions","https://www.ag-grid.com/javascript-data-grid/grid-options/")}checkProperties(e,t,n,o,a){const l=fuzzyCheckStrings(e,t,n);iterateObject(l,(s,m)=>{doOnce(()=>console.warn(`AG Grid: invalid ${o} property '${s}' did you mean any of these: ${m.slice(0,8).join(", ")}`),"invalidProperty"+o+s)}),Object.keys(l).length>0&&doOnce(()=>console.warn(`AG Grid: to see all the valid ${o} properties please check: ${a}`),"invalidProperties"+o+a)}checkForDeprecated(){const e=this.gridOptions;Object.entries(this.deprecatedProperties).forEach(([t,n])=>{var o;const a=e[t];a&&(logDeprecation(n.version,t,n.newProp,n.message),n.copyToNewProp&&n.newProp&&e[n.newProp]==null&&(e[n.newProp]=(o=n.newPropValue)!==null&&o!==void 0?o:a))}),e.serverSideStoreType&&(console.warn("AG Grid: since v29.0, `serverSideStoreType` has been replaced by `suppressServerSideInfiniteScroll`. Set to false to use Partial Store, and true to use Full Store."),e.suppressServerSideInfiniteScroll=e.serverSideStoreType!=="partial")}checkForViolations(){this.gridOptionsService.is("treeData")&&this.treeDataViolations()}treeDataViolations(){this.gridOptionsService.isRowModelType("clientSide")&&(this.gridOptionsService.exists("getDataPath")||console.warn("AG Grid: property usingTreeData=true with rowModel=clientSide, but you did not provide getDataPath function, please provide getDataPath function if using tree data.")),this.gridOptionsService.isRowModelType("serverSide")&&(this.gridOptionsService.exists("isServerSideGroup")||console.warn("AG Grid: property usingTreeData=true with rowModel=serverSide, but you did not provide isServerSideGroup function, please provide isServerSideGroup function if using tree data."),this.gridOptionsService.exists("getServerSideGroupKey")||console.warn("AG Grid: property usingTreeData=true with rowModel=serverSide, but you did not provide getServerSideGroupKey function, please provide getServerSideGroupKey function if using tree data."))}};__decorate$2x([Autowired("gridOptions")],GridOptionsValidator.prototype,"gridOptions",void 0);__decorate$2x([Autowired("gridOptionsService")],GridOptionsValidator.prototype,"gridOptionsService",void 0);__decorate$2x([PostConstruct],GridOptionsValidator.prototype,"init",null);GridOptionsValidator=__decorate$2x([Bean("gridOptionsValidator")],GridOptionsValidator);function matchesGroupDisplayType(r,e){const t=["groupRows","multipleColumns","custom","singleColumn"];return t.indexOf(e)<0?(console.warn(`AG Grid: '${e}' is not a valid groupDisplayType value - possible values are: '${t.join("', '")}'`),!1):e===r}function matchesTreeDataDisplayType(r,e){const t=["auto","custom"];return t.indexOf(e)<0?(console.warn(`AG Grid: '${e}' is not a valid treeDataDisplayType value - possible values are: '${t.join("', '")}'`),!1):e===r}var __decorate$2w=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},__param$8=function(r,e){return function(t,n){e(t,n,r)}},__rest=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(t[n[o]]=r[n[o]]);return t};let ColumnModel=class extends BeanStub{constructor(){super(...arguments),this.primaryHeaderRowCount=0,this.secondaryHeaderRowCount=0,this.gridHeaderRowCount=0,this.displayedColumnsLeft=[],this.displayedColumnsRight=[],this.displayedColumnsCenter=[],this.displayedColumns=[],this.displayedColumnsAndGroupsMap={},this.viewportColumns=[],this.viewportColumnsHash="",this.headerViewportColumns=[],this.viewportColumnsCenter=[],this.headerViewportColumnsCenter=[],this.autoHeightActiveAtLeastOnce=!1,this.rowGroupColumns=[],this.valueColumns=[],this.pivotColumns=[],this.ready=!1,this.autoGroupsNeedBuilding=!1,this.forceRecreateAutoGroups=!1,this.pivotMode=!1,this.bodyWidth=0,this.leftWidth=0,this.rightWidth=0,this.bodyWidthDirty=!0,this.shouldQueueResizeOperations=!1,this.resizeOperationQueue=[]}init(){this.suppressColumnVirtualisation=this.gridOptionsService.is("suppressColumnVirtualisation");const e=this.gridOptionsService.is("pivotMode");this.isPivotSettingAllowed(e)&&(this.pivotMode=e),this.usingTreeData=this.gridOptionsService.isTreeData(),this.addManagedPropertyListener("groupDisplayType",()=>this.onAutoGroupColumnDefChanged()),this.addManagedPropertyListener("autoGroupColumnDef",()=>this.onAutoGroupColumnDefChanged()),this.addManagedPropertyListener("defaultColDef",t=>this.onSharedColDefChanged(t.source)),this.addManagedPropertyListener("columnTypes",t=>this.onSharedColDefChanged(t.source))}onAutoGroupColumnDefChanged(){this.columnDefs&&(this.autoGroupsNeedBuilding=!0,this.forceRecreateAutoGroups=!0,this.updateGridColumns(),this.updateDisplayedColumns("gridOptionsChanged"))}onSharedColDefChanged(e="api"){this.forceRecreateAutoGroups=!0,this.createColumnsFromColumnDefs(!0,e)}setColumnDefs(e,t="api"){const n=!!this.columnDefs;this.columnDefs=e,this.createColumnsFromColumnDefs(n,t)}recreateColumnDefs(e="api"){this.onSharedColDefChanged(e)}destroyOldColumns(e,t){const n={};if(!e)return;this.columnUtils.depthFirstOriginalTreeSearch(null,e,a=>{n[a.getInstanceId()]=a}),t&&this.columnUtils.depthFirstOriginalTreeSearch(null,t,a=>{n[a.getInstanceId()]=null});const o=Object.values(n).filter(a=>a!=null);this.destroyBeans(o)}destroyColumns(){this.destroyOldColumns(this.primaryColumnTree),this.destroyOldColumns(this.secondaryBalancedTree),this.destroyOldColumns(this.groupAutoColsBalancedTree)}createColumnsFromColumnDefs(e,t="api"){const n=e?this.compareColumnStatesAndDispatchEvents(t):void 0;this.valueCache.expire(),this.autoGroupsNeedBuilding=!0;const o=this.primaryColumns,a=this.primaryColumnTree,l=this.columnFactory.createColumnTree(this.columnDefs,!0,a);this.destroyOldColumns(this.primaryColumnTree,l.columnTree),this.primaryColumnTree=l.columnTree,this.primaryHeaderRowCount=l.treeDept+1,this.primaryColumns=this.getColumnsFromTree(this.primaryColumnTree),this.primaryColumnsMap={},this.primaryColumns.forEach(y=>this.primaryColumnsMap[y.getId()]=y),this.extractRowGroupColumns(t,o),this.extractPivotColumns(t,o),this.extractValueColumns(t,o),this.ready=!0;const s=this.gridColsArePrimary===void 0;(this.gridColsArePrimary||s)&&(this.updateGridColumns(),e&&!this.gridOptionsService.is("maintainColumnOrder")&&this.orderGridColumnsLikePrimary(),this.updateDisplayedColumns(t),this.checkViewportColumns()),this.dispatchEverythingChanged(t),n&&n(),this.dispatchNewColumnsLoaded()}dispatchNewColumnsLoaded(){const e={type:Events.EVENT_NEW_COLUMNS_LOADED};this.eventService.dispatchEvent(e)}dispatchEverythingChanged(e="api"){const t={type:Events.EVENT_COLUMN_EVERYTHING_CHANGED,source:e};this.eventService.dispatchEvent(t)}orderGridColumnsLikePrimary(){const e=this.primaryColumns;e&&(this.gridColumns.sort((t,n)=>{const o=e.indexOf(t),a=e.indexOf(n),l=o>=0,s=a>=0;if(l&&s)return o-a;if(l)return 1;if(s)return-1;const m=this.gridColumns.indexOf(t),y=this.gridColumns.indexOf(n);return m-y}),this.gridColumns=this.placeLockedColumns(this.gridColumns))}getAllDisplayedAutoHeightCols(){return this.displayedAutoHeightCols}setViewport(){this.gridOptionsService.is("enableRtl")?(this.viewportLeft=this.bodyWidth-this.scrollPosition-this.scrollWidth,this.viewportRight=this.bodyWidth-this.scrollPosition):(this.viewportLeft=this.scrollPosition,this.viewportRight=this.scrollWidth+this.scrollPosition)}getDisplayedColumnsStartingAt(e){let t=e;const n=[];for(;t!=null;)n.push(t),t=this.getDisplayedColAfter(t);return n}checkViewportColumns(){if(this.displayedColumnsCenter==null||!this.extractViewport())return;const t={type:Events.EVENT_VIRTUAL_COLUMNS_CHANGED};this.eventService.dispatchEvent(t)}setViewportPosition(e,t){(e!==this.scrollWidth||t!==this.scrollPosition||this.bodyWidthDirty)&&(this.scrollWidth=e,this.scrollPosition=t,this.bodyWidthDirty=!0,this.setViewport(),this.ready&&this.checkViewportColumns())}isPivotMode(){return this.pivotMode}isPivotSettingAllowed(e){return e&&this.gridOptionsService.isTreeData()?(console.warn("AG Grid: Pivot mode not available in conjunction Tree Data i.e. 'gridOptions.treeData: true'"),!1):!0}setPivotMode(e,t="api"){if(e===this.pivotMode||!this.isPivotSettingAllowed(this.pivotMode))return;this.pivotMode=e,this.autoGroupsNeedBuilding=!0,this.updateGridColumns(),this.updateDisplayedColumns(t);const n={type:Events.EVENT_COLUMN_PIVOT_MODE_CHANGED};this.eventService.dispatchEvent(n)}getSecondaryPivotColumn(e,t){if(missing(this.secondaryColumns))return null;const n=this.getPrimaryColumn(t);let o=null;return this.secondaryColumns.forEach(a=>{const l=a.getColDef().pivotKeys,s=a.getColDef().pivotValueColumn;areEqual(l,e)&&s===n&&(o=a)}),o}setBeans(e){this.logger=e.create("columnModel")}setFirstRightAndLastLeftPinned(e){let t,n;this.gridOptionsService.is("enableRtl")?(t=this.displayedColumnsLeft?this.displayedColumnsLeft[0]:null,n=this.displayedColumnsRight?last(this.displayedColumnsRight):null):(t=this.displayedColumnsLeft?last(this.displayedColumnsLeft):null,n=this.displayedColumnsRight?this.displayedColumnsRight[0]:null),this.gridColumns.forEach(o=>{o.setLastLeftPinned(o===t,e),o.setFirstRightPinned(o===n,e)})}autoSizeColumns(e){if(this.shouldQueueResizeOperations){this.resizeOperationQueue.push(()=>this.autoSizeColumns(e));return}const{columns:t,skipHeader:n,skipHeaderGroups:o,stopAtGroup:a,source:l="api"}=e;this.animationFrameService.flushAllFrames();const s=[];let m=-1;const y=n??this.gridOptionsService.is("skipHeaderOnAutoSize"),D=o??y;for(;m!==0;)m=0,this.actionOnGridColumns(t,W=>{if(s.indexOf(W)>=0)return!1;const Ee=this.autoWidthCalculator.getPreferredWidthForColumn(W,y);if(Ee>0){const dt=this.normaliseColumnWidth(W,Ee);W.setActualWidth(dt,l),s.push(W),m++}return!0},l);D||this.autoSizeColumnGroupsByColumns(t,l,a),this.dispatchColumnResizedEvent(s,!0,"autosizeColumns")}dispatchColumnResizedEvent(e,t,n,o=null){if(e&&e.length){const a={type:Events.EVENT_COLUMN_RESIZED,columns:e,column:e.length===1?e[0]:null,flexColumns:o,finished:t,source:n};this.eventService.dispatchEvent(a)}}dispatchColumnChangedEvent(e,t,n){const o={type:e,columns:t,column:t&&t.length==1?t[0]:null,source:n};this.eventService.dispatchEvent(o)}dispatchColumnMovedEvent(e){const{movedColumns:t,source:n,toIndex:o,finished:a}=e,l={type:Events.EVENT_COLUMN_MOVED,columns:t,column:t&&t.length===1?t[0]:null,toIndex:o,finished:a,source:n};this.eventService.dispatchEvent(l)}dispatchColumnPinnedEvent(e,t){if(!e.length)return;const n=e.length===1?e[0]:null,o=this.getCommonValue(e,l=>l.getPinned()),a={type:Events.EVENT_COLUMN_PINNED,pinned:o??null,columns:e,column:n,source:t};this.eventService.dispatchEvent(a)}dispatchColumnVisibleEvent(e,t){if(!e.length)return;const n=e.length===1?e[0]:null,o=this.getCommonValue(e,l=>l.isVisible()),a={type:Events.EVENT_COLUMN_VISIBLE,visible:o,columns:e,column:n,source:t};this.eventService.dispatchEvent(a)}autoSizeColumn(e,t,n="api"){e&&this.autoSizeColumns({columns:[e],skipHeader:t,skipHeaderGroups:!0,source:n})}autoSizeColumnGroupsByColumns(e,t,n){const o=new Set;this.getGridColumns(e).forEach(m=>{let y=m.getParent();for(;y&&y!=n;)y.isPadding()||o.add(y),y=y.getParent()});let l;const s=[];for(const m of o){for(const y of this.ctrlsService.getHeaderRowContainerCtrls())if(l=y.getHeaderCtrlForColumn(m),l)break;l&&l.resizeLeafColumnsToFit(t)}return s}autoSizeAllColumns(e,t="api"){if(this.shouldQueueResizeOperations){this.resizeOperationQueue.push(()=>this.autoSizeAllColumns(e,t));return}const n=this.getAllDisplayedColumns();this.autoSizeColumns({columns:n,skipHeader:e,source:t})}getColumnsFromTree(e){const t=[],n=o=>{for(let a=0;a<o.length;a++){const l=o[a];l instanceof Column?t.push(l):l instanceof ProvidedColumnGroup&&n(l.getChildren())}};return n(e),t}getAllDisplayedTrees(){return this.displayedTreeLeft&&this.displayedTreeRight&&this.displayedTreeCentre?this.displayedTreeLeft.concat(this.displayedTreeCentre).concat(this.displayedTreeRight):null}getPrimaryColumnTree(){return this.primaryColumnTree}getHeaderRowCount(){return this.gridHeaderRowCount}getDisplayedTreeLeft(){return this.displayedTreeLeft}getDisplayedTreeRight(){return this.displayedTreeRight}getDisplayedTreeCentre(){return this.displayedTreeCentre}isColumnDisplayed(e){return this.getAllDisplayedColumns().indexOf(e)>=0}getAllDisplayedColumns(){return this.displayedColumns}getViewportColumns(){return this.viewportColumns}getDisplayedLeftColumnsForRow(e){return this.colSpanActive?this.getDisplayedColumnsForRow(e,this.displayedColumnsLeft):this.displayedColumnsLeft}getDisplayedRightColumnsForRow(e){return this.colSpanActive?this.getDisplayedColumnsForRow(e,this.displayedColumnsRight):this.displayedColumnsRight}isColSpanActive(){return this.colSpanActive}getDisplayedColumnsForRow(e,t,n,o){const a=[];let l=null;for(let s=0;s<t.length;s++){const m=t[s],y=t.length-s,D=Math.min(m.getColSpan(e),y),W=[m];if(D>1){const dt=D-1;for(let Ht=1;Ht<=dt;Ht++)W.push(t[s+Ht]);s+=dt}let Ee;n?(Ee=!1,W.forEach(dt=>{n(dt)&&(Ee=!0)})):Ee=!0,Ee&&(a.length===0&&l&&(o&&o(m))&&a.push(l),a.push(m)),l=m}return a}getViewportCenterColumnsForRow(e){if(!this.colSpanActive)return this.viewportColumnsCenter;const t=o=>{const a=o.getLeft();return exists(a)&&a>this.viewportLeft},n=this.suppressColumnVirtualisation?null:this.isColumnInRowViewport.bind(this);return this.getDisplayedColumnsForRow(e,this.displayedColumnsCenter,n,t)}getAriaColumnIndex(e){return this.getAllGridColumns().indexOf(e)+1}isColumnInHeaderViewport(e){return e.isAutoHeaderHeight()?!0:this.isColumnInRowViewport(e)}isColumnInRowViewport(e){if(e.isAutoHeight())return!0;const t=e.getLeft()||0,n=t+e.getActualWidth(),o=this.viewportLeft-200,a=this.viewportRight+200,l=t<o&&n<o,s=t>a&&n>a;return!l&&!s}getDisplayedColumnsLeftWidth(){return this.getWidthOfColsInList(this.displayedColumnsLeft)}getDisplayedColumnsRightWidth(){return this.getWidthOfColsInList(this.displayedColumnsRight)}updatePrimaryColumnList(e,t,n,o,a,l="api"){if(!e||missingOrEmpty(e))return;let s=!1;if(e.forEach(y=>{const D=this.getPrimaryColumn(y);if(D){if(n){if(t.indexOf(D)>=0)return;t.push(D)}else{if(t.indexOf(D)<0)return;removeFromArray(t,D)}o(D),s=!0}}),!s)return;this.autoGroupsNeedBuilding&&this.updateGridColumns(),this.updateDisplayedColumns(l);const m={type:a,columns:t,column:t.length===1?t[0]:null,source:l};this.eventService.dispatchEvent(m)}setRowGroupColumns(e,t="api"){this.autoGroupsNeedBuilding=!0,this.setPrimaryColumnList(e,this.rowGroupColumns,Events.EVENT_COLUMN_ROW_GROUP_CHANGED,this.setRowGroupActive.bind(this),t)}setRowGroupActive(e,t,n){e!==t.isRowGroupActive()&&(t.setRowGroupActive(e,n),e&&!this.gridOptionsService.is("suppressRowGroupHidesColumns")&&this.setColumnVisible(t,!1,n),!e&&!this.gridOptionsService.is("suppressMakeColumnVisibleAfterUnGroup")&&this.setColumnVisible(t,!0,n))}addRowGroupColumn(e,t="api"){e&&this.addRowGroupColumns([e],t)}addRowGroupColumns(e,t="api"){this.autoGroupsNeedBuilding=!0,this.updatePrimaryColumnList(e,this.rowGroupColumns,!0,this.setRowGroupActive.bind(this,!0),Events.EVENT_COLUMN_ROW_GROUP_CHANGED,t)}removeRowGroupColumns(e,t="api"){this.autoGroupsNeedBuilding=!0,this.updatePrimaryColumnList(e,this.rowGroupColumns,!1,this.setRowGroupActive.bind(this,!1),Events.EVENT_COLUMN_ROW_GROUP_CHANGED,t)}removeRowGroupColumn(e,t="api"){e&&this.removeRowGroupColumns([e],t)}addPivotColumns(e,t="api"){this.updatePrimaryColumnList(e,this.pivotColumns,!0,n=>n.setPivotActive(!0,t),Events.EVENT_COLUMN_PIVOT_CHANGED,t)}setPivotColumns(e,t="api"){this.setPrimaryColumnList(e,this.pivotColumns,Events.EVENT_COLUMN_PIVOT_CHANGED,(n,o)=>{o.setPivotActive(n,t)},t)}addPivotColumn(e,t="api"){this.addPivotColumns([e],t)}removePivotColumns(e,t="api"){this.updatePrimaryColumnList(e,this.pivotColumns,!1,n=>n.setPivotActive(!1,t),Events.EVENT_COLUMN_PIVOT_CHANGED,t)}removePivotColumn(e,t="api"){this.removePivotColumns([e],t)}setPrimaryColumnList(e,t,n,o,a){t.length=0,exists(e)&&e.forEach(l=>{const s=this.getPrimaryColumn(l);s&&t.push(s)}),(this.primaryColumns||[]).forEach(l=>{const s=t.indexOf(l)>=0;o(s,l)}),this.autoGroupsNeedBuilding&&this.updateGridColumns(),this.updateDisplayedColumns(a),this.dispatchColumnChangedEvent(n,t,a)}setValueColumns(e,t="api"){this.setPrimaryColumnList(e,this.valueColumns,Events.EVENT_COLUMN_VALUE_CHANGED,this.setValueActive.bind(this),t)}setValueActive(e,t,n){if(e!==t.isValueActive()&&(t.setValueActive(e,n),e&&!t.getAggFunc())){const o=this.aggFuncService.getDefaultAggFunc(t);t.setAggFunc(o)}}addValueColumns(e,t="api"){this.updatePrimaryColumnList(e,this.valueColumns,!0,this.setValueActive.bind(this,!0),Events.EVENT_COLUMN_VALUE_CHANGED,t)}addValueColumn(e,t="api"){e&&this.addValueColumns([e],t)}removeValueColumn(e,t="api"){this.removeValueColumns([e],t)}removeValueColumns(e,t="api"){this.updatePrimaryColumnList(e,this.valueColumns,!1,this.setValueActive.bind(this,!1),Events.EVENT_COLUMN_VALUE_CHANGED,t)}normaliseColumnWidth(e,t){const n=e.getMinWidth();exists(n)&&t<n&&(t=n);const o=e.getMaxWidth();return exists(o)&&e.isGreaterThanMax(t)&&(t=o),t}getPrimaryOrGridColumn(e){return this.getPrimaryColumn(e)||this.getGridColumn(e)}setColumnWidths(e,t,n,o="api"){const a=[];e.forEach(l=>{const s=this.getPrimaryOrGridColumn(l.key);if(!s)return;if(a.push({width:l.newWidth,ratios:[1],columns:[s]}),this.gridOptionsService.get("colResizeDefault")==="shift"&&(t=!t),t){const y=this.getDisplayedColAfter(s);if(!y)return;const D=s.getActualWidth()-l.newWidth,W=y.getActualWidth()+D;a.push({width:W,ratios:[1],columns:[y]})}}),a.length!==0&&this.resizeColumnSets({resizeSets:a,finished:n,source:o})}checkMinAndMaxWidthsForSet(e){const{columns:t,width:n}=e;let o=0,a=0,l=!0;t.forEach(y=>{const D=y.getMinWidth();o+=D||0;const W=y.getMaxWidth();exists(W)&&W>0?a+=W:l=!1});const s=n>=o,m=!l||n<=a;return s&&m}resizeColumnSets(e){const{resizeSets:t,finished:n,source:o}=e;if(!(!t||t.every(W=>this.checkMinAndMaxWidthsForSet(W)))){if(n){const W=t&&t.length>0?t[0].columns:null;this.dispatchColumnResizedEvent(W,n,o)}return}const l=[],s=[];t.forEach(W=>{const{width:Ee,columns:dt,ratios:Ht}=W,ir={},Hr={};dt.forEach(Wr=>s.push(Wr));let Bn=!0,Vn=0;for(;Bn;){if(Vn++,Vn>1e3){console.error("AG Grid: infinite loop in resizeColumnSets");break}Bn=!1;const Wr=[];let ps=0,il=Ee;dt.forEach((ml,sl)=>{if(Hr[ml.getId()])il-=ir[ml.getId()];else{Wr.push(ml);const rl=Ht[sl];ps+=rl}});const gl=1/ps;Wr.forEach((ml,sl)=>{const ll=sl===Wr.length-1;let rl;ll?rl=il:(rl=Math.round(Ht[sl]*Ee*gl),il-=rl);const th=ml.getMinWidth(),nh=ml.getMaxWidth();exists(th)&&rl<th?(rl=th,Hr[ml.getId()]=!0,Bn=!0):exists(nh)&&nh>0&&rl>nh&&(rl=nh,Hr[ml.getId()]=!0,Bn=!0),ir[ml.getId()]=rl})}dt.forEach(Wr=>{const ps=ir[Wr.getId()];Wr.getActualWidth()!==ps&&(Wr.setActualWidth(ps,o),l.push(Wr))})});const m=l.length>0;let y=[];m&&(y=this.refreshFlexedColumns({resizingCols:s,skipSetLeft:!0}),this.setLeftValues(o),this.updateBodyWidths(),this.checkViewportColumns());const D=s.concat(y);(m||n)&&this.dispatchColumnResizedEvent(D,n,o,y)}setColumnAggFunc(e,t,n="api"){if(!e)return;const o=this.getPrimaryColumn(e);o&&(o.setAggFunc(t),this.dispatchColumnChangedEvent(Events.EVENT_COLUMN_VALUE_CHANGED,[o],n))}moveRowGroupColumn(e,t,n="api"){const o=this.rowGroupColumns[e];this.rowGroupColumns.splice(e,1),this.rowGroupColumns.splice(t,0,o);const a={type:Events.EVENT_COLUMN_ROW_GROUP_CHANGED,columns:this.rowGroupColumns,column:this.rowGroupColumns.length===1?this.rowGroupColumns[0]:null,source:n};this.eventService.dispatchEvent(a)}moveColumns(e,t,n="api",o=!0){if(this.columnAnimationService.start(),t>this.gridColumns.length-e.length){console.warn("AG Grid: tried to insert columns in invalid location, toIndex = "+t),console.warn("AG Grid: remember that you should not count the moving columns when calculating the new index");return}const a=this.getGridColumns(e);this.doesMovePassRules(a,t)&&(moveInArray(this.gridColumns,a,t),this.updateDisplayedColumns(n),this.dispatchColumnMovedEvent({movedColumns:a,source:n,toIndex:t,finished:o}),this.columnAnimationService.finish())}doesMovePassRules(e,t){const n=this.getProposedColumnOrder(e,t);return this.doesOrderPassRules(n)}doesOrderPassRules(e){return!(!this.doesMovePassMarryChildren(e)||!this.doesMovePassLockedPositions(e))}getProposedColumnOrder(e,t){const n=this.gridColumns.slice();return moveInArray(n,e,t),n}sortColumnsLikeGridColumns(e){!e||e.length<=1||e.filter(n=>this.gridColumns.indexOf(n)<0).length>0||e.sort((n,o)=>{const a=this.gridColumns.indexOf(n),l=this.gridColumns.indexOf(o);return a-l})}doesMovePassLockedPositions(e){let t=0,n=!0;const o=a=>a?a===!0||a==="left"?0:2:1;return e.forEach(a=>{const l=o(a.getColDef().lockPosition);l<t&&(n=!1),t=l}),n}doesMovePassMarryChildren(e){let t=!0;return this.columnUtils.depthFirstOriginalTreeSearch(null,this.gridBalancedTree,n=>{if(!(n instanceof ProvidedColumnGroup))return;const o=n,a=o.getColGroupDef();if(!(a&&a.marryChildren))return;const s=[];o.getLeafColumns().forEach(Ee=>{const dt=e.indexOf(Ee);s.push(dt)});const m=Math.max.apply(Math,s),y=Math.min.apply(Math,s),D=m-y,W=o.getLeafColumns().length-1;D>W&&(t=!1)}),t}moveColumn(e,t,n="api"){this.moveColumns([e],t,n)}moveColumnByIndex(e,t,n="api"){const o=this.gridColumns[e];this.moveColumn(o,t,n)}getColumnDefs(){if(!this.primaryColumns)return;const e=this.primaryColumns.slice();return this.gridColsArePrimary?e.sort((t,n)=>this.gridColumns.indexOf(t)-this.gridColumns.indexOf(n)):this.lastPrimaryOrder&&e.sort((t,n)=>this.lastPrimaryOrder.indexOf(t)-this.lastPrimaryOrder.indexOf(n)),this.columnDefFactory.buildColumnDefs(e,this.rowGroupColumns,this.pivotColumns)}getBodyContainerWidth(){return this.bodyWidth}getContainerWidth(e){switch(e){case"left":return this.leftWidth;case"right":return this.rightWidth;default:return this.bodyWidth}}updateBodyWidths(){const e=this.getWidthOfColsInList(this.displayedColumnsCenter),t=this.getWidthOfColsInList(this.displayedColumnsLeft),n=this.getWidthOfColsInList(this.displayedColumnsRight);if(this.bodyWidthDirty=this.bodyWidth!==e,this.bodyWidth!==e||this.leftWidth!==t||this.rightWidth!==n){this.bodyWidth=e,this.leftWidth=t,this.rightWidth=n;const a={type:Events.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED};this.eventService.dispatchEvent(a)}}getValueColumns(){return this.valueColumns?this.valueColumns:[]}getPivotColumns(){return this.pivotColumns?this.pivotColumns:[]}isPivotActive(){return this.pivotColumns&&this.pivotColumns.length>0&&this.pivotMode}getRowGroupColumns(){return this.rowGroupColumns?this.rowGroupColumns:[]}getDisplayedCenterColumns(){return this.displayedColumnsCenter}getDisplayedLeftColumns(){return this.displayedColumnsLeft}getDisplayedRightColumns(){return this.displayedColumnsRight}getDisplayedColumns(e){switch(e){case"left":return this.getDisplayedLeftColumns();case"right":return this.getDisplayedRightColumns();default:return this.getDisplayedCenterColumns()}}getAllPrimaryColumns(){return this.primaryColumns?this.primaryColumns.slice():null}getSecondaryColumns(){return this.secondaryColumns?this.secondaryColumns.slice():null}getAllColumnsForQuickFilter(){return this.columnsForQuickFilter}getAllGridColumns(){return this.gridColumns}isEmpty(){return missingOrEmpty(this.gridColumns)}isRowGroupEmpty(){return missingOrEmpty(this.rowGroupColumns)}setColumnVisible(e,t,n="api"){this.setColumnsVisible([e],t,n)}setColumnsVisible(e,t=!1,n="api"){this.applyColumnState({state:e.map(o=>({colId:typeof o=="string"?o:o.getColId(),hide:!t}))},n)}setColumnPinned(e,t,n="api"){e&&this.setColumnsPinned([e],t,n)}setColumnsPinned(e,t,n="api"){if(this.gridOptionsService.isDomLayout("print")){console.warn("AG Grid: Changing the column pinning status is not allowed with domLayout='print'");return}this.columnAnimationService.start();let o;t===!0||t==="left"?o="left":t==="right"?o="right":o=null,this.actionOnGridColumns(e,a=>a.getPinned()!==o?(a.setPinned(o),!0):!1,n,()=>({type:Events.EVENT_COLUMN_PINNED,pinned:o,column:null,columns:null,source:n})),this.columnAnimationService.finish()}actionOnGridColumns(e,t,n,o){if(missingOrEmpty(e))return;const a=[];if(e.forEach(l=>{const s=this.getGridColumn(l);if(!s)return;t(s)!==!1&&a.push(s)}),!!a.length&&(this.updateDisplayedColumns(n),exists(o)&&o)){const l=o();l.columns=a,l.column=a.length===1?a[0]:null,this.eventService.dispatchEvent(l)}}getDisplayedColBefore(e){const t=this.getAllDisplayedColumns(),n=t.indexOf(e);return n>0?t[n-1]:null}getDisplayedColAfter(e){const t=this.getAllDisplayedColumns(),n=t.indexOf(e);return n<t.length-1?t[n+1]:null}getDisplayedGroupAfter(e){return this.getDisplayedGroupAtDirection(e,"After")}getDisplayedGroupBefore(e){return this.getDisplayedGroupAtDirection(e,"Before")}getDisplayedGroupAtDirection(e,t){const n=e.getProvidedColumnGroup().getLevel()+e.getPaddingLevel(),o=e.getDisplayedLeafColumns(),a=t==="After"?last(o):o[0],l=`getDisplayedCol${t}`;for(;;){const s=this[l](a);if(!s)return null;const m=this.getColumnGroupAtLevel(s,n);if(m!==e)return m}}getColumnGroupAtLevel(e,t){let n=e.getParent(),o,a;for(;o=n.getProvidedColumnGroup().getLevel(),a=n.getPaddingLevel(),!(o+a<=t);)n=n.getParent();return n}isPinningLeft(){return this.displayedColumnsLeft.length>0}isPinningRight(){return this.displayedColumnsRight.length>0}getPrimaryAndSecondaryAndAutoColumns(){return[].concat(this.primaryColumns||[],this.groupAutoColumns||[],this.secondaryColumns||[])}createStateItemFromColumn(e){const t=e.isRowGroupActive()?this.rowGroupColumns.indexOf(e):null,n=e.isPivotActive()?this.pivotColumns.indexOf(e):null,o=e.isValueActive()?e.getAggFunc():null,a=e.getSort()!=null?e.getSort():null,l=e.getSortIndex()!=null?e.getSortIndex():null,s=e.getFlex()!=null&&e.getFlex()>0?e.getFlex():null;return{colId:e.getColId(),width:e.getActualWidth(),hide:!e.isVisible(),pinned:e.getPinned(),sort:a,sortIndex:l,aggFunc:o,rowGroup:e.isRowGroupActive(),rowGroupIndex:t,pivot:e.isPivotActive(),pivotIndex:n,flex:s}}getColumnState(){if(missing(this.primaryColumns)||!this.isAlive())return[];const t=this.getPrimaryAndSecondaryAndAutoColumns().map(this.createStateItemFromColumn.bind(this));return this.orderColumnStateList(t),t}orderColumnStateList(e){const t=convertToMap(this.gridColumns.map((n,o)=>[n.getColId(),o]));e.sort((n,o)=>{const a=t.has(n.colId)?t.get(n.colId):-1,l=t.has(o.colId)?t.get(o.colId):-1;return a-l})}resetColumnState(e="api"){const t=this.getColumnsFromTree(this.primaryColumnTree),n=[];let o=1e3,a=1e3,l=[];this.groupAutoColumns&&(l=l.concat(this.groupAutoColumns)),t&&(l=l.concat(t)),l.forEach(s=>{const m=this.getColumnStateFromColDef(s);missing(m.rowGroupIndex)&&m.rowGroup&&(m.rowGroupIndex=o++),missing(m.pivotIndex)&&m.pivot&&(m.pivotIndex=a++),n.push(m)}),this.applyColumnState({state:n,applyOrder:!0},e)}getColumnStateFromColDef(e){const t=(ir,Hr)=>ir??Hr??null,n=e.getColDef(),o=t(n.sort,n.initialSort),a=t(n.sortIndex,n.initialSortIndex),l=t(n.hide,n.initialHide),s=t(n.pinned,n.initialPinned),m=t(n.width,n.initialWidth),y=t(n.flex,n.initialFlex);let D=t(n.rowGroupIndex,n.initialRowGroupIndex),W=t(n.rowGroup,n.initialRowGroup);D==null&&(W==null||W==!1)&&(D=null,W=null);let Ee=t(n.pivotIndex,n.initialPivotIndex),dt=t(n.pivot,n.initialPivot);Ee==null&&(dt==null||dt==!1)&&(Ee=null,dt=null);const Ht=t(n.aggFunc,n.initialAggFunc);return{colId:e.getColId(),sort:o,sortIndex:a,hide:l,pinned:s,width:m,flex:y,rowGroup:W,rowGroupIndex:D,pivot:dt,pivotIndex:Ee,aggFunc:Ht}}applyColumnState(e,t){if(missingOrEmpty(this.primaryColumns))return!1;if(e&&e.state&&!e.state.forEach)return console.warn("AG Grid: applyColumnState() - the state attribute should be an array, however an array was not found. Please provide an array of items (one for each col you want to change) for state."),!1;const n=(l,s,m)=>{const y=this.compareColumnStatesAndDispatchEvents(t);this.autoGroupsNeedBuilding=!0;const D=s.slice(),W={},Ee={},dt=[],Ht=[];let ir=0;const Hr=this.rowGroupColumns.slice(),Bn=this.pivotColumns.slice();l.forEach(il=>{const gl=il.colId||"";if(gl.startsWith(GROUP_AUTO_COLUMN_ID)){dt.push(il),Ht.push(il);return}const sl=m(gl);sl?(this.syncColumnWithStateItem(sl,il,e.defaultState,W,Ee,!1,t),removeFromArray(D,sl)):(Ht.push(il),ir+=1)});const Vn=il=>this.syncColumnWithStateItem(il,null,e.defaultState,W,Ee,!1,t);D.forEach(Vn);const Wr=(il,gl,ml,sl)=>{const ll=il[ml.getId()],rl=il[sl.getId()],th=ll!=null,nh=rl!=null;if(th&&nh)return ll-rl;if(th)return-1;if(nh)return 1;const bh=gl.indexOf(ml),Fh=gl.indexOf(sl),Bh=bh>=0,Ed=Fh>=0;return Bh&&Ed?bh-Fh:Bh?-1:1};this.rowGroupColumns.sort(Wr.bind(this,W,Hr)),this.pivotColumns.sort(Wr.bind(this,Ee,Bn)),this.updateGridColumns();const ps=this.groupAutoColumns?this.groupAutoColumns.slice():[];return dt.forEach(il=>{const gl=this.getAutoColumn(il.colId);removeFromArray(ps,gl),this.syncColumnWithStateItem(gl,il,e.defaultState,null,null,!0,t)}),ps.forEach(Vn),this.applyOrderAfterApplyState(e),this.updateDisplayedColumns(t),this.dispatchEverythingChanged(t),y(),{unmatchedAndAutoStates:Ht,unmatchedCount:ir}};this.columnAnimationService.start();let{unmatchedAndAutoStates:o,unmatchedCount:a}=n(e.state||[],this.primaryColumns||[],l=>this.getPrimaryColumn(l));return(o.length>0||exists(e.defaultState))&&(a=n(o,this.secondaryColumns||[],l=>this.getSecondaryColumn(l)).unmatchedCount),this.columnAnimationService.finish(),a===0}applyOrderAfterApplyState(e){if(!e.applyOrder||!e.state)return;let t=[];const n={};e.state.forEach(a=>{if(!a.colId||n[a.colId])return;const l=this.gridColumnsMap[a.colId];l&&(t.push(l),n[a.colId]=!0)});let o=0;if(this.gridColumns.forEach(a=>{const l=a.getColId();if(n[l]!=null)return;l.startsWith(GROUP_AUTO_COLUMN_ID)?insertIntoArray(t,a,o++):t.push(a)}),t=this.placeLockedColumns(t),!this.doesMovePassMarryChildren(t)){console.warn("AG Grid: Applying column order broke a group where columns should be married together. Applying new order has been discarded.");return}this.gridColumns=t}compareColumnStatesAndDispatchEvents(e){const t={rowGroupColumns:this.rowGroupColumns.slice(),pivotColumns:this.pivotColumns.slice(),valueColumns:this.valueColumns.slice()},n=this.getColumnState(),o={};return n.forEach(a=>{o[a.colId]=a}),()=>{const a=this.getPrimaryAndSecondaryAndAutoColumns(),l=(ir,Hr,Bn,Vn)=>{const Wr=Hr.map(Vn),ps=Bn.map(Vn);if(areEqual(Wr,ps))return;const gl={type:ir,columns:Bn,column:Bn.length===1?Bn[0]:null,source:e};this.eventService.dispatchEvent(gl)},s=ir=>{const Hr=[];return a.forEach(Bn=>{const Vn=o[Bn.getColId()];Vn&&ir(Vn,Bn)&&Hr.push(Bn)}),Hr},m=ir=>ir.getColId();l(Events.EVENT_COLUMN_ROW_GROUP_CHANGED,t.rowGroupColumns,this.rowGroupColumns,m),l(Events.EVENT_COLUMN_PIVOT_CHANGED,t.pivotColumns,this.pivotColumns,m),s((ir,Hr)=>{const Bn=ir.aggFunc!=null,Vn=Bn!=Hr.isValueActive(),Wr=Bn&&ir.aggFunc!=Hr.getAggFunc();return Vn||Wr}).length>0&&this.dispatchColumnChangedEvent(Events.EVENT_COLUMN_VALUE_CHANGED,this.valueColumns,e);const W=(ir,Hr)=>ir.width!=Hr.getActualWidth();this.dispatchColumnResizedEvent(s(W),!0,e);const Ee=(ir,Hr)=>ir.pinned!=Hr.getPinned();this.dispatchColumnPinnedEvent(s(Ee),e);const dt=(ir,Hr)=>ir.hide==Hr.isVisible();this.dispatchColumnVisibleEvent(s(dt),e),s((ir,Hr)=>ir.sort!=Hr.getSort()||ir.sortIndex!=Hr.getSortIndex()).length>0&&this.sortController.dispatchSortChangedEvents(e),this.normaliseColumnMovedEventForColumnState(n,e)}}getCommonValue(e,t){if(!e||e.length==0)return;const n=t(e[0]);for(let o=1;o<e.length;o++)if(n!==t(e[o]))return;return n}normaliseColumnMovedEventForColumnState(e,t){const n=this.getColumnState(),o={};n.forEach(y=>o[y.colId]=y);const a={};e.forEach(y=>{o[y.colId]&&(a[y.colId]=!0)});const l=e.filter(y=>a[y.colId]),s=n.filter(y=>a[y.colId]),m=[];s.forEach((y,D)=>{const W=l&&l[D];if(W&&W.colId!==y.colId){const Ee=this.getGridColumn(W.colId);Ee&&m.push(Ee)}}),m.length&&this.dispatchColumnMovedEvent({movedColumns:m,source:t,finished:!0})}syncColumnWithStateItem(e,t,n,o,a,l,s){if(!e)return;const m=(il,gl)=>{const ml={value1:void 0,value2:void 0};let sl=!1;return t&&(t[il]!==void 0&&(ml.value1=t[il],sl=!0),exists(gl)&&t[gl]!==void 0&&(ml.value2=t[gl],sl=!0)),!sl&&n&&(n[il]!==void 0&&(ml.value1=n[il]),exists(gl)&&n[gl]!==void 0&&(ml.value2=n[gl])),ml},y=m("hide").value1;y!==void 0&&e.setVisible(!y,s);const D=m("pinned").value1;D!==void 0&&e.setPinned(D);const W=this.columnUtils.calculateColMinWidth(e.getColDef()),Ee=m("flex").value1;if(Ee!==void 0&&e.setFlex(Ee),e.getFlex()<=0){const il=m("width").value1;il!=null&&W!=null&&il>=W&&e.setActualWidth(il,s)}const Ht=m("sort").value1;Ht!==void 0&&(Ht==="desc"||Ht==="asc"?e.setSort(Ht,s):e.setSort(void 0,s));const ir=m("sortIndex").value1;if(ir!==void 0&&e.setSortIndex(ir),l||!e.isPrimary())return;const Hr=m("aggFunc").value1;Hr!==void 0&&(typeof Hr=="string"?(e.setAggFunc(Hr),e.isValueActive()||(e.setValueActive(!0,s),this.valueColumns.push(e))):(exists(Hr)&&console.warn("AG Grid: stateItem.aggFunc must be a string. if using your own aggregation functions, register the functions first before using them in get/set state. This is because it is intended for the column state to be stored and retrieved as simple JSON."),e.isValueActive()&&(e.setValueActive(!1,s),removeFromArray(this.valueColumns,e))));const{value1:Bn,value2:Vn}=m("rowGroup","rowGroupIndex");(Bn!==void 0||Vn!==void 0)&&(typeof Vn=="number"||Bn?(e.isRowGroupActive()||(e.setRowGroupActive(!0,s),this.rowGroupColumns.push(e)),o&&typeof Vn=="number"&&(o[e.getId()]=Vn)):e.isRowGroupActive()&&(e.setRowGroupActive(!1,s),removeFromArray(this.rowGroupColumns,e)));const{value1:Wr,value2:ps}=m("pivot","pivotIndex");(Wr!==void 0||ps!==void 0)&&(typeof ps=="number"||Wr?(e.isPivotActive()||(e.setPivotActive(!0,s),this.pivotColumns.push(e)),a&&typeof ps=="number"&&(a[e.getId()]=ps)):e.isPivotActive()&&(e.setPivotActive(!1,s),removeFromArray(this.pivotColumns,e)))}getGridColumns(e){return this.getColumns(e,this.getGridColumn.bind(this))}getColumns(e,t){const n=[];return e&&e.forEach(o=>{const a=t(o);a&&n.push(a)}),n}getColumnWithValidation(e){if(e==null)return null;const t=this.getGridColumn(e);return t||console.warn("AG Grid: could not find column "+e),t}getPrimaryColumn(e){return this.primaryColumns?this.getColumn(e,this.primaryColumns,this.primaryColumnsMap):null}getGridColumn(e){return this.getColumn(e,this.gridColumns,this.gridColumnsMap)}getSecondaryColumn(e){return this.secondaryColumns?this.getColumn(e,this.secondaryColumns,this.secondaryColumnsMap):null}getColumn(e,t,n){if(!e)return null;if(typeof e=="string"&&n[e])return n[e];for(let o=0;o<t.length;o++)if(this.columnsMatch(t[o],e))return t[o];return this.getAutoColumn(e)}getSourceColumnsForGroupColumn(e){const t=e.getColDef().showRowGroup;if(!t)return null;if(t===!0)return this.rowGroupColumns.slice(0);const n=this.getPrimaryColumn(t);return n?[n]:null}getAutoColumn(e){return!this.groupAutoColumns||!exists(this.groupAutoColumns)||missing(this.groupAutoColumns)?null:this.groupAutoColumns.find(t=>this.columnsMatch(t,e))||null}columnsMatch(e,t){const n=e===t,o=e.getColDef()===t,a=e.getColId()==t;return n||o||a}getDisplayNameForColumn(e,t,n=!1){if(!e)return null;const o=this.getHeaderName(e.getColDef(),e,null,null,t);return n?this.wrapHeaderNameWithAggFunc(e,o):o}getDisplayNameForProvidedColumnGroup(e,t,n){const o=t?t.getColGroupDef():null;return o?this.getHeaderName(o,null,e,t,n):null}getDisplayNameForColumnGroup(e,t){return this.getDisplayNameForProvidedColumnGroup(e,e.getProvidedColumnGroup(),t)}getHeaderName(e,t,n,o,a){const l=e.headerValueGetter;if(l){const s={colDef:e,column:t,columnGroup:n,providedColumnGroup:o,location:a,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context};return typeof l=="function"?l(s):typeof l=="string"?this.expressionService.evaluate(l,s):(console.warn("AG Grid: headerValueGetter must be a function or a string"),"")}else{if(e.headerName!=null)return e.headerName;if(e.field)return camelCaseToHumanText(e.field)}return""}wrapHeaderNameWithAggFunc(e,t){if(this.gridOptionsService.is("suppressAggFuncInHeader"))return t;const n=e.getColDef().pivotValueColumn,o=exists(n);let a=null,l;if(o){const s=this.gridOptionsService.is("removePivotHeaderRowWhenSingleValueColumn")&&this.valueColumns.length===1,m=e.getColDef().pivotTotalColumnIds!==void 0;if(s&&!m)return t;a=n?n.getAggFunc():null,l=!0}else{const s=e.isValueActive(),m=this.pivotMode||!this.isRowGroupEmpty();s&&m?(a=e.getAggFunc(),l=!0):l=!1}if(l){const s=typeof a=="string"?a:"func";return`${this.localeService.getLocaleTextFunc()(s,s)}(${t})`}return t}getColumnGroup(e,t){if(!e)return null;if(e instanceof ColumnGroup)return e;const n=this.getAllDisplayedTrees(),o=typeof t=="number";let a=null;return this.columnUtils.depthFirstAllColumnTreeSearch(n,l=>{if(l instanceof ColumnGroup){const s=l;let m;o?m=e===s.getGroupId()&&t===s.getPartId():m=e===s.getGroupId(),m&&(a=s)}}),a}isReady(){return this.ready}extractValueColumns(e,t){this.valueColumns=this.extractColumns(t,this.valueColumns,(n,o)=>n.setValueActive(o,e),()=>{},()=>{},n=>{const o=n.aggFunc;if(o===null||o==="")return null;if(o!==void 0)return!!o},n=>n.initialAggFunc!=null&&n.initialAggFunc!=""),this.valueColumns.forEach(n=>{const o=n.getColDef();o.aggFunc!=null&&o.aggFunc!=""?n.setAggFunc(o.aggFunc):n.getAggFunc()||n.setAggFunc(o.initialAggFunc)})}extractRowGroupColumns(e,t){this.rowGroupColumns=this.extractColumns(t,this.rowGroupColumns,(n,o)=>n.setRowGroupActive(o,e),n=>n.rowGroupIndex,n=>n.initialRowGroupIndex,n=>n.rowGroup,n=>n.initialRowGroup)}extractColumns(e=[],t=[],n,o,a,l,s){const m=[],y=[];(this.primaryColumns||[]).forEach(Ee=>{const dt=e.indexOf(Ee)<0,Ht=Ee.getColDef(),ir=attrToBoolean(l(Ht)),Hr=attrToBoolean(s(Ht)),Bn=attrToNumber(o(Ht)),Vn=attrToNumber(a(Ht));let Wr;ir!==void 0?Wr=ir:Bn!==void 0?Bn===null?Wr=!1:Wr=Bn>=0:dt?Hr!==void 0?Wr=Hr:Vn!==void 0?Wr=Vn!=null&&Vn>=0:Wr=!1:Wr=t.indexOf(Ee)>=0,Wr&&((dt?Bn!=null||Vn!=null:Bn!=null)?m.push(Ee):y.push(Ee))});const D=Ee=>{const dt=o(Ee.getColDef()),Ht=a(Ee.getColDef());return dt??Ht};m.sort((Ee,dt)=>{const Ht=D(Ee),ir=D(dt);return Ht===ir?0:Ht<ir?-1:1});const W=[].concat(m);return t.forEach(Ee=>{y.indexOf(Ee)>=0&&W.push(Ee)}),y.forEach(Ee=>{W.indexOf(Ee)<0&&W.push(Ee)}),t.forEach(Ee=>{W.indexOf(Ee)<0&&n(Ee,!1)}),W.forEach(Ee=>{t.indexOf(Ee)<0&&n(Ee,!0)}),W}extractPivotColumns(e,t){this.pivotColumns=this.extractColumns(t,this.pivotColumns,(n,o)=>n.setPivotActive(o,e),n=>n.pivotIndex,n=>n.initialPivotIndex,n=>n.pivot,n=>n.initialPivot)}resetColumnGroupState(e="api"){const t=[];this.columnUtils.depthFirstOriginalTreeSearch(null,this.primaryColumnTree,n=>{if(n instanceof ProvidedColumnGroup){const o=n.getColGroupDef(),a={groupId:n.getGroupId(),open:o?o.openByDefault:void 0};t.push(a)}}),this.setColumnGroupState(t,e)}getColumnGroupState(){const e=[];return this.columnUtils.depthFirstOriginalTreeSearch(null,this.gridBalancedTree,t=>{t instanceof ProvidedColumnGroup&&e.push({groupId:t.getGroupId(),open:t.isExpanded()})}),e}setColumnGroupState(e,t="api"){this.columnAnimationService.start();const n=[];e.forEach(o=>{const a=o.groupId,l=o.open,s=this.getProvidedColumnGroup(a);s&&s.isExpanded()!==l&&(this.logger.log("columnGroupOpened("+s.getGroupId()+","+l+")"),s.setExpanded(l),n.push(s))}),this.updateGroupsAndDisplayedColumns(t),this.setFirstRightAndLastLeftPinned(t),n.forEach(o=>{const a={type:Events.EVENT_COLUMN_GROUP_OPENED,columnGroup:o};this.eventService.dispatchEvent(a)}),this.columnAnimationService.finish()}setColumnGroupOpened(e,t,n="api"){let o;e instanceof ProvidedColumnGroup?o=e.getId():o=e||"",this.setColumnGroupState([{groupId:o,open:t}],n)}getProvidedColumnGroup(e){typeof e!="string"&&console.error("AG Grid: group key must be a string");let t=null;return this.columnUtils.depthFirstOriginalTreeSearch(null,this.gridBalancedTree,n=>{n instanceof ProvidedColumnGroup&&n.getId()===e&&(t=n)}),t}calculateColumnsForDisplay(){let e;return this.pivotMode&&missing(this.secondaryColumns)?e=this.gridColumns.filter(t=>{const n=this.groupAutoColumns&&includes(this.groupAutoColumns,t),o=this.valueColumns&&includes(this.valueColumns,t);return n||o}):e=this.gridColumns.filter(t=>this.groupAutoColumns&&includes(this.groupAutoColumns,t)||t.isVisible()),e}checkColSpanActiveInCols(e){let t=!1;return e.forEach(n=>{exists(n.getColDef().colSpan)&&(t=!0)}),t}calculateColumnsForGroupDisplay(){this.groupDisplayColumns=[],this.groupDisplayColumnsMap={};const e=t=>{const n=t.getColDef(),o=n.showRowGroup;n&&exists(o)&&(this.groupDisplayColumns.push(t),typeof o=="string"?this.groupDisplayColumnsMap[o]=t:o===!0&&this.getRowGroupColumns().forEach(a=>{this.groupDisplayColumnsMap[a.getId()]=t}))};this.gridColumns.forEach(e)}getGroupDisplayColumns(){return this.groupDisplayColumns}getGroupDisplayColumnForGroup(e){return this.groupDisplayColumnsMap[e]}updateDisplayedColumns(e){const t=this.calculateColumnsForDisplay();this.buildDisplayedTrees(t),this.updateGroupsAndDisplayedColumns(e),this.setFirstRightAndLastLeftPinned(e)}isSecondaryColumnsPresent(){return exists(this.secondaryColumns)}setSecondaryColumns(e,t="api"){const n=e&&e.length>0;if(!(!n&&missing(this.secondaryColumns))){if(n){this.processSecondaryColumnDefinitions(e);const o=this.columnFactory.createColumnTree(e,!1,this.secondaryBalancedTree||this.previousSecondaryColumns||void 0);this.destroyOldColumns(this.secondaryBalancedTree,o.columnTree),this.secondaryBalancedTree=o.columnTree,this.secondaryHeaderRowCount=o.treeDept+1,this.secondaryColumns=this.getColumnsFromTree(this.secondaryBalancedTree),this.secondaryColumnsMap={},this.secondaryColumns.forEach(a=>this.secondaryColumnsMap[a.getId()]=a),this.previousSecondaryColumns=null}else this.previousSecondaryColumns=this.secondaryBalancedTree,this.secondaryBalancedTree=null,this.secondaryHeaderRowCount=-1,this.secondaryColumns=null,this.secondaryColumnsMap={};this.updateGridColumns(),this.updateDisplayedColumns(t)}}processSecondaryColumnDefinitions(e){const t=this.gridOptionsService.get("processPivotResultColDef")||this.gridOptionsService.get("processSecondaryColDef"),n=this.gridOptionsService.get("processPivotResultColGroupDef")||this.gridOptionsService.get("processSecondaryColGroupDef");if(!t&&!n)return;const o=a=>{a.forEach(l=>{if(exists(l.children)){const m=l;n&&n(m),o(m.children)}else t&&t(l)})};e&&o(e)}updateGridColumns(){const e=this.gridBalancedTree;this.gridColsArePrimary?this.lastPrimaryOrder=this.gridColumns:this.lastSecondaryOrder=this.gridColumns;let t;if(this.secondaryColumns&&this.secondaryBalancedTree){const o=this.secondaryColumns.every(a=>this.gridColumnsMap[a.getColId()]!==void 0);this.gridBalancedTree=this.secondaryBalancedTree.slice(),this.gridHeaderRowCount=this.secondaryHeaderRowCount,this.gridColumns=this.secondaryColumns.slice(),this.gridColsArePrimary=!1,o&&(t=this.lastSecondaryOrder)}else this.primaryColumns&&(this.gridBalancedTree=this.primaryColumnTree.slice(),this.gridHeaderRowCount=this.primaryHeaderRowCount,this.gridColumns=this.primaryColumns.slice(),this.gridColsArePrimary=!0,t=this.lastPrimaryOrder);if(this.createGroupAutoColumnsIfNeeded()&&t){const o=convertToMap(this.groupAutoColumns.map(a=>[a,!0]));t=t.filter(a=>!o.has(a)),t=[...this.groupAutoColumns,...t]}if(this.addAutoGroupToGridColumns(),this.orderGridColsLike(t),this.gridColumns=this.placeLockedColumns(this.gridColumns),this.calculateColumnsForGroupDisplay(),this.refreshQuickFilterColumns(),this.clearDisplayedAndViewportColumns(),this.colSpanActive=this.checkColSpanActiveInCols(this.gridColumns),this.gridColumnsMap={},this.gridColumns.forEach(o=>this.gridColumnsMap[o.getId()]=o),this.setAutoHeightActive(),!areEqual(e,this.gridBalancedTree)){const o={type:Events.EVENT_GRID_COLUMNS_CHANGED};this.eventService.dispatchEvent(o)}}setAutoHeightActive(){if(this.autoHeightActive=this.gridColumns.filter(e=>e.isAutoHeight()).length>0,this.autoHeightActive&&(this.autoHeightActiveAtLeastOnce=!0,!(this.gridOptionsService.isRowModelType("clientSide")||this.gridOptionsService.isRowModelType("serverSide")))){const t="AG Grid - autoHeight columns only work with Client Side Row Model and Server Side Row Model.";doOnce(()=>console.warn(t),"autoHeightActive.wrongRowModel")}}orderGridColsLike(e){if(missing(e))return;const t=convertToMap(e.map((y,D)=>[y,D]));let n=!0;if(this.gridColumns.forEach(y=>{t.has(y)&&(n=!1)}),n)return;const o=convertToMap(this.gridColumns.map(y=>[y,!0])),a=e.filter(y=>o.has(y)),l=convertToMap(a.map(y=>[y,!0])),s=this.gridColumns.filter(y=>!l.has(y)),m=a.slice();s.forEach(y=>{let D=y.getOriginalParent();if(!D){m.push(y);return}const W=[];for(;!W.length&&D;)D.getLeafColumns().forEach(ir=>{const Hr=m.indexOf(ir)>=0,Bn=W.indexOf(ir)<0;Hr&&Bn&&W.push(ir)}),D=D.getOriginalParent();if(!W.length){m.push(y);return}const Ee=W.map(Ht=>m.indexOf(Ht)),dt=Math.max(...Ee);insertIntoArray(m,y,dt+1)}),this.gridColumns=m}isPrimaryColumnGroupsPresent(){return this.primaryHeaderRowCount>1}refreshQuickFilterColumns(){var e;let t=(e=this.isPivotMode()?this.secondaryColumns:this.primaryColumns)!==null&&e!==void 0?e:[];this.groupAutoColumns&&(t=t.concat(this.groupAutoColumns)),this.columnsForQuickFilter=this.gridOptionsService.is("includeHiddenColumnsInQuickFilter")?t:t.filter(n=>n.isVisible()||n.isRowGroupActive())}placeLockedColumns(e){const t=[],n=[],o=[];return e.forEach(a=>{const l=a.getColDef().lockPosition;l==="right"?o.push(a):l==="left"||l===!0?t.push(a):n.push(a)}),[...t,...n,...o]}addAutoGroupToGridColumns(){if(missing(this.groupAutoColumns)){this.destroyOldColumns(this.groupAutoColsBalancedTree),this.groupAutoColsBalancedTree=null;return}this.gridColumns=this.groupAutoColumns?this.groupAutoColumns.concat(this.gridColumns):this.gridColumns;const e=this.columnFactory.createForAutoGroups(this.groupAutoColumns,this.gridBalancedTree);this.destroyOldColumns(this.groupAutoColsBalancedTree,e),this.groupAutoColsBalancedTree=e,this.gridBalancedTree=e.concat(this.gridBalancedTree)}clearDisplayedAndViewportColumns(){this.viewportRowLeft={},this.viewportRowRight={},this.viewportRowCenter={},this.displayedColumnsLeft=[],this.displayedColumnsRight=[],this.displayedColumnsCenter=[],this.displayedColumns=[],this.viewportColumns=[],this.headerViewportColumns=[],this.viewportColumnsHash=""}updateGroupsAndDisplayedColumns(e){this.updateOpenClosedVisibilityInColumnGroups(),this.deriveDisplayedColumns(e),this.refreshFlexedColumns(),this.extractViewport(),this.updateBodyWidths();const t={type:Events.EVENT_DISPLAYED_COLUMNS_CHANGED};this.eventService.dispatchEvent(t)}deriveDisplayedColumns(e){this.derivedDisplayedColumnsFromDisplayedTree(this.displayedTreeLeft,this.displayedColumnsLeft),this.derivedDisplayedColumnsFromDisplayedTree(this.displayedTreeCentre,this.displayedColumnsCenter),this.derivedDisplayedColumnsFromDisplayedTree(this.displayedTreeRight,this.displayedColumnsRight),this.joinDisplayedColumns(),this.setLeftValues(e),this.displayedAutoHeightCols=this.displayedColumns.filter(t=>t.isAutoHeight())}isAutoRowHeightActive(){return this.autoHeightActive}wasAutoRowHeightEverActive(){return this.autoHeightActiveAtLeastOnce}joinDisplayedColumns(){this.gridOptionsService.is("enableRtl")?this.displayedColumns=this.displayedColumnsRight.concat(this.displayedColumnsCenter).concat(this.displayedColumnsLeft):this.displayedColumns=this.displayedColumnsLeft.concat(this.displayedColumnsCenter).concat(this.displayedColumnsRight)}setLeftValues(e){this.setLeftValuesOfColumns(e),this.setLeftValuesOfGroups()}setLeftValuesOfColumns(e){if(!this.primaryColumns)return;const t=this.primaryColumns.slice(0),n=this.gridOptionsService.is("enableRtl");[this.displayedColumnsLeft,this.displayedColumnsRight,this.displayedColumnsCenter].forEach(o=>{if(n){let a=this.getWidthOfColsInList(o);o.forEach(l=>{a-=l.getActualWidth(),l.setLeft(a,e)})}else{let a=0;o.forEach(l=>{l.setLeft(a,e),a+=l.getActualWidth()})}removeAllFromArray(t,o)}),t.forEach(o=>{o.setLeft(null,e)})}setLeftValuesOfGroups(){[this.displayedTreeLeft,this.displayedTreeRight,this.displayedTreeCentre].forEach(e=>{e.forEach(t=>{t instanceof ColumnGroup&&t.checkLeft()})})}derivedDisplayedColumnsFromDisplayedTree(e,t){t.length=0,this.columnUtils.depthFirstDisplayedColumnTreeSearch(e,n=>{n instanceof Column&&t.push(n)})}extractViewportColumns(){this.suppressColumnVirtualisation?(this.viewportColumnsCenter=this.displayedColumnsCenter,this.headerViewportColumnsCenter=this.displayedColumnsCenter):(this.viewportColumnsCenter=this.displayedColumnsCenter.filter(this.isColumnInRowViewport.bind(this)),this.headerViewportColumnsCenter=this.displayedColumnsCenter.filter(this.isColumnInHeaderViewport.bind(this))),this.viewportColumns=this.viewportColumnsCenter.concat(this.displayedColumnsLeft).concat(this.displayedColumnsRight),this.headerViewportColumns=this.headerViewportColumnsCenter.concat(this.displayedColumnsLeft).concat(this.displayedColumnsRight)}getVirtualHeaderGroupRow(e,t){let n;switch(e){case"left":n=this.viewportRowLeft[t];break;case"right":n=this.viewportRowRight[t];break;default:n=this.viewportRowCenter[t];break}return missing(n)&&(n=[]),n}calculateHeaderRows(){this.viewportRowLeft={},this.viewportRowRight={},this.viewportRowCenter={};const e={};this.headerViewportColumns.forEach(n=>e[n.getId()]=!0);const t=(n,o,a)=>{let l=!1;for(let s=0;s<n.length;s++){const m=n[s];let y=!1;if(m instanceof Column)y=e[m.getId()]===!0;else{const W=m.getDisplayedChildren();W&&(y=t(W,o,a+1))}y&&(l=!0,o[a]||(o[a]=[]),o[a].push(m))}return l};t(this.displayedTreeLeft,this.viewportRowLeft,0),t(this.displayedTreeRight,this.viewportRowRight,0),t(this.displayedTreeCentre,this.viewportRowCenter,0)}extractViewport(){const e=o=>`${o.getId()}-${o.getPinned()||"normal"}`;this.extractViewportColumns();const t=this.viewportColumns.map(e).join("#"),n=this.viewportColumnsHash!==t;return n&&(this.viewportColumnsHash=t,this.calculateHeaderRows()),n}refreshFlexedColumns(e={}){const t=e.source?e.source:"flex";if(e.viewportWidth!=null&&(this.flexViewportWidth=e.viewportWidth),!this.flexViewportWidth)return[];let n=-1;e.resizingCols&&e.resizingCols.forEach(W=>{const Ee=this.displayedColumnsCenter.indexOf(W);n<Ee&&(n=Ee)});const o=W=>{const Ee=this.displayedColumnsCenter.indexOf(W)>n;return W.getFlex()&&Ee},a=this.displayedColumnsCenter.filter(W=>!o(W)),l=this.displayedColumnsCenter.filter(W=>o(W)),s=[];if(!l.length)return[];const m=[];let y;e:for(;;){const W=l.reduce((Ee,dt)=>Ee+dt.getFlex(),0);y=this.flexViewportWidth-this.getWidthOfColsInList(a);for(let Ee=0;Ee<l.length;Ee++){const dt=l[Ee],Ht=y*dt.getFlex()/W;let ir=0;const Hr=dt.getMinWidth(),Bn=dt.getMaxWidth();if(exists(Hr)&&Ht<Hr?ir=Hr:exists(Bn)&&Ht>Bn&&(ir=Bn),ir){dt.setActualWidth(ir,t),removeFromArray(l,dt),s.push(dt),a.push(dt);continue e}m[Ee]=Math.round(Ht)}break}let D=y;return l.forEach((W,Ee)=>{W.setActualWidth(Math.min(m[Ee],D),t),s.push(W),D-=m[Ee]}),e.skipSetLeft||this.setLeftValues(t),e.updateBodyWidths&&this.updateBodyWidths(),e.fireResizedEvent&&this.dispatchColumnResizedEvent(s,!0,t,l),l}sizeColumnsToFit(e,t="sizeColumnsToFit",n,o){var a,l,s,m,y;if(this.shouldQueueResizeOperations){this.resizeOperationQueue.push(()=>this.sizeColumnsToFit(e,t,n,o));return}const D={};o&&((a=o==null?void 0:o.columnLimits)===null||a===void 0||a.forEach(Vn=>{var{key:Wr}=Vn,ps=__rest(Vn,["key"]);D[typeof Wr=="string"?Wr:Wr.getColId()]=ps}));const W=this.getAllDisplayedColumns(),Ee=e===this.getWidthOfColsInList(W);if(e<=0||!W.length||Ee)return;const dt=[],Ht=[];W.forEach(Vn=>{Vn.getColDef().suppressSizeToFit===!0?Ht.push(Vn):dt.push(Vn)});const ir=dt.slice(0);let Hr=!1;const Bn=Vn=>{removeFromArray(dt,Vn),Ht.push(Vn)};for(dt.forEach(Vn=>Vn.resetActualWidth(t));!Hr;){Hr=!0;const Vn=e-this.getWidthOfColsInList(Ht);if(Vn<=0)dt.forEach(Wr=>{var ps,il;const gl=(il=(ps=D==null?void 0:D[Wr.getId()])===null||ps===void 0?void 0:ps.minWidth)!==null&&il!==void 0?il:o==null?void 0:o.defaultMinWidth;if(typeof gl=="number"){Wr.setActualWidth(gl);return}Wr.setMinimum(t)});else{const Wr=Vn/this.getWidthOfColsInList(dt);let ps=Vn;for(let il=dt.length-1;il>=0;il--){const gl=dt[il],ml=D==null?void 0:D[gl.getId()],sl=(l=ml==null?void 0:ml.minWidth)!==null&&l!==void 0?l:o==null?void 0:o.defaultMinWidth,ll=(s=ml==null?void 0:ml.maxWidth)!==null&&s!==void 0?s:o==null?void 0:o.defaultMaxWidth,rl=(m=gl.getMinWidth())!==null&&m!==void 0?m:0,th=(y=gl.getMaxWidth())!==null&&y!==void 0?y:Number.MAX_VALUE,nh=typeof sl=="number"&&sl>rl?sl:gl.getMinWidth(),bh=typeof ll=="number"&&ll<th?ll:gl.getMaxWidth();let Fh=Math.round(gl.getActualWidth()*Wr);exists(nh)&&Fh<nh?(Fh=nh,Bn(gl),Hr=!1):exists(bh)&&Fh>bh?(Fh=bh,Bn(gl),Hr=!1):il===0&&(Fh=ps),gl.setActualWidth(Fh,t,!0),ps-=Fh}}}ir.forEach(Vn=>{Vn.fireColumnWidthChangedEvent(t)}),this.setLeftValues(t),this.updateBodyWidths(),!n&&this.dispatchColumnResizedEvent(ir,!0,t)}buildDisplayedTrees(e){const t=[],n=[],o=[];e.forEach(l=>{switch(l.getPinned()){case"left":t.push(l);break;case"right":n.push(l);break;default:o.push(l);break}});const a=new GroupInstanceIdCreator;this.displayedTreeLeft=this.displayedGroupCreator.createDisplayedGroups(t,this.gridBalancedTree,a,"left",this.displayedTreeLeft),this.displayedTreeRight=this.displayedGroupCreator.createDisplayedGroups(n,this.gridBalancedTree,a,"right",this.displayedTreeRight),this.displayedTreeCentre=this.displayedGroupCreator.createDisplayedGroups(o,this.gridBalancedTree,a,null,this.displayedTreeCentre),this.updateDisplayedMap()}updateDisplayedMap(){this.displayedColumnsAndGroupsMap={};const e=t=>{this.displayedColumnsAndGroupsMap[t.getUniqueId()]=t};this.columnUtils.depthFirstAllColumnTreeSearch(this.displayedTreeCentre,e),this.columnUtils.depthFirstAllColumnTreeSearch(this.displayedTreeLeft,e),this.columnUtils.depthFirstAllColumnTreeSearch(this.displayedTreeRight,e)}isDisplayed(e){return this.displayedColumnsAndGroupsMap[e.getUniqueId()]===e}updateOpenClosedVisibilityInColumnGroups(){const e=this.getAllDisplayedTrees();this.columnUtils.depthFirstAllColumnTreeSearch(e,t=>{t instanceof ColumnGroup&&t.calculateDisplayedColumns()})}getGroupAutoColumns(){return this.groupAutoColumns}createGroupAutoColumnsIfNeeded(){const e=this.forceRecreateAutoGroups;if(this.forceRecreateAutoGroups=!1,!this.autoGroupsNeedBuilding)return!1;this.autoGroupsNeedBuilding=!1;const t=this.gridOptionsService.isGroupUseEntireRow(this.pivotMode),n=this.pivotMode?this.gridOptionsService.is("pivotSuppressAutoColumn"):this.isGroupSuppressAutoColumn();if((this.rowGroupColumns.length>0||this.usingTreeData)&&!n&&!t){const l=this.groupAutoColumns||[],s=this.autoGroupColService.createAutoGroupColumns(l,this.rowGroupColumns);if(!this.autoColsEqual(s,this.groupAutoColumns)||e)return this.groupAutoColumns=s,!0}else this.groupAutoColumns=null;return!1}isGroupSuppressAutoColumn(){const e=this.gridOptionsService.get("groupDisplayType");if(e?matchesGroupDisplayType("custom",e):!1)return!0;const n=this.gridOptionsService.get("treeDataDisplayType");return n?matchesTreeDataDisplayType("custom",n):!1}autoColsEqual(e,t){return areEqual(e,t,(n,o)=>n.getColId()===o.getColId())}getWidthOfColsInList(e){return e.reduce((t,n)=>t+n.getActualWidth(),0)}getGridBalancedTree(){return this.gridBalancedTree}hasFloatingFilters(){return this.gridColumns?this.gridColumns.some(t=>t.getColDef().floatingFilter):!1}getFirstDisplayedColumn(){const e=this.gridOptionsService.is("enableRtl"),t=["getDisplayedLeftColumns","getDisplayedCenterColumns","getDisplayedRightColumns"];e&&t.reverse();for(let n=0;n<t.length;n++){const o=this[t[n]]();if(o.length)return e?last(o):o[0]}return null}setColumnHeaderHeight(e,t){if(e.setAutoHeaderHeight(t)){const o={type:Events.EVENT_COLUMN_HEADER_HEIGHT_CHANGED,column:e,columns:[e],source:"autosizeColumnHeaderHeight"};this.eventService.dispatchEvent(o)}}getColumnGroupHeaderRowHeight(){return this.isPivotMode()?this.getPivotGroupHeaderHeight():this.getGroupHeaderHeight()}getColumnHeaderRowHeight(){const e=this.isPivotMode()?this.getPivotHeaderHeight():this.getHeaderHeight(),t=this.getAllDisplayedColumns().filter(n=>n.isAutoHeaderHeight()).map(n=>n.getAutoHeaderHeight()||0);return Math.max(e,...t)}getHeaderHeight(){var e;return(e=this.gridOptionsService.getNum("headerHeight"))!==null&&e!==void 0?e:this.environment.getFromTheme(25,"headerHeight")}getFloatingFiltersHeight(){var e;return(e=this.gridOptionsService.getNum("floatingFiltersHeight"))!==null&&e!==void 0?e:this.getHeaderHeight()}getGroupHeaderHeight(){var e;return(e=this.gridOptionsService.getNum("groupHeaderHeight"))!==null&&e!==void 0?e:this.getHeaderHeight()}getPivotHeaderHeight(){var e;return(e=this.gridOptionsService.getNum("pivotHeaderHeight"))!==null&&e!==void 0?e:this.getHeaderHeight()}getPivotGroupHeaderHeight(){var e;return(e=this.gridOptionsService.getNum("pivotGroupHeaderHeight"))!==null&&e!==void 0?e:this.getGroupHeaderHeight()}queueResizeOperations(){this.shouldQueueResizeOperations=!0}processResizeOperations(){this.shouldQueueResizeOperations=!1,this.resizeOperationQueue.forEach(e=>e()),this.resizeOperationQueue=[]}resetColumnDefIntoColumn(e){const t=e.getUserProvidedColDef();if(!t)return!1;const n=this.columnFactory.mergeColDefs(t,e.getColId());return e.setColDef(n,t),!0}generateColumnStateForRowGroupAndPivotIndexes(e,t){let n={};const o=(a,l,s,m,y,D)=>{if(!l.length||!this.primaryColumns)return[];const W=Object.keys(a),Ee=new Set(W),dt=new Set(W),Ht=new Set(l.map(gl=>{const ml=gl.getColId();return dt.delete(ml),ml}).concat(W)),ir=[],Hr={};let Bn=0;for(let gl=0;gl<this.primaryColumns.length;gl++){const ml=this.primaryColumns[gl].getColId();Ht.has(ml)&&(ir.push(ml),Hr[ml]=Bn++)}let Vn=1e3,Wr=!1,ps=0;const il=gl=>{const ml=Hr[gl];for(let sl=ps;sl<ml;sl++){const ll=ir[sl];dt.has(ll)&&(a[ll][y]=Vn++,dt.delete(ll))}ps=ml};l.forEach(gl=>{const ml=gl.getColId();if(Ee.has(ml))il(ml),a[ml][y]=Vn++;else{const sl=gl.getColDef();(sl[y]===null||sl[y]===void 0&&sl[D]==null)&&(Wr||(sl[s]||sl[s]===void 0&&sl[m]?il(ml):(dt.forEach(th=>{a[th][y]=Vn+Hr[th]}),Vn+=ir.length,Wr=!0)),n[ml]||(n[ml]={colId:ml}),n[ml][y]=Vn++)}})};return o(e,this.rowGroupColumns,"rowGroup","initialRowGroup","rowGroupIndex","initialRowGroupIndex"),o(t,this.pivotColumns,"pivot","initialPivot","pivotIndex","initialPivotIndex"),Object.values(n)}};__decorate$2w([Autowired("expressionService")],ColumnModel.prototype,"expressionService",void 0);__decorate$2w([Autowired("columnFactory")],ColumnModel.prototype,"columnFactory",void 0);__decorate$2w([Autowired("displayedGroupCreator")],ColumnModel.prototype,"displayedGroupCreator",void 0);__decorate$2w([Autowired("ctrlsService")],ColumnModel.prototype,"ctrlsService",void 0);__decorate$2w([Autowired("autoWidthCalculator")],ColumnModel.prototype,"autoWidthCalculator",void 0);__decorate$2w([Autowired("columnUtils")],ColumnModel.prototype,"columnUtils",void 0);__decorate$2w([Autowired("columnAnimationService")],ColumnModel.prototype,"columnAnimationService",void 0);__decorate$2w([Autowired("autoGroupColService")],ColumnModel.prototype,"autoGroupColService",void 0);__decorate$2w([Optional("aggFuncService")],ColumnModel.prototype,"aggFuncService",void 0);__decorate$2w([Optional("valueCache")],ColumnModel.prototype,"valueCache",void 0);__decorate$2w([Optional("animationFrameService")],ColumnModel.prototype,"animationFrameService",void 0);__decorate$2w([Autowired("sortController")],ColumnModel.prototype,"sortController",void 0);__decorate$2w([Autowired("columnDefFactory")],ColumnModel.prototype,"columnDefFactory",void 0);__decorate$2w([PostConstruct],ColumnModel.prototype,"init",null);__decorate$2w([PreDestroy],ColumnModel.prototype,"destroyColumns",null);__decorate$2w([__param$8(0,Qualifier("loggerFactory"))],ColumnModel.prototype,"setBeans",null);ColumnModel=__decorate$2w([Bean("columnModel")],ColumnModel);var __decorate$2v=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let ColumnUtils=class extends BeanStub{calculateColMinWidth(e){return e.minWidth!=null?e.minWidth:this.environment.getMinColWidth()}calculateColMaxWidth(e){return e.maxWidth!=null?e.maxWidth:Number.MAX_SAFE_INTEGER}calculateColInitialWidth(e){const t=this.calculateColMinWidth(e),n=this.calculateColMaxWidth(e);let o;const a=attrToNumber(e.width),l=attrToNumber(e.initialWidth);return a!=null?o=a:l!=null?o=l:o=200,Math.max(Math.min(o,n),t)}getOriginalPathForColumn(e,t){const n=[];let o=!1;const a=(l,s)=>{for(let m=0;m<l.length;m++){if(o)return;const y=l[m];y instanceof ProvidedColumnGroup?(a(y.getChildren(),s+1),n[s]=y):y===e&&(o=!0)}};return a(t,0),o?n:null}depthFirstOriginalTreeSearch(e,t,n){t&&t.forEach(o=>{o instanceof ProvidedColumnGroup&&this.depthFirstOriginalTreeSearch(o,o.getChildren(),n),n(o,e)})}depthFirstAllColumnTreeSearch(e,t){e&&e.forEach(n=>{n instanceof ColumnGroup&&this.depthFirstAllColumnTreeSearch(n.getChildren(),t),t(n)})}depthFirstDisplayedColumnTreeSearch(e,t){e&&e.forEach(n=>{n instanceof ColumnGroup&&this.depthFirstDisplayedColumnTreeSearch(n.getDisplayedChildren(),t),t(n)})}};ColumnUtils=__decorate$2v([Bean("columnUtils")],ColumnUtils);var __decorate$2u=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let DisplayedGroupCreator=class extends BeanStub{createDisplayedGroups(e,t,n,o,a){const l=[];let s,m;const y=this.mapOldGroupsById(a);return e.forEach(D=>{const W=this.getOriginalPathForColumn(t,D),Ee=[],dt=!m;for(let ir=0;ir<W.length;ir++)if(dt||W[ir]!==m[ir]){const Hr=this.createColumnGroup(W[ir],n,y,o);Ee[ir]=Hr,ir==0?l.push(Hr):Ee[ir-1].addChild(Hr)}else Ee[ir]=s[ir];Ee.length===0?l.push(D):last(Ee).addChild(D),s=Ee,m=W}),this.setupParentsIntoColumns(l,null),l}createColumnGroup(e,t,n,o){const a=e.getGroupId(),l=t.getInstanceIdForKey(a),s=ColumnGroup.createUniqueId(a,l);let m=n[s];return m&&m.getProvidedColumnGroup()!==e&&(m=null),exists(m)?m.reset():(m=new ColumnGroup(e,a,l,o),this.context.createBean(m)),m}mapOldGroupsById(e){const t={},n=o=>{o.forEach(a=>{if(a instanceof ColumnGroup){const l=a;t[a.getUniqueId()]=l,n(l.getChildren())}})};return e&&n(e),t}setupParentsIntoColumns(e,t){e.forEach(n=>{if(n.setParent(t),n instanceof ColumnGroup){const o=n;this.setupParentsIntoColumns(o.getChildren(),o)}})}getOriginalPathForColumn(e,t){const n=[];let o=!1;const a=(l,s)=>{for(let m=0;m<l.length;m++){if(o)return;const y=l[m];y instanceof ProvidedColumnGroup?(a(y.getChildren(),s+1),n[s]=y):y===t&&(o=!0)}};return a(e,0),o?n:(console.warn("AG Grid: could not get path"),null)}};DisplayedGroupCreator=__decorate$2u([Bean("displayedGroupCreator")],DisplayedGroupCreator);var __decorate$2t=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let AgStackComponentsRegistry=class extends BeanStub{constructor(){super(...arguments),this.componentsMappedByName={}}setupComponents(e){e&&e.forEach(t=>this.addComponent(t))}addComponent(e){const n=e.componentName.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase().toUpperCase();this.componentsMappedByName[n]=e.componentClass}getComponentClass(e){return this.componentsMappedByName[e]}};AgStackComponentsRegistry=__decorate$2t([Bean("agStackComponentsRegistry")],AgStackComponentsRegistry);function toggleAriaAttribute(r,e,t){t==null||t==""?removeAriaAttribute(r,e):setAriaAttribute(r,e,t)}function setAriaAttribute(r,e,t){r.setAttribute(ariaAttributeName(e),t.toString())}function removeAriaAttribute(r,e){r.removeAttribute(ariaAttributeName(e))}function ariaAttributeName(r){return`aria-${r}`}function setAriaRole(r,e){e?r.setAttribute("role",e):r.removeAttribute("role")}function getAriaSortState(r){let e;return r==="asc"?e="ascending":r==="desc"?e="descending":r==="mixed"?e="other":e="none",e}function getAriaLevel(r){return parseInt(r.getAttribute("aria-level"),10)}function getAriaPosInSet(r){return parseInt(r.getAttribute("aria-posinset"),10)}function getAriaDescribedBy(r){return r.getAttribute("aria-describedby")||""}function setAriaLabel(r,e){toggleAriaAttribute(r,"label",e)}function setAriaLabelledBy(r,e){toggleAriaAttribute(r,"labelledby",e)}function setAriaDescription(r,e){toggleAriaAttribute(r,"description",e)}function setAriaDescribedBy(r,e){toggleAriaAttribute(r,"describedby",e)}function setAriaLive(r,e){toggleAriaAttribute(r,"live",e)}function setAriaLevel(r,e){toggleAriaAttribute(r,"level",e)}function setAriaDisabled(r,e){toggleAriaAttribute(r,"disabled",e)}function setAriaHidden(r,e){toggleAriaAttribute(r,"hidden",e)}function setAriaExpanded(r,e){setAriaAttribute(r,"expanded",e)}function removeAriaExpanded(r){removeAriaAttribute(r,"expanded")}function setAriaSetSize(r,e){setAriaAttribute(r,"setsize",e)}function setAriaPosInSet(r,e){setAriaAttribute(r,"posinset",e)}function setAriaMultiSelectable(r,e){setAriaAttribute(r,"multiselectable",e)}function setAriaRowCount(r,e){setAriaAttribute(r,"rowcount",e)}function setAriaRowIndex(r,e){setAriaAttribute(r,"rowindex",e)}function setAriaColCount(r,e){setAriaAttribute(r,"colcount",e)}function setAriaColIndex(r,e){setAriaAttribute(r,"colindex",e)}function setAriaColSpan(r,e){setAriaAttribute(r,"colspan",e)}function setAriaSort(r,e){setAriaAttribute(r,"sort",e)}function removeAriaSort(r){removeAriaAttribute(r,"sort")}function setAriaSelected(r,e){toggleAriaAttribute(r,"selected",e)}function setAriaChecked(r,e){setAriaAttribute(r,"checked",e===void 0?"mixed":e)}function setAriaControls(r,e){toggleAriaAttribute(r,"controls",e.id),setAriaLabelledBy(e,r.id)}function getAriaCheckboxStateName(r,e){return e===void 0?r("ariaIndeterminate","indeterminate"):e===!0?r("ariaChecked","checked"):r("ariaUnchecked","unchecked")}var AriaUtils=Object.freeze({__proto__:null,setAriaRole,getAriaSortState,getAriaLevel,getAriaPosInSet,getAriaDescribedBy,setAriaLabel,setAriaLabelledBy,setAriaDescription,setAriaDescribedBy,setAriaLive,setAriaLevel,setAriaDisabled,setAriaHidden,setAriaExpanded,removeAriaExpanded,setAriaSetSize,setAriaPosInSet,setAriaMultiSelectable,setAriaRowCount,setAriaRowIndex,setAriaColCount,setAriaColIndex,setAriaColSpan,setAriaSort,removeAriaSort,setAriaSelected,setAriaChecked,setAriaControls,getAriaCheckboxStateName});let isSafari,safariVersion,isChrome,isFirefox,isMacOs,isIOS,invisibleScrollbar,browserScrollbarWidth;function isBrowserSafari(){return isSafari===void 0&&(isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),isSafari}function getSafariVersion(){if(safariVersion===void 0)if(isBrowserSafari()){const r=navigator.userAgent.match(/version\/(\d+)/i);r&&(safariVersion=r[1]!=null?parseFloat(r[1]):0)}else safariVersion=0;return safariVersion}function isBrowserChrome(){if(isChrome===void 0){const r=window;isChrome=!!r.chrome&&(!!r.chrome.webstore||!!r.chrome.runtime)||/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}return isChrome}function isBrowserFirefox(){return isFirefox===void 0&&(isFirefox=/(firefox)/i.test(navigator.userAgent)),isFirefox}function isMacOsUserAgent(){return isMacOs===void 0&&(isMacOs=/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)),isMacOs}function isIOSUserAgent(){return isIOS===void 0&&(isIOS=/iPad|iPhone|iPod/.test(navigator.platform)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1),isIOS}function browserSupportsPreventScroll(){return!isBrowserSafari()||getSafariVersion()>=15}function getTabIndex(r){if(!r)return null;const e=r.tabIndex,t=r.getAttribute("tabIndex");return e===-1&&(t===null||t===""&&!isBrowserFirefox())?null:e.toString()}function getMaxDivHeight(){if(!document.body)return-1;let r=1e6;const e=navigator.userAgent.toLowerCase().match(/firefox/)?6e6:1e9,t=document.createElement("div");for(document.body.appendChild(t);;){const n=r*2;if(t.style.height=n+"px",n>e||t.clientHeight!==n)break;r=n}return document.body.removeChild(t),r}function getBodyWidth(){var r,e,t;return(e=(r=document.body)===null||r===void 0?void 0:r.clientWidth)!==null&&e!==void 0?e:window.innerHeight||((t=document.documentElement)===null||t===void 0?void 0:t.clientWidth)||-1}function getBodyHeight(){var r,e,t;return(e=(r=document.body)===null||r===void 0?void 0:r.clientHeight)!==null&&e!==void 0?e:window.innerHeight||((t=document.documentElement)===null||t===void 0?void 0:t.clientHeight)||-1}function getScrollbarWidth(){return browserScrollbarWidth==null&&initScrollbarWidthAndVisibility(),browserScrollbarWidth}function initScrollbarWidthAndVisibility(){const r=document.body,e=document.createElement("div");e.style.width=e.style.height="100px",e.style.opacity="0",e.style.overflow="scroll",e.style.msOverflowStyle="scrollbar",e.style.position="absolute",r.appendChild(e);let t=e.offsetWidth-e.clientWidth;t===0&&e.clientWidth===0&&(t=null),e.parentNode&&e.parentNode.removeChild(e),t!=null&&(browserScrollbarWidth=t,invisibleScrollbar=t===0)}function isInvisibleScrollbar(){return invisibleScrollbar==null&&initScrollbarWidthAndVisibility(),invisibleScrollbar}var BrowserUtils=Object.freeze({__proto__:null,isBrowserSafari,getSafariVersion,isBrowserChrome,isBrowserFirefox,isMacOsUserAgent,isIOSUserAgent,browserSupportsPreventScroll,getTabIndex,getMaxDivHeight,getBodyWidth,getBodyHeight,getScrollbarWidth,isInvisibleScrollbar});function padStartWidthZeros(r,e){return r.toString().padStart(e,"0")}function createArrayOfNumbers(r,e){const t=[];for(let n=r;n<=e;n++)t.push(n);return t}function cleanNumber(r){return typeof r=="string"&&(r=parseInt(r,10)),typeof r=="number"?Math.floor(r):null}function decToHex(r,e){let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(r&255),r>>>=8;return t}function formatNumberTwoDecimalPlacesAndCommas(r,e,t){return typeof r!="number"?"":formatNumberCommas(Math.round(r*100)/100,e,t)}function formatNumberCommas(r,e,t){return typeof r!="number"?"":r.toString().replace(".",t).replace(/(\d)(?=(\d{3})+(?!\d))/g,`$1${e}`)}function sum$1(r){return r==null?null:r.reduce((e,t)=>e+t,0)}function zeroOrGreater(r,e){return r>=0?r:e}function oneOrGreater(r,e){const t=parseInt(r,10);return!isNaN(t)&&isFinite(t)&&t>0?t:e}var NumberUtils=Object.freeze({__proto__:null,padStartWidthZeros,createArrayOfNumbers,cleanNumber,decToHex,formatNumberTwoDecimalPlacesAndCommas,formatNumberCommas,sum:sum$1,zeroOrGreater,oneOrGreater});function serialiseDate(r,e=!0,t="-"){if(!r)return null;let n=[r.getFullYear(),r.getMonth()+1,r.getDate()].map(o=>padStartWidthZeros(o,2)).join(t);return e&&(n+=" "+[r.getHours(),r.getMinutes(),r.getSeconds()].map(o=>padStartWidthZeros(o,2)).join(":")),n}const calculateOrdinal=r=>{if(r>3&&r<21)return"th";switch(r%10){case 1:return"st";case 2:return"nd";case 3:return"rd"}return"th"};function dateToFormattedString(r,e="YYYY-MM-DD"){const t=padStartWidthZeros(r.getFullYear(),4),n=["January","February","March","April","May","June","July","August","September","October","November","December"],o=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],a={YYYY:()=>t.slice(t.length-4,t.length),YY:()=>t.slice(t.length-2,t.length),Y:()=>`${r.getFullYear()}`,MMMM:()=>n[r.getMonth()],MMM:()=>n[r.getMonth()].slice(0,3),MM:()=>padStartWidthZeros(r.getMonth()+1,2),Mo:()=>`${r.getMonth()+1}${calculateOrdinal(r.getMonth()+1)}`,M:()=>`${r.getMonth()+1}`,Do:()=>`${r.getDate()}${calculateOrdinal(r.getDate())}`,DD:()=>padStartWidthZeros(r.getDate(),2),D:()=>`${r.getDate()}`,dddd:()=>o[r.getDay()],ddd:()=>o[r.getDay()].slice(0,3),dd:()=>o[r.getDay()].slice(0,2),do:()=>`${r.getDay()}${calculateOrdinal(r.getDay())}`,d:()=>`${r.getDay()}`},l=new RegExp(Object.keys(a).join("|"),"g");return e.replace(l,s=>s in a?a[s]():s)}function parseDateTimeFromString(r){if(!r)return null;const[e,t]=r.split(" ");if(!e)return null;const n=e.split("-").map(W=>parseInt(W,10));if(n.filter(W=>!isNaN(W)).length!==3)return null;const[o,a,l]=n,s=new Date(o,a-1,l);if(s.getFullYear()!==o||s.getMonth()!==a-1||s.getDate()!==l)return null;if(!t||t==="00:00:00")return s;const[m,y,D]=t.split(":").map(W=>parseInt(W,10));return m>=0&&m<24&&s.setHours(m),y>=0&&y<60&&s.setMinutes(y),D>=0&&D<60&&s.setSeconds(D),s}var DateUtils=Object.freeze({__proto__:null,serialiseDate,dateToFormattedString,parseDateTimeFromString});let rtlNegativeScroll;function radioCssClass(r,e,t){const n=r.parentElement;let o=n&&n.firstChild;for(;o;)e&&o.classList.toggle(e,o===r),t&&o.classList.toggle(t,o!==r),o=o.nextSibling}const FOCUSABLE_SELECTOR="[tabindex], input, select, button, textarea, [href]",FOCUSABLE_EXCLUDE=".ag-hidden, .ag-hidden *, [disabled], .ag-disabled:not(.ag-button), .ag-disabled *.mjs";function isFocusableFormField(r){const e=Element.prototype.matches||Element.prototype.msMatchesSelector,t="input, select, button, textarea",n=e.call(r,t),o=e.call(r,FOCUSABLE_EXCLUDE),a=isVisible(r);return n&&!o&&a}function setDisplayed(r,e,t={}){const{skipAriaHidden:n}=t;r.classList.toggle("ag-hidden",!e),n||setAriaHidden(r,!e)}function setVisible(r,e,t={}){const{skipAriaHidden:n}=t;r.classList.toggle("ag-invisible",!e),n||setAriaHidden(r,!e)}function setDisabled(r,e){const t="disabled",n=e?o=>o.setAttribute(t,""):o=>o.removeAttribute(t);n(r),nodeListForEach(r.querySelectorAll("input"),o=>n(o))}function isElementChildOfClass(r,e,t){let n=0;for(;r;){if(r.classList.contains(e))return!0;if(r=r.parentElement,typeof t=="number"){if(++n>t)break}else if(r===t)break}return!1}function getElementSize(r){const{height:e,width:t,borderTopWidth:n,borderRightWidth:o,borderBottomWidth:a,borderLeftWidth:l,paddingTop:s,paddingRight:m,paddingBottom:y,paddingLeft:D,marginTop:W,marginRight:Ee,marginBottom:dt,marginLeft:Ht,boxSizing:ir}=window.getComputedStyle(r);return{height:parseFloat(e),width:parseFloat(t),borderTopWidth:parseFloat(n),borderRightWidth:parseFloat(o),borderBottomWidth:parseFloat(a),borderLeftWidth:parseFloat(l),paddingTop:parseFloat(s),paddingRight:parseFloat(m),paddingBottom:parseFloat(y),paddingLeft:parseFloat(D),marginTop:parseFloat(W),marginRight:parseFloat(Ee),marginBottom:parseFloat(dt),marginLeft:parseFloat(Ht),boxSizing:ir}}function getInnerHeight(r){const e=getElementSize(r);return e.boxSizing==="border-box"?e.height-e.paddingTop-e.paddingBottom:e.height}function getInnerWidth(r){const e=getElementSize(r);return e.boxSizing==="border-box"?e.width-e.paddingLeft-e.paddingRight:e.width}function getAbsoluteHeight(r){const e=getElementSize(r),t=e.marginBottom+e.marginTop;return Math.ceil(r.offsetHeight+t)}function getAbsoluteWidth(r){const e=getElementSize(r),t=e.marginLeft+e.marginRight;return Math.ceil(r.offsetWidth+t)}function getElementRectWithOffset(r){const e=r.getBoundingClientRect(),{borderTopWidth:t,borderLeftWidth:n,borderRightWidth:o,borderBottomWidth:a}=getElementSize(r);return{top:e.top+(t||0),left:e.left+(n||0),right:e.right+(o||0),bottom:e.bottom+(a||0)}}function isRtlNegativeScroll(){if(typeof rtlNegativeScroll=="boolean")return rtlNegativeScroll;const r=document.createElement("div");return r.style.direction="rtl",r.style.width="1px",r.style.height="1px",r.style.position="fixed",r.style.top="0px",r.style.overflow="hidden",r.dir="rtl",r.innerHTML=`<div style="width: 2px">
            <span style="display: inline-block; width: 1px"></span>
            <span style="display: inline-block; width: 1px"></span>
        </div>`,document.body.appendChild(r),r.scrollLeft=1,rtlNegativeScroll=Math.floor(r.scrollLeft)===0,document.body.removeChild(r),rtlNegativeScroll}function getScrollLeft(r,e){let t=r.scrollLeft;return e&&(t=Math.abs(t),isBrowserChrome()&&!isRtlNegativeScroll()&&(t=r.scrollWidth-r.clientWidth-t)),t}function setScrollLeft(r,e,t){t&&(isRtlNegativeScroll()?e*=-1:(isBrowserSafari()||isBrowserChrome())&&(e=r.scrollWidth-r.clientWidth-e)),r.scrollLeft=e}function clearElement(r){for(;r&&r.firstChild;)r.removeChild(r.firstChild)}function removeElement(r,e){removeFromParent(r.querySelector(e))}function removeFromParent(r){r&&r.parentNode&&r.parentNode.removeChild(r)}function isVisible(r){return r.offsetParent!==null}function loadTemplate(r){const e=document.createElement("div");return e.innerHTML=(r||"").trim(),e.firstChild}function appendHtml(r,e){r.lastChild?r.insertAdjacentHTML("afterbegin",e):r.innerHTML=e}function getElementAttribute(r,e){return r.attributes&&r.attributes[e]?r.attributes[e].value:null}function offsetHeight(r){return r&&r.clientHeight?r.clientHeight:0}function offsetWidth(r){return r&&r.clientWidth?r.clientWidth:0}function ensureDomOrder(r,e,t){if(t&&t.nextSibling===e)return;const n=document.activeElement,o=e.contains(n);t?t.nextSibling?r.insertBefore(e,t.nextSibling):r.appendChild(e):r.firstChild&&r.firstChild!==e&&r.insertAdjacentElement("afterbegin",e),o&&n&&browserSupportsPreventScroll()&&n.focus({preventScroll:!0})}function setDomChildOrder(r,e){for(let t=0;t<e.length;t++){const n=e[t],o=r.children[t];o!==n&&r.insertBefore(n,o)}}function insertWithDomOrder(r,e,t){t?t.insertAdjacentElement("afterend",e):r.firstChild?r.insertAdjacentElement("afterbegin",e):r.appendChild(e)}function prependDC(r,e){exists(r.firstChild)?r.insertBefore(e,r.firstChild):r.appendChild(e)}function addStylesToElement(r,e){if(e)for(const[t,n]of Object.entries(e)){if(!t||!t.length||n==null)continue;const o=camelCaseToHyphenated(t),a=n.toString(),l=a.replace(/\s*!important/g,""),s=l.length!=a.length?"important":void 0;r.style.setProperty(o,l,s)}}function isHorizontalScrollShowing(r){return r.clientWidth<r.scrollWidth}function isVerticalScrollShowing(r){return r.clientHeight<r.scrollHeight}function setElementWidth(r,e){e==="flex"?(r.style.removeProperty("width"),r.style.removeProperty("minWidth"),r.style.removeProperty("maxWidth"),r.style.flex="1 1 auto"):setFixedWidth(r,e)}function setFixedWidth(r,e){e=formatSize(e),r.style.width=e.toString(),r.style.maxWidth=e.toString(),r.style.minWidth=e.toString()}function setElementHeight(r,e){e==="flex"?(r.style.removeProperty("height"),r.style.removeProperty("minHeight"),r.style.removeProperty("maxHeight"),r.style.flex="1 1 auto"):setFixedHeight(r,e)}function setFixedHeight(r,e){e=formatSize(e),r.style.height=e.toString(),r.style.maxHeight=e.toString(),r.style.minHeight=e.toString()}function formatSize(r){return typeof r=="number"?`${r}px`:r}function isNodeOrElement(r){return r instanceof Node||r instanceof HTMLElement}function copyNodeList(r){if(r==null)return[];const e=[];return nodeListForEach(r,t=>e.push(t)),e}function iterateNamedNodeMap(r,e){if(r)for(let t=0;t<r.length;t++){const n=r[t];e(n.name,n.value)}}function addOrRemoveAttribute(r,e,t){t==null?r.removeAttribute(e):r.setAttribute(e,t.toString())}function nodeListForEach(r,e){if(r!=null)for(let t=0;t<r.length;t++)e(r[t])}var DomUtils=Object.freeze({__proto__:null,radioCssClass,FOCUSABLE_SELECTOR,FOCUSABLE_EXCLUDE,isFocusableFormField,setDisplayed,setVisible,setDisabled,isElementChildOfClass,getElementSize,getInnerHeight,getInnerWidth,getAbsoluteHeight,getAbsoluteWidth,getElementRectWithOffset,isRtlNegativeScroll,getScrollLeft,setScrollLeft,clearElement,removeElement,removeFromParent,isVisible,loadTemplate,appendHtml,getElementAttribute,offsetHeight,offsetWidth,ensureDomOrder,setDomChildOrder,insertWithDomOrder,prependDC,addStylesToElement,isHorizontalScrollShowing,isVerticalScrollShowing,setElementWidth,setFixedWidth,setElementHeight,setFixedHeight,formatSize,isNodeOrElement,copyNodeList,iterateNamedNodeMap,addOrRemoveAttribute,nodeListForEach});const iconNameClassMap={columnGroupOpened:"expanded",columnGroupClosed:"contracted",columnSelectClosed:"tree-closed",columnSelectOpen:"tree-open",columnSelectIndeterminate:"tree-indeterminate",columnMovePin:"pin",columnMoveHide:"eye-slash",columnMoveMove:"arrows",columnMoveLeft:"left",columnMoveRight:"right",columnMoveGroup:"group",columnMoveValue:"aggregation",columnMovePivot:"pivot",dropNotAllowed:"not-allowed",groupContracted:"tree-closed",groupExpanded:"tree-open",setFilterGroupClosed:"tree-closed",setFilterGroupOpen:"tree-open",setFilterGroupIndeterminate:"tree-indeterminate",chart:"chart",close:"cross",cancel:"cancel",check:"tick",first:"first",previous:"previous",next:"next",last:"last",linked:"linked",unlinked:"unlinked",colorPicker:"color-picker",groupLoading:"loading",menu:"menu",filter:"filter",columns:"columns",maximize:"maximize",minimize:"minimize",menuPin:"pin",menuValue:"aggregation",menuAddRowGroup:"group",menuRemoveRowGroup:"group",clipboardCopy:"copy",clipboardCut:"cut",clipboardPaste:"paste",pivotPanel:"pivot",rowGroupPanel:"group",valuePanel:"aggregation",columnDrag:"grip",rowDrag:"grip",save:"save",csvExport:"csv",excelExport:"excel",smallDown:"small-down",smallLeft:"small-left",smallRight:"small-right",smallUp:"small-up",sortAscending:"asc",sortDescending:"desc",sortUnSort:"none"};function createIcon(r,e,t){const n=createIconNoSpan(r,e,t);if(n){const{className:a}=n;if(typeof a=="string"&&a.indexOf("ag-icon")>-1||typeof a=="object"&&a["ag-icon"])return n}const o=document.createElement("span");return o.appendChild(n),o}function createIconNoSpan(r,e,t,n){let o=null;const a=t&&t.getColDef().icons;if(a&&(o=a[r]),e&&!o){const l=e.get("icons");l&&(o=l[r])}if(o){let l;if(typeof o=="function")l=o();else if(typeof o=="string")l=o;else throw new Error("icon from grid options needs to be a string or a function");if(typeof l=="string")return loadTemplate(l);if(isNodeOrElement(l))return l;console.warn("AG Grid: iconRenderer should return back a string or a dom object")}else{const l=document.createElement("span");let s=iconNameClassMap[r];return s||(n?s=r:(console.warn(`AG Grid: Did not find icon ${r}`),s="")),l.setAttribute("class",`ag-icon ag-icon-${s}`),l.setAttribute("unselectable","on"),setAriaRole(l,"presentation"),l}}var IconUtils=Object.freeze({__proto__:null,iconNameClassMap,createIcon,createIconNoSpan});class KeyCode{}KeyCode.BACKSPACE="Backspace";KeyCode.TAB="Tab";KeyCode.ENTER="Enter";KeyCode.ESCAPE="Escape";KeyCode.SPACE=" ";KeyCode.LEFT="ArrowLeft";KeyCode.UP="ArrowUp";KeyCode.RIGHT="ArrowRight";KeyCode.DOWN="ArrowDown";KeyCode.DELETE="Delete";KeyCode.F2="F2";KeyCode.PAGE_UP="PageUp";KeyCode.PAGE_DOWN="PageDown";KeyCode.PAGE_HOME="Home";KeyCode.PAGE_END="End";KeyCode.A="KeyA";KeyCode.C="KeyC";KeyCode.D="KeyD";KeyCode.V="KeyV";KeyCode.X="KeyX";KeyCode.Y="KeyY";KeyCode.Z="KeyZ";const A_KEYCODE=65,C_KEYCODE=67,V_KEYCODE=86,D_KEYCODE=68,Z_KEYCODE=90,Y_KEYCODE=89;function isEventFromPrintableCharacter(r){return r.altKey||r.ctrlKey||r.metaKey?!1:r.key.length===1}function isUserSuppressingKeyboardEvent(r,e,t,n,o){const a=n?n.getColDef().suppressKeyboardEvent:void 0;if(!a)return!1;const l={event:e,editing:o,column:n,api:r.api,node:t,data:t.data,colDef:n.getColDef(),context:r.context,columnApi:r.columnApi};return!!(a&&a(l))}function isUserSuppressingHeaderKeyboardEvent(r,e,t,n){const o=n.getDefinition(),a=o&&o.suppressHeaderKeyboardEvent;if(!exists(a))return!1;const l={api:r.api,columnApi:r.columnApi,context:r.context,colDef:o,column:n,headerRowIndex:t,event:e};return!!a(l)}function normaliseQwertyAzerty(r){const{keyCode:e}=r;let t;switch(e){case A_KEYCODE:t=KeyCode.A;break;case C_KEYCODE:t=KeyCode.C;break;case V_KEYCODE:t=KeyCode.V;break;case D_KEYCODE:t=KeyCode.D;break;case Z_KEYCODE:t=KeyCode.Z;break;case Y_KEYCODE:t=KeyCode.Y;break;default:t=r.code}return t}function isDeleteKey(r,e=!1){return r===KeyCode.DELETE?!0:!e&&r===KeyCode.BACKSPACE?isMacOsUserAgent():!1}var KeyboardUtils=Object.freeze({__proto__:null,isEventFromPrintableCharacter,isUserSuppressingKeyboardEvent,isUserSuppressingHeaderKeyboardEvent,normaliseQwertyAzerty,isDeleteKey});function areEventsNear(r,e,t){if(t===0)return!1;const n=Math.abs(r.clientX-e.clientX),o=Math.abs(r.clientY-e.clientY);return Math.max(n,o)<=t}var MouseUtils=Object.freeze({__proto__:null,areEventsNear});function sortRowNodesByOrder(r,e){if(!r)return!1;const t=(l,s)=>{const m=e[l.id],y=e[s.id],D=m!==void 0,W=y!==void 0,Ee=D&&W,dt=!D&&!W;return Ee?m-y:dt?l.__objectId-s.__objectId:D?1:-1};let n,o,a=!1;for(let l=0;l<r.length-1;l++)if(n=r[l],o=r[l+1],t(n,o)>0){a=!0;break}return a?(r.sort(t),!0):!1}function traverseNodesWithKey(r,e){const t=[];n(r);function n(o){o&&o.forEach(a=>{if(a.group||a.hasChildren()){t.push(a.key);const l=t.join("|");e(a,l),n(a.childrenAfterGroup),t.pop()}})}}var RowNodeUtils=Object.freeze({__proto__:null,sortRowNodesByOrder,traverseNodesWithKey});function convertToSet(r){const e=new Set;return r.forEach(t=>e.add(t)),e}var SetUtils=Object.freeze({__proto__:null,convertToSet});const utils=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},AriaUtils),ArrayUtils),BrowserUtils),DateUtils),DomUtils),EventUtils),FunctionUtils),FuzzyMatchUtils),GenericUtils),IconUtils),KeyboardUtils),MapUtils),MouseUtils),NumberUtils),ObjectUtils),RowNodeUtils),SetUtils),StringUtils),_=utils;class NumberSequence{constructor(e=0,t=1){this.nextValue=e,this.step=t}next(){const e=this.nextValue;return this.nextValue+=this.step,e}peek(){return this.nextValue}skip(e){this.nextValue+=e}}var AgPromiseStatus;(function(r){r[r.IN_PROGRESS=0]="IN_PROGRESS",r[r.RESOLVED=1]="RESOLVED"})(AgPromiseStatus||(AgPromiseStatus={}));class AgPromise{constructor(e){this.status=AgPromiseStatus.IN_PROGRESS,this.resolution=null,this.waiters=[],e(t=>this.onDone(t),t=>this.onReject(t))}static all(e){return new AgPromise(t=>{let n=e.length;const o=new Array(n);e.forEach((a,l)=>{a.then(s=>{o[l]=s,n--,n===0&&t(o)})})})}static resolve(e=null){return new AgPromise(t=>t(e))}then(e){return new AgPromise(t=>{this.status===AgPromiseStatus.RESOLVED?t(e(this.resolution)):this.waiters.push(n=>t(e(n)))})}resolveNow(e,t){return this.status===AgPromiseStatus.RESOLVED?t(this.resolution):e}onDone(e){this.status=AgPromiseStatus.RESOLVED,this.resolution=e,this.waiters.forEach(t=>t(e))}onReject(e){console.warn("TBI")}}var __decorate$2s=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},TooltipStates;(function(r){r[r.NOTHING=0]="NOTHING",r[r.WAITING_TO_SHOW=1]="WAITING_TO_SHOW",r[r.SHOWING=2]="SHOWING"})(TooltipStates||(TooltipStates={}));class CustomTooltipFeature extends BeanStub{constructor(e){super(),this.DEFAULT_SHOW_TOOLTIP_DELAY=2e3,this.DEFAULT_HIDE_TOOLTIP_DELAY=1e4,this.SHOW_QUICK_TOOLTIP_DIFF=1e3,this.FADE_OUT_TOOLTIP_TIMEOUT=1e3,this.state=TooltipStates.NOTHING,this.tooltipInstanceCount=0,this.tooltipMouseTrack=!1,this.parentComp=e}postConstruct(){this.tooltipShowDelay=this.getTooltipDelay("show")||this.DEFAULT_SHOW_TOOLTIP_DELAY,this.tooltipHideDelay=this.getTooltipDelay("hide")||this.DEFAULT_HIDE_TOOLTIP_DELAY,this.tooltipMouseTrack=this.gridOptionsService.is("tooltipMouseTrack");const e=this.parentComp.getGui();this.addManagedListener(e,"mouseenter",this.onMouseEnter.bind(this)),this.addManagedListener(e,"mouseleave",this.onMouseLeave.bind(this)),this.addManagedListener(e,"mousemove",this.onMouseMove.bind(this)),this.addManagedListener(e,"mousedown",this.onMouseDown.bind(this)),this.addManagedListener(e,"keydown",this.onKeyDown.bind(this))}destroy(){this.setToDoNothing(),super.destroy()}onMouseEnter(e){if(isIOSUserAgent()||this.state!=TooltipStates.NOTHING)return;const t=this.isLastTooltipHiddenRecently()?200:this.tooltipShowDelay;this.showTooltipTimeoutId=window.setTimeout(this.showTooltip.bind(this),t),this.lastMouseEvent=e,this.state=TooltipStates.WAITING_TO_SHOW}onMouseLeave(){this.setToDoNothing()}onKeyDown(){this.setToDoNothing()}setToDoNothing(){this.state===TooltipStates.SHOWING&&this.hideTooltip(),this.clearTimeouts(),this.state=TooltipStates.NOTHING}onMouseMove(e){this.lastMouseEvent=e,this.tooltipMouseTrack&&this.state===TooltipStates.SHOWING&&this.tooltipComp&&this.positionTooltipUnderLastMouseEvent()}onMouseDown(){this.setToDoNothing()}getTooltipDelay(e){const t=this.gridOptionsService.getNum("tooltipShowDelay"),n=this.gridOptionsService.getNum("tooltipHideDelay"),o=e==="show"?t:n,a=capitalise(e);return exists(o)?(o<0&&doOnce(()=>console.warn(`AG Grid: tooltip${a}Delay should not be lower than 0`),`tooltip${a}DelayWarn`),Math.max(200,o)):null}hideTooltip(){this.tooltipComp&&(this.destroyTooltipComp(),CustomTooltipFeature.lastTooltipHideTime=new Date().getTime()),this.state=TooltipStates.NOTHING}destroyTooltipComp(){this.tooltipComp.getGui().classList.add("ag-tooltip-hiding");const e=this.tooltipPopupDestroyFunc,t=this.tooltipComp;window.setTimeout(()=>{e(),this.getContext().destroyBean(t)},this.FADE_OUT_TOOLTIP_TIMEOUT),this.tooltipPopupDestroyFunc=void 0,this.tooltipComp=void 0}isLastTooltipHiddenRecently(){const e=new Date().getTime(),t=CustomTooltipFeature.lastTooltipHideTime;return e-t<this.SHOW_QUICK_TOOLTIP_DIFF}showTooltip(){const e=Object.assign({},this.parentComp.getTooltipParams());if(!exists(e.value)){this.setToDoNothing();return}this.state=TooltipStates.SHOWING,this.tooltipInstanceCount++;const t=this.newTooltipComponentCallback.bind(this,this.tooltipInstanceCount);this.userComponentFactory.getTooltipCompDetails(e).newAgStackInstance().then(t)}newTooltipComponentCallback(e,t){if(this.state!==TooltipStates.SHOWING||this.tooltipInstanceCount!==e){this.getContext().destroyBean(t);return}const o=t.getGui();this.tooltipComp=t,o.classList.contains("ag-tooltip")||o.classList.add("ag-tooltip-custom");const a=this.localeService.getLocaleTextFunc(),l=this.popupService.addPopup({eChild:o,ariaLabel:a("ariaLabelTooltip","Tooltip")});l&&(this.tooltipPopupDestroyFunc=l.hideFunc),this.positionTooltipUnderLastMouseEvent(),this.hideTooltipTimeoutId=window.setTimeout(this.hideTooltip.bind(this),this.tooltipHideDelay)}positionTooltipUnderLastMouseEvent(){this.popupService.positionPopupUnderMouseEvent({type:"tooltip",mouseEvent:this.lastMouseEvent,ePopup:this.tooltipComp.getGui(),nudgeY:18,skipObserver:this.tooltipMouseTrack})}clearTimeouts(){this.showTooltipTimeoutId&&(window.clearTimeout(this.showTooltipTimeoutId),this.showTooltipTimeoutId=void 0),this.hideTooltipTimeoutId&&(window.clearTimeout(this.hideTooltipTimeoutId),this.hideTooltipTimeoutId=void 0)}}__decorate$2s([Autowired("popupService")],CustomTooltipFeature.prototype,"popupService",void 0);__decorate$2s([Autowired("userComponentFactory")],CustomTooltipFeature.prototype,"userComponentFactory",void 0);__decorate$2s([PostConstruct],CustomTooltipFeature.prototype,"postConstruct",null);class CssClassManager{constructor(e){this.cssClassStates={},this.getGui=e}addCssClass(e){const t=(e||"").split(" ");if(t.length>1){t.forEach(o=>this.addCssClass(o));return}if(this.cssClassStates[e]!==!0&&e.length){const o=this.getGui();o&&o.classList.add(e),this.cssClassStates[e]=!0}}removeCssClass(e){const t=(e||"").split(" ");if(t.length>1){t.forEach(o=>this.removeCssClass(o));return}if(this.cssClassStates[e]!==!1&&e.length){const o=this.getGui();o&&o.classList.remove(e),this.cssClassStates[e]=!1}}containsCssClass(e){const t=this.getGui();return t?t.classList.contains(e):!1}addOrRemoveCssClass(e,t){if(!e)return;if(e.indexOf(" ")>=0){const o=(e||"").split(" ");if(o.length>1){o.forEach(a=>this.addOrRemoveCssClass(a,t));return}}if(this.cssClassStates[e]!==t&&e.length){const o=this.getGui();o&&o.classList.toggle(e,t),this.cssClassStates[e]=t}}}var __decorate$2r=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const compIdSequence=new NumberSequence;class Component extends BeanStub{constructor(e){super(),this.displayed=!0,this.visible=!0,this.compId=compIdSequence.next(),this.cssClassManager=new CssClassManager(()=>this.eGui),e&&this.setTemplate(e)}preConstructOnComponent(){this.usingBrowserTooltips=this.gridOptionsService.is("enableBrowserTooltips")}getCompId(){return this.compId}getTooltipParams(){return{value:this.tooltipText,location:"UNKNOWN"}}setTooltip(e){const t=()=>{this.usingBrowserTooltips?this.getGui().removeAttribute("title"):this.tooltipFeature=this.destroyBean(this.tooltipFeature)},n=()=>{this.usingBrowserTooltips?this.getGui().setAttribute("title",this.tooltipText):this.tooltipFeature=this.createBean(new CustomTooltipFeature(this))};this.tooltipText!=e&&(this.tooltipText&&t(),e!=null&&(this.tooltipText=e,this.tooltipText&&n()))}createChildComponentsFromTags(e,t){copyNodeList(e.childNodes).forEach(o=>{if(!(o instanceof HTMLElement))return;const a=this.createComponentFromElement(o,l=>{l.getGui()&&this.copyAttributesFromNode(o,l.getGui())},t);if(a){if(a.addItems&&o.children.length){this.createChildComponentsFromTags(o,t);const l=Array.prototype.slice.call(o.children);a.addItems(l)}this.swapComponentForNode(a,e,o)}else o.childNodes&&this.createChildComponentsFromTags(o,t)})}createComponentFromElement(e,t,n){const o=e.nodeName,a=n?n[e.getAttribute("ref")]:void 0,l=this.agStackComponentsRegistry.getComponentClass(o);if(l){Component.elementGettingCreated=e;const s=new l(a);return s.setParentComponent(this),this.createBean(s,null,t),s}return null}copyAttributesFromNode(e,t){iterateNamedNodeMap(e.attributes,(n,o)=>t.setAttribute(n,o))}swapComponentForNode(e,t,n){const o=e.getGui();t.replaceChild(o,n),t.insertBefore(document.createComment(n.nodeName),o),this.addDestroyFunc(this.destroyBean.bind(this,e)),this.swapInComponentForQuerySelectors(e,n)}swapInComponentForQuerySelectors(e,t){const n=this;this.iterateOverQuerySelectors(o=>{n[o.attributeName]===t&&(n[o.attributeName]=e)})}iterateOverQuerySelectors(e){let t=Object.getPrototypeOf(this);for(;t!=null;){const n=t.__agComponentMetaData,o=getFunctionName(t.constructor);n&&n[o]&&n[o].querySelectors&&n[o].querySelectors.forEach(a=>e(a)),t=Object.getPrototypeOf(t)}}activateTabIndex(e){const t=this.gridOptionsService.getNum("tabIndex")||0;e||(e=[]),e.length||e.push(this.getGui()),e.forEach(n=>n.setAttribute("tabindex",t.toString()))}setTemplate(e,t){const n=loadTemplate(e);this.setTemplateFromElement(n,t)}setTemplateFromElement(e,t){this.eGui=e,this.eGui.__agComponent=this,this.wireQuerySelectors(),this.getContext()&&this.createChildComponentsFromTags(this.getGui(),t)}createChildComponentsPreConstruct(){this.getGui()&&this.createChildComponentsFromTags(this.getGui())}wireQuerySelectors(){if(!this.eGui)return;const e=this;this.iterateOverQuerySelectors(t=>{const n=a=>e[t.attributeName]=a;if(t.refSelector&&this.getAttribute("ref")===t.refSelector)n(this.eGui);else{const a=this.eGui.querySelector(t.querySelector);a&&n(a.__agComponent||a)}})}getGui(){return this.eGui}getFocusableElement(){return this.eGui}setParentComponent(e){this.parentComponent=e}getParentComponent(){return this.parentComponent}setGui(e){this.eGui=e}queryForHtmlElement(e){return this.eGui.querySelector(e)}queryForHtmlInputElement(e){return this.eGui.querySelector(e)}appendChild(e,t){if(e!=null)if(t||(t=this.eGui),isNodeOrElement(e))t.appendChild(e);else{const n=e;t.appendChild(n.getGui())}}isDisplayed(){return this.displayed}setVisible(e,t={}){if(e!==this.visible){this.visible=e;const{skipAriaHidden:n}=t;setVisible(this.eGui,e,{skipAriaHidden:n})}}setDisplayed(e,t={}){if(e!==this.displayed){this.displayed=e;const{skipAriaHidden:n}=t;setDisplayed(this.eGui,e,{skipAriaHidden:n});const o={type:Component.EVENT_DISPLAYED_CHANGED,visible:this.displayed};this.dispatchEvent(o)}}destroy(){this.tooltipFeature&&(this.tooltipFeature=this.destroyBean(this.tooltipFeature)),this.parentComponent&&(this.parentComponent=void 0);const e=this.eGui;e&&e.__agComponent&&(e.__agComponent=void 0),super.destroy()}addGuiEventListener(e,t,n){this.eGui.addEventListener(e,t,n),this.addDestroyFunc(()=>this.eGui.removeEventListener(e,t))}addCssClass(e){this.cssClassManager.addCssClass(e)}removeCssClass(e){this.cssClassManager.removeCssClass(e)}containsCssClass(e){return this.cssClassManager.containsCssClass(e)}addOrRemoveCssClass(e,t){this.cssClassManager.addOrRemoveCssClass(e,t)}getAttribute(e){const{eGui:t}=this;return t?t.getAttribute(e):null}getRefElement(e){return this.queryForHtmlElement(`[ref="${e}"]`)}}Component.EVENT_DISPLAYED_CHANGED="displayedChanged";__decorate$2r([Autowired("agStackComponentsRegistry")],Component.prototype,"agStackComponentsRegistry",void 0);__decorate$2r([PreConstruct],Component.prototype,"preConstructOnComponent",null);__decorate$2r([PreConstruct],Component.prototype,"createChildComponentsPreConstruct",null);function RefSelector(r){return querySelectorFunc.bind(this,`[ref=${r}]`,r)}function querySelectorFunc(r,e,t,n,o){if(r===null){console.error("AG Grid: QuerySelector selector should not be null");return}if(typeof o=="number"){console.error("AG Grid: QuerySelector should be on an attribute");return}addToObjectProps(t,"querySelectors",{attributeName:n,querySelector:r,refSelector:e})}function addToObjectProps(r,e,t){const n=getOrCreateProps(r,getFunctionName(r.constructor));n[e]||(n[e]=[]),n[e].push(t)}function getOrCreateProps(r,e){return r.__agComponentMetaData||(r.__agComponentMetaData={}),r.__agComponentMetaData[e]||(r.__agComponentMetaData[e]={}),r.__agComponentMetaData[e]}var __decorate$2q=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class ReadOnlyFloatingFilter extends Component{constructor(){super(`
            <div class="ag-floating-filter-input" role="presentation">
                <ag-input-text-field ref="eFloatingFilterText"></ag-input-text-field>
            </div>`)}destroy(){super.destroy()}init(e){this.params=e;const t=this.columnModel.getDisplayNameForColumn(e.column,"header",!0),n=this.localeService.getLocaleTextFunc();this.eFloatingFilterText.setDisabled(!0).setInputAriaLabel(`${t} ${n("ariaFilterInput","Filter Input")}`)}onParentModelChanged(e){if(!e){this.eFloatingFilterText.setValue("");return}this.params.parentFilterInstance(t=>{if(t.getModelAsString){const n=t.getModelAsString(e);this.eFloatingFilterText.setValue(n)}})}}__decorate$2q([RefSelector("eFloatingFilterText")],ReadOnlyFloatingFilter.prototype,"eFloatingFilterText",void 0);__decorate$2q([Autowired("columnModel")],ReadOnlyFloatingFilter.prototype,"columnModel",void 0);class DateCompWrapper{constructor(e,t,n,o){this.alive=!0,this.context=e,this.eParent=o,t.getDateCompDetails(n).newAgStackInstance().then(s=>{if(!this.alive){e.destroyBean(s);return}this.dateComp=s,s&&(o.appendChild(s.getGui()),s.afterGuiAttached&&s.afterGuiAttached(),this.tempValue&&s.setDate(this.tempValue),this.disabled!=null&&this.setDateCompDisabled(this.disabled))})}destroy(){this.alive=!1,this.dateComp=this.context.destroyBean(this.dateComp)}getDate(){return this.dateComp?this.dateComp.getDate():this.tempValue}setDate(e){this.dateComp?this.dateComp.setDate(e):this.tempValue=e}setDisabled(e){this.dateComp?this.setDateCompDisabled(e):this.disabled=e}setDisplayed(e){setDisplayed(this.eParent,e)}setInputPlaceholder(e){this.dateComp&&this.dateComp.setInputPlaceholder&&this.dateComp.setInputPlaceholder(e)}setInputAriaLabel(e){this.dateComp&&this.dateComp.setInputAriaLabel&&this.dateComp.setInputAriaLabel(e)}afterGuiAttached(e){this.dateComp&&typeof this.dateComp.afterGuiAttached=="function"&&this.dateComp.afterGuiAttached(e)}setDateCompDisabled(e){this.dateComp!=null&&this.dateComp.setDisabled!=null&&this.dateComp.setDisabled(e)}}class OptionsFactory{constructor(){this.customFilterOptions={}}init(e,t){this.filterOptions=e.filterOptions||t,this.mapCustomOptions(),this.selectDefaultItem(e)}getFilterOptions(){return this.filterOptions}mapCustomOptions(){this.filterOptions&&this.filterOptions.forEach(e=>{if(typeof e=="string")return;const t=[["displayKey"],["displayName"],["predicate","test"]],n=o=>o.some(a=>e[a]!=null)?!0:(console.warn(`AG Grid: ignoring FilterOptionDef as it doesn't contain one of '${o}'`),!1);if(!t.every(n)){this.filterOptions=this.filterOptions.filter(o=>o===e)||[];return}this.customFilterOptions[e.displayKey]=e})}selectDefaultItem(e){if(e.defaultOption)this.defaultOption=e.defaultOption;else if(this.filterOptions.length>=1){const t=this.filterOptions[0];typeof t=="string"?this.defaultOption=t:t.displayKey?this.defaultOption=t.displayKey:console.warn("AG Grid: invalid FilterOptionDef supplied as it doesn't contain a 'displayKey'")}else console.warn("AG Grid: no filter options for filter")}getDefaultOption(){return this.defaultOption}getCustomOption(e){return this.customFilterOptions[e]}}const DEFAULT_FILTER_LOCALE_TEXT={applyFilter:"Apply",clearFilter:"Clear",resetFilter:"Reset",cancelFilter:"Cancel",textFilter:"Text Filter",numberFilter:"Number Filter",dateFilter:"Date Filter",setFilter:"Set Filter",filterOoo:"Filter...",empty:"Choose One",equals:"Equals",notEqual:"Not equal",lessThan:"Less than",greaterThan:"Greater than",inRange:"In range",inRangeStart:"From",inRangeEnd:"To",lessThanOrEqual:"Less than or equals",greaterThanOrEqual:"Greater than or equals",contains:"Contains",notContains:"Not contains",startsWith:"Starts with",endsWith:"Ends with",blank:"Blank",notBlank:"Not blank",andCondition:"AND",orCondition:"OR",dateFormatOoo:"yyyy-mm-dd"};var __decorate$2p=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class ManagedFocusFeature extends BeanStub{constructor(e,t={}){super(),this.eFocusableElement=e,this.callbacks=t,this.callbacks=Object.assign({shouldStopEventPropagation:()=>!1,onTabKeyDown:n=>{if(n.defaultPrevented)return;const o=this.focusService.findNextFocusableElement(this.eFocusableElement,!1,n.shiftKey);o&&(o.focus(),n.preventDefault())}},t)}postConstruct(){this.eFocusableElement.classList.add(ManagedFocusFeature.FOCUS_MANAGED_CLASS),this.addKeyDownListeners(this.eFocusableElement),this.callbacks.onFocusIn&&this.addManagedListener(this.eFocusableElement,"focusin",this.callbacks.onFocusIn),this.callbacks.onFocusOut&&this.addManagedListener(this.eFocusableElement,"focusout",this.callbacks.onFocusOut)}addKeyDownListeners(e){this.addManagedListener(e,"keydown",t=>{if(!(t.defaultPrevented||isStopPropagationForAgGrid(t))){if(this.callbacks.shouldStopEventPropagation(t)){stopPropagationForAgGrid(t);return}t.key===KeyCode.TAB?this.callbacks.onTabKeyDown(t):this.callbacks.handleKeyDown&&this.callbacks.handleKeyDown(t)}})}}ManagedFocusFeature.FOCUS_MANAGED_CLASS="ag-focus-managed";__decorate$2p([Autowired("focusService")],ManagedFocusFeature.prototype,"focusService",void 0);__decorate$2p([PostConstruct],ManagedFocusFeature.prototype,"postConstruct",null);var __decorate$2o=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const RESIZE_CONTAINER_STYLE="ag-resizer-wrapper",RESIZE_TEMPLATE=`<div class="${RESIZE_CONTAINER_STYLE}">
        <div ref="eTopLeftResizer" class="ag-resizer ag-resizer-topLeft"></div>
        <div ref="eTopResizer" class="ag-resizer ag-resizer-top"></div>
        <div ref="eTopRightResizer" class="ag-resizer ag-resizer-topRight"></div>
        <div ref="eRightResizer" class="ag-resizer ag-resizer-right"></div>
        <div ref="eBottomRightResizer" class="ag-resizer ag-resizer-bottomRight"></div>
        <div ref="eBottomResizer" class="ag-resizer ag-resizer-bottom"></div>
        <div ref="eBottomLeftResizer" class="ag-resizer ag-resizer-bottomLeft"></div>
        <div ref="eLeftResizer" class="ag-resizer ag-resizer-left"></div>
    </div>`;class PositionableFeature extends BeanStub{constructor(e,t){super(),this.element=e,this.dragStartPosition={x:0,y:0},this.position={x:0,y:0},this.lastSize={width:-1,height:-1},this.positioned=!1,this.resizersAdded=!1,this.resizeListeners=[],this.boundaryEl=null,this.isResizing=!1,this.isMoving=!1,this.resizable={},this.movable=!1,this.currentResizer=null,this.config=Object.assign({},{popup:!1},t)}center(){const{clientHeight:e,clientWidth:t}=this.offsetParent,n=t/2-this.getWidth()/2,o=e/2-this.getHeight()/2;this.offsetElement(n,o)}initialisePosition(){if(this.positioned)return;const{centered:e,forcePopupParentAsOffsetParent:t,minWidth:n,width:o,minHeight:a,height:l,x:s,y:m}=this.config;this.offsetParent||this.setOffsetParent();let y=0,D=0;const W=!!this.element.offsetParent;if(W){const Ee=this.findBoundaryElement(),dt=window.getComputedStyle(Ee);if(dt.minWidth!=null){const Ht=Ee.offsetWidth-this.element.offsetWidth;D=parseInt(dt.minWidth,10)-Ht}if(dt.minHeight!=null){const Ht=Ee.offsetHeight-this.element.offsetHeight;y=parseInt(dt.minHeight,10)-Ht}}if(this.minHeight=a||y,this.minWidth=n||D,o&&this.setWidth(o),l&&this.setHeight(l),(!o||!l)&&this.refreshSize(),e)this.center();else if(s||m)this.offsetElement(s,m);else if(W&&t){let Ee=this.boundaryEl,dt=!0;if(Ee||(Ee=this.findBoundaryElement(),dt=!1),Ee){const Ht=parseFloat(Ee.style.top),ir=parseFloat(Ee.style.left);dt?this.offsetElement(isNaN(ir)?0:ir,isNaN(Ht)?0:Ht):this.setPosition(ir,Ht)}}this.positioned=!!this.offsetParent}isPositioned(){return this.positioned}getPosition(){return this.position}setMovable(e,t){if(!this.config.popup||e===this.movable)return;this.movable=e;const n=this.moveElementDragListener||{eElement:t,onDragStart:this.onMoveStart.bind(this),onDragging:this.onMove.bind(this),onDragStop:this.onMoveEnd.bind(this)};e?(this.dragService.addDragSource(n),this.moveElementDragListener=n):(this.dragService.removeDragSource(n),this.moveElementDragListener=void 0)}setResizable(e){if(this.clearResizeListeners(),e?this.addResizers():this.removeResizers(),typeof e=="boolean"){if(e===!1)return;e={topLeft:e,top:e,topRight:e,right:e,bottomRight:e,bottom:e,bottomLeft:e,left:e}}Object.keys(e).forEach(t=>{const o=!!e[t],a=this.getResizerElement(t),l={dragStartPixels:0,eElement:a,onDragStart:s=>this.onResizeStart(s,t),onDragging:this.onResize.bind(this),onDragStop:s=>this.onResizeEnd(s,t)};(o||!this.isAlive()&&!o)&&(o?(this.dragService.addDragSource(l),this.resizeListeners.push(l),a.style.pointerEvents="all"):a.style.pointerEvents="none",this.resizable[t]=o)})}removeSizeFromEl(){this.element.style.removeProperty("height"),this.element.style.removeProperty("width"),this.element.style.removeProperty("flex")}restoreLastSize(){this.element.style.flex="0 0 auto";const{height:e,width:t}=this.lastSize;t!==-1&&(this.element.style.width=`${t}px`),e!==-1&&(this.element.style.height=`${e}px`)}getHeight(){return this.element.offsetHeight}setHeight(e){const{popup:t}=this.config,n=this.element;let o=!1;if(typeof e=="string"&&e.indexOf("%")!==-1)setFixedHeight(n,e),e=getAbsoluteHeight(n),o=!0;else if(e=Math.max(this.minHeight,e),this.positioned){const a=this.getAvailableHeight();a&&e>a&&(e=a)}this.getHeight()!==e&&(o?(n.style.maxHeight="unset",n.style.minHeight="unset"):t?setFixedHeight(n,e):(n.style.height=`${e}px`,n.style.flex="0 0 auto",this.lastSize.height=typeof e=="number"?e:parseFloat(e)))}getAvailableHeight(){const{popup:e,forcePopupParentAsOffsetParent:t}=this.config;this.positioned||this.initialisePosition();const{clientHeight:n}=this.offsetParent;if(!n)return null;const o=this.element.getBoundingClientRect(),a=this.offsetParent.getBoundingClientRect(),l=e?this.position.y:o.top,s=e?0:a.top;let m=0;if(t){const D=this.element.parentElement;if(D){const{bottom:W}=D.getBoundingClientRect();m=W-o.bottom}}return n+s-l-m}getWidth(){return this.element.offsetWidth}setWidth(e){const t=this.element,{popup:n}=this.config;let o=!1;if(typeof e=="string"&&e.indexOf("%")!==-1)setFixedWidth(t,e),e=getAbsoluteWidth(t),o=!0;else if(this.positioned){e=Math.max(this.minWidth,e);const{clientWidth:a}=this.offsetParent,l=n?this.position.x:this.element.getBoundingClientRect().left;a&&e+l>a&&(e=a-l)}this.getWidth()!==e&&(o?(t.style.maxWidth="unset",t.style.minWidth="unset"):this.config.popup?setFixedWidth(t,e):(t.style.width=`${e}px`,t.style.flex=" unset",this.lastSize.width=typeof e=="number"?e:parseFloat(e)))}offsetElement(e=0,t=0){const{forcePopupParentAsOffsetParent:n}=this.config,o=n?this.boundaryEl:this.element;o&&(this.popupService.positionPopup({ePopup:o,keepWithinBounds:!0,skipObserver:this.movable||this.isResizable(),updatePosition:()=>({x:e,y:t})}),this.setPosition(parseFloat(o.style.left),parseFloat(o.style.top)))}constrainSizeToAvailableHeight(e){if(!this.config.forcePopupParentAsOffsetParent)return;const t=()=>{const n=this.getAvailableHeight();this.element.style.setProperty("max-height",`${n}px`)};e?this.resizeObserverSubscriber=this.resizeObserverService.observeResize(this.popupService.getPopupParent(),t):(this.element.style.removeProperty("max-height"),this.resizeObserverSubscriber&&(this.resizeObserverSubscriber(),this.resizeObserverSubscriber=void 0))}setPosition(e,t){this.position.x=e,this.position.y=t}updateDragStartPosition(e,t){this.dragStartPosition={x:e,y:t}}calculateMouseMovement(e){const{e:t,isLeft:n,isTop:o,anywhereWithin:a,topBuffer:l}=e,s=t.clientX-this.dragStartPosition.x,m=t.clientY-this.dragStartPosition.y,y=this.shouldSkipX(t,!!n,!!a,s)?0:s,D=this.shouldSkipY(t,!!o,l,m)?0:m;return{movementX:y,movementY:D}}shouldSkipX(e,t,n,o){const a=this.element.getBoundingClientRect(),l=this.offsetParent.getBoundingClientRect(),s=this.boundaryEl.getBoundingClientRect(),m=this.config.popup?this.position.x:a.left;let y=m<=0&&l.left>=e.clientX||l.right<=e.clientX&&l.right<=s.right;return y?!0:(t?y=o<0&&e.clientX>m+l.left||o>0&&e.clientX<m+l.left:n?y=o<0&&e.clientX>s.right||o>0&&e.clientX<m+l.left:y=o<0&&e.clientX>s.right||o>0&&e.clientX<s.right,y)}shouldSkipY(e,t,n=0,o){const a=this.element.getBoundingClientRect(),l=this.offsetParent.getBoundingClientRect(),s=this.boundaryEl.getBoundingClientRect(),m=this.config.popup?this.position.y:a.top;let y=m<=0&&l.top>=e.clientY||l.bottom<=e.clientY&&l.bottom<=s.bottom;return y?!0:(t?y=o<0&&e.clientY>m+l.top+n||o>0&&e.clientY<m+l.top:y=o<0&&e.clientY>s.bottom||o>0&&e.clientY<s.bottom,y)}createResizeMap(){const e=this.element;this.resizerMap={topLeft:{element:e.querySelector("[ref=eTopLeftResizer]")},top:{element:e.querySelector("[ref=eTopResizer]")},topRight:{element:e.querySelector("[ref=eTopRightResizer]")},right:{element:e.querySelector("[ref=eRightResizer]")},bottomRight:{element:e.querySelector("[ref=eBottomRightResizer]")},bottom:{element:e.querySelector("[ref=eBottomResizer]")},bottomLeft:{element:e.querySelector("[ref=eBottomLeftResizer]")},left:{element:e.querySelector("[ref=eLeftResizer]")}}}addResizers(){if(this.resizersAdded)return;const e=this.element;if(!e)return;const n=new DOMParser().parseFromString(RESIZE_TEMPLATE,"text/html").body;e.appendChild(n.firstChild),this.createResizeMap(),this.resizersAdded=!0}removeResizers(){this.resizerMap=void 0;const e=this.element.querySelector(`.${RESIZE_CONTAINER_STYLE}`);e&&this.element.removeChild(e),this.resizersAdded=!1}getResizerElement(e){return this.resizerMap[e].element}onResizeStart(e,t){this.boundaryEl=this.findBoundaryElement(),this.positioned||this.initialisePosition(),this.currentResizer={isTop:!!t.match(/top/i),isRight:!!t.match(/right/i),isBottom:!!t.match(/bottom/i),isLeft:!!t.match(/left/i)},this.element.classList.add("ag-resizing"),this.resizerMap[t].element.classList.add("ag-active");const{popup:n,forcePopupParentAsOffsetParent:o}=this.config;!n&&!o&&this.applySizeToSiblings(this.currentResizer.isBottom||this.currentResizer.isTop),this.isResizing=!0,this.updateDragStartPosition(e.clientX,e.clientY)}getSiblings(){const t=this.element.parentElement;return t?Array.prototype.slice.call(t.children).filter(n=>!n.classList.contains("ag-hidden")):null}getMinSizeOfSiblings(){const e=this.getSiblings()||[];let t=0,n=0;for(let o=0;o<e.length;o++){const a=e[o],l=!!a.style.flex&&a.style.flex!=="0 0 auto";if(a===this.element)continue;let s=this.minHeight||0,m=this.minWidth||0;if(l){const y=window.getComputedStyle(a);y.minHeight&&(s=parseInt(y.minHeight,10)),y.minWidth&&(m=parseInt(y.minWidth,10))}else s=a.offsetHeight,m=a.offsetWidth;t+=s,n+=m}return{height:t,width:n}}applySizeToSiblings(e){let t=null;const n=this.getSiblings();if(n){for(let o=0;o<n.length;o++){const a=n[o];a!==t&&(e?a.style.height=`${a.offsetHeight}px`:a.style.width=`${a.offsetWidth}px`,a.style.flex="0 0 auto",a===this.element&&(t=n[o+1]))}t&&(t.style.removeProperty("height"),t.style.removeProperty("min-height"),t.style.removeProperty("max-height"),t.style.flex="1 1 auto")}}isResizable(){return Object.values(this.resizable).some(e=>e)}onResize(e){if(!this.isResizing||!this.currentResizer)return;const{popup:t,forcePopupParentAsOffsetParent:n}=this.config,{isTop:o,isRight:a,isBottom:l,isLeft:s}=this.currentResizer,m=a||s,y=l||o,{movementX:D,movementY:W}=this.calculateMouseMovement({e,isLeft:s,isTop:o}),Ee=this.position.x,dt=this.position.y;let Ht=0,ir=0;if(m&&D){const Hr=s?-1:1,Bn=this.getWidth(),Vn=Bn+D*Hr;let Wr=!1;s&&(Ht=Bn-Vn,(Ee+Ht<=0||Vn<=this.minWidth)&&(Wr=!0,Ht=0)),Wr||this.setWidth(Vn)}if(y&&W){const Hr=o?-1:1,Bn=this.getHeight(),Vn=Bn+W*Hr;let Wr=!1;o?(ir=Bn-Vn,(dt+ir<=0||Vn<=this.minHeight)&&(Wr=!0,ir=0)):!this.config.popup&&!this.config.forcePopupParentAsOffsetParent&&Bn<Vn&&this.getMinSizeOfSiblings().height+Vn>this.element.parentElement.offsetHeight&&(Wr=!0),Wr||this.setHeight(Vn)}this.updateDragStartPosition(e.clientX,e.clientY),((t||n)&&Ht||ir)&&this.offsetElement(Ee+Ht,dt+ir)}onResizeEnd(e,t){this.isResizing=!1,this.currentResizer=null,this.boundaryEl=null;const n={type:"resize",api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi};this.element.classList.remove("ag-resizing"),this.resizerMap[t].element.classList.remove("ag-active"),this.dispatchEvent(n)}refreshSize(){const e=this.element;this.config.popup&&(this.config.width||this.setWidth(e.offsetWidth),this.config.height||this.setHeight(e.offsetHeight))}onMoveStart(e){this.boundaryEl=this.findBoundaryElement(),this.positioned||this.initialisePosition(),this.isMoving=!0,this.element.classList.add("ag-moving"),this.updateDragStartPosition(e.clientX,e.clientY)}onMove(e){if(!this.isMoving)return;const{x:t,y:n}=this.position;let o;this.config.calculateTopBuffer&&(o=this.config.calculateTopBuffer());const{movementX:a,movementY:l}=this.calculateMouseMovement({e,isTop:!0,anywhereWithin:!0,topBuffer:o});this.offsetElement(t+a,n+l),this.updateDragStartPosition(e.clientX,e.clientY)}onMoveEnd(){this.isMoving=!1,this.boundaryEl=null,this.element.classList.remove("ag-moving")}setOffsetParent(){this.config.forcePopupParentAsOffsetParent?this.offsetParent=this.popupService.getPopupParent():this.offsetParent=this.element.offsetParent}findBoundaryElement(){let e=this.element;for(;e;){if(window.getComputedStyle(e).position!=="static")return e;e=e.parentElement}return this.element}clearResizeListeners(){for(;this.resizeListeners.length;){const e=this.resizeListeners.pop();this.dragService.removeDragSource(e)}}destroy(){super.destroy(),this.moveElementDragListener&&this.dragService.removeDragSource(this.moveElementDragListener),this.constrainSizeToAvailableHeight(!1),this.clearResizeListeners(),this.removeResizers()}}__decorate$2o([Autowired("popupService")],PositionableFeature.prototype,"popupService",void 0);__decorate$2o([Autowired("resizeObserverService")],PositionableFeature.prototype,"resizeObserverService",void 0);__decorate$2o([Autowired("dragService")],PositionableFeature.prototype,"dragService",void 0);var __decorate$2n=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class ProvidedFilter extends Component{constructor(e){super(),this.filterNameKey=e,this.applyActive=!1,this.hidePopup=null,this.debouncePending=!1,this.appliedModel=null}postConstruct(){this.resetTemplate(),this.createManagedBean(new ManagedFocusFeature(this.getFocusableElement(),{handleKeyDown:this.handleKeyDown.bind(this)})),this.positionableFeature=new PositionableFeature(this.getPositionableElement(),{forcePopupParentAsOffsetParent:!0}),this.createBean(this.positionableFeature)}handleKeyDown(e){}getFilterTitle(){return this.translate(this.filterNameKey)}isFilterActive(){return!!this.appliedModel}resetTemplate(e){let t=this.getGui();t&&t.removeEventListener("submit",this.onFormSubmit);const n=`
            <form class="ag-filter-wrapper">
                <div class="ag-filter-body-wrapper ag-${this.getCssIdentifier()}-body-wrapper" ref="eFilterBody">
                    ${this.createBodyTemplate()}
                </div>
            </form>`;this.setTemplate(n,e),t=this.getGui(),t&&t.addEventListener("submit",this.onFormSubmit)}isReadOnly(){return!!this.providedFilterParams.readOnly}init(e){this.setParams(e),this.resetUiToDefaults(!0).then(()=>{this.updateUiVisibility(),this.setupOnBtApplyDebounce()})}setParams(e){this.providedFilterParams=e,this.applyActive=ProvidedFilter.isUseApplyButton(e),this.createButtonPanel()}createButtonPanel(){const{buttons:e}=this.providedFilterParams;if(!e||e.length<1||this.isReadOnly())return;const t=document.createElement("div");t.classList.add("ag-filter-apply-panel");const n=o=>{let a,l;switch(o){case"apply":a=this.translate("applyFilter"),l=y=>this.onBtApply(!1,!1,y);break;case"clear":a=this.translate("clearFilter"),l=()=>this.onBtClear();break;case"reset":a=this.translate("resetFilter"),l=()=>this.onBtReset();break;case"cancel":a=this.translate("cancelFilter"),l=y=>{this.onBtCancel(y)};break;default:console.warn("AG Grid: Unknown button type specified");return}const m=loadTemplate(`<button
                    type="${o==="apply"?"submit":"button"}"
                    ref="${o}FilterButton"
                    class="ag-button ag-standard-button ag-filter-apply-panel-button"
                >${a}
                </button>`);t.appendChild(m),this.addManagedListener(m,"click",l)};convertToSet(e).forEach(o=>n(o)),this.getGui().appendChild(t)}getDefaultDebounceMs(){return 0}setupOnBtApplyDebounce(){const e=ProvidedFilter.getDebounceMs(this.providedFilterParams,this.getDefaultDebounceMs()),t=debounce(this.checkApplyDebounce.bind(this),e);this.onBtApplyDebounce=()=>{this.debouncePending=!0,t()}}checkApplyDebounce(){this.debouncePending&&(this.debouncePending=!1,this.onBtApply())}getModel(){return this.appliedModel?this.appliedModel:null}setModel(e){return(e!=null?this.setModelIntoUi(e):this.resetUiToDefaults()).then(()=>{this.updateUiVisibility(),this.applyModel("api")})}onBtCancel(e){this.resetUiToActiveModel(this.getModel(),()=>{this.handleCancelEnd(e)})}handleCancelEnd(e){this.providedFilterParams.closeOnApply&&this.close(e)}resetUiToActiveModel(e,t){const n=()=>{this.onUiChanged(!1,"prevent"),t==null||t()};e!=null?this.setModelIntoUi(e).then(n):this.resetUiToDefaults().then(n)}onBtClear(){this.resetUiToDefaults().then(()=>this.onUiChanged())}onBtReset(){this.onBtClear(),this.onBtApply()}applyModel(e="api"){const t=this.getModelFromUi();if(!this.isModelValid(t))return!1;const n=this.appliedModel;return this.appliedModel=t,!this.areModelsEqual(n,t)}isModelValid(e){return!0}onFormSubmit(e){e.preventDefault()}onBtApply(e=!1,t=!1,n){n&&n.preventDefault(),this.applyModel(t?"rowDataUpdated":"ui")&&this.providedFilterParams.filterChangedCallback({afterFloatingFilter:e,afterDataChange:t});const{closeOnApply:o}=this.providedFilterParams;o&&this.applyActive&&!e&&!t&&this.close(n)}onNewRowsLoaded(){}close(e){if(!this.hidePopup)return;const t=e,n=t&&t.key;let o;(n==="Enter"||n==="Space")&&(o={keyboardEvent:t}),this.hidePopup(o),this.hidePopup=null}onUiChanged(e=!1,t){if(this.updateUiVisibility(),this.providedFilterParams.filterModifiedCallback(),this.applyActive&&!this.isReadOnly()){const n=this.isModelValid(this.getModelFromUi());setDisabled(this.getRefElement("applyFilterButton"),!n)}e&&!t||t==="immediately"?this.onBtApply(e):(!this.applyActive&&!t||t==="debounce")&&this.onBtApplyDebounce()}afterGuiAttached(e){e&&(this.hidePopup=e.hidePopup),this.refreshFilterResizer(e==null?void 0:e.container)}refreshFilterResizer(e){if(!this.positionableFeature||e==="toolPanel")return;const t=e==="floatingFilter",{positionableFeature:n,gridOptionsService:o}=this;t?(n.restoreLastSize(),n.setResizable(o.is("enableRtl")?{bottom:!0,bottomLeft:!0,left:!0}:{bottom:!0,bottomRight:!0,right:!0})):(this.positionableFeature.removeSizeFromEl(),this.positionableFeature.setResizable(!1)),this.positionableFeature.constrainSizeToAvailableHeight(!0)}afterGuiDetached(){this.checkApplyDebounce(),this.positionableFeature&&this.positionableFeature.constrainSizeToAvailableHeight(!1)}static getDebounceMs(e,t){return ProvidedFilter.isUseApplyButton(e)?(e.debounceMs!=null&&console.warn("AG Grid: debounceMs is ignored when apply button is present"),0):e.debounceMs!=null?e.debounceMs:t}static isUseApplyButton(e){return!!e.buttons&&e.buttons.indexOf("apply")>=0}destroy(){const e=this.getGui();e&&e.removeEventListener("submit",this.onFormSubmit),this.hidePopup=null,this.positionableFeature&&(this.positionableFeature=this.destroyBean(this.positionableFeature)),super.destroy()}translate(e){return this.localeService.getLocaleTextFunc()(e,DEFAULT_FILTER_LOCALE_TEXT[e])}getCellValue(e){const{api:t,colDef:n,column:o,columnApi:a,context:l}=this.providedFilterParams;return this.providedFilterParams.valueGetter({api:t,colDef:n,column:o,columnApi:a,context:l,data:e.data,getValue:s=>e.data[s],node:e})}getPositionableElement(){return this.eFilterBody}}__decorate$2n([Autowired("rowModel")],ProvidedFilter.prototype,"rowModel",void 0);__decorate$2n([RefSelector("eFilterBody")],ProvidedFilter.prototype,"eFilterBody",void 0);__decorate$2n([PostConstruct],ProvidedFilter.prototype,"postConstruct",null);var __decorate$2m=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class AgAbstractLabel extends Component{constructor(e,t){super(t),this.labelSeparator="",this.labelAlignment="left",this.disabled=!1,this.label="",this.config=e||{}}postConstruct(){this.addCssClass("ag-labeled"),this.eLabel.classList.add("ag-label");const{labelSeparator:e,label:t,labelWidth:n,labelAlignment:o}=this.config;e!=null&&this.setLabelSeparator(e),t!=null&&this.setLabel(t),n!=null&&this.setLabelWidth(n),this.setLabelAlignment(o||this.labelAlignment),this.refreshLabel()}refreshLabel(){clearElement(this.eLabel),typeof this.label=="string"?this.eLabel.innerText=this.label+this.labelSeparator:this.label&&this.eLabel.appendChild(this.label),this.label===""?(setDisplayed(this.eLabel,!1),setAriaRole(this.eLabel,"presentation")):(setDisplayed(this.eLabel,!0),setAriaRole(this.eLabel,null))}setLabelSeparator(e){return this.labelSeparator===e?this:(this.labelSeparator=e,this.label!=null&&this.refreshLabel(),this)}getLabelId(){return this.eLabel.id=this.eLabel.id||`ag-${this.getCompId()}-label`,this.eLabel.id}getLabel(){return this.label}setLabel(e){return this.label===e?this:(this.label=e,this.refreshLabel(),this)}setLabelAlignment(e){const n=this.getGui().classList;return n.toggle("ag-label-align-left",e==="left"),n.toggle("ag-label-align-right",e==="right"),n.toggle("ag-label-align-top",e==="top"),this}setLabelEllipsis(e){return this.eLabel.classList.toggle("ag-label-ellipsis",e),this}setLabelWidth(e){return this.label==null?this:(setElementWidth(this.eLabel,e),this)}setDisabled(e){e=!!e;const t=this.getGui();return setDisabled(t,e),t.classList.toggle("ag-disabled",e),this.disabled=e,this}isDisabled(){return!!this.disabled}}__decorate$2m([PostConstruct],AgAbstractLabel.prototype,"postConstruct",null);class AgAbstractField extends AgAbstractLabel{constructor(e,t,n){super(e,t),this.className=n}postConstruct(){super.postConstruct(),this.className&&this.addCssClass(this.className)}onValueChange(e){return this.addManagedListener(this,AgAbstractField.EVENT_CHANGED,()=>e(this.getValue())),this}getWidth(){return this.getGui().clientWidth}setWidth(e){return setFixedWidth(this.getGui(),e),this}getPreviousValue(){return this.previousValue}getValue(){return this.value}setValue(e,t){return this.value===e?this:(this.previousValue=this.value,this.value=e,t||this.dispatchEvent({type:AgAbstractField.EVENT_CHANGED}),this)}}AgAbstractField.EVENT_CHANGED="valueChange";var __decorate$2l=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class AgPickerField extends AgAbstractField{constructor(e,t,n,o){super(e,`<div class="ag-picker-field" role="presentation">
                <div ref="eLabel"></div>
                <div ref="eWrapper"
                    class="ag-wrapper ag-picker-field-wrapper"
                    tabIndex="-1"
                    aria-expanded="false"
                    ${o?`role="${o}"`:""}
                >
                    <div ref="eDisplayField" class="ag-picker-field-display"></div>
                    <div ref="eIcon" class="ag-picker-field-icon" aria-hidden="true"></div>
                </div>
            </div>`,t),this.pickerIcon=n,this.isPickerDisplayed=!1,this.isDestroyingPicker=!1,this.skipClick=!1}postConstruct(){super.postConstruct();const e=`ag-${this.getCompId()}-display`;this.eDisplayField.setAttribute("id",e),setAriaDescribedBy(this.eWrapper,e);const t=()=>{if(this.skipClick){this.skipClick=!1;return}this.isDisabled()||(this.pickerComponent=this.showPicker())},n=this.getGui();if(this.addManagedListener(n,"mousedown",o=>{!this.skipClick&&this.pickerComponent&&this.pickerComponent.isAlive()&&isVisible(this.pickerComponent.getGui())&&n.contains(o.target)&&(this.skipClick=!0)}),this.addManagedListener(n,"keydown",o=>{switch(o.key){case KeyCode.UP:case KeyCode.DOWN:case KeyCode.ENTER:case KeyCode.SPACE:t();case KeyCode.ESCAPE:this.isPickerDisplayed&&o.preventDefault();break}}),this.addManagedListener(this.eWrapper,"click",t),this.addManagedListener(this.eLabel,"click",t),this.pickerIcon){const o=createIconNoSpan(this.pickerIcon,this.gridOptionsService);o&&this.eIcon.appendChild(o)}}refreshLabel(){exists(this.getLabel())?setAriaLabelledBy(this.eWrapper,this.getLabelId()):this.eWrapper.removeAttribute("aria-labelledby"),super.refreshLabel()}setAriaLabel(e){return setAriaLabel(this.eWrapper,e),this}setInputWidth(e){return setElementWidth(this.eWrapper,e),this}getFocusableElement(){return this.eWrapper}}__decorate$2l([RefSelector("eLabel")],AgPickerField.prototype,"eLabel",void 0);__decorate$2l([RefSelector("eWrapper")],AgPickerField.prototype,"eWrapper",void 0);__decorate$2l([RefSelector("eDisplayField")],AgPickerField.prototype,"eDisplayField",void 0);__decorate$2l([RefSelector("eIcon")],AgPickerField.prototype,"eIcon",void 0);var __decorate$2k=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class AgList extends Component{constructor(e="default"){super(`<div class="ag-list ag-${e}-list" role="listbox"></div>`),this.cssIdentifier=e,this.options=[],this.itemEls=[]}init(){this.addManagedListener(this.getGui(),"keydown",this.handleKeyDown.bind(this))}handleKeyDown(e){const t=e.key;switch(t){case KeyCode.ENTER:if(!this.highlightedEl)this.setValue(this.getValue());else{const a=this.itemEls.indexOf(this.highlightedEl);this.setValueByIndex(a)}break;case KeyCode.DOWN:case KeyCode.UP:const n=t===KeyCode.DOWN;let o;if(e.preventDefault(),!this.highlightedEl)o=this.itemEls[n?0:this.itemEls.length-1];else{let l=this.itemEls.indexOf(this.highlightedEl)+(n?1:-1);l=Math.min(Math.max(l,0),this.itemEls.length-1),o=this.itemEls[l]}this.highlightItem(o);break}}addOptions(e){return e.forEach(t=>this.addOption(t)),this}addOption(e){const{value:t,text:n}=e,o=escapeString(n||t);return this.options.push({value:t,text:o}),this.renderOption(t,o),this.updateIndices(),this}updateIndices(){const e=this.getGui().querySelectorAll(".ag-list-item");e.forEach((t,n)=>{setAriaPosInSet(t,n+1),setAriaSetSize(t,e.length)})}renderOption(e,t){const n=document.createElement("div");setAriaRole(n,"option"),n.classList.add("ag-list-item",`ag-${this.cssIdentifier}-list-item`),n.innerHTML=`<span>${t}</span>`,n.tabIndex=-1,this.itemEls.push(n),this.addManagedListener(n,"mouseover",()=>this.highlightItem(n)),this.addManagedListener(n,"mouseleave",()=>this.clearHighlighted()),this.addManagedListener(n,"click",()=>this.setValue(e)),this.getGui().appendChild(n)}setValue(e,t){if(this.value===e)return this.fireItemSelected(),this;if(e==null)return this.reset(),this;const n=this.options.findIndex(o=>o.value===e);if(n!==-1){const o=this.options[n];this.value=o.value,this.displayValue=o.text!=null?o.text:o.value,this.highlightItem(this.itemEls[n]),t||this.fireChangeEvent()}return this}setValueByIndex(e){return this.setValue(this.options[e].value)}getValue(){return this.value}getDisplayValue(){return this.displayValue}refreshHighlighted(){this.clearHighlighted();const e=this.options.findIndex(t=>t.value===this.value);e!==-1&&this.highlightItem(this.itemEls[e])}reset(){this.value=null,this.displayValue=null,this.clearHighlighted(),this.fireChangeEvent()}highlightItem(e){e.offsetParent&&(this.clearHighlighted(),this.highlightedEl=e,this.highlightedEl.classList.add(AgList.ACTIVE_CLASS),setAriaSelected(this.highlightedEl,!0),this.highlightedEl.focus())}clearHighlighted(){!this.highlightedEl||!this.highlightedEl.offsetParent||(this.highlightedEl.classList.remove(AgList.ACTIVE_CLASS),setAriaSelected(this.highlightedEl,!1),this.highlightedEl=null)}fireChangeEvent(){this.dispatchEvent({type:AgAbstractField.EVENT_CHANGED}),this.fireItemSelected()}fireItemSelected(){this.dispatchEvent({type:AgList.EVENT_ITEM_SELECTED})}}AgList.EVENT_ITEM_SELECTED="selectedItem";AgList.ACTIVE_CLASS="ag-active-item";__decorate$2k([PostConstruct],AgList.prototype,"init",null);var __decorate$2j=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class AgSelect extends AgPickerField{constructor(e){super(e,"ag-select","smallDown","listbox")}init(){this.listComponent=this.createBean(new AgList("select")),this.listComponent.setParentComponent(this),this.eWrapper.tabIndex=0,this.listComponent.addManagedListener(this.listComponent,AgList.EVENT_ITEM_SELECTED,()=>{this.hideList&&this.hideList(),this.dispatchEvent({type:AgSelect.EVENT_ITEM_SELECTED})}),this.listComponent.addManagedListener(this.listComponent,AgAbstractField.EVENT_CHANGED,()=>{this.setValue(this.listComponent.getValue(),!1,!0),this.hideList&&this.hideList()})}showPicker(){const e=this.listComponent.getGui(),t=this.gridOptionsService.getDocument(),n=this.addManagedListener(t.body,"wheel",s=>{!e.contains(s.target)&&this.hideList&&this.hideList()}),o=this.addManagedListener(e,"focusout",s=>{!e.contains(s.relatedTarget)&&this.hideList&&this.hideList()}),a=this.localeService.getLocaleTextFunc(),l=this.popupService.addPopup({modal:!0,eChild:e,closeOnEsc:!0,closedCallback:()=>{this.hideList=null,this.isPickerDisplayed=!1,o(),n(),this.isAlive()&&(setAriaExpanded(this.eWrapper,!1),this.getFocusableElement().focus())},ariaLabel:a("ariaLabelSelectField","Select Field")});return l&&(this.hideList=l.hideFunc),this.isPickerDisplayed=!0,setElementWidth(e,getAbsoluteWidth(this.eWrapper)),setAriaExpanded(this.eWrapper,!0),e.style.maxHeight=getInnerHeight(this.popupService.getPopupParent())+"px",e.style.position="absolute",this.popupService.positionPopupByComponent({type:"ag-list",eventSource:this.eWrapper,ePopup:e,position:"under",keepWithinBounds:!0}),this.listComponent.refreshHighlighted(),this.listComponent}addOptions(e){return e.forEach(t=>this.addOption(t)),this}addOption(e){return this.listComponent.addOption(e),this}setValue(e,t,n){return this.value===e?this:(n||this.listComponent.setValue(e,!0),this.listComponent.getValue()===this.getValue()?this:(this.eDisplayField.innerHTML=this.listComponent.getDisplayValue(),super.setValue(e,t)))}destroy(){this.hideList&&this.hideList(),this.destroyBean(this.listComponent),super.destroy()}}AgSelect.EVENT_ITEM_SELECTED="selectedItem";__decorate$2j([Autowired("popupService")],AgSelect.prototype,"popupService",void 0);__decorate$2j([PostConstruct],AgSelect.prototype,"init",null);var __decorate$2i=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class AgAbstractInputField extends AgAbstractField{constructor(e,t,n="text",o="input"){super(e,`
            <div role="presentation">
                <div ref="eLabel" class="ag-input-field-label"></div>
                <div ref="eWrapper" class="ag-wrapper ag-input-wrapper" role="presentation">
                    <${o} ref="eInput" class="ag-input-field-input"></${o}>
                </div>
            </div>`,t),this.inputType=n,this.displayFieldTag=o}postConstruct(){super.postConstruct(),this.setInputType(),this.eLabel.classList.add(`${this.className}-label`),this.eWrapper.classList.add(`${this.className}-input-wrapper`),this.eInput.classList.add(`${this.className}-input`),this.addCssClass("ag-input-field"),this.eInput.id=this.eInput.id||`ag-${this.getCompId()}-input`;const{width:e,value:t}=this.config;e!=null&&this.setWidth(e),t!=null&&this.setValue(t),this.addInputListeners(),this.activateTabIndex([this.eInput])}refreshLabel(){exists(this.getLabel())?setAriaLabelledBy(this.eInput,this.getLabelId()):this.eInput.removeAttribute("aria-labelledby"),super.refreshLabel()}addInputListeners(){this.addManagedListener(this.eInput,"input",e=>this.setValue(e.target.value))}setInputType(){this.displayFieldTag==="input"&&this.eInput.setAttribute("type",this.inputType)}getInputElement(){return this.eInput}setInputWidth(e){return setElementWidth(this.eWrapper,e),this}setInputName(e){return this.getInputElement().setAttribute("name",e),this}getFocusableElement(){return this.eInput}setMaxLength(e){const t=this.eInput;return t.maxLength=e,this}setInputPlaceholder(e){return addOrRemoveAttribute(this.eInput,"placeholder",e),this}setInputAriaLabel(e){return setAriaLabel(this.eInput,e),this}setDisabled(e){return setDisabled(this.eInput,e),super.setDisabled(e)}}__decorate$2i([RefSelector("eLabel")],AgAbstractInputField.prototype,"eLabel",void 0);__decorate$2i([RefSelector("eWrapper")],AgAbstractInputField.prototype,"eWrapper",void 0);__decorate$2i([RefSelector("eInput")],AgAbstractInputField.prototype,"eInput",void 0);class AgCheckbox extends AgAbstractInputField{constructor(e,t="ag-checkbox",n="checkbox"){super(e,t,n),this.labelAlignment="right",this.selected=!1,this.readOnly=!1,this.passive=!1}addInputListeners(){this.addManagedListener(this.eInput,"click",this.onCheckboxClick.bind(this)),this.addManagedListener(this.eLabel,"click",this.toggle.bind(this))}getNextValue(){return this.selected===void 0?!0:!this.selected}setPassive(e){this.passive=e}isReadOnly(){return this.readOnly}setReadOnly(e){this.eWrapper.classList.toggle("ag-disabled",e),this.eInput.disabled=e,this.readOnly=e}setDisabled(e){return this.eWrapper.classList.toggle("ag-disabled",e),super.setDisabled(e)}toggle(){if(this.eInput.disabled)return;const e=this.isSelected(),t=this.getNextValue();this.passive?this.dispatchChange(t,e):this.setValue(t)}getValue(){return this.isSelected()}setValue(e,t){return this.refreshSelectedClass(e),this.setSelected(e,t),this}setName(e){const t=this.getInputElement();return t.name=e,this}isSelected(){return this.selected}setSelected(e,t){this.isSelected()!==e&&(this.previousValue=this.isSelected(),e=this.selected=typeof e=="boolean"?e:void 0,this.eInput.checked=e,this.eInput.indeterminate=e===void 0,t||this.dispatchChange(this.selected,this.previousValue))}dispatchChange(e,t,n){this.dispatchEvent({type:AgCheckbox.EVENT_CHANGED,selected:e,previousValue:t,event:n});const o=this.getInputElement(),a={type:Events.EVENT_CHECKBOX_CHANGED,id:o.id,name:o.name,selected:e,previousValue:t};this.eventService.dispatchEvent(a)}onCheckboxClick(e){if(this.passive||this.eInput.disabled)return;const t=this.isSelected(),n=this.selected=e.target.checked;this.refreshSelectedClass(n),this.dispatchChange(n,t,e)}refreshSelectedClass(e){this.eWrapper.classList.toggle("ag-checked",e===!0),this.eWrapper.classList.toggle("ag-indeterminate",e==null)}}class AgRadioButton extends AgCheckbox{constructor(e){super(e,"ag-radio-button","radio")}isSelected(){return this.eInput.checked}toggle(){this.eInput.disabled||this.isSelected()||this.setValue(!0)}addInputListeners(){super.addInputListeners(),this.addManagedListener(this.eventService,Events.EVENT_CHECKBOX_CHANGED,this.onChange.bind(this))}onChange(e){e.selected&&e.name&&this.eInput.name&&this.eInput.name===e.name&&e.id&&this.eInput.id!==e.id&&this.setValue(!1,!0)}}class SimpleFilterModelFormatter{constructor(e,t){this.localeService=e,this.optionsFactory=t}getModelAsString(e){if(!e)return null;const t=e.operator!=null,n=this.localeService.getLocaleTextFunc();if(t){const o=e;let{conditions:a}=o;if(!a){const{condition1:m,condition2:y}=o;a=[m,y]}const l=a.map(m=>this.getModelAsString(m)),s=o.operator==="AND"?"andCondition":"orCondition";return l.join(` ${n(s,DEFAULT_FILTER_LOCALE_TEXT[s])} `)}else{if(e.type===SimpleFilter.BLANK||e.type===SimpleFilter.NOT_BLANK)return n(e.type,e.type);{const o=e,a=this.optionsFactory.getCustomOption(o.type),{displayKey:l,displayName:s,numberOfInputs:m}=a||{};return l&&s&&m===0?(n(l,s),s):this.conditionToString(o,a)}}}}class SimpleFilter extends ProvidedFilter{constructor(){super(...arguments),this.eTypes=[],this.eJoinOperatorPanels=[],this.eJoinOperatorsAnd=[],this.eJoinOperatorsOr=[],this.eConditionBodies=[],this.listener=()=>this.onUiChanged(),this.lastUiCompletePosition=null,this.joinOperatorId=0}getNumberOfInputs(e){const t=this.optionsFactory.getCustomOption(e);if(t){const{numberOfInputs:o}=t;return o??1}const n=[SimpleFilter.EMPTY,SimpleFilter.NOT_BLANK,SimpleFilter.BLANK];return e&&n.indexOf(e)>=0?0:e===SimpleFilter.IN_RANGE?2:1}onFloatingFilterChanged(e,t){this.setTypeFromFloatingFilter(e),this.setValueFromFloatingFilter(t),this.onUiChanged(!0)}setTypeFromFloatingFilter(e){this.eTypes.forEach((t,n)=>{n===0?t.setValue(e,!0):t.setValue(this.optionsFactory.getDefaultOption(),!0)})}getModelFromUi(){const e=this.getUiCompleteConditions();return e.length===0?null:this.maxNumConditions>1&&e.length>1?{filterType:this.getFilterType(),operator:this.getJoinOperator(),condition1:e[0],condition2:e[1],conditions:e}:e[0]}getConditionTypes(){return this.eTypes.map(e=>e.getValue())}getConditionType(e){return this.eTypes[e].getValue()}getJoinOperator(){return this.eJoinOperatorsOr.length===0?this.defaultJoinOperator:this.eJoinOperatorsOr[0].getValue()===!0?"OR":"AND"}areModelsEqual(e,t){if(!e&&!t)return!0;if(!e&&t||e&&!t)return!1;const n=!e.operator,o=!t.operator;if(!n&&o||n&&!o)return!1;let l;if(n){const s=e,m=t;l=this.areSimpleModelsEqual(s,m)}else{const s=e,m=t;l=s.operator===m.operator&&areEqual(s.conditions,m.conditions,(y,D)=>this.areSimpleModelsEqual(y,D))}return l}setModelIntoUi(e){if(e.operator){let n=e;n.conditions||(n.conditions=[n.condition1,n.condition2]);const o=this.validateAndUpdateConditions(n.conditions),a=this.getNumConditions();if(o<a)this.removeConditionsAndOperators(o);else if(o>a)for(let s=a;s<o;s++)this.createJoinOperatorPanel(),this.createOption();const l=n.operator==="OR";this.eJoinOperatorsAnd.forEach(s=>s.setValue(!l,!0)),this.eJoinOperatorsOr.forEach(s=>s.setValue(l,!0)),n.conditions.forEach((s,m)=>{this.eTypes[m].setValue(s.type,!0),this.setConditionIntoUi(s,m)})}else{const n=e;this.getNumConditions()>1&&this.removeConditionsAndOperators(1),this.eTypes[0].setValue(n.type,!0),this.setConditionIntoUi(n,0)}return this.lastUiCompletePosition=this.getNumConditions()-1,this.createMissingConditionsAndOperators(),this.onUiChanged(),AgPromise.resolve()}validateAndUpdateConditions(e){let t=e.length;return t>this.maxNumConditions&&(e.splice(this.maxNumConditions),doOnce(()=>console.warn('AG Grid: Filter Model contains more conditions than "filterParams.maxNumConditions". Additional conditions have been ignored.'),"simpleFilterSetModelMaxNumConditions"),t=this.maxNumConditions),t}doesFilterPass(e){var t;const n=this.getModel();if(n==null)return!0;const{operator:o}=n,a=[];if(o){const s=n;a.push(...(t=s.conditions)!==null&&t!==void 0?t:[])}else a.push(n);return a[o&&o==="OR"?"some":"every"](s=>this.individualConditionPasses(e,s))}setParams(e){super.setParams(e),this.setNumConditions(e),this.defaultJoinOperator=this.getDefaultJoinOperator(e.defaultJoinOperator),this.filterPlaceholder=e.filterPlaceholder,this.optionsFactory=new OptionsFactory,this.optionsFactory.init(e,this.getDefaultFilterOptions()),this.createFilterListOptions(),this.createOption(),this.createMissingConditionsAndOperators()}setNumConditions(e){var t,n;e.suppressAndOrCondition!=null&&doOnce(()=>console.warn('AG Grid: Since v29.2 "filterParams.suppressAndOrCondition" is deprecated. Use "filterParams.maxNumConditions = 1" instead.'),"simpleFilterSuppressAndOrCondition"),e.alwaysShowBothConditions!=null&&doOnce(()=>console.warn('AG Grid: Since v29.2 "filterParams.alwaysShowBothConditions" is deprecated. Use "filterParams.numAlwaysVisibleConditions = 2" instead.'),"simpleFilterAlwaysShowBothConditions"),this.maxNumConditions=(t=e.maxNumConditions)!==null&&t!==void 0?t:e.suppressAndOrCondition?1:2,this.maxNumConditions<1&&(doOnce(()=>console.warn('AG Grid: "filterParams.maxNumConditions" must be greater than or equal to zero.'),"simpleFilterMaxNumConditions"),this.maxNumConditions=1),this.numAlwaysVisibleConditions=(n=e.numAlwaysVisibleConditions)!==null&&n!==void 0?n:e.alwaysShowBothConditions?2:1,this.numAlwaysVisibleConditions<1&&(doOnce(()=>console.warn('AG Grid: "filterParams.numAlwaysVisibleConditions" must be greater than or equal to zero.'),"simpleFilterNumAlwaysVisibleConditions"),this.numAlwaysVisibleConditions=1),this.numAlwaysVisibleConditions>this.maxNumConditions&&(doOnce(()=>console.warn('AG Grid: "filterParams.numAlwaysVisibleConditions" cannot be greater than "filterParams.maxNumConditions".'),"simpleFilterNumAlwaysVisibleGreaterThanMaxNumConditions"),this.numAlwaysVisibleConditions=this.maxNumConditions)}createOption(){const e=this.createManagedBean(new AgSelect);this.eTypes.push(e),e.addCssClass("ag-filter-select"),this.eFilterBody.appendChild(e.getGui());const t=this.createValueElement();this.eConditionBodies.push(t),this.eFilterBody.appendChild(t),this.putOptionsIntoDropdown(e),this.resetType(e);const n=this.getNumConditions()-1;this.forEachPositionInput(n,o=>this.resetInput(o)),this.addChangedListeners(e,n)}createJoinOperatorPanel(){const e=document.createElement("div");this.eJoinOperatorPanels.push(e),e.classList.add("ag-filter-condition");const t=this.createJoinOperator(this.eJoinOperatorsAnd,e,"and"),n=this.createJoinOperator(this.eJoinOperatorsOr,e,"or");this.eFilterBody.appendChild(e);const o=this.eJoinOperatorPanels.length-1,a=this.joinOperatorId++;this.resetJoinOperatorAnd(t,o,a),this.resetJoinOperatorOr(n,o,a),this.isReadOnly()||(t.onValueChange(this.listener),n.onValueChange(this.listener))}createJoinOperator(e,t,n){const o=this.createManagedBean(new AgRadioButton);return e.push(o),o.addCssClass("ag-filter-condition-operator"),o.addCssClass(`ag-filter-condition-operator-${n}`),t.appendChild(o.getGui()),o}getDefaultJoinOperator(e){return e==="AND"||e==="OR"?e:"AND"}createFilterListOptions(){const e=this.optionsFactory.getFilterOptions();this.filterListOptions=e.map(t=>typeof t=="string"?this.createBoilerplateListOption(t):this.createCustomListOption(t))}putOptionsIntoDropdown(e){this.filterListOptions.forEach(t=>{e.addOption(t)}),e.setDisabled(this.filterListOptions.length<=1)}createBoilerplateListOption(e){return{value:e,text:this.translate(e)}}createCustomListOption(e){const{displayKey:t}=e,n=this.optionsFactory.getCustomOption(e.displayKey);return{value:t,text:n?this.localeService.getLocaleTextFunc()(n.displayKey,n.displayName):this.translate(t)}}isAllowTwoConditions(){return this.maxNumConditions>=2}createBodyTemplate(){return""}getCssIdentifier(){return"simple-filter"}updateUiVisibility(){const e=this.getJoinOperator();this.updateNumConditions(),this.updateConditionStatusesAndValues(this.lastUiCompletePosition,e)}updateNumConditions(){var e;let t=-1,n=!0;for(let o=0;o<this.getNumConditions();o++)this.isConditionUiComplete(o)?t=o:n=!1;if(this.shouldAddNewConditionAtEnd(n))this.createJoinOperatorPanel(),this.createOption();else{const o=(e=this.lastUiCompletePosition)!==null&&e!==void 0?e:this.getNumConditions()-2;if(t<o){this.removeConditionsAndOperators(o+1);const a=t+1,l=o-a;l>0&&this.removeConditionsAndOperators(a,l),this.createMissingConditionsAndOperators()}}this.lastUiCompletePosition=t}updateConditionStatusesAndValues(e,t){this.eTypes.forEach((o,a)=>{const l=this.isConditionDisabled(a,e);o.setDisabled(l||this.filterListOptions.length<=1),a===1&&(setDisabled(this.eJoinOperatorPanels[0],l),this.eJoinOperatorsAnd[0].setDisabled(l),this.eJoinOperatorsOr[0].setDisabled(l))}),this.eConditionBodies.forEach((o,a)=>{setDisplayed(o,this.isConditionBodyVisible(a))});const n=(t??this.getJoinOperator())==="OR";this.eJoinOperatorsAnd.forEach((o,a)=>{o.setValue(!n,!0)}),this.eJoinOperatorsOr.forEach((o,a)=>{o.setValue(n,!0)}),this.forEachInput((o,a,l,s)=>{this.setElementDisplayed(o,a<s),this.setElementDisabled(o,this.isConditionDisabled(l,e))}),this.resetPlaceholder()}shouldAddNewConditionAtEnd(e){return e&&this.getNumConditions()<this.maxNumConditions&&!this.isReadOnly()}removeConditionsAndOperators(e,t){if(e>=this.getNumConditions())return;this.removeComponents(this.eTypes,e,t),this.removeElements(this.eConditionBodies,e,t),this.removeValueElements(e,t);const n=Math.max(e-1,0);this.removeElements(this.eJoinOperatorPanels,n,t),this.removeComponents(this.eJoinOperatorsAnd,n,t),this.removeComponents(this.eJoinOperatorsOr,n,t)}removeElements(e,t,n){this.removeItems(e,t,n).forEach(a=>removeFromParent(a))}removeComponents(e,t,n){this.removeItems(e,t,n).forEach(a=>{removeFromParent(a.getGui()),this.destroyBean(a)})}removeItems(e,t,n){return n==null?e.splice(t):e.splice(t,n)}afterGuiAttached(e){if(super.afterGuiAttached(e),this.resetPlaceholder(),!e||!e.suppressFocus&&!this.isReadOnly()){const t=this.getInputs(0)[0];if(!t)return;t instanceof AgAbstractInputField&&t.getInputElement().focus()}}afterGuiDetached(){super.afterGuiDetached();const e=this.getModel();(!this.areModelsEqual(e,this.getModelFromUi())||this.hasInvalidInputs())&&this.resetUiToActiveModel(e);let t=-1,n=-1,o=!1;const a=this.getJoinOperator();for(let s=this.getNumConditions()-1;s>=0;s--)if(this.isConditionUiComplete(s))t===-1&&(t=s,n=s);else{const m=s>=this.numAlwaysVisibleConditions&&!this.isConditionUiComplete(s-1),y=s<t;(m||y)&&(this.removeConditionsAndOperators(s,1),o=!0,y&&n--)}let l=!1;this.getNumConditions()<this.numAlwaysVisibleConditions&&(this.createMissingConditionsAndOperators(),l=!0),this.shouldAddNewConditionAtEnd(n===this.getNumConditions()-1)&&(this.createJoinOperatorPanel(),this.createOption(),l=!0),l&&this.updateConditionStatusesAndValues(n,a),o&&this.updateJoinOperatorsDisabled(),this.lastUiCompletePosition=n}getPlaceholderText(e,t){let n=this.translate(e);if(isFunction(this.filterPlaceholder)){const o=this.filterPlaceholder,a=this.eTypes[t].getValue(),l=this.translate(a);n=o({filterOptionKey:a,filterOption:l,placeholder:n})}else typeof this.filterPlaceholder=="string"&&(n=this.filterPlaceholder);return n}resetPlaceholder(){const e=this.localeService.getLocaleTextFunc();this.forEachInput((t,n,o,a)=>{if(!(t instanceof AgAbstractInputField))return;const l=n===0&&a>1?"inRangeStart":n===0?"filterOoo":"inRangeEnd",s=n===0&&a>1?e("ariaFilterFromValue","Filter from value"):n===0?e("ariaFilterValue","Filter Value"):e("ariaFilterToValue","Filter to Value");t.setInputPlaceholder(this.getPlaceholderText(l,o)),t.setInputAriaLabel(s)})}setElementValue(e,t){e instanceof AgAbstractInputField&&e.setValue(t!=null?String(t):null,!0)}setElementDisplayed(e,t){e instanceof Component&&setDisplayed(e.getGui(),t)}setElementDisabled(e,t){e instanceof Component&&setDisabled(e.getGui(),t)}attachElementOnChange(e,t){e instanceof AgAbstractInputField&&e.onValueChange(t)}forEachInput(e){this.getConditionTypes().forEach((t,n)=>{this.forEachPositionTypeInput(n,t,e)})}forEachPositionInput(e,t){const n=this.getConditionType(e);this.forEachPositionTypeInput(e,n,t)}forEachPositionTypeInput(e,t,n){const o=this.getNumberOfInputs(t),a=this.getInputs(e);for(let l=0;l<a.length;l++){const s=a[l];s!=null&&n(s,l,e,o)}}isConditionDisabled(e,t){return this.isReadOnly()?!0:e===0?!1:e>t+1}isConditionBodyVisible(e){const t=this.getConditionType(e);return this.getNumberOfInputs(t)>0}isConditionUiComplete(e){return!(e>=this.getNumConditions()||this.getConditionType(e)===SimpleFilter.EMPTY||this.getValues(e).some(n=>n==null))}getNumConditions(){return this.eTypes.length}getUiCompleteConditions(){const e=[];for(let t=0;t<this.getNumConditions();t++)this.isConditionUiComplete(t)&&e.push(this.createCondition(t));return e}createMissingConditionsAndOperators(){if(!this.isReadOnly())for(let e=this.getNumConditions();e<this.numAlwaysVisibleConditions;e++)this.createJoinOperatorPanel(),this.createOption()}resetUiToDefaults(e){return this.removeConditionsAndOperators(this.isReadOnly()?1:this.numAlwaysVisibleConditions),this.eTypes.forEach(t=>this.resetType(t)),this.eJoinOperatorsAnd.forEach((t,n)=>this.resetJoinOperatorAnd(t,n,this.joinOperatorId+n)),this.eJoinOperatorsOr.forEach((t,n)=>this.resetJoinOperatorOr(t,n,this.joinOperatorId+n)),this.joinOperatorId++,this.forEachInput(t=>this.resetInput(t)),this.resetPlaceholder(),this.createMissingConditionsAndOperators(),this.lastUiCompletePosition=null,e||this.onUiChanged(),AgPromise.resolve()}resetType(e){const n=this.localeService.getLocaleTextFunc()("ariaFilteringOperator","Filtering operator");e.setValue(this.optionsFactory.getDefaultOption(),!0).setAriaLabel(n).setDisabled(this.isReadOnly()||this.filterListOptions.length<=1)}resetJoinOperatorAnd(e,t,n){this.resetJoinOperator(e,t,this.isDefaultOperator("AND"),this.translate("andCondition"),n)}resetJoinOperatorOr(e,t,n){this.resetJoinOperator(e,t,this.isDefaultOperator("OR"),this.translate("orCondition"),n)}resetJoinOperator(e,t,n,o,a){this.updateJoinOperatorDisabled(e.setValue(n,!0).setName(`ag-simple-filter-and-or-${this.getCompId()}-${a}`).setLabel(o),t)}updateJoinOperatorsDisabled(){this.eJoinOperatorsAnd.forEach((e,t)=>this.updateJoinOperatorDisabled(e,t)),this.eJoinOperatorsOr.forEach((e,t)=>this.updateJoinOperatorDisabled(e,t))}updateJoinOperatorDisabled(e,t){e.setDisabled(this.isReadOnly()||t>0)}resetInput(e){this.setElementValue(e,null),this.setElementDisabled(e,this.isReadOnly())}setConditionIntoUi(e,t){const n=this.mapValuesFromModel(e);this.forEachInput((o,a,l,s)=>{l===t&&this.setElementValue(o,n[a]!=null?n[a]:null)})}setValueFromFloatingFilter(e){this.forEachInput((t,n,o,a)=>{this.setElementValue(t,n===0&&o===0?e:null)})}isDefaultOperator(e){return e===this.defaultJoinOperator}addChangedListeners(e,t){this.isReadOnly()||(e.onValueChange(this.listener),this.forEachPositionInput(t,n=>{this.attachElementOnChange(n,this.listener)}))}individualConditionPasses(e,t){const n=this.getCellValue(e.node),o=this.mapValuesFromModel(t),a=this.optionsFactory.getCustomOption(t.type),l=this.evaluateCustomFilter(a,o,n);return l??(n==null?this.evaluateNullValue(t.type):this.evaluateNonNullValue(o,n,t,e))}evaluateCustomFilter(e,t,n){if(e==null)return;const{predicate:o}=e;if(o!=null&&!t.some(a=>a==null))return o(t,n)}isBlank(e){return e==null||typeof e=="string"&&e.trim().length===0}hasInvalidInputs(){return!1}}SimpleFilter.EMPTY="empty";SimpleFilter.BLANK="blank";SimpleFilter.NOT_BLANK="notBlank";SimpleFilter.EQUALS="equals";SimpleFilter.NOT_EQUAL="notEqual";SimpleFilter.LESS_THAN="lessThan";SimpleFilter.LESS_THAN_OR_EQUAL="lessThanOrEqual";SimpleFilter.GREATER_THAN="greaterThan";SimpleFilter.GREATER_THAN_OR_EQUAL="greaterThanOrEqual";SimpleFilter.IN_RANGE="inRange";SimpleFilter.CONTAINS="contains";SimpleFilter.NOT_CONTAINS="notContains";SimpleFilter.STARTS_WITH="startsWith";SimpleFilter.ENDS_WITH="endsWith";class ScalarFilter extends SimpleFilter{setParams(e){super.setParams(e),this.scalarFilterParams=e}evaluateNullValue(e){switch(e){case ScalarFilter.EQUALS:case ScalarFilter.NOT_EQUAL:if(this.scalarFilterParams.includeBlanksInEquals)return!0;break;case ScalarFilter.GREATER_THAN:case ScalarFilter.GREATER_THAN_OR_EQUAL:if(this.scalarFilterParams.includeBlanksInGreaterThan)return!0;break;case ScalarFilter.LESS_THAN:case ScalarFilter.LESS_THAN_OR_EQUAL:if(this.scalarFilterParams.includeBlanksInLessThan)return!0;break;case ScalarFilter.IN_RANGE:if(this.scalarFilterParams.includeBlanksInRange)return!0;break;case ScalarFilter.BLANK:return!0;case ScalarFilter.NOT_BLANK:return!1}return!1}evaluateNonNullValue(e,t,n){const o=this.comparator(),a=e[0]!=null?o(e[0],t):0;switch(n.type){case ScalarFilter.EQUALS:return a===0;case ScalarFilter.NOT_EQUAL:return a!==0;case ScalarFilter.GREATER_THAN:return a>0;case ScalarFilter.GREATER_THAN_OR_EQUAL:return a>=0;case ScalarFilter.LESS_THAN:return a<0;case ScalarFilter.LESS_THAN_OR_EQUAL:return a<=0;case ScalarFilter.IN_RANGE:{const l=o(e[1],t);return this.scalarFilterParams.inRangeInclusive?a>=0&&l<=0:a>0&&l<0}case ScalarFilter.BLANK:return this.isBlank(t);case ScalarFilter.NOT_BLANK:return!this.isBlank(t);default:return console.warn('AG Grid: Unexpected type of filter "'+n.type+'", it looks like the filter was configured with incorrect Filter Options'),!0}}}var __decorate$2h=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const DEFAULT_MIN_YEAR=1e3,DEFAULT_MAX_YEAR=1/0;class DateFilterModelFormatter extends SimpleFilterModelFormatter{constructor(e,t,n){super(t,n),this.dateFilterParams=e}conditionToString(e,t){const{type:n}=e,{numberOfInputs:o}=t||{},a=n==SimpleFilter.IN_RANGE||o===2,l=parseDateTimeFromString(e.dateFrom),s=parseDateTimeFromString(e.dateTo),m=this.dateFilterParams.inRangeFloatingFilterDateFormat;if(a){const y=l!==null?dateToFormattedString(l,m):"null",D=s!==null?dateToFormattedString(s,m):"null";return`${y}-${D}`}return l!=null?dateToFormattedString(l,m):`${n}`}}class DateFilter extends ScalarFilter{constructor(){super("dateFilter"),this.eConditionPanelsFrom=[],this.eConditionPanelsTo=[],this.dateConditionFromComps=[],this.dateConditionToComps=[],this.minValidYear=DEFAULT_MIN_YEAR,this.maxValidYear=DEFAULT_MAX_YEAR}afterGuiAttached(e){super.afterGuiAttached(e),this.dateConditionFromComps[0].afterGuiAttached(e)}mapValuesFromModel(e){const{dateFrom:t,dateTo:n,type:o}=e||{};return[t&&parseDateTimeFromString(t)||null,n&&parseDateTimeFromString(n)||null].slice(0,this.getNumberOfInputs(o))}comparator(){return this.dateFilterParams.comparator?this.dateFilterParams.comparator:this.defaultComparator.bind(this)}defaultComparator(e,t){const n=t;return t==null||n<e?-1:n>e?1:0}setParams(e){this.dateFilterParams=e,super.setParams(e);const t=(n,o)=>{if(e[n]!=null)if(isNaN(e[n]))console.warn(`AG Grid: DateFilter ${n} is not a number`);else return e[n]==null?o:Number(e[n]);return o};this.minValidYear=t("minValidYear",DEFAULT_MIN_YEAR),this.maxValidYear=t("maxValidYear",DEFAULT_MAX_YEAR),this.minValidYear>this.maxValidYear&&console.warn("AG Grid: DateFilter minValidYear should be <= maxValidYear"),this.filterModelFormatter=new DateFilterModelFormatter(this.dateFilterParams,this.localeService,this.optionsFactory)}createDateCompWrapper(e){const t=new DateCompWrapper(this.getContext(),this.userComponentFactory,{onDateChanged:()=>this.onUiChanged(),filterParams:this.dateFilterParams},e);return this.addDestroyFunc(()=>t.destroy()),t}setElementValue(e,t){e.setDate(t)}setElementDisplayed(e,t){e.setDisplayed(t)}setElementDisabled(e,t){e.setDisabled(t)}getDefaultFilterOptions(){return DateFilter.DEFAULT_FILTER_OPTIONS}createValueElement(){const e=document.createElement("div");return e.classList.add("ag-filter-body"),this.createFromToElement(e,this.eConditionPanelsFrom,this.dateConditionFromComps,"from"),this.createFromToElement(e,this.eConditionPanelsTo,this.dateConditionToComps,"to"),e}createFromToElement(e,t,n,o){const a=document.createElement("div");a.classList.add(`ag-filter-${o}`),a.classList.add(`ag-filter-date-${o}`),t.push(a),e.appendChild(a),n.push(this.createDateCompWrapper(a))}removeValueElements(e,t){this.removeDateComps(this.dateConditionFromComps,e,t),this.removeDateComps(this.dateConditionToComps,e,t),this.removeItems(this.eConditionPanelsFrom,e,t),this.removeItems(this.eConditionPanelsTo,e,t)}removeDateComps(e,t,n){this.removeItems(e,t,n).forEach(a=>a.destroy())}isConditionUiComplete(e){if(!super.isConditionUiComplete(e))return!1;const t=o=>o!=null&&o.getUTCFullYear()>=this.minValidYear&&o.getUTCFullYear()<=this.maxValidYear;let n=!0;return this.forEachInput((o,a,l,s)=>{l!==e||!n||a>=s||(n=n&&t(o.getDate()))}),n}areSimpleModelsEqual(e,t){return e.dateFrom===t.dateFrom&&e.dateTo===t.dateTo&&e.type===t.type}getFilterType(){return"date"}createCondition(e){const t=this.getConditionType(e),n={},o=this.getValues(e);return o.length>0&&(n.dateFrom=serialiseDate(o[0])),o.length>1&&(n.dateTo=serialiseDate(o[1])),Object.assign({dateFrom:null,dateTo:null,filterType:this.getFilterType(),type:t},n)}resetPlaceholder(){const e=this.localeService.getLocaleTextFunc(),t=this.translate("dateFormatOoo"),n=e("ariaFilterValue","Filter Value");this.forEachInput(o=>{o.setInputPlaceholder(t),o.setInputAriaLabel(n)})}getInputs(e){return e>=this.dateConditionFromComps.length?[null,null]:[this.dateConditionFromComps[e],this.dateConditionToComps[e]]}getValues(e){const t=[];return this.forEachPositionInput(e,(n,o,a,l)=>{o<l&&t.push(n.getDate())}),t}getModelAsString(e){var t;return(t=this.filterModelFormatter.getModelAsString(e))!==null&&t!==void 0?t:""}}DateFilter.DEFAULT_FILTER_OPTIONS=[ScalarFilter.EQUALS,ScalarFilter.GREATER_THAN,ScalarFilter.LESS_THAN,ScalarFilter.NOT_EQUAL,ScalarFilter.IN_RANGE,ScalarFilter.BLANK,ScalarFilter.NOT_BLANK];__decorate$2h([Autowired("userComponentFactory")],DateFilter.prototype,"userComponentFactory",void 0);class SimpleFloatingFilter extends Component{getDefaultDebounceMs(){return 0}destroy(){super.destroy()}isEventFromFloatingFilter(e){return e&&e.afterFloatingFilter}isEventFromDataChange(e){return e==null?void 0:e.afterDataChange}getLastType(){return this.lastType}isReadOnly(){return this.readOnly}setLastTypeFromModel(e){if(!e){this.lastType=this.optionsFactory.getDefaultOption();return}const t=e.operator;let n;t?n=e.conditions[0]:n=e,this.lastType=n.type}canWeEditAfterModelFromParentFilter(e){if(!e)return this.isTypeEditable(this.lastType);if(e.operator)return!1;const n=e;return this.isTypeEditable(n.type)}init(e){this.optionsFactory=new OptionsFactory,this.optionsFactory.init(e.filterParams,this.getDefaultFilterOptions()),this.lastType=this.optionsFactory.getDefaultOption(),this.readOnly=!!e.filterParams.readOnly;const t=this.isTypeEditable(this.lastType);this.setEditable(t)}doesFilterHaveSingleInput(e){const t=this.optionsFactory.getCustomOption(e),{numberOfInputs:n}=t||{};return n==null||n==1}isTypeEditable(e){const t=[SimpleFilter.IN_RANGE,SimpleFilter.EMPTY,SimpleFilter.BLANK,SimpleFilter.NOT_BLANK];return!!e&&!this.isReadOnly()&&this.doesFilterHaveSingleInput(e)&&t.indexOf(e)<0}}var __decorate$2g=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class DateFloatingFilter extends SimpleFloatingFilter{constructor(){super(`
            <div class="ag-floating-filter-input" role="presentation">
                <ag-input-text-field ref="eReadOnlyText"></ag-input-text-field>
                <div ref="eDateWrapper" style="display: flex;"></div>
            </div>`)}getDefaultFilterOptions(){return DateFilter.DEFAULT_FILTER_OPTIONS}init(e){super.init(e),this.params=e,this.filterParams=e.filterParams,this.createDateComponent();const t=this.localeService.getLocaleTextFunc();this.eReadOnlyText.setDisabled(!0).setInputAriaLabel(t("ariaDateFilterInput","Date Filter Input")),this.filterModelFormatter=new DateFilterModelFormatter(this.filterParams,this.localeService,this.optionsFactory)}setEditable(e){setDisplayed(this.eDateWrapper,e),setDisplayed(this.eReadOnlyText.getGui(),!e)}onParentModelChanged(e,t){if(this.isEventFromFloatingFilter(t)||this.isEventFromDataChange(t))return;super.setLastTypeFromModel(e);const n=!this.isReadOnly()&&this.canWeEditAfterModelFromParentFilter(e);if(this.setEditable(n),n){if(e){const o=e;this.dateComp.setDate(parseDateTimeFromString(o.dateFrom))}else this.dateComp.setDate(null);this.eReadOnlyText.setValue("")}else this.eReadOnlyText.setValue(this.filterModelFormatter.getModelAsString(e)),this.dateComp.setDate(null)}onDateChanged(){const e=this.dateComp.getDate(),t=serialiseDate(e);this.params.parentFilterInstance(n=>{if(n){const o=parseDateTimeFromString(t);n.onFloatingFilterChanged(this.getLastType()||null,o)}})}createDateComponent(){const e=ProvidedFilter.getDebounceMs(this.params.filterParams,this.getDefaultDebounceMs()),t={onDateChanged:debounce(this.onDateChanged.bind(this),e),filterParams:this.params.column.getColDef().filterParams};this.dateComp=new DateCompWrapper(this.getContext(),this.userComponentFactory,t,this.eDateWrapper),this.addDestroyFunc(()=>this.dateComp.destroy())}getFilterModelFormatter(){return this.filterModelFormatter}}__decorate$2g([Autowired("userComponentFactory")],DateFloatingFilter.prototype,"userComponentFactory",void 0);__decorate$2g([RefSelector("eReadOnlyText")],DateFloatingFilter.prototype,"eReadOnlyText",void 0);__decorate$2g([RefSelector("eDateWrapper")],DateFloatingFilter.prototype,"eDateWrapper",void 0);var __decorate$2f=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class DefaultDateComponent extends Component{constructor(){super(`
            <div class="ag-filter-filter">
                <ag-input-text-field class="ag-date-filter" ref="eDateInput"></ag-input-text-field>
            </div>`)}destroy(){super.destroy()}init(e){const t=this.gridOptionsService.getDocument(),n=this.eDateInput.getInputElement(),o=this.shouldUseBrowserDatePicker(e);o&&(n.type="date");const a=o&&isBrowserSafari();this.addManagedListener(n,"mousedown",()=>{this.eDateInput.isDisabled()||a||n.focus()}),this.addManagedListener(n,"input",m=>{m.target===t.activeElement&&(this.eDateInput.isDisabled()||e.onDateChanged())});const{minValidYear:l,maxValidYear:s}=e.filterParams||{};l&&(n.min=`${l}-01-01`),s&&(n.max=`${s}-12-31`)}getDate(){return parseDateTimeFromString(this.eDateInput.getValue())}setDate(e){this.eDateInput.setValue(serialiseDate(e,!1))}setInputPlaceholder(e){this.eDateInput.setInputPlaceholder(e)}setDisabled(e){this.eDateInput.setDisabled(e)}afterGuiAttached(e){(!e||!e.suppressFocus)&&this.eDateInput.getInputElement().focus()}shouldUseBrowserDatePicker(e){return e.filterParams&&e.filterParams.browserDatePicker!=null?e.filterParams.browserDatePicker:isBrowserChrome()||isBrowserFirefox()||isBrowserSafari()&&getSafariVersion()>=14.1}}__decorate$2f([RefSelector("eDateInput")],DefaultDateComponent.prototype,"eDateInput",void 0);class AgInputTextField extends AgAbstractInputField{constructor(e,t="ag-text-field",n="text"){super(e,t,n)}postConstruct(){super.postConstruct(),this.config.allowedCharPattern&&this.preventDisallowedCharacters()}setValue(e,t){const n=super.setValue(e,t);return this.eInput.value!==e&&(this.eInput.value=exists(e)?e:""),n}setStartValue(e){this.setValue(e,!0)}preventDisallowedCharacters(){const e=new RegExp(`[${this.config.allowedCharPattern}]`),t=n=>{isEventFromPrintableCharacter(n)&&n.key&&!e.test(n.key)&&n.preventDefault()};this.addManagedListener(this.eInput,"keydown",t),this.addManagedListener(this.eInput,"paste",n=>{var o;const a=(o=n.clipboardData)===null||o===void 0?void 0:o.getData("text");a&&a.split("").some(l=>!e.test(l))&&n.preventDefault()})}}class AgInputNumberField extends AgInputTextField{constructor(e){super(e,"ag-number-field","number")}postConstruct(){super.postConstruct(),this.addManagedListener(this.eInput,"blur",()=>{const e=parseFloat(this.eInput.value),t=isNaN(e)?"":this.normalizeValue(e.toString());this.value!==t&&this.setValue(t)}),this.addManagedListener(this.eInput,"wheel",this.onWheel.bind(this)),this.eInput.step="any"}onWheel(e){document.activeElement===this.eInput&&e.preventDefault()}normalizeValue(e){if(e==="")return"";this.precision!=null&&(e=this.adjustPrecision(e));const t=parseFloat(e);return this.min!=null&&t<this.min?e=this.min.toString():this.max!=null&&t>this.max&&(e=this.max.toString()),e}adjustPrecision(e,t){if(this.precision==null)return e;if(t){const o=parseFloat(e).toFixed(this.precision);return parseFloat(o).toString()}const n=String(e).split(".");if(n.length>1){if(n[1].length<=this.precision)return e;if(this.precision>0)return`${n[0]}.${n[1].slice(0,this.precision)}`}return n[0]}setMin(e){return this.min===e?this:(this.min=e,addOrRemoveAttribute(this.eInput,"min",e),this)}setMax(e){return this.max===e?this:(this.max=e,addOrRemoveAttribute(this.eInput,"max",e),this)}setPrecision(e){return this.precision=e,this}setStep(e){return this.step===e?this:(this.step=e,addOrRemoveAttribute(this.eInput,"step",e),this)}setValue(e,t){return this.setValueOrInputValue(n=>super.setValue(n,t),()=>this,e)}setStartValue(e){return this.setValueOrInputValue(t=>super.setValue(t,!0),t=>{this.eInput.value=t},e)}setValueOrInputValue(e,t,n){if(exists(n)){let o=this.isScientificNotation(n);if(o&&this.eInput.validity.valid)return e(n);if(!o){n=this.adjustPrecision(n);const a=this.normalizeValue(n);o=n!=a}if(o)return t(n)}return e(n)}getValue(){if(!this.eInput.validity.valid)return;const e=this.eInput.value;return this.isScientificNotation(e)?this.adjustPrecision(e,!0):super.getValue()}isScientificNotation(e){return typeof e=="string"&&e.includes("e")}}class NumberFilterModelFormatter extends SimpleFilterModelFormatter{conditionToString(e,t){const{numberOfInputs:n}=t||{};return e.type==SimpleFilter.IN_RANGE||n===2?`${e.filter}-${e.filterTo}`:e.filter!=null?`${e.filter}`:`${e.type}`}}function getAllowedCharPattern(r){const{allowedCharPattern:e}=r??{};return e??null}class NumberFilter extends ScalarFilter{constructor(){super("numberFilter"),this.eValuesFrom=[],this.eValuesTo=[]}mapValuesFromModel(e){const{filter:t,filterTo:n,type:o}=e||{};return[this.processValue(t),this.processValue(n)].slice(0,this.getNumberOfInputs(o))}getDefaultDebounceMs(){return 500}comparator(){return(e,t)=>e===t?0:e<t?1:-1}setParams(e){this.numberFilterParams=e,super.setParams(e),this.filterModelFormatter=new NumberFilterModelFormatter(this.localeService,this.optionsFactory)}getDefaultFilterOptions(){return NumberFilter.DEFAULT_FILTER_OPTIONS}createValueElement(){const e=getAllowedCharPattern(this.numberFilterParams),t=document.createElement("div");return t.classList.add("ag-filter-body"),setAriaRole(t,"presentation"),this.createFromToElement(t,this.eValuesFrom,"from",e),this.createFromToElement(t,this.eValuesTo,"to",e),t}createFromToElement(e,t,n,o){const a=this.createManagedBean(o?new AgInputTextField({allowedCharPattern:o}):new AgInputNumberField);a.addCssClass(`ag-filter-${n}`),a.addCssClass("ag-filter-filter"),t.push(a),e.appendChild(a.getGui())}removeValueElements(e,t){this.removeComponents(this.eValuesFrom,e,t),this.removeComponents(this.eValuesTo,e,t)}getValues(e){const t=[];return this.forEachPositionInput(e,(n,o,a,l)=>{o<l&&t.push(this.processValue(this.stringToFloat(n.getValue())))}),t}areSimpleModelsEqual(e,t){return e.filter===t.filter&&e.filterTo===t.filterTo&&e.type===t.type}getFilterType(){return"number"}processValue(e){return e==null||isNaN(e)?null:e}stringToFloat(e){if(typeof e=="number")return e;let t=makeNull(e);return t!=null&&t.trim()===""&&(t=null),this.numberFilterParams.numberParser?this.numberFilterParams.numberParser(t):t==null||t.trim()==="-"?null:parseFloat(t)}createCondition(e){const t=this.getConditionType(e),n={filterType:this.getFilterType(),type:t},o=this.getValues(e);return o.length>0&&(n.filter=o[0]),o.length>1&&(n.filterTo=o[1]),n}getInputs(e){return e>=this.eValuesFrom.length?[null,null]:[this.eValuesFrom[e],this.eValuesTo[e]]}getModelAsString(e){var t;return(t=this.filterModelFormatter.getModelAsString(e))!==null&&t!==void 0?t:""}hasInvalidInputs(){let e=!1;return this.forEachInput(t=>{if(!t.getInputElement().validity.valid){e=!0;return}}),e}}NumberFilter.DEFAULT_FILTER_OPTIONS=[ScalarFilter.EQUALS,ScalarFilter.NOT_EQUAL,ScalarFilter.LESS_THAN,ScalarFilter.LESS_THAN_OR_EQUAL,ScalarFilter.GREATER_THAN,ScalarFilter.GREATER_THAN_OR_EQUAL,ScalarFilter.IN_RANGE,ScalarFilter.BLANK,ScalarFilter.NOT_BLANK];class TextFilterModelFormatter extends SimpleFilterModelFormatter{conditionToString(e,t){const{numberOfInputs:n}=t||{};return e.type==SimpleFilter.IN_RANGE||n===2?`${e.filter}-${e.filterTo}`:e.filter!=null?`${e.filter}`:`${e.type}`}}class TextFilter extends SimpleFilter{constructor(){super("textFilter"),this.eValuesFrom=[],this.eValuesTo=[]}static trimInput(e){const t=e&&e.trim();return t===""?e:t}getDefaultDebounceMs(){return 500}setParams(e){this.textFilterParams=e,super.setParams(e),this.matcher=this.getTextMatcher(),this.formatter=this.textFilterParams.textFormatter||(this.textFilterParams.caseSensitive?TextFilter.DEFAULT_FORMATTER:TextFilter.DEFAULT_LOWERCASE_FORMATTER),this.filterModelFormatter=new TextFilterModelFormatter(this.localeService,this.optionsFactory)}getTextMatcher(){const e=this.textFilterParams.textCustomComparator;return e?(_.doOnce(()=>console.warn("AG Grid - textCustomComparator is deprecated, use textMatcher instead."),"textCustomComparator.deprecated"),({filterOption:t,value:n,filterText:o})=>e(t,n,o)):this.textFilterParams.textMatcher||TextFilter.DEFAULT_MATCHER}createCondition(e){const t=this.getConditionType(e),n={filterType:this.getFilterType(),type:t},o=this.getValues(e);return o.length>0&&(n.filter=o[0]),o.length>1&&(n.filterTo=o[1]),n}getFilterType(){return"text"}areSimpleModelsEqual(e,t){return e.filter===t.filter&&e.filterTo===t.filterTo&&e.type===t.type}getInputs(e){return e>=this.eValuesFrom.length?[null,null]:[this.eValuesFrom[e],this.eValuesTo[e]]}getValues(e){const t=[];return this.forEachPositionInput(e,(n,o,a,l)=>{if(o<l){const s=makeNull(n.getValue()),m=(this.textFilterParams.trimInput?TextFilter.trimInput(s):s)||null;t.push(m),n.setValue(m,!0)}}),t}getDefaultFilterOptions(){return TextFilter.DEFAULT_FILTER_OPTIONS}createValueElement(){const e=document.createElement("div");return e.classList.add("ag-filter-body"),setAriaRole(e,"presentation"),this.createFromToElement(e,this.eValuesFrom,"from"),this.createFromToElement(e,this.eValuesTo,"to"),e}createFromToElement(e,t,n){const o=this.createManagedBean(new AgInputTextField);o.addCssClass(`ag-filter-${n}`),o.addCssClass("ag-filter-filter"),t.push(o),e.appendChild(o.getGui())}removeValueElements(e,t){this.removeComponents(this.eValuesFrom,e,t),this.removeComponents(this.eValuesTo,e,t)}mapValuesFromModel(e){const{filter:t,filterTo:n,type:o}=e||{};return[t||null,n||null].slice(0,this.getNumberOfInputs(o))}evaluateNullValue(e){const t=[SimpleFilter.NOT_EQUAL,SimpleFilter.NOT_CONTAINS,SimpleFilter.BLANK];return e?t.indexOf(e)>=0:!1}evaluateNonNullValue(e,t,n,o){const a=e.map(Ht=>this.formatter(Ht))||[],l=this.formatter(t),{api:s,colDef:m,column:y,columnApi:D,context:W,textFormatter:Ee}=this.textFilterParams;if(n.type===SimpleFilter.BLANK)return this.isBlank(t);if(n.type===SimpleFilter.NOT_BLANK)return!this.isBlank(t);const dt={api:s,colDef:m,column:y,columnApi:D,context:W,node:o.node,data:o.data,filterOption:n.type,value:l,textFormatter:Ee};return a.some(Ht=>this.matcher(Object.assign(Object.assign({},dt),{filterText:Ht})))}getModelAsString(e){var t;return(t=this.filterModelFormatter.getModelAsString(e))!==null&&t!==void 0?t:""}}TextFilter.DEFAULT_FILTER_OPTIONS=[SimpleFilter.CONTAINS,SimpleFilter.NOT_CONTAINS,SimpleFilter.EQUALS,SimpleFilter.NOT_EQUAL,SimpleFilter.STARTS_WITH,SimpleFilter.ENDS_WITH,SimpleFilter.BLANK,SimpleFilter.NOT_BLANK];TextFilter.DEFAULT_FORMATTER=r=>r;TextFilter.DEFAULT_LOWERCASE_FORMATTER=r=>r==null?null:r.toString().toLowerCase();TextFilter.DEFAULT_MATCHER=({filterOption:r,value:e,filterText:t})=>{if(t==null)return!1;switch(r){case TextFilter.CONTAINS:return e.indexOf(t)>=0;case TextFilter.NOT_CONTAINS:return e.indexOf(t)<0;case TextFilter.EQUALS:return e===t;case TextFilter.NOT_EQUAL:return e!=t;case TextFilter.STARTS_WITH:return e.indexOf(t)===0;case TextFilter.ENDS_WITH:const n=e.lastIndexOf(t);return n>=0&&n===e.length-t.length;default:return!1}};var __decorate$2e=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class FloatingFilterTextInputService extends BeanStub{constructor(e){super(),this.params=e}setupGui(e){this.eFloatingFilterTextInput=this.createManagedBean(new AgInputTextField(this.params.config)),this.eFloatingFilterTextInput.setInputAriaLabel(this.params.ariaLabel),e.appendChild(this.eFloatingFilterTextInput.getGui())}setEditable(e){this.eFloatingFilterTextInput.setDisabled(!e)}getValue(){return this.eFloatingFilterTextInput.getValue()}setValue(e,t){this.eFloatingFilterTextInput.setValue(e,t)}addValueChangedListener(e){const t=this.eFloatingFilterTextInput.getGui();this.addManagedListener(t,"input",e),this.addManagedListener(t,"keydown",e)}}class TextInputFloatingFilter extends SimpleFloatingFilter{postConstruct(){this.setTemplate(`
            <div class="ag-floating-filter-input" role="presentation" ref="eFloatingFilterInputContainer"></div>
        `)}getDefaultDebounceMs(){return 500}onParentModelChanged(e,t){this.isEventFromFloatingFilter(t)||this.isEventFromDataChange(t)||(this.setLastTypeFromModel(e),this.setEditable(this.canWeEditAfterModelFromParentFilter(e)),this.floatingFilterInputService.setValue(this.getFilterModelFormatter().getModelAsString(e)))}init(e){this.params=e;const t=this.columnModel.getDisplayNameForColumn(e.column,"header",!0),n=this.localeService.getLocaleTextFunc(),o=`${t} ${n("ariaFilterInput","Filter Input")}`;if(this.floatingFilterInputService=this.createFloatingFilterInputService(o),this.floatingFilterInputService.setupGui(this.eFloatingFilterInputContainer),super.init(e),this.applyActive=ProvidedFilter.isUseApplyButton(this.params.filterParams),!this.isReadOnly()){const a=ProvidedFilter.getDebounceMs(this.params.filterParams,this.getDefaultDebounceMs()),l=debounce(this.syncUpWithParentFilter.bind(this),a);this.floatingFilterInputService.addValueChangedListener(l)}}syncUpWithParentFilter(e){const t=e.key===KeyCode.ENTER;if(this.applyActive&&!t)return;let n=this.floatingFilterInputService.getValue();this.params.filterParams.trimInput&&(n=TextFilter.trimInput(n),this.floatingFilterInputService.setValue(n,!0)),this.params.parentFilterInstance(o=>{o&&o.onFloatingFilterChanged(this.getLastType()||null,n||null)})}setEditable(e){this.floatingFilterInputService.setEditable(e)}}__decorate$2e([Autowired("columnModel")],TextInputFloatingFilter.prototype,"columnModel",void 0);__decorate$2e([RefSelector("eFloatingFilterInputContainer")],TextInputFloatingFilter.prototype,"eFloatingFilterInputContainer",void 0);__decorate$2e([PostConstruct],TextInputFloatingFilter.prototype,"postConstruct",null);class FloatingFilterNumberInputService extends BeanStub{constructor(e){super(),this.params=e,this.numberInputActive=!0}setupGui(e){this.eFloatingFilterNumberInput=this.createManagedBean(new AgInputNumberField),this.eFloatingFilterTextInput=this.createManagedBean(new AgInputTextField),this.eFloatingFilterTextInput.setDisabled(!0),this.eFloatingFilterNumberInput.setInputAriaLabel(this.params.ariaLabel),this.eFloatingFilterTextInput.setInputAriaLabel(this.params.ariaLabel),e.appendChild(this.eFloatingFilterNumberInput.getGui()),e.appendChild(this.eFloatingFilterTextInput.getGui())}setEditable(e){this.numberInputActive=e,this.eFloatingFilterNumberInput.setDisplayed(this.numberInputActive),this.eFloatingFilterTextInput.setDisplayed(!this.numberInputActive)}getValue(){return this.getActiveInputElement().getValue()}setValue(e,t){this.getActiveInputElement().setValue(e,t)}getActiveInputElement(){return this.numberInputActive?this.eFloatingFilterNumberInput:this.eFloatingFilterTextInput}addValueChangedListener(e){this.setupListeners(this.eFloatingFilterNumberInput.getGui(),e),this.setupListeners(this.eFloatingFilterTextInput.getGui(),e)}setupListeners(e,t){this.addManagedListener(e,"input",t),this.addManagedListener(e,"keydown",t)}}class NumberFloatingFilter extends TextInputFloatingFilter{init(e){super.init(e),this.filterModelFormatter=new NumberFilterModelFormatter(this.localeService,this.optionsFactory)}getDefaultFilterOptions(){return NumberFilter.DEFAULT_FILTER_OPTIONS}getFilterModelFormatter(){return this.filterModelFormatter}createFloatingFilterInputService(e){const t=getAllowedCharPattern(this.params.filterParams);return t?this.createManagedBean(new FloatingFilterTextInputService({config:{allowedCharPattern:t},ariaLabel:e})):this.createManagedBean(new FloatingFilterNumberInputService({ariaLabel:e}))}}class TextFloatingFilter extends TextInputFloatingFilter{init(e){super.init(e),this.filterModelFormatter=new TextFilterModelFormatter(this.localeService,this.optionsFactory)}getDefaultFilterOptions(){return TextFilter.DEFAULT_FILTER_OPTIONS}getFilterModelFormatter(){return this.filterModelFormatter}createFloatingFilterInputService(e){return this.createManagedBean(new FloatingFilterTextInputService({ariaLabel:e}))}}class TouchListener{constructor(e,t=!1){this.destroyFuncs=[],this.touching=!1,this.eventService=new EventService,this.eElement=e,this.preventMouseClick=t;const n=this.onTouchStart.bind(this),o=this.onTouchMove.bind(this),a=this.onTouchEnd.bind(this);this.eElement.addEventListener("touchstart",n,{passive:!0}),this.eElement.addEventListener("touchmove",o,{passive:!0}),this.eElement.addEventListener("touchend",a,{passive:!1}),this.destroyFuncs.push(()=>{this.eElement.removeEventListener("touchstart",n,{passive:!0}),this.eElement.removeEventListener("touchmove",o,{passive:!0}),this.eElement.removeEventListener("touchend",a,{passive:!1})})}getActiveTouch(e){for(let t=0;t<e.length;t++)if(e[t].identifier===this.touchStart.identifier)return e[t];return null}addEventListener(e,t){this.eventService.addEventListener(e,t)}removeEventListener(e,t){this.eventService.removeEventListener(e,t)}onTouchStart(e){if(this.touching)return;this.touchStart=e.touches[0],this.touching=!0,this.moved=!1;const t=this.touchStart;window.setTimeout(()=>{const n=this.touchStart===t;if(this.touching&&n&&!this.moved){this.moved=!0;const o={type:TouchListener.EVENT_LONG_TAP,touchStart:this.touchStart,touchEvent:e};this.eventService.dispatchEvent(o)}},500)}onTouchMove(e){if(!this.touching)return;const t=this.getActiveTouch(e.touches);if(!t)return;!areEventsNear(t,this.touchStart,4)&&(this.moved=!0)}onTouchEnd(e){if(this.touching){if(!this.moved){const t={type:TouchListener.EVENT_TAP,touchStart:this.touchStart};this.eventService.dispatchEvent(t),this.checkForDoubleTap()}this.preventMouseClick&&e.cancelable&&e.preventDefault(),this.touching=!1}}checkForDoubleTap(){const e=new Date().getTime();if(this.lastTapTime&&this.lastTapTime>0)if(e-this.lastTapTime>TouchListener.DOUBLE_TAP_MILLIS){const n={type:TouchListener.EVENT_DOUBLE_TAP,touchStart:this.touchStart};this.eventService.dispatchEvent(n),this.lastTapTime=null}else this.lastTapTime=e;else this.lastTapTime=e}destroy(){this.destroyFuncs.forEach(e=>e())}}TouchListener.EVENT_TAP="tap";TouchListener.EVENT_DOUBLE_TAP="doubleTap";TouchListener.EVENT_LONG_TAP="longTap";TouchListener.DOUBLE_TAP_MILLIS=500;var __decorate$2d=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class SortIndicatorComp extends Component{constructor(e){super(),e||this.setTemplate(SortIndicatorComp.TEMPLATE)}attachCustomElements(e,t,n,o,a){this.eSortOrder=e,this.eSortAsc=t,this.eSortDesc=n,this.eSortMixed=o,this.eSortNone=a}setupSort(e,t=!1){this.column=e,this.suppressOrder=t,this.setupMultiSortIndicator(),this.column.getColDef().sortable&&(this.addInIcon("sortAscending",this.eSortAsc,e),this.addInIcon("sortDescending",this.eSortDesc,e),this.addInIcon("sortUnSort",this.eSortNone,e),this.addManagedListener(this.eventService,Events.EVENT_SORT_CHANGED,()=>this.onSortChanged()),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_ROW_GROUP_CHANGED,()=>this.onSortChanged()),this.onSortChanged())}addInIcon(e,t,n){if(t==null)return;const o=createIconNoSpan(e,this.gridOptionsService,n);o&&t.appendChild(o)}onSortChanged(){this.updateIcons(),this.suppressOrder||this.updateSortOrder()}updateIcons(){const e=this.sortController.getDisplaySortForColumn(this.column);if(this.eSortAsc){const t=e==="asc";setDisplayed(this.eSortAsc,t,{skipAriaHidden:!0})}if(this.eSortDesc){const t=e==="desc";setDisplayed(this.eSortDesc,t,{skipAriaHidden:!0})}if(this.eSortNone){const t=!this.column.getColDef().unSortIcon&&!this.gridOptionsService.is("unSortIcon"),n=e==null;setDisplayed(this.eSortNone,!t&&n,{skipAriaHidden:!0})}}setupMultiSortIndicator(){this.addInIcon("sortUnSort",this.eSortMixed,this.column);const e=this.column.getColDef().showRowGroup;this.gridOptionsService.isColumnsSortingCoupledToGroup()&&e&&(this.addManagedListener(this.eventService,Events.EVENT_SORT_CHANGED,()=>this.updateMultiSortIndicator()),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_ROW_GROUP_CHANGED,()=>this.updateMultiSortIndicator()),this.updateMultiSortIndicator())}updateMultiSortIndicator(){if(this.eSortMixed){const e=this.sortController.getDisplaySortForColumn(this.column)==="mixed";setDisplayed(this.eSortMixed,e,{skipAriaHidden:!0})}}updateSortOrder(){var e;if(!this.eSortOrder)return;const t=this.sortController.getColumnsWithSortingOrdered(),n=(e=this.sortController.getDisplaySortIndexForColumn(this.column))!==null&&e!==void 0?e:-1,o=t.some(l=>{var s;return(s=this.sortController.getDisplaySortIndexForColumn(l))!==null&&s!==void 0?s:-1>=1}),a=n>=0&&o;setDisplayed(this.eSortOrder,a,{skipAriaHidden:!0}),n>=0?this.eSortOrder.innerHTML=(n+1).toString():clearElement(this.eSortOrder)}}SortIndicatorComp.TEMPLATE=`<span class="ag-sort-indicator-container">
            <span ref="eSortOrder" class="ag-sort-indicator-icon ag-sort-order ag-hidden" aria-hidden="true"></span>
            <span ref="eSortAsc" class="ag-sort-indicator-icon ag-sort-ascending-icon ag-hidden" aria-hidden="true"></span>
            <span ref="eSortDesc" class="ag-sort-indicator-icon ag-sort-descending-icon ag-hidden" aria-hidden="true"></span>
            <span ref="eSortMixed" class="ag-sort-indicator-icon ag-sort-mixed-icon ag-hidden" aria-hidden="true"></span>
            <span ref="eSortNone" class="ag-sort-indicator-icon ag-sort-none-icon ag-hidden" aria-hidden="true"></span>
        </span>`;__decorate$2d([RefSelector("eSortOrder")],SortIndicatorComp.prototype,"eSortOrder",void 0);__decorate$2d([RefSelector("eSortAsc")],SortIndicatorComp.prototype,"eSortAsc",void 0);__decorate$2d([RefSelector("eSortDesc")],SortIndicatorComp.prototype,"eSortDesc",void 0);__decorate$2d([RefSelector("eSortMixed")],SortIndicatorComp.prototype,"eSortMixed",void 0);__decorate$2d([RefSelector("eSortNone")],SortIndicatorComp.prototype,"eSortNone",void 0);__decorate$2d([Autowired("columnModel")],SortIndicatorComp.prototype,"columnModel",void 0);__decorate$2d([Autowired("sortController")],SortIndicatorComp.prototype,"sortController",void 0);var __decorate$2c=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class HeaderComp extends Component{constructor(){super(...arguments),this.lastMovingChanged=0}destroy(){super.destroy()}refresh(e){return this.params=e,this.workOutTemplate()!=this.currentTemplate||this.workOutShowMenu()!=this.currentShowMenu||this.workOutSort()!=this.currentSort?!1:(this.setDisplayName(e),!0)}workOutTemplate(){let e=firstExistingValue(this.params.template,HeaderComp.TEMPLATE);return e=e&&e.trim?e.trim():e,e}init(e){this.params=e,this.currentTemplate=this.workOutTemplate(),this.setTemplate(this.currentTemplate),this.setupTap(),this.setupIcons(e.column),this.setMenu(),this.setupSort(),this.setupFilterIcon(),this.setDisplayName(e)}setDisplayName(e){if(this.currentDisplayName!=e.displayName){this.currentDisplayName=e.displayName;const t=escapeString(this.currentDisplayName);this.eText&&(this.eText.innerHTML=t)}}setupIcons(e){this.addInIcon("menu",this.eMenu,e),this.addInIcon("filter",this.eFilter,e)}addInIcon(e,t,n){if(t==null)return;const o=createIconNoSpan(e,this.gridOptionsService,n);o&&t.appendChild(o)}setupTap(){const{gridOptionsService:e}=this;if(e.is("suppressTouch"))return;const t=new TouchListener(this.getGui(),!0),n=e.is("suppressMenuHide"),o=n&&exists(this.eMenu),a=o?new TouchListener(this.eMenu,!0):t;if(this.params.enableMenu){const l=o?"EVENT_TAP":"EVENT_LONG_TAP",s=m=>{e.api.showColumnMenuAfterMouseClick(this.params.column,m.touchStart)};this.addManagedListener(a,TouchListener[l],s)}if(this.params.enableSorting){const l=s=>{const m=s.touchStart.target;n&&this.eMenu.contains(m)||this.sortController.progressSort(this.params.column,!1,"uiColumnSorted")};this.addManagedListener(t,TouchListener.EVENT_TAP,l)}this.addDestroyFunc(()=>t.destroy()),o&&this.addDestroyFunc(()=>a.destroy())}workOutShowMenu(){const e=!this.gridOptionsService.is("suppressMenuHide"),t=isIOSUserAgent()&&e;return this.params.enableMenu&&!t}setMenu(){if(!this.eMenu)return;if(this.currentShowMenu=this.workOutShowMenu(),!this.currentShowMenu){removeFromParent(this.eMenu);return}const e=this.gridOptionsService.is("suppressMenuHide");this.addManagedListener(this.eMenu,"click",()=>this.showMenu(this.eMenu)),this.eMenu.classList.toggle("ag-header-menu-always-show",e)}showMenu(e){e||(e=this.eMenu),this.menuFactory.showMenuAfterButtonClick(this.params.column,e,"columnMenu")}workOutSort(){return this.params.enableSorting}setupSort(){if(this.currentSort=this.params.enableSorting,this.eSortIndicator||(this.eSortIndicator=this.context.createBean(new SortIndicatorComp(!0)),this.eSortIndicator.attachCustomElements(this.eSortOrder,this.eSortAsc,this.eSortDesc,this.eSortMixed,this.eSortNone)),this.eSortIndicator.setupSort(this.params.column),!this.currentSort)return;const e=this.gridOptionsService.get("multiSortKey")==="ctrl";this.addManagedListener(this.params.column,Column.EVENT_MOVING_CHANGED,()=>{this.lastMovingChanged=new Date().getTime()}),this.eLabel&&this.addManagedListener(this.eLabel,"click",n=>{const o=this.params.column.isMoving(),l=new Date().getTime()-this.lastMovingChanged<50;if(!(o||l)){const m=e?n.ctrlKey||n.metaKey:n.shiftKey;this.params.progressSort(m)}});const t=()=>{if(this.addOrRemoveCssClass("ag-header-cell-sorted-asc",this.params.column.isSortAscending()),this.addOrRemoveCssClass("ag-header-cell-sorted-desc",this.params.column.isSortDescending()),this.addOrRemoveCssClass("ag-header-cell-sorted-none",this.params.column.isSortNone()),this.params.column.getColDef().showRowGroup){const n=this.columnModel.getSourceColumnsForGroupColumn(this.params.column),a=!(n==null?void 0:n.every(l=>this.params.column.getSort()==l.getSort()));this.addOrRemoveCssClass("ag-header-cell-sorted-mixed",a)}};this.addManagedListener(this.eventService,Events.EVENT_SORT_CHANGED,t),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_ROW_GROUP_CHANGED,t)}setupFilterIcon(){this.eFilter&&(this.addManagedListener(this.params.column,Column.EVENT_FILTER_CHANGED,this.onFilterChanged.bind(this)),this.onFilterChanged())}onFilterChanged(){const e=this.params.column.isFilterActive();setDisplayed(this.eFilter,e,{skipAriaHidden:!0})}}HeaderComp.TEMPLATE=`<div class="ag-cell-label-container" role="presentation">
            <span ref="eMenu" class="ag-header-icon ag-header-cell-menu-button" aria-hidden="true"></span>
            <div ref="eLabel" class="ag-header-cell-label" role="presentation">
                <span ref="eText" class="ag-header-cell-text"></span>
                <span ref="eFilter" class="ag-header-icon ag-header-label-icon ag-filter-icon" aria-hidden="true"></span>
                <ag-sort-indicator ref="eSortIndicator"></ag-sort-indicator>
            </div>
        </div>`;__decorate$2c([Autowired("sortController")],HeaderComp.prototype,"sortController",void 0);__decorate$2c([Autowired("menuFactory")],HeaderComp.prototype,"menuFactory",void 0);__decorate$2c([Autowired("columnModel")],HeaderComp.prototype,"columnModel",void 0);__decorate$2c([RefSelector("eFilter")],HeaderComp.prototype,"eFilter",void 0);__decorate$2c([RefSelector("eSortIndicator")],HeaderComp.prototype,"eSortIndicator",void 0);__decorate$2c([RefSelector("eMenu")],HeaderComp.prototype,"eMenu",void 0);__decorate$2c([RefSelector("eLabel")],HeaderComp.prototype,"eLabel",void 0);__decorate$2c([RefSelector("eText")],HeaderComp.prototype,"eText",void 0);__decorate$2c([RefSelector("eSortOrder")],HeaderComp.prototype,"eSortOrder",void 0);__decorate$2c([RefSelector("eSortAsc")],HeaderComp.prototype,"eSortAsc",void 0);__decorate$2c([RefSelector("eSortDesc")],HeaderComp.prototype,"eSortDesc",void 0);__decorate$2c([RefSelector("eSortMixed")],HeaderComp.prototype,"eSortMixed",void 0);__decorate$2c([RefSelector("eSortNone")],HeaderComp.prototype,"eSortNone",void 0);var __decorate$2b=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class HeaderGroupComp extends Component{constructor(){super(HeaderGroupComp.TEMPLATE)}destroy(){super.destroy()}init(e){this.params=e,this.checkWarnings(),this.setupLabel(),this.addGroupExpandIcon(),this.setupExpandIcons()}checkWarnings(){if(this.params.template){const t="AG Grid: A template was provided for Header Group Comp - templates are only supported for Header Comps (not groups)";doOnce(()=>console.warn(t),"HeaderGroupComp.templateNotSupported")}}setupExpandIcons(){this.addInIcon("columnGroupOpened","agOpened"),this.addInIcon("columnGroupClosed","agClosed");const e=o=>{if(isStopPropagationForAgGrid(o))return;const a=!this.params.columnGroup.isExpanded();this.columnModel.setColumnGroupOpened(this.params.columnGroup.getProvidedColumnGroup(),a,"uiColumnExpanded")};this.addTouchAndClickListeners(this.eCloseIcon,e),this.addTouchAndClickListeners(this.eOpenIcon,e);const t=o=>{stopPropagationForAgGrid(o)};this.addManagedListener(this.eCloseIcon,"dblclick",t),this.addManagedListener(this.eOpenIcon,"dblclick",t),this.addManagedListener(this.getGui(),"dblclick",e),this.updateIconVisibility();const n=this.params.columnGroup.getProvidedColumnGroup();this.addManagedListener(n,ProvidedColumnGroup.EVENT_EXPANDED_CHANGED,this.updateIconVisibility.bind(this)),this.addManagedListener(n,ProvidedColumnGroup.EVENT_EXPANDABLE_CHANGED,this.updateIconVisibility.bind(this))}addTouchAndClickListeners(e,t){const n=new TouchListener(e,!0);this.addManagedListener(n,TouchListener.EVENT_TAP,t),this.addDestroyFunc(()=>n.destroy()),this.addManagedListener(e,"click",t)}updateIconVisibility(){if(this.params.columnGroup.isExpandable()){const t=this.params.columnGroup.isExpanded();setDisplayed(this.eOpenIcon,t),setDisplayed(this.eCloseIcon,!t)}else setDisplayed(this.eOpenIcon,!1),setDisplayed(this.eCloseIcon,!1)}addInIcon(e,t){const n=createIconNoSpan(e,this.gridOptionsService,null);n&&this.getRefElement(t).appendChild(n)}addGroupExpandIcon(){if(!this.params.columnGroup.isExpandable()){setDisplayed(this.eOpenIcon,!1),setDisplayed(this.eCloseIcon,!1);return}}setupLabel(){var e;const{displayName:t,columnGroup:n}=this.params;if(exists(t)){const o=escapeString(t);this.getRefElement("agLabel").innerHTML=o}this.addOrRemoveCssClass("ag-sticky-label",!(!((e=n.getColGroupDef())===null||e===void 0)&&e.suppressStickyLabel))}}HeaderGroupComp.TEMPLATE=`<div class="ag-header-group-cell-label" ref="agContainer" role="presentation">
            <span ref="agLabel" class="ag-header-group-text" role="presentation"></span>
            <span ref="agOpened" class="ag-header-icon ag-header-expand-icon ag-header-expand-icon-expanded"></span>
            <span ref="agClosed" class="ag-header-icon ag-header-expand-icon ag-header-expand-icon-collapsed"></span>
        </div>`;__decorate$2b([Autowired("columnModel")],HeaderGroupComp.prototype,"columnModel",void 0);__decorate$2b([RefSelector("agOpened")],HeaderGroupComp.prototype,"eOpenIcon",void 0);__decorate$2b([RefSelector("agClosed")],HeaderGroupComp.prototype,"eCloseIcon",void 0);class PopupComponent extends Component{isPopup(){return!0}setParentComponent(e){e.addCssClass("ag-has-popup"),super.setParentComponent(e)}destroy(){const e=this.parentComponent;e&&e.isAlive()&&e.getGui().classList.remove("ag-has-popup"),super.destroy()}}var __decorate$2a=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class LargeTextCellEditor extends PopupComponent{constructor(){super(LargeTextCellEditor.TEMPLATE)}init(e){this.params=e,this.focusAfterAttached=e.cellStartedEdit,this.eTextArea.setMaxLength(e.maxLength||200).setCols(e.cols||60).setRows(e.rows||10),exists(e.value,!0)&&this.eTextArea.setValue(e.value.toString(),!0),this.addGuiEventListener("keydown",this.onKeyDown.bind(this)),this.activateTabIndex()}onKeyDown(e){const t=e.key;(t===KeyCode.LEFT||t===KeyCode.UP||t===KeyCode.RIGHT||t===KeyCode.DOWN||e.shiftKey&&t===KeyCode.ENTER)&&e.stopPropagation()}afterGuiAttached(){const e=this.localeService.getLocaleTextFunc();this.eTextArea.setInputAriaLabel(e("ariaInputEditor","Input Editor")),this.focusAfterAttached&&this.eTextArea.getFocusableElement().focus()}getValue(){const e=this.eTextArea.getValue();return!exists(e)&&!exists(this.params.value)?this.params.value:this.params.parseValue(e)}}LargeTextCellEditor.TEMPLATE=`<div class="ag-large-text">
            <ag-input-text-area ref="eTextArea" class="ag-large-text-input"></ag-input-text-area>
        </div>`;__decorate$2a([RefSelector("eTextArea")],LargeTextCellEditor.prototype,"eTextArea",void 0);var __decorate$29=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class SelectCellEditor extends PopupComponent{constructor(){super('<div class="ag-cell-edit-wrapper"><ag-select class="ag-cell-editor" ref="eSelect"></ag-select></div>'),this.startedByEnter=!1}init(e){if(this.focusAfterAttached=e.cellStartedEdit,missing(e.values)){console.warn("AG Grid: no values found for select cellEditor");return}this.startedByEnter=e.eventKey!=null?e.eventKey===KeyCode.ENTER:!1;let t=!1;e.values.forEach(n=>{const o={value:n},a=this.valueFormatterService.formatValue(e.column,null,n),l=a!=null;o.text=l?a:n,this.eSelect.addOption(o),t=t||e.value===n}),t?this.eSelect.setValue(e.value,!0):e.values.length&&this.eSelect.setValue(e.values[0],!0),this.gridOptionsService.get("editType")!=="fullRow"&&this.addManagedListener(this.eSelect,AgSelect.EVENT_ITEM_SELECTED,()=>e.stopEditing())}afterGuiAttached(){this.focusAfterAttached&&this.eSelect.getFocusableElement().focus(),this.startedByEnter&&this.eSelect.showPicker()}focusIn(){this.eSelect.getFocusableElement().focus()}getValue(){return this.eSelect.getValue()}isPopup(){return!1}}__decorate$29([Autowired("valueFormatterService")],SelectCellEditor.prototype,"valueFormatterService",void 0);__decorate$29([RefSelector("eSelect")],SelectCellEditor.prototype,"eSelect",void 0);var __decorate$28=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class SimpleCellEditor extends PopupComponent{constructor(e){super(`
            <div class="ag-cell-edit-wrapper">
                ${e.getTemplate()}
            </div>`),this.cellEditorInput=e}init(e){this.params=e;const t=this.eInput;this.cellEditorInput.init(t,e);let n;if(e.cellStartedEdit){this.focusAfterAttached=!0;const o=e.eventKey;o===KeyCode.BACKSPACE||e.eventKey===KeyCode.DELETE?n="":o&&o.length===1?n=o:(n=this.cellEditorInput.getStartValue(),o!==KeyCode.F2&&(this.highlightAllOnFocus=!0))}else this.focusAfterAttached=!1,n=this.cellEditorInput.getStartValue();n!=null&&t.setStartValue(n),this.addManagedListener(t.getGui(),"keydown",o=>{const{key:a}=o;(a===KeyCode.PAGE_UP||a===KeyCode.PAGE_DOWN)&&o.preventDefault()})}afterGuiAttached(){var e,t;const n=this.localeService.getLocaleTextFunc(),o=this.eInput;if(o.setInputAriaLabel(n("ariaInputEditor","Input Editor")),!this.focusAfterAttached)return;isBrowserSafari()||o.getFocusableElement().focus();const a=o.getInputElement();this.highlightAllOnFocus?a.select():(t=(e=this.cellEditorInput).setCaret)===null||t===void 0||t.call(e)}focusIn(){const e=this.eInput,t=e.getFocusableElement(),n=e.getInputElement();t.focus(),n.select()}getValue(){return this.cellEditorInput.getValue()}isPopup(){return!1}}__decorate$28([RefSelector("eInput")],SimpleCellEditor.prototype,"eInput",void 0);class TextCellEditorInput{getTemplate(){return'<ag-input-text-field class="ag-cell-editor" ref="eInput"></ag-input-text-field>'}init(e,t){this.eInput=e,this.params=t,t.maxLength!=null&&e.setMaxLength(t.maxLength)}getValue(){const e=this.eInput.getValue();return!exists(e)&&!exists(this.params.value)?this.params.value:this.params.parseValue(e)}getStartValue(){return this.params.useFormatter||this.params.column.getColDef().refData?this.params.formatValue(this.params.value):this.params.value}setCaret(){const e=this.eInput.getValue(),t=exists(e)&&e.length||0;t&&this.eInput.getInputElement().setSelectionRange(t,t)}}class TextCellEditor extends SimpleCellEditor{constructor(){super(new TextCellEditorInput)}}var __decorate$27=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const ARROW_UP="",ARROW_DOWN="";class AnimateShowChangeCellRenderer extends Component{constructor(){super(AnimateShowChangeCellRenderer.TEMPLATE),this.refreshCount=0}init(e){this.eValue=this.queryForHtmlElement(".ag-value-change-value"),this.eDelta=this.queryForHtmlElement(".ag-value-change-delta"),this.refresh(e)}showDelta(e,t){const n=Math.abs(t),o=e.formatValue(n),a=exists(o)?o:n,l=t>=0;l?this.eDelta.innerHTML=ARROW_UP+a:this.eDelta.innerHTML=ARROW_DOWN+a,this.eDelta.classList.toggle("ag-value-change-delta-up",l),this.eDelta.classList.toggle("ag-value-change-delta-down",!l)}setTimerToRemoveDelta(){this.refreshCount++;const e=this.refreshCount;window.setTimeout(()=>{e===this.refreshCount&&this.hideDeltaValue()},2e3)}hideDeltaValue(){this.eValue.classList.remove("ag-value-change-value-highlight"),clearElement(this.eDelta)}refresh(e){const t=e.value;if(t===this.lastValue||(exists(e.valueFormatted)?this.eValue.innerHTML=e.valueFormatted:exists(e.value)?this.eValue.innerHTML=t:clearElement(this.eValue),this.filterManager.isSuppressFlashingCellsBecauseFiltering()))return!1;if(typeof t=="number"&&typeof this.lastValue=="number"){const n=t-this.lastValue;this.showDelta(e,n)}return this.lastValue&&this.eValue.classList.add("ag-value-change-value-highlight"),this.setTimerToRemoveDelta(),this.lastValue=t,!0}}AnimateShowChangeCellRenderer.TEMPLATE='<span><span class="ag-value-change-delta"></span><span class="ag-value-change-value"></span></span>';__decorate$27([Autowired("filterManager")],AnimateShowChangeCellRenderer.prototype,"filterManager",void 0);var __decorate$26=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class AnimateSlideCellRenderer extends Component{constructor(){super(AnimateSlideCellRenderer.TEMPLATE),this.refreshCount=0,this.eCurrent=this.queryForHtmlElement(".ag-value-slide-current")}init(e){this.refresh(e)}addSlideAnimation(){this.refreshCount++;const e=this.refreshCount;this.ePrevious&&this.getGui().removeChild(this.ePrevious),this.ePrevious=loadTemplate('<span class="ag-value-slide-previous ag-value-slide-out"></span>'),this.ePrevious.innerHTML=this.eCurrent.innerHTML,this.getGui().insertBefore(this.ePrevious,this.eCurrent),window.setTimeout(()=>{e===this.refreshCount&&this.ePrevious.classList.add("ag-value-slide-out-end")},50),window.setTimeout(()=>{e===this.refreshCount&&(this.getGui().removeChild(this.ePrevious),this.ePrevious=null)},3e3)}refresh(e){let t=e.value;return missing(t)&&(t=""),t===this.lastValue||this.filterManager.isSuppressFlashingCellsBecauseFiltering()?!1:(this.addSlideAnimation(),this.lastValue=t,exists(e.valueFormatted)?this.eCurrent.innerHTML=e.valueFormatted:exists(e.value)?this.eCurrent.innerHTML=t:clearElement(this.eCurrent),!0)}}AnimateSlideCellRenderer.TEMPLATE=`<span>
            <span class="ag-value-slide-current"></span>
        </span>`;__decorate$26([Autowired("filterManager")],AnimateSlideCellRenderer.prototype,"filterManager",void 0);class RowNode{constructor(e){this.rowIndex=null,this.key=null,this.childrenMapped={},this.displayed=!1,this.rowTop=null,this.oldRowTop=null,this.selectable=!0,this.__objectId=RowNode.OBJECT_ID_SEQUENCE++,this.__autoHeights={},this.alreadyRendered=!1,this.highlighted=null,this.hovered=!1,this.selected=!1,this.beans=e}setData(e){this.setDataCommon(e,!1)}updateData(e){this.setDataCommon(e,!0)}setDataCommon(e,t){const n=this.data;this.data=e,this.beans.valueCache.onDataChanged(),this.updateDataOnDetailNode(),this.checkRowSelectable(),this.resetQuickFilterAggregateText();const o=this.createDataChangedEvent(e,n,t);this.dispatchLocalEvent(o)}updateDataOnDetailNode(){this.detailNode&&(this.detailNode.data=this.data)}createDataChangedEvent(e,t,n){return{type:RowNode.EVENT_DATA_CHANGED,node:this,oldData:t,newData:e,update:n}}createLocalRowEvent(e){return{type:e,node:this}}getRowIndexString(){return this.rowPinned==="top"?"t-"+this.rowIndex:this.rowPinned==="bottom"?"b-"+this.rowIndex:this.rowIndex.toString()}createDaemonNode(){const e=new RowNode(this.beans);return e.id=this.id,e.data=this.data,e.__daemon=!0,e.selected=this.selected,e.level=this.level,e}setDataAndId(e,t){const n=exists(this.id)?this.createDaemonNode():null,o=this.data;this.data=e,this.updateDataOnDetailNode(),this.setId(t),this.beans.selectionService.syncInRowNode(this,n),this.checkRowSelectable();const a=this.createDataChangedEvent(e,o,!1);this.dispatchLocalEvent(a)}checkRowSelectable(){const e=this.beans.gridOptionsService.get("isRowSelectable");this.setRowSelectable(e?e(this):!0)}setRowSelectable(e){if(this.selectable!==e&&(this.selectable=e,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(RowNode.EVENT_SELECTABLE_CHANGED)),this.beans.gridOptionsService.is("groupSelectsChildren"))){const n=this.calculateSelectedFromChildren();this.setSelectedParams({newValue:n??!1,source:"selectableChanged"})}}setId(e){const t=this.beans.gridOptionsService.getCallback("getRowId");if(t)if(this.data){const n=this.getGroupKeys(!0);this.id=t({data:this.data,parentKeys:n.length>0?n:void 0,level:this.level}),this.id!==null&&typeof this.id=="string"&&this.id.startsWith(RowNode.ID_PREFIX_ROW_GROUP)&&console.error(`AG Grid: Row IDs cannot start with ${RowNode.ID_PREFIX_ROW_GROUP}, this is a reserved prefix for AG Grid's row grouping feature.`),this.id!==null&&typeof this.id!="string"&&(this.id=""+this.id)}else this.id=void 0;else this.id=e}getGroupKeys(e=!1){const t=[];let n=this;for(e&&(n=n.parent);n&&n.level>=0;)t.push(n.key),n=n.parent;return t.reverse(),t}isPixelInRange(e){return!exists(this.rowTop)||!exists(this.rowHeight)?!1:e>=this.rowTop&&e<this.rowTop+this.rowHeight}setFirstChild(e){this.firstChild!==e&&(this.firstChild=e,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(RowNode.EVENT_FIRST_CHILD_CHANGED)))}setLastChild(e){this.lastChild!==e&&(this.lastChild=e,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(RowNode.EVENT_LAST_CHILD_CHANGED)))}setChildIndex(e){this.childIndex!==e&&(this.childIndex=e,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(RowNode.EVENT_CHILD_INDEX_CHANGED)))}setRowTop(e){this.oldRowTop=this.rowTop,this.rowTop!==e&&(this.rowTop=e,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(RowNode.EVENT_TOP_CHANGED)),this.setDisplayed(e!==null))}clearRowTopAndRowIndex(){this.oldRowTop=null,this.setRowTop(null),this.setRowIndex(null)}setDisplayed(e){this.displayed!==e&&(this.displayed=e,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(RowNode.EVENT_DISPLAYED_CHANGED)))}setDragging(e){this.dragging!==e&&(this.dragging=e,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(RowNode.EVENT_DRAGGING_CHANGED)))}setHighlighted(e){e!==this.highlighted&&(this.highlighted=e,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(RowNode.EVENT_HIGHLIGHT_CHANGED)))}setHovered(e){this.hovered!==e&&(this.hovered=e)}isHovered(){return this.hovered}setAllChildrenCount(e){this.allChildrenCount!==e&&(this.allChildrenCount=e,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(RowNode.EVENT_ALL_CHILDREN_COUNT_CHANGED)))}setMaster(e){this.master!==e&&(this.master&&!e&&(this.expanded=!1),this.master=e,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(RowNode.EVENT_MASTER_CHANGED)))}setGroup(e){this.group!==e&&(this.group&&!e&&(this.expanded=!1),this.group=e,this.updateHasChildren(),this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(RowNode.EVENT_GROUP_CHANGED)))}setRowHeight(e,t=!1){this.rowHeight=e,this.rowHeightEstimated=t,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(RowNode.EVENT_HEIGHT_CHANGED))}setRowAutoHeight(e,t){this.__autoHeights||(this.__autoHeights={}),this.__autoHeights[t.getId()]=e,e!=null&&(this.checkAutoHeightsDebounced==null&&(this.checkAutoHeightsDebounced=debounce(this.checkAutoHeights.bind(this),1)),this.checkAutoHeightsDebounced())}checkAutoHeights(){let e=!1,t=!0,n=0;const o=this.__autoHeights;if(o==null||(this.beans.columnModel.getAllDisplayedAutoHeightCols().forEach(s=>{let m=o[s.getId()];if(m==null)if(this.beans.columnModel.isColSpanActive()){let y=[];switch(s.getPinned()){case"left":y=this.beans.columnModel.getDisplayedLeftColumnsForRow(this);break;case"right":y=this.beans.columnModel.getDisplayedRightColumnsForRow(this);break;case null:y=this.beans.columnModel.getViewportCenterColumnsForRow(this);break}if(y.includes(s)){e=!0;return}m=-1}else{e=!0;return}else t=!1;m>n&&(n=m)}),e)||((t||n<10)&&(n=this.beans.gridOptionsService.getRowHeightForNode(this).height),n==this.rowHeight))return;this.setRowHeight(n);const l=this.beans.rowModel;l.onRowHeightChangedDebounced&&l.onRowHeightChangedDebounced()}setRowIndex(e){this.rowIndex!==e&&(this.rowIndex=e,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(RowNode.EVENT_ROW_INDEX_CHANGED)))}setUiLevel(e){this.uiLevel!==e&&(this.uiLevel=e,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(RowNode.EVENT_UI_LEVEL_CHANGED)))}setExpanded(e,t){if(this.expanded===e)return;this.expanded=e,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(RowNode.EVENT_EXPANDED_CHANGED));const n=Object.assign({},this.createGlobalRowEvent(Events.EVENT_ROW_GROUP_OPENED),{expanded:e,event:t||null});this.beans.rowNodeEventThrottle.dispatchExpanded(n),this.beans.gridOptionsService.is("groupIncludeFooter")&&this.beans.rowRenderer.refreshCells({rowNodes:[this]})}createGlobalRowEvent(e){return{type:e,node:this,data:this.data,rowIndex:this.rowIndex,rowPinned:this.rowPinned,context:this.beans.gridOptionsService.context,api:this.beans.gridOptionsService.api,columnApi:this.beans.gridOptionsService.columnApi}}dispatchLocalEvent(e){this.eventService&&this.eventService.dispatchEvent(e)}setDataValue(e,t,n){const a=(()=>{var m;return typeof e!="string"?e:(m=this.beans.columnModel.getGridColumn(e))!==null&&m!==void 0?m:this.beans.columnModel.getPrimaryColumn(e)})(),l=this.getValueFromValueService(a);if(this.beans.gridOptionsService.is("readOnlyEdit"))return this.dispatchEventForSaveValueReadOnly(a,l,t,n),!1;const s=this.beans.valueService.setValue(this,a,t,n);return this.dispatchCellChangedEvent(a,t,l),this.checkRowSelectable(),s}getValueFromValueService(e){const t=this.leafGroup&&this.beans.columnModel.isPivotMode(),n=this.group&&this.expanded&&!this.footer&&!t,o=this.beans.gridOptionsService.is("groupIncludeFooter"),a=this.beans.gridOptionsService.is("groupSuppressBlankHeader"),l=n&&o&&!a;return this.beans.valueService.getValue(e,this,!1,l)}dispatchEventForSaveValueReadOnly(e,t,n,o){const a={type:Events.EVENT_CELL_EDIT_REQUEST,event:null,rowIndex:this.rowIndex,rowPinned:this.rowPinned,column:e,colDef:e.getColDef(),context:this.beans.gridOptionsService.context,api:this.beans.gridOptionsService.api,columnApi:this.beans.gridOptionsService.columnApi,data:this.data,node:this,oldValue:t,newValue:n,value:n,source:o};this.beans.eventService.dispatchEvent(a)}setGroupValue(e,t){const n=this.beans.columnModel.getGridColumn(e);missing(this.groupData)&&(this.groupData={});const o=n.getColId(),a=this.groupData[o];a!==t&&(this.groupData[o]=t,this.dispatchCellChangedEvent(n,t,a))}setAggData(e){const t=getAllKeysInObjects([this.aggData,e]),n=this.aggData;this.aggData=e,this.eventService&&t.forEach(o=>{const a=this.beans.columnModel.getGridColumn(o),l=this.aggData?this.aggData[o]:void 0,s=n?n[o]:void 0;this.dispatchCellChangedEvent(a,l,s)})}updateHasChildren(){let e=this.group&&!this.footer||this.childrenAfterGroup&&this.childrenAfterGroup.length>0;if(this.beans.gridOptionsService.isRowModelType("serverSide")){const n=this.beans.gridOptionsService.isTreeData(),o=this.beans.gridOptionsService.get("isServerSideGroup");e=!this.stub&&!this.footer&&(n?!!o&&o(this.data):!!this.group)}e!==this.__hasChildren&&(this.__hasChildren=!!e,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(RowNode.EVENT_HAS_CHILDREN_CHANGED)))}hasChildren(){return this.__hasChildren==null&&this.updateHasChildren(),this.__hasChildren}isEmptyRowGroupNode(){return this.group&&missingOrEmpty(this.childrenAfterGroup)}dispatchCellChangedEvent(e,t,n){const o={type:RowNode.EVENT_CELL_CHANGED,node:this,column:e,newValue:t,oldValue:n};this.dispatchLocalEvent(o)}resetQuickFilterAggregateText(){this.quickFilterAggregateText=null}isExpandable(){return!!(this.hasChildren()&&!this.footer||this.master)}isSelected(){return this.footer?this.sibling.isSelected():this.selected}depthFirstSearch(e){this.childrenAfterGroup&&this.childrenAfterGroup.forEach(t=>t.depthFirstSearch(e)),e(this)}calculateSelectedFromChildren(){var e;let t=!1,n=!1,o=!1;if(!(!((e=this.childrenAfterGroup)===null||e===void 0)&&e.length))return this.selectable?this.selected:null;for(let a=0;a<this.childrenAfterGroup.length;a++){const l=this.childrenAfterGroup[a];let s=l.isSelected();if(!l.selectable){const m=l.calculateSelectedFromChildren();if(m===null)continue;s=m}switch(s){case!0:t=!0;break;case!1:n=!0;break;default:o=!0;break}}if(!(o||t&&n))return t?!0:n?!1:this.selectable?this.selected:null}setSelectedInitialValue(e){this.selected=e}selectThisNode(e,t,n="api"){const o=!this.selectable&&e,a=this.selected===e;if(o||a)return!1;this.selected=e,this.eventService&&this.dispatchLocalEvent(this.createLocalRowEvent(RowNode.EVENT_ROW_SELECTED));const l=Object.assign(Object.assign({},this.createGlobalRowEvent(Events.EVENT_ROW_SELECTED)),{event:t||null,source:n});return this.beans.eventService.dispatchEvent(l),!0}setSelected(e,t=!1,n="api"){if(typeof n=="boolean"){console.warn("AG Grid: since version v30, rowNode.setSelected() property `suppressFinishActions` has been removed, please use `gridApi.setNodesSelected()` for bulk actions, and the event `source` property for ignoring events instead.");return}this.setSelectedParams({newValue:e,clearSelection:t,rangeSelect:!1,source:n})}setSelectedParams(e){return this.rowPinned?(console.warn("AG Grid: cannot select pinned rows"),0):this.id===void 0?(console.warn("AG Grid: cannot select node until id for node is known"),0):this.beans.selectionService.setNodesSelected(Object.assign(Object.assign({},e),{nodes:[this.footer?this.sibling:this]}))}isRowPinned(){return this.rowPinned==="top"||this.rowPinned==="bottom"}isParentOfNode(e){let t=this.parent;for(;t;){if(t===e)return!0;t=t.parent}return!1}addEventListener(e,t){this.eventService||(this.eventService=new EventService),this.eventService.addEventListener(e,t)}removeEventListener(e,t){this.eventService&&(this.eventService.removeEventListener(e,t),this.eventService.noRegisteredListenersExist()&&(this.eventService=null))}onMouseEnter(){this.dispatchLocalEvent(this.createLocalRowEvent(RowNode.EVENT_MOUSE_ENTER))}onMouseLeave(){this.dispatchLocalEvent(this.createLocalRowEvent(RowNode.EVENT_MOUSE_LEAVE))}getFirstChildOfFirstChild(e){let t=this,n=!0,o=!1,a=null;for(;n&&!o;){const l=t.parent;exists(l)&&t.firstChild?l.rowGroupColumn===e&&(o=!0,a=l):n=!1,t=l}return o?a:null}isFullWidthCell(){const e=this.beans.gridOptionsService.getCallback("isFullWidthRow");return e?e({rowNode:this}):!1}getRoute(){if(this.key==null)return;const e=[];let t=this;for(;t.key!=null;)e.push(t.key),t=t.parent;return e.reverse()}createFooter(){if(this.sibling)return;const e=new RowNode(this.beans);Object.keys(this).forEach(t=>{e[t]=this[t]}),e.footer=!0,e.setRowTop(null),e.setRowIndex(null),e.oldRowTop=null,e.id="rowGroupFooter_"+this.id,e.sibling=this,this.sibling=e}}RowNode.ID_PREFIX_ROW_GROUP="row-group-";RowNode.ID_PREFIX_TOP_PINNED="t-";RowNode.ID_PREFIX_BOTTOM_PINNED="b-";RowNode.OBJECT_ID_SEQUENCE=0;RowNode.EVENT_ROW_SELECTED="rowSelected";RowNode.EVENT_DATA_CHANGED="dataChanged";RowNode.EVENT_CELL_CHANGED="cellChanged";RowNode.EVENT_ALL_CHILDREN_COUNT_CHANGED="allChildrenCountChanged";RowNode.EVENT_MASTER_CHANGED="masterChanged";RowNode.EVENT_GROUP_CHANGED="groupChanged";RowNode.EVENT_MOUSE_ENTER="mouseEnter";RowNode.EVENT_MOUSE_LEAVE="mouseLeave";RowNode.EVENT_HEIGHT_CHANGED="heightChanged";RowNode.EVENT_TOP_CHANGED="topChanged";RowNode.EVENT_DISPLAYED_CHANGED="displayedChanged";RowNode.EVENT_FIRST_CHILD_CHANGED="firstChildChanged";RowNode.EVENT_LAST_CHILD_CHANGED="lastChildChanged";RowNode.EVENT_CHILD_INDEX_CHANGED="childIndexChanged";RowNode.EVENT_ROW_INDEX_CHANGED="rowIndexChanged";RowNode.EVENT_EXPANDED_CHANGED="expandedChanged";RowNode.EVENT_HAS_CHILDREN_CHANGED="hasChildrenChanged";RowNode.EVENT_SELECTABLE_CHANGED="selectableChanged";RowNode.EVENT_UI_LEVEL_CHANGED="uiLevelChanged";RowNode.EVENT_HIGHLIGHT_CHANGED="rowHighlightChanged";RowNode.EVENT_DRAGGING_CHANGED="draggingChanged";var __decorate$25=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class CheckboxSelectionComponent extends Component{constructor(){super(`
            <div class="ag-selection-checkbox" role="presentation">
                <ag-checkbox role="presentation" ref="eCheckbox"></ag-checkbox>
            </div>`)}postConstruct(){this.eCheckbox.setPassive(!0),setAriaLive(this.eCheckbox.getInputElement(),"polite")}getCheckboxId(){return this.eCheckbox.getInputElement().id}onDataChanged(){this.onSelectionChanged()}onSelectableChanged(){this.showOrHideSelect()}onSelectionChanged(){const e=this.localeService.getLocaleTextFunc(),t=this.rowNode.isSelected(),n=getAriaCheckboxStateName(e,t),o=e("ariaRowToggleSelection","Press Space to toggle row selection");this.eCheckbox.setValue(t,!0),this.eCheckbox.setInputAriaLabel(`${o} (${n})`)}onClicked(e,t,n){return this.rowNode.setSelectedParams({newValue:e,rangeSelect:n.shiftKey,groupSelectsFiltered:t,event:n,source:"checkboxSelected"})}init(e){if(this.rowNode=e.rowNode,this.column=e.column,this.overrides=e.overrides,this.onSelectionChanged(),this.addManagedListener(this.eCheckbox.getInputElement(),"dblclick",o=>{stopPropagationForAgGrid(o)}),this.addManagedListener(this.eCheckbox.getInputElement(),"click",o=>{stopPropagationForAgGrid(o);const a=this.gridOptionsService.is("groupSelectsFiltered"),l=this.eCheckbox.getValue();this.shouldHandleIndeterminateState(l,a)?this.onClicked(!0,a,o||{})===0&&this.onClicked(!1,a,o):l?this.onClicked(!1,a,o):this.onClicked(!0,a,o||{})}),this.addManagedListener(this.rowNode,RowNode.EVENT_ROW_SELECTED,this.onSelectionChanged.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_DATA_CHANGED,this.onDataChanged.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_SELECTABLE_CHANGED,this.onSelectableChanged.bind(this)),this.gridOptionsService.get("isRowSelectable")||typeof this.getIsVisible()=="function"){const o=this.showOrHideSelect.bind(this);this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,o),this.addManagedListener(this.rowNode,RowNode.EVENT_DATA_CHANGED,o),this.addManagedListener(this.rowNode,RowNode.EVENT_CELL_CHANGED,o),this.showOrHideSelect()}this.eCheckbox.getInputElement().setAttribute("tabindex","-1")}shouldHandleIndeterminateState(e,t){return t&&(this.eCheckbox.getPreviousValue()===void 0||e===void 0)&&this.gridOptionsService.isRowModelType("clientSide")}showOrHideSelect(){var e,t,n,o;let a=this.rowNode.selectable;const l=this.getIsVisible();if(a)if(typeof l=="function"){const m=(e=this.overrides)===null||e===void 0?void 0:e.callbackParams,y=(t=this.column)===null||t===void 0?void 0:t.createColumnFunctionCallbackParams(this.rowNode);a=y?l(Object.assign(Object.assign({},m),y)):!1}else a=l??!1;if((n=this.column)===null||n===void 0?void 0:n.getColDef().showDisabledCheckboxes){this.eCheckbox.setDisabled(!a),this.setVisible(!0),this.setDisplayed(!0);return}if(!((o=this.overrides)===null||o===void 0)&&o.removeHidden){this.setDisplayed(a);return}this.setVisible(a)}getIsVisible(){var e,t;return this.overrides?this.overrides.isVisible:(t=(e=this.column)===null||e===void 0?void 0:e.getColDef())===null||t===void 0?void 0:t.checkboxSelection}}__decorate$25([RefSelector("eCheckbox")],CheckboxSelectionComponent.prototype,"eCheckbox",void 0);__decorate$25([PostConstruct],CheckboxSelectionComponent.prototype,"postConstruct",null);var __decorate$24=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},DragAndDropService_1,DragSourceType;(function(r){r[r.ToolPanel=0]="ToolPanel",r[r.HeaderCell=1]="HeaderCell",r[r.RowDrag=2]="RowDrag",r[r.ChartPanel=3]="ChartPanel"})(DragSourceType||(DragSourceType={}));var VerticalDirection;(function(r){r[r.Up=0]="Up",r[r.Down=1]="Down"})(VerticalDirection||(VerticalDirection={}));var HorizontalDirection;(function(r){r[r.Left=0]="Left",r[r.Right=1]="Right"})(HorizontalDirection||(HorizontalDirection={}));let DragAndDropService=DragAndDropService_1=class extends BeanStub{constructor(){super(...arguments),this.dragSourceAndParamsList=[],this.dropTargets=[]}init(){this.ePinnedIcon=createIcon("columnMovePin",this.gridOptionsService,null),this.eHideIcon=createIcon("columnMoveHide",this.gridOptionsService,null),this.eMoveIcon=createIcon("columnMoveMove",this.gridOptionsService,null),this.eLeftIcon=createIcon("columnMoveLeft",this.gridOptionsService,null),this.eRightIcon=createIcon("columnMoveRight",this.gridOptionsService,null),this.eGroupIcon=createIcon("columnMoveGroup",this.gridOptionsService,null),this.eAggregateIcon=createIcon("columnMoveValue",this.gridOptionsService,null),this.ePivotIcon=createIcon("columnMovePivot",this.gridOptionsService,null),this.eDropNotAllowedIcon=createIcon("dropNotAllowed",this.gridOptionsService,null)}addDragSource(e,t=!1){const n={eElement:e.eElement,dragStartPixels:e.dragStartPixels,onDragStart:this.onDragStart.bind(this,e),onDragStop:this.onDragStop.bind(this),onDragging:this.onDragging.bind(this),includeTouch:t};this.dragSourceAndParamsList.push({params:n,dragSource:e}),this.dragService.addDragSource(n)}removeDragSource(e){const t=this.dragSourceAndParamsList.find(n=>n.dragSource===e);t&&(this.dragService.removeDragSource(t.params),removeFromArray(this.dragSourceAndParamsList,t))}clearDragSourceParamsList(){this.dragSourceAndParamsList.forEach(e=>this.dragService.removeDragSource(e.params)),this.dragSourceAndParamsList.length=0,this.dropTargets.length=0}nudge(){this.dragging&&this.onDragging(this.eventLastTime,!0)}onDragStart(e,t){this.dragging=!0,this.dragSource=e,this.eventLastTime=t,this.dragItem=this.dragSource.getDragItem(),this.lastDropTarget=this.dragSource.dragSourceDropTarget,this.dragSource.onDragStarted&&this.dragSource.onDragStarted(),this.createGhost()}onDragStop(e){if(this.eventLastTime=null,this.dragging=!1,this.dragSource.onDragStopped&&this.dragSource.onDragStopped(),this.lastDropTarget&&this.lastDropTarget.onDragStop){const t=this.createDropTargetEvent(this.lastDropTarget,e,null,null,!1);this.lastDropTarget.onDragStop(t)}this.lastDropTarget=null,this.dragItem=null,this.removeGhost()}onDragging(e,t){var n,o,a,l;const s=this.getHorizontalDirection(e),m=this.getVerticalDirection(e);this.eventLastTime=e,this.positionGhost(e);const y=this.dropTargets.filter(W=>this.isMouseOnDropTarget(e,W)),D=this.findCurrentDropTarget(e,y);if(D!==this.lastDropTarget)this.leaveLastTargetIfExists(e,s,m,t),this.lastDropTarget!==null&&D===null&&((o=(n=this.dragSource).onGridExit)===null||o===void 0||o.call(n,this.dragItem)),this.lastDropTarget===null&&D!==null&&((l=(a=this.dragSource).onGridEnter)===null||l===void 0||l.call(a,this.dragItem)),this.enterDragTargetIfExists(D,e,s,m,t),this.lastDropTarget=D;else if(D&&D.onDragging){const W=this.createDropTargetEvent(D,e,s,m,t);D.onDragging(W)}}getAllContainersFromDropTarget(e){const t=e.getSecondaryContainers?e.getSecondaryContainers():null,n=[[e.getContainer()]];return t?n.concat(t):n}allContainersIntersect(e,t){for(const n of t){const o=n.getBoundingClientRect();if(o.width===0||o.height===0)return!1;const a=e.clientX>=o.left&&e.clientX<o.right,l=e.clientY>=o.top&&e.clientY<o.bottom;if(!a||!l)return!1}return!0}isMouseOnDropTarget(e,t){const n=this.getAllContainersFromDropTarget(t);let o=!1;for(const a of n)if(this.allContainersIntersect(e,a)){o=!0;break}return t.targetContainsSource&&!t.getContainer().contains(this.dragSource.eElement)?!1:o&&t.isInterestedIn(this.dragSource.type,this.dragSource.eElement)}findCurrentDropTarget(e,t){const n=t.length;if(n===0)return null;if(n===1)return t[0];const a=this.gridOptionsService.getRootNode().elementsFromPoint(e.clientX,e.clientY);for(const l of a)for(const s of t)if(flatten(this.getAllContainersFromDropTarget(s)).indexOf(l)!==-1)return s;return null}enterDragTargetIfExists(e,t,n,o,a){if(e){if(e.onDragEnter){const l=this.createDropTargetEvent(e,t,n,o,a);e.onDragEnter(l)}this.setGhostIcon(e.getIconName?e.getIconName():null)}}leaveLastTargetIfExists(e,t,n,o){if(this.lastDropTarget){if(this.lastDropTarget.onDragLeave){const a=this.createDropTargetEvent(this.lastDropTarget,e,t,n,o);this.lastDropTarget.onDragLeave(a)}this.setGhostIcon(null)}}addDropTarget(e){this.dropTargets.push(e)}removeDropTarget(e){this.dropTargets=this.dropTargets.filter(t=>t.getContainer()!==e.getContainer())}hasExternalDropZones(){return this.dropTargets.some(e=>e.external)}findExternalZone(e){return this.dropTargets.filter(n=>n.external).find(n=>n.getContainer()===e.getContainer())||null}getHorizontalDirection(e){const t=this.eventLastTime&&this.eventLastTime.clientX,n=e.clientX;return t===n?null:t>n?HorizontalDirection.Left:HorizontalDirection.Right}getVerticalDirection(e){const t=this.eventLastTime&&this.eventLastTime.clientY,n=e.clientY;return t===n?null:t>n?VerticalDirection.Up:VerticalDirection.Down}createDropTargetEvent(e,t,n,o,a){const l=e.getContainer(),s=l.getBoundingClientRect(),{gridApi:m,columnApi:y,dragItem:D,dragSource:W}=this,Ee=t.clientX-s.left,dt=t.clientY-s.top;return{event:t,x:Ee,y:dt,vDirection:o,hDirection:n,dragSource:W,fromNudge:a,dragItem:D,api:m,columnApi:y,dropZoneTarget:l}}positionGhost(e){const t=this.eGhost;if(!t)return;const o=t.getBoundingClientRect().height,a=getBodyWidth()-2,l=getBodyHeight()-2,s=getElementRectWithOffset(t.offsetParent),{clientY:m,clientX:y}=e;let D=m-s.top-o/2,W=y-s.left-10;const Ee=this.gridOptionsService.getDocument(),dt=Ee.defaultView||window,Ht=dt.pageYOffset||Ee.documentElement.scrollTop,ir=dt.pageXOffset||Ee.documentElement.scrollLeft;a>0&&W+t.clientWidth>a+ir&&(W=a+ir-t.clientWidth),W<0&&(W=0),l>0&&D+t.clientHeight>l+Ht&&(D=l+Ht-t.clientHeight),D<0&&(D=0),t.style.left=`${W}px`,t.style.top=`${D}px`}removeGhost(){this.eGhost&&this.eGhostParent&&this.eGhostParent.removeChild(this.eGhost),this.eGhost=null}createGhost(){this.eGhost=loadTemplate(DragAndDropService_1.GHOST_TEMPLATE),this.mouseEventService.stampTopLevelGridCompWithGridInstance(this.eGhost);const{theme:e}=this.environment.getTheme();e&&this.eGhost.classList.add(e),this.eGhostIcon=this.eGhost.querySelector(".ag-dnd-ghost-icon"),this.setGhostIcon(null);const t=this.eGhost.querySelector(".ag-dnd-ghost-label");let n=this.dragSource.dragItemName;isFunction(n)&&(n=n()),t.innerHTML=escapeString(n)||"",this.eGhost.style.height="25px",this.eGhost.style.top="20px",this.eGhost.style.left="20px";const o=this.gridOptionsService.getDocument();let a=null;try{a=o.fullscreenElement}catch{}finally{if(!a){const l=this.gridOptionsService.getRootNode(),s=l.querySelector("body");s?a=s:l instanceof ShadowRoot?a=l:a=l==null?void 0:l.documentElement}}this.eGhostParent=a,this.eGhostParent?this.eGhostParent.appendChild(this.eGhost):console.warn("AG Grid: could not find document body, it is needed for dragging columns")}setGhostIcon(e,t=!1){clearElement(this.eGhostIcon);let n=null;switch(e||(e=this.dragSource.defaultIconName||DragAndDropService_1.ICON_NOT_ALLOWED),e){case DragAndDropService_1.ICON_PINNED:n=this.ePinnedIcon;break;case DragAndDropService_1.ICON_MOVE:n=this.eMoveIcon;break;case DragAndDropService_1.ICON_LEFT:n=this.eLeftIcon;break;case DragAndDropService_1.ICON_RIGHT:n=this.eRightIcon;break;case DragAndDropService_1.ICON_GROUP:n=this.eGroupIcon;break;case DragAndDropService_1.ICON_AGGREGATE:n=this.eAggregateIcon;break;case DragAndDropService_1.ICON_PIVOT:n=this.ePivotIcon;break;case DragAndDropService_1.ICON_NOT_ALLOWED:n=this.eDropNotAllowedIcon;break;case DragAndDropService_1.ICON_HIDE:n=this.eHideIcon;break}this.eGhostIcon.classList.toggle("ag-shake-left-to-right",t),!(n===this.eHideIcon&&this.gridOptionsService.is("suppressDragLeaveHidesColumns"))&&n&&this.eGhostIcon.appendChild(n)}};DragAndDropService.ICON_PINNED="pinned";DragAndDropService.ICON_MOVE="move";DragAndDropService.ICON_LEFT="left";DragAndDropService.ICON_RIGHT="right";DragAndDropService.ICON_GROUP="group";DragAndDropService.ICON_AGGREGATE="aggregate";DragAndDropService.ICON_PIVOT="pivot";DragAndDropService.ICON_NOT_ALLOWED="notAllowed";DragAndDropService.ICON_HIDE="hide";DragAndDropService.GHOST_TEMPLATE=`<div class="ag-dnd-ghost ag-unselectable">
            <span class="ag-dnd-ghost-icon ag-shake-left-to-right"></span>
            <div class="ag-dnd-ghost-label"></div>
        </div>`;__decorate$24([Autowired("dragService")],DragAndDropService.prototype,"dragService",void 0);__decorate$24([Autowired("mouseEventService")],DragAndDropService.prototype,"mouseEventService",void 0);__decorate$24([Autowired("columnApi")],DragAndDropService.prototype,"columnApi",void 0);__decorate$24([Autowired("gridApi")],DragAndDropService.prototype,"gridApi",void 0);__decorate$24([PostConstruct],DragAndDropService.prototype,"init",null);__decorate$24([PreDestroy],DragAndDropService.prototype,"clearDragSourceParamsList",null);DragAndDropService=DragAndDropService_1=__decorate$24([Bean("dragAndDropService")],DragAndDropService);var __decorate$23=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class RowDragComp extends Component{constructor(e,t,n,o,a,l){super(),this.cellValueFn=e,this.rowNode=t,this.column=n,this.customGui=o,this.dragStartPixels=a,this.suppressVisibilityChange=l,this.dragSource=null}isCustomGui(){return this.customGui!=null}postConstruct(){if(this.customGui?this.setDragElement(this.customGui,this.dragStartPixels):(this.setTemplate('<div class="ag-drag-handle ag-row-drag" aria-hidden="true"></div>'),this.getGui().appendChild(createIconNoSpan("rowDrag",this.gridOptionsService,null)),this.addDragSource()),this.checkCompatibility(),!this.suppressVisibilityChange){const e=this.gridOptionsService.is("rowDragManaged")?new ManagedVisibilityStrategy(this,this.beans,this.rowNode,this.column):new NonManagedVisibilityStrategy(this,this.beans,this.rowNode,this.column);this.createManagedBean(e,this.beans.context)}}setDragElement(e,t){this.setTemplateFromElement(e),this.addDragSource(t)}getSelectedNodes(){if(!this.gridOptionsService.is("rowDragMultiRow"))return[this.rowNode];const t=this.beans.selectionService.getSelectedNodes();return t.indexOf(this.rowNode)!==-1?t:[this.rowNode]}checkCompatibility(){const e=this.gridOptionsService.is("rowDragManaged");this.gridOptionsService.isTreeData()&&e&&doOnce(()=>console.warn("AG Grid: If using row drag with tree data, you cannot have rowDragManaged=true"),"RowDragComp.managedAndTreeData")}getDragItem(){return{rowNode:this.rowNode,rowNodes:this.getSelectedNodes(),columns:this.column?[this.column]:void 0,defaultTextValue:this.cellValueFn()}}getRowDragText(e){if(e){const t=e.getColDef();if(t.rowDragText)return t.rowDragText}return this.gridOptionsService.get("rowDragText")}addDragSource(e=4){this.dragSource&&this.removeDragSource();const t=this.getRowDragText(this.column),n=this.localeService.getLocaleTextFunc();this.dragSource={type:DragSourceType.RowDrag,eElement:this.getGui(),dragItemName:()=>{var o;const a=this.getDragItem(),l=((o=a.rowNodes)===null||o===void 0?void 0:o.length)||1;return t?t(a,l):l===1?this.cellValueFn():`${l} ${n("rowDragRows","rows")}`},getDragItem:()=>this.getDragItem(),dragStartPixels:e,dragSourceDomDataKey:this.gridOptionsService.getDomDataKey()},this.beans.dragAndDropService.addDragSource(this.dragSource,!0)}removeDragSource(){this.dragSource&&this.beans.dragAndDropService.removeDragSource(this.dragSource),this.dragSource=null}}__decorate$23([Autowired("beans")],RowDragComp.prototype,"beans",void 0);__decorate$23([PostConstruct],RowDragComp.prototype,"postConstruct",null);__decorate$23([PreDestroy],RowDragComp.prototype,"removeDragSource",null);class VisibilityStrategy extends BeanStub{constructor(e,t,n){super(),this.parent=e,this.rowNode=t,this.column=n}setDisplayedOrVisible(e){const t={skipAriaHidden:!0};if(e)this.parent.setDisplayed(!1,t);else{let n=!0,o=!1;this.column&&(n=this.column.isRowDrag(this.rowNode)||this.parent.isCustomGui(),o=isFunction(this.column.getColDef().rowDrag)),o?(this.parent.setDisplayed(!0,t),this.parent.setVisible(n,t)):(this.parent.setDisplayed(n,t),this.parent.setVisible(!0,t))}}}class NonManagedVisibilityStrategy extends VisibilityStrategy{constructor(e,t,n,o){super(e,n,o),this.beans=t}postConstruct(){this.addManagedPropertyListener("suppressRowDrag",this.onSuppressRowDrag.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_DATA_CHANGED,this.workOutVisibility.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_CELL_CHANGED,this.workOutVisibility.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_CELL_CHANGED,this.workOutVisibility.bind(this)),this.addManagedListener(this.beans.eventService,Events.EVENT_NEW_COLUMNS_LOADED,this.workOutVisibility.bind(this)),this.workOutVisibility()}onSuppressRowDrag(){this.workOutVisibility()}workOutVisibility(){const e=this.gridOptionsService.is("suppressRowDrag");this.setDisplayedOrVisible(e)}}__decorate$23([PostConstruct],NonManagedVisibilityStrategy.prototype,"postConstruct",null);class ManagedVisibilityStrategy extends VisibilityStrategy{constructor(e,t,n,o){super(e,n,o),this.beans=t}postConstruct(){this.addManagedListener(this.beans.eventService,Events.EVENT_SORT_CHANGED,this.workOutVisibility.bind(this)),this.addManagedListener(this.beans.eventService,Events.EVENT_FILTER_CHANGED,this.workOutVisibility.bind(this)),this.addManagedListener(this.beans.eventService,Events.EVENT_COLUMN_ROW_GROUP_CHANGED,this.workOutVisibility.bind(this)),this.addManagedListener(this.beans.eventService,Events.EVENT_NEW_COLUMNS_LOADED,this.workOutVisibility.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_DATA_CHANGED,this.workOutVisibility.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_CELL_CHANGED,this.workOutVisibility.bind(this)),this.addManagedPropertyListener("suppressRowDrag",this.onSuppressRowDrag.bind(this)),this.workOutVisibility()}onSuppressRowDrag(){this.workOutVisibility()}workOutVisibility(){const t=this.beans.ctrlsService.getGridBodyCtrl().getRowDragFeature(),n=t&&t.shouldPreventRowMove(),o=this.gridOptionsService.is("suppressRowDrag"),a=this.beans.dragAndDropService.hasExternalDropZones(),l=n&&!a||o;this.setDisplayedOrVisible(l)}}__decorate$23([PostConstruct],ManagedVisibilityStrategy.prototype,"postConstruct",null);var __decorate$22=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class GroupCellRendererCtrl extends BeanStub{init(e,t,n,o,a,l,s){this.params=s,this.eGui=t,this.eCheckbox=n,this.eExpanded=o,this.eContracted=a,this.comp=e,this.compClass=l;const m=this.isTopLevelFooter(),y=this.isEmbeddedRowMismatch(),D=s.value==null&&!s.node.master;let W=!1;if(this.gridOptionsService.is("groupIncludeFooter")&&this.gridOptionsService.is("groupHideOpenParents")){const Ee=s.node;if(Ee.footer){const dt=s.colDef&&s.colDef.showRowGroup,Ht=Ee.rowGroupColumn&&Ee.rowGroupColumn.getColId();W=dt!==Ht}}this.cellIsBlank=m?!1:y||D&&!s.node.master||W,!this.cellIsBlank&&(this.setupShowingValueForOpenedParent(),this.findDisplayedGroupNode(),this.addFullWidthRowDraggerIfNeeded(),this.addExpandAndContract(),this.addCheckboxIfNeeded(),this.addValueElement(),this.setupIndent(),this.refreshAriaExpanded())}destroy(){super.destroy(),this.expandListener=null}refreshAriaExpanded(){const{node:e,eParentOfValue:t}=this.params;if(this.expandListener&&(this.expandListener=this.expandListener()),!this.isExpandable()){removeAriaExpanded(t);return}const n=()=>{setAriaExpanded(t,!!e.expanded)};this.expandListener=this.addManagedListener(e,RowNode.EVENT_EXPANDED_CHANGED,n)||null,n()}isTopLevelFooter(){if(!this.gridOptionsService.is("groupIncludeTotalFooter")||this.params.value!=null||this.params.node.level!=-1)return!1;const e=this.params.colDef;if(e==null||e.showRowGroup===!0)return!0;const n=this.columnModel.getRowGroupColumns();return!n||n.length===0?!0:n[0].getId()===e.showRowGroup}isEmbeddedRowMismatch(){if(!this.params.fullWidth||!this.gridOptionsService.is("embedFullWidthRows"))return!1;const e=this.params.pinned==="left",t=this.params.pinned==="right",n=!e&&!t;return this.gridOptionsService.is("enableRtl")?this.columnModel.isPinningLeft()?!t:!n:this.columnModel.isPinningLeft()?!e:!n}findDisplayedGroupNode(){const e=this.params.column,t=this.params.node;if(this.showingValueForOpenedParent){let n=t.parent;for(;n!=null;){if(n.rowGroupColumn&&e.isRowGroupDisplayed(n.rowGroupColumn.getId())){this.displayedGroupNode=n;break}n=n.parent}}missing(this.displayedGroupNode)&&(this.displayedGroupNode=t)}setupShowingValueForOpenedParent(){const e=this.params.node,t=this.params.column;if(!this.gridOptionsService.is("groupHideOpenParents")){this.showingValueForOpenedParent=!1;return}if(!e.groupData){this.showingValueForOpenedParent=!1;return}if(e.rowGroupColumn!=null){const a=e.rowGroupColumn.getId();if(t.isRowGroupDisplayed(a)){this.showingValueForOpenedParent=!1;return}}const o=e.groupData[t.getId()]!=null;this.showingValueForOpenedParent=o}addValueElement(){this.displayedGroupNode.footer?this.addFooterValue():(this.addGroupValue(),this.addChildCount())}addGroupValue(){const e=this.adjustParamsWithDetailsFromRelatedColumn(),t=this.getInnerCompDetails(e),{valueFormatted:n,value:o}=e;let a=n;a==null&&(o===""&&this.params.node.group?a=this.localeService.getLocaleTextFunc()("blanks","(Blanks)"):a=o??null),this.comp.setInnerRenderer(t,a)}adjustParamsWithDetailsFromRelatedColumn(){const e=this.displayedGroupNode.rowGroupColumn,t=this.params.column;if(!e)return this.params;if(t!=null&&!t.isRowGroupDisplayed(e.getId()))return this.params;const o=this.params,{value:a,node:l}=this.params,s=this.valueFormatterService.formatValue(e,l,a);return Object.assign(Object.assign({},o),{valueFormatted:s})}addFooterValue(){const e=this.params.footerValueGetter;let t="";if(e){const o=cloneObject(this.params);o.value=this.params.value,typeof e=="function"?t=e(o):typeof e=="string"?t=this.expressionService.evaluate(e,o):console.warn("AG Grid: footerValueGetter should be either a function or a string (expression)")}else t="Total "+(this.params.value!=null?this.params.value:"");const n=this.getInnerCompDetails(this.params);this.comp.setInnerRenderer(n,t)}getInnerCompDetails(e){if(e.fullWidth)return this.userComponentFactory.getFullWidthGroupRowInnerCellRenderer(this.gridOptionsService.get("groupRowRendererParams"),e);const t=this.userComponentFactory.getInnerRendererDetails(e,e),n=s=>s&&s.componentClass==this.compClass;if(t&&!n(t))return t;const o=this.displayedGroupNode.rowGroupColumn,a=o?o.getColDef():void 0;if(!a)return;const l=this.userComponentFactory.getCellRendererDetails(a,e);if(l&&!n(l))return l;if(n(l)&&a.cellRendererParams&&a.cellRendererParams.innerRenderer)return this.userComponentFactory.getInnerRendererDetails(a.cellRendererParams,e)}addChildCount(){this.params.suppressCount||(this.addManagedListener(this.displayedGroupNode,RowNode.EVENT_ALL_CHILDREN_COUNT_CHANGED,this.updateChildCount.bind(this)),this.updateChildCount())}updateChildCount(){const e=this.displayedGroupNode.allChildrenCount,o=this.isShowRowGroupForThisRow()&&e!=null&&e>=0?`(${e})`:"";this.comp.setChildCount(o)}isShowRowGroupForThisRow(){if(this.gridOptionsService.isTreeData())return!0;const e=this.displayedGroupNode.rowGroupColumn;if(!e)return!1;const t=this.params.column;return t==null||t.isRowGroupDisplayed(e.getId())}addExpandAndContract(){var e;const t=this.params,n=createIconNoSpan("groupExpanded",this.gridOptionsService,null),o=createIconNoSpan("groupContracted",this.gridOptionsService,null);n&&this.eExpanded.appendChild(n),o&&this.eContracted.appendChild(o);const a=t.eGridCell;!(((e=this.params.column)===null||e===void 0?void 0:e.isCellEditable(t.node))&&this.gridOptionsService.is("enableGroupEdit"))&&this.isExpandable()&&!t.suppressDoubleClickExpand&&this.addManagedListener(a,"dblclick",this.onCellDblClicked.bind(this)),this.addManagedListener(this.eExpanded,"click",this.onExpandClicked.bind(this)),this.addManagedListener(this.eContracted,"click",this.onExpandClicked.bind(this)),this.addManagedListener(a,"keydown",this.onKeyDown.bind(this)),this.addManagedListener(t.node,RowNode.EVENT_EXPANDED_CHANGED,this.showExpandAndContractIcons.bind(this)),this.showExpandAndContractIcons();const s=this.onRowNodeIsExpandableChanged.bind(this);this.addManagedListener(this.displayedGroupNode,RowNode.EVENT_ALL_CHILDREN_COUNT_CHANGED,s),this.addManagedListener(this.displayedGroupNode,RowNode.EVENT_MASTER_CHANGED,s),this.addManagedListener(this.displayedGroupNode,RowNode.EVENT_GROUP_CHANGED,s),this.addManagedListener(this.displayedGroupNode,RowNode.EVENT_HAS_CHILDREN_CHANGED,s)}onExpandClicked(e){isStopPropagationForAgGrid(e)||(stopPropagationForAgGrid(e),this.onExpandOrContract(e))}onExpandOrContract(e){const t=this.displayedGroupNode,n=!t.expanded;!n&&t.sticky&&this.scrollToStickyNode(t),t.setExpanded(n,e)}scrollToStickyNode(e){this.ctrlsService.getGridBodyCtrl().getScrollFeature().setVerticalScrollPosition(e.rowTop-e.stickyRowTop)}isExpandable(){if(this.showingValueForOpenedParent)return!0;const e=this.displayedGroupNode,t=this.columnModel.isPivotMode()&&e.leafGroup;if(!(e.isExpandable()&&!e.footer&&!t))return!1;const o=this.params.column;return o!=null&&typeof o.getColDef().showRowGroup=="string"?this.isShowRowGroupForThisRow():!0}showExpandAndContractIcons(){const{params:e,displayedGroupNode:t,columnModel:n}=this,{node:o}=e,a=this.isExpandable();if(a){const D=this.showingValueForOpenedParent?!0:o.expanded;this.comp.setExpandedDisplayed(D),this.comp.setContractedDisplayed(!D)}else this.comp.setExpandedDisplayed(!1),this.comp.setContractedDisplayed(!1);const l=n.isPivotMode(),s=l&&t.leafGroup,m=a&&!s,y=o.footer&&o.level===-1;this.comp.addOrRemoveCssClass("ag-cell-expandable",m),this.comp.addOrRemoveCssClass("ag-row-group",m),l?this.comp.addOrRemoveCssClass("ag-pivot-leaf-group",s):y||this.comp.addOrRemoveCssClass("ag-row-group-leaf-indent",!m)}onRowNodeIsExpandableChanged(){this.showExpandAndContractIcons(),this.setIndent(),this.refreshAriaExpanded()}setupIndent(){const e=this.params.node;this.params.suppressPadding||(this.addManagedListener(e,RowNode.EVENT_UI_LEVEL_CHANGED,this.setIndent.bind(this)),this.setIndent())}setIndent(){if(this.gridOptionsService.is("groupHideOpenParents"))return;const e=this.params,t=e.node,n=!!e.colDef,o=this.gridOptionsService.isTreeData(),l=!n||o||e.colDef.showRowGroup===!0?t.uiLevel:0;this.indentClass&&this.comp.addOrRemoveCssClass(this.indentClass,!1),this.indentClass="ag-row-group-indent-"+l,this.comp.addOrRemoveCssClass(this.indentClass,!0)}addFullWidthRowDraggerIfNeeded(){if(!this.params.fullWidth||!this.params.rowDrag)return;const e=new RowDragComp(()=>this.params.value,this.params.node);this.createManagedBean(e,this.context),this.eGui.insertAdjacentElement("afterbegin",e.getGui())}isUserWantsSelected(){const e=this.params.checkbox;return typeof e=="function"||e===!0}addCheckboxIfNeeded(){const e=this.displayedGroupNode,t=this.isUserWantsSelected()&&!e.footer&&!e.rowPinned&&!e.detail;if(t){const n=new CheckboxSelectionComponent;this.getContext().createBean(n),n.init({rowNode:e,column:this.params.column,overrides:{isVisible:this.params.checkbox,callbackParams:this.params,removeHidden:!0}}),this.eCheckbox.appendChild(n.getGui()),this.addDestroyFunc(()=>this.getContext().destroyBean(n))}this.comp.setCheckboxVisible(t)}onKeyDown(e){!(e.key===KeyCode.ENTER)||this.params.suppressEnterExpand||this.params.column&&this.params.column.isCellEditable(this.params.node)||this.onExpandOrContract(e)}onCellDblClicked(e){if(isStopPropagationForAgGrid(e))return;isElementInEventPath(this.eExpanded,e)||isElementInEventPath(this.eContracted,e)||this.onExpandOrContract(e)}}__decorate$22([Autowired("expressionService")],GroupCellRendererCtrl.prototype,"expressionService",void 0);__decorate$22([Autowired("valueFormatterService")],GroupCellRendererCtrl.prototype,"valueFormatterService",void 0);__decorate$22([Autowired("columnModel")],GroupCellRendererCtrl.prototype,"columnModel",void 0);__decorate$22([Autowired("userComponentFactory")],GroupCellRendererCtrl.prototype,"userComponentFactory",void 0);__decorate$22([Autowired("ctrlsService")],GroupCellRendererCtrl.prototype,"ctrlsService",void 0);var __decorate$21=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class GroupCellRenderer extends Component{constructor(){super(GroupCellRenderer.TEMPLATE)}init(e){const t={setInnerRenderer:(l,s)=>this.setRenderDetails(l,s),setChildCount:l=>this.eChildCount.innerHTML=l,addOrRemoveCssClass:(l,s)=>this.addOrRemoveCssClass(l,s),setContractedDisplayed:l=>setDisplayed(this.eContracted,l),setExpandedDisplayed:l=>setDisplayed(this.eExpanded,l),setCheckboxVisible:l=>this.eCheckbox.classList.toggle("ag-invisible",!l)},n=this.createManagedBean(new GroupCellRendererCtrl),o=!e.colDef,a=this.getGui();n.init(t,a,this.eCheckbox,this.eExpanded,this.eContracted,this.constructor,e),o&&setAriaRole(a,"gridcell")}setRenderDetails(e,t){if(e){const n=e.newAgStackInstance();if(!n)return;n.then(o=>{if(!o)return;const a=()=>this.context.destroyBean(o);this.isAlive()?(this.eValue.appendChild(o.getGui()),this.addDestroyFunc(a)):a()})}else this.eValue.innerText=t}destroy(){this.getContext().destroyBean(this.innerCellRenderer),super.destroy()}refresh(){return!1}}GroupCellRenderer.TEMPLATE=`<span class="ag-cell-wrapper">
            <span class="ag-group-expanded" ref="eExpanded"></span>
            <span class="ag-group-contracted" ref="eContracted"></span>
            <span class="ag-group-checkbox ag-invisible" ref="eCheckbox"></span>
            <span class="ag-group-value" ref="eValue"></span>
            <span class="ag-group-child-count" ref="eChildCount"></span>
        </span>`;__decorate$21([RefSelector("eExpanded")],GroupCellRenderer.prototype,"eExpanded",void 0);__decorate$21([RefSelector("eContracted")],GroupCellRenderer.prototype,"eContracted",void 0);__decorate$21([RefSelector("eCheckbox")],GroupCellRenderer.prototype,"eCheckbox",void 0);__decorate$21([RefSelector("eValue")],GroupCellRenderer.prototype,"eValue",void 0);__decorate$21([RefSelector("eChildCount")],GroupCellRenderer.prototype,"eChildCount",void 0);var __decorate$20=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class LoadingCellRenderer extends Component{constructor(){super(LoadingCellRenderer.TEMPLATE)}init(e){e.node.failedLoad?this.setupFailed():this.setupLoading()}setupFailed(){const e=this.localeService.getLocaleTextFunc();this.eLoadingText.innerText=e("loadingError","ERR")}setupLoading(){const e=createIconNoSpan("groupLoading",this.gridOptionsService,null);e&&this.eLoadingIcon.appendChild(e);const t=this.localeService.getLocaleTextFunc();this.eLoadingText.innerText=t("loadingOoo","Loading")}refresh(e){return!1}destroy(){super.destroy()}}LoadingCellRenderer.TEMPLATE=`<div class="ag-loading">
            <span class="ag-loading-icon" ref="eLoadingIcon"></span>
            <span class="ag-loading-text" ref="eLoadingText"></span>
        </div>`;__decorate$20([RefSelector("eLoadingIcon")],LoadingCellRenderer.prototype,"eLoadingIcon",void 0);__decorate$20([RefSelector("eLoadingText")],LoadingCellRenderer.prototype,"eLoadingText",void 0);class LoadingOverlayComponent$1 extends Component{constructor(){super()}destroy(){super.destroy()}init(e){var t;const n=(t=this.gridOptionsService.get("overlayLoadingTemplate"))!==null&&t!==void 0?t:LoadingOverlayComponent$1.DEFAULT_LOADING_OVERLAY_TEMPLATE,o=this.localeService.getLocaleTextFunc(),a=n.replace("[LOADING...]",o("loadingOoo","Loading..."));this.setTemplate(a)}}LoadingOverlayComponent$1.DEFAULT_LOADING_OVERLAY_TEMPLATE='<span class="ag-overlay-loading-center">[LOADING...]</span>';class NoRowsOverlayComponent$1 extends Component{constructor(){super()}destroy(){super.destroy()}init(e){var t;const n=(t=this.gridOptionsService.get("overlayNoRowsTemplate"))!==null&&t!==void 0?t:NoRowsOverlayComponent$1.DEFAULT_NO_ROWS_TEMPLATE,o=this.localeService.getLocaleTextFunc(),a=n.replace("[NO_ROWS_TO_SHOW]",o("noRowsToShow","No Rows To Show"));this.setTemplate(a)}}NoRowsOverlayComponent$1.DEFAULT_NO_ROWS_TEMPLATE='<span class="ag-overlay-no-rows-center">[NO_ROWS_TO_SHOW]</span>';class TooltipComponent$1 extends PopupComponent{constructor(){super('<div class="ag-tooltip"></div>')}init(e){const{value:t}=e;this.getGui().innerHTML=escapeString(t)}}class NumberCellEditorInput{getTemplate(){return'<ag-input-number-field class="ag-cell-editor" ref="eInput"></ag-input-number-field>'}init(e,t){this.eInput=e,this.params=t,t.max!=null&&e.setMax(t.max),t.min!=null&&e.setMin(t.min),t.precision!=null&&e.setPrecision(t.precision),t.step!=null&&e.setStep(t.step),t.showStepperButtons&&e.getInputElement().classList.add("ag-number-field-input-stepper")}getValue(){const e=this.eInput.getValue();if(!exists(e)&&!exists(this.params.value))return this.params.value;let t=this.params.parseValue(e);if(t==null)return t;if(typeof t=="string"){if(t==="")return null;t=Number(t)}return isNaN(t)?null:t}getStartValue(){return this.params.value}}class NumberCellEditor extends SimpleCellEditor{constructor(){super(new NumberCellEditorInput)}}class DateCellEditorInput{getTemplate(){return'<ag-input-date-field class="ag-cell-editor" ref="eInput"></ag-input-date-field>'}init(e,t){this.eInput=e,this.params=t,t.min!=null&&e.setMin(t.min),t.max!=null&&e.setMax(t.max),t.step!=null&&e.setStep(t.step)}getValue(){const e=this.eInput.getDate();return!exists(e)&&!exists(this.params.value)?this.params.value:e??null}getStartValue(){const{value:e}=this.params;if(e instanceof Date)return serialiseDate(e,!1)}}class DateCellEditor extends SimpleCellEditor{constructor(){super(new DateCellEditorInput)}}var __decorate$1$=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class DateStringCellEditorInput{constructor(e){this.getDataTypeService=e}getTemplate(){return'<ag-input-date-field class="ag-cell-editor" ref="eInput"></ag-input-date-field>'}init(e,t){this.eInput=e,this.params=t,t.min!=null&&e.setMin(t.min),t.max!=null&&e.setMax(t.max),t.step!=null&&e.setStep(t.step)}getValue(){const e=this.formatDate(this.eInput.getDate());return!exists(e)&&!exists(this.params.value)?this.params.value:this.params.parseValue(e??"")}getStartValue(){var e,t;return serialiseDate((t=this.parseDate((e=this.params.value)!==null&&e!==void 0?e:void 0))!==null&&t!==void 0?t:null,!1)}parseDate(e){return this.getDataTypeService().getDateParserFunction()(e)}formatDate(e){return this.getDataTypeService().getDateFormatterFunction()(e)}}class DateStringCellEditor extends SimpleCellEditor{constructor(){super(new DateStringCellEditorInput(()=>this.dataTypeService))}}__decorate$1$([Autowired("dataTypeService")],DateStringCellEditor.prototype,"dataTypeService",void 0);var __decorate$1_=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class CheckboxCellRenderer extends Component{constructor(){super(CheckboxCellRenderer.TEMPLATE)}init(e){this.params=e,this.updateCheckbox(e),this.eCheckbox.getInputElement().setAttribute("tabindex","-1"),this.addManagedListener(this.eCheckbox.getInputElement(),"click",n=>{if(stopPropagationForAgGrid(n),this.eCheckbox.isDisabled())return;const o=this.eCheckbox.getValue();this.onCheckboxChanged(o)}),this.addManagedListener(this.eCheckbox.getInputElement(),"dblclick",n=>{stopPropagationForAgGrid(n)});const t=this.gridOptionsService.getDocument();this.addManagedListener(this.params.eGridCell,"keydown",n=>{if(n.key===KeyCode.SPACE&&!this.eCheckbox.isDisabled()){this.params.eGridCell===t.activeElement&&this.eCheckbox.toggle();const o=this.eCheckbox.getValue();this.onCheckboxChanged(o),n.preventDefault()}})}refresh(e){return this.params=e,this.updateCheckbox(e),!0}updateCheckbox(e){var t,n,o;let a,l=!0;if(e.node.group&&e.column){const W=e.column.getColId();W.startsWith(GROUP_AUTO_COLUMN_ID)?a=e.value==null||e.value===""?void 0:e.value==="true":e.node.aggData&&e.node.aggData[W]!==void 0?a=(t=e.value)!==null&&t!==void 0?t:void 0:l=!1}else a=(n=e.value)!==null&&n!==void 0?n:void 0;if(!l){this.eCheckbox.setDisplayed(!1);return}this.eCheckbox.setValue(a);const s=e.disabled!=null?e.disabled:!(!((o=e.column)===null||o===void 0)&&o.isCellEditable(e.node));this.eCheckbox.setDisabled(s);const m=this.localeService.getLocaleTextFunc(),y=getAriaCheckboxStateName(m,a),D=s?y:`${m("ariaToggleCellValue","Press SPACE to toggle cell value")} (${y})`;this.eCheckbox.setInputAriaLabel(D)}onCheckboxChanged(e){const{column:t,node:n,rowIndex:o,value:a}=this.params,l={type:Events.EVENT_CELL_EDITING_STARTED,column:t,colDef:t==null?void 0:t.getColDef(),data:n.data,node:n,rowIndex:o,rowPinned:n.rowPinned,value:a};this.eventService.dispatchEvent(l);const s=this.params.node.setDataValue(this.params.column,e,"edit"),m={type:Events.EVENT_CELL_EDITING_STOPPED,column:t,colDef:t==null?void 0:t.getColDef(),data:n.data,node:n,rowIndex:o,rowPinned:n.rowPinned,value:a,oldValue:a,newValue:e,valueChanged:s};this.eventService.dispatchEvent(m)}}CheckboxCellRenderer.TEMPLATE=`
        <div class="ag-cell-wrapper ag-checkbox-cell" role="presentation">
            <ag-checkbox role="presentation" ref="eCheckbox"></ag-checkbox>
        </div>`;__decorate$1_([RefSelector("eCheckbox")],CheckboxCellRenderer.prototype,"eCheckbox",void 0);var __decorate$1Z=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class CheckboxCellEditor extends PopupComponent{constructor(){super(`
            <div class="ag-cell-wrapper ag-cell-edit-wrapper ag-checkbox-edit">
                <ag-checkbox role="presentation" ref="eCheckbox"></ag-checkbox>
            </div>`)}init(e){var t;this.params=e;const n=(t=e.value)!==null&&t!==void 0?t:void 0;this.eCheckbox.setValue(n),this.eCheckbox.getInputElement().setAttribute("tabindex","-1"),this.setAriaLabel(n),this.addManagedListener(this.eCheckbox,AgCheckbox.EVENT_CHANGED,o=>this.setAriaLabel(o.selected))}getValue(){return this.eCheckbox.getValue()}focusIn(){this.eCheckbox.getFocusableElement().focus()}afterGuiAttached(){this.params.cellStartedEdit&&this.focusIn()}isPopup(){return!1}setAriaLabel(e){const t=this.localeService.getLocaleTextFunc(),n=getAriaCheckboxStateName(t,e),o=t("ariaToggleCellValue","Press SPACE to toggle cell value");this.eCheckbox.setInputAriaLabel(`${o} (${n})`)}}__decorate$1Z([RefSelector("eCheckbox")],CheckboxCellEditor.prototype,"eCheckbox",void 0);var __decorate$1Y=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let UserComponentRegistry=class extends BeanStub{constructor(){super(...arguments),this.agGridDefaults={agDateInput:DefaultDateComponent,agColumnHeader:HeaderComp,agColumnGroupHeader:HeaderGroupComp,agSortIndicator:SortIndicatorComp,agTextColumnFloatingFilter:TextFloatingFilter,agNumberColumnFloatingFilter:NumberFloatingFilter,agDateColumnFloatingFilter:DateFloatingFilter,agReadOnlyFloatingFilter:ReadOnlyFloatingFilter,agAnimateShowChangeCellRenderer:AnimateShowChangeCellRenderer,agAnimateSlideCellRenderer:AnimateSlideCellRenderer,agGroupCellRenderer:GroupCellRenderer,agGroupRowRenderer:GroupCellRenderer,agLoadingCellRenderer:LoadingCellRenderer,agCheckboxCellRenderer:CheckboxCellRenderer,agCellEditor:TextCellEditor,agTextCellEditor:TextCellEditor,agNumberCellEditor:NumberCellEditor,agDateCellEditor:DateCellEditor,agDateStringCellEditor:DateStringCellEditor,agSelectCellEditor:SelectCellEditor,agLargeTextCellEditor:LargeTextCellEditor,agCheckboxCellEditor:CheckboxCellEditor,agTextColumnFilter:TextFilter,agNumberColumnFilter:NumberFilter,agDateColumnFilter:DateFilter,agLoadingOverlay:LoadingOverlayComponent$1,agNoRowsOverlay:NoRowsOverlayComponent$1,agTooltipComponent:TooltipComponent$1},this.enterpriseAgDefaultCompsModule={agSetColumnFilter:ModuleNames.SetFilterModule,agSetColumnFloatingFilter:ModuleNames.SetFilterModule,agMultiColumnFilter:ModuleNames.MultiFilterModule,agMultiColumnFloatingFilter:ModuleNames.MultiFilterModule,agGroupColumnFilter:ModuleNames.RowGroupingModule,agGroupColumnFloatingFilter:ModuleNames.RowGroupingModule,agRichSelect:ModuleNames.RichSelectModule,agRichSelectCellEditor:ModuleNames.RichSelectModule,agDetailCellRenderer:ModuleNames.MasterDetailModule,agSparklineCellRenderer:ModuleNames.SparklinesModule},this.jsComps={}}init(){this.gridOptions.components!=null&&iterateObject(this.gridOptions.components,(e,t)=>this.registerJsComponent(e,t))}registerDefaultComponent(e,t){if(this.agGridDefaults[e]){console.error("Trying to overwrite a default component. You should call registerComponent");return}this.agGridDefaults[e]=t}registerJsComponent(e,t){this.jsComps[e]=t}retrieve(e,t){const n=(m,y)=>({componentFromFramework:y,component:m}),o=this.getFrameworkOverrides().frameworkComponent(t,this.gridOptions.components);if(o!=null)return n(o,!0);const a=this.jsComps[t];if(a){const m=this.getFrameworkOverrides().isFrameworkComponent(a);return n(a,m)}const l=this.agGridDefaults[t];if(l)return n(l,!1);const s=this.enterpriseAgDefaultCompsModule[t];return s?ModuleRegistry.__assertRegistered(s,`AG Grid '${e}' component: ${t}`,this.context.getGridId()):doOnce(()=>{this.warnAboutMissingComponent(e,t)},"MissingComp"+t),null}warnAboutMissingComponent(e,t){const n=[...Object.keys(this.agGridDefaults).filter(a=>!["agCellEditor","agGroupRowRenderer","agSortIndicator"].includes(a)),...Object.keys(this.jsComps)],o=fuzzySuggestions(t,n,!0,.8);console.warn(`AG Grid: Could not find '${t}' component. It was configured as "${e}: '${t}'" but it wasn't found in the list of registered components.`),o.length>0&&console.warn(`         Did you mean: [${o.slice(0,3)}]?`),console.warn("If using a custom component check it has been registered as described in: https://ag-grid.com/javascript-data-grid/components/")}};__decorate$1Y([Autowired("gridOptions")],UserComponentRegistry.prototype,"gridOptions",void 0);__decorate$1Y([PostConstruct],UserComponentRegistry.prototype,"init",null);UserComponentRegistry=__decorate$1Y([Bean("userComponentRegistry")],UserComponentRegistry);const DateComponent={propertyName:"dateComponent",cellRenderer:!1},HeaderComponent={propertyName:"headerComponent",cellRenderer:!1},HeaderGroupComponent={propertyName:"headerGroupComponent",cellRenderer:!1},CellRendererComponent={propertyName:"cellRenderer",cellRenderer:!0},CellEditorComponent={propertyName:"cellEditor",cellRenderer:!1},InnerRendererComponent={propertyName:"innerRenderer",cellRenderer:!0},LoadingOverlayComponent={propertyName:"loadingOverlayComponent",cellRenderer:!1},NoRowsOverlayComponent={propertyName:"noRowsOverlayComponent",cellRenderer:!1},TooltipComponent={propertyName:"tooltipComponent",cellRenderer:!1},FilterComponent={propertyName:"filter",cellRenderer:!1},FloatingFilterComponent={propertyName:"floatingFilterComponent",cellRenderer:!1},ToolPanelComponent={propertyName:"toolPanel",cellRenderer:!1},StatusPanelComponent={propertyName:"statusPanel",cellRenderer:!1},FullWidth={propertyName:"fullWidthCellRenderer",cellRenderer:!0},FullWidthLoading={propertyName:"loadingCellRenderer",cellRenderer:!0},FullWidthGroup={propertyName:"groupRowRenderer",cellRenderer:!0},FullWidthDetail={propertyName:"detailCellRenderer",cellRenderer:!0};class FloatingFilterMapper{static getFloatingFilterType(e){return this.filterToFloatingFilterMapping[e]}}FloatingFilterMapper.filterToFloatingFilterMapping={set:"agSetColumnFloatingFilter",agSetColumnFilter:"agSetColumnFloatingFilter",multi:"agMultiColumnFloatingFilter",agMultiColumnFilter:"agMultiColumnFloatingFilter",group:"agGroupColumnFloatingFilter",agGroupColumnFilter:"agGroupColumnFloatingFilter",number:"agNumberColumnFloatingFilter",agNumberColumnFilter:"agNumberColumnFloatingFilter",date:"agDateColumnFloatingFilter",agDateColumnFilter:"agDateColumnFloatingFilter",text:"agTextColumnFloatingFilter",agTextColumnFilter:"agTextColumnFloatingFilter"};var __decorate$1X=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let UserComponentFactory=class extends BeanStub{getHeaderCompDetails(e,t){return this.getCompDetails(e,HeaderComponent,"agColumnHeader",t)}getHeaderGroupCompDetails(e){const t=e.columnGroup.getColGroupDef();return this.getCompDetails(t,HeaderGroupComponent,"agColumnGroupHeader",e)}getFullWidthCellRendererDetails(e){return this.getCompDetails(this.gridOptions,FullWidth,null,e,!0)}getFullWidthLoadingCellRendererDetails(e){return this.getCompDetails(this.gridOptions,FullWidthLoading,"agLoadingCellRenderer",e,!0)}getFullWidthGroupCellRendererDetails(e){return this.getCompDetails(this.gridOptions,FullWidthGroup,"agGroupRowRenderer",e,!0)}getFullWidthDetailCellRendererDetails(e){return this.getCompDetails(this.gridOptions,FullWidthDetail,"agDetailCellRenderer",e,!0)}getInnerRendererDetails(e,t){return this.getCompDetails(e,InnerRendererComponent,null,t)}getFullWidthGroupRowInnerCellRenderer(e,t){return this.getCompDetails(e,InnerRendererComponent,null,t)}getCellRendererDetails(e,t){return this.getCompDetails(e,CellRendererComponent,null,t)}getCellEditorDetails(e,t){return this.getCompDetails(e,CellEditorComponent,"agCellEditor",t,!0)}getFilterDetails(e,t,n){return this.getCompDetails(e,FilterComponent,n,t,!0)}getDateCompDetails(e){return this.getCompDetails(this.gridOptions,DateComponent,"agDateInput",e,!0)}getLoadingOverlayCompDetails(e){return this.getCompDetails(this.gridOptions,LoadingOverlayComponent,"agLoadingOverlay",e,!0)}getNoRowsOverlayCompDetails(e){return this.getCompDetails(this.gridOptions,NoRowsOverlayComponent,"agNoRowsOverlay",e,!0)}getTooltipCompDetails(e){return this.getCompDetails(e.colDef,TooltipComponent,"agTooltipComponent",e,!0)}getSetFilterCellRendererDetails(e,t){return this.getCompDetails(e,CellRendererComponent,null,t)}getFloatingFilterCompDetails(e,t,n){return this.getCompDetails(e,FloatingFilterComponent,n,t)}getToolPanelCompDetails(e,t){return this.getCompDetails(e,ToolPanelComponent,null,t,!0)}getStatusPanelCompDetails(e,t){return this.getCompDetails(e,StatusPanelComponent,null,t,!0)}getCompDetails(e,t,n,o,a=!1){const{propertyName:l,cellRenderer:s}=t;let{compName:m,jsComp:y,fwComp:D,paramsFromSelector:W,popupFromSelector:Ee,popupPositionFromSelector:dt}=this.getCompKeys(e,t,o);const Ht=Vn=>{const Wr=this.userComponentRegistry.retrieve(l,Vn);Wr&&(y=Wr.componentFromFramework?void 0:Wr.component,D=Wr.componentFromFramework?Wr.component:void 0)};if(m!=null&&Ht(m),y==null&&D==null&&n!=null&&Ht(n),y&&s&&!this.agComponentUtils.doesImplementIComponent(y)&&(y=this.agComponentUtils.adaptFunction(l,y)),!y&&!D){a&&console.error(`AG Grid: Could not find component ${m}, did you forget to configure this component?`);return}const ir=this.mergeParamsWithApplicationProvidedParams(e,t,o,W),Hr=y==null,Bn=y||D;return{componentFromFramework:Hr,componentClass:Bn,params:ir,type:t,popupFromSelector:Ee,popupPositionFromSelector:dt,newAgStackInstance:()=>this.newAgStackInstance(Bn,Hr,ir,t)}}getCompKeys(e,t,n){const{propertyName:o}=t;let a,l,s,m,y,D;if(e){const W=e,Ee=W[o+"Selector"],dt=Ee?Ee(n):null,Ht=ir=>{typeof ir=="string"?a=ir:ir!=null&&ir!==!0&&(this.getFrameworkOverrides().isFrameworkComponent(ir)?s=ir:l=ir)};dt?(Ht(dt.component),m=dt.params,y=dt.popup,D=dt.popupPosition):Ht(W[o])}return{compName:a,jsComp:l,fwComp:s,paramsFromSelector:m,popupFromSelector:y,popupPositionFromSelector:D}}newAgStackInstance(e,t,n,o){const a=o.propertyName,l=!t;let s;if(l)s=new e;else{const y=this.componentMetadataProvider.retrieve(a);s=this.frameworkComponentWrapper.wrap(e,y.mandatoryMethodList,y.optionalMethodList,o)}const m=this.initComponent(s,n);return m==null?AgPromise.resolve(s):m.then(()=>s)}mergeParamsWithApplicationProvidedParams(e,t,n,o=null){const a={context:this.gridOptionsService.context,columnApi:this.gridOptionsService.columnApi,api:this.gridOptionsService.api};mergeDeep(a,n);const l=e,s=l&&l[t.propertyName+"Params"];if(typeof s=="function"){const m=s(n);mergeDeep(a,m)}else typeof s=="object"&&mergeDeep(a,s);return mergeDeep(a,o),a}initComponent(e,t){if(this.context.createBean(e),e.init!=null)return e.init(t)}getDefaultFloatingFilterType(e,t){if(e==null)return null;let n=null,{compName:o,jsComp:a,fwComp:l}=this.getCompKeys(e,FilterComponent);return o?n=FloatingFilterMapper.getFloatingFilterType(o):a==null&&l==null&&e.filter===!0&&(n=t()),n}};__decorate$1X([Autowired("gridOptions")],UserComponentFactory.prototype,"gridOptions",void 0);__decorate$1X([Autowired("agComponentUtils")],UserComponentFactory.prototype,"agComponentUtils",void 0);__decorate$1X([Autowired("componentMetadataProvider")],UserComponentFactory.prototype,"componentMetadataProvider",void 0);__decorate$1X([Autowired("userComponentRegistry")],UserComponentFactory.prototype,"userComponentRegistry",void 0);__decorate$1X([Optional("frameworkComponentWrapper")],UserComponentFactory.prototype,"frameworkComponentWrapper",void 0);UserComponentFactory=__decorate$1X([Bean("userComponentFactory")],UserComponentFactory);var ExcelFactoryMode;(function(r){r[r.SINGLE_SHEET=0]="SINGLE_SHEET",r[r.MULTI_SHEET=1]="MULTI_SHEET"})(ExcelFactoryMode||(ExcelFactoryMode={}));var __decorate$1W=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let DragService=class extends BeanStub{constructor(){super(...arguments),this.dragEndFunctions=[],this.dragSources=[]}removeAllListeners(){this.dragSources.forEach(this.removeListener.bind(this)),this.dragSources.length=0}removeListener(e){const t=e.dragSource.eElement,n=e.mouseDownListener;if(t.removeEventListener("mousedown",n),e.touchEnabled){const o=e.touchStartListener;t.removeEventListener("touchstart",o,{passive:!0})}}removeDragSource(e){const t=this.dragSources.find(n=>n.dragSource===e);t&&(this.removeListener(t),removeFromArray(this.dragSources,t))}isDragging(){return this.dragging}addDragSource(e){const t=this.onMouseDown.bind(this,e),{eElement:n,includeTouch:o,stopPropagationForTouch:a}=e;n.addEventListener("mousedown",t);let l=null;const s=this.gridOptionsService.is("suppressTouch");o&&!s&&(l=m=>{isFocusableFormField(m.target)||(m.cancelable&&(m.preventDefault(),a&&m.stopPropagation()),this.onTouchStart(e,m))},n.addEventListener("touchstart",l,{passive:!1})),this.dragSources.push({dragSource:e,mouseDownListener:t,touchStartListener:l,touchEnabled:!!o})}getStartTarget(){return this.startTarget}onTouchStart(e,t){this.currentDragParams=e,this.dragging=!1;const n=t.touches[0];this.touchLastTime=n,this.touchStart=n;const o=y=>this.onTouchMove(y,e.eElement),a=y=>this.onTouchUp(y,e.eElement),l=y=>{y.cancelable&&y.preventDefault()},s=t.target,m=[{target:this.gridOptionsService.getRootNode(),type:"touchmove",listener:l,options:{passive:!1}},{target:s,type:"touchmove",listener:o,options:{passive:!0}},{target:s,type:"touchend",listener:a,options:{passive:!0}},{target:s,type:"touchcancel",listener:a,options:{passive:!0}}];this.addTemporaryEvents(m),e.dragStartPixels===0&&this.onCommonMove(n,this.touchStart,e.eElement)}onMouseDown(e,t){const n=t;if(e.skipMouseEvent&&e.skipMouseEvent(t)||n._alreadyProcessedByDragService||(n._alreadyProcessedByDragService=!0,t.button!==0))return;this.shouldPreventMouseEvent(t)&&t.preventDefault(),this.currentDragParams=e,this.dragging=!1,this.mouseStartEvent=t,this.startTarget=t.target;const o=y=>this.onMouseMove(y,e.eElement),a=y=>this.onMouseUp(y,e.eElement),l=y=>y.preventDefault(),s=this.gridOptionsService.getRootNode(),m=[{target:s,type:"mousemove",listener:o},{target:s,type:"mouseup",listener:a},{target:s,type:"contextmenu",listener:l}];this.addTemporaryEvents(m),e.dragStartPixels===0&&this.onMouseMove(t,e.eElement)}addTemporaryEvents(e){e.forEach(t=>{const{target:n,type:o,listener:a,options:l}=t;n.addEventListener(o,a,l)}),this.dragEndFunctions.push(()=>{e.forEach(t=>{const{target:n,type:o,listener:a,options:l}=t;n.removeEventListener(o,a,l)})})}isEventNearStartEvent(e,t){const{dragStartPixels:n}=this.currentDragParams,o=exists(n)?n:4;return areEventsNear(e,t,o)}getFirstActiveTouch(e){for(let t=0;t<e.length;t++)if(e[t].identifier===this.touchStart.identifier)return e[t];return null}onCommonMove(e,t,n){if(!this.dragging){if(!this.dragging&&this.isEventNearStartEvent(e,t))return;this.dragging=!0;const o={type:Events.EVENT_DRAG_STARTED,target:n};this.eventService.dispatchEvent(o),this.currentDragParams.onDragStart(t),this.currentDragParams.onDragging(t)}this.currentDragParams.onDragging(e)}onTouchMove(e,t){const n=this.getFirstActiveTouch(e.touches);n&&this.onCommonMove(n,this.touchStart,t)}onMouseMove(e,t){this.shouldPreventMouseEvent(e)&&e.preventDefault(),this.onCommonMove(e,this.mouseStartEvent,t)}shouldPreventMouseEvent(e){const t=this.gridOptionsService.is("enableCellTextSelection"),n=isBrowserSafari(),o=e.type==="mousemove";return(t&&o||n)&&e.cancelable&&this.mouseEventService.isEventFromThisGrid(e)&&!this.isOverFormFieldElement(e)}isOverFormFieldElement(e){const t=e.target,n=t==null?void 0:t.tagName.toLocaleLowerCase();return!!(n!=null&&n.match("^a$|textarea|input|select|button"))}onTouchUp(e,t){let n=this.getFirstActiveTouch(e.changedTouches);n||(n=this.touchLastTime),this.onUpCommon(n,t)}onMouseUp(e,t){this.onUpCommon(e,t)}onUpCommon(e,t){if(this.dragging){this.dragging=!1,this.currentDragParams.onDragStop(e);const n={type:Events.EVENT_DRAG_STOPPED,target:t};this.eventService.dispatchEvent(n)}this.mouseStartEvent=null,this.startTarget=null,this.touchStart=null,this.touchLastTime=null,this.currentDragParams=null,this.dragEndFunctions.forEach(n=>n()),this.dragEndFunctions.length=0}};__decorate$1W([Autowired("mouseEventService")],DragService.prototype,"mouseEventService",void 0);__decorate$1W([PreDestroy],DragService.prototype,"removeAllListeners",null);DragService=__decorate$1W([Bean("dragService")],DragService);var RowHighlightPosition;(function(r){r[r.Above=0]="Above",r[r.Below=1]="Below"})(RowHighlightPosition||(RowHighlightPosition={}));var ClientSideRowModelSteps;(function(r){r.EVERYTHING="group",r.FILTER="filter",r.SORT="sort",r.MAP="map",r.AGGREGATE="aggregate",r.FILTER_AGGREGATES="filter_aggregates",r.PIVOT="pivot",r.NOTHING="nothing"})(ClientSideRowModelSteps||(ClientSideRowModelSteps={}));var __decorate$1V=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};function unwrapUserComp(r){const e=r;return e!=null&&e.getFrameworkComponentInstance!=null?e.getFrameworkComponentInstance():r}let GridApi=class{constructor(){this.detailGridInfoMap={},this.destroyCalled=!1}registerOverlayWrapperComp(e){this.overlayWrapperComp=e}registerSideBarComp(e){this.sideBarComp=e}init(){switch(this.rowModel.getType()){case"clientSide":this.clientSideRowModel=this.rowModel;break;case"infinite":this.infiniteRowModel=this.rowModel;break;case"serverSide":this.serverSideRowModel=this.rowModel;break}this.ctrlsService.whenReady(()=>{this.gridBodyCtrl=this.ctrlsService.getGridBodyCtrl()})}__getAlignedGridService(){return this.alignedGridsService}__getContext(){return this.context}getSetterMethod(e){return`set${e.charAt(0).toUpperCase()}${e.substring(1)}`}__setProperty(e,t){this.gridOptionsService.set(e,t);const n=this.getSetterMethod(e),o=this;o[n]&&o[n](t)}getGridId(){return this.context.getGridId()}addDetailGridInfo(e,t){this.detailGridInfoMap[e]=t}removeDetailGridInfo(e){this.detailGridInfoMap[e]=void 0}getDetailGridInfo(e){return this.detailGridInfoMap[e]}forEachDetailGridInfo(e){let t=0;iterateObject(this.detailGridInfoMap,(n,o)=>{exists(o)&&(e(o,t),t++)})}getDataAsCsv(e){if(ModuleRegistry.__assertRegistered(ModuleNames.CsvExportModule,"api.getDataAsCsv",this.context.getGridId()))return this.csvCreator.getDataAsCsv(e)}exportDataAsCsv(e){ModuleRegistry.__assertRegistered(ModuleNames.CsvExportModule,"api.exportDataAsCSv",this.context.getGridId())&&this.csvCreator.exportDataAsCsv(e)}getExcelExportMode(e){const t=this.gridOptionsService.get("defaultExcelExportParams");return Object.assign({exportMode:"xlsx"},t,e).exportMode}assertNotExcelMultiSheet(e,t){if(!ModuleRegistry.__assertRegistered(ModuleNames.ExcelExportModule,"api."+e,this.context.getGridId()))return!1;const n=this.getExcelExportMode(t);return this.excelCreator.getFactoryMode(n)===ExcelFactoryMode.MULTI_SHEET?(console.warn("AG Grid: The Excel Exporter is currently on Multi Sheet mode. End that operation by calling 'api.getMultipleSheetAsExcel()' or 'api.exportMultipleSheetsAsExcel()'"),!1):!0}getDataAsExcel(e){if(this.assertNotExcelMultiSheet("getDataAsExcel",e))return this.excelCreator.getDataAsExcel(e)}exportDataAsExcel(e){this.assertNotExcelMultiSheet("exportDataAsExcel",e)&&this.excelCreator.exportDataAsExcel(e)}getSheetDataForExcel(e){if(!ModuleRegistry.__assertRegistered(ModuleNames.ExcelExportModule,"api.getSheetDataForExcel",this.context.getGridId()))return;const t=this.getExcelExportMode(e);return this.excelCreator.setFactoryMode(ExcelFactoryMode.MULTI_SHEET,t),this.excelCreator.getSheetDataForExcel(e)}getMultipleSheetsAsExcel(e){if(ModuleRegistry.__assertRegistered(ModuleNames.ExcelExportModule,"api.getMultipleSheetsAsExcel",this.context.getGridId()))return this.excelCreator.getMultipleSheetsAsExcel(e)}exportMultipleSheetsAsExcel(e){if(ModuleRegistry.__assertRegistered(ModuleNames.ExcelExportModule,"api.exportMultipleSheetsAsExcel",this.context.getGridId()))return this.excelCreator.exportMultipleSheetsAsExcel(e)}setGridAriaProperty(e,t){if(!e)return;const n=this.ctrlsService.getGridBodyCtrl().getGui(),o=`aria-${e}`;t===null?n.removeAttribute(o):n.setAttribute(o,t)}logMissingRowModel(e,...t){console.error(`AG Grid: api.${e} can only be called when gridOptions.rowModelType is ${t.join(" or ")}`)}setServerSideDatasource(e){this.serverSideRowModel?this.serverSideRowModel.setDatasource(e):this.logMissingRowModel("setServerSideDatasource","serverSide")}setCacheBlockSize(e){this.serverSideRowModel?(this.gridOptionsService.set("cacheBlockSize",e),this.serverSideRowModel.resetRootStore()):this.logMissingRowModel("setCacheBlockSize","serverSide")}setDatasource(e){this.gridOptionsService.isRowModelType("infinite")?this.rowModel.setDatasource(e):this.logMissingRowModel("setDatasource","infinite")}setViewportDatasource(e){this.gridOptionsService.isRowModelType("viewport")?this.rowModel.setViewportDatasource(e):this.logMissingRowModel("setViewportDatasource","viewport")}setRowData(e){if(this.immutableService==null){this.logMissingRowModel("setRowData","clientSide");return}this.immutableService.isActive()?this.immutableService.setRowData(e):(this.selectionService.reset(),this.clientSideRowModel.setRowData(e))}setPinnedTopRowData(e){this.pinnedRowModel.setPinnedTopRowData(e)}setPinnedBottomRowData(e){this.pinnedRowModel.setPinnedBottomRowData(e)}getPinnedTopRowCount(){return this.pinnedRowModel.getPinnedTopRowCount()}getPinnedBottomRowCount(){return this.pinnedRowModel.getPinnedBottomRowCount()}getPinnedTopRow(e){return this.pinnedRowModel.getPinnedTopRow(e)}getPinnedBottomRow(e){return this.pinnedRowModel.getPinnedBottomRow(e)}setColumnDefs(e,t="api"){this.columnModel.setColumnDefs(e,t),this.gridOptionsService.set("columnDefs",e,!0,{source:t})}setAutoGroupColumnDef(e,t="api"){this.gridOptionsService.set("autoGroupColumnDef",e,!0,{source:t})}setDefaultColDef(e,t="api"){this.gridOptionsService.set("defaultColDef",e,!0,{source:t})}setColumnTypes(e,t="api"){this.gridOptionsService.set("columnTypes",e,!0,{source:t})}expireValueCache(){this.valueCache.expire()}getVerticalPixelRange(){return this.gridBodyCtrl.getScrollFeature().getVScrollPosition()}getHorizontalPixelRange(){return this.gridBodyCtrl.getScrollFeature().getHScrollPosition()}setAlwaysShowHorizontalScroll(e){this.gridOptionsService.set("alwaysShowHorizontalScroll",e)}setAlwaysShowVerticalScroll(e){this.gridOptionsService.set("alwaysShowVerticalScroll",e)}refreshCells(e={}){this.rowRenderer.refreshCells(e)}flashCells(e={}){this.rowRenderer.flashCells(e)}redrawRows(e={}){const t=e?e.rowNodes:void 0;this.rowRenderer.redrawRows(t)}setFunctionsReadOnly(e){this.gridOptionsService.set("functionsReadOnly",e)}refreshHeader(){this.ctrlsService.getHeaderRowContainerCtrls().forEach(e=>e.refresh())}isAnyFilterPresent(){return this.filterManager.isAnyFilterPresent()}isColumnFilterPresent(){return this.filterManager.isColumnFilterPresent()||this.filterManager.isAggregateFilterPresent()}isQuickFilterPresent(){return this.filterManager.isQuickFilterPresent()}getModel(){return this.rowModel}setRowNodeExpanded(e,t,n){e&&(n&&e.parent&&e.parent.level!==-1&&this.setRowNodeExpanded(e.parent,t,n),e.setExpanded(t))}onGroupExpandedOrCollapsed(){if(missing(this.clientSideRowModel)){this.logMissingRowModel("onGroupExpandedOrCollapsed","clientSide");return}this.clientSideRowModel.refreshModel({step:ClientSideRowModelSteps.MAP})}refreshClientSideRowModel(e){if(missing(this.clientSideRowModel)){this.logMissingRowModel("refreshClientSideRowModel","clientSide");return}this.clientSideRowModel.refreshModel(e)}isAnimationFrameQueueEmpty(){return this.animationFrameService.isQueueEmpty()}flushAllAnimationFrames(){this.animationFrameService.flushAllFrames()}getRowNode(e){return this.rowModel.getRowNode(e)}getSizesForCurrentTheme(){return{rowHeight:this.gridOptionsService.getRowHeightAsNumber(),headerHeight:this.columnModel.getHeaderHeight()}}expandAll(){this.clientSideRowModel?this.clientSideRowModel.expandOrCollapseAll(!0):this.serverSideRowModel?this.serverSideRowModel.expandAll(!0):this.logMissingRowModel("expandAll","clientSide","serverSide")}collapseAll(){this.clientSideRowModel?this.clientSideRowModel.expandOrCollapseAll(!1):this.serverSideRowModel?this.serverSideRowModel.expandAll(!1):this.logMissingRowModel("expandAll","clientSide","serverSide")}addRenderedRowListener(e,t,n){this.rowRenderer.addRenderedRowListener(e,t,n)}getQuickFilter(){return this.gridOptionsService.get("quickFilterText")}setQuickFilter(e){this.gridOptionsService.set("quickFilterText",e)}setExcludeHiddenColumnsFromQuickFilter(e){logDeprecation("30","setExcludeHiddenColumnsFromQuickFilter",void 0,"Hidden columns are now excluded from the Quick Filter by default. This can be toggled using `setIncludeHiddenColumnsInQuickFilter`"),this.setIncludeHiddenColumnsInQuickFilter(!e)}setIncludeHiddenColumnsInQuickFilter(e){this.gridOptionsService.set("includeHiddenColumnsInQuickFilter",e)}setNodesSelected(e){if(!e.nodes.every(s=>s.rowPinned?(console.warn("AG Grid: cannot select pinned rows"),!1):s.id===void 0?(console.warn("AG Grid: cannot select node until id for node is known"),!1):!0))return;const{nodes:n,source:o,newValue:a}=e,l=n;this.selectionService.setNodesSelected({nodes:l,source:o??"api",newValue:a})}selectAll(e="apiSelectAll"){this.selectionService.selectAllRowNodes({source:e})}deselectAll(e="apiSelectAll"){this.selectionService.deselectAllRowNodes({source:e})}selectAllFiltered(e="apiSelectAllFiltered"){this.selectionService.selectAllRowNodes({source:e,justFiltered:!0})}deselectAllFiltered(e="apiSelectAllFiltered"){this.selectionService.deselectAllRowNodes({source:e,justFiltered:!0})}getServerSideSelectionState(){return missing(this.serverSideRowModel)?(this.logMissingRowModel("getServerSideSelectionState","serverSide"),null):this.selectionService.getServerSideSelectionState()}setServerSideSelectionState(e){if(missing(this.serverSideRowModel)){this.logMissingRowModel("setServerSideSelectionState","serverSide");return}this.selectionService.setServerSideSelectionState(e)}selectAllOnCurrentPage(e="apiSelectAllCurrentPage"){this.selectionService.selectAllRowNodes({source:e,justCurrentPage:!0})}deselectAllOnCurrentPage(e="apiSelectAllCurrentPage"){this.selectionService.deselectAllRowNodes({source:e,justCurrentPage:!0})}sizeColumnsToFit(e){this.gridBodyCtrl.sizeColumnsToFit(e)}showLoadingOverlay(){this.overlayWrapperComp.showLoadingOverlay()}showNoRowsOverlay(){this.overlayWrapperComp.showNoRowsOverlay()}hideOverlay(){this.overlayWrapperComp.hideOverlay()}getSelectedNodes(){return this.selectionService.getSelectedNodes()}getSelectedRows(){return this.selectionService.getSelectedRows()}getBestCostNodeSelection(){if(missing(this.clientSideRowModel)){this.logMissingRowModel("getBestCostNodeSelection","clientSide");return}return this.selectionService.getBestCostNodeSelection()}getRenderedNodes(){return this.rowRenderer.getRenderedNodes()}ensureColumnVisible(e,t="auto"){this.gridBodyCtrl.getScrollFeature().ensureColumnVisible(e,t)}ensureIndexVisible(e,t){this.gridBodyCtrl.getScrollFeature().ensureIndexVisible(e,t)}ensureNodeVisible(e,t=null){this.gridBodyCtrl.getScrollFeature().ensureNodeVisible(e,t)}forEachLeafNode(e){if(missing(this.clientSideRowModel)){this.logMissingRowModel("forEachLeafNode","clientSide");return}this.clientSideRowModel.forEachLeafNode(e)}forEachNode(e,t){this.rowModel.forEachNode(e,t)}forEachNodeAfterFilter(e){if(missing(this.clientSideRowModel)){this.logMissingRowModel("forEachNodeAfterFilter","clientSide");return}this.clientSideRowModel.forEachNodeAfterFilter(e)}forEachNodeAfterFilterAndSort(e){if(missing(this.clientSideRowModel)){this.logMissingRowModel("forEachNodeAfterFilterAndSort","clientSide");return}this.clientSideRowModel.forEachNodeAfterFilterAndSort(e)}getFilterInstance(e,t){const n=this.getFilterInstanceImpl(e,a=>{if(!t)return;const l=unwrapUserComp(a);t(l)});return unwrapUserComp(n)}getFilterInstanceImpl(e,t){const n=this.columnModel.getPrimaryColumn(e);if(!n)return;const o=this.filterManager.getFilterComponent(n,"NO_UI"),a=o&&o.resolveNow(null,l=>l);return a?setTimeout(t,0,a):o&&o.then(l=>{t(l)}),a}destroyFilter(e){const t=this.columnModel.getPrimaryColumn(e);if(t)return this.filterManager.destroyFilter(t,"api")}getStatusPanel(e){if(!ModuleRegistry.__assertRegistered(ModuleNames.StatusBarModule,"api.getStatusPanel",this.context.getGridId()))return;const t=this.statusBarService.getStatusPanel(e);return unwrapUserComp(t)}getColumnDef(e){const t=this.columnModel.getPrimaryColumn(e);return t?t.getColDef():null}getColumnDefs(){return this.columnModel.getColumnDefs()}onFilterChanged(){this.filterManager.onFilterChanged()}onSortChanged(){this.sortController.onSortChanged("api")}setFilterModel(e){this.filterManager.setFilterModel(e)}getFilterModel(){return this.filterManager.getFilterModel()}getFocusedCell(){return this.focusService.getFocusedCell()}clearFocusedCell(){return this.focusService.clearFocusedCell()}setFocusedCell(e,t,n){this.focusService.setFocusedCell({rowIndex:e,column:t,rowPinned:n,forceBrowserFocus:!0})}setSuppressRowDrag(e){this.gridOptionsService.set("suppressRowDrag",e)}setSuppressMoveWhenRowDragging(e){this.gridOptionsService.set("suppressMoveWhenRowDragging",e)}setSuppressRowClickSelection(e){this.gridOptionsService.set("suppressRowClickSelection",e)}addRowDropZone(e){this.gridBodyCtrl.getRowDragFeature().addRowDropZone(e)}removeRowDropZone(e){const t=this.dragAndDropService.findExternalZone(e);t&&this.dragAndDropService.removeDropTarget(t)}getRowDropZoneParams(e){return this.gridBodyCtrl.getRowDragFeature().getRowDropZone(e)}setHeaderHeight(e){this.gridOptionsService.set("headerHeight",e)}setDomLayout(e){this.gridOptionsService.set("domLayout",e)}setEnableCellTextSelection(e){this.gridBodyCtrl.setCellTextSelection(e)}setFillHandleDirection(e){this.gridOptionsService.set("fillHandleDirection",e)}setGroupHeaderHeight(e){this.gridOptionsService.set("groupHeaderHeight",e)}setFloatingFiltersHeight(e){this.gridOptionsService.set("floatingFiltersHeight",e)}setPivotHeaderHeight(e){this.gridOptionsService.set("pivotHeaderHeight",e)}setPivotGroupHeaderHeight(e){this.gridOptionsService.set("pivotGroupHeaderHeight",e)}setPivotMode(e){this.columnModel.setPivotMode(e)}setAnimateRows(e){this.gridOptionsService.set("animateRows",e)}setIsExternalFilterPresent(e){this.gridOptionsService.set("isExternalFilterPresent",e)}setDoesExternalFilterPass(e){this.gridOptionsService.set("doesExternalFilterPass",e)}setNavigateToNextCell(e){this.gridOptionsService.set("navigateToNextCell",e)}setTabToNextCell(e){this.gridOptionsService.set("tabToNextCell",e)}setTabToNextHeader(e){this.gridOptionsService.set("tabToNextHeader",e)}setNavigateToNextHeader(e){this.gridOptionsService.set("navigateToNextHeader",e)}setRowGroupPanelShow(e){this.gridOptionsService.set("rowGroupPanelShow",e)}setGetGroupRowAgg(e){this.gridOptionsService.set("getGroupRowAgg",e)}setGetBusinessKeyForNode(e){this.gridOptionsService.set("getBusinessKeyForNode",e)}setGetChildCount(e){this.gridOptionsService.set("getChildCount",e)}setProcessRowPostCreate(e){this.gridOptionsService.set("processRowPostCreate",e)}setGetRowId(e){this.gridOptionsService.set("getRowId",e)}setGetRowClass(e){this.gridOptionsService.set("getRowClass",e)}setIsFullWidthRow(e){this.gridOptionsService.set("isFullWidthRow",e)}setIsRowSelectable(e){this.gridOptionsService.set("isRowSelectable",e)}setIsRowMaster(e){this.gridOptionsService.set("isRowMaster",e)}setPostSortRows(e){this.gridOptionsService.set("postSortRows",e)}setGetDocument(e){this.gridOptionsService.set("getDocument",e)}setGetContextMenuItems(e){this.gridOptionsService.set("getContextMenuItems",e)}setGetMainMenuItems(e){this.gridOptionsService.set("getMainMenuItems",e)}setProcessCellForClipboard(e){this.gridOptionsService.set("processCellForClipboard",e)}setSendToClipboard(e){this.gridOptionsService.set("sendToClipboard",e)}setProcessCellFromClipboard(e){this.gridOptionsService.set("processCellFromClipboard",e)}setProcessSecondaryColDef(e){logDeprecation("28.0","setProcessSecondaryColDef","setProcessPivotResultColDef"),this.setProcessPivotResultColDef(e)}setProcessSecondaryColGroupDef(e){logDeprecation("28.0","setProcessSecondaryColGroupDef","setProcessPivotResultColGroupDef"),this.setProcessPivotResultColGroupDef(e)}setProcessPivotResultColDef(e){this.gridOptionsService.set("processPivotResultColDef",e)}setProcessPivotResultColGroupDef(e){this.gridOptionsService.set("processPivotResultColGroupDef",e)}setPostProcessPopup(e){this.gridOptionsService.set("postProcessPopup",e)}setInitialGroupOrderComparator(e){this.gridOptionsService.set("initialGroupOrderComparator",e)}setGetChartToolbarItems(e){this.gridOptionsService.set("getChartToolbarItems",e)}setPaginationNumberFormatter(e){this.gridOptionsService.set("paginationNumberFormatter",e)}setGetServerSideStoreParams(e){logDeprecation("28.0","setGetServerSideStoreParams","setGetServerSideGroupLevelParams"),this.setGetServerSideGroupLevelParams(e)}setGetServerSideGroupLevelParams(e){this.gridOptionsService.set("getServerSideGroupLevelParams",e)}setIsServerSideGroupOpenByDefault(e){this.gridOptionsService.set("isServerSideGroupOpenByDefault",e)}setIsApplyServerSideTransaction(e){this.gridOptionsService.set("isApplyServerSideTransaction",e)}setIsServerSideGroup(e){this.gridOptionsService.set("isServerSideGroup",e)}setGetServerSideGroupKey(e){this.gridOptionsService.set("getServerSideGroupKey",e)}setGetRowStyle(e){this.gridOptionsService.set("getRowStyle",e)}setGetRowHeight(e){this.gridOptionsService.set("getRowHeight",e)}assertSideBarLoaded(e){return ModuleRegistry.__assertRegistered(ModuleNames.SideBarModule,"api."+e,this.context.getGridId())}isSideBarVisible(){return this.assertSideBarLoaded("isSideBarVisible")&&this.sideBarComp.isDisplayed()}setSideBarVisible(e){this.assertSideBarLoaded("setSideBarVisible")&&this.sideBarComp.setDisplayed(e)}setSideBarPosition(e){this.assertSideBarLoaded("setSideBarPosition")&&this.sideBarComp.setSideBarPosition(e)}openToolPanel(e){this.assertSideBarLoaded("openToolPanel")&&this.sideBarComp.openToolPanel(e,"api")}closeToolPanel(){this.assertSideBarLoaded("closeToolPanel")&&this.sideBarComp.close("api")}getOpenedToolPanel(){return this.assertSideBarLoaded("getOpenedToolPanel")?this.sideBarComp.openedItem():null}refreshToolPanel(){this.assertSideBarLoaded("refreshToolPanel")&&this.sideBarComp.refresh()}isToolPanelShowing(){return this.assertSideBarLoaded("isToolPanelShowing")&&this.sideBarComp.isToolPanelShowing()}getToolPanelInstance(e){if(this.assertSideBarLoaded("getToolPanelInstance")){const t=this.sideBarComp.getToolPanelInstance(e);return unwrapUserComp(t)}}getSideBar(){if(this.assertSideBarLoaded("getSideBar"))return this.sideBarComp.getDef()}setSideBar(e){this.gridOptionsService.set("sideBar",e)}setSuppressClipboardPaste(e){this.gridOptionsService.set("suppressClipboardPaste",e)}resetRowHeights(){if(exists(this.clientSideRowModel)){if(this.columnModel.isAutoRowHeightActive()){console.warn("AG Grid: calling gridApi.resetRowHeights() makes no sense when using Auto Row Height.");return}this.clientSideRowModel.resetRowHeights()}}setGroupRemoveSingleChildren(e){this.gridOptionsService.set("groupRemoveSingleChildren",e)}setGroupRemoveLowestSingleChildren(e){this.gridOptionsService.set("groupRemoveLowestSingleChildren",e)}setGroupDisplayType(e){this.gridOptionsService.set("groupDisplayType",e)}setRowClass(e){this.gridOptionsService.set("rowClass",e)}setDeltaSort(e){this.gridOptionsService.set("deltaSort",e)}setRowCount(e,t){if(this.serverSideRowModel){if(this.columnModel.isRowGroupEmpty()){this.serverSideRowModel.setRowCount(e,t);return}console.error("AG Grid: setRowCount cannot be used while using row grouping.");return}if(this.infiniteRowModel){this.infiniteRowModel.setRowCount(e,t);return}this.logMissingRowModel("setRowCount","infinite","serverSide")}onRowHeightChanged(){this.clientSideRowModel?this.clientSideRowModel.onRowHeightChanged():this.serverSideRowModel&&this.serverSideRowModel.onRowHeightChanged()}getValue(e,t){let n=this.columnModel.getPrimaryColumn(e);return missing(n)&&(n=this.columnModel.getGridColumn(e)),missing(n)?null:this.valueService.getValue(n,t)}addEventListener(e,t){const n=this.gridOptionsService.useAsyncEvents();this.eventService.addEventListener(e,t,n)}addGlobalListener(e){const t=this.gridOptionsService.useAsyncEvents();this.eventService.addGlobalListener(e,t)}removeEventListener(e,t){const n=this.gridOptionsService.useAsyncEvents();this.eventService.removeEventListener(e,t,n)}removeGlobalListener(e){const t=this.gridOptionsService.useAsyncEvents();this.eventService.removeGlobalListener(e,t)}dispatchEvent(e){this.eventService.dispatchEvent(e)}destroy(){if(this.destroyCalled)return;this.destroyCalled=!0;const e=this.ctrlsService.getGridCtrl();e&&e.destroyGridUi(),this.context.destroy()}cleanDownReferencesToAvoidMemoryLeakInCaseApplicationIsKeepingReferenceToDestroyedGrid(){setTimeout(removeAllReferences.bind(window,this,"Grid API"),100)}warnIfDestroyed(e){return this.destroyCalled&&console.warn(`AG Grid: Grid API method ${e} was called on a grid that was destroyed.`),this.destroyCalled}resetQuickFilter(){this.warnIfDestroyed("resetQuickFilter")||this.filterManager.resetQuickFilterCache()}getCellRanges(){return this.rangeService?this.rangeService.getCellRanges():(ModuleRegistry.__assertRegistered(ModuleNames.RangeSelectionModule,"api.getCellRanges",this.context.getGridId()),null)}addCellRange(e){if(this.rangeService){this.rangeService.addCellRange(e);return}ModuleRegistry.__assertRegistered(ModuleNames.RangeSelectionModule,"api.addCellRange",this.context.getGridId())}clearRangeSelection(){this.rangeService&&this.rangeService.removeAllCellRanges(),ModuleRegistry.__assertRegistered(ModuleNames.RangeSelectionModule,"gridApi.clearRangeSelection",this.context.getGridId())}undoCellEditing(){this.undoRedoService.undo("api")}redoCellEditing(){this.undoRedoService.redo("api")}getCurrentUndoSize(){return this.undoRedoService.getCurrentUndoStackSize()}getCurrentRedoSize(){return this.undoRedoService.getCurrentRedoStackSize()}getChartModels(){if(ModuleRegistry.__assertRegistered(ModuleNames.GridChartsModule,"api.getChartModels",this.context.getGridId()))return this.chartService.getChartModels()}getChartRef(e){if(ModuleRegistry.__assertRegistered(ModuleNames.GridChartsModule,"api.getChartRef",this.context.getGridId()))return this.chartService.getChartRef(e)}getChartImageDataURL(e){if(ModuleRegistry.__assertRegistered(ModuleNames.GridChartsModule,"api.getChartImageDataURL",this.context.getGridId()))return this.chartService.getChartImageDataURL(e)}downloadChart(e){if(ModuleRegistry.__assertRegistered(ModuleNames.GridChartsModule,"api.downloadChart",this.context.getGridId()))return this.chartService.downloadChart(e)}openChartToolPanel(e){if(ModuleRegistry.__assertRegistered(ModuleNames.GridChartsModule,"api.openChartToolPanel",this.context.getGridId()))return this.chartService.openChartToolPanel(e)}closeChartToolPanel(e){if(ModuleRegistry.__assertRegistered(ModuleNames.GridChartsModule,"api.closeChartToolPanel",this.context.getGridId()))return this.chartService.closeChartToolPanel(e.chartId)}createRangeChart(e){if(ModuleRegistry.__assertRegistered(ModuleNames.GridChartsModule,"api.createRangeChart",this.context.getGridId()))return this.chartService.createRangeChart(e)}createPivotChart(e){if(ModuleRegistry.__assertRegistered(ModuleNames.GridChartsModule,"api.createPivotChart",this.context.getGridId()))return this.chartService.createPivotChart(e)}createCrossFilterChart(e){if(ModuleRegistry.__assertRegistered(ModuleNames.GridChartsModule,"api.createCrossFilterChart",this.context.getGridId()))return this.chartService.createCrossFilterChart(e)}updateChart(e){ModuleRegistry.__assertRegistered(ModuleNames.GridChartsModule,"api.updateChart",this.context.getGridId())&&this.chartService.updateChart(e)}restoreChart(e,t){if(ModuleRegistry.__assertRegistered(ModuleNames.GridChartsModule,"api.restoreChart",this.context.getGridId()))return this.chartService.restoreChart(e,t)}copyToClipboard(e){ModuleRegistry.__assertRegistered(ModuleNames.ClipboardModule,"api.copyToClipboard",this.context.getGridId())&&this.clipboardService.copyToClipboard(e)}cutToClipboard(e){ModuleRegistry.__assertRegistered(ModuleNames.ClipboardModule,"api.cutToClipboard",this.context.getGridId())&&this.clipboardService.cutToClipboard(e,"api")}copySelectedRowsToClipboard(e){ModuleRegistry.__assertRegistered(ModuleNames.ClipboardModule,"api.copySelectedRowsToClipboard",this.context.getGridId())&&this.clipboardService.copySelectedRowsToClipboard(e)}copySelectedRangeToClipboard(e){ModuleRegistry.__assertRegistered(ModuleNames.ClipboardModule,"api.copySelectedRangeToClipboard",this.context.getGridId())&&this.clipboardService.copySelectedRangeToClipboard(e)}copySelectedRangeDown(){ModuleRegistry.__assertRegistered(ModuleNames.ClipboardModule,"api.copySelectedRangeDown",this.context.getGridId())&&this.clipboardService.copyRangeDown()}pasteFromClipboard(){ModuleRegistry.__assertRegistered(ModuleNames.ClipboardModule,"api.pasteFromClipboard",this.context.getGridId())&&this.clipboardService.pasteFromClipboard()}showColumnMenuAfterButtonClick(e,t){const n=this.columnModel.getGridColumn(e);this.menuFactory.showMenuAfterButtonClick(n,t,"columnMenu")}showColumnMenuAfterMouseClick(e,t){let n=this.columnModel.getGridColumn(e);if(n||(n=this.columnModel.getPrimaryColumn(e)),!n){console.error(`AG Grid: column '${e}' not found`);return}this.menuFactory.showMenuAfterMouseEvent(n,t)}hidePopupMenu(){this.contextMenuFactory&&this.contextMenuFactory.hideActiveMenu(),this.menuFactory.hideActiveMenu()}setPopupParent(e){this.gridOptionsService.set("popupParent",e)}tabToNextCell(e){return this.navigationService.tabToNextCell(!1,e)}tabToPreviousCell(e){return this.navigationService.tabToNextCell(!0,e)}getCellRendererInstances(e={}){return this.rowRenderer.getCellRendererInstances(e).map(unwrapUserComp)}getCellEditorInstances(e={}){return this.rowRenderer.getCellEditorInstances(e).map(unwrapUserComp)}getEditingCells(){return this.rowRenderer.getEditingCells()}stopEditing(e=!1){this.rowRenderer.stopEditing(e)}startEditingCell(e){const t=this.columnModel.getGridColumn(e.colKey);if(!t){console.warn(`AG Grid: no column found for ${e.colKey}`);return}const n={rowIndex:e.rowIndex,rowPinned:e.rowPinned||null,column:t};e.rowPinned==null&&this.gridBodyCtrl.getScrollFeature().ensureIndexVisible(e.rowIndex);const a=this.navigationService.getCellByPosition(n);a&&a.startRowOrCellEdit(e.key)}addAggFunc(e,t){this.aggFuncService&&this.aggFuncService.addAggFunc(e,t)}addAggFuncs(e){this.aggFuncService&&this.aggFuncService.addAggFuncs(e)}clearAggFuncs(){this.aggFuncService&&this.aggFuncService.clear()}applyServerSideTransaction(e){if(!this.serverSideTransactionManager){this.logMissingRowModel("applyServerSideTransaction","serverSide");return}return this.serverSideTransactionManager.applyTransaction(e)}applyServerSideTransactionAsync(e,t){if(!this.serverSideTransactionManager){this.logMissingRowModel("applyServerSideTransactionAsync","serverSide");return}return this.serverSideTransactionManager.applyTransactionAsync(e,t)}retryServerSideLoads(){if(!this.serverSideRowModel){this.logMissingRowModel("retryServerSideLoads","serverSide");return}this.serverSideRowModel.retryLoads()}flushServerSideAsyncTransactions(){if(!this.serverSideTransactionManager){this.logMissingRowModel("flushServerSideAsyncTransactions","serverSide");return}return this.serverSideTransactionManager.flushAsyncTransactions()}applyTransaction(e){if(!this.clientSideRowModel){this.logMissingRowModel("applyTransaction","clientSide");return}return this.clientSideRowModel.updateRowData(e)}applyTransactionAsync(e,t){if(!this.clientSideRowModel){this.logMissingRowModel("applyTransactionAsync","clientSide");return}this.clientSideRowModel.batchUpdateRowData(e,t)}flushAsyncTransactions(){if(!this.clientSideRowModel){this.logMissingRowModel("flushAsyncTransactions","clientSide");return}this.clientSideRowModel.flushAsyncTransactions()}setSuppressModelUpdateAfterUpdateTransaction(e){this.gridOptionsService.set("suppressModelUpdateAfterUpdateTransaction",e)}refreshInfiniteCache(){this.infiniteRowModel?this.infiniteRowModel.refreshCache():this.logMissingRowModel("refreshInfiniteCache","infinite")}purgeInfiniteCache(){this.infiniteRowModel?this.infiniteRowModel.purgeCache():this.logMissingRowModel("purgeInfiniteCache","infinite")}refreshServerSide(e){if(!this.serverSideRowModel){this.logMissingRowModel("refreshServerSide","serverSide");return}this.serverSideRowModel.refreshStore(e)}refreshServerSideStore(e){return logDeprecation("28.0","refreshServerSideStore","refreshServerSide"),this.refreshServerSide(e)}getServerSideStoreState(){return logDeprecation("28.0","getServerSideStoreState","getServerSideGroupLevelState"),this.getServerSideGroupLevelState()}getServerSideGroupLevelState(){return this.serverSideRowModel?this.serverSideRowModel.getStoreState():(this.logMissingRowModel("getServerSideGroupLevelState","serverSide"),[])}getInfiniteRowCount(){if(this.infiniteRowModel)return this.infiniteRowModel.getRowCount();this.logMissingRowModel("getInfiniteRowCount","infinite")}isLastRowIndexKnown(){if(this.infiniteRowModel)return this.infiniteRowModel.isLastRowIndexKnown();this.logMissingRowModel("isLastRowIndexKnown","infinite")}getCacheBlockState(){return this.rowNodeBlockLoader.getBlockState()}getFirstDisplayedRow(){return this.rowRenderer.getFirstVirtualRenderedRow()}getLastDisplayedRow(){return this.rowRenderer.getLastVirtualRenderedRow()}getDisplayedRowAtIndex(e){return this.rowModel.getRow(e)}getDisplayedRowCount(){return this.rowModel.getRowCount()}setDataTypeDefinitions(e){this.gridOptionsService.set("dataTypeDefinitions",e)}setPagination(e){this.gridOptionsService.set("pagination",e)}paginationIsLastPageFound(){return this.paginationProxy.isLastPageFound()}paginationGetPageSize(){return this.paginationProxy.getPageSize()}paginationSetPageSize(e){this.gridOptionsService.set("paginationPageSize",e)}paginationGetCurrentPage(){return this.paginationProxy.getCurrentPage()}paginationGetTotalPages(){return this.paginationProxy.getTotalPages()}paginationGetRowCount(){return this.paginationProxy.getMasterRowCount()}paginationGoToNextPage(){this.paginationProxy.goToNextPage()}paginationGoToPreviousPage(){this.paginationProxy.goToPreviousPage()}paginationGoToFirstPage(){this.paginationProxy.goToFirstPage()}paginationGoToLastPage(){this.paginationProxy.goToLastPage()}paginationGoToPage(e){this.paginationProxy.goToPage(e)}};__decorate$1V([Optional("immutableService")],GridApi.prototype,"immutableService",void 0);__decorate$1V([Optional("csvCreator")],GridApi.prototype,"csvCreator",void 0);__decorate$1V([Optional("excelCreator")],GridApi.prototype,"excelCreator",void 0);__decorate$1V([Autowired("rowRenderer")],GridApi.prototype,"rowRenderer",void 0);__decorate$1V([Autowired("navigationService")],GridApi.prototype,"navigationService",void 0);__decorate$1V([Autowired("filterManager")],GridApi.prototype,"filterManager",void 0);__decorate$1V([Autowired("columnModel")],GridApi.prototype,"columnModel",void 0);__decorate$1V([Autowired("selectionService")],GridApi.prototype,"selectionService",void 0);__decorate$1V([Autowired("gridOptionsService")],GridApi.prototype,"gridOptionsService",void 0);__decorate$1V([Autowired("valueService")],GridApi.prototype,"valueService",void 0);__decorate$1V([Autowired("alignedGridsService")],GridApi.prototype,"alignedGridsService",void 0);__decorate$1V([Autowired("eventService")],GridApi.prototype,"eventService",void 0);__decorate$1V([Autowired("pinnedRowModel")],GridApi.prototype,"pinnedRowModel",void 0);__decorate$1V([Autowired("context")],GridApi.prototype,"context",void 0);__decorate$1V([Autowired("rowModel")],GridApi.prototype,"rowModel",void 0);__decorate$1V([Autowired("sortController")],GridApi.prototype,"sortController",void 0);__decorate$1V([Autowired("paginationProxy")],GridApi.prototype,"paginationProxy",void 0);__decorate$1V([Autowired("focusService")],GridApi.prototype,"focusService",void 0);__decorate$1V([Autowired("dragAndDropService")],GridApi.prototype,"dragAndDropService",void 0);__decorate$1V([Optional("rangeService")],GridApi.prototype,"rangeService",void 0);__decorate$1V([Optional("clipboardService")],GridApi.prototype,"clipboardService",void 0);__decorate$1V([Optional("aggFuncService")],GridApi.prototype,"aggFuncService",void 0);__decorate$1V([Autowired("menuFactory")],GridApi.prototype,"menuFactory",void 0);__decorate$1V([Optional("contextMenuFactory")],GridApi.prototype,"contextMenuFactory",void 0);__decorate$1V([Autowired("valueCache")],GridApi.prototype,"valueCache",void 0);__decorate$1V([Autowired("animationFrameService")],GridApi.prototype,"animationFrameService",void 0);__decorate$1V([Optional("statusBarService")],GridApi.prototype,"statusBarService",void 0);__decorate$1V([Optional("chartService")],GridApi.prototype,"chartService",void 0);__decorate$1V([Optional("undoRedoService")],GridApi.prototype,"undoRedoService",void 0);__decorate$1V([Optional("rowNodeBlockLoader")],GridApi.prototype,"rowNodeBlockLoader",void 0);__decorate$1V([Optional("ssrmTransactionManager")],GridApi.prototype,"serverSideTransactionManager",void 0);__decorate$1V([Autowired("ctrlsService")],GridApi.prototype,"ctrlsService",void 0);__decorate$1V([PostConstruct],GridApi.prototype,"init",null);__decorate$1V([PreDestroy],GridApi.prototype,"cleanDownReferencesToAvoidMemoryLeakInCaseApplicationIsKeepingReferenceToDestroyedGrid",null);GridApi=__decorate$1V([Bean("gridApi")],GridApi);var __decorate$1U=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},FilterManager_1;let FilterManager=FilterManager_1=class extends BeanStub{constructor(){super(...arguments),this.allColumnFilters=new Map,this.allColumnListeners=new Map,this.activeAggregateFilters=[],this.activeColumnFilters=[],this.quickFilter=null,this.quickFilterParts=null,this.processingFilterChange=!1}init(){this.addManagedListener(this.eventService,Events.EVENT_GRID_COLUMNS_CHANGED,()=>this.onColumnsChanged()),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_VALUE_CHANGED,()=>this.refreshFiltersForAggregations()),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_PIVOT_CHANGED,()=>this.refreshFiltersForAggregations()),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_PIVOT_MODE_CHANGED,()=>{this.refreshFiltersForAggregations(),this.resetQuickFilterCache()}),this.addManagedListener(this.eventService,Events.EVENT_NEW_COLUMNS_LOADED,()=>this.resetQuickFilterCache()),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_ROW_GROUP_CHANGED,()=>this.resetQuickFilterCache()),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_VISIBLE,()=>{this.gridOptionsService.is("includeHiddenColumnsInQuickFilter")||this.resetQuickFilterCache()}),this.addManagedPropertyListener("quickFilterText",e=>this.setQuickFilter(e.currentValue)),this.addManagedPropertyListener("includeHiddenColumnsInQuickFilter",()=>this.onIncludeHiddenColumnsInQuickFilterChanged()),this.quickFilter=this.parseQuickFilter(this.gridOptionsService.get("quickFilterText")),this.setQuickFilterParts(),this.allowShowChangeAfterFilter=this.gridOptionsService.is("allowShowChangeAfterFilter"),this.externalFilterPresent=this.isExternalFilterPresentCallback(),this.updateAggFiltering(),this.addManagedPropertyListener("groupAggFiltering",()=>this.updateAggFiltering())}isExternalFilterPresentCallback(){const e=this.gridOptionsService.getCallback("isExternalFilterPresent");return typeof e=="function"?e({}):!1}doesExternalFilterPass(e){const t=this.gridOptionsService.get("doesExternalFilterPass");return typeof t=="function"?t(e):!1}setQuickFilterParts(){this.quickFilterParts=this.quickFilter?this.quickFilter.split(" "):null}setFilterModel(e){const t=[],n=this.getFilterModel();if(e){const o=convertToSet(Object.keys(e));this.allColumnFilters.forEach((a,l)=>{const s=e[l];t.push(this.setModelOnFilterWrapper(a.filterPromise,s)),o.delete(l)}),o.forEach(a=>{const l=this.columnModel.getPrimaryColumn(a)||this.columnModel.getGridColumn(a);if(!l){console.warn("AG Grid: setFilterModel() - no column found for colId: "+a);return}if(!l.isFilterAllowed()){console.warn("AG Grid: setFilterModel() - unable to fully apply model, filtering disabled for colId: "+a);return}const s=this.getOrCreateFilterWrapper(l,"NO_UI");if(!s){console.warn("AG-Grid: setFilterModel() - unable to fully apply model, unable to create filter for colId: "+a);return}t.push(this.setModelOnFilterWrapper(s.filterPromise,e[a]))})}else this.allColumnFilters.forEach(o=>{t.push(this.setModelOnFilterWrapper(o.filterPromise,null))});AgPromise.all(t).then(()=>{const o=this.getFilterModel(),a=[];this.allColumnFilters.forEach((l,s)=>{const m=n?n[s]:null,y=o?o[s]:null;_.jsonEquals(m,y)||a.push(l.column)}),a.length>0&&this.onFilterChanged({columns:a})})}setModelOnFilterWrapper(e,t){return new AgPromise(n=>{e.then(o=>{typeof o.setModel!="function"&&(console.warn("AG Grid: filter missing setModel method, which is needed for setFilterModel"),n()),(o.setModel(t)||AgPromise.resolve()).then(()=>n())})})}getFilterModel(){const e={};return this.allColumnFilters.forEach((t,n)=>{const a=t.filterPromise.resolveNow(null,s=>s);if(a==null)return null;if(typeof a.getModel!="function"){console.warn("AG Grid: filter API missing getModel method, which is needed for getFilterModel");return}const l=a.getModel();exists(l)&&(e[n]=l)}),e}isColumnFilterPresent(){return this.activeColumnFilters.length>0}isAggregateFilterPresent(){return!!this.activeAggregateFilters.length}isExternalFilterPresent(){return this.externalFilterPresent}doAggregateFiltersPass(e,t){return this.doColumnFiltersPass(e,t,!0)}updateActiveFilters(){this.activeColumnFilters.length=0,this.activeAggregateFilters.length=0;const e=o=>o?o.isFilterActive?o.isFilterActive():(console.warn("AG Grid: Filter is missing isFilterActive() method"),!1):!1,t=!!this.gridOptionsService.getGroupAggFiltering(),n=o=>{if(!o.isPrimary())return!0;const l=!this.columnModel.isPivotActive();return!o.isValueActive()||!l?!1:this.columnModel.isPivotMode()?!0:t};this.allColumnFilters.forEach(o=>{if(o.filterPromise.resolveNow(!1,e)){const a=o.filterPromise.resolveNow(null,l=>l);n(o.column)?this.activeAggregateFilters.push(a):this.activeColumnFilters.push(a)}})}updateFilterFlagInColumns(e,t){this.allColumnFilters.forEach(n=>{const o=n.filterPromise.resolveNow(!1,a=>a.isFilterActive());n.column.setFilterActive(o,e,t)})}isAnyFilterPresent(){return this.isQuickFilterPresent()||this.isColumnFilterPresent()||this.isAggregateFilterPresent()||this.isExternalFilterPresent()}doColumnFiltersPass(e,t,n){const{data:o,aggData:a}=e,l=n?this.activeAggregateFilters:this.activeColumnFilters,s=n?a:o;for(let m=0;m<l.length;m++){const y=l[m];if(!(y==null||y===t)){if(typeof y.doesFilterPass!="function")throw new Error("Filter is missing method doesFilterPass");if(!y.doesFilterPass({node:e,data:s}))return!1}}return!0}parseQuickFilter(e){return exists(e)?this.gridOptionsService.isRowModelType("clientSide")?e.toUpperCase():(console.warn("AG Grid - Quick filtering only works with the Client-Side Row Model"),null):null}setQuickFilter(e){if(e!=null&&typeof e!="string"){console.warn(`AG Grid - setQuickFilter() only supports string inputs, received: ${typeof e}`);return}const t=this.parseQuickFilter(e);this.quickFilter!==t&&(this.quickFilter=t,this.setQuickFilterParts(),this.onFilterChanged())}resetQuickFilterCache(){this.rowModel.forEachNode(e=>e.quickFilterAggregateText=null)}onIncludeHiddenColumnsInQuickFilterChanged(){this.columnModel.refreshQuickFilterColumns(),this.resetQuickFilterCache(),this.isQuickFilterPresent()&&this.onFilterChanged()}refreshFiltersForAggregations(){this.gridOptionsService.getGroupAggFiltering()&&this.onFilterChanged()}callOnFilterChangedOutsideRenderCycle(e={}){const t=()=>this.onFilterChanged(e);this.rowRenderer.isRefreshInProgress()?setTimeout(t,0):t()}onFilterChanged(e={}){const{filterInstance:t,additionalEventAttributes:n,columns:o}=e;this.updateDependantFilters(),this.updateActiveFilters(),this.updateFilterFlagInColumns("filterChanged",n),this.externalFilterPresent=this.isExternalFilterPresentCallback(),this.allColumnFilters.forEach(l=>{l.filterPromise&&l.filterPromise.then(s=>{s&&s!==t&&s.onAnyFilterChanged&&s.onAnyFilterChanged()})});const a={type:Events.EVENT_FILTER_CHANGED,columns:o||[]};n&&mergeDeep(a,n),this.processingFilterChange=!0,this.eventService.dispatchEvent(a),this.processingFilterChange=!1}isSuppressFlashingCellsBecauseFiltering(){return!this.allowShowChangeAfterFilter&&this.processingFilterChange}isQuickFilterPresent(){return this.quickFilter!==null}updateAggFiltering(){this.aggFiltering=!!this.gridOptionsService.getGroupAggFiltering()}isAggregateQuickFilterPresent(){return this.isQuickFilterPresent()&&(this.aggFiltering||this.columnModel.isPivotMode())}isNonAggregateQuickFilterPresent(){return this.isQuickFilterPresent()&&!(this.aggFiltering||this.columnModel.isPivotMode())}doesRowPassOtherFilters(e,t){return this.doesRowPassFilter({rowNode:t,filterInstanceToSkip:e})}doesRowPassQuickFilterNoCache(e,t){return this.columnModel.getAllColumnsForQuickFilter().some(o=>{const a=this.getQuickFilterTextForColumn(o,e);return exists(a)&&a.indexOf(t)>=0})}doesRowPassQuickFilterCache(e,t){return e.quickFilterAggregateText||this.aggregateRowForQuickFilter(e),e.quickFilterAggregateText.indexOf(t)>=0}doesRowPassQuickFilter(e){const t=this.gridOptionsService.is("cacheQuickFilter");return this.quickFilterParts.every(n=>t?this.doesRowPassQuickFilterCache(e,n):this.doesRowPassQuickFilterNoCache(e,n))}doesRowPassAggregateFilters(e){return!(this.isAggregateQuickFilterPresent()&&!this.doesRowPassQuickFilter(e.rowNode)||this.isAggregateFilterPresent()&&!this.doAggregateFiltersPass(e.rowNode,e.filterInstanceToSkip))}doesRowPassFilter(e){return!(this.isNonAggregateQuickFilterPresent()&&!this.doesRowPassQuickFilter(e.rowNode)||this.isExternalFilterPresent()&&!this.doesExternalFilterPass(e.rowNode)||this.isColumnFilterPresent()&&!this.doColumnFiltersPass(e.rowNode,e.filterInstanceToSkip))}getQuickFilterTextForColumn(e,t){let n=this.valueService.getValue(e,t,!0);const o=e.getColDef();if(o.getQuickFilterText){const a={value:n,node:t,data:t.data,column:e,colDef:o,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context};n=o.getQuickFilterText(a)}return exists(n)?n.toString().toUpperCase():null}aggregateRowForQuickFilter(e){const t=[];this.columnModel.getAllColumnsForQuickFilter().forEach(o=>{const a=this.getQuickFilterTextForColumn(o,e);exists(a)&&t.push(a)}),e.quickFilterAggregateText=t.join(FilterManager_1.QUICK_FILTER_SEPARATOR)}onNewRowsLoaded(e){this.allColumnFilters.forEach(t=>{t.filterPromise.then(n=>{n.onNewRowsLoaded&&n.onNewRowsLoaded()})}),this.updateFilterFlagInColumns(e,{afterDataChange:!0}),this.updateActiveFilters()}createValueGetter(e){return({node:t})=>this.valueService.getValue(e,t,!0)}getFilterComponent(e,t,n=!0){var o;if(n)return((o=this.getOrCreateFilterWrapper(e,t))===null||o===void 0?void 0:o.filterPromise)||null;const a=this.cachedFilter(e);return a?a.filterPromise:null}isFilterActive(e){const t=this.cachedFilter(e);return!!t&&t.filterPromise.resolveNow(!1,n=>n.isFilterActive())}getOrCreateFilterWrapper(e,t){if(!e.isFilterAllowed())return null;let n=this.cachedFilter(e);if(n)t!=="NO_UI"&&this.putIntoGui(n,t);else{n=this.createFilterWrapper(e,t);const o=e.getColId();this.allColumnFilters.set(o,n),this.allColumnListeners.set(o,this.addManagedListener(e,Column.EVENT_COL_DEF_CHANGED,()=>this.checkDestroyFilter(o)))}return n}cachedFilter(e){return this.allColumnFilters.get(e.getColId())}getDefaultFilter(e){let t;if(ModuleRegistry.__isRegistered(ModuleNames.SetFilterModule,this.context.getGridId()))t="agSetColumnFilter";else{const n=e.getColDef().cellDataType;n==="number"?t="agNumberColumnFilter":n==="date"||n==="dateString"?t="agDateColumnFilter":t="agTextColumnFilter"}return t}getDefaultFloatingFilter(e){let t;if(ModuleRegistry.__isRegistered(ModuleNames.SetFilterModule,this.context.getGridId()))t="agSetColumnFloatingFilter";else{const n=e.getColDef().cellDataType;n==="number"?t="agNumberColumnFloatingFilter":n==="date"||n==="dateString"?t="agDateColumnFloatingFilter":t="agTextColumnFloatingFilter"}return t}createFilterInstance(e){const t=this.getDefaultFilter(e),n=e.getColDef();let o;const a=Object.assign(Object.assign({},this.createFilterParams(e,n)),{filterModifiedCallback:()=>{const s={type:Events.EVENT_FILTER_MODIFIED,column:e,filterInstance:o};this.eventService.dispatchEvent(s)},filterChangedCallback:s=>{const m={filterInstance:o,additionalEventAttributes:s,columns:[e]};this.callOnFilterChangedOutsideRenderCycle(m)},doesRowPassOtherFilter:s=>this.doesRowPassOtherFilters(o,s)}),l=this.userComponentFactory.getFilterDetails(n,a,t);return l?{filterPromise:()=>{const s=l.newAgStackInstance();return s&&s.then(m=>o=m),s},compDetails:l}:{filterPromise:null,compDetails:null}}createFilterParams(e,t){return{column:e,colDef:cloneObject(t),rowModel:this.rowModel,filterChangedCallback:()=>{},filterModifiedCallback:()=>{},valueGetter:this.createValueGetter(e),doesRowPassOtherFilter:()=>!0,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context}}createFilterWrapper(e,t){var n;const o={column:e,filterPromise:null,compiledElement:null,guiPromise:AgPromise.resolve(null),compDetails:null},{filterPromise:a,compDetails:l}=this.createFilterInstance(e);return o.filterPromise=(n=a==null?void 0:a())!==null&&n!==void 0?n:null,o.compDetails=l,a&&this.putIntoGui(o,t),o}putIntoGui(e,t){const n=document.createElement("div");n.className="ag-filter",e.guiPromise=new AgPromise(o=>{e.filterPromise.then(a=>{let l=a.getGui();exists(l)||console.warn(`AG Grid: getGui method from filter returned ${l}, it should be a DOM element or an HTML template string.`),typeof l=="string"&&(l=loadTemplate(l)),n.appendChild(l),o(n);const s={type:Events.EVENT_FILTER_OPENED,column:e.column,source:t,eGui:n};this.eventService.dispatchEvent(s)})})}onColumnsChanged(){const e=[];this.allColumnFilters.forEach((t,n)=>{let o;t.column.isPrimary()?o=this.columnModel.getPrimaryColumn(n):o=this.columnModel.getGridColumn(n),!o&&(e.push(t.column),this.disposeFilterWrapper(t,"columnChanged"),this.disposeColumnListener(n))}),e.length>0?this.onFilterChanged({columns:e}):this.updateDependantFilters()}updateDependantFilters(){const e=this.columnModel.getGroupAutoColumns();e==null||e.forEach(t=>{t.getColDef().filter==="agGroupColumnFilter"&&this.getOrCreateFilterWrapper(t,"NO_UI")})}isFilterAllowed(e){var t,n;if(!e.isFilterAllowed())return!1;const a=this.allColumnFilters.get(e.getColId());return(n=(t=a==null?void 0:a.filterPromise)===null||t===void 0?void 0:t.resolveNow(!0,l=>{var s,m;return typeof((s=l)===null||s===void 0?void 0:s.isFilterAllowed)=="function"?(m=l)===null||m===void 0?void 0:m.isFilterAllowed():!0}))!==null&&n!==void 0?n:!0}getFloatingFilterCompDetails(e,t){const n=e.getColDef(),o=this.createFilterParams(e,n),a=this.userComponentFactory.mergeParamsWithApplicationProvidedParams(n,FilterComponent,o);let l=this.userComponentFactory.getDefaultFloatingFilterType(n,()=>this.getDefaultFloatingFilter(e));l==null&&(l="agReadOnlyFloatingFilter");const m={column:e,filterParams:a,currentParentModel:()=>this.getCurrentFloatingFilterParentModel(e),parentFilterInstance:y=>{const D=this.getFilterComponent(e,"NO_UI");D!=null&&D.then(W=>{y(unwrapUserComp(W))})},showParentFilter:t,suppressFilterButton:!1};return this.userComponentFactory.getFloatingFilterCompDetails(n,m,l)}getCurrentFloatingFilterParentModel(e){const t=this.getFilterComponent(e,"NO_UI",!1);return t?t.resolveNow(null,n=>n&&n.getModel()):null}destroyFilter(e,t="api"){const n=e.getColId(),o=this.allColumnFilters.get(n);this.disposeColumnListener(n),o&&(this.disposeFilterWrapper(o,t),this.onFilterChanged({columns:[e]}))}disposeColumnListener(e){const t=this.allColumnListeners.get(e);t&&(this.allColumnListeners.delete(e),t())}disposeFilterWrapper(e,t){e.filterPromise.then(n=>{(n.setModel(null)||AgPromise.resolve()).then(()=>{this.getContext().destroyBean(n),e.column.setFilterActive(!1,"filterDestroyed"),this.allColumnFilters.delete(e.column.getColId());const o={type:Events.EVENT_FILTER_DESTROYED,source:t,column:e.column};this.eventService.dispatchEvent(o)})})}checkDestroyFilter(e){const t=this.allColumnFilters.get(e);if(!t)return;const n=t.column,{compDetails:o}=n.isFilterAllowed()?this.createFilterInstance(n):{compDetails:null};((l,s)=>{if(!s||!l)return!0;const{componentClass:m}=l,{componentClass:y}=s;return!(m===y||(m==null?void 0:m.render)&&(y==null?void 0:y.render)&&m.render===y.render)})(t.compDetails,o)&&this.destroyFilter(n,"columnChanged")}destroy(){super.destroy(),this.allColumnFilters.forEach(e=>this.disposeFilterWrapper(e,"gridDestroyed")),this.allColumnListeners.clear()}};FilterManager.QUICK_FILTER_SEPARATOR=`
`;__decorate$1U([Autowired("valueService")],FilterManager.prototype,"valueService",void 0);__decorate$1U([Autowired("columnModel")],FilterManager.prototype,"columnModel",void 0);__decorate$1U([Autowired("rowModel")],FilterManager.prototype,"rowModel",void 0);__decorate$1U([Autowired("userComponentFactory")],FilterManager.prototype,"userComponentFactory",void 0);__decorate$1U([Autowired("rowRenderer")],FilterManager.prototype,"rowRenderer",void 0);__decorate$1U([PostConstruct],FilterManager.prototype,"init",null);FilterManager=FilterManager_1=__decorate$1U([Bean("filterManager")],FilterManager);class AbstractHeaderCellComp extends Component{constructor(e,t){super(e),this.ctrl=t}getCtrl(){return this.ctrl}}var __decorate$1T=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class HeaderFilterCellComp extends AbstractHeaderCellComp{constructor(e){super(HeaderFilterCellComp.TEMPLATE,e)}postConstruct(){const e=this.getGui(),t={addOrRemoveCssClass:(n,o)=>this.addOrRemoveCssClass(n,o),addOrRemoveBodyCssClass:(n,o)=>this.eFloatingFilterBody.classList.toggle(n,o),setButtonWrapperDisplayed:n=>setDisplayed(this.eButtonWrapper,n),setCompDetails:n=>this.setCompDetails(n),getFloatingFilterComp:()=>this.compPromise,setWidth:n=>e.style.width=n,setMenuIcon:n=>this.eButtonShowMainFilter.appendChild(n)};this.ctrl.setComp(t,e,this.eButtonShowMainFilter,this.eFloatingFilterBody)}setCompDetails(e){if(!e){this.destroyFloatingFilterComp(),this.compPromise=null;return}this.compPromise=e.newAgStackInstance(),this.compPromise.then(t=>this.afterCompCreated(t))}destroyFloatingFilterComp(){this.floatingFilterComp&&(this.eFloatingFilterBody.removeChild(this.floatingFilterComp.getGui()),this.floatingFilterComp=this.destroyBean(this.floatingFilterComp))}afterCompCreated(e){if(e){if(!this.isAlive()){this.destroyBean(e);return}this.destroyFloatingFilterComp(),this.floatingFilterComp=e,this.eFloatingFilterBody.appendChild(e.getGui()),e.afterGuiAttached&&e.afterGuiAttached()}}}HeaderFilterCellComp.TEMPLATE=`<div class="ag-header-cell ag-floating-filter" role="gridcell" tabindex="-1">
            <div ref="eFloatingFilterBody" role="presentation"></div>
            <div class="ag-floating-filter-button ag-hidden" ref="eButtonWrapper" role="presentation">
                <button type="button" class="ag-button ag-floating-filter-button-button" ref="eButtonShowMainFilter" tabindex="-1"></button>
            </div>
        </div>`;__decorate$1T([RefSelector("eFloatingFilterBody")],HeaderFilterCellComp.prototype,"eFloatingFilterBody",void 0);__decorate$1T([RefSelector("eButtonWrapper")],HeaderFilterCellComp.prototype,"eButtonWrapper",void 0);__decorate$1T([RefSelector("eButtonShowMainFilter")],HeaderFilterCellComp.prototype,"eButtonShowMainFilter",void 0);__decorate$1T([PostConstruct],HeaderFilterCellComp.prototype,"postConstruct",null);__decorate$1T([PreDestroy],HeaderFilterCellComp.prototype,"destroyFloatingFilterComp",null);var __decorate$1S=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},LayoutCssClasses;(function(r){r.AUTO_HEIGHT="ag-layout-auto-height",r.NORMAL="ag-layout-normal",r.PRINT="ag-layout-print"})(LayoutCssClasses||(LayoutCssClasses={}));class LayoutFeature extends BeanStub{constructor(e){super(),this.view=e}postConstruct(){this.addManagedPropertyListener("domLayout",this.updateLayoutClasses.bind(this)),this.updateLayoutClasses()}updateLayoutClasses(){const e=this.getDomLayout(),t={autoHeight:e==="autoHeight",normal:e==="normal",print:e==="print"},n=t.autoHeight?LayoutCssClasses.AUTO_HEIGHT:t.print?LayoutCssClasses.PRINT:LayoutCssClasses.NORMAL;this.view.updateLayoutClasses(n,t)}getDomLayout(){var e;const t=(e=this.gridOptionsService.get("domLayout"))!==null&&e!==void 0?e:"normal";return["normal","print","autoHeight"].indexOf(t)===-1?(doOnce(()=>console.warn(`AG Grid: ${t} is not valid for DOM Layout, valid values are 'normal', 'autoHeight', 'print'.`),"warn about dom layout values"),"normal"):t}}__decorate$1S([PostConstruct],LayoutFeature.prototype,"postConstruct",null);var __decorate$1R=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},ScrollDirection;(function(r){r[r.Vertical=0]="Vertical",r[r.Horizontal=1]="Horizontal"})(ScrollDirection||(ScrollDirection={}));var ScrollSource;(function(r){r[r.Container=0]="Container",r[r.FakeContainer=1]="FakeContainer"})(ScrollSource||(ScrollSource={}));class GridBodyScrollFeature extends BeanStub{constructor(e){super(),this.lastScrollSource=[null,null],this.scrollLeft=-1,this.nextScrollTop=-1,this.scrollTop=-1,this.eBodyViewport=e,this.resetLastHScrollDebounced=debounce(()=>this.lastScrollSource[ScrollDirection.Horizontal]=null,500),this.resetLastVScrollDebounced=debounce(()=>this.lastScrollSource[ScrollDirection.Vertical]=null,500)}postConstruct(){this.enableRtl=this.gridOptionsService.is("enableRtl"),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED,this.onDisplayedColumnsWidthChanged.bind(this)),this.ctrlsService.whenReady(e=>{this.centerRowContainerCtrl=e.centerRowContainerCtrl,this.onDisplayedColumnsWidthChanged(),this.addScrollListener()})}addScrollListener(){const e=this.ctrlsService.getFakeHScrollComp(),t=this.ctrlsService.getFakeVScrollComp();this.addManagedListener(this.centerRowContainerCtrl.getViewportElement(),"scroll",this.onHScroll.bind(this)),e.onScrollCallback(this.onFakeHScroll.bind(this));const n=this.gridOptionsService.is("debounceVerticalScrollbar"),o=n?debounce(this.onVScroll.bind(this),100):this.onVScroll.bind(this),a=n?debounce(this.onFakeVScroll.bind(this),100):this.onFakeVScroll.bind(this);this.addManagedListener(this.eBodyViewport,"scroll",o),t.onScrollCallback(a)}onDisplayedColumnsWidthChanged(){this.enableRtl&&this.horizontallyScrollHeaderCenterAndFloatingCenter()}horizontallyScrollHeaderCenterAndFloatingCenter(e){if(this.centerRowContainerCtrl==null)return;e===void 0&&(e=this.centerRowContainerCtrl.getCenterViewportScrollLeft());const n=this.enableRtl?e:-e,o=this.ctrlsService.getTopCenterRowContainerCtrl(),a=this.ctrlsService.getStickyTopCenterRowContainerCtrl(),l=this.ctrlsService.getBottomCenterRowContainerCtrl(),s=this.ctrlsService.getFakeHScrollComp();this.ctrlsService.getHeaderRowContainerCtrl().setHorizontalScroll(-n),l.setContainerTranslateX(n),o.setContainerTranslateX(n),a.setContainerTranslateX(n);const y=this.centerRowContainerCtrl.getViewportElement(),D=this.lastScrollSource[ScrollDirection.Horizontal]===ScrollSource.Container;e=Math.abs(e),D?s.setScrollPosition(e):setScrollLeft(y,e,this.enableRtl)}isControllingScroll(e,t){return this.lastScrollSource[t]==null?(this.lastScrollSource[t]=e,!0):this.lastScrollSource[t]===e}onFakeHScroll(){this.isControllingScroll(ScrollSource.FakeContainer,ScrollDirection.Horizontal)&&this.onHScrollCommon(ScrollSource.FakeContainer)}onHScroll(){this.isControllingScroll(ScrollSource.Container,ScrollDirection.Horizontal)&&this.onHScrollCommon(ScrollSource.Container)}onHScrollCommon(e){const t=this.centerRowContainerCtrl.getViewportElement(),{scrollLeft:n}=t;if(this.shouldBlockScrollUpdate(ScrollDirection.Horizontal,n,!0))return;let o;e===ScrollSource.Container?o=getScrollLeft(t,this.enableRtl):o=this.ctrlsService.getFakeHScrollComp().getScrollPosition(),this.doHorizontalScroll(Math.round(o)),this.resetLastHScrollDebounced()}onFakeVScroll(){this.isControllingScroll(ScrollSource.FakeContainer,ScrollDirection.Vertical)&&this.onVScrollCommon(ScrollSource.FakeContainer)}onVScroll(){this.isControllingScroll(ScrollSource.Container,ScrollDirection.Vertical)&&this.onVScrollCommon(ScrollSource.Container)}onVScrollCommon(e){let t;e===ScrollSource.Container?t=this.eBodyViewport.scrollTop:t=this.ctrlsService.getFakeVScrollComp().getScrollPosition(),!this.shouldBlockScrollUpdate(ScrollDirection.Vertical,t,!0)&&(this.animationFrameService.setScrollTop(t),this.nextScrollTop=t,e===ScrollSource.Container?this.ctrlsService.getFakeVScrollComp().setScrollPosition(t):this.eBodyViewport.scrollTop=t,this.gridOptionsService.is("suppressAnimationFrame")?this.scrollGridIfNeeded():this.animationFrameService.schedule(),this.resetLastVScrollDebounced())}doHorizontalScroll(e){const t=this.ctrlsService.getFakeHScrollComp().getScrollPosition();this.scrollLeft===e&&e===t||(this.scrollLeft=e,this.fireScrollEvent(ScrollDirection.Horizontal),this.horizontallyScrollHeaderCenterAndFloatingCenter(e),this.onHorizontalViewportChanged())}fireScrollEvent(e){const t={type:Events.EVENT_BODY_SCROLL,direction:e===ScrollDirection.Horizontal?"horizontal":"vertical",left:this.scrollLeft,top:this.scrollTop};this.eventService.dispatchEvent(t),window.clearTimeout(this.scrollTimer),this.scrollTimer=void 0,this.scrollTimer=window.setTimeout(()=>{const n=Object.assign(Object.assign({},t),{type:Events.EVENT_BODY_SCROLL_END});this.eventService.dispatchEvent(n)},100)}shouldBlockScrollUpdate(e,t,n=!1){return n&&!isIOSUserAgent()?!1:e===ScrollDirection.Vertical?this.shouldBlockVerticalScroll(t):this.shouldBlockHorizontalScroll(t)}shouldBlockVerticalScroll(e){const t=getInnerHeight(this.eBodyViewport),{scrollHeight:n}=this.eBodyViewport;return e<0||e+t>n}shouldBlockHorizontalScroll(e){const t=this.centerRowContainerCtrl.getCenterWidth(),{scrollWidth:n}=this.centerRowContainerCtrl.getViewportElement();if(this.enableRtl&&isRtlNegativeScroll()){if(e>0)return!0}else if(e<0)return!0;return Math.abs(e)+t>n}redrawRowsAfterScroll(){this.fireScrollEvent(ScrollDirection.Vertical)}onHorizontalViewportChanged(){this.centerRowContainerCtrl.onHorizontalViewportChanged()}checkScrollLeft(){this.scrollLeft!==this.centerRowContainerCtrl.getCenterViewportScrollLeft()&&this.onHScrollCommon(ScrollSource.Container)}scrollGridIfNeeded(){const e=this.scrollTop!=this.nextScrollTop;return e&&(this.scrollTop=this.nextScrollTop,this.redrawRowsAfterScroll()),e}setHorizontalScrollPosition(e,t=!1){const o=this.centerRowContainerCtrl.getViewportElement().scrollWidth-this.centerRowContainerCtrl.getCenterWidth();!t&&this.shouldBlockScrollUpdate(ScrollDirection.Horizontal,e)&&(this.enableRtl&&isRtlNegativeScroll()?e=e>0?0:o:e=Math.min(Math.max(e,0),o)),setScrollLeft(this.centerRowContainerCtrl.getViewportElement(),Math.abs(e),this.enableRtl),this.doHorizontalScroll(e)}setVerticalScrollPosition(e){this.eBodyViewport.scrollTop=e}getVScrollPosition(){return{top:this.eBodyViewport.scrollTop,bottom:this.eBodyViewport.scrollTop+this.eBodyViewport.offsetHeight}}getHScrollPosition(){return this.centerRowContainerCtrl.getHScrollPosition()}isHorizontalScrollShowing(){return this.centerRowContainerCtrl.isHorizontalScrollShowing()}scrollHorizontally(e){const t=this.centerRowContainerCtrl.getViewportElement().scrollLeft;return this.setHorizontalScrollPosition(t+e),this.centerRowContainerCtrl.getViewportElement().scrollLeft-t}scrollToTop(){this.eBodyViewport.scrollTop=0}ensureNodeVisible(e,t=null){const n=this.rowModel.getRowCount();let o=-1;for(let a=0;a<n;a++){const l=this.rowModel.getRow(a);if(typeof e=="function"){if(l&&e(l)){o=a;break}}else if(e===l||e===l.data){o=a;break}}o>=0&&this.ensureIndexVisible(o,t)}ensureIndexVisible(e,t){if(this.gridOptionsService.isDomLayout("print"))return;const n=this.paginationProxy.getRowCount();if(typeof e!="number"||e<0||e>=n){console.warn("AG Grid: Invalid row index for ensureIndexVisible: "+e);return}this.gridOptionsService.is("pagination")&&!this.gridOptionsService.is("suppressPaginationPanel")||this.paginationProxy.goToPageWithIndex(e);const s=this.ctrlsService.getGridBodyCtrl().getStickyTopHeight(),m=this.paginationProxy.getRow(e);let y;do{const D=m.rowTop,W=m.rowHeight,Ee=this.paginationProxy.getPixelOffset(),dt=m.rowTop-Ee,Ht=dt+m.rowHeight,ir=this.getVScrollPosition(),Hr=this.heightScaler.getDivStretchOffset(),Bn=ir.top+Hr,Vn=ir.bottom+Hr,Wr=Vn-Bn,ps=this.heightScaler.getScrollPositionForPixel(dt),il=this.heightScaler.getScrollPositionForPixel(Ht-Wr),gl=Math.min((ps+il)/2,dt),ml=Bn+s>dt,sl=Vn<Ht;let ll=null;t==="top"?ll=ps:t==="bottom"?ll=il:t==="middle"?ll=gl:ml?ll=ps-s:sl&&(ll=il),ll!==null&&(this.setVerticalScrollPosition(ll),this.rowRenderer.redraw()),y=D!==m.rowTop||W!==m.rowHeight}while(y);this.animationFrameService.flushAllFrames()}ensureColumnVisible(e,t="auto"){const n=this.columnModel.getGridColumn(e);if(!n||n.isPinned()||!this.columnModel.isColumnDisplayed(n))return;const o=this.getPositionedHorizontalScroll(n,t);o!==null&&this.centerRowContainerCtrl.setCenterViewportScrollLeft(o),this.centerRowContainerCtrl.onHorizontalViewportChanged(),this.animationFrameService.flushAllFrames()}getPositionedHorizontalScroll(e,t){const{columnBeforeStart:n,columnAfterEnd:o}=this.isColumnOutsideViewport(e),a=this.centerRowContainerCtrl.getCenterWidth()<e.getActualWidth(),l=this.centerRowContainerCtrl.getCenterWidth(),s=this.enableRtl;let m=(s?n:o)||a,y=s?o:n;t!=="auto"&&(m=t==="start",y=t==="end");const D=t==="middle";if(m||y||D){const{colLeft:W,colMiddle:Ee,colRight:dt}=this.getColumnBounds(e);return D?Ee-l/2:m?s?dt:W:s?W-l:dt-l}return null}isColumnOutsideViewport(e){const{start:t,end:n}=this.getViewportBounds(),{colLeft:o,colRight:a}=this.getColumnBounds(e),l=this.enableRtl,s=l?t>a:n<a,m=l?n<o:t>o;return{columnBeforeStart:s,columnAfterEnd:m}}getColumnBounds(e){const t=this.enableRtl,n=this.columnModel.getBodyContainerWidth(),o=e.getActualWidth(),a=e.getLeft(),l=t?-1:1,s=t?n-a:a,m=s+o*l,y=s+o/2*l;return{colLeft:s,colMiddle:y,colRight:m}}getViewportBounds(){const e=this.centerRowContainerCtrl.getCenterWidth(),t=this.centerRowContainerCtrl.getCenterViewportScrollLeft(),n=t,o=e+t;return{start:n,end:o,width:e}}}__decorate$1R([Autowired("ctrlsService")],GridBodyScrollFeature.prototype,"ctrlsService",void 0);__decorate$1R([Autowired("animationFrameService")],GridBodyScrollFeature.prototype,"animationFrameService",void 0);__decorate$1R([Autowired("paginationProxy")],GridBodyScrollFeature.prototype,"paginationProxy",void 0);__decorate$1R([Autowired("rowModel")],GridBodyScrollFeature.prototype,"rowModel",void 0);__decorate$1R([Autowired("rowContainerHeightService")],GridBodyScrollFeature.prototype,"heightScaler",void 0);__decorate$1R([Autowired("rowRenderer")],GridBodyScrollFeature.prototype,"rowRenderer",void 0);__decorate$1R([Autowired("columnModel")],GridBodyScrollFeature.prototype,"columnModel",void 0);__decorate$1R([PostConstruct],GridBodyScrollFeature.prototype,"postConstruct",null);class AutoScrollService{constructor(e){this.tickingInterval=null,this.onScrollCallback=null,this.scrollContainer=e.scrollContainer,this.scrollHorizontally=e.scrollAxis.indexOf("x")!==-1,this.scrollVertically=e.scrollAxis.indexOf("y")!==-1,this.scrollByTick=e.scrollByTick!=null?e.scrollByTick:20,e.onScrollCallback&&(this.onScrollCallback=e.onScrollCallback),this.scrollVertically&&(this.getVerticalPosition=e.getVerticalPosition,this.setVerticalPosition=e.setVerticalPosition),this.scrollHorizontally&&(this.getHorizontalPosition=e.getHorizontalPosition,this.setHorizontalPosition=e.setHorizontalPosition),this.shouldSkipVerticalScroll=e.shouldSkipVerticalScroll||(()=>!1),this.shouldSkipHorizontalScroll=e.shouldSkipHorizontalScroll||(()=>!1)}check(e,t=!1){const n=t||this.shouldSkipVerticalScroll();if(n&&this.shouldSkipHorizontalScroll())return;const o=this.scrollContainer.getBoundingClientRect(),a=this.scrollByTick;this.tickLeft=e.clientX<o.left+a,this.tickRight=e.clientX>o.right-a,this.tickUp=e.clientY<o.top+a&&!n,this.tickDown=e.clientY>o.bottom-a&&!n,this.tickLeft||this.tickRight||this.tickUp||this.tickDown?this.ensureTickingStarted():this.ensureCleared()}ensureTickingStarted(){this.tickingInterval===null&&(this.tickingInterval=window.setInterval(this.doTick.bind(this),100),this.tickCount=0)}doTick(){this.tickCount++;let e;if(e=this.tickCount>20?200:this.tickCount>10?80:40,this.scrollVertically){const t=this.getVerticalPosition();this.tickUp&&this.setVerticalPosition(t-e),this.tickDown&&this.setVerticalPosition(t+e)}if(this.scrollHorizontally){const t=this.getHorizontalPosition();this.tickLeft&&this.setHorizontalPosition(t-e),this.tickRight&&this.setHorizontalPosition(t+e)}this.onScrollCallback&&this.onScrollCallback()}ensureCleared(){this.tickingInterval&&(window.clearInterval(this.tickingInterval),this.tickingInterval=null)}}var __decorate$1Q=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class RowDragFeature extends BeanStub{constructor(e){super(),this.isMultiRowDrag=!1,this.isGridSorted=!1,this.isGridFiltered=!1,this.isRowGroupActive=!1,this.eContainer=e}postConstruct(){this.gridOptionsService.isRowModelType("clientSide")&&(this.clientSideRowModel=this.rowModel);const e=()=>{this.onSortChanged(),this.onFilterChanged(),this.onRowGroupChanged()};this.addManagedListener(this.eventService,Events.EVENT_SORT_CHANGED,this.onSortChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_FILTER_CHANGED,this.onFilterChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_ROW_GROUP_CHANGED,this.onRowGroupChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_MODEL_UPDATED,()=>{e()}),e(),this.ctrlsService.whenReady(()=>{const t=this.ctrlsService.getGridBodyCtrl();this.autoScrollService=new AutoScrollService({scrollContainer:t.getBodyViewportElement(),scrollAxis:"y",getVerticalPosition:()=>t.getScrollFeature().getVScrollPosition().top,setVerticalPosition:n=>t.getScrollFeature().setVerticalScrollPosition(n),onScrollCallback:()=>{this.onDragging(this.lastDraggingEvent)}})})}onSortChanged(){this.isGridSorted=this.sortController.isSortActive()}onFilterChanged(){this.isGridFiltered=this.filterManager.isAnyFilterPresent()}onRowGroupChanged(){const e=this.columnModel.getRowGroupColumns();this.isRowGroupActive=!missingOrEmpty(e)}getContainer(){return this.eContainer}isInterestedIn(e){return e===DragSourceType.RowDrag}getIconName(){return this.gridOptionsService.is("rowDragManaged")&&this.shouldPreventRowMove()?DragAndDropService.ICON_NOT_ALLOWED:DragAndDropService.ICON_MOVE}shouldPreventRowMove(){return this.isGridSorted||this.isGridFiltered||this.isRowGroupActive}getRowNodes(e){if(!this.isFromThisGrid(e))return e.dragItem.rowNodes||[];const t=this.gridOptionsService.is("rowDragMultiRow"),n=[...this.selectionService.getSelectedNodes()].sort((a,l)=>a.rowIndex==null||l.rowIndex==null?0:this.getRowIndexNumber(a)-this.getRowIndexNumber(l)),o=e.dragItem.rowNode;return t&&n.indexOf(o)!==-1?(this.isMultiRowDrag=!0,n):(this.isMultiRowDrag=!1,[o])}onDragEnter(e){e.dragItem.rowNodes=this.getRowNodes(e),this.dispatchGridEvent(Events.EVENT_ROW_DRAG_ENTER,e),this.getRowNodes(e).forEach(t=>{t.setDragging(!0)}),this.onEnterOrDragging(e)}onDragging(e){this.onEnterOrDragging(e)}isFromThisGrid(e){const{dragSourceDomDataKey:t}=e.dragSource;return t===this.gridOptionsService.getDomDataKey()}isDropZoneWithinThisGrid(e){const n=this.ctrlsService.getGridBodyCtrl().getGui(),{dropZoneTarget:o}=e;return!n.contains(o)}onEnterOrDragging(e){this.dispatchGridEvent(Events.EVENT_ROW_DRAG_MOVE,e),this.lastDraggingEvent=e;const t=this.mouseEventService.getNormalisedPosition(e).y;this.gridOptionsService.is("rowDragManaged")&&this.doManagedDrag(e,t),this.autoScrollService.check(e.event)}doManagedDrag(e,t){const n=this.isFromThisGrid(e),o=this.gridOptionsService.is("rowDragManaged"),a=e.dragItem.rowNodes;o&&this.shouldPreventRowMove()||(this.gridOptionsService.is("suppressMoveWhenRowDragging")||!n?this.isDropZoneWithinThisGrid(e)||this.clientSideRowModel.highlightRowAtPixel(a[0],t):this.moveRows(a,t))}getRowIndexNumber(e){return parseInt(last(e.getRowIndexString().split("-")),10)}moveRowAndClearHighlight(e){const t=this.clientSideRowModel.getLastHighlightedRowNode(),n=t&&t.highlighted===RowHighlightPosition.Below,o=this.mouseEventService.getNormalisedPosition(e).y,a=e.dragItem.rowNodes;let l=n?1:0;if(this.isFromThisGrid(e))a.forEach(s=>{s.rowTop<o&&(l-=1)}),this.moveRows(a,o,l);else{const s=this.gridOptionsService.getCallback("getRowId");let m=this.clientSideRowModel.getRowIndexAtPixel(o)+1;this.clientSideRowModel.getHighlightPosition(o)===RowHighlightPosition.Above&&m--,this.clientSideRowModel.updateRowData({add:a.map(y=>y.data).filter(y=>!this.clientSideRowModel.getRowNode(s?s({data:y,level:0}):y.id)),addIndex:m})}this.clearRowHighlight()}clearRowHighlight(){this.clientSideRowModel.highlightRowAtPixel(null)}moveRows(e,t,n=0){this.clientSideRowModel.ensureRowsAtPixel(e,t,n)&&(this.focusService.clearFocusedCell(),this.rangeService&&this.rangeService.removeAllCellRanges())}addRowDropZone(e){if(!e.getContainer()){doOnce(()=>console.warn("AG Grid: addRowDropZone - A container target needs to be provided"),"add-drop-zone-empty-target");return}if(this.dragAndDropService.findExternalZone(e)){console.warn("AG Grid: addRowDropZone - target already exists in the list of DropZones. Use `removeRowDropZone` before adding it again.");return}let t={getContainer:e.getContainer};e.fromGrid?(e.fromGrid=void 0,t=e):(e.onDragEnter&&(t.onDragEnter=n=>{e.onDragEnter(this.draggingToRowDragEvent(Events.EVENT_ROW_DRAG_ENTER,n))}),e.onDragLeave&&(t.onDragLeave=n=>{e.onDragLeave(this.draggingToRowDragEvent(Events.EVENT_ROW_DRAG_LEAVE,n))}),e.onDragging&&(t.onDragging=n=>{e.onDragging(this.draggingToRowDragEvent(Events.EVENT_ROW_DRAG_MOVE,n))}),e.onDragStop&&(t.onDragStop=n=>{e.onDragStop(this.draggingToRowDragEvent(Events.EVENT_ROW_DRAG_END,n))})),this.dragAndDropService.addDropTarget(Object.assign({isInterestedIn:n=>n===DragSourceType.RowDrag,getIconName:()=>DragAndDropService.ICON_MOVE,external:!0},t))}getRowDropZone(e){const t=this.getContainer.bind(this),n=this.onDragEnter.bind(this),o=this.onDragLeave.bind(this),a=this.onDragging.bind(this),l=this.onDragStop.bind(this);return e?{getContainer:t,onDragEnter:e.onDragEnter?s=>{n(s),e.onDragEnter(this.draggingToRowDragEvent(Events.EVENT_ROW_DRAG_ENTER,s))}:n,onDragLeave:e.onDragLeave?s=>{o(s),e.onDragLeave(this.draggingToRowDragEvent(Events.EVENT_ROW_DRAG_LEAVE,s))}:o,onDragging:e.onDragging?s=>{a(s),e.onDragging(this.draggingToRowDragEvent(Events.EVENT_ROW_DRAG_MOVE,s))}:a,onDragStop:e.onDragStop?s=>{l(s),e.onDragStop(this.draggingToRowDragEvent(Events.EVENT_ROW_DRAG_END,s))}:l,fromGrid:!0}:{getContainer:t,onDragEnter:n,onDragLeave:o,onDragging:a,onDragStop:l,fromGrid:!0}}draggingToRowDragEvent(e,t){const n=this.mouseEventService.getNormalisedPosition(t).y,o=n>this.paginationProxy.getCurrentPageHeight();let a=-1,l;o||(a=this.rowModel.getRowIndexAtPixel(n),l=this.rowModel.getRow(a));let s;switch(t.vDirection){case VerticalDirection.Down:s="down";break;case VerticalDirection.Up:s="up";break;default:s=null;break}return{type:e,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context,event:t.event,node:t.dragItem.rowNode,nodes:t.dragItem.rowNodes,overIndex:a,overNode:l,y:n,vDirection:s}}dispatchGridEvent(e,t){const n=this.draggingToRowDragEvent(e,t);this.eventService.dispatchEvent(n)}onDragLeave(e){this.dispatchGridEvent(Events.EVENT_ROW_DRAG_LEAVE,e),this.stopDragging(e),this.gridOptionsService.is("rowDragManaged")&&this.clearRowHighlight(),this.isFromThisGrid(e)&&(this.isMultiRowDrag=!1)}onDragStop(e){this.dispatchGridEvent(Events.EVENT_ROW_DRAG_END,e),this.stopDragging(e),this.gridOptionsService.is("rowDragManaged")&&(this.gridOptionsService.is("suppressMoveWhenRowDragging")||!this.isFromThisGrid(e))&&!this.isDropZoneWithinThisGrid(e)&&this.moveRowAndClearHighlight(e)}stopDragging(e){this.autoScrollService.ensureCleared(),this.getRowNodes(e).forEach(t=>{t.setDragging(!1)})}}__decorate$1Q([Autowired("dragAndDropService")],RowDragFeature.prototype,"dragAndDropService",void 0);__decorate$1Q([Autowired("rowModel")],RowDragFeature.prototype,"rowModel",void 0);__decorate$1Q([Autowired("paginationProxy")],RowDragFeature.prototype,"paginationProxy",void 0);__decorate$1Q([Autowired("columnModel")],RowDragFeature.prototype,"columnModel",void 0);__decorate$1Q([Autowired("focusService")],RowDragFeature.prototype,"focusService",void 0);__decorate$1Q([Autowired("sortController")],RowDragFeature.prototype,"sortController",void 0);__decorate$1Q([Autowired("filterManager")],RowDragFeature.prototype,"filterManager",void 0);__decorate$1Q([Autowired("selectionService")],RowDragFeature.prototype,"selectionService",void 0);__decorate$1Q([Autowired("mouseEventService")],RowDragFeature.prototype,"mouseEventService",void 0);__decorate$1Q([Autowired("ctrlsService")],RowDragFeature.prototype,"ctrlsService",void 0);__decorate$1Q([Optional("rangeService")],RowDragFeature.prototype,"rangeService",void 0);__decorate$1Q([PostConstruct],RowDragFeature.prototype,"postConstruct",null);var __decorate$1P=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},RowAnimationCssClasses;(function(r){r.ANIMATION_ON="ag-row-animation",r.ANIMATION_OFF="ag-row-no-animation"})(RowAnimationCssClasses||(RowAnimationCssClasses={}));const CSS_CLASS_FORCE_VERTICAL_SCROLL="ag-force-vertical-scroll",CSS_CLASS_CELL_SELECTABLE="ag-selectable",CSS_CLASS_COLUMN_MOVING="ag-column-moving";class GridBodyCtrl extends BeanStub{constructor(){super(...arguments),this.stickyTopHeight=0}getScrollFeature(){return this.bodyScrollFeature}getBodyViewportElement(){return this.eBodyViewport}setComp(e,t,n,o,a,l){this.comp=e,this.eGridBody=t,this.eBodyViewport=n,this.eTop=o,this.eBottom=a,this.eStickyTop=l,this.setCellTextSelection(this.gridOptionsService.is("enableCellTextSelection")),this.createManagedBean(new LayoutFeature(this.comp)),this.bodyScrollFeature=this.createManagedBean(new GridBodyScrollFeature(this.eBodyViewport)),this.addRowDragListener(),this.setupRowAnimationCssClass(),this.addEventListeners(),this.addFocusListeners([o,n,a,l]),this.onGridColumnsChanged(),this.addBodyViewportListener(),this.setFloatingHeights(),this.disableBrowserDragging(),this.addStopEditingWhenGridLosesFocus(),this.ctrlsService.registerGridBodyCtrl(this)}getComp(){return this.comp}addEventListeners(){this.addManagedListener(this.eventService,Events.EVENT_GRID_COLUMNS_CHANGED,this.onGridColumnsChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_SCROLL_VISIBILITY_CHANGED,this.onScrollVisibilityChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_PINNED_ROW_DATA_CHANGED,this.onPinnedRowDataChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_HEADER_HEIGHT_CHANGED,this.onHeaderHeightChanged.bind(this))}addFocusListeners(e){e.forEach(t=>{this.addManagedListener(t,"focusin",n=>{const{target:o}=n,a=isElementChildOfClass(o,"ag-root",t);t.classList.toggle("ag-has-focus",!a)}),this.addManagedListener(t,"focusout",n=>{const{target:o,relatedTarget:a}=n,l=t.contains(a),s=isElementChildOfClass(a,"ag-root",t);isElementChildOfClass(o,"ag-root",t)||(!l||s)&&t.classList.remove("ag-has-focus")})})}setColumnMovingCss(e){this.comp.setColumnMovingCss(CSS_CLASS_COLUMN_MOVING,e)}setCellTextSelection(e=!1){this.comp.setCellSelectableCss(CSS_CLASS_CELL_SELECTABLE,e)}onScrollVisibilityChanged(){const e=this.scrollVisibleService.isVerticalScrollShowing();this.setVerticalScrollPaddingVisible(e),this.setStickyTopWidth(e);const t=e&&this.gridOptionsService.getScrollbarWidth()||0,n=isInvisibleScrollbar()?16:0,o=`calc(100% + ${t+n}px)`;this.animationFrameService.requestAnimationFrame(()=>this.comp.setBodyViewportWidth(o))}onGridColumnsChanged(){const e=this.columnModel.getAllGridColumns();this.comp.setColumnCount(e?e.length:0)}disableBrowserDragging(){this.addManagedListener(this.eGridBody,"dragstart",e=>{if(e.target instanceof HTMLImageElement)return e.preventDefault(),!1})}addStopEditingWhenGridLosesFocus(){if(!this.gridOptionsService.is("stopEditingWhenCellsLoseFocus"))return;const e=n=>{const o=n.relatedTarget;if(getTabIndex(o)===null){this.rowRenderer.stopEditing();return}let a=t.some(l=>l.contains(o))&&this.mouseEventService.isElementInThisGrid(o);if(!a){const l=this.popupService;a=l.getActivePopups().some(s=>s.contains(o))||l.isElementWithinCustomPopup(o)}a||this.rowRenderer.stopEditing()},t=[this.eBodyViewport,this.eBottom,this.eTop,this.eStickyTop];t.forEach(n=>this.addManagedListener(n,"focusout",e))}updateRowCount(){const e=this.headerNavigationService.getHeaderRowCount(),t=this.rowModel.isLastRowIndexKnown()?this.rowModel.getRowCount():-1,n=t===-1?-1:e+t;this.comp.setRowCount(n)}registerBodyViewportResizeListener(e){this.comp.registerBodyViewportResizeListener(e)}setVerticalScrollPaddingVisible(e){const t=e?"scroll":"hidden";this.comp.setPinnedTopBottomOverflowY(t)}isVerticalScrollShowing(){const e=this.gridOptionsService.is("alwaysShowVerticalScroll"),t=e?CSS_CLASS_FORCE_VERTICAL_SCROLL:null,n=this.gridOptionsService.isDomLayout("normal");return this.comp.setAlwaysVerticalScrollClass(t,e),e||n&&isVerticalScrollShowing(this.eBodyViewport)}setupRowAnimationCssClass(){const e=()=>{const t=this.gridOptionsService.isAnimateRows()&&!this.rowContainerHeightService.isStretching(),n=t?RowAnimationCssClasses.ANIMATION_ON:RowAnimationCssClasses.ANIMATION_OFF;this.comp.setRowAnimationCssOnBodyViewport(n,t)};e(),this.addManagedListener(this.eventService,Events.EVENT_HEIGHT_SCALE_CHANGED,e),this.addManagedPropertyListener("animateRows",e)}getGridBodyElement(){return this.eGridBody}addBodyViewportListener(){const e=this.onBodyViewportContextMenu.bind(this);this.addManagedListener(this.eBodyViewport,"contextmenu",e),this.mockContextMenuForIPad(e),this.addManagedListener(this.eBodyViewport,"wheel",this.onBodyViewportWheel.bind(this)),this.addManagedListener(this.eStickyTop,"wheel",this.onStickyTopWheel.bind(this)),this.addFullWidthContainerWheelListener()}addFullWidthContainerWheelListener(){const e=this.eBodyViewport.querySelector(".ag-full-width-container"),t=this.eBodyViewport.querySelector(".ag-center-cols-viewport");e&&t&&this.addManagedListener(e,"wheel",n=>this.onFullWidthContainerWheel(n,t))}onFullWidthContainerWheel(e,t){!e.deltaX||Math.abs(e.deltaY)>Math.abs(e.deltaX)||!this.mouseEventService.isEventFromThisGrid(e)||(e.preventDefault(),t.scrollBy({left:e.deltaX}))}onBodyViewportContextMenu(e,t,n){if(!e&&!n)return;this.gridOptionsService.is("preventDefaultOnContextMenu")&&(e||n).preventDefault();const{target:o}=e||t;if(o===this.eBodyViewport||o===this.ctrlsService.getCenterRowContainerCtrl().getViewportElement()){if(!this.contextMenuFactory)return;e?this.contextMenuFactory.onContextMenu(e,null,null,null,null,this.eGridBody):n&&this.contextMenuFactory.onContextMenu(null,n,null,null,null,this.eGridBody)}}mockContextMenuForIPad(e){if(!isIOSUserAgent())return;const t=new TouchListener(this.eBodyViewport),n=o=>{e(void 0,o.touchStart,o.touchEvent)};this.addManagedListener(t,TouchListener.EVENT_LONG_TAP,n),this.addDestroyFunc(()=>t.destroy())}onBodyViewportWheel(e){this.gridOptionsService.is("suppressScrollWhenPopupsAreOpen")&&this.popupService.hasAnchoredPopup()&&e.preventDefault()}onStickyTopWheel(e){e.preventDefault(),e.offsetY&&this.scrollVertically(e.deltaY)}getGui(){return this.eGridBody}scrollVertically(e){const t=this.eBodyViewport.scrollTop;return this.bodyScrollFeature.setVerticalScrollPosition(t+e),this.eBodyViewport.scrollTop-t}addRowDragListener(){this.rowDragFeature=this.createManagedBean(new RowDragFeature(this.eBodyViewport)),this.dragAndDropService.addDropTarget(this.rowDragFeature)}getRowDragFeature(){return this.rowDragFeature}onPinnedRowDataChanged(){this.setFloatingHeights()}setFloatingHeights(){const{pinnedRowModel:e}=this;let t=e.getPinnedTopTotalHeight();t&&(t+=1);let n=e.getPinnedBottomTotalHeight();n&&(n+=1),this.comp.setTopHeight(t),this.comp.setBottomHeight(n),this.comp.setTopDisplay(t?"inherit":"none"),this.comp.setBottomDisplay(n?"inherit":"none"),this.setStickyTopOffsetTop()}setStickyTopHeight(e=0){this.comp.setStickyTopHeight(`${e}px`),this.stickyTopHeight=e}getStickyTopHeight(){return this.stickyTopHeight}setStickyTopWidth(e){if(!e)this.comp.setStickyTopWidth("100%");else{const t=this.gridOptionsService.getScrollbarWidth();this.comp.setStickyTopWidth(`calc(100% - ${t}px)`)}}onHeaderHeightChanged(){this.setStickyTopOffsetTop()}setStickyTopOffsetTop(){const t=this.ctrlsService.getGridHeaderCtrl().getHeaderHeight(),n=this.pinnedRowModel.getPinnedTopTotalHeight();let o=0;t>0&&(o+=t+1),n>0&&(o+=n+1),this.comp.setStickyTopTop(`${o}px`)}sizeColumnsToFit(e,t){const o=this.isVerticalScrollShowing()?this.gridOptionsService.getScrollbarWidth():0,l=getInnerWidth(this.eGridBody)-o;if(l>0){this.columnModel.sizeColumnsToFit(l,"sizeColumnsToFit",!1,e);return}t===void 0?window.setTimeout(()=>{this.sizeColumnsToFit(e,100)},0):t===100?window.setTimeout(()=>{this.sizeColumnsToFit(e,500)},100):t===500?window.setTimeout(()=>{this.sizeColumnsToFit(e,-1)},500):console.warn("AG Grid: tried to call sizeColumnsToFit() but the grid is coming back with zero width, maybe the grid is not visible yet on the screen?")}addScrollEventListener(e){this.eBodyViewport.addEventListener("scroll",e,{passive:!0})}removeScrollEventListener(e){this.eBodyViewport.removeEventListener("scroll",e)}}__decorate$1P([Autowired("animationFrameService")],GridBodyCtrl.prototype,"animationFrameService",void 0);__decorate$1P([Autowired("rowContainerHeightService")],GridBodyCtrl.prototype,"rowContainerHeightService",void 0);__decorate$1P([Autowired("ctrlsService")],GridBodyCtrl.prototype,"ctrlsService",void 0);__decorate$1P([Autowired("columnModel")],GridBodyCtrl.prototype,"columnModel",void 0);__decorate$1P([Autowired("scrollVisibleService")],GridBodyCtrl.prototype,"scrollVisibleService",void 0);__decorate$1P([Optional("contextMenuFactory")],GridBodyCtrl.prototype,"contextMenuFactory",void 0);__decorate$1P([Autowired("headerNavigationService")],GridBodyCtrl.prototype,"headerNavigationService",void 0);__decorate$1P([Autowired("dragAndDropService")],GridBodyCtrl.prototype,"dragAndDropService",void 0);__decorate$1P([Autowired("pinnedRowModel")],GridBodyCtrl.prototype,"pinnedRowModel",void 0);__decorate$1P([Autowired("rowRenderer")],GridBodyCtrl.prototype,"rowRenderer",void 0);__decorate$1P([Autowired("popupService")],GridBodyCtrl.prototype,"popupService",void 0);__decorate$1P([Autowired("mouseEventService")],GridBodyCtrl.prototype,"mouseEventService",void 0);__decorate$1P([Autowired("rowModel")],GridBodyCtrl.prototype,"rowModel",void 0);var SelectionHandleType;(function(r){r[r.FILL=0]="FILL",r[r.RANGE=1]="RANGE"})(SelectionHandleType||(SelectionHandleType={}));var CellRangeType;(function(r){r[r.VALUE=0]="VALUE",r[r.DIMENSION=1]="DIMENSION"})(CellRangeType||(CellRangeType={}));const CSS_CELL_RANGE_SELECTED="ag-cell-range-selected",CSS_CELL_RANGE_CHART="ag-cell-range-chart",CSS_CELL_RANGE_SINGLE_CELL="ag-cell-range-single-cell",CSS_CELL_RANGE_CHART_CATEGORY="ag-cell-range-chart-category",CSS_CELL_RANGE_HANDLE="ag-cell-range-handle",CSS_CELL_RANGE_TOP="ag-cell-range-top",CSS_CELL_RANGE_RIGHT="ag-cell-range-right",CSS_CELL_RANGE_BOTTOM="ag-cell-range-bottom",CSS_CELL_RANGE_LEFT="ag-cell-range-left";class CellRangeFeature{constructor(e,t){this.beans=e,this.cellCtrl=t}setComp(e,t){this.cellComp=e,this.eGui=t,this.onRangeSelectionChanged()}onRangeSelectionChanged(){this.cellComp&&(this.rangeCount=this.beans.rangeService.getCellRangeCount(this.cellCtrl.getCellPosition()),this.hasChartRange=this.getHasChartRange(),this.cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_SELECTED,this.rangeCount!==0),this.cellComp.addOrRemoveCssClass(`${CSS_CELL_RANGE_SELECTED}-1`,this.rangeCount===1),this.cellComp.addOrRemoveCssClass(`${CSS_CELL_RANGE_SELECTED}-2`,this.rangeCount===2),this.cellComp.addOrRemoveCssClass(`${CSS_CELL_RANGE_SELECTED}-3`,this.rangeCount===3),this.cellComp.addOrRemoveCssClass(`${CSS_CELL_RANGE_SELECTED}-4`,this.rangeCount>=4),this.cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_CHART,this.hasChartRange),setAriaSelected(this.eGui,this.rangeCount>0?!0:void 0),this.cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_SINGLE_CELL,this.isSingleCell()),this.updateRangeBorders(),this.refreshHandle())}updateRangeBorders(){const e=this.getRangeBorders(),t=this.isSingleCell(),n=!t&&e.top,o=!t&&e.right,a=!t&&e.bottom,l=!t&&e.left;this.cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_TOP,n),this.cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_RIGHT,o),this.cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_BOTTOM,a),this.cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_LEFT,l)}isSingleCell(){const{rangeService:e}=this.beans;return this.rangeCount===1&&e&&!e.isMoreThanOneCell()}getHasChartRange(){const{rangeService:e}=this.beans;if(!this.rangeCount||!e)return!1;const t=e.getCellRanges();return t.length>0&&t.every(n=>includes([CellRangeType.DIMENSION,CellRangeType.VALUE],n.type))}updateRangeBordersIfRangeCount(){this.rangeCount>0&&(this.updateRangeBorders(),this.refreshHandle())}getRangeBorders(){const e=this.beans.gridOptionsService.is("enableRtl");let t=!1,n=!1,o=!1,a=!1;const l=this.cellCtrl.getCellPosition().column,{rangeService:s,columnModel:m}=this.beans;let y,D;e?(y=m.getDisplayedColAfter(l),D=m.getDisplayedColBefore(l)):(y=m.getDisplayedColBefore(l),D=m.getDisplayedColAfter(l));const W=s.getCellRanges().filter(Ee=>s.isCellInSpecificRange(this.cellCtrl.getCellPosition(),Ee));y||(a=!0),D||(n=!0);for(let Ee=0;Ee<W.length&&!(t&&n&&o&&a);Ee++){const dt=W[Ee],Ht=s.getRangeStartRow(dt),ir=s.getRangeEndRow(dt);!t&&this.beans.rowPositionUtils.sameRow(Ht,this.cellCtrl.getCellPosition())&&(t=!0),!o&&this.beans.rowPositionUtils.sameRow(ir,this.cellCtrl.getCellPosition())&&(o=!0),!a&&y&&dt.columns.indexOf(y)<0&&(a=!0),!n&&D&&dt.columns.indexOf(D)<0&&(n=!0)}return{top:t,right:n,bottom:o,left:a}}refreshHandle(){if(!this.beans.rangeService)return;const e=this.shouldHaveSelectionHandle();this.selectionHandle&&!e&&(this.selectionHandle=this.beans.context.destroyBean(this.selectionHandle)),e&&this.addSelectionHandle(),this.cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_HANDLE,!!this.selectionHandle)}shouldHaveSelectionHandle(){const{gridOptionsService:e,rangeService:t}=this.beans,n=t.getCellRanges(),o=n.length;if(this.rangeCount<1||o<1)return!1;const a=last(n),l=this.cellCtrl.getCellPosition(),s=e.is("enableFillHandle")&&!this.cellCtrl.isSuppressFillHandle(),m=e.is("enableRangeHandle");let y=o===1&&!this.cellCtrl.isEditing()&&(s||m);if(this.hasChartRange){const W=n[0].type===CellRangeType.DIMENSION&&t.isCellInSpecificRange(l,n[0]);this.cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_CHART_CATEGORY,W),y=a.type===CellRangeType.VALUE}return y&&a.endRow!=null&&t.isContiguousRange(a)&&t.isBottomRightCell(a,l)}addSelectionHandle(){const{gridOptionsService:e,rangeService:t}=this.beans,n=last(t.getCellRanges()).type,a=e.is("enableFillHandle")&&missing(n)?SelectionHandleType.FILL:SelectionHandleType.RANGE;this.selectionHandle&&this.selectionHandle.getType()!==a&&(this.selectionHandle=this.beans.context.destroyBean(this.selectionHandle)),this.selectionHandle||(this.selectionHandle=this.beans.selectionHandleFactory.createSelectionHandle(a)),this.selectionHandle.refresh(this.cellCtrl)}destroy(){this.beans.context.destroyBean(this.selectionHandle)}}class CellPositionFeature extends BeanStub{constructor(e,t){super(),this.cellCtrl=e,this.beans=t,this.column=e.getColumn(),this.rowNode=e.getRowNode(),this.setupColSpan(),this.setupRowSpan()}setupRowSpan(){this.rowSpan=this.column.getRowSpan(this.rowNode)}setComp(e){this.eGui=e,this.onLeftChanged(),this.onWidthChanged(),this.applyRowSpan()}onDisplayColumnsChanged(){const e=this.getColSpanningList();areEqual(this.colsSpanning,e)||(this.colsSpanning=e,this.onWidthChanged(),this.onLeftChanged())}setupColSpan(){this.column.getColDef().colSpan!=null&&(this.colsSpanning=this.getColSpanningList(),this.addManagedListener(this.beans.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,this.onDisplayColumnsChanged.bind(this)),this.addManagedListener(this.beans.eventService,Events.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED,this.onWidthChanged.bind(this)))}onWidthChanged(){if(!this.eGui)return;const e=this.getCellWidth();this.eGui.style.width=`${e}px`}getCellWidth(){return this.colsSpanning?this.colsSpanning.reduce((e,t)=>e+t.getActualWidth(),0):this.column.getActualWidth()}getColSpanningList(){const e=this.column.getColSpan(this.rowNode),t=[];if(e===1)t.push(this.column);else{let n=this.column;const o=this.column.getPinned();for(let a=0;n&&a<e&&(t.push(n),n=this.beans.columnModel.getDisplayedColAfter(n),!(!n||missing(n)||o!==n.getPinned()));a++);}return t}onLeftChanged(){if(!this.eGui)return;const e=this.modifyLeftForPrintLayout(this.getCellLeft());this.eGui.style.left=e+"px"}getCellLeft(){let e;return this.beans.gridOptionsService.is("enableRtl")&&this.colsSpanning?e=last(this.colsSpanning):e=this.column,e.getLeft()}modifyLeftForPrintLayout(e){if(!this.cellCtrl.isPrintLayout()||this.column.getPinned()==="left")return e;const t=this.beans.columnModel.getDisplayedColumnsLeftWidth();if(this.column.getPinned()==="right"){const n=this.beans.columnModel.getBodyContainerWidth();return t+n+(e||0)}return t+(e||0)}applyRowSpan(){if(this.rowSpan===1)return;const t=this.beans.gridOptionsService.getRowHeightAsNumber()*this.rowSpan;this.eGui.style.height=`${t}px`,this.eGui.style.zIndex="1"}destroy(){super.destroy()}}class CellCustomStyleFeature extends BeanStub{constructor(e,t){super(),this.staticClasses=[],this.cellCtrl=e,this.beans=t,this.column=e.getColumn(),this.rowNode=e.getRowNode()}setComp(e){this.cellComp=e,this.applyUserStyles(),this.applyCellClassRules(),this.applyClassesFromColDef()}applyCellClassRules(){const e=this.column.getColDef(),t={value:this.cellCtrl.getValue(),data:this.rowNode.data,node:this.rowNode,colDef:e,column:this.column,rowIndex:this.rowNode.rowIndex,api:this.beans.gridOptionsService.api,columnApi:this.beans.gridOptionsService.columnApi,context:this.beans.gridOptionsService.context};this.beans.stylingService.processClassRules(e.cellClassRules,t,n=>this.cellComp.addOrRemoveCssClass(n,!0),n=>this.cellComp.addOrRemoveCssClass(n,!1))}applyUserStyles(){const e=this.column.getColDef();if(!e.cellStyle)return;let t;if(typeof e.cellStyle=="function"){const n={column:this.column,value:this.cellCtrl.getValue(),colDef:e,data:this.rowNode.data,node:this.rowNode,rowIndex:this.rowNode.rowIndex,api:this.beans.gridOptionsService.api,columnApi:this.beans.gridOptionsService.columnApi,context:this.beans.gridOptionsService.context},o=e.cellStyle;t=o(n)}else t=e.cellStyle;t&&this.cellComp.setUserStyles(t)}applyClassesFromColDef(){const e=this.column.getColDef(),t={value:this.cellCtrl.getValue(),data:this.rowNode.data,node:this.rowNode,column:this.column,colDef:e,rowIndex:this.rowNode.rowIndex,api:this.beans.gridOptionsService.api,columnApi:this.beans.gridOptionsService.columnApi,context:this.beans.gridOptionsService.context};this.staticClasses.length&&this.staticClasses.forEach(n=>this.cellComp.addOrRemoveCssClass(n,!1)),this.staticClasses=this.beans.stylingService.getStaticCellClasses(e,t),this.staticClasses.length&&this.staticClasses.forEach(n=>this.cellComp.addOrRemoveCssClass(n,!0))}destroy(){super.destroy()}}class TooltipFeature extends BeanStub{constructor(e,t){super(),this.ctrl=e,this.beans=t}setComp(e){this.comp=e,this.setupTooltip()}setupTooltip(){this.browserTooltips=this.beans.gridOptionsService.is("enableBrowserTooltips"),this.updateTooltipText(),this.browserTooltips?this.comp.setTitle(this.tooltip!=null?this.tooltip:void 0):this.createTooltipFeatureIfNeeded()}updateTooltipText(){this.tooltip=this.ctrl.getTooltipValue()}createTooltipFeatureIfNeeded(){if(this.genericTooltipFeature!=null)return;const e={getTooltipParams:()=>this.getTooltipParams(),getGui:()=>this.ctrl.getGui()};this.genericTooltipFeature=this.createManagedBean(new CustomTooltipFeature(e),this.beans.context)}refreshToolTip(){this.updateTooltipText(),this.browserTooltips&&this.comp.setTitle(this.tooltip!=null?this.tooltip:void 0)}getTooltipParams(){const e=this.ctrl,t=e.getColumn?e.getColumn():void 0,n=e.getColDef?e.getColDef():void 0,o=e.getRowNode?e.getRowNode():void 0;return{location:e.getLocation(),colDef:n,column:t,rowIndex:e.getRowIndex?e.getRowIndex():void 0,node:o,data:o?o.data:void 0,value:this.getTooltipText(),valueFormatted:e.getValueFormatted?e.getValueFormatted():void 0}}getTooltipText(){return this.tooltip}destroy(){super.destroy()}}var __decorate$1O=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Beans=class{postConstruct(){this.doingMasterDetail=this.gridOptionsService.isMasterDetail(),this.gridOptionsService.isRowModelType("clientSide")&&(this.clientSideRowModel=this.rowModel),this.gridOptionsService.isRowModelType("serverSide")&&(this.serverSideRowModel=this.rowModel)}};__decorate$1O([Autowired("resizeObserverService")],Beans.prototype,"resizeObserverService",void 0);__decorate$1O([Autowired("paginationProxy")],Beans.prototype,"paginationProxy",void 0);__decorate$1O([Autowired("context")],Beans.prototype,"context",void 0);__decorate$1O([Autowired("columnApi")],Beans.prototype,"columnApi",void 0);__decorate$1O([Autowired("gridApi")],Beans.prototype,"gridApi",void 0);__decorate$1O([Autowired("gridOptionsService")],Beans.prototype,"gridOptionsService",void 0);__decorate$1O([Autowired("expressionService")],Beans.prototype,"expressionService",void 0);__decorate$1O([Autowired("environment")],Beans.prototype,"environment",void 0);__decorate$1O([Autowired("rowRenderer")],Beans.prototype,"rowRenderer",void 0);__decorate$1O([Autowired("templateService")],Beans.prototype,"templateService",void 0);__decorate$1O([Autowired("valueService")],Beans.prototype,"valueService",void 0);__decorate$1O([Autowired("eventService")],Beans.prototype,"eventService",void 0);__decorate$1O([Autowired("columnModel")],Beans.prototype,"columnModel",void 0);__decorate$1O([Autowired("headerNavigationService")],Beans.prototype,"headerNavigationService",void 0);__decorate$1O([Autowired("navigationService")],Beans.prototype,"navigationService",void 0);__decorate$1O([Autowired("columnAnimationService")],Beans.prototype,"columnAnimationService",void 0);__decorate$1O([Optional("rangeService")],Beans.prototype,"rangeService",void 0);__decorate$1O([Autowired("focusService")],Beans.prototype,"focusService",void 0);__decorate$1O([Optional("contextMenuFactory")],Beans.prototype,"contextMenuFactory",void 0);__decorate$1O([Autowired("popupService")],Beans.prototype,"popupService",void 0);__decorate$1O([Autowired("valueFormatterService")],Beans.prototype,"valueFormatterService",void 0);__decorate$1O([Autowired("stylingService")],Beans.prototype,"stylingService",void 0);__decorate$1O([Autowired("columnHoverService")],Beans.prototype,"columnHoverService",void 0);__decorate$1O([Autowired("userComponentFactory")],Beans.prototype,"userComponentFactory",void 0);__decorate$1O([Autowired("userComponentRegistry")],Beans.prototype,"userComponentRegistry",void 0);__decorate$1O([Autowired("animationFrameService")],Beans.prototype,"animationFrameService",void 0);__decorate$1O([Autowired("dragService")],Beans.prototype,"dragService",void 0);__decorate$1O([Autowired("dragAndDropService")],Beans.prototype,"dragAndDropService",void 0);__decorate$1O([Autowired("sortController")],Beans.prototype,"sortController",void 0);__decorate$1O([Autowired("filterManager")],Beans.prototype,"filterManager",void 0);__decorate$1O([Autowired("rowContainerHeightService")],Beans.prototype,"rowContainerHeightService",void 0);__decorate$1O([Autowired("frameworkOverrides")],Beans.prototype,"frameworkOverrides",void 0);__decorate$1O([Autowired("cellPositionUtils")],Beans.prototype,"cellPositionUtils",void 0);__decorate$1O([Autowired("rowPositionUtils")],Beans.prototype,"rowPositionUtils",void 0);__decorate$1O([Autowired("selectionService")],Beans.prototype,"selectionService",void 0);__decorate$1O([Optional("selectionHandleFactory")],Beans.prototype,"selectionHandleFactory",void 0);__decorate$1O([Autowired("rowCssClassCalculator")],Beans.prototype,"rowCssClassCalculator",void 0);__decorate$1O([Autowired("rowModel")],Beans.prototype,"rowModel",void 0);__decorate$1O([Autowired("ctrlsService")],Beans.prototype,"ctrlsService",void 0);__decorate$1O([Autowired("ctrlsFactory")],Beans.prototype,"ctrlsFactory",void 0);__decorate$1O([Autowired("agStackComponentsRegistry")],Beans.prototype,"agStackComponentsRegistry",void 0);__decorate$1O([Autowired("valueCache")],Beans.prototype,"valueCache",void 0);__decorate$1O([Autowired("rowNodeEventThrottle")],Beans.prototype,"rowNodeEventThrottle",void 0);__decorate$1O([Autowired("localeService")],Beans.prototype,"localeService",void 0);__decorate$1O([Autowired("valueParserService")],Beans.prototype,"valueParserService",void 0);__decorate$1O([PostConstruct],Beans.prototype,"postConstruct",null);Beans=__decorate$1O([Bean("beans")],Beans);class CellMouseListenerFeature extends Beans{constructor(e,t,n){super(),this.cellCtrl=e,this.beans=t,this.column=n}onMouseEvent(e,t){if(!isStopPropagationForAgGrid(t))switch(e){case"click":this.onCellClicked(t);break;case"mousedown":case"touchstart":this.onMouseDown(t);break;case"dblclick":this.onCellDoubleClicked(t);break;case"mouseout":this.onMouseOut(t);break;case"mouseover":this.onMouseOver(t);break}}onCellClicked(e){if(this.isDoubleClickOnIPad()){this.onCellDoubleClicked(e),e.preventDefault();return}const{eventService:t,rangeService:n,gridOptionsService:o}=this.beans,a=e.ctrlKey||e.metaKey;n&&a&&n.getCellRangeCount(this.cellCtrl.getCellPosition())>1&&n.intersectLastRange(!0);const l=this.cellCtrl.createEvent(e,Events.EVENT_CELL_CLICKED);t.dispatchEvent(l);const s=this.column.getColDef();s.onCellClicked&&window.setTimeout(()=>s.onCellClicked(l),0),(o.is("singleClickEdit")||s.singleClickEdit)&&!o.is("suppressClickEdit")&&this.cellCtrl.startRowOrCellEdit()}isDoubleClickOnIPad(){if(!isIOSUserAgent()||isEventSupported("dblclick"))return!1;const e=new Date().getTime(),t=e-this.lastIPadMouseClickEvent<200;return this.lastIPadMouseClickEvent=e,t}onCellDoubleClicked(e){const t=this.column.getColDef(),n=this.cellCtrl.createEvent(e,Events.EVENT_CELL_DOUBLE_CLICKED);this.beans.eventService.dispatchEvent(n),typeof t.onCellDoubleClicked=="function"&&window.setTimeout(()=>t.onCellDoubleClicked(n),0),!this.beans.gridOptionsService.is("singleClickEdit")&&!this.beans.gridOptionsService.is("suppressClickEdit")&&this.cellCtrl.startRowOrCellEdit(null,e)}onMouseDown(e){const{ctrlKey:t,metaKey:n,shiftKey:o}=e,a=e.target,{eventService:l,rangeService:s}=this.beans;if(this.isRightClickInExistingRange(e))return;const m=s&&s.getCellRanges().length!=0;if(!o||!m){const y=isBrowserSafari()&&!this.cellCtrl.isEditing()&&!isFocusableFormField(a);this.cellCtrl.focusCell(y)}if(o&&m&&e.preventDefault(),!this.containsWidget(a)){if(s){const y=this.cellCtrl.getCellPosition();if(o)s.extendLatestRangeToCell(y);else{const D=t||n;s.setRangeToCell(y,D)}}l.dispatchEvent(this.cellCtrl.createEvent(e,Events.EVENT_CELL_MOUSE_DOWN))}}isRightClickInExistingRange(e){const{rangeService:t}=this.beans;return!!(t&&t.isCellInAnyRange(this.cellCtrl.getCellPosition())&&e.button===2)}containsWidget(e){return isElementChildOfClass(e,"ag-selection-checkbox",3)}onMouseOut(e){if(this.mouseStayingInsideCell(e))return;const t=this.cellCtrl.createEvent(e,Events.EVENT_CELL_MOUSE_OUT);this.beans.eventService.dispatchEvent(t),this.beans.columnHoverService.clearMouseOver()}onMouseOver(e){if(this.mouseStayingInsideCell(e))return;const t=this.cellCtrl.createEvent(e,Events.EVENT_CELL_MOUSE_OVER);this.beans.eventService.dispatchEvent(t),this.beans.columnHoverService.setMouseOver([this.column])}mouseStayingInsideCell(e){if(!e.target||!e.relatedTarget)return!1;const t=this.cellCtrl.getGui(),n=t.contains(e.target),o=t.contains(e.relatedTarget);return n&&o}destroy(){}}class CellKeyboardListenerFeature extends BeanStub{constructor(e,t,n,o,a){super(),this.cellCtrl=e,this.beans=t,this.rowNode=o,this.rowCtrl=a}setComp(e){this.eGui=e}onKeyDown(e){const t=e.key;switch(t){case KeyCode.ENTER:this.onEnterKeyDown(e);break;case KeyCode.F2:this.onF2KeyDown(e);break;case KeyCode.ESCAPE:this.onEscapeKeyDown(e);break;case KeyCode.TAB:this.onTabKeyDown(e);break;case KeyCode.BACKSPACE:case KeyCode.DELETE:this.onBackspaceOrDeleteKeyDown(t,e);break;case KeyCode.DOWN:case KeyCode.UP:case KeyCode.RIGHT:case KeyCode.LEFT:this.onNavigationKeyDown(e,t);break}}onNavigationKeyDown(e,t){this.cellCtrl.isEditing()||(e.shiftKey&&this.cellCtrl.isRangeSelectionEnabled()?this.onShiftRangeSelect(e):this.beans.navigationService.navigateToNextCell(e,t,this.cellCtrl.getCellPosition(),!0),e.preventDefault())}onShiftRangeSelect(e){if(!this.beans.rangeService)return;const t=this.beans.rangeService.extendLatestRangeInDirection(e);t&&this.beans.navigationService.ensureCellVisible(t)}onTabKeyDown(e){this.beans.navigationService.onTabKeyDown(this.cellCtrl,e)}onBackspaceOrDeleteKeyDown(e,t){const{cellCtrl:n,beans:o,rowNode:a}=this,{gridOptionsService:l,rangeService:s,eventService:m}=o;n.isEditing()||(m.dispatchEvent({type:Events.EVENT_KEY_SHORTCUT_CHANGED_CELL_START}),isDeleteKey(e,l.is("enableCellEditingOnBackspace"))?s&&l.isEnableRangeSelection()?s.clearCellRangeCellValues({dispatchWrapperEvents:!0,wrapperEventSource:"deleteKey"}):n.isCellEditable()&&a.setDataValue(n.getColumn(),null,"cellClear"):n.startRowOrCellEdit(e,t),m.dispatchEvent({type:Events.EVENT_KEY_SHORTCUT_CHANGED_CELL_END}))}onEnterKeyDown(e){if(this.cellCtrl.isEditing()||this.rowCtrl.isEditing())this.cellCtrl.stopEditingAndFocus(!1,e.shiftKey);else if(this.beans.gridOptionsService.is("enterNavigatesVertically")){const t=e.shiftKey?KeyCode.UP:KeyCode.DOWN;this.beans.navigationService.navigateToNextCell(null,t,this.cellCtrl.getCellPosition(),!1)}else this.cellCtrl.startRowOrCellEdit(KeyCode.ENTER,e),this.cellCtrl.isEditing()&&e.preventDefault()}onF2KeyDown(e){this.cellCtrl.isEditing()||this.cellCtrl.startRowOrCellEdit(KeyCode.F2,e)}onEscapeKeyDown(e){this.cellCtrl.isEditing()&&(this.cellCtrl.stopRowOrCellEdit(!0),this.cellCtrl.focusCell(!0))}processCharacter(e){if(e.target!==this.eGui||this.cellCtrl.isEditing())return;const o=e.key;o===" "?this.onSpaceKeyDown(e):(this.cellCtrl.startRowOrCellEdit(o,e),e.preventDefault())}onSpaceKeyDown(e){const{gridOptionsService:t}=this.beans;if(!this.cellCtrl.isEditing()&&t.isRowSelection()){const n=this.rowNode.isSelected(),o=!n;if(o||!t.is("suppressRowDeselection")){const a=this.beans.gridOptionsService.is("groupSelectsFiltered"),l=this.rowNode.setSelectedParams({newValue:o,rangeSelect:e.shiftKey,groupSelectsFiltered:a,event:e,source:"spaceKey"});n===void 0&&l===0&&this.rowNode.setSelectedParams({newValue:!1,rangeSelect:e.shiftKey,groupSelectsFiltered:a,event:e,source:"spaceKey"})}}e.preventDefault()}destroy(){super.destroy()}}var __decorate$1N=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class DndSourceComp extends Component{constructor(e,t,n){super('<div class="ag-drag-handle ag-row-drag" draggable="true"></div>'),this.rowNode=e,this.column=t,this.eCell=n}postConstruct(){this.getGui().appendChild(createIconNoSpan("rowDrag",this.gridOptionsService,null)),this.addGuiEventListener("mousedown",t=>{t.stopPropagation()}),this.addDragSource(),this.checkVisibility()}addDragSource(){this.addGuiEventListener("dragstart",this.onDragStart.bind(this))}onDragStart(e){const t=this.column.getColDef().dndSourceOnRowDrag;e.dataTransfer.setDragImage(this.eCell,0,0);const n=()=>{try{const o=JSON.stringify(this.rowNode.data);e.dataTransfer.setData("application/json",o),e.dataTransfer.setData("text/plain",o)}catch{}};if(t){const o={rowNode:this.rowNode,dragEvent:e,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context};t(o)}else n()}checkVisibility(){const e=this.column.isDndSource(this.rowNode);this.setDisplayed(e)}}__decorate$1N([PostConstruct],DndSourceComp.prototype,"postConstruct",null);const CSS_CELL="ag-cell",CSS_AUTO_HEIGHT="ag-cell-auto-height",CSS_NORMAL_HEIGHT="ag-cell-normal-height",CSS_CELL_FOCUS="ag-cell-focus",CSS_CELL_FIRST_RIGHT_PINNED="ag-cell-first-right-pinned",CSS_CELL_LAST_LEFT_PINNED="ag-cell-last-left-pinned",CSS_CELL_NOT_INLINE_EDITING="ag-cell-not-inline-editing",CSS_COLUMN_HOVER="ag-column-hover",CSS_CELL_WRAP_TEXT="ag-cell-wrap-text";let instanceIdSequence$3=0;class CellCtrl extends BeanStub{constructor(e,t,n,o){super(),this.cellRangeFeature=null,this.cellPositionFeature=null,this.cellCustomStyleFeature=null,this.tooltipFeature=null,this.cellMouseListenerFeature=null,this.cellKeyboardListenerFeature=null,this.suppressRefreshCell=!1,this.onCellCompAttachedFuncs=[],this.column=e,this.rowNode=t,this.beans=n,this.rowCtrl=o,this.instanceId=e.getId()+"-"+instanceIdSequence$3++,this.createCellPosition(),this.addFeatures()}shouldRestoreFocus(){return this.beans.focusService.shouldRestoreFocus(this.cellPosition)}addFeatures(){this.cellPositionFeature=new CellPositionFeature(this,this.beans),this.addDestroyFunc(()=>{var t;(t=this.cellPositionFeature)===null||t===void 0||t.destroy(),this.cellPositionFeature=null}),this.cellCustomStyleFeature=new CellCustomStyleFeature(this,this.beans),this.addDestroyFunc(()=>{var t;(t=this.cellCustomStyleFeature)===null||t===void 0||t.destroy(),this.cellCustomStyleFeature=null}),this.cellMouseListenerFeature=new CellMouseListenerFeature(this,this.beans,this.column),this.addDestroyFunc(()=>{var t;(t=this.cellMouseListenerFeature)===null||t===void 0||t.destroy(),this.cellMouseListenerFeature=null}),this.cellKeyboardListenerFeature=new CellKeyboardListenerFeature(this,this.beans,this.column,this.rowNode,this.rowCtrl),this.addDestroyFunc(()=>{var t;(t=this.cellKeyboardListenerFeature)===null||t===void 0||t.destroy(),this.cellKeyboardListenerFeature=null}),this.beans.rangeService&&this.beans.gridOptionsService.isEnableRangeSelection()&&(this.cellRangeFeature=new CellRangeFeature(this.beans,this),this.addDestroyFunc(()=>{var t;(t=this.cellRangeFeature)===null||t===void 0||t.destroy(),this.cellRangeFeature=null})),this.column.isTooltipEnabled()&&this.addTooltipFeature()}addTooltipFeature(){const t={getColumn:()=>this.column,getColDef:()=>this.column.getColDef(),getRowIndex:()=>this.cellPosition.rowIndex,getRowNode:()=>this.rowNode,getGui:()=>this.getGui(),getLocation:()=>"cell",getTooltipValue:()=>{const n=this.column.getColDef(),o=this.rowNode.data;if(n.tooltipField&&exists(o))return getValueUsingField(o,n.tooltipField,this.column.isTooltipFieldContainsDots());const a=n.tooltipValueGetter;return a?a({location:"cell",api:this.beans.gridOptionsService.api,columnApi:this.beans.gridOptionsService.columnApi,context:this.beans.gridOptionsService.context,colDef:this.column.getColDef(),column:this.column,rowIndex:this.cellPosition.rowIndex,node:this.rowNode,data:this.rowNode.data,value:this.value,valueFormatted:this.valueFormatted}):null},getValueFormatted:()=>this.valueFormatted};this.tooltipFeature=new TooltipFeature(t,this.beans),this.addDestroyFunc(()=>{var n;(n=this.tooltipFeature)===null||n===void 0||n.destroy(),this.tooltipFeature=null})}setComp(e,t,n,o,a){var l,s,m,y;this.cellComp=e,this.eGui=t,this.printLayout=o,this.updateAndFormatValue(!0),this.addDomData(),this.onCellFocused(),this.applyStaticCssClasses(),this.setWrapText(),this.onFirstRightPinnedChanged(),this.onLastLeftPinnedChanged(),this.onColumnHover(),this.setupControlComps(),n&&this.setupAutoHeight(n),this.setAriaColIndex(),this.beans.gridOptionsService.is("suppressCellFocus")||this.cellComp.setTabIndex(-1);const D=escapeString(this.column.getId());this.cellComp.setColId(D),this.cellComp.setRole("gridcell"),(l=this.cellPositionFeature)===null||l===void 0||l.setComp(t),(s=this.cellCustomStyleFeature)===null||s===void 0||s.setComp(e),(m=this.tooltipFeature)===null||m===void 0||m.setComp(e),(y=this.cellKeyboardListenerFeature)===null||y===void 0||y.setComp(this.eGui),this.cellRangeFeature&&this.cellRangeFeature.setComp(e,t),a&&this.isCellEditable()?this.startEditing():this.showValue(),this.onCellCompAttachedFuncs.length&&(this.onCellCompAttachedFuncs.forEach(W=>W()),this.onCellCompAttachedFuncs=[])}setupAutoHeight(e){if(!this.column.isAutoHeight())return;const t=e.parentElement,n=this.beans.gridOptionsService.getRowHeightForNode(this.rowNode).height,o=s=>{if(this.editing||!this.isAlive())return;const{paddingTop:m,paddingBottom:y,borderBottomWidth:D,borderTopWidth:W}=getElementSize(t),Ee=m+y+D+W,Ht=e.offsetHeight+Ee;if(s<5){const Hr=this.beans.gridOptionsService.getDocument(),Bn=!Hr||!Hr.contains(e),Vn=Ht==0;if(Bn||Vn){this.beans.frameworkOverrides.setTimeout(()=>o(s+1),0);return}}const ir=Math.max(Ht,n);this.rowNode.setRowAutoHeight(ir,this.column)},a=()=>o(0);a();const l=this.beans.resizeObserverService.observeResize(e,a);this.addDestroyFunc(()=>{l(),this.rowNode.setRowAutoHeight(void 0,this.column)})}getInstanceId(){return this.instanceId}showValue(e=!1){const t=this.valueFormatted!=null?this.valueFormatted:this.value,n=this.createCellRendererParams(),o=this.beans.userComponentFactory.getCellRendererDetails(this.column.getColDef(),n);this.cellComp.setRenderDetails(o,t,e),this.refreshHandle()}setupControlComps(){const e=this.column.getColDef();this.includeSelection=this.isIncludeControl(e.checkboxSelection),this.includeRowDrag=this.isIncludeControl(e.rowDrag),this.includeDndSource=this.isIncludeControl(e.dndSource),this.cellComp.setIncludeSelection(this.includeSelection),this.cellComp.setIncludeDndSource(this.includeDndSource),this.cellComp.setIncludeRowDrag(this.includeRowDrag)}isForceWrapper(){return this.beans.gridOptionsService.is("enableCellTextSelection")||this.column.isAutoHeight()}isIncludeControl(e){return this.rowNode.rowPinned!=null?!1:typeof e=="function"||e===!0}refreshShouldDestroy(){const e=this.column.getColDef(),t=this.includeSelection!=this.isIncludeControl(e.checkboxSelection),n=this.includeRowDrag!=this.isIncludeControl(e.rowDrag),o=this.includeDndSource!=this.isIncludeControl(e.dndSource);return t||n||o}startEditing(e=null,t=!1,n=null){if(!this.isCellEditable()||this.editing)return;if(!this.cellComp){this.onCellCompAttachedFuncs.push(()=>{this.startEditing(e,t,n)});return}const o=this.createCellEditorParams(e,t),a=this.column.getColDef(),l=this.beans.userComponentFactory.getCellEditorDetails(a,o),s=(l==null?void 0:l.popupFromSelector)!=null?l.popupFromSelector:!!a.cellEditorPopup,m=(l==null?void 0:l.popupPositionFromSelector)!=null?l.popupPositionFromSelector:a.cellEditorPopupPosition;this.setEditing(!0),this.cellComp.setEditDetails(l,s,m);const y=this.createEvent(n,Events.EVENT_CELL_EDITING_STARTED);this.beans.eventService.dispatchEvent(y)}setEditing(e){this.editing!==e&&(this.editing=e,this.refreshHandle())}stopRowOrCellEdit(e=!1){this.beans.gridOptionsService.get("editType")==="fullRow"?this.rowCtrl.stopRowEditing(e):this.stopEditing(e)}onPopupEditorClosed(){this.isEditing()&&this.stopEditingAndFocus()}takeValueFromCellEditor(e){const t={newValueExists:!1};if(e)return t;const n=this.cellComp.getCellEditor();return!n||n.isCancelAfterEnd&&n.isCancelAfterEnd()?t:{newValue:n.getValue(),newValueExists:!0}}saveNewValue(e,t){if(t===e)return!1;this.suppressRefreshCell=!0;const n=this.rowNode.setDataValue(this.column,t,"edit");return this.suppressRefreshCell=!1,n}stopEditing(e=!1){if(!this.editing)return!1;const{newValue:t,newValueExists:n}=this.takeValueFromCellEditor(e),o=this.rowNode.getValueFromValueService(this.column);let a=!1;return n&&(a=this.saveNewValue(o,t)),this.setEditing(!1),this.cellComp.setEditDetails(),this.updateAndFormatValue(),this.refreshCell({forceRefresh:!0,suppressFlash:!0}),this.dispatchEditingStoppedEvent(o,t,!e&&!!a),a}dispatchEditingStoppedEvent(e,t,n){const o=Object.assign(Object.assign({},this.createEvent(null,Events.EVENT_CELL_EDITING_STOPPED)),{oldValue:e,newValue:t,valueChanged:n});this.beans.eventService.dispatchEvent(o)}createCellEditorParams(e,t){return{value:this.rowNode.getValueFromValueService(this.column),eventKey:e,column:this.column,colDef:this.column.getColDef(),rowIndex:this.getCellPosition().rowIndex,node:this.rowNode,data:this.rowNode.data,api:this.beans.gridOptionsService.api,cellStartedEdit:t,columnApi:this.beans.gridOptionsService.columnApi,context:this.beans.gridOptionsService.context,onKeyDown:this.onKeyDown.bind(this),stopEditing:this.stopEditingAndFocus.bind(this),eGridCell:this.getGui(),parseValue:this.parseValue.bind(this),formatValue:this.formatValue.bind(this)}}createCellRendererParams(){return{value:this.value,valueFormatted:this.valueFormatted,getValue:()=>this.rowNode.getValueFromValueService(this.column),setValue:t=>this.beans.valueService.setValue(this.rowNode,this.column,t),formatValue:this.formatValue.bind(this),data:this.rowNode.data,node:this.rowNode,pinned:this.column.getPinned(),colDef:this.column.getColDef(),column:this.column,rowIndex:this.getCellPosition().rowIndex,api:this.beans.gridOptionsService.api,columnApi:this.beans.gridOptionsService.columnApi,context:this.beans.gridOptionsService.context,refreshCell:this.refreshCell.bind(this),eGridCell:this.getGui(),eParentOfValue:this.cellComp.getParentOfValue(),registerRowDragger:(t,n,o,a)=>this.registerRowDragger(t,n,a)}}parseValue(e){return this.beans.valueParserService.parseValue(this.column,this.rowNode,e,this.getValue())}setFocusOutOnEditor(){if(!this.editing)return;const e=this.cellComp.getCellEditor();e&&e.focusOut&&e.focusOut()}setFocusInOnEditor(){if(!this.editing)return;const e=this.cellComp.getCellEditor();e&&e.focusIn?e.focusIn():this.focusCell(!0)}onCellChanged(e){if(!this.cellComp)return;e.column===this.column&&this.refreshCell({})}refreshCell(e){var t,n,o;if(this.suppressRefreshCell||this.editing||!this.cellComp)return;const a=this.column.getColDef(),l=e!=null&&!!e.newData,s=e!=null&&!!e.suppressFlash||!!a.suppressCellFlash,m=a.field==null&&a.valueGetter==null&&a.showRowGroup==null,y=e&&e.forceRefresh||m||l,D=this.updateAndFormatValue();if(y||D){this.showValue(l);const Ee=this.beans.filterManager.isSuppressFlashingCellsBecauseFiltering();!s&&!Ee&&(this.beans.gridOptionsService.is("enableCellChangeFlash")||a.enableCellChangeFlash)&&this.flashCell(),(t=this.cellCustomStyleFeature)===null||t===void 0||t.applyUserStyles(),(n=this.cellCustomStyleFeature)===null||n===void 0||n.applyClassesFromColDef()}this.refreshToolTip(),(o=this.cellCustomStyleFeature)===null||o===void 0||o.applyCellClassRules()}stopEditingAndFocus(e=!1,t=!1){this.stopRowOrCellEdit(),this.focusCell(!0),e||this.navigateAfterEdit(t)}navigateAfterEdit(e){if(this.beans.gridOptionsService.is("enterNavigatesVerticallyAfterEdit")){const n=e?KeyCode.UP:KeyCode.DOWN;this.beans.navigationService.navigateToNextCell(null,n,this.getCellPosition(),!1)}}flashCell(e){const t=e&&e.flashDelay,n=e&&e.fadeDelay;this.animateCell("data-changed",t,n)}animateCell(e,t,n){var o,a;const l=`ag-cell-${e}`,s=`ag-cell-${e}-animation`,{gridOptionsService:m}=this.beans;t||(t=(o=m.getNum("cellFlashDelay"))!==null&&o!==void 0?o:500),exists(n)||(n=(a=m.getNum("cellFadeDelay"))!==null&&a!==void 0?a:1e3),this.cellComp.addOrRemoveCssClass(l,!0),this.cellComp.addOrRemoveCssClass(s,!1),window.setTimeout(()=>{this.isAlive()&&(this.cellComp.addOrRemoveCssClass(l,!1),this.cellComp.addOrRemoveCssClass(s,!0),this.eGui.style.transition=`background-color ${n}ms`,window.setTimeout(()=>{this.isAlive()&&(this.cellComp.addOrRemoveCssClass(s,!1),this.eGui.style.transition="")},n))},t)}onFlashCells(e){if(!this.cellComp)return;const t=this.beans.cellPositionUtils.createId(this.getCellPosition());e.cells[t]&&this.animateCell("highlight")}isCellEditable(){return this.column.isCellEditable(this.rowNode)}isSuppressFillHandle(){return this.column.isSuppressFillHandle()}formatValue(e){const t=this.callValueFormatter(e);return t??e}callValueFormatter(e){return this.beans.valueFormatterService.formatValue(this.column,this.rowNode,e)}updateAndFormatValue(e=!1){const t=this.value,n=this.valueFormatted;return this.value=this.rowNode.getValueFromValueService(this.column),this.valueFormatted=this.callValueFormatter(this.value),e?!0:!this.valuesAreEqual(t,this.value)||this.valueFormatted!=n}valuesAreEqual(e,t){const n=this.column.getColDef();return n.equals?n.equals(e,t):e===t}getComp(){return this.cellComp}getValue(){return this.value}getValueFormatted(){return this.valueFormatted}addDomData(){const e=this.getGui();this.beans.gridOptionsService.setDomData(e,CellCtrl.DOM_DATA_KEY_CELL_CTRL,this),this.addDestroyFunc(()=>this.beans.gridOptionsService.setDomData(e,CellCtrl.DOM_DATA_KEY_CELL_CTRL,null))}createEvent(e,t){return{type:t,node:this.rowNode,data:this.rowNode.data,value:this.value,column:this.column,colDef:this.column.getColDef(),context:this.beans.gridOptionsService.context,api:this.beans.gridApi,columnApi:this.beans.columnApi,rowPinned:this.rowNode.rowPinned,event:e,rowIndex:this.rowNode.rowIndex}}processCharacter(e){var t;(t=this.cellKeyboardListenerFeature)===null||t===void 0||t.processCharacter(e)}onKeyDown(e){var t;(t=this.cellKeyboardListenerFeature)===null||t===void 0||t.onKeyDown(e)}onMouseEvent(e,t){var n;(n=this.cellMouseListenerFeature)===null||n===void 0||n.onMouseEvent(e,t)}getGui(){return this.eGui}refreshToolTip(){var e;(e=this.tooltipFeature)===null||e===void 0||e.refreshToolTip()}getColSpanningList(){return this.cellPositionFeature.getColSpanningList()}onLeftChanged(){var e;this.cellComp&&((e=this.cellPositionFeature)===null||e===void 0||e.onLeftChanged())}onDisplayedColumnsChanged(){this.eGui&&this.setAriaColIndex()}setAriaColIndex(){const e=this.beans.columnModel.getAriaColumnIndex(this.column);setAriaColIndex(this.getGui(),e)}isSuppressNavigable(){return this.column.isSuppressNavigable(this.rowNode)}onWidthChanged(){var e;return(e=this.cellPositionFeature)===null||e===void 0?void 0:e.onWidthChanged()}getColumn(){return this.column}getRowNode(){return this.rowNode}getBeans(){return this.beans}isPrintLayout(){return this.printLayout}appendChild(e){this.eGui.appendChild(e)}refreshHandle(){this.cellRangeFeature&&this.cellRangeFeature.refreshHandle()}getCellPosition(){return this.cellPosition}isEditing(){return this.editing}startRowOrCellEdit(e,t=null){this.cellComp&&(this.beans.gridOptionsService.get("editType")==="fullRow"?this.rowCtrl.startRowEditing(e,this):this.startEditing(e,!0,t))}getRowCtrl(){return this.rowCtrl}getRowPosition(){return{rowIndex:this.cellPosition.rowIndex,rowPinned:this.cellPosition.rowPinned}}updateRangeBordersIfRangeCount(){this.cellComp&&this.cellRangeFeature&&this.cellRangeFeature.updateRangeBordersIfRangeCount()}onRangeSelectionChanged(){this.cellComp&&this.cellRangeFeature&&this.cellRangeFeature.onRangeSelectionChanged()}isRangeSelectionEnabled(){return this.cellRangeFeature!=null}focusCell(e=!1){this.beans.focusService.setFocusedCell({rowIndex:this.getCellPosition().rowIndex,column:this.column,rowPinned:this.rowNode.rowPinned,forceBrowserFocus:e})}onRowIndexChanged(){this.createCellPosition(),this.onCellFocused(),this.cellRangeFeature&&this.cellRangeFeature.onRangeSelectionChanged()}onFirstRightPinnedChanged(){if(!this.cellComp)return;const e=this.column.isFirstRightPinned();this.cellComp.addOrRemoveCssClass(CSS_CELL_FIRST_RIGHT_PINNED,e)}onLastLeftPinnedChanged(){if(!this.cellComp)return;const e=this.column.isLastLeftPinned();this.cellComp.addOrRemoveCssClass(CSS_CELL_LAST_LEFT_PINNED,e)}onCellFocused(e){if(!this.cellComp||this.beans.gridOptionsService.is("suppressCellFocus"))return;const t=this.beans.focusService.isCellFocused(this.cellPosition);this.cellComp.addOrRemoveCssClass(CSS_CELL_FOCUS,t),t&&e&&e.forceBrowserFocus&&this.cellComp.getFocusableElement().focus({preventScroll:!!e.preventScrollOnBrowserFocus});const n=this.beans.gridOptionsService.get("editType")==="fullRow";!t&&!n&&this.editing&&this.stopRowOrCellEdit()}createCellPosition(){this.cellPosition={rowIndex:this.rowNode.rowIndex,rowPinned:makeNull(this.rowNode.rowPinned),column:this.column}}applyStaticCssClasses(){this.cellComp.addOrRemoveCssClass(CSS_CELL,!0),this.cellComp.addOrRemoveCssClass(CSS_CELL_NOT_INLINE_EDITING,!0);const e=this.column.isAutoHeight()==!0;this.cellComp.addOrRemoveCssClass(CSS_AUTO_HEIGHT,e),this.cellComp.addOrRemoveCssClass(CSS_NORMAL_HEIGHT,!e)}onColumnHover(){if(!this.cellComp||!this.beans.gridOptionsService.is("columnHoverHighlight"))return;const e=this.beans.columnHoverService.isHovered(this.column);this.cellComp.addOrRemoveCssClass(CSS_COLUMN_HOVER,e)}onColDefChanged(){this.cellComp&&(this.setWrapText(),this.editing||this.refreshCell({forceRefresh:!0,suppressFlash:!0}))}setWrapText(){const e=this.column.getColDef().wrapText==!0;this.cellComp.addOrRemoveCssClass(CSS_CELL_WRAP_TEXT,e)}dispatchCellContextMenuEvent(e){const t=this.column.getColDef(),n=this.createEvent(e,Events.EVENT_CELL_CONTEXT_MENU);this.beans.eventService.dispatchEvent(n),t.onCellContextMenu&&window.setTimeout(()=>t.onCellContextMenu(n),0)}getCellRenderer(){return this.cellComp?this.cellComp.getCellRenderer():null}getCellEditor(){return this.cellComp?this.cellComp.getCellEditor():null}destroy(){this.onCellCompAttachedFuncs=[],super.destroy()}createSelectionCheckbox(){const e=new CheckboxSelectionComponent;return this.beans.context.createBean(e),e.init({rowNode:this.rowNode,column:this.column}),e}createDndSource(){const e=new DndSourceComp(this.rowNode,this.column,this.eGui);return this.beans.context.createBean(e),e}registerRowDragger(e,t,n){if(this.customRowDragComp){this.customRowDragComp.setDragElement(e,t);return}const o=this.createRowDragComp(e,t,n);o&&(this.customRowDragComp=o,this.addDestroyFunc(()=>{this.beans.context.destroyBean(o),this.customRowDragComp=null}))}createRowDragComp(e,t,n){const o=this.beans.gridOptionsService.is("pagination"),a=this.beans.gridOptionsService.is("rowDragManaged"),l=this.beans.gridOptionsService.isRowModelType("clientSide");if(a){if(!l){doOnce(()=>console.warn("AG Grid: managed row dragging is only allowed in the Client Side Row Model"),"CellComp.addRowDragging");return}if(o){doOnce(()=>console.warn("AG Grid: managed row dragging is not possible when doing pagination"),"CellComp.addRowDragging");return}}const s=new RowDragComp(()=>this.value,this.rowNode,this.column,e,t,n);return this.beans.context.createBean(s),s}}CellCtrl.DOM_DATA_KEY_CELL_CTRL="cellCtrl";var RowType$1;(function(r){r.Normal="Normal",r.FullWidth="FullWidth",r.FullWidthLoading="FullWidthLoading",r.FullWidthGroup="FullWidthGroup",r.FullWidthDetail="FullWidthDetail"})(RowType$1||(RowType$1={}));let instanceIdSequence$2=0;class RowCtrl extends BeanStub{constructor(e,t,n,o,a){super(),this.allRowGuis=[],this.active=!0,this.centerCellCtrls={list:[],map:{}},this.leftCellCtrls={list:[],map:{}},this.rightCellCtrls={list:[],map:{}},this.slideInAnimation={left:!1,center:!1,right:!1,fullWidth:!1},this.fadeInAnimation={left:!1,center:!1,right:!1,fullWidth:!1},this.lastMouseDownOnDragger=!1,this.updateColumnListsPending=!1,this.businessKeySanitised=null,this.beans=t,this.gridOptionsService=t.gridOptionsService,this.rowNode=e,this.paginationPage=t.paginationProxy.getCurrentPage(),this.useAnimationFrameForCreate=o,this.printLayout=a,this.instanceId=e.id+"-"+instanceIdSequence$2++,this.setAnimateFlags(n),this.initRowBusinessKey(),this.rowFocused=t.focusService.isRowFocused(this.rowNode.rowIndex,this.rowNode.rowPinned),this.rowLevel=t.rowCssClassCalculator.calculateRowLevel(this.rowNode),this.setRowType(),this.addListeners()}initRowBusinessKey(){this.businessKeyForNodeFunc=this.gridOptionsService.get("getBusinessKeyForNode"),this.updateRowBusinessKey()}updateRowBusinessKey(){if(typeof this.businessKeyForNodeFunc!="function")return;const e=this.businessKeyForNodeFunc(this.rowNode);this.businessKeySanitised=escapeString(e)}isSticky(){return this.rowNode.sticky}getBeans(){return this.beans}getInstanceId(){return this.instanceId}setComp(e,t,n){const o={rowComp:e,element:t,containerType:n};this.allRowGuis.push(o),n===RowContainerType.LEFT?this.leftGui=o:n===RowContainerType.RIGHT?this.rightGui=o:n===RowContainerType.FULL_WIDTH?this.fullWidthGui=o:this.centerGui=o,this.initialiseRowComp(o),this.rowType!=="FullWidthLoading"&&!this.rowNode.rowPinned&&this.beans.rowRenderer.dispatchFirstDataRenderedEvent()}unsetComp(e){this.allRowGuis=this.allRowGuis.filter(t=>t.containerType!==e),e===RowContainerType.LEFT?this.leftGui=void 0:e===RowContainerType.RIGHT?this.rightGui=void 0:e===RowContainerType.FULL_WIDTH&&(this.fullWidthGui=void 0)}isCacheable(){return this.rowType===RowType$1.FullWidthDetail&&this.gridOptionsService.is("keepDetailRows")}setCached(e){const t=e?"none":"";this.allRowGuis.forEach(n=>n.element.style.display=t)}initialiseRowComp(e){const t=this.gridOptionsService;this.listenOnDomOrder(e),this.onRowHeightChanged(e),this.updateRowIndexes(e),this.setFocusedClasses(e),this.setStylesFromGridOptions(e),t.isRowSelection()&&this.rowNode.selectable&&this.onRowSelected(e),this.updateColumnLists(!this.useAnimationFrameForCreate);const n=e.rowComp;n.setRole("row"),this.getInitialRowClasses(e.containerType).forEach(a=>n.addOrRemoveCssClass(a,!0)),this.executeSlideAndFadeAnimations(e),this.rowNode.group&&setAriaExpanded(e.element,this.rowNode.expanded==!0),this.setRowCompRowId(n),this.setRowCompRowBusinessKey(n),this.isFullWidth()&&!this.gridOptionsService.is("suppressCellFocus")&&n.setTabIndex(-1),t.setDomData(e.element,RowCtrl.DOM_DATA_KEY_ROW_CTRL,this),this.addDestroyFunc(()=>t.setDomData(e.element,RowCtrl.DOM_DATA_KEY_ROW_CTRL,null)),this.useAnimationFrameForCreate?this.beans.animationFrameService.createTask(this.addHoverFunctionality.bind(this,e.element),this.rowNode.rowIndex,"createTasksP2"):this.addHoverFunctionality(e.element),this.isFullWidth()&&this.setupFullWidth(e),t.is("rowDragEntireRow")&&this.addRowDraggerToRow(e),this.useAnimationFrameForCreate&&this.beans.animationFrameService.addDestroyTask(()=>{this.isAlive()&&e.rowComp.addOrRemoveCssClass("ag-after-created",!0)}),this.executeProcessRowPostCreateFunc()}setRowCompRowBusinessKey(e){this.businessKeySanitised!=null&&e.setRowBusinessKey(this.businessKeySanitised)}setRowCompRowId(e){const t=escapeString(this.rowNode.id);t!=null&&e.setRowId(t)}executeSlideAndFadeAnimations(e){const{containerType:t}=e;this.slideInAnimation[t]&&(executeNextVMTurn(()=>{this.onTopChanged()}),this.slideInAnimation[t]=!1),this.fadeInAnimation[t]&&(executeNextVMTurn(()=>{e.rowComp.addOrRemoveCssClass("ag-opacity-zero",!1)}),this.fadeInAnimation[t]=!1)}addRowDraggerToRow(e){if(this.gridOptionsService.isEnableRangeSelection()){doOnce(()=>{console.warn("AG Grid: Setting `rowDragEntireRow: true` in the gridOptions doesn't work with `enableRangeSelection: true`")},"rowDragAndRangeSelectionEnabled");return}const t=this.beans.localeService.getLocaleTextFunc(),n=new RowDragComp(()=>`1 ${t("rowDragRow","row")}`,this.rowNode,void 0,e.element,void 0,!0);this.createManagedBean(n,this.beans.context)}setupFullWidth(e){const t=this.getPinnedForContainer(e.containerType),n=this.createFullWidthParams(e.element,t);if(this.rowType==RowType$1.FullWidthDetail&&!ModuleRegistry.__assertRegistered(ModuleNames.MasterDetailModule,"cell renderer 'agDetailCellRenderer' (for master detail)",this.beans.context.getGridId()))return;let o;switch(this.rowType){case RowType$1.FullWidthDetail:o=this.beans.userComponentFactory.getFullWidthDetailCellRendererDetails(n);break;case RowType$1.FullWidthGroup:o=this.beans.userComponentFactory.getFullWidthGroupCellRendererDetails(n);break;case RowType$1.FullWidthLoading:o=this.beans.userComponentFactory.getFullWidthLoadingCellRendererDetails(n);break;default:o=this.beans.userComponentFactory.getFullWidthCellRendererDetails(n);break}e.rowComp.showFullWidth(o)}isPrintLayout(){return this.printLayout}getFullWidthCellRenderer(){var e,t;return(t=(e=this.fullWidthGui)===null||e===void 0?void 0:e.rowComp)===null||t===void 0?void 0:t.getFullWidthCellRenderer()}getCellElement(e){const t=this.getCellCtrl(e);return t?t.getGui():null}executeProcessRowPostCreateFunc(){var e;const t=this.gridOptionsService.getCallback("processRowPostCreate");if(!t||!this.areAllContainersReady())return;const n={eRow:(e=this.centerGui)===null||e===void 0?void 0:e.element,ePinnedLeftRow:this.leftGui?this.leftGui.element:void 0,ePinnedRightRow:this.rightGui?this.rightGui.element:void 0,node:this.rowNode,rowIndex:this.rowNode.rowIndex,addRenderedRowListener:this.addEventListener.bind(this)};t(n)}areAllContainersReady(){const e=!!this.leftGui||!this.beans.columnModel.isPinningLeft(),t=!!this.centerGui,n=!!this.rightGui||!this.beans.columnModel.isPinningRight();return e&&t&&n}setRowType(){const e=this.rowNode.stub,t=this.rowNode.isFullWidthCell(),n=this.beans.doingMasterDetail&&this.rowNode.detail,o=this.beans.columnModel.isPivotMode(),l=!!this.rowNode.group&&!this.rowNode.footer&&this.gridOptionsService.isGroupUseEntireRow(o);e?this.rowType=RowType$1.FullWidthLoading:n?this.rowType=RowType$1.FullWidthDetail:t?this.rowType=RowType$1.FullWidth:l?this.rowType=RowType$1.FullWidthGroup:this.rowType=RowType$1.Normal}updateColumnLists(e=!1,t=!1){if(this.isFullWidth())return;if(e||this.gridOptionsService.is("suppressAnimationFrame")||this.printLayout){this.updateColumnListsImpl(t);return}this.updateColumnListsPending||(this.beans.animationFrameService.createTask(()=>{this.active&&this.updateColumnListsImpl(!0)},this.rowNode.rowIndex,"createTasksP1"),this.updateColumnListsPending=!0)}createCellCtrls(e,t,n=null){const o={list:[],map:{}},a=(l,s)=>{o.list.push(s),o.map[l]=s};return t.forEach(l=>{const s=l.getInstanceId();let m=e.map[s];m||(m=new CellCtrl(l,this.rowNode,this.beans,this)),a(s,m)}),e.list.forEach(l=>{if(o.map[l.getColumn().getInstanceId()]!=null)return;if(!this.isCellEligibleToBeRemoved(l,n)){a(l.getColumn().getInstanceId(),l);return}l.destroy()}),o}updateColumnListsImpl(e=!1){this.updateColumnListsPending=!1;const t=this.beans.columnModel;if(this.printLayout)this.centerCellCtrls=this.createCellCtrls(this.centerCellCtrls,t.getAllDisplayedColumns()),this.leftCellCtrls={list:[],map:{}},this.rightCellCtrls={list:[],map:{}};else{const n=t.getViewportCenterColumnsForRow(this.rowNode);this.centerCellCtrls=this.createCellCtrls(this.centerCellCtrls,n);const o=t.getDisplayedLeftColumnsForRow(this.rowNode);this.leftCellCtrls=this.createCellCtrls(this.leftCellCtrls,o,"left");const a=t.getDisplayedRightColumnsForRow(this.rowNode);this.rightCellCtrls=this.createCellCtrls(this.rightCellCtrls,a,"right")}this.allRowGuis.forEach(n=>{const o=n.containerType===RowContainerType.LEFT?this.leftCellCtrls:n.containerType===RowContainerType.RIGHT?this.rightCellCtrls:this.centerCellCtrls;n.rowComp.setCellCtrls(o.list,e)})}isCellEligibleToBeRemoved(e,t){if(e.getColumn().getPinned()!=t)return!0;const l=e.isEditing(),s=this.beans.focusService.isCellFocused(e.getCellPosition());if(l||s){const y=e.getColumn();return!(this.beans.columnModel.getAllDisplayedColumns().indexOf(y)>=0)}return!0}listenOnDomOrder(e){const t=()=>{const n=this.gridOptionsService.is("ensureDomOrder"),o=this.gridOptionsService.isDomLayout("print");e.rowComp.setDomOrder(n||o)};this.addManagedPropertyListener("domLayout",t),t()}setAnimateFlags(e){if(this.isSticky()||!e)return;const t=exists(this.rowNode.oldRowTop),n=this.beans.columnModel.isPinningLeft(),o=this.beans.columnModel.isPinningRight();t?(this.slideInAnimation.center=!0,this.slideInAnimation.left=n,this.slideInAnimation.right=o):(this.fadeInAnimation.center=!0,this.fadeInAnimation.left=n,this.fadeInAnimation.right=o)}isEditing(){return this.editingRow}stopRowEditing(e){this.stopEditing(e)}isFullWidth(){return this.rowType!==RowType$1.Normal}getRowType(){return this.rowType}refreshFullWidth(){const e=(s,m)=>{if(!s)return!0;const y=s.rowComp.getFullWidthCellRenderer();if(!y||!y.refresh)return!1;const D=this.createFullWidthParams(s.element,m);return y.refresh(D)},t=e(this.fullWidthGui,null),n=e(this.centerGui,null),o=e(this.leftGui,"left"),a=e(this.rightGui,"right");return t&&n&&o&&a}addListeners(){this.addManagedListener(this.rowNode,RowNode.EVENT_HEIGHT_CHANGED,()=>this.onRowHeightChanged()),this.addManagedListener(this.rowNode,RowNode.EVENT_ROW_SELECTED,()=>this.onRowSelected()),this.addManagedListener(this.rowNode,RowNode.EVENT_ROW_INDEX_CHANGED,this.onRowIndexChanged.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_TOP_CHANGED,this.onTopChanged.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_EXPANDED_CHANGED,this.updateExpandedCss.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_HAS_CHILDREN_CHANGED,this.updateExpandedCss.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_DATA_CHANGED,this.onRowNodeDataChanged.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_CELL_CHANGED,this.onRowNodeCellChanged.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_HIGHLIGHT_CHANGED,this.onRowNodeHighlightChanged.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_DRAGGING_CHANGED,this.onRowNodeDraggingChanged.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_UI_LEVEL_CHANGED,this.onUiLevelChanged.bind(this));const e=this.beans.eventService;this.addManagedListener(e,Events.EVENT_PAGINATION_PIXEL_OFFSET_CHANGED,this.onPaginationPixelOffsetChanged.bind(this)),this.addManagedListener(e,Events.EVENT_HEIGHT_SCALE_CHANGED,this.onTopChanged.bind(this)),this.addManagedListener(e,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,this.onDisplayedColumnsChanged.bind(this)),this.addManagedListener(e,Events.EVENT_VIRTUAL_COLUMNS_CHANGED,this.onVirtualColumnsChanged.bind(this)),this.addManagedListener(e,Events.EVENT_CELL_FOCUSED,this.onCellFocused.bind(this)),this.addManagedListener(e,Events.EVENT_CELL_FOCUS_CLEARED,this.onCellFocusCleared.bind(this)),this.addManagedListener(e,Events.EVENT_PAGINATION_CHANGED,this.onPaginationChanged.bind(this)),this.addManagedListener(e,Events.EVENT_MODEL_UPDATED,this.onModelUpdated.bind(this)),this.addManagedListener(e,Events.EVENT_COLUMN_MOVED,this.onColumnMoved.bind(this)),this.addListenersForCellComps()}onColumnMoved(){this.updateColumnLists()}addListenersForCellComps(){this.addManagedListener(this.rowNode,RowNode.EVENT_ROW_INDEX_CHANGED,()=>{this.getAllCellCtrls().forEach(e=>e.onRowIndexChanged())}),this.addManagedListener(this.rowNode,RowNode.EVENT_CELL_CHANGED,e=>{this.getAllCellCtrls().forEach(t=>t.onCellChanged(e))})}onRowNodeDataChanged(e){if(this.rowNode.detailNode&&this.beans.rowRenderer.refreshFullWidthRow(this.rowNode.detailNode),this.isFullWidth()){this.beans.rowRenderer.refreshFullWidthRow(this.rowNode);return}this.getAllCellCtrls().forEach(t=>t.refreshCell({suppressFlash:!e.update,newData:!e.update})),this.allRowGuis.forEach(t=>{this.setRowCompRowId(t.rowComp),this.updateRowBusinessKey(),this.setRowCompRowBusinessKey(t.rowComp)}),this.onRowSelected(),this.postProcessCss()}onRowNodeCellChanged(){this.postProcessCss()}postProcessCss(){this.setStylesFromGridOptions(),this.postProcessClassesFromGridOptions(),this.postProcessRowClassRules(),this.postProcessRowDragging()}onRowNodeHighlightChanged(){const e=this.rowNode.highlighted;this.allRowGuis.forEach(t=>{const n=e===RowHighlightPosition.Above,o=e===RowHighlightPosition.Below;t.rowComp.addOrRemoveCssClass("ag-row-highlight-above",n),t.rowComp.addOrRemoveCssClass("ag-row-highlight-below",o)})}onRowNodeDraggingChanged(){this.postProcessRowDragging()}postProcessRowDragging(){const e=this.rowNode.dragging;this.allRowGuis.forEach(t=>t.rowComp.addOrRemoveCssClass("ag-row-dragging",e))}updateExpandedCss(){const e=this.rowNode.isExpandable(),t=this.rowNode.expanded==!0;this.allRowGuis.forEach(n=>{n.rowComp.addOrRemoveCssClass("ag-row-group",e),n.rowComp.addOrRemoveCssClass("ag-row-group-expanded",e&&t),n.rowComp.addOrRemoveCssClass("ag-row-group-contracted",e&&!t),setAriaExpanded(n.element,e&&t)})}onDisplayedColumnsChanged(){this.updateColumnLists(!0),this.beans.columnModel.wasAutoRowHeightEverActive()&&this.rowNode.checkAutoHeights()}onVirtualColumnsChanged(){this.updateColumnLists(!1,!0)}getRowPosition(){return{rowPinned:makeNull(this.rowNode.rowPinned),rowIndex:this.rowNode.rowIndex}}onKeyboardNavigate(e){const t=this.allRowGuis.find(m=>m.element.contains(e.target));if(!((t?t.element:null)===e.target))return;const a=this.rowNode,l=this.beans.focusService.getFocusedCell(),s={rowIndex:a.rowIndex,rowPinned:a.rowPinned,column:l&&l.column};this.beans.navigationService.navigateToNextCell(e,e.key,s,!0),e.preventDefault()}onTabKeyDown(e){if(e.defaultPrevented||isStopPropagationForAgGrid(e))return;const t=this.allRowGuis.find(l=>l.element.contains(e.target)),n=t?t.element:null,o=n===e.target;let a=null;o||(a=this.beans.focusService.findNextFocusableElement(n,!1,e.shiftKey)),(this.isFullWidth()&&o||!a)&&this.beans.navigationService.onTabKeyDown(this,e)}onFullWidthRowFocused(e){var t;const n=this.rowNode,o=e?this.isFullWidth()&&e.rowIndex===n.rowIndex&&e.rowPinned==n.rowPinned:!1,a=this.fullWidthGui?this.fullWidthGui.element:(t=this.centerGui)===null||t===void 0?void 0:t.element;a&&(a.classList.toggle("ag-full-width-focus",o),o&&a.focus({preventScroll:!0}))}refreshCell(e){this.centerCellCtrls=this.removeCellCtrl(this.centerCellCtrls,e),this.leftCellCtrls=this.removeCellCtrl(this.leftCellCtrls,e),this.rightCellCtrls=this.removeCellCtrl(this.rightCellCtrls,e),this.updateColumnLists()}removeCellCtrl(e,t){const n={list:[],map:{}};return e.list.forEach(o=>{o!==t&&(n.list.push(o),n.map[o.getInstanceId()]=o)}),n}onMouseEvent(e,t){switch(e){case"dblclick":this.onRowDblClick(t);break;case"click":this.onRowClick(t);break;case"touchstart":case"mousedown":this.onRowMouseDown(t);break}}createRowEvent(e,t){return{type:e,node:this.rowNode,data:this.rowNode.data,rowIndex:this.rowNode.rowIndex,rowPinned:this.rowNode.rowPinned,context:this.gridOptionsService.context,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,event:t}}createRowEventWithSource(e,t){const n=this.createRowEvent(e,t);return n.source=this,n}onRowDblClick(e){if(isStopPropagationForAgGrid(e))return;const t=this.createRowEventWithSource(Events.EVENT_ROW_DOUBLE_CLICKED,e);this.beans.eventService.dispatchEvent(t)}onRowMouseDown(e){if(this.lastMouseDownOnDragger=isElementChildOfClass(e.target,"ag-row-drag",3),!this.isFullWidth())return;const t=this.rowNode,n=this.beans.columnModel;this.beans.rangeService&&this.beans.rangeService.removeAllCellRanges(),this.beans.focusService.setFocusedCell({rowIndex:t.rowIndex,column:n.getAllDisplayedColumns()[0],rowPinned:t.rowPinned,forceBrowserFocus:!0})}onRowClick(e){if(isStopPropagationForAgGrid(e)||this.lastMouseDownOnDragger)return;const n=this.createRowEventWithSource(Events.EVENT_ROW_CLICKED,e);this.beans.eventService.dispatchEvent(n);const o=e.ctrlKey||e.metaKey,a=e.shiftKey;if(this.gridOptionsService.is("groupSelectsChildren")&&this.rowNode.group||!this.rowNode.selectable||this.rowNode.rowPinned||!this.gridOptionsService.isRowSelection()||this.gridOptionsService.is("suppressRowClickSelection"))return;const s=this.gridOptionsService.is("rowMultiSelectWithClick"),m=!this.gridOptionsService.is("suppressRowDeselection"),y="rowClicked";if(this.rowNode.isSelected())s?this.rowNode.setSelectedParams({newValue:!1,event:e,source:y}):o?m&&this.rowNode.setSelectedParams({newValue:!1,event:e,source:y}):this.rowNode.setSelectedParams({newValue:!0,clearSelection:!a,rangeSelect:a,event:e,source:y});else{const D=s?!1:!o;this.rowNode.setSelectedParams({newValue:!0,clearSelection:D,rangeSelect:a,event:e,source:y})}}setupDetailRowAutoHeight(e){if(this.rowType!==RowType$1.FullWidthDetail||!this.gridOptionsService.is("detailRowAutoHeight"))return;const t=()=>{const o=e.clientHeight;if(o!=null&&o>0){const a=()=>{this.rowNode.setRowHeight(o),this.beans.clientSideRowModel?this.beans.clientSideRowModel.onRowHeightChanged():this.beans.serverSideRowModel&&this.beans.serverSideRowModel.onRowHeightChanged()};this.beans.frameworkOverrides.setTimeout(a,0)}},n=this.beans.resizeObserverService.observeResize(e,t);this.addDestroyFunc(n),t()}createFullWidthParams(e,t){return{fullWidth:!0,data:this.rowNode.data,node:this.rowNode,value:this.rowNode.key,valueFormatted:this.rowNode.key,rowIndex:this.rowNode.rowIndex,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context,eGridCell:e,eParentOfValue:e,pinned:t,addRenderedRowListener:this.addEventListener.bind(this),registerRowDragger:(o,a,l,s)=>this.addFullWidthRowDragging(o,a,l,s)}}addFullWidthRowDragging(e,t,n="",o){if(!this.isFullWidth())return;const a=new RowDragComp(()=>n,this.rowNode,void 0,e,t,o);this.createManagedBean(a,this.beans.context)}onUiLevelChanged(){const e=this.beans.rowCssClassCalculator.calculateRowLevel(this.rowNode);if(this.rowLevel!=e){const t="ag-row-level-"+e,n="ag-row-level-"+this.rowLevel;this.allRowGuis.forEach(o=>{o.rowComp.addOrRemoveCssClass(t,!0),o.rowComp.addOrRemoveCssClass(n,!1)})}this.rowLevel=e}isFirstRowOnPage(){return this.rowNode.rowIndex===this.beans.paginationProxy.getPageFirstRow()}isLastRowOnPage(){return this.rowNode.rowIndex===this.beans.paginationProxy.getPageLastRow()}onModelUpdated(){this.refreshFirstAndLastRowStyles()}refreshFirstAndLastRowStyles(){const e=this.isFirstRowOnPage(),t=this.isLastRowOnPage();this.firstRowOnPage!==e&&(this.firstRowOnPage=e,this.allRowGuis.forEach(n=>n.rowComp.addOrRemoveCssClass("ag-row-first",e))),this.lastRowOnPage!==t&&(this.lastRowOnPage=t,this.allRowGuis.forEach(n=>n.rowComp.addOrRemoveCssClass("ag-row-last",t)))}stopEditing(e=!1){if(this.stoppingRowEdit)return;const t=this.getAllCellCtrls(),n=this.editingRow;this.stoppingRowEdit=!0;let o=!1;for(const a of t){const l=a.stopEditing(e);n&&!e&&!o&&l&&(o=!0)}if(o){const a=this.createRowEvent(Events.EVENT_ROW_VALUE_CHANGED);this.beans.eventService.dispatchEvent(a)}n&&this.setEditingRow(!1),this.stoppingRowEdit=!1}setInlineEditingCss(e){this.allRowGuis.forEach(t=>{t.rowComp.addOrRemoveCssClass("ag-row-inline-editing",e),t.rowComp.addOrRemoveCssClass("ag-row-not-inline-editing",!e)})}setEditingRow(e){this.editingRow=e,this.allRowGuis.forEach(n=>n.rowComp.addOrRemoveCssClass("ag-row-editing",e));const t=e?this.createRowEvent(Events.EVENT_ROW_EDITING_STARTED):this.createRowEvent(Events.EVENT_ROW_EDITING_STOPPED);this.beans.eventService.dispatchEvent(t)}startRowEditing(e=null,t=null,n=null){if(this.editingRow)return;this.getAllCellCtrls().reduce((a,l)=>{const s=l===t;return s?l.startEditing(e,s,n):l.startEditing(null,s,n),a?!0:l.isEditing()},!1)&&this.setEditingRow(!0)}getAllCellCtrls(){return this.leftCellCtrls.list.length===0&&this.rightCellCtrls.list.length===0?this.centerCellCtrls.list:[...this.centerCellCtrls.list,...this.leftCellCtrls.list,...this.rightCellCtrls.list]}postProcessClassesFromGridOptions(){const e=this.beans.rowCssClassCalculator.processClassesFromGridOptions(this.rowNode);!e||!e.length||e.forEach(t=>{this.allRowGuis.forEach(n=>n.rowComp.addOrRemoveCssClass(t,!0))})}postProcessRowClassRules(){this.beans.rowCssClassCalculator.processRowClassRules(this.rowNode,e=>{this.allRowGuis.forEach(t=>t.rowComp.addOrRemoveCssClass(e,!0))},e=>{this.allRowGuis.forEach(t=>t.rowComp.addOrRemoveCssClass(e,!1))})}setStylesFromGridOptions(e){const t=this.processStylesFromGridOptions();this.forEachGui(e,n=>n.rowComp.setUserStyles(t))}getPinnedForContainer(e){return e===RowContainerType.LEFT?"left":e===RowContainerType.RIGHT?"right":null}getInitialRowClasses(e){const t=this.getPinnedForContainer(e),n={rowNode:this.rowNode,rowFocused:this.rowFocused,fadeRowIn:this.fadeInAnimation[e],rowIsEven:this.rowNode.rowIndex%2===0,rowLevel:this.rowLevel,fullWidthRow:this.isFullWidth(),firstRowOnPage:this.isFirstRowOnPage(),lastRowOnPage:this.isLastRowOnPage(),printLayout:this.printLayout,expandable:this.rowNode.isExpandable(),pinned:t};return this.beans.rowCssClassCalculator.getInitialRowClasses(n)}processStylesFromGridOptions(){const e=this.gridOptionsService.get("rowStyle");if(e&&typeof e=="function"){console.warn("AG Grid: rowStyle should be an object of key/value styles, not be a function, use getRowStyle() instead");return}const t=this.gridOptionsService.getCallback("getRowStyle");let n;if(t){const o={data:this.rowNode.data,node:this.rowNode,rowIndex:this.rowNode.rowIndex};n=t(o)}return Object.assign({},e,n)}onRowSelected(e){const t=!!this.rowNode.isSelected();this.forEachGui(e,n=>{n.rowComp.addOrRemoveCssClass("ag-row-selected",t),setAriaSelected(n.element,t?!0:void 0);const o=this.createAriaLabel();setAriaLabel(n.element,o??"")})}createAriaLabel(){const e=this.rowNode.isSelected();return e&&this.gridOptionsService.is("suppressRowDeselection")?void 0:this.beans.localeService.getLocaleTextFunc()(e?"ariaRowDeselect":"ariaRowSelect",`Press SPACE to ${e?"deselect":"select"} this row.`)}isUseAnimationFrameForCreate(){return this.useAnimationFrameForCreate}addHoverFunctionality(e){this.active&&(this.addManagedListener(e,"mouseenter",()=>this.rowNode.onMouseEnter()),this.addManagedListener(e,"mouseleave",()=>this.rowNode.onMouseLeave()),this.addManagedListener(this.rowNode,RowNode.EVENT_MOUSE_ENTER,()=>{!this.beans.dragService.isDragging()&&!this.gridOptionsService.is("suppressRowHoverHighlight")&&(e.classList.add("ag-row-hover"),this.rowNode.setHovered(!0))}),this.addManagedListener(this.rowNode,RowNode.EVENT_MOUSE_LEAVE,()=>{e.classList.remove("ag-row-hover"),this.rowNode.setHovered(!1)}))}roundRowTopToBounds(e){const n=this.beans.ctrlsService.getGridBodyCtrl().getScrollFeature().getVScrollPosition(),o=this.applyPaginationOffset(n.top,!0)-100,a=this.applyPaginationOffset(n.bottom,!0)+100;return Math.min(Math.max(o,e),a)}getFrameworkOverrides(){return this.beans.frameworkOverrides}forEachGui(e,t){(e?[e]:this.allRowGuis).forEach(t)}onRowHeightChanged(e){if(this.rowNode.rowHeight==null)return;const t=this.rowNode.rowHeight,n=this.beans.environment.getDefaultRowHeight(),a=this.gridOptionsService.isGetRowHeightFunction()?this.gridOptionsService.getRowHeightForNode(this.rowNode).height:void 0,l=a?`${Math.min(n,a)-2}px`:void 0;this.forEachGui(e,s=>{s.element.style.height=`${t}px`,l&&s.element.style.setProperty("--ag-line-height",l)})}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}destroyFirstPass(){this.active=!1,this.gridOptionsService.isAnimateRows()&&this.setupRemoveAnimation(),this.rowNode.setHovered(!1);const e=this.createRowEvent(Events.EVENT_VIRTUAL_ROW_REMOVED);this.dispatchEvent(e),this.beans.eventService.dispatchEvent(e),super.destroy()}setupRemoveAnimation(){if(this.isSticky())return;if(this.rowNode.rowTop!=null){const t=this.roundRowTopToBounds(this.rowNode.rowTop);this.setRowTop(t)}else this.allRowGuis.forEach(t=>t.rowComp.addOrRemoveCssClass("ag-opacity-zero",!0))}destroySecondPass(){this.allRowGuis.length=0;const e=t=>(t.list.forEach(n=>n.destroy()),{list:[],map:{}});this.centerCellCtrls=e(this.centerCellCtrls),this.leftCellCtrls=e(this.leftCellCtrls),this.rightCellCtrls=e(this.rightCellCtrls)}setFocusedClasses(e){this.forEachGui(e,t=>{t.rowComp.addOrRemoveCssClass("ag-row-focus",this.rowFocused),t.rowComp.addOrRemoveCssClass("ag-row-no-focus",!this.rowFocused)})}onCellFocused(){this.onCellFocusChanged()}onCellFocusCleared(){this.onCellFocusChanged()}onCellFocusChanged(){const e=this.beans.focusService.isRowFocused(this.rowNode.rowIndex,this.rowNode.rowPinned);e!==this.rowFocused&&(this.rowFocused=e,this.setFocusedClasses()),!e&&this.editingRow&&this.stopEditing(!1)}onPaginationChanged(){const e=this.beans.paginationProxy.getCurrentPage();this.paginationPage!==e&&(this.paginationPage=e,this.onTopChanged()),this.refreshFirstAndLastRowStyles()}onTopChanged(){this.setRowTop(this.rowNode.rowTop)}onPaginationPixelOffsetChanged(){this.onTopChanged()}applyPaginationOffset(e,t=!1){if(this.rowNode.isRowPinned()||this.rowNode.sticky)return e;const n=this.beans.paginationProxy.getPixelOffset();return e+n*(t?1:-1)}setRowTop(e){if(!this.printLayout&&exists(e)){const t=this.applyPaginationOffset(e),a=`${this.rowNode.isRowPinned()||this.rowNode.sticky?t:this.beans.rowContainerHeightService.getRealPixelPosition(t)}px`;this.setRowTopStyle(a)}}getInitialRowTop(e){return this.gridOptionsService.is("suppressRowTransform")?this.getInitialRowTopShared(e):void 0}getInitialTransform(e){return this.gridOptionsService.is("suppressRowTransform")?void 0:`translateY(${this.getInitialRowTopShared(e)})`}getInitialRowTopShared(e){if(this.printLayout)return"";let t;if(this.isSticky())t=this.rowNode.stickyRowTop;else{const n=this.slideInAnimation[e]?this.roundRowTopToBounds(this.rowNode.oldRowTop):this.rowNode.rowTop,o=this.applyPaginationOffset(n);t=this.rowNode.isRowPinned()?o:this.beans.rowContainerHeightService.getRealPixelPosition(o)}return t+"px"}setRowTopStyle(e){const t=this.gridOptionsService.is("suppressRowTransform");this.allRowGuis.forEach(n=>t?n.rowComp.setTop(e):n.rowComp.setTransform(`translateY(${e})`))}getRowNode(){return this.rowNode}getCellCtrl(e){let t=null;return this.getAllCellCtrls().forEach(n=>{n.getColumn()==e&&(t=n)}),t!=null||this.getAllCellCtrls().forEach(n=>{n.getColSpanningList().indexOf(e)>=0&&(t=n)}),t}onRowIndexChanged(){this.rowNode.rowIndex!=null&&(this.onCellFocusChanged(),this.updateRowIndexes(),this.postProcessCss())}updateRowIndexes(e){const t=this.rowNode.getRowIndexString(),n=this.beans.headerNavigationService.getHeaderRowCount(),o=this.rowNode.rowIndex%2===0,a=n+this.rowNode.rowIndex+1;this.forEachGui(e,l=>{l.rowComp.setRowIndex(t),l.rowComp.addOrRemoveCssClass("ag-row-even",o),l.rowComp.addOrRemoveCssClass("ag-row-odd",!o),setAriaRowIndex(l.element,a)})}getPinnedLeftRowElement(){return this.leftGui?this.leftGui.element:void 0}getPinnedRightRowElement(){return this.rightGui?this.rightGui.element:void 0}getBodyRowElement(){return this.centerGui?this.centerGui.element:void 0}getFullWidthRowElement(){return this.fullWidthGui?this.fullWidthGui.element:void 0}}RowCtrl.DOM_DATA_KEY_ROW_CTRL="renderedRow";var __decorate$1M=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class RowContainerEventsFeature extends BeanStub{constructor(e){super(),this.element=e}postConstruct(){this.addKeyboardListeners(),this.addMouseListeners(),this.mockContextMenuForIPad()}addKeyboardListeners(){const e="keydown",t=this.processKeyboardEvent.bind(this,e);this.addManagedListener(this.element,e,t)}addMouseListeners(){["dblclick","contextmenu","mouseover","mouseout","click",isEventSupported("touchstart")?"touchstart":"mousedown"].forEach(n=>{const o=this.processMouseEvent.bind(this,n);this.addManagedListener(this.element,n,o)})}processMouseEvent(e,t){if(!this.mouseEventService.isEventFromThisGrid(t)||isStopPropagationForAgGrid(t))return;const n=this.getRowForEvent(t),o=this.mouseEventService.getRenderedCellForEvent(t);e==="contextmenu"?this.handleContextMenuMouseEvent(t,null,n,o):(o&&o.onMouseEvent(e,t),n&&n.onMouseEvent(e,t))}mockContextMenuForIPad(){if(!isIOSUserAgent())return;const e=new TouchListener(this.element),t=n=>{const o=this.getRowForEvent(n.touchEvent),a=this.mouseEventService.getRenderedCellForEvent(n.touchEvent);this.handleContextMenuMouseEvent(null,n.touchEvent,o,a)};this.addManagedListener(e,TouchListener.EVENT_LONG_TAP,t),this.addDestroyFunc(()=>e.destroy())}getRowForEvent(e){let t=e.target;for(;t;){const n=this.gridOptionsService.getDomData(t,RowCtrl.DOM_DATA_KEY_ROW_CTRL);if(n)return n;t=t.parentElement}return null}handleContextMenuMouseEvent(e,t,n,o){const a=n?n.getRowNode():null,l=o?o.getColumn():null;let s=null;if(l){const D=e||t;o.dispatchCellContextMenuEvent(D),s=this.valueService.getValue(l,a)}const m=this.ctrlsService.getGridBodyCtrl(),y=o?o.getGui():m.getGridBodyElement();this.contextMenuFactory&&this.contextMenuFactory.onContextMenu(e,t,a,l,s,y)}getControlsForEventTarget(e){return{cellCtrl:getCtrlForEventTarget(this.gridOptionsService,e,CellCtrl.DOM_DATA_KEY_CELL_CTRL),rowCtrl:getCtrlForEventTarget(this.gridOptionsService,e,RowCtrl.DOM_DATA_KEY_ROW_CTRL)}}processKeyboardEvent(e,t){const{cellCtrl:n,rowCtrl:o}=this.getControlsForEventTarget(t.target);t.defaultPrevented||(n?this.processCellKeyboardEvent(n,e,t):o&&o.isFullWidth()&&this.processFullWidthRowKeyboardEvent(o,e,t))}processCellKeyboardEvent(e,t,n){const o=e.getRowNode(),a=e.getColumn(),l=e.isEditing();if(!isUserSuppressingKeyboardEvent(this.gridOptionsService,n,o,a,l)&&t==="keydown"&&(!l&&this.navigationService.handlePageScrollingKey(n)||e.onKeyDown(n),this.doGridOperations(n,e.isEditing()),isEventFromPrintableCharacter(n)&&e.processCharacter(n)),t==="keydown"){const m=e.createEvent(n,Events.EVENT_CELL_KEY_DOWN);this.eventService.dispatchEvent(m)}}processFullWidthRowKeyboardEvent(e,t,n){const o=e.getRowNode(),a=this.focusService.getFocusedCell(),l=a&&a.column;if(!isUserSuppressingKeyboardEvent(this.gridOptionsService,n,o,l,!1)){const m=n.key;if(t==="keydown")switch(m){case KeyCode.PAGE_HOME:case KeyCode.PAGE_END:case KeyCode.PAGE_UP:case KeyCode.PAGE_DOWN:this.navigationService.handlePageScrollingKey(n,!0);break;case KeyCode.UP:case KeyCode.DOWN:e.onKeyboardNavigate(n);break;case KeyCode.TAB:e.onTabKeyDown(n);break}}if(t==="keydown"){const m=e.createRowEvent(Events.EVENT_CELL_KEY_DOWN,n);this.eventService.dispatchEvent(m)}}doGridOperations(e,t){if(!e.ctrlKey&&!e.metaKey||t||!this.mouseEventService.isEventFromThisGrid(e))return;const n=normaliseQwertyAzerty(e);if(n===KeyCode.A)return this.onCtrlAndA(e);if(n===KeyCode.C)return this.onCtrlAndC(e);if(n===KeyCode.D)return this.onCtrlAndD(e);if(n===KeyCode.V)return this.onCtrlAndV(e);if(n===KeyCode.X)return this.onCtrlAndX(e);if(n===KeyCode.Y)return this.onCtrlAndY();if(n===KeyCode.Z)return this.onCtrlAndZ(e)}onCtrlAndA(e){const{pinnedRowModel:t,paginationProxy:n,rangeService:o}=this;if(o&&n.isRowsToRender()){const[a,l]=[t.isEmpty("top"),t.isEmpty("bottom")],s=a?null:"top";let m,y;l?(m=null,y=this.paginationProxy.getRowCount()-1):(m="bottom",y=t.getPinnedBottomRowData().length-1);const D=this.columnModel.getAllDisplayedColumns();if(missingOrEmpty(D))return;o.setCellRange({rowStartIndex:0,rowStartPinned:s,rowEndIndex:y,rowEndPinned:m,columnStart:D[0],columnEnd:last(D)})}e.preventDefault()}onCtrlAndC(e){if(!this.clipboardService||this.gridOptionsService.is("enableCellTextSelection"))return;const{cellCtrl:t,rowCtrl:n}=this.getControlsForEventTarget(e.target);t!=null&&t.isEditing()||n!=null&&n.isEditing()||(e.preventDefault(),this.clipboardService.copyToClipboard())}onCtrlAndX(e){if(!this.clipboardService||this.gridOptionsService.is("enableCellTextSelection")||this.gridOptionsService.is("suppressCutToClipboard"))return;const{cellCtrl:t,rowCtrl:n}=this.getControlsForEventTarget(e.target);t!=null&&t.isEditing()||n!=null&&n.isEditing()||(e.preventDefault(),this.clipboardService.cutToClipboard(void 0,"ui"))}onCtrlAndV(e){const{cellCtrl:t,rowCtrl:n}=this.getControlsForEventTarget(e.target);t!=null&&t.isEditing()||n!=null&&n.isEditing()||this.clipboardService&&!this.gridOptionsService.is("suppressClipboardPaste")&&this.clipboardService.pasteFromClipboard()}onCtrlAndD(e){this.clipboardService&&!this.gridOptionsService.is("suppressClipboardPaste")&&this.clipboardService.copyRangeDown(),e.preventDefault()}onCtrlAndZ(e){this.gridOptionsService.is("undoRedoCellEditing")&&(e.preventDefault(),e.shiftKey?this.undoRedoService.redo("ui"):this.undoRedoService.undo("ui"))}onCtrlAndY(){this.undoRedoService.redo("ui")}}__decorate$1M([Autowired("mouseEventService")],RowContainerEventsFeature.prototype,"mouseEventService",void 0);__decorate$1M([Autowired("valueService")],RowContainerEventsFeature.prototype,"valueService",void 0);__decorate$1M([Optional("contextMenuFactory")],RowContainerEventsFeature.prototype,"contextMenuFactory",void 0);__decorate$1M([Autowired("ctrlsService")],RowContainerEventsFeature.prototype,"ctrlsService",void 0);__decorate$1M([Autowired("navigationService")],RowContainerEventsFeature.prototype,"navigationService",void 0);__decorate$1M([Autowired("focusService")],RowContainerEventsFeature.prototype,"focusService",void 0);__decorate$1M([Autowired("undoRedoService")],RowContainerEventsFeature.prototype,"undoRedoService",void 0);__decorate$1M([Autowired("columnModel")],RowContainerEventsFeature.prototype,"columnModel",void 0);__decorate$1M([Autowired("paginationProxy")],RowContainerEventsFeature.prototype,"paginationProxy",void 0);__decorate$1M([Autowired("pinnedRowModel")],RowContainerEventsFeature.prototype,"pinnedRowModel",void 0);__decorate$1M([Optional("rangeService")],RowContainerEventsFeature.prototype,"rangeService",void 0);__decorate$1M([Optional("clipboardService")],RowContainerEventsFeature.prototype,"clipboardService",void 0);__decorate$1M([PostConstruct],RowContainerEventsFeature.prototype,"postConstruct",null);var __decorate$1L=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class ViewportSizeFeature extends BeanStub{constructor(e){super(),this.centerContainerCtrl=e}postConstruct(){this.ctrlsService.whenReady(()=>{this.gridBodyCtrl=this.ctrlsService.getGridBodyCtrl(),this.listenForResize()}),this.addManagedListener(this.eventService,Events.EVENT_SCROLLBAR_WIDTH_CHANGED,this.onScrollbarWidthChanged.bind(this))}listenForResize(){const e=()=>this.onCenterViewportResized();this.centerContainerCtrl.registerViewportResizeListener(e),this.gridBodyCtrl.registerBodyViewportResizeListener(e)}onScrollbarWidthChanged(){this.checkViewportAndScrolls()}onCenterViewportResized(){if(this.centerContainerCtrl.isViewportVisible()){this.checkViewportAndScrolls();const e=this.centerContainerCtrl.getCenterWidth();e!==this.centerWidth&&(this.centerWidth=e,this.columnModel.refreshFlexedColumns({viewportWidth:this.centerWidth,updateBodyWidths:!0,fireResizedEvent:!0}))}else this.bodyHeight=0}checkViewportAndScrolls(){this.updateScrollVisibleService(),this.checkBodyHeight(),this.onHorizontalViewportChanged(),this.gridBodyCtrl.getScrollFeature().checkScrollLeft()}getBodyHeight(){return this.bodyHeight}checkBodyHeight(){const e=this.gridBodyCtrl.getBodyViewportElement(),t=getInnerHeight(e);if(this.bodyHeight!==t){this.bodyHeight=t;const n={type:Events.EVENT_BODY_HEIGHT_CHANGED};this.eventService.dispatchEvent(n)}}updateScrollVisibleService(){this.updateScrollVisibleServiceImpl(),setTimeout(this.updateScrollVisibleServiceImpl.bind(this),500)}updateScrollVisibleServiceImpl(){const e={horizontalScrollShowing:this.isHorizontalScrollShowing(),verticalScrollShowing:this.gridBodyCtrl.isVerticalScrollShowing()};this.scrollVisibleService.setScrollsVisible(e)}isHorizontalScrollShowing(){return this.centerContainerCtrl.isHorizontalScrollShowing()}onHorizontalViewportChanged(){const e=this.centerContainerCtrl.getCenterWidth(),t=this.centerContainerCtrl.getViewportScrollLeft();this.columnModel.setViewportPosition(e,t)}}__decorate$1L([Autowired("ctrlsService")],ViewportSizeFeature.prototype,"ctrlsService",void 0);__decorate$1L([Autowired("columnModel")],ViewportSizeFeature.prototype,"columnModel",void 0);__decorate$1L([Autowired("scrollVisibleService")],ViewportSizeFeature.prototype,"scrollVisibleService",void 0);__decorate$1L([PostConstruct],ViewportSizeFeature.prototype,"postConstruct",null);var __decorate$1K=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class SetPinnedLeftWidthFeature extends BeanStub{constructor(e){super(),this.element=e}postConstruct(){this.addManagedListener(this.eventService,Events.EVENT_LEFT_PINNED_WIDTH_CHANGED,this.onPinnedLeftWidthChanged.bind(this))}onPinnedLeftWidthChanged(){const e=this.pinnedWidthService.getPinnedLeftWidth(),t=e>0;setDisplayed(this.element,t),setFixedWidth(this.element,e)}getWidth(){return this.pinnedWidthService.getPinnedLeftWidth()}}__decorate$1K([Autowired("pinnedWidthService")],SetPinnedLeftWidthFeature.prototype,"pinnedWidthService",void 0);__decorate$1K([PostConstruct],SetPinnedLeftWidthFeature.prototype,"postConstruct",null);var __decorate$1J=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class SetPinnedRightWidthFeature extends BeanStub{constructor(e){super(),this.element=e}postConstruct(){this.addManagedListener(this.eventService,Events.EVENT_RIGHT_PINNED_WIDTH_CHANGED,this.onPinnedRightWidthChanged.bind(this))}onPinnedRightWidthChanged(){const e=this.pinnedWidthService.getPinnedRightWidth(),t=e>0;setDisplayed(this.element,t),setFixedWidth(this.element,e)}getWidth(){return this.pinnedWidthService.getPinnedRightWidth()}}__decorate$1J([Autowired("pinnedWidthService")],SetPinnedRightWidthFeature.prototype,"pinnedWidthService",void 0);__decorate$1J([PostConstruct],SetPinnedRightWidthFeature.prototype,"postConstruct",null);var __decorate$1I=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class SetHeightFeature extends BeanStub{constructor(e,t){super(),this.eContainer=e,this.eWrapper=t}postConstruct(){this.addManagedListener(this.eventService,Events.EVENT_ROW_CONTAINER_HEIGHT_CHANGED,this.onHeightChanged.bind(this))}onHeightChanged(){const e=this.maxDivHeightScaler.getUiContainerHeight(),t=e!=null?`${e}px`:"";this.eContainer.style.height=t,this.eWrapper&&(this.eWrapper.style.height=t)}}__decorate$1I([Autowired("rowContainerHeightService")],SetHeightFeature.prototype,"maxDivHeightScaler",void 0);__decorate$1I([PostConstruct],SetHeightFeature.prototype,"postConstruct",null);var __decorate$1H=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class DragListenerFeature extends BeanStub{constructor(e){super(),this.eContainer=e}postConstruct(){if(!this.gridOptionsService.isEnableRangeSelection()||missing(this.rangeService))return;const e={eElement:this.eContainer,onDragStart:this.rangeService.onDragStart.bind(this.rangeService),onDragStop:this.rangeService.onDragStop.bind(this.rangeService),onDragging:this.rangeService.onDragging.bind(this.rangeService)};this.dragService.addDragSource(e),this.addDestroyFunc(()=>this.dragService.removeDragSource(e))}}__decorate$1H([Optional("rangeService")],DragListenerFeature.prototype,"rangeService",void 0);__decorate$1H([Autowired("dragService")],DragListenerFeature.prototype,"dragService",void 0);__decorate$1H([PostConstruct],DragListenerFeature.prototype,"postConstruct",null);var __decorate$1G=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class CenterWidthFeature extends BeanStub{constructor(e,t=!1){super(),this.callback=e,this.addSpacer=t}postConstruct(){const e=this.setWidth.bind(this);this.addManagedPropertyListener("domLayout",e),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,e),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED,e),this.addManagedListener(this.eventService,Events.EVENT_LEFT_PINNED_WIDTH_CHANGED,e),this.addSpacer&&(this.addManagedListener(this.eventService,Events.EVENT_RIGHT_PINNED_WIDTH_CHANGED,e),this.addManagedListener(this.eventService,Events.EVENT_SCROLL_VISIBILITY_CHANGED,e),this.addManagedListener(this.eventService,Events.EVENT_SCROLLBAR_WIDTH_CHANGED,e)),this.setWidth()}setWidth(){const{columnModel:e}=this,t=this.gridOptionsService.isDomLayout("print"),n=e.getBodyContainerWidth(),o=e.getDisplayedColumnsLeftWidth(),a=e.getDisplayedColumnsRightWidth();let l;t?l=n+o+a:(l=n,this.addSpacer&&(this.gridOptionsService.is("enableRtl")?o:a)===0&&this.scrollVisibleService.isVerticalScrollShowing()&&(l+=this.gridOptionsService.getScrollbarWidth())),this.callback(l)}}__decorate$1G([Autowired("columnModel")],CenterWidthFeature.prototype,"columnModel",void 0);__decorate$1G([Autowired("scrollVisibleService")],CenterWidthFeature.prototype,"scrollVisibleService",void 0);__decorate$1G([PostConstruct],CenterWidthFeature.prototype,"postConstruct",null);var __decorate$1F=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},RowContainerName;(function(r){r.LEFT="left",r.RIGHT="right",r.CENTER="center",r.FULL_WIDTH="fullWidth",r.TOP_LEFT="topLeft",r.TOP_RIGHT="topRight",r.TOP_CENTER="topCenter",r.TOP_FULL_WIDTH="topFullWidth",r.STICKY_TOP_LEFT="stickyTopLeft",r.STICKY_TOP_RIGHT="stickyTopRight",r.STICKY_TOP_CENTER="stickyTopCenter",r.STICKY_TOP_FULL_WIDTH="stickyTopFullWidth",r.BOTTOM_LEFT="bottomLeft",r.BOTTOM_RIGHT="bottomRight",r.BOTTOM_CENTER="bottomCenter",r.BOTTOM_FULL_WIDTH="bottomFullWidth"})(RowContainerName||(RowContainerName={}));var RowContainerType;(function(r){r.LEFT="left",r.RIGHT="right",r.CENTER="center",r.FULL_WIDTH="fullWidth"})(RowContainerType||(RowContainerType={}));function getRowContainerTypeForName(r){switch(r){case RowContainerName.CENTER:case RowContainerName.TOP_CENTER:case RowContainerName.STICKY_TOP_CENTER:case RowContainerName.BOTTOM_CENTER:return RowContainerType.CENTER;case RowContainerName.LEFT:case RowContainerName.TOP_LEFT:case RowContainerName.STICKY_TOP_LEFT:case RowContainerName.BOTTOM_LEFT:return RowContainerType.LEFT;case RowContainerName.RIGHT:case RowContainerName.TOP_RIGHT:case RowContainerName.STICKY_TOP_RIGHT:case RowContainerName.BOTTOM_RIGHT:return RowContainerType.RIGHT;case RowContainerName.FULL_WIDTH:case RowContainerName.TOP_FULL_WIDTH:case RowContainerName.STICKY_TOP_FULL_WIDTH:case RowContainerName.BOTTOM_FULL_WIDTH:return RowContainerType.FULL_WIDTH;default:throw Error("Invalid Row Container Type")}}const ContainerCssClasses=convertToMap([[RowContainerName.CENTER,"ag-center-cols-container"],[RowContainerName.LEFT,"ag-pinned-left-cols-container"],[RowContainerName.RIGHT,"ag-pinned-right-cols-container"],[RowContainerName.FULL_WIDTH,"ag-full-width-container"],[RowContainerName.TOP_CENTER,"ag-floating-top-container"],[RowContainerName.TOP_LEFT,"ag-pinned-left-floating-top"],[RowContainerName.TOP_RIGHT,"ag-pinned-right-floating-top"],[RowContainerName.TOP_FULL_WIDTH,"ag-floating-top-full-width-container"],[RowContainerName.STICKY_TOP_CENTER,"ag-sticky-top-container"],[RowContainerName.STICKY_TOP_LEFT,"ag-pinned-left-sticky-top"],[RowContainerName.STICKY_TOP_RIGHT,"ag-pinned-right-sticky-top"],[RowContainerName.STICKY_TOP_FULL_WIDTH,"ag-sticky-top-full-width-container"],[RowContainerName.BOTTOM_CENTER,"ag-floating-bottom-container"],[RowContainerName.BOTTOM_LEFT,"ag-pinned-left-floating-bottom"],[RowContainerName.BOTTOM_RIGHT,"ag-pinned-right-floating-bottom"],[RowContainerName.BOTTOM_FULL_WIDTH,"ag-floating-bottom-full-width-container"]]),ViewportCssClasses=convertToMap([[RowContainerName.CENTER,"ag-center-cols-viewport"],[RowContainerName.TOP_CENTER,"ag-floating-top-viewport"],[RowContainerName.STICKY_TOP_CENTER,"ag-sticky-top-viewport"],[RowContainerName.BOTTOM_CENTER,"ag-floating-bottom-viewport"]]),WrapperCssClasses=convertToMap([[RowContainerName.CENTER,"ag-center-cols-clipper"]]);class RowContainerCtrl extends BeanStub{constructor(e){super(),this.visible=!0,this.EMPTY_CTRLS=[],this.name=e,this.isFullWithContainer=this.name===RowContainerName.TOP_FULL_WIDTH||this.name===RowContainerName.STICKY_TOP_FULL_WIDTH||this.name===RowContainerName.BOTTOM_FULL_WIDTH||this.name===RowContainerName.FULL_WIDTH}static getRowContainerCssClasses(e){const t=ContainerCssClasses.get(e),n=ViewportCssClasses.get(e),o=WrapperCssClasses.get(e);return{container:t,viewport:n,wrapper:o}}static getPinned(e){switch(e){case RowContainerName.BOTTOM_LEFT:case RowContainerName.TOP_LEFT:case RowContainerName.STICKY_TOP_LEFT:case RowContainerName.LEFT:return"left";case RowContainerName.BOTTOM_RIGHT:case RowContainerName.TOP_RIGHT:case RowContainerName.STICKY_TOP_RIGHT:case RowContainerName.RIGHT:return"right";default:return null}}postConstruct(){this.enableRtl=this.gridOptionsService.is("enableRtl"),this.embedFullWidthRows=this.gridOptionsService.is("embedFullWidthRows"),this.forContainers([RowContainerName.CENTER],()=>this.viewportSizeFeature=this.createManagedBean(new ViewportSizeFeature(this)))}registerWithCtrlsService(){switch(this.name){case RowContainerName.CENTER:this.ctrlsService.registerCenterRowContainerCtrl(this);break;case RowContainerName.LEFT:this.ctrlsService.registerLeftRowContainerCtrl(this);break;case RowContainerName.RIGHT:this.ctrlsService.registerRightRowContainerCtrl(this);break;case RowContainerName.TOP_CENTER:this.ctrlsService.registerTopCenterRowContainerCtrl(this);break;case RowContainerName.TOP_LEFT:this.ctrlsService.registerTopLeftRowContainerCon(this);break;case RowContainerName.TOP_RIGHT:this.ctrlsService.registerTopRightRowContainerCtrl(this);break;case RowContainerName.STICKY_TOP_CENTER:this.ctrlsService.registerStickyTopCenterRowContainerCtrl(this);break;case RowContainerName.STICKY_TOP_LEFT:this.ctrlsService.registerStickyTopLeftRowContainerCon(this);break;case RowContainerName.STICKY_TOP_RIGHT:this.ctrlsService.registerStickyTopRightRowContainerCtrl(this);break;case RowContainerName.BOTTOM_CENTER:this.ctrlsService.registerBottomCenterRowContainerCtrl(this);break;case RowContainerName.BOTTOM_LEFT:this.ctrlsService.registerBottomLeftRowContainerCtrl(this);break;case RowContainerName.BOTTOM_RIGHT:this.ctrlsService.registerBottomRightRowContainerCtrl(this);break}}forContainers(e,t){e.indexOf(this.name)>=0&&t()}getContainerElement(){return this.eContainer}getViewportSizeFeature(){return this.viewportSizeFeature}setComp(e,t,n,o){this.comp=e,this.eContainer=t,this.eViewport=n,this.eWrapper=o,this.createManagedBean(new RowContainerEventsFeature(this.eContainer)),this.addPreventScrollWhileDragging(),this.listenOnDomOrder(),this.stopHScrollOnPinnedRows();const a=[RowContainerName.TOP_CENTER,RowContainerName.TOP_LEFT,RowContainerName.TOP_RIGHT],l=[RowContainerName.STICKY_TOP_CENTER,RowContainerName.STICKY_TOP_LEFT,RowContainerName.STICKY_TOP_RIGHT],s=[RowContainerName.BOTTOM_CENTER,RowContainerName.BOTTOM_LEFT,RowContainerName.BOTTOM_RIGHT],m=[RowContainerName.CENTER,RowContainerName.LEFT,RowContainerName.RIGHT],y=[...a,...s,...m,...l],D=[RowContainerName.CENTER,RowContainerName.LEFT,RowContainerName.RIGHT,RowContainerName.FULL_WIDTH],W=[RowContainerName.CENTER,RowContainerName.TOP_CENTER,RowContainerName.STICKY_TOP_CENTER,RowContainerName.BOTTOM_CENTER],Ee=[RowContainerName.LEFT,RowContainerName.BOTTOM_LEFT,RowContainerName.TOP_LEFT,RowContainerName.STICKY_TOP_LEFT],dt=[RowContainerName.RIGHT,RowContainerName.BOTTOM_RIGHT,RowContainerName.TOP_RIGHT,RowContainerName.STICKY_TOP_RIGHT];this.forContainers(Ee,()=>{this.pinnedWidthFeature=this.createManagedBean(new SetPinnedLeftWidthFeature(this.eContainer)),this.addManagedListener(this.eventService,Events.EVENT_LEFT_PINNED_WIDTH_CHANGED,()=>this.onPinnedWidthChanged())}),this.forContainers(dt,()=>{this.pinnedWidthFeature=this.createManagedBean(new SetPinnedRightWidthFeature(this.eContainer)),this.addManagedListener(this.eventService,Events.EVENT_RIGHT_PINNED_WIDTH_CHANGED,()=>this.onPinnedWidthChanged())}),this.forContainers(D,()=>this.createManagedBean(new SetHeightFeature(this.eContainer,this.eWrapper))),this.forContainers(y,()=>this.createManagedBean(new DragListenerFeature(this.eContainer))),this.forContainers(W,()=>this.createManagedBean(new CenterWidthFeature(Ht=>this.comp.setContainerWidth(`${Ht}px`)))),isInvisibleScrollbar()&&(this.forContainers([RowContainerName.CENTER],()=>{const Ht=this.enableRtl?Events.EVENT_LEFT_PINNED_WIDTH_CHANGED:Events.EVENT_RIGHT_PINNED_WIDTH_CHANGED;this.addManagedListener(this.eventService,Ht,()=>this.refreshPaddingForFakeScrollbar())}),this.refreshPaddingForFakeScrollbar()),this.addListeners(),this.registerWithCtrlsService()}refreshPaddingForFakeScrollbar(){const{enableRtl:e,columnModel:t,name:n,eWrapper:o,eContainer:a}=this,l=e?RowContainerName.LEFT:RowContainerName.RIGHT;this.forContainers([RowContainerName.CENTER,l],()=>{const s=t.getContainerWidth(l),m=e?"marginLeft":"marginRight";n===RowContainerName.CENTER?o.style[m]=s?"0px":"16px":a.style[m]=s?"16px":"0px"})}addListeners(){this.addManagedListener(this.eventService,Events.EVENT_SCROLL_VISIBILITY_CHANGED,()=>this.onScrollVisibilityChanged()),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,()=>this.onDisplayedColumnsChanged()),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED,()=>this.onDisplayedColumnsWidthChanged()),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_ROWS_CHANGED,e=>this.onDisplayedRowsChanged(e.afterScroll)),this.onScrollVisibilityChanged(),this.onDisplayedColumnsChanged(),this.onDisplayedColumnsWidthChanged(),this.onDisplayedRowsChanged()}listenOnDomOrder(){if([RowContainerName.STICKY_TOP_CENTER,RowContainerName.STICKY_TOP_LEFT,RowContainerName.STICKY_TOP_RIGHT,RowContainerName.STICKY_TOP_FULL_WIDTH].indexOf(this.name)>=0){this.comp.setDomOrder(!0);return}const n=()=>{const o=this.gridOptionsService.is("ensureDomOrder"),a=this.gridOptionsService.isDomLayout("print");this.comp.setDomOrder(o||a)};this.addManagedPropertyListener("domLayout",n),n()}stopHScrollOnPinnedRows(){this.forContainers([RowContainerName.TOP_CENTER,RowContainerName.STICKY_TOP_CENTER,RowContainerName.BOTTOM_CENTER],()=>{const e=()=>this.eViewport.scrollLeft=0;this.addManagedListener(this.eViewport,"scroll",e)})}onDisplayedColumnsChanged(){this.forContainers([RowContainerName.CENTER],()=>this.onHorizontalViewportChanged())}onDisplayedColumnsWidthChanged(){this.forContainers([RowContainerName.CENTER],()=>this.onHorizontalViewportChanged())}onScrollVisibilityChanged(){const e=this.gridOptionsService.getScrollbarWidth()||0;if(this.name===RowContainerName.CENTER){const n=this.scrollVisibleService.isHorizontalScrollShowing()?e:0,o=n==0?"100%":`calc(100% + ${n}px)`;this.animationFrameService.requestAnimationFrame(()=>this.comp.setViewportHeight(o))}if(this.name===RowContainerName.FULL_WIDTH){const n=`calc(100% - ${isInvisibleScrollbar()?16:0}px)`;this.eContainer.style.setProperty("width",n)}}addPreventScrollWhileDragging(){const e=t=>{this.dragService.isDragging()&&t.cancelable&&t.preventDefault()};this.eContainer.addEventListener("touchmove",e,{passive:!1}),this.addDestroyFunc(()=>this.eContainer.removeEventListener("touchmove",e))}onHorizontalViewportChanged(){const e=this.getCenterWidth(),t=this.getCenterViewportScrollLeft();this.columnModel.setViewportPosition(e,t)}getCenterWidth(){return getInnerWidth(this.eViewport)}getCenterViewportScrollLeft(){return getScrollLeft(this.eViewport,this.enableRtl)}registerViewportResizeListener(e){const t=this.resizeObserverService.observeResize(this.eViewport,e);this.addDestroyFunc(()=>t())}isViewportVisible(){return isVisible(this.eViewport)}getViewportScrollLeft(){return getScrollLeft(this.eViewport,this.enableRtl)}isHorizontalScrollShowing(){return this.gridOptionsService.is("alwaysShowHorizontalScroll")||isHorizontalScrollShowing(this.eViewport)}getViewportElement(){return this.eViewport}setContainerTranslateX(e){this.eContainer.style.transform=`translateX(${e}px)`}getHScrollPosition(){return{left:this.eViewport.scrollLeft,right:this.eViewport.scrollLeft+this.eViewport.offsetWidth}}setCenterViewportScrollLeft(e){setScrollLeft(this.eViewport,e,this.enableRtl)}isContainerVisible(){return!RowContainerCtrl.getPinned(this.name)||!!this.pinnedWidthFeature&&this.pinnedWidthFeature.getWidth()>0}onPinnedWidthChanged(){const e=this.isContainerVisible();this.visible!=e&&(this.visible=e,this.onDisplayedRowsChanged()),isInvisibleScrollbar()&&this.refreshPaddingForFakeScrollbar()}onDisplayedRowsChanged(e=!1){if(this.visible){const t=this.gridOptionsService.isDomLayout("print"),n=a=>{const l=a.isFullWidth(),s=this.embedFullWidthRows||t;return this.isFullWithContainer?!s&&l:s||!l},o=this.getRowCtrls().filter(n);this.comp.setRowCtrls(o,e)}else this.comp.setRowCtrls(this.EMPTY_CTRLS,!1)}getRowCtrls(){switch(this.name){case RowContainerName.TOP_CENTER:case RowContainerName.TOP_LEFT:case RowContainerName.TOP_RIGHT:case RowContainerName.TOP_FULL_WIDTH:return this.rowRenderer.getTopRowCtrls();case RowContainerName.STICKY_TOP_CENTER:case RowContainerName.STICKY_TOP_LEFT:case RowContainerName.STICKY_TOP_RIGHT:case RowContainerName.STICKY_TOP_FULL_WIDTH:return this.rowRenderer.getStickyTopRowCtrls();case RowContainerName.BOTTOM_CENTER:case RowContainerName.BOTTOM_LEFT:case RowContainerName.BOTTOM_RIGHT:case RowContainerName.BOTTOM_FULL_WIDTH:return this.rowRenderer.getBottomRowCtrls();default:return this.rowRenderer.getRowCtrls()}}}__decorate$1F([Autowired("scrollVisibleService")],RowContainerCtrl.prototype,"scrollVisibleService",void 0);__decorate$1F([Autowired("dragService")],RowContainerCtrl.prototype,"dragService",void 0);__decorate$1F([Autowired("ctrlsService")],RowContainerCtrl.prototype,"ctrlsService",void 0);__decorate$1F([Autowired("columnModel")],RowContainerCtrl.prototype,"columnModel",void 0);__decorate$1F([Autowired("resizeObserverService")],RowContainerCtrl.prototype,"resizeObserverService",void 0);__decorate$1F([Autowired("animationFrameService")],RowContainerCtrl.prototype,"animationFrameService",void 0);__decorate$1F([Autowired("rowRenderer")],RowContainerCtrl.prototype,"rowRenderer",void 0);__decorate$1F([PostConstruct],RowContainerCtrl.prototype,"postConstruct",null);var __decorate$1E=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const GRID_BODY_TEMPLATE=`<div class="ag-root ag-unselectable" role="treegrid">
        <ag-header-root ref="gridHeader"></ag-header-root>
        <div class="ag-floating-top" ref="eTop" role="presentation">
            <ag-row-container ref="topLeftContainer" name="${RowContainerName.TOP_LEFT}"></ag-row-container>
            <ag-row-container ref="topCenterContainer" name="${RowContainerName.TOP_CENTER}"></ag-row-container>
            <ag-row-container ref="topRightContainer" name="${RowContainerName.TOP_RIGHT}"></ag-row-container>
            <ag-row-container ref="topFullWidthContainer" name="${RowContainerName.TOP_FULL_WIDTH}"></ag-row-container>
        </div>
        <div class="ag-body" ref="eBody" role="presentation">
            <div class="ag-body-clipper" ref="eBodyClipper" role="presentation">
                <div class="ag-body-viewport" ref="eBodyViewport" role="presentation">
                    <ag-row-container ref="leftContainer" name="${RowContainerName.LEFT}"></ag-row-container>
                    <ag-row-container ref="centerContainer" name="${RowContainerName.CENTER}"></ag-row-container>
                    <ag-row-container ref="rightContainer" name="${RowContainerName.RIGHT}"></ag-row-container>
                    <ag-row-container ref="fullWidthContainer" name="${RowContainerName.FULL_WIDTH}"></ag-row-container>
                </div>
            </div>
            <ag-fake-vertical-scroll></ag-fake-vertical-scroll>
        </div>
        <div class="ag-sticky-top" ref="eStickyTop" role="presentation">
            <ag-row-container ref="stickyTopLeftContainer" name="${RowContainerName.STICKY_TOP_LEFT}"></ag-row-container>
            <ag-row-container ref="stickyTopCenterContainer" name="${RowContainerName.STICKY_TOP_CENTER}"></ag-row-container>
            <ag-row-container ref="stickyTopRightContainer" name="${RowContainerName.STICKY_TOP_RIGHT}"></ag-row-container>
            <ag-row-container ref="stickyTopFullWidthContainer" name="${RowContainerName.STICKY_TOP_FULL_WIDTH}"></ag-row-container>
        </div>
        <div class="ag-floating-bottom" ref="eBottom" role="presentation">
            <ag-row-container ref="bottomLeftContainer" name="${RowContainerName.BOTTOM_LEFT}"></ag-row-container>
            <ag-row-container ref="bottomCenterContainer" name="${RowContainerName.BOTTOM_CENTER}"></ag-row-container>
            <ag-row-container ref="bottomRightContainer" name="${RowContainerName.BOTTOM_RIGHT}"></ag-row-container>
            <ag-row-container ref="bottomFullWidthContainer" name="${RowContainerName.BOTTOM_FULL_WIDTH}"></ag-row-container>
        </div>
        <ag-fake-horizontal-scroll></ag-fake-horizontal-scroll>
        <ag-overlay-wrapper></ag-overlay-wrapper>
    </div>`;class GridBodyComp extends Component{constructor(){super(GRID_BODY_TEMPLATE)}init(){const e=(n,o)=>{const a=`${n}px`;o.style.minHeight=a,o.style.height=a},t={setRowAnimationCssOnBodyViewport:(n,o)=>this.setRowAnimationCssOnBodyViewport(n,o),setColumnCount:n=>setAriaColCount(this.getGui(),n),setRowCount:n=>setAriaRowCount(this.getGui(),n),setTopHeight:n=>e(n,this.eTop),setBottomHeight:n=>e(n,this.eBottom),setTopDisplay:n=>this.eTop.style.display=n,setBottomDisplay:n=>this.eBottom.style.display=n,setStickyTopHeight:n=>this.eStickyTop.style.height=n,setStickyTopTop:n=>this.eStickyTop.style.top=n,setStickyTopWidth:n=>this.eStickyTop.style.width=n,setColumnMovingCss:(n,o)=>this.addOrRemoveCssClass(n,o),updateLayoutClasses:(n,o)=>{[this.eBodyViewport.classList,this.eBodyClipper.classList,this.eBody.classList].forEach(l=>{l.toggle(LayoutCssClasses.AUTO_HEIGHT,o.autoHeight),l.toggle(LayoutCssClasses.NORMAL,o.normal),l.toggle(LayoutCssClasses.PRINT,o.print)}),this.addOrRemoveCssClass(LayoutCssClasses.AUTO_HEIGHT,o.autoHeight),this.addOrRemoveCssClass(LayoutCssClasses.NORMAL,o.normal),this.addOrRemoveCssClass(LayoutCssClasses.PRINT,o.print)},setAlwaysVerticalScrollClass:(n,o)=>this.eBodyViewport.classList.toggle(CSS_CLASS_FORCE_VERTICAL_SCROLL,o),registerBodyViewportResizeListener:n=>{const o=this.resizeObserverService.observeResize(this.eBodyViewport,n);this.addDestroyFunc(()=>o())},setPinnedTopBottomOverflowY:n=>this.eTop.style.overflowY=this.eBottom.style.overflowY=n,setCellSelectableCss:(n,o)=>{[this.eTop,this.eBodyViewport,this.eBottom].forEach(a=>a.classList.toggle(n,o))},setBodyViewportWidth:n=>this.eBodyViewport.style.width=n};this.ctrl=this.createManagedBean(new GridBodyCtrl),this.ctrl.setComp(t,this.getGui(),this.eBodyViewport,this.eTop,this.eBottom,this.eStickyTop),(this.rangeService||this.gridOptionsService.get("rowSelection")==="multiple")&&setAriaMultiSelectable(this.getGui(),!0)}setRowAnimationCssOnBodyViewport(e,t){const n=this.eBodyViewport.classList;n.toggle(RowAnimationCssClasses.ANIMATION_ON,t),n.toggle(RowAnimationCssClasses.ANIMATION_OFF,!t)}getFloatingTopBottom(){return[this.eTop,this.eBottom]}}__decorate$1E([Autowired("resizeObserverService")],GridBodyComp.prototype,"resizeObserverService",void 0);__decorate$1E([Optional("rangeService")],GridBodyComp.prototype,"rangeService",void 0);__decorate$1E([RefSelector("eBodyViewport")],GridBodyComp.prototype,"eBodyViewport",void 0);__decorate$1E([RefSelector("eStickyTop")],GridBodyComp.prototype,"eStickyTop",void 0);__decorate$1E([RefSelector("eTop")],GridBodyComp.prototype,"eTop",void 0);__decorate$1E([RefSelector("eBottom")],GridBodyComp.prototype,"eBottom",void 0);__decorate$1E([RefSelector("gridHeader")],GridBodyComp.prototype,"headerRootComp",void 0);__decorate$1E([RefSelector("eBodyClipper")],GridBodyComp.prototype,"eBodyClipper",void 0);__decorate$1E([RefSelector("eBody")],GridBodyComp.prototype,"eBody",void 0);__decorate$1E([PostConstruct],GridBodyComp.prototype,"init",null);var __decorate$1D=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let ScrollVisibleService=class extends BeanStub{postConstruct(){this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,this.onDisplayedColumnsChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED,this.onDisplayedColumnsWidthChanged.bind(this))}onDisplayedColumnsChanged(){this.update()}onDisplayedColumnsWidthChanged(){this.update()}update(){this.updateImpl(),setTimeout(this.updateImpl.bind(this),500)}updateImpl(){const e=this.ctrlsService.getCenterRowContainerCtrl();if(!e)return;const t={horizontalScrollShowing:e.isHorizontalScrollShowing(),verticalScrollShowing:this.isVerticalScrollShowing()};this.setScrollsVisible(t)}setScrollsVisible(e){if(this.horizontalScrollShowing!==e.horizontalScrollShowing||this.verticalScrollShowing!==e.verticalScrollShowing){this.horizontalScrollShowing=e.horizontalScrollShowing,this.verticalScrollShowing=e.verticalScrollShowing;const n={type:Events.EVENT_SCROLL_VISIBILITY_CHANGED};this.eventService.dispatchEvent(n)}}isHorizontalScrollShowing(){return this.horizontalScrollShowing}isVerticalScrollShowing(){return this.verticalScrollShowing}};__decorate$1D([Autowired("ctrlsService")],ScrollVisibleService.prototype,"ctrlsService",void 0);__decorate$1D([PostConstruct],ScrollVisibleService.prototype,"postConstruct",null);ScrollVisibleService=__decorate$1D([Bean("scrollVisibleService")],ScrollVisibleService);var __decorate$1C=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},MouseEventService_1;let MouseEventService=MouseEventService_1=class extends BeanStub{constructor(){super(...arguments),this.gridInstanceId=MouseEventService_1.gridInstanceSequence.next()}stampTopLevelGridCompWithGridInstance(e){e[MouseEventService_1.GRID_DOM_KEY]=this.gridInstanceId}getRenderedCellForEvent(e){return getCtrlForEventTarget(this.gridOptionsService,e.target,CellCtrl.DOM_DATA_KEY_CELL_CTRL)}isEventFromThisGrid(e){return this.isElementInThisGrid(e.target)}isElementInThisGrid(e){let t=e;for(;t;){const n=t[MouseEventService_1.GRID_DOM_KEY];if(exists(n))return n===this.gridInstanceId;t=t.parentElement}return!1}getCellPositionForEvent(e){const t=this.getRenderedCellForEvent(e);return t?t.getCellPosition():null}getNormalisedPosition(e){const t=this.gridOptionsService.isDomLayout("normal"),n=e;let o,a;if(n.clientX!=null||n.clientY!=null?(o=n.clientX,a=n.clientY):(o=n.x,a=n.y),t){const l=this.ctrlsService.getGridBodyCtrl(),s=l.getScrollFeature().getVScrollPosition(),m=l.getScrollFeature().getHScrollPosition();o+=m.left,a+=s.top}return{x:o,y:a}}};MouseEventService.gridInstanceSequence=new NumberSequence;MouseEventService.GRID_DOM_KEY="__ag_grid_instance";__decorate$1C([Autowired("ctrlsService")],MouseEventService.prototype,"ctrlsService",void 0);MouseEventService=MouseEventService_1=__decorate$1C([Bean("mouseEventService")],MouseEventService);var __decorate$1B=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let NavigationService=class extends BeanStub{constructor(){super(),this.onPageDown=throttle(this.onPageDown,100),this.onPageUp=throttle(this.onPageUp,100)}postConstruct(){this.ctrlsService.whenReady(e=>{this.gridBodyCon=e.gridBodyCtrl})}handlePageScrollingKey(e,t=!1){const n=e.key,o=e.altKey,a=e.ctrlKey||e.metaKey,l=!!this.rangeService&&e.shiftKey,s=this.mouseEventService.getCellPositionForEvent(e);let m=!1;switch(n){case KeyCode.PAGE_HOME:case KeyCode.PAGE_END:!a&&!o&&(this.onHomeOrEndKey(n),m=!0);break;case KeyCode.LEFT:case KeyCode.RIGHT:case KeyCode.UP:case KeyCode.DOWN:if(!s)return!1;a&&!o&&!l&&(this.onCtrlUpDownLeftRight(n,s),m=!0);break;case KeyCode.PAGE_DOWN:case KeyCode.PAGE_UP:!a&&!o&&(m=this.handlePageUpDown(n,s,t));break}return m&&e.preventDefault(),m}handlePageUpDown(e,t,n){return n&&(t=this.focusService.getFocusedCell()),t?(e===KeyCode.PAGE_UP?this.onPageUp(t):this.onPageDown(t),!0):!1}navigateTo(e){const{scrollIndex:t,scrollType:n,scrollColumn:o,focusIndex:a,focusColumn:l}=e;if(exists(o)&&!o.isPinned()&&this.gridBodyCon.getScrollFeature().ensureColumnVisible(o),exists(t)&&this.gridBodyCon.getScrollFeature().ensureIndexVisible(t,n),e.isAsync||this.gridBodyCon.getScrollFeature().ensureIndexVisible(a),this.focusService.setFocusedCell({rowIndex:a,column:l,rowPinned:null,forceBrowserFocus:!0}),this.rangeService){const s={rowIndex:a,rowPinned:null,column:l};this.rangeService.setRangeToCell(s)}}onPageDown(e){const n=this.ctrlsService.getGridBodyCtrl().getScrollFeature().getVScrollPosition(),o=this.getViewportHeight(),a=this.paginationProxy.getPixelOffset(),l=n.top+o,s=this.paginationProxy.getRowIndexAtPixel(l+a);this.columnModel.isAutoRowHeightActive()?this.navigateToNextPageWithAutoHeight(e,s):this.navigateToNextPage(e,s)}onPageUp(e){const n=this.ctrlsService.getGridBodyCtrl().getScrollFeature().getVScrollPosition(),o=this.paginationProxy.getPixelOffset(),a=n.top,l=this.paginationProxy.getRowIndexAtPixel(a+o);this.columnModel.isAutoRowHeightActive()?this.navigateToNextPageWithAutoHeight(e,l,!0):this.navigateToNextPage(e,l,!0)}navigateToNextPage(e,t,n=!1){const o=this.getViewportHeight(),a=this.paginationProxy.getPageFirstRow(),l=this.paginationProxy.getPageLastRow(),s=this.paginationProxy.getPixelOffset(),m=this.paginationProxy.getRow(e.rowIndex),y=n?(m==null?void 0:m.rowHeight)-o-s:o-s,D=(m==null?void 0:m.rowTop)+y;let W=this.paginationProxy.getRowIndexAtPixel(D+s);if(W===e.rowIndex){const dt=n?-1:1;t=W=e.rowIndex+dt}let Ee;n?(Ee="bottom",W<a&&(W=a),t<a&&(t=a)):(Ee="top",W>l&&(W=l),t>l&&(t=l)),this.isRowTallerThanView(W)&&(t=W,Ee="top"),this.navigateTo({scrollIndex:t,scrollType:Ee,scrollColumn:null,focusIndex:W,focusColumn:e.column})}navigateToNextPageWithAutoHeight(e,t,n=!1){this.navigateTo({scrollIndex:t,scrollType:n?"bottom":"top",scrollColumn:null,focusIndex:t,focusColumn:e.column}),setTimeout(()=>{const o=this.getNextFocusIndexForAutoHeight(e,n);this.navigateTo({scrollIndex:t,scrollType:n?"bottom":"top",scrollColumn:null,focusIndex:o,focusColumn:e.column,isAsync:!0})},50)}getNextFocusIndexForAutoHeight(e,t=!1){var n;const o=t?-1:1,a=this.getViewportHeight(),l=this.paginationProxy.getPageLastRow();let s=0,m=e.rowIndex;for(;m>=0&&m<=l;){const y=this.paginationProxy.getRow(m);if(y){const D=(n=y.rowHeight)!==null&&n!==void 0?n:0;if(s+D>a)break;s+=D}m+=o}return Math.max(0,Math.min(m,l))}getViewportHeight(){const t=this.ctrlsService.getGridBodyCtrl().getScrollFeature().getVScrollPosition(),n=this.gridOptionsService.getScrollbarWidth();let o=t.bottom-t.top;return this.ctrlsService.getCenterRowContainerCtrl().isHorizontalScrollShowing()&&(o-=n),o}isRowTallerThanView(e){const t=this.paginationProxy.getRow(e);if(!t)return!1;const n=t.rowHeight;return typeof n!="number"?!1:n>this.getViewportHeight()}onCtrlUpDownLeftRight(e,t){const n=this.cellNavigationService.getNextCellToFocus(e,t,!0),{rowIndex:o,column:a}=n;this.navigateTo({scrollIndex:o,scrollType:null,scrollColumn:a,focusIndex:o,focusColumn:a})}onHomeOrEndKey(e){const t=e===KeyCode.PAGE_HOME,n=this.columnModel.getAllDisplayedColumns(),o=t?n[0]:last(n),a=t?this.paginationProxy.getPageFirstRow():this.paginationProxy.getPageLastRow();this.navigateTo({scrollIndex:a,scrollType:null,scrollColumn:o,focusIndex:a,focusColumn:o})}onTabKeyDown(e,t){const n=t.shiftKey;if(this.tabToNextCellCommon(e,n,t)){t.preventDefault();return}if(n){const{rowIndex:a,rowPinned:l}=e.getRowPosition();(l?a===0:a===this.paginationProxy.getPageFirstRow())&&(this.gridOptionsService.getNum("headerHeight")===0?this.focusService.focusNextGridCoreContainer(!0,!0):(t.preventDefault(),this.focusService.focusLastHeader(t)))}else e instanceof CellCtrl&&e.focusCell(!0),this.focusService.focusNextGridCoreContainer(n)&&t.preventDefault()}tabToNextCell(e,t){const n=this.focusService.getFocusedCell();if(!n)return!1;let o=this.getCellByPosition(n);return!o&&(o=this.rowRenderer.getRowByPosition(n),!o||!o.isFullWidth())?!1:this.tabToNextCellCommon(o,e,t)}tabToNextCellCommon(e,t,n){let o=e.isEditing();if(!o&&e instanceof CellCtrl){const s=e.getRowCtrl();s&&(o=s.isEditing())}let a;return o?this.gridOptionsService.get("editType")==="fullRow"?a=this.moveToNextEditingRow(e,t,n):a=this.moveToNextEditingCell(e,t,n):a=this.moveToNextCellNotEditing(e,t),a||!!this.focusService.getFocusedHeader()}moveToNextEditingCell(e,t,n=null){const o=e.getCellPosition();e.getGui().focus(),e.stopEditing();const a=this.findNextCellToFocusOn(o,t,!0);return a==null?!1:(a.startEditing(null,!0,n),a.focusCell(!1),!0)}moveToNextEditingRow(e,t,n=null){const o=e.getCellPosition(),a=this.findNextCellToFocusOn(o,t,!0);if(a==null)return!1;const l=a.getCellPosition(),s=this.isCellEditable(o),m=this.isCellEditable(l),y=l&&o.rowIndex===l.rowIndex&&o.rowPinned===l.rowPinned;return s&&e.setFocusOutOnEditor(),y||(e.getRowCtrl().stopEditing(),a.getRowCtrl().startRowEditing(void 0,void 0,n)),m?(a.setFocusInOnEditor(),a.focusCell()):a.focusCell(!0),!0}moveToNextCellNotEditing(e,t){const n=this.columnModel.getAllDisplayedColumns();let o;e instanceof RowCtrl?o=Object.assign(Object.assign({},e.getRowPosition()),{column:t?n[0]:last(n)}):o=e.getCellPosition();const a=this.findNextCellToFocusOn(o,t,!1);if(a instanceof CellCtrl)a.focusCell(!0);else if(a)return this.tryToFocusFullWidthRow(a.getRowPosition(),t);return exists(a)}findNextCellToFocusOn(e,t,n){let o=e;for(;;){e!==o&&(e=o),t||(o=this.getLastCellOfColSpan(o)),o=this.cellNavigationService.getNextTabbedCell(o,t);const a=this.gridOptionsService.getCallback("tabToNextCell");if(exists(a)){const y=a({backwards:t,editing:n,previousCellPosition:e,nextCellPosition:o||null});exists(y)?(y.floating&&(doOnce(()=>{console.warn("AG Grid: tabToNextCellFunc return type should have attributes: rowIndex, rowPinned, column. However you had 'floating', maybe you meant 'rowPinned'?")},"no floating in userCell"),y.rowPinned=y.floating),o={rowIndex:y.rowIndex,column:y.column,rowPinned:y.rowPinned}):o=null}if(!o)return null;if(o.rowIndex<0){const m=this.headerNavigationService.getHeaderRowCount();return this.focusService.focusHeaderPosition({headerPosition:{headerRowIndex:m+o.rowIndex,column:o.column}}),null}const l=this.gridOptionsService.get("editType")==="fullRow";if(n&&!l&&!this.isCellEditable(o))continue;this.ensureCellVisible(o);const s=this.getCellByPosition(o);if(!s){const m=this.rowRenderer.getRowByPosition(o);if(!m||!m.isFullWidth()||n)continue;return m}if(!s.isSuppressNavigable())return this.rangeService&&this.rangeService.setRangeToCell(o),s}}isCellEditable(e){const t=this.lookupRowNodeForCell(e);return t?e.column.isCellEditable(t):!1}getCellByPosition(e){const t=this.rowRenderer.getRowByPosition(e);return t?t.getCellCtrl(e.column):null}lookupRowNodeForCell(e){return e.rowPinned==="top"?this.pinnedRowModel.getPinnedTopRow(e.rowIndex):e.rowPinned==="bottom"?this.pinnedRowModel.getPinnedBottomRow(e.rowIndex):this.paginationProxy.getRow(e.rowIndex)}navigateToNextCell(e,t,n,o){let a=n,l=!1;for(;a&&(a===n||!this.isValidNavigateCell(a));)this.gridOptionsService.is("enableRtl")?t===KeyCode.LEFT&&(a=this.getLastCellOfColSpan(a)):t===KeyCode.RIGHT&&(a=this.getLastCellOfColSpan(a)),a=this.cellNavigationService.getNextCellToFocus(t,a),l=missing(a);if(l&&e&&e.key===KeyCode.UP&&(a={rowIndex:-1,rowPinned:null,column:n.column}),o){const m=this.gridOptionsService.getCallback("navigateToNextCell");if(exists(m)){const D=m({key:t,previousCellPosition:n,nextCellPosition:a||null,event:e});exists(D)?(D.floating&&(doOnce(()=>{console.warn("AG Grid: tabToNextCellFunc return type should have attributes: rowIndex, rowPinned, column. However you had 'floating', maybe you meant 'rowPinned'?")},"no floating in userCell"),D.rowPinned=D.floating),a={rowPinned:D.rowPinned,rowIndex:D.rowIndex,column:D.column}):a=null}}if(!a)return;if(a.rowIndex<0){const m=this.headerNavigationService.getHeaderRowCount();this.focusService.focusHeaderPosition({headerPosition:{headerRowIndex:m+a.rowIndex,column:n.column},event:e||void 0});return}const s=this.getNormalisedPosition(a);s?this.focusPosition(s):this.tryToFocusFullWidthRow(a)}getNormalisedPosition(e){this.ensureCellVisible(e);const t=this.getCellByPosition(e);return t?(e=t.getCellPosition(),this.ensureCellVisible(e),e):null}tryToFocusFullWidthRow(e,t=!1){const n=this.columnModel.getAllDisplayedColumns(),o=this.rowRenderer.getRowByPosition(e);if(!o||!o.isFullWidth())return!1;const a=this.focusService.getFocusedCell(),l={rowIndex:e.rowIndex,rowPinned:e.rowPinned,column:e.column||(t?last(n):n[0])};this.focusPosition(l);const s=a!=null?this.rowPositionUtils.before(l,a):!1,m={type:Events.EVENT_FULL_WIDTH_ROW_FOCUSED,rowIndex:l.rowIndex,rowPinned:l.rowPinned,column:l.column,isFullWidthCell:!0,floating:l.rowPinned,fromBelow:s};return this.eventService.dispatchEvent(m),!0}focusPosition(e){this.focusService.setFocusedCell({rowIndex:e.rowIndex,column:e.column,rowPinned:e.rowPinned,forceBrowserFocus:!0}),this.rangeService&&this.rangeService.setRangeToCell(e)}isValidNavigateCell(e){return!!this.rowPositionUtils.getRowNode(e)}getLastCellOfColSpan(e){const t=this.getCellByPosition(e);if(!t)return e;const n=t.getColSpanningList();return n.length===1?e:{rowIndex:e.rowIndex,column:last(n),rowPinned:e.rowPinned}}ensureCellVisible(e){const t=this.gridOptionsService.isGroupRowsSticky(),n=this.rowModel.getRow(e.rowIndex);!(t&&(n==null?void 0:n.sticky))&&missing(e.rowPinned)&&this.gridBodyCon.getScrollFeature().ensureIndexVisible(e.rowIndex),e.column.isPinned()||this.gridBodyCon.getScrollFeature().ensureColumnVisible(e.column)}};__decorate$1B([Autowired("mouseEventService")],NavigationService.prototype,"mouseEventService",void 0);__decorate$1B([Autowired("paginationProxy")],NavigationService.prototype,"paginationProxy",void 0);__decorate$1B([Autowired("focusService")],NavigationService.prototype,"focusService",void 0);__decorate$1B([Optional("rangeService")],NavigationService.prototype,"rangeService",void 0);__decorate$1B([Autowired("columnModel")],NavigationService.prototype,"columnModel",void 0);__decorate$1B([Autowired("rowModel")],NavigationService.prototype,"rowModel",void 0);__decorate$1B([Autowired("ctrlsService")],NavigationService.prototype,"ctrlsService",void 0);__decorate$1B([Autowired("rowRenderer")],NavigationService.prototype,"rowRenderer",void 0);__decorate$1B([Autowired("headerNavigationService")],NavigationService.prototype,"headerNavigationService",void 0);__decorate$1B([Autowired("rowPositionUtils")],NavigationService.prototype,"rowPositionUtils",void 0);__decorate$1B([Autowired("cellNavigationService")],NavigationService.prototype,"cellNavigationService",void 0);__decorate$1B([Autowired("pinnedRowModel")],NavigationService.prototype,"pinnedRowModel",void 0);__decorate$1B([PostConstruct],NavigationService.prototype,"postConstruct",null);NavigationService=__decorate$1B([Bean("navigationService")],NavigationService);var __decorate$1A=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class PopupEditorWrapper extends PopupComponent{constructor(e){super('<div class="ag-popup-editor" tabindex="-1"/>'),this.params=e}postConstruct(){this.gridOptionsService.setDomData(this.getGui(),PopupEditorWrapper.DOM_KEY_POPUP_EDITOR_WRAPPER,!0),this.addKeyDownListener()}addKeyDownListener(){const e=this.getGui(),t=this.params,n=o=>{isUserSuppressingKeyboardEvent(this.gridOptionsService,o,t.node,t.column,!0)||t.onKeyDown(o)};this.addManagedListener(e,"keydown",n)}}PopupEditorWrapper.DOM_KEY_POPUP_EDITOR_WRAPPER="popupEditorWrapper";__decorate$1A([PostConstruct],PopupEditorWrapper.prototype,"postConstruct",null);class CellComp extends Component{constructor(e,t,n,o,a){super(),this.rendererVersion=0,this.editorVersion=0,this.beans=e,this.column=t.getColumn(),this.rowNode=t.getRowNode(),this.rowCtrl=t.getRowCtrl(),this.eRow=o,this.setTemplate(`<div comp-id="${this.getCompId()}"/>`);const l=this.getGui();this.forceWrapper=t.isForceWrapper(),this.refreshWrapper(!1);const s=(y,D,W)=>{const Ee=W||l;D!=null&&D!=""?Ee.setAttribute(y,D):Ee.removeAttribute(y)},m={addOrRemoveCssClass:(y,D)=>this.addOrRemoveCssClass(y,D),setUserStyles:y=>addStylesToElement(l,y),getFocusableElement:()=>this.getFocusableElement(),setTabIndex:y=>s("tabindex",y.toString()),setRole:y=>setAriaRole(l,y),setColId:y=>s("col-id",y),setTitle:y=>s("title",y),setIncludeSelection:y=>this.includeSelection=y,setIncludeRowDrag:y=>this.includeRowDrag=y,setIncludeDndSource:y=>this.includeDndSource=y,setRenderDetails:(y,D,W)=>this.setRenderDetails(y,D,W),setEditDetails:(y,D,W)=>this.setEditDetails(y,D,W),getCellEditor:()=>this.cellEditor||null,getCellRenderer:()=>this.cellRenderer||null,getParentOfValue:()=>this.getParentOfValue()};this.cellCtrl=t,t.setComp(m,this.getGui(),this.eCellWrapper,n,a)}getParentOfValue(){return this.eCellValue?this.eCellValue:this.eCellWrapper?this.eCellWrapper:this.getGui()}setRenderDetails(e,t,n){if(this.cellEditor&&!this.cellEditorPopupWrapper)return;this.firstRender=this.firstRender==null;const a=this.refreshWrapper(!1);this.refreshEditStyles(!1),e?!(n||a)&&this.refreshCellRenderer(e)||(this.destroyRenderer(),this.createCellRendererInstance(e)):(this.destroyRenderer(),this.insertValueWithoutCellRenderer(t))}setEditDetails(e,t,n){e?this.createCellEditorInstance(e,t,n):this.destroyEditor()}removeControls(){this.checkboxSelectionComp=this.beans.context.destroyBean(this.checkboxSelectionComp),this.dndSourceComp=this.beans.context.destroyBean(this.dndSourceComp),this.rowDraggingComp=this.beans.context.destroyBean(this.rowDraggingComp)}refreshWrapper(e){const t=this.includeRowDrag||this.includeDndSource||this.includeSelection,n=t||this.forceWrapper,o=n&&this.eCellWrapper==null;o&&(this.eCellWrapper=loadTemplate('<div class="ag-cell-wrapper" role="presentation"></div>'),this.getGui().appendChild(this.eCellWrapper));const a=!n&&this.eCellWrapper!=null;a&&(removeFromParent(this.eCellWrapper),this.eCellWrapper=void 0),this.addOrRemoveCssClass("ag-cell-value",!n);const l=!e&&n,s=l&&this.eCellValue==null;s&&(this.eCellValue=loadTemplate('<span class="ag-cell-value" role="presentation"></span>'),this.eCellWrapper.appendChild(this.eCellValue));const m=!l&&this.eCellValue!=null;m&&(removeFromParent(this.eCellValue),this.eCellValue=void 0);const y=o||a||s||m;return y&&this.removeControls(),e||t&&this.addControls(),y}addControls(){this.includeRowDrag&&this.rowDraggingComp==null&&(this.rowDraggingComp=this.cellCtrl.createRowDragComp(),this.rowDraggingComp&&this.eCellWrapper.insertBefore(this.rowDraggingComp.getGui(),this.eCellValue)),this.includeDndSource&&this.dndSourceComp==null&&(this.dndSourceComp=this.cellCtrl.createDndSource(),this.eCellWrapper.insertBefore(this.dndSourceComp.getGui(),this.eCellValue)),this.includeSelection&&this.checkboxSelectionComp==null&&(this.checkboxSelectionComp=this.cellCtrl.createSelectionCheckbox(),this.eCellWrapper.insertBefore(this.checkboxSelectionComp.getGui(),this.eCellValue))}createCellEditorInstance(e,t,n){const o=this.editorVersion,a=e.newAgStackInstance();if(!a)return;const{params:l}=e;a.then(m=>this.afterCellEditorCreated(o,m,l,t,n)),missing(this.cellEditor)&&l.cellStartedEdit&&this.cellCtrl.focusCell(!0)}insertValueWithoutCellRenderer(e){const t=this.getParentOfValue();clearElement(t);const n=e!=null?escapeString(e):null;n!=null&&(t.innerHTML=n)}destroyEditorAndRenderer(){this.destroyRenderer(),this.destroyEditor()}destroyRenderer(){const{context:e}=this.beans;this.cellRenderer=e.destroyBean(this.cellRenderer),removeFromParent(this.cellRendererGui),this.cellRendererGui=null,this.rendererVersion++}destroyEditor(){const{context:e}=this.beans;this.hideEditorPopup&&this.hideEditorPopup(),this.hideEditorPopup=void 0,this.cellEditor=e.destroyBean(this.cellEditor),this.cellEditorPopupWrapper=e.destroyBean(this.cellEditorPopupWrapper),removeFromParent(this.cellEditorGui),this.cellEditorGui=null,this.editorVersion++}refreshCellRenderer(e){if(this.cellRenderer==null||this.cellRenderer.refresh==null||this.cellRendererClass!==e.componentClass)return!1;const t=this.cellRenderer.refresh(e.params);return t===!0||t===void 0}createCellRendererInstance(e){const n=!this.beans.gridOptionsService.is("suppressAnimationFrame"),o=this.rendererVersion,{componentClass:a}=e,l=()=>{if(this.rendererVersion!==o||!this.isAlive())return;const m=e.newAgStackInstance(),y=this.afterCellRendererCreated.bind(this,o,a);m&&m.then(y)};n&&this.firstRender?this.beans.animationFrameService.createTask(l,this.rowNode.rowIndex,"createTasksP2"):l()}getCtrl(){return this.cellCtrl}getRowCtrl(){return this.rowCtrl}getCellRenderer(){return this.cellRenderer}getCellEditor(){return this.cellEditor}afterCellRendererCreated(e,t,n){if(!this.isAlive()||e!==this.rendererVersion){this.beans.context.destroyBean(n);return}if(this.cellRenderer=n,this.cellRendererClass=t,this.cellRendererGui=this.cellRenderer.getGui(),this.cellRendererGui!=null){const a=this.getParentOfValue();clearElement(a),a.appendChild(this.cellRendererGui)}}afterCellEditorCreated(e,t,n,o,a){if(e!==this.editorVersion){this.beans.context.destroyBean(t);return}if(t.isCancelBeforeStart&&t.isCancelBeforeStart()){this.beans.context.destroyBean(t),this.cellCtrl.stopEditing(!0);return}if(!t.getGui){console.warn(`AG Grid: cellEditor for column ${this.column.getId()} is missing getGui() method`),this.beans.context.destroyBean(t);return}this.cellEditor=t,this.cellEditorGui=t.getGui();const m=o||t.isPopup!==void 0&&t.isPopup();m?this.addPopupCellEditor(n,a):this.addInCellEditor(),this.refreshEditStyles(!0,m),t.afterGuiAttached&&t.afterGuiAttached()}refreshEditStyles(e,t){var n;this.addOrRemoveCssClass("ag-cell-inline-editing",e&&!t),this.addOrRemoveCssClass("ag-cell-popup-editing",e&&!!t),this.addOrRemoveCssClass("ag-cell-not-inline-editing",!e||!!t),(n=this.rowCtrl)===null||n===void 0||n.setInlineEditingCss(e)}addInCellEditor(){const e=this.getGui(),t=this.beans.gridOptionsService.getDocument();e.contains(t.activeElement)&&e.focus(),this.destroyRenderer(),this.refreshWrapper(!0),this.clearParentOfValue(),this.cellEditorGui&&this.getParentOfValue().appendChild(this.cellEditorGui)}addPopupCellEditor(e,t){this.beans.gridOptionsService.get("editType")==="fullRow"&&console.warn("AG Grid: popup cellEditor does not work with fullRowEdit - you cannot use them both - either turn off fullRowEdit, or stop using popup editors.");const n=this.cellEditor;this.cellEditorPopupWrapper=this.beans.context.createBean(new PopupEditorWrapper(e));const o=this.cellEditorPopupWrapper.getGui();this.cellEditorGui&&o.appendChild(this.cellEditorGui);const a=this.beans.popupService,l=this.beans.gridOptionsService.is("stopEditingWhenCellsLoseFocus"),s=t??(n.getPopupPosition?n.getPopupPosition():"over"),m=this.beans.gridOptionsService.is("enableRtl"),y={ePopup:o,column:this.column,rowNode:this.rowNode,type:"popupCellEditor",eventSource:this.getGui(),position:s,alignSide:m?"right":"left",keepWithinBounds:!0},D=a.positionPopupByComponent.bind(a,y),W=this.beans.localeService.getLocaleTextFunc(),Ee=a.addPopup({modal:l,eChild:o,closeOnEsc:!0,closedCallback:()=>{this.cellCtrl.onPopupEditorClosed()},anchorToElement:this.getGui(),positionCallback:D,ariaLabel:W("ariaLabelCellEditor","Cell Editor")});Ee&&(this.hideEditorPopup=Ee.hideFunc)}detach(){this.eRow.removeChild(this.getGui())}destroy(){this.cellCtrl.stopEditing(),this.destroyEditorAndRenderer(),this.removeControls(),super.destroy()}clearParentOfValue(){const e=this.getGui(),t=this.beans.gridOptionsService.getDocument();e.contains(t.activeElement)&&browserSupportsPreventScroll()&&e.focus({preventScroll:!0}),clearElement(this.getParentOfValue())}}class RowComp extends Component{constructor(e,t,n){super(),this.cellComps={},this.beans=t,this.rowCtrl=e,this.setTemplate(`<div comp-id="${this.getCompId()}" style="${this.getInitialStyle(n)}"/>`);const o=this.getGui(),a=o.style,l={setDomOrder:s=>this.domOrder=s,setCellCtrls:s=>this.setCellCtrls(s),showFullWidth:s=>this.showFullWidth(s),getFullWidthCellRenderer:()=>this.getFullWidthCellRenderer(),addOrRemoveCssClass:(s,m)=>this.addOrRemoveCssClass(s,m),setUserStyles:s=>addStylesToElement(o,s),setTop:s=>a.top=s,setTransform:s=>a.transform=s,setRowIndex:s=>o.setAttribute("row-index",s),setRole:s=>setAriaRole(o,s),setRowId:s=>o.setAttribute("row-id",s),setRowBusinessKey:s=>o.setAttribute("row-business-key",s),setTabIndex:s=>o.setAttribute("tabindex",s.toString())};e.setComp(l,this.getGui(),n),this.addDestroyFunc(()=>{e.unsetComp(n)})}getInitialStyle(e){const t=this.rowCtrl.getInitialTransform(e),n=this.rowCtrl.getInitialRowTop(e);return t?`transform: ${t}`:`top: ${n}`}showFullWidth(e){const t=o=>{if(this.isAlive()){const a=o.getGui();this.getGui().appendChild(a),this.rowCtrl.setupDetailRowAutoHeight(a),this.setFullWidthRowComp(o)}else this.beans.context.destroyBean(o)},n=e.newAgStackInstance();n&&n.then(t)}setCellCtrls(e){const t=Object.assign({},this.cellComps);e.forEach(o=>{const a=o.getInstanceId();this.cellComps[a]==null?this.newCellComp(o):t[a]=null});const n=getAllValuesInObject(t).filter(o=>o!=null);this.destroyCells(n),this.ensureDomOrder(e)}ensureDomOrder(e){if(!this.domOrder)return;const t=[];e.forEach(n=>{const o=this.cellComps[n.getInstanceId()];o&&t.push(o.getGui())}),setDomChildOrder(this.getGui(),t)}newCellComp(e){const t=new CellComp(this.beans,e,this.rowCtrl.isPrintLayout(),this.getGui(),this.rowCtrl.isEditing());this.cellComps[e.getInstanceId()]=t,this.getGui().appendChild(t.getGui())}destroy(){super.destroy(),this.destroyAllCells()}destroyAllCells(){const e=getAllValuesInObject(this.cellComps).filter(t=>t!=null);this.destroyCells(e)}setFullWidthRowComp(e){this.fullWidthCellRenderer&&console.error("AG Grid - should not be setting fullWidthRowComponent twice"),this.fullWidthCellRenderer=e,this.addDestroyFunc(()=>{this.fullWidthCellRenderer=this.beans.context.destroyBean(this.fullWidthCellRenderer)})}getFullWidthCellRenderer(){return this.fullWidthCellRenderer}destroyCells(e){e.forEach(t=>{if(!t)return;const n=t.getCtrl().getInstanceId();this.cellComps[n]===t&&(t.detach(),t.destroy(),this.cellComps[n]=null)})}}var __decorate$1z=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};function templateFactory(){const r=Component.elementGettingCreated.getAttribute("name"),e=RowContainerCtrl.getRowContainerCssClasses(r);let t;const n=r===RowContainerName.CENTER,o=r===RowContainerName.TOP_CENTER||r===RowContainerName.STICKY_TOP_CENTER||r===RowContainerName.BOTTOM_CENTER;return n?t=`<div class="${e.wrapper}" ref="eWrapper" role="presentation">
                <div class="${e.viewport}" ref="eViewport" role="presentation">
                    <div class="${e.container}" ref="eContainer"></div>
                </div>
            </div>`:o?t=`<div class="${e.viewport}" ref="eViewport" role="presentation">
                <div class="${e.container}" ref="eContainer"></div>
            </div>`:t=`<div class="${e.container}" ref="eContainer"></div>`,t}class RowContainerComp extends Component{constructor(){super(templateFactory()),this.rowComps={},this.name=Component.elementGettingCreated.getAttribute("name"),this.type=getRowContainerTypeForName(this.name)}postConstruct(){const e={setViewportHeight:n=>this.eViewport.style.height=n,setRowCtrls:n=>this.setRowCtrls(n),setDomOrder:n=>{this.domOrder=n},setContainerWidth:n=>this.eContainer.style.width=n};this.createManagedBean(new RowContainerCtrl(this.name)).setComp(e,this.eContainer,this.eViewport,this.eWrapper)}preDestroy(){this.setRowCtrls([])}setRowCtrls(e){const t=Object.assign({},this.rowComps);this.rowComps={},this.lastPlacedElement=null;const n=o=>{const a=o.getInstanceId(),l=t[a];if(l)this.rowComps[a]=l,delete t[a],this.ensureDomOrder(l.getGui());else{if(!o.getRowNode().displayed)return;const s=new RowComp(o,this.beans,this.type);this.rowComps[a]=s,this.appendRow(s.getGui())}};e.forEach(n),getAllValuesInObject(t).forEach(o=>{this.eContainer.removeChild(o.getGui()),o.destroy()}),setAriaRole(this.eContainer,e.length?"rowgroup":"presentation")}appendRow(e){this.domOrder?insertWithDomOrder(this.eContainer,e,this.lastPlacedElement):this.eContainer.appendChild(e),this.lastPlacedElement=e}ensureDomOrder(e){this.domOrder&&(ensureDomOrder(this.eContainer,e,this.lastPlacedElement),this.lastPlacedElement=e)}}__decorate$1z([Autowired("beans")],RowContainerComp.prototype,"beans",void 0);__decorate$1z([RefSelector("eViewport")],RowContainerComp.prototype,"eViewport",void 0);__decorate$1z([RefSelector("eContainer")],RowContainerComp.prototype,"eContainer",void 0);__decorate$1z([RefSelector("eWrapper")],RowContainerComp.prototype,"eWrapper",void 0);__decorate$1z([PostConstruct],RowContainerComp.prototype,"postConstruct",null);__decorate$1z([PreDestroy],RowContainerComp.prototype,"preDestroy",null);var __decorate$1y=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class BodyDropPivotTarget{constructor(e){this.columnsToAggregate=[],this.columnsToGroup=[],this.columnsToPivot=[],this.pinned=e}onDragEnter(e){if(this.clearColumnsList(),this.gridOptionsService.is("functionsReadOnly"))return;const t=e.dragItem.columns;t&&t.forEach(n=>{n.isPrimary()&&(n.isAnyFunctionActive()||(n.isAllowValue()?this.columnsToAggregate.push(n):n.isAllowRowGroup()?this.columnsToGroup.push(n):n.isAllowPivot()&&this.columnsToPivot.push(n)))})}getIconName(){return this.columnsToAggregate.length+this.columnsToGroup.length+this.columnsToPivot.length>0?this.pinned?DragAndDropService.ICON_PINNED:DragAndDropService.ICON_MOVE:null}onDragLeave(e){this.clearColumnsList()}clearColumnsList(){this.columnsToAggregate.length=0,this.columnsToGroup.length=0,this.columnsToPivot.length=0}onDragging(e){}onDragStop(e){this.columnsToAggregate.length>0&&this.columnModel.addValueColumns(this.columnsToAggregate,"toolPanelDragAndDrop"),this.columnsToGroup.length>0&&this.columnModel.addRowGroupColumns(this.columnsToGroup,"toolPanelDragAndDrop"),this.columnsToPivot.length>0&&this.columnModel.addPivotColumns(this.columnsToPivot,"toolPanelDragAndDrop")}}__decorate$1y([Autowired("columnModel")],BodyDropPivotTarget.prototype,"columnModel",void 0);__decorate$1y([Autowired("gridOptionsService")],BodyDropPivotTarget.prototype,"gridOptionsService",void 0);var __decorate$1x=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class MoveColumnFeature{constructor(e,t){this.needToMoveLeft=!1,this.needToMoveRight=!1,this.lastMovedInfo=null,this.pinned=e,this.eContainer=t,this.centerContainer=!exists(e)}init(){this.ctrlsService.whenReady(()=>{this.gridBodyCon=this.ctrlsService.getGridBodyCtrl()})}getIconName(){return this.pinned?DragAndDropService.ICON_PINNED:DragAndDropService.ICON_MOVE}onDragEnter(e){const t=e.dragItem.columns;if(e.dragSource.type===DragSourceType.ToolPanel)this.setColumnsVisible(t,!0,"uiColumnDragged");else{const o=e.dragItem.visibleState,a=(t||[]).filter(l=>o[l.getId()]);this.setColumnsVisible(a,!0,"uiColumnDragged")}this.setColumnsPinned(t,this.pinned,"uiColumnDragged"),this.onDragging(e,!0,!0)}onDragLeave(){this.ensureIntervalCleared(),this.lastMovedInfo=null}setColumnsVisible(e,t,n="api"){if(e){const o=e.filter(a=>!a.getColDef().lockVisible);this.columnModel.setColumnsVisible(o,t,n)}}setColumnsPinned(e,t,n="api"){if(e){const o=e.filter(a=>!a.getColDef().lockPinned);this.columnModel.setColumnsPinned(o,t,n)}}onDragStop(){this.onDragging(this.lastDraggingEvent,!1,!0,!0),this.ensureIntervalCleared(),this.lastMovedInfo=null}normaliseX(e){return this.gridOptionsService.is("enableRtl")&&(e=this.eContainer.clientWidth-e),this.centerContainer&&(e+=this.ctrlsService.getCenterRowContainerCtrl().getCenterViewportScrollLeft()),e}checkCenterForScrolling(e){if(this.centerContainer){const t=this.ctrlsService.getCenterRowContainerCtrl().getCenterViewportScrollLeft(),n=t+this.ctrlsService.getCenterRowContainerCtrl().getCenterWidth();this.gridOptionsService.is("enableRtl")?(this.needToMoveRight=e<t+50,this.needToMoveLeft=e>n-50):(this.needToMoveLeft=e<t+50,this.needToMoveRight=e>n-50),this.needToMoveLeft||this.needToMoveRight?this.ensureIntervalStarted():this.ensureIntervalCleared()}}onDragging(e=this.lastDraggingEvent,t=!1,n=!1,o=!1){var a;if(o){if(this.lastMovedInfo){const{columns:D,toIndex:W}=this.lastMovedInfo;this.moveColumns(D,W,"uiColumnMoved",!0)}return}if(this.lastDraggingEvent=e,missing(e.hDirection))return;const l=this.normaliseX(e.x);t||this.checkCenterForScrolling(l);const s=this.normaliseDirection(e.hDirection),m=e.dragSource.type,y=((a=e.dragSource.getDragItem().columns)===null||a===void 0?void 0:a.filter(D=>D.getColDef().lockPinned?D.getPinned()==this.pinned:!0))||[];this.attemptMoveColumns({dragSourceType:m,allMovingColumns:y,hDirection:s,mouseX:l,fromEnter:t,fakeEvent:n})}normaliseDirection(e){if(this.gridOptionsService.is("enableRtl"))switch(e){case HorizontalDirection.Left:return HorizontalDirection.Right;case HorizontalDirection.Right:return HorizontalDirection.Left;default:console.error(`AG Grid: Unknown direction ${e}`)}else return e}attemptMoveColumns(e){const{dragSourceType:t,hDirection:n,mouseX:o,fromEnter:a,fakeEvent:l}=e,s=n===HorizontalDirection.Left,m=n===HorizontalDirection.Right;let{allMovingColumns:y}=e;if(t===DragSourceType.HeaderCell){let Vn=[];y.forEach(Wr=>{let ps=null,il=Wr.getParent();for(;il!=null&&il.getDisplayedLeafColumns().length===1;)ps=il,il=il.getParent();ps!=null?ps.getProvidedColumnGroup().getLeafColumns().forEach(ml=>{Vn.includes(ml)||Vn.push(ml)}):Vn.includes(Wr)||Vn.push(Wr)}),y=Vn}const D=y.slice();this.columnModel.sortColumnsLikeGridColumns(D);const W=this.calculateValidMoves(D,m,o),Ee=this.calculateOldIndex(D);if(W.length===0)return;const dt=W[0];let Ht=Ee!==null&&!a;if(t==DragSourceType.HeaderCell&&(Ht=Ee!==null),Ht&&!l&&(s&&dt>=Ee||m&&dt<=Ee))return;const ir=this.columnModel.getAllDisplayedColumns();let Hr=[],Bn=null;for(let Vn=0;Vn<W.length;Vn++){const Wr=W[Vn],ps=this.columnModel.getProposedColumnOrder(D,Wr);if(!this.columnModel.doesOrderPassRules(ps))continue;const il=ps.filter(ml=>ir.includes(ml));if(Bn===null)Bn=il;else if(!_.areEqual(il,Bn))break;const gl=this.groupFragCount(ps);Hr.push({move:Wr,fragCount:gl})}Hr.length!==0&&(Hr.sort((Vn,Wr)=>Vn.fragCount-Wr.fragCount),this.moveColumns(y,Hr[0].move,"uiColumnMoved",!1))}calculateOldIndex(e){const t=this.columnModel.getAllGridColumns(),n=sortNumerically(e.map(m=>t.indexOf(m))),o=n[0];return last(n)-o!==n.length-1?null:o}moveColumns(e,t,n,o){this.columnModel.moveColumns(e,t,n,o),this.lastMovedInfo=o?null:{columns:e,toIndex:t}}groupFragCount(e){function t(o){let a=[],l=o.getOriginalParent();for(;l!=null;)a.push(l),l=l.getOriginalParent();return a}let n=0;for(let o=0;o<e.length-1;o++){let a=t(e[o]),l=t(e[o+1]);[a,l]=a.length>l.length?[a,l]:[l,a],a.forEach(s=>{l.indexOf(s)===-1&&n++})}return n}calculateValidMoves(e,t,n){if(this.gridOptionsService.is("suppressMovableColumns")||e.some(ir=>ir.getColDef().suppressMovable))return[];const a=this.columnModel.getDisplayedColumns(this.pinned),l=this.columnModel.getAllGridColumns(),s=a.filter(ir=>includes(e,ir)),m=a.filter(ir=>!includes(e,ir)),y=l.filter(ir=>!includes(e,ir));let D=0,W=n;if(t){let ir=0;s.forEach(Hr=>ir+=Hr.getActualWidth()),W-=ir}if(W>0){for(let ir=0;ir<m.length;ir++){const Hr=m[ir];if(W-=Hr.getActualWidth(),W<0)break;D++}t&&D++}let Ee;if(D>0){const ir=m[D-1];Ee=y.indexOf(ir)+1}else Ee=y.indexOf(m[0]),Ee===-1&&(Ee=0);const dt=[Ee],Ht=(ir,Hr)=>ir-Hr;if(t){let ir=Ee+1;const Hr=l.length-1;for(;ir<=Hr;)dt.push(ir),ir++;dt.sort(Ht)}else{let ir=Ee;const Hr=l.length-1;let Bn=l[ir];for(;ir<=Hr&&this.isColumnHidden(a,Bn);)ir++,dt.push(ir),Bn=l[ir];ir=Ee-1;const Vn=0;for(;ir>=Vn;)dt.push(ir),ir--;dt.sort(Ht).reverse()}return dt}isColumnHidden(e,t){return e.indexOf(t)<0}ensureIntervalStarted(){this.movingIntervalId||(this.intervalCount=0,this.failedMoveAttempts=0,this.movingIntervalId=window.setInterval(this.moveInterval.bind(this),100),this.needToMoveLeft?this.dragAndDropService.setGhostIcon(DragAndDropService.ICON_LEFT,!0):this.dragAndDropService.setGhostIcon(DragAndDropService.ICON_RIGHT,!0))}ensureIntervalCleared(){this.movingIntervalId&&(window.clearInterval(this.movingIntervalId),this.movingIntervalId=null,this.dragAndDropService.setGhostIcon(DragAndDropService.ICON_MOVE))}moveInterval(){let e;this.intervalCount++,e=10+this.intervalCount*5,e>100&&(e=100);let t=null;const n=this.gridBodyCon.getScrollFeature();if(this.needToMoveLeft?t=n.scrollHorizontally(-e):this.needToMoveRight&&(t=n.scrollHorizontally(e)),t!==0)this.onDragging(this.lastDraggingEvent),this.failedMoveAttempts=0;else{this.failedMoveAttempts++;const a=this.lastDraggingEvent.dragItem.columns.filter(l=>!l.getColDef().lockPinned);if(a.length>0&&(this.dragAndDropService.setGhostIcon(DragAndDropService.ICON_PINNED),this.failedMoveAttempts>7)){const l=this.needToMoveLeft?"left":"right";this.setColumnsPinned(a,l,"uiColumnDragged"),this.dragAndDropService.nudge()}}}}__decorate$1x([Autowired("columnModel")],MoveColumnFeature.prototype,"columnModel",void 0);__decorate$1x([Autowired("dragAndDropService")],MoveColumnFeature.prototype,"dragAndDropService",void 0);__decorate$1x([Autowired("gridOptionsService")],MoveColumnFeature.prototype,"gridOptionsService",void 0);__decorate$1x([Autowired("ctrlsService")],MoveColumnFeature.prototype,"ctrlsService",void 0);__decorate$1x([PostConstruct],MoveColumnFeature.prototype,"init",null);var __decorate$1w=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class BodyDropTarget extends BeanStub{constructor(e,t){super(),this.pinned=e,this.eContainer=t}postConstruct(){this.ctrlsService.whenReady(e=>{switch(this.pinned){case"left":this.eSecondaryContainers=[[e.gridBodyCtrl.getBodyViewportElement(),e.leftRowContainerCtrl.getContainerElement()],[e.bottomLeftRowContainerCtrl.getContainerElement()],[e.topLeftRowContainerCtrl.getContainerElement()]];break;case"right":this.eSecondaryContainers=[[e.gridBodyCtrl.getBodyViewportElement(),e.rightRowContainerCtrl.getContainerElement()],[e.bottomRightRowContainerCtrl.getContainerElement()],[e.topRightRowContainerCtrl.getContainerElement()]];break;default:this.eSecondaryContainers=[[e.gridBodyCtrl.getBodyViewportElement(),e.centerRowContainerCtrl.getViewportElement()],[e.bottomCenterRowContainerCtrl.getViewportElement()],[e.topCenterRowContainerCtrl.getViewportElement()]];break}})}isInterestedIn(e){return e===DragSourceType.HeaderCell||e===DragSourceType.ToolPanel&&this.gridOptionsService.is("allowDragFromColumnsToolPanel")}getSecondaryContainers(){return this.eSecondaryContainers}getContainer(){return this.eContainer}init(){this.moveColumnFeature=this.createManagedBean(new MoveColumnFeature(this.pinned,this.eContainer)),this.bodyDropPivotTarget=this.createManagedBean(new BodyDropPivotTarget(this.pinned)),this.dragAndDropService.addDropTarget(this)}getIconName(){return this.currentDropListener.getIconName()}isDropColumnInPivotMode(e){return this.columnModel.isPivotMode()&&e.dragSource.type===DragSourceType.ToolPanel}onDragEnter(e){this.currentDropListener=this.isDropColumnInPivotMode(e)?this.bodyDropPivotTarget:this.moveColumnFeature,this.currentDropListener.onDragEnter(e)}onDragLeave(e){this.currentDropListener.onDragLeave(e)}onDragging(e){this.currentDropListener.onDragging(e)}onDragStop(e){this.currentDropListener.onDragStop(e)}}__decorate$1w([Autowired("dragAndDropService")],BodyDropTarget.prototype,"dragAndDropService",void 0);__decorate$1w([Autowired("columnModel")],BodyDropTarget.prototype,"columnModel",void 0);__decorate$1w([Autowired("ctrlsService")],BodyDropTarget.prototype,"ctrlsService",void 0);__decorate$1w([PostConstruct],BodyDropTarget.prototype,"postConstruct",null);__decorate$1w([PostConstruct],BodyDropTarget.prototype,"init",null);class CssClassApplier{static getHeaderClassesFromColDef(e,t,n,o){return missing(e)?[]:this.getColumnClassesFromCollDef(e.headerClass,e,t,n,o)}static getToolPanelClassesFromColDef(e,t,n,o){return missing(e)?[]:this.getColumnClassesFromCollDef(e.toolPanelClass,e,t,n,o)}static getClassParams(e,t,n,o){return{colDef:e,column:n,columnGroup:o,api:t.api,columnApi:t.columnApi,context:t.context}}static getColumnClassesFromCollDef(e,t,n,o,a){if(missing(e))return[];let l;if(typeof e=="function"){const s=this.getClassParams(t,n,o,a);l=e(s)}else l=e;return typeof l=="string"?[l]:Array.isArray(l)?[...l]:[]}}var __decorate$1v=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class HeaderCellComp extends AbstractHeaderCellComp{constructor(e){super(HeaderCellComp.TEMPLATE,e),this.headerCompVersion=0,this.column=e.getColumnGroupChild(),this.pinned=e.getPinned()}postConstruct(){const e=this.getGui(),t=(a,l,s)=>{const m=s||e;l!=null&&l!=""?m.setAttribute(a,l):m.removeAttribute(a)},n={setWidth:a=>e.style.width=a,addOrRemoveCssClass:(a,l)=>this.addOrRemoveCssClass(a,l),setColId:a=>t("col-id",a),setTitle:a=>t("title",a),setAriaDescription:a=>setAriaDescription(e,a),setAriaSort:a=>a?setAriaSort(e,a):removeAriaSort(e),setUserCompDetails:a=>this.setUserCompDetails(a),getUserCompInstance:()=>this.headerComp};this.ctrl.setComp(n,this.getGui(),this.eResize,this.eHeaderCompWrapper);const o=this.ctrl.getSelectAllGui();this.eResize.insertAdjacentElement("afterend",o)}destroyHeaderComp(){this.headerComp&&(this.eHeaderCompWrapper.removeChild(this.headerCompGui),this.headerComp=this.destroyBean(this.headerComp),this.headerCompGui=void 0)}setUserCompDetails(e){this.headerCompVersion++;const t=this.headerCompVersion;e.newAgStackInstance().then(n=>this.afterCompCreated(t,n))}afterCompCreated(e,t){if(e!=this.headerCompVersion||!this.isAlive()){this.destroyBean(t);return}this.destroyHeaderComp(),this.headerComp=t,this.headerCompGui=t.getGui(),this.eHeaderCompWrapper.appendChild(this.headerCompGui),this.ctrl.setDragSource(this.getGui())}}HeaderCellComp.TEMPLATE=`<div class="ag-header-cell" role="columnheader" tabindex="-1">
            <div ref="eResize" class="ag-header-cell-resize" role="presentation"></div>
            <div ref="eHeaderCompWrapper" class="ag-header-cell-comp-wrapper" role="presentation"></div>
        </div>`;__decorate$1v([RefSelector("eResize")],HeaderCellComp.prototype,"eResize",void 0);__decorate$1v([RefSelector("eHeaderCompWrapper")],HeaderCellComp.prototype,"eHeaderCompWrapper",void 0);__decorate$1v([PostConstruct],HeaderCellComp.prototype,"postConstruct",null);__decorate$1v([PreDestroy],HeaderCellComp.prototype,"destroyHeaderComp",null);var __decorate$1u=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class HeaderGroupCellComp extends AbstractHeaderCellComp{constructor(e){super(HeaderGroupCellComp.TEMPLATE,e)}postConstruct(){const e=this.getGui(),t=(o,a)=>a!=null?e.setAttribute(o,a):e.removeAttribute(o),n={addOrRemoveCssClass:(o,a)=>this.addOrRemoveCssClass(o,a),setResizableDisplayed:o=>setDisplayed(this.eResize,o),setWidth:o=>e.style.width=o,setColId:o=>e.setAttribute("col-id",o),setAriaExpanded:o=>t("aria-expanded",o),setTitle:o=>t("title",o),setUserCompDetails:o=>this.setUserCompDetails(o)};this.ctrl.setComp(n,e,this.eResize)}setUserCompDetails(e){e.newAgStackInstance().then(t=>this.afterHeaderCompCreated(t))}afterHeaderCompCreated(e){const t=()=>this.destroyBean(e);if(!this.isAlive()){t();return}const n=this.getGui(),o=e.getGui();n.appendChild(o),this.addDestroyFunc(t),this.ctrl.setDragSource(n)}}HeaderGroupCellComp.TEMPLATE=`<div class="ag-header-group-cell" role="columnheader" tabindex="-1">
            <div ref="eResize" class="ag-header-cell-resize" role="presentation"></div>
        </div>`;__decorate$1u([Autowired("userComponentFactory")],HeaderGroupCellComp.prototype,"userComponentFactory",void 0);__decorate$1u([RefSelector("eResize")],HeaderGroupCellComp.prototype,"eResize",void 0);__decorate$1u([PostConstruct],HeaderGroupCellComp.prototype,"postConstruct",null);var __decorate$1t=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},HeaderRowType;(function(r){r.COLUMN_GROUP="group",r.COLUMN="column",r.FLOATING_FILTER="filter"})(HeaderRowType||(HeaderRowType={}));class HeaderRowComp extends Component{constructor(e){super(),this.headerComps={};const t=e.getType()==HeaderRowType.COLUMN_GROUP?"ag-header-row-column-group":e.getType()==HeaderRowType.FLOATING_FILTER?"ag-header-row-column-filter":"ag-header-row-column";this.setTemplate(`<div class="ag-header-row ${t}" role="row"></div>`),this.ctrl=e}init(){const e={setTransform:t=>this.getGui().style.transform=t,setHeight:t=>this.getGui().style.height=t,setTop:t=>this.getGui().style.top=t,setHeaderCtrls:t=>this.setHeaderCtrls(t),setWidth:t=>this.getGui().style.width=t,setAriaRowIndex:t=>setAriaRowIndex(this.getGui(),t)};this.ctrl.setComp(e)}destroyHeaderCtrls(){this.setHeaderCtrls([])}setHeaderCtrls(e){if(!this.isAlive())return;const t=this.headerComps;this.headerComps={},e.forEach(a=>{const l=a.getInstanceId();let s=t[l];delete t[l],s==null&&(s=this.createHeaderComp(a),this.getGui().appendChild(s.getGui())),this.headerComps[l]=s}),iterateObject(t,(a,l)=>{this.getGui().removeChild(l.getGui()),this.destroyBean(l)});const n=this.gridOptionsService.is("ensureDomOrder"),o=this.gridOptionsService.isDomLayout("print");if(n||o){const a=getAllValuesInObject(this.headerComps);a.sort((s,m)=>{const y=s.getCtrl().getColumnGroupChild().getLeft(),D=m.getCtrl().getColumnGroupChild().getLeft();return y-D});const l=a.map(s=>s.getGui());setDomChildOrder(this.getGui(),l)}}createHeaderComp(e){let t;switch(this.ctrl.getType()){case HeaderRowType.COLUMN_GROUP:t=new HeaderGroupCellComp(e);break;case HeaderRowType.FLOATING_FILTER:t=new HeaderFilterCellComp(e);break;default:t=new HeaderCellComp(e);break}return this.createBean(t),t.setParentComponent(this),t}}__decorate$1t([PostConstruct],HeaderRowComp.prototype,"init",null);__decorate$1t([PreDestroy],HeaderRowComp.prototype,"destroyHeaderCtrls",null);var __decorate$1s=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let instanceIdSequence$1=0;class AbstractHeaderCellCtrl extends BeanStub{constructor(e,t){super(),this.lastFocusEvent=null,this.columnGroupChild=e,this.parentRowCtrl=t,this.instanceId=e.getUniqueId()+"-"+instanceIdSequence$1++}shouldStopEventPropagation(e){const{headerRowIndex:t,column:n}=this.focusService.getFocusedHeader();return isUserSuppressingHeaderKeyboardEvent(this.gridOptionsService,e,t,n)}getWrapperHasFocus(){return this.gridOptionsService.getDocument().activeElement===this.eGui}setGui(e){this.eGui=e,this.addDomData()}handleKeyDown(e){const t=this.getWrapperHasFocus();switch(e.key){case KeyCode.PAGE_DOWN:case KeyCode.PAGE_UP:case KeyCode.PAGE_HOME:case KeyCode.PAGE_END:t&&e.preventDefault()}}addDomData(){const e=AbstractHeaderCellCtrl.DOM_DATA_KEY_HEADER_CTRL;this.gridOptionsService.setDomData(this.eGui,e,this),this.addDestroyFunc(()=>this.gridOptionsService.setDomData(this.eGui,e,null))}getGui(){return this.eGui}focus(e){return this.eGui?(this.lastFocusEvent=e||null,this.eGui.focus(),!0):!1}getRowIndex(){return this.parentRowCtrl.getRowIndex()}getParentRowCtrl(){return this.parentRowCtrl}getPinned(){return this.parentRowCtrl.getPinned()}getInstanceId(){return this.instanceId}getColumnGroupChild(){return this.columnGroupChild}}AbstractHeaderCellCtrl.DOM_DATA_KEY_HEADER_CTRL="headerCtrl";__decorate$1s([Autowired("focusService")],AbstractHeaderCellCtrl.prototype,"focusService",void 0);__decorate$1s([Autowired("beans")],AbstractHeaderCellCtrl.prototype,"beans",void 0);__decorate$1s([Autowired("userComponentFactory")],AbstractHeaderCellCtrl.prototype,"userComponentFactory",void 0);var __decorate$1r=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class SetLeftFeature extends BeanStub{constructor(e,t,n,o){super(),this.columnOrGroup=e,this.eCell=t,this.ariaEl=this.eCell.querySelector("[role=columnheader]")||this.eCell,this.colsSpanning=o,this.beans=n}setColsSpanning(e){this.colsSpanning=e,this.onLeftChanged()}getColumnOrGroup(){return this.beans.gridOptionsService.is("enableRtl")&&this.colsSpanning?last(this.colsSpanning):this.columnOrGroup}postConstruct(){this.addManagedListener(this.columnOrGroup,Column.EVENT_LEFT_CHANGED,this.onLeftChanged.bind(this)),this.setLeftFirstTime(),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED,this.onLeftChanged.bind(this)),this.addManagedPropertyListener("domLayout",this.onLeftChanged.bind(this))}setLeftFirstTime(){const e=this.beans.gridOptionsService.is("suppressColumnMoveAnimation"),t=exists(this.columnOrGroup.getOldLeft());this.beans.columnAnimationService.isActive()&&t&&!e?this.animateInLeft():this.onLeftChanged()}animateInLeft(){const e=this.getColumnOrGroup(),t=e.getLeft(),n=e.getOldLeft(),o=this.modifyLeftForPrintLayout(e,n),a=this.modifyLeftForPrintLayout(e,t);this.setLeft(o),this.actualLeft=a,this.beans.columnAnimationService.executeNextVMTurn(()=>{this.actualLeft===a&&this.setLeft(a)})}onLeftChanged(){const e=this.getColumnOrGroup(),t=e.getLeft();this.actualLeft=this.modifyLeftForPrintLayout(e,t),this.setLeft(this.actualLeft)}modifyLeftForPrintLayout(e,t){if(!this.beans.gridOptionsService.isDomLayout("print")||e.getPinned()==="left")return t;const o=this.beans.columnModel.getDisplayedColumnsLeftWidth();if(e.getPinned()==="right"){const a=this.beans.columnModel.getBodyContainerWidth();return o+a+t}return o+t}setLeft(e){exists(e)&&(this.eCell.style.left=`${e}px`);let t;if(this.columnOrGroup instanceof Column)t=this.columnOrGroup;else{const a=this.columnOrGroup.getLeafColumns();if(!a.length)return;a.length>1&&setAriaColSpan(this.ariaEl,a.length),t=a[0]}const n=this.beans.columnModel.getAriaColumnIndex(t);setAriaColIndex(this.ariaEl,n)}}__decorate$1r([PostConstruct],SetLeftFeature.prototype,"postConstruct",null);var __decorate$1q=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class HoverFeature extends BeanStub{constructor(e,t){super(),this.columns=e,this.element=t}postConstruct(){this.gridOptionsService.is("columnHoverHighlight")&&this.addMouseHoverListeners()}addMouseHoverListeners(){this.addManagedListener(this.element,"mouseout",this.onMouseOut.bind(this)),this.addManagedListener(this.element,"mouseover",this.onMouseOver.bind(this))}onMouseOut(){this.columnHoverService.clearMouseOver()}onMouseOver(){this.columnHoverService.setMouseOver(this.columns)}}__decorate$1q([Autowired("columnHoverService")],HoverFeature.prototype,"columnHoverService",void 0);__decorate$1q([PostConstruct],HoverFeature.prototype,"postConstruct",null);var __decorate$1p=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class HeaderFilterCellCtrl extends AbstractHeaderCellCtrl{constructor(e,t){super(e,t),this.iconCreated=!1,this.column=e}setComp(e,t,n,o){super.setGui(t),this.comp=e,this.eButtonShowMainFilter=n,this.eFloatingFilterBody=o,this.setupActive(),this.setupWidth(),this.setupLeft(),this.setupHover(),this.setupFocus(),this.setupAria(),this.setupFilterButton(),this.setupUserComp(),this.setupSyncWithFilter(),this.setupUi(),this.addManagedListener(this.eButtonShowMainFilter,"click",this.showParentFilter.bind(this)),this.setupFilterChangedListener(),this.addManagedListener(this.column,Column.EVENT_COL_DEF_CHANGED,this.onColDefChanged.bind(this))}setupActive(){const e=this.column.getColDef(),t=!!e.filter,n=!!e.floatingFilter;this.active=t&&n}setupUi(){if(this.comp.setButtonWrapperDisplayed(!this.suppressFilterButton&&this.active),this.comp.addOrRemoveBodyCssClass("ag-floating-filter-full-body",this.suppressFilterButton),this.comp.addOrRemoveBodyCssClass("ag-floating-filter-body",!this.suppressFilterButton),!this.active||this.iconCreated)return;const e=createIconNoSpan("filter",this.gridOptionsService,this.column);e&&(this.iconCreated=!0,this.eButtonShowMainFilter.appendChild(e))}setupFocus(){this.createManagedBean(new ManagedFocusFeature(this.eGui,{shouldStopEventPropagation:this.shouldStopEventPropagation.bind(this),onTabKeyDown:this.onTabKeyDown.bind(this),handleKeyDown:this.handleKeyDown.bind(this),onFocusIn:this.onFocusIn.bind(this)}))}setupAria(){const e=this.localeService.getLocaleTextFunc();setAriaLabel(this.eButtonShowMainFilter,e("ariaFilterMenuOpen","Open Filter Menu"))}onTabKeyDown(e){if(this.gridOptionsService.getDocument().activeElement===this.eGui)return;const a=this.focusService.findNextFocusableElement(this.eGui,null,e.shiftKey);if(a){this.beans.headerNavigationService.scrollToColumn(this.column),e.preventDefault(),a.focus();return}const l=this.findNextColumnWithFloatingFilter(e.shiftKey);l&&this.focusService.focusHeaderPosition({headerPosition:{headerRowIndex:this.getParentRowCtrl().getRowIndex(),column:l},event:e})&&e.preventDefault()}findNextColumnWithFloatingFilter(e){const t=this.beans.columnModel;let n=this.column;do if(n=e?t.getDisplayedColBefore(n):t.getDisplayedColAfter(n),!n)break;while(!n.getColDef().filter||!n.getColDef().floatingFilter);return n}handleKeyDown(e){super.handleKeyDown(e);const t=this.getWrapperHasFocus();switch(e.key){case KeyCode.UP:case KeyCode.DOWN:t||e.preventDefault();case KeyCode.LEFT:case KeyCode.RIGHT:if(t)return;e.stopPropagation();case KeyCode.ENTER:t&&this.focusService.focusInto(this.eGui)&&e.preventDefault();break;case KeyCode.ESCAPE:t||this.eGui.focus()}}onFocusIn(e){if(this.eGui.contains(e.relatedTarget))return;const n=!!e.relatedTarget&&!e.relatedTarget.classList.contains("ag-floating-filter"),o=!!e.relatedTarget&&isElementChildOfClass(e.relatedTarget,"ag-floating-filter");if(n&&o&&e.target===this.eGui){const l=this.lastFocusEvent,s=!!(l&&l.key===KeyCode.TAB);if(l&&s){const m=l.shiftKey;this.focusService.focusInto(this.eGui,m)}}const a=this.getRowIndex();this.beans.focusService.setFocusedHeader(a,this.column)}setupHover(){this.createManagedBean(new HoverFeature([this.column],this.eGui));const e=()=>{if(!this.gridOptionsService.is("columnHoverHighlight"))return;const t=this.columnHoverService.isHovered(this.column);this.comp.addOrRemoveCssClass("ag-column-hover",t)};this.addManagedListener(this.eventService,Events.EVENT_COLUMN_HOVER_CHANGED,e),e()}setupLeft(){const e=new SetLeftFeature(this.column,this.eGui,this.beans);this.createManagedBean(e)}setupFilterButton(){const e=this.column.getColDef();this.suppressFilterButton=e.floatingFilterComponentParams?!!e.floatingFilterComponentParams.suppressFilterButton:!1}setupUserComp(){if(!this.active)return;const e=this.filterManager.getFloatingFilterCompDetails(this.column,()=>this.showParentFilter());e&&this.setCompDetails(e)}setCompDetails(e){this.userCompDetails=e,this.comp.setCompDetails(e)}showParentFilter(){const e=this.suppressFilterButton?this.eFloatingFilterBody:this.eButtonShowMainFilter;this.menuFactory.showMenuAfterButtonClick(this.column,e,"floatingFilter","filterMenuTab",["filterMenuTab"])}setupSyncWithFilter(){if(!this.active)return;const e=t=>{const n=this.comp.getFloatingFilterComp();n&&n.then(o=>{if(o){const a=this.filterManager.getCurrentFloatingFilterParentModel(this.column);o.onParentModelChanged(a,t)}})};this.destroySyncListener=this.addManagedListener(this.column,Column.EVENT_FILTER_CHANGED,e),this.filterManager.isFilterActive(this.column)&&e(null)}setupWidth(){const e=()=>{const t=`${this.column.getActualWidth()}px`;this.comp.setWidth(t)};this.addManagedListener(this.column,Column.EVENT_WIDTH_CHANGED,e),e()}setupFilterChangedListener(){this.active&&(this.destroyFilterChangedListener=this.addManagedListener(this.column,Column.EVENT_FILTER_CHANGED,this.updateFilterButton.bind(this)))}updateFilterButton(){!this.suppressFilterButton&&this.comp&&this.comp.setButtonWrapperDisplayed(this.filterManager.isFilterAllowed(this.column))}onColDefChanged(){var e,t;const n=this.active;this.setupActive();const o=!n&&this.active;n&&!this.active&&((e=this.destroySyncListener)===null||e===void 0||e.call(this),(t=this.destroyFilterChangedListener)===null||t===void 0||t.call(this));const a=this.active?this.filterManager.getFloatingFilterCompDetails(this.column,()=>this.showParentFilter()):null,l=this.comp.getFloatingFilterComp();!l||!a?this.updateCompDetails(a,o):l.then(s=>{var m;(!s||((m=this.userCompDetails)===null||m===void 0?void 0:m.componentClass)!==a.componentClass)&&this.updateCompDetails(a,o)})}updateCompDetails(e,t){this.setCompDetails(e),this.setupFilterButton(),this.setupUi(),t&&(this.setupSyncWithFilter(),this.setupFilterChangedListener())}}__decorate$1p([Autowired("filterManager")],HeaderFilterCellCtrl.prototype,"filterManager",void 0);__decorate$1p([Autowired("columnHoverService")],HeaderFilterCellCtrl.prototype,"columnHoverService",void 0);__decorate$1p([Autowired("menuFactory")],HeaderFilterCellCtrl.prototype,"menuFactory",void 0);var __decorate$1o=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class ResizeFeature extends BeanStub{constructor(e,t,n,o,a){super(),this.pinned=e,this.column=t,this.eResize=n,this.comp=o,this.ctrl=a}postConstruct(){const e=this.column.getColDef(),t=[];let n,o;const a=()=>{if(setDisplayed(this.eResize,n),!n)return;const m=this.horizontalResizeService.addResizeBar({eResizeBar:this.eResize,onResizeStart:this.onResizeStart.bind(this),onResizing:this.onResizing.bind(this,!1),onResizeEnd:this.onResizing.bind(this,!0)});if(t.push(m),o){const y=this.gridOptionsService.is("skipHeaderOnAutoSize"),D=()=>{this.columnModel.autoSizeColumn(this.column,y,"uiColumnResized")};this.eResize.addEventListener("dblclick",D);const W=new TouchListener(this.eResize);W.addEventListener(TouchListener.EVENT_DOUBLE_TAP,D),this.addDestroyFunc(()=>{this.eResize.removeEventListener("dblclick",D),W.removeEventListener(TouchListener.EVENT_DOUBLE_TAP,D),W.destroy()})}},l=()=>{t.forEach(m=>m()),t.length=0},s=()=>{const m=this.column.isResizable(),y=!this.gridOptionsService.is("suppressAutoSize")&&!e.suppressAutoSize;(m!==n||y!==o)&&(n=m,o=y,l(),a())};s(),this.addDestroyFunc(l),this.ctrl.addRefreshFunction(s)}onResizing(e,t){const n=this.normaliseResizeAmount(t),o=[{key:this.column,newWidth:this.resizeStartWidth+n}];this.columnModel.setColumnWidths(o,this.resizeWithShiftKey,e,"uiColumnResized"),e&&this.comp.addOrRemoveCssClass("ag-column-resizing",!1)}onResizeStart(e){this.resizeStartWidth=this.column.getActualWidth(),this.resizeWithShiftKey=e,this.comp.addOrRemoveCssClass("ag-column-resizing",!0)}normaliseResizeAmount(e){let t=e;const n=this.pinned!=="left",o=this.pinned==="right";return this.gridOptionsService.is("enableRtl")?n&&(t*=-1):o&&(t*=-1),t}}__decorate$1o([Autowired("horizontalResizeService")],ResizeFeature.prototype,"horizontalResizeService",void 0);__decorate$1o([Autowired("columnModel")],ResizeFeature.prototype,"columnModel",void 0);__decorate$1o([PostConstruct],ResizeFeature.prototype,"postConstruct",null);var __decorate$1n=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class SelectAllFeature extends BeanStub{constructor(e){super(),this.cbSelectAllVisible=!1,this.processingEventFromCheckbox=!1,this.column=e;const t=e.getColDef();this.filteredOnly=!!(t!=null&&t.headerCheckboxSelectionFilteredOnly),this.currentPageOnly=!!(t!=null&&t.headerCheckboxSelectionCurrentPageOnly)}onSpaceKeyDown(e){const t=this.cbSelectAll,n=this.gridOptionsService.getDocument();t.isDisplayed()&&!t.getGui().contains(n.activeElement)&&(e.preventDefault(),t.setValue(!t.getValue()))}getCheckboxGui(){return this.cbSelectAll.getGui()}setComp(e){this.headerCellCtrl=e,this.cbSelectAll=this.createManagedBean(new AgCheckbox),this.cbSelectAll.addCssClass("ag-header-select-all"),setAriaRole(this.cbSelectAll.getGui(),"presentation"),this.showOrHideSelectAll(),this.addManagedListener(this.eventService,Events.EVENT_NEW_COLUMNS_LOADED,this.showOrHideSelectAll.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,this.showOrHideSelectAll.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_SELECTION_CHANGED,this.onSelectionChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_PAGINATION_CHANGED,this.onSelectionChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_MODEL_UPDATED,this.onModelChanged.bind(this)),this.addManagedListener(this.cbSelectAll,AgCheckbox.EVENT_CHANGED,this.onCbSelectAll.bind(this)),setAriaHidden(this.cbSelectAll.getGui(),!0),this.cbSelectAll.getInputElement().setAttribute("tabindex","-1"),this.refreshSelectAllLabel()}showOrHideSelectAll(){this.cbSelectAllVisible=this.isCheckboxSelection(),this.cbSelectAll.setDisplayed(this.cbSelectAllVisible,{skipAriaHidden:!0}),this.cbSelectAllVisible&&(this.checkRightRowModelType("selectAllCheckbox"),this.updateStateOfCheckbox()),this.refreshSelectAllLabel()}onModelChanged(){this.cbSelectAllVisible&&this.updateStateOfCheckbox()}onSelectionChanged(){this.cbSelectAllVisible&&this.updateStateOfCheckbox()}updateStateOfCheckbox(){if(this.processingEventFromCheckbox)return;this.processingEventFromCheckbox=!0;const e=this.selectionService.getSelectAllState(this.filteredOnly,this.currentPageOnly);this.cbSelectAll.setValue(e),this.refreshSelectAllLabel(),this.processingEventFromCheckbox=!1}refreshSelectAllLabel(){const e=this.localeService.getLocaleTextFunc(),n=this.cbSelectAll.getValue()?e("ariaChecked","checked"):e("ariaUnchecked","unchecked"),o=e("ariaRowSelectAll","Press Space to toggle all rows selection");this.cbSelectAllVisible?this.headerCellCtrl.setAriaDescriptionProperty("selectAll",`${o} (${n})`):this.headerCellCtrl.setAriaDescriptionProperty("selectAll",null),this.cbSelectAll.setInputAriaLabel(`${o} (${n})`),this.headerCellCtrl.refreshAriaDescription()}checkRightRowModelType(e){const t=this.rowModel.getType();return t==="clientSide"||t==="serverSide"?!0:(console.warn(`AG Grid: ${e} is only available if using 'clientSide' or 'serverSide' rowModelType, you are using ${t}.`),!1)}onCbSelectAll(){if(this.processingEventFromCheckbox||!this.cbSelectAllVisible)return;const e=this.cbSelectAll.getValue();let t="uiSelectAll";this.currentPageOnly?t="uiSelectAllCurrentPage":this.filteredOnly&&(t="uiSelectAllFiltered");const n={source:t,justFiltered:this.filteredOnly,justCurrentPage:this.currentPageOnly};e?this.selectionService.selectAllRowNodes(n):this.selectionService.deselectAllRowNodes(n)}isCheckboxSelection(){let e=this.column.getColDef().headerCheckboxSelection;if(typeof e=="function"){const t=e,n={column:this.column,colDef:this.column.getColDef(),columnApi:this.columnApi,api:this.gridApi,context:this.gridOptionsService.context};e=t(n)}return e?this.checkRightRowModelType("headerCheckboxSelection"):!1}}__decorate$1n([Autowired("gridApi")],SelectAllFeature.prototype,"gridApi",void 0);__decorate$1n([Autowired("columnApi")],SelectAllFeature.prototype,"columnApi",void 0);__decorate$1n([Autowired("rowModel")],SelectAllFeature.prototype,"rowModel",void 0);__decorate$1n([Autowired("selectionService")],SelectAllFeature.prototype,"selectionService",void 0);var __decorate$1m=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},TabGuardClassNames;(function(r){r.TAB_GUARD="ag-tab-guard",r.TAB_GUARD_TOP="ag-tab-guard-top",r.TAB_GUARD_BOTTOM="ag-tab-guard-bottom"})(TabGuardClassNames||(TabGuardClassNames={}));class TabGuardCtrl extends BeanStub{constructor(e){super(),this.skipTabGuardFocus=!1;const{comp:t,eTopGuard:n,eBottomGuard:o,focusInnerElement:a,onFocusIn:l,onFocusOut:s,shouldStopEventPropagation:m,onTabKeyDown:y,handleKeyDown:D,eFocusableElement:W}=e;this.comp=t,this.eTopGuard=n,this.eBottomGuard=o,this.providedFocusInnerElement=a,this.eFocusableElement=W,this.providedFocusIn=l,this.providedFocusOut=s,this.providedShouldStopEventPropagation=m,this.providedOnTabKeyDown=y,this.providedHandleKeyDown=D}postConstruct(){this.createManagedBean(new ManagedFocusFeature(this.eFocusableElement,{shouldStopEventPropagation:()=>this.shouldStopEventPropagation(),onTabKeyDown:e=>this.onTabKeyDown(e),handleKeyDown:e=>this.handleKeyDown(e),onFocusIn:e=>this.onFocusIn(e),onFocusOut:e=>this.onFocusOut(e)})),this.activateTabGuards(),[this.eTopGuard,this.eBottomGuard].forEach(e=>this.addManagedListener(e,"focus",this.onFocus.bind(this)))}handleKeyDown(e){this.providedHandleKeyDown&&this.providedHandleKeyDown(e)}tabGuardsAreActive(){return!!this.eTopGuard&&this.eTopGuard.hasAttribute("tabIndex")}shouldStopEventPropagation(){return this.providedShouldStopEventPropagation?this.providedShouldStopEventPropagation():!1}activateTabGuards(){const e=this.gridOptionsService.getNum("tabIndex")||0;this.comp.setTabIndex(e.toString())}deactivateTabGuards(){this.comp.setTabIndex()}onFocus(e){if(this.skipTabGuardFocus){this.skipTabGuardFocus=!1;return}const t=e.target===this.eBottomGuard;this.providedFocusInnerElement?this.providedFocusInnerElement(t):this.focusInnerElement(t)}onFocusIn(e){this.providedFocusIn&&this.providedFocusIn(e)||this.deactivateTabGuards()}onFocusOut(e){this.providedFocusOut&&this.providedFocusOut(e)||this.eFocusableElement.contains(e.relatedTarget)||this.activateTabGuards()}onTabKeyDown(e){if(this.providedOnTabKeyDown){this.providedOnTabKeyDown(e);return}if(e.defaultPrevented)return;const t=this.tabGuardsAreActive();t&&this.deactivateTabGuards();const n=this.getNextFocusableElement(e.shiftKey);t&&setTimeout(()=>this.activateTabGuards(),0),n&&(n.focus(),e.preventDefault())}focusInnerElement(e=!1){const t=this.focusService.findFocusableElements(this.eFocusableElement);this.tabGuardsAreActive()&&(t.splice(0,1),t.splice(t.length-1,1)),t.length&&t[e?t.length-1:0].focus({preventScroll:!0})}getNextFocusableElement(e){return this.focusService.findNextFocusableElement(this.eFocusableElement,!1,e)}forceFocusOutOfContainer(e=!1){const t=e?this.eTopGuard:this.eBottomGuard;this.activateTabGuards(),this.skipTabGuardFocus=!0,t.focus()}}__decorate$1m([Autowired("focusService")],TabGuardCtrl.prototype,"focusService",void 0);__decorate$1m([PostConstruct],TabGuardCtrl.prototype,"postConstruct",null);var __decorate$1l=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},FocusService_1;let FocusService=FocusService_1=class extends BeanStub{static addKeyboardModeEvents(e,t){const n=FocusService_1.instancesMonitored.get(e);n&&n.length>0?n.indexOf(t)===-1&&n.push(t):(FocusService_1.instancesMonitored.set(e,[t]),e.addEventListener("keydown",FocusService_1.toggleKeyboardMode),e.addEventListener("mousedown",FocusService_1.toggleKeyboardMode))}static removeKeyboardModeEvents(e,t){const n=FocusService_1.instancesMonitored.get(e);let o=[];n&&n.length&&(o=[...n].filter(a=>a!==t),FocusService_1.instancesMonitored.set(e,o)),o.length===0&&(e.removeEventListener("keydown",FocusService_1.toggleKeyboardMode),e.removeEventListener("mousedown",FocusService_1.toggleKeyboardMode))}static toggleKeyboardMode(e){const t=FocusService_1.keyboardModeActive,n=e.type==="keydown";if(n&&(e.ctrlKey||e.metaKey||e.altKey)||t&&n||!t&&!n)return;FocusService_1.keyboardModeActive=n;const o=e.target.ownerDocument;if(!o)return;const a=FocusService_1.instancesMonitored.get(o);a&&a.forEach(l=>{l.dispatchEvent({type:n?Events.EVENT_KEYBOARD_FOCUS:Events.EVENT_MOUSE_FOCUS})})}init(){const e=this.clearFocusedCell.bind(this);this.addManagedListener(this.eventService,Events.EVENT_COLUMN_PIVOT_MODE_CHANGED,e),this.addManagedListener(this.eventService,Events.EVENT_NEW_COLUMNS_LOADED,this.onColumnEverythingChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_GROUP_OPENED,e),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_ROW_GROUP_CHANGED,e),this.ctrlsService.whenReady(t=>{this.gridCtrl=t.gridCtrl;const n=this.gridOptionsService.getDocument();FocusService_1.addKeyboardModeEvents(n,this.gridCtrl),this.addDestroyFunc(()=>this.unregisterGridCompController(this.gridCtrl))})}unregisterGridCompController(e){const t=this.gridOptionsService.getDocument();FocusService_1.removeKeyboardModeEvents(t,e)}onColumnEverythingChanged(){if(!this.focusedCellPosition)return;const e=this.focusedCellPosition.column,t=this.columnModel.getGridColumn(e.getId());e!==t&&this.clearFocusedCell()}isKeyboardMode(){return FocusService_1.keyboardModeActive}getFocusCellToUseAfterRefresh(){const e=this.gridOptionsService.getDocument();return this.gridOptionsService.is("suppressFocusAfterRefresh")||!this.focusedCellPosition||this.isDomDataMissingInHierarchy(e.activeElement,RowCtrl.DOM_DATA_KEY_ROW_CTRL)?null:this.focusedCellPosition}getFocusHeaderToUseAfterRefresh(){const e=this.gridOptionsService.getDocument();return this.gridOptionsService.is("suppressFocusAfterRefresh")||!this.focusedHeaderPosition||this.isDomDataMissingInHierarchy(e.activeElement,AbstractHeaderCellCtrl.DOM_DATA_KEY_HEADER_CTRL)?null:this.focusedHeaderPosition}isDomDataMissingInHierarchy(e,t){let n=e;for(;n;){if(this.gridOptionsService.getDomData(n,t))return!1;n=n.parentNode}return!0}getFocusedCell(){return this.focusedCellPosition}shouldRestoreFocus(e){return this.isCellRestoreFocused(e)?(setTimeout(()=>{this.restoredFocusedCellPosition=null},0),!0):!1}isCellRestoreFocused(e){return this.restoredFocusedCellPosition==null?!1:this.cellPositionUtils.equals(e,this.restoredFocusedCellPosition)}setRestoreFocusedCell(e){this.getFrameworkOverrides().renderingEngine==="react"&&(this.restoredFocusedCellPosition=e)}getFocusEventParams(){const{rowIndex:e,rowPinned:t,column:n}=this.focusedCellPosition,o={rowIndex:e,rowPinned:t,column:n,isFullWidthCell:!1},a=this.rowRenderer.getRowByPosition({rowIndex:e,rowPinned:t});return a&&(o.isFullWidthCell=a.isFullWidth()),o}clearFocusedCell(){if(this.restoredFocusedCellPosition=null,this.focusedCellPosition==null)return;const e=Object.assign({type:Events.EVENT_CELL_FOCUS_CLEARED},this.getFocusEventParams());this.focusedCellPosition=null,this.eventService.dispatchEvent(e)}setFocusedCell(e){const{column:t,rowIndex:n,rowPinned:o,forceBrowserFocus:a=!1,preventScrollOnBrowserFocus:l=!1}=e,s=this.columnModel.getGridColumn(t);if(!s){this.focusedCellPosition=null;return}this.focusedCellPosition=s?{rowIndex:n,rowPinned:makeNull(o),column:s}:null;const m=Object.assign(Object.assign({type:Events.EVENT_CELL_FOCUSED},this.getFocusEventParams()),{forceBrowserFocus:a,preventScrollOnBrowserFocus:l,floating:null});this.eventService.dispatchEvent(m)}isCellFocused(e){return this.focusedCellPosition==null?!1:this.cellPositionUtils.equals(e,this.focusedCellPosition)}isRowNodeFocused(e){return this.isRowFocused(e.rowIndex,e.rowPinned)}isHeaderWrapperFocused(e){if(this.focusedHeaderPosition==null)return!1;const t=e.getColumnGroupChild(),n=e.getRowIndex(),o=e.getPinned(),{column:a,headerRowIndex:l}=this.focusedHeaderPosition;return t===a&&n===l&&o==a.getPinned()}clearFocusedHeader(){this.focusedHeaderPosition=null}getFocusedHeader(){return this.focusedHeaderPosition}setFocusedHeader(e,t){this.focusedHeaderPosition={headerRowIndex:e,column:t}}focusHeaderPosition(e){const{direction:t,fromTab:n,allowUserOverride:o,event:a}=e;let{headerPosition:l}=e;if(o){const y=this.getFocusedHeader(),D=this.headerNavigationService.getHeaderRowCount();if(n){const W=this.gridOptionsService.getCallback("tabToNextHeader");W&&(l=W({backwards:t==="Before",previousHeaderPosition:y,nextHeaderPosition:l,headerRowCount:D}))}else{const W=this.gridOptionsService.getCallback("navigateToNextHeader");if(W&&a){const Ee={key:a.key,previousHeaderPosition:y,nextHeaderPosition:l,headerRowCount:D,event:a};l=W(Ee)}}}return l?l.headerRowIndex===-1?this.focusGridView(l.column):(this.headerNavigationService.scrollToColumn(l.column,t),this.ctrlsService.getHeaderRowContainerCtrl(l.column.getPinned()).focusHeader(l.headerRowIndex,l.column,a)):!1}focusFirstHeader(){let e=this.columnModel.getAllDisplayedColumns()[0];return e?(e.getParent()&&(e=this.columnModel.getColumnGroupAtLevel(e,0)),this.focusHeaderPosition({headerPosition:{headerRowIndex:0,column:e}})):!1}focusLastHeader(e){const t=this.headerNavigationService.getHeaderRowCount()-1,n=last(this.columnModel.getAllDisplayedColumns());return this.focusHeaderPosition({headerPosition:{headerRowIndex:t,column:n},event:e})}isAnyCellFocused(){return!!this.focusedCellPosition}isRowFocused(e,t){return this.focusedCellPosition==null?!1:this.focusedCellPosition.rowIndex===e&&this.focusedCellPosition.rowPinned===makeNull(t)}findFocusableElements(e,t,n=!1){const o=FOCUSABLE_SELECTOR;let a=FOCUSABLE_EXCLUDE;t&&(a+=", "+t),n&&(a+=', [tabindex="-1"]');const l=Array.prototype.slice.apply(e.querySelectorAll(o)),s=Array.prototype.slice.apply(e.querySelectorAll(a));return s.length?((y,D)=>y.filter(W=>D.indexOf(W)===-1))(l,s):l}focusInto(e,t=!1,n=!1){const o=this.findFocusableElements(e,null,n),a=t?last(o):o[0];return a?(a.focus({preventScroll:!0}),!0):!1}findFocusableElementBeforeTabGuard(e,t){if(!t)return null;const n=this.findFocusableElements(e),o=n.indexOf(t);if(o===-1)return null;let a=-1;for(let l=o-1;l>=0;l--)if(n[l].classList.contains(TabGuardClassNames.TAB_GUARD_TOP)){a=l;break}return a<=0?null:n[a-1]}findNextFocusableElement(e=this.eGridDiv,t,n){const o=this.findFocusableElements(e,t?':not([tabindex="-1"])':null),l=this.gridOptionsService.getDocument().activeElement;let s;t?s=o.findIndex(y=>y.contains(l)):s=o.indexOf(l);const m=s+(n?-1:1);return m<0||m>=o.length?null:o[m]}isTargetUnderManagedComponent(e,t){if(!t)return!1;const n=e.querySelectorAll(`.${ManagedFocusFeature.FOCUS_MANAGED_CLASS}`);if(!n.length)return!1;for(let o=0;o<n.length;o++)if(n[o].contains(t))return!0;return!1}findTabbableParent(e,t=5){let n=0;for(;e&&getTabIndex(e)===null&&++n<=t;)e=e.parentElement;return getTabIndex(e)===null?null:e}focusGridView(e,t){if(this.gridOptionsService.is("suppressCellFocus"))return t?this.focusLastHeader():this.focusNextGridCoreContainer(!1);const n=t?this.rowPositionUtils.getLastRow():this.rowPositionUtils.getFirstRow();if(!n)return!1;const{rowIndex:o,rowPinned:a}=n,l=this.getFocusedHeader();if(!e&&l&&(e=l.column),o==null||!e)return!1;if(this.navigationService.ensureCellVisible({rowIndex:o,column:e,rowPinned:a}),this.setFocusedCell({rowIndex:o,column:e,rowPinned:makeNull(a),forceBrowserFocus:!0}),this.rangeService){const s={rowIndex:o,rowPinned:a,column:e};this.rangeService.setRangeToCell(s)}return!0}focusNextGridCoreContainer(e,t=!1){return!t&&this.gridCtrl.focusNextInnerContainer(e)?!0:((t||!e&&!this.gridCtrl.isDetailGrid())&&this.gridCtrl.forceFocusOutOfContainer(e),!1)}};FocusService.AG_KEYBOARD_FOCUS="ag-keyboard-focus";FocusService.keyboardModeActive=!1;FocusService.instancesMonitored=new Map;__decorate$1l([Autowired("eGridDiv")],FocusService.prototype,"eGridDiv",void 0);__decorate$1l([Autowired("columnModel")],FocusService.prototype,"columnModel",void 0);__decorate$1l([Autowired("headerNavigationService")],FocusService.prototype,"headerNavigationService",void 0);__decorate$1l([Autowired("rowRenderer")],FocusService.prototype,"rowRenderer",void 0);__decorate$1l([Autowired("rowPositionUtils")],FocusService.prototype,"rowPositionUtils",void 0);__decorate$1l([Autowired("cellPositionUtils")],FocusService.prototype,"cellPositionUtils",void 0);__decorate$1l([Optional("rangeService")],FocusService.prototype,"rangeService",void 0);__decorate$1l([Autowired("navigationService")],FocusService.prototype,"navigationService",void 0);__decorate$1l([Autowired("ctrlsService")],FocusService.prototype,"ctrlsService",void 0);__decorate$1l([PostConstruct],FocusService.prototype,"init",null);FocusService=FocusService_1=__decorate$1l([Bean("focusService")],FocusService);var __decorate$1k=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class HeaderCellCtrl extends AbstractHeaderCellCtrl{constructor(e,t){super(e,t),this.refreshFunctions=[],this.userHeaderClasses=new Set,this.ariaDescriptionProperties=new Map,this.column=e}setComp(e,t,n,o){super.setGui(t),this.comp=e,this.updateState(),this.setupWidth(),this.setupMovingCss(),this.setupMenuClass(),this.setupSortableClass(),this.setupWrapTextClass(),this.refreshSpanHeaderHeight(),this.setupAutoHeight(o),this.addColumnHoverListener(),this.setupFilterCss(),this.setupColId(),this.setupClassesFromColDef(),this.setupTooltip(),this.addActiveHeaderMouseListeners(),this.setupSelectAll(),this.setupUserComp(),this.refreshAria(),this.createManagedBean(new ResizeFeature(this.getPinned(),this.column,n,e,this)),this.createManagedBean(new HoverFeature([this.column],t)),this.createManagedBean(new SetLeftFeature(this.column,t,this.beans)),this.createManagedBean(new ManagedFocusFeature(t,{shouldStopEventPropagation:a=>this.shouldStopEventPropagation(a),onTabKeyDown:()=>null,handleKeyDown:this.handleKeyDown.bind(this),onFocusIn:this.onFocusIn.bind(this),onFocusOut:this.onFocusOut.bind(this)})),this.addMouseDownListenerIfNeeded(t),this.addManagedListener(this.column,Column.EVENT_COL_DEF_CHANGED,this.onColDefChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_VALUE_CHANGED,this.onColumnValueChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_ROW_GROUP_CHANGED,this.onColumnRowGroupChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_PIVOT_CHANGED,this.onColumnPivotChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_HEADER_HEIGHT_CHANGED,this.onHeaderHeightChanged.bind(this))}addMouseDownListenerIfNeeded(e){if(!isBrowserSafari())return;const t=["mousedown","touchstart"],n=this.gridOptionsService.getDocument();t.forEach(o=>{this.addManagedListener(e,o,a=>{const l=n.activeElement;l!==e&&!e.contains(l)&&(e.focus(),FocusService.toggleKeyboardMode(a))})})}setupUserComp(){const e=this.lookupUserCompDetails();this.setCompDetails(e)}setCompDetails(e){this.userCompDetails=e,this.comp.setUserCompDetails(e)}lookupUserCompDetails(){const e=this.createParams(),t=this.column.getColDef();return this.userComponentFactory.getHeaderCompDetails(t,e)}createParams(){const e=this.column.getColDef();return{column:this.column,displayName:this.displayName,enableSorting:e.sortable,enableMenu:this.menuEnabled,showColumnMenu:n=>{this.gridApi.showColumnMenuAfterButtonClick(this.column,n)},progressSort:n=>{this.sortController.progressSort(this.column,!!n,"uiColumnSorted")},setSort:(n,o)=>{this.sortController.setSortForColumn(this.column,n,!!o,"uiColumnSorted")},api:this.gridApi,columnApi:this.columnApi,context:this.gridOptionsService.context,eGridHeader:this.getGui()}}setupSelectAll(){this.selectAllFeature=this.createManagedBean(new SelectAllFeature(this.column)),this.selectAllFeature.setComp(this)}getSelectAllGui(){return this.selectAllFeature.getCheckboxGui()}handleKeyDown(e){super.handleKeyDown(e),e.key===KeyCode.SPACE&&this.selectAllFeature.onSpaceKeyDown(e),e.key===KeyCode.ENTER&&this.onEnterKeyDown(e)}onEnterKeyDown(e){const t=this.comp.getUserCompInstance();if(t){if(e.ctrlKey||e.metaKey)this.menuEnabled&&t.showMenu&&(e.preventDefault(),t.showMenu());else if(this.sortable){const n=e.shiftKey;this.sortController.progressSort(this.column,n,"uiColumnSorted")}}}isMenuEnabled(){return this.menuEnabled}onFocusIn(e){if(!this.getGui().contains(e.relatedTarget)){const t=this.getRowIndex();this.focusService.setFocusedHeader(t,this.column)}this.setActiveHeader(!0)}onFocusOut(e){this.getGui().contains(e.relatedTarget)||this.setActiveHeader(!1)}setupTooltip(){const e={getColumn:()=>this.column,getColDef:()=>this.column.getColDef(),getGui:()=>this.eGui,getLocation:()=>"header",getTooltipValue:()=>this.column.getColDef().headerTooltip},t=this.createManagedBean(new TooltipFeature(e,this.beans));t.setComp(this.comp),this.refreshFunctions.push(()=>t.refreshToolTip())}setupClassesFromColDef(){const e=()=>{const t=this.column.getColDef(),n=CssClassApplier.getHeaderClassesFromColDef(t,this.gridOptionsService,this.column,null),o=this.userHeaderClasses;this.userHeaderClasses=new Set(n),n.forEach(a=>{o.has(a)?o.delete(a):this.comp.addOrRemoveCssClass(a,!0)}),o.forEach(a=>this.comp.addOrRemoveCssClass(a,!1))};this.refreshFunctions.push(e),e()}setDragSource(e){if(this.dragSourceElement=e,this.removeDragSource(),!e||!this.draggable)return;const t=!this.gridOptionsService.is("suppressDragLeaveHidesColumns");this.moveDragSource={type:DragSourceType.HeaderCell,eElement:e,defaultIconName:t?DragAndDropService.ICON_HIDE:DragAndDropService.ICON_NOT_ALLOWED,getDragItem:()=>this.createDragItem(),dragItemName:this.displayName,onDragStarted:()=>this.column.setMoving(!0,"uiColumnMoved"),onDragStopped:()=>this.column.setMoving(!1,"uiColumnMoved"),onGridEnter:n=>{var o;if(t){const a=((o=n==null?void 0:n.columns)===null||o===void 0?void 0:o.filter(l=>!l.getColDef().lockVisible))||[];this.columnModel.setColumnsVisible(a,!0,"uiColumnMoved")}},onGridExit:n=>{var o;if(t){const a=((o=n==null?void 0:n.columns)===null||o===void 0?void 0:o.filter(l=>!l.getColDef().lockVisible))||[];this.columnModel.setColumnsVisible(a,!1,"uiColumnMoved")}}},this.dragAndDropService.addDragSource(this.moveDragSource,!0)}createDragItem(){const e={};return e[this.column.getId()]=this.column.isVisible(),{columns:[this.column],visibleState:e}}removeDragSource(){this.moveDragSource&&(this.dragAndDropService.removeDragSource(this.moveDragSource),this.moveDragSource=void 0)}onColDefChanged(){this.refresh()}updateState(){const e=this.column.getColDef();this.menuEnabled=this.menuFactory.isMenuEnabled(this.column)&&!e.suppressMenu,this.sortable=e.sortable,this.displayName=this.calculateDisplayName(),this.draggable=this.workOutDraggable()}addRefreshFunction(e){this.refreshFunctions.push(e)}refresh(){this.updateState(),this.refreshHeaderComp(),this.refreshAria(),this.refreshFunctions.forEach(e=>e())}refreshHeaderComp(){const e=this.lookupUserCompDetails();(this.comp.getUserCompInstance()!=null&&this.userCompDetails.componentClass==e.componentClass?this.attemptHeaderCompRefresh(e.params):!1)?this.setDragSource(this.dragSourceElement):this.setCompDetails(e)}attemptHeaderCompRefresh(e){const t=this.comp.getUserCompInstance();return!t||!t.refresh?!1:t.refresh(e)}calculateDisplayName(){return this.columnModel.getDisplayNameForColumn(this.column,"header",!0)}checkDisplayName(){this.displayName!==this.calculateDisplayName()&&this.refresh()}workOutDraggable(){const e=this.column.getColDef();return!!(!this.gridOptionsService.is("suppressMovableColumns")&&!e.suppressMovable&&!e.lockPosition)||!!e.enableRowGroup||!!e.enablePivot}onColumnRowGroupChanged(){this.checkDisplayName()}onColumnPivotChanged(){this.checkDisplayName()}onColumnValueChanged(){this.checkDisplayName()}setupWidth(){const e=()=>{const t=this.column.getActualWidth();this.comp.setWidth(`${t}px`)};this.addManagedListener(this.column,Column.EVENT_WIDTH_CHANGED,e),e()}setupMovingCss(){const e=()=>{this.comp.addOrRemoveCssClass("ag-header-cell-moving",this.column.isMoving())};this.addManagedListener(this.column,Column.EVENT_MOVING_CHANGED,e),e()}setupMenuClass(){const e=()=>{this.comp.addOrRemoveCssClass("ag-column-menu-visible",this.column.isMenuVisible())};this.addManagedListener(this.column,Column.EVENT_MENU_VISIBLE_CHANGED,e),e()}setupSortableClass(){const e=()=>{this.comp.addOrRemoveCssClass("ag-header-cell-sortable",!!this.sortable)};e(),this.addRefreshFunction(e),this.addManagedListener(this.eventService,Column.EVENT_SORT_CHANGED,this.refreshAriaSort.bind(this))}setupWrapTextClass(){const e=()=>{const t=!!this.column.getColDef().wrapHeaderText;this.comp.addOrRemoveCssClass("ag-header-cell-wrap-text",t)};e(),this.addRefreshFunction(e)}onHeaderHeightChanged(){this.refreshSpanHeaderHeight()}refreshSpanHeaderHeight(){const{eGui:e,column:t,comp:n,columnModel:o,gridOptionsService:a}=this;if(!t.isSpanHeaderHeight())return;const{numberOfParents:l,isSpanningTotal:s}=this.getColumnGroupPaddingInfo();if(n.addOrRemoveCssClass("ag-header-span-height",l>0),l===0)return;n.addOrRemoveCssClass("ag-header-span-total",s);const y=a.is("pivotMode")?o.getPivotGroupHeaderHeight():o.getGroupHeaderHeight(),D=o.getColumnHeaderRowHeight(),W=l*y;e.style.setProperty("top",`${-W}px`),e.style.setProperty("height",`${D+W}px`)}getColumnGroupPaddingInfo(){let e=this.column.getParent();if(!e||!e.isPadding())return{numberOfParents:0,isSpanningTotal:!1};const t=e.getPaddingLevel()+1;let n=!0;for(;e;){if(!e.isPadding()){n=!1;break}e=e.getParent()}return{numberOfParents:t,isSpanningTotal:n}}setupAutoHeight(e){const t=m=>{if(!this.isAlive())return;const{paddingTop:y,paddingBottom:D,borderBottomWidth:W,borderTopWidth:Ee}=getElementSize(this.getGui()),dt=y+D+W+Ee,ir=e.offsetHeight+dt;if(m<5){const Hr=this.beans.gridOptionsService.getDocument(),Bn=!Hr||!Hr.contains(e),Vn=ir==0;if(Bn||Vn){this.beans.frameworkOverrides.setTimeout(()=>t(m+1),0);return}}this.columnModel.setColumnHeaderHeight(this.column,ir)};let n=!1,o;const a=()=>{const m=this.column.isAutoHeaderHeight();m&&!n&&l(),!m&&n&&s()},l=()=>{n=!0,t(0),this.comp.addOrRemoveCssClass("ag-header-cell-auto-height",!0),o=this.resizeObserverService.observeResize(e,()=>t(0))},s=()=>{n=!1,o&&o(),this.comp.addOrRemoveCssClass("ag-header-cell-auto-height",!1),o=void 0};a(),this.addDestroyFunc(()=>s()),this.addManagedListener(this.column,Column.EVENT_WIDTH_CHANGED,()=>n&&t(0)),this.addManagedListener(this.eventService,Column.EVENT_SORT_CHANGED,()=>{n&&this.beans.frameworkOverrides.setTimeout(()=>t(0))}),this.addRefreshFunction(a)}refreshAriaSort(){if(this.sortable){const e=this.localeService.getLocaleTextFunc(),t=this.sortController.getDisplaySortForColumn(this.column)||null;this.comp.setAriaSort(getAriaSortState(t)),this.setAriaDescriptionProperty("sort",e("ariaSortableColumn","Press ENTER to sort."))}else this.comp.setAriaSort(),this.setAriaDescriptionProperty("sort",null)}refreshAriaMenu(){if(this.menuEnabled){const e=this.localeService.getLocaleTextFunc();this.setAriaDescriptionProperty("menu",e("ariaMenuColumn","Press CTRL ENTER to open column menu."))}else this.setAriaDescriptionProperty("menu",null)}setAriaDescriptionProperty(e,t){t!=null?this.ariaDescriptionProperties.set(e,t):this.ariaDescriptionProperties.delete(e)}refreshAriaDescription(){const e=Array.from(this.ariaDescriptionProperties.values());this.comp.setAriaDescription(e.length?e.join(" "):void 0)}refreshAria(){this.refreshAriaSort(),this.refreshAriaMenu(),this.refreshAriaDescription()}addColumnHoverListener(){const e=()=>{if(!this.gridOptionsService.is("columnHoverHighlight"))return;const t=this.columnHoverService.isHovered(this.column);this.comp.addOrRemoveCssClass("ag-column-hover",t)};this.addManagedListener(this.eventService,Events.EVENT_COLUMN_HOVER_CHANGED,e),e()}setupFilterCss(){const e=()=>{this.comp.addOrRemoveCssClass("ag-header-cell-filtered",this.column.isFilterActive())};this.addManagedListener(this.column,Column.EVENT_FILTER_ACTIVE_CHANGED,e),e()}setupColId(){this.comp.setColId(this.column.getColId())}addActiveHeaderMouseListeners(){const e=t=>this.setActiveHeader(t.type==="mouseenter");this.addManagedListener(this.getGui(),"mouseenter",e),this.addManagedListener(this.getGui(),"mouseleave",e)}setActiveHeader(e){this.comp.addOrRemoveCssClass("ag-header-active",e)}}__decorate$1k([Autowired("columnModel")],HeaderCellCtrl.prototype,"columnModel",void 0);__decorate$1k([Autowired("columnHoverService")],HeaderCellCtrl.prototype,"columnHoverService",void 0);__decorate$1k([Autowired("sortController")],HeaderCellCtrl.prototype,"sortController",void 0);__decorate$1k([Autowired("menuFactory")],HeaderCellCtrl.prototype,"menuFactory",void 0);__decorate$1k([Autowired("dragAndDropService")],HeaderCellCtrl.prototype,"dragAndDropService",void 0);__decorate$1k([Autowired("resizeObserverService")],HeaderCellCtrl.prototype,"resizeObserverService",void 0);__decorate$1k([Autowired("gridApi")],HeaderCellCtrl.prototype,"gridApi",void 0);__decorate$1k([Autowired("columnApi")],HeaderCellCtrl.prototype,"columnApi",void 0);__decorate$1k([PreDestroy],HeaderCellCtrl.prototype,"removeDragSource",null);var __decorate$1j=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class GroupResizeFeature extends BeanStub{constructor(e,t,n,o){super(),this.eResize=t,this.comp=e,this.pinned=n,this.columnGroup=o}postConstruct(){if(!this.columnGroup.isResizable()){this.comp.setResizableDisplayed(!1);return}const e=this.horizontalResizeService.addResizeBar({eResizeBar:this.eResize,onResizeStart:this.onResizeStart.bind(this),onResizing:this.onResizing.bind(this,!1),onResizeEnd:this.onResizing.bind(this,!0)});if(this.addDestroyFunc(e),!this.gridOptionsService.is("suppressAutoSize")){const t=this.gridOptionsService.is("skipHeaderOnAutoSize");this.eResize.addEventListener("dblclick",()=>{const n=[];this.columnGroup.getDisplayedLeafColumns().forEach(a=>{a.getColDef().suppressAutoSize||n.push(a.getColId())}),n.length>0&&this.columnModel.autoSizeColumns({columns:n,skipHeader:t,stopAtGroup:this.columnGroup,source:"uiColumnResized"}),this.resizeLeafColumnsToFit("uiColumnResized")})}}onResizeStart(e){this.calculateInitialValues();let t=null;if(e&&(t=this.columnModel.getDisplayedGroupAfter(this.columnGroup)),t){const n=t.getDisplayedLeafColumns();this.resizeTakeFromCols=n.filter(o=>o.isResizable()),this.resizeTakeFromStartWidth=0,this.resizeTakeFromCols.forEach(o=>this.resizeTakeFromStartWidth+=o.getActualWidth()),this.resizeTakeFromRatios=[],this.resizeTakeFromCols.forEach(o=>this.resizeTakeFromRatios.push(o.getActualWidth()/this.resizeTakeFromStartWidth))}else this.resizeTakeFromCols=null,this.resizeTakeFromStartWidth=null,this.resizeTakeFromRatios=null;this.comp.addOrRemoveCssClass("ag-column-resizing",!0)}onResizing(e,t,n="uiColumnResized"){const o=this.normaliseDragChange(t),a=this.resizeStartWidth+o;this.resizeColumns(a,n,e)}resizeLeafColumnsToFit(e){const t=this.autoWidthCalculator.getPreferredWidthForColumnGroup(this.columnGroup);this.calculateInitialValues(),t>this.resizeStartWidth&&this.resizeColumns(t,e,!0)}resizeColumns(e,t,n=!0){const o=[];if(o.push({columns:this.resizeCols,ratios:this.resizeRatios,width:e}),this.resizeTakeFromCols){const a=e-this.resizeStartWidth;o.push({columns:this.resizeTakeFromCols,ratios:this.resizeTakeFromRatios,width:this.resizeTakeFromStartWidth-a})}this.columnModel.resizeColumnSets({resizeSets:o,finished:n,source:t}),n&&this.comp.addOrRemoveCssClass("ag-column-resizing",!1)}calculateInitialValues(){const e=this.columnGroup.getDisplayedLeafColumns();this.resizeCols=e.filter(t=>t.isResizable()),this.resizeStartWidth=0,this.resizeCols.forEach(t=>this.resizeStartWidth+=t.getActualWidth()),this.resizeRatios=[],this.resizeCols.forEach(t=>this.resizeRatios.push(t.getActualWidth()/this.resizeStartWidth))}normaliseDragChange(e){let t=e;return this.gridOptionsService.is("enableRtl")?this.pinned!=="left"&&(t*=-1):this.pinned==="right"&&(t*=-1),t}}__decorate$1j([Autowired("horizontalResizeService")],GroupResizeFeature.prototype,"horizontalResizeService",void 0);__decorate$1j([Autowired("autoWidthCalculator")],GroupResizeFeature.prototype,"autoWidthCalculator",void 0);__decorate$1j([Autowired("columnModel")],GroupResizeFeature.prototype,"columnModel",void 0);__decorate$1j([PostConstruct],GroupResizeFeature.prototype,"postConstruct",null);var __decorate$1i=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class GroupWidthFeature extends BeanStub{constructor(e,t){super(),this.removeChildListenersFuncs=[],this.columnGroup=t,this.comp=e}postConstruct(){this.addListenersToChildrenColumns(),this.addManagedListener(this.columnGroup,ColumnGroup.EVENT_DISPLAYED_CHILDREN_CHANGED,this.onDisplayedChildrenChanged.bind(this)),this.onWidthChanged(),this.addDestroyFunc(this.removeListenersOnChildrenColumns.bind(this))}addListenersToChildrenColumns(){this.removeListenersOnChildrenColumns();const e=this.onWidthChanged.bind(this);this.columnGroup.getLeafColumns().forEach(t=>{t.addEventListener("widthChanged",e),t.addEventListener("visibleChanged",e),this.removeChildListenersFuncs.push(()=>{t.removeEventListener("widthChanged",e),t.removeEventListener("visibleChanged",e)})})}removeListenersOnChildrenColumns(){this.removeChildListenersFuncs.forEach(e=>e()),this.removeChildListenersFuncs=[]}onDisplayedChildrenChanged(){this.addListenersToChildrenColumns(),this.onWidthChanged()}onWidthChanged(){const e=this.columnGroup.getActualWidth();this.comp.setWidth(`${e}px`),this.comp.addOrRemoveCssClass("ag-hidden",e===0)}}__decorate$1i([PostConstruct],GroupWidthFeature.prototype,"postConstruct",null);var __decorate$1h=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class HeaderGroupCellCtrl extends AbstractHeaderCellCtrl{constructor(e,t){super(e,t),this.columnGroup=e}setComp(e,t,n){super.setGui(t),this.comp=e,this.displayName=this.columnModel.getDisplayNameForColumnGroup(this.columnGroup,"header"),this.addClasses(),this.addAttributes(),this.setupMovingCss(),this.setupExpandable(),this.setupTooltip(),this.setupUserComp();const o=this.getParentRowCtrl().getPinned(),a=this.columnGroup.getProvidedColumnGroup().getLeafColumns();this.createManagedBean(new HoverFeature(a,t)),this.createManagedBean(new SetLeftFeature(this.columnGroup,t,this.beans)),this.createManagedBean(new GroupWidthFeature(e,this.columnGroup)),this.groupResizeFeature=this.createManagedBean(new GroupResizeFeature(e,n,o,this.columnGroup)),this.createManagedBean(new ManagedFocusFeature(t,{shouldStopEventPropagation:this.shouldStopEventPropagation.bind(this),onTabKeyDown:()=>{},handleKeyDown:this.handleKeyDown.bind(this),onFocusIn:this.onFocusIn.bind(this)}))}resizeLeafColumnsToFit(e){this.groupResizeFeature&&this.groupResizeFeature.resizeLeafColumnsToFit(e)}setupUserComp(){let e=this.displayName;const t={displayName:this.displayName,columnGroup:this.columnGroup,setExpanded:o=>{this.columnModel.setColumnGroupOpened(this.columnGroup.getProvidedColumnGroup(),o,"gridInitializing")},api:this.gridApi,columnApi:this.columnApi,context:this.gridOptionsService.context};if(!e){let o=this.columnGroup;const a=o.getLeafColumns();for(;o.getParent()&&o.getParent().getLeafColumns().length===a.length;)o=o.getParent();const l=o.getColGroupDef();l&&(e=l.headerName),e||(e=a?this.columnModel.getDisplayNameForColumn(a[0],"header",!0):"")}const n=this.userComponentFactory.getHeaderGroupCompDetails(t);this.comp.setUserCompDetails(n)}setupTooltip(){const e=this.columnGroup.getColGroupDef(),t={getColumn:()=>this.columnGroup,getGui:()=>this.eGui,getLocation:()=>"headerGroup",getTooltipValue:()=>e&&e.headerTooltip};e&&(t.getColDef=()=>e),this.createManagedBean(new TooltipFeature(t,this.beans)).setComp(this.comp)}setupExpandable(){const e=this.columnGroup.getProvidedColumnGroup();this.refreshExpanded(),this.addManagedListener(e,ProvidedColumnGroup.EVENT_EXPANDABLE_CHANGED,this.refreshExpanded.bind(this)),this.addManagedListener(e,ProvidedColumnGroup.EVENT_EXPANDED_CHANGED,this.refreshExpanded.bind(this))}refreshExpanded(){const e=this.columnGroup;this.expandable=e.isExpandable();const t=e.isExpanded();this.expandable?this.comp.setAriaExpanded(t?"true":"false"):this.comp.setAriaExpanded(void 0)}addAttributes(){this.comp.setColId(this.columnGroup.getUniqueId())}addClasses(){const e=this.columnGroup.getColGroupDef(),t=CssClassApplier.getHeaderClassesFromColDef(e,this.gridOptionsService,null,this.columnGroup);this.columnGroup.isPadding()?(t.push("ag-header-group-cell-no-group"),this.columnGroup.getLeafColumns().every(o=>o.isSpanHeaderHeight())&&t.push("ag-header-span-height")):t.push("ag-header-group-cell-with-group"),t.forEach(n=>this.comp.addOrRemoveCssClass(n,!0))}setupMovingCss(){const t=this.columnGroup.getProvidedColumnGroup().getLeafColumns(),n=()=>this.comp.addOrRemoveCssClass("ag-header-cell-moving",this.columnGroup.isMoving());t.forEach(o=>{this.addManagedListener(o,Column.EVENT_MOVING_CHANGED,n)}),n()}onFocusIn(e){if(!this.eGui.contains(e.relatedTarget)){const t=this.getRowIndex();this.beans.focusService.setFocusedHeader(t,this.columnGroup)}}handleKeyDown(e){super.handleKeyDown(e);const t=this.getWrapperHasFocus();if(!(!this.expandable||!t)&&e.key===KeyCode.ENTER){const n=this.columnGroup,o=!n.isExpanded();this.columnModel.setColumnGroupOpened(n.getProvidedColumnGroup(),o,"uiColumnExpanded")}}setDragSource(e){if(this.isSuppressMoving())return;const t=this.columnGroup.getProvidedColumnGroup().getLeafColumns(),n=!this.gridOptionsService.is("suppressDragLeaveHidesColumns"),o={type:DragSourceType.HeaderCell,eElement:e,defaultIconName:n?DragAndDropService.ICON_HIDE:DragAndDropService.ICON_NOT_ALLOWED,dragItemName:this.displayName,getDragItem:this.getDragItemForGroup.bind(this),onDragStarted:()=>t.forEach(a=>a.setMoving(!0,"uiColumnDragged")),onDragStopped:()=>t.forEach(a=>a.setMoving(!1,"uiColumnDragged")),onGridEnter:a=>{var l;if(n){const s=((l=a==null?void 0:a.columns)===null||l===void 0?void 0:l.filter(m=>!m.getColDef().lockVisible))||[];this.columnModel.setColumnsVisible(s,!0,"uiColumnMoved")}},onGridExit:a=>{var l;if(n){const s=((l=a==null?void 0:a.columns)===null||l===void 0?void 0:l.filter(m=>!m.getColDef().lockVisible))||[];this.columnModel.setColumnsVisible(s,!1,"uiColumnMoved")}}};this.dragAndDropService.addDragSource(o,!0),this.addDestroyFunc(()=>this.dragAndDropService.removeDragSource(o))}getDragItemForGroup(){const e=this.columnGroup.getProvidedColumnGroup().getLeafColumns(),t={};e.forEach(o=>t[o.getId()]=o.isVisible());const n=[];return this.columnModel.getAllDisplayedColumns().forEach(o=>{e.indexOf(o)>=0&&(n.push(o),removeFromArray(e,o))}),e.forEach(o=>n.push(o)),{columns:n,visibleState:t}}isSuppressMoving(){let e=!1;return this.columnGroup.getLeafColumns().forEach(n=>{(n.getColDef().suppressMovable||n.getColDef().lockPosition)&&(e=!0)}),e||this.gridOptionsService.is("suppressMovableColumns")}}__decorate$1h([Autowired("columnModel")],HeaderGroupCellCtrl.prototype,"columnModel",void 0);__decorate$1h([Autowired("dragAndDropService")],HeaderGroupCellCtrl.prototype,"dragAndDropService",void 0);__decorate$1h([Autowired("gridApi")],HeaderGroupCellCtrl.prototype,"gridApi",void 0);__decorate$1h([Autowired("columnApi")],HeaderGroupCellCtrl.prototype,"columnApi",void 0);var __decorate$1g=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let instanceIdSequence=0;class HeaderRowCtrl extends BeanStub{constructor(e,t,n){super(),this.instanceId=instanceIdSequence++,this.headerCellCtrls={},this.rowIndex=e,this.pinned=t,this.type=n}getInstanceId(){return this.instanceId}setComp(e){this.comp=e,this.onRowHeightChanged(),this.onVirtualColumnsChanged(),this.setWidth(),this.addEventListeners(),isBrowserSafari()&&this.comp.setTransform("translateZ(0)"),e.setAriaRowIndex(this.rowIndex+1)}addEventListeners(){this.addManagedListener(this.eventService,Events.EVENT_COLUMN_RESIZED,this.onColumnResized.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,this.onDisplayedColumnsChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_VIRTUAL_COLUMNS_CHANGED,this.onVirtualColumnsChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_HEADER_HEIGHT_CHANGED,this.onRowHeightChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_GRID_STYLES_CHANGED,this.onRowHeightChanged.bind(this)),this.addManagedPropertyListener("domLayout",this.onDisplayedColumnsChanged.bind(this)),this.addManagedPropertyListener("headerHeight",this.onRowHeightChanged.bind(this)),this.addManagedPropertyListener("pivotHeaderHeight",this.onRowHeightChanged.bind(this)),this.addManagedPropertyListener("groupHeaderHeight",this.onRowHeightChanged.bind(this)),this.addManagedPropertyListener("pivotGroupHeaderHeight",this.onRowHeightChanged.bind(this)),this.addManagedPropertyListener("floatingFiltersHeight",this.onRowHeightChanged.bind(this))}getHeaderCellCtrl(e){return values(this.headerCellCtrls).find(t=>t.getColumnGroupChild()===e)}onDisplayedColumnsChanged(){this.onVirtualColumnsChanged(),this.setWidth(),this.onRowHeightChanged()}getType(){return this.type}onColumnResized(){this.setWidth()}setWidth(){const e=this.getWidthForRow();this.comp.setWidth(`${e}px`)}getWidthForRow(){return this.gridOptionsService.isDomLayout("print")?this.pinned!=null?0:this.columnModel.getContainerWidth("right")+this.columnModel.getContainerWidth("left")+this.columnModel.getContainerWidth(null):this.columnModel.getContainerWidth(this.pinned)}onRowHeightChanged(){let e=this.columnModel.getHeaderRowCount();const t=[];let n=0;this.columnModel.hasFloatingFilters()&&(e++,n=1);const o=this.columnModel.getColumnGroupHeaderRowHeight(),a=this.columnModel.getColumnHeaderRowHeight(),l=1+n,s=e-l;for(let D=0;D<s;D++)t.push(o);t.push(a);for(let D=0;D<n;D++)t.push(this.columnModel.getFloatingFiltersHeight());let m=0;for(let D=0;D<this.rowIndex;D++)m+=t[D];const y=t[this.rowIndex]+"px";this.comp.setTop(m+"px"),this.comp.setHeight(y)}getPinned(){return this.pinned}getRowIndex(){return this.rowIndex}onVirtualColumnsChanged(){const e=this.headerCellCtrls;this.headerCellCtrls={},this.getColumnsInViewport().forEach(a=>{if(a.isEmptyGroup())return;const l=a.getUniqueId();let s=e[l];if(delete e[l],s&&s.getColumnGroupChild()!=a&&(this.destroyBean(s),s=void 0),s==null)switch(this.type){case HeaderRowType.FLOATING_FILTER:s=this.createBean(new HeaderFilterCellCtrl(a,this));break;case HeaderRowType.COLUMN_GROUP:s=this.createBean(new HeaderGroupCellCtrl(a,this));break;default:s=this.createBean(new HeaderCellCtrl(a,this));break}this.headerCellCtrls[l]=s});const n=a=>this.focusService.isHeaderWrapperFocused(a)?this.columnModel.isDisplayed(a.getColumnGroupChild()):!1;iterateObject(e,(a,l)=>{n(l)?this.headerCellCtrls[a]=l:this.destroyBean(l)});const o=getAllValuesInObject(this.headerCellCtrls);this.comp.setHeaderCtrls(o)}getColumnsInViewport(){return this.gridOptionsService.isDomLayout("print")?this.getColumnsInViewportPrintLayout():this.getColumnsInViewportNormalLayout()}getColumnsInViewportPrintLayout(){if(this.pinned!=null)return[];let e=[];const t=this.getActualDepth();return["left",null,"right"].forEach(n=>{const o=this.columnModel.getVirtualHeaderGroupRow(n,t);e=e.concat(o)}),e}getActualDepth(){return this.type==HeaderRowType.FLOATING_FILTER?this.rowIndex-1:this.rowIndex}getColumnsInViewportNormalLayout(){return this.columnModel.getVirtualHeaderGroupRow(this.pinned,this.getActualDepth())}focusHeader(e,t){const o=getAllValuesInObject(this.headerCellCtrls).find(a=>a.getColumnGroupChild()==e);return o?(o.focus(t),!0):!1}destroy(){iterateObject(this.headerCellCtrls,(e,t)=>{this.destroyBean(t)}),this.headerCellCtrls={},super.destroy()}}__decorate$1g([Autowired("columnModel")],HeaderRowCtrl.prototype,"columnModel",void 0);__decorate$1g([Autowired("focusService")],HeaderRowCtrl.prototype,"focusService",void 0);var __decorate$1f=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class HeaderRowContainerCtrl extends BeanStub{constructor(e){super(),this.hidden=!1,this.includeFloatingFilter=!1,this.groupsRowCtrls=[],this.pinned=e}setComp(e,t){this.comp=e,this.eViewport=t,this.setupCenterWidth(),this.setupPinnedWidth(),this.setupDragAndDrop(this.eViewport),this.addManagedListener(this.eventService,Events.EVENT_GRID_COLUMNS_CHANGED,this.onGridColumnsChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,this.onDisplayedColumnsChanged.bind(this)),this.ctrlsService.registerHeaderContainer(this,this.pinned),this.columnModel.isReady()&&this.refresh()}setupDragAndDrop(e){const t=new BodyDropTarget(this.pinned,e);this.createManagedBean(t)}refresh(e=!1){const t=new NumberSequence,n=this.focusService.getFocusHeaderToUseAfterRefresh(),o=()=>{const m=this.columnModel.getHeaderRowCount()-1;this.groupsRowCtrls=this.destroyBeans(this.groupsRowCtrls);for(let y=0;y<m;y++){const D=this.createBean(new HeaderRowCtrl(t.next(),this.pinned,HeaderRowType.COLUMN_GROUP));this.groupsRowCtrls.push(D)}},a=()=>{const m=t.next(),y=!this.hidden&&(this.columnsRowCtrl==null||!e||this.columnsRowCtrl.getRowIndex()!==m);(y||this.hidden)&&(this.columnsRowCtrl=this.destroyBean(this.columnsRowCtrl)),y&&(this.columnsRowCtrl=this.createBean(new HeaderRowCtrl(m,this.pinned,HeaderRowType.COLUMN)))},l=()=>{this.includeFloatingFilter=this.columnModel.hasFloatingFilters()&&!this.hidden;const m=()=>{this.filtersRowCtrl=this.destroyBean(this.filtersRowCtrl)};if(!this.includeFloatingFilter){m();return}const y=t.next();if(this.filtersRowCtrl){const D=this.filtersRowCtrl.getRowIndex()!==y;(!e||D)&&m()}this.filtersRowCtrl||(this.filtersRowCtrl=this.createBean(new HeaderRowCtrl(y,this.pinned,HeaderRowType.FLOATING_FILTER)))};o(),a(),l();const s=this.getAllCtrls();this.comp.setCtrls(s),this.restoreFocusOnHeader(n)}restoreFocusOnHeader(e){e==null||e.column.getPinned()!=this.pinned||this.focusService.focusHeaderPosition({headerPosition:e})}getAllCtrls(){const e=[...this.groupsRowCtrls];return this.columnsRowCtrl&&e.push(this.columnsRowCtrl),this.filtersRowCtrl&&e.push(this.filtersRowCtrl),e}onGridColumnsChanged(){this.refresh(!0)}onDisplayedColumnsChanged(){const e=this.columnModel.hasFloatingFilters()&&!this.hidden;this.includeFloatingFilter!==e&&this.refresh(!0)}setupCenterWidth(){this.pinned==null&&this.createManagedBean(new CenterWidthFeature(e=>this.comp.setCenterWidth(`${e}px`),!0))}setHorizontalScroll(e){this.comp.setViewportScrollLeft(e)}setupPinnedWidth(){if(this.pinned==null)return;const e=this.pinned==="left",t=this.pinned==="right";this.hidden=!0;const n=()=>{const o=e?this.pinnedWidthService.getPinnedLeftWidth():this.pinnedWidthService.getPinnedRightWidth();if(o==null)return;const a=o==0,l=this.hidden!==a,s=this.gridOptionsService.is("enableRtl"),m=this.gridOptionsService.getScrollbarWidth(),D=this.scrollVisibleService.isVerticalScrollShowing()&&(s&&e||!s&&t)?o+m:o;this.comp.setPinnedContainerWidth(`${D}px`),this.comp.setDisplayed(!a),l&&(this.hidden=a,this.refresh())};this.addManagedListener(this.eventService,Events.EVENT_LEFT_PINNED_WIDTH_CHANGED,n),this.addManagedListener(this.eventService,Events.EVENT_RIGHT_PINNED_WIDTH_CHANGED,n),this.addManagedListener(this.eventService,Events.EVENT_SCROLL_VISIBILITY_CHANGED,n),this.addManagedListener(this.eventService,Events.EVENT_SCROLLBAR_WIDTH_CHANGED,n)}getHeaderCtrlForColumn(e){if(e instanceof Column)return this.columnsRowCtrl?this.columnsRowCtrl.getHeaderCellCtrl(e):void 0;if(this.groupsRowCtrls.length!==0)for(let t=0;t<this.groupsRowCtrls.length;t++){const n=this.groupsRowCtrls[t].getHeaderCellCtrl(e);if(n)return n}}getHtmlElementForColumnHeader(e){const t=this.getHeaderCtrlForColumn(e);return t?t.getGui():null}getRowType(e){const n=this.getAllCtrls()[e];return n?n.getType():void 0}focusHeader(e,t,n){const a=this.getAllCtrls()[e];return a?a.focusHeader(t,n):!1}getRowCount(){return this.groupsRowCtrls.length+(this.columnsRowCtrl?1:0)+(this.filtersRowCtrl?1:0)}destroy(){this.filtersRowCtrl&&(this.filtersRowCtrl=this.destroyBean(this.filtersRowCtrl)),this.columnsRowCtrl&&(this.columnsRowCtrl=this.destroyBean(this.columnsRowCtrl)),this.groupsRowCtrls&&this.groupsRowCtrls.length&&(this.groupsRowCtrls=this.destroyBeans(this.groupsRowCtrls)),super.destroy()}}__decorate$1f([Autowired("ctrlsService")],HeaderRowContainerCtrl.prototype,"ctrlsService",void 0);__decorate$1f([Autowired("scrollVisibleService")],HeaderRowContainerCtrl.prototype,"scrollVisibleService",void 0);__decorate$1f([Autowired("pinnedWidthService")],HeaderRowContainerCtrl.prototype,"pinnedWidthService",void 0);__decorate$1f([Autowired("columnModel")],HeaderRowContainerCtrl.prototype,"columnModel",void 0);__decorate$1f([Autowired("focusService")],HeaderRowContainerCtrl.prototype,"focusService",void 0);var __decorate$1e=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class HeaderRowContainerComp extends Component{constructor(e){super(),this.headerRowComps={},this.rowCompsList=[],this.pinned=e}init(){this.selectAndSetTemplate();const e={setDisplayed:n=>this.setDisplayed(n),setCtrls:n=>this.setCtrls(n),setCenterWidth:n=>this.eCenterContainer.style.width=n,setViewportScrollLeft:n=>this.getGui().scrollLeft=n,setPinnedContainerWidth:n=>{const o=this.getGui();o.style.width=n,o.style.maxWidth=n,o.style.minWidth=n}};this.createManagedBean(new HeaderRowContainerCtrl(this.pinned)).setComp(e,this.getGui())}selectAndSetTemplate(){const e=this.pinned=="left",t=this.pinned=="right",n=e?HeaderRowContainerComp.PINNED_LEFT_TEMPLATE:t?HeaderRowContainerComp.PINNED_RIGHT_TEMPLATE:HeaderRowContainerComp.CENTER_TEMPLATE;this.setTemplate(n),this.eRowContainer=this.eCenterContainer?this.eCenterContainer:this.getGui()}destroyRowComps(){this.setCtrls([])}destroyRowComp(e){this.destroyBean(e),this.eRowContainer.removeChild(e.getGui())}setCtrls(e){const t=this.headerRowComps;this.headerRowComps={},this.rowCompsList=[];let n;const o=a=>{const l=a.getGui();l.parentElement!=this.eRowContainer&&this.eRowContainer.appendChild(l),n&&ensureDomOrder(this.eRowContainer,l,n),n=l};e.forEach(a=>{const l=a.getInstanceId(),s=t[l];delete t[l];const m=s||this.createBean(new HeaderRowComp(a));this.headerRowComps[l]=m,this.rowCompsList.push(m),o(m)}),getAllValuesInObject(t).forEach(a=>this.destroyRowComp(a))}}HeaderRowContainerComp.PINNED_LEFT_TEMPLATE='<div class="ag-pinned-left-header" role="presentation"></div>';HeaderRowContainerComp.PINNED_RIGHT_TEMPLATE='<div class="ag-pinned-right-header" role="presentation"></div>';HeaderRowContainerComp.CENTER_TEMPLATE=`<div class="ag-header-viewport" role="presentation">
            <div class="ag-header-container" ref="eCenterContainer" role="rowgroup"></div>
        </div>`;__decorate$1e([RefSelector("eCenterContainer")],HeaderRowContainerComp.prototype,"eCenterContainer",void 0);__decorate$1e([PostConstruct],HeaderRowContainerComp.prototype,"init",null);__decorate$1e([PreDestroy],HeaderRowContainerComp.prototype,"destroyRowComps",null);var __decorate$1d=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},HeaderNavigationDirection;(function(r){r[r.UP=0]="UP",r[r.DOWN=1]="DOWN",r[r.LEFT=2]="LEFT",r[r.RIGHT=3]="RIGHT"})(HeaderNavigationDirection||(HeaderNavigationDirection={}));let HeaderNavigationService=class extends BeanStub{postConstruct(){this.ctrlsService.whenReady(e=>{this.gridBodyCon=e.gridBodyCtrl})}getHeaderRowCount(){const e=this.ctrlsService.getHeaderRowContainerCtrl();return e?e.getRowCount():0}navigateVertically(e,t,n){if(t||(t=this.focusService.getFocusedHeader()),!t)return!1;const{headerRowIndex:o,column:a}=t,l=this.getHeaderRowCount(),s=e===HeaderNavigationDirection.UP;let{nextRow:m,nextFocusColumn:y}=s?this.headerPositionUtils.getColumnVisibleParent(a,o):this.headerPositionUtils.getColumnVisibleChild(a,o),D=!1;return m<0&&(m=0,y=a,D=!0),m>=l&&(m=-1),!D&&!y?!1:this.focusService.focusHeaderPosition({headerPosition:{headerRowIndex:m,column:y},allowUserOverride:!0,event:n})}navigateHorizontally(e,t=!1,n){const o=this.focusService.getFocusedHeader(),a=e===HeaderNavigationDirection.LEFT,l=this.gridOptionsService.is("enableRtl");let s,m;return a!==l?(m="Before",s=this.headerPositionUtils.findHeader(o,m)):(m="After",s=this.headerPositionUtils.findHeader(o,m)),s||!t?this.focusService.focusHeaderPosition({headerPosition:s,direction:m,fromTab:t,allowUserOverride:!0,event:n}):this.focusNextHeaderRow(o,m,n)}focusNextHeaderRow(e,t,n){const o=e.headerRowIndex;let a=null,l;return t==="Before"?o>0&&(l=o-1,a=this.headerPositionUtils.findColAtEdgeForHeaderRow(l,"end")):(l=o+1,a=this.headerPositionUtils.findColAtEdgeForHeaderRow(l,"start")),this.focusService.focusHeaderPosition({headerPosition:a,direction:t,fromTab:!0,allowUserOverride:!0,event:n})}scrollToColumn(e,t="After"){if(e.getPinned())return;let n;if(e instanceof ColumnGroup){const o=e.getDisplayedLeafColumns();n=t==="Before"?last(o):o[0]}else n=e;this.gridBodyCon.getScrollFeature().ensureColumnVisible(n)}};__decorate$1d([Autowired("focusService")],HeaderNavigationService.prototype,"focusService",void 0);__decorate$1d([Autowired("headerPositionUtils")],HeaderNavigationService.prototype,"headerPositionUtils",void 0);__decorate$1d([Autowired("ctrlsService")],HeaderNavigationService.prototype,"ctrlsService",void 0);__decorate$1d([PostConstruct],HeaderNavigationService.prototype,"postConstruct",null);HeaderNavigationService=__decorate$1d([Bean("headerNavigationService")],HeaderNavigationService);var __decorate$1c=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class GridHeaderCtrl extends BeanStub{setComp(e,t,n){this.comp=e,this.eGui=t,this.createManagedBean(new ManagedFocusFeature(n,{onTabKeyDown:this.onTabKeyDown.bind(this),handleKeyDown:this.handleKeyDown.bind(this),onFocusOut:this.onFocusOut.bind(this)})),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_PIVOT_MODE_CHANGED,this.onPivotModeChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,this.onDisplayedColumnsChanged.bind(this)),this.onPivotModeChanged(),this.setupHeaderHeight(),this.ctrlsService.registerGridHeaderCtrl(this)}setupHeaderHeight(){const e=this.setHeaderHeight.bind(this);e(),this.addManagedPropertyListener("headerHeight",e),this.addManagedPropertyListener("pivotHeaderHeight",e),this.addManagedPropertyListener("groupHeaderHeight",e),this.addManagedPropertyListener("pivotGroupHeaderHeight",e),this.addManagedPropertyListener("floatingFiltersHeight",e),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,e),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_HEADER_HEIGHT_CHANGED,e),this.addManagedListener(this.eventService,Events.EVENT_GRID_STYLES_CHANGED,e)}getHeaderHeight(){return this.headerHeight}setHeaderHeight(){const{columnModel:e}=this;let t=0,n=e.getHeaderRowCount(),o;e.hasFloatingFilters()&&(n++,t=1);const l=this.columnModel.getColumnGroupHeaderRowHeight(),s=this.columnModel.getColumnHeaderRowHeight(),m=1+t,y=n-m;if(o=t*e.getFloatingFiltersHeight(),o+=y*l,o+=s,this.headerHeight===o)return;this.headerHeight=o;const D=`${o+1}px`;this.comp.setHeightAndMinHeight(D),this.eventService.dispatchEvent({type:Events.EVENT_HEADER_HEIGHT_CHANGED})}onPivotModeChanged(){const e=this.columnModel.isPivotMode();this.comp.addOrRemoveCssClass("ag-pivot-on",e),this.comp.addOrRemoveCssClass("ag-pivot-off",!e)}onDisplayedColumnsChanged(){const t=this.columnModel.getAllDisplayedColumns().some(n=>n.isSpanHeaderHeight());this.comp.addOrRemoveCssClass("ag-header-allow-overflow",t)}onTabKeyDown(e){const t=this.gridOptionsService.is("enableRtl"),n=e.shiftKey!==t?HeaderNavigationDirection.LEFT:HeaderNavigationDirection.RIGHT;(this.headerNavigationService.navigateHorizontally(n,!0,e)||this.focusService.focusNextGridCoreContainer(e.shiftKey))&&e.preventDefault()}handleKeyDown(e){let t=null;switch(e.key){case KeyCode.LEFT:t=HeaderNavigationDirection.LEFT;case KeyCode.RIGHT:exists(t)||(t=HeaderNavigationDirection.RIGHT),this.headerNavigationService.navigateHorizontally(t,!1,e);break;case KeyCode.UP:t=HeaderNavigationDirection.UP;case KeyCode.DOWN:exists(t)||(t=HeaderNavigationDirection.DOWN),this.headerNavigationService.navigateVertically(t,null,e)&&e.preventDefault();break;default:return}}onFocusOut(e){const t=this.gridOptionsService.getDocument(),{relatedTarget:n}=e;!n&&this.eGui.contains(t.activeElement)||this.eGui.contains(n)||this.focusService.clearFocusedHeader()}}__decorate$1c([Autowired("headerNavigationService")],GridHeaderCtrl.prototype,"headerNavigationService",void 0);__decorate$1c([Autowired("focusService")],GridHeaderCtrl.prototype,"focusService",void 0);__decorate$1c([Autowired("columnModel")],GridHeaderCtrl.prototype,"columnModel",void 0);__decorate$1c([Autowired("ctrlsService")],GridHeaderCtrl.prototype,"ctrlsService",void 0);var __decorate$1b=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class GridHeaderComp extends Component{constructor(){super(GridHeaderComp.TEMPLATE)}postConstruct(){const e={addOrRemoveCssClass:(o,a)=>this.addOrRemoveCssClass(o,a),setHeightAndMinHeight:o=>{this.getGui().style.height=o,this.getGui().style.minHeight=o}};this.createManagedBean(new GridHeaderCtrl).setComp(e,this.getGui(),this.getFocusableElement());const n=o=>{this.createManagedBean(o),this.appendChild(o)};n(new HeaderRowContainerComp("left")),n(new HeaderRowContainerComp(null)),n(new HeaderRowContainerComp("right"))}}GridHeaderComp.TEMPLATE='<div class="ag-header" role="presentation"/>';__decorate$1b([PostConstruct],GridHeaderComp.prototype,"postConstruct",null);var __decorate$1a=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let HorizontalResizeService=class extends BeanStub{addResizeBar(e){const t={dragStartPixels:e.dragStartPixels||0,eElement:e.eResizeBar,onDragStart:this.onDragStart.bind(this,e),onDragStop:this.onDragStop.bind(this,e),onDragging:this.onDragging.bind(this,e),includeTouch:!0,stopPropagationForTouch:!0};return this.dragService.addDragSource(t),()=>this.dragService.removeDragSource(t)}onDragStart(e,t){this.dragStartX=t.clientX,this.setResizeIcons();const n=t instanceof MouseEvent&&t.shiftKey===!0;e.onResizeStart(n)}setResizeIcons(){const e=this.ctrlsService.getGridCtrl();e.setResizeCursor(!0),e.disableUserSelect(!0)}onDragStop(e,t){e.onResizeEnd(this.resizeAmount),this.resetIcons()}resetIcons(){const e=this.ctrlsService.getGridCtrl();e.setResizeCursor(!1),e.disableUserSelect(!1)}onDragging(e,t){this.resizeAmount=t.clientX-this.dragStartX,e.onResizing(this.resizeAmount)}};__decorate$1a([Autowired("dragService")],HorizontalResizeService.prototype,"dragService",void 0);__decorate$1a([Autowired("ctrlsService")],HorizontalResizeService.prototype,"ctrlsService",void 0);HorizontalResizeService=__decorate$1a([Bean("horizontalResizeService")],HorizontalResizeService);var __decorate$19=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let StandardMenuFactory=class extends BeanStub{hideActiveMenu(){this.hidePopup&&this.hidePopup()}showMenuAfterMouseEvent(e,t){this.showPopup(e,n=>{this.popupService.positionPopupUnderMouseEvent({column:e,type:"columnMenu",mouseEvent:t,ePopup:n})},"columnMenu",t.target)}showMenuAfterButtonClick(e,t,n){this.showPopup(e,o=>{this.popupService.positionPopupByComponent({type:n,eventSource:t,ePopup:o,keepWithinBounds:!0,position:"under",column:e})},n,t)}showPopup(e,t,n,o){const a=this.filterManager.getOrCreateFilterWrapper(e,"COLUMN_MENU");if(!a)throw new Error("AG Grid - unable to show popup filter, filter instantiation failed");const l=document.createElement("div");setAriaRole(l,"presentation"),l.classList.add("ag-menu"),this.tabListener=this.addManagedListener(l,"keydown",dt=>this.trapFocusWithin(dt,l)),a.guiPromise.then(dt=>l.appendChild(dt));let s;const m=()=>{var dt;return(dt=a.filterPromise)===null||dt===void 0?void 0:dt.then(Ht=>{var ir;return(ir=Ht==null?void 0:Ht.afterGuiDetached)===null||ir===void 0?void 0:ir.call(Ht)})},y=o||this.ctrlsService.getGridBodyCtrl().getGui(),D=dt=>{e.setMenuVisible(!1,"contextMenu");const Ht=dt instanceof KeyboardEvent;if(this.tabListener&&(this.tabListener=this.tabListener()),Ht&&o&&isVisible(o)){const ir=this.focusService.findTabbableParent(o);ir&&ir.focus()}m()},W=this.localeService.getLocaleTextFunc(),Ee=this.popupService.addPopup({modal:!0,eChild:l,closeOnEsc:!0,closedCallback:D,positionCallback:()=>t(l),anchorToElement:y,ariaLabel:W("ariaLabelColumnMenu","Column Menu")});Ee&&(this.hidePopup=s=Ee.hideFunc),a.filterPromise.then(dt=>{t(l),dt.afterGuiAttached&&dt.afterGuiAttached({container:n,hidePopup:s})}),e.setMenuVisible(!0,"contextMenu")}trapFocusWithin(e,t){e.key!==KeyCode.TAB||e.defaultPrevented||this.focusService.findNextFocusableElement(t,!1,e.shiftKey)||(e.preventDefault(),this.focusService.focusInto(t,e.shiftKey))}isMenuEnabled(e){return e.isFilterAllowed()&&e.getMenuTabs(["filterMenuTab"]).includes("filterMenuTab")}};__decorate$19([Autowired("filterManager")],StandardMenuFactory.prototype,"filterManager",void 0);__decorate$19([Autowired("popupService")],StandardMenuFactory.prototype,"popupService",void 0);__decorate$19([Autowired("focusService")],StandardMenuFactory.prototype,"focusService",void 0);__decorate$19([Autowired("ctrlsService")],StandardMenuFactory.prototype,"ctrlsService",void 0);StandardMenuFactory=__decorate$19([Bean("menuFactory")],StandardMenuFactory);var __decorate$18=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class TabbedLayout extends Component{constructor(e){super(TabbedLayout.getTemplate(e.cssClass)),this.items=[],this.tabbedItemScrollMap=new Map,this.params=e,e.items&&e.items.forEach(t=>this.addItem(t))}postConstruct(){this.createManagedBean(new ManagedFocusFeature(this.getFocusableElement(),{onTabKeyDown:this.onTabKeyDown.bind(this),handleKeyDown:this.handleKeyDown.bind(this)})),this.addDestroyFunc(()=>{var e,t,n;return(n=(t=(e=this.activeItem)===null||e===void 0?void 0:e.tabbedItem)===null||t===void 0?void 0:t.afterDetachedCallback)===null||n===void 0?void 0:n.call(t)})}static getTemplate(e){return`<div class="ag-tabs ${e}">
            <div ref="eHeader" role="tablist" class="ag-tabs-header ${e?`${e}-header`:""}"></div>
            <div ref="eBody" role="presentation" class="ag-tabs-body ${e?`${e}-body`:""}"></div>
        </div>`}handleKeyDown(e){const t=this.gridOptionsService.getDocument();switch(e.key){case KeyCode.RIGHT:case KeyCode.LEFT:if(!this.eHeader.contains(t.activeElement))return;const n=e.key===KeyCode.RIGHT,o=this.gridOptionsService.is("enableRtl"),a=this.items.indexOf(this.activeItem),l=n!==o?Math.min(a+1,this.items.length-1):Math.max(a-1,0);if(a===l)return;e.preventDefault();const s=this.items[l];this.showItemWrapper(s),s.eHeaderButton.focus();break;case KeyCode.UP:case KeyCode.DOWN:e.stopPropagation();break}}onTabKeyDown(e){if(e.defaultPrevented)return;const{focusService:t,eHeader:n,eBody:o,activeItem:a}=this,s=this.gridOptionsService.getDocument().activeElement,m=e.target;if(e.preventDefault(),n.contains(s)){t.focusInto(o,e.shiftKey);return}let y=null;t.isTargetUnderManagedComponent(o,m)&&(e.shiftKey&&(y=this.focusService.findFocusableElementBeforeTabGuard(o,m)),y||(y=a.eHeaderButton)),!y&&o.contains(s)&&(y=t.findNextFocusableElement(o,!1,e.shiftKey),y||(y=a.eHeaderButton)),y&&y.focus()}setAfterAttachedParams(e){this.afterAttachedParams=e}showFirstItem(){this.items.length>0&&this.showItemWrapper(this.items[0])}addItem(e){const t=document.createElement("span");setAriaRole(t,"tab"),t.setAttribute("tabindex","-1"),t.appendChild(e.title),t.classList.add("ag-tab"),this.eHeader.appendChild(t),setAriaLabel(t,e.titleLabel);const n={tabbedItem:e,eHeaderButton:t};this.items.push(n),t.addEventListener("click",this.showItemWrapper.bind(this,n))}showItem(e){const t=this.items.find(n=>n.tabbedItem===e);t&&this.showItemWrapper(t)}showItemWrapper(e){var t,n;const{tabbedItem:o,eHeaderButton:a}=e;if(this.params.onItemClicked&&this.params.onItemClicked({item:o}),this.activeItem===e){callIfPresent(this.params.onActiveItemClicked);return}this.lastScrollListener&&(this.lastScrollListener=this.lastScrollListener()),clearElement(this.eBody),o.bodyPromise.then(l=>{this.eBody.appendChild(l);const s=!this.focusService.isKeyboardMode();if(this.focusService.focusInto(this.eBody,!1,s),o.afterAttachedCallback&&o.afterAttachedCallback(this.afterAttachedParams),this.params.keepScrollPosition){const m=o.getScrollableContainer&&o.getScrollableContainer()||l;this.lastScrollListener=this.addManagedListener(m,"scroll",()=>{this.tabbedItemScrollMap.set(o.name,m.scrollTop)});const y=this.tabbedItemScrollMap.get(o.name);y!==void 0&&setTimeout(()=>{m.scrollTop=y},0)}}),this.activeItem&&(this.activeItem.eHeaderButton.classList.remove("ag-tab-selected"),(n=(t=this.activeItem.tabbedItem).afterDetachedCallback)===null||n===void 0||n.call(t)),a.classList.add("ag-tab-selected"),this.activeItem=e}}__decorate$18([Autowired("focusService")],TabbedLayout.prototype,"focusService",void 0);__decorate$18([RefSelector("eHeader")],TabbedLayout.prototype,"eHeader",void 0);__decorate$18([RefSelector("eBody")],TabbedLayout.prototype,"eBody",void 0);__decorate$18([PostConstruct],TabbedLayout.prototype,"postConstruct",null);var __decorate$17=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const DEBOUNCE_DELAY=50;let ResizeObserverService=class extends BeanStub{constructor(){super(...arguments),this.polyfillFunctions=[]}observeResize(e,t){const n=this.gridOptionsService.getWindow(),o=()=>{const m=new n.ResizeObserver(t);return m.observe(e),()=>m.disconnect()},a=()=>{let m=offsetWidth(e),y=offsetHeight(e),D=!0;const W=()=>{if(D){const Ee=offsetWidth(e),dt=offsetHeight(e);(Ee!==m||dt!==y)&&(m=Ee,y=dt,t()),this.doNextPolyfillTurn(W)}};return W(),()=>D=!1},l=this.gridOptionsService.is("suppressBrowserResizeObserver");return!!n.ResizeObserver&&!l?o():a()}doNextPolyfillTurn(e){this.polyfillFunctions.push(e),this.schedulePolyfill()}schedulePolyfill(){if(this.polyfillScheduled)return;const e=()=>{const t=this.polyfillFunctions;this.polyfillScheduled=!1,this.polyfillFunctions=[],t.forEach(n=>n())};this.polyfillScheduled=!0,this.getFrameworkOverrides().setTimeout(e,DEBOUNCE_DELAY)}};ResizeObserverService=__decorate$17([Bean("resizeObserverService")],ResizeObserverService);var __decorate$16=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let AnimationFrameService=class extends BeanStub{constructor(){super(...arguments),this.createTasksP1={list:[],sorted:!1},this.createTasksP2={list:[],sorted:!1},this.destroyTasks=[],this.ticking=!1,this.scrollGoingDown=!0,this.lastPage=0,this.lastScrollTop=0,this.taskCount=0,this.cancelledTasks=new Set}setScrollTop(e){const t=this.gridOptionsService.is("pagination");if(this.scrollGoingDown=e>=this.lastScrollTop,t&&e===0){const n=this.paginationProxy.getCurrentPage();n!==this.lastPage&&(this.lastPage=n,this.scrollGoingDown=!0)}this.lastScrollTop=e}init(){this.useAnimationFrame=!this.gridOptionsService.is("suppressAnimationFrame")}isOn(){return this.useAnimationFrame}verifyAnimationFrameOn(e){this.useAnimationFrame===!1&&console.warn(`AG Grid: AnimationFrameService.${e} called but animation frames are off`)}createTask(e,t,n){this.verifyAnimationFrameOn(n);const o={task:e,index:t,createOrder:++this.taskCount};this.addTaskToList(this[n],o),this.schedule()}cancelTask(e){this.cancelledTasks.add(e)}addTaskToList(e,t){e.list.push(t),e.sorted=!1}sortTaskList(e){if(e.sorted)return;const t=this.scrollGoingDown?1:-1;e.list.sort((n,o)=>n.index!==o.index?t*(o.index-n.index):o.createOrder-n.createOrder),e.sorted=!0}addDestroyTask(e){this.verifyAnimationFrameOn("createTasksP3"),this.destroyTasks.push(e),this.schedule()}executeFrame(e){this.verifyAnimationFrameOn("executeFrame");const t=this.createTasksP1,n=t.list,o=this.createTasksP2,a=o.list,l=this.destroyTasks,s=new Date().getTime();let m=new Date().getTime()-s;const y=e<=0,D=this.ctrlsService.getGridBodyCtrl();for(;y||m<e;){if(!D.getScrollFeature().scrollGridIfNeeded()){let Ee;if(n.length)this.sortTaskList(t),Ee=n.pop().task;else if(a.length)this.sortTaskList(o),Ee=a.pop().task;else if(l.length)Ee=l.pop();else{this.cancelledTasks.clear();break}this.cancelledTasks.has(Ee)||Ee()}m=new Date().getTime()-s}n.length||a.length||l.length?this.requestFrame():this.stopTicking()}stopTicking(){this.ticking=!1}flushAllFrames(){this.useAnimationFrame&&this.executeFrame(-1)}schedule(){this.useAnimationFrame&&(this.ticking||(this.ticking=!0,this.requestFrame()))}requestFrame(){const e=this.executeFrame.bind(this,60);this.requestAnimationFrame(e)}requestAnimationFrame(e){const t=this.gridOptionsService.getWindow();t.requestAnimationFrame?t.requestAnimationFrame(e):t.webkitRequestAnimationFrame?t.webkitRequestAnimationFrame(e):t.setTimeout(e,0)}isQueueEmpty(){return!this.ticking}debounce(e){let t=!1;return()=>{if(!this.isOn()){this.getFrameworkOverrides().setTimeout(e,0);return}t||(t=!0,this.addDestroyTask(()=>{t=!1,e()}))}}};__decorate$16([Autowired("ctrlsService")],AnimationFrameService.prototype,"ctrlsService",void 0);__decorate$16([Autowired("paginationProxy")],AnimationFrameService.prototype,"paginationProxy",void 0);__decorate$16([PostConstruct],AnimationFrameService.prototype,"init",null);AnimationFrameService=__decorate$16([Bean("animationFrameService")],AnimationFrameService);var __decorate$15=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let AutoWidthCalculator=class extends BeanStub{postConstruct(){this.ctrlsService.whenReady(e=>{this.centerRowContainerCtrl=e.centerRowContainerCtrl})}getPreferredWidthForColumn(e,t){const n=this.getHeaderCellForColumn(e);if(!n)return-1;const o=this.rowRenderer.getAllCellsForColumn(e);return t||o.push(n),this.addElementsToContainerAndGetWidth(o)}getPreferredWidthForColumnGroup(e){const t=this.getHeaderCellForColumn(e);return t?this.addElementsToContainerAndGetWidth([t]):-1}addElementsToContainerAndGetWidth(e){const t=document.createElement("form");t.style.position="fixed";const n=this.centerRowContainerCtrl.getContainerElement();e.forEach(l=>this.cloneItemIntoDummy(l,t)),n.appendChild(t);const o=t.offsetWidth;n.removeChild(t);const a=this.getAutoSizePadding();return o+a}getAutoSizePadding(){const e=this.gridOptionsService.getNum("autoSizePadding");return e!=null&&e>=0?e:20}getHeaderCellForColumn(e){let t=null;return this.ctrlsService.getHeaderRowContainerCtrls().forEach(n=>{const o=n.getHtmlElementForColumnHeader(e);o!=null&&(t=o)}),t}cloneItemIntoDummy(e,t){const n=e.cloneNode(!0);n.style.width="",n.style.position="static",n.style.left="";const o=document.createElement("div"),a=o.classList;["ag-header-cell","ag-header-group-cell"].some(m=>n.classList.contains(m))?(a.add("ag-header","ag-header-row"),o.style.position="static"):a.add("ag-row");let s=e.parentElement;for(;s;){if(["ag-header-row","ag-row"].some(y=>s.classList.contains(y))){for(let y=0;y<s.classList.length;y++){const D=s.classList[y];D!="ag-row-position-absolute"&&a.add(D)}break}s=s.parentElement}o.appendChild(n),t.appendChild(o)}};__decorate$15([Autowired("rowRenderer")],AutoWidthCalculator.prototype,"rowRenderer",void 0);__decorate$15([Autowired("ctrlsService")],AutoWidthCalculator.prototype,"ctrlsService",void 0);__decorate$15([Autowired("rowCssClassCalculator")],AutoWidthCalculator.prototype,"rowCssClassCalculator",void 0);__decorate$15([PostConstruct],AutoWidthCalculator.prototype,"postConstruct",null);AutoWidthCalculator=__decorate$15([Bean("autoWidthCalculator")],AutoWidthCalculator);var __decorate$14=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class StickyRowFeature extends BeanStub{constructor(e,t){super(),this.createRowCon=e,this.destroyRowCtrls=t,this.stickyRowCtrls=[],this.containerHeight=0}postConstruct(){this.isClientSide=this.rowModel.getType()==="clientSide",this.ctrlsService.whenReady(e=>{this.gridBodyCtrl=e.gridBodyCtrl})}getStickyRowCtrls(){return this.stickyRowCtrls}checkStickyRows(){let e=0;if(!this.gridOptionsService.isGroupRowsSticky()){this.refreshNodesAndContainerHeight([],e);return}const t=[],n=this.rowRenderer.getFirstVisibleVerticalPixel(),o=a=>{var l,s,m;t.push(a);let y;if(this.isClientSide){let W=a;for(;W.expanded;)if(W.master)W=W.detailNode;else if(W.childrenAfterSort){if(W.childrenAfterSort.length===0)break;W=last(W.childrenAfterSort)}y=W.rowTop+W.rowHeight}else if(a.master)y=a.detailNode.rowTop+a.detailNode.rowHeight;else{const W=(l=a.childStore)===null||l===void 0?void 0:l.getStoreBounds();y=((s=W==null?void 0:W.heightPx)!==null&&s!==void 0?s:0)+((m=W==null?void 0:W.topPx)!==null&&m!==void 0?m:0)}const D=n+e+a.rowHeight;y<D?a.stickyRowTop=e+(y-D):a.stickyRowTop=e,e=0,t.forEach(W=>{const Ee=W.stickyRowTop+W.rowHeight;e<Ee&&(e=Ee)})};for(;;){const a=n+e,l=this.rowModel.getRowIndexAtPixel(a),s=this.rowModel.getRow(l);if(s==null||s.level<0)break;const m=[];let y=s.parent;for(;y.level>=0;)m.push(y),y=y.parent;const D=m.reverse().find(W=>t.indexOf(W)<0&&W.displayed);if(D){o(D);continue}if(s.isExpandable()&&s.expanded&&s.rowTop<a){o(s);continue}break}this.refreshNodesAndContainerHeight(t,e)}refreshStickyNode(e){const t=[];for(let n=0;n<this.stickyRowCtrls.length;n++){const o=this.stickyRowCtrls[n].getRowNode();o!==e&&t.push(o)}this.refreshNodesAndContainerHeight(t,this.containerHeight),this.checkStickyRows()}refreshNodesAndContainerHeight(e,t){const n=this.stickyRowCtrls.filter(s=>e.indexOf(s.getRowNode())===-1),o=e.filter(s=>this.stickyRowCtrls.findIndex(m=>m.getRowNode()===s)===-1),a={};n.forEach(s=>{a[s.getRowNode().id]=s,this.stickyRowCtrls=this.stickyRowCtrls.filter(m=>m!==s)});for(const s of Object.values(a))s.getRowNode().sticky=!1;this.destroyRowCtrls(a,!1);const l=o.map(s=>(s.sticky=!0,this.createRowCon(s,!1,!1)));this.stickyRowCtrls.push(...l),this.stickyRowCtrls.forEach(s=>s.setRowTop(s.getRowNode().stickyRowTop)),this.stickyRowCtrls.sort((s,m)=>m.getRowNode().rowIndex-s.getRowNode().rowIndex),this.containerHeight!==t&&(this.containerHeight=t,this.gridBodyCtrl.setStickyTopHeight(t))}}__decorate$14([Autowired("rowModel")],StickyRowFeature.prototype,"rowModel",void 0);__decorate$14([Autowired("rowRenderer")],StickyRowFeature.prototype,"rowRenderer",void 0);__decorate$14([Autowired("ctrlsService")],StickyRowFeature.prototype,"ctrlsService",void 0);__decorate$14([PostConstruct],StickyRowFeature.prototype,"postConstruct",null);var __decorate$13=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const DEFAULT_KEEP_DETAIL_ROW_COUNT=10;let RowRenderer=class extends BeanStub{constructor(){super(...arguments),this.destroyFuncsForColumnListeners=[],this.rowCtrlsByRowIndex={},this.zombieRowCtrls={},this.allRowCtrls=[],this.topRowCtrls=[],this.bottomRowCtrls=[],this.refreshInProgress=!1,this.dataFirstRenderedFired=!1}postConstruct(){this.ctrlsService.whenReady(()=>{this.gridBodyCtrl=this.ctrlsService.getGridBodyCtrl(),this.initialise()})}initialise(){if(this.addManagedListener(this.eventService,Events.EVENT_PAGINATION_CHANGED,this.onPageLoaded.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_PINNED_ROW_DATA_CHANGED,this.onPinnedRowDataChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,this.onDisplayedColumnsChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_BODY_SCROLL,this.onBodyScroll.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_BODY_HEIGHT_CHANGED,this.redraw.bind(this)),this.addManagedPropertyListener("domLayout",this.onDomLayoutChanged.bind(this)),this.addManagedPropertyListener("rowClass",this.redrawRows.bind(this)),this.gridOptionsService.isGroupRowsSticky()){const e=this.rowModel.getType();(e==="clientSide"||e==="serverSide")&&(this.stickyRowFeature=this.createManagedBean(new StickyRowFeature(this.createRowCon.bind(this),this.destroyRowCtrls.bind(this))))}this.registerCellEventListeners(),this.initialiseCache(),this.printLayout=this.gridOptionsService.isDomLayout("print"),this.embedFullWidthRows=this.printLayout||this.gridOptionsService.is("embedFullWidthRows"),this.redrawAfterModelUpdate()}initialiseCache(){if(this.gridOptionsService.is("keepDetailRows")){const e=this.getKeepDetailRowsCount(),t=e??3;this.cachedRowCtrls=new RowCtrlCache(t)}}getKeepDetailRowsCount(){const e=this.gridOptionsService.getNum("keepDetailRowsCount");return exists(e)&&e>0?e:DEFAULT_KEEP_DETAIL_ROW_COUNT}getRowCtrls(){return this.allRowCtrls}getStickyTopRowCtrls(){return this.stickyRowFeature?this.stickyRowFeature.getStickyRowCtrls():[]}updateAllRowCtrls(){const e=getAllValuesInObject(this.rowCtrlsByRowIndex),t=this.gridOptionsService.is("ensureDomOrder"),n=this.gridOptionsService.isDomLayout("print");(t||n)&&e.sort((l,s)=>l.getRowNode().rowIndex-s.getRowNode.rowIndex);const o=getAllValuesInObject(this.zombieRowCtrls),a=this.cachedRowCtrls?this.cachedRowCtrls.getEntries():[];this.allRowCtrls=[...e,...o,...a]}onCellFocusChanged(e){this.getAllCellCtrls().forEach(t=>t.onCellFocused(e)),this.getFullWidthRowCtrls().forEach(t=>t.onFullWidthRowFocused(e))}registerCellEventListeners(){this.addManagedListener(this.eventService,Events.EVENT_CELL_FOCUSED,t=>{this.onCellFocusChanged(t)}),this.addManagedListener(this.eventService,Events.EVENT_CELL_FOCUS_CLEARED,()=>{this.onCellFocusChanged()}),this.addManagedListener(this.eventService,Events.EVENT_FLASH_CELLS,t=>{this.getAllCellCtrls().forEach(n=>n.onFlashCells(t))}),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_HOVER_CHANGED,()=>{this.getAllCellCtrls().forEach(t=>t.onColumnHover())}),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,()=>{this.getAllCellCtrls().forEach(t=>t.onDisplayedColumnsChanged())}),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED,()=>{this.printLayout&&this.getAllCellCtrls().forEach(t=>t.onLeftChanged())}),this.gridOptionsService.isEnableRangeSelection()&&(this.addManagedListener(this.eventService,Events.EVENT_RANGE_SELECTION_CHANGED,()=>{this.getAllCellCtrls().forEach(t=>t.onRangeSelectionChanged())}),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_MOVED,()=>{this.getAllCellCtrls().forEach(t=>t.updateRangeBordersIfRangeCount())}),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_PINNED,()=>{this.getAllCellCtrls().forEach(t=>t.updateRangeBordersIfRangeCount())}),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_VISIBLE,()=>{this.getAllCellCtrls().forEach(t=>t.updateRangeBordersIfRangeCount())})),this.refreshListenersToColumnsForCellComps(),this.addManagedListener(this.eventService,Events.EVENT_GRID_COLUMNS_CHANGED,this.refreshListenersToColumnsForCellComps.bind(this)),this.addDestroyFunc(this.removeGridColumnListeners.bind(this))}removeGridColumnListeners(){this.destroyFuncsForColumnListeners.forEach(e=>e()),this.destroyFuncsForColumnListeners.length=0}refreshListenersToColumnsForCellComps(){this.removeGridColumnListeners();const e=this.columnModel.getAllGridColumns();e&&e.forEach(t=>{const n=y=>{this.getAllCellCtrls().forEach(D=>{D.getColumn()===t&&y(D)})},o=()=>{n(y=>y.onLeftChanged())},a=()=>{n(y=>y.onWidthChanged())},l=()=>{n(y=>y.onFirstRightPinnedChanged())},s=()=>{n(y=>y.onLastLeftPinnedChanged())},m=()=>{n(y=>y.onColDefChanged())};t.addEventListener("leftChanged",o),t.addEventListener("widthChanged",a),t.addEventListener("firstRightPinnedChanged",l),t.addEventListener("lastLeftPinnedChanged",s),t.addEventListener("colDefChanged",m),this.destroyFuncsForColumnListeners.push(()=>{t.removeEventListener("leftChanged",o),t.removeEventListener("widthChanged",a),t.removeEventListener("firstRightPinnedChanged",l),t.removeEventListener("lastLeftPinnedChanged",s),t.removeEventListener("colDefChanged",m)})})}onDomLayoutChanged(){const e=this.gridOptionsService.isDomLayout("print"),t=e||this.gridOptionsService.is("embedFullWidthRows"),n=t!==this.embedFullWidthRows||this.printLayout!==e;this.printLayout=e,this.embedFullWidthRows=t,n&&this.redrawAfterModelUpdate({domLayoutChanged:!0})}datasourceChanged(){this.firstRenderedRow=0,this.lastRenderedRow=-1;const e=Object.keys(this.rowCtrlsByRowIndex);this.removeRowCtrls(e)}onPageLoaded(e){const t={recycleRows:e.keepRenderedRows,animate:e.animate,newData:e.newData,newPage:e.newPage,onlyBody:!0};this.redrawAfterModelUpdate(t)}getAllCellsForColumn(e){const t=[];return this.getAllRowCtrls().forEach(n=>{const o=n.getCellElement(e);o&&t.push(o)}),t}refreshFloatingRowComps(){this.refreshFloatingRows(this.topRowCtrls,this.pinnedRowModel.getPinnedTopRowData()),this.refreshFloatingRows(this.bottomRowCtrls,this.pinnedRowModel.getPinnedBottomRowData())}getTopRowCtrls(){return this.topRowCtrls}getBottomRowCtrls(){return this.bottomRowCtrls}refreshFloatingRows(e,t){e.forEach(n=>{n.destroyFirstPass(),n.destroySecondPass()}),e.length=0,t&&t.forEach(n=>{const o=new RowCtrl(n,this.beans,!1,!1,this.printLayout);e.push(o)})}onPinnedRowDataChanged(){const e={recycleRows:!0};this.redrawAfterModelUpdate(e)}getRenderedIndexesForRowNodes(e){const t=[];return missing(e)||iterateObject(this.rowCtrlsByRowIndex,(n,o)=>{const a=o.getRowNode();e.indexOf(a)>=0&&t.push(n)}),t}redrawRows(e){const t=e!=null&&e.length>0;if(t){const n=this.getRenderedIndexesForRowNodes(e);this.removeRowCtrls(n)}this.redrawAfterModelUpdate({recycleRows:t})}getCellToRestoreFocusToAfterRefresh(e){const t=e!=null&&e.suppressKeepFocus?null:this.focusService.getFocusCellToUseAfterRefresh();if(t==null)return null;const o=this.gridOptionsService.getDocument().activeElement,a=this.gridOptionsService.getDomData(o,CellCtrl.DOM_DATA_KEY_CELL_CTRL),l=this.gridOptionsService.getDomData(o,RowCtrl.DOM_DATA_KEY_ROW_CTRL);return a||l?t:null}redrawAfterModelUpdate(e={}){this.getLockOnRefresh();const t=this.getCellToRestoreFocusToAfterRefresh(e);this.updateContainerHeights(),this.scrollToTopIfNewData(e);const n=!e.domLayoutChanged&&!!e.recycleRows,o=e.animate&&this.gridOptionsService.isAnimateRows(),a=n?this.getRowsToRecycle():null;n||this.removeAllRowComps(),this.recycleRows(a,o),this.gridBodyCtrl.updateRowCount(),e.onlyBody||this.refreshFloatingRowComps(),this.dispatchDisplayedRowsChanged(),t!=null&&this.restoreFocusedCell(t),this.releaseLockOnRefresh()}scrollToTopIfNewData(e){const t=e.newData||e.newPage,n=this.gridOptionsService.is("suppressScrollOnNewData");t&&!n&&this.gridBodyCtrl.getScrollFeature().scrollToTop()}updateContainerHeights(){if(this.printLayout){this.rowContainerHeightService.setModelHeight(null);return}let e=this.paginationProxy.getCurrentPageHeight();e===0&&(e=1),this.rowContainerHeightService.setModelHeight(e)}getLockOnRefresh(){if(this.refreshInProgress)throw new Error("AG Grid: cannot get grid to draw rows when it is in the middle of drawing rows. Your code probably called a grid API method while the grid was in the render stage. To overcome this, put the API call into a timeout, e.g. instead of api.redrawRows(), call setTimeout(function() { api.redrawRows(); }, 0). To see what part of your code that caused the refresh check this stacktrace.");this.refreshInProgress=!0}releaseLockOnRefresh(){this.refreshInProgress=!1}isRefreshInProgress(){return this.refreshInProgress}restoreFocusedCell(e){e&&(this.focusService.setRestoreFocusedCell(e),this.onCellFocusChanged({rowIndex:e.rowIndex,column:e.column,rowPinned:e.rowPinned,forceBrowserFocus:!0,preventScrollOnBrowserFocus:!0,api:this.beans.gridApi,columnApi:this.beans.columnApi,context:this.beans.gridOptionsService.context,type:"mock"}))}stopEditing(e=!1){this.getAllRowCtrls().forEach(t=>{t.stopEditing(e)})}getAllCellCtrls(){const e=[],t=this.getAllRowCtrls(),n=t.length;for(let o=0;o<n;o++){const a=t[o].getAllCellCtrls(),l=a.length;for(let s=0;s<l;s++)e.push(a[s])}return e}getAllRowCtrls(){const e=this.stickyRowFeature&&this.stickyRowFeature.getStickyRowCtrls()||[],t=[...this.topRowCtrls,...this.bottomRowCtrls,...e];for(const n of Object.keys(this.rowCtrlsByRowIndex))t.push(this.rowCtrlsByRowIndex[n]);return t}addRenderedRowListener(e,t,n){const o=this.rowCtrlsByRowIndex[t];o&&o.addEventListener(e,n)}flashCells(e={}){const{flashDelay:t,fadeDelay:n}=e;this.getCellCtrls(e.rowNodes,e.columns).forEach(o=>o.flashCell({flashDelay:t,fadeDelay:n}))}refreshCells(e={}){const t={forceRefresh:e.force,newData:!1,suppressFlash:e.suppressFlash};this.getCellCtrls(e.rowNodes,e.columns).forEach(n=>{if(n.refreshShouldDestroy()){const o=n.getRowCtrl();o&&o.refreshCell(n)}else n.refreshCell(t)}),this.refreshFullWidthRows(e.rowNodes)}getCellRendererInstances(e){var t;const n=this.getCellCtrls(e.rowNodes,e.columns).map(l=>l.getCellRenderer()).filter(l=>l!=null);if(!((t=e.columns)===null||t===void 0)&&t.length)return n;const o=[],a=this.mapRowNodes(e.rowNodes);return this.getAllRowCtrls().forEach(l=>{if(a&&!this.isRowInMap(l.getRowNode(),a)||!l.isFullWidth())return;const s=l.getFullWidthCellRenderer();s&&o.push(s)}),[...o,...n]}getCellEditorInstances(e){const t=[];return this.getCellCtrls(e.rowNodes,e.columns).forEach(n=>{const o=n.getCellEditor();o&&t.push(o)}),t}getEditingCells(){const e=[];return this.getAllCellCtrls().forEach(t=>{if(t.isEditing()){const n=t.getCellPosition();e.push(n)}}),e}mapRowNodes(e){if(!e)return;const t={top:{},bottom:{},normal:{}};return e.forEach(n=>{const o=n.id;n.rowPinned==="top"?t.top[o]=n:n.rowPinned==="bottom"?t.bottom[o]=n:t.normal[o]=n}),t}isRowInMap(e,t){const n=e.id,o=e.rowPinned;return o==="bottom"?t.bottom[n]!=null:o==="top"?t.top[n]!=null:t.normal[n]!=null}getCellCtrls(e,t){const n=this.mapRowNodes(e),o=[];let a;exists(t)&&(a={},t.forEach(s=>{const m=this.columnModel.getGridColumn(s);exists(m)&&(a[m.getId()]=!0)}));const l=s=>{const m=s.getRowNode();n!=null&&!this.isRowInMap(m,n)||s.getAllCellCtrls().forEach(y=>{const D=y.getColumn().getId();a&&!a[D]||o.push(y)})};return this.getAllRowCtrls().forEach(s=>l(s)),o}destroy(){this.removeAllRowComps(),super.destroy()}removeAllRowComps(){const e=Object.keys(this.rowCtrlsByRowIndex);this.removeRowCtrls(e)}getRowsToRecycle(){const e=[];iterateObject(this.rowCtrlsByRowIndex,(n,o)=>{o.getRowNode().id==null&&e.push(n)}),this.removeRowCtrls(e);const t={};return iterateObject(this.rowCtrlsByRowIndex,(n,o)=>{const a=o.getRowNode();t[a.id]=o}),this.rowCtrlsByRowIndex={},t}removeRowCtrls(e){e.forEach(t=>{const n=this.rowCtrlsByRowIndex[t];n&&(n.destroyFirstPass(),n.destroySecondPass()),delete this.rowCtrlsByRowIndex[t]})}onBodyScroll(e){e.direction==="vertical"&&this.redraw()}redraw(e=!0){let t;if(this.stickyRowFeature&&browserSupportsPreventScroll()&&(t=this.getCellToRestoreFocusToAfterRefresh()||void 0),this.getLockOnRefresh(),this.recycleRows(null,!1,e),this.releaseLockOnRefresh(),this.dispatchDisplayedRowsChanged(e),t!=null){const n=this.getCellToRestoreFocusToAfterRefresh();t!=null&&n==null&&(this.animationFrameService.flushAllFrames(),this.restoreFocusedCell(t))}}removeRowCompsNotToDraw(e){const t={};e.forEach(a=>t[a]=!0);const o=Object.keys(this.rowCtrlsByRowIndex).filter(a=>!t[a]);this.removeRowCtrls(o)}calculateIndexesToDraw(e){let t=createArrayOfNumbers(this.firstRenderedRow,this.lastRenderedRow);const n=(o,a)=>{const l=a.getRowNode().rowIndex;l!=null&&(l<this.firstRenderedRow||l>this.lastRenderedRow)&&this.doNotUnVirtualiseRow(a)&&t.push(l)};return iterateObject(this.rowCtrlsByRowIndex,n),iterateObject(e,n),t.sort((o,a)=>o-a),t=t.filter(o=>{const a=this.paginationProxy.getRow(o);return a&&!a.sticky}),t}recycleRows(e,t=!1,n=!1){this.rowContainerHeightService.updateOffset(),this.workOutFirstAndLastRowsToRender(),this.stickyRowFeature&&this.stickyRowFeature.checkStickyRows();const o=this.calculateIndexesToDraw(e);this.removeRowCompsNotToDraw(o),this.printLayout&&(t=!1),o.forEach(a=>{this.createOrUpdateRowCtrl(a,e,t,n)}),e&&(n&&!this.gridOptionsService.is("suppressAnimationFrame")&&!this.printLayout?this.beans.animationFrameService.addDestroyTask(()=>{this.destroyRowCtrls(e,t),this.updateAllRowCtrls(),this.dispatchDisplayedRowsChanged()}):this.destroyRowCtrls(e,t)),this.updateAllRowCtrls()}dispatchDisplayedRowsChanged(e=!1){const t={type:Events.EVENT_DISPLAYED_ROWS_CHANGED,afterScroll:e};this.eventService.dispatchEvent(t)}onDisplayedColumnsChanged(){const e=this.columnModel.isPinningLeft(),t=this.columnModel.isPinningRight();(this.pinningLeft!==e||t!==this.pinningRight)&&(this.pinningLeft=e,this.pinningRight=t,this.embedFullWidthRows&&this.redrawFullWidthEmbeddedRows())}redrawFullWidthEmbeddedRows(){const e=[];this.getFullWidthRowCtrls().forEach(t=>{const n=t.getRowNode().rowIndex;e.push(n.toString())}),this.refreshFloatingRowComps(),this.removeRowCtrls(e),this.redraw()}getFullWidthRowCtrls(e){const t=this.mapRowNodes(e);return this.getAllRowCtrls().filter(n=>{if(!n.isFullWidth())return!1;const o=n.getRowNode();return!(t!=null&&!this.isRowInMap(o,t))})}refreshFullWidthRow(e){this.refreshFullWidthRows([e])}refreshFullWidthRows(e){const t=this.getFullWidthRowCtrls(e);let n=!1;const o=[];t.forEach(a=>{if(a.refreshFullWidth())return;const s=a.getRowNode();s.sticky?this.stickyRowFeature.refreshStickyNode(s):o.push(s.rowIndex),n=!0}),o.length>0&&this.removeRowCtrls(o),n&&this.redraw(!1)}createOrUpdateRowCtrl(e,t,n,o){let a,l=this.rowCtrlsByRowIndex[e];if(l||(a=this.paginationProxy.getRow(e),exists(a)&&exists(t)&&t[a.id]&&a.alreadyRendered&&(l=t[a.id],t[a.id]=null)),!l)if(a||(a=this.paginationProxy.getRow(e)),exists(a))l=this.createRowCon(a,n,o);else return;return a&&(a.alreadyRendered=!0),this.rowCtrlsByRowIndex[e]=l,l}destroyRowCtrls(e,t){const n=[];iterateObject(e,(o,a)=>{if(a){if(this.cachedRowCtrls&&a.isCacheable()){this.cachedRowCtrls.addRow(a);return}a.destroyFirstPass(),t?(this.zombieRowCtrls[a.getInstanceId()]=a,n.push(()=>{a.destroySecondPass(),delete this.zombieRowCtrls[a.getInstanceId()]})):a.destroySecondPass()}}),t&&(n.push(()=>{this.updateAllRowCtrls(),this.dispatchDisplayedRowsChanged()}),executeInAWhile(n))}getRowBuffer(){let e=this.gridOptionsService.getNum("rowBuffer");return typeof e=="number"?e<0&&(doOnce(()=>console.warn("AG Grid: rowBuffer should not be negative"),"warn rowBuffer negative"),e=0,this.gridOptionsService.set("rowBuffer",0)):e=10,e}getRowBufferInPixels(){const e=this.getRowBuffer(),t=this.gridOptionsService.getRowHeightAsNumber();return e*t}workOutFirstAndLastRowsToRender(){let e,t;if(!this.paginationProxy.isRowsToRender())e=0,t=-1;else if(this.printLayout)e=this.paginationProxy.getPageFirstRow(),t=this.paginationProxy.getPageLastRow();else{const m=this.getRowBufferInPixels(),y=this.ctrlsService.getGridBodyCtrl(),D=this.gridOptionsService.is("suppressRowVirtualisation");let W=!1,Ee,dt;do{const Vn=this.paginationProxy.getPixelOffset(),{pageFirstPixel:Wr,pageLastPixel:ps}=this.paginationProxy.getCurrentPagePixelRange(),il=this.rowContainerHeightService.getDivStretchOffset(),gl=y.getScrollFeature().getVScrollPosition(),ml=gl.top,sl=gl.bottom;D?(Ee=Wr+il,dt=ps+il):(Ee=Math.max(ml+Vn-m,Wr)+il,dt=Math.min(sl+Vn+m,ps)+il),this.firstVisibleVPixel=Math.max(ml+Vn,Wr)+il,W=this.ensureAllRowsInRangeHaveHeightsCalculated(Ee,dt)}while(W);let Ht=this.paginationProxy.getRowIndexAtPixel(Ee),ir=this.paginationProxy.getRowIndexAtPixel(dt);const Hr=this.paginationProxy.getPageFirstRow(),Bn=this.paginationProxy.getPageLastRow();Ht<Hr&&(Ht=Hr),ir>Bn&&(ir=Bn),e=Ht,t=ir}const n=this.gridOptionsService.isDomLayout("normal"),o=this.gridOptionsService.is("suppressMaxRenderedRowRestriction"),a=Math.max(this.getRowBuffer(),500);n&&!o&&t-e>a&&(t=e+a);const l=e!==this.firstRenderedRow,s=t!==this.lastRenderedRow;if(l||s){this.firstRenderedRow=e,this.lastRenderedRow=t;const m={type:Events.EVENT_VIEWPORT_CHANGED,firstRow:e,lastRow:t};this.eventService.dispatchEvent(m)}}dispatchFirstDataRenderedEvent(){if(this.dataFirstRenderedFired)return;this.dataFirstRenderedFired=!0;const e={type:Events.EVENT_FIRST_DATA_RENDERED,firstRow:this.firstRenderedRow,lastRow:this.lastRenderedRow};window.requestAnimationFrame(()=>{this.beans.eventService.dispatchEvent(e)})}ensureAllRowsInRangeHaveHeightsCalculated(e,t){const n=this.paginationProxy.ensureRowHeightsValid(e,t,-1,-1);return n&&this.updateContainerHeights(),n}getFirstVisibleVerticalPixel(){return this.firstVisibleVPixel}getFirstVirtualRenderedRow(){return this.firstRenderedRow}getLastVirtualRenderedRow(){return this.lastRenderedRow}doNotUnVirtualiseRow(e){const o=e.getRowNode(),a=this.focusService.isRowNodeFocused(o),l=e.isEditing(),s=o.detail;return a||l||s?!!this.paginationProxy.isRowPresent(o):!1}createRowCon(e,t,n){const o=this.cachedRowCtrls?this.cachedRowCtrls.getRow(e):null;if(o)return o;const a=this.gridOptionsService.is("suppressAnimationFrame"),l=n&&!a&&!this.printLayout;return new RowCtrl(e,this.beans,t,l,this.printLayout)}getRenderedNodes(){const e=this.rowCtrlsByRowIndex;return Object.keys(e).map(t=>e[t].getRowNode())}getRowByPosition(e){let t;const{rowIndex:n}=e;switch(e.rowPinned){case"top":t=this.topRowCtrls[n];break;case"bottom":t=this.bottomRowCtrls[n];break;default:t=this.rowCtrlsByRowIndex[n],t||(t=this.getStickyTopRowCtrls().find(o=>o.getRowNode().rowIndex===n)||null);break}return t}getRowNode(e){switch(e.rowPinned){case"top":return this.pinnedRowModel.getPinnedTopRowData()[e.rowIndex];case"bottom":return this.pinnedRowModel.getPinnedBottomRowData()[e.rowIndex];default:return this.rowModel.getRow(e.rowIndex)}}isRangeInRenderedViewport(e,t){if(e==null||t==null)return!1;const o=e>this.lastRenderedRow;return!(t<this.firstRenderedRow)&&!o}};__decorate$13([Autowired("animationFrameService")],RowRenderer.prototype,"animationFrameService",void 0);__decorate$13([Autowired("paginationProxy")],RowRenderer.prototype,"paginationProxy",void 0);__decorate$13([Autowired("columnModel")],RowRenderer.prototype,"columnModel",void 0);__decorate$13([Autowired("pinnedRowModel")],RowRenderer.prototype,"pinnedRowModel",void 0);__decorate$13([Autowired("rowModel")],RowRenderer.prototype,"rowModel",void 0);__decorate$13([Autowired("focusService")],RowRenderer.prototype,"focusService",void 0);__decorate$13([Autowired("beans")],RowRenderer.prototype,"beans",void 0);__decorate$13([Autowired("rowContainerHeightService")],RowRenderer.prototype,"rowContainerHeightService",void 0);__decorate$13([Autowired("ctrlsService")],RowRenderer.prototype,"ctrlsService",void 0);__decorate$13([PostConstruct],RowRenderer.prototype,"postConstruct",null);RowRenderer=__decorate$13([Bean("rowRenderer")],RowRenderer);class RowCtrlCache{constructor(e){this.entriesMap={},this.entriesList=[],this.maxCount=e}addRow(e){if(this.entriesMap[e.getRowNode().id]=e,this.entriesList.push(e),e.setCached(!0),this.entriesList.length>this.maxCount){const t=this.entriesList[0];t.destroyFirstPass(),t.destroySecondPass(),this.removeFromCache(t)}}getRow(e){if(e==null||e.id==null)return null;const t=this.entriesMap[e.id];return t?(this.removeFromCache(t),t.setCached(!1),t.getRowNode()!=e?null:t):null}removeFromCache(e){const t=e.getRowNode().id;delete this.entriesMap[t],removeFromArray(this.entriesList,e)}getEntries(){return this.entriesList}}var __decorate$12=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let ValueFormatterService=class extends BeanStub{formatValue(e,t,n,o,a=!0){let l=null,s;const m=e.getColDef();if(o?s=o:a&&(s=m.valueFormatter),s){const y={value:n,node:t,data:t?t.data:null,colDef:m,column:e,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context};typeof s=="function"?l=s(y):l=this.expressionService.evaluate(s,y)}else if(m.refData)return m.refData[n]||"";return l==null&&Array.isArray(n)&&(l=n.join(", ")),l}};__decorate$12([Autowired("expressionService")],ValueFormatterService.prototype,"expressionService",void 0);ValueFormatterService=__decorate$12([Bean("valueFormatterService")],ValueFormatterService);var __decorate$11=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let PinnedRowModel=class extends BeanStub{init(){this.setPinnedTopRowData(this.gridOptionsService.get("pinnedTopRowData")),this.setPinnedBottomRowData(this.gridOptionsService.get("pinnedBottomRowData"))}isEmpty(e){const t=e==="top"?this.pinnedTopRows:this.pinnedBottomRows;return missingOrEmpty(t)}isRowsToRender(e){return!this.isEmpty(e)}getRowAtPixel(e,t){const n=t==="top"?this.pinnedTopRows:this.pinnedBottomRows;if(missingOrEmpty(n))return 0;for(let o=0;o<n.length;o++){const a=n[o];if(a.rowTop+a.rowHeight-1>=e)return o}return n.length-1}setPinnedTopRowData(e){this.pinnedTopRows=this.createNodesFromData(e,!0);const t={type:Events.EVENT_PINNED_ROW_DATA_CHANGED};this.eventService.dispatchEvent(t)}setPinnedBottomRowData(e){this.pinnedBottomRows=this.createNodesFromData(e,!1);const t={type:Events.EVENT_PINNED_ROW_DATA_CHANGED};this.eventService.dispatchEvent(t)}createNodesFromData(e,t){const n=[];if(e){let o=0;e.forEach((a,l)=>{const s=new RowNode(this.beans);s.data=a;const m=t?RowNode.ID_PREFIX_TOP_PINNED:RowNode.ID_PREFIX_BOTTOM_PINNED;s.id=m+l,s.rowPinned=t?"top":"bottom",s.setRowTop(o),s.setRowHeight(this.gridOptionsService.getRowHeightForNode(s).height),s.setRowIndex(l),o+=s.rowHeight,n.push(s)})}return n}getPinnedTopRowData(){return this.pinnedTopRows}getPinnedBottomRowData(){return this.pinnedBottomRows}getPinnedTopTotalHeight(){return this.getTotalHeight(this.pinnedTopRows)}getPinnedTopRowCount(){return this.pinnedTopRows?this.pinnedTopRows.length:0}getPinnedBottomRowCount(){return this.pinnedBottomRows?this.pinnedBottomRows.length:0}getPinnedTopRow(e){return this.pinnedTopRows[e]}getPinnedBottomRow(e){return this.pinnedBottomRows[e]}forEachPinnedTopRow(e){missingOrEmpty(this.pinnedTopRows)||this.pinnedTopRows.forEach(e)}forEachPinnedBottomRow(e){missingOrEmpty(this.pinnedBottomRows)||this.pinnedBottomRows.forEach(e)}getPinnedBottomTotalHeight(){return this.getTotalHeight(this.pinnedBottomRows)}getTotalHeight(e){if(!e||e.length===0)return 0;const t=last(e);return t.rowTop+t.rowHeight}};__decorate$11([Autowired("beans")],PinnedRowModel.prototype,"beans",void 0);__decorate$11([PostConstruct],PinnedRowModel.prototype,"init",null);PinnedRowModel=__decorate$11([Bean("pinnedRowModel")],PinnedRowModel);var ServerSideTransactionResultStatus;(function(r){r.Applied="Applied",r.StoreNotFound="StoreNotFound",r.StoreLoading="StoreLoading",r.StoreWaitingToLoad="StoreWaitingToLoad",r.StoreLoadingFailed="StoreLoadingFailed",r.StoreWrongType="StoreWrongType",r.Cancelled="Cancelled"})(ServerSideTransactionResultStatus||(ServerSideTransactionResultStatus={}));class ChangedPath{constructor(e,t){this.active=!0,this.nodeIdsToColumns={},this.mapToItems={},this.keepingColumns=e,this.pathRoot={rowNode:t,children:null},this.mapToItems[t.id]=this.pathRoot}setInactive(){this.active=!1}isActive(){return this.active}depthFirstSearchChangedPath(e,t){if(e.children)for(let n=0;n<e.children.length;n++)this.depthFirstSearchChangedPath(e.children[n],t);t(e.rowNode)}depthFirstSearchEverything(e,t,n){if(e.childrenAfterGroup)for(let o=0;o<e.childrenAfterGroup.length;o++){const a=e.childrenAfterGroup[o];a.childrenAfterGroup?this.depthFirstSearchEverything(e.childrenAfterGroup[o],t,n):n&&t(a)}t(e)}forEachChangedNodeDepthFirst(e,t=!1,n=!1){this.active&&!n?this.depthFirstSearchChangedPath(this.pathRoot,e):this.depthFirstSearchEverything(this.pathRoot.rowNode,e,t)}executeFromRootNode(e){e(this.pathRoot.rowNode)}createPathItems(e){let t=e,n=0;for(;!this.mapToItems[t.id];){const o={rowNode:t,children:null};this.mapToItems[t.id]=o,n++,t=t.parent}return n}populateColumnsMap(e,t){if(!this.keepingColumns||!t)return;let n=e;for(;n;)this.nodeIdsToColumns[n.id]||(this.nodeIdsToColumns[n.id]={}),t.forEach(o=>this.nodeIdsToColumns[n.id][o.getId()]=!0),n=n.parent}linkPathItems(e,t){let n=e;for(let o=0;o<t;o++){const a=this.mapToItems[n.id],l=this.mapToItems[n.parent.id];l.children||(l.children=[]),l.children.push(a),n=n.parent}}addParentNode(e,t){if(!e||e.isRowPinned())return;const n=this.createPathItems(e);this.linkPathItems(e,n),this.populateColumnsMap(e,t)}canSkip(e){return this.active&&!this.mapToItems[e.id]}getValueColumnsForNode(e,t){if(!this.keepingColumns)return t;const n=this.nodeIdsToColumns[e.id];return t.filter(a=>n[a.getId()])}getNotValueColumnsForNode(e,t){if(!this.keepingColumns)return null;const n=this.nodeIdsToColumns[e.id];return t.filter(a=>!n[a.getId()])}}class RowNodeBlock extends BeanStub{constructor(e){super(),this.state=RowNodeBlock.STATE_WAITING_TO_LOAD,this.version=0,this.id=e}getId(){return this.id}load(){this.state=RowNodeBlock.STATE_LOADING,this.loadFromDatasource()}getVersion(){return this.version}setStateWaitingToLoad(){this.version++,this.state=RowNodeBlock.STATE_WAITING_TO_LOAD}getState(){return this.state}pageLoadFailed(e){this.isRequestMostRecentAndLive(e)&&(this.state=RowNodeBlock.STATE_FAILED,this.processServerFail()),this.dispatchLoadCompleted(!1)}success(e,t){this.successCommon(e,t)}pageLoaded(e,t,n){this.successCommon(e,{rowData:t,rowCount:n})}isRequestMostRecentAndLive(e){const t=e===this.version,n=this.isAlive();return t&&n}successCommon(e,t){this.dispatchLoadCompleted(),this.isRequestMostRecentAndLive(e)&&(this.state=RowNodeBlock.STATE_LOADED,this.processServerResult(t))}dispatchLoadCompleted(e=!0){const t={type:RowNodeBlock.EVENT_LOAD_COMPLETE,success:e,block:this};this.dispatchEvent(t)}}RowNodeBlock.EVENT_LOAD_COMPLETE="loadComplete";RowNodeBlock.STATE_WAITING_TO_LOAD="needsLoading";RowNodeBlock.STATE_LOADING="loading";RowNodeBlock.STATE_LOADED="loaded";RowNodeBlock.STATE_FAILED="failed";var __decorate$10=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},__param$7=function(r,e){return function(t,n){e(t,n,r)}},RowNodeBlockLoader_1;let RowNodeBlockLoader=RowNodeBlockLoader_1=class extends BeanStub{constructor(){super(...arguments),this.activeBlockLoadsCount=0,this.blocks=[],this.active=!0}postConstruct(){this.maxConcurrentRequests=this.getMaxConcurrentDatasourceRequests();const e=this.gridOptionsService.getNum("blockLoadDebounceMillis");e&&e>0&&(this.checkBlockToLoadDebounce=_.debounce(this.performCheckBlocksToLoad.bind(this),e))}setBeans(e){this.logger=e.create("RowNodeBlockLoader")}getMaxConcurrentDatasourceRequests(){const e=this.gridOptionsService.getNum("maxConcurrentDatasourceRequests");if(e==null)return 2;if(!(e<=0))return e}addBlock(e){this.blocks.push(e),e.addEventListener(RowNodeBlock.EVENT_LOAD_COMPLETE,this.loadComplete.bind(this)),this.checkBlockToLoad()}removeBlock(e){_.removeFromArray(this.blocks,e)}destroy(){super.destroy(),this.active=!1}loadComplete(){this.activeBlockLoadsCount--,this.checkBlockToLoad(),this.dispatchEvent({type:RowNodeBlockLoader_1.BLOCK_LOADED_EVENT}),this.activeBlockLoadsCount==0&&this.dispatchEvent({type:RowNodeBlockLoader_1.BLOCK_LOADER_FINISHED_EVENT})}checkBlockToLoad(){this.checkBlockToLoadDebounce?this.checkBlockToLoadDebounce():this.performCheckBlocksToLoad()}performCheckBlocksToLoad(){if(!this.active)return;if(this.printCacheStatus(),this.maxConcurrentRequests!=null&&this.activeBlockLoadsCount>=this.maxConcurrentRequests){this.logger.log("checkBlockToLoad: max loads exceeded");return}const e=this.getAvailableLoadingCount(),t=this.blocks.filter(n=>n.getState()===RowNodeBlock.STATE_WAITING_TO_LOAD).slice(0,e);this.registerLoads(t.length),t.forEach(n=>n.load()),this.printCacheStatus()}getBlockState(){if(this.gridOptionsService.isRowModelType("serverSide"))return this.rowModel.getBlockStates();const e={};return this.blocks.forEach(t=>{const{id:n,state:o}=t.getBlockStateJson();e[n]=o}),e}printCacheStatus(){this.logger.isLogging()&&this.logger.log(`printCacheStatus: activePageLoadsCount = ${this.activeBlockLoadsCount}, blocks = ${JSON.stringify(this.getBlockState())}`)}isLoading(){return this.activeBlockLoadsCount>0}registerLoads(e){this.activeBlockLoadsCount+=e}getAvailableLoadingCount(){return this.maxConcurrentRequests!==void 0?this.maxConcurrentRequests-this.activeBlockLoadsCount:void 0}};RowNodeBlockLoader.BLOCK_LOADED_EVENT="blockLoaded";RowNodeBlockLoader.BLOCK_LOADER_FINISHED_EVENT="blockLoaderFinished";__decorate$10([Autowired("rowModel")],RowNodeBlockLoader.prototype,"rowModel",void 0);__decorate$10([PostConstruct],RowNodeBlockLoader.prototype,"postConstruct",null);__decorate$10([__param$7(0,Qualifier("loggerFactory"))],RowNodeBlockLoader.prototype,"setBeans",null);RowNodeBlockLoader=RowNodeBlockLoader_1=__decorate$10([Bean("rowNodeBlockLoader")],RowNodeBlockLoader);var __decorate$$=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let PaginationProxy=class extends BeanStub{constructor(){super(...arguments),this.currentPage=0,this.topDisplayedRowIndex=0,this.bottomDisplayedRowIndex=0,this.pixelOffset=0,this.masterRowCount=0}postConstruct(){this.active=this.gridOptionsService.is("pagination"),this.paginateChildRows=this.isPaginateChildRows(),this.addManagedListener(this.eventService,Events.EVENT_MODEL_UPDATED,this.onModelUpdated.bind(this)),this.addManagedPropertyListener("pagination",this.onPaginationPageSizeChanged.bind(this)),this.addManagedPropertyListener("paginationPageSize",this.onPaginationPageSizeChanged.bind(this)),this.onModelUpdated()}ensureRowHeightsValid(e,t,n,o){const a=this.rowModel.ensureRowHeightsValid(e,t,this.getPageFirstRow(),this.getPageLastRow());return a&&this.calculatePages(),a}isPaginateChildRows(){return this.gridOptionsService.is("groupRemoveSingleChildren")||this.gridOptionsService.is("groupRemoveLowestSingleChildren")?!0:this.gridOptionsService.is("paginateChildRows")}onModelUpdated(e){this.calculatePages();const t={type:Events.EVENT_PAGINATION_CHANGED,animate:e?e.animate:!1,newData:e?e.newData:!1,newPage:e?e.newPage:!1,keepRenderedRows:e?e.keepRenderedRows:!1};this.eventService.dispatchEvent(t)}onPaginationPageSizeChanged(){this.active=this.gridOptionsService.is("pagination"),this.calculatePages();const e={type:Events.EVENT_PAGINATION_CHANGED,animate:!1,newData:!1,newPage:!1,keepRenderedRows:!0};this.eventService.dispatchEvent(e)}goToPage(e){if(!this.active||this.currentPage===e||typeof this.currentPage!="number")return;this.currentPage=e;const t={type:Events.EVENT_MODEL_UPDATED,animate:!1,keepRenderedRows:!1,newData:!1,newPage:!0};this.onModelUpdated(t)}getPixelOffset(){return this.pixelOffset}getRow(e){return this.rowModel.getRow(e)}getRowNode(e){return this.rowModel.getRowNode(e)}getRowIndexAtPixel(e){return this.rowModel.getRowIndexAtPixel(e)}getCurrentPageHeight(){return missing(this.topRowBounds)||missing(this.bottomRowBounds)?0:Math.max(this.bottomRowBounds.rowTop+this.bottomRowBounds.rowHeight-this.topRowBounds.rowTop,0)}getCurrentPagePixelRange(){const e=this.topRowBounds?this.topRowBounds.rowTop:0,t=this.bottomRowBounds?this.bottomRowBounds.rowTop+this.bottomRowBounds.rowHeight:0;return{pageFirstPixel:e,pageLastPixel:t}}isRowPresent(e){return this.rowModel.isRowPresent(e)?e.rowIndex>=this.topDisplayedRowIndex&&e.rowIndex<=this.bottomDisplayedRowIndex:!1}isEmpty(){return this.rowModel.isEmpty()}isRowsToRender(){return this.rowModel.isRowsToRender()}forEachNode(e){return this.rowModel.forEachNode(e)}forEachNodeOnPage(e){const t=this.getPageFirstRow(),n=this.getPageLastRow();for(let o=t;o<=n;o++){const a=this.getRow(o);a&&e(a)}}getType(){return this.rowModel.getType()}getRowBounds(e){const t=this.rowModel.getRowBounds(e);return t.rowIndex=e,t}getPageFirstRow(){return this.topRowBounds?this.topRowBounds.rowIndex:-1}getPageLastRow(){return this.bottomRowBounds?this.bottomRowBounds.rowIndex:-1}getRowCount(){return this.rowModel.getRowCount()}getPageForIndex(e){return Math.floor(e/this.pageSize)}goToPageWithIndex(e){if(!this.active)return;const t=this.getPageForIndex(e);this.goToPage(t)}isRowInPage(e){return this.active?this.getPageForIndex(e.rowIndex)===this.currentPage:!0}isLastPageFound(){return this.rowModel.isLastRowIndexKnown()}getCurrentPage(){return this.currentPage}goToNextPage(){this.goToPage(this.currentPage+1)}goToPreviousPage(){this.goToPage(this.currentPage-1)}goToFirstPage(){this.goToPage(0)}goToLastPage(){const e=this.rowModel.getRowCount(),t=Math.floor(e/this.pageSize);this.goToPage(t)}getPageSize(){return this.pageSize}getTotalPages(){return this.totalPages}setPageSize(){this.pageSize=this.gridOptionsService.getNum("paginationPageSize"),(this.pageSize==null||this.pageSize<1)&&(this.pageSize=100)}calculatePages(){this.active?(this.setPageSize(),this.paginateChildRows?this.calculatePagesAllRows():this.calculatePagesMasterRowsOnly()):this.calculatedPagesNotActive(),this.topRowBounds=this.rowModel.getRowBounds(this.topDisplayedRowIndex),this.topRowBounds&&(this.topRowBounds.rowIndex=this.topDisplayedRowIndex),this.bottomRowBounds=this.rowModel.getRowBounds(this.bottomDisplayedRowIndex),this.bottomRowBounds&&(this.bottomRowBounds.rowIndex=this.bottomDisplayedRowIndex),this.setPixelOffset(exists(this.topRowBounds)?this.topRowBounds.rowTop:0)}setPixelOffset(e){this.pixelOffset!==e&&(this.pixelOffset=e,this.eventService.dispatchEvent({type:Events.EVENT_PAGINATION_PIXEL_OFFSET_CHANGED}))}setZeroRows(){this.masterRowCount=0,this.topDisplayedRowIndex=0,this.bottomDisplayedRowIndex=-1,this.currentPage=0,this.totalPages=0}adjustCurrentPageIfInvalid(){this.currentPage>=this.totalPages&&(this.currentPage=this.totalPages-1),(!isFinite(this.currentPage)||isNaN(this.currentPage)||this.currentPage<0)&&(this.currentPage=0)}calculatePagesMasterRowsOnly(){if(this.masterRowCount=this.rowModel.getTopLevelRowCount(),this.masterRowCount<=0){this.setZeroRows();return}const e=this.masterRowCount-1;this.totalPages=Math.floor(e/this.pageSize)+1,this.adjustCurrentPageIfInvalid();const t=this.pageSize*this.currentPage;let n=this.pageSize*(this.currentPage+1)-1;if(n>e&&(n=e),this.topDisplayedRowIndex=this.rowModel.getTopLevelRowDisplayedIndex(t),n===e)this.bottomDisplayedRowIndex=this.rowModel.getRowCount()-1;else{const o=this.rowModel.getTopLevelRowDisplayedIndex(n+1);this.bottomDisplayedRowIndex=o-1}}getMasterRowCount(){return this.masterRowCount}calculatePagesAllRows(){if(this.masterRowCount=this.rowModel.getRowCount(),this.masterRowCount===0){this.setZeroRows();return}const e=this.masterRowCount-1;this.totalPages=Math.floor(e/this.pageSize)+1,this.adjustCurrentPageIfInvalid(),this.topDisplayedRowIndex=this.pageSize*this.currentPage,this.bottomDisplayedRowIndex=this.pageSize*(this.currentPage+1)-1,this.bottomDisplayedRowIndex>e&&(this.bottomDisplayedRowIndex=e)}calculatedPagesNotActive(){this.pageSize=this.rowModel.getRowCount(),this.totalPages=1,this.currentPage=0,this.topDisplayedRowIndex=0,this.bottomDisplayedRowIndex=this.rowModel.getRowCount()-1}};__decorate$$([Autowired("rowModel")],PaginationProxy.prototype,"rowModel",void 0);__decorate$$([PostConstruct],PaginationProxy.prototype,"postConstruct",null);PaginationProxy=__decorate$$([Bean("paginationProxy")],PaginationProxy);var __decorate$_=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let StylingService=class extends BeanStub{processAllCellClasses(e,t,n,o){this.processClassRules(e.cellClassRules,t,n,o),this.processStaticCellClasses(e,t,n)}processClassRules(e,t,n,o){if(e==null)return;const a=Object.keys(e),l={},s={};for(let m=0;m<a.length;m++){const y=a[m],D=e[y];let W;typeof D=="string"?W=this.expressionService.evaluate(D,t):typeof D=="function"&&(W=D(t)),y.split(" ").forEach(Ee=>{Ee==null||Ee.trim()==""||(W?l[Ee]=!0:s[Ee]=!0)})}o&&Object.keys(s).forEach(o),Object.keys(l).forEach(n)}getStaticCellClasses(e,t){const{cellClass:n}=e;if(!n)return[];let o;return typeof n=="function"?o=n(t):o=n,typeof o=="string"&&(o=[o]),o||[]}processStaticCellClasses(e,t,n){this.getStaticCellClasses(e,t).forEach(a=>{n(a)})}};__decorate$_([Autowired("expressionService")],StylingService.prototype,"expressionService",void 0);StylingService=__decorate$_([Bean("stylingService")],StylingService);class AgToggleButton extends AgCheckbox{constructor(e){super(e,"ag-toggle-button")}setValue(e,t){return super.setValue(e,t),this.addOrRemoveCssClass("ag-selected",this.getValue()),this}}class AgInputTextArea extends AgAbstractInputField{constructor(e){super(e,"ag-text-area",null,"textarea")}setValue(e,t){const n=super.setValue(e,t);return this.eInput.value=e,n}setCols(e){return this.eInput.cols=e,this}setRows(e){return this.eInput.rows=e,this}}class AgInputDateField extends AgInputTextField{constructor(e){super(e,"ag-date-field","date")}postConstruct(){super.postConstruct(),this.addManagedListener(this.eInput,"wheel",this.onWheel.bind(this));const e=isBrowserSafari();this.addManagedListener(this.eInput,"mousedown",()=>{this.isDisabled()||e||this.eInput.focus()}),this.eInput.step="any"}onWheel(e){document.activeElement===this.eInput&&e.preventDefault()}setMin(e){var t;const n=e instanceof Date?(t=serialiseDate(e??null,!1))!==null&&t!==void 0?t:void 0:e;return this.min===n?this:(this.min=n,addOrRemoveAttribute(this.eInput,"min",n),this)}setMax(e){var t;const n=e instanceof Date?(t=serialiseDate(e??null,!1))!==null&&t!==void 0?t:void 0:e;return this.max===n?this:(this.max=n,addOrRemoveAttribute(this.eInput,"max",n),this)}setStep(e){return this.step===e?this:(this.step=e,addOrRemoveAttribute(this.eInput,"step",e),this)}getDate(){var e;if(this.eInput.validity.valid)return(e=parseDateTimeFromString(this.getValue()))!==null&&e!==void 0?e:void 0}setDate(e,t){this.setValue(serialiseDate(e??null,!1),t)}}class AgInputRange extends AgAbstractInputField{constructor(e){super(e,"ag-range-field","range")}postConstruct(){super.postConstruct();const{min:e,max:t,step:n}=this.config;e!=null&&this.setMinValue(e),t!=null&&this.setMaxValue(t),this.setStep(n||1)}addInputListeners(){this.addManagedListener(this.eInput,"input",e=>{const t=e.target.value;this.setValue(t)})}setMinValue(e){return this.min=e,this.eInput.setAttribute("min",e.toString()),this}setMaxValue(e){return this.max=e,this.eInput.setAttribute("max",e.toString()),this}setStep(e){return this.eInput.setAttribute("step",e.toString()),this}setValue(e,t){this.min!=null&&(e=Math.max(parseFloat(e),this.min).toString()),this.max!=null&&(e=Math.min(parseFloat(e),this.max).toString());const n=super.setValue(e,t);return this.eInput.value=e,n}}var __decorate$Z=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class AgSlider extends AgAbstractLabel{constructor(e){super(e,AgSlider.TEMPLATE),this.labelAlignment="top"}init(){this.eSlider.addCssClass("ag-slider-field")}onValueChange(e){const t=AgAbstractField.EVENT_CHANGED;return this.addManagedListener(this.eText,t,()=>{const n=parseFloat(this.eText.getValue());this.eSlider.setValue(n.toString(),!0),e(n||0)}),this.addManagedListener(this.eSlider,t,()=>{const n=this.eSlider.getValue();this.eText.setValue(n,!0),e(parseFloat(n))}),this}setSliderWidth(e){return this.eSlider.setWidth(e),this}setTextFieldWidth(e){return this.eText.setWidth(e),this}setMinValue(e){return this.eSlider.setMinValue(e),this.eText.setMin(e),this}setMaxValue(e){return this.eSlider.setMaxValue(e),this.eText.setMax(e),this}getValue(){return this.eText.getValue()}setValue(e){return this.getValue()===e?this:(this.eText.setValue(e,!0),this.eSlider.setValue(e,!0),this.dispatchEvent({type:AgAbstractField.EVENT_CHANGED}),this)}setStep(e){return this.eSlider.setStep(e),this.eText.setStep(e),this}}AgSlider.TEMPLATE=`<div class="ag-slider">
            <label ref="eLabel"></label>
            <div class="ag-wrapper ag-slider-wrapper">
                <ag-input-range ref="eSlider"></ag-input-range>
                <ag-input-number-field ref="eText"></ag-input-number-field>
            </div>
        </div>`;__decorate$Z([RefSelector("eLabel")],AgSlider.prototype,"eLabel",void 0);__decorate$Z([RefSelector("eSlider")],AgSlider.prototype,"eSlider",void 0);__decorate$Z([RefSelector("eText")],AgSlider.prototype,"eText",void 0);__decorate$Z([PostConstruct],AgSlider.prototype,"init",null);var __decorate$Y=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class AgGroupComponent extends Component{constructor(e={}){super(AgGroupComponent.getTemplate(e)),this.suppressEnabledCheckbox=!0,this.suppressOpenCloseIcons=!1;const{title:t,enabled:n,items:o,suppressEnabledCheckbox:a,suppressOpenCloseIcons:l}=e;this.title=t,this.cssIdentifier=e.cssIdentifier||"default",this.enabled=n??!0,this.items=o||[],this.alignItems=e.alignItems||"center",a!=null&&(this.suppressEnabledCheckbox=a),l!=null&&(this.suppressOpenCloseIcons=l)}static getTemplate(e){const t=e.cssIdentifier||"default",n=e.direction||"vertical";return`<div class="ag-group ag-${t}-group" role="presentation">
            <div class="ag-group-title-bar ag-${t}-group-title-bar ag-unselectable" ref="eTitleBar" role="button">
                <span class="ag-group-title-bar-icon ag-${t}-group-title-bar-icon" ref="eGroupOpenedIcon" role="presentation"></span>
                <span class="ag-group-title-bar-icon ag-${t}-group-title-bar-icon" ref="eGroupClosedIcon" role="presentation"></span>
                <span ref="eTitle" class="ag-group-title ag-${t}-group-title"></span>
            </div>
            <div ref="eToolbar" class="ag-group-toolbar ag-${t}-group-toolbar">
                <ag-checkbox ref="cbGroupEnabled"></ag-checkbox>
            </div>
            <div ref="eContainer" class="ag-group-container ag-group-container-${n} ag-${t}-group-container"></div>
        </div>`}postConstruct(){if(this.items.length){const t=this.items;this.items=[],this.addItems(t)}const e=this.localeService.getLocaleTextFunc();this.cbGroupEnabled.setLabel(e("enabled","Enabled")),this.title&&this.setTitle(this.title),this.enabled&&this.setEnabled(this.enabled),this.setAlignItems(this.alignItems),this.hideEnabledCheckbox(this.suppressEnabledCheckbox),this.hideOpenCloseIcons(this.suppressOpenCloseIcons),this.setupExpandContract(),this.refreshAriaStatus(),this.refreshChildDisplay()}setupExpandContract(){this.eGroupClosedIcon.appendChild(createIcon("columnSelectClosed",this.gridOptionsService,null)),this.eGroupOpenedIcon.appendChild(createIcon("columnSelectOpen",this.gridOptionsService,null)),this.addManagedListener(this.eTitleBar,"click",()=>this.toggleGroupExpand()),this.addManagedListener(this.eTitleBar,"keydown",e=>{switch(e.key){case KeyCode.ENTER:case KeyCode.SPACE:e.preventDefault(),this.toggleGroupExpand();break;case KeyCode.RIGHT:case KeyCode.LEFT:e.preventDefault(),this.toggleGroupExpand(e.key===KeyCode.RIGHT);break}})}refreshAriaStatus(){this.suppressOpenCloseIcons||setAriaExpanded(this.eTitleBar,this.expanded)}refreshChildDisplay(){const e=!this.suppressOpenCloseIcons;setDisplayed(this.eToolbar,this.expanded&&!this.suppressEnabledCheckbox),setDisplayed(this.eGroupOpenedIcon,e&&this.expanded),setDisplayed(this.eGroupClosedIcon,e&&!this.expanded)}isExpanded(){return this.expanded}setAlignItems(e){this.alignItems!==e&&this.removeCssClass(`ag-group-item-alignment-${this.alignItems}`),this.alignItems=e;const t=`ag-group-item-alignment-${this.alignItems}`;return this.addCssClass(t),this}toggleGroupExpand(e){return this.suppressOpenCloseIcons?(this.expanded=!0,this.refreshChildDisplay(),setDisplayed(this.eContainer,!0),this):(e=e??!this.expanded,this.expanded===e?this:(this.expanded=e,this.refreshAriaStatus(),this.refreshChildDisplay(),setDisplayed(this.eContainer,e),this.dispatchEvent({type:this.expanded?AgGroupComponent.EVENT_EXPANDED:AgGroupComponent.EVENT_COLLAPSED}),this))}addItems(e){e.forEach(t=>this.addItem(t))}addItem(e){const t=this.eContainer,n=e instanceof Component?e.getGui():e;n.classList.add("ag-group-item",`ag-${this.cssIdentifier}-group-item`),t.appendChild(n),this.items.push(n)}hideItem(e,t){const n=this.items[t];setDisplayed(n,!e)}setTitle(e){return this.eTitle.innerText=e,this}addCssClassToTitleBar(e){this.eTitleBar.classList.add(e)}setEnabled(e,t){return this.enabled=e,this.refreshDisabledStyles(),this.toggleGroupExpand(e),t||this.cbGroupEnabled.setValue(e),this}isEnabled(){return this.enabled}onEnableChange(e){return this.cbGroupEnabled.onValueChange(t=>{this.setEnabled(t,!0),e(t)}),this}hideEnabledCheckbox(e){return this.suppressEnabledCheckbox=e,this.refreshChildDisplay(),this.refreshDisabledStyles(),this}hideOpenCloseIcons(e){return this.suppressOpenCloseIcons=e,e&&this.toggleGroupExpand(!0),this}refreshDisabledStyles(){this.addOrRemoveCssClass("ag-disabled",!this.enabled),this.suppressEnabledCheckbox&&!this.enabled?(this.eTitleBar.classList.add("ag-disabled-group-title-bar"),this.eTitleBar.removeAttribute("tabindex")):(this.eTitleBar.classList.remove("ag-disabled-group-title-bar"),this.eTitleBar.setAttribute("tabindex","0")),this.eContainer.classList.toggle("ag-disabled-group-container",!this.enabled)}}AgGroupComponent.EVENT_EXPANDED="expanded";AgGroupComponent.EVENT_COLLAPSED="collapsed";__decorate$Y([RefSelector("eTitleBar")],AgGroupComponent.prototype,"eTitleBar",void 0);__decorate$Y([RefSelector("eGroupOpenedIcon")],AgGroupComponent.prototype,"eGroupOpenedIcon",void 0);__decorate$Y([RefSelector("eGroupClosedIcon")],AgGroupComponent.prototype,"eGroupClosedIcon",void 0);__decorate$Y([RefSelector("eToolbar")],AgGroupComponent.prototype,"eToolbar",void 0);__decorate$Y([RefSelector("cbGroupEnabled")],AgGroupComponent.prototype,"cbGroupEnabled",void 0);__decorate$Y([RefSelector("eTitle")],AgGroupComponent.prototype,"eTitle",void 0);__decorate$Y([RefSelector("eContainer")],AgGroupComponent.prototype,"eContainer",void 0);__decorate$Y([PostConstruct],AgGroupComponent.prototype,"postConstruct",null);class TabGuardComp extends Component{initialiseTabGuard(e){this.eTopGuard=this.createTabGuard("top"),this.eBottomGuard=this.createTabGuard("bottom"),this.eFocusableElement=this.getFocusableElement();const t=[this.eTopGuard,this.eBottomGuard],n={setTabIndex:o=>{t.forEach(a=>o!=null?a.setAttribute("tabindex",o):a.removeAttribute("tabindex"))}};this.addTabGuards(this.eTopGuard,this.eBottomGuard),this.tabGuardCtrl=this.createManagedBean(new TabGuardCtrl({comp:n,eTopGuard:this.eTopGuard,eBottomGuard:this.eBottomGuard,eFocusableElement:this.eFocusableElement,onFocusIn:e.onFocusIn,onFocusOut:e.onFocusOut,focusInnerElement:e.focusInnerElement,handleKeyDown:e.handleKeyDown,onTabKeyDown:e.onTabKeyDown,shouldStopEventPropagation:e.shouldStopEventPropagation}))}createTabGuard(e){const t=document.createElement("div"),n=e==="top"?TabGuardClassNames.TAB_GUARD_TOP:TabGuardClassNames.TAB_GUARD_BOTTOM;return t.classList.add(TabGuardClassNames.TAB_GUARD,n),setAriaRole(t,"presentation"),t}addTabGuards(e,t){this.eFocusableElement.insertAdjacentElement("afterbegin",e),this.eFocusableElement.insertAdjacentElement("beforeend",t)}removeAllChildrenExceptTabGuards(){const e=[this.eTopGuard,this.eBottomGuard];clearElement(this.getFocusableElement()),this.addTabGuards(...e)}forceFocusOutOfContainer(e=!1){this.tabGuardCtrl.forceFocusOutOfContainer(e)}appendChild(e,t){isNodeOrElement(e)||(e=e.getGui());const{eBottomGuard:n}=this;n?n.insertAdjacentElement("beforebegin",e):super.appendChild(e,t)}}var __decorate$X=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class AgMenuList extends TabGuardComp{constructor(e=1){super('<div class="ag-menu-list" role="tree"></div>'),this.level=e,this.menuItems=[]}postConstruct(){this.initialiseTabGuard({onTabKeyDown:e=>this.onTabKeyDown(e),handleKeyDown:e=>this.handleKeyDown(e)})}onTabKeyDown(e){const t=this.getParentComponent(),n=t&&t.getGui();n&&n.classList.contains("ag-focus-managed")||e.preventDefault(),e.shiftKey&&this.closeIfIsChild(e)}handleKeyDown(e){switch(e.key){case KeyCode.UP:case KeyCode.RIGHT:case KeyCode.DOWN:case KeyCode.LEFT:e.preventDefault(),this.handleNavKey(e.key);break;case KeyCode.ESCAPE:const t=this.findTopMenu();t&&this.focusService.focusInto(t.getGui());break}}clearActiveItem(){this.activeMenuItem&&(this.activeMenuItem.deactivate(),this.activeMenuItem=null)}addMenuItems(e){e!=null&&e.forEach(t=>{t==="separator"?this.addSeparator():typeof t=="string"?console.warn(`AG Grid: unrecognised menu item ${t}`):this.addItem(t)})}addItem(e){const t=this.createManagedBean(new AgMenuItemComponent(Object.assign(Object.assign({},e),{isAnotherSubMenuOpen:()=>this.menuItems.some(n=>n.isSubMenuOpen())})));t.setParentComponent(this),setAriaLevel(t.getGui(),this.level),this.menuItems.push(t),this.appendChild(t.getGui()),this.addManagedListener(t,AgMenuItemComponent.EVENT_MENU_ITEM_SELECTED,n=>{this.dispatchEvent(n)}),this.addManagedListener(t,AgMenuItemComponent.EVENT_MENU_ITEM_ACTIVATED,n=>{this.activeMenuItem&&this.activeMenuItem!==n.menuItem&&this.activeMenuItem.deactivate(),this.activeMenuItem=n.menuItem})}activateFirstItem(){const e=this.menuItems.filter(t=>!t.isDisabled())[0];e&&e.activate()}addSeparator(){const e=`
            <div class="ag-menu-separator" aria-hidden="true">
                <div class="ag-menu-separator-part"></div>
                <div class="ag-menu-separator-part"></div>
                <div class="ag-menu-separator-part"></div>
                <div class="ag-menu-separator-part"></div>
            </div>`;this.appendChild(loadTemplate(e))}findTopMenu(){let e=this.getParentComponent();if(!e&&this instanceof AgMenuList)return this;for(;;){const t=e&&e.getParentComponent&&e.getParentComponent();if(!t||!(t instanceof AgMenuList||t instanceof AgMenuItemComponent))break;e=t}return e instanceof AgMenuList?e:void 0}handleNavKey(e){switch(e){case KeyCode.UP:case KeyCode.DOWN:const n=this.findNextItem(e===KeyCode.UP);n&&n!==this.activeMenuItem&&n.activate();return}const t=this.gridOptionsService.is("enableRtl")?KeyCode.RIGHT:KeyCode.LEFT;e===t?this.closeIfIsChild():this.openChild()}closeIfIsChild(e){const t=this.getParentComponent();t&&t instanceof AgMenuItemComponent&&(e&&e.preventDefault(),t.closeSubMenu(),t.getGui().focus())}openChild(){this.activeMenuItem&&this.activeMenuItem.openSubMenu(!0)}findNextItem(e){const t=this.menuItems.filter(a=>!a.isDisabled());if(!t.length)return;if(!this.activeMenuItem)return e?last(t):t[0];e&&t.reverse();let n,o=!1;for(let a=0;a<t.length;a++){const l=t[a];if(!o){l===this.activeMenuItem&&(o=!0);continue}n=l;break}return n||this.activeMenuItem}destroy(){this.clearActiveItem(),super.destroy()}}__decorate$X([Autowired("focusService")],AgMenuList.prototype,"focusService",void 0);__decorate$X([PostConstruct],AgMenuList.prototype,"postConstruct",null);var __decorate$W=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class AgMenuPanel extends TabGuardComp{constructor(e){super(),this.wrappedComponent=e,this.setTemplateFromElement(e.getGui())}postConstruct(){this.initialiseTabGuard({onTabKeyDown:e=>this.onTabKeyDown(e),handleKeyDown:e=>this.handleKeyDown(e)})}handleKeyDown(e){e.key===KeyCode.ESCAPE&&this.closePanel()}onTabKeyDown(e){e.defaultPrevented||(this.closePanel(),e.preventDefault())}closePanel(){const e=this.parentComponent;e.closeSubMenu(),setTimeout(()=>e.getGui().focus(),0)}}__decorate$W([PostConstruct],AgMenuPanel.prototype,"postConstruct",null);var __decorate$V=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class AgMenuItemComponent extends Component{constructor(e){super(),this.params=e,this.isActive=!1,this.subMenuIsOpen=!1,this.setTemplate(`<div class="${this.getClassName()}" tabindex="-1" role="treeitem"></div>`)}init(){this.addIcon(),this.addName(),this.addShortcut(),this.addSubMenu(),this.addTooltip();const e=this.getGui();this.params.disabled?(this.addCssClass(this.getClassName("disabled")),setAriaDisabled(e,!0)):(this.addGuiEventListener("click",t=>this.onItemSelected(t)),this.addGuiEventListener("keydown",t=>{(t.key===KeyCode.ENTER||t.key===KeyCode.SPACE)&&(t.preventDefault(),this.onItemSelected(t))}),this.addGuiEventListener("mousedown",t=>{t.stopPropagation(),t.preventDefault()}),this.addGuiEventListener("mouseenter",()=>this.onMouseEnter()),this.addGuiEventListener("mouseleave",()=>this.onMouseLeave())),this.params.cssClasses&&this.params.cssClasses.forEach(t=>this.addCssClass(t))}isDisabled(){return!!this.params.disabled}openSubMenu(e=!1){if(this.closeSubMenu(),!this.params.subMenu)return;const t=loadTemplate('<div class="ag-menu" role="presentation"></div>');let n;if(this.params.subMenu instanceof Array){const m=getAriaLevel(this.getGui()),y=isNaN(m)?1:m+1,D=this.createBean(new AgMenuList(y));D.setParentComponent(this),D.addMenuItems(this.params.subMenu),t.appendChild(D.getGui()),this.addManagedListener(D,AgMenuItemComponent.EVENT_MENU_ITEM_SELECTED,W=>this.dispatchEvent(W)),D.addGuiEventListener("mouseenter",()=>this.cancelDeactivate()),n=()=>this.destroyBean(D),e&&setTimeout(()=>D.activateFirstItem(),0)}else{const{subMenu:m}=this.params,y=this.createBean(new AgMenuPanel(m));y.setParentComponent(this);const D=y.getGui(),W="mouseenter",Ee=()=>this.cancelDeactivate();D.addEventListener(W,Ee),n=()=>D.removeEventListener(W,Ee),t.appendChild(D),m.afterGuiAttached&&setTimeout(()=>m.afterGuiAttached(),0)}const o=this.getGui(),a=this.popupService.positionPopupForMenu.bind(this.popupService,{eventSource:o,ePopup:t}),l=this.localeService.getLocaleTextFunc(),s=this.popupService.addPopup({modal:!0,eChild:t,positionCallback:a,anchorToElement:o,ariaLabel:l("ariaLabelSubMenu","SubMenu")});this.subMenuIsOpen=!0,setAriaExpanded(o,!0),this.hideSubMenu=()=>{s&&s.hideFunc(),this.subMenuIsOpen=!1,setAriaExpanded(o,!1),n()}}closeSubMenu(){this.hideSubMenu&&(this.hideSubMenu(),this.hideSubMenu=null,setAriaExpanded(this.getGui(),!1))}isSubMenuOpen(){return this.subMenuIsOpen}activate(e){this.cancelActivate(),!this.params.disabled&&(this.isActive=!0,this.addCssClass(this.getClassName("active")),this.getGui().focus(),e&&this.params.subMenu&&window.setTimeout(()=>{this.isAlive()&&this.isActive&&this.openSubMenu()},300),this.onItemActivated())}deactivate(){this.cancelDeactivate(),this.removeCssClass(this.getClassName("active")),this.isActive=!1,this.subMenuIsOpen&&this.hideSubMenu()}addIcon(){if(!this.params.checked&&!this.params.icon&&this.params.isCompact)return;const e=loadTemplate(`<span ref="eIcon" class="${this.getClassName("part")} ${this.getClassName("icon")}" role="presentation"></span>`);this.params.checked?e.appendChild(createIconNoSpan("check",this.gridOptionsService)):this.params.icon&&(isNodeOrElement(this.params.icon)?e.appendChild(this.params.icon):typeof this.params.icon=="string"?e.innerHTML=this.params.icon:console.warn("AG Grid: menu item icon must be DOM node or string")),this.getGui().appendChild(e)}addName(){if(!this.params.name&&this.params.isCompact)return;const e=loadTemplate(`<span ref="eName" class="${this.getClassName("part")} ${this.getClassName("text")}">${this.params.name||""}</span>`);this.getGui().appendChild(e)}addTooltip(){this.params.tooltip&&(this.tooltip=this.params.tooltip,this.gridOptionsService.is("enableBrowserTooltips")?this.getGui().setAttribute("title",this.tooltip):this.createManagedBean(new CustomTooltipFeature(this)))}getTooltipParams(){return{location:"menu",value:this.tooltip}}addShortcut(){if(!this.params.shortcut&&this.params.isCompact)return;const e=loadTemplate(`<span ref="eShortcut" class="${this.getClassName("part")} ${this.getClassName("shortcut")}">${this.params.shortcut||""}</span>`);this.getGui().appendChild(e)}addSubMenu(){if(!this.params.subMenu&&this.params.isCompact)return;const e=loadTemplate(`<span ref="ePopupPointer" class="${this.getClassName("part")} ${this.getClassName("popup-pointer")}"></span>`),t=this.getGui();if(this.params.subMenu){const n=this.gridOptionsService.is("enableRtl")?"smallLeft":"smallRight";setAriaExpanded(t,!1),e.appendChild(createIconNoSpan(n,this.gridOptionsService))}t.appendChild(e)}onItemSelected(e){if(this.params.action?this.params.action():this.openSubMenu(e&&e.type==="keydown"),this.params.subMenu&&!this.params.action)return;const t={type:AgMenuItemComponent.EVENT_MENU_ITEM_SELECTED,action:this.params.action,checked:this.params.checked,cssClasses:this.params.cssClasses,disabled:this.params.disabled,icon:this.params.icon,name:this.params.name,shortcut:this.params.shortcut,subMenu:this.params.subMenu,tooltip:this.params.tooltip,event:e};this.dispatchEvent(t)}onItemActivated(){const e={type:AgMenuItemComponent.EVENT_MENU_ITEM_ACTIVATED,menuItem:this};this.dispatchEvent(e)}cancelActivate(){this.activateTimeoutId&&(window.clearTimeout(this.activateTimeoutId),this.activateTimeoutId=0)}cancelDeactivate(){this.deactivateTimeoutId&&(window.clearTimeout(this.deactivateTimeoutId),this.deactivateTimeoutId=0)}onMouseEnter(){this.cancelDeactivate(),this.params.isAnotherSubMenuOpen()?this.activateTimeoutId=window.setTimeout(()=>this.activate(!0),AgMenuItemComponent.ACTIVATION_DELAY):this.activate(!0)}onMouseLeave(){this.cancelActivate(),this.isSubMenuOpen()?this.deactivateTimeoutId=window.setTimeout(()=>this.deactivate(),AgMenuItemComponent.ACTIVATION_DELAY):this.deactivate()}getClassName(e){const t=this.params.isCompact?"ag-compact-menu-option":"ag-menu-option";return e?`${t}-${e}`:t}}AgMenuItemComponent.EVENT_MENU_ITEM_SELECTED="menuItemSelected";AgMenuItemComponent.EVENT_MENU_ITEM_ACTIVATED="menuItemActivated";AgMenuItemComponent.ACTIVATION_DELAY=80;__decorate$V([Autowired("popupService")],AgMenuItemComponent.prototype,"popupService",void 0);__decorate$V([PostConstruct],AgMenuItemComponent.prototype,"init",null);var __decorate$U=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class AgPanel extends Component{constructor(e){super(AgPanel.getTemplate(e)),this.closable=!0,this.config=e}static getTemplate(e){const t=e&&e.cssIdentifier||"default";return`<div class="ag-panel ag-${t}-panel" tabindex="-1">
            <div ref="eTitleBar" class="ag-panel-title-bar ag-${t}-panel-title-bar ag-unselectable">
                <span ref="eTitle" class="ag-panel-title-bar-title ag-${t}-panel-title-bar-title"></span>
                <div ref="eTitleBarButtons" class="ag-panel-title-bar-buttons ag-${t}-panel-title-bar-buttons"></div>
            </div>
            <div ref="eContentWrapper" class="ag-panel-content-wrapper ag-${t}-panel-content-wrapper"></div>
        </div>`}postConstruct(){const{component:e,closable:t,hideTitleBar:n,title:o,minWidth:a=250,width:l,minHeight:s=250,height:m,centered:y,popup:D,x:W,y:Ee}=this.config;this.positionableFeature=new PositionableFeature(this.getGui(),{minWidth:a,width:l,minHeight:s,height:m,centered:y,x:W,y:Ee,popup:D,calculateTopBuffer:()=>this.positionableFeature.getHeight()-this.getBodyHeight()}),this.createManagedBean(this.positionableFeature);const dt=this.getGui();e&&this.setBodyComponent(e),n?setDisplayed(this.eTitleBar,!1):(o&&this.setTitle(o),this.setClosable(t??this.closable)),this.addManagedListener(this.eTitleBar,"mousedown",Ht=>{const ir=this.gridOptionsService.getDocument();if(dt.contains(Ht.relatedTarget)||dt.contains(ir.activeElement)||this.eTitleBarButtons.contains(Ht.target)){Ht.preventDefault();return}const Hr=this.eContentWrapper.querySelector("button, [href], input, select, textarea, [tabindex]");Hr&&Hr.focus()}),!(D&&this.positionableFeature.isPositioned())&&(this.renderComponent&&this.renderComponent(),this.positionableFeature.initialisePosition(),this.eContentWrapper.style.height="0")}renderComponent(){const e=this.getGui();e.focus(),this.close=()=>{e.parentElement.removeChild(e),this.destroy()}}getHeight(){return this.positionableFeature.getHeight()}setHeight(e){this.positionableFeature.setHeight(e)}getWidth(){return this.positionableFeature.getWidth()}setWidth(e){this.positionableFeature.setWidth(e)}setClosable(e){if(e!==this.closable&&(this.closable=e),e){const t=this.closeButtonComp=new Component(AgPanel.CLOSE_BTN_TEMPLATE);this.getContext().createBean(t);const n=t.getGui(),o=createIconNoSpan("close",this.gridOptionsService);o.classList.add("ag-panel-title-bar-button-icon"),n.appendChild(o),this.addTitleBarButton(t),t.addManagedListener(n,"click",this.onBtClose.bind(this))}else if(this.closeButtonComp){const t=this.closeButtonComp.getGui();t.parentElement.removeChild(t),this.closeButtonComp=this.destroyBean(this.closeButtonComp)}}setBodyComponent(e){e.setParentComponent(this),this.eContentWrapper.appendChild(e.getGui())}addTitleBarButton(e,t){const n=this.eTitleBarButtons,o=n.children,a=o.length;t==null&&(t=a),t=Math.max(0,Math.min(t,a)),e.addCssClass("ag-panel-title-bar-button");const l=e.getGui();t===0?n.insertAdjacentElement("afterbegin",l):t===a?n.insertAdjacentElement("beforeend",l):o[t-1].insertAdjacentElement("afterend",l),e.setParentComponent(this)}getBodyHeight(){return getInnerHeight(this.eContentWrapper)}getBodyWidth(){return getInnerWidth(this.eContentWrapper)}setTitle(e){this.eTitle.innerText=e}onBtClose(){this.close()}destroy(){this.closeButtonComp&&(this.closeButtonComp=this.destroyBean(this.closeButtonComp));const e=this.getGui();e&&e.offsetParent&&this.close(),super.destroy()}}AgPanel.CLOSE_BTN_TEMPLATE='<div class="ag-button"></div>';__decorate$U([RefSelector("eContentWrapper")],AgPanel.prototype,"eContentWrapper",void 0);__decorate$U([RefSelector("eTitleBar")],AgPanel.prototype,"eTitleBar",void 0);__decorate$U([RefSelector("eTitleBarButtons")],AgPanel.prototype,"eTitleBarButtons",void 0);__decorate$U([RefSelector("eTitle")],AgPanel.prototype,"eTitle",void 0);__decorate$U([PostConstruct],AgPanel.prototype,"postConstruct",null);var __decorate$T=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class AgDialog extends AgPanel{constructor(e){super(Object.assign(Object.assign({},e),{popup:!0})),this.isMaximizable=!1,this.isMaximized=!1,this.maximizeListeners=[],this.resizeListenerDestroy=null,this.lastPosition={x:0,y:0,width:0,height:0}}postConstruct(){const e=this.getGui(),{movable:t,resizable:n,maximizable:o}=this.config;this.addCssClass("ag-dialog"),super.postConstruct(),this.addManagedListener(e,"focusin",a=>{e.contains(a.relatedTarget)||this.popupService.bringPopupToFront(e)}),t&&this.setMovable(t),o&&this.setMaximizable(o),n&&this.setResizable(n)}renderComponent(){const e=this.getGui(),{alwaysOnTop:t,modal:n,title:o}=this.config,a=this.localeService.getLocaleTextFunc(),l=this.popupService.addPopup({modal:n,eChild:e,closeOnEsc:!0,closedCallback:this.destroy.bind(this),alwaysOnTop:t,ariaLabel:o||a("ariaLabelDialog","Dialog")});l&&(this.close=l.hideFunc)}toggleMaximize(){const e=this.positionableFeature.getPosition();if(this.isMaximized){const{x:t,y:n,width:o,height:a}=this.lastPosition;this.setWidth(o),this.setHeight(a),this.positionableFeature.offsetElement(t,n)}else this.lastPosition.width=this.getWidth(),this.lastPosition.height=this.getHeight(),this.lastPosition.x=e.x,this.lastPosition.y=e.y,this.positionableFeature.offsetElement(0,0),this.setHeight("100%"),this.setWidth("100%");this.isMaximized=!this.isMaximized,this.refreshMaximizeIcon()}refreshMaximizeIcon(){setDisplayed(this.maximizeIcon,!this.isMaximized),setDisplayed(this.minimizeIcon,this.isMaximized)}clearMaximizebleListeners(){this.maximizeListeners.length&&(this.maximizeListeners.forEach(e=>e()),this.maximizeListeners.length=0),this.resizeListenerDestroy&&(this.resizeListenerDestroy(),this.resizeListenerDestroy=null)}destroy(){this.maximizeButtonComp=this.destroyBean(this.maximizeButtonComp),this.clearMaximizebleListeners(),super.destroy()}setResizable(e){this.positionableFeature.setResizable(e)}setMovable(e){this.positionableFeature.setMovable(e,this.eTitleBar)}setMaximizable(e){if(!e){this.clearMaximizebleListeners(),this.maximizeButtonComp&&(this.destroyBean(this.maximizeButtonComp),this.maximizeButtonComp=this.maximizeIcon=this.minimizeIcon=void 0);return}const t=this.eTitleBar;if(!t||e===this.isMaximizable)return;const n=this.buildMaximizeAndMinimizeElements();this.refreshMaximizeIcon(),n.addManagedListener(n.getGui(),"click",this.toggleMaximize.bind(this)),this.addTitleBarButton(n,0),this.maximizeListeners.push(this.addManagedListener(t,"dblclick",this.toggleMaximize.bind(this))),this.resizeListenerDestroy=this.addManagedListener(this,"resize",()=>{this.isMaximized=!1,this.refreshMaximizeIcon()})}buildMaximizeAndMinimizeElements(){const e=this.maximizeButtonComp=this.createBean(new Component('<div class="ag-dialog-button"></span>')),t=e.getGui();return this.maximizeIcon=createIconNoSpan("maximize",this.gridOptionsService),t.appendChild(this.maximizeIcon),this.maximizeIcon.classList.add("ag-panel-title-bar-button-icon"),this.minimizeIcon=createIconNoSpan("minimize",this.gridOptionsService),t.appendChild(this.minimizeIcon),this.minimizeIcon.classList.add("ag-panel-title-bar-button-icon"),e}}__decorate$T([Autowired("popupService")],AgDialog.prototype,"popupService",void 0);var __decorate$S=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},PopupService_1,DIRECTION;(function(r){r[r.vertical=0]="vertical",r[r.horizontal=1]="horizontal"})(DIRECTION||(DIRECTION={}));let instanceIdSeq=0,PopupService=PopupService_1=class extends BeanStub{constructor(){super(...arguments),this.popupList=[]}postConstruct(){this.ctrlsService.whenReady(e=>{this.gridCtrl=e.gridCtrl,this.addManagedListener(this.gridCtrl,Events.EVENT_KEYBOARD_FOCUS,()=>{this.popupList.forEach(t=>t.element.classList.add(FocusService.AG_KEYBOARD_FOCUS))}),this.addManagedListener(this.gridCtrl,Events.EVENT_MOUSE_FOCUS,()=>{this.popupList.forEach(t=>t.element.classList.remove(FocusService.AG_KEYBOARD_FOCUS))})})}getPopupParent(){const e=this.gridOptionsService.get("popupParent");return e||this.gridCtrl.getGui()}positionPopupForMenu(e){const t=e.eventSource.getBoundingClientRect(),n=this.getParentRect(),o=this.keepXYWithinBounds(e.ePopup,t.top-n.top,DIRECTION.vertical),a=e.ePopup.clientWidth>0?e.ePopup.clientWidth:200;e.ePopup.style.minWidth=`${a}px`;const s=n.right-n.left-a;let m;this.gridOptionsService.is("enableRtl")?(m=D(),m<0&&(m=y()),m>s&&(m=0)):(m=y(),m>s&&(m=D()),m<0&&(m=0)),e.ePopup.style.left=`${m}px`,e.ePopup.style.top=`${o}px`;function y(){return t.right-n.left-2}function D(){return t.left-n.left-a}}positionPopupUnderMouseEvent(e){const{ePopup:t,nudgeX:n,nudgeY:o,skipObserver:a}=e;this.positionPopup({ePopup:t,nudgeX:n,nudgeY:o,keepWithinBounds:!0,skipObserver:a,updatePosition:()=>this.calculatePointerAlign(e.mouseEvent),postProcessCallback:()=>this.callPostProcessPopup(e.type,e.ePopup,null,e.mouseEvent,e.column,e.rowNode)})}calculatePointerAlign(e){const t=this.getParentRect();return{x:e.clientX-t.left,y:e.clientY-t.top}}positionPopupByComponent(e){const t=e.eventSource.getBoundingClientRect(),n=e.alignSide||"left",o=e.position||"over",a=this.getParentRect(),l=()=>{let s=t.left-a.left;n==="right"&&(s-=e.ePopup.offsetWidth-t.width);const m=o==="over"?t.top-a.top:t.top-a.top+t.height;return{x:s,y:m}};this.positionPopup({ePopup:e.ePopup,nudgeX:e.nudgeX,nudgeY:e.nudgeY,keepWithinBounds:e.keepWithinBounds,updatePosition:l,postProcessCallback:()=>this.callPostProcessPopup(e.type,e.ePopup,e.eventSource,null,e.column,e.rowNode)})}callPostProcessPopup(e,t,n,o,a,l){const s=this.gridOptionsService.getCallback("postProcessPopup");s&&s({column:a,rowNode:l,ePopup:t,type:e,eventSource:n,mouseEvent:o})}positionPopup(e){const{ePopup:t,keepWithinBounds:n,nudgeX:o,nudgeY:a,skipObserver:l,updatePosition:s}=e,m={width:0,height:0},y=(D=!1)=>{let{x:W,y:Ee}=s();D&&t.clientWidth===m.width&&t.clientHeight===m.height||(m.width=t.clientWidth,m.height=t.clientHeight,o&&(W+=o),a&&(Ee+=a),n&&(W=this.keepXYWithinBounds(t,W,DIRECTION.horizontal),Ee=this.keepXYWithinBounds(t,Ee,DIRECTION.vertical)),t.style.left=`${W}px`,t.style.top=`${Ee}px`,e.postProcessCallback&&e.postProcessCallback())};if(y(),!l){const D=this.resizeObserverService.observeResize(t,()=>y(!0));setTimeout(()=>D(),PopupService_1.WAIT_FOR_POPUP_CONTENT_RESIZE)}}getActivePopups(){return this.popupList.map(e=>e.element)}getPopupList(){return this.popupList}getParentRect(){const e=this.gridOptionsService.getDocument();let t=this.getPopupParent();return t===e.body?t=e.documentElement:getComputedStyle(t).position==="static"&&(t=t.offsetParent),getElementRectWithOffset(t)}keepXYWithinBounds(e,t,n){const o=n===DIRECTION.vertical,a=o?"clientHeight":"clientWidth",l=o?"top":"left",s=o?"offsetHeight":"offsetWidth",m=o?"scrollTop":"scrollLeft",y=this.gridOptionsService.getDocument(),D=y.documentElement,W=this.getPopupParent(),Ee=W.getBoundingClientRect(),dt=y.documentElement.getBoundingClientRect(),Ht=W===y.body,ir=e[s];let Bn=Ht?(o?getAbsoluteHeight:getAbsoluteWidth)(D)+D[m]:W[a];Ht&&(Bn-=Math.abs(dt[l]-Ee[l]));const Vn=Bn-ir;return Math.min(Math.max(t,0),Math.abs(Vn))}addPopup(e){const t=this.gridOptionsService.getDocument(),{eChild:n,ariaLabel:o,alwaysOnTop:a,positionCallback:l,anchorToElement:s}=e;if(!t)return console.warn("AG Grid: could not find the document, document is empty"),{hideFunc:()=>{}};const m=this.popupList.findIndex(W=>W.element===n);if(m!==-1)return{hideFunc:this.popupList[m].hideFunc};this.initialisePopupPosition(n);const y=this.createPopupWrapper(n,o,!!a),D=this.addEventListenersToPopup(Object.assign(Object.assign({},e),{wrapperEl:y}));return l&&l(),this.addPopupToPopupList(n,y,D,s),{hideFunc:D}}initialisePopupPosition(e){const n=this.getPopupParent().getBoundingClientRect();exists(e.style.top)||(e.style.top=`${n.top*-1}px`),exists(e.style.left)||(e.style.left=`${n.left*-1}px`)}createPopupWrapper(e,t,n){const o=this.getPopupParent(),a=document.createElement("div"),{allThemes:l}=this.environment.getTheme();return l.length&&a.classList.add(...l),a.classList.add("ag-popup"),e.classList.add(this.gridOptionsService.is("enableRtl")?"ag-rtl":"ag-ltr","ag-popup-child"),e.hasAttribute("role")||setAriaRole(e,"dialog"),setAriaLabel(e,t),this.focusService.isKeyboardMode()&&e.classList.add(FocusService.AG_KEYBOARD_FOCUS),a.appendChild(e),o.appendChild(a),n?this.setAlwaysOnTop(e,!0):this.bringPopupToFront(e),a}addEventListenersToPopup(e){const t=this.gridOptionsService.getDocument(),n=this.getPopupParent(),{wrapperEl:o,eChild:a,click:l,closedCallback:s,afterGuiAttached:m,closeOnEsc:y,modal:D}=e;let W=!1;const Ee=Hr=>{if(!o.contains(t.activeElement))return;Hr.key===KeyCode.ESCAPE&&ir({keyboardEvent:Hr})},dt=Hr=>ir({mouseEvent:Hr}),Ht=Hr=>ir({touchEvent:Hr}),ir=(Hr={})=>{const{mouseEvent:Bn,touchEvent:Vn,keyboardEvent:Wr}=Hr;this.isEventFromCurrentPopup({mouseEvent:Bn,touchEvent:Vn},a)||this.isEventSameChainAsOriginalEvent({originalMouseEvent:l,mouseEvent:Bn,touchEvent:Vn})||W||(W=!0,n.removeChild(o),t.removeEventListener("keydown",Ee),t.removeEventListener("mousedown",dt),t.removeEventListener("touchstart",Ht),t.removeEventListener("contextmenu",dt),this.eventService.removeEventListener(Events.EVENT_DRAG_STARTED,dt),s&&s(Bn||Vn||Wr),this.removePopupFromPopupList(a))};return m&&m({hidePopup:ir}),window.setTimeout(()=>{y&&t.addEventListener("keydown",Ee),D&&(t.addEventListener("mousedown",dt),this.eventService.addEventListener(Events.EVENT_DRAG_STARTED,dt),t.addEventListener("touchstart",Ht),t.addEventListener("contextmenu",dt))},0),ir}addPopupToPopupList(e,t,n,o){this.popupList.push({element:e,wrapper:t,hideFunc:n,instanceId:instanceIdSeq++,isAnchored:!!o}),o&&this.setPopupPositionRelatedToElement(e,o)}setPopupPositionRelatedToElement(e,t){const n=this.popupList.find(a=>a.element===e);if(!n||(n.stopAnchoringPromise&&n.stopAnchoringPromise.then(a=>a&&a()),n.stopAnchoringPromise=void 0,n.isAnchored=!1,!t))return;const o=this.keepPopupPositionedRelativeTo({element:t,ePopup:e,hidePopup:n.hideFunc});return n.stopAnchoringPromise=o,n.isAnchored=!0,o}removePopupFromPopupList(e){this.setPopupPositionRelatedToElement(e,null),this.popupList=this.popupList.filter(t=>t.element!==e)}keepPopupPositionedRelativeTo(e){const t=this.getPopupParent(),n=t.getBoundingClientRect(),{element:o,ePopup:a}=e,l=o.getBoundingClientRect(),s=n.top-l.top,m=n.left-l.left;let y=s,D=m;const W=a.style.top,Ee=parseInt(W.substring(0,W.length-1),10),dt=a.style.left,Ht=parseInt(dt.substring(0,dt.length-1),10);return new AgPromise(ir=>{this.getFrameworkOverrides().setInterval(()=>{const Hr=t.getBoundingClientRect(),Bn=o.getBoundingClientRect();if(Bn.top==0&&Bn.left==0&&Bn.height==0&&Bn.width==0){e.hidePopup();return}const Wr=Hr.top-Bn.top;if(Wr!=y){const il=this.keepXYWithinBounds(a,Ee+s-Wr,DIRECTION.vertical);a.style.top=`${il}px`}y=Wr;const ps=Hr.left-Bn.left;if(ps!=D){const il=this.keepXYWithinBounds(a,Ht+m-ps,DIRECTION.horizontal);a.style.left=`${il}px`}D=ps},200).then(Hr=>{ir(()=>{Hr!=null&&window.clearInterval(Hr)})})})}hasAnchoredPopup(){return this.popupList.some(e=>e.isAnchored)}isEventFromCurrentPopup(e,t){const{mouseEvent:n,touchEvent:o}=e,a=n||o;if(!a)return!1;const l=this.popupList.findIndex(s=>s.element===t);if(l===-1)return!1;for(let s=l;s<this.popupList.length;s++){const m=this.popupList[s];if(isElementInEventPath(m.element,a))return!0}return this.isElementWithinCustomPopup(a.target)}isElementWithinCustomPopup(e){const t=this.gridOptionsService.getDocument();for(;e&&e!==t.body;){if(e.classList.contains("ag-custom-component-popup")||e.parentElement===null)return!0;e=e.parentElement}return!1}isEventSameChainAsOriginalEvent(e){const{originalMouseEvent:t,mouseEvent:n,touchEvent:o}=e;let a=null;if(n?a=n:o&&(a=o.touches[0]),a&&t){const l=n?n.screenX:0,s=n?n.screenY:0,m=Math.abs(t.screenX-l)<5,y=Math.abs(t.screenY-s)<5;if(m&&y)return!0}return!1}getWrapper(e){for(;!e.classList.contains("ag-popup")&&e.parentElement;)e=e.parentElement;return e.classList.contains("ag-popup")?e:null}setAlwaysOnTop(e,t){const n=this.getWrapper(e);n&&(n.classList.toggle("ag-always-on-top",!!t),t&&this.bringPopupToFront(n))}bringPopupToFront(e){const t=this.getPopupParent(),n=Array.prototype.slice.call(t.querySelectorAll(".ag-popup")),o=n.length,a=Array.prototype.slice.call(t.querySelectorAll(".ag-popup.ag-always-on-top")),l=a.length,s=this.getWrapper(e);if(!s||o<=1||!t.contains(e))return;const m=n.indexOf(s),y=s.querySelectorAll("div"),D=[];for(y.forEach(Ee=>{Ee.scrollTop!==0&&D.push([Ee,Ee.scrollTop])}),l?s.classList.contains("ag-always-on-top")?m!==o-1&&last(a).insertAdjacentElement("afterend",s):m!==o-l-1&&a[0].insertAdjacentElement("beforebegin",s):m!==o-1&&last(n).insertAdjacentElement("afterend",s);D.length;){const Ee=D.pop();Ee[0].scrollTop=Ee[1]}const W={type:"popupToFront",api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,eWrapper:s};this.eventService.dispatchEvent(W)}};PopupService.WAIT_FOR_POPUP_CONTENT_RESIZE=200;__decorate$S([Autowired("focusService")],PopupService.prototype,"focusService",void 0);__decorate$S([Autowired("ctrlsService")],PopupService.prototype,"ctrlsService",void 0);__decorate$S([Autowired("resizeObserverService")],PopupService.prototype,"resizeObserverService",void 0);__decorate$S([PostConstruct],PopupService.prototype,"postConstruct",null);PopupService=PopupService_1=__decorate$S([Bean("popupService")],PopupService);var __decorate$R=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class VirtualList extends TabGuardComp{constructor(e="default",t="listbox",n){super(VirtualList.getTemplate(e)),this.cssIdentifier=e,this.ariaRole=t,this.listName=n,this.renderedRows=new Map,this.rowHeight=20}postConstruct(){this.addScrollListener(),this.rowHeight=this.getItemHeight(),this.addResizeObserver(),this.initialiseTabGuard({onFocusIn:e=>this.onFocusIn(e),onFocusOut:e=>this.onFocusOut(e),focusInnerElement:e=>this.focusInnerElement(e),onTabKeyDown:e=>this.onTabKeyDown(e),handleKeyDown:e=>this.handleKeyDown(e)}),this.setAriaProperties(),this.addManagedListener(this.eventService,Events.EVENT_GRID_STYLES_CHANGED,this.onGridStylesChanged.bind(this))}onGridStylesChanged(){this.rowHeight=this.getItemHeight(),this.refresh()}setAriaProperties(){const t=this.localeService.getLocaleTextFunc()("ariaDefaultListName",this.listName||"List"),n=this.eContainer;setAriaRole(n,this.ariaRole),setAriaLabel(n,t)}addResizeObserver(){const e=()=>this.drawVirtualRows(),t=this.resizeObserverService.observeResize(this.getGui(),e);this.addDestroyFunc(t)}focusInnerElement(e){this.focusRow(e?this.model.getRowCount()-1:0)}onFocusIn(e){const t=e.target;return t.classList.contains("ag-virtual-list-item")&&(this.lastFocusedRowIndex=getAriaPosInSet(t)-1),!1}onFocusOut(e){return this.getFocusableElement().contains(e.relatedTarget)||(this.lastFocusedRowIndex=null),!1}handleKeyDown(e){switch(e.key){case KeyCode.UP:case KeyCode.DOWN:this.navigate(e.key===KeyCode.UP)&&e.preventDefault();break}}onTabKeyDown(e){this.navigate(e.shiftKey)?e.preventDefault():(stopPropagationForAgGrid(e),this.forceFocusOutOfContainer(e.shiftKey))}navigate(e){if(this.lastFocusedRowIndex==null)return!1;const t=this.lastFocusedRowIndex+(e?-1:1);return t<0||t>=this.model.getRowCount()?!1:(this.focusRow(t),!0)}getLastFocusedRow(){return this.lastFocusedRowIndex}focusRow(e){this.ensureIndexVisible(e),window.setTimeout(()=>{if(!this.isAlive())return;const t=this.renderedRows.get(e);t&&t.eDiv.focus()},10)}getComponentAt(e){const t=this.renderedRows.get(e);return t&&t.rowComponent}forEachRenderedRow(e){this.renderedRows.forEach((t,n)=>e(t.rowComponent,n))}static getTemplate(e){return`
            <div class="ag-virtual-list-viewport ag-${e}-virtual-list-viewport" role="presentation">
                <div class="ag-virtual-list-container ag-${e}-virtual-list-container" ref="eContainer"></div>
            </div>`}getItemHeight(){return this.environment.getListItemHeight()}ensureIndexVisible(e){const t=this.model.getRowCount();if(typeof e!="number"||e<0||e>=t){console.warn("AG Grid: invalid row index for ensureIndexVisible: "+e);return}const n=e*this.rowHeight,o=n+this.rowHeight,a=this.getGui(),l=a.scrollTop,s=a.offsetHeight,m=l+s,y=l>n,D=m<o;if(y)a.scrollTop=n;else if(D){const W=o-s;a.scrollTop=W}}setComponentCreator(e){this.componentCreator=e}setComponentUpdater(e){this.componentUpdater=e}getRowHeight(){return this.rowHeight}getScrollTop(){return this.getGui().scrollTop}setRowHeight(e){this.rowHeight=e,this.refresh()}refresh(e){if(this.model==null||!this.isAlive())return;const t=this.model.getRowCount();this.eContainer.style.height=`${t*this.rowHeight}px`,waitUntil(()=>this.eContainer.clientHeight>=t*this.rowHeight,()=>{this.isAlive()&&(this.canSoftRefresh(e)?this.drawVirtualRows(!0):(this.clearVirtualRows(),this.drawVirtualRows()))})}canSoftRefresh(e){return!!(e&&this.renderedRows.size&&typeof this.model.areRowsEqual=="function"&&this.componentUpdater)}clearVirtualRows(){this.renderedRows.forEach((e,t)=>this.removeRow(t))}drawVirtualRows(e){if(!this.isAlive())return;const t=this.getGui(),n=t.scrollTop,o=n+t.offsetHeight,a=Math.floor(n/this.rowHeight),l=Math.floor(o/this.rowHeight);this.ensureRowsRendered(a,l,e)}ensureRowsRendered(e,t,n){this.renderedRows.forEach((o,a)=>{(a<e||a>t)&&a!==this.lastFocusedRowIndex&&this.removeRow(a)}),n&&this.refreshRows();for(let o=e;o<=t;o++)this.renderedRows.has(o)||o<this.model.getRowCount()&&this.insertRow(o)}insertRow(e){const t=this.model.getRow(e),n=document.createElement("div");if(n.classList.add("ag-virtual-list-item",`ag-${this.cssIdentifier}-virtual-list-item`),setAriaRole(n,this.ariaRole==="tree"?"treeitem":"option"),setAriaSetSize(n,this.model.getRowCount()),setAriaPosInSet(n,e+1),n.setAttribute("tabindex","-1"),typeof this.model.isRowSelected=="function"){const a=this.model.isRowSelected(e);setAriaSelected(n,!!a),setAriaChecked(n,a)}n.style.height=`${this.rowHeight}px`,n.style.top=`${this.rowHeight*e}px`;const o=this.componentCreator(t,n);o.addGuiEventListener("focusin",()=>this.lastFocusedRowIndex=e),n.appendChild(o.getGui()),this.renderedRows.has(e-1)?this.renderedRows.get(e-1).eDiv.insertAdjacentElement("afterend",n):this.renderedRows.has(e+1)?this.renderedRows.get(e+1).eDiv.insertAdjacentElement("beforebegin",n):this.eContainer.appendChild(n),this.renderedRows.set(e,{rowComponent:o,eDiv:n,value:t})}removeRow(e){const t=this.renderedRows.get(e);this.eContainer.removeChild(t.eDiv),this.destroyBean(t.rowComponent),this.renderedRows.delete(e)}refreshRows(){const e=this.model.getRowCount();this.renderedRows.forEach((t,n)=>{var o,a;if(n>=e)this.removeRow(n);else{const l=this.model.getRow(n);!((a=(o=this.model).areRowsEqual)===null||a===void 0)&&a.call(o,t.value,l)?this.componentUpdater(l,t.rowComponent):this.removeRow(n)}})}addScrollListener(){this.addGuiEventListener("scroll",()=>this.drawVirtualRows(),{passive:!0})}setModel(e){this.model=e}destroy(){this.isAlive()&&(this.clearVirtualRows(),super.destroy())}}__decorate$R([Autowired("resizeObserverService")],VirtualList.prototype,"resizeObserverService",void 0);__decorate$R([RefSelector("eContainer")],VirtualList.prototype,"eContainer",void 0);__decorate$R([PostConstruct],VirtualList.prototype,"postConstruct",null);const OUTSIDE_ANGULAR_EVENTS=["mouseover","mouseout","mouseenter","mouseleave","mousemove"],PASSIVE_EVENTS=["touchstart","touchend","touchmove","touchcancel"];class VanillaFrameworkOverrides{constructor(){this.renderingEngine="vanilla",this.isOutsideAngular=e=>includes(OUTSIDE_ANGULAR_EVENTS,e)}setTimeout(e,t){window.setTimeout(e,t)}setInterval(e,t){return new AgPromise(n=>{n(window.setInterval(e,t))})}addEventListener(e,t,n,o){const a=includes(PASSIVE_EVENTS,t);e.addEventListener(t,n,{capture:!!o,passive:a})}dispatchEvent(e,t,n=!1){t()}frameworkComponent(e){return null}isFrameworkComponent(e){return!1}}var __decorate$Q=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let CellNavigationService=class extends BeanStub{getNextCellToFocus(e,t,n=!1){return n?this.getNextCellToFocusWithCtrlPressed(e,t):this.getNextCellToFocusWithoutCtrlPressed(e,t)}getNextCellToFocusWithCtrlPressed(e,t){const n=e===KeyCode.UP,o=e===KeyCode.DOWN,a=e===KeyCode.LEFT;let l,s;if(n||o)s=n?this.paginationProxy.getPageFirstRow():this.paginationProxy.getPageLastRow(),l=t.column;else{const m=this.columnModel.getAllDisplayedColumns(),y=this.gridOptionsService.is("enableRtl");s=t.rowIndex,l=a!==y?m[0]:last(m)}return{rowIndex:s,rowPinned:null,column:l}}getNextCellToFocusWithoutCtrlPressed(e,t){let n=t,o=!1;for(;!o;){switch(e){case KeyCode.UP:n=this.getCellAbove(n);break;case KeyCode.DOWN:n=this.getCellBelow(n);break;case KeyCode.RIGHT:this.gridOptionsService.is("enableRtl")?n=this.getCellToLeft(n):n=this.getCellToRight(n);break;case KeyCode.LEFT:this.gridOptionsService.is("enableRtl")?n=this.getCellToRight(n):n=this.getCellToLeft(n);break;default:n=null,console.warn("AG Grid: unknown key for navigation "+e);break}n?o=this.isCellGoodToFocusOn(n):o=!0}return n}isCellGoodToFocusOn(e){const t=e.column;let n;switch(e.rowPinned){case"top":n=this.pinnedRowModel.getPinnedTopRow(e.rowIndex);break;case"bottom":n=this.pinnedRowModel.getPinnedBottomRow(e.rowIndex);break;default:n=this.rowModel.getRow(e.rowIndex);break}return n?!t.isSuppressNavigable(n):!1}getCellToLeft(e){if(!e)return null;const t=this.columnModel.getDisplayedColBefore(e.column);return t?{rowIndex:e.rowIndex,column:t,rowPinned:e.rowPinned}:null}getCellToRight(e){if(!e)return null;const t=this.columnModel.getDisplayedColAfter(e.column);return t?{rowIndex:e.rowIndex,column:t,rowPinned:e.rowPinned}:null}getRowBelow(e){const t=e.rowIndex,n=e.rowPinned;if(this.isLastRowInContainer(e))switch(n){case"bottom":return null;case"top":return this.rowModel.isRowsToRender()?{rowIndex:this.paginationProxy.getPageFirstRow(),rowPinned:null}:this.pinnedRowModel.isRowsToRender("bottom")?{rowIndex:0,rowPinned:"bottom"}:null;default:return this.pinnedRowModel.isRowsToRender("bottom")?{rowIndex:0,rowPinned:"bottom"}:null}const o=this.rowModel.getRow(e.rowIndex),a=this.getNextStickyPosition(o);return a||{rowIndex:t+1,rowPinned:n}}getNextStickyPosition(e,t){if(!this.gridOptionsService.isGroupRowsSticky()||!e||!e.sticky)return;const n=[...this.rowRenderer.getStickyTopRowCtrls()].sort((s,m)=>s.getRowNode().rowIndex-m.getRowNode().rowIndex),o=t?-1:1,a=n.findIndex(s=>s.getRowNode().rowIndex===e.rowIndex),l=n[a+o];if(l)return{rowIndex:l.getRowNode().rowIndex,rowPinned:null}}getCellBelow(e){if(!e)return null;const t=this.getRowBelow(e);return t?{rowIndex:t.rowIndex,column:e.column,rowPinned:t.rowPinned}:null}isLastRowInContainer(e){const t=e.rowPinned,n=e.rowIndex;return t==="top"?this.pinnedRowModel.getPinnedTopRowData().length-1<=n:t==="bottom"?this.pinnedRowModel.getPinnedBottomRowData().length-1<=n:this.paginationProxy.getPageLastRow()<=n}getRowAbove(e){const t=e.rowIndex,n=e.rowPinned;if(n?t===0:t===this.paginationProxy.getPageFirstRow())return n==="top"?null:n?this.rowModel.isRowsToRender()?this.getLastBodyCell():this.pinnedRowModel.isRowsToRender("top")?this.getLastFloatingTopRow():null:this.pinnedRowModel.isRowsToRender("top")?this.getLastFloatingTopRow():null;const a=this.rowModel.getRow(e.rowIndex),l=this.getNextStickyPosition(a,!0);return l||{rowIndex:t-1,rowPinned:n}}getCellAbove(e){if(!e)return null;const t=this.getRowAbove({rowIndex:e.rowIndex,rowPinned:e.rowPinned});return t?{rowIndex:t.rowIndex,column:e.column,rowPinned:t.rowPinned}:null}getLastBodyCell(){return{rowIndex:this.paginationProxy.getPageLastRow(),rowPinned:null}}getLastFloatingTopRow(){return{rowIndex:this.pinnedRowModel.getPinnedTopRowData().length-1,rowPinned:"top"}}getNextTabbedCell(e,t){return t?this.getNextTabbedCellBackwards(e):this.getNextTabbedCellForwards(e)}getNextTabbedCellForwards(e){const t=this.columnModel.getAllDisplayedColumns();let n=e.rowIndex,o=e.rowPinned,a=this.columnModel.getDisplayedColAfter(e.column);if(!a){a=t[0];const l=this.getRowBelow(e);if(missing(l)||!l.rowPinned&&!this.paginationProxy.isRowInPage(l))return null;n=l?l.rowIndex:null,o=l?l.rowPinned:null}return{rowIndex:n,column:a,rowPinned:o}}getNextTabbedCellBackwards(e){const t=this.columnModel.getAllDisplayedColumns();let n=e.rowIndex,o=e.rowPinned,a=this.columnModel.getDisplayedColBefore(e.column);if(!a){a=last(t);const l=this.getRowAbove({rowIndex:e.rowIndex,rowPinned:e.rowPinned});if(missing(l)||!l.rowPinned&&!this.paginationProxy.isRowInPage(l))return null;n=l?l.rowIndex:null,o=l?l.rowPinned:null}return{rowIndex:n,column:a,rowPinned:o}}};__decorate$Q([Autowired("columnModel")],CellNavigationService.prototype,"columnModel",void 0);__decorate$Q([Autowired("rowModel")],CellNavigationService.prototype,"rowModel",void 0);__decorate$Q([Autowired("rowRenderer")],CellNavigationService.prototype,"rowRenderer",void 0);__decorate$Q([Autowired("pinnedRowModel")],CellNavigationService.prototype,"pinnedRowModel",void 0);__decorate$Q([Autowired("paginationProxy")],CellNavigationService.prototype,"paginationProxy",void 0);CellNavigationService=__decorate$Q([Bean("cellNavigationService")],CellNavigationService);var __decorate$P=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},__param$6=function(r,e){return function(t,n){e(t,n,r)}};let AlignedGridsService=class extends BeanStub{constructor(){super(...arguments),this.consuming=!1}setBeans(e){this.logger=e.create("AlignedGridsService")}init(){this.addManagedListener(this.eventService,Events.EVENT_COLUMN_MOVED,this.fireColumnEvent.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_VISIBLE,this.fireColumnEvent.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_PINNED,this.fireColumnEvent.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_GROUP_OPENED,this.fireColumnEvent.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_RESIZED,this.fireColumnEvent.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_BODY_SCROLL,this.fireScrollEvent.bind(this))}fireEvent(e){if(this.consuming)return;const t=this.gridOptionsService.get("alignedGrids");t&&t.forEach(n=>{if(n.api){const o=n.api.__getAlignedGridService();e(o)}})}onEvent(e){this.consuming=!0,e(),this.consuming=!1}fireColumnEvent(e){this.fireEvent(t=>{t.onColumnEvent(e)})}fireScrollEvent(e){e.direction==="horizontal"&&this.fireEvent(t=>{t.onScrollEvent(e)})}onScrollEvent(e){this.onEvent(()=>{this.ctrlsService.getGridBodyCtrl().getScrollFeature().setHorizontalScrollPosition(e.left,!0)})}getMasterColumns(e){const t=[];return e.columns?e.columns.forEach(n=>{t.push(n)}):e.column&&t.push(e.column),t}getColumnIds(e){const t=[];return e.columns?e.columns.forEach(n=>{t.push(n.getColId())}):e.column&&t.push(e.column.getColId()),t}onColumnEvent(e){this.onEvent(()=>{switch(e.type){case Events.EVENT_COLUMN_MOVED:case Events.EVENT_COLUMN_VISIBLE:case Events.EVENT_COLUMN_PINNED:case Events.EVENT_COLUMN_RESIZED:const t=e;this.processColumnEvent(t);break;case Events.EVENT_COLUMN_GROUP_OPENED:const n=e;this.processGroupOpenedEvent(n);break;case Events.EVENT_COLUMN_PIVOT_CHANGED:console.warn("AG Grid: pivoting is not supported with aligned grids. You can only use one of these features at a time in a grid.");break}})}processGroupOpenedEvent(e){const t=e.columnGroup;let n=null;if(t){const o=t.getGroupId();n=this.columnModel.getProvidedColumnGroup(o)}t&&!n||(this.logger.log("onColumnEvent-> processing "+e+" expanded = "+t.isExpanded()),this.columnModel.setColumnGroupOpened(n,t.isExpanded(),"alignedGridChanged"))}processColumnEvent(e){var t;const n=e.column;let o=null;if(n&&(o=this.columnModel.getPrimaryColumn(n.getColId())),n&&!o)return;const a=this.getMasterColumns(e);switch(e.type){case Events.EVENT_COLUMN_MOVED:{const W=e,dt=e.columnApi.getColumnState().map(Ht=>({colId:Ht.colId}));this.columnModel.applyColumnState({state:dt,applyOrder:!0},"alignedGridChanged"),this.logger.log(`onColumnEvent-> processing ${e.type} toIndex = ${W.toIndex}`)}break;case Events.EVENT_COLUMN_VISIBLE:{const W=e,dt=e.columnApi.getColumnState().map(Ht=>({colId:Ht.colId,hide:Ht.hide}));this.columnModel.applyColumnState({state:dt},"alignedGridChanged"),this.logger.log(`onColumnEvent-> processing ${e.type} visible = ${W.visible}`)}break;case Events.EVENT_COLUMN_PINNED:{const W=e,dt=e.columnApi.getColumnState().map(Ht=>({colId:Ht.colId,pinned:Ht.pinned}));this.columnModel.applyColumnState({state:dt},"alignedGridChanged"),this.logger.log(`onColumnEvent-> processing ${e.type} pinned = ${W.pinned}`)}break;case Events.EVENT_COLUMN_RESIZED:const y=e,D={};a.forEach(W=>{this.logger.log(`onColumnEvent-> processing ${e.type} actualWidth = ${W.getActualWidth()}`),D[W.getId()]={key:W.getColId(),newWidth:W.getActualWidth()}}),(t=y.flexColumns)===null||t===void 0||t.forEach(W=>{D[W.getId()]&&delete D[W.getId()]}),this.columnModel.setColumnWidths(Object.values(D),!1,y.finished,"alignedGridChanged");break}const s=this.ctrlsService.getGridBodyCtrl().isVerticalScrollShowing(),m=this.gridOptionsService.get("alignedGrids");m&&m.forEach(y=>{y.api&&y.api.setAlwaysShowVerticalScroll(s)})}};__decorate$P([Autowired("columnModel")],AlignedGridsService.prototype,"columnModel",void 0);__decorate$P([Autowired("ctrlsService")],AlignedGridsService.prototype,"ctrlsService",void 0);__decorate$P([__param$6(0,Qualifier("loggerFactory"))],AlignedGridsService.prototype,"setBeans",null);__decorate$P([PostConstruct],AlignedGridsService.prototype,"init",null);AlignedGridsService=__decorate$P([Bean("alignedGridsService")],AlignedGridsService);var __decorate$O=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},__param$5=function(r,e){return function(t,n){e(t,n,r)}};let SelectionService=class extends BeanStub{setBeans(e){this.logger=e.create("selectionService"),this.reset()}init(){this.groupSelectsChildren=this.gridOptionsService.is("groupSelectsChildren"),this.addManagedPropertyListener("groupSelectsChildren",e=>this.groupSelectsChildren=e.currentValue),this.rowSelection=this.gridOptionsService.get("rowSelection"),this.addManagedPropertyListener("rowSelection",e=>this.rowSelection=e.currentValue),this.addManagedListener(this.eventService,Events.EVENT_ROW_SELECTED,this.onRowSelected.bind(this))}isMultiselect(){return this.rowSelection==="multiple"}setNodesSelected(e){var t;if(e.nodes.length===0)return 0;const{newValue:n,clearSelection:o,suppressFinishActions:a,rangeSelect:l,event:s,source:m="api"}=e;if(e.nodes.length>1&&!this.isMultiselect())return console.warn("AG Grid: cannot multi select while rowSelection='single'"),0;const y=this.groupSelectsChildren&&e.groupSelectsFiltered===!0,D=e.nodes.map(Ee=>Ee.footer?Ee.sibling:Ee);if(l){if(e.nodes.length>1)return console.warn("AG Grid: cannot range select while selecting multiple rows"),0;const Ee=this.getLastSelectedNode();if(Ee){const dt=D[0];if(Ee!==dt&&this.isMultiselect()){const ir=this.selectRange(dt,Ee,e.newValue,m);return this.setLastSelectedNode(dt),ir}}}let W=0;for(let Ee=0;Ee<D.length;Ee++){const dt=D[Ee];y&&dt.group||dt.selectThisNode(n,e.event,m)&&W++,this.groupSelectsChildren&&(!((t=dt.childrenAfterGroup)===null||t===void 0)&&t.length)&&(W+=this.selectChildren(dt,n,y,m))}if(!a){if(n&&(o||!this.isMultiselect())&&(W+=this.clearOtherNodes(D[0],m)),W>0){this.updateGroupsFromChildrenSelections(m);const dt={type:Events.EVENT_SELECTION_CHANGED,source:m};this.eventService.dispatchEvent(dt)}n&&this.setLastSelectedNode(D[D.length-1])}return W}selectRange(e,t,n=!0,o){const a=this.rowModel.getNodesInRangeForSelection(e,t);let l=0;a.forEach(m=>{if(m.group&&this.groupSelectsChildren||n===!1&&e===m)return;m.selectThisNode(n,void 0,o)&&l++}),this.updateGroupsFromChildrenSelections(o);const s={type:Events.EVENT_SELECTION_CHANGED,source:o};return this.eventService.dispatchEvent(s),l}selectChildren(e,t,n,o){const a=n?e.childrenAfterAggFilter:e.childrenAfterGroup;return _.missing(a)?0:this.setNodesSelected({newValue:t,clearSelection:!1,suppressFinishActions:!0,groupSelectsFiltered:n,source:o,nodes:a})}setLastSelectedNode(e){this.lastSelectedNode=e}getLastSelectedNode(){return this.lastSelectedNode}getSelectedNodes(){const e=[];return iterateObject(this.selectedNodes,(t,n)=>{n&&e.push(n)}),e}getSelectedRows(){const e=[];return iterateObject(this.selectedNodes,(t,n)=>{n&&n.data&&e.push(n.data)}),e}getSelectionCount(){return Object.values(this.selectedNodes).length}filterFromSelection(e){const t={};Object.entries(this.selectedNodes).forEach(([n,o])=>{o&&e(o)&&(t[n]=o)}),this.selectedNodes=t}updateGroupsFromChildrenSelections(e,t){if(!this.groupSelectsChildren||this.rowModel.getType()!=="clientSide")return!1;const o=this.rowModel.getRootNode();t||(t=new ChangedPath(!0,o),t.setInactive());let a=!1;return t.forEachChangedNodeDepthFirst(l=>{if(l!==o){const s=l.calculateSelectedFromChildren();a=l.selectThisNode(s===null?!1:s,void 0,e)||a}}),a}clearOtherNodes(e,t){const n={};let o=0;return iterateObject(this.selectedNodes,(a,l)=>{if(l&&l.id!==e.id){const s=this.selectedNodes[l.id];o+=s.setSelectedParams({newValue:!1,clearSelection:!1,suppressFinishActions:!0,source:t}),this.groupSelectsChildren&&l.parent&&(n[l.parent.id]=l.parent)}}),iterateObject(n,(a,l)=>{const s=l.calculateSelectedFromChildren();l.selectThisNode(s===null?!1:s,void 0,t)}),o}onRowSelected(e){const t=e.node;this.groupSelectsChildren&&t.group||(t.isSelected()?this.selectedNodes[t.id]=t:delete this.selectedNodes[t.id])}syncInRowNode(e,t){this.syncInOldRowNode(e,t),this.syncInNewRowNode(e)}syncInOldRowNode(e,t){if(exists(t)&&e.id!==t.id&&t){const o=t.id;this.selectedNodes[o]==e&&(this.selectedNodes[t.id]=t)}}syncInNewRowNode(e){exists(this.selectedNodes[e.id])?(e.setSelectedInitialValue(!0),this.selectedNodes[e.id]=e):e.setSelectedInitialValue(!1)}reset(){this.logger.log("reset"),this.selectedNodes={},this.lastSelectedNode=null}getBestCostNodeSelection(){if(this.rowModel.getType()!=="clientSide")return;const t=this.rowModel.getTopLevelNodes();if(t===null)return;const n=[];function o(a){for(let l=0,s=a.length;l<s;l++){const m=a[l];if(m.isSelected())n.push(m);else{const y=m;y.group&&y.children&&o(y.children)}}}return o(t),n}isEmpty(){let e=0;return iterateObject(this.selectedNodes,(t,n)=>{n&&e++}),e===0}deselectAllRowNodes(e){const t=m=>m.selectThisNode(!1,void 0,o),n=this.rowModel.getType()==="clientSide",{source:o,justFiltered:a,justCurrentPage:l}=e;if(l||a){if(!n){console.error("AG Grid: selecting just filtered only works when gridOptions.rowModelType='clientSide'");return}this.getNodesToSelect(a,l).forEach(t)}else iterateObject(this.selectedNodes,(m,y)=>{y&&t(y)}),this.reset();n&&this.groupSelectsChildren&&this.updateGroupsFromChildrenSelections(o);const s={type:Events.EVENT_SELECTION_CHANGED,source:o};this.eventService.dispatchEvent(s)}getSelectAllState(e,t){let n=0,o=0;const a=l=>{this.groupSelectsChildren&&l.group||(l.isSelected()?n++:l.selectable&&o++)};return this.getNodesToSelect(e,t).forEach(a),n===0&&o===0?!1:n>0&&o>0?null:n>0}getNodesToSelect(e=!1,t=!1){if(this.rowModel.getType()!=="clientSide")throw new Error(`selectAll only available when rowModelType='clientSide', ie not ${this.rowModel.getType()}`);const n=[];if(t)return this.paginationProxy.forEachNodeOnPage(a=>{if(!a.group){n.push(a);return}if(!a.expanded){const l=s=>{var m;n.push(s),!((m=s.childrenAfterFilter)===null||m===void 0)&&m.length&&s.childrenAfterFilter.forEach(l)};l(a);return}this.groupSelectsChildren||n.push(a)}),n;const o=this.rowModel;return e?(o.forEachNodeAfterFilter(a=>{n.push(a)}),n):(o.forEachNode(a=>{n.push(a)}),n)}selectAllRowNodes(e){if(this.rowModel.getType()!=="clientSide")throw new Error(`selectAll only available when rowModelType='clientSide', ie not ${this.rowModel.getType()}`);const{source:t,justFiltered:n,justCurrentPage:o}=e,a=s=>s.selectThisNode(!0,void 0,t);this.getNodesToSelect(n,o).forEach(a),this.rowModel.getType()==="clientSide"&&this.groupSelectsChildren&&this.updateGroupsFromChildrenSelections(t);const l={type:Events.EVENT_SELECTION_CHANGED,source:t};this.eventService.dispatchEvent(l)}getServerSideSelectionState(){return null}setServerSideSelectionState(e){}};__decorate$O([Autowired("rowModel")],SelectionService.prototype,"rowModel",void 0);__decorate$O([Autowired("paginationProxy")],SelectionService.prototype,"paginationProxy",void 0);__decorate$O([__param$5(0,Qualifier("loggerFactory"))],SelectionService.prototype,"setBeans",null);__decorate$O([PostConstruct],SelectionService.prototype,"init",null);SelectionService=__decorate$O([Bean("selectionService")],SelectionService);var __decorate$N=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let ColumnApi=class{sizeColumnsToFit(e){typeof e>"u"&&console.error("AG Grid: missing parameter to columnApi.sizeColumnsToFit(gridWidth)"),this.columnModel.sizeColumnsToFit(e,"api")}setColumnGroupOpened(e,t){this.columnModel.setColumnGroupOpened(e,t,"api")}getColumnGroup(e,t){return this.columnModel.getColumnGroup(e,t)}getProvidedColumnGroup(e){return this.columnModel.getProvidedColumnGroup(e)}getDisplayNameForColumn(e,t){return this.columnModel.getDisplayNameForColumn(e,t)||""}getDisplayNameForColumnGroup(e,t){return this.columnModel.getDisplayNameForColumnGroup(e,t)||""}getColumn(e){return this.columnModel.getPrimaryColumn(e)}getColumns(){return this.columnModel.getAllPrimaryColumns()}applyColumnState(e){return this.columnModel.applyColumnState(e,"api")}getColumnState(){return this.columnModel.getColumnState()}resetColumnState(){this.columnModel.resetColumnState("api")}getColumnGroupState(){return this.columnModel.getColumnGroupState()}setColumnGroupState(e){this.columnModel.setColumnGroupState(e,"api")}resetColumnGroupState(){this.columnModel.resetColumnGroupState("api")}isPinning(){return this.columnModel.isPinningLeft()||this.columnModel.isPinningRight()}isPinningLeft(){return this.columnModel.isPinningLeft()}isPinningRight(){return this.columnModel.isPinningRight()}getDisplayedColAfter(e){return this.columnModel.getDisplayedColAfter(e)}getDisplayedColBefore(e){return this.columnModel.getDisplayedColBefore(e)}setColumnVisible(e,t){this.columnModel.setColumnVisible(e,t,"api")}setColumnsVisible(e,t){this.columnModel.setColumnsVisible(e,t,"api")}setColumnPinned(e,t){this.columnModel.setColumnPinned(e,t,"api")}setColumnsPinned(e,t){this.columnModel.setColumnsPinned(e,t,"api")}getAllGridColumns(){return this.columnModel.getAllGridColumns()}getDisplayedLeftColumns(){return this.columnModel.getDisplayedLeftColumns()}getDisplayedCenterColumns(){return this.columnModel.getDisplayedCenterColumns()}getDisplayedRightColumns(){return this.columnModel.getDisplayedRightColumns()}getAllDisplayedColumns(){return this.columnModel.getAllDisplayedColumns()}getAllDisplayedVirtualColumns(){return this.columnModel.getViewportColumns()}moveColumn(e,t){this.columnModel.moveColumn(e,t,"api")}moveColumnByIndex(e,t){this.columnModel.moveColumnByIndex(e,t,"api")}moveColumns(e,t){this.columnModel.moveColumns(e,t,"api")}moveRowGroupColumn(e,t){this.columnModel.moveRowGroupColumn(e,t)}setColumnAggFunc(e,t){this.columnModel.setColumnAggFunc(e,t)}setColumnWidth(e,t,n=!0,o){this.columnModel.setColumnWidths([{key:e,newWidth:t}],!1,n,o)}setColumnWidths(e,t=!0,n){this.columnModel.setColumnWidths(e,!1,t,n)}setPivotMode(e){this.columnModel.setPivotMode(e)}isPivotMode(){return this.columnModel.isPivotMode()}getPivotResultColumn(e,t){return this.columnModel.getSecondaryPivotColumn(e,t)}setValueColumns(e){this.columnModel.setValueColumns(e,"api")}getValueColumns(){return this.columnModel.getValueColumns()}removeValueColumn(e){this.columnModel.removeValueColumn(e,"api")}removeValueColumns(e){this.columnModel.removeValueColumns(e,"api")}addValueColumn(e){this.columnModel.addValueColumn(e,"api")}addValueColumns(e){this.columnModel.addValueColumns(e,"api")}setRowGroupColumns(e){this.columnModel.setRowGroupColumns(e,"api")}removeRowGroupColumn(e){this.columnModel.removeRowGroupColumn(e,"api")}removeRowGroupColumns(e){this.columnModel.removeRowGroupColumns(e,"api")}addRowGroupColumn(e){this.columnModel.addRowGroupColumn(e,"api")}addRowGroupColumns(e){this.columnModel.addRowGroupColumns(e,"api")}getRowGroupColumns(){return this.columnModel.getRowGroupColumns()}setPivotColumns(e){this.columnModel.setPivotColumns(e,"api")}removePivotColumn(e){this.columnModel.removePivotColumn(e,"api")}removePivotColumns(e){this.columnModel.removePivotColumns(e,"api")}addPivotColumn(e){this.columnModel.addPivotColumn(e,"api")}addPivotColumns(e){this.columnModel.addPivotColumns(e,"api")}getPivotColumns(){return this.columnModel.getPivotColumns()}getLeftDisplayedColumnGroups(){return this.columnModel.getDisplayedTreeLeft()}getCenterDisplayedColumnGroups(){return this.columnModel.getDisplayedTreeCentre()}getRightDisplayedColumnGroups(){return this.columnModel.getDisplayedTreeRight()}getAllDisplayedColumnGroups(){return this.columnModel.getAllDisplayedTrees()}autoSizeColumn(e,t){return this.columnModel.autoSizeColumn(e,t,"api")}autoSizeColumns(e,t){this.columnModel.autoSizeColumns({columns:e,skipHeader:t})}autoSizeAllColumns(e){this.columnModel.autoSizeAllColumns(e,"api")}setPivotResultColumns(e){this.columnModel.setSecondaryColumns(e,"api")}getPivotResultColumns(){return this.columnModel.getSecondaryColumns()}cleanDownReferencesToAvoidMemoryLeakInCaseApplicationIsKeepingReferenceToDestroyedGrid(){setTimeout(_.removeAllReferences.bind(window,this,"Column API"),100)}getAllColumns(){return logDeprecation("28.0","getAllColumns","getColumns"),this.getColumns()}getPrimaryColumns(){return logDeprecation("28.0","getPrimaryColumns","getColumns"),this.getColumns()}getSecondaryColumns(){return logDeprecation("28.0","getSecondaryColumns","getPivotResultColumns"),this.getPivotResultColumns()}setSecondaryColumns(e){logDeprecation("28.0","setSecondaryColumns","setPivotResultColumns"),this.setPivotResultColumns(e)}getSecondaryPivotColumn(e,t){return logDeprecation("28.0","getSecondaryPivotColumn","getPivotResultColumn"),this.getPivotResultColumn(e,t)}};__decorate$N([Autowired("columnModel")],ColumnApi.prototype,"columnModel",void 0);__decorate$N([PreDestroy],ColumnApi.prototype,"cleanDownReferencesToAvoidMemoryLeakInCaseApplicationIsKeepingReferenceToDestroyedGrid",null);ColumnApi=__decorate$N([Bean("columnApi")],ColumnApi);var __decorate$M=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let ValueService=class extends BeanStub{constructor(){super(...arguments),this.initialised=!1,this.isSsrm=!1}init(){this.isSsrm=this.gridOptionsService.isRowModelType("serverSide"),this.cellExpressions=this.gridOptionsService.is("enableCellExpressions"),this.isTreeData=this.gridOptionsService.is("treeData"),this.initialised=!0,this.eventService.addEventListener(Events.EVENT_CELL_VALUE_CHANGED,e=>this.callColumnCellValueChangedHandler(e),this.gridOptionsService.useAsyncEvents()),this.addManagedPropertyListener("treeData",e=>this.isTreeData=e.currentValue)}getValue(e,t,n=!1,o=!1){if(this.initialised||this.init(),!t)return;const a=e.getColDef(),l=a.field,s=e.getColId(),m=t.data;let y;const D=t.groupData&&t.groupData[s]!==void 0,W=!o&&t.aggData&&t.aggData[s]!==void 0,Ee=this.isSsrm&&o&&!!e.getColDef().aggFunc,dt=this.isSsrm&&t.footer&&t.field&&(e.getColDef().showRowGroup===!0||e.getColDef().showRowGroup===t.field);if(n&&a.filterValueGetter?y=this.executeFilterValueGetter(a.filterValueGetter,m,e,t):this.isTreeData&&W?y=t.aggData[s]:this.isTreeData&&a.valueGetter?y=this.executeValueGetter(a.valueGetter,m,e,t):this.isTreeData&&l&&m?y=getValueUsingField(m,l,e.isFieldContainsDots()):D?y=t.groupData[s]:W?y=t.aggData[s]:a.valueGetter?y=this.executeValueGetter(a.valueGetter,m,e,t):dt?y=getValueUsingField(m,t.field,e.isFieldContainsDots()):l&&m&&!Ee&&(y=getValueUsingField(m,l,e.isFieldContainsDots())),this.cellExpressions&&typeof y=="string"&&y.indexOf("=")===0){const Ht=y.substring(1);y=this.executeValueGetter(Ht,m,e,t)}if(y==null){const Ht=this.getOpenedGroup(t,e);if(Ht!=null)return Ht}return y}getOpenedGroup(e,t){if(!this.gridOptionsService.is("showOpenedGroup")||!t.getColDef().showRowGroup)return;const o=t.getColDef().showRowGroup;let a=e.parent;for(;a!=null;){if(a.rowGroupColumn&&(o===!0||o===a.rowGroupColumn.getColId()))return a.key;a=a.parent}}setValue(e,t,n,o){const a=this.columnModel.getPrimaryColumn(t);if(!e||!a)return!1;missing(e.data)&&(e.data={});const{field:l,valueSetter:s}=a.getColDef();if(missing(l)&&missing(s))return console.warn("AG Grid: you need either field or valueSetter set on colDef for editing to work"),!1;if(!this.dataTypeService.checkType(a,n))return console.warn("AG Grid: Data type of the new value does not match the cell data type of the column"),!1;const m={node:e,data:e.data,oldValue:this.getValue(a,e),newValue:n,colDef:a.getColDef(),column:a,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context};m.newValue=n;let y;if(exists(s)?typeof s=="function"?y=s(m):y=this.expressionService.evaluate(s,m):y=this.setValueUsingField(e.data,l,n,a.isFieldContainsDots()),y===void 0&&(y=!0),!y)return!1;e.resetQuickFilterAggregateText(),this.valueCache.onDataChanged(),m.newValue=this.getValue(a,e);const D={type:Events.EVENT_CELL_VALUE_CHANGED,event:null,rowIndex:e.rowIndex,rowPinned:e.rowPinned,column:m.column,api:m.api,columnApi:m.columnApi,colDef:m.colDef,context:m.context,data:e.data,node:e,oldValue:m.oldValue,newValue:m.newValue,value:m.newValue,source:o};return this.eventService.dispatchEvent(D),!0}callColumnCellValueChangedHandler(e){const t=e.colDef.onCellValueChanged;typeof t=="function"&&t({node:e.node,data:e.data,oldValue:e.oldValue,newValue:e.newValue,colDef:e.colDef,column:e.column,api:e.api,columnApi:e.columnApi,context:e.context})}setValueUsingField(e,t,n,o){if(!t)return!1;let a=!1;if(!o)a=e[t]==n,a||(e[t]=n);else{const l=t.split(".");let s=e;for(;l.length>0&&s;){const m=l.shift();l.length===0?(a=s[m]==n,a||(s[m]=n)):s=s[m]}}return!a}executeFilterValueGetter(e,t,n,o){const a={data:t,node:o,column:n,colDef:n.getColDef(),api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context,getValue:this.getValueCallback.bind(this,o)};return typeof e=="function"?e(a):this.expressionService.evaluate(e,a)}executeValueGetter(e,t,n,o){const a=n.getColId(),l=this.valueCache.getValue(o,a);if(l!==void 0)return l;const s={data:t,node:o,column:n,colDef:n.getColDef(),api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context,getValue:this.getValueCallback.bind(this,o)};let m;return typeof e=="function"?m=e(s):m=this.expressionService.evaluate(e,s),this.valueCache.setValue(o,a,m),m}getValueCallback(e,t){const n=this.columnModel.getPrimaryColumn(t);return n?this.getValue(n,e):null}getKeyForNode(e,t){const n=this.getValue(e,t),o=e.getColDef().keyCreator;let a=n;if(o){const l={value:n,colDef:e.getColDef(),column:e,node:t,data:t.data,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context};a=o(l)}return typeof a=="string"||a==null||(a=String(a),a==="[object Object]"&&doOnce(()=>{console.warn("AG Grid: a column you are grouping or pivoting by has objects as values. If you want to group by complex objects then either a) use a colDef.keyCreator (se AG Grid docs) or b) to toString() on the object to return a key")},"getKeyForNode - warn about [object,object]")),a}};__decorate$M([Autowired("expressionService")],ValueService.prototype,"expressionService",void 0);__decorate$M([Autowired("columnModel")],ValueService.prototype,"columnModel",void 0);__decorate$M([Autowired("valueCache")],ValueService.prototype,"valueCache",void 0);__decorate$M([Autowired("dataTypeService")],ValueService.prototype,"dataTypeService",void 0);__decorate$M([PostConstruct],ValueService.prototype,"init",null);ValueService=__decorate$M([Bean("valueService")],ValueService);var __decorate$L=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},__param$4=function(r,e){return function(t,n){e(t,n,r)}};let ExpressionService=class extends BeanStub{constructor(){super(...arguments),this.expressionToFunctionCache={}}setBeans(e){this.logger=e.create("ExpressionService")}evaluate(e,t){if(typeof e=="string")return this.evaluateExpression(e,t);console.error("AG Grid: value should be either a string or a function",e)}evaluateExpression(e,t){try{return this.createExpressionFunction(e)(t.value,t.context,t.oldValue,t.newValue,t.value,t.node,t.data,t.colDef,t.rowIndex,t.api,t.columnApi,t.getValue,t.column,t.columnGroup)}catch(n){return console.log("Processing of the expression failed"),console.log("Expression = "+e),console.log("Params =",t),console.log("Exception = "+n),null}}createExpressionFunction(e){if(this.expressionToFunctionCache[e])return this.expressionToFunctionCache[e];const t=this.createFunctionBody(e),n=new Function("x, ctx, oldValue, newValue, value, node, data, colDef, rowIndex, api, columnApi, getValue, column, columnGroup",t);return this.expressionToFunctionCache[e]=n,n}createFunctionBody(e){return e.indexOf("return")>=0?e:"return "+e+";"}};__decorate$L([__param$4(0,Qualifier("loggerFactory"))],ExpressionService.prototype,"setBeans",null);ExpressionService=__decorate$L([Bean("expressionService")],ExpressionService);var __decorate$K=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let TemplateService=class extends BeanStub{constructor(){super(...arguments),this.templateCache={},this.waitingCallbacks={}}getTemplate(e,t){const n=this.templateCache[e];if(n)return n;let o=this.waitingCallbacks[e];const a=this;if(!o){o=[],this.waitingCallbacks[e]=o;const l=new XMLHttpRequest;l.onload=function(){a.handleHttpResult(this,e)},l.open("GET",e),l.send()}return t&&o.push(t),null}handleHttpResult(e,t){if(e.status!==200||e.response===null){console.warn(`AG Grid: Unable to get template error ${e.status} - ${t}`);return}this.templateCache[t]=e.response||e.responseText;const n=this.waitingCallbacks[t];for(let o=0;o<n.length;o++){const a=n[o];a()}}};TemplateService=__decorate$K([Bean("templateService")],TemplateService);var __decorate$J=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},__param$3=function(r,e){return function(t,n){e(t,n,r)}};let LoggerFactory=class extends BeanStub{setBeans(e){this.logging=e.is("debug")}create(e){return new Logger(e,this.isLogging.bind(this))}isLogging(){return this.logging}};__decorate$J([__param$3(0,Qualifier("gridOptionsService"))],LoggerFactory.prototype,"setBeans",null);LoggerFactory=__decorate$J([Bean("loggerFactory")],LoggerFactory);class Logger{constructor(e,t){this.name=e,this.isLoggingFunc=t}isLogging(){return this.isLoggingFunc()}log(e){this.isLoggingFunc()&&console.log("AG Grid."+this.name+": "+e)}}var __decorate$I=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class GridCtrl extends BeanStub{setComp(e,t,n){this.view=e,this.eGridHostDiv=t,this.eGui=n,this.eGui.setAttribute("grid-id",this.context.getGridId()),this.dragAndDropService.addDropTarget({getContainer:()=>this.eGui,isInterestedIn:a=>a===DragSourceType.HeaderCell||a===DragSourceType.ToolPanel,getIconName:()=>DragAndDropService.ICON_NOT_ALLOWED}),this.mouseEventService.stampTopLevelGridCompWithGridInstance(t),this.createManagedBean(new LayoutFeature(this.view)),this.addRtlSupport(),this.addManagedListener(this,Events.EVENT_KEYBOARD_FOCUS,()=>{this.view.addOrRemoveKeyboardFocusClass(!0)}),this.addManagedListener(this,Events.EVENT_MOUSE_FOCUS,()=>{this.view.addOrRemoveKeyboardFocusClass(!1)});const o=this.resizeObserverService.observeResize(this.eGridHostDiv,this.onGridSizeChanged.bind(this));this.addDestroyFunc(()=>o()),this.ctrlsService.registerGridCtrl(this)}isDetailGrid(){var e;const t=this.focusService.findTabbableParent(this.getGui());return((e=t==null?void 0:t.getAttribute("row-id"))===null||e===void 0?void 0:e.startsWith("detail"))||!1}showDropZones(){return ModuleRegistry.__isRegistered(ModuleNames.RowGroupingModule,this.context.getGridId())}showSideBar(){return ModuleRegistry.__isRegistered(ModuleNames.SideBarModule,this.context.getGridId())}showStatusBar(){return ModuleRegistry.__isRegistered(ModuleNames.StatusBarModule,this.context.getGridId())}showWatermark(){return ModuleRegistry.__isRegistered(ModuleNames.EnterpriseCoreModule,this.context.getGridId())}onGridSizeChanged(){const e={type:Events.EVENT_GRID_SIZE_CHANGED,clientWidth:this.eGridHostDiv.clientWidth,clientHeight:this.eGridHostDiv.clientHeight};this.eventService.dispatchEvent(e)}addRtlSupport(){const e=this.gridOptionsService.is("enableRtl")?"ag-rtl":"ag-ltr";this.view.setRtlClass(e)}destroyGridUi(){this.view.destroyGridUi()}getGui(){return this.eGui}setResizeCursor(e){this.view.setCursor(e?"ew-resize":null)}disableUserSelect(e){this.view.setUserSelect(e?"none":null)}focusNextInnerContainer(e){const t=this.gridOptionsService.getDocument(),n=this.view.getFocusableContainers(),a=n.findIndex(l=>l.contains(t.activeElement))+(e?-1:1);return a<=0||a>=n.length?!1:this.focusService.focusInto(n[a])}focusInnerElement(e){const t=this.view.getFocusableContainers(),n=this.columnModel.getAllDisplayedColumns();if(e){if(t.length>1)return this.focusService.focusInto(last(t),!0);const o=last(n);if(this.focusService.focusGridView(o,!0))return!0}return this.gridOptionsService.getNum("headerHeight")===0?this.focusService.focusGridView(n[0]):this.focusService.focusFirstHeader()}forceFocusOutOfContainer(e=!1){this.view.forceFocusOutOfContainer(e)}}__decorate$I([Autowired("focusService")],GridCtrl.prototype,"focusService",void 0);__decorate$I([Autowired("resizeObserverService")],GridCtrl.prototype,"resizeObserverService",void 0);__decorate$I([Autowired("columnModel")],GridCtrl.prototype,"columnModel",void 0);__decorate$I([Autowired("ctrlsService")],GridCtrl.prototype,"ctrlsService",void 0);__decorate$I([Autowired("mouseEventService")],GridCtrl.prototype,"mouseEventService",void 0);__decorate$I([Autowired("dragAndDropService")],GridCtrl.prototype,"dragAndDropService",void 0);var __decorate$H=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class GridComp extends TabGuardComp{constructor(e){super(),this.eGridDiv=e}postConstruct(){this.logger=this.loggerFactory.create("GridComp");const e={destroyGridUi:()=>this.destroyBean(this),setRtlClass:n=>this.addCssClass(n),addOrRemoveKeyboardFocusClass:n=>this.addOrRemoveCssClass(FocusService.AG_KEYBOARD_FOCUS,n),forceFocusOutOfContainer:this.forceFocusOutOfContainer.bind(this),updateLayoutClasses:this.updateLayoutClasses.bind(this),getFocusableContainers:this.getFocusableContainers.bind(this),setUserSelect:n=>{this.getGui().style.userSelect=n??"",this.getGui().style.webkitUserSelect=n??""},setCursor:n=>{this.getGui().style.cursor=n??""}};this.ctrl=this.createManagedBean(new GridCtrl);const t=this.createTemplate();this.setTemplate(t),this.ctrl.setComp(e,this.eGridDiv,this.getGui()),this.insertGridIntoDom(),this.initialiseTabGuard({onTabKeyDown:()=>{},focusInnerElement:n=>this.ctrl.focusInnerElement(n)})}insertGridIntoDom(){const e=this.getGui();this.eGridDiv.appendChild(e),this.addDestroyFunc(()=>{this.eGridDiv.removeChild(e),this.logger.log("Grid removed from DOM")})}updateLayoutClasses(e,t){const n=this.eRootWrapperBody.classList;n.toggle(LayoutCssClasses.AUTO_HEIGHT,t.autoHeight),n.toggle(LayoutCssClasses.NORMAL,t.normal),n.toggle(LayoutCssClasses.PRINT,t.print),this.addOrRemoveCssClass(LayoutCssClasses.AUTO_HEIGHT,t.autoHeight),this.addOrRemoveCssClass(LayoutCssClasses.NORMAL,t.normal),this.addOrRemoveCssClass(LayoutCssClasses.PRINT,t.print)}createTemplate(){const e=this.ctrl.showDropZones()?"<ag-grid-header-drop-zones></ag-grid-header-drop-zones>":"",t=this.ctrl.showSideBar()?'<ag-side-bar ref="sideBar"></ag-side-bar>':"",n=this.ctrl.showStatusBar()?'<ag-status-bar ref="statusBar"></ag-status-bar>':"",o=this.ctrl.showWatermark()?"<ag-watermark></ag-watermark>":"";return`<div class="ag-root-wrapper" role="presentation">
                ${e}
                <div class="ag-root-wrapper-body" ref="rootWrapperBody" role="presentation">
                    <ag-grid-body ref="gridBody"></ag-grid-body>
                    ${t}
                </div>
                ${n}
                <ag-pagination></ag-pagination>
                ${o}
            </div>`}getFocusableElement(){return this.eRootWrapperBody}getFocusableContainers(){const e=[this.gridBodyComp.getGui()];return this.sideBarComp&&e.push(this.sideBarComp.getGui()),e.filter(t=>isVisible(t))}}__decorate$H([Autowired("loggerFactory")],GridComp.prototype,"loggerFactory",void 0);__decorate$H([RefSelector("gridBody")],GridComp.prototype,"gridBodyComp",void 0);__decorate$H([RefSelector("sideBar")],GridComp.prototype,"sideBarComp",void 0);__decorate$H([RefSelector("rootWrapperBody")],GridComp.prototype,"eRootWrapperBody",void 0);__decorate$H([PostConstruct],GridComp.prototype,"postConstruct",null);var __decorate$G=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},SortController_1;let SortController=SortController_1=class extends BeanStub{progressSort(e,t,n){const o=this.getNextSortDirection(e);this.setSortForColumn(e,o,t,n)}setSortForColumn(e,t,n,o){t!=="asc"&&t!=="desc"&&(t=null);const a=this.gridOptionsService.isColumnsSortingCoupledToGroup();let l=[e];if(a&&e.getColDef().showRowGroup){const m=this.columnModel.getSourceColumnsForGroupColumn(e),y=m==null?void 0:m.filter(D=>D.getColDef().sortable);y&&(l=[e,...y])}l.forEach(m=>m.setSort(t,o)),(n||this.gridOptionsService.is("alwaysMultiSort"))&&!this.gridOptionsService.is("suppressMultiSort")||this.clearSortBarTheseColumns(l,o),this.updateSortIndex(e),this.dispatchSortChangedEvents(o)}updateSortIndex(e){const t=this.gridOptionsService.isColumnsSortingCoupledToGroup(),n=this.columnModel.getGroupDisplayColumnForGroup(e.getId()),o=t&&n||e,a=this.getColumnsWithSortingOrdered();this.columnModel.getPrimaryAndSecondaryAndAutoColumns().forEach(m=>m.setSortIndex(null));const l=a.filter(m=>m!==o);(o.getSort()?[...l,o]:l).forEach((m,y)=>m.setSortIndex(y))}onSortChanged(e){this.dispatchSortChangedEvents(e)}isSortActive(){const t=this.columnModel.getPrimaryAndSecondaryAndAutoColumns().filter(n=>!!n.getSort());return t&&t.length>0}dispatchSortChangedEvents(e){const t={type:Events.EVENT_SORT_CHANGED,source:e};this.eventService.dispatchEvent(t)}clearSortBarTheseColumns(e,t){this.columnModel.getPrimaryAndSecondaryAndAutoColumns().forEach(n=>{e.includes(n)||n.setSort(void 0,t)})}getNextSortDirection(e){let t;if(e.getColDef().sortingOrder?t=e.getColDef().sortingOrder:this.gridOptionsService.get("sortingOrder")?t=this.gridOptionsService.get("sortingOrder"):t=SortController_1.DEFAULT_SORTING_ORDER,!Array.isArray(t)||t.length<=0)return console.warn(`AG Grid: sortingOrder must be an array with at least one element, currently it's ${t}`),null;const n=t.indexOf(e.getSort()),o=n<0,a=n==t.length-1;let l;return o||a?l=t[0]:l=t[n+1],SortController_1.DEFAULT_SORTING_ORDER.indexOf(l)<0?(console.warn("AG Grid: invalid sort type "+l),null):l}getIndexedSortMap(){let e=this.columnModel.getPrimaryAndSecondaryAndAutoColumns().filter(l=>!!l.getSort());if(this.columnModel.isPivotMode()){const l=this.gridOptionsService.isColumnsSortingCoupledToGroup();e=e.filter(s=>{const m=!!s.getAggFunc(),y=!s.isPrimary(),D=l?this.columnModel.getGroupDisplayColumnForGroup(s.getId()):s.getColDef().showRowGroup;return m||y||D})}const t=this.columnModel.getRowGroupColumns().filter(l=>!!l.getSort()),n=this.gridOptionsService.isColumnsSortingCoupledToGroup()&&!!t.length;n&&(e=[...new Set(e.map(l=>{var s;return(s=this.columnModel.getGroupDisplayColumnForGroup(l.getId()))!==null&&s!==void 0?s:l}))]);const o={};e.forEach((l,s)=>o[l.getId()]=s),e.sort((l,s)=>{const m=l.getSortIndex(),y=s.getSortIndex();if(m!=null&&y!=null)return m-y;if(m==null&&y==null){const D=o[l.getId()],W=o[s.getId()];return D>W?1:-1}else return y==null?-1:1});const a=new Map;return e.forEach((l,s)=>a.set(l,s)),n&&t.forEach(l=>{const s=this.columnModel.getGroupDisplayColumnForGroup(l.getId());a.set(l,a.get(s))}),a}getColumnsWithSortingOrdered(){return[...this.getIndexedSortMap().entries()].sort(([e,t],[n,o])=>t-o).map(([e])=>e)}getSortModel(){return this.getColumnsWithSortingOrdered().map(e=>({sort:e.getSort(),colId:e.getId()}))}getSortOptions(){return this.getColumnsWithSortingOrdered().map(e=>({sort:e.getSort(),column:e}))}canColumnDisplayMixedSort(e){const t=this.gridOptionsService.isColumnsSortingCoupledToGroup(),n=!!e.getColDef().showRowGroup;return t&&n}getDisplaySortForColumn(e){const t=this.columnModel.getSourceColumnsForGroupColumn(e);if(!this.canColumnDisplayMixedSort(e)||!(t!=null&&t.length))return e.getSort();const o=!!e.getColDef().field?[e,...t]:t,a=o[0].getSort();return o.every(s=>s.getSort()==a)?a:"mixed"}getDisplaySortIndexForColumn(e){return this.getIndexedSortMap().get(e)}};SortController.DEFAULT_SORTING_ORDER=["asc","desc",null];__decorate$G([Autowired("columnModel")],SortController.prototype,"columnModel",void 0);SortController=SortController_1=__decorate$G([Bean("sortController")],SortController);var __decorate$F=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let ColumnHoverService=class extends BeanStub{setMouseOver(e){this.selectedColumns=e;const t={type:Events.EVENT_COLUMN_HOVER_CHANGED};this.eventService.dispatchEvent(t)}clearMouseOver(){this.selectedColumns=null;const e={type:Events.EVENT_COLUMN_HOVER_CHANGED};this.eventService.dispatchEvent(e)}isHovered(e){return!!this.selectedColumns&&this.selectedColumns.indexOf(e)>=0}};ColumnHoverService=__decorate$F([Bean("columnHoverService")],ColumnHoverService);var __decorate$E=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let ColumnAnimationService=class extends BeanStub{constructor(){super(...arguments),this.executeNextFuncs=[],this.executeLaterFuncs=[],this.active=!1,this.animationThreadCount=0}postConstruct(){this.ctrlsService.whenReady(e=>this.gridBodyCtrl=e.gridBodyCtrl)}isActive(){return this.active}start(){this.active||this.gridOptionsService.is("suppressColumnMoveAnimation")||this.gridOptionsService.is("enableRtl")||(this.ensureAnimationCssClassPresent(),this.active=!0)}finish(){this.active&&(this.flush(),this.active=!1)}executeNextVMTurn(e){this.active?this.executeNextFuncs.push(e):e()}executeLaterVMTurn(e){this.active?this.executeLaterFuncs.push(e):e()}ensureAnimationCssClassPresent(){this.animationThreadCount++;const e=this.animationThreadCount;this.gridBodyCtrl.setColumnMovingCss(!0),this.executeLaterFuncs.push(()=>{this.animationThreadCount===e&&this.gridBodyCtrl.setColumnMovingCss(!1)})}flush(){const e=this.executeNextFuncs;this.executeNextFuncs=[];const t=this.executeLaterFuncs;this.executeLaterFuncs=[],!(e.length===0&&t.length===0)&&(window.setTimeout(()=>e.forEach(n=>n()),0),window.setTimeout(()=>t.forEach(n=>n()),300))}};__decorate$E([Autowired("ctrlsService")],ColumnAnimationService.prototype,"ctrlsService",void 0);__decorate$E([PostConstruct],ColumnAnimationService.prototype,"postConstruct",null);ColumnAnimationService=__decorate$E([Bean("columnAnimationService")],ColumnAnimationService);var __decorate$D=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let PaginationAutoPageSizeService=class extends BeanStub{postConstruct(){this.ctrlsService.whenReady(e=>{this.centerRowContainerCon=e.centerRowContainerCtrl,this.addManagedListener(this.eventService,Events.EVENT_BODY_HEIGHT_CHANGED,this.checkPageSize.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_SCROLL_VISIBILITY_CHANGED,this.checkPageSize.bind(this)),this.checkPageSize()})}notActive(){return!this.gridOptionsService.is("paginationAutoPageSize")||this.centerRowContainerCon==null}checkPageSize(){if(this.notActive())return;const e=this.centerRowContainerCon.getViewportSizeFeature().getBodyHeight();if(e>0){const t=()=>{const n=this.gridOptionsService.getRowHeightAsNumber(),o=Math.floor(e/n);this.gridOptionsService.set("paginationPageSize",o)};this.isBodyRendered?debounce(()=>t(),50)():(t(),this.isBodyRendered=!0)}else this.isBodyRendered=!1}};__decorate$D([Autowired("ctrlsService")],PaginationAutoPageSizeService.prototype,"ctrlsService",void 0);__decorate$D([PostConstruct],PaginationAutoPageSizeService.prototype,"postConstruct",null);PaginationAutoPageSizeService=__decorate$D([Bean("paginationAutoPageSizeService")],PaginationAutoPageSizeService);var __decorate$C=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let ValueCache=class extends BeanStub{constructor(){super(...arguments),this.cacheVersion=0}init(){this.active=this.gridOptionsService.is("valueCache"),this.neverExpires=this.gridOptionsService.is("valueCacheNeverExpires")}onDataChanged(){this.neverExpires||this.expire()}expire(){this.cacheVersion++}setValue(e,t,n){this.active&&(e.__cacheVersion!==this.cacheVersion&&(e.__cacheVersion=this.cacheVersion,e.__cacheData={}),e.__cacheData[t]=n)}getValue(e,t){if(!(!this.active||e.__cacheVersion!==this.cacheVersion))return e.__cacheData[t]}};__decorate$C([PostConstruct],ValueCache.prototype,"init",null);ValueCache=__decorate$C([Bean("valueCache")],ValueCache);var __decorate$B=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const SOURCE_PASTE="paste";let ChangeDetectionService=class extends BeanStub{init(){this.rowModel.getType()==="clientSide"&&(this.clientSideRowModel=this.rowModel),this.addManagedListener(this.eventService,Events.EVENT_CELL_VALUE_CHANGED,this.onCellValueChanged.bind(this))}onCellValueChanged(e){e.source!==SOURCE_PASTE&&this.doChangeDetection(e.node,e.column)}doChangeDetection(e,t){if(this.gridOptionsService.is("suppressChangeDetection"))return;const n=[e];if(this.clientSideRowModel&&!e.isRowPinned()){const o=this.gridOptionsService.is("aggregateOnlyChangedColumns"),a=new ChangedPath(o,this.clientSideRowModel.getRootNode());a.addParentNode(e.parent,[t]),this.clientSideRowModel.doAggregate(a),a.forEachChangedNodeDepthFirst(l=>{n.push(l)})}this.rowRenderer.refreshCells({rowNodes:n})}};__decorate$B([Autowired("rowModel")],ChangeDetectionService.prototype,"rowModel",void 0);__decorate$B([Autowired("rowRenderer")],ChangeDetectionService.prototype,"rowRenderer",void 0);__decorate$B([PostConstruct],ChangeDetectionService.prototype,"init",null);ChangeDetectionService=__decorate$B([Bean("changeDetectionService")],ChangeDetectionService);var __decorate$A=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let AgComponentUtils=class extends BeanStub{adaptFunction(e,t){const n=this.componentMetadataProvider.retrieve(e);return n&&n.functionAdapter?n.functionAdapter(t):null}adaptCellRendererFunction(e){class t{refresh(o){return!1}getGui(){return this.eGui}init(o){const a=e(o),l=typeof a;if(l==="string"||l==="number"||l==="boolean"){this.eGui=loadTemplate("<span>"+a+"</span>");return}if(a==null){this.eGui=loadTemplate("<span></span>");return}this.eGui=a}}return t}doesImplementIComponent(e){return e?e.prototype&&"getGui"in e.prototype:!1}};__decorate$A([Autowired("componentMetadataProvider")],AgComponentUtils.prototype,"componentMetadataProvider",void 0);AgComponentUtils=__decorate$A([Bean("agComponentUtils")],AgComponentUtils);var __decorate$z=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let ComponentMetadataProvider=class extends BeanStub{postConstruct(){this.componentMetaData={dateComponent:{mandatoryMethodList:["getDate","setDate"],optionalMethodList:["afterGuiAttached","setInputPlaceholder","setInputAriaLabel"]},detailCellRenderer:{mandatoryMethodList:[],optionalMethodList:["refresh"],functionAdapter:this.agComponentUtils.adaptCellRendererFunction.bind(this.agComponentUtils)},headerComponent:{mandatoryMethodList:[],optionalMethodList:["refresh"]},headerGroupComponent:{mandatoryMethodList:[],optionalMethodList:[]},loadingCellRenderer:{mandatoryMethodList:[],optionalMethodList:[]},loadingOverlayComponent:{mandatoryMethodList:[],optionalMethodList:[]},noRowsOverlayComponent:{mandatoryMethodList:[],optionalMethodList:[]},floatingFilterComponent:{mandatoryMethodList:["onParentModelChanged"],optionalMethodList:["afterGuiAttached"]},floatingFilterWrapperComponent:{mandatoryMethodList:[],optionalMethodList:[]},cellRenderer:{mandatoryMethodList:[],optionalMethodList:["refresh","afterGuiAttached"],functionAdapter:this.agComponentUtils.adaptCellRendererFunction.bind(this.agComponentUtils)},cellEditor:{mandatoryMethodList:["getValue"],optionalMethodList:["isPopup","isCancelBeforeStart","isCancelAfterEnd","getPopupPosition","focusIn","focusOut","afterGuiAttached"]},innerRenderer:{mandatoryMethodList:[],optionalMethodList:["afterGuiAttached"],functionAdapter:this.agComponentUtils.adaptCellRendererFunction.bind(this.agComponentUtils)},fullWidthCellRenderer:{mandatoryMethodList:[],optionalMethodList:["refresh","afterGuiAttached"],functionAdapter:this.agComponentUtils.adaptCellRendererFunction.bind(this.agComponentUtils)},groupRowRenderer:{mandatoryMethodList:[],optionalMethodList:["afterGuiAttached"],functionAdapter:this.agComponentUtils.adaptCellRendererFunction.bind(this.agComponentUtils)},filter:{mandatoryMethodList:["isFilterActive","doesFilterPass","getModel","setModel"],optionalMethodList:["afterGuiAttached","afterGuiDetached","onNewRowsLoaded","getModelAsString","onFloatingFilterChanged","onAnyFilterChanged"]},filterComponent:{mandatoryMethodList:["isFilterActive","doesFilterPass","getModel","setModel"],optionalMethodList:["afterGuiAttached","afterGuiDetached","onNewRowsLoaded","getModelAsString","onFloatingFilterChanged","onAnyFilterChanged"]},statusPanel:{mandatoryMethodList:[],optionalMethodList:["afterGuiAttached"]},toolPanel:{mandatoryMethodList:[],optionalMethodList:["refresh","afterGuiAttached"]},tooltipComponent:{mandatoryMethodList:[],optionalMethodList:[]}}}retrieve(e){return this.componentMetaData[e]}};__decorate$z([Autowired("agComponentUtils")],ComponentMetadataProvider.prototype,"agComponentUtils",void 0);__decorate$z([PostConstruct],ComponentMetadataProvider.prototype,"postConstruct",null);ComponentMetadataProvider=__decorate$z([Bean("componentMetadataProvider")],ComponentMetadataProvider);var __decorate$y=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const DEFAULT_ROW_HEIGHT=25,MIN_COL_WIDTH=10,MAT_GRID_SIZE=8,BASE_GRID_SIZE=4,BALHAM_GRID_SIZE=4,ALPINE_GRID_SIZE=6,HARD_CODED_SIZES={"ag-theme-custom":{headerHeight:25,headerCellMinWidth:24,listItemHeight:BASE_GRID_SIZE*5,rowHeight:25,chartMenuPanelWidth:220},"ag-theme-material":{headerHeight:MAT_GRID_SIZE*7,headerCellMinWidth:48,listItemHeight:MAT_GRID_SIZE*4,rowHeight:MAT_GRID_SIZE*6,chartMenuPanelWidth:240},"ag-theme-balham":{headerHeight:BALHAM_GRID_SIZE*8,headerCellMinWidth:24,listItemHeight:BALHAM_GRID_SIZE*6,rowHeight:BALHAM_GRID_SIZE*7,chartMenuPanelWidth:220},"ag-theme-alpine":{headerHeight:ALPINE_GRID_SIZE*8,headerCellMinWidth:36,listItemHeight:ALPINE_GRID_SIZE*4,rowHeight:ALPINE_GRID_SIZE*7,chartMenuPanelWidth:240}},SASS_PROPERTY_BUILDER={headerHeight:["ag-header-row"],headerCellMinWidth:["ag-header-cell"],listItemHeight:["ag-virtual-list-item"],rowHeight:["ag-row"],chartMenuPanelWidth:["ag-chart-docked-container"]};let Environment=class extends BeanStub{constructor(){super(...arguments),this.calculatedSizes={}}postConstruct(){var e;const t=(e=this.getTheme().el)!==null&&e!==void 0?e:this.eGridDiv;this.mutationObserver=new MutationObserver(()=>{this.calculatedSizes={},this.fireGridStylesChangedEvent()}),this.mutationObserver.observe(t||this.eGridDiv,{attributes:!0,attributeFilter:["class"]})}fireGridStylesChangedEvent(){const e={type:Events.EVENT_GRID_STYLES_CHANGED};this.eventService.dispatchEvent(e)}getSassVariable(e){const{themeFamily:t,el:n}=this.getTheme();if(!t||t.indexOf("ag-theme")!==0)return;this.calculatedSizes||(this.calculatedSizes={}),this.calculatedSizes[t]||(this.calculatedSizes[t]={});const o=this.calculatedSizes[t][e];return o??(this.calculatedSizes[t][e]=this.calculateValueForSassProperty(e,t,n),this.calculatedSizes[t][e])}calculateValueForSassProperty(e,t,n){const o="ag-theme-"+(t.match("material")?"material":t.match("balham")?"balham":t.match("alpine")?"alpine":"custom"),a=HARD_CODED_SIZES[o][e],l=this.gridOptionsService.getDocument();if(n||(n=this.eGridDiv),!SASS_PROPERTY_BUILDER[e])return a;const s=SASS_PROPERTY_BUILDER[e],m=l.createElement("div"),y=Array.from(n.classList);m.classList.add(t,...y),m.style.position="absolute";const D=s.reduce((Ee,dt)=>{const Ht=l.createElement("div");return Ht.style.position="static",Ht.classList.add(dt),Ee.appendChild(Ht),Ht},m);let W=0;if(l.body){l.body.appendChild(m);const Ee=e.toLowerCase().indexOf("height")!==-1?"height":"width";W=parseInt(window.getComputedStyle(D)[Ee],10),l.body.removeChild(m)}return W||a}isThemeDark(){const{theme:e}=this.getTheme();return!!e&&e.indexOf("dark")>=0}chartMenuPanelWidth(){return this.getSassVariable("chartMenuPanelWidth")}getTheme(){const e=/\bag-(material|(?:theme-([\w\-]*)))\b/g;let t=this.eGridDiv,n=null,o=[];for(;t;)if(n=e.exec(t.className),!n)t=t.parentElement||void 0;else{const l=t.className.match(e);l&&(o=l);break}if(!n)return{allThemes:o};const a=n[0];return{theme:a,el:t,themeFamily:a.replace(/-dark$/,""),allThemes:o}}getFromTheme(e,t){var n;return(n=this.getSassVariable(t))!==null&&n!==void 0?n:e}getDefaultRowHeight(){return this.getFromTheme(DEFAULT_ROW_HEIGHT,"rowHeight")}getListItemHeight(){return this.getFromTheme(20,"listItemHeight")}setRowHeightVariable(e){const t=this.eGridDiv.style.getPropertyValue("--ag-line-height").trim(),n=`${e}px`;t!=n&&this.eGridDiv.style.setProperty("--ag-line-height",n)}getMinColWidth(){const e=this.getFromTheme(null,"headerCellMinWidth");return exists(e)?Math.max(e,MIN_COL_WIDTH):MIN_COL_WIDTH}destroy(){this.calculatedSizes=null,this.mutationObserver&&this.mutationObserver.disconnect(),super.destroy()}};__decorate$y([Autowired("eGridDiv")],Environment.prototype,"eGridDiv",void 0);__decorate$y([PostConstruct],Environment.prototype,"postConstruct",null);Environment=__decorate$y([Bean("environment")],Environment);var __decorate$x=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},__param$2=function(r,e){return function(t,n){e(t,n,r)}};let RowContainerHeightService=class extends BeanStub{constructor(){super(...arguments),this.scrollY=0,this.uiBodyHeight=0}agWire(e){this.logger=e.create("RowContainerHeightService")}postConstruct(){this.addManagedListener(this.eventService,Events.EVENT_BODY_HEIGHT_CHANGED,this.updateOffset.bind(this)),this.maxDivHeight=getMaxDivHeight(),this.logger.log("maxDivHeight = "+this.maxDivHeight)}isStretching(){return this.stretching}getDivStretchOffset(){return this.divStretchOffset}updateOffset(){if(!this.stretching)return;const t=this.ctrlsService.getGridBodyCtrl().getScrollFeature().getVScrollPosition().top,n=this.getUiBodyHeight();(t!==this.scrollY||n!==this.uiBodyHeight)&&(this.scrollY=t,this.uiBodyHeight=n,this.calculateOffset())}calculateOffset(){this.setUiContainerHeight(this.maxDivHeight),this.pixelsToShave=this.modelHeight-this.uiContainerHeight,this.maxScrollY=this.uiContainerHeight-this.uiBodyHeight;const e=this.scrollY/this.maxScrollY,t=e*this.pixelsToShave;this.logger.log(`Div Stretch Offset = ${t} (${this.pixelsToShave} * ${e})`),this.setDivStretchOffset(t)}setUiContainerHeight(e){e!==this.uiContainerHeight&&(this.uiContainerHeight=e,this.eventService.dispatchEvent({type:Events.EVENT_ROW_CONTAINER_HEIGHT_CHANGED}))}clearOffset(){this.setUiContainerHeight(this.modelHeight),this.pixelsToShave=0,this.setDivStretchOffset(0)}setDivStretchOffset(e){const t=typeof e=="number"?Math.floor(e):null;this.divStretchOffset!==t&&(this.divStretchOffset=t,this.eventService.dispatchEvent({type:Events.EVENT_HEIGHT_SCALE_CHANGED}))}setModelHeight(e){this.modelHeight=e,this.stretching=e!=null&&this.maxDivHeight>0&&e>this.maxDivHeight,this.stretching?this.calculateOffset():this.clearOffset()}getUiContainerHeight(){return this.uiContainerHeight}getRealPixelPosition(e){return e-this.divStretchOffset}getUiBodyHeight(){const t=this.ctrlsService.getGridBodyCtrl().getScrollFeature().getVScrollPosition();return t.bottom-t.top}getScrollPositionForPixel(e){if(this.pixelsToShave<=0)return e;const t=this.modelHeight-this.getUiBodyHeight(),n=e/t;return this.maxScrollY*n}};__decorate$x([Autowired("ctrlsService")],RowContainerHeightService.prototype,"ctrlsService",void 0);__decorate$x([__param$2(0,Qualifier("loggerFactory"))],RowContainerHeightService.prototype,"agWire",null);__decorate$x([PostConstruct],RowContainerHeightService.prototype,"postConstruct",null);RowContainerHeightService=__decorate$x([Bean("rowContainerHeightService")],RowContainerHeightService);var __decorate$w=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let SelectableService=class extends BeanStub{init(){this.groupSelectsChildren=this.gridOptionsService.is("groupSelectsChildren"),this.isRowSelectableFunc=this.gridOptionsService.get("isRowSelectable")}updateSelectableAfterGrouping(e){if(this.isRowSelectableFunc){const t=n=>n.childrenAfterGroup;this.recurseDown(e.childrenAfterGroup,t)}}recurseDown(e,t){e&&e.forEach(n=>{if(!n.group)return;n.hasChildren()&&this.recurseDown(t(n),t);let o;if(this.groupSelectsChildren){const a=(t(n)||[]).find(l=>l.selectable===!0);o=exists(a)}else o=this.isRowSelectableFunc?this.isRowSelectableFunc(n):!1;n.setRowSelectable(o)})}};__decorate$w([PostConstruct],SelectableService.prototype,"init",null);SelectableService=__decorate$w([Bean("selectableService")],SelectableService);var __decorate$v=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class PaginationComp extends Component{constructor(){super(),this.previousAndFirstButtonsDisabled=!1,this.nextButtonDisabled=!1,this.lastButtonDisabled=!1,this.areListenersSetup=!1}postConstruct(){const e=this.gridOptionsService.is("enableRtl");this.setTemplate(this.getTemplate());const{btFirst:t,btPrevious:n,btNext:o,btLast:a}=this;this.activateTabIndex([t,n,o,a]),t.insertAdjacentElement("afterbegin",createIconNoSpan(e?"last":"first",this.gridOptionsService)),n.insertAdjacentElement("afterbegin",createIconNoSpan(e?"next":"previous",this.gridOptionsService)),o.insertAdjacentElement("afterbegin",createIconNoSpan(e?"previous":"next",this.gridOptionsService)),a.insertAdjacentElement("afterbegin",createIconNoSpan(e?"first":"last",this.gridOptionsService)),this.addManagedPropertyListener("pagination",this.onPaginationChanged.bind(this)),this.addManagedPropertyListener("suppressPaginationPanel",this.onPaginationChanged.bind(this)),this.onPaginationChanged()}onPaginationChanged(){const t=this.gridOptionsService.is("pagination")&&!this.gridOptionsService.is("suppressPaginationPanel");this.setDisplayed(t),t&&(this.setupListeners(),this.enableOrDisableButtons(),this.updateRowLabels(),this.setCurrentPageLabel(),this.setTotalLabels())}setupListeners(){this.areListenersSetup||(this.addManagedListener(this.eventService,Events.EVENT_PAGINATION_CHANGED,this.onPaginationChanged.bind(this)),[{el:this.btFirst,fn:this.onBtFirst.bind(this)},{el:this.btPrevious,fn:this.onBtPrevious.bind(this)},{el:this.btNext,fn:this.onBtNext.bind(this)},{el:this.btLast,fn:this.onBtLast.bind(this)}].forEach(e=>{const{el:t,fn:n}=e;this.addManagedListener(t,"click",n),this.addManagedListener(t,"keydown",o=>{(o.key===KeyCode.ENTER||o.key===KeyCode.SPACE)&&(o.preventDefault(),n())})}),this.areListenersSetup=!0)}onBtFirst(){this.previousAndFirstButtonsDisabled||this.paginationProxy.goToFirstPage()}setCurrentPageLabel(){const e=this.paginationProxy.getTotalPages()>0,t=this.paginationProxy.getCurrentPage(),n=e?t+1:0;this.lbCurrent.innerHTML=this.formatNumber(n)}formatNumber(e){const t=this.gridOptionsService.getCallback("paginationNumberFormatter");if(t)return t({value:e});const n=this.localeService.getLocaleTextFunc(),o=n("thousandSeparator",","),a=n("decimalSeparator",".");return formatNumberCommas(e,o,a)}getTemplate(){const e=this.localeService.getLocaleTextFunc(),t=e("page","Page"),n=e("to","to"),o=e("of","of"),a=e("firstPage","First Page"),l=e("previousPage","Previous Page"),s=e("nextPage","Next Page"),m=e("lastPage","Last Page"),y=this.getCompId();return`<div class="ag-paging-panel ag-unselectable" id="ag-${y}">
                <span class="ag-paging-row-summary-panel" role="status">
                    <span id="ag-${y}-first-row" ref="lbFirstRowOnPage" class="ag-paging-row-summary-panel-number"></span>
                    <span id="ag-${y}-to">${n}</span>
                    <span id="ag-${y}-last-row" ref="lbLastRowOnPage" class="ag-paging-row-summary-panel-number"></span>
                    <span id="ag-${y}-of">${o}</span>
                    <span id="ag-${y}-row-count" ref="lbRecordCount" class="ag-paging-row-summary-panel-number"></span>
                </span>
                <span class="ag-paging-page-summary-panel" role="presentation">
                    <div ref="btFirst" class="ag-button ag-paging-button" role="button" aria-label="${a}"></div>
                    <div ref="btPrevious" class="ag-button ag-paging-button" role="button" aria-label="${l}"></div>
                    <span class="ag-paging-description" role="status">
                        <span id="ag-${y}-start-page">${t}</span>
                        <span id="ag-${y}-start-page-number" ref="lbCurrent" class="ag-paging-number"></span>
                        <span id="ag-${y}-of-page">${o}</span>
                        <span id="ag-${y}-of-page-number" ref="lbTotal" class="ag-paging-number"></span>
                    </span>
                    <div ref="btNext" class="ag-button ag-paging-button" role="button" aria-label="${s}"></div>
                    <div ref="btLast" class="ag-button ag-paging-button" role="button" aria-label="${m}"></div>
                </span>
            </div>`}onBtNext(){this.nextButtonDisabled||this.paginationProxy.goToNextPage()}onBtPrevious(){this.previousAndFirstButtonsDisabled||this.paginationProxy.goToPreviousPage()}onBtLast(){this.lastButtonDisabled||this.paginationProxy.goToLastPage()}enableOrDisableButtons(){const e=this.paginationProxy.getCurrentPage(),t=this.paginationProxy.isLastPageFound(),n=this.paginationProxy.getTotalPages();this.previousAndFirstButtonsDisabled=e===0,this.toggleButtonDisabled(this.btFirst,this.previousAndFirstButtonsDisabled),this.toggleButtonDisabled(this.btPrevious,this.previousAndFirstButtonsDisabled);const o=this.isZeroPagesToDisplay(),a=t&&e===n-1;this.nextButtonDisabled=a||o,this.lastButtonDisabled=!t||o||e===n-1,this.toggleButtonDisabled(this.btNext,this.nextButtonDisabled),this.toggleButtonDisabled(this.btLast,this.lastButtonDisabled)}toggleButtonDisabled(e,t){setAriaDisabled(e,t),e.classList.toggle("ag-disabled",t)}updateRowLabels(){const e=this.paginationProxy.getCurrentPage(),t=this.paginationProxy.getPageSize(),n=this.paginationProxy.isLastPageFound(),o=this.paginationProxy.isLastPageFound()?this.paginationProxy.getMasterRowCount():null;let a,l;if(this.isZeroPagesToDisplay()?a=l=0:(a=t*e+1,l=a+t-1,n&&l>o&&(l=o)),this.lbFirstRowOnPage.innerHTML=this.formatNumber(a),this.rowNodeBlockLoader.isLoading()){const s=this.localeService.getLocaleTextFunc();this.lbLastRowOnPage.innerHTML=s("pageLastRowUnknown","?")}else this.lbLastRowOnPage.innerHTML=this.formatNumber(l)}isZeroPagesToDisplay(){const e=this.paginationProxy.isLastPageFound(),t=this.paginationProxy.getTotalPages();return e&&t===0}setTotalLabels(){const e=this.paginationProxy.isLastPageFound(),t=this.paginationProxy.getTotalPages(),n=e?this.paginationProxy.getMasterRowCount():null;if(n===1){const o=this.paginationProxy.getRow(0);if(o&&o.group&&!(o.groupData||o.aggData)){this.setTotalLabelsToZero();return}}if(e)this.lbTotal.innerHTML=this.formatNumber(t),this.lbRecordCount.innerHTML=this.formatNumber(n);else{const o=this.localeService.getLocaleTextFunc()("more","more");this.lbTotal.innerHTML=o,this.lbRecordCount.innerHTML=o}}setTotalLabelsToZero(){this.lbFirstRowOnPage.innerHTML=this.formatNumber(0),this.lbCurrent.innerHTML=this.formatNumber(0),this.lbLastRowOnPage.innerHTML=this.formatNumber(0),this.lbTotal.innerHTML=this.formatNumber(0),this.lbRecordCount.innerHTML=this.formatNumber(0)}}__decorate$v([Autowired("paginationProxy")],PaginationComp.prototype,"paginationProxy",void 0);__decorate$v([Autowired("rowNodeBlockLoader")],PaginationComp.prototype,"rowNodeBlockLoader",void 0);__decorate$v([RefSelector("btFirst")],PaginationComp.prototype,"btFirst",void 0);__decorate$v([RefSelector("btPrevious")],PaginationComp.prototype,"btPrevious",void 0);__decorate$v([RefSelector("btNext")],PaginationComp.prototype,"btNext",void 0);__decorate$v([RefSelector("btLast")],PaginationComp.prototype,"btLast",void 0);__decorate$v([RefSelector("lbRecordCount")],PaginationComp.prototype,"lbRecordCount",void 0);__decorate$v([RefSelector("lbFirstRowOnPage")],PaginationComp.prototype,"lbFirstRowOnPage",void 0);__decorate$v([RefSelector("lbLastRowOnPage")],PaginationComp.prototype,"lbLastRowOnPage",void 0);__decorate$v([RefSelector("lbCurrent")],PaginationComp.prototype,"lbCurrent",void 0);__decorate$v([RefSelector("lbTotal")],PaginationComp.prototype,"lbTotal",void 0);__decorate$v([PostConstruct],PaginationComp.prototype,"postConstruct",null);var __decorate$u=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},LoadingType;(function(r){r[r.Loading=0]="Loading",r[r.NoRows=1]="NoRows"})(LoadingType||(LoadingType={}));class OverlayWrapperComponent extends Component{constructor(){super(OverlayWrapperComponent.TEMPLATE),this.inProgress=!1,this.destroyRequested=!1,this.manuallyDisplayed=!1}updateLayoutClasses(e,t){const n=this.eOverlayWrapper.classList;n.toggle(LayoutCssClasses.AUTO_HEIGHT,t.autoHeight),n.toggle(LayoutCssClasses.NORMAL,t.normal),n.toggle(LayoutCssClasses.PRINT,t.print)}postConstruct(){this.createManagedBean(new LayoutFeature(this)),this.setDisplayed(!1,{skipAriaHidden:!0}),this.addManagedListener(this.eventService,Events.EVENT_ROW_DATA_UPDATED,this.onRowDataUpdated.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_NEW_COLUMNS_LOADED,this.onNewColumnsLoaded.bind(this)),this.gridOptionsService.isRowModelType("clientSide")&&!this.gridOptionsService.get("rowData")&&this.showLoadingOverlay(),this.gridApi.registerOverlayWrapperComp(this)}setWrapperTypeClass(e){const t=this.eOverlayWrapper.classList;t.toggle("ag-overlay-loading-wrapper",e===LoadingType.Loading),t.toggle("ag-overlay-no-rows-wrapper",e===LoadingType.NoRows)}showLoadingOverlay(){if(this.gridOptionsService.is("suppressLoadingOverlay"))return;const e={},n=this.userComponentFactory.getLoadingOverlayCompDetails(e).newAgStackInstance();this.showOverlay(n,LoadingType.Loading)}showNoRowsOverlay(){if(this.gridOptionsService.is("suppressNoRowsOverlay"))return;const e={},n=this.userComponentFactory.getNoRowsOverlayCompDetails(e).newAgStackInstance();this.showOverlay(n,LoadingType.NoRows)}showOverlay(e,t){this.inProgress||(this.setWrapperTypeClass(t),this.destroyActiveOverlay(),this.inProgress=!0,e&&e.then(n=>{this.inProgress=!1,this.eOverlayWrapper.appendChild(n.getGui()),this.activeOverlay=n,this.destroyRequested&&(this.destroyRequested=!1,this.destroyActiveOverlay())}),this.manuallyDisplayed=this.columnModel.isReady()&&!this.paginationProxy.isEmpty(),this.setDisplayed(!0,{skipAriaHidden:!0}))}destroyActiveOverlay(){if(this.inProgress){this.destroyRequested=!0;return}this.activeOverlay&&(this.activeOverlay=this.getContext().destroyBean(this.activeOverlay),clearElement(this.eOverlayWrapper))}hideOverlay(){this.manuallyDisplayed=!1,this.destroyActiveOverlay(),this.setDisplayed(!1,{skipAriaHidden:!0})}destroy(){this.destroyActiveOverlay(),super.destroy()}showOrHideOverlay(){const e=this.paginationProxy.isEmpty(),t=this.gridOptionsService.is("suppressNoRowsOverlay");e&&!t?this.showNoRowsOverlay():this.hideOverlay()}onRowDataUpdated(){this.showOrHideOverlay()}onNewColumnsLoaded(){this.columnModel.isReady()&&!this.paginationProxy.isEmpty()&&!this.manuallyDisplayed&&this.hideOverlay()}}OverlayWrapperComponent.TEMPLATE=`
        <div class="ag-overlay" aria-hidden="true">
            <div class="ag-overlay-panel">
                <div class="ag-overlay-wrapper" ref="eOverlayWrapper"></div>
            </div>
        </div>`;__decorate$u([Autowired("userComponentFactory")],OverlayWrapperComponent.prototype,"userComponentFactory",void 0);__decorate$u([Autowired("paginationProxy")],OverlayWrapperComponent.prototype,"paginationProxy",void 0);__decorate$u([Autowired("gridApi")],OverlayWrapperComponent.prototype,"gridApi",void 0);__decorate$u([Autowired("columnModel")],OverlayWrapperComponent.prototype,"columnModel",void 0);__decorate$u([RefSelector("eOverlayWrapper")],OverlayWrapperComponent.prototype,"eOverlayWrapper",void 0);__decorate$u([PostConstruct],OverlayWrapperComponent.prototype,"postConstruct",null);var __decorate$t=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let RowPositionUtils=class extends BeanStub{getFirstRow(){let e=0,t;return this.pinnedRowModel.getPinnedTopRowCount()?t="top":this.rowModel.getRowCount()?(t=null,e=this.paginationProxy.getPageFirstRow()):this.pinnedRowModel.getPinnedBottomRowCount()&&(t="bottom"),t===void 0?null:{rowIndex:e,rowPinned:t}}getLastRow(){let e,t=null;const n=this.pinnedRowModel.getPinnedBottomRowCount(),o=this.pinnedRowModel.getPinnedTopRowCount();return n?(t="bottom",e=n-1):this.rowModel.getRowCount()?(t=null,e=this.paginationProxy.getPageLastRow()):o&&(t="top",e=o-1),e===void 0?null:{rowIndex:e,rowPinned:t}}getRowNode(e){switch(e.rowPinned){case"top":return this.pinnedRowModel.getPinnedTopRowData()[e.rowIndex];case"bottom":return this.pinnedRowModel.getPinnedBottomRowData()[e.rowIndex];default:return this.rowModel.getRow(e.rowIndex)}}sameRow(e,t){return!e&&!t?!0:e&&!t||!e&&t?!1:e.rowIndex===t.rowIndex&&e.rowPinned==t.rowPinned}before(e,t){switch(e.rowPinned){case"top":if(t.rowPinned!=="top")return!0;break;case"bottom":if(t.rowPinned!=="bottom")return!1;break;default:if(exists(t.rowPinned))return t.rowPinned!=="top";break}return e.rowIndex<t.rowIndex}rowMax(e){let t;return e.forEach(n=>{(t===void 0||this.before(t,n))&&(t=n)}),t}rowMin(e){let t;return e.forEach(n=>{(t===void 0||this.before(n,t))&&(t=n)}),t}};__decorate$t([Autowired("rowModel")],RowPositionUtils.prototype,"rowModel",void 0);__decorate$t([Autowired("pinnedRowModel")],RowPositionUtils.prototype,"pinnedRowModel",void 0);__decorate$t([Autowired("paginationProxy")],RowPositionUtils.prototype,"paginationProxy",void 0);RowPositionUtils=__decorate$t([Bean("rowPositionUtils")],RowPositionUtils);var __decorate$s=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let CellPositionUtils=class extends BeanStub{createId(e){const{rowIndex:t,rowPinned:n,column:o}=e;return this.createIdFromValues({rowIndex:t,column:o,rowPinned:n})}createIdFromValues(e){const{rowIndex:t,rowPinned:n,column:o}=e;return`${t}.${n??"null"}.${o.getId()}`}equals(e,t){const n=e.column===t.column,o=e.rowPinned===t.rowPinned,a=e.rowIndex===t.rowIndex;return n&&o&&a}};CellPositionUtils=__decorate$s([Bean("cellPositionUtils")],CellPositionUtils);class UndoRedoAction{constructor(e){this.cellValueChanges=e}}class RangeUndoRedoAction extends UndoRedoAction{constructor(e,t,n,o){super(e),this.initialRange=t,this.finalRange=n,this.ranges=o}}class UndoRedoStack{constructor(e){this.actionStack=[],this.maxStackSize=e||UndoRedoStack.DEFAULT_STACK_SIZE,this.actionStack=new Array(this.maxStackSize)}pop(){return this.actionStack.pop()}push(e){e.cellValueChanges&&e.cellValueChanges.length>0&&(this.actionStack.length===this.maxStackSize&&this.actionStack.shift(),this.actionStack.push(e))}clear(){this.actionStack=[]}getCurrentStackSize(){return this.actionStack.length}}UndoRedoStack.DEFAULT_STACK_SIZE=10;var __decorate$r=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let UndoRedoService=class extends BeanStub{constructor(){super(...arguments),this.cellValueChanges=[],this.activeCellEdit=null,this.activeRowEdit=null,this.isPasting=!1,this.isRangeInAction=!1,this.onCellValueChanged=e=>{const t={column:e.column,rowIndex:e.rowIndex,rowPinned:e.rowPinned},n=this.activeCellEdit!==null&&this.cellPositionUtils.equals(this.activeCellEdit,t),o=this.activeRowEdit!==null&&this.rowPositionUtils.sameRow(this.activeRowEdit,t);if(!(n||o||this.isPasting||this.isRangeInAction))return;const{rowPinned:l,rowIndex:s,column:m,oldValue:y,value:D}=e,W={rowPinned:l,rowIndex:s,columnId:m.getColId(),newValue:D,oldValue:y};this.cellValueChanges.push(W)},this.clearStacks=()=>{this.undoStack.clear(),this.redoStack.clear()}}init(){if(!this.gridOptionsService.is("undoRedoCellEditing"))return;const e=this.gridOptionsService.getNum("undoRedoCellEditingLimit");e<=0||(this.undoStack=new UndoRedoStack(e),this.redoStack=new UndoRedoStack(e),this.addRowEditingListeners(),this.addCellEditingListeners(),this.addPasteListeners(),this.addFillListeners(),this.addCellKeyListeners(),this.addManagedListener(this.eventService,Events.EVENT_CELL_VALUE_CHANGED,this.onCellValueChanged),this.addManagedListener(this.eventService,Events.EVENT_MODEL_UPDATED,t=>{t.keepUndoRedoStack||this.clearStacks()}),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_PIVOT_MODE_CHANGED,this.clearStacks),this.addManagedListener(this.eventService,Events.EVENT_NEW_COLUMNS_LOADED,this.clearStacks),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_GROUP_OPENED,this.clearStacks),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_ROW_GROUP_CHANGED,this.clearStacks),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_MOVED,this.clearStacks),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_PINNED,this.clearStacks),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_VISIBLE,this.clearStacks),this.addManagedListener(this.eventService,Events.EVENT_ROW_DRAG_END,this.clearStacks),this.ctrlsService.whenReady(()=>{this.gridBodyCtrl=this.ctrlsService.getGridBodyCtrl()}))}getCurrentUndoStackSize(){return this.undoStack?this.undoStack.getCurrentStackSize():0}getCurrentRedoStackSize(){return this.redoStack?this.redoStack.getCurrentStackSize():0}undo(e){const t={type:Events.EVENT_UNDO_STARTED,source:e};this.eventService.dispatchEvent(t);const n=this.undoRedo(this.undoStack,this.redoStack,"initialRange","oldValue","undo"),o={type:Events.EVENT_UNDO_ENDED,source:e,operationPerformed:n};this.eventService.dispatchEvent(o)}redo(e){const t={type:Events.EVENT_REDO_STARTED,source:e};this.eventService.dispatchEvent(t);const n=this.undoRedo(this.redoStack,this.undoStack,"finalRange","newValue","redo"),o={type:Events.EVENT_REDO_ENDED,source:e,operationPerformed:n};this.eventService.dispatchEvent(o)}undoRedo(e,t,n,o,a){if(!e)return!1;const l=e.pop();return!l||!l.cellValueChanges?!1:(this.processAction(l,s=>s[o],a),l instanceof RangeUndoRedoAction?this.processRange(l.ranges||[l[n]]):this.processCell(l.cellValueChanges),t.push(l),!0)}processAction(e,t,n){e.cellValueChanges.forEach(o=>{const{rowIndex:a,rowPinned:l,columnId:s}=o,m={rowIndex:a,rowPinned:l},y=this.getRowNode(m);y.displayed&&y.setDataValue(s,t(o),n)})}processRange(e){let t;this.rangeService.removeAllCellRanges(!0),e.forEach((n,o)=>{if(!n)return;const a=n.startRow,l=n.endRow;o===e.length-1&&(t={rowPinned:a.rowPinned,rowIndex:a.rowIndex,columnId:n.startColumn.getColId()},this.setLastFocusedCell(t));const s={rowStartIndex:a.rowIndex,rowStartPinned:a.rowPinned,rowEndIndex:l.rowIndex,rowEndPinned:l.rowPinned,columnStart:n.startColumn,columns:n.columns};this.rangeService.addCellRange(s)})}processCell(e){const t=e[0],{rowIndex:n,rowPinned:o}=t,a={rowIndex:n,rowPinned:o},l=this.getRowNode(a),s={rowPinned:t.rowPinned,rowIndex:l.rowIndex,columnId:t.columnId};this.setLastFocusedCell(s,!!this.rangeService)}setLastFocusedCell(e,t){const{rowIndex:n,columnId:o,rowPinned:a}=e,l=this.gridBodyCtrl.getScrollFeature(),s=this.columnModel.getGridColumn(o);if(!s)return;l.ensureIndexVisible(n),l.ensureColumnVisible(s);const m={rowIndex:n,column:s,rowPinned:a};this.focusService.setFocusedCell(Object.assign(Object.assign({},m),{forceBrowserFocus:!0})),t&&this.rangeService.setRangeToCell(m)}addRowEditingListeners(){this.addManagedListener(this.eventService,Events.EVENT_ROW_EDITING_STARTED,e=>{this.activeRowEdit={rowIndex:e.rowIndex,rowPinned:e.rowPinned}}),this.addManagedListener(this.eventService,Events.EVENT_ROW_EDITING_STOPPED,()=>{const e=new UndoRedoAction(this.cellValueChanges);this.pushActionsToUndoStack(e),this.activeRowEdit=null})}addCellEditingListeners(){this.addManagedListener(this.eventService,Events.EVENT_CELL_EDITING_STARTED,e=>{this.activeCellEdit={column:e.column,rowIndex:e.rowIndex,rowPinned:e.rowPinned}}),this.addManagedListener(this.eventService,Events.EVENT_CELL_EDITING_STOPPED,e=>{if(this.activeCellEdit=null,e.valueChanged&&!this.activeRowEdit&&!this.isPasting&&!this.isRangeInAction){const n=new UndoRedoAction(this.cellValueChanges);this.pushActionsToUndoStack(n)}})}addPasteListeners(){this.addManagedListener(this.eventService,Events.EVENT_PASTE_START,()=>{this.isPasting=!0}),this.addManagedListener(this.eventService,Events.EVENT_PASTE_END,()=>{const e=new UndoRedoAction(this.cellValueChanges);this.pushActionsToUndoStack(e),this.isPasting=!1})}addFillListeners(){this.addManagedListener(this.eventService,Events.EVENT_FILL_START,()=>{this.isRangeInAction=!0}),this.addManagedListener(this.eventService,Events.EVENT_FILL_END,e=>{const t=new RangeUndoRedoAction(this.cellValueChanges,e.initialRange,e.finalRange);this.pushActionsToUndoStack(t),this.isRangeInAction=!1})}addCellKeyListeners(){this.addManagedListener(this.eventService,Events.EVENT_KEY_SHORTCUT_CHANGED_CELL_START,()=>{this.isRangeInAction=!0}),this.addManagedListener(this.eventService,Events.EVENT_KEY_SHORTCUT_CHANGED_CELL_END,()=>{let e;this.rangeService&&this.gridOptionsService.isEnableRangeSelection()?e=new RangeUndoRedoAction(this.cellValueChanges,void 0,void 0,[...this.rangeService.getCellRanges()]):e=new UndoRedoAction(this.cellValueChanges),this.pushActionsToUndoStack(e),this.isRangeInAction=!1})}pushActionsToUndoStack(e){this.undoStack.push(e),this.cellValueChanges=[],this.redoStack.clear()}getRowNode(e){switch(e.rowPinned){case"top":return this.pinnedRowModel.getPinnedTopRowData()[e.rowIndex];case"bottom":return this.pinnedRowModel.getPinnedBottomRowData()[e.rowIndex];default:return this.rowModel.getRow(e.rowIndex)}}};__decorate$r([Autowired("focusService")],UndoRedoService.prototype,"focusService",void 0);__decorate$r([Autowired("ctrlsService")],UndoRedoService.prototype,"ctrlsService",void 0);__decorate$r([Autowired("rowModel")],UndoRedoService.prototype,"rowModel",void 0);__decorate$r([Autowired("pinnedRowModel")],UndoRedoService.prototype,"pinnedRowModel",void 0);__decorate$r([Autowired("cellPositionUtils")],UndoRedoService.prototype,"cellPositionUtils",void 0);__decorate$r([Autowired("rowPositionUtils")],UndoRedoService.prototype,"rowPositionUtils",void 0);__decorate$r([Autowired("columnModel")],UndoRedoService.prototype,"columnModel",void 0);__decorate$r([Optional("rangeService")],UndoRedoService.prototype,"rangeService",void 0);__decorate$r([PostConstruct],UndoRedoService.prototype,"init",null);UndoRedoService=__decorate$r([Bean("undoRedoService")],UndoRedoService);var __decorate$q=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let HeaderPositionUtils=class extends BeanStub{findHeader(e,t){let n,o,a;if(e.column instanceof ColumnGroup?(o=`getDisplayedGroup${t}`,n=this.columnModel[o](e.column)):(a=`getDisplayedCol${t}`,n=this.columnModel[a](e.column)),!n)return;let{headerRowIndex:l}=e;if(this.getHeaderRowType(l)===HeaderRowType.COLUMN_GROUP){const m=n;if(m.isPadding()&&this.isAnyChildSpanningHeaderHeight(m)){const{nextFocusColumn:y,nextRow:D}=this.getColumnVisibleChild(m,l,t);y&&(n=y,l=D)}}return{column:n,headerRowIndex:l}}isAnyChildSpanningHeaderHeight(e){return e?e.getLeafColumns().some(t=>t.isSpanHeaderHeight()):!1}getColumnVisibleParent(e,t){const n=this.getHeaderRowType(t),o=n===HeaderRowType.FLOATING_FILTER,a=n===HeaderRowType.COLUMN;let l=o?e:e.getParent(),s=t-1;if(a&&this.isAnyChildSpanningHeaderHeight(e.getParent())){for(;l&&l.isPadding();)l=l.getParent(),s--;s<0&&(l=e,s=t)}return{nextFocusColumn:l,nextRow:s}}getColumnVisibleChild(e,t,n="After"){const o=this.getHeaderRowType(t);let a=e,l=t+1;if(o===HeaderRowType.COLUMN_GROUP){const s=e.getLeafColumns(),m=n==="After"?s[0]:last(s);if(this.isAnyChildSpanningHeaderHeight(m.getParent())){a=m;let y=m.getParent();for(;y&&y!==e;)y=y.getParent(),l++}else a=e.getDisplayedChildren()[0]}return{nextFocusColumn:a,nextRow:l}}getHeaderRowType(e){const t=this.ctrlsService.getHeaderRowContainerCtrl();if(t)return t.getRowType(e)}findColAtEdgeForHeaderRow(e,t){const n=this.columnModel.getAllDisplayedColumns(),o=n[t==="start"?0:n.length-1];if(!o)return;const l=this.ctrlsService.getHeaderRowContainerCtrl(o.getPinned()).getRowType(e);if(l==HeaderRowType.COLUMN_GROUP){const s=this.columnModel.getColumnGroupAtLevel(o,e);return{headerRowIndex:e,column:s}}return{headerRowIndex:l==null?-1:e,column:o}}};__decorate$q([Autowired("columnModel")],HeaderPositionUtils.prototype,"columnModel",void 0);__decorate$q([Autowired("ctrlsService")],HeaderPositionUtils.prototype,"ctrlsService",void 0);HeaderPositionUtils=__decorate$q([Bean("headerPositionUtils")],HeaderPositionUtils);var __decorate$p=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let ColumnDefFactory=class{buildColumnDefs(e,t,n){const o=[],a={};return e.forEach(l=>{const s=this.createDefFromColumn(l,t,n);let m=!0,y=s,D=l.getOriginalParent(),W=null;for(;D;){let Ee=null;if(D.isPadding()){D=D.getOriginalParent();continue}const dt=a[D.getGroupId()];if(dt){dt.children.push(y),m=!1;break}if(Ee=this.createDefFromGroup(D),Ee&&(Ee.children=[y],a[Ee.groupId]=Ee,y=Ee,D=D.getOriginalParent()),D!=null&&W===D){m=!1;break}W=D}m&&o.push(y)}),o}createDefFromGroup(e){const t=deepCloneDefinition(e.getColGroupDef(),["children"]);return t&&(t.groupId=e.getGroupId()),t}createDefFromColumn(e,t,n){const o=deepCloneDefinition(e.getColDef());return o.colId=e.getColId(),o.width=e.getActualWidth(),o.rowGroup=e.isRowGroupActive(),o.rowGroupIndex=e.isRowGroupActive()?t.indexOf(e):null,o.pivot=e.isPivotActive(),o.pivotIndex=e.isPivotActive()?n.indexOf(e):null,o.aggFunc=e.isValueActive()?e.getAggFunc():null,o.hide=e.isVisible()?void 0:!0,o.pinned=e.isPinned()?e.getPinned():null,o.sort=e.getSort()?e.getSort():null,o.sortIndex=e.getSortIndex()!=null?e.getSortIndex():null,o}};ColumnDefFactory=__decorate$p([Bean("columnDefFactory")],ColumnDefFactory);var __decorate$o=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let RowCssClassCalculator=class{getInitialRowClasses(e){const t=[];return exists(e.extraCssClass)&&t.push(e.extraCssClass),t.push("ag-row"),t.push(e.rowFocused?"ag-row-focus":"ag-row-no-focus"),e.fadeRowIn&&t.push("ag-opacity-zero"),t.push(e.rowIsEven?"ag-row-even":"ag-row-odd"),e.rowNode.isRowPinned()&&t.push("ag-row-pinned"),e.rowNode.isSelected()&&t.push("ag-row-selected"),e.rowNode.footer&&t.push("ag-row-footer"),t.push("ag-row-level-"+e.rowLevel),e.rowNode.stub&&t.push("ag-row-loading"),e.fullWidthRow&&t.push("ag-full-width-row"),e.expandable&&(t.push("ag-row-group"),t.push(e.rowNode.expanded?"ag-row-group-expanded":"ag-row-group-contracted")),e.rowNode.dragging&&t.push("ag-row-dragging"),pushAll(t,this.processClassesFromGridOptions(e.rowNode)),pushAll(t,this.preProcessRowClassRules(e.rowNode)),t.push(e.printLayout?"ag-row-position-relative":"ag-row-position-absolute"),e.firstRowOnPage&&t.push("ag-row-first"),e.lastRowOnPage&&t.push("ag-row-last"),e.fullWidthRow&&(e.pinned==="left"&&t.push("ag-cell-last-left-pinned"),e.pinned==="right"&&t.push("ag-cell-first-right-pinned")),t}processClassesFromGridOptions(e){const t=[],n=l=>{typeof l=="string"?t.push(l):Array.isArray(l)&&l.forEach(s=>t.push(s))},o=this.gridOptionsService.get("rowClass");if(o){if(typeof o=="function")return console.warn("AG Grid: rowClass should not be a function, please use getRowClass instead"),[];n(o)}const a=this.gridOptionsService.getCallback("getRowClass");if(a){const l={data:e.data,node:e,rowIndex:e.rowIndex},s=a(l);n(s)}return t}preProcessRowClassRules(e){const t=[];return this.processRowClassRules(e,n=>{t.push(n)},n=>{}),t}processRowClassRules(e,t,n){const o={data:e.data,node:e,rowIndex:e.rowIndex,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context};this.stylingService.processClassRules(this.gridOptionsService.get("rowClassRules"),o,t,n)}calculateRowLevel(e){return e.group?e.level:e.parent?e.parent.level+1:0}};__decorate$o([Autowired("stylingService")],RowCssClassCalculator.prototype,"stylingService",void 0);__decorate$o([Autowired("gridOptionsService")],RowCssClassCalculator.prototype,"gridOptionsService",void 0);RowCssClassCalculator=__decorate$o([Bean("rowCssClassCalculator")],RowCssClassCalculator);var __decorate$n=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let RowNodeSorter=class extends BeanStub{init(){this.isAccentedSort=this.gridOptionsService.is("accentedSort"),this.primaryColumnsSortGroups=this.gridOptionsService.isColumnsSortingCoupledToGroup(),this.addManagedPropertyListener("accentedSort",e=>this.isAccentedSort=e.currentValue),this.addManagedPropertyListener("autoGroupColumnDef",()=>this.primaryColumnsSortGroups=this.gridOptionsService.isColumnsSortingCoupledToGroup())}doFullSort(e,t){const n=(a,l)=>({currentPos:l,rowNode:a}),o=e.map(n);return o.sort(this.compareRowNodes.bind(this,t)),o.map(a=>a.rowNode)}compareRowNodes(e,t,n){const o=t.rowNode,a=n.rowNode;for(let l=0,s=e.length;l<s;l++){const m=e[l],y=m.sort==="desc",D=this.getValue(o,m.column),W=this.getValue(a,m.column);let Ee;const dt=this.getComparator(m,o);if(dt?Ee=dt(D,W,o,a,y):Ee=_.defaultComparator(D,W,this.isAccentedSort),!isNaN(Ee)&&Ee!==0)return m.sort==="asc"?Ee:Ee*-1}return t.currentPos-n.currentPos}getComparator(e,t){const n=e.column,o=n.getColDef().comparator;if(o!=null)return o;if(!n.getColDef().showRowGroup)return;const a=!t.group&&n.getColDef().field;if(!a)return;const l=this.columnModel.getPrimaryColumn(a);if(l)return l.getColDef().comparator}getValue(e,t){var n,o;if(!this.primaryColumnsSortGroups)return this.valueService.getValue(t,e,!1,!1);if(e.rowGroupColumn===t){if(this.gridOptionsService.isGroupUseEntireRow(this.columnModel.isPivotActive())){if(t.getColDef().keyCreator)return e.key;const y=(n=e.allLeafChildren)===null||n===void 0?void 0:n[0];return y?this.valueService.getValue(t,y,!1,!1):void 0}const s=this.columnModel.getGroupDisplayColumnForGroup(t.getId());return s?(o=e.groupData)===null||o===void 0?void 0:o[s.getId()]:void 0}if(!(e.group&&t.getColDef().showRowGroup))return this.valueService.getValue(t,e,!1,!1)}};__decorate$n([Autowired("valueService")],RowNodeSorter.prototype,"valueService",void 0);__decorate$n([Autowired("columnModel")],RowNodeSorter.prototype,"columnModel",void 0);__decorate$n([PostConstruct],RowNodeSorter.prototype,"init",null);RowNodeSorter=__decorate$n([Bean("rowNodeSorter")],RowNodeSorter);var __decorate$m=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},CtrlsService_1;let CtrlsService=CtrlsService_1=class extends BeanStub{constructor(){super(...arguments),this.ready=!1,this.readyCallbacks=[]}checkReady(){if(this.ready=this.gridCtrl!=null&&this.gridBodyCtrl!=null&&this.centerRowContainerCtrl!=null&&this.leftRowContainerCtrl!=null&&this.rightRowContainerCtrl!=null&&this.bottomCenterRowContainerCtrl!=null&&this.bottomLeftRowContainerCtrl!=null&&this.bottomRightRowContainerCtrl!=null&&this.topCenterRowContainerCtrl!=null&&this.topLeftRowContainerCtrl!=null&&this.topRightRowContainerCtrl!=null&&this.stickyTopCenterRowContainerCtrl!=null&&this.stickyTopLeftRowContainerCtrl!=null&&this.stickyTopRightRowContainerCtrl!=null&&this.centerHeaderRowContainerCtrl!=null&&this.leftHeaderRowContainerCtrl!=null&&this.rightHeaderRowContainerCtrl!=null&&this.fakeHScrollComp!=null&&this.fakeVScrollComp!=null&&this.gridHeaderCtrl!=null,this.ready){const e=this.createReadyParams();this.readyCallbacks.forEach(t=>t(e)),this.readyCallbacks.length=0}}whenReady(e){this.ready?e(this.createReadyParams()):this.readyCallbacks.push(e)}createReadyParams(){return{centerRowContainerCtrl:this.centerRowContainerCtrl,leftRowContainerCtrl:this.leftRowContainerCtrl,rightRowContainerCtrl:this.rightRowContainerCtrl,bottomCenterRowContainerCtrl:this.bottomCenterRowContainerCtrl,bottomLeftRowContainerCtrl:this.bottomLeftRowContainerCtrl,bottomRightRowContainerCtrl:this.bottomRightRowContainerCtrl,topCenterRowContainerCtrl:this.topCenterRowContainerCtrl,topLeftRowContainerCtrl:this.topLeftRowContainerCtrl,topRightRowContainerCtrl:this.topRightRowContainerCtrl,stickyTopCenterRowContainerCtrl:this.stickyTopCenterRowContainerCtrl,stickyTopLeftRowContainerCtrl:this.stickyTopLeftRowContainerCtrl,stickyTopRightRowContainerCtrl:this.stickyTopRightRowContainerCtrl,centerHeaderRowContainerCtrl:this.centerHeaderRowContainerCtrl,leftHeaderRowContainerCtrl:this.leftHeaderRowContainerCtrl,rightHeaderRowContainerCtrl:this.rightHeaderRowContainerCtrl,fakeHScrollComp:this.fakeHScrollComp,fakeVScrollComp:this.fakeVScrollComp,gridBodyCtrl:this.gridBodyCtrl,gridCtrl:this.gridCtrl,gridHeaderCtrl:this.gridHeaderCtrl}}registerFakeHScrollComp(e){this.fakeHScrollComp=e,this.checkReady()}registerFakeVScrollComp(e){this.fakeVScrollComp=e,this.checkReady()}registerGridHeaderCtrl(e){this.gridHeaderCtrl=e,this.checkReady()}registerCenterRowContainerCtrl(e){this.centerRowContainerCtrl=e,this.checkReady()}registerLeftRowContainerCtrl(e){this.leftRowContainerCtrl=e,this.checkReady()}registerRightRowContainerCtrl(e){this.rightRowContainerCtrl=e,this.checkReady()}registerTopCenterRowContainerCtrl(e){this.topCenterRowContainerCtrl=e,this.checkReady()}registerTopLeftRowContainerCon(e){this.topLeftRowContainerCtrl=e,this.checkReady()}registerTopRightRowContainerCtrl(e){this.topRightRowContainerCtrl=e,this.checkReady()}registerStickyTopCenterRowContainerCtrl(e){this.stickyTopCenterRowContainerCtrl=e,this.checkReady()}registerStickyTopLeftRowContainerCon(e){this.stickyTopLeftRowContainerCtrl=e,this.checkReady()}registerStickyTopRightRowContainerCtrl(e){this.stickyTopRightRowContainerCtrl=e,this.checkReady()}registerBottomCenterRowContainerCtrl(e){this.bottomCenterRowContainerCtrl=e,this.checkReady()}registerBottomLeftRowContainerCtrl(e){this.bottomLeftRowContainerCtrl=e,this.checkReady()}registerBottomRightRowContainerCtrl(e){this.bottomRightRowContainerCtrl=e,this.checkReady()}registerHeaderContainer(e,t){switch(t){case"left":this.leftHeaderRowContainerCtrl=e;break;case"right":this.rightHeaderRowContainerCtrl=e;break;default:this.centerHeaderRowContainerCtrl=e;break}this.checkReady()}registerGridBodyCtrl(e){this.gridBodyCtrl=e,this.checkReady()}registerGridCtrl(e){this.gridCtrl=e,this.checkReady()}getFakeHScrollComp(){return this.fakeHScrollComp}getFakeVScrollComp(){return this.fakeVScrollComp}getGridHeaderCtrl(){return this.gridHeaderCtrl}getGridCtrl(){return this.gridCtrl}getCenterRowContainerCtrl(){return this.centerRowContainerCtrl}getTopCenterRowContainerCtrl(){return this.topCenterRowContainerCtrl}getBottomCenterRowContainerCtrl(){return this.bottomCenterRowContainerCtrl}getStickyTopCenterRowContainerCtrl(){return this.stickyTopCenterRowContainerCtrl}getGridBodyCtrl(){return this.gridBodyCtrl}getHeaderRowContainerCtrls(){return[this.leftHeaderRowContainerCtrl,this.rightHeaderRowContainerCtrl,this.centerHeaderRowContainerCtrl]}getHeaderRowContainerCtrl(e){switch(e){case"left":return this.leftHeaderRowContainerCtrl;case"right":return this.rightHeaderRowContainerCtrl;default:return this.centerHeaderRowContainerCtrl}}};CtrlsService.NAME="ctrlsService";CtrlsService=CtrlsService_1=__decorate$m([Bean(CtrlsService_1.NAME)],CtrlsService);var __decorate$l=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let CtrlsFactory=class extends BeanStub{constructor(){super(...arguments),this.registry={}}register(e){this.registry[e.controllerName]=e.controllerClass}getInstance(e){const t=this.registry[e];if(t!=null)return new t}};CtrlsFactory=__decorate$l([Bean("ctrlsFactory")],CtrlsFactory);var __decorate$k=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class AbstractFakeScrollComp extends Component{constructor(e,t){super(e),this.direction=t,this.hideTimeout=null}postConstruct(){this.addManagedListener(this.eventService,Events.EVENT_SCROLL_VISIBILITY_CHANGED,this.onScrollVisibilityChanged.bind(this)),this.onScrollVisibilityChanged(),this.addOrRemoveCssClass("ag-apple-scrollbar",isMacOsUserAgent()||isIOSUserAgent())}initialiseInvisibleScrollbar(){this.invisibleScrollbar===void 0&&(this.invisibleScrollbar=isInvisibleScrollbar(),this.invisibleScrollbar&&(this.hideAndShowInvisibleScrollAsNeeded(),this.addActiveListenerToggles()))}addActiveListenerToggles(){const e=["mouseenter","mousedown","touchstart"],t=["mouseleave","touchend"],n=this.getGui();e.forEach(o=>this.addManagedListener(n,o,()=>this.addOrRemoveCssClass("ag-scrollbar-active",!0))),t.forEach(o=>this.addManagedListener(n,o,()=>this.addOrRemoveCssClass("ag-scrollbar-active",!1)))}onScrollVisibilityChanged(){this.invisibleScrollbar===void 0&&this.initialiseInvisibleScrollbar(),this.animationFrameService.requestAnimationFrame(()=>this.setScrollVisible())}hideAndShowInvisibleScrollAsNeeded(){this.addManagedListener(this.eventService,Events.EVENT_BODY_SCROLL,e=>{e.direction===this.direction&&(this.hideTimeout!==null&&(window.clearTimeout(this.hideTimeout),this.hideTimeout=null),this.addOrRemoveCssClass("ag-scrollbar-scrolling",!0))}),this.addManagedListener(this.eventService,Events.EVENT_BODY_SCROLL_END,()=>{this.hideTimeout=window.setTimeout(()=>{this.addOrRemoveCssClass("ag-scrollbar-scrolling",!1),this.hideTimeout=null},400)})}attemptSettingScrollPosition(e){const t=this.getViewport();waitUntil(()=>isVisible(t),()=>this.setScrollPosition(e),100)}getViewport(){return this.eViewport}getContainer(){return this.eContainer}onScrollCallback(e){this.addManagedListener(this.getViewport(),"scroll",e)}}__decorate$k([RefSelector("eViewport")],AbstractFakeScrollComp.prototype,"eViewport",void 0);__decorate$k([RefSelector("eContainer")],AbstractFakeScrollComp.prototype,"eContainer",void 0);__decorate$k([Autowired("scrollVisibleService")],AbstractFakeScrollComp.prototype,"scrollVisibleService",void 0);__decorate$k([Autowired("ctrlsService")],AbstractFakeScrollComp.prototype,"ctrlsService",void 0);__decorate$k([Autowired("animationFrameService")],AbstractFakeScrollComp.prototype,"animationFrameService",void 0);var __decorate$j=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class FakeHScrollComp extends AbstractFakeScrollComp{constructor(){super(FakeHScrollComp.TEMPLATE,"horizontal")}postConstruct(){super.postConstruct();const e=this.setFakeHScrollSpacerWidths.bind(this);this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,e),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED,e),this.addManagedListener(this.eventService,Events.EVENT_PINNED_ROW_DATA_CHANGED,this.onPinnedRowDataChanged.bind(this)),this.addManagedPropertyListener("domLayout",e),this.ctrlsService.registerFakeHScrollComp(this),this.createManagedBean(new CenterWidthFeature(t=>this.eContainer.style.width=`${t}px`))}initialiseInvisibleScrollbar(){this.invisibleScrollbar===void 0&&(this.enableRtl=this.gridOptionsService.is("enableRtl"),super.initialiseInvisibleScrollbar(),this.invisibleScrollbar&&this.refreshCompBottom())}onPinnedRowDataChanged(){this.refreshCompBottom()}refreshCompBottom(){if(!this.invisibleScrollbar)return;const e=this.pinnedRowModel.getPinnedBottomTotalHeight();this.getGui().style.bottom=`${e}px`}onScrollVisibilityChanged(){super.onScrollVisibilityChanged(),this.setFakeHScrollSpacerWidths()}setFakeHScrollSpacerWidths(){const e=this.scrollVisibleService.isVerticalScrollShowing();let t=this.columnModel.getDisplayedColumnsRightWidth();const n=!this.enableRtl&&e,o=this.gridOptionsService.getScrollbarWidth();n&&(t+=o),setFixedWidth(this.eRightSpacer,t),this.eRightSpacer.classList.toggle("ag-scroller-corner",t<=o);let a=this.columnModel.getDisplayedColumnsLeftWidth();this.enableRtl&&e&&(a+=o),setFixedWidth(this.eLeftSpacer,a),this.eLeftSpacer.classList.toggle("ag-scroller-corner",a<=o)}setScrollVisible(){const e=this.scrollVisibleService.isHorizontalScrollShowing(),t=this.invisibleScrollbar,n=this.gridOptionsService.is("suppressHorizontalScroll"),o=e&&this.gridOptionsService.getScrollbarWidth()||0,l=n?0:o===0&&t?16:o;this.addOrRemoveCssClass("ag-scrollbar-invisible",t),setFixedHeight(this.getGui(),l),setFixedHeight(this.eViewport,l),setFixedHeight(this.eContainer,l),this.setDisplayed(e,{skipAriaHidden:!0})}getScrollPosition(){return getScrollLeft(this.getViewport(),this.enableRtl)}setScrollPosition(e){isVisible(this.getViewport())||this.attemptSettingScrollPosition(e),setScrollLeft(this.getViewport(),e,this.enableRtl)}}FakeHScrollComp.TEMPLATE=`<div class="ag-body-horizontal-scroll" aria-hidden="true">
            <div class="ag-horizontal-left-spacer" ref="eLeftSpacer"></div>
            <div class="ag-body-horizontal-scroll-viewport" ref="eViewport">
                <div class="ag-body-horizontal-scroll-container" ref="eContainer"></div>
            </div>
            <div class="ag-horizontal-right-spacer" ref="eRightSpacer"></div>
        </div>`;__decorate$j([RefSelector("eLeftSpacer")],FakeHScrollComp.prototype,"eLeftSpacer",void 0);__decorate$j([RefSelector("eRightSpacer")],FakeHScrollComp.prototype,"eRightSpacer",void 0);__decorate$j([Autowired("columnModel")],FakeHScrollComp.prototype,"columnModel",void 0);__decorate$j([Autowired("pinnedRowModel")],FakeHScrollComp.prototype,"pinnedRowModel",void 0);__decorate$j([PostConstruct],FakeHScrollComp.prototype,"postConstruct",null);var __decorate$i=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let PinnedWidthService=class extends BeanStub{postConstruct(){const e=this.checkContainerWidths.bind(this);this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,e),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED,e),this.addManagedPropertyListener("domLayout",e)}checkContainerWidths(){const e=this.gridOptionsService.isDomLayout("print"),t=e?0:this.columnModel.getDisplayedColumnsLeftWidth(),n=e?0:this.columnModel.getDisplayedColumnsRightWidth();t!=this.leftWidth&&(this.leftWidth=t,this.eventService.dispatchEvent({type:Events.EVENT_LEFT_PINNED_WIDTH_CHANGED})),n!=this.rightWidth&&(this.rightWidth=n,this.eventService.dispatchEvent({type:Events.EVENT_RIGHT_PINNED_WIDTH_CHANGED}))}getPinnedRightWidth(){return this.rightWidth}getPinnedLeftWidth(){return this.leftWidth}};__decorate$i([Autowired("columnModel")],PinnedWidthService.prototype,"columnModel",void 0);__decorate$i([PostConstruct],PinnedWidthService.prototype,"postConstruct",null);PinnedWidthService=__decorate$i([Bean("pinnedWidthService")],PinnedWidthService);var __decorate$h=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let RowNodeEventThrottle=class extends BeanStub{constructor(){super(...arguments),this.events=[]}postConstruct(){this.rowModel.getType()=="clientSide"&&(this.clientSideRowModel=this.rowModel)}dispatchExpanded(e){if(this.clientSideRowModel==null){this.eventService.dispatchEvent(e);return}this.events.push(e);const t=()=>{this.clientSideRowModel&&this.clientSideRowModel.onRowGroupOpened(),this.events.forEach(n=>this.eventService.dispatchEvent(n)),this.events=[]};this.dispatchExpandedDebounced==null&&(this.dispatchExpandedDebounced=this.animationFrameService.debounce(t)),this.dispatchExpandedDebounced()}};__decorate$h([Autowired("animationFrameService")],RowNodeEventThrottle.prototype,"animationFrameService",void 0);__decorate$h([Autowired("rowModel")],RowNodeEventThrottle.prototype,"rowModel",void 0);__decorate$h([PostConstruct],RowNodeEventThrottle.prototype,"postConstruct",null);RowNodeEventThrottle=__decorate$h([Bean("rowNodeEventThrottle")],RowNodeEventThrottle);var __decorate$g=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},__param$1=function(r,e){return function(t,n){e(t,n,r)}};function toNumber(r){if(typeof r=="number")return r;if(typeof r=="string")return parseInt(r,10)}function isTrue(r){return r===!0||r==="true"}let GridOptionsService=class{constructor(){this.destroyed=!1,this.domDataKey="__AG_"+Math.random().toString(),this.propertyEventService=new EventService}get context(){return this.gridOptions.context}agWire(e,t){this.gridOptions.api=e,this.gridOptions.columnApi=t,this.api=e,this.columnApi=t}init(){this.gridOptionLookup=new Set([...ComponentUtil.ALL_PROPERTIES,...ComponentUtil.EVENT_CALLBACKS]);const e=!this.is("suppressAsyncEvents");this.eventService.addGlobalListener(this.globalEventHandler.bind(this),e),this.getScrollbarWidth()}destroy(){this.gridOptions.api=null,this.gridOptions.columnApi=null,this.destroyed=!0}is(e){return isTrue(this.gridOptions[e])}get(e){return this.gridOptions[e]}getNum(e){return toNumber(this.gridOptions[e])}getCallback(e){return this.mergeGridCommonParams(this.gridOptions[e])}exists(e){return exists(this.gridOptions[e])}mergeGridCommonParams(e){return e&&(n=>{const o=n;return o.api=this.api,o.columnApi=this.columnApi,o.context=this.context,e(o)})}set(e,t,n=!1,o={}){if(this.gridOptionLookup.has(e)){const a=this.gridOptions[e];if(n||a!==t){this.gridOptions[e]=t;const l=Object.assign({type:e,currentValue:t,previousValue:a},o);this.propertyEventService.dispatchEvent(l)}}}addEventListener(e,t){this.propertyEventService.addEventListener(e,t)}removeEventListener(e,t){this.propertyEventService.removeEventListener(e,t)}globalEventHandler(e,t){if(this.destroyed)return;const n=ComponentUtil.getCallbackForEvent(e);typeof this.gridOptions[n]=="function"&&this.gridOptions[n](t)}getGridId(){return this.api.getGridId()}getScrollbarWidth(){if(this.scrollbarWidth==null){const t=typeof this.gridOptions.scrollbarWidth=="number"&&this.gridOptions.scrollbarWidth>=0?this.gridOptions.scrollbarWidth:getScrollbarWidth();t!=null&&(this.scrollbarWidth=t,this.eventService.dispatchEvent({type:Events.EVENT_SCROLLBAR_WIDTH_CHANGED}))}return this.scrollbarWidth}isRowModelType(e){return this.gridOptions.rowModelType===e||e==="clientSide"&&missing(this.gridOptions.rowModelType)}isDomLayout(e){var t;return((t=this.gridOptions.domLayout)!==null&&t!==void 0?t:"normal")===e}isRowSelection(){return this.gridOptions.rowSelection==="single"||this.gridOptions.rowSelection==="multiple"}useAsyncEvents(){return!this.is("suppressAsyncEvents")}isGetRowHeightFunction(){return typeof this.gridOptions.getRowHeight=="function"}getRowHeightForNode(e,t=!1,n){if(n==null&&(n=this.environment.getDefaultRowHeight()),this.isGetRowHeightFunction()){if(t)return{height:n,estimated:!0};const a={node:e,data:e.data},l=this.getCallback("getRowHeight")(a);if(this.isNumeric(l))return l===0&&doOnce(()=>console.warn("AG Grid: The return of `getRowHeight` cannot be zero. If the intention is to hide rows, use a filter instead."),"invalidRowHeight"),{height:Math.max(1,l),estimated:!1}}return e.detail&&this.is("masterDetail")?this.getMasterDetailRowHeight():{height:this.gridOptions.rowHeight&&this.isNumeric(this.gridOptions.rowHeight)?this.gridOptions.rowHeight:n,estimated:!1}}getMasterDetailRowHeight(){return this.is("detailRowAutoHeight")?{height:1,estimated:!1}:this.isNumeric(this.gridOptions.detailRowHeight)?{height:this.gridOptions.detailRowHeight,estimated:!1}:{height:300,estimated:!1}}getRowHeightAsNumber(){if(!this.gridOptions.rowHeight||missing(this.gridOptions.rowHeight))return this.environment.getDefaultRowHeight();const e=this.gridOptions.rowHeight;return e&&this.isNumeric(e)?(this.environment.setRowHeightVariable(e),e):(console.warn("AG Grid row height must be a number if not using standard row model"),this.environment.getDefaultRowHeight())}isNumeric(e){return!isNaN(e)&&typeof e=="number"&&isFinite(e)}getDomDataKey(){return this.domDataKey}getDomData(e,t){const n=e[this.getDomDataKey()];return n?n[t]:void 0}setDomData(e,t,n){const o=this.getDomDataKey();let a=e[o];missing(a)&&(a={},e[o]=a),a[t]=n}getDocument(){let e=null;return this.gridOptions.getDocument&&exists(this.gridOptions.getDocument)?e=this.gridOptions.getDocument():this.eGridDiv&&(e=this.eGridDiv.ownerDocument),e&&exists(e)?e:document}getWindow(){return this.getDocument().defaultView||window}getRootNode(){return this.eGridDiv.getRootNode()}getAsyncTransactionWaitMillis(){return exists(this.gridOptions.asyncTransactionWaitMillis)?this.gridOptions.asyncTransactionWaitMillis:50}isAnimateRows(){return this.is("ensureDomOrder")?!1:this.is("animateRows")}isGroupRowsSticky(){return!(this.is("suppressGroupRowsSticky")||this.is("paginateChildRows")||this.is("groupHideOpenParents"))}isTreeData(){return this.is("treeData")&&ModuleRegistry.__assertRegistered(ModuleNames.RowGroupingModule,"Tree Data",this.api.getGridId())}isMasterDetail(){return this.is("masterDetail")&&ModuleRegistry.__assertRegistered(ModuleNames.MasterDetailModule,"masterDetail",this.api.getGridId())}isEnableRangeSelection(){return this.is("enableRangeSelection")&&ModuleRegistry.__isRegistered(ModuleNames.RangeSelectionModule,this.api.getGridId())}isColumnsSortingCoupledToGroup(){const e=this.gridOptions.autoGroupColumnDef;return this.isRowModelType("clientSide")&&!(e!=null&&e.comparator)&&!this.isTreeData()}getGroupAggFiltering(){const e=this.gridOptions.groupAggFiltering;if(typeof e=="function")return this.getCallback("groupAggFiltering");if(isTrue(e))return()=>!0}isGroupMultiAutoColumn(){return this.gridOptions.groupDisplayType?matchesGroupDisplayType("multipleColumns",this.gridOptions.groupDisplayType):this.is("groupHideOpenParents")}isGroupUseEntireRow(e){return e?!1:this.gridOptions.groupDisplayType?matchesGroupDisplayType("groupRows",this.gridOptions.groupDisplayType):!1}};__decorate$g([Autowired("gridOptions")],GridOptionsService.prototype,"gridOptions",void 0);__decorate$g([Autowired("eventService")],GridOptionsService.prototype,"eventService",void 0);__decorate$g([Autowired("environment")],GridOptionsService.prototype,"environment",void 0);__decorate$g([Autowired("eGridDiv")],GridOptionsService.prototype,"eGridDiv",void 0);__decorate$g([__param$1(0,Qualifier("gridApi")),__param$1(1,Qualifier("columnApi"))],GridOptionsService.prototype,"agWire",null);__decorate$g([PostConstruct],GridOptionsService.prototype,"init",null);__decorate$g([PreDestroy],GridOptionsService.prototype,"destroy",null);GridOptionsService=__decorate$g([Bean("gridOptionsService")],GridOptionsService);var __decorate$f=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let LocaleService=class extends BeanStub{getLocaleTextFunc(){const e=this.gridOptionsService.getCallback("getLocaleText");if(e)return(n,o,a)=>e({key:n,defaultValue:o,variableValues:a});const t=this.gridOptionsService.get("localeText");return(n,o,a)=>{let l=t&&t[n];if(l&&a&&a.length){let s=0;for(;!(s>=a.length||l.indexOf("${variable}")===-1);)l=l.replace("${variable}",a[s++])}return l??o}}};LocaleService=__decorate$f([Bean("localeService")],LocaleService);var __decorate$e=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class FakeVScrollComp extends AbstractFakeScrollComp{constructor(){super(FakeVScrollComp.TEMPLATE,"vertical")}postConstruct(){super.postConstruct(),this.createManagedBean(new SetHeightFeature(this.eContainer)),this.ctrlsService.registerFakeVScrollComp(this),this.addManagedListener(this.eventService,Events.EVENT_ROW_CONTAINER_HEIGHT_CHANGED,this.onRowContainerHeightChanged.bind(this))}setScrollVisible(){const e=this.scrollVisibleService.isVerticalScrollShowing(),t=this.invisibleScrollbar,n=e&&this.gridOptionsService.getScrollbarWidth()||0,o=n===0&&t?16:n;this.addOrRemoveCssClass("ag-scrollbar-invisible",t),setFixedWidth(this.getGui(),o),setFixedWidth(this.eViewport,o),setFixedWidth(this.eContainer,o),this.setDisplayed(e,{skipAriaHidden:!0})}onRowContainerHeightChanged(){const t=this.ctrlsService.getGridBodyCtrl().getBodyViewportElement();this.eViewport.scrollTop!=t.scrollTop&&(this.eViewport.scrollTop=t.scrollTop)}getScrollPosition(){return this.getViewport().scrollTop}setScrollPosition(e){isVisible(this.getViewport())||this.attemptSettingScrollPosition(e),this.getViewport().scrollTop=e}}FakeVScrollComp.TEMPLATE=`<div class="ag-body-vertical-scroll" aria-hidden="true">
            <div class="ag-body-vertical-scroll-viewport" ref="eViewport">
                <div class="ag-body-vertical-scroll-container" ref="eContainer"></div>
            </div>
        </div>`;__decorate$e([PostConstruct],FakeVScrollComp.prototype,"postConstruct",null);var __decorate$d=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const MONTH_LOCALE_TEXT={january:"January",february:"February",march:"March",april:"April",may:"May",june:"June",july:"July",august:"August",september:"September",october:"October",november:"November",december:"December"},MONTH_KEYS=["january","february","march","april","may","june","july","august","september","october","november","december"];let DataTypeService=class extends BeanStub{constructor(){super(...arguments),this.dataTypeDefinitions={},this.isWaitingForRowData=!1,this.isColumnTypeOverrideInDataTypeDefinitions=!1,this.columnStateUpdatesPendingInference={},this.columnStateUpdateListenerDestroyFuncs=[]}init(){this.groupHideOpenParents=this.gridOptionsService.is("groupHideOpenParents"),this.addManagedPropertyListener("groupHideOpenParents",()=>{this.groupHideOpenParents=this.gridOptionsService.is("groupHideOpenParents")}),this.processDataTypeDefinitions(),this.addManagedPropertyListener("dataTypeDefinitions",()=>{this.processDataTypeDefinitions(),this.columnModel.recreateColumnDefs("gridOptionsChanged")})}processDataTypeDefinitions(){var e;const t=this.getDefaultDataTypes();this.dataTypeDefinitions={},Object.entries(t).forEach(([o,a])=>{this.dataTypeDefinitions[o]=Object.assign(Object.assign({},a),{groupSafeValueFormatter:this.createGroupSafeValueFormatter(a)})});const n=(e=this.gridOptionsService.get("dataTypeDefinitions"))!==null&&e!==void 0?e:{};this.dataTypeMatchers={},Object.entries(n).forEach(([o,a])=>{const l=this.processDataTypeDefinition(a,n,[o],t);l&&(this.dataTypeDefinitions[o]=l,a.dataTypeMatcher&&(this.dataTypeMatchers[o]=a.dataTypeMatcher))}),this.checkObjectValueHandlers(t),["dateString","text","number","boolean","date"].forEach(o=>{const a=this.dataTypeMatchers[o];a&&delete this.dataTypeMatchers[o],this.dataTypeMatchers[o]=a??t[o].dataTypeMatcher})}mergeDataTypeDefinitions(e,t){const n=Object.assign(Object.assign({},e),t);return e.columnTypes&&t.columnTypes&&t.appendColumnTypes&&(n.columnTypes=[...this.convertColumnTypes(e.columnTypes),...this.convertColumnTypes(t.columnTypes)]),n}processDataTypeDefinition(e,t,n,o){let a;const l=e.extendsDataType;if(e.columnTypes&&(this.isColumnTypeOverrideInDataTypeDefinitions=!0),e.extendsDataType===e.baseDataType){const s=o[l];if(!this.validateDataTypeDefinition(e,s,l))return;a=this.mergeDataTypeDefinitions(s,e)}else{if(n.includes(l)){doOnce(()=>console.warn('AG Grid: Data type definition hierarchies (via the "extendsDataType" property) cannot contain circular references.'),"dataTypeExtendsCircularRef");return}const s=t[l];if(!this.validateDataTypeDefinition(e,s,l))return;const m=this.processDataTypeDefinition(s,t,[...n,l],o);if(!m)return;a=this.mergeDataTypeDefinitions(m,e)}return Object.assign(Object.assign({},a),{groupSafeValueFormatter:this.createGroupSafeValueFormatter(a)})}validateDataTypeDefinition(e,t,n){return t?t.baseDataType!==e.baseDataType?(doOnce(()=>console.warn('AG Grid: The "baseDataType" property of a data type definition must match that of its parent.'),"dataTypeBaseTypesMatch"),!1):!0:(doOnce(()=>console.warn(`AG Grid: The data type definition ${n} does not exist.`),"dataTypeDefMissing"+n),!1)}createGroupSafeValueFormatter(e){if(e.valueFormatter)return t=>{var n,o;if(!((n=t.node)===null||n===void 0)&&n.group){const a=t.column.getAggFunc();if(a){if(a==="first"||a==="last")return e.valueFormatter(t);if(e.baseDataType==="number"&&a!=="count"){if(typeof t.value=="number")return e.valueFormatter(t);if(typeof t.value=="object"){if(!t.value)return;if("toNumber"in t.value)return e.valueFormatter(Object.assign(Object.assign({},t),{value:t.value.toNumber()}));if("value"in t.value)return e.valueFormatter(Object.assign(Object.assign({},t),{value:t.value.value}))}}}return}else if(this.groupHideOpenParents&&t.column.isRowGroupActive())return typeof t.value!="string"||!((o=e.dataTypeMatcher)===null||o===void 0)&&o.call(e,t.value)?e.valueFormatter(t):void 0;return e.valueFormatter(t)}}updateColDefAndGetDataTypeDefinitionColumnType(e,t,n){let{cellDataType:o}=t;const{field:a}=t;if(o===void 0&&(o=e.cellDataType),(o==null||o===!0)&&(o=this.canInferCellDataType(e,t)?this.inferCellDataType(a,n):!1),!o){e.cellDataType=!1;return}const l=this.dataTypeDefinitions[o];if(!l){doOnce(()=>console.warn(`AG Grid: Missing data type definition - "${o}"`),"dataTypeMissing"+o);return}return e.cellDataType=o,l.groupSafeValueFormatter&&(e.valueFormatter=l.groupSafeValueFormatter),l.valueParser&&(e.valueParser=l.valueParser),l.suppressDefaultProperties||this.setColDefPropertiesForBaseDataType(e,l,n),l.columnTypes}updateColDefAndGetColumnType(e,t,n){var o,a;const l=this.updateColDefAndGetDataTypeDefinitionColumnType(e,t,n),s=(a=(o=t.type)!==null&&o!==void 0?o:l)!==null&&a!==void 0?a:e.type;return e.type=s,s?this.convertColumnTypes(s):void 0}addColumnListeners(e){if(!this.isWaitingForRowData)return;const t=this.columnStateUpdatesPendingInference[e.getColId()];if(!t)return;const n=o=>{t.add(o.key)};e.addEventListener(Column.EVENT_STATE_UPDATED,n),this.columnStateUpdateListenerDestroyFuncs.push(()=>e.removeEventListener(Column.EVENT_STATE_UPDATED,n))}canInferCellDataType(e,t){var n;if(this.rowModel.getType()!=="clientSide")return!1;const o={cellRenderer:!0,valueGetter:!0,valueParser:!0,refData:!0};if(this.doColDefPropsPreventInference(t,o))return!1;const a=t.type===null?e.type:t.type;if(a){const l=(n=this.gridOptionsService.get("columnTypes"))!==null&&n!==void 0?n:{};if(this.convertColumnTypes(a).some(m=>{const y=l[m.trim()];return y&&this.doColDefPropsPreventInference(y,o)}))return!1}return!this.doColDefPropsPreventInference(e,o)}doColDefPropsPreventInference(e,t){return[["cellRenderer","agSparklineCellRenderer"],["valueGetter",void 0],["valueParser",void 0],["refData",void 0]].some(([n,o])=>this.doesColDefPropPreventInference(e,t,n,o))}doesColDefPropPreventInference(e,t,n,o){if(!t[n])return!1;const a=e[n];return a===null?(t[n]=!1,!1):o===void 0?!!a:a===o}inferCellDataType(e,t){var n;if(!e)return;let o;const a=this.getInitialData();if(a){const s=e.indexOf(".")>=0&&!this.gridOptionsService.is("suppressFieldDotNotation");o=getValueUsingField(a,e,s)}else this.initWaitForRowData(t);if(o==null)return;const[l]=(n=Object.entries(this.dataTypeMatchers).find(([s,m])=>m(o)))!==null&&n!==void 0?n:["object"];return l}getInitialData(){const e=this.gridOptionsService.get("rowData");if(e!=null&&e.length)return e[0];if(this.initialData)return this.initialData;{const t=this.rowModel.getRootNode().allLeafChildren;if(t!=null&&t.length)return t[0].data}return null}initWaitForRowData(e){if(this.columnStateUpdatesPendingInference[e]=new Set,this.isWaitingForRowData)return;this.isWaitingForRowData=!0;const t=this.isColumnTypeOverrideInDataTypeDefinitions;t&&this.columnModel.queueResizeOperations();const n=this.addManagedListener(this.eventService,Events.EVENT_ROW_DATA_UPDATE_STARTED,o=>{const{firstRowData:a}=o;a&&(n==null||n(),this.isWaitingForRowData=!1,this.processColumnsPendingInference(a,t),this.columnStateUpdatesPendingInference={},t&&this.columnModel.processResizeOperations())})}processColumnsPendingInference(e,t){this.initialData=e;const n=[];this.columnStateUpdateListenerDestroyFuncs.forEach(l=>l()),this.columnStateUpdateListenerDestroyFuncs=[];const o={},a={};Object.entries(this.columnStateUpdatesPendingInference).forEach(([l,s])=>{const m=this.columnModel.getGridColumn(l);if(!m)return;const y=m.getColDef();if(!this.columnModel.resetColumnDefIntoColumn(m))return;const D=m.getColDef();if(t&&D.type&&D.type!==y.type){const W=this.getUpdatedColumnState(m,s);W.rowGroup&&W.rowGroupIndex==null&&(o[l]=W),W.pivot&&W.pivotIndex==null&&(a[l]=W),n.push(W)}}),t&&n.push(...this.columnModel.generateColumnStateForRowGroupAndPivotIndexes(o,a)),n.length&&this.columnModel.applyColumnState({state:n},"cellDataTypeInferred"),this.initialData=null}getUpdatedColumnState(e,t){const n=this.columnModel.getColumnStateFromColDef(e);return t.forEach(o=>{delete n[o],o==="rowGroup"?delete n.rowGroupIndex:o==="pivot"&&delete n.pivotIndex}),n}checkObjectValueHandlers(e){const t=this.dataTypeDefinitions.object,n=e.object;this.hasObjectValueParser=t.valueParser!==n.valueParser,this.hasObjectValueFormatter=t.valueFormatter!==n.valueFormatter}convertColumnTypes(e){let t=[];return e instanceof Array?e.some(o=>typeof o!="string")?console.warn("AG Grid: if colDef.type is supplied an array it should be of type 'string[]'"):t=e:typeof e=="string"?t=e.split(","):console.warn("AG Grid: colDef.type should be of type 'string' | 'string[]'"),t}getDateStringTypeDefinition(){return this.dataTypeDefinitions.dateString}getDateParserFunction(){return this.getDateStringTypeDefinition().dateParser}getDateFormatterFunction(){return this.getDateStringTypeDefinition().dateFormatter}checkType(e,t){var n;const o=e.getColDef();if(!o.cellDataType||t==null)return!0;const a=(n=this.dataTypeDefinitions[o.cellDataType])===null||n===void 0?void 0:n.dataTypeMatcher;return a?a(t):!0}validateColDef(e){e.cellDataType==="object"&&(e.valueFormatter===this.dataTypeDefinitions.object.groupSafeValueFormatter&&!this.hasObjectValueFormatter&&doOnce(()=>console.warn('AG Grid: Cell data type is "object" but no value formatter has been provided. Please either provide an object data type definition with a value formatter, or set "colDef.valueFormatter"'),"dataTypeObjectValueFormatter"),e.editable&&e.valueParser===this.dataTypeDefinitions.object.valueParser&&!this.hasObjectValueParser&&doOnce(()=>console.warn('AG Grid: Cell data type is "object" but no value parser has been provided. Please either provide an object data type definition with a value parser, or set "colDef.valueParser"'),"dataTypeObjectValueParser"))}setColDefPropertiesForBaseDataType(e,t,n){const o=(m,y,D)=>{let W=m.getColDef().valueFormatter;return W===t.groupSafeValueFormatter&&(W=t.valueFormatter),this.valueFormatterService.formatValue(m,y,D,W)},a=ModuleRegistry.__isRegistered(ModuleNames.SetFilterModule,this.context.getGridId()),l=this.localeService.getLocaleTextFunc(),s=m=>{const{filterParams:y}=e;e.filterParams=typeof y=="object"?Object.assign(Object.assign({},y),m):m};switch(e.useValueFormatterForExport=!0,e.useValueParserForImport=!0,t.baseDataType){case"number":{e.cellEditor="agNumberCellEditor",a&&s({comparator:(m,y)=>{const D=m==null?0:parseInt(m),W=y==null?0:parseInt(y);return D===W?0:D>W?1:-1}});break}case"boolean":{e.cellEditor="agCheckboxCellEditor",e.cellRenderer="agCheckboxCellRenderer",e.suppressKeyboardEvent=m=>!!m.colDef.editable&&m.event.key===KeyCode.SPACE,s(a?{valueFormatter:m=>exists(m.value)?l(String(m.value),m.value?"True":"False"):l("blanks","(Blanks)")}:{maxNumConditions:1,filterOptions:["empty",{displayKey:"true",displayName:"True",predicate:(m,y)=>y,numberOfInputs:0},{displayKey:"false",displayName:"False",predicate:(m,y)=>y===!1,numberOfInputs:0}]});break}case"date":{e.cellEditor="agDateCellEditor",e.keyCreator=m=>o(m.column,m.node,m.value),a&&s({valueFormatter:m=>{const y=o(m.column,m.node,m.value);return exists(y)?y:l("blanks","(Blanks)")},treeList:!0,treeListFormatter:(m,y)=>{if(y===1&&m!=null){const D=MONTH_KEYS[Number(m)-1];return l(D,MONTH_LOCALE_TEXT[D])}return m??l("blanks","(Blanks)")}});break}case"dateString":{e.cellEditor="agDateStringCellEditor",e.keyCreator=y=>o(y.column,y.node,y.value);const m=this.getDateParserFunction();s(a?{valueFormatter:y=>{const D=o(y.column,y.node,y.value);return exists(D)?D:l("blanks","(Blanks)")},treeList:!0,treeListPathGetter:y=>{const D=m(y??void 0);return D?[String(D.getFullYear()),String(D.getMonth()+1),String(D.getDate())]:null},treeListFormatter:(y,D)=>{if(D===1&&y!=null){const W=MONTH_KEYS[Number(y)-1];return l(W,MONTH_LOCALE_TEXT[W])}return y??l("blanks","(Blanks)")}}:{comparator:(y,D)=>{const W=m(D);return D==null||W<y?-1:W>y?1:0}});break}case"object":{e.cellEditorParams={useFormatter:!0},e.comparator=(m,y)=>{const D=this.columnModel.getPrimaryColumn(n),W=D==null?void 0:D.getColDef();if(!D||!W)return 0;const Ee=m==null?"":o(D,null,m),dt=y==null?"":o(D,null,y);return Ee===dt?0:Ee>dt?1:-1},e.keyCreator=m=>o(m.column,m.node,m.value),a?s({valueFormatter:m=>{const y=o(m.column,m.node,m.value);return exists(y)?y:l("blanks","(Blanks)")}}):e.filterValueGetter=m=>o(m.column,m.node,this.valueService.getValue(m.column,m.node));break}}}getDefaultDataTypes(){const e=n=>!!n.match("^\\d{4}-\\d{2}-\\d{2}$"),t=this.localeService.getLocaleTextFunc();return{number:{baseDataType:"number",valueParser:n=>n.newValue===""?null:Number(n.newValue),valueFormatter:n=>n.value==null?"":typeof n.value!="number"||isNaN(n.value)?t("invalidNumber","Invalid Number"):String(n.value),dataTypeMatcher:n=>typeof n=="number"},text:{baseDataType:"text",valueParser:n=>n.newValue===""?null:toStringOrNull(n.newValue),dataTypeMatcher:n=>typeof n=="string"},boolean:{baseDataType:"boolean",valueParser:n=>n.newValue===""?null:String(n.newValue).toLowerCase()==="true",valueFormatter:n=>n.value==null?"":String(n.value),dataTypeMatcher:n=>typeof n=="boolean"},date:{baseDataType:"date",valueParser:n=>parseDateTimeFromString(n.newValue==null?null:String(n.newValue)),valueFormatter:n=>{var o;return n.value==null?"":!(n.value instanceof Date)||isNaN(n.value.getTime())?t("invalidDate","Invalid Date"):(o=serialiseDate(n.value,!1))!==null&&o!==void 0?o:""},dataTypeMatcher:n=>n instanceof Date},dateString:{baseDataType:"dateString",dateParser:n=>{var o;return(o=parseDateTimeFromString(n))!==null&&o!==void 0?o:void 0},dateFormatter:n=>{var o;return(o=serialiseDate(n??null,!1))!==null&&o!==void 0?o:void 0},valueParser:n=>e(String(n.newValue))?n.newValue:null,valueFormatter:n=>e(String(n.value))?n.value:"",dataTypeMatcher:n=>typeof n=="string"&&e(n)},object:{baseDataType:"object",valueParser:()=>null,valueFormatter:n=>{var o;return(o=toStringOrNull(n.value))!==null&&o!==void 0?o:""}}}}};__decorate$d([Autowired("rowModel")],DataTypeService.prototype,"rowModel",void 0);__decorate$d([Autowired("columnModel")],DataTypeService.prototype,"columnModel",void 0);__decorate$d([Autowired("columnUtils")],DataTypeService.prototype,"columnUtils",void 0);__decorate$d([Autowired("valueService")],DataTypeService.prototype,"valueService",void 0);__decorate$d([Autowired("valueFormatterService")],DataTypeService.prototype,"valueFormatterService",void 0);__decorate$d([PostConstruct],DataTypeService.prototype,"init",null);DataTypeService=__decorate$d([Bean("dataTypeService")],DataTypeService);var __decorate$c=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let ValueParserService=class extends BeanStub{parseValue(e,t,n,o){const a=e.getColDef(),l={node:t,data:t==null?void 0:t.data,oldValue:o,newValue:n,colDef:a,column:e,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context},s=a.valueParser;return exists(s)?typeof s=="function"?s(l):this.expressionService.evaluate(s,l):n}};__decorate$c([Autowired("expressionService")],ValueParserService.prototype,"expressionService",void 0);ValueParserService=__decorate$c([Bean("valueParserService")],ValueParserService);class Grid{constructor(e,t,n){if(!t){console.error("AG Grid: no gridOptions provided to the grid");return}this.gridOptions=t,new GridCoreCreator().create(e,t,o=>{const a=new GridComp(e);o.createBean(a)},void 0,n)}destroy(){this.gridOptions&&this.gridOptions.api&&this.gridOptions.api.destroy()}}let nextGridId=1;class GridCoreCreator{create(e,t,n,o,a){var l;const s=!!t.debug,m=(l=t.gridId)!==null&&l!==void 0?l:String(nextGridId++),y=this.getRegisteredModules(a,m),D=this.createBeansList(t.rowModelType,y,m),W=this.createProvidedBeans(e,t,a);if(!D)return;const Ee={providedBeanInstances:W,beanClasses:D,debug:s,gridId:m},dt=new Logger("AG Grid",()=>t.debug),Ht=new Logger("Context",()=>Ee.debug),ir=new Context(Ee,Ht),Hr=ir.getBean("beans");this.registerModuleUserComponents(Hr,y),this.registerStackComponents(Hr,y),this.registerControllers(Hr,y),n(ir),Hr.ctrlsService.whenReady(()=>{this.setColumnsAndData(Hr),this.dispatchGridReadyEvent(Hr);const Bn=ModuleRegistry.__isRegistered(ModuleNames.EnterpriseCoreModule,m);dt.log(`initialised successfully, enterprise = ${Bn}`)}),o&&o(ir)}registerControllers(e,t){t.forEach(n=>{n.controllers&&n.controllers.forEach(o=>e.ctrlsFactory.register(o))})}registerStackComponents(e,t){const n=this.createAgStackComponentsList(t);e.agStackComponentsRegistry.setupComponents(n)}getRegisteredModules(e,t){const n=e?e.modules:null,o=ModuleRegistry.__getRegisteredModules(t),a=[],l={},s=(m,y,D)=>{(Ee=>{l[Ee.moduleName]||(l[Ee.moduleName]=!0,a.push(Ee),ModuleRegistry.__register(Ee,m,D))})(y),y.dependantModules&&y.dependantModules.forEach(Ee=>s(m,Ee,D))};return n&&n.forEach(m=>s(!0,m,t)),o&&o.forEach(m=>s(!ModuleRegistry.__isPackageBased(),m,void 0)),a}registerModuleUserComponents(e,t){this.extractModuleEntity(t,o=>o.userComponents?o.userComponents:[]).forEach(o=>{e.userComponentRegistry.registerDefaultComponent(o.componentName,o.componentClass)})}createProvidedBeans(e,t,n){let o=n?n.frameworkOverrides:null;missing(o)&&(o=new VanillaFrameworkOverrides);const a={gridOptions:t,eGridDiv:e,globalEventListener:n?n.globalEventListener:null,frameworkOverrides:o};return n&&n.providedBeanInstances&&Object.assign(a,n.providedBeanInstances),a}createAgStackComponentsList(e){let t=[{componentName:"AgCheckbox",componentClass:AgCheckbox},{componentName:"AgRadioButton",componentClass:AgRadioButton},{componentName:"AgToggleButton",componentClass:AgToggleButton},{componentName:"AgInputTextField",componentClass:AgInputTextField},{componentName:"AgInputTextArea",componentClass:AgInputTextArea},{componentName:"AgInputNumberField",componentClass:AgInputNumberField},{componentName:"AgInputDateField",componentClass:AgInputDateField},{componentName:"AgInputRange",componentClass:AgInputRange},{componentName:"AgSelect",componentClass:AgSelect},{componentName:"AgSlider",componentClass:AgSlider},{componentName:"AgGridBody",componentClass:GridBodyComp},{componentName:"AgHeaderRoot",componentClass:GridHeaderComp},{componentName:"AgSortIndicator",componentClass:SortIndicatorComp},{componentName:"AgPagination",componentClass:PaginationComp},{componentName:"AgOverlayWrapper",componentClass:OverlayWrapperComponent},{componentName:"AgGroupComponent",componentClass:AgGroupComponent},{componentName:"AgPanel",componentClass:AgPanel},{componentName:"AgDialog",componentClass:AgDialog},{componentName:"AgRowContainer",componentClass:RowContainerComp},{componentName:"AgFakeHorizontalScroll",componentClass:FakeHScrollComp},{componentName:"AgFakeVerticalScroll",componentClass:FakeVScrollComp}];const n=this.extractModuleEntity(e,o=>o.agStackComponents?o.agStackComponents:[]);return t=t.concat(n),t}createBeansList(e="clientSide",t,n){const o=t.filter(y=>!y.rowModel||y.rowModel===e),a={clientSide:ModuleNames.ClientSideRowModelModule,infinite:ModuleNames.InfiniteRowModelModule,serverSide:ModuleNames.ServerSideRowModelModule,viewport:ModuleNames.ViewportRowModelModule};if(!a[e]){console.error("AG Grid: could not find row model for rowModelType = "+e);return}if(!ModuleRegistry.__assertRegistered(a[e],`rowModelType = '${e}'`,n))return;const l=[Beans,RowPositionUtils,CellPositionUtils,HeaderPositionUtils,PaginationAutoPageSizeService,GridApi,UserComponentRegistry,AgComponentUtils,ComponentMetadataProvider,ResizeObserverService,UserComponentFactory,RowContainerHeightService,HorizontalResizeService,LocaleService,GridOptionsValidator,PinnedRowModel,DragService,DisplayedGroupCreator,EventService,GridOptionsService,PopupService,SelectionService,FilterManager,ColumnModel,HeaderNavigationService,PaginationProxy,RowRenderer,ExpressionService,ColumnFactory,TemplateService,AlignedGridsService,NavigationService,ValueCache,ValueService,LoggerFactory,ColumnUtils,AutoWidthCalculator,StandardMenuFactory,DragAndDropService,ColumnApi,FocusService,MouseEventService,Environment,CellNavigationService,ValueFormatterService,StylingService,ScrollVisibleService,SortController,ColumnHoverService,ColumnAnimationService,SelectableService,AutoGroupColService,ChangeDetectionService,AnimationFrameService,UndoRedoService,AgStackComponentsRegistry,ColumnDefFactory,RowCssClassCalculator,RowNodeBlockLoader,RowNodeSorter,CtrlsService,PinnedWidthService,RowNodeEventThrottle,CtrlsFactory,DataTypeService,ValueParserService],s=this.extractModuleEntity(o,y=>y.beans?y.beans:[]);l.push(...s);const m=[];return l.forEach(y=>{m.indexOf(y)<0&&m.push(y)}),m}extractModuleEntity(e,t){return[].concat(...e.map(t))}setColumnsAndData(e){const t=e.gridOptionsService.get("columnDefs");e.columnModel.setColumnDefs(t||[],"gridInitializing"),e.rowModel.start()}dispatchGridReadyEvent(e){const t={type:Events.EVENT_GRID_READY};e.eventService.dispatchEvent(t)}}var BarColumnLabelPlacement;(function(r){r.InsideBase="insideBase",r.InsideEnd="insideEnd",r.Center="center",r.OutsideEnd="outsideEnd"})(BarColumnLabelPlacement||(BarColumnLabelPlacement={}));/**
 * @ag-grid-community/core - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue
 * @version v30.0.5
 * @link https://www.ag-grid.com/
 * @license MIT
 */const globalObj=typeof global>"u"?{}:global;globalObj.HTMLElement=typeof HTMLElement>"u"?{}:HTMLElement;globalObj.HTMLButtonElement=typeof HTMLButtonElement>"u"?{}:HTMLButtonElement;globalObj.HTMLSelectElement=typeof HTMLSelectElement>"u"?{}:HTMLSelectElement;globalObj.HTMLInputElement=typeof HTMLInputElement>"u"?{}:HTMLInputElement;globalObj.Node=typeof Node>"u"?{}:Node;globalObj.MouseEvent=typeof MouseEvent>"u"?{}:MouseEvent;class ClientSideNodeManager{constructor(e,t,n,o,a,l){this.nextId=0,this.allNodesMap={},this.rootNode=e,this.gridOptionsService=t,this.eventService=n,this.columnModel=o,this.beans=l,this.selectionService=a,this.rootNode.group=!0,this.rootNode.level=-1,this.rootNode.id=ClientSideNodeManager.ROOT_NODE_ID,this.rootNode.allLeafChildren=[],this.rootNode.childrenAfterGroup=[],this.rootNode.childrenAfterSort=[],this.rootNode.childrenAfterAggFilter=[],this.rootNode.childrenAfterFilter=[],this.postConstruct()}postConstruct(){this.suppressParentsInRowNodes=this.gridOptionsService.is("suppressParentsInRowNodes"),this.isRowMasterFunc=this.gridOptionsService.get("isRowMaster"),this.doingTreeData=this.gridOptionsService.isTreeData(),this.doingMasterDetail=this.gridOptionsService.isMasterDetail()}getCopyOfNodesMap(){return _.cloneObject(this.allNodesMap)}getRowNode(e){return this.allNodesMap[e]}setRowData(e){if(typeof e=="string"){console.warn("AG Grid: rowData must be an array, however you passed in a string. If you are loading JSON, make sure you convert the JSON string to JavaScript objects first");return}this.dispatchRowDataUpdateStartedEvent(e);const t=this.rootNode,n=this.rootNode.sibling;t.childrenAfterFilter=null,t.childrenAfterGroup=null,t.childrenAfterAggFilter=null,t.childrenAfterSort=null,t.childrenMapped=null,t.updateHasChildren(),this.nextId=0,this.allNodesMap={},e?t.allLeafChildren=e.map(o=>this.createNode(o,this.rootNode,ClientSideNodeManager.TOP_LEVEL)):(t.allLeafChildren=[],t.childrenAfterGroup=[]),n&&(n.childrenAfterFilter=t.childrenAfterFilter,n.childrenAfterGroup=t.childrenAfterGroup,n.childrenAfterAggFilter=t.childrenAfterAggFilter,n.childrenAfterSort=t.childrenAfterSort,n.childrenMapped=t.childrenMapped,n.allLeafChildren=t.allLeafChildren)}updateRowData(e,t){this.dispatchRowDataUpdateStartedEvent(e.add);const n={remove:[],update:[],add:[]},o=[];return this.executeRemove(e,n,o),this.executeUpdate(e,n,o),this.executeAdd(e,n),this.updateSelection(o,"rowDataChanged"),t&&_.sortRowNodesByOrder(this.rootNode.allLeafChildren,t),n}dispatchRowDataUpdateStartedEvent(e){const t={type:Events.EVENT_ROW_DATA_UPDATE_STARTED,firstRowData:e!=null&&e.length?e[0]:null};this.eventService.dispatchEvent(t)}updateSelection(e,t){const n=e.length>0;if(n&&this.selectionService.setNodesSelected({newValue:!1,nodes:e,suppressFinishActions:!0,source:t}),this.selectionService.updateGroupsFromChildrenSelections(t),n){const o={type:Events.EVENT_SELECTION_CHANGED,source:t};this.eventService.dispatchEvent(o)}}executeAdd(e,t){var n;const{add:o,addIndex:a}=e;if(_.missingOrEmpty(o))return;const l=o.map(s=>this.createNode(s,this.rootNode,ClientSideNodeManager.TOP_LEVEL));if(typeof a=="number"&&a>=0){const{allLeafChildren:s}=this.rootNode,m=s.length;let y=a;if(this.doingTreeData&&a>0&&m>0){for(let Ee=0;Ee<m;Ee++)if(((n=s[Ee])===null||n===void 0?void 0:n.rowIndex)==a-1){y=Ee+1;break}}const D=s.slice(0,y),W=s.slice(y,s.length);this.rootNode.allLeafChildren=[...D,...l,...W]}else this.rootNode.allLeafChildren=[...this.rootNode.allLeafChildren,...l];this.rootNode.sibling&&(this.rootNode.sibling.allLeafChildren=this.rootNode.allLeafChildren),t.add=l}executeRemove(e,t,n){const{remove:o}=e;if(_.missingOrEmpty(o))return;const a={};o.forEach(l=>{const s=this.lookupRowNode(l);s&&(s.isSelected()&&n.push(s),s.clearRowTopAndRowIndex(),a[s.id]=!0,delete this.allNodesMap[s.id],t.remove.push(s))}),this.rootNode.allLeafChildren=this.rootNode.allLeafChildren.filter(l=>!a[l.id]),this.rootNode.sibling&&(this.rootNode.sibling.allLeafChildren=this.rootNode.allLeafChildren)}executeUpdate(e,t,n){const{update:o}=e;_.missingOrEmpty(o)||o.forEach(a=>{const l=this.lookupRowNode(a);l&&(l.updateData(a),!l.selectable&&l.isSelected()&&n.push(l),this.setMasterForRow(l,a,ClientSideNodeManager.TOP_LEVEL,!1),t.update.push(l))})}lookupRowNode(e){const t=this.gridOptionsService.getCallback("getRowId");let n;if(t){const o=t({data:e,level:0});if(n=this.allNodesMap[o],!n)return console.error(`AG Grid: could not find row id=${o}, data item was not found for this id`),null}else if(n=this.rootNode.allLeafChildren.find(o=>o.data===e),!n)return console.error("AG Grid: could not find data item as object was not found",e),console.error("Consider using getRowId to help the Grid find matching row data"),null;return n||null}createNode(e,t,n){const o=new RowNode(this.beans);return o.group=!1,this.setMasterForRow(o,e,n,!0),t&&!this.suppressParentsInRowNodes&&(o.parent=t),o.level=n,o.setDataAndId(e,this.nextId.toString()),this.allNodesMap[o.id]&&console.warn(`AG Grid: duplicate node id '${o.id}' detected from getRowId callback, this could cause issues in your grid.`),this.allNodesMap[o.id]=o,this.nextId++,o}setMasterForRow(e,t,n,o){if(this.doingTreeData)e.setMaster(!1),o&&(e.expanded=!1);else if(this.doingMasterDetail?this.isRowMasterFunc?e.setMaster(this.isRowMasterFunc(t)):e.setMaster(!0):e.setMaster(!1),o){const a=this.columnModel.getRowGroupColumns(),l=a?a.length:0,s=n+l;e.expanded=e.master?this.isExpanded(s):!1}}isExpanded(e){const t=this.gridOptionsService.getNum("groupDefaultExpanded");return t===-1?!0:e<t}}ClientSideNodeManager.TOP_LEVEL=0;ClientSideNodeManager.ROOT_NODE_ID="ROOT_NODE_ID";var __decorate$b=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},RecursionType;(function(r){r[r.Normal=0]="Normal",r[r.AfterFilter=1]="AfterFilter",r[r.AfterFilterAndSort=2]="AfterFilterAndSort",r[r.PivotNodes=3]="PivotNodes"})(RecursionType||(RecursionType={}));let ClientSideRowModel=class extends BeanStub{constructor(){super(...arguments),this.onRowHeightChanged_debounced=_.debounce(this.onRowHeightChanged.bind(this),100),this.rowsToDisplay=[]}init(){const e=this.refreshModel.bind(this,{step:ClientSideRowModelSteps.EVERYTHING}),t=!this.gridOptionsService.is("suppressAnimationFrame"),n=this.refreshModel.bind(this,{step:ClientSideRowModelSteps.EVERYTHING,afterColumnsChanged:!0,keepRenderedRows:!0,animate:t});this.addManagedListener(this.eventService,Events.EVENT_NEW_COLUMNS_LOADED,n),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_ROW_GROUP_CHANGED,e),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_VALUE_CHANGED,this.onValueChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_PIVOT_CHANGED,this.refreshModel.bind(this,{step:ClientSideRowModelSteps.PIVOT})),this.addManagedListener(this.eventService,Events.EVENT_FILTER_CHANGED,this.onFilterChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_SORT_CHANGED,this.onSortChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_PIVOT_MODE_CHANGED,e),this.addManagedListener(this.eventService,Events.EVENT_GRID_STYLES_CHANGED,this.onGridStylesChanges.bind(this));const o=this.refreshModel.bind(this,{step:ClientSideRowModelSteps.MAP,keepRenderedRows:!0,animate:t});this.addManagedPropertyListener("groupRemoveSingleChildren",o),this.addManagedPropertyListener("groupRemoveLowestSingleChildren",o),this.rootNode=new RowNode(this.beans),this.nodeManager=new ClientSideNodeManager(this.rootNode,this.gridOptionsService,this.eventService,this.columnModel,this.selectionService,this.beans)}start(){const e=this.gridOptionsService.get("rowData");e&&this.setRowData(e)}ensureRowHeightsValid(e,t,n,o){let a,l=!1;do{a=!1;const s=this.getRowIndexAtPixel(e),m=this.getRowIndexAtPixel(t),y=Math.max(s,n),D=Math.min(m,o);for(let W=y;W<=D;W++){const Ee=this.getRow(W);if(Ee.rowHeightEstimated){const dt=this.gridOptionsService.getRowHeightForNode(Ee);Ee.setRowHeight(dt.height),a=!0,l=!0}}a&&this.setRowTopAndRowIndex()}while(a);return l}setRowTopAndRowIndex(){const e=this.environment.getDefaultRowHeight();let t=0;const n=new Set,o=this.gridOptionsService.isDomLayout("normal");for(let a=0;a<this.rowsToDisplay.length;a++){const l=this.rowsToDisplay[a];if(l.id!=null&&n.add(l.id),l.rowHeight==null){const s=this.gridOptionsService.getRowHeightForNode(l,o,e);l.setRowHeight(s.height,s.estimated)}l.setRowTop(t),l.setRowIndex(a),t+=l.rowHeight}return n}clearRowTopAndRowIndex(e,t){const n=e.isActive(),o=l=>{l&&l.id!=null&&!t.has(l.id)&&l.clearRowTopAndRowIndex()},a=l=>{if(o(l),o(l.detailNode),o(l.sibling),l.hasChildren()&&l.childrenAfterGroup){const s=l.level==-1;n&&!s&&!l.expanded||l.childrenAfterGroup.forEach(a)}};a(this.rootNode)}ensureRowsAtPixel(e,t,n=0){const o=this.getRowIndexAtPixel(t),a=this.getRow(o),l=!this.gridOptionsService.is("suppressAnimationFrame");return a===e[0]?!1:(e.forEach(s=>{_.removeFromArray(this.rootNode.allLeafChildren,s)}),e.forEach((s,m)=>{_.insertIntoArray(this.rootNode.allLeafChildren,s,Math.max(o+n,0)+m)}),this.refreshModel({step:ClientSideRowModelSteps.EVERYTHING,keepRenderedRows:!0,keepEditingRows:!0,animate:l}),!0)}highlightRowAtPixel(e,t){const n=t!=null?this.getRowIndexAtPixel(t):null,o=n!=null?this.getRow(n):null;if(!o||!e||o===e||t==null){this.lastHighlightedRow&&(this.lastHighlightedRow.setHighlighted(null),this.lastHighlightedRow=null);return}const a=this.getHighlightPosition(t,o);this.lastHighlightedRow&&this.lastHighlightedRow!==o&&(this.lastHighlightedRow.setHighlighted(null),this.lastHighlightedRow=null),o.setHighlighted(a),this.lastHighlightedRow=o}getHighlightPosition(e,t){if(!t){const a=this.getRowIndexAtPixel(e);if(t=this.getRow(a||0),!t)return RowHighlightPosition.Below}const{rowTop:n,rowHeight:o}=t;return e-n<o/2?RowHighlightPosition.Above:RowHighlightPosition.Below}getLastHighlightedRowNode(){return this.lastHighlightedRow}isLastRowIndexKnown(){return!0}getRowCount(){return this.rowsToDisplay?this.rowsToDisplay.length:0}getTopLevelRowCount(){if(this.rowsToDisplay&&this.rowsToDisplay[0]===this.rootNode)return 1;const t=this.rootNode.childrenAfterAggFilter;return t?t.length:0}getTopLevelRowDisplayedIndex(e){if(this.rowsToDisplay&&this.rowsToDisplay[0]===this.rootNode)return e;let n=this.rootNode.childrenAfterSort[e];if(this.gridOptionsService.is("groupHideOpenParents"))for(;n.expanded&&n.childrenAfterSort&&n.childrenAfterSort.length>0;)n=n.childrenAfterSort[0];return n.rowIndex}getRowBounds(e){if(_.missing(this.rowsToDisplay))return null;const t=this.rowsToDisplay[e];return t?{rowTop:t.rowTop,rowHeight:t.rowHeight}:null}onRowGroupOpened(){const e=this.gridOptionsService.isAnimateRows();this.refreshModel({step:ClientSideRowModelSteps.MAP,keepRenderedRows:!0,animate:e})}onFilterChanged(e){if(e.afterDataChange)return;const t=this.gridOptionsService.isAnimateRows(),o=e.columns.length===0||e.columns.some(a=>a.isPrimary())?ClientSideRowModelSteps.FILTER:ClientSideRowModelSteps.FILTER_AGGREGATES;this.refreshModel({step:o,keepRenderedRows:!0,animate:t})}onSortChanged(){const e=this.gridOptionsService.isAnimateRows();this.refreshModel({step:ClientSideRowModelSteps.SORT,keepRenderedRows:!0,animate:e,keepEditingRows:!0})}getType(){return"clientSide"}onValueChanged(){this.columnModel.isPivotActive()?this.refreshModel({step:ClientSideRowModelSteps.PIVOT}):this.refreshModel({step:ClientSideRowModelSteps.AGGREGATE})}createChangePath(e){const t=_.missingOrEmpty(e),n=new ChangedPath(!1,this.rootNode);return(t||this.gridOptionsService.isTreeData())&&n.setInactive(),n}isSuppressModelUpdateAfterUpdateTransaction(e){if(!this.gridOptionsService.is("suppressModelUpdateAfterUpdateTransaction")||e.rowNodeTransactions==null)return!1;const t=e.rowNodeTransactions.filter(o=>o.add!=null&&o.add.length>0||o.remove!=null&&o.remove.length>0);return t==null||t.length==0}buildRefreshModelParams(e){let t=ClientSideRowModelSteps.EVERYTHING;const n={everything:ClientSideRowModelSteps.EVERYTHING,group:ClientSideRowModelSteps.EVERYTHING,filter:ClientSideRowModelSteps.FILTER,map:ClientSideRowModelSteps.MAP,aggregate:ClientSideRowModelSteps.AGGREGATE,sort:ClientSideRowModelSteps.SORT,pivot:ClientSideRowModelSteps.PIVOT};if(_.exists(e)&&(t=n[e]),_.missing(t)){console.error(`AG Grid: invalid step ${e}, available steps are ${Object.keys(n).join(", ")}`);return}const o=!this.gridOptionsService.is("suppressAnimationFrame");return{step:t,keepRenderedRows:!0,keepEditingRows:!0,animate:o}}refreshModel(e){let t=typeof e=="object"&&"step"in e?e:this.buildRefreshModelParams(e);if(!t||this.isSuppressModelUpdateAfterUpdateTransaction(t))return;const n=this.createChangePath(t.rowNodeTransactions);switch(t.step){case ClientSideRowModelSteps.EVERYTHING:this.doRowGrouping(t.groupState,t.rowNodeTransactions,t.rowNodeOrder,n,!!t.afterColumnsChanged);case ClientSideRowModelSteps.FILTER:this.doFilter(n);case ClientSideRowModelSteps.PIVOT:this.doPivot(n);case ClientSideRowModelSteps.AGGREGATE:this.doAggregate(n);case ClientSideRowModelSteps.FILTER_AGGREGATES:this.doFilterAggregates(n);case ClientSideRowModelSteps.SORT:this.doSort(t.rowNodeTransactions,n);case ClientSideRowModelSteps.MAP:this.doRowsToDisplay()}const o=this.setRowTopAndRowIndex();this.clearRowTopAndRowIndex(n,o);const a={type:Events.EVENT_MODEL_UPDATED,animate:t.animate,keepRenderedRows:t.keepRenderedRows,newData:t.newData,newPage:!1,keepUndoRedoStack:t.keepUndoRedoStack};this.eventService.dispatchEvent(a)}isEmpty(){const e=_.missing(this.rootNode.allLeafChildren)||this.rootNode.allLeafChildren.length===0;return _.missing(this.rootNode)||e||!this.columnModel.isReady()}isRowsToRender(){return _.exists(this.rowsToDisplay)&&this.rowsToDisplay.length>0}getNodesInRangeForSelection(e,t){let n=!t,o=!1;const a=[],l=this.gridOptionsService.is("groupSelectsChildren");return this.forEachNodeAfterFilterAndSort(s=>{if(o)return;if(n&&(s===t||s===e)&&(o=!0,s.group&&l)){a.push(...s.allLeafChildren);return}if(!n){if(s!==t&&s!==e)return;n=!0}if(!s.group||!l){a.push(s);return}}),a}setDatasource(e){console.error("AG Grid: should never call setDatasource on clientSideRowController")}getTopLevelNodes(){return this.rootNode?this.rootNode.childrenAfterGroup:null}getRootNode(){return this.rootNode}getRow(e){return this.rowsToDisplay[e]}isRowPresent(e){return this.rowsToDisplay.indexOf(e)>=0}getRowIndexAtPixel(e){if(this.isEmpty()||this.rowsToDisplay.length===0)return-1;let t=0,n=this.rowsToDisplay.length-1;if(e<=0)return 0;if(_.last(this.rowsToDisplay).rowTop<=e)return this.rowsToDisplay.length-1;let a=-1,l=-1;for(;;){const s=Math.floor((t+n)/2),m=this.rowsToDisplay[s];if(this.isRowInPixel(m,e)||(m.rowTop<e?t=s+1:m.rowTop>e&&(n=s-1),a===t&&l===n))return s;a=t,l=n}}isRowInPixel(e,t){const n=e.rowTop,o=e.rowTop+e.rowHeight;return n<=t&&o>t}forEachLeafNode(e){this.rootNode.allLeafChildren&&this.rootNode.allLeafChildren.forEach((t,n)=>e(t,n))}forEachNode(e,t=!1){this.recursivelyWalkNodesAndCallback({nodes:[...this.rootNode.childrenAfterGroup||[]],callback:e,recursionType:RecursionType.Normal,index:0,includeFooterNodes:t})}forEachNodeAfterFilter(e,t=!1){this.recursivelyWalkNodesAndCallback({nodes:[...this.rootNode.childrenAfterAggFilter||[]],callback:e,recursionType:RecursionType.AfterFilter,index:0,includeFooterNodes:t})}forEachNodeAfterFilterAndSort(e,t=!1){this.recursivelyWalkNodesAndCallback({nodes:[...this.rootNode.childrenAfterSort||[]],callback:e,recursionType:RecursionType.AfterFilterAndSort,index:0,includeFooterNodes:t})}forEachPivotNode(e,t=!1){this.recursivelyWalkNodesAndCallback({nodes:[this.rootNode],callback:e,recursionType:RecursionType.PivotNodes,index:0,includeFooterNodes:t})}recursivelyWalkNodesAndCallback(e){var t;const{nodes:n,callback:o,recursionType:a,includeFooterNodes:l}=e;let{index:s}=e;const m=n[0];l&&(!((t=m==null?void 0:m.parent)===null||t===void 0)&&t.sibling)&&n.push(m.parent.sibling);for(let y=0;y<n.length;y++){const D=n[y];if(o(D,s++),D.hasChildren()&&!D.footer){let W=null;switch(a){case RecursionType.Normal:W=D.childrenAfterGroup;break;case RecursionType.AfterFilter:W=D.childrenAfterAggFilter;break;case RecursionType.AfterFilterAndSort:W=D.childrenAfterSort;break;case RecursionType.PivotNodes:W=D.leafGroup?null:D.childrenAfterSort;break}W&&(s=this.recursivelyWalkNodesAndCallback({nodes:[...W],callback:o,recursionType:a,index:s,includeFooterNodes:l}))}}return s}doAggregate(e){this.aggregationStage&&this.aggregationStage.execute({rowNode:this.rootNode,changedPath:e})}doFilterAggregates(e){this.filterAggregatesStage?this.filterAggregatesStage.execute({rowNode:this.rootNode,changedPath:e}):this.rootNode.childrenAfterAggFilter=this.rootNode.childrenAfterFilter}expandOrCollapseAll(e){const t=this.gridOptionsService.isTreeData(),n=this.columnModel.isPivotActive(),o=s=>{s&&s.forEach(m=>{const y=()=>{m.expanded=e,o(m.childrenAfterGroup)};if(t){_.exists(m.childrenAfterGroup)&&y();return}if(n){!m.leafGroup&&y();return}m.group&&y()})};this.rootNode&&o(this.rootNode.childrenAfterGroup),this.refreshModel({step:ClientSideRowModelSteps.MAP});const a=e?"expandAll":"collapseAll",l={type:Events.EVENT_EXPAND_COLLAPSE_ALL,source:a};this.eventService.dispatchEvent(l)}doSort(e,t){this.sortStage.execute({rowNode:this.rootNode,rowNodeTransactions:e,changedPath:t})}doRowGrouping(e,t,n,o,a){if(this.groupStage){if(t?this.groupStage.execute({rowNode:this.rootNode,rowNodeTransactions:t,rowNodeOrder:n,changedPath:o}):(this.groupStage.execute({rowNode:this.rootNode,changedPath:o,afterColumnsChanged:a}),this.restoreGroupState(e)),this.gridOptionsService.is("groupSelectsChildren")&&this.selectionService.updateGroupsFromChildrenSelections("rowGroupChanged",o)){const s={type:Events.EVENT_SELECTION_CHANGED,source:"rowGroupChanged"};this.eventService.dispatchEvent(s)}}else this.rootNode.childrenAfterGroup=this.rootNode.allLeafChildren,this.rootNode.sibling&&(this.rootNode.sibling.childrenAfterGroup=this.rootNode.childrenAfterGroup),this.rootNode.updateHasChildren()}restoreGroupState(e){e&&_.traverseNodesWithKey(this.rootNode.childrenAfterGroup,(t,n)=>{typeof e[n]=="boolean"&&(t.expanded=e[n])})}doFilter(e){this.filterStage.execute({rowNode:this.rootNode,changedPath:e})}doPivot(e){this.pivotStage&&this.pivotStage.execute({rowNode:this.rootNode,changedPath:e})}getGroupState(){if(!this.rootNode.childrenAfterGroup||!this.gridOptionsService.is("rememberGroupStateWhenNewData"))return null;const e={};return _.traverseNodesWithKey(this.rootNode.childrenAfterGroup,(t,n)=>e[n]=t.expanded),e}getCopyOfNodesMap(){return this.nodeManager.getCopyOfNodesMap()}getRowNode(e){if(typeof e=="string"&&e.indexOf(RowNode.ID_PREFIX_ROW_GROUP)==0){let n;return this.forEachNode(o=>{o.id===e&&(n=o)}),n}return this.nodeManager.getRowNode(e)}setRowData(e){const t=this.getGroupState();this.nodeManager.setRowData(e),this.selectionService.reset(),this.filterManager.onNewRowsLoaded("rowDataUpdated");const n={type:Events.EVENT_ROW_DATA_UPDATED};this.eventService.dispatchEvent(n),this.refreshModel({step:ClientSideRowModelSteps.EVERYTHING,groupState:t,newData:!0})}batchUpdateRowData(e,t){if(this.applyAsyncTransactionsTimeout==null){this.rowDataTransactionBatch=[];const n=this.gridOptionsService.getAsyncTransactionWaitMillis();this.applyAsyncTransactionsTimeout=window.setTimeout(()=>{this.executeBatchUpdateRowData()},n)}this.rowDataTransactionBatch.push({rowDataTransaction:e,callback:t})}flushAsyncTransactions(){this.applyAsyncTransactionsTimeout!=null&&(clearTimeout(this.applyAsyncTransactionsTimeout),this.executeBatchUpdateRowData())}executeBatchUpdateRowData(){this.valueCache.onDataChanged();const e=[],t=[];let n=!1;if(this.rowDataTransactionBatch&&this.rowDataTransactionBatch.forEach(o=>{const a=this.nodeManager.updateRowData(o.rowDataTransaction,void 0);t.push(a),o.callback&&e.push(o.callback.bind(null,a)),typeof o.rowDataTransaction.addIndex=="number"&&(n=!0)}),this.commonUpdateRowData(t,void 0,n),e.length>0&&window.setTimeout(()=>{e.forEach(o=>o())},0),t.length>0){const o={type:Events.EVENT_ASYNC_TRANSACTIONS_FLUSHED,results:t};this.eventService.dispatchEvent(o)}this.rowDataTransactionBatch=null,this.applyAsyncTransactionsTimeout=void 0}updateRowData(e,t){this.valueCache.onDataChanged();const n=this.nodeManager.updateRowData(e,t),o=typeof e.addIndex=="number";return this.commonUpdateRowData([n],t,o),n}createRowNodeOrder(){if(this.gridOptionsService.is("suppressMaintainUnsortedOrder"))return;const t={};if(this.rootNode&&this.rootNode.allLeafChildren)for(let n=0;n<this.rootNode.allLeafChildren.length;n++){const o=this.rootNode.allLeafChildren[n];t[o.id]=n}return t}commonUpdateRowData(e,t,n){const o=!this.gridOptionsService.is("suppressAnimationFrame");n&&(t=this.createRowNodeOrder()),this.refreshModel({step:ClientSideRowModelSteps.EVERYTHING,rowNodeTransactions:e,rowNodeOrder:t,keepRenderedRows:!0,keepEditingRows:!0,animate:o}),this.filterManager.onNewRowsLoaded("rowDataUpdated");const a={type:Events.EVENT_ROW_DATA_UPDATED};this.eventService.dispatchEvent(a)}doRowsToDisplay(){this.rowsToDisplay=this.flattenStage.execute({rowNode:this.rootNode})}onRowHeightChanged(){this.refreshModel({step:ClientSideRowModelSteps.MAP,keepRenderedRows:!0,keepEditingRows:!0,keepUndoRedoStack:!0})}onRowHeightChangedDebounced(){this.onRowHeightChanged_debounced()}resetRowHeights(){const e=this.resetRowHeightsForAllRowNodes();this.rootNode.setRowHeight(this.rootNode.rowHeight,!0),e&&this.onRowHeightChanged()}resetRowHeightsForAllRowNodes(){let e=!1;return this.forEachNode(t=>{t.setRowHeight(t.rowHeight,!0);const n=t.detailNode;n&&n.setRowHeight(n.rowHeight,!0),e=!0}),e}onGridStylesChanges(){this.columnModel.isAutoRowHeightActive()||this.resetRowHeights()}};__decorate$b([Autowired("columnModel")],ClientSideRowModel.prototype,"columnModel",void 0);__decorate$b([Autowired("selectionService")],ClientSideRowModel.prototype,"selectionService",void 0);__decorate$b([Autowired("filterManager")],ClientSideRowModel.prototype,"filterManager",void 0);__decorate$b([Autowired("valueCache")],ClientSideRowModel.prototype,"valueCache",void 0);__decorate$b([Autowired("beans")],ClientSideRowModel.prototype,"beans",void 0);__decorate$b([Autowired("filterStage")],ClientSideRowModel.prototype,"filterStage",void 0);__decorate$b([Autowired("sortStage")],ClientSideRowModel.prototype,"sortStage",void 0);__decorate$b([Autowired("flattenStage")],ClientSideRowModel.prototype,"flattenStage",void 0);__decorate$b([Optional("groupStage")],ClientSideRowModel.prototype,"groupStage",void 0);__decorate$b([Optional("aggregationStage")],ClientSideRowModel.prototype,"aggregationStage",void 0);__decorate$b([Optional("pivotStage")],ClientSideRowModel.prototype,"pivotStage",void 0);__decorate$b([Optional("filterAggregatesStage")],ClientSideRowModel.prototype,"filterAggregatesStage",void 0);__decorate$b([PostConstruct],ClientSideRowModel.prototype,"init",null);ClientSideRowModel=__decorate$b([Bean("rowModel")],ClientSideRowModel);var __decorate$a=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let FilterStage=class extends BeanStub{execute(e){const{changedPath:t}=e;this.filterService.filter(t)}};__decorate$a([Autowired("filterService")],FilterStage.prototype,"filterService",void 0);FilterStage=__decorate$a([Bean("filterStage")],FilterStage);var __decorate$9=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let SortStage=class extends BeanStub{execute(e){const t=this.sortController.getSortOptions(),n=_.exists(t)&&t.length>0,o=n&&_.exists(e.rowNodeTransactions)&&this.gridOptionsService.is("deltaSort"),a=t.some(l=>!!this.columnModel.getGroupDisplayColumnForGroup(l.column.getId()));this.sortService.sort(t,n,o,e.rowNodeTransactions,e.changedPath,a)}};__decorate$9([Autowired("sortService")],SortStage.prototype,"sortService",void 0);__decorate$9([Autowired("sortController")],SortStage.prototype,"sortController",void 0);__decorate$9([Autowired("columnModel")],SortStage.prototype,"columnModel",void 0);SortStage=__decorate$9([Bean("sortStage")],SortStage);var __decorate$8=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let FlattenStage=class extends BeanStub{execute(e){const t=e.rowNode,n=[],o={value:0},a=this.columnModel.isPivotMode(),l=a&&t.leafGroup,s=l?[t]:t.childrenAfterSort;this.recursivelyAddToRowsToDisplay(s,n,o,a,0);const m=n.length>0;return!l&&m&&this.gridOptionsService.is("groupIncludeTotalFooter")&&(t.createFooter(),this.addRowNodeToRowsToDisplay(t.sibling,n,o,0)),n}recursivelyAddToRowsToDisplay(e,t,n,o,a){if(_.missingOrEmpty(e))return;const l=this.gridOptionsService.is("groupHideOpenParents"),s=this.gridOptionsService.is("groupRemoveSingleChildren"),m=!s&&this.gridOptionsService.is("groupRemoveLowestSingleChildren");for(let y=0;y<e.length;y++){const D=e[y],W=D.hasChildren(),Ee=o&&!W,dt=s&&W&&D.childrenAfterGroup.length===1,Ht=m&&W&&D.leafGroup&&D.childrenAfterGroup.length===1,ir=o&&D.leafGroup,Hr=l&&D.expanded&&!D.master&&!ir;if(!Ee&&!Hr&&!dt&&!Ht&&this.addRowNodeToRowsToDisplay(D,t,n,a),!(o&&D.leafGroup)){if(W){const Vn=dt||Ht;if(D.expanded||Vn){const Wr=Vn?a:a+1;this.recursivelyAddToRowsToDisplay(D.childrenAfterSort,t,n,o,Wr),this.gridOptionsService.is("groupIncludeFooter")&&this.addRowNodeToRowsToDisplay(D.sibling,t,n,Wr)}}else if(D.master&&D.expanded){const Vn=this.createDetailNode(D);this.addRowNodeToRowsToDisplay(Vn,t,n,a)}}}}addRowNodeToRowsToDisplay(e,t,n,o){const a=this.gridOptionsService.isGroupMultiAutoColumn();t.push(e),e.setUiLevel(a?0:o)}createDetailNode(e){if(_.exists(e.detailNode))return e.detailNode;const t=new RowNode(this.beans);return t.detail=!0,t.selectable=!1,t.parent=e,_.exists(e.id)&&(t.id="detail_"+e.id),t.data=e.data,t.level=e.level+1,e.detailNode=t,t}};__decorate$8([Autowired("columnModel")],FlattenStage.prototype,"columnModel",void 0);__decorate$8([Autowired("beans")],FlattenStage.prototype,"beans",void 0);FlattenStage=__decorate$8([Bean("flattenStage")],FlattenStage);var __decorate$7=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let SortService=class extends BeanStub{init(){this.postSortFunc=this.gridOptionsService.getCallback("postSortRows")}sort(e,t,n,o,a,l){const s=this.gridOptionsService.is("groupMaintainOrder"),m=this.columnModel.getAllGridColumns().some(Ee=>Ee.isRowGroupActive());let y={};n&&o&&(y=this.calculateDirtyNodes(o));const D=this.columnModel.isPivotMode(),W=Ee=>{this.pullDownGroupDataForHideOpenParents(Ee.childrenAfterAggFilter,!0);const dt=D&&Ee.leafGroup;if(s&&m&&!Ee.leafGroup&&!l){const ir=Ee.childrenAfterAggFilter.slice(0);if(Ee.childrenAfterSort){const Hr={};Ee.childrenAfterSort.forEach((Bn,Vn)=>{Hr[Bn.id]=Vn}),ir.sort((Bn,Vn)=>{var Wr,ps;return((Wr=Hr[Bn.id])!==null&&Wr!==void 0?Wr:0)-((ps=Hr[Vn.id])!==null&&ps!==void 0?ps:0)})}Ee.childrenAfterSort=ir}else!t||dt?Ee.childrenAfterSort=Ee.childrenAfterAggFilter.slice(0):n?Ee.childrenAfterSort=this.doDeltaSort(Ee,y,a,e):Ee.childrenAfterSort=this.rowNodeSorter.doFullSort(Ee.childrenAfterAggFilter,e);if(Ee.sibling&&(Ee.sibling.childrenAfterSort=Ee.childrenAfterSort),this.updateChildIndexes(Ee),this.postSortFunc){const ir={nodes:Ee.childrenAfterSort};this.postSortFunc(ir)}};a&&a.forEachChangedNodeDepthFirst(W),this.updateGroupDataForHideOpenParents(a)}calculateDirtyNodes(e){const t={},n=o=>{o&&o.forEach(a=>t[a.id]=!0)};return e&&e.forEach(o=>{n(o.add),n(o.update),n(o.remove)}),t}doDeltaSort(e,t,n,o){const a=e.childrenAfterAggFilter,l=e.childrenAfterSort;if(!l)return this.rowNodeSorter.doFullSort(a,o);const s={},m=[];a.forEach(Ee=>{t[Ee.id]||!n.canSkip(Ee)?m.push(Ee):s[Ee.id]=!0});const y=l.filter(Ee=>s[Ee.id]),D=(Ee,dt)=>({currentPos:dt,rowNode:Ee}),W=m.map(D).sort((Ee,dt)=>this.rowNodeSorter.compareRowNodes(o,Ee,dt));return this.mergeSortedArrays(o,W,y.map(D)).map(({rowNode:Ee})=>Ee)}mergeSortedArrays(e,t,n){const o=[];let a=0,l=0;for(;a<t.length&&l<n.length;)this.rowNodeSorter.compareRowNodes(e,t[a],n[l])<0?o.push(t[a++]):o.push(n[l++]);for(;a<t.length;)o.push(t[a++]);for(;l<n.length;)o.push(n[l++]);return o}updateChildIndexes(e){if(_.missing(e.childrenAfterSort))return;const t=e.childrenAfterSort;for(let n=0;n<t.length;n++){const o=t[n],a=n===0,l=n===e.childrenAfterSort.length-1;o.setFirstChild(a),o.setLastChild(l),o.setChildIndex(n)}}updateGroupDataForHideOpenParents(e){if(!this.gridOptionsService.is("groupHideOpenParents"))return;if(this.gridOptionsService.isTreeData()){const n="AG Grid: The property hideOpenParents dose not work with Tree Data. This is because Tree Data has values at the group level, it doesn't make sense to hide them (as opposed to Row Grouping, which only has Aggregated Values at the group level).";return _.doOnce(()=>console.warn(n),"sortService.hideOpenParentsWithTreeData"),!1}const t=n=>{this.pullDownGroupDataForHideOpenParents(n.childrenAfterSort,!1),n.childrenAfterSort.forEach(o=>{o.hasChildren()&&t(o)})};e&&e.executeFromRootNode(n=>t(n))}pullDownGroupDataForHideOpenParents(e,t){!this.gridOptionsService.is("groupHideOpenParents")||_.missing(e)||e.forEach(n=>{this.columnModel.getGroupDisplayColumns().forEach(a=>{const l=a.getColDef().showRowGroup;if(typeof l!="string"){console.error("AG Grid: groupHideOpenParents only works when specifying specific columns for colDef.showRowGroup");return}const s=l,m=this.columnModel.getPrimaryColumn(s);if(m!==n.rowGroupColumn)if(t)n.setGroupValue(a.getId(),void 0);else{const D=n.getFirstChildOfFirstChild(m);D&&n.setGroupValue(a.getId(),D.key)}})})}};__decorate$7([Autowired("columnModel")],SortService.prototype,"columnModel",void 0);__decorate$7([Autowired("rowNodeSorter")],SortService.prototype,"rowNodeSorter",void 0);__decorate$7([PostConstruct],SortService.prototype,"init",null);SortService=__decorate$7([Bean("sortService")],SortService);var __decorate$6=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let FilterService=class extends BeanStub{filter(e){const t=this.filterManager.isColumnFilterPresent()||this.filterManager.isQuickFilterPresent()||this.filterManager.isExternalFilterPresent();this.filterNodes(t,e)}filterNodes(e,t){const n=(o,a)=>{o.hasChildren()&&e&&!a?o.childrenAfterFilter=o.childrenAfterGroup.filter(l=>{const s=l.childrenAfterFilter&&l.childrenAfterFilter.length>0,m=l.data&&this.filterManager.doesRowPassFilter({rowNode:l});return s||m}):o.childrenAfterFilter=o.childrenAfterGroup,o.sibling&&(o.sibling.childrenAfterFilter=o.childrenAfterFilter)};if(this.doingTreeDataFiltering()){const o=(l,s)=>{if(l.childrenAfterGroup)for(let m=0;m<l.childrenAfterGroup.length;m++){const y=l.childrenAfterGroup[m],D=s||this.filterManager.doesRowPassFilter({rowNode:y});y.childrenAfterGroup?o(l.childrenAfterGroup[m],D):n(y,D)}n(l,s)},a=l=>o(l,!1);t.executeFromRootNode(a)}else{const o=a=>n(a,!1);t.forEachChangedNodeDepthFirst(o,!0)}}doingTreeDataFiltering(){return this.gridOptionsService.isTreeData()&&!this.gridOptionsService.is("excludeChildrenWhenTreeDataFiltering")}};__decorate$6([Autowired("filterManager")],FilterService.prototype,"filterManager",void 0);FilterService=__decorate$6([Bean("filterService")],FilterService);var __decorate$5=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let ImmutableService=class extends BeanStub{postConstruct(){this.rowModel.getType()==="clientSide"&&(this.clientSideRowModel=this.rowModel)}isActive(){const e=this.gridOptionsService.exists("getRowId");return this.gridOptionsService.is("resetRowDataOnUpdate")?!1:e}setRowData(e){const t=this.createTransactionForRowData(e);if(!t)return;const[n,o]=t;this.clientSideRowModel.updateRowData(n,o)}createTransactionForRowData(e){if(_.missing(this.clientSideRowModel)){console.error("AG Grid: ImmutableService only works with ClientSideRowModel");return}const t=this.gridOptionsService.getCallback("getRowId");if(t==null){console.error("AG Grid: ImmutableService requires getRowId() callback to be implemented, your row data needs IDs!");return}const n={remove:[],update:[],add:[]},o=this.clientSideRowModel.getCopyOfNodesMap(),l=this.gridOptionsService.is("suppressMaintainUnsortedOrder")?void 0:{};return _.exists(e)&&e.forEach((s,m)=>{const y=t({data:s,level:0}),D=o[y];l&&(l[y]=m),D?(D.data!==s&&n.update.push(s),o[y]=void 0):n.add.push(s)}),_.iterateObject(o,(s,m)=>{m&&n.remove.push(m.data)}),[n,l]}};__decorate$5([Autowired("rowModel")],ImmutableService.prototype,"rowModel",void 0);__decorate$5([Autowired("rowRenderer")],ImmutableService.prototype,"rowRenderer",void 0);__decorate$5([PostConstruct],ImmutableService.prototype,"postConstruct",null);ImmutableService=__decorate$5([Bean("immutableService")],ImmutableService);const VERSION$2="30.0.5",ClientSideRowModelModule={version:VERSION$2,moduleName:ModuleNames.ClientSideRowModelModule,rowModel:"clientSide",beans:[ClientSideRowModel,FilterStage,SortStage,FlattenStage,SortService,FilterService,ImmutableService]};var __decorate$4=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class InfiniteBlock extends RowNodeBlock{constructor(e,t,n){super(e),this.parentCache=t,this.params=n,this.startRow=e*n.blockSize,this.endRow=this.startRow+n.blockSize}postConstruct(){this.createRowNodes()}getBlockStateJson(){return{id:""+this.getId(),state:{blockNumber:this.getId(),startRow:this.getStartRow(),endRow:this.getEndRow(),pageStatus:this.getState()}}}setDataAndId(e,t,n){_.exists(t)?e.setDataAndId(t,n.toString()):e.setDataAndId(void 0,void 0)}loadFromDatasource(){const e=this.createLoadParams();if(_.missing(this.params.datasource.getRows)){console.warn("AG Grid: datasource is missing getRows method");return}window.setTimeout(()=>{this.params.datasource.getRows(e)},0)}processServerFail(){}createLoadParams(){return{startRow:this.getStartRow(),endRow:this.getEndRow(),successCallback:this.pageLoaded.bind(this,this.getVersion()),failCallback:this.pageLoadFailed.bind(this,this.getVersion()),sortModel:this.params.sortModel,filterModel:this.params.filterModel,context:this.gridOptionsService.context}}forEachNode(e,t,n){this.rowNodes.forEach((o,a)=>{this.startRow+a<n&&e(o,t.next())})}getLastAccessed(){return this.lastAccessed}getRow(e,t=!1){t||(this.lastAccessed=this.params.lastAccessedSequence.next());const n=e-this.startRow;return this.rowNodes[n]}getStartRow(){return this.startRow}getEndRow(){return this.endRow}createRowNodes(){this.rowNodes=[];for(let e=0;e<this.params.blockSize;e++){const t=this.startRow+e,n=new RowNode(this.beans);n.setRowHeight(this.params.rowHeight),n.uiLevel=0,n.setRowIndex(t),n.setRowTop(this.params.rowHeight*t),this.rowNodes.push(n)}}processServerResult(e){this.rowNodes.forEach((n,o)=>{const a=e.rowData?e.rowData[o]:void 0;!n.id&&n.alreadyRendered&&a&&(this.rowNodes[o]=new RowNode(this.beans),this.rowNodes[o].setRowIndex(n.rowIndex),this.rowNodes[o].setRowTop(n.rowTop),n.clearRowTopAndRowIndex()),this.setDataAndId(this.rowNodes[o],a,this.startRow+o)});const t=e.rowCount!=null&&e.rowCount>=0?e.rowCount:void 0;this.parentCache.pageLoaded(this,t)}destroyRowNodes(){this.rowNodes.forEach(e=>{e.clearRowTopAndRowIndex()})}}__decorate$4([Autowired("beans")],InfiniteBlock.prototype,"beans",void 0);__decorate$4([PostConstruct],InfiniteBlock.prototype,"postConstruct",null);__decorate$4([PreDestroy],InfiniteBlock.prototype,"destroyRowNodes",null);var __decorate$3=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},__param=function(r,e){return function(t,n){e(t,n,r)}};class InfiniteCache extends BeanStub{constructor(e){super(),this.lastRowIndexKnown=!1,this.blocks={},this.blockCount=0,this.rowCount=e.initialRowCount,this.params=e}setBeans(e){this.logger=e.create("InfiniteCache")}getRow(e,t=!1){const n=Math.floor(e/this.params.blockSize);let o=this.blocks[n];if(!o){if(t)return;o=this.createBlock(n)}return o.getRow(e)}createBlock(e){const t=this.createBean(new InfiniteBlock(e,this,this.params));return this.blocks[t.getId()]=t,this.blockCount++,this.purgeBlocksIfNeeded(t),this.params.rowNodeBlockLoader.addBlock(t),t}refreshCache(){if(this.blockCount==0){this.purgeCache();return}this.getBlocksInOrder().forEach(t=>t.setStateWaitingToLoad()),this.params.rowNodeBlockLoader.checkBlockToLoad()}destroyAllBlocks(){this.getBlocksInOrder().forEach(e=>this.destroyBlock(e))}getRowCount(){return this.rowCount}isLastRowIndexKnown(){return this.lastRowIndexKnown}pageLoaded(e,t){this.isAlive()&&(this.logger.log(`onPageLoaded: page = ${e.getId()}, lastRow = ${t}`),this.checkRowCount(e,t),this.onCacheUpdated())}purgeBlocksIfNeeded(e){const t=this.getBlocksInOrder().filter(s=>s!=e),n=(s,m)=>m.getLastAccessed()-s.getLastAccessed();t.sort(n);const o=this.params.maxBlocksInCache>0,a=o?this.params.maxBlocksInCache-1:null,l=InfiniteCache.MAX_EMPTY_BLOCKS_TO_KEEP-1;t.forEach((s,m)=>{const y=s.getState()===InfiniteBlock.STATE_WAITING_TO_LOAD&&m>=l,D=o?m>=a:!1;if(y||D){if(this.isBlockCurrentlyDisplayed(s)||this.isBlockFocused(s))return;this.removeBlockFromCache(s)}})}isBlockFocused(e){const t=this.focusService.getFocusCellToUseAfterRefresh();if(!t||t.rowPinned!=null)return!1;const n=e.getStartRow(),o=e.getEndRow();return t.rowIndex>=n&&t.rowIndex<o}isBlockCurrentlyDisplayed(e){const t=e.getStartRow(),n=e.getEndRow()-1;return this.rowRenderer.isRangeInRenderedViewport(t,n)}removeBlockFromCache(e){e&&this.destroyBlock(e)}checkRowCount(e,t){if(typeof t=="number"&&t>=0)this.rowCount=t,this.lastRowIndexKnown=!0;else if(!this.lastRowIndexKnown){const o=(e.getId()+1)*this.params.blockSize+this.params.overflowSize;this.rowCount<o&&(this.rowCount=o)}}setRowCount(e,t){this.rowCount=e,_.exists(t)&&(this.lastRowIndexKnown=t),this.lastRowIndexKnown||this.rowCount%this.params.blockSize===0&&this.rowCount++,this.onCacheUpdated()}forEachNodeDeep(e){const t=new NumberSequence;this.getBlocksInOrder().forEach(n=>n.forEachNode(e,t,this.rowCount))}getBlocksInOrder(){const e=(n,o)=>n.getId()-o.getId();return _.getAllValuesInObject(this.blocks).sort(e)}destroyBlock(e){delete this.blocks[e.getId()],this.destroyBean(e),this.blockCount--,this.params.rowNodeBlockLoader.removeBlock(e)}onCacheUpdated(){if(this.isAlive()){this.destroyAllBlocksPastVirtualRowCount();const e={type:Events.EVENT_STORE_UPDATED};this.eventService.dispatchEvent(e)}}destroyAllBlocksPastVirtualRowCount(){const e=[];this.getBlocksInOrder().forEach(t=>{t.getId()*this.params.blockSize>=this.rowCount&&e.push(t)}),e.length>0&&e.forEach(t=>this.destroyBlock(t))}purgeCache(){this.getBlocksInOrder().forEach(e=>this.removeBlockFromCache(e)),this.lastRowIndexKnown=!1,this.rowCount===0&&(this.rowCount=this.params.initialRowCount),this.onCacheUpdated()}getRowNodesInRange(e,t){const n=[];let o=-1,a=!1;const l=new NumberSequence;_.missing(e)&&(a=!0);let s=!1;return this.getBlocksInOrder().forEach(y=>{if(!s){if(a&&o+1!==y.getId()){s=!0;return}o=y.getId(),y.forEachNode(D=>{const W=D===e||D===t;(a||W)&&n.push(D),W&&(a=!a)},l,this.rowCount)}}),s||a?[]:n}}InfiniteCache.MAX_EMPTY_BLOCKS_TO_KEEP=2;__decorate$3([Autowired("rowRenderer")],InfiniteCache.prototype,"rowRenderer",void 0);__decorate$3([Autowired("focusService")],InfiniteCache.prototype,"focusService",void 0);__decorate$3([__param(0,Qualifier("loggerFactory"))],InfiniteCache.prototype,"setBeans",null);__decorate$3([PreDestroy],InfiniteCache.prototype,"destroyAllBlocks",null);var __decorate$2=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let InfiniteRowModel=class extends BeanStub{getRowBounds(e){return{rowHeight:this.rowHeight,rowTop:this.rowHeight*e}}ensureRowHeightsValid(e,t,n,o){return!1}init(){this.gridOptionsService.isRowModelType("infinite")&&(this.rowHeight=this.gridOptionsService.getRowHeightAsNumber(),this.addEventListeners(),this.addDestroyFunc(()=>this.destroyCache()),this.verifyProps())}verifyProps(){if(this.gridOptionsService.exists("initialGroupOrderComparator")){const e="AG Grid: initialGroupOrderComparator cannot be used with Infinite Row Model. If using Infinite Row Model, then sorting is done on the server side, nothing to do with the client.";_.doOnce(()=>console.warn(e),"IRM.InitialGroupOrderComparator")}}start(){this.setDatasource(this.gridOptionsService.get("datasource"))}destroyDatasource(){this.datasource&&(this.getContext().destroyBean(this.datasource),this.rowRenderer.datasourceChanged(),this.datasource=null)}addEventListeners(){this.addManagedListener(this.eventService,Events.EVENT_FILTER_CHANGED,this.onFilterChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_SORT_CHANGED,this.onSortChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_NEW_COLUMNS_LOADED,this.onColumnEverything.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_STORE_UPDATED,this.onCacheUpdated.bind(this))}onFilterChanged(){this.reset()}onSortChanged(){this.reset()}onColumnEverything(){let e;this.cacheParams?e=this.isSortModelDifferent():e=!0,e&&this.reset()}isSortModelDifferent(){return!_.jsonEquals(this.cacheParams.sortModel,this.sortController.getSortModel())}getType(){return"infinite"}setDatasource(e){this.destroyDatasource(),this.datasource=e,e&&this.reset()}isEmpty(){return!this.infiniteCache}isRowsToRender(){return!!this.infiniteCache}getNodesInRangeForSelection(e,t){return this.infiniteCache?this.infiniteCache.getRowNodesInRange(e,t):[]}reset(){if(!this.datasource)return;this.gridOptionsService.getCallback("getRowId")!=null||this.selectionService.reset(),this.resetCache();const n=this.createModelUpdatedEvent();this.eventService.dispatchEvent(n)}createModelUpdatedEvent(){return{type:Events.EVENT_MODEL_UPDATED,newPage:!1,newData:!1,keepRenderedRows:!0,animate:!1}}resetCache(){this.destroyCache(),this.cacheParams={datasource:this.datasource,filterModel:this.filterManager.getFilterModel(),sortModel:this.sortController.getSortModel(),rowNodeBlockLoader:this.rowNodeBlockLoader,initialRowCount:this.defaultIfInvalid(this.gridOptionsService.getNum("infiniteInitialRowCount"),1),maxBlocksInCache:this.gridOptionsService.getNum("maxBlocksInCache"),rowHeight:this.gridOptionsService.getRowHeightAsNumber(),overflowSize:this.defaultIfInvalid(this.gridOptionsService.getNum("cacheOverflowSize"),1),blockSize:this.defaultIfInvalid(this.gridOptionsService.getNum("cacheBlockSize"),100),lastAccessedSequence:new NumberSequence},this.infiniteCache=this.createBean(new InfiniteCache(this.cacheParams))}defaultIfInvalid(e,t){return e>0?e:t}destroyCache(){this.infiniteCache&&(this.infiniteCache=this.destroyBean(this.infiniteCache))}onCacheUpdated(){const e=this.createModelUpdatedEvent();this.eventService.dispatchEvent(e)}getRow(e){if(this.infiniteCache&&!(e>=this.infiniteCache.getRowCount()))return this.infiniteCache.getRow(e)}getRowNode(e){let t;return this.forEachNode(n=>{n.id===e&&(t=n)}),t}forEachNode(e){this.infiniteCache&&this.infiniteCache.forEachNodeDeep(e)}getTopLevelRowCount(){return this.getRowCount()}getTopLevelRowDisplayedIndex(e){return e}getRowIndexAtPixel(e){if(this.rowHeight!==0){const t=Math.floor(e/this.rowHeight),n=this.getRowCount()-1;return t>n?n:t}return 0}getRowCount(){return this.infiniteCache?this.infiniteCache.getRowCount():0}isRowPresent(e){return!!this.getRowNode(e.id)}refreshCache(){this.infiniteCache&&this.infiniteCache.refreshCache()}purgeCache(){this.infiniteCache&&this.infiniteCache.purgeCache()}isLastRowIndexKnown(){return this.infiniteCache?this.infiniteCache.isLastRowIndexKnown():!1}setRowCount(e,t){this.infiniteCache&&this.infiniteCache.setRowCount(e,t)}};__decorate$2([Autowired("filterManager")],InfiniteRowModel.prototype,"filterManager",void 0);__decorate$2([Autowired("sortController")],InfiniteRowModel.prototype,"sortController",void 0);__decorate$2([Autowired("selectionService")],InfiniteRowModel.prototype,"selectionService",void 0);__decorate$2([Autowired("rowRenderer")],InfiniteRowModel.prototype,"rowRenderer",void 0);__decorate$2([Autowired("rowNodeBlockLoader")],InfiniteRowModel.prototype,"rowNodeBlockLoader",void 0);__decorate$2([PostConstruct],InfiniteRowModel.prototype,"init",null);__decorate$2([PreDestroy],InfiniteRowModel.prototype,"destroyDatasource",null);InfiniteRowModel=__decorate$2([Bean("rowModel")],InfiniteRowModel);const VERSION$1="30.0.5",InfiniteRowModelModule={version:VERSION$1,moduleName:ModuleNames.InfiniteRowModelModule,rowModel:"infinite",beans:[InfiniteRowModel]};class BaseCreator{setBeans(e){this.beans=e}getFileName(e){const t=this.getDefaultFileExtension();return(e==null||!e.length)&&(e=this.getDefaultFileName()),e.indexOf(".")===-1?`${e}.${t}`:e}getData(e){const t=this.createSerializingSession(e);return this.beans.gridSerializer.serialize(t,e)}}class BaseGridSerializingSession{constructor(e){this.groupColumns=[];const{columnModel:t,valueService:n,gridOptionsService:o,valueFormatterService:a,valueParserService:l,processCellCallback:s,processHeaderCallback:m,processGroupHeaderCallback:y,processRowGroupCallback:D}=e;this.columnModel=t,this.valueService=n,this.gridOptionsService=o,this.valueFormatterService=a,this.valueParserService=l,this.processCellCallback=s,this.processHeaderCallback=m,this.processGroupHeaderCallback=y,this.processRowGroupCallback=D}prepare(e){this.groupColumns=e.filter(t=>!!t.getColDef().showRowGroup)}extractHeaderValue(e){const t=this.getHeaderName(this.processHeaderCallback,e);return t??""}extractRowCellValue(e,t,n,o,a){const s=(!this.gridOptionsService.is("groupHideOpenParents")||a.footer)&&this.shouldRenderGroupSummaryCell(a,e,t)?this.createValueForGroupNode(a):this.valueService.getValue(e,a);return this.processCell({accumulatedRowIndex:n,rowNode:a,column:e,value:s,processCellCallback:this.processCellCallback,type:o})}shouldRenderGroupSummaryCell(e,t,n){var o;if(!(e&&e.group))return!1;if(this.groupColumns.indexOf(t)!==-1){if(((o=e.groupData)===null||o===void 0?void 0:o[t.getId()])!=null)return!0;if(e.footer&&e.level===-1){const m=t.getColDef();return m==null||m.showRowGroup===!0||m.showRowGroup===this.columnModel.getRowGroupColumns()[0].getId()}}const s=this.gridOptionsService.isGroupUseEntireRow(this.columnModel.isPivotMode());return n===0&&s}getHeaderName(e,t){return e?e({column:t,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context}):this.columnModel.getDisplayNameForColumn(t,"csv",!0)}createValueForGroupNode(e){if(this.processRowGroupCallback)return this.processRowGroupCallback({node:e,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context});const t=e.footer,n=[e.key];if(!this.gridOptionsService.isGroupMultiAutoColumn())for(;e.parent;)e=e.parent,n.push(e.key);const o=n.reverse().join(" -> ");return t?`Total ${o}`:o}processCell(e){var t;const{accumulatedRowIndex:n,rowNode:o,column:a,value:l,processCellCallback:s,type:m}=e;return s?{value:(t=s({accumulatedRowIndex:n,column:a,node:o,value:l,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context,type:m,parseValue:y=>this.valueParserService.parseValue(a,o,y,this.valueService.getValue(a,o)),formatValue:y=>{var D;return(D=this.valueFormatterService.formatValue(a,o,y))!==null&&D!==void 0?D:y}}))!==null&&t!==void 0?t:""}:a.getColDef().useValueFormatterForExport?{value:l??"",valueFormatted:this.valueFormatterService.formatValue(a,o,l)}:{value:l??""}}}class Downloader{static download(e,t){const n=document.defaultView||window;if(!n){console.warn("AG Grid: There is no `window` associated with the current `document`");return}const o=document.createElement("a"),a=n.URL.createObjectURL(t);o.setAttribute("href",a),o.setAttribute("download",e),o.style.display="none",document.body.appendChild(o),o.dispatchEvent(new MouseEvent("click",{bubbles:!1,cancelable:!0,view:n})),document.body.removeChild(o),n.setTimeout(()=>{n.URL.revokeObjectURL(a)},0)}}const LINE_SEPARATOR$1=`\r
`;class CsvSerializingSession extends BaseGridSerializingSession{constructor(e){super(e),this.isFirstLine=!0,this.result="";const{suppressQuotes:t,columnSeparator:n}=e;this.suppressQuotes=t,this.columnSeparator=n}addCustomContent(e){e&&(typeof e=="string"?(/^\s*\n/.test(e)||this.beginNewLine(),e=e.replace(/\r?\n/g,LINE_SEPARATOR$1),this.result+=e):e.forEach(t=>{this.beginNewLine(),t.forEach((n,o)=>{o!==0&&(this.result+=this.columnSeparator),this.result+=this.putInQuotes(n.data.value||""),n.mergeAcross&&this.appendEmptyCells(n.mergeAcross)})}))}onNewHeaderGroupingRow(){return this.beginNewLine(),{onColumn:this.onNewHeaderGroupingRowColumn.bind(this)}}onNewHeaderGroupingRowColumn(e,t,n,o){n!=0&&(this.result+=this.columnSeparator),this.result+=this.putInQuotes(t),this.appendEmptyCells(o)}appendEmptyCells(e){for(let t=1;t<=e;t++)this.result+=this.columnSeparator+this.putInQuotes("")}onNewHeaderRow(){return this.beginNewLine(),{onColumn:this.onNewHeaderRowColumn.bind(this)}}onNewHeaderRowColumn(e,t){t!=0&&(this.result+=this.columnSeparator),this.result+=this.putInQuotes(this.extractHeaderValue(e))}onNewBodyRow(){return this.beginNewLine(),{onColumn:this.onNewBodyRowColumn.bind(this)}}onNewBodyRowColumn(e,t,n){var o;t!=0&&(this.result+=this.columnSeparator);const a=this.extractRowCellValue(e,t,t,"csv",n);this.result+=this.putInQuotes((o=a.valueFormatted)!==null&&o!==void 0?o:a.value)}putInQuotes(e){if(this.suppressQuotes)return e;if(e==null)return'""';let t;return typeof e=="string"?t=e:typeof e.toString=="function"?t=e.toString():(console.warn("AG Grid: unknown value type during csv conversion"),t=""),'"'+t.replace(/"/g,'""')+'"'}parse(){return this.result}beginNewLine(){this.isFirstLine||(this.result+=LINE_SEPARATOR$1),this.isFirstLine=!1}}var __decorate$1=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let CsvCreator=class extends BaseCreator{postConstruct(){this.setBeans({gridSerializer:this.gridSerializer,gridOptionsService:this.gridOptionsService})}getMergedParams(e){const t=this.gridOptionsService.get("defaultCsvExportParams");return Object.assign({},t,e)}export(e){if(this.isExportSuppressed())return console.warn("AG Grid: Export cancelled. Export is not allowed as per your configuration."),"";const t=this.getMergedParams(e),n=this.getData(t),o=new Blob(["\uFEFF",n],{type:"text/plain"});return Downloader.download(this.getFileName(t.fileName),o),n}exportDataAsCsv(e){return this.export(e)}getDataAsCsv(e,t=!1){const n=t?Object.assign({},e):this.getMergedParams(e);return this.getData(n)}getDefaultFileName(){return"export.csv"}getDefaultFileExtension(){return"csv"}createSerializingSession(e){const{columnModel:t,valueService:n,gridOptionsService:o,valueFormatterService:a,valueParserService:l}=this,{processCellCallback:s,processHeaderCallback:m,processGroupHeaderCallback:y,processRowGroupCallback:D,suppressQuotes:W,columnSeparator:Ee}=e;return new CsvSerializingSession({columnModel:t,valueService:n,gridOptionsService:o,valueFormatterService:a,valueParserService:l,processCellCallback:s||void 0,processHeaderCallback:m||void 0,processGroupHeaderCallback:y||void 0,processRowGroupCallback:D||void 0,suppressQuotes:W||!1,columnSeparator:Ee||","})}isExportSuppressed(){return this.gridOptionsService.is("suppressCsvExport")}};__decorate$1([Autowired("columnModel")],CsvCreator.prototype,"columnModel",void 0);__decorate$1([Autowired("valueService")],CsvCreator.prototype,"valueService",void 0);__decorate$1([Autowired("gridSerializer")],CsvCreator.prototype,"gridSerializer",void 0);__decorate$1([Autowired("gridOptionsService")],CsvCreator.prototype,"gridOptionsService",void 0);__decorate$1([Autowired("valueFormatterService")],CsvCreator.prototype,"valueFormatterService",void 0);__decorate$1([Autowired("valueParserService")],CsvCreator.prototype,"valueParserService",void 0);__decorate$1([PostConstruct],CsvCreator.prototype,"postConstruct",null);CsvCreator=__decorate$1([Bean("csvCreator")],CsvCreator);var __decorate=function(r,e,t,n){var o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(l=r[s])&&(a=(o<3?l(a):o>3?l(e,t,a):l(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},RowType;(function(r){r[r.HEADER_GROUPING=0]="HEADER_GROUPING",r[r.HEADER=1]="HEADER",r[r.BODY=2]="BODY"})(RowType||(RowType={}));let GridSerializer=class extends BeanStub{serialize(e,t={}){const n=this.getColumnsToExport(t.allColumns,t.columnKeys);return _.compose(this.prepareSession(n),this.prependContent(t),this.exportColumnGroups(t,n),this.exportHeaders(t,n),this.processPinnedTopRows(t,n),this.processRows(t,n),this.processPinnedBottomRows(t,n),this.appendContent(t))(e).parse()}processRow(e,t,n,o){const a=t.shouldRowBeSkipped||(()=>!1),l=this.gridOptionsService.context,s=this.gridOptionsService.api,m=this.gridOptionsService.columnApi,y=this.gridOptionsService.is("groupRemoveSingleChildren"),D=this.gridOptionsService.is("groupRemoveLowestSingleChildren"),Ee=t.rowPositions!=null||!!t.onlySelected,dt=this.gridOptionsService.is("groupHideOpenParents")&&!Ee,Ht=this.columnModel.isPivotMode()?o.leafGroup:!o.group,ir=!!o.footer,Hr=t.skipGroups||t.skipRowGroups,Bn=D&&o.leafGroup,Vn=o.allChildrenCount===1&&(y||Bn);if(Hr&&t.skipGroups&&_.doOnce(()=>console.warn("AG Grid: Since v25.2 `skipGroups` has been renamed to `skipRowGroups`."),"gridSerializer-skipGroups"),!Ht&&!ir&&(t.skipRowGroups||Vn||dt)||t.onlySelected&&!o.isSelected()||t.skipPinnedTop&&o.rowPinned==="top"||t.skipPinnedBottom&&o.rowPinned==="bottom"||o.level===-1&&!Ht&&!ir||a({node:o,api:s,columnApi:m,context:l}))return;const il=e.onNewBodyRow(o);if(n.forEach((gl,ml)=>{il.onColumn(gl,ml,o)}),t.getCustomContentBelowRow){const gl=t.getCustomContentBelowRow({node:o,api:s,columnApi:m,context:l});gl&&e.addCustomContent(gl)}}appendContent(e){return t=>{const n=e.customFooter||e.appendContent;return n&&(e.customFooter&&_.doOnce(()=>console.warn("AG Grid: Since version 25.2.0 the `customFooter` param has been deprecated. Use `appendContent` instead."),"gridSerializer-customFooter"),t.addCustomContent(n)),t}}prependContent(e){return t=>{const n=e.customHeader||e.prependContent;return n&&(e.customHeader&&_.doOnce(()=>console.warn("AG Grid: Since version 25.2.0 the `customHeader` param has been deprecated. Use `prependContent` instead."),"gridSerializer-customHeader"),t.addCustomContent(n)),t}}prepareSession(e){return t=>(t.prepare(e),t)}exportColumnGroups(e,t){return n=>{if(e.skipColumnGroupHeaders)e.columnGroups&&_.doOnce(()=>console.warn("AG Grid: Since v25.2 the `columnGroups` param has deprecated, and groups are exported by default."),"gridSerializer-columnGroups");else{const o=new GroupInstanceIdCreator,a=this.displayedGroupCreator.createDisplayedGroups(t,this.columnModel.getGridBalancedTree(),o,null);this.recursivelyAddHeaderGroups(a,n,e.processGroupHeaderCallback)}return n}}exportHeaders(e,t){return n=>{if(!e.skipHeader&&!e.skipColumnHeaders){const o=n.onNewHeaderRow();t.forEach((a,l)=>{o.onColumn(a,l,void 0)})}else e.skipHeader&&_.doOnce(()=>console.warn("AG Grid: Since v25.2 the `skipHeader` param has been renamed to `skipColumnHeaders`."),"gridSerializer-skipHeader");return n}}processPinnedTopRows(e,t){return n=>{const o=this.processRow.bind(this,n,e,t);return e.rowPositions?e.rowPositions.filter(a=>a.rowPinned==="top").sort((a,l)=>a.rowIndex-l.rowIndex).map(a=>this.pinnedRowModel.getPinnedTopRow(a.rowIndex)).forEach(o):this.pinnedRowModel.forEachPinnedTopRow(o),n}}processRows(e,t){return n=>{const o=this.rowModel,a=o.getType(),l=a==="clientSide",s=a==="serverSide",m=!l&&e.onlySelected,y=this.processRow.bind(this,n,e,t),{exportedRows:D="filteredAndSorted"}=e;if(e.rowPositions)e.rowPositions.filter(W=>W.rowPinned==null).sort((W,Ee)=>W.rowIndex-Ee.rowIndex).map(W=>o.getRow(W.rowIndex)).forEach(y);else if(this.columnModel.isPivotMode())l?o.forEachPivotNode(y,!0):o.forEachNode(y);else if(e.onlySelectedAllPages||m){const W=this.selectionService.getSelectedNodes();this.replicateSortedOrder(W),W.forEach(y)}else D==="all"?o.forEachNode(y):l?o.forEachNodeAfterFilterAndSort(y,!0):s?o.forEachNodeAfterFilterAndSort(y):o.forEachNode(y);return n}}replicateSortedOrder(e){const t=this.sortController.getSortOptions(),n=(o,a)=>{var l,s,m,y;return o.rowIndex!=null&&a.rowIndex!=null?o.rowIndex-a.rowIndex:o.level===a.level?((l=o.parent)===null||l===void 0?void 0:l.id)===((s=a.parent)===null||s===void 0?void 0:s.id)?this.rowNodeSorter.compareRowNodes(t,{rowNode:o,currentPos:(m=o.rowIndex)!==null&&m!==void 0?m:-1},{rowNode:a,currentPos:(y=a.rowIndex)!==null&&y!==void 0?y:-1}):n(o.parent,a.parent):o.level>a.level?n(o.parent,a):n(o,a.parent)};e.sort(n)}processPinnedBottomRows(e,t){return n=>{const o=this.processRow.bind(this,n,e,t);return e.rowPositions?e.rowPositions.filter(a=>a.rowPinned==="bottom").sort((a,l)=>a.rowIndex-l.rowIndex).map(a=>this.pinnedRowModel.getPinnedBottomRow(a.rowIndex)).forEach(o):this.pinnedRowModel.forEachPinnedBottomRow(o),n}}getColumnsToExport(e=!1,t){const n=this.columnModel.isPivotMode();return t&&t.length?this.columnModel.getGridColumns(t):e&&!n?(this.gridOptionsService.isTreeData()?this.columnModel.getGridColumns([GROUP_AUTO_COLUMN_ID]):[]).concat(this.columnModel.getAllGridColumns()||[]):this.columnModel.getAllDisplayedColumns()}recursivelyAddHeaderGroups(e,t,n){const o=[];e.forEach(a=>{const l=a;l.getChildren&&l.getChildren().forEach(s=>o.push(s))}),e.length>0&&e[0]instanceof ColumnGroup&&this.doAddHeaderHeader(t,e,n),o&&o.length>0&&this.recursivelyAddHeaderGroups(o,t,n)}doAddHeaderHeader(e,t,n){const o=e.onNewHeaderGroupingRow();let a=0;t.forEach(l=>{const s=l;let m;n?m=n({columnGroup:s,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context}):m=this.columnModel.getDisplayNameForColumnGroup(s,"header");const y=s.getLeafColumns().reduce((D,W,Ee,dt)=>{let Ht=_.last(D);return W.getColumnGroupShow()==="open"?(!Ht||Ht[1]!=null)&&(Ht=[Ee],D.push(Ht)):Ht&&Ht[1]==null&&(Ht[1]=Ee-1),Ee===dt.length-1&&Ht&&Ht[1]==null&&(Ht[1]=Ee),D},[]);o.onColumn(s,m||"",a++,s.getLeafColumns().length-1,y)})}};__decorate([Autowired("displayedGroupCreator")],GridSerializer.prototype,"displayedGroupCreator",void 0);__decorate([Autowired("columnModel")],GridSerializer.prototype,"columnModel",void 0);__decorate([Autowired("rowModel")],GridSerializer.prototype,"rowModel",void 0);__decorate([Autowired("pinnedRowModel")],GridSerializer.prototype,"pinnedRowModel",void 0);__decorate([Autowired("selectionService")],GridSerializer.prototype,"selectionService",void 0);__decorate([Autowired("rowNodeSorter")],GridSerializer.prototype,"rowNodeSorter",void 0);__decorate([Autowired("sortController")],GridSerializer.prototype,"sortController",void 0);GridSerializer=__decorate([Bean("gridSerializer")],GridSerializer);const VERSION="30.0.5",CsvExportModule={version:VERSION,moduleName:ModuleNames.CsvExportModule,beans:[CsvCreator,GridSerializer]},AllCommunityModules=[ClientSideRowModelModule,InfiniteRowModelModule,CsvExportModule];ModuleRegistry.registerModules(AllCommunityModules);const agGrid="",agThemeAlpine="";var earthRadius=63710088e-1,factors={centimeters:earthRadius*100,centimetres:earthRadius*100,degrees:earthRadius/111325,feet:earthRadius*3.28084,inches:earthRadius*39.37,kilometers:earthRadius/1e3,kilometres:earthRadius/1e3,meters:earthRadius,metres:earthRadius,miles:earthRadius/1609.344,millimeters:earthRadius*1e3,millimetres:earthRadius*1e3,nauticalmiles:earthRadius/1852,radians:1,yards:earthRadius*1.0936},unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/earthRadius,yards:1.0936133},areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function feature(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function geometry(r,e,t){switch(r){case"Point":return point(e).geometry;case"LineString":return lineString(e).geometry;case"Polygon":return polygon(e).geometry;case"MultiPoint":return multiPoint(e).geometry;case"MultiLineString":return multiLineString(e).geometry;case"MultiPolygon":return multiPolygon(e).geometry;default:throw new Error(r+" is invalid")}}function point(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!isNumber(r[0])||!isNumber(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return feature(n,e,t)}function points$1(r,e,t){return t===void 0&&(t={}),featureCollection$1(r.map(function(n){return point(n,e)}),t)}function polygon(r,e,t){t===void 0&&(t={});for(var n=0,o=r;n<o.length;n++){var a=o[n];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var l=0;l<a[a.length-1].length;l++)if(a[a.length-1][l]!==a[0][l])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:r};return feature(s,e,t)}function polygons(r,e,t){return t===void 0&&(t={}),featureCollection$1(r.map(function(n){return polygon(n,e)}),t)}function lineString(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return feature(n,e,t)}function lineStrings(r,e,t){return t===void 0&&(t={}),featureCollection$1(r.map(function(n){return lineString(n,e)}),t)}function featureCollection$1(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function multiLineString(r,e,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:r};return feature(n,e,t)}function multiPoint(r,e,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:r};return feature(n,e,t)}function multiPolygon(r,e,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:r};return feature(n,e,t)}function geometryCollection(r,e,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:r};return feature(n,e,t)}function round$1(r,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(r*t)/t}function radiansToLength(r,e){e===void 0&&(e="kilometers");var t=factors[e];if(!t)throw new Error(e+" units is invalid");return r*t}function lengthToRadians(r,e){e===void 0&&(e="kilometers");var t=factors[e];if(!t)throw new Error(e+" units is invalid");return r/t}function lengthToDegrees(r,e){return radiansToDegrees(lengthToRadians(r,e))}function bearingToAzimuth(r){var e=r%360;return e<0&&(e+=360),e}function radiansToDegrees(r){var e=r%(2*Math.PI);return e*180/Math.PI}function degreesToRadians(r){var e=r%360;return e*Math.PI/180}function convertLength(r,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("length must be a positive number");return radiansToLength(lengthToRadians(r,e),t)}function convertArea(r,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("area must be a positive number");var n=areaFactors[e];if(!n)throw new Error("invalid original units");var o=areaFactors[t];if(!o)throw new Error("invalid final units");return r/n*o}function isNumber(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function isObject(r){return!!r&&r.constructor===Object}function validateBBox(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(e){if(!isNumber(e))throw new Error("bbox must only contain numbers")})}function validateId(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}const es$2=Object.freeze(Object.defineProperty({__proto__:null,areaFactors,bearingToAzimuth,convertArea,convertLength,degreesToRadians,earthRadius,factors,feature,featureCollection:featureCollection$1,geometry,geometryCollection,isNumber,isObject,lengthToDegrees,lengthToRadians,lineString,lineStrings,multiLineString,multiPoint,multiPolygon,point,points:points$1,polygon,polygons,radiansToDegrees,radiansToLength,round:round$1,unitsFactors,validateBBox,validateId},Symbol.toStringTag,{value:"Module"}));function coordEach(r,e,t){if(r!==null)for(var n,o,a,l,s,m,y,D=0,W=0,Ee,dt=r.type,Ht=dt==="FeatureCollection",ir=dt==="Feature",Hr=Ht?r.features.length:1,Bn=0;Bn<Hr;Bn++){y=Ht?r.features[Bn].geometry:ir?r.geometry:r,Ee=y?y.type==="GeometryCollection":!1,s=Ee?y.geometries.length:1;for(var Vn=0;Vn<s;Vn++){var Wr=0,ps=0;if(l=Ee?y.geometries[Vn]:y,l!==null){m=l.coordinates;var il=l.type;switch(D=t&&(il==="Polygon"||il==="MultiPolygon")?1:0,il){case null:break;case"Point":if(e(m,W,Bn,Wr,ps)===!1)return!1;W++,Wr++;break;case"LineString":case"MultiPoint":for(n=0;n<m.length;n++){if(e(m[n],W,Bn,Wr,ps)===!1)return!1;W++,il==="MultiPoint"&&Wr++}il==="LineString"&&Wr++;break;case"Polygon":case"MultiLineString":for(n=0;n<m.length;n++){for(o=0;o<m[n].length-D;o++){if(e(m[n][o],W,Bn,Wr,ps)===!1)return!1;W++}il==="MultiLineString"&&Wr++,il==="Polygon"&&ps++}il==="Polygon"&&Wr++;break;case"MultiPolygon":for(n=0;n<m.length;n++){for(ps=0,o=0;o<m[n].length;o++){for(a=0;a<m[n][o].length-D;a++){if(e(m[n][o][a],W,Bn,Wr,ps)===!1)return!1;W++}ps++}Wr++}break;case"GeometryCollection":for(n=0;n<l.geometries.length;n++)if(coordEach(l.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function coordReduce(r,e,t,n){var o=t;return coordEach(r,function(a,l,s,m,y){l===0&&t===void 0?o=a:o=e(o,a,l,s,m,y)},n),o}function propEach(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&e(r.features[t].properties,t)!==!1;t++);break;case"Feature":e(r.properties,0);break}}function propReduce(r,e,t){var n=t;return propEach(r,function(o,a){a===0&&t===void 0?n=o:n=e(n,o,a)}),n}function featureEach$1(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function featureReduce(r,e,t){var n=t;return featureEach$1(r,function(o,a){a===0&&t===void 0?n=o:n=e(n,o,a)}),n}function coordAll(r){var e=[];return coordEach(r,function(t){e.push(t)}),e}function geomEach(r,e){var t,n,o,a,l,s,m,y,D,W,Ee=0,dt=r.type==="FeatureCollection",Ht=r.type==="Feature",ir=dt?r.features.length:1;for(t=0;t<ir;t++){for(s=dt?r.features[t].geometry:Ht?r.geometry:r,y=dt?r.features[t].properties:Ht?r.properties:{},D=dt?r.features[t].bbox:Ht?r.bbox:void 0,W=dt?r.features[t].id:Ht?r.id:void 0,m=s?s.type==="GeometryCollection":!1,l=m?s.geometries.length:1,o=0;o<l;o++){if(a=m?s.geometries[o]:s,a===null){if(e(null,Ee,y,D,W)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(a,Ee,y,D,W)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<a.geometries.length;n++)if(e(a.geometries[n],Ee,y,D,W)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}Ee++}}function geomReduce(r,e,t){var n=t;return geomEach(r,function(o,a,l,s,m){a===0&&t===void 0?n=o:n=e(n,o,a,l,s,m)}),n}function flattenEach(r,e){geomEach(r,function(t,n,o,a,l){var s=t===null?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(feature(t,o,{bbox:a,id:l}),n,0)===!1?!1:void 0}var m;switch(s){case"MultiPoint":m="Point";break;case"MultiLineString":m="LineString";break;case"MultiPolygon":m="Polygon";break}for(var y=0;y<t.coordinates.length;y++){var D=t.coordinates[y],W={type:m,coordinates:D};if(e(feature(W,o),n,y)===!1)return!1}})}function flattenReduce(r,e,t){var n=t;return flattenEach(r,function(o,a,l){a===0&&l===0&&t===void 0?n=o:n=e(n,o,a,l)}),n}function segmentEach(r,e){flattenEach(r,function(t,n,o){var a=0;if(t.geometry){var l=t.geometry.type;if(!(l==="Point"||l==="MultiPoint")){var s,m=0,y=0,D=0;if(coordEach(t,function(W,Ee,dt,Ht,ir){if(s===void 0||n>m||Ht>y||ir>D){s=W,m=n,y=Ht,D=ir,a=0;return}var Hr=lineString([s,W],t.properties);if(e(Hr,n,o,ir,a)===!1)return!1;a++,s=W})===!1)return!1}}})}function segmentReduce(r,e,t){var n=t,o=!1;return segmentEach(r,function(a,l,s,m,y){o===!1&&t===void 0?n=a:n=e(n,a,l,s,m,y),o=!0}),n}function lineEach(r,e){if(!r)throw new Error("geojson is required");flattenEach(r,function(t,n,o){if(t.geometry!==null){var a=t.geometry.type,l=t.geometry.coordinates;switch(a){case"LineString":if(e(t,n,o,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<l.length;s++)if(e(lineString(l[s],t.properties),n,o,s)===!1)return!1;break}}})}function lineReduce(r,e,t){var n=t;return lineEach(r,function(o,a,l,s){a===0&&t===void 0?n=o:n=e(n,o,a,l,s)}),n}function findSegment(r,e){if(e=e||{},!isObject(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,o=e.geometryIndex||0,a=e.segmentIndex||0,l=e.properties,s;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),l=l||r.features[t].properties,s=r.features[t].geometry;break;case"Feature":l=l||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var m=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=m.length+a-1),lineString([m[a],m[a+1]],l,e);case"Polygon":return o<0&&(o=m.length+o),a<0&&(a=m[o].length+a-1),lineString([m[o][a],m[o][a+1]],l,e);case"MultiLineString":return n<0&&(n=m.length+n),a<0&&(a=m[n].length+a-1),lineString([m[n][a],m[n][a+1]],l,e);case"MultiPolygon":return n<0&&(n=m.length+n),o<0&&(o=m[n].length+o),a<0&&(a=m[n][o].length-a-1),lineString([m[n][o][a],m[n][o][a+1]],l,e)}throw new Error("geojson is invalid")}function findPoint(r,e){if(e=e||{},!isObject(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,o=e.geometryIndex||0,a=e.coordIndex||0,l=e.properties,s;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),l=l||r.features[t].properties,s=r.features[t].geometry;break;case"Feature":l=l||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var m=s.coordinates;switch(s.type){case"Point":return point(m,l,e);case"MultiPoint":return n<0&&(n=m.length+n),point(m[n],l,e);case"LineString":return a<0&&(a=m.length+a),point(m[a],l,e);case"Polygon":return o<0&&(o=m.length+o),a<0&&(a=m[o].length+a),point(m[o][a],l,e);case"MultiLineString":return n<0&&(n=m.length+n),a<0&&(a=m[n].length+a),point(m[n][a],l,e);case"MultiPolygon":return n<0&&(n=m.length+n),o<0&&(o=m[n].length+o),a<0&&(a=m[n][o].length-a),point(m[n][o][a],l,e)}throw new Error("geojson is invalid")}const es$1=Object.freeze(Object.defineProperty({__proto__:null,coordAll,coordEach,coordReduce,featureEach:featureEach$1,featureReduce,findPoint,findSegment,flattenEach,flattenReduce,geomEach,geomReduce,lineEach,lineReduce,propEach,propReduce,segmentEach,segmentReduce},Symbol.toStringTag,{value:"Module"}));function bbox$1(r){var e=[1/0,1/0,-1/0,-1/0];return coordEach(r,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}bbox$1.default=bbox$1;const es=Object.freeze(Object.defineProperty({__proto__:null,default:bbox$1},Symbol.toStringTag,{value:"Module"}));function getCoord(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function getCoords(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function getGeom(r){return r.type==="Feature"?r.geometry:r}function booleanPointInPolygon(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("point is required");if(!e)throw new Error("polygon is required");var n=getCoord(r),o=getGeom(e),a=o.type,l=e.bbox,s=o.coordinates;if(l&&inBBox(n,l)===!1)return!1;a==="Polygon"&&(s=[s]);for(var m=!1,y=0;y<s.length&&!m;y++)if(inRing(n,s[y][0],t.ignoreBoundary)){for(var D=!1,W=1;W<s[y].length&&!D;)inRing(n,s[y][W],!t.ignoreBoundary)&&(D=!0),W++;D||(m=!0)}return m}function inRing(r,e,t){var n=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var o=0,a=e.length-1;o<e.length;a=o++){var l=e[o][0],s=e[o][1],m=e[a][0],y=e[a][1],D=r[1]*(l-m)+s*(m-r[0])+y*(r[0]-l)===0&&(l-r[0])*(m-r[0])<=0&&(s-r[1])*(y-r[1])<=0;if(D)return!t;var W=s>r[1]!=y>r[1]&&r[0]<(m-l)*(r[1]-s)/(y-s)+l;W&&(n=!n)}return n}function inBBox(r,e){return e[0]<=r[0]&&e[1]<=r[1]&&e[2]>=r[0]&&e[3]>=r[1]}function distance$1(r,e,t){t===void 0&&(t={});var n=getCoord(r),o=getCoord(e),a=degreesToRadians(o[1]-n[1]),l=degreesToRadians(o[0]-n[0]),s=degreesToRadians(n[1]),m=degreesToRadians(o[1]),y=Math.pow(Math.sin(a/2),2)+Math.pow(Math.sin(l/2),2)*Math.cos(s)*Math.cos(m);return radiansToLength(2*Math.atan2(Math.sqrt(y),Math.sqrt(1-y)),t.units)}function destination(r,e,t,n){n===void 0&&(n={});var o=getCoord(r),a=degreesToRadians(o[0]),l=degreesToRadians(o[1]),s=degreesToRadians(t),m=lengthToRadians(e,n.units),y=Math.asin(Math.sin(l)*Math.cos(m)+Math.cos(l)*Math.sin(m)*Math.cos(s)),D=a+Math.atan2(Math.sin(s)*Math.sin(m)*Math.cos(l),Math.cos(m)-Math.sin(l)*Math.sin(y)),W=radiansToDegrees(D),Ee=radiansToDegrees(y);return point([W,Ee],n.properties)}function lineSegment(r){if(!r)throw new Error("geojson is required");var e=[];return flattenEach(r,function(t){lineSegmentFeature(t,e)}),featureCollection$1(e)}function lineSegmentFeature(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=getCoords(n);break;case"LineString":t=[getCoords(n)]}t.forEach(function(o){var a=createSegments(o,r.properties);a.forEach(function(l){l.id=e.length,e.push(l)})})}}function createSegments(r,e){var t=[];return r.reduce(function(n,o){var a=lineString([n,o],e);return a.bbox=bbox(n,o),t.push(a),o}),t}function bbox(r,e){var t=r[0],n=r[1],o=e[0],a=e[1],l=t<o?t:o,s=n<a?n:a,m=t>o?t:o,y=n>a?n:a;return[l,s,m,y]}var geojsonRbush$1={exports:{}},rbush_min={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(commonjsGlobal,function(){function t(Vn,Wr,ps,il,gl){(function ml(sl,ll,rl,th,nh){for(;th>rl;){if(th-rl>600){var bh=th-rl+1,Fh=ll-rl+1,Bh=Math.log(bh),Ed=.5*Math.exp(2*Bh/3),Td=.5*Math.sqrt(Bh*Ed*(bh-Ed)/bh)*(Fh-bh/2<0?-1:1),td=Math.max(rl,Math.floor(ll-Fh*Ed/bh+Td)),Fd=Math.min(th,Math.floor(ll+(bh-Fh)*Ed/bh+Td));ml(sl,ll,td,Fd,nh)}var Ld=sl[ll],Ud=rl,Xd=th;for(n(sl,rl,ll),nh(sl[th],Ld)>0&&n(sl,rl,th);Ud<Xd;){for(n(sl,Ud,Xd),Ud++,Xd--;nh(sl[Ud],Ld)<0;)Ud++;for(;nh(sl[Xd],Ld)>0;)Xd--}nh(sl[rl],Ld)===0?n(sl,rl,Xd):n(sl,++Xd,th),Xd<=ll&&(rl=Xd+1),ll<=Xd&&(th=Xd-1)}})(Vn,Wr,ps||0,il||Vn.length-1,gl||o)}function n(Vn,Wr,ps){var il=Vn[Wr];Vn[Wr]=Vn[ps],Vn[ps]=il}function o(Vn,Wr){return Vn<Wr?-1:Vn>Wr?1:0}var a=function(Vn){Vn===void 0&&(Vn=9),this._maxEntries=Math.max(4,Vn),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function l(Vn,Wr,ps){if(!ps)return Wr.indexOf(Vn);for(var il=0;il<Wr.length;il++)if(ps(Vn,Wr[il]))return il;return-1}function s(Vn,Wr){m(Vn,0,Vn.children.length,Wr,Vn)}function m(Vn,Wr,ps,il,gl){gl||(gl=Hr(null)),gl.minX=1/0,gl.minY=1/0,gl.maxX=-1/0,gl.maxY=-1/0;for(var ml=Wr;ml<ps;ml++){var sl=Vn.children[ml];y(gl,Vn.leaf?il(sl):sl)}return gl}function y(Vn,Wr){return Vn.minX=Math.min(Vn.minX,Wr.minX),Vn.minY=Math.min(Vn.minY,Wr.minY),Vn.maxX=Math.max(Vn.maxX,Wr.maxX),Vn.maxY=Math.max(Vn.maxY,Wr.maxY),Vn}function D(Vn,Wr){return Vn.minX-Wr.minX}function W(Vn,Wr){return Vn.minY-Wr.minY}function Ee(Vn){return(Vn.maxX-Vn.minX)*(Vn.maxY-Vn.minY)}function dt(Vn){return Vn.maxX-Vn.minX+(Vn.maxY-Vn.minY)}function Ht(Vn,Wr){return Vn.minX<=Wr.minX&&Vn.minY<=Wr.minY&&Wr.maxX<=Vn.maxX&&Wr.maxY<=Vn.maxY}function ir(Vn,Wr){return Wr.minX<=Vn.maxX&&Wr.minY<=Vn.maxY&&Wr.maxX>=Vn.minX&&Wr.maxY>=Vn.minY}function Hr(Vn){return{children:Vn,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Bn(Vn,Wr,ps,il,gl){for(var ml=[Wr,ps];ml.length;)if(!((ps=ml.pop())-(Wr=ml.pop())<=il)){var sl=Wr+Math.ceil((ps-Wr)/il/2)*il;t(Vn,sl,Wr,ps,gl),ml.push(Wr,sl,sl,ps)}}return a.prototype.all=function(){return this._all(this.data,[])},a.prototype.search=function(Vn){var Wr=this.data,ps=[];if(!ir(Vn,Wr))return ps;for(var il=this.toBBox,gl=[];Wr;){for(var ml=0;ml<Wr.children.length;ml++){var sl=Wr.children[ml],ll=Wr.leaf?il(sl):sl;ir(Vn,ll)&&(Wr.leaf?ps.push(sl):Ht(Vn,ll)?this._all(sl,ps):gl.push(sl))}Wr=gl.pop()}return ps},a.prototype.collides=function(Vn){var Wr=this.data;if(!ir(Vn,Wr))return!1;for(var ps=[];Wr;){for(var il=0;il<Wr.children.length;il++){var gl=Wr.children[il],ml=Wr.leaf?this.toBBox(gl):gl;if(ir(Vn,ml)){if(Wr.leaf||Ht(Vn,ml))return!0;ps.push(gl)}}Wr=ps.pop()}return!1},a.prototype.load=function(Vn){if(!Vn||!Vn.length)return this;if(Vn.length<this._minEntries){for(var Wr=0;Wr<Vn.length;Wr++)this.insert(Vn[Wr]);return this}var ps=this._build(Vn.slice(),0,Vn.length-1,0);if(this.data.children.length)if(this.data.height===ps.height)this._splitRoot(this.data,ps);else{if(this.data.height<ps.height){var il=this.data;this.data=ps,ps=il}this._insert(ps,this.data.height-ps.height-1,!0)}else this.data=ps;return this},a.prototype.insert=function(Vn){return Vn&&this._insert(Vn,this.data.height-1),this},a.prototype.clear=function(){return this.data=Hr([]),this},a.prototype.remove=function(Vn,Wr){if(!Vn)return this;for(var ps,il,gl,ml=this.data,sl=this.toBBox(Vn),ll=[],rl=[];ml||ll.length;){if(ml||(ml=ll.pop(),il=ll[ll.length-1],ps=rl.pop(),gl=!0),ml.leaf){var th=l(Vn,ml.children,Wr);if(th!==-1)return ml.children.splice(th,1),ll.push(ml),this._condense(ll),this}gl||ml.leaf||!Ht(ml,sl)?il?(ps++,ml=il.children[ps],gl=!1):ml=null:(ll.push(ml),rl.push(ps),ps=0,il=ml,ml=ml.children[0])}return this},a.prototype.toBBox=function(Vn){return Vn},a.prototype.compareMinX=function(Vn,Wr){return Vn.minX-Wr.minX},a.prototype.compareMinY=function(Vn,Wr){return Vn.minY-Wr.minY},a.prototype.toJSON=function(){return this.data},a.prototype.fromJSON=function(Vn){return this.data=Vn,this},a.prototype._all=function(Vn,Wr){for(var ps=[];Vn;)Vn.leaf?Wr.push.apply(Wr,Vn.children):ps.push.apply(ps,Vn.children),Vn=ps.pop();return Wr},a.prototype._build=function(Vn,Wr,ps,il){var gl,ml=ps-Wr+1,sl=this._maxEntries;if(ml<=sl)return s(gl=Hr(Vn.slice(Wr,ps+1)),this.toBBox),gl;il||(il=Math.ceil(Math.log(ml)/Math.log(sl)),sl=Math.ceil(ml/Math.pow(sl,il-1))),(gl=Hr([])).leaf=!1,gl.height=il;var ll=Math.ceil(ml/sl),rl=ll*Math.ceil(Math.sqrt(sl));Bn(Vn,Wr,ps,rl,this.compareMinX);for(var th=Wr;th<=ps;th+=rl){var nh=Math.min(th+rl-1,ps);Bn(Vn,th,nh,ll,this.compareMinY);for(var bh=th;bh<=nh;bh+=ll){var Fh=Math.min(bh+ll-1,nh);gl.children.push(this._build(Vn,bh,Fh,il-1))}}return s(gl,this.toBBox),gl},a.prototype._chooseSubtree=function(Vn,Wr,ps,il){for(;il.push(Wr),!Wr.leaf&&il.length-1!==ps;){for(var gl=1/0,ml=1/0,sl=void 0,ll=0;ll<Wr.children.length;ll++){var rl=Wr.children[ll],th=Ee(rl),nh=(bh=Vn,Fh=rl,(Math.max(Fh.maxX,bh.maxX)-Math.min(Fh.minX,bh.minX))*(Math.max(Fh.maxY,bh.maxY)-Math.min(Fh.minY,bh.minY))-th);nh<ml?(ml=nh,gl=th<gl?th:gl,sl=rl):nh===ml&&th<gl&&(gl=th,sl=rl)}Wr=sl||Wr.children[0]}var bh,Fh;return Wr},a.prototype._insert=function(Vn,Wr,ps){var il=ps?Vn:this.toBBox(Vn),gl=[],ml=this._chooseSubtree(il,this.data,Wr,gl);for(ml.children.push(Vn),y(ml,il);Wr>=0&&gl[Wr].children.length>this._maxEntries;)this._split(gl,Wr),Wr--;this._adjustParentBBoxes(il,gl,Wr)},a.prototype._split=function(Vn,Wr){var ps=Vn[Wr],il=ps.children.length,gl=this._minEntries;this._chooseSplitAxis(ps,gl,il);var ml=this._chooseSplitIndex(ps,gl,il),sl=Hr(ps.children.splice(ml,ps.children.length-ml));sl.height=ps.height,sl.leaf=ps.leaf,s(ps,this.toBBox),s(sl,this.toBBox),Wr?Vn[Wr-1].children.push(sl):this._splitRoot(ps,sl)},a.prototype._splitRoot=function(Vn,Wr){this.data=Hr([Vn,Wr]),this.data.height=Vn.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},a.prototype._chooseSplitIndex=function(Vn,Wr,ps){for(var il,gl,ml,sl,ll,rl,th,nh=1/0,bh=1/0,Fh=Wr;Fh<=ps-Wr;Fh++){var Bh=m(Vn,0,Fh,this.toBBox),Ed=m(Vn,Fh,ps,this.toBBox),Td=(gl=Bh,ml=Ed,sl=void 0,ll=void 0,rl=void 0,th=void 0,sl=Math.max(gl.minX,ml.minX),ll=Math.max(gl.minY,ml.minY),rl=Math.min(gl.maxX,ml.maxX),th=Math.min(gl.maxY,ml.maxY),Math.max(0,rl-sl)*Math.max(0,th-ll)),td=Ee(Bh)+Ee(Ed);Td<nh?(nh=Td,il=Fh,bh=td<bh?td:bh):Td===nh&&td<bh&&(bh=td,il=Fh)}return il||ps-Wr},a.prototype._chooseSplitAxis=function(Vn,Wr,ps){var il=Vn.leaf?this.compareMinX:D,gl=Vn.leaf?this.compareMinY:W;this._allDistMargin(Vn,Wr,ps,il)<this._allDistMargin(Vn,Wr,ps,gl)&&Vn.children.sort(il)},a.prototype._allDistMargin=function(Vn,Wr,ps,il){Vn.children.sort(il);for(var gl=this.toBBox,ml=m(Vn,0,Wr,gl),sl=m(Vn,ps-Wr,ps,gl),ll=dt(ml)+dt(sl),rl=Wr;rl<ps-Wr;rl++){var th=Vn.children[rl];y(ml,Vn.leaf?gl(th):th),ll+=dt(ml)}for(var nh=ps-Wr-1;nh>=Wr;nh--){var bh=Vn.children[nh];y(sl,Vn.leaf?gl(bh):bh),ll+=dt(sl)}return ll},a.prototype._adjustParentBBoxes=function(Vn,Wr,ps){for(var il=ps;il>=0;il--)y(Wr[il],Vn)},a.prototype._condense=function(Vn){for(var Wr=Vn.length-1,ps=void 0;Wr>=0;Wr--)Vn[Wr].children.length===0?Wr>0?(ps=Vn[Wr-1].children).splice(ps.indexOf(Vn[Wr]),1):this.clear():s(Vn[Wr],this.toBBox)},a})})(rbush_min);var rbush_minExports=rbush_min.exports;const require$$1=getAugmentedNamespace(es$2),require$$2=getAugmentedNamespace(es$1),require$$3=getAugmentedNamespace(es);var rbush=rbush_minExports,helpers=require$$1,meta=require$$2,turfBBox=require$$3.default,featureEach=meta.featureEach;meta.coordEach;helpers.polygon;var featureCollection=helpers.featureCollection;function geojsonRbush(r){var e=new rbush(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:turfBBox(t),rbush.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:turfBBox(o),n.push(o)}):featureEach(t,function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:turfBBox(o),n.push(o)}),rbush.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:turfBBox(t),rbush.prototype.remove.call(this,t,n)},e.clear=function(){return rbush.prototype.clear.call(this)},e.search=function(t){var n=rbush.prototype.search.call(this,this.toBBox(t));return featureCollection(n)},e.collides=function(t){return rbush.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=rbush.prototype.all.call(this);return featureCollection(t)},e.toJSON=function(){return rbush.prototype.toJSON.call(this)},e.fromJSON=function(t){return rbush.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=turfBBox(t);else if(t.type==="FeatureCollection")n=turfBBox(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}geojsonRbush$1.exports=geojsonRbush;geojsonRbush$1.exports.default=geojsonRbush;var geojsonRbushExports=geojsonRbush$1.exports;const rbush$1=getDefaultExportFromCjs(geojsonRbushExports);function lineIntersect(r,e){var t={},n=[];if(r.type==="LineString"&&(r=feature(r)),e.type==="LineString"&&(e=feature(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var o=intersects(r,e);return o&&n.push(o),featureCollection$1(n)}var a=rbush$1();return a.load(lineSegment(e)),featureEach$1(lineSegment(r),function(l){featureEach$1(a.search(l),function(s){var m=intersects(l,s);if(m){var y=getCoords(m).join(",");t[y]||(t[y]=!0,n.push(m))}})}),featureCollection$1(n)}function intersects(r,e){var t=getCoords(r),n=getCoords(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var o=t[0][0],a=t[0][1],l=t[1][0],s=t[1][1],m=n[0][0],y=n[0][1],D=n[1][0],W=n[1][1],Ee=(W-y)*(l-o)-(D-m)*(s-a),dt=(D-m)*(a-y)-(W-y)*(o-m),Ht=(l-o)*(a-y)-(s-a)*(o-m);if(Ee===0)return null;var ir=dt/Ee,Hr=Ht/Ee;if(ir>=0&&ir<=1&&Hr>=0&&Hr<=1){var Bn=o+ir*(l-o),Vn=a+ir*(s-a);return point([Bn,Vn])}return null}function polygonToLine(r,e){e===void 0&&(e={});var t=getGeom(r);switch(!e.properties&&r.type==="Feature"&&(e.properties=r.properties),t.type){case"Polygon":return polygonToLine$1(t,e);case"MultiPolygon":return multiPolygonToLine(t,e);default:throw new Error("invalid poly")}}function polygonToLine$1(r,e){e===void 0&&(e={});var t=getGeom(r),n=t.coordinates,o=e.properties?e.properties:r.type==="Feature"?r.properties:{};return coordsToLine(n,o)}function multiPolygonToLine(r,e){e===void 0&&(e={});var t=getGeom(r),n=t.coordinates,o=e.properties?e.properties:r.type==="Feature"?r.properties:{},a=[];return n.forEach(function(l){a.push(coordsToLine(l,o))}),featureCollection$1(a)}function coordsToLine(r,e){return r.length>1?multiLineString(r,e):lineString(r[0],e)}function booleanDisjoint(r,e){var t=!0;return flattenEach(r,function(n){flattenEach(e,function(o){if(t===!1)return!1;t=disjoint(n.geometry,o.geometry)})}),t}function disjoint(r,e){switch(r.type){case"Point":switch(e.type){case"Point":return!compareCoords(r.coordinates,e.coordinates);case"LineString":return!isPointOnLine(e,r);case"Polygon":return!booleanPointInPolygon(r,e)}break;case"LineString":switch(e.type){case"Point":return!isPointOnLine(r,e);case"LineString":return!isLineOnLine(r,e);case"Polygon":return!isLineInPoly(e,r)}break;case"Polygon":switch(e.type){case"Point":return!booleanPointInPolygon(e,r);case"LineString":return!isLineInPoly(r,e);case"Polygon":return!isPolyInPoly(e,r)}}return!1}function isPointOnLine(r,e){for(var t=0;t<r.coordinates.length-1;t++)if(isPointOnLineSegment(r.coordinates[t],r.coordinates[t+1],e.coordinates))return!0;return!1}function isLineOnLine(r,e){var t=lineIntersect(r,e);return t.features.length>0}function isLineInPoly(r,e){for(var t=0,n=e.coordinates;t<n.length;t++){var o=n[t];if(booleanPointInPolygon(o,r))return!0}var a=lineIntersect(e,polygonToLine(r));return a.features.length>0}function isPolyInPoly(r,e){for(var t=0,n=r.coordinates[0];t<n.length;t++){var o=n[t];if(booleanPointInPolygon(o,e))return!0}for(var a=0,l=e.coordinates[0];a<l.length;a++){var s=l[a];if(booleanPointInPolygon(s,r))return!0}var m=lineIntersect(polygonToLine(r),polygonToLine(e));return m.features.length>0}function isPointOnLineSegment(r,e,t){var n=t[0]-r[0],o=t[1]-r[1],a=e[0]-r[0],l=e[1]-r[1],s=n*l-o*a;return s!==0?!1:Math.abs(a)>=Math.abs(l)?a>0?r[0]<=t[0]&&t[0]<=e[0]:e[0]<=t[0]&&t[0]<=r[0]:l>0?r[1]<=t[1]&&t[1]<=e[1]:e[1]<=t[1]&&t[1]<=r[1]}function compareCoords(r,e){return r[0]===e[0]&&r[1]===e[1]}function booleanIntersects(r,e){var t=!1;return flattenEach(r,function(n){flattenEach(e,function(o){if(t===!0)return!0;t=!booleanDisjoint(n.geometry,o.geometry)})}),t}function rectangleGrid(r,e,t,n){n===void 0&&(n={});for(var o=[],a=r[0],l=r[1],s=r[2],m=r[3],y=e/distance$1([a,l],[s,l],n),D=y*(s-a),W=t/distance$1([a,l],[a,m],n),Ee=W*(m-l),dt=s-a,Ht=m-l,ir=Math.floor(dt/D),Hr=Math.floor(Ht/Ee),Bn=(dt-ir*D)/2,Vn=(Ht-Hr*Ee)/2,Wr=a+Bn,ps=0;ps<ir;ps++){for(var il=l+Vn,gl=0;gl<Hr;gl++){var ml=polygon([[[Wr,il],[Wr,il+Ee],[Wr+D,il+Ee],[Wr+D,il],[Wr,il]]],n.properties);n.mask?booleanIntersects(n.mask,ml)&&o.push(ml):o.push(ml),il+=Ee}Wr+=D}return featureCollection$1(o)}function squareGrid(r,e,t){return t===void 0&&(t={}),rectangleGrid(r,e,e,t)}class Store{constructor(e="unreal-map-bridge",t="keyval"){this.storeName=t,this._dbp=new Promise((n,o)=>{const a=indexedDB.open(e,3);a.onerror=()=>o(a.error),a.onsuccess=()=>n(a.result),a.onupgradeneeded=()=>{try{a.result.deleteObjectStore(t)}catch{}a.result.createObjectStore(t)}})}_withIDBStore(e,t){return this._dbp.then(n=>new Promise((o,a)=>{const l=n.transaction(this.storeName,e);l.oncomplete=()=>o(),l.onabort=l.onerror=()=>a(l.error),t(l.objectStore(this.storeName))}))}}let store;function getDefaultStore(){return store||(store=new Store),store}function get(r,e=getDefaultStore()){let t;return e._withIDBStore("readonly",n=>{t=n.get(r)}).then(()=>t.result)}function set(r,e,t=getDefaultStore()){return t._withIDBStore("readwrite",n=>{n.put(e,r)})}function del(r,e=getDefaultStore()){return e._withIDBStore("readwrite",t=>{t.delete(r)})}function clear(r=getDefaultStore()){return r._withIDBStore("readwrite",e=>{e.clear()})}function keys(r=getDefaultStore()){const e=[];return r._withIDBStore("readonly",t=>{(t.openKeyCursor||t.openCursor).call(t).onsuccess=function(){this.result&&(e.push(this.result.key),this.result.continue())}}).then(()=>e)}const idbKeyval={keys,clear,del,set,get};function getFileHandle(){if("showOpenFilePicker"in window)return window.showOpenFilePicker().then(r=>r[0])}function getDirHandle(){if("showDirectoryPicker"in window)return window.showDirectoryPicker().then(r=>r)}async function verifyPermission(r,e){const t={};return e&&(t.writable=!0,t.mode="readwrite"),await r.queryPermission(t)==="granted"||await r.requestPermission(t)==="granted"}async function writeFileToDisk(r,e,t){let o=await(await r.getFileHandle(e,{create:!0})).createWritable();await o.write(t),await o.close()}async function fileExists(r,e){try{return await r.getFileHandle(e),!0}catch(t){if(t.name==="NotFoundError")return!1;if(t.name==="NotAllowedError")return console.log("Please select directory to verify permissions"),!1}}async function readFileFromDisk(r,e){return await(await(await r.getFileHandle(e)).getFile()).arrayBuffer()}function checkFileApiSupport$1(){let r;return"showDirectoryPicker"in window?r=!0:r=!1,r}const fileUtils={getDirHandle,verifyPermission,writeFileToDisk,fileExists,getFileHandle,readFileFromDisk,checkFileApiSupport:checkFileApiSupport$1},scriptRel="modulepreload",assetsURL=function(r){return"/"+r},seen={},__vitePreload=function(e,t,n){if(!t||t.length===0)return e();const o=document.getElementsByTagName("link");return Promise.all(t.map(a=>{if(a=assetsURL(a),a in seen)return;seen[a]=!0;const l=a.endsWith(".css"),s=l?'[rel="stylesheet"]':"";if(!!n)for(let D=o.length-1;D>=0;D--){const W=o[D];if(W.href===a&&(!l||W.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${s}`))return;const y=document.createElement("link");if(y.rel=l?"stylesheet":scriptRel,l||(y.as="script",y.crossOrigin=""),y.href=a,document.head.appendChild(y),l)return new Promise((D,W)=>{y.addEventListener("load",D),y.addEventListener("error",()=>W(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>e()).catch(a=>{const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a})},bitMethods={getBit(r){return this.data[getSlot(r)]&1<<getShift(r)?1:0},setBit(r){this.data[getSlot(r)]|=1<<getShift(r)},clearBit(r){this.data[getSlot(r)]&=~(1<<getShift(r))},toggleBit(r){this.data[getSlot(r)]^=1<<getShift(r)},getBitXY(r,e){return r>=this.width||e>=this.height?0:this.getBit(e*this.width+r)},setBitXY(r,e){this.setBit(e*this.width+r)},clearBitXY(r,e){this.clearBit(e*this.width+r)},toggleBitXY(r,e){this.toggleBit(e*this.width+r)}};function getSlot(r){return r>>3}function getShift(r){return 7-(r&7)}function setBitMethods(r){for(const e in bitMethods)r.prototype[e]=bitMethods[e]}function checkProcessable(r,e={}){let{bitDepth:t,alpha:n,colorModel:o,components:a,channels:l}=e;if(typeof r!="string"||r.length===0)throw new TypeError("processName must be a string");if(t&&(Array.isArray(t)||(t=[t]),!t.includes(this.bitDepth)))throw new TypeError(`The process: ${r} can only be applied if bit depth is in: ${t}`);if(n&&(Array.isArray(n)||(n=[n]),!n.includes(this.alpha)))throw new TypeError(`The process: ${r} can only be applied if alpha is in: ${n}`);if(o&&(Array.isArray(o)||(o=[o]),!o.includes(this.colorModel)))throw new TypeError(`The process: ${r} can only be applied if color model is in: ${o}`);if(a&&(Array.isArray(a)||(a=[a]),!a.includes(this.components))){let s=`The process: ${r} can only be applied if the number of components is in: ${a}`;throw a.length===1&&a[0]===1?new TypeError(`${s}.\rYou should transform your image using "image.grey()" before applying the algorithm.`):new TypeError(s)}if(l&&(Array.isArray(l)||(l=[l]),!l.includes(this.channels)))throw new TypeError(`The process: ${r} can only be applied if the number of channels is in: ${l}`)}function createBlob(r,e){r=r||[],e=e||{},typeof e=="string"&&(e={type:e});try{return new Blob(r,e)}catch(a){if(a.name!=="TypeError")throw a;for(var t=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,n=new t,o=0;o<r.length;o+=1)n.append(r[o]);return n.getBlob(e.type)}}function dataURLToBlob(r){var e=r.match(/data:([^;]+)/)[1],t=r.replace(/^[^,]+,/,""),n=binaryStringToArrayBuffer(atob(t));return createBlob([n],{type:e})}function canvasToBlob(r,e,t){return typeof r.toBlob=="function"?new Promise(function(n){r.toBlob(n,e,t)}):Promise.resolve(dataURLToBlob(r.toDataURL(e,t)))}function binaryStringToArrayBuffer(r){for(var e=r.length,t=new ArrayBuffer(e),n=new Uint8Array(t),o=-1;++o<e;)n[o]=r.charCodeAt(o);return t}(function(r){if(r.TextEncoder&&r.TextDecoder)return!1;function e(n="utf-8"){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${n}') is invalid.`)}Object.defineProperty(e.prototype,"encoding",{value:"utf-8"}),e.prototype.encode=function(n,o={stream:!1}){if(o.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let a=0;const l=n.length;let s=0,m=Math.max(32,l+(l>>1)+7),y=new Uint8Array(m>>3<<3);for(;a<l;){let D=n.charCodeAt(a++);if(D>=55296&&D<=56319){if(a<l){const W=n.charCodeAt(a);(W&64512)===56320&&(++a,D=((D&1023)<<10)+(W&1023)+65536)}if(D>=55296&&D<=56319)continue}if(s+4>y.length){m+=8,m*=1+a/n.length*2,m=m>>3<<3;const W=new Uint8Array(m);W.set(y),y=W}if(D&4294967168)if(!(D&4294965248))y[s++]=D>>6&31|192;else if(!(D&4294901760))y[s++]=D>>12&15|224,y[s++]=D>>6&63|128;else if(!(D&4292870144))y[s++]=D>>18&7|240,y[s++]=D>>12&63|128,y[s++]=D>>6&63|128;else continue;else{y[s++]=D;continue}y[s++]=D&63|128}return y.slice(0,s)};function t(n="utf-8",o={fatal:!1}){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${n}') is invalid.`);if(o.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(t.prototype,"fatal",{value:!1}),Object.defineProperty(t.prototype,"ignoreBOM",{value:!1}),t.prototype.decode=function(n,o={stream:!1}){if(o.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const a=new Uint8Array(n);let l=0;const s=a.length,m=[];for(;l<s;){const y=a[l++];if(y===0)break;if(!(y&128))m.push(y);else if((y&224)===192){const D=a[l++]&63;m.push((y&31)<<6|D)}else if((y&240)===224){const D=a[l++]&63,W=a[l++]&63;m.push((y&31)<<12|D<<6|W)}else if((y&248)===240){const D=a[l++]&63,W=a[l++]&63,Ee=a[l++]&63;let dt=(y&7)<<18|D<<12|W<<6|Ee;dt>65535&&(dt-=65536,m.push(dt>>>10&1023|55296),dt=56320|dt&1023),m.push(dt)}}return String.fromCharCode.apply(null,m)},r.TextEncoder=e,r.TextDecoder=t})(typeof window<"u"?window:typeof self<"u"?self:globalThis);function decode$5(r,e="utf8"){return new TextDecoder(e).decode(r)}const encoder$1=new TextEncoder;function encode$3(r){return encoder$1.encode(r)}const defaultByteLength$1=1024*8,hostBigEndian=(()=>{const r=new Uint8Array(4),e=new Uint32Array(r.buffer);return!((e[0]=1)&r[0])})(),typedArrays={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};let IOBuffer$4=class JS{constructor(e=defaultByteLength$1,t={}){let n=!1;typeof e=="number"?e=new ArrayBuffer(e):(n=!0,this.lastWrittenByte=e.byteLength);const o=t.offset?t.offset>>>0:0,a=e.byteLength-o;let l=o;(ArrayBuffer.isView(e)||e instanceof JS)&&(e.byteLength!==e.buffer.byteLength&&(l=e.byteOffset+o),e=e.buffer),n?this.lastWrittenByte=a:this.lastWrittenByte=0,this.buffer=e,this.length=a,this.byteLength=a,this.byteOffset=l,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,l,a),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}back(e=1){return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){const n=(this.offset+e)*2,o=new Uint8Array(n);o.set(new Uint8Array(this.buffer)),this.buffer=o.buffer,this.length=this.byteLength=n,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){return this.readArray(e,"uint8")}readArray(e,t){const n=typedArrays[t].BYTES_PER_ELEMENT*e,o=this.byteOffset+this.offset,a=this.buffer.slice(o,o+n);if(this.littleEndian===hostBigEndian&&t!=="uint8"&&t!=="int8"){const s=new Uint8Array(this.buffer.slice(o,o+n));s.reverse();const m=new typedArrays[t](s.buffer);return this.offset+=n,m.reverse(),m}const l=new typedArrays[t](a);return this.offset+=n,l}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){const e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){const e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let t="";for(let n=0;n<e;n++)t+=this.readChar();return t}readUtf8(e=1){return decode$5(this.readBytes(e))}decodeText(e=1,t="utf-8"){return decode$5(this.readBytes(e),t)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}writeUtf8(e){return this.writeBytes(encode$3(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}};const IOBuffer$5=Object.freeze(Object.defineProperty({__proto__:null,IOBuffer:IOBuffer$4},Symbol.toStringTag,{value:"Module"})),require$$0$3=getAugmentedNamespace(IOBuffer$5);var constants$4={BITMAPV5HEADER:{LogicalColorSpace:{LCS_CALIBRATED_RGB:0,LCS_sRGB:1934772034,LCS_WINDOWS_COLOR_SPACE:1466527264},Compression:{BI_RGB:0,BI_RLE8:1,BI_RLE4:2,BI_BITFIELDS:3,BI_JPEG:4,BI_PNG:5,BI_CMYK:11,BI_CMYKRLE8:12,BI_CMYKRLE4:13},GamutMappingIntent:{LCS_GM_ABS_COLORIMETRIC:8,LCS_GM_BUSINESS:1,LCS_GM_GRAPHICS:2,LCS_GM_IMAGES:4}}};const{IOBuffer:IOBuffer$3}=require$$0$3,constants$3=constants$4,tableLeft=[];for(let r=0;r<=8;r++)tableLeft.push(255<<r);class BMPEncoder extends IOBuffer$3{constructor(e){if(e.bitDepth!==1)throw new Error("Only bitDepth of 1 is supported");if(!e.height||!e.width)throw new Error("ImageData width and height are required");super(e.data),this.width=e.width,this.height=e.height,this.bitDepth=e.bitDepth,this.channels=e.channels,this.components=e.components}encode(){this.encoded=new IOBuffer$3,this.encoded.skip(14),this.writeBitmapV5Header(),this.writeColorTable();const e=this.encoded.offset;return this.writePixelArray(),this.encoded.rewind(),this.writeBitmapFileHeader(e),this.encoded.toArray()}writePixelArray(){let e=this.encoded;const t=Math.floor((this.bitDepth*this.width+31)/32)*4,n=Math.ceil(this.bitDepth*this.width/8),o=t-n,a=this.bitDepth*this.width%8,l=a===0?0:8-a,s=t*this.height;let m,y,D=0,W=0,Ee=8;e.mark(),y=this.readUint8();for(let dt=this.height-1;dt>=0;dt--){const Ht=dt===0;e.reset(),e.skip(dt*t);for(let ir=0;ir<n;ir++){const Hr=ir===n-1;W<=l&&Hr?(e.writeByte(y<<W),(l===0||l===W)&&!Ht&&(m=y,y=this.readByte())):W===0?(m=y,y=this.readUint8(),e.writeByte(m)):(m=y,y=this.readUint8(),e.writeByte(m<<W&tableLeft[W]|y>>Ee)),Hr&&(D+=a||0,e.skip(o),W=D%8,Ee=8-W)}}t>n&&(e.reset(),e.skip(s-1),e.writeUint8(0))}writeColorTable(){this.encoded.writeUint32(0).writeUint32(16777215)}writeBitmapFileHeader(e){this.encoded.writeChars("BM").writeInt32(this.encoded.lastWrittenByte).writeUint16(0).writeUint16(0).writeUint32(e)}writeBitmapV5Header(){const t=Math.floor((this.bitDepth*this.width+31)/32)*4*this.height;this.encoded.writeUint32(124).writeInt32(this.width).writeInt32(this.height).writeUint16(1).writeUint16(this.bitDepth).writeUint32(constants$3.BITMAPV5HEADER.Compression.BI_RGB).writeUint32(t).writeInt32(0).writeInt32(0).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(4278190080).writeUint32(16711680).writeUint32(65280).writeUint32(255).writeUint32(constants$3.BITMAPV5HEADER.LogicalColorSpace.LCS_sRGB).skip(36).skip(12).writeUint32(constants$3.BITMAPV5HEADER.GamutMappingIntent.LCS_GM_IMAGES).skip(12)}}var BMPEncoder_1=BMPEncoder;const Encoder=BMPEncoder_1;var encode$2=function(e){return new Encoder(e).encode()};/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Z_FIXED$1=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN$1=2;function zero$1(r){let e=r.length;for(;--e>=0;)r[e]=0}const STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH$1=3,MAX_MATCH$1=258,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),extra_dbits=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),extra_blbits=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bl_order=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DIST_CODE_LEN=512,static_ltree=new Array((L_CODES$1+2)*2);zero$1(static_ltree);const static_dtree=new Array(D_CODES$1*2);zero$1(static_dtree);const _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);const _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);const base_length=new Array(LENGTH_CODES$1);zero$1(base_length);const base_dist=new Array(D_CODES$1);zero$1(base_dist);function StaticTreeDesc(r,e,t,n,o){this.static_tree=r,this.extra_bits=e,this.extra_base=t,this.elems=n,this.max_length=o,this.has_stree=r&&r.length}let static_l_desc,static_d_desc,static_bl_desc;function TreeDesc(r,e){this.dyn_tree=r,this.max_code=0,this.stat_desc=e}const d_code=r=>r<256?_dist_code[r]:_dist_code[256+(r>>>7)],put_short=(r,e)=>{r.pending_buf[r.pending++]=e&255,r.pending_buf[r.pending++]=e>>>8&255},send_bits=(r,e,t)=>{r.bi_valid>Buf_size-t?(r.bi_buf|=e<<r.bi_valid&65535,put_short(r,r.bi_buf),r.bi_buf=e>>Buf_size-r.bi_valid,r.bi_valid+=t-Buf_size):(r.bi_buf|=e<<r.bi_valid&65535,r.bi_valid+=t)},send_code=(r,e,t)=>{send_bits(r,t[e*2],t[e*2+1])},bi_reverse=(r,e)=>{let t=0;do t|=r&1,r>>>=1,t<<=1;while(--e>0);return t>>>1},bi_flush=r=>{r.bi_valid===16?(put_short(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=r.bi_buf&255,r.bi_buf>>=8,r.bi_valid-=8)},gen_bitlen=(r,e)=>{const t=e.dyn_tree,n=e.max_code,o=e.stat_desc.static_tree,a=e.stat_desc.has_stree,l=e.stat_desc.extra_bits,s=e.stat_desc.extra_base,m=e.stat_desc.max_length;let y,D,W,Ee,dt,Ht,ir=0;for(Ee=0;Ee<=MAX_BITS$1;Ee++)r.bl_count[Ee]=0;for(t[r.heap[r.heap_max]*2+1]=0,y=r.heap_max+1;y<HEAP_SIZE$1;y++)D=r.heap[y],Ee=t[t[D*2+1]*2+1]+1,Ee>m&&(Ee=m,ir++),t[D*2+1]=Ee,!(D>n)&&(r.bl_count[Ee]++,dt=0,D>=s&&(dt=l[D-s]),Ht=t[D*2],r.opt_len+=Ht*(Ee+dt),a&&(r.static_len+=Ht*(o[D*2+1]+dt)));if(ir!==0){do{for(Ee=m-1;r.bl_count[Ee]===0;)Ee--;r.bl_count[Ee]--,r.bl_count[Ee+1]+=2,r.bl_count[m]--,ir-=2}while(ir>0);for(Ee=m;Ee!==0;Ee--)for(D=r.bl_count[Ee];D!==0;)W=r.heap[--y],!(W>n)&&(t[W*2+1]!==Ee&&(r.opt_len+=(Ee-t[W*2+1])*t[W*2],t[W*2+1]=Ee),D--)}},gen_codes=(r,e,t)=>{const n=new Array(MAX_BITS$1+1);let o=0,a,l;for(a=1;a<=MAX_BITS$1;a++)o=o+t[a-1]<<1,n[a]=o;for(l=0;l<=e;l++){let s=r[l*2+1];s!==0&&(r[l*2]=bi_reverse(n[s]++,s))}},tr_static_init=()=>{let r,e,t,n,o;const a=new Array(MAX_BITS$1+1);for(t=0,n=0;n<LENGTH_CODES$1-1;n++)for(base_length[n]=t,r=0;r<1<<extra_lbits[n];r++)_length_code[t++]=n;for(_length_code[t-1]=n,o=0,n=0;n<16;n++)for(base_dist[n]=o,r=0;r<1<<extra_dbits[n];r++)_dist_code[o++]=n;for(o>>=7;n<D_CODES$1;n++)for(base_dist[n]=o<<7,r=0;r<1<<extra_dbits[n]-7;r++)_dist_code[256+o++]=n;for(e=0;e<=MAX_BITS$1;e++)a[e]=0;for(r=0;r<=143;)static_ltree[r*2+1]=8,r++,a[8]++;for(;r<=255;)static_ltree[r*2+1]=9,r++,a[9]++;for(;r<=279;)static_ltree[r*2+1]=7,r++,a[7]++;for(;r<=287;)static_ltree[r*2+1]=8,r++,a[8]++;for(gen_codes(static_ltree,L_CODES$1+1,a),r=0;r<D_CODES$1;r++)static_dtree[r*2+1]=5,static_dtree[r*2]=bi_reverse(r,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS$1+1,L_CODES$1,MAX_BITS$1),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES$1,MAX_BITS$1),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES$1,MAX_BL_BITS)},init_block=r=>{let e;for(e=0;e<L_CODES$1;e++)r.dyn_ltree[e*2]=0;for(e=0;e<D_CODES$1;e++)r.dyn_dtree[e*2]=0;for(e=0;e<BL_CODES$1;e++)r.bl_tree[e*2]=0;r.dyn_ltree[END_BLOCK*2]=1,r.opt_len=r.static_len=0,r.sym_next=r.matches=0},bi_windup=r=>{r.bi_valid>8?put_short(r,r.bi_buf):r.bi_valid>0&&(r.pending_buf[r.pending++]=r.bi_buf),r.bi_buf=0,r.bi_valid=0},smaller=(r,e,t,n)=>{const o=e*2,a=t*2;return r[o]<r[a]||r[o]===r[a]&&n[e]<=n[t]},pqdownheap=(r,e,t)=>{const n=r.heap[t];let o=t<<1;for(;o<=r.heap_len&&(o<r.heap_len&&smaller(e,r.heap[o+1],r.heap[o],r.depth)&&o++,!smaller(e,n,r.heap[o],r.depth));)r.heap[t]=r.heap[o],t=o,o<<=1;r.heap[t]=n},compress_block=(r,e,t)=>{let n,o,a=0,l,s;if(r.sym_next!==0)do n=r.pending_buf[r.sym_buf+a++]&255,n+=(r.pending_buf[r.sym_buf+a++]&255)<<8,o=r.pending_buf[r.sym_buf+a++],n===0?send_code(r,o,e):(l=_length_code[o],send_code(r,l+LITERALS$1+1,e),s=extra_lbits[l],s!==0&&(o-=base_length[l],send_bits(r,o,s)),n--,l=d_code(n),send_code(r,l,t),s=extra_dbits[l],s!==0&&(n-=base_dist[l],send_bits(r,n,s)));while(a<r.sym_next);send_code(r,END_BLOCK,e)},build_tree=(r,e)=>{const t=e.dyn_tree,n=e.stat_desc.static_tree,o=e.stat_desc.has_stree,a=e.stat_desc.elems;let l,s,m=-1,y;for(r.heap_len=0,r.heap_max=HEAP_SIZE$1,l=0;l<a;l++)t[l*2]!==0?(r.heap[++r.heap_len]=m=l,r.depth[l]=0):t[l*2+1]=0;for(;r.heap_len<2;)y=r.heap[++r.heap_len]=m<2?++m:0,t[y*2]=1,r.depth[y]=0,r.opt_len--,o&&(r.static_len-=n[y*2+1]);for(e.max_code=m,l=r.heap_len>>1;l>=1;l--)pqdownheap(r,t,l);y=a;do l=r.heap[1],r.heap[1]=r.heap[r.heap_len--],pqdownheap(r,t,1),s=r.heap[1],r.heap[--r.heap_max]=l,r.heap[--r.heap_max]=s,t[y*2]=t[l*2]+t[s*2],r.depth[y]=(r.depth[l]>=r.depth[s]?r.depth[l]:r.depth[s])+1,t[l*2+1]=t[s*2+1]=y,r.heap[1]=y++,pqdownheap(r,t,1);while(r.heap_len>=2);r.heap[--r.heap_max]=r.heap[1],gen_bitlen(r,e),gen_codes(t,m,r.bl_count)},scan_tree=(r,e,t)=>{let n,o=-1,a,l=e[0*2+1],s=0,m=7,y=4;for(l===0&&(m=138,y=3),e[(t+1)*2+1]=65535,n=0;n<=t;n++)a=l,l=e[(n+1)*2+1],!(++s<m&&a===l)&&(s<y?r.bl_tree[a*2]+=s:a!==0?(a!==o&&r.bl_tree[a*2]++,r.bl_tree[REP_3_6*2]++):s<=10?r.bl_tree[REPZ_3_10*2]++:r.bl_tree[REPZ_11_138*2]++,s=0,o=a,l===0?(m=138,y=3):a===l?(m=6,y=3):(m=7,y=4))},send_tree=(r,e,t)=>{let n,o=-1,a,l=e[0*2+1],s=0,m=7,y=4;for(l===0&&(m=138,y=3),n=0;n<=t;n++)if(a=l,l=e[(n+1)*2+1],!(++s<m&&a===l)){if(s<y)do send_code(r,a,r.bl_tree);while(--s!==0);else a!==0?(a!==o&&(send_code(r,a,r.bl_tree),s--),send_code(r,REP_3_6,r.bl_tree),send_bits(r,s-3,2)):s<=10?(send_code(r,REPZ_3_10,r.bl_tree),send_bits(r,s-3,3)):(send_code(r,REPZ_11_138,r.bl_tree),send_bits(r,s-11,7));s=0,o=a,l===0?(m=138,y=3):a===l?(m=6,y=3):(m=7,y=4)}},build_bl_tree=r=>{let e;for(scan_tree(r,r.dyn_ltree,r.l_desc.max_code),scan_tree(r,r.dyn_dtree,r.d_desc.max_code),build_tree(r,r.bl_desc),e=BL_CODES$1-1;e>=3&&r.bl_tree[bl_order[e]*2+1]===0;e--);return r.opt_len+=3*(e+1)+5+5+4,e},send_all_trees=(r,e,t,n)=>{let o;for(send_bits(r,e-257,5),send_bits(r,t-1,5),send_bits(r,n-4,4),o=0;o<n;o++)send_bits(r,r.bl_tree[bl_order[o]*2+1],3);send_tree(r,r.dyn_ltree,e-1),send_tree(r,r.dyn_dtree,t-1)},detect_data_type=r=>{let e=4093624447,t;for(t=0;t<=31;t++,e>>>=1)if(e&1&&r.dyn_ltree[t*2]!==0)return Z_BINARY;if(r.dyn_ltree[9*2]!==0||r.dyn_ltree[10*2]!==0||r.dyn_ltree[13*2]!==0)return Z_TEXT;for(t=32;t<LITERALS$1;t++)if(r.dyn_ltree[t*2]!==0)return Z_TEXT;return Z_BINARY};let static_init_done=!1;const _tr_init$1=r=>{static_init_done||(tr_static_init(),static_init_done=!0),r.l_desc=new TreeDesc(r.dyn_ltree,static_l_desc),r.d_desc=new TreeDesc(r.dyn_dtree,static_d_desc),r.bl_desc=new TreeDesc(r.bl_tree,static_bl_desc),r.bi_buf=0,r.bi_valid=0,init_block(r)},_tr_stored_block$1=(r,e,t,n)=>{send_bits(r,(STORED_BLOCK<<1)+(n?1:0),3),bi_windup(r),put_short(r,t),put_short(r,~t),t&&r.pending_buf.set(r.window.subarray(e,e+t),r.pending),r.pending+=t},_tr_align$1=r=>{send_bits(r,STATIC_TREES<<1,3),send_code(r,END_BLOCK,static_ltree),bi_flush(r)},_tr_flush_block$1=(r,e,t,n)=>{let o,a,l=0;r.level>0?(r.strm.data_type===Z_UNKNOWN$1&&(r.strm.data_type=detect_data_type(r)),build_tree(r,r.l_desc),build_tree(r,r.d_desc),l=build_bl_tree(r),o=r.opt_len+3+7>>>3,a=r.static_len+3+7>>>3,a<=o&&(o=a)):o=a=t+5,t+4<=o&&e!==-1?_tr_stored_block$1(r,e,t,n):r.strategy===Z_FIXED$1||a===o?(send_bits(r,(STATIC_TREES<<1)+(n?1:0),3),compress_block(r,static_ltree,static_dtree)):(send_bits(r,(DYN_TREES<<1)+(n?1:0),3),send_all_trees(r,r.l_desc.max_code+1,r.d_desc.max_code+1,l+1),compress_block(r,r.dyn_ltree,r.dyn_dtree)),init_block(r),n&&bi_windup(r)},_tr_tally$1=(r,e,t)=>(r.pending_buf[r.sym_buf+r.sym_next++]=e,r.pending_buf[r.sym_buf+r.sym_next++]=e>>8,r.pending_buf[r.sym_buf+r.sym_next++]=t,e===0?r.dyn_ltree[t*2]++:(r.matches++,e--,r.dyn_ltree[(_length_code[t]+LITERALS$1+1)*2]++,r.dyn_dtree[d_code(e)*2]++),r.sym_next===r.sym_end);var _tr_init_1=_tr_init$1,_tr_stored_block_1=_tr_stored_block$1,_tr_flush_block_1=_tr_flush_block$1,_tr_tally_1=_tr_tally$1,_tr_align_1=_tr_align$1,trees={_tr_init:_tr_init_1,_tr_stored_block:_tr_stored_block_1,_tr_flush_block:_tr_flush_block_1,_tr_tally:_tr_tally_1,_tr_align:_tr_align_1};const adler32=(r,e,t,n)=>{let o=r&65535|0,a=r>>>16&65535|0,l=0;for(;t!==0;){l=t>2e3?2e3:t,t-=l;do o=o+e[n++]|0,a=a+o|0;while(--l);o%=65521,a%=65521}return o|a<<16|0};var adler32_1=adler32;const makeTable=()=>{let r,e=[];for(var t=0;t<256;t++){r=t;for(var n=0;n<8;n++)r=r&1?3988292384^r>>>1:r>>>1;e[t]=r}return e},crcTable$1=new Uint32Array(makeTable()),crc32=(r,e,t,n)=>{const o=crcTable$1,a=n+t;r^=-1;for(let l=n;l<a;l++)r=r>>>8^o[(r^e[l])&255];return r^-1};var crc32_1=crc32,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},constants$2={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init,_tr_stored_block,_tr_flush_block,_tr_tally,_tr_align}=trees,{Z_NO_FLUSH:Z_NO_FLUSH$2,Z_PARTIAL_FLUSH,Z_FULL_FLUSH:Z_FULL_FLUSH$1,Z_FINISH:Z_FINISH$3,Z_BLOCK:Z_BLOCK$1,Z_OK:Z_OK$3,Z_STREAM_END:Z_STREAM_END$3,Z_STREAM_ERROR:Z_STREAM_ERROR$2,Z_DATA_ERROR:Z_DATA_ERROR$2,Z_BUF_ERROR:Z_BUF_ERROR$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$1,Z_FILTERED,Z_HUFFMAN_ONLY,Z_RLE,Z_FIXED,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$1,Z_UNKNOWN,Z_DEFLATED:Z_DEFLATED$2}=constants$2,MAX_MEM_LEVEL=9,MAX_WBITS$1=15,DEF_MEM_LEVEL=8,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,MIN_MATCH=3,MAX_MATCH=258,MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1,PRESET_DICT=32,INIT_STATE=42,GZIP_STATE=57,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,err=(r,e)=>(r.msg=messages[e],e),rank=r=>r*2-(r>4?9:0),zero=r=>{let e=r.length;for(;--e>=0;)r[e]=0},slide_hash=r=>{let e,t,n,o=r.w_size;e=r.hash_size,n=e;do t=r.head[--n],r.head[n]=t>=o?t-o:0;while(--e);e=o,n=e;do t=r.prev[--n],r.prev[n]=t>=o?t-o:0;while(--e)};let HASH_ZLIB=(r,e,t)=>(e<<r.hash_shift^t)&r.hash_mask,HASH=HASH_ZLIB;const flush_pending=r=>{const e=r.state;let t=e.pending;t>r.avail_out&&(t=r.avail_out),t!==0&&(r.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+t),r.next_out),r.next_out+=t,e.pending_out+=t,r.total_out+=t,r.avail_out-=t,e.pending-=t,e.pending===0&&(e.pending_out=0))},flush_block_only=(r,e)=>{_tr_flush_block(r,r.block_start>=0?r.block_start:-1,r.strstart-r.block_start,e),r.block_start=r.strstart,flush_pending(r.strm)},put_byte=(r,e)=>{r.pending_buf[r.pending++]=e},putShortMSB=(r,e)=>{r.pending_buf[r.pending++]=e>>>8&255,r.pending_buf[r.pending++]=e&255},read_buf=(r,e,t,n)=>{let o=r.avail_in;return o>n&&(o=n),o===0?0:(r.avail_in-=o,e.set(r.input.subarray(r.next_in,r.next_in+o),t),r.state.wrap===1?r.adler=adler32_1(r.adler,e,o,t):r.state.wrap===2&&(r.adler=crc32_1(r.adler,e,o,t)),r.next_in+=o,r.total_in+=o,o)},longest_match=(r,e)=>{let t=r.max_chain_length,n=r.strstart,o,a,l=r.prev_length,s=r.nice_match;const m=r.strstart>r.w_size-MIN_LOOKAHEAD?r.strstart-(r.w_size-MIN_LOOKAHEAD):0,y=r.window,D=r.w_mask,W=r.prev,Ee=r.strstart+MAX_MATCH;let dt=y[n+l-1],Ht=y[n+l];r.prev_length>=r.good_match&&(t>>=2),s>r.lookahead&&(s=r.lookahead);do if(o=e,!(y[o+l]!==Ht||y[o+l-1]!==dt||y[o]!==y[n]||y[++o]!==y[n+1])){n+=2,o++;do;while(y[++n]===y[++o]&&y[++n]===y[++o]&&y[++n]===y[++o]&&y[++n]===y[++o]&&y[++n]===y[++o]&&y[++n]===y[++o]&&y[++n]===y[++o]&&y[++n]===y[++o]&&n<Ee);if(a=MAX_MATCH-(Ee-n),n=Ee-MAX_MATCH,a>l){if(r.match_start=e,l=a,a>=s)break;dt=y[n+l-1],Ht=y[n+l]}}while((e=W[e&D])>m&&--t!==0);return l<=r.lookahead?l:r.lookahead},fill_window=r=>{const e=r.w_size;let t,n,o;do{if(n=r.window_size-r.lookahead-r.strstart,r.strstart>=e+(e-MIN_LOOKAHEAD)&&(r.window.set(r.window.subarray(e,e+e-n),0),r.match_start-=e,r.strstart-=e,r.block_start-=e,r.insert>r.strstart&&(r.insert=r.strstart),slide_hash(r),n+=e),r.strm.avail_in===0)break;if(t=read_buf(r.strm,r.window,r.strstart+r.lookahead,n),r.lookahead+=t,r.lookahead+r.insert>=MIN_MATCH)for(o=r.strstart-r.insert,r.ins_h=r.window[o],r.ins_h=HASH(r,r.ins_h,r.window[o+1]);r.insert&&(r.ins_h=HASH(r,r.ins_h,r.window[o+MIN_MATCH-1]),r.prev[o&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=o,o++,r.insert--,!(r.lookahead+r.insert<MIN_MATCH)););}while(r.lookahead<MIN_LOOKAHEAD&&r.strm.avail_in!==0)},deflate_stored=(r,e)=>{let t=r.pending_buf_size-5>r.w_size?r.w_size:r.pending_buf_size-5,n,o,a,l=0,s=r.strm.avail_in;do{if(n=65535,a=r.bi_valid+42>>3,r.strm.avail_out<a||(a=r.strm.avail_out-a,o=r.strstart-r.block_start,n>o+r.strm.avail_in&&(n=o+r.strm.avail_in),n>a&&(n=a),n<t&&(n===0&&e!==Z_FINISH$3||e===Z_NO_FLUSH$2||n!==o+r.strm.avail_in)))break;l=e===Z_FINISH$3&&n===o+r.strm.avail_in?1:0,_tr_stored_block(r,0,0,l),r.pending_buf[r.pending-4]=n,r.pending_buf[r.pending-3]=n>>8,r.pending_buf[r.pending-2]=~n,r.pending_buf[r.pending-1]=~n>>8,flush_pending(r.strm),o&&(o>n&&(o=n),r.strm.output.set(r.window.subarray(r.block_start,r.block_start+o),r.strm.next_out),r.strm.next_out+=o,r.strm.avail_out-=o,r.strm.total_out+=o,r.block_start+=o,n-=o),n&&(read_buf(r.strm,r.strm.output,r.strm.next_out,n),r.strm.next_out+=n,r.strm.avail_out-=n,r.strm.total_out+=n)}while(l===0);return s-=r.strm.avail_in,s&&(s>=r.w_size?(r.matches=2,r.window.set(r.strm.input.subarray(r.strm.next_in-r.w_size,r.strm.next_in),0),r.strstart=r.w_size,r.insert=r.strstart):(r.window_size-r.strstart<=s&&(r.strstart-=r.w_size,r.window.set(r.window.subarray(r.w_size,r.w_size+r.strstart),0),r.matches<2&&r.matches++,r.insert>r.strstart&&(r.insert=r.strstart)),r.window.set(r.strm.input.subarray(r.strm.next_in-s,r.strm.next_in),r.strstart),r.strstart+=s,r.insert+=s>r.w_size-r.insert?r.w_size-r.insert:s),r.block_start=r.strstart),r.high_water<r.strstart&&(r.high_water=r.strstart),l?BS_FINISH_DONE:e!==Z_NO_FLUSH$2&&e!==Z_FINISH$3&&r.strm.avail_in===0&&r.strstart===r.block_start?BS_BLOCK_DONE:(a=r.window_size-r.strstart,r.strm.avail_in>a&&r.block_start>=r.w_size&&(r.block_start-=r.w_size,r.strstart-=r.w_size,r.window.set(r.window.subarray(r.w_size,r.w_size+r.strstart),0),r.matches<2&&r.matches++,a+=r.w_size,r.insert>r.strstart&&(r.insert=r.strstart)),a>r.strm.avail_in&&(a=r.strm.avail_in),a&&(read_buf(r.strm,r.window,r.strstart,a),r.strstart+=a,r.insert+=a>r.w_size-r.insert?r.w_size-r.insert:a),r.high_water<r.strstart&&(r.high_water=r.strstart),a=r.bi_valid+42>>3,a=r.pending_buf_size-a>65535?65535:r.pending_buf_size-a,t=a>r.w_size?r.w_size:a,o=r.strstart-r.block_start,(o>=t||(o||e===Z_FINISH$3)&&e!==Z_NO_FLUSH$2&&r.strm.avail_in===0&&o<=a)&&(n=o>a?a:o,l=e===Z_FINISH$3&&r.strm.avail_in===0&&n===o?1:0,_tr_stored_block(r,r.block_start,n,l),r.block_start+=n,flush_pending(r.strm)),l?BS_FINISH_STARTED:BS_NEED_MORE)},deflate_fast=(r,e)=>{let t,n;for(;;){if(r.lookahead<MIN_LOOKAHEAD){if(fill_window(r),r.lookahead<MIN_LOOKAHEAD&&e===Z_NO_FLUSH$2)return BS_NEED_MORE;if(r.lookahead===0)break}if(t=0,r.lookahead>=MIN_MATCH&&(r.ins_h=HASH(r,r.ins_h,r.window[r.strstart+MIN_MATCH-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),t!==0&&r.strstart-t<=r.w_size-MIN_LOOKAHEAD&&(r.match_length=longest_match(r,t)),r.match_length>=MIN_MATCH)if(n=_tr_tally(r,r.strstart-r.match_start,r.match_length-MIN_MATCH),r.lookahead-=r.match_length,r.match_length<=r.max_lazy_match&&r.lookahead>=MIN_MATCH){r.match_length--;do r.strstart++,r.ins_h=HASH(r,r.ins_h,r.window[r.strstart+MIN_MATCH-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart;while(--r.match_length!==0);r.strstart++}else r.strstart+=r.match_length,r.match_length=0,r.ins_h=r.window[r.strstart],r.ins_h=HASH(r,r.ins_h,r.window[r.strstart+1]);else n=_tr_tally(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++;if(n&&(flush_block_only(r,!1),r.strm.avail_out===0))return BS_NEED_MORE}return r.insert=r.strstart<MIN_MATCH-1?r.strstart:MIN_MATCH-1,e===Z_FINISH$3?(flush_block_only(r,!0),r.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):r.sym_next&&(flush_block_only(r,!1),r.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_slow=(r,e)=>{let t,n,o;for(;;){if(r.lookahead<MIN_LOOKAHEAD){if(fill_window(r),r.lookahead<MIN_LOOKAHEAD&&e===Z_NO_FLUSH$2)return BS_NEED_MORE;if(r.lookahead===0)break}if(t=0,r.lookahead>=MIN_MATCH&&(r.ins_h=HASH(r,r.ins_h,r.window[r.strstart+MIN_MATCH-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),r.prev_length=r.match_length,r.prev_match=r.match_start,r.match_length=MIN_MATCH-1,t!==0&&r.prev_length<r.max_lazy_match&&r.strstart-t<=r.w_size-MIN_LOOKAHEAD&&(r.match_length=longest_match(r,t),r.match_length<=5&&(r.strategy===Z_FILTERED||r.match_length===MIN_MATCH&&r.strstart-r.match_start>4096)&&(r.match_length=MIN_MATCH-1)),r.prev_length>=MIN_MATCH&&r.match_length<=r.prev_length){o=r.strstart+r.lookahead-MIN_MATCH,n=_tr_tally(r,r.strstart-1-r.prev_match,r.prev_length-MIN_MATCH),r.lookahead-=r.prev_length-1,r.prev_length-=2;do++r.strstart<=o&&(r.ins_h=HASH(r,r.ins_h,r.window[r.strstart+MIN_MATCH-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart);while(--r.prev_length!==0);if(r.match_available=0,r.match_length=MIN_MATCH-1,r.strstart++,n&&(flush_block_only(r,!1),r.strm.avail_out===0))return BS_NEED_MORE}else if(r.match_available){if(n=_tr_tally(r,0,r.window[r.strstart-1]),n&&flush_block_only(r,!1),r.strstart++,r.lookahead--,r.strm.avail_out===0)return BS_NEED_MORE}else r.match_available=1,r.strstart++,r.lookahead--}return r.match_available&&(n=_tr_tally(r,0,r.window[r.strstart-1]),r.match_available=0),r.insert=r.strstart<MIN_MATCH-1?r.strstart:MIN_MATCH-1,e===Z_FINISH$3?(flush_block_only(r,!0),r.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):r.sym_next&&(flush_block_only(r,!1),r.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_rle=(r,e)=>{let t,n,o,a;const l=r.window;for(;;){if(r.lookahead<=MAX_MATCH){if(fill_window(r),r.lookahead<=MAX_MATCH&&e===Z_NO_FLUSH$2)return BS_NEED_MORE;if(r.lookahead===0)break}if(r.match_length=0,r.lookahead>=MIN_MATCH&&r.strstart>0&&(o=r.strstart-1,n=l[o],n===l[++o]&&n===l[++o]&&n===l[++o])){a=r.strstart+MAX_MATCH;do;while(n===l[++o]&&n===l[++o]&&n===l[++o]&&n===l[++o]&&n===l[++o]&&n===l[++o]&&n===l[++o]&&n===l[++o]&&o<a);r.match_length=MAX_MATCH-(a-o),r.match_length>r.lookahead&&(r.match_length=r.lookahead)}if(r.match_length>=MIN_MATCH?(t=_tr_tally(r,1,r.match_length-MIN_MATCH),r.lookahead-=r.match_length,r.strstart+=r.match_length,r.match_length=0):(t=_tr_tally(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++),t&&(flush_block_only(r,!1),r.strm.avail_out===0))return BS_NEED_MORE}return r.insert=0,e===Z_FINISH$3?(flush_block_only(r,!0),r.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):r.sym_next&&(flush_block_only(r,!1),r.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_huff=(r,e)=>{let t;for(;;){if(r.lookahead===0&&(fill_window(r),r.lookahead===0)){if(e===Z_NO_FLUSH$2)return BS_NEED_MORE;break}if(r.match_length=0,t=_tr_tally(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++,t&&(flush_block_only(r,!1),r.strm.avail_out===0))return BS_NEED_MORE}return r.insert=0,e===Z_FINISH$3?(flush_block_only(r,!0),r.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):r.sym_next&&(flush_block_only(r,!1),r.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE};function Config(r,e,t,n,o){this.good_length=r,this.max_lazy=e,this.nice_length=t,this.max_chain=n,this.func=o}const configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],lm_init=r=>{r.window_size=2*r.w_size,zero(r.head),r.max_lazy_match=configuration_table[r.level].max_lazy,r.good_match=configuration_table[r.level].good_length,r.nice_match=configuration_table[r.level].nice_length,r.max_chain_length=configuration_table[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=MIN_MATCH-1,r.match_available=0,r.ins_h=0};function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED$2,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(HEAP_SIZE*2),this.dyn_dtree=new Uint16Array((2*D_CODES+1)*2),this.bl_tree=new Uint16Array((2*BL_CODES+1)*2),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(MAX_BITS+1),this.heap=new Uint16Array(2*L_CODES+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*L_CODES+1),zero(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const deflateStateCheck=r=>{if(!r)return 1;const e=r.state;return!e||e.strm!==r||e.status!==INIT_STATE&&e.status!==GZIP_STATE&&e.status!==EXTRA_STATE&&e.status!==NAME_STATE&&e.status!==COMMENT_STATE&&e.status!==HCRC_STATE&&e.status!==BUSY_STATE&&e.status!==FINISH_STATE?1:0},deflateResetKeep=r=>{if(deflateStateCheck(r))return err(r,Z_STREAM_ERROR$2);r.total_in=r.total_out=0,r.data_type=Z_UNKNOWN;const e=r.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?GZIP_STATE:e.wrap?INIT_STATE:BUSY_STATE,r.adler=e.wrap===2?0:1,e.last_flush=-2,_tr_init(e),Z_OK$3},deflateReset=r=>{const e=deflateResetKeep(r);return e===Z_OK$3&&lm_init(r.state),e},deflateSetHeader=(r,e)=>deflateStateCheck(r)||r.state.wrap!==2?Z_STREAM_ERROR$2:(r.state.gzhead=e,Z_OK$3),deflateInit2=(r,e,t,n,o,a)=>{if(!r)return Z_STREAM_ERROR$2;let l=1;if(e===Z_DEFAULT_COMPRESSION$1&&(e=6),n<0?(l=0,n=-n):n>15&&(l=2,n-=16),o<1||o>MAX_MEM_LEVEL||t!==Z_DEFLATED$2||n<8||n>15||e<0||e>9||a<0||a>Z_FIXED||n===8&&l!==1)return err(r,Z_STREAM_ERROR$2);n===8&&(n=9);const s=new DeflateState;return r.state=s,s.strm=r,s.status=INIT_STATE,s.wrap=l,s.gzhead=null,s.w_bits=n,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=o+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+MIN_MATCH-1)/MIN_MATCH),s.window=new Uint8Array(s.w_size*2),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<o+6,s.pending_buf_size=s.lit_bufsize*4,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=(s.lit_bufsize-1)*3,s.level=e,s.strategy=a,s.method=t,deflateReset(r)},deflateInit=(r,e)=>deflateInit2(r,e,Z_DEFLATED$2,MAX_WBITS$1,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY$1),deflate$2=(r,e)=>{if(deflateStateCheck(r)||e>Z_BLOCK$1||e<0)return r?err(r,Z_STREAM_ERROR$2):Z_STREAM_ERROR$2;const t=r.state;if(!r.output||r.avail_in!==0&&!r.input||t.status===FINISH_STATE&&e!==Z_FINISH$3)return err(r,r.avail_out===0?Z_BUF_ERROR$1:Z_STREAM_ERROR$2);const n=t.last_flush;if(t.last_flush=e,t.pending!==0){if(flush_pending(r),r.avail_out===0)return t.last_flush=-1,Z_OK$3}else if(r.avail_in===0&&rank(e)<=rank(n)&&e!==Z_FINISH$3)return err(r,Z_BUF_ERROR$1);if(t.status===FINISH_STATE&&r.avail_in!==0)return err(r,Z_BUF_ERROR$1);if(t.status===INIT_STATE&&t.wrap===0&&(t.status=BUSY_STATE),t.status===INIT_STATE){let o=Z_DEFLATED$2+(t.w_bits-8<<4)<<8,a=-1;if(t.strategy>=Z_HUFFMAN_ONLY||t.level<2?a=0:t.level<6?a=1:t.level===6?a=2:a=3,o|=a<<6,t.strstart!==0&&(o|=PRESET_DICT),o+=31-o%31,putShortMSB(t,o),t.strstart!==0&&(putShortMSB(t,r.adler>>>16),putShortMSB(t,r.adler&65535)),r.adler=1,t.status=BUSY_STATE,flush_pending(r),t.pending!==0)return t.last_flush=-1,Z_OK$3}if(t.status===GZIP_STATE){if(r.adler=0,put_byte(t,31),put_byte(t,139),put_byte(t,8),t.gzhead)put_byte(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),put_byte(t,t.gzhead.time&255),put_byte(t,t.gzhead.time>>8&255),put_byte(t,t.gzhead.time>>16&255),put_byte(t,t.gzhead.time>>24&255),put_byte(t,t.level===9?2:t.strategy>=Z_HUFFMAN_ONLY||t.level<2?4:0),put_byte(t,t.gzhead.os&255),t.gzhead.extra&&t.gzhead.extra.length&&(put_byte(t,t.gzhead.extra.length&255),put_byte(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(r.adler=crc32_1(r.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=EXTRA_STATE;else if(put_byte(t,0),put_byte(t,0),put_byte(t,0),put_byte(t,0),put_byte(t,0),put_byte(t,t.level===9?2:t.strategy>=Z_HUFFMAN_ONLY||t.level<2?4:0),put_byte(t,OS_CODE),t.status=BUSY_STATE,flush_pending(r),t.pending!==0)return t.last_flush=-1,Z_OK$3}if(t.status===EXTRA_STATE){if(t.gzhead.extra){let o=t.pending,a=(t.gzhead.extra.length&65535)-t.gzindex;for(;t.pending+a>t.pending_buf_size;){let s=t.pending_buf_size-t.pending;if(t.pending_buf.set(t.gzhead.extra.subarray(t.gzindex,t.gzindex+s),t.pending),t.pending=t.pending_buf_size,t.gzhead.hcrc&&t.pending>o&&(r.adler=crc32_1(r.adler,t.pending_buf,t.pending-o,o)),t.gzindex+=s,flush_pending(r),t.pending!==0)return t.last_flush=-1,Z_OK$3;o=0,a-=s}let l=new Uint8Array(t.gzhead.extra);t.pending_buf.set(l.subarray(t.gzindex,t.gzindex+a),t.pending),t.pending+=a,t.gzhead.hcrc&&t.pending>o&&(r.adler=crc32_1(r.adler,t.pending_buf,t.pending-o,o)),t.gzindex=0}t.status=NAME_STATE}if(t.status===NAME_STATE){if(t.gzhead.name){let o=t.pending,a;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>o&&(r.adler=crc32_1(r.adler,t.pending_buf,t.pending-o,o)),flush_pending(r),t.pending!==0)return t.last_flush=-1,Z_OK$3;o=0}t.gzindex<t.gzhead.name.length?a=t.gzhead.name.charCodeAt(t.gzindex++)&255:a=0,put_byte(t,a)}while(a!==0);t.gzhead.hcrc&&t.pending>o&&(r.adler=crc32_1(r.adler,t.pending_buf,t.pending-o,o)),t.gzindex=0}t.status=COMMENT_STATE}if(t.status===COMMENT_STATE){if(t.gzhead.comment){let o=t.pending,a;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>o&&(r.adler=crc32_1(r.adler,t.pending_buf,t.pending-o,o)),flush_pending(r),t.pending!==0)return t.last_flush=-1,Z_OK$3;o=0}t.gzindex<t.gzhead.comment.length?a=t.gzhead.comment.charCodeAt(t.gzindex++)&255:a=0,put_byte(t,a)}while(a!==0);t.gzhead.hcrc&&t.pending>o&&(r.adler=crc32_1(r.adler,t.pending_buf,t.pending-o,o))}t.status=HCRC_STATE}if(t.status===HCRC_STATE){if(t.gzhead.hcrc){if(t.pending+2>t.pending_buf_size&&(flush_pending(r),t.pending!==0))return t.last_flush=-1,Z_OK$3;put_byte(t,r.adler&255),put_byte(t,r.adler>>8&255),r.adler=0}if(t.status=BUSY_STATE,flush_pending(r),t.pending!==0)return t.last_flush=-1,Z_OK$3}if(r.avail_in!==0||t.lookahead!==0||e!==Z_NO_FLUSH$2&&t.status!==FINISH_STATE){let o=t.level===0?deflate_stored(t,e):t.strategy===Z_HUFFMAN_ONLY?deflate_huff(t,e):t.strategy===Z_RLE?deflate_rle(t,e):configuration_table[t.level].func(t,e);if((o===BS_FINISH_STARTED||o===BS_FINISH_DONE)&&(t.status=FINISH_STATE),o===BS_NEED_MORE||o===BS_FINISH_STARTED)return r.avail_out===0&&(t.last_flush=-1),Z_OK$3;if(o===BS_BLOCK_DONE&&(e===Z_PARTIAL_FLUSH?_tr_align(t):e!==Z_BLOCK$1&&(_tr_stored_block(t,0,0,!1),e===Z_FULL_FLUSH$1&&(zero(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),flush_pending(r),r.avail_out===0))return t.last_flush=-1,Z_OK$3}return e!==Z_FINISH$3?Z_OK$3:t.wrap<=0?Z_STREAM_END$3:(t.wrap===2?(put_byte(t,r.adler&255),put_byte(t,r.adler>>8&255),put_byte(t,r.adler>>16&255),put_byte(t,r.adler>>24&255),put_byte(t,r.total_in&255),put_byte(t,r.total_in>>8&255),put_byte(t,r.total_in>>16&255),put_byte(t,r.total_in>>24&255)):(putShortMSB(t,r.adler>>>16),putShortMSB(t,r.adler&65535)),flush_pending(r),t.wrap>0&&(t.wrap=-t.wrap),t.pending!==0?Z_OK$3:Z_STREAM_END$3)},deflateEnd=r=>{if(deflateStateCheck(r))return Z_STREAM_ERROR$2;const e=r.state.status;return r.state=null,e===BUSY_STATE?err(r,Z_DATA_ERROR$2):Z_OK$3},deflateSetDictionary=(r,e)=>{let t=e.length;if(deflateStateCheck(r))return Z_STREAM_ERROR$2;const n=r.state,o=n.wrap;if(o===2||o===1&&n.status!==INIT_STATE||n.lookahead)return Z_STREAM_ERROR$2;if(o===1&&(r.adler=adler32_1(r.adler,e,t,0)),n.wrap=0,t>=n.w_size){o===0&&(zero(n.head),n.strstart=0,n.block_start=0,n.insert=0);let m=new Uint8Array(n.w_size);m.set(e.subarray(t-n.w_size,t),0),e=m,t=n.w_size}const a=r.avail_in,l=r.next_in,s=r.input;for(r.avail_in=t,r.next_in=0,r.input=e,fill_window(n);n.lookahead>=MIN_MATCH;){let m=n.strstart,y=n.lookahead-(MIN_MATCH-1);do n.ins_h=HASH(n,n.ins_h,n.window[m+MIN_MATCH-1]),n.prev[m&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=m,m++;while(--y);n.strstart=m,n.lookahead=MIN_MATCH-1,fill_window(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=MIN_MATCH-1,n.match_available=0,r.next_in=l,r.input=s,r.avail_in=a,n.wrap=o,Z_OK$3};var deflateInit_1=deflateInit,deflateInit2_1=deflateInit2,deflateReset_1=deflateReset,deflateResetKeep_1=deflateResetKeep,deflateSetHeader_1=deflateSetHeader,deflate_2$1=deflate$2,deflateEnd_1=deflateEnd,deflateSetDictionary_1=deflateSetDictionary,deflateInfo="pako deflate (from Nodeca project)",deflate_1$2={deflateInit:deflateInit_1,deflateInit2:deflateInit2_1,deflateReset:deflateReset_1,deflateResetKeep:deflateResetKeep_1,deflateSetHeader:deflateSetHeader_1,deflate:deflate_2$1,deflateEnd:deflateEnd_1,deflateSetDictionary:deflateSetDictionary_1,deflateInfo};const _has=(r,e)=>Object.prototype.hasOwnProperty.call(r,e);var assign=function(r){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const n in t)_has(t,n)&&(r[n]=t[n])}}return r},flattenChunks=r=>{let e=0;for(let n=0,o=r.length;n<o;n++)e+=r[n].length;const t=new Uint8Array(e);for(let n=0,o=0,a=r.length;n<a;n++){let l=r[n];t.set(l,o),o+=l.length}return t},common={assign,flattenChunks};let STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{STR_APPLY_UIA_OK=!1}const _utf8len=new Uint8Array(256);for(let r=0;r<256;r++)_utf8len[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;_utf8len[254]=_utf8len[254]=1;var string2buf=r=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(r);let e,t,n,o,a,l=r.length,s=0;for(o=0;o<l;o++)t=r.charCodeAt(o),(t&64512)===55296&&o+1<l&&(n=r.charCodeAt(o+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),o++)),s+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(s),a=0,o=0;a<s;o++)t=r.charCodeAt(o),(t&64512)===55296&&o+1<l&&(n=r.charCodeAt(o+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),o++)),t<128?e[a++]=t:t<2048?(e[a++]=192|t>>>6,e[a++]=128|t&63):t<65536?(e[a++]=224|t>>>12,e[a++]=128|t>>>6&63,e[a++]=128|t&63):(e[a++]=240|t>>>18,e[a++]=128|t>>>12&63,e[a++]=128|t>>>6&63,e[a++]=128|t&63);return e};const buf2binstring=(r,e)=>{if(e<65534&&r.subarray&&STR_APPLY_UIA_OK)return String.fromCharCode.apply(null,r.length===e?r:r.subarray(0,e));let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(r[n]);return t};var buf2string=(r,e)=>{const t=e||r.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(r.subarray(0,e));let n,o;const a=new Array(t*2);for(o=0,n=0;n<t;){let l=r[n++];if(l<128){a[o++]=l;continue}let s=_utf8len[l];if(s>4){a[o++]=65533,n+=s-1;continue}for(l&=s===2?31:s===3?15:7;s>1&&n<t;)l=l<<6|r[n++]&63,s--;if(s>1){a[o++]=65533;continue}l<65536?a[o++]=l:(l-=65536,a[o++]=55296|l>>10&1023,a[o++]=56320|l&1023)}return buf2binstring(a,o)},utf8border=(r,e)=>{e=e||r.length,e>r.length&&(e=r.length);let t=e-1;for(;t>=0&&(r[t]&192)===128;)t--;return t<0||t===0?e:t+_utf8len[r[t]]>e?t:e},strings={string2buf,buf2string,utf8border};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream=ZStream;const toString$1$1=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$1,Z_SYNC_FLUSH,Z_FULL_FLUSH,Z_FINISH:Z_FINISH$2,Z_OK:Z_OK$2,Z_STREAM_END:Z_STREAM_END$2,Z_DEFAULT_COMPRESSION,Z_DEFAULT_STRATEGY,Z_DEFLATED:Z_DEFLATED$1}=constants$2;function Deflate$1(r){this.options=common.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY},r||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let t=deflate_1$2.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(t!==Z_OK$2)throw new Error(messages[t]);if(e.header&&deflate_1$2.deflateSetHeader(this.strm,e.header),e.dictionary){let n;if(typeof e.dictionary=="string"?n=strings.string2buf(e.dictionary):toString$1$1.call(e.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(e.dictionary):n=e.dictionary,t=deflate_1$2.deflateSetDictionary(this.strm,n),t!==Z_OK$2)throw new Error(messages[t]);this._dict_set=!0}}Deflate$1.prototype.push=function(r,e){const t=this.strm,n=this.options.chunkSize;let o,a;if(this.ended)return!1;for(e===~~e?a=e:a=e===!0?Z_FINISH$2:Z_NO_FLUSH$1,typeof r=="string"?t.input=strings.string2buf(r):toString$1$1.call(r)==="[object ArrayBuffer]"?t.input=new Uint8Array(r):t.input=r,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),(a===Z_SYNC_FLUSH||a===Z_FULL_FLUSH)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(o=deflate_1$2.deflate(t,a),o===Z_STREAM_END$2)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),o=deflate_1$2.deflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===Z_OK$2;if(t.avail_out===0){this.onData(t.output);continue}if(a>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(t.avail_in===0)break}return!0};Deflate$1.prototype.onData=function(r){this.chunks.push(r)};Deflate$1.prototype.onEnd=function(r){r===Z_OK$2&&(this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};function deflate$1(r,e){const t=new Deflate$1(e);if(t.push(r,!0),t.err)throw t.msg||messages[t.err];return t.result}function deflateRaw$1(r,e){return e=e||{},e.raw=!0,deflate$1(r,e)}function gzip$1(r,e){return e=e||{},e.gzip=!0,deflate$1(r,e)}var Deflate_1$1=Deflate$1,deflate_2=deflate$1,deflateRaw_1$1=deflateRaw$1,gzip_1$1=gzip$1,constants$1=constants$2,deflate_1$1={Deflate:Deflate_1$1,deflate:deflate_2,deflateRaw:deflateRaw_1$1,gzip:gzip_1$1,constants:constants$1};const BAD$1=16209,TYPE$1=16191;var inffast=function(e,t){let n,o,a,l,s,m,y,D,W,Ee,dt,Ht,ir,Hr,Bn,Vn,Wr,ps,il,gl,ml,sl,ll,rl;const th=e.state;n=e.next_in,ll=e.input,o=n+(e.avail_in-5),a=e.next_out,rl=e.output,l=a-(t-e.avail_out),s=a+(e.avail_out-257),m=th.dmax,y=th.wsize,D=th.whave,W=th.wnext,Ee=th.window,dt=th.hold,Ht=th.bits,ir=th.lencode,Hr=th.distcode,Bn=(1<<th.lenbits)-1,Vn=(1<<th.distbits)-1;e:do{Ht<15&&(dt+=ll[n++]<<Ht,Ht+=8,dt+=ll[n++]<<Ht,Ht+=8),Wr=ir[dt&Bn];t:for(;;){if(ps=Wr>>>24,dt>>>=ps,Ht-=ps,ps=Wr>>>16&255,ps===0)rl[a++]=Wr&65535;else if(ps&16){il=Wr&65535,ps&=15,ps&&(Ht<ps&&(dt+=ll[n++]<<Ht,Ht+=8),il+=dt&(1<<ps)-1,dt>>>=ps,Ht-=ps),Ht<15&&(dt+=ll[n++]<<Ht,Ht+=8,dt+=ll[n++]<<Ht,Ht+=8),Wr=Hr[dt&Vn];i:for(;;){if(ps=Wr>>>24,dt>>>=ps,Ht-=ps,ps=Wr>>>16&255,ps&16){if(gl=Wr&65535,ps&=15,Ht<ps&&(dt+=ll[n++]<<Ht,Ht+=8,Ht<ps&&(dt+=ll[n++]<<Ht,Ht+=8)),gl+=dt&(1<<ps)-1,gl>m){e.msg="invalid distance too far back",th.mode=BAD$1;break e}if(dt>>>=ps,Ht-=ps,ps=a-l,gl>ps){if(ps=gl-ps,ps>D&&th.sane){e.msg="invalid distance too far back",th.mode=BAD$1;break e}if(ml=0,sl=Ee,W===0){if(ml+=y-ps,ps<il){il-=ps;do rl[a++]=Ee[ml++];while(--ps);ml=a-gl,sl=rl}}else if(W<ps){if(ml+=y+W-ps,ps-=W,ps<il){il-=ps;do rl[a++]=Ee[ml++];while(--ps);if(ml=0,W<il){ps=W,il-=ps;do rl[a++]=Ee[ml++];while(--ps);ml=a-gl,sl=rl}}}else if(ml+=W-ps,ps<il){il-=ps;do rl[a++]=Ee[ml++];while(--ps);ml=a-gl,sl=rl}for(;il>2;)rl[a++]=sl[ml++],rl[a++]=sl[ml++],rl[a++]=sl[ml++],il-=3;il&&(rl[a++]=sl[ml++],il>1&&(rl[a++]=sl[ml++]))}else{ml=a-gl;do rl[a++]=rl[ml++],rl[a++]=rl[ml++],rl[a++]=rl[ml++],il-=3;while(il>2);il&&(rl[a++]=rl[ml++],il>1&&(rl[a++]=rl[ml++]))}}else if(ps&64){e.msg="invalid distance code",th.mode=BAD$1;break e}else{Wr=Hr[(Wr&65535)+(dt&(1<<ps)-1)];continue i}break}}else if(ps&64)if(ps&32){th.mode=TYPE$1;break e}else{e.msg="invalid literal/length code",th.mode=BAD$1;break e}else{Wr=ir[(Wr&65535)+(dt&(1<<ps)-1)];continue t}break}}while(n<o&&a<s);il=Ht>>3,n-=il,Ht-=il<<3,dt&=(1<<Ht)-1,e.next_in=n,e.next_out=a,e.avail_in=n<o?5+(o-n):5-(n-o),e.avail_out=a<s?257+(s-a):257-(a-s),th.hold=dt,th.bits=Ht};const MAXBITS=15,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,CODES$1=0,LENS$1=1,DISTS$1=2,lbase=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lext=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dbase=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dext=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),inflate_table=(r,e,t,n,o,a,l,s)=>{const m=s.bits;let y=0,D=0,W=0,Ee=0,dt=0,Ht=0,ir=0,Hr=0,Bn=0,Vn=0,Wr,ps,il,gl,ml,sl=null,ll;const rl=new Uint16Array(MAXBITS+1),th=new Uint16Array(MAXBITS+1);let nh=null,bh,Fh,Bh;for(y=0;y<=MAXBITS;y++)rl[y]=0;for(D=0;D<n;D++)rl[e[t+D]]++;for(dt=m,Ee=MAXBITS;Ee>=1&&rl[Ee]===0;Ee--);if(dt>Ee&&(dt=Ee),Ee===0)return o[a++]=1<<24|64<<16|0,o[a++]=1<<24|64<<16|0,s.bits=1,0;for(W=1;W<Ee&&rl[W]===0;W++);for(dt<W&&(dt=W),Hr=1,y=1;y<=MAXBITS;y++)if(Hr<<=1,Hr-=rl[y],Hr<0)return-1;if(Hr>0&&(r===CODES$1||Ee!==1))return-1;for(th[1]=0,y=1;y<MAXBITS;y++)th[y+1]=th[y]+rl[y];for(D=0;D<n;D++)e[t+D]!==0&&(l[th[e[t+D]]++]=D);if(r===CODES$1?(sl=nh=l,ll=20):r===LENS$1?(sl=lbase,nh=lext,ll=257):(sl=dbase,nh=dext,ll=0),Vn=0,D=0,y=W,ml=a,Ht=dt,ir=0,il=-1,Bn=1<<dt,gl=Bn-1,r===LENS$1&&Bn>ENOUGH_LENS$1||r===DISTS$1&&Bn>ENOUGH_DISTS$1)return 1;for(;;){bh=y-ir,l[D]+1<ll?(Fh=0,Bh=l[D]):l[D]>=ll?(Fh=nh[l[D]-ll],Bh=sl[l[D]-ll]):(Fh=32+64,Bh=0),Wr=1<<y-ir,ps=1<<Ht,W=ps;do ps-=Wr,o[ml+(Vn>>ir)+ps]=bh<<24|Fh<<16|Bh|0;while(ps!==0);for(Wr=1<<y-1;Vn&Wr;)Wr>>=1;if(Wr!==0?(Vn&=Wr-1,Vn+=Wr):Vn=0,D++,--rl[y]===0){if(y===Ee)break;y=e[t+l[D]]}if(y>dt&&(Vn&gl)!==il){for(ir===0&&(ir=dt),ml+=W,Ht=y-ir,Hr=1<<Ht;Ht+ir<Ee&&(Hr-=rl[Ht+ir],!(Hr<=0));)Ht++,Hr<<=1;if(Bn+=1<<Ht,r===LENS$1&&Bn>ENOUGH_LENS$1||r===DISTS$1&&Bn>ENOUGH_DISTS$1)return 1;il=Vn&gl,o[il]=dt<<24|Ht<<16|ml-a|0}}return Vn!==0&&(o[ml+Vn]=y-ir<<24|64<<16|0),s.bits=dt,0};var inftrees=inflate_table;const CODES=0,LENS=1,DISTS=2,{Z_FINISH:Z_FINISH$1,Z_BLOCK,Z_TREES,Z_OK:Z_OK$1,Z_STREAM_END:Z_STREAM_END$1,Z_NEED_DICT:Z_NEED_DICT$1,Z_STREAM_ERROR:Z_STREAM_ERROR$1,Z_DATA_ERROR:Z_DATA_ERROR$1,Z_MEM_ERROR:Z_MEM_ERROR$1,Z_BUF_ERROR,Z_DEFLATED}=constants$2,HEAD=16180,FLAGS=16181,TIME=16182,OS=16183,EXLEN=16184,EXTRA=16185,NAME=16186,COMMENT=16187,HCRC=16188,DICTID=16189,DICT=16190,TYPE=16191,TYPEDO=16192,STORED=16193,COPY_=16194,COPY=16195,TABLE=16196,LENLENS=16197,CODELENS=16198,LEN_=16199,LEN=16200,LENEXT=16201,DIST=16202,DISTEXT=16203,MATCH=16204,LIT=16205,CHECK=16206,LENGTH=16207,DONE=16208,BAD=16209,MEM=16210,SYNC=16211,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS,zswap32=r=>(r>>>24&255)+(r>>>8&65280)+((r&65280)<<8)+((r&255)<<24);function InflateState(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const inflateStateCheck=r=>{if(!r)return 1;const e=r.state;return!e||e.strm!==r||e.mode<HEAD||e.mode>SYNC?1:0},inflateResetKeep=r=>{if(inflateStateCheck(r))return Z_STREAM_ERROR$1;const e=r.state;return r.total_in=r.total_out=e.total=0,r.msg="",e.wrap&&(r.adler=e.wrap&1),e.mode=HEAD,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(ENOUGH_LENS),e.distcode=e.distdyn=new Int32Array(ENOUGH_DISTS),e.sane=1,e.back=-1,Z_OK$1},inflateReset=r=>{if(inflateStateCheck(r))return Z_STREAM_ERROR$1;const e=r.state;return e.wsize=0,e.whave=0,e.wnext=0,inflateResetKeep(r)},inflateReset2=(r,e)=>{let t;if(inflateStateCheck(r))return Z_STREAM_ERROR$1;const n=r.state;return e<0?(t=0,e=-e):(t=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?Z_STREAM_ERROR$1:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=t,n.wbits=e,inflateReset(r))},inflateInit2=(r,e)=>{if(!r)return Z_STREAM_ERROR$1;const t=new InflateState;r.state=t,t.strm=r,t.window=null,t.mode=HEAD;const n=inflateReset2(r,e);return n!==Z_OK$1&&(r.state=null),n},inflateInit=r=>inflateInit2(r,DEF_WBITS);let virgin=!0,lenfix,distfix;const fixedtables=r=>{if(virgin){lenfix=new Int32Array(512),distfix=new Int32Array(32);let e=0;for(;e<144;)r.lens[e++]=8;for(;e<256;)r.lens[e++]=9;for(;e<280;)r.lens[e++]=7;for(;e<288;)r.lens[e++]=8;for(inftrees(LENS,r.lens,0,288,lenfix,0,r.work,{bits:9}),e=0;e<32;)r.lens[e++]=5;inftrees(DISTS,r.lens,0,32,distfix,0,r.work,{bits:5}),virgin=!1}r.lencode=lenfix,r.lenbits=9,r.distcode=distfix,r.distbits=5},updatewindow=(r,e,t,n)=>{let o;const a=r.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),n>=a.wsize?(a.window.set(e.subarray(t-a.wsize,t),0),a.wnext=0,a.whave=a.wsize):(o=a.wsize-a.wnext,o>n&&(o=n),a.window.set(e.subarray(t-n,t-n+o),a.wnext),n-=o,n?(a.window.set(e.subarray(t-n,t),0),a.wnext=n,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0},inflate$2=(r,e)=>{let t,n,o,a,l,s,m,y,D,W,Ee,dt,Ht,ir,Hr=0,Bn,Vn,Wr,ps,il,gl,ml,sl;const ll=new Uint8Array(4);let rl,th;const nh=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(inflateStateCheck(r)||!r.output||!r.input&&r.avail_in!==0)return Z_STREAM_ERROR$1;t=r.state,t.mode===TYPE&&(t.mode=TYPEDO),l=r.next_out,o=r.output,m=r.avail_out,a=r.next_in,n=r.input,s=r.avail_in,y=t.hold,D=t.bits,W=s,Ee=m,sl=Z_OK$1;e:for(;;)switch(t.mode){case HEAD:if(t.wrap===0){t.mode=TYPEDO;break}for(;D<16;){if(s===0)break e;s--,y+=n[a++]<<D,D+=8}if(t.wrap&2&&y===35615){t.wbits===0&&(t.wbits=15),t.check=0,ll[0]=y&255,ll[1]=y>>>8&255,t.check=crc32_1(t.check,ll,2,0),y=0,D=0,t.mode=FLAGS;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((y&255)<<8)+(y>>8))%31){r.msg="incorrect header check",t.mode=BAD;break}if((y&15)!==Z_DEFLATED){r.msg="unknown compression method",t.mode=BAD;break}if(y>>>=4,D-=4,ml=(y&15)+8,t.wbits===0&&(t.wbits=ml),ml>15||ml>t.wbits){r.msg="invalid window size",t.mode=BAD;break}t.dmax=1<<t.wbits,t.flags=0,r.adler=t.check=1,t.mode=y&512?DICTID:TYPE,y=0,D=0;break;case FLAGS:for(;D<16;){if(s===0)break e;s--,y+=n[a++]<<D,D+=8}if(t.flags=y,(t.flags&255)!==Z_DEFLATED){r.msg="unknown compression method",t.mode=BAD;break}if(t.flags&57344){r.msg="unknown header flags set",t.mode=BAD;break}t.head&&(t.head.text=y>>8&1),t.flags&512&&t.wrap&4&&(ll[0]=y&255,ll[1]=y>>>8&255,t.check=crc32_1(t.check,ll,2,0)),y=0,D=0,t.mode=TIME;case TIME:for(;D<32;){if(s===0)break e;s--,y+=n[a++]<<D,D+=8}t.head&&(t.head.time=y),t.flags&512&&t.wrap&4&&(ll[0]=y&255,ll[1]=y>>>8&255,ll[2]=y>>>16&255,ll[3]=y>>>24&255,t.check=crc32_1(t.check,ll,4,0)),y=0,D=0,t.mode=OS;case OS:for(;D<16;){if(s===0)break e;s--,y+=n[a++]<<D,D+=8}t.head&&(t.head.xflags=y&255,t.head.os=y>>8),t.flags&512&&t.wrap&4&&(ll[0]=y&255,ll[1]=y>>>8&255,t.check=crc32_1(t.check,ll,2,0)),y=0,D=0,t.mode=EXLEN;case EXLEN:if(t.flags&1024){for(;D<16;){if(s===0)break e;s--,y+=n[a++]<<D,D+=8}t.length=y,t.head&&(t.head.extra_len=y),t.flags&512&&t.wrap&4&&(ll[0]=y&255,ll[1]=y>>>8&255,t.check=crc32_1(t.check,ll,2,0)),y=0,D=0}else t.head&&(t.head.extra=null);t.mode=EXTRA;case EXTRA:if(t.flags&1024&&(dt=t.length,dt>s&&(dt=s),dt&&(t.head&&(ml=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(n.subarray(a,a+dt),ml)),t.flags&512&&t.wrap&4&&(t.check=crc32_1(t.check,n,dt,a)),s-=dt,a+=dt,t.length-=dt),t.length))break e;t.length=0,t.mode=NAME;case NAME:if(t.flags&2048){if(s===0)break e;dt=0;do ml=n[a+dt++],t.head&&ml&&t.length<65536&&(t.head.name+=String.fromCharCode(ml));while(ml&&dt<s);if(t.flags&512&&t.wrap&4&&(t.check=crc32_1(t.check,n,dt,a)),s-=dt,a+=dt,ml)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=COMMENT;case COMMENT:if(t.flags&4096){if(s===0)break e;dt=0;do ml=n[a+dt++],t.head&&ml&&t.length<65536&&(t.head.comment+=String.fromCharCode(ml));while(ml&&dt<s);if(t.flags&512&&t.wrap&4&&(t.check=crc32_1(t.check,n,dt,a)),s-=dt,a+=dt,ml)break e}else t.head&&(t.head.comment=null);t.mode=HCRC;case HCRC:if(t.flags&512){for(;D<16;){if(s===0)break e;s--,y+=n[a++]<<D,D+=8}if(t.wrap&4&&y!==(t.check&65535)){r.msg="header crc mismatch",t.mode=BAD;break}y=0,D=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),r.adler=t.check=0,t.mode=TYPE;break;case DICTID:for(;D<32;){if(s===0)break e;s--,y+=n[a++]<<D,D+=8}r.adler=t.check=zswap32(y),y=0,D=0,t.mode=DICT;case DICT:if(t.havedict===0)return r.next_out=l,r.avail_out=m,r.next_in=a,r.avail_in=s,t.hold=y,t.bits=D,Z_NEED_DICT$1;r.adler=t.check=1,t.mode=TYPE;case TYPE:if(e===Z_BLOCK||e===Z_TREES)break e;case TYPEDO:if(t.last){y>>>=D&7,D-=D&7,t.mode=CHECK;break}for(;D<3;){if(s===0)break e;s--,y+=n[a++]<<D,D+=8}switch(t.last=y&1,y>>>=1,D-=1,y&3){case 0:t.mode=STORED;break;case 1:if(fixedtables(t),t.mode=LEN_,e===Z_TREES){y>>>=2,D-=2;break e}break;case 2:t.mode=TABLE;break;case 3:r.msg="invalid block type",t.mode=BAD}y>>>=2,D-=2;break;case STORED:for(y>>>=D&7,D-=D&7;D<32;){if(s===0)break e;s--,y+=n[a++]<<D,D+=8}if((y&65535)!==(y>>>16^65535)){r.msg="invalid stored block lengths",t.mode=BAD;break}if(t.length=y&65535,y=0,D=0,t.mode=COPY_,e===Z_TREES)break e;case COPY_:t.mode=COPY;case COPY:if(dt=t.length,dt){if(dt>s&&(dt=s),dt>m&&(dt=m),dt===0)break e;o.set(n.subarray(a,a+dt),l),s-=dt,a+=dt,m-=dt,l+=dt,t.length-=dt;break}t.mode=TYPE;break;case TABLE:for(;D<14;){if(s===0)break e;s--,y+=n[a++]<<D,D+=8}if(t.nlen=(y&31)+257,y>>>=5,D-=5,t.ndist=(y&31)+1,y>>>=5,D-=5,t.ncode=(y&15)+4,y>>>=4,D-=4,t.nlen>286||t.ndist>30){r.msg="too many length or distance symbols",t.mode=BAD;break}t.have=0,t.mode=LENLENS;case LENLENS:for(;t.have<t.ncode;){for(;D<3;){if(s===0)break e;s--,y+=n[a++]<<D,D+=8}t.lens[nh[t.have++]]=y&7,y>>>=3,D-=3}for(;t.have<19;)t.lens[nh[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,rl={bits:t.lenbits},sl=inftrees(CODES,t.lens,0,19,t.lencode,0,t.work,rl),t.lenbits=rl.bits,sl){r.msg="invalid code lengths set",t.mode=BAD;break}t.have=0,t.mode=CODELENS;case CODELENS:for(;t.have<t.nlen+t.ndist;){for(;Hr=t.lencode[y&(1<<t.lenbits)-1],Bn=Hr>>>24,Vn=Hr>>>16&255,Wr=Hr&65535,!(Bn<=D);){if(s===0)break e;s--,y+=n[a++]<<D,D+=8}if(Wr<16)y>>>=Bn,D-=Bn,t.lens[t.have++]=Wr;else{if(Wr===16){for(th=Bn+2;D<th;){if(s===0)break e;s--,y+=n[a++]<<D,D+=8}if(y>>>=Bn,D-=Bn,t.have===0){r.msg="invalid bit length repeat",t.mode=BAD;break}ml=t.lens[t.have-1],dt=3+(y&3),y>>>=2,D-=2}else if(Wr===17){for(th=Bn+3;D<th;){if(s===0)break e;s--,y+=n[a++]<<D,D+=8}y>>>=Bn,D-=Bn,ml=0,dt=3+(y&7),y>>>=3,D-=3}else{for(th=Bn+7;D<th;){if(s===0)break e;s--,y+=n[a++]<<D,D+=8}y>>>=Bn,D-=Bn,ml=0,dt=11+(y&127),y>>>=7,D-=7}if(t.have+dt>t.nlen+t.ndist){r.msg="invalid bit length repeat",t.mode=BAD;break}for(;dt--;)t.lens[t.have++]=ml}}if(t.mode===BAD)break;if(t.lens[256]===0){r.msg="invalid code -- missing end-of-block",t.mode=BAD;break}if(t.lenbits=9,rl={bits:t.lenbits},sl=inftrees(LENS,t.lens,0,t.nlen,t.lencode,0,t.work,rl),t.lenbits=rl.bits,sl){r.msg="invalid literal/lengths set",t.mode=BAD;break}if(t.distbits=6,t.distcode=t.distdyn,rl={bits:t.distbits},sl=inftrees(DISTS,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,rl),t.distbits=rl.bits,sl){r.msg="invalid distances set",t.mode=BAD;break}if(t.mode=LEN_,e===Z_TREES)break e;case LEN_:t.mode=LEN;case LEN:if(s>=6&&m>=258){r.next_out=l,r.avail_out=m,r.next_in=a,r.avail_in=s,t.hold=y,t.bits=D,inffast(r,Ee),l=r.next_out,o=r.output,m=r.avail_out,a=r.next_in,n=r.input,s=r.avail_in,y=t.hold,D=t.bits,t.mode===TYPE&&(t.back=-1);break}for(t.back=0;Hr=t.lencode[y&(1<<t.lenbits)-1],Bn=Hr>>>24,Vn=Hr>>>16&255,Wr=Hr&65535,!(Bn<=D);){if(s===0)break e;s--,y+=n[a++]<<D,D+=8}if(Vn&&!(Vn&240)){for(ps=Bn,il=Vn,gl=Wr;Hr=t.lencode[gl+((y&(1<<ps+il)-1)>>ps)],Bn=Hr>>>24,Vn=Hr>>>16&255,Wr=Hr&65535,!(ps+Bn<=D);){if(s===0)break e;s--,y+=n[a++]<<D,D+=8}y>>>=ps,D-=ps,t.back+=ps}if(y>>>=Bn,D-=Bn,t.back+=Bn,t.length=Wr,Vn===0){t.mode=LIT;break}if(Vn&32){t.back=-1,t.mode=TYPE;break}if(Vn&64){r.msg="invalid literal/length code",t.mode=BAD;break}t.extra=Vn&15,t.mode=LENEXT;case LENEXT:if(t.extra){for(th=t.extra;D<th;){if(s===0)break e;s--,y+=n[a++]<<D,D+=8}t.length+=y&(1<<t.extra)-1,y>>>=t.extra,D-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=DIST;case DIST:for(;Hr=t.distcode[y&(1<<t.distbits)-1],Bn=Hr>>>24,Vn=Hr>>>16&255,Wr=Hr&65535,!(Bn<=D);){if(s===0)break e;s--,y+=n[a++]<<D,D+=8}if(!(Vn&240)){for(ps=Bn,il=Vn,gl=Wr;Hr=t.distcode[gl+((y&(1<<ps+il)-1)>>ps)],Bn=Hr>>>24,Vn=Hr>>>16&255,Wr=Hr&65535,!(ps+Bn<=D);){if(s===0)break e;s--,y+=n[a++]<<D,D+=8}y>>>=ps,D-=ps,t.back+=ps}if(y>>>=Bn,D-=Bn,t.back+=Bn,Vn&64){r.msg="invalid distance code",t.mode=BAD;break}t.offset=Wr,t.extra=Vn&15,t.mode=DISTEXT;case DISTEXT:if(t.extra){for(th=t.extra;D<th;){if(s===0)break e;s--,y+=n[a++]<<D,D+=8}t.offset+=y&(1<<t.extra)-1,y>>>=t.extra,D-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){r.msg="invalid distance too far back",t.mode=BAD;break}t.mode=MATCH;case MATCH:if(m===0)break e;if(dt=Ee-m,t.offset>dt){if(dt=t.offset-dt,dt>t.whave&&t.sane){r.msg="invalid distance too far back",t.mode=BAD;break}dt>t.wnext?(dt-=t.wnext,Ht=t.wsize-dt):Ht=t.wnext-dt,dt>t.length&&(dt=t.length),ir=t.window}else ir=o,Ht=l-t.offset,dt=t.length;dt>m&&(dt=m),m-=dt,t.length-=dt;do o[l++]=ir[Ht++];while(--dt);t.length===0&&(t.mode=LEN);break;case LIT:if(m===0)break e;o[l++]=t.length,m--,t.mode=LEN;break;case CHECK:if(t.wrap){for(;D<32;){if(s===0)break e;s--,y|=n[a++]<<D,D+=8}if(Ee-=m,r.total_out+=Ee,t.total+=Ee,t.wrap&4&&Ee&&(r.adler=t.check=t.flags?crc32_1(t.check,o,Ee,l-Ee):adler32_1(t.check,o,Ee,l-Ee)),Ee=m,t.wrap&4&&(t.flags?y:zswap32(y))!==t.check){r.msg="incorrect data check",t.mode=BAD;break}y=0,D=0}t.mode=LENGTH;case LENGTH:if(t.wrap&&t.flags){for(;D<32;){if(s===0)break e;s--,y+=n[a++]<<D,D+=8}if(t.wrap&4&&y!==(t.total&4294967295)){r.msg="incorrect length check",t.mode=BAD;break}y=0,D=0}t.mode=DONE;case DONE:sl=Z_STREAM_END$1;break e;case BAD:sl=Z_DATA_ERROR$1;break e;case MEM:return Z_MEM_ERROR$1;case SYNC:default:return Z_STREAM_ERROR$1}return r.next_out=l,r.avail_out=m,r.next_in=a,r.avail_in=s,t.hold=y,t.bits=D,(t.wsize||Ee!==r.avail_out&&t.mode<BAD&&(t.mode<CHECK||e!==Z_FINISH$1))&&updatewindow(r,r.output,r.next_out,Ee-r.avail_out),W-=r.avail_in,Ee-=r.avail_out,r.total_in+=W,r.total_out+=Ee,t.total+=Ee,t.wrap&4&&Ee&&(r.adler=t.check=t.flags?crc32_1(t.check,o,Ee,r.next_out-Ee):adler32_1(t.check,o,Ee,r.next_out-Ee)),r.data_type=t.bits+(t.last?64:0)+(t.mode===TYPE?128:0)+(t.mode===LEN_||t.mode===COPY_?256:0),(W===0&&Ee===0||e===Z_FINISH$1)&&sl===Z_OK$1&&(sl=Z_BUF_ERROR),sl},inflateEnd=r=>{if(inflateStateCheck(r))return Z_STREAM_ERROR$1;let e=r.state;return e.window&&(e.window=null),r.state=null,Z_OK$1},inflateGetHeader=(r,e)=>{if(inflateStateCheck(r))return Z_STREAM_ERROR$1;const t=r.state;return t.wrap&2?(t.head=e,e.done=!1,Z_OK$1):Z_STREAM_ERROR$1},inflateSetDictionary=(r,e)=>{const t=e.length;let n,o,a;return inflateStateCheck(r)||(n=r.state,n.wrap!==0&&n.mode!==DICT)?Z_STREAM_ERROR$1:n.mode===DICT&&(o=1,o=adler32_1(o,e,t,0),o!==n.check)?Z_DATA_ERROR$1:(a=updatewindow(r,e,t,t),a?(n.mode=MEM,Z_MEM_ERROR$1):(n.havedict=1,Z_OK$1))};var inflateReset_1=inflateReset,inflateReset2_1=inflateReset2,inflateResetKeep_1=inflateResetKeep,inflateInit_1=inflateInit,inflateInit2_1=inflateInit2,inflate_2$1=inflate$2,inflateEnd_1=inflateEnd,inflateGetHeader_1=inflateGetHeader,inflateSetDictionary_1=inflateSetDictionary,inflateInfo="pako inflate (from Nodeca project)",inflate_1$2={inflateReset:inflateReset_1,inflateReset2:inflateReset2_1,inflateResetKeep:inflateResetKeep_1,inflateInit:inflateInit_1,inflateInit2:inflateInit2_1,inflate:inflate_2$1,inflateEnd:inflateEnd_1,inflateGetHeader:inflateGetHeader_1,inflateSetDictionary:inflateSetDictionary_1,inflateInfo};function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader;const toString$2=Object.prototype.toString,{Z_NO_FLUSH,Z_FINISH,Z_OK,Z_STREAM_END,Z_NEED_DICT,Z_STREAM_ERROR,Z_DATA_ERROR,Z_MEM_ERROR}=constants$2;function Inflate$1(r){this.options=common.assign({chunkSize:1024*64,windowBits:15,to:""},r||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(r&&r.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let t=inflate_1$2.inflateInit2(this.strm,e.windowBits);if(t!==Z_OK)throw new Error(messages[t]);if(this.header=new gzheader,inflate_1$2.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=strings.string2buf(e.dictionary):toString$2.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=inflate_1$2.inflateSetDictionary(this.strm,e.dictionary),t!==Z_OK)))throw new Error(messages[t])}Inflate$1.prototype.push=function(r,e){const t=this.strm,n=this.options.chunkSize,o=this.options.dictionary;let a,l,s;if(this.ended)return!1;for(e===~~e?l=e:l=e===!0?Z_FINISH:Z_NO_FLUSH,toString$2.call(r)==="[object ArrayBuffer]"?t.input=new Uint8Array(r):t.input=r,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),a=inflate_1$2.inflate(t,l),a===Z_NEED_DICT&&o&&(a=inflate_1$2.inflateSetDictionary(t,o),a===Z_OK?a=inflate_1$2.inflate(t,l):a===Z_DATA_ERROR&&(a=Z_NEED_DICT));t.avail_in>0&&a===Z_STREAM_END&&t.state.wrap>0&&r[t.next_in]!==0;)inflate_1$2.inflateReset(t),a=inflate_1$2.inflate(t,l);switch(a){case Z_STREAM_ERROR:case Z_DATA_ERROR:case Z_NEED_DICT:case Z_MEM_ERROR:return this.onEnd(a),this.ended=!0,!1}if(s=t.avail_out,t.next_out&&(t.avail_out===0||a===Z_STREAM_END))if(this.options.to==="string"){let m=strings.utf8border(t.output,t.next_out),y=t.next_out-m,D=strings.buf2string(t.output,m);t.next_out=y,t.avail_out=n-y,y&&t.output.set(t.output.subarray(m,m+y),0),this.onData(D)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(a===Z_OK&&s===0)){if(a===Z_STREAM_END)return a=inflate_1$2.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};Inflate$1.prototype.onData=function(r){this.chunks.push(r)};Inflate$1.prototype.onEnd=function(r){r===Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};function inflate$1(r,e){const t=new Inflate$1(e);if(t.push(r),t.err)throw t.msg||messages[t.err];return t.result}function inflateRaw$1(r,e){return e=e||{},e.raw=!0,inflate$1(r,e)}var Inflate_1$1=Inflate$1,inflate_2=inflate$1,inflateRaw_1$1=inflateRaw$1,ungzip$1=inflate$1,constants=constants$2,inflate_1$1={Inflate:Inflate_1$1,inflate:inflate_2,inflateRaw:inflateRaw_1$1,ungzip:ungzip$1,constants};const{Deflate,deflate,deflateRaw,gzip}=deflate_1$1,{Inflate,inflate,inflateRaw,ungzip}=inflate_1$1;var deflate_1=deflate,Inflate_1=Inflate,inflate_1=inflate;const pngSignature=[137,80,78,71,13,10,26,10],crcTable=[];for(let r=0;r<256;r++){let e=r;for(let t=0;t<8;t++)e&1?e=3988292384^e>>>1:e=e>>>1;crcTable[r]=e}const initialCrc=4294967295;function updateCrc(r,e,t){let n=r;for(let o=0;o<t;o++)n=crcTable[(n^e[o])&255]^n>>>8;return n}function crc(r,e){return(updateCrc(initialCrc,r,e)^initialCrc)>>>0}var ColorType;(function(r){r[r.UNKNOWN=-1]="UNKNOWN",r[r.GREYSCALE=0]="GREYSCALE",r[r.TRUECOLOUR=2]="TRUECOLOUR",r[r.INDEXED_COLOUR=3]="INDEXED_COLOUR",r[r.GREYSCALE_ALPHA=4]="GREYSCALE_ALPHA",r[r.TRUECOLOUR_ALPHA=6]="TRUECOLOUR_ALPHA"})(ColorType||(ColorType={}));var CompressionMethod;(function(r){r[r.UNKNOWN=-1]="UNKNOWN",r[r.DEFLATE=0]="DEFLATE"})(CompressionMethod||(CompressionMethod={}));var FilterMethod;(function(r){r[r.UNKNOWN=-1]="UNKNOWN",r[r.ADAPTIVE=0]="ADAPTIVE"})(FilterMethod||(FilterMethod={}));var InterlaceMethod;(function(r){r[r.UNKNOWN=-1]="UNKNOWN",r[r.NO_INTERLACE=0]="NO_INTERLACE",r[r.ADAM7=1]="ADAM7"})(InterlaceMethod||(InterlaceMethod={}));const empty=new Uint8Array(0),NULL="\0",uint16=new Uint16Array([255]),uint8=new Uint8Array(uint16.buffer),osIsLittleEndian=uint8[0]===255;class PngDecoder extends IOBuffer$4{constructor(e,t={}){super(e);const{checkCrc:n=!1}=t;this._checkCrc=n,this._inflator=new Inflate_1,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._compressionMethod=CompressionMethod.UNKNOWN,this._filterMethod=FilterMethod.UNKNOWN,this._interlaceMethod=InterlaceMethod.UNKNOWN,this._colorType=-1,this.setBigEndian()}decode(){for(this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(let e=0;e<pngSignature.length;e++)if(this.readUint8()!==pngSignature[e])throw new Error(`wrong PNG signature. Byte at ${e} should be ${pngSignature[e]}.`)}decodeChunk(){const e=this.readUint32(),t=this.readChars(4),n=this.offset;switch(t){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(e);break;case"IDAT":this.decodeIDAT(e);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(e);break;case"iCCP":this.decodeiCCP(e);break;case"tEXt":this.decodetEXt(e);break;case"pHYs":this.decodepHYs();break;default:this.skip(e);break}if(this.offset-n!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);if(this._checkCrc){const o=this.readUint32(),a=e+4,l=crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-a-4,a),a);if(l!==o)throw new Error(`CRC mismatch for chunk ${t}. Expected ${o}, found ${l}`)}else this.skip(4)}decodeIHDR(){const e=this._png;e.width=this.readUint32(),e.height=this.readUint32(),e.depth=checkBitDepth(this.readUint8());const t=this.readUint8();this._colorType=t;let n;switch(t){case ColorType.GREYSCALE:n=1;break;case ColorType.TRUECOLOUR:n=3;break;case ColorType.INDEXED_COLOUR:n=1;break;case ColorType.GREYSCALE_ALPHA:n=2;break;case ColorType.TRUECOLOUR_ALPHA:n=4;break;default:throw new Error(`Unknown color type: ${t}`)}if(this._png.channels=n,this._compressionMethod=this.readUint8(),this._compressionMethod!==CompressionMethod.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(e){if(e%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${e}`);const t=e/3;this._hasPalette=!0;const n=[];this._palette=n;for(let o=0;o<t;o++)n.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(e){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,e)),this.skip(e)}decodetRNS(e){if(this._colorType===3){if(e>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${e} vs ${this._palette.length})`);let t=0;for(;t<e;t++){const n=this.readByte();this._palette[t].push(n)}for(;t<this._palette.length;t++)this._palette[t].push(255)}}decodeiCCP(e){let t="",n;for(;(n=this.readChar())!==NULL;)t+=n;const o=this.readUint8();if(o!==CompressionMethod.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${o}`);const a=this.readBytes(e-t.length-2);this._png.iccEmbeddedProfile={name:t,profile:inflate_1(a)}}decodetEXt(e){let t="",n;for(;(n=this.readChar())!==NULL;)t+=n;this._png.text[t]=this.readChars(e-t.length-1)}decodepHYs(){const e=this.readUint32(),t=this.readUint32(),n=this.readByte();this._png.resolution={x:e,y:t,unit:n}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const e=this._inflator.result;if(this._filterMethod!==FilterMethod.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===InterlaceMethod.NO_INTERLACE)this.decodeInterlaceNull(e);else throw new Error(`Interlace method ${this._interlaceMethod} not supported`)}decodeInterlaceNull(e){const t=this._png.height,n=this._png.channels*this._png.depth/8,o=this._png.width*n,a=new Uint8Array(this._png.height*o);let l=empty,s=0,m,y;for(let D=0;D<t;D++){switch(m=e.subarray(s+1,s+1+o),y=a.subarray(D*o,(D+1)*o),e[s]){case 0:unfilterNone(m,y,o);break;case 1:unfilterSub(m,y,o,n);break;case 2:unfilterUp(m,y,l,o);break;case 3:unfilterAverage(m,y,l,o,n);break;case 4:unfilterPaeth(m,y,l,o,n);break;default:throw new Error(`Unsupported filter: ${e[s]}`)}l=y,s+=o+1}if(this._hasPalette&&(this._png.palette=this._palette),this._png.depth===16){const D=new Uint16Array(a.buffer);if(osIsLittleEndian)for(let W=0;W<D.length;W++)D[W]=swap16(D[W]);this._png.data=D}else this._png.data=a}}function unfilterNone(r,e,t){for(let n=0;n<t;n++)e[n]=r[n]}function unfilterSub(r,e,t,n){let o=0;for(;o<n;o++)e[o]=r[o];for(;o<t;o++)e[o]=r[o]+e[o-n]&255}function unfilterUp(r,e,t,n){let o=0;if(t.length===0)for(;o<n;o++)e[o]=r[o];else for(;o<n;o++)e[o]=r[o]+t[o]&255}function unfilterAverage(r,e,t,n,o){let a=0;if(t.length===0){for(;a<o;a++)e[a]=r[a];for(;a<n;a++)e[a]=r[a]+(e[a-o]>>1)&255}else{for(;a<o;a++)e[a]=r[a]+(t[a]>>1)&255;for(;a<n;a++)e[a]=r[a]+(e[a-o]+t[a]>>1)&255}}function unfilterPaeth(r,e,t,n,o){let a=0;if(t.length===0){for(;a<o;a++)e[a]=r[a];for(;a<n;a++)e[a]=r[a]+e[a-o]&255}else{for(;a<o;a++)e[a]=r[a]+t[a]&255;for(;a<n;a++)e[a]=r[a]+paethPredictor(e[a-o],t[a],t[a-o])&255}}function paethPredictor(r,e,t){const n=r+e-t,o=Math.abs(n-r),a=Math.abs(n-e),l=Math.abs(n-t);return o<=a&&o<=l?r:a<=l?e:t}function swap16(r){return(r&255)<<8|r>>8&255}function checkBitDepth(r){if(r!==1&&r!==2&&r!==4&&r!==8&&r!==16)throw new Error(`invalid bit depth: ${r}`);return r}const defaultZlibOptions={level:3};class PngEncoder extends IOBuffer$4{constructor(e,t={}){super(),this._colorType=ColorType.UNKNOWN,this._zlibOptions=Object.assign({},defaultZlibOptions,t.zlib),this._png=this._checkData(e),this.setBigEndian()}encode(){return this.encodeSignature(),this.encodeIHDR(),this.encodeData(),this.encodeIEND(),this.toArray()}encodeSignature(){this.writeBytes(pngSignature)}encodeIHDR(){this.writeUint32(13),this.writeChars("IHDR"),this.writeUint32(this._png.width),this.writeUint32(this._png.height),this.writeByte(this._png.depth),this.writeByte(this._colorType),this.writeByte(CompressionMethod.DEFLATE),this.writeByte(FilterMethod.ADAPTIVE),this.writeByte(InterlaceMethod.NO_INTERLACE),this.writeCrc(17)}encodeIEND(){this.writeUint32(0),this.writeChars("IEND"),this.writeCrc(4)}encodeIDAT(e){this.writeUint32(e.length),this.writeChars("IDAT"),this.writeBytes(e),this.writeCrc(e.length+4)}encodeData(){const{width:e,height:t,channels:n,depth:o,data:a}=this._png,l=n*e,s=new IOBuffer$4().setBigEndian();let m=0;for(let W=0;W<t;W++)if(s.writeByte(0),o===8)m=writeDataBytes(a,s,l,m);else if(o===16)m=writeDataUint16(a,s,l,m);else throw new Error("unreachable");const y=s.toArray(),D=deflate_1(y,this._zlibOptions);this.encodeIDAT(D)}_checkData(e){const{colorType:t,channels:n,depth:o}=getColorType(e),a={width:checkInteger(e.width,"width"),height:checkInteger(e.height,"height"),channels:n,data:e.data,depth:o,text:{}};this._colorType=t;const l=a.width*a.height*n;if(a.data.length!==l)throw new RangeError(`wrong data size. Found ${a.data.length}, expected ${l}`);return a}writeCrc(e){this.writeUint32(crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-e,e),e))}}function checkInteger(r,e){if(Number.isInteger(r)&&r>0)return r;throw new TypeError(`${e} must be a positive integer`)}function getColorType(r){const{channels:e=4,depth:t=8}=r;if(e!==4&&e!==3&&e!==2&&e!==1)throw new RangeError(`unsupported number of channels: ${e}`);if(t!==8&&t!==16)throw new RangeError(`unsupported bit depth: ${t}`);const n={channels:e,depth:t,colorType:ColorType.UNKNOWN};switch(e){case 4:n.colorType=ColorType.TRUECOLOUR_ALPHA;break;case 3:n.colorType=ColorType.TRUECOLOUR;break;case 1:n.colorType=ColorType.GREYSCALE;break;case 2:n.colorType=ColorType.GREYSCALE_ALPHA;break;default:throw new Error("unsupported number of channels")}return n}function writeDataBytes(r,e,t,n){for(let o=0;o<t;o++)e.writeByte(r[n++]);return n}function writeDataUint16(r,e,t,n){for(let o=0;o<t;o++)e.writeUint16(r[n++]);return n}var ResolutionUnitSpecifier;(function(r){r[r.UNKNOWN=0]="UNKNOWN",r[r.METRE=1]="METRE"})(ResolutionUnitSpecifier||(ResolutionUnitSpecifier={}));function decodePng(r,e){return new PngDecoder(r,e).decode()}function encodePng$1(r,e){return new PngEncoder(r,e).encode()}var encoder={exports:{}};(function(r){function e(n){var o=Math.floor,a=new Array(64),l=new Array(64),s=new Array(64),m=new Array(64),y,D,W,Ee,dt=new Array(65535),Ht=new Array(65535),ir=new Array(64),Hr=new Array(64),Bn=[],Vn=0,Wr=7,ps=new Array(64),il=new Array(64),gl=new Array(64),ml=new Array(256),sl=new Array(2048),ll,rl=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],th=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],nh=[0,1,2,3,4,5,6,7,8,9,10,11],bh=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],Fh=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],Bh=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Ed=[0,1,2,3,4,5,6,7,8,9,10,11],Td=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],td=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Fd(fd){for(var Cp=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],Fp=0;Fp<64;Fp++){var _p=o((Cp[Fp]*fd+50)/100);_p<1?_p=1:_p>255&&(_p=255),a[rl[Fp]]=_p}for(var kd=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],$f=0;$f<64;$f++){var Uf=o((kd[$f]*fd+50)/100);Uf<1?Uf=1:Uf>255&&(Uf=255),l[rl[$f]]=Uf}for(var cd=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],cp=0,xp=0;xp<8;xp++)for(var Ep=0;Ep<8;Ep++)s[cp]=1/(a[rl[cp]]*cd[xp]*cd[Ep]*8),m[cp]=1/(l[rl[cp]]*cd[xp]*cd[Ep]*8),cp++}function Ld(fd,Cp){for(var Fp=0,_p=0,kd=new Array,$f=1;$f<=16;$f++){for(var Uf=1;Uf<=fd[$f];Uf++)kd[Cp[_p]]=[],kd[Cp[_p]][0]=Fp,kd[Cp[_p]][1]=$f,_p++,Fp++;Fp*=2}return kd}function Ud(){y=Ld(th,nh),D=Ld(Bh,Ed),W=Ld(bh,Fh),Ee=Ld(Td,td)}function Xd(){for(var fd=1,Cp=2,Fp=1;Fp<=15;Fp++){for(var _p=fd;_p<Cp;_p++)Ht[32767+_p]=Fp,dt[32767+_p]=[],dt[32767+_p][1]=Fp,dt[32767+_p][0]=_p;for(var kd=-(Cp-1);kd<=-fd;kd++)Ht[32767+kd]=Fp,dt[32767+kd]=[],dt[32767+kd][1]=Fp,dt[32767+kd][0]=Cp-1+kd;fd<<=1,Cp<<=1}}function wd(){for(var fd=0;fd<256;fd++)sl[fd]=19595*fd,sl[fd+256>>0]=38470*fd,sl[fd+512>>0]=7471*fd+32768,sl[fd+768>>0]=-11059*fd,sl[fd+1024>>0]=-21709*fd,sl[fd+1280>>0]=32768*fd+8421375,sl[fd+1536>>0]=-27439*fd,sl[fd+1792>>0]=-5329*fd}function zd(fd){for(var Cp=fd[0],Fp=fd[1]-1;Fp>=0;)Cp&1<<Fp&&(Vn|=1<<Wr),Fp--,Wr--,Wr<0&&(Vn==255?(Rd(255),Rd(0)):Rd(Vn),Wr=7,Vn=0)}function Rd(fd){Bn.push(fd)}function op(fd){Rd(fd>>8&255),Rd(fd&255)}function Wd(fd,Cp){var Fp,_p,kd,$f,Uf,cd,cp,xp,Ep=0,Vp,bd=8,Yd=64;for(Vp=0;Vp<bd;++Vp){Fp=fd[Ep],_p=fd[Ep+1],kd=fd[Ep+2],$f=fd[Ep+3],Uf=fd[Ep+4],cd=fd[Ep+5],cp=fd[Ep+6],xp=fd[Ep+7];var np=Fp+xp,Up=Fp-xp,Qp=_p+cp,Rp=_p-cp,ng=kd+cd,bg=kd-cd,Ih=$f+Uf,rh=$f-Uf,sh=np+Ih,oh=np-Ih,Dh=Qp+ng,$h=Qp-ng;fd[Ep]=sh+Dh,fd[Ep+4]=sh-Dh;var yl=($h+oh)*.707106781;fd[Ep+2]=oh+yl,fd[Ep+6]=oh-yl,sh=rh+bg,Dh=bg+Rp,$h=Rp+Up;var gs=(sh-$h)*.382683433,Cr=.5411961*sh+gs,fs=1.306562965*$h+gs,ul=Dh*.707106781,ih=Up+ul,ch=Up-ul;fd[Ep+5]=ch+Cr,fd[Ep+3]=ch-Cr,fd[Ep+1]=ih+fs,fd[Ep+7]=ih-fs,Ep+=8}for(Ep=0,Vp=0;Vp<bd;++Vp){Fp=fd[Ep],_p=fd[Ep+8],kd=fd[Ep+16],$f=fd[Ep+24],Uf=fd[Ep+32],cd=fd[Ep+40],cp=fd[Ep+48],xp=fd[Ep+56];var vh=Fp+xp,Th=Fp-xp,Nh=_p+cp,Qh=_p-cp,rd=kd+cd,_d=kd-cd,ip=$f+Uf,Dp=$f-Uf,qd=vh+ip,wp=vh-ip,pp=Nh+rd,Wp=Nh-rd;fd[Ep]=qd+pp,fd[Ep+32]=qd-pp;var Vf=(Wp+wp)*.707106781;fd[Ep+16]=wp+Vf,fd[Ep+48]=wp-Vf,qd=Dp+_d,pp=_d+Qh,Wp=Qh+Th;var Wf=(qd-Wp)*.382683433,dg=.5411961*qd+Wf,Jp=1.306562965*Wp+Wf,Yp=pp*.707106781,Cg=Th+Yp,o_=Th-Yp;fd[Ep+40]=o_+dg,fd[Ep+24]=o_-dg,fd[Ep+8]=Cg+Jp,fd[Ep+56]=Cg-Jp,Ep++}var Bg;for(Vp=0;Vp<Yd;++Vp)Bg=fd[Vp]*Cp[Vp],ir[Vp]=Bg>0?Bg+.5|0:Bg-.5|0;return ir}function Op(){op(65504),op(16),Rd(74),Rd(70),Rd(73),Rd(70),Rd(0),Rd(1),Rd(1),Rd(0),op(1),op(1),Rd(0),Rd(0)}function ep(fd){if(fd){op(65505),fd[0]===69&&fd[1]===120&&fd[2]===105&&fd[3]===102?op(fd.length+2):(op(fd.length+5+2),Rd(69),Rd(120),Rd(105),Rd(102),Rd(0));for(var Cp=0;Cp<fd.length;Cp++)Rd(fd[Cp])}}function zp(fd,Cp){op(65472),op(17),Rd(8),op(Cp),op(fd),Rd(3),Rd(1),Rd(17),Rd(0),Rd(2),Rd(17),Rd(1),Rd(3),Rd(17),Rd(1)}function Kd(){op(65499),op(132),Rd(0);for(var fd=0;fd<64;fd++)Rd(a[fd]);Rd(1);for(var Cp=0;Cp<64;Cp++)Rd(l[Cp])}function Ap(){op(65476),op(418),Rd(0);for(var fd=0;fd<16;fd++)Rd(th[fd+1]);for(var Cp=0;Cp<=11;Cp++)Rd(nh[Cp]);Rd(16);for(var Fp=0;Fp<16;Fp++)Rd(bh[Fp+1]);for(var _p=0;_p<=161;_p++)Rd(Fh[_p]);Rd(1);for(var kd=0;kd<16;kd++)Rd(Bh[kd+1]);for(var $f=0;$f<=11;$f++)Rd(Ed[$f]);Rd(17);for(var Uf=0;Uf<16;Uf++)Rd(Td[Uf+1]);for(var cd=0;cd<=161;cd++)Rd(td[cd])}function Ip(fd){typeof fd>"u"||fd.constructor!==Array||fd.forEach(Cp=>{if(typeof Cp=="string"){op(65534);var Fp=Cp.length;op(Fp+2);var _p;for(_p=0;_p<Fp;_p++)Rd(Cp.charCodeAt(_p))}})}function Yh(){op(65498),op(12),Rd(3),Rd(1),Rd(0),Rd(2),Rd(17),Rd(3),Rd(17),Rd(0),Rd(63),Rd(0)}function Ad(fd,Cp,Fp,_p,kd){for(var $f=kd[0],Uf=kd[240],cd,cp=16,xp=63,Ep=64,Vp=Wd(fd,Cp),bd=0;bd<Ep;++bd)Hr[rl[bd]]=Vp[bd];var Yd=Hr[0]-Fp;Fp=Hr[0],Yd==0?zd(_p[0]):(cd=32767+Yd,zd(_p[Ht[cd]]),zd(dt[cd]));for(var np=63;np>0&&Hr[np]==0;np--);if(np==0)return zd($f),Fp;for(var Up=1,Qp;Up<=np;){for(var Rp=Up;Hr[Up]==0&&Up<=np;++Up);var ng=Up-Rp;if(ng>=cp){Qp=ng>>4;for(var bg=1;bg<=Qp;++bg)zd(Uf);ng=ng&15}cd=32767+Hr[Up],zd(kd[(ng<<4)+Ht[cd]]),zd(dt[cd]),Up++}return np!=xp&&zd($f),Fp}function kp(){for(var fd=String.fromCharCode,Cp=0;Cp<256;Cp++)ml[Cp]=fd(Cp)}this.encode=function(fd,Cp){new Date().getTime(),Cp&&up(Cp),Bn=new Array,Vn=0,Wr=7,op(65496),Op(),Ip(fd.comments),ep(fd.exifBuffer),Kd(),zp(fd.width,fd.height),Ap(),Yh();var Fp=0,_p=0,kd=0;Vn=0,Wr=7,this.encode.displayName="_encode_";for(var $f=fd.data,Uf=fd.width,cd=fd.height,cp=Uf*4,xp,Ep=0,Vp,bd,Yd,np,Up,Qp,Rp,ng;Ep<cd;){for(xp=0;xp<cp;){for(np=cp*Ep+xp,Up=np,Qp=-1,Rp=0,ng=0;ng<64;ng++)Rp=ng>>3,Qp=(ng&7)*4,Up=np+Rp*cp+Qp,Ep+Rp>=cd&&(Up-=cp*(Ep+1+Rp-cd)),xp+Qp>=cp&&(Up-=xp+Qp-cp+4),Vp=$f[Up++],bd=$f[Up++],Yd=$f[Up++],ps[ng]=(sl[Vp]+sl[bd+256>>0]+sl[Yd+512>>0]>>16)-128,il[ng]=(sl[Vp+768>>0]+sl[bd+1024>>0]+sl[Yd+1280>>0]>>16)-128,gl[ng]=(sl[Vp+1280>>0]+sl[bd+1536>>0]+sl[Yd+1792>>0]>>16)-128;Fp=Ad(ps,s,Fp,y,W),_p=Ad(il,m,_p,D,Ee),kd=Ad(gl,m,kd,D,Ee),xp+=32}Ep+=8}if(Wr>=0){var bg=[];bg[1]=Wr+1,bg[0]=(1<<Wr+1)-1,zd(bg)}return op(65497),Buffer.from(Bn)};function up(fd){if(fd<=0&&(fd=1),fd>100&&(fd=100),ll!=fd){var Cp=0;fd<50?Cp=Math.floor(5e3/fd):Cp=Math.floor(200-fd*2),Fd(Cp),ll=fd}}function rp(){var fd=new Date().getTime();n||(n=50),kp(),Ud(),Xd(),wd(),up(n),new Date().getTime()-fd}rp()}r.exports=t;function t(n,o){typeof o>"u"&&(o=50);var a=new e(o),l=a.encode(n,o);return{data:l,width:n.width,height:n.height}}})(encoder);var encoderExports=encoder.exports,decoder={exports:{}};(function(r){var e=function(){var o=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),a=4017,l=799,s=3406,m=2276,y=1567,D=3784,W=5793,Ee=2896;function dt(){}function Ht(il,gl){for(var ml=0,sl=[],ll,rl,th=16;th>0&&!il[th-1];)th--;sl.push({children:[],index:0});var nh=sl[0],bh;for(ll=0;ll<th;ll++){for(rl=0;rl<il[ll];rl++){for(nh=sl.pop(),nh.children[nh.index]=gl[ml];nh.index>0;){if(sl.length===0)throw new Error("Could not recreate Huffman Table");nh=sl.pop()}for(nh.index++,sl.push(nh);sl.length<=ll;)sl.push(bh={children:[],index:0}),nh.children[nh.index]=bh.children,nh=bh;ml++}ll+1<th&&(sl.push(bh={children:[],index:0}),nh.children[nh.index]=bh.children,nh=bh)}return sl[0].children}function ir(il,gl,ml,sl,ll,rl,th,nh,bh,Fh){ml.precision,ml.samplesPerLine,ml.scanLines;var Bh=ml.mcusPerLine,Ed=ml.progressive;ml.maxH,ml.maxV;var Td=gl,td=0,Fd=0;function Ld(){if(Fd>0)return Fd--,td>>Fd&1;if(td=il[gl++],td==255){var cd=il[gl++];if(cd)throw new Error("unexpected marker: "+(td<<8|cd).toString(16))}return Fd=7,td>>>7}function Ud(cd){for(var cp=cd,xp;(xp=Ld())!==null;){if(cp=cp[xp],typeof cp=="number")return cp;if(typeof cp!="object")throw new Error("invalid huffman sequence")}return null}function Xd(cd){for(var cp=0;cd>0;){var xp=Ld();if(xp===null)return;cp=cp<<1|xp,cd--}return cp}function wd(cd){var cp=Xd(cd);return cp>=1<<cd-1?cp:cp+(-1<<cd)+1}function zd(cd,cp){var xp=Ud(cd.huffmanTableDC),Ep=xp===0?0:wd(xp);cp[0]=cd.pred+=Ep;for(var Vp=1;Vp<64;){var bd=Ud(cd.huffmanTableAC),Yd=bd&15,np=bd>>4;if(Yd===0){if(np<15)break;Vp+=16;continue}Vp+=np;var Up=o[Vp];cp[Up]=wd(Yd),Vp++}}function Rd(cd,cp){var xp=Ud(cd.huffmanTableDC),Ep=xp===0?0:wd(xp)<<bh;cp[0]=cd.pred+=Ep}function op(cd,cp){cp[0]|=Ld()<<bh}var Wd=0;function Op(cd,cp){if(Wd>0){Wd--;return}for(var xp=rl,Ep=th;xp<=Ep;){var Vp=Ud(cd.huffmanTableAC),bd=Vp&15,Yd=Vp>>4;if(bd===0){if(Yd<15){Wd=Xd(Yd)+(1<<Yd)-1;break}xp+=16;continue}xp+=Yd;var np=o[xp];cp[np]=wd(bd)*(1<<bh),xp++}}var ep=0,zp;function Kd(cd,cp){for(var xp=rl,Ep=th,Vp=0;xp<=Ep;){var bd=o[xp],Yd=cp[bd]<0?-1:1;switch(ep){case 0:var np=Ud(cd.huffmanTableAC),Up=np&15,Vp=np>>4;if(Up===0)Vp<15?(Wd=Xd(Vp)+(1<<Vp),ep=4):(Vp=16,ep=1);else{if(Up!==1)throw new Error("invalid ACn encoding");zp=wd(Up),ep=Vp?2:3}continue;case 1:case 2:cp[bd]?cp[bd]+=(Ld()<<bh)*Yd:(Vp--,Vp===0&&(ep=ep==2?3:0));break;case 3:cp[bd]?cp[bd]+=(Ld()<<bh)*Yd:(cp[bd]=zp<<bh,ep=0);break;case 4:cp[bd]&&(cp[bd]+=(Ld()<<bh)*Yd);break}xp++}ep===4&&(Wd--,Wd===0&&(ep=0))}function Ap(cd,cp,xp,Ep,Vp){var bd=xp/Bh|0,Yd=xp%Bh,np=bd*cd.v+Ep,Up=Yd*cd.h+Vp;cd.blocks[np]===void 0&&Fh.tolerantDecoding||cp(cd,cd.blocks[np][Up])}function Ip(cd,cp,xp){var Ep=xp/cd.blocksPerLine|0,Vp=xp%cd.blocksPerLine;cd.blocks[Ep]===void 0&&Fh.tolerantDecoding||cp(cd,cd.blocks[Ep][Vp])}var Yh=sl.length,Ad,kp,up,rp,fd,Cp;Ed?rl===0?Cp=nh===0?Rd:op:Cp=nh===0?Op:Kd:Cp=zd;var Fp=0,_p,kd;Yh==1?kd=sl[0].blocksPerLine*sl[0].blocksPerColumn:kd=Bh*ml.mcusPerColumn,ll||(ll=kd);for(var $f,Uf;Fp<kd;){for(kp=0;kp<Yh;kp++)sl[kp].pred=0;if(Wd=0,Yh==1)for(Ad=sl[0],fd=0;fd<ll;fd++)Ip(Ad,Cp,Fp),Fp++;else for(fd=0;fd<ll;fd++){for(kp=0;kp<Yh;kp++)for(Ad=sl[kp],$f=Ad.h,Uf=Ad.v,up=0;up<Uf;up++)for(rp=0;rp<$f;rp++)Ap(Ad,Cp,Fp,up,rp);if(Fp++,Fp===kd)break}if(Fp===kd)do{if(il[gl]===255&&il[gl+1]!==0)break;gl+=1}while(gl<il.length-2);if(Fd=0,_p=il[gl]<<8|il[gl+1],_p<65280)throw new Error("marker was not found");if(_p>=65488&&_p<=65495)gl+=2;else break}return gl-Td}function Hr(il,gl){var ml=[],sl=gl.blocksPerLine,ll=gl.blocksPerColumn,rl=sl<<3,th=new Int32Array(64),nh=new Uint8Array(64);function bh(Xd,wd,zd){var Rd=gl.quantizationTable,op,Wd,Op,ep,zp,Kd,Ap,Ip,Yh,Ad=zd,kp;for(kp=0;kp<64;kp++)Ad[kp]=Xd[kp]*Rd[kp];for(kp=0;kp<8;++kp){var up=8*kp;if(Ad[1+up]==0&&Ad[2+up]==0&&Ad[3+up]==0&&Ad[4+up]==0&&Ad[5+up]==0&&Ad[6+up]==0&&Ad[7+up]==0){Yh=W*Ad[0+up]+512>>10,Ad[0+up]=Yh,Ad[1+up]=Yh,Ad[2+up]=Yh,Ad[3+up]=Yh,Ad[4+up]=Yh,Ad[5+up]=Yh,Ad[6+up]=Yh,Ad[7+up]=Yh;continue}op=W*Ad[0+up]+128>>8,Wd=W*Ad[4+up]+128>>8,Op=Ad[2+up],ep=Ad[6+up],zp=Ee*(Ad[1+up]-Ad[7+up])+128>>8,Ip=Ee*(Ad[1+up]+Ad[7+up])+128>>8,Kd=Ad[3+up]<<4,Ap=Ad[5+up]<<4,Yh=op-Wd+1>>1,op=op+Wd+1>>1,Wd=Yh,Yh=Op*D+ep*y+128>>8,Op=Op*y-ep*D+128>>8,ep=Yh,Yh=zp-Ap+1>>1,zp=zp+Ap+1>>1,Ap=Yh,Yh=Ip+Kd+1>>1,Kd=Ip-Kd+1>>1,Ip=Yh,Yh=op-ep+1>>1,op=op+ep+1>>1,ep=Yh,Yh=Wd-Op+1>>1,Wd=Wd+Op+1>>1,Op=Yh,Yh=zp*m+Ip*s+2048>>12,zp=zp*s-Ip*m+2048>>12,Ip=Yh,Yh=Kd*l+Ap*a+2048>>12,Kd=Kd*a-Ap*l+2048>>12,Ap=Yh,Ad[0+up]=op+Ip,Ad[7+up]=op-Ip,Ad[1+up]=Wd+Ap,Ad[6+up]=Wd-Ap,Ad[2+up]=Op+Kd,Ad[5+up]=Op-Kd,Ad[3+up]=ep+zp,Ad[4+up]=ep-zp}for(kp=0;kp<8;++kp){var rp=kp;if(Ad[8+rp]==0&&Ad[16+rp]==0&&Ad[24+rp]==0&&Ad[32+rp]==0&&Ad[40+rp]==0&&Ad[48+rp]==0&&Ad[56+rp]==0){Yh=W*zd[kp+0]+8192>>14,Ad[0+rp]=Yh,Ad[8+rp]=Yh,Ad[16+rp]=Yh,Ad[24+rp]=Yh,Ad[32+rp]=Yh,Ad[40+rp]=Yh,Ad[48+rp]=Yh,Ad[56+rp]=Yh;continue}op=W*Ad[0+rp]+2048>>12,Wd=W*Ad[32+rp]+2048>>12,Op=Ad[16+rp],ep=Ad[48+rp],zp=Ee*(Ad[8+rp]-Ad[56+rp])+2048>>12,Ip=Ee*(Ad[8+rp]+Ad[56+rp])+2048>>12,Kd=Ad[24+rp],Ap=Ad[40+rp],Yh=op-Wd+1>>1,op=op+Wd+1>>1,Wd=Yh,Yh=Op*D+ep*y+2048>>12,Op=Op*y-ep*D+2048>>12,ep=Yh,Yh=zp-Ap+1>>1,zp=zp+Ap+1>>1,Ap=Yh,Yh=Ip+Kd+1>>1,Kd=Ip-Kd+1>>1,Ip=Yh,Yh=op-ep+1>>1,op=op+ep+1>>1,ep=Yh,Yh=Wd-Op+1>>1,Wd=Wd+Op+1>>1,Op=Yh,Yh=zp*m+Ip*s+2048>>12,zp=zp*s-Ip*m+2048>>12,Ip=Yh,Yh=Kd*l+Ap*a+2048>>12,Kd=Kd*a-Ap*l+2048>>12,Ap=Yh,Ad[0+rp]=op+Ip,Ad[56+rp]=op-Ip,Ad[8+rp]=Wd+Ap,Ad[48+rp]=Wd-Ap,Ad[16+rp]=Op+Kd,Ad[40+rp]=Op-Kd,Ad[24+rp]=ep+zp,Ad[32+rp]=ep-zp}for(kp=0;kp<64;++kp){var fd=128+(Ad[kp]+8>>4);wd[kp]=fd<0?0:fd>255?255:fd}}ps(rl*ll*8);for(var Fh,Bh,Ed=0;Ed<ll;Ed++){var Td=Ed<<3;for(Fh=0;Fh<8;Fh++)ml.push(new Uint8Array(rl));for(var td=0;td<sl;td++){bh(gl.blocks[Ed][td],nh,th);var Fd=0,Ld=td<<3;for(Bh=0;Bh<8;Bh++){var Ud=ml[Td+Bh];for(Fh=0;Fh<8;Fh++)Ud[Ld+Fh]=nh[Fd++]}}}return ml}function Bn(il){return il<0?0:il>255?255:il}dt.prototype={load:function(gl){var ml=new XMLHttpRequest;ml.open("GET",gl,!0),ml.responseType="arraybuffer",ml.onload=(function(){var sl=new Uint8Array(ml.response||ml.mozResponseArrayBuffer);this.parse(sl),this.onload&&this.onload()}).bind(this),ml.send(null)},parse:function(gl){var ml=this.opts.maxResolutionInMP*1e3*1e3,sl=0;gl.length;function ll(){var Yd=gl[sl]<<8|gl[sl+1];return sl+=2,Yd}function rl(){var Yd=ll(),np=gl.subarray(sl,sl+Yd-2);return sl+=np.length,np}function th(Yd){var np=1,Up=1,Qp,Rp;for(Rp in Yd.components)Yd.components.hasOwnProperty(Rp)&&(Qp=Yd.components[Rp],np<Qp.h&&(np=Qp.h),Up<Qp.v&&(Up=Qp.v));var ng=Math.ceil(Yd.samplesPerLine/8/np),bg=Math.ceil(Yd.scanLines/8/Up);for(Rp in Yd.components)if(Yd.components.hasOwnProperty(Rp)){Qp=Yd.components[Rp];var Ih=Math.ceil(Math.ceil(Yd.samplesPerLine/8)*Qp.h/np),rh=Math.ceil(Math.ceil(Yd.scanLines/8)*Qp.v/Up),sh=ng*Qp.h,oh=bg*Qp.v,Dh=oh*sh,$h=[];ps(Dh*256);for(var yl=0;yl<oh;yl++){for(var gs=[],Cr=0;Cr<sh;Cr++)gs.push(new Int32Array(64));$h.push(gs)}Qp.blocksPerLine=Ih,Qp.blocksPerColumn=rh,Qp.blocks=$h}Yd.maxH=np,Yd.maxV=Up,Yd.mcusPerLine=ng,Yd.mcusPerColumn=bg}var nh=null,bh=null,Fh,Bh,Ed=[],Td=[],td=[],Fd=[],Ld=ll(),Ud=-1;if(this.comments=[],Ld!=65496)throw new Error("SOI not found");for(Ld=ll();Ld!=65497;){var Xd,wd;switch(Ld){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var zd=rl();if(Ld===65534){var Rd=String.fromCharCode.apply(null,zd);this.comments.push(Rd)}Ld===65504&&zd[0]===74&&zd[1]===70&&zd[2]===73&&zd[3]===70&&zd[4]===0&&(nh={version:{major:zd[5],minor:zd[6]},densityUnits:zd[7],xDensity:zd[8]<<8|zd[9],yDensity:zd[10]<<8|zd[11],thumbWidth:zd[12],thumbHeight:zd[13],thumbData:zd.subarray(14,14+3*zd[12]*zd[13])}),Ld===65505&&zd[0]===69&&zd[1]===120&&zd[2]===105&&zd[3]===102&&zd[4]===0&&(this.exifBuffer=zd.subarray(5,zd.length)),Ld===65518&&zd[0]===65&&zd[1]===100&&zd[2]===111&&zd[3]===98&&zd[4]===101&&zd[5]===0&&(bh={version:zd[6],flags0:zd[7]<<8|zd[8],flags1:zd[9]<<8|zd[10],transformCode:zd[11]});break;case 65499:for(var op=ll(),Wd=op+sl-2;sl<Wd;){var Op=gl[sl++];ps(256);var ep=new Int32Array(64);if(Op>>4)if(Op>>4===1)for(wd=0;wd<64;wd++){var zp=o[wd];ep[zp]=ll()}else throw new Error("DQT: invalid table spec");else for(wd=0;wd<64;wd++){var zp=o[wd];ep[zp]=gl[sl++]}Ed[Op&15]=ep}break;case 65472:case 65473:case 65474:ll(),Fh={},Fh.extended=Ld===65473,Fh.progressive=Ld===65474,Fh.precision=gl[sl++],Fh.scanLines=ll(),Fh.samplesPerLine=ll(),Fh.components={},Fh.componentsOrder=[];var Kd=Fh.scanLines*Fh.samplesPerLine;if(Kd>ml){var Ap=Math.ceil((Kd-ml)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${Ap}MP`)}var Ip=gl[sl++],Yh;for(Xd=0;Xd<Ip;Xd++){Yh=gl[sl];var Ad=gl[sl+1]>>4,kp=gl[sl+1]&15,up=gl[sl+2];if(Ad<=0||kp<=0)throw new Error("Invalid sampling factor, expected values above 0");Fh.componentsOrder.push(Yh),Fh.components[Yh]={h:Ad,v:kp,quantizationIdx:up},sl+=3}th(Fh),Td.push(Fh);break;case 65476:var rp=ll();for(Xd=2;Xd<rp;){var fd=gl[sl++],Cp=new Uint8Array(16),Fp=0;for(wd=0;wd<16;wd++,sl++)Fp+=Cp[wd]=gl[sl];ps(16+Fp);var _p=new Uint8Array(Fp);for(wd=0;wd<Fp;wd++,sl++)_p[wd]=gl[sl];Xd+=17+Fp,(fd>>4?td:Fd)[fd&15]=Ht(Cp,_p)}break;case 65501:ll(),Bh=ll();break;case 65500:ll(),ll();break;case 65498:ll();var kd=gl[sl++],$f=[],Uf;for(Xd=0;Xd<kd;Xd++){Uf=Fh.components[gl[sl++]];var cd=gl[sl++];Uf.huffmanTableDC=Fd[cd>>4],Uf.huffmanTableAC=td[cd&15],$f.push(Uf)}var cp=gl[sl++],xp=gl[sl++],Ep=gl[sl++],Vp=ir(gl,sl,Fh,$f,Bh,cp,xp,Ep>>4,Ep&15,this.opts);sl+=Vp;break;case 65535:gl[sl]!==255&&sl--;break;default:if(gl[sl-3]==255&&gl[sl-2]>=192&&gl[sl-2]<=254){sl-=3;break}else if(Ld===224||Ld==225){if(Ud!==-1)throw new Error(`first unknown JPEG marker at offset ${Ud.toString(16)}, second unknown JPEG marker ${Ld.toString(16)} at offset ${(sl-1).toString(16)}`);Ud=sl-1;const Yd=ll();if(gl[sl+Yd-2]===255){sl+=Yd-2;break}}throw new Error("unknown JPEG marker "+Ld.toString(16))}Ld=ll()}if(Td.length!=1)throw new Error("only single frame JPEGs supported");for(var Xd=0;Xd<Td.length;Xd++){var bd=Td[Xd].components;for(var wd in bd)bd[wd].quantizationTable=Ed[bd[wd].quantizationIdx],delete bd[wd].quantizationIdx}this.width=Fh.samplesPerLine,this.height=Fh.scanLines,this.jfif=nh,this.adobe=bh,this.components=[];for(var Xd=0;Xd<Fh.componentsOrder.length;Xd++){var Uf=Fh.components[Fh.componentsOrder[Xd]];this.components.push({lines:Hr(Fh,Uf),scaleX:Uf.h/Fh.maxH,scaleY:Uf.v/Fh.maxV})}},getData:function(gl,ml){var sl=this.width/gl,ll=this.height/ml,rl,th,nh,bh,Fh,Bh,Ed,Td,td,Fd,Ld=0,Ud,Xd,wd,zd,Rd,op,Wd,Op,ep,zp,Kd,Ap=gl*ml*this.components.length;ps(Ap);var Ip=new Uint8Array(Ap);switch(this.components.length){case 1:for(rl=this.components[0],Fd=0;Fd<ml;Fd++)for(Fh=rl.lines[0|Fd*rl.scaleY*ll],td=0;td<gl;td++)Ud=Fh[0|td*rl.scaleX*sl],Ip[Ld++]=Ud;break;case 2:for(rl=this.components[0],th=this.components[1],Fd=0;Fd<ml;Fd++)for(Fh=rl.lines[0|Fd*rl.scaleY*ll],Bh=th.lines[0|Fd*th.scaleY*ll],td=0;td<gl;td++)Ud=Fh[0|td*rl.scaleX*sl],Ip[Ld++]=Ud,Ud=Bh[0|td*th.scaleX*sl],Ip[Ld++]=Ud;break;case 3:for(Kd=!0,this.adobe&&this.adobe.transformCode?Kd=!0:typeof this.opts.colorTransform<"u"&&(Kd=!!this.opts.colorTransform),rl=this.components[0],th=this.components[1],nh=this.components[2],Fd=0;Fd<ml;Fd++)for(Fh=rl.lines[0|Fd*rl.scaleY*ll],Bh=th.lines[0|Fd*th.scaleY*ll],Ed=nh.lines[0|Fd*nh.scaleY*ll],td=0;td<gl;td++)Kd?(Ud=Fh[0|td*rl.scaleX*sl],Xd=Bh[0|td*th.scaleX*sl],wd=Ed[0|td*nh.scaleX*sl],Op=Bn(Ud+1.402*(wd-128)),ep=Bn(Ud-.3441363*(Xd-128)-.71413636*(wd-128)),zp=Bn(Ud+1.772*(Xd-128))):(Op=Fh[0|td*rl.scaleX*sl],ep=Bh[0|td*th.scaleX*sl],zp=Ed[0|td*nh.scaleX*sl]),Ip[Ld++]=Op,Ip[Ld++]=ep,Ip[Ld++]=zp;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(Kd=!1,this.adobe&&this.adobe.transformCode?Kd=!0:typeof this.opts.colorTransform<"u"&&(Kd=!!this.opts.colorTransform),rl=this.components[0],th=this.components[1],nh=this.components[2],bh=this.components[3],Fd=0;Fd<ml;Fd++)for(Fh=rl.lines[0|Fd*rl.scaleY*ll],Bh=th.lines[0|Fd*th.scaleY*ll],Ed=nh.lines[0|Fd*nh.scaleY*ll],Td=bh.lines[0|Fd*bh.scaleY*ll],td=0;td<gl;td++)Kd?(Ud=Fh[0|td*rl.scaleX*sl],Xd=Bh[0|td*th.scaleX*sl],wd=Ed[0|td*nh.scaleX*sl],zd=Td[0|td*bh.scaleX*sl],Rd=255-Bn(Ud+1.402*(wd-128)),op=255-Bn(Ud-.3441363*(Xd-128)-.71413636*(wd-128)),Wd=255-Bn(Ud+1.772*(Xd-128))):(Rd=Fh[0|td*rl.scaleX*sl],op=Bh[0|td*th.scaleX*sl],Wd=Ed[0|td*nh.scaleX*sl],zd=Td[0|td*bh.scaleX*sl]),Ip[Ld++]=255-Rd,Ip[Ld++]=255-op,Ip[Ld++]=255-Wd,Ip[Ld++]=255-zd;break;default:throw new Error("Unsupported color mode")}return Ip},copyToImageData:function(gl,ml){var sl=gl.width,ll=gl.height,rl=gl.data,th=this.getData(sl,ll),nh=0,bh=0,Fh,Bh,Ed,Td,td,Fd,Ld,Ud,Xd;switch(this.components.length){case 1:for(Bh=0;Bh<ll;Bh++)for(Fh=0;Fh<sl;Fh++)Ed=th[nh++],rl[bh++]=Ed,rl[bh++]=Ed,rl[bh++]=Ed,ml&&(rl[bh++]=255);break;case 3:for(Bh=0;Bh<ll;Bh++)for(Fh=0;Fh<sl;Fh++)Ld=th[nh++],Ud=th[nh++],Xd=th[nh++],rl[bh++]=Ld,rl[bh++]=Ud,rl[bh++]=Xd,ml&&(rl[bh++]=255);break;case 4:for(Bh=0;Bh<ll;Bh++)for(Fh=0;Fh<sl;Fh++)td=th[nh++],Fd=th[nh++],Ed=th[nh++],Td=th[nh++],Ld=255-Bn(td*(1-Td/255)+Td),Ud=255-Bn(Fd*(1-Td/255)+Td),Xd=255-Bn(Ed*(1-Td/255)+Td),rl[bh++]=Ld,rl[bh++]=Ud,rl[bh++]=Xd,ml&&(rl[bh++]=255);break;default:throw new Error("Unsupported color mode")}}};var Vn=0,Wr=0;function ps(il=0){var gl=Vn+il;if(gl>Wr){var ml=Math.ceil((gl-Wr)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${ml}MB`)}Vn=gl}return dt.resetMaxMemoryUsage=function(il){Vn=0,Wr=il},dt.getBytesAllocated=function(){return Vn},dt.requestMemoryAllocation=ps,dt}();r.exports=t;function t(n,o={}){var a={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512},l={...a,...o},s=new Uint8Array(n),m=new e;m.opts=l,e.resetMaxMemoryUsage(l.maxMemoryUsageInMB*1024*1024),m.parse(s);var y=l.formatAsRGBA?4:3,D=m.width*m.height*y;try{e.requestMemoryAllocation(D);var W={width:m.width,height:m.height,exifBuffer:m.exifBuffer,data:l.useTArray?new Uint8Array(D):Buffer.alloc(D)};m.comments.length>0&&(W.comments=m.comments)}catch(Ee){throw Ee instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+D):Ee instanceof ReferenceError&&Ee.message==="Buffer is not defined"?new Error("Buffer is not globally defined in this environment. Consider setting useTArray to true"):Ee}return m.copyToImageData(W,l.formatAsRGBA),W}})(decoder);var decoderExports=decoder.exports,encode$1=encoderExports,decode$4=decoderExports,jpegJs={encode:encode$1,decode:decode$4};let chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup=new Uint8Array(256);for(let r=0;r<chars.length;r++)lookup[chars.charCodeAt(r)]=r;function encode(r){let e,t=r.length,n="";for(e=0;e<t;e+=3)n+=chars[r[e]>>2],n+=chars[(r[e]&3)<<4|r[e+1]>>4],n+=chars[(r[e+1]&15)<<2|r[e+2]>>6],n+=chars[r[e+2]&63];return t%3===2?n=`${n.substring(0,n.length-1)}=`:t%3===1&&(n=`${n.substring(0,n.length-2)}==`),n}function decode$3(r){let e=r.length*.75,t=r.length,n=0,o,a,l,s;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);const m=new Uint8Array(e);for(let y=0;y<t;y+=4)o=lookup[r.charCodeAt(y)],a=lookup[r.charCodeAt(y+1)],l=lookup[r.charCodeAt(y+2)],s=lookup[r.charCodeAt(y+3)],m[n++]=o<<2|a>>4,m[n++]=(a&15)<<4|l>>2,m[n++]=(l&3)<<6|s&63;return m}function toBase64URL(r,e){const t=encode(r);return`data:${e};base64,${t}`}const ImageData$1=self.ImageData,DOMImage=self.Image;function createCanvas(r,e){let t=self.document.createElement("canvas");return t.width=r,t.height=e,t}function fetchBinary(r,{withCredentials:e=!1}={}){return new Promise(function(t,n){let o=new self.XMLHttpRequest;o.open("GET",r,!0),o.responseType="arraybuffer",o.withCredentials=e,o.onload=function(a){this.status!==200?n(a):t(this.response)},o.onerror=n,o.send()})}function createWriteStream(){throw new Error("createWriteStream does not exist in the browser")}function writeFile(){throw new Error("writeFile does not exist in the browser")}function getType(r){return r.includes("/")||(r=`image/${r}`),r}function encodeJpeg(r,e={}){const t={width:r.width,height:r.height,data:r.getRGBAData()};return jpegJs.encode(t,e.quality).data}function encodePng(r,e){const t={width:r.width,height:r.height,channels:r.channels,depth:r.bitDepth,data:r.data};return(t.depth===1||t.depth===32)&&(t.depth=8,t.channels=4,t.data=r.getRGBAData()),encodePng$1(t,e)}const exportMethods={save(r,e={}){const{useCanvas:t=!1,encoder:n=void 0}=e;let{format:o}=e;if(!o){const a=/\.(?<format>[a-zA-Z]+)$/.exec(r);a&&(o=a.groups.format.toLowerCase())}if(!o)throw new Error("file format not provided");return new Promise((a,l)=>{let s,m;switch(o.toLowerCase()){case"png":{t?s=this.getCanvas().pngStream():m=encodePng(this,n);break}case"jpg":case"jpeg":t?s=this.getCanvas().jpegStream():m=encodeJpeg(this,n);break;case"bmp":m=encode$2(this,n);break;default:throw new RangeError(`invalid output format: ${o}`)}if(s){let y=createWriteStream();y.on("finish",a),y.on("error",l),s.pipe(y)}else m&&writeFile()})},toDataURL(r="image/png",e={}){typeof r=="object"&&(e=r,r="image/png");const{useCanvas:t=!1,encoder:n=void 0}=e;r=getType(r);function o(a,l){const s=a(l,n);return toBase64URL(s,r)}return r==="image/bmp"?o(encode$2,this):r==="image/png"&&!t?o(encodePng,this):r==="image/jpeg"&&!t?o(encodeJpeg,this):this.getCanvas().toDataURL(r)},toBuffer(r={}){const{format:e="png",encoder:t=void 0}=r;switch(e.toLowerCase()){case"png":return encodePng(this,t);case"jpeg":case"jpg":return encodeJpeg(this,t);case"bmp":return encode$2(this,t);default:throw new RangeError(`invalid output format: ${e}`)}},toBase64(r="image/png",e={}){if(e.async)return this.toDataURL(r,e).then(function(t){return t.substring(t.indexOf(",")+1)});{const t=this.toDataURL(r,e);return t.substring(t.indexOf(",")+1)}},toBlob(r="image/png",e=.8){return canvasToBlob(this.getCanvas(),r,e)},getCanvas(){const r=new ImageData$1(this.getRGBAData({clamped:!0}),this.width,this.height);let e=createCanvas(this.width,this.height);return e.getContext("2d").putImageData(r,0,0),e}};function setExportMethods(r){for(const e in exportMethods)r.prototype[e]=exportMethods[e]}var hasOwn$1={exports:{}};const name="has-own",version="1.0.1",description="A safer .hasOwnProperty() - hasOwn(name, obj)",main="index.js",scripts={test:"make test"},author="Aaron Heckmann <aaron.heckmann+github@gmail.com>",license="MIT",repository={type:"git",url:"git://github.com/aheckmann/has-own.git"},homepage="https://github.com/aheckmann/has-own/",devDependencies={mocha:"^6.2.2"},require$$0$2={name,version,description,main,scripts,author,license,repository,homepage,devDependencies};(function(r,e){var t=Object.prototype.hasOwnProperty;r.exports=e=function(o,a){return t.call(a,o)},e.version=require$$0$2.version})(hasOwn$1,hasOwn$1.exports);var hasOwnExports=hasOwn$1.exports;const hasOwn=getDefaultExportFromCjs(hasOwnExports);let computedPropertyDescriptor$1={configurable:!0,enumerable:!1,get:void 0};function extendMethod(r,e,t={}){let{inPlace:n=!1,returnThis:o=!0,partialArgs:a=[]}=t;return n?Image$1.prototype[r]=function(...l){this.computed=null;let s=e.apply(this,[...a,...l]);return o?this:s}:Image$1.prototype[r]=function(...l){return e.apply(this,[...a,...l])},Image$1}function extendProperty(r,e,t={}){let{partialArgs:n=[]}=t;return computedPropertyDescriptor$1.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(r,this.computed))return this.computed[r];let o=e.apply(this,n);return this.computed[r]=o,o},Object.defineProperty(Image$1.prototype,r,computedPropertyDescriptor$1),Image$1}const GREY$1="GREY",RGB$1="RGB",HSL="HSL",HSV="HSV",CMYK$1="CMYK",ColorModel=Object.freeze(Object.defineProperty({__proto__:null,CMYK:CMYK$1,GREY:GREY$1,HSL,HSV,RGB:RGB$1},Symbol.toStringTag,{value:"Module"}));function getRGBAData(r={}){const{clamped:e}=r;this.checkProcessable("getRGBAData",{components:[1,3],bitDepth:[1,8,16,32]});const t=this.width*this.height*4;let n=e?new Uint8ClampedArray(t):new Uint8Array(t);return this.bitDepth===1?fillDataFromBinary(this,n):this.bitDepth===32?(this.checkProcessable("getRGBAData",{alpha:0}),this.components===1?fillDataFromGrey32(this,n):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB32(this,n))):this.components===1?fillDataFromGrey(this,n):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB(this,n)),this.alpha===1?(this.checkProcessable("getRGBAData",{bitDepth:[8,16]}),copyAlpha(this,n)):fillAlpha(this,n),n}function fillDataFromBinary(r,e){for(let t=0;t<r.size;t++){const n=r.getBit(t);e[t*4]=n*255,e[t*4+1]=n*255,e[t*4+2]=n*255}}function fillDataFromGrey32(r,e){const t=r.min[0],o=r.max[0]-t;for(let a=0;a<r.size;a++){const l=Math.floor(255*(r.data[a]-t)/o);e[a*4]=l,e[a*4+1]=l,e[a*4+2]=l}}function fillDataFromRGB32(r,e){const t=Math.min(...r.min),o=Math.max(...r.max)-t;for(let a=0;a<r.size;a++){const l=Math.floor(255*(r.data[a*3]-t)/o),s=Math.floor(255*(r.data[a*3+1]-t)/o),m=Math.floor(255*(r.data[a*3+2]-t)/o);e[a*4]=l,e[a*4+1]=s,e[a*4+2]=m}}function fillDataFromGrey(r,e){for(let t=0;t<r.size;t++)e[t*4]=r.data[t*r.channels]>>>r.bitDepth-8,e[t*4+1]=r.data[t*r.channels]>>>r.bitDepth-8,e[t*4+2]=r.data[t*r.channels]>>>r.bitDepth-8}function fillDataFromRGB(r,e){for(let t=0;t<r.size;t++)e[t*4]=r.data[t*r.channels]>>>r.bitDepth-8,e[t*4+1]=r.data[t*r.channels+1]>>>r.bitDepth-8,e[t*4+2]=r.data[t*r.channels+2]>>>r.bitDepth-8}function copyAlpha(r,e){for(let t=0;t<r.size;t++)e[t*4+3]=r.data[t*r.channels+r.components]>>r.bitDepth-8}function fillAlpha(r,e){for(let t=0;t<r.size;t++)e[t*4+3]=255}const BINARY="BINARY",GREY="GREY",GREYA="GREYA",RGB="RGB",RGBA="RGBA",CMYK="CMYK",CMYKA="CMYKA",kinds={};kinds[BINARY]={components:1,alpha:0,bitDepth:1,colorModel:GREY$1};kinds[GREYA]={components:1,alpha:1,bitDepth:8,colorModel:GREY$1};kinds[GREY]={components:1,alpha:0,bitDepth:8,colorModel:GREY$1};kinds[RGBA]={components:3,alpha:1,bitDepth:8,colorModel:RGB$1};kinds[RGB]={components:3,alpha:0,bitDepth:8,colorModel:RGB$1};kinds[CMYK]={components:4,alpha:0,bitDepth:8,colorModel:CMYK$1};kinds[CMYKA]={components:4,alpha:1,bitDepth:8,colorModel:CMYK$1};function getKind(r){const e=kinds[r];if(!e)throw new RangeError(`invalid image kind: ${r}`);return e}const validBitDepth=[1,8,16,32];function verifyKindDefinition(r){const{components:e,alpha:t,bitDepth:n,colorModel:o}=r;if(!Number.isInteger(e)||e<=0)throw new RangeError(`invalid components: ${e}. Must be a positive integer`);if(t!==0&&t!==1&&typeof t!="boolean")throw new TypeError(`invalid alpha: ${t}: must be a boolean, 0 or 1`);if(!validBitDepth.includes(n))throw new RangeError(`invalid bitDepth: ${n}. Must be one of ${validBitDepth.join(", ")}`);if(!ColorModel[o])throw new RangeError(`invalid colorModel: ${o}. Must be one of ${Object.keys(ColorModel).join(", ")}`)}function getTheoreticalPixelArraySize(r,e,t){let n=e*r;return t===1&&(n=Math.ceil(n/8)),n}function createPixelArray(r,e,t,n,o,a){const l=n*r;let s;switch(o){case 1:s=new Uint8Array(Math.ceil(l/8));break;case 8:s=new Uint8Array(l);break;case 16:s=new Uint16Array(l);break;case 32:s=new Float32Array(l);break;default:throw new Error(`Cannot create pixel array for bit depth ${o}`)}if(t)for(let m=e;m<s.length;m+=n)s[m]=a;return s}const defaultByteLength=1024*8,charArray=[];let IOBuffer$2=class{constructor(e,t){t=t||{},e===void 0&&(e=defaultByteLength),typeof e=="number"&&(e=new ArrayBuffer(e));let n=e.byteLength;const o=t.offset?t.offset>>>0:0;e.buffer&&(n=e.byteLength-o,e.byteLength!==e.buffer.byteLength?e=e.buffer.slice(e.byteOffset+o,e.byteOffset+e.byteLength):o?e=e.buffer.slice(o):e=e.buffer),this.buffer=e,this.length=n,this.byteLength=n,this.byteOffset=0,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer),this._increment=n||defaultByteLength,this._mark=0}available(e){return e===void 0&&(e=1),this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){this.littleEndian=!0}isBigEndian(){return!this.littleEndian}setBigEndian(){this.littleEndian=!1}skip(e){e===void 0&&(e=1),this.offset+=e}seek(e){this.offset=e}mark(){this._mark=this.offset}reset(){this.offset=this._mark}rewind(){this.offset=0}ensureAvailable(e){if(e===void 0&&(e=1),!this.available(e)){const t=this._increment+this._increment;this._increment=t;const n=this.length+t,o=new Uint8Array(n);o.set(new Uint8Array(this.buffer)),this.buffer=o.buffer,this.length=n,this._data=new DataView(this.buffer)}}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e){e===void 0&&(e=1);for(var t=new Uint8Array(e),n=0;n<e;n++)t[n]=this.readByte();return t}readInt16(){var e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){var e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){var e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){var e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){var e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){var e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e){e===void 0&&(e=1),charArray.length=e;for(var t=0;t<e;t++)charArray[t]=this.readChar();return charArray.join("")}writeBoolean(e){this.writeUint8(e?255:0)}writeInt8(e){this.ensureAvailable(1),this._data.setInt8(this.offset++,e)}writeUint8(e){this.ensureAvailable(1),this._data.setUint8(this.offset++,e)}writeByte(e){this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(var t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t])}writeInt16(e){this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2}writeUint16(e){this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2}writeInt32(e){this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4}writeUint32(e){this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4}writeFloat32(e){this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4}writeFloat64(e){this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8}writeChar(e){this.writeUint8(e.charCodeAt(0))}writeChars(e){for(var t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t))}toArray(){return new Uint8Array(this.buffer,0,this.offset)}};var IOBuffer_1=IOBuffer$2,src$4={};const tagsById$5={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName$5={};for(var i$2 in tagsById$5)tagsByName$5[tagsById$5[i$2]]=i$2;var standard$1={tagsById:tagsById$5,tagsByName:tagsByName$5};const tagsById$4={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$4={};for(var i$1 in tagsById$4)tagsByName$4[tagsById$4[i$1]]=i$1;var exif$1={tagsById:tagsById$4,tagsByName:tagsByName$4};const tagsById$3={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$3={};for(var i in tagsById$3)tagsByName$3[tagsById$3[i]]=i;var gps$1={tagsById:tagsById$3,tagsByName:tagsByName$3};const tags$1={standard:standard$1,exif:exif$1,gps:gps$1};let IFD$2=class{constructor(e){if(!e)throw new Error("missing kind");this.data=null,this.fields=new Map,this.kind=e,this._map=null}get(e){if(typeof e=="number")return this.fields.get(e);if(typeof e=="string")return this.fields.get(tags$1[this.kind].tagsByName[e]);throw new Error("expected a number or string")}get map(){if(!this._map){this._map={};const t=tags$1[this.kind].tagsById;for(var e of this.fields.keys())t[e]&&(this._map[t[e]]=this.fields.get(e))}return this._map}};var ifd=IFD$2;const Ifd=ifd,dateTimeRegex$1=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;let TiffIfd$1=class extends Ifd{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){var e=new Date,t=dateTimeRegex$1.exec(this.dateTime);return e.setFullYear(t[1],t[2]-1,t[3]),e.setHours(t[4],t[5],t[6]),e}get newSubfileType(){return this.get(254)}get imageWidth(){return this.get(256)}get imageLength(){return this.get(257)}get bitsPerSample(){return this.get(258)}get compression(){return this.get(259)||1}get type(){return this.get(262)}get fillOrder(){return this.get(266)||1}get documentName(){return this.get(269)}get imageDescription(){return this.get(270)}get stripOffsets(){return alwaysArray$1(this.get(273))}get orientation(){return this.get(274)}get samplesPerPixel(){return this.get(277)}get rowsPerStrip(){return this.get(278)}get stripByteCounts(){return alwaysArray$1(this.get(279))}get minSampleValue(){return this.get(280)||0}get maxSampleValue(){return this.get(281)||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get(282)}get yResolution(){return this.get(283)}get planarConfiguration(){return this.get(284)||1}get resolutionUnit(){return this.get(296)||2}get dateTime(){return this.get(306)}get predictor(){return this.get(317)||1}get sampleFormat(){return this.get(339)||1}get sMinSampleValue(){return this.get(340)||this.minSampleValue}get sMaxSampleValue(){return this.get(341)||this.maxSampleValue}};function alwaysArray$1(r){return typeof r=="number"?[r]:r}var tiffIfd=TiffIfd$1,ifdValue={},types$1=new Map([[1,[1,readByte$1]],[2,[1,readASCII$1]],[3,[2,readShort$1]],[4,[4,readLong$1]],[5,[8,readRational$1]],[6,[1,readSByte$1]],[7,[1,readByte$1]],[8,[2,readSShort$1]],[9,[4,readSLong$1]],[10,[8,readSRational$1]],[11,[4,readFloat$1]],[12,[8,readDouble$1]]]);ifdValue.getByteLength=function(r,e){return types$1.get(r)[0]*e};ifdValue.readData=function(r,e,t){return types$1.get(e)[1](r,t)};function readByte$1(r,e){if(e===1)return r.readUint8();for(var t=new Uint8Array(e),n=0;n<e;n++)t[n]=r.readUint8();return t}function readASCII$1(r,e){for(var t=[],n="",o=0;o<e;o++){var a=String.fromCharCode(r.readUint8());a==="\0"?(t.push(n),n=""):n+=a}return t.length===1?t[0]:t}function readShort$1(r,e){if(e===1)return r.readUint16();for(var t=new Uint16Array(e),n=0;n<e;n++)t[n]=r.readUint16();return t}function readLong$1(r,e){if(e===1)return r.readUint32();for(var t=new Uint32Array(e),n=0;n<e;n++)t[n]=r.readUint32();return t}function readRational$1(r,e){if(e===1)return r.readUint32()/r.readUint32();for(var t=new Array(e),n=0;n<e;n++)t[n]=r.readUint32()/r.readUint32();return t}function readSByte$1(r,e){if(e===1)return r.readInt8();for(var t=new Int8Array(e),n=0;n<e;n++)t[n]=r.readInt8();return t}function readSShort$1(r,e){if(e===1)return r.readInt16();for(var t=new Int16Array(e),n=0;n<e;n++)t[n]=r.readInt16();return t}function readSLong$1(r,e){if(e===1)return r.readInt32();for(var t=new Int32Array(e),n=0;n<e;n++)t[n]=r.readInt32();return t}function readSRational$1(r,e){if(e===1)return r.readInt32()/r.readInt32();for(var t=new Array(e),n=0;n<e;n++)t[n]=r.readInt32()/r.readInt32();return t}function readFloat$1(r,e){if(e===1)return r.readFloat32();for(var t=new Float32Array(e),n=0;n<e;n++)t[n]=r.readFloat32();return t}function readDouble$1(r,e){if(e===1)return r.readFloat64();for(var t=new Float64Array(e),n=0;n<e;n++)t[n]=r.readFloat64();return t}const IOBuffer$1=IOBuffer_1,IFD$1=ifd,TiffIFD=tiffIfd,IFDValue=ifdValue,defaultOptions$d={ignoreImageData:!1,onlyFirst:!1};let TIFFDecoder$2=class extends IOBuffer$1{constructor(e,t){super(e,t),this._nextIFD=0}decode(e){e=Object.assign({},defaultOptions$d,e);const t=[];for(this.decodeHeader();this._nextIFD;)if(t.push(this.decodeIFD(e)),e.onlyFirst)return t[0];return t}decodeHeader(){let e=this.readUint16();if(e===18761)this.setLittleEndian();else if(e===19789)this.setBigEndian();else throw new Error("invalid byte order: 0x"+e.toString(16));if(e=this.readUint16(),e!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(e){this.seek(this._nextIFD);var t;e.kind?t=new IFD$1(e.kind):t=new TiffIFD;const n=this.readUint16();for(var o=0;o<n;o++)this.decodeIFDEntry(t);return e.ignoreImageData||this.decodeImageData(t),this._nextIFD=this.readUint32(),t}decodeIFDEntry(e){const t=this.offset,n=this.readUint16(),o=this.readUint16(),a=this.readUint32();if(o<1||o>12){this.skip(4);return}IFDValue.getByteLength(o,a)>4&&this.seek(this.readUint32());const s=IFDValue.readData(this,o,a);if(e.fields.set(n,s),n===34665||n===34853){let m=this.offset,y;n===34665?y="exif":n===34853&&(y="gps"),this._nextIFD=s,e[y]=this.decodeIFD({kind:y,ignoreImageData:!0}),this.offset=m}this.seek(t),this.skip(12)}decodeImageData(e){const t=e.orientation;switch(t&&t!==1&&unsupported$1("orientation",t),e.type){case 1:case 2:this.readStripData(e);break;default:unsupported$1("image type",e.type);break}}readStripData(e){const t=e.width,n=e.height,o=validateBitDepth(e.bitsPerSample),a=e.sampleFormat;let l=t*n;const s=getDataArray$1(l,1,o,a),m=e.compression,D=e.rowsPerStrip*t,W=e.stripOffsets,Ee=e.stripByteCounts;for(var dt=0,Ht=0;Ht<W.length;Ht++){var ir=this.getStripData(m,W[Ht],Ee[Ht]),Hr=l>D?D:l;l-=Hr,o===8?dt=fill8bit$1(s,ir,dt,Hr):o===16?dt=fill16bit$1(s,ir,dt,Hr,this.isLittleEndian()):o===32&&a===3?dt=fillFloat32$1(s,ir,dt,Hr,this.isLittleEndian()):unsupported$1("bitDepth",o)}e.data=s}getStripData(e,t,n){switch(e){case 1:return new DataView(this.buffer,t,n);case 2:case 32773:return unsupported$1("Compression",e);default:throw new Error("invalid compression: "+e)}}};var tiffDecoder=TIFFDecoder$2;function getDataArray$1(r,e,t,n){return t===8?new Uint8Array(r*e):t===16?new Uint16Array(r*e):t===32&&n===3?new Float32Array(r*e):unsupported$1("bit depth / sample format",t+" / "+n)}function fill8bit$1(r,e,t,n){for(var o=0;o<n;o++)r[t++]=e.getUint8(o);return t}function fill16bit$1(r,e,t,n,o){for(var a=0;a<n*2;a+=2)r[t++]=e.getUint16(a,o);return t}function fillFloat32$1(r,e,t,n,o){for(var a=0;a<n*4;a+=4)r[t++]=e.getFloat32(a,o);return t}function unsupported$1(r,e){throw new Error("Unsupported "+r+": "+e)}function validateBitDepth(r){if(r.length){const t=r;r=t[0];for(var e=0;e<t.length;e++)t[e]!==r&&unsupported$1("bit depth",t)}return r}const TIFFDecoder$1=tiffDecoder;var decode$2=function(e,t){return new TIFFDecoder$1(e,t).decode(t)};src$4.decode=decode$2;const IOBuffer=IOBuffer_1,tiff=src$4;function decode$1(r){const e=new IOBuffer(r),t={};if(e.setBigEndian(),e.readUint16()!==65496)throw new Error("SOI marker not found. Not a valid JPEG file");if(e.readUint16()===65505){e.readUint16();const a=e.readBytes(6);if(a[0]===69&&a[1]===120&&a[2]===105&&a[3]===102&&a[4]===0&&a[5]===0){const l=tiff.decode(e,{onlyFirst:!0,ignoreImageData:!0,offset:e.offset});t.exif=l}}return t}var decode_1=decode$1,decode=decode_1,imageType$2={exports:{}},fileType$1={exports:{}};(function(module){const toBytes=r=>[...r].map(e=>e.charCodeAt(0)),xpiZipFilename=toBytes("META-INF/mozilla.rsa"),oxmlContentTypes=toBytes("[Content_Types].xml"),oxmlRels=toBytes("_rels/.rels");function readUInt64LE(r,e=0){let t=r[e],n=1,o=0;for(;++o<8;)n*=256,t+=r[e+o]*n;return t}const fileType=r=>{if(!(r instanceof Uint8Array||r instanceof ArrayBuffer||Buffer.isBuffer(r)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof r}\``);const e=r instanceof Uint8Array?r:new Uint8Array(r);if(!(e&&e.length>1))return null;const t=(o,a)=>{a=Object.assign({offset:0},a);for(let l=0;l<o.length;l++)if(a.mask){if(o[l]!==(a.mask[l]&e[l+a.offset]))return!1}else if(o[l]!==e[l+a.offset])return!1;return!0},n=(o,a)=>t(toBytes(o),a);if(t([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(t([137,80,78,71,13,10,26,10]))return{ext:"png",mime:"image/png"};if(t([71,73,70]))return{ext:"gif",mime:"image/gif"};if(t([87,69,66,80],{offset:8}))return{ext:"webp",mime:"image/webp"};if(t([70,76,73,70]))return{ext:"flif",mime:"image/flif"};if((t([73,73,42,0])||t([77,77,0,42]))&&t([67,82],{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(t([73,73,42,0])||t([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(t([66,77]))return{ext:"bmp",mime:"image/bmp"};if(t([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(t([56,66,80,83]))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(t([80,75,3,4])){if(t([109,105,109,101,116,121,112,101,97,112,112,108,105,99,97,116,105,111,110,47,101,112,117,98,43,122,105,112],{offset:30}))return{ext:"epub",mime:"application/epub+zip"};if(t(xpiZipFilename,{offset:30}))return{ext:"xpi",mime:"application/x-xpinstall"};if(n("mimetypeapplication/vnd.oasis.opendocument.text",{offset:30}))return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};if(n("mimetypeapplication/vnd.oasis.opendocument.spreadsheet",{offset:30}))return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};if(n("mimetypeapplication/vnd.oasis.opendocument.presentation",{offset:30}))return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};const o=(m,y=0)=>m.findIndex((D,W,Ee)=>W>=y&&Ee[W]===80&&Ee[W+1]===75&&Ee[W+2]===3&&Ee[W+3]===4);let a=0,l=!1,s=null;do{const m=a+30;if(l||(l=t(oxmlContentTypes,{offset:m})||t(oxmlRels,{offset:m})),s||(n("word/",{offset:m})?s={ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}:n("ppt/",{offset:m})?s={ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}:n("xl/",{offset:m})&&(s={ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),l&&s)return s;a=o(e,m)}while(a>=0);if(s)return s}if(t([80,75])&&(e[2]===3||e[2]===5||e[2]===7)&&(e[3]===4||e[3]===6||e[3]===8))return{ext:"zip",mime:"application/zip"};if(t([117,115,116,97,114],{offset:257}))return{ext:"tar",mime:"application/x-tar"};if(t([82,97,114,33,26,7])&&(e[6]===0||e[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(t([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(t([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(t([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(t([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(t([51,103,112,53])||t([0,0,0])&&t([102,116,121,112],{offset:4})&&(t([109,112,52,49],{offset:8})||t([109,112,52,50],{offset:8})||t([105,115,111,109],{offset:8})||t([105,115,111,50],{offset:8})||t([109,109,112,52],{offset:8})||t([77,52,86],{offset:8})||t([100,97,115,104],{offset:8})))return{ext:"mp4",mime:"video/mp4"};if(t([77,84,104,100]))return{ext:"mid",mime:"audio/midi"};if(t([26,69,223,163])){const o=e.subarray(4,4100),a=o.findIndex((l,s,m)=>m[s]===66&&m[s+1]===130);if(a!==-1){const l=a+3,s=m=>[...m].every((y,D)=>o[l+D]===y.charCodeAt(0));if(s("matroska"))return{ext:"mkv",mime:"video/x-matroska"};if(s("webm"))return{ext:"webm",mime:"video/webm"}}}if(t([0,0,0,20,102,116,121,112,113,116,32,32])||t([102,114,101,101],{offset:4})||t([102,116,121,112,113,116,32,32],{offset:4})||t([109,100,97,116],{offset:4})||t([109,111,111,118],{offset:4})||t([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(t([82,73,70,70])){if(t([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(t([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(t([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(t([48,38,178,117,142,102,207,17,166,217])){let o=30;do{const a=readUInt64LE(e,o+16);if(t([145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101],{offset:o})){if(t([64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43],{offset:o+24}))return{ext:"wma",mime:"audio/x-ms-wma"};if(t([192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43],{offset:o+24}))return{ext:"wmv",mime:"video/x-ms-asf"};break}o+=a}while(o+24<=e.length);return{ext:"asf",mime:"application/vnd.ms-asf"}}if(t([0,0,1,186])||t([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(t([102,116,121,112,51,103],{offset:4}))return{ext:"3gp",mime:"video/3gpp"};for(let o=0;o<2&&o<e.length-16;o++){if(t([73,68,51],{offset:o})||t([255,226],{offset:o,mask:[255,226]}))return{ext:"mp3",mime:"audio/mpeg"};if(t([255,228],{offset:o,mask:[255,228]}))return{ext:"mp2",mime:"audio/mpeg"};if(t([255,248],{offset:o,mask:[255,252]}))return{ext:"mp2",mime:"audio/mpeg"};if(t([255,240],{offset:o,mask:[255,252]}))return{ext:"mp4",mime:"audio/mpeg"}}if(t([102,116,121,112,77,52,65],{offset:4}))return{ext:"m4a",mime:"audio/mp4"};if(t([79,112,117,115,72,101,97,100],{offset:28}))return{ext:"opus",mime:"audio/opus"};if(t([79,103,103,83]))return t([128,116,104,101,111,114,97],{offset:28})?{ext:"ogv",mime:"video/ogg"}:t([1,118,105,100,101,111,0],{offset:28})?{ext:"ogm",mime:"video/ogg"}:t([127,70,76,65,67],{offset:28})?{ext:"oga",mime:"audio/ogg"}:t([83,112,101,101,120,32,32],{offset:28})?{ext:"spx",mime:"audio/ogg"}:t([1,118,111,114,98,105,115],{offset:28})?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"};if(t([102,76,97,67]))return{ext:"flac",mime:"audio/x-flac"};if(t([77,65,67,32]))return{ext:"ape",mime:"audio/ape"};if(t([119,118,112,107]))return{ext:"wv",mime:"audio/wavpack"};if(t([35,33,65,77,82,10]))return{ext:"amr",mime:"audio/amr"};if(t([37,80,68,70]))return{ext:"pdf",mime:"application/pdf"};if(t([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if((e[0]===67||e[0]===70)&&t([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(t([123,92,114,116,102]))return{ext:"rtf",mime:"application/rtf"};if(t([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(t([119,79,70,70])&&(t([0,1,0,0],{offset:4})||t([79,84,84,79],{offset:4})))return{ext:"woff",mime:"font/woff"};if(t([119,79,70,50])&&(t([0,1,0,0],{offset:4})||t([79,84,84,79],{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(t([76,80],{offset:34})&&(t([0,0,1],{offset:8})||t([1,0,2],{offset:8})||t([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(t([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(t([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(t([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(t([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(t([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(t([37,33]))return{ext:"ps",mime:"application/postscript"};if(t([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(t([83,81,76,105]))return{ext:"sqlite",mime:"application/x-sqlite3"};if(t([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(t([67,114,50,52]))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(t([77,83,67,70])||t([73,83,99,40]))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(t([33,60,97,114,99,104,62,10,100,101,98,105,97,110,45,98,105,110,97,114,121]))return{ext:"deb",mime:"application/x-deb"};if(t([33,60,97,114,99,104,62]))return{ext:"ar",mime:"application/x-unix-archive"};if(t([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(t([31,160])||t([31,157]))return{ext:"Z",mime:"application/x-compress"};if(t([76,90,73,80]))return{ext:"lz",mime:"application/x-lzip"};if(t([208,207,17,224,161,177,26,225]))return{ext:"msi",mime:"application/x-msi"};if(t([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(t([71],{offset:4})&&(t([71],{offset:192})||t([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(t([66,76,69,78,68,69,82]))return{ext:"blend",mime:"application/x-blender"};if(t([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(t([0,0,0,12,106,80,32,32,13,10,135,10])){if(t([106,112,50,32],{offset:20}))return{ext:"jp2",mime:"image/jp2"};if(t([106,112,120,32],{offset:20}))return{ext:"jpx",mime:"image/jpx"};if(t([106,112,109,32],{offset:20}))return{ext:"jpm",mime:"image/jpm"};if(t([109,106,112,50],{offset:20}))return{ext:"mj2",mime:"image/mj2"}}if(t([70,79,82,77]))return{ext:"aif",mime:"audio/aiff"};if(n("<?xml "))return{ext:"xml",mime:"application/xml"};if(t([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(t([102,116,121,112],{offset:4})){if(t([109,105,102,49],{offset:8}))return{ext:"heic",mime:"image/heif"};if(t([109,115,102,49],{offset:8}))return{ext:"heic",mime:"image/heif-sequence"};if(t([104,101,105,99],{offset:8})||t([104,101,105,120],{offset:8}))return{ext:"heic",mime:"image/heic"};if(t([104,101,118,99],{offset:8})||t([104,101,118,120],{offset:8}))return{ext:"heic",mime:"image/heic-sequence"}}return t([171,75,84,88,32,49,49,187,13,10,26,10])?{ext:"ktx",mime:"image/ktx"}:t([68,73,67,77],{offset:128})?{ext:"dcm",mime:"application/dicom"}:t([77,80,43])?{ext:"mpc",mime:"audio/x-musepack"}:t([77,80,67,75])?{ext:"mpc",mime:"audio/x-musepack"}:t([66,69,71,73,78,58])?{ext:"ics",mime:"text/calendar"}:t([103,108,84,70,2,0,0,0])?{ext:"glb",mime:"model/gltf-binary"}:t([212,195,178,161])||t([161,178,195,212])?{ext:"pcap",mime:"application/vnd.tcpdump.pcap"}:null};module.exports=fileType,module.exports.default=fileType,Object.defineProperty(fileType,"minimumBytes",{value:4100}),module.exports.stream=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.once("readable",()=>{const r=new stream.PassThrough,e=readableStream.read(module.exports.minimumBytes)||readableStream.read();try{r.fileType=fileType(e)}catch(t){reject(t)}readableStream.unshift(e),stream.pipeline?resolve(stream.pipeline(readableStream,r,()=>{})):resolve(readableStream.pipe(r))})})})(fileType$1);var fileTypeExports=fileType$1.exports;const fileType=fileTypeExports,imageExts=new Set(["jpg","png","gif","webp","flif","cr2","tif","bmp","jxr","psd","ico","bpg","jp2","jpm","jpx","heic","cur","dcm"]),imageType=r=>{const e=fileType(r);return imageExts.has(e&&e.ext)?e:null};imageType$2.exports=imageType;imageType$2.exports.default=imageType;Object.defineProperty(imageType,"minimumBytes",{value:fileType.minimumBytes});var imageTypeExports=imageType$2.exports;const imageType$1=getDefaultExportFromCjs(imageTypeExports);function guessStripByteCounts(r){if(r.compression!==1)throw new Error("missing mandatory StripByteCounts field in compressed image");const e=r.rowsPerStrip*r.width*r.samplesPerPixel*(r.bitsPerSample/8);return new Array(r.stripOffsets.length).fill(e)}function applyHorizontalDifferencing8Bit(r,e,t){let n=0;for(;n<r.length;){for(let o=t;o<e*t;o+=t)for(let a=0;a<t;a++)r[n+o+a]=r[n+o+a]+r[n+o-(t-a)]&255;n+=e*t}}function applyHorizontalDifferencing16Bit(r,e,t){let n=0;for(;n<r.length;){for(let o=t;o<e*t;o+=t)for(let a=0;a<t;a++)r[n+o+a]=r[n+o+a]+r[n+o-(t-a)]&65535;n+=e*t}}const tagsById$2={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$2={};for(let r in tagsById$2)tagsByName$2[tagsById$2[r]]=Number(r);const exif=Object.freeze(Object.defineProperty({__proto__:null,tagsById:tagsById$2,tagsByName:tagsByName$2},Symbol.toStringTag,{value:"Module"})),tagsById$1={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$1={};for(let r in tagsById$1)tagsByName$1[tagsById$1[r]]=Number(r);const gps=Object.freeze(Object.defineProperty({__proto__:null,tagsById:tagsById$1,tagsByName:tagsByName$1},Symbol.toStringTag,{value:"Module"})),tagsById={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName={};for(let r in tagsById)tagsByName[tagsById[r]]=Number(r);const standard=Object.freeze(Object.defineProperty({__proto__:null,tagsById,tagsByName},Symbol.toStringTag,{value:"Module"})),tags={standard,exif,gps};class IFD{constructor(e){if(!e)throw new Error("missing kind");this.data=new Uint8Array,this.fields=new Map,this.kind=e,this._hasMap=!1,this._map={}}get(e){if(typeof e=="number")return this.fields.get(e);if(typeof e=="string")return this.fields.get(tags[this.kind].tagsByName[e]);throw new Error("expected a number or string")}get map(){if(!this._hasMap){const e=tags[this.kind].tagsById;for(let t of this.fields.keys())e[t]&&(this._map[e[t]]=this.fields.get(t));this._hasMap=!0}return this._map}}let types=new Map([[1,[1,readByte]],[2,[1,readASCII]],[3,[2,readShort]],[4,[4,readLong]],[5,[8,readRational]],[6,[1,readSByte]],[7,[1,readByte]],[8,[2,readSShort]],[9,[4,readSLong]],[10,[8,readSRational]],[11,[4,readFloat]],[12,[8,readDouble]]]);function getByteLength(r,e){const t=types.get(r);if(!t)throw new Error(`type not found: ${r}`);return t[0]*e}function readData(r,e,t){const n=types.get(e);if(!n)throw new Error(`type not found: ${e}`);return n[1](r,t)}function readByte(r,e){if(e===1)return r.readUint8();let t=new Uint8Array(e);for(let n=0;n<e;n++)t[n]=r.readUint8();return t}function readASCII(r,e){let t=[],n="";for(let o=0;o<e;o++){let a=String.fromCharCode(r.readUint8());a==="\0"?(t.push(n),n=""):n+=a}return t.length===1?t[0]:t}function readShort(r,e){if(e===1)return r.readUint16();let t=new Uint16Array(e);for(let n=0;n<e;n++)t[n]=r.readUint16();return t}function readLong(r,e){if(e===1)return r.readUint32();let t=new Uint32Array(e);for(let n=0;n<e;n++)t[n]=r.readUint32();return t}function readRational(r,e){if(e===1)return r.readUint32()/r.readUint32();let t=new Array(e);for(let n=0;n<e;n++)t[n]=r.readUint32()/r.readUint32();return t}function readSByte(r,e){if(e===1)return r.readInt8();let t=new Int8Array(e);for(let n=0;n<e;n++)t[n]=r.readInt8();return t}function readSShort(r,e){if(e===1)return r.readInt16();let t=new Int16Array(e);for(let n=0;n<e;n++)t[n]=r.readInt16();return t}function readSLong(r,e){if(e===1)return r.readInt32();let t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=r.readInt32();return t}function readSRational(r,e){if(e===1)return r.readInt32()/r.readInt32();let t=new Array(e);for(let n=0;n<e;n++)t[n]=r.readInt32()/r.readInt32();return t}function readFloat(r,e){if(e===1)return r.readFloat32();let t=new Float32Array(e);for(let n=0;n<e;n++)t[n]=r.readFloat32();return t}function readDouble(r,e){if(e===1)return r.readFloat64();let t=new Float64Array(e);for(let n=0;n<e;n++)t[n]=r.readFloat64();return t}const CLEAR_CODE=256,EOI_CODE=257,TABLE_START=258,MIN_BIT_LENGTH=9;let stringTable=[];function initializeStringTable(){if(stringTable.length===0){for(let e=0;e<256;e++)stringTable.push([e]);const r=[];for(let e=256;e<4096;e++)stringTable.push(r)}}const andTable=[511,1023,2047,4095],bitJumps=[0,0,0,0,0,0,0,0,0,511,1023,2047,4095];class LzwDecoder{constructor(e){this.nextData=0,this.nextBits=0,this.bytePointer=0,this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH,this.stripArray=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),this.outData=new IOBuffer$4(e.byteLength),this.initializeTable()}decode(){let e=0,t=0;for(;(e=this.getNextCode())!==EOI_CODE;)if(e===CLEAR_CODE){if(this.initializeTable(),e=this.getNextCode(),e===EOI_CODE)break;this.writeString(this.stringFromCode(e)),t=e}else if(this.isInTable(e))this.writeString(this.stringFromCode(e)),this.addStringToTable(this.stringFromCode(t).concat(this.stringFromCode(e)[0])),t=e;else{const o=this.stringFromCode(t).concat(this.stringFromCode(t)[0]);this.writeString(o),this.addStringToTable(o),t=e}const n=this.outData.toArray();return new DataView(n.buffer,n.byteOffset,n.byteLength)}initializeTable(){initializeStringTable(),this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH}writeString(e){this.outData.writeBytes(e)}stringFromCode(e){return stringTable[e]}isInTable(e){return e<this.tableLength}addStringToTable(e){if(stringTable[this.tableLength++]=e,stringTable.length>4096)throw stringTable=[],new Error("LZW decoding error. Please open an issue at https://github.com/image-js/tiff/issues/new/choose (include a test image).");this.tableLength===bitJumps[this.currentBitLength]&&this.currentBitLength++}getNextCode(){this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8,this.nextBits<this.currentBitLength&&(this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8);const e=this.nextData>>this.nextBits-this.currentBitLength&andTable[this.currentBitLength-9];return this.nextBits-=this.currentBitLength,this.bytePointer>this.stripArray.length?257:e}}function decompressLzw(r){return new LzwDecoder(r).decode()}const dateTimeRegex=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class TiffIfd extends IFD{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){let e=new Date,t=dateTimeRegex.exec(this.dateTime);if(t===null)throw new Error(`invalid dateTime: ${this.dateTime}`);return e.setFullYear(Number(t[1]),Number(t[2])-1,Number(t[3])),e.setHours(Number(t[4]),Number(t[5]),Number(t[6])),e}get newSubfileType(){return this.get("NewSubfileType")}get imageWidth(){return this.get("ImageWidth")}get imageLength(){return this.get("ImageLength")}get bitsPerSample(){const e=this.get("BitsPerSample");return e&&typeof e!="number"?e[0]:e}get alpha(){const e=this.extraSamples;return e?e[0]!==0:!1}get associatedAlpha(){const e=this.extraSamples;return e?e[0]===1:!1}get extraSamples(){return alwaysArray(this.get("ExtraSamples"))}get compression(){return this.get("Compression")||1}get type(){return this.get("PhotometricInterpretation")}get fillOrder(){return this.get("FillOrder")||1}get documentName(){return this.get("DocumentName")}get imageDescription(){return this.get("ImageDescription")}get stripOffsets(){return alwaysArray(this.get("StripOffsets"))}get orientation(){return this.get("Orientation")}get samplesPerPixel(){return this.get("SamplesPerPixel")||1}get rowsPerStrip(){return this.get("RowsPerStrip")}get stripByteCounts(){return alwaysArray(this.get("StripByteCounts"))}get minSampleValue(){return this.get("MinSampleValue")||0}get maxSampleValue(){return this.get("MaxSampleValue")||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get("XResolution")}get yResolution(){return this.get("YResolution")}get planarConfiguration(){return this.get("PlanarConfiguration")||1}get resolutionUnit(){return this.get("ResolutionUnit")||2}get dateTime(){return this.get("DateTime")}get predictor(){return this.get("Predictor")||1}get sampleFormat(){return this.get("SampleFormat")||1}get sMinSampleValue(){return this.get("SMinSampleValue")||this.minSampleValue}get sMaxSampleValue(){return this.get("SMaxSampleValue")||this.maxSampleValue}get palette(){const e=2**this.bitsPerSample,t=this.get("ColorMap");if(!t)return;if(t.length!==3*e)throw new Error(`ColorMap size must be ${e}`);const n=[];for(let o=0;o<e;o++)n.push([t[o],t[o+e],t[o+2*e]]);return n}}function alwaysArray(r){return typeof r=="number"?[r]:r}function decompressZlib(r){const e=new Uint8Array(r.buffer,r.byteOffset,r.byteLength),t=inflate_1(e);return new DataView(t.buffer,t.byteOffset,t.byteLength)}const defaultOptions$c={ignoreImageData:!1,onlyFirst:!1};class TIFFDecoder extends IOBuffer$4{constructor(e){super(e),this._nextIFD=0}get isMultiPage(){let e=0;for(this.decodeHeader();this._nextIFD;)if(e++,this.decodeIFD({ignoreImageData:!0},!0),e===2)return!0;if(e===1)return!1;throw unsupported("ifdCount",e)}get pageCount(){let e=0;for(this.decodeHeader();this._nextIFD;)e++,this.decodeIFD({ignoreImageData:!0},!0);if(e>0)return e;throw unsupported("ifdCount",e)}decode(e={}){e=Object.assign({},defaultOptions$c,e);const t=[];for(this.decodeHeader();this._nextIFD;)if(t.push(this.decodeIFD(e,!0)),e.onlyFirst)return[t[0]];return t}decodeHeader(){const e=this.readUint16();if(e===18761)this.setLittleEndian();else if(e===19789)this.setBigEndian();else throw new Error(`invalid byte order: 0x${e.toString(16)}`);if(this.readUint16()!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(e,t){this.seek(this._nextIFD);let n;if(t)n=new TiffIfd;else{if(!e.kind)throw new Error("kind is missing");n=new IFD(e.kind)}const o=this.readUint16();for(let a=0;a<o;a++)this.decodeIFDEntry(n);if(!e.ignoreImageData){if(!(n instanceof TiffIfd))throw new Error("must be a tiff ifd");this.decodeImageData(n)}return this._nextIFD=this.readUint32(),n}decodeIFDEntry(e){const t=this.offset,n=this.readUint16(),o=this.readUint16(),a=this.readUint32();if(o<1||o>12){this.skip(4);return}getByteLength(o,a)>4&&this.seek(this.readUint32());const s=readData(this,o,a);if(e.fields.set(n,s),n===34665||n===34853){let m=this.offset,y="exif";n===34665?y="exif":n===34853&&(y="gps"),this._nextIFD=s,e[y]=this.decodeIFD({kind:y,ignoreImageData:!0},!1),this.offset=m}this.seek(t),this.skip(12)}decodeImageData(e){const t=e.orientation;if(t&&t!==1)throw unsupported("orientation",t);switch(e.type){case 0:case 1:case 2:case 3:this.readStripData(e);break;default:throw unsupported("image type",e.type)}if(this.applyPredictor(e),this.convertAlpha(e),e.type===0){const n=e.bitsPerSample,o=Math.pow(2,n)-1;for(let a=0;a<e.data.length;a++)e.data[a]=o-e.data[a]}}readStripData(e){const t=e.width,n=e.height,o=e.bitsPerSample,a=e.sampleFormat,l=t*n*e.samplesPerPixel,s=getDataArray(l,o,a),y=e.rowsPerStrip*t*e.samplesPerPixel,D=e.stripOffsets,W=e.stripByteCounts||guessStripByteCounts(e);let Ee=l,dt=0;for(let Ht=0;Ht<D.length;Ht++){let ir=new DataView(this.buffer,this.byteOffset+D[Ht],W[Ht]),Hr=Ee>y?y:Ee;Ee-=Hr;let Bn=ir;switch(e.compression){case 1:break;case 5:{Bn=decompressLzw(ir);break}case 8:{Bn=decompressZlib(ir);break}case 2:throw unsupported("Compression","CCITT Group 3");case 32773:throw unsupported("Compression","PackBits");default:throw unsupported("Compression",e.compression)}dt=this.fillUncompressed(o,a,s,Bn,dt,Hr)}e.data=s}fillUncompressed(e,t,n,o,a,l){if(e===8)return fill8bit(n,o,a,l);if(e===16)return fill16bit(n,o,a,l,this.isLittleEndian());if(e===32&&t===3)return fillFloat32(n,o,a,l,this.isLittleEndian());throw unsupported("bitDepth",e)}applyPredictor(e){const t=e.bitsPerSample;switch(e.predictor){case 1:break;case 2:{if(t===8)applyHorizontalDifferencing8Bit(e.data,e.width,e.components);else if(t===16)applyHorizontalDifferencing16Bit(e.data,e.width,e.components);else throw new Error(`Horizontal differencing is only supported for images with a bit depth of ${t}`);break}default:throw new Error(`invalid predictor: ${e.predictor}`)}}convertAlpha(e){if(e.alpha&&e.associatedAlpha){const{data:t,components:n,maxSampleValue:o}=e;for(let a=0;a<t.length;a+=n){const l=t[a+n-1];for(let s=0;s<n-1;s++)t[a+s]=Math.round(t[a+s]*o/l)}}}}function getDataArray(r,e,t){if(e===8)return new Uint8Array(r);if(e===16)return new Uint16Array(r);if(e===32&&t===3)return new Float32Array(r);throw unsupported("bit depth / sample format",`${e} / ${t}`)}function fill8bit(r,e,t,n){for(let o=0;o<n;o++)r[t++]=e.getUint8(o);return t}function fill16bit(r,e,t,n,o){for(let a=0;a<n*2;a+=2)r[t++]=e.getUint16(a,o);return t}function fillFloat32(r,e,t,n,o){for(let a=0;a<n*4;a+=4)r[t++]=e.getFloat32(a,o);return t}function unsupported(r,e){return new Error(`Unsupported ${r}: ${e}`)}function decodeTIFF(r,e){return new TIFFDecoder(r).decode(e)}function matchAndCrop(r={}){let{algorithm:e="matchToPrevious",ignoreBorder:t=[0,0]}=r;this.checkProcessable("matchAndCrop",{bitDepth:[8,16]});let n=e==="matchToPrevious",o=this[0],a=[];a[0]={position:[0,0],image:this[0]};let l=[0,0];for(let Ee=1;Ee<this.length;Ee++){let dt=o.getBestMatch(this[Ee],{border:t});a[Ee]={position:[dt[0]+l[0],dt[1]+l[1]],image:this[Ee]},n&&(l[0]+=dt[0],l[1]+=dt[1],o=this[Ee])}let s=0,m=0,y=0,D=0;for(let Ee=0;Ee<a.length;Ee++){let dt=a[Ee];dt.position[0]>s&&(s=dt.position[0]),dt.position[0]<m&&(m=dt.position[0]),dt.position[1]>y&&(y=dt.position[1]),dt.position[1]<D&&(D=dt.position[1])}m=0-m,D=0-D;for(let Ee=0;Ee<a.length;Ee++){let dt=a[Ee];dt.crop=dt.image.crop({x:s-dt.position[0],y:y-dt.position[1],width:o.width-m-s,height:o.height-D-y})}let W=[];for(let Ee=0;Ee<a.length;Ee++)W[Ee]=a[Ee].crop;return new Stack(W)}function min$2(){this.checkProcessable("min",{bitDepth:[8,16]});let r=this[0].min;for(let e=1;e<this.length;e++)for(let t=0;t<r.length;t++)r[t]=Math.min(r[t],this[e].min[t]);return r}function max$2(){this.checkProcessable("min",{bitDepth:[8,16]});let r=this[0].max;for(let e=1;e<this.length;e++)for(let t=0;t<r.length;t++)r[t]=Math.max(r[t],this[e].max[t]);return r}function median$2(r){let e=r.reduce((l,s)=>l+s);if(e===0)throw new Error("unreachable");let t=0,n=0,o=e/2,a;for(;;){if(r[t]>0){if(a!==void 0)return(a+t)/2;if(n+=r[t],n>o)return t;n===o&&(a=t)}t++}}function mean$2(r){let e=0,t=0;for(let n=0;n<r.length;n++)e+=r[n],t+=r[n]*n;return e===0?0:t/e}function median$1(){this.checkProcessable("median",{bitDepth:[8,16]});let r=this.getHistograms({maxSlots:this[0].maxValue+1}),e=new Array(r.length);for(let t=0;t<r.length;t++){let n=r[t];e[t]=median$2(n)}return e}function histogram(r){this.checkProcessable("min",{bitDepth:[8,16]});let e=this[0].getHistogram(r);for(let t=1;t<this.length;t++){let n=this[t].getHistogram(r);for(let o=0;o<e.length;o++)e[o]+=n[o]}return e}function histograms(r){this.checkProcessable("min",{bitDepth:[8,16]});let e=this[0].getHistograms(r),t=e[0].length;for(let n=1;n<this.length;n++){let o=this[n].getHistograms(r);for(let a=0;a<e.length;a++)for(let l=0;l<t;l++)e[a][l]+=o[a][l]}return e}function averageImage(){this.checkProcessable("averageImage",{bitDepth:[8,16]});let r=new Uint32Array(this[0].data.length);for(let n=0;n<this.length;n++){let o=this[n];for(let a=0;a<this[0].data.length;a++)r[a]+=o.data[a]}let e=Image$1.createFrom(this[0]),t=e.data;for(let n=0;n<this[0].data.length;n++)t[n]=r[n]/this.length;return e}function maxImage(){this.checkProcessable("max",{bitDepth:[8,16]});let r=Image$1.createFrom(this[0]);r.data.fill(0);for(const e of this)for(let t=0;t<r.data.length;t++)r.data[t]=Math.max(e.data[t],r.data[t]);return r}function minImage(){this.checkProcessable("max",{bitDepth:[8,16]});let r=Image$1.createFrom(this[0]);r.data.fill(r.maxValue);for(const e of this)for(let t=0;t<r.data.length;t++)r.data[t]=Math.min(e.data[t],r.data[t]);return r}function extend$2(r){r.extendMethod("matchAndCrop",matchAndCrop),r.extendMethod("getMin",min$2),r.extendMethod("getMax",max$2),r.extendMethod("getMedian",median$1),r.extendMethod("getHistogram",histogram),r.extendMethod("getHistograms",histograms),r.extendMethod("getAverage",averageImage),r.extendMethod("getAverageImage",averageImage),r.extendMethod("getMaxImage",maxImage),r.extendMethod("getMinImage",minImage)}let computedPropertyDescriptor={configurable:!0,enumerable:!1,get:void 0};class Stack extends Array{constructor(e){if(Array.isArray(e)){super(e.length);for(let t=0;t<e.length;t++)this[t]=e[t]}else typeof e=="number"?super(e):super();this.computed=null}static load(e){return Promise.all(e.map(Image$1.load)).then(t=>new Stack(t))}static extendMethod(e,t,n={}){let{inPlace:o=!1,returnThis:a=!0,partialArgs:l=[]}=n;return o?Stack.prototype[e]=function(...s){this.computed=null;let m=t.apply(this,[...l,...s]);return a?this:m}:Stack.prototype[e]=function(...s){return t.apply(this,[...l,...s])},Stack}static extendProperty(e,t,n={}){let{partialArgs:o=[]}=n;return computedPropertyDescriptor.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(e,this.computed))return this.computed[e];let a=t.apply(this,o);return this.computed[e]=a,a},Object.defineProperty(Stack.prototype,e,computedPropertyDescriptor),Stack}checkProcessable(e,t={}){if(typeof e!="string")throw new TypeError("checkProcessable requires as first parameter the processName (a string)");if(this.size===0)throw new TypeError(`The process: ${e} can not be applied on an empty stack`);this[0].checkProcessable(e,t);for(let n=1;n<this.length;n++){if((t.sameSize===void 0||t.sameSize)&&this[0].width!==this[n].width)throw new TypeError(`The process: ${e} can not be applied if width is not identical in all images`);if((t.sameSize===void 0||t.sameSize)&&this[0].height!==this[n].height)throw new TypeError(`The process: ${e} can not be applied if height is not identical in all images`);if((t.sameAlpha===void 0||t.sameAlpha)&&this[0].alpha!==this[n].alpha)throw new TypeError(`The process: ${e} can not be applied if alpha is not identical in all images`);if((t.sameBitDepth===void 0||t.sameBitDepth)&&this[0].bitDepth!==this[n].bitDepth)throw new TypeError(`The process: ${e} can not be applied if bitDepth is not identical in all images`);if((t.sameColorModel===void 0||t.sameColorModel)&&this[0].colorModel!==this[n].colorModel)throw new TypeError(`The process: ${e} can not be applied if colorModel is not identical in all images`);if((t.sameNumberChannels===void 0||t.sameNumberChannels)&&this[0].channels!==this[n].channels)throw new TypeError(`The process: ${e} can not be applied if channels is not identical in all images`)}}}Array[Symbol.species]||(Stack.prototype.map=function(r,e){if(typeof r!="function")throw new TypeError(`${r} is not a function`);let t=new Stack(this.length);for(let n=0;n<this.length;n++)t[n]=r.call(e,this[n],n,this);return t});extend$2(Stack);const isDataURL=/^data:[a-z]+\/(?:[a-z]+);base64,/;function load(r,e){if(typeof r=="string")return loadURL(r,e);if(r instanceof ArrayBuffer)return Promise.resolve(loadBinary(new Uint8Array(r),void 0,e&&e.ignorePalette));if(r.buffer)return Promise.resolve(loadBinary(r,void 0,e&&e.ignorePalette));throw new Error('argument to "load" must be a string or buffer.')}function loadBinary(r,e,t){const n=imageType$1(r);if(n)switch(n.mime){case"image/png":return loadPNG(r);case"image/jpeg":return loadJPEG(r);case"image/tiff":return loadTIFF(r,t);default:return loadGeneric(o(n.mime))}return loadGeneric(o("application/octet-stream"));function o(a){return e||toBase64URL(r,a)}}function loadURL(r,e){const t=r.slice(0,64).match(isDataURL);let n;return t!==null?n=Promise.resolve(decode$3(r.slice(t[0].length))):n=fetchBinary(r,e),n.then(o=>{const a=new Uint8Array(o);return loadBinary(a,t?r:void 0,e&&e.ignorePalette)})}function loadPNG(r){const e=decodePng(r);let t=e.channels,n,o=0;return t===2||t===4?(n=t-1,o=1):n=t,e.palette?loadPNGFromPalette(e):new Image$1(e.width,e.height,e.data,{components:n,alpha:o,bitDepth:e.depth})}function loadPNGFromPalette(r){const e=r.width*r.height,t=r.palette[0].length,n=new Uint8Array(e*t),o=8/r.depth,a=r.depth<8?o:1,l=parseInt("1".repeat(r.depth),2),s=t===4;let m=0;for(let y=0;y<e;y++){const D=Math.floor(y/a);let W=r.data[D];r.depth<8&&(W=W>>>r.depth*(o-1-y%o)&l);const Ee=r.palette[W];n[m++]=Ee[0],n[m++]=Ee[1],n[m++]=Ee[2],s&&(n[m++]=Ee[3])}return new Image$1(r.width,r.height,n,{components:3,alpha:s,bitDepth:8})}function loadJPEG(r){const e=decode(r);let t;e.exif&&(t=getMetadata(e.exif));const n=jpegJs.decode(r,{useTArray:!0,maxMemoryUsageInMB:1024});let o=new Image$1(n.width,n.height,n.data,{meta:t});if(t&&t.tiff.tags.Orientation){const a=t.tiff.tags.Orientation;a>2&&(o=o.rotate({3:180,4:180,5:90,6:90,7:270,8:270}[a])),[2,4,5,7].includes(a)&&(o=o.flipX())}return o}function loadTIFF(r,e){let t=decodeTIFF(r);return t.length===1?getImageFromIFD(t[0],e):new Stack(t.map(function(n){return getImageFromIFD(n,e)}))}function getMetadata(r){const e={tiff:{fields:r.fields,tags:r.map}};return r.exif&&(e.exif=r.exif),r.gps&&(e.gps=r.gps),e}function getImageFromIFD(r,e){if(!e&&r.type===3){const t=new Uint16Array(3*r.width*r.height),n=r.palette;let o=0;for(let a=0;a<r.data.length;a++){const l=r.data[a],s=n[l];t[o++]=s[0],t[o++]=s[1],t[o++]=s[2]}return new Image$1(r.width,r.height,t,{components:3,alpha:r.alpha,colorModel:RGB$1,bitDepth:16,meta:getMetadata(r)})}else return new Image$1(r.width,r.height,r.data,{components:r.type===2?3:1,alpha:r.alpha,colorModel:r.type===2?RGB$1:GREY$1,bitDepth:r.bitsPerSample.length?r.bitsPerSample[0]:r.bitsPerSample,meta:getMetadata(r)})}function loadGeneric(r,e){return e=e||{},new Promise(function(t,n){let o=new DOMImage;o.onload=function(){let a=o.width,l=o.height,m=createCanvas(a,l).getContext("2d");m.drawImage(o,0,0,a,l);let y=m.getImageData(0,0,a,l).data;t(new Image$1(a,l,y,e))},o.onerror=function(){n(new Error(`Could not load ${r}`))},o.src=r})}const valueMethods={getValueXY(r,e,t){return this.data[(e*this.width+r)*this.channels+t]},setValueXY(r,e,t,n){return this.data[(e*this.width+r)*this.channels+t]=n,this.computed=null,this},getValue(r,e){return this.data[r*this.channels+e]},setValue(r,e,t){return this.data[r*this.channels+e]=t,this.computed=null,this},getPixelXY(r,e){return this.getPixel(e*this.width+r)},setPixelXY(r,e,t){return this.setPixel(e*this.width+r,t)},getPixel(r){const e=new Array(this.channels),t=r*this.channels;for(let n=0;n<this.channels;n++)e[n]=this.data[t+n];return e},setPixel(r,e){const t=r*this.channels;for(let n=0;n<e.length;n++)this.data[t+n]=e[n];return this.computed=null,this}};function setValueMethods(r){for(const e in valueMethods)r.prototype[e]=valueMethods[e]}function getImageParameters(r){return{width:r.width,height:r.height,components:r.components,alpha:r.alpha,colorModel:r.colorModel,bitDepth:r.bitDepth}}function getOutputImage(r,e,t,n={}){const{out:o}=e;if(o===void 0)return n.copy?r.clone():Image$1.createFrom(r,t);{if(!Image$1.isImage(o))throw new TypeError("out must be an Image object");const a=Object.assign(getImageParameters(r),t);for(const l in a)if(o[l]!==a[l])throw new RangeError(`cannot use out. Its ${l} must be "${a[l]}" (found "${o[l]}")`);return o}}function getOutputImageOrInPlace(r,e,t){if(e.inPlace!==void 0&&typeof e.inPlace!="boolean")throw new TypeError("inPlace option must be a boolean");if(e.inPlace){if(e.out!==void 0)throw new TypeError("out option must not be set if inPlace option is true");return r}return getOutputImage(r,e,null,t)}function abs(r={}){this.checkProcessable("abs",{bitDepth:[32]});const e=getOutputImageOrInPlace(this,r);return absolute(this,e),e}function absolute(r,e){for(let t=0;t<r.data.length;t++)e.data[t]=Math.abs(r.data[t])}function copyAlphaChannel(r,e){if(r.alpha===1&&e.alpha===1)for(let t=0;t<r.size;t++)e.data[t*e.channels+e.components]=r.data[t*r.channels+r.components]}function invert(r={}){this.checkProcessable("invert",{bitDepth:[1,8,16]});const e=getOutputImageOrInPlace(this,r);return this.bitDepth===1?invertBinary(this,e):(invertColor(this,e),this!==e&&copyAlphaChannel(this,e)),e}function invertBinary(r,e){for(let t=0;t<r.data.length;t++)e.data[t]=~r.data[t]}function invertColor(r,e){for(let t=0;t<r.data.length;t+=r.channels)for(let n=0;n<r.components;n++)e.data[t+n]=r.maxValue-r.data[t+n]}function flipX(){this.checkProcessable("flipX",{bitDepth:[8,16]});for(let r=0;r<this.height;r++){let e=r*this.width*this.channels;for(let t=0;t<Math.floor(this.width/2);t++){let n=t*this.channels+e,o=(this.width-t-1)*this.channels+e;for(let a=0;a<this.channels;a++){let l=this.data[n+a];this.data[n+a]=this.data[o+a],this.data[o+a]=l}}}return this}function flipY(){this.checkProcessable("flipY",{bitDepth:[8,16]});for(let r=0;r<Math.floor(this.height/2);r++)for(let e=0;e<this.width;e++){let t=e*this.channels+r*this.width*this.channels,n=e*this.channels+(this.height-1-r)*this.channels*this.width;for(let o=0;o<this.channels;o++){let a=this.data[t+o];this.data[t+o]=this.data[n+o],this.data[n+o]=a}}return this}function blurFilter(r={}){const{radius:e=1}=r;if(e<1)throw new Error("radius must be greater than 1");const t=2*e+1,n=new Array(t);for(let o=0;o<t;o++){n[o]=new Array(t);for(let a=0;a<t;a++)n[o][a]=1/(t*t)}return this.convolution(n)}var medianQuickselect_min={exports:{}};(function(r){(function(){function e(o){for(var a=0,l=o.length-1,s=void 0,m=void 0,y=void 0,D=n(a,l);;){if(l<=a)return o[D];if(l==a+1)return o[a]>o[l]&&t(o,a,l),o[D];for(s=n(a,l),o[s]>o[l]&&t(o,s,l),o[a]>o[l]&&t(o,a,l),o[s]>o[a]&&t(o,s,a),t(o,s,a+1),m=a+1,y=l;;){do m++;while(o[a]>o[m]);do y--;while(o[y]>o[a]);if(y<m)break;t(o,m,y)}t(o,a,y),y<=D&&(a=m),y>=D&&(l=y-1)}}var t=function(a,l,s){var m;return m=[a[s],a[l]],a[l]=m[0],a[s]=m[1],m},n=function(a,l){return~~((a+l)/2)};r.exports?r.exports=e:window.median=e})()})(medianQuickselect_min);var medianQuickselect_minExports=medianQuickselect_min.exports;const quickSelectMedian=getDefaultExportFromCjs(medianQuickselect_minExports);function validateArrayOfChannels(r,e={}){let{channels:t,allowAlpha:n,defaultAlpha:o}=e;return typeof n!="boolean"&&(n=!0),typeof t>"u"?allChannels(r,o):validateChannels(r,t,n)}function allChannels(r,e){let t=e?r.channels:r.components,n=new Array(t);for(let o=0;o<t;o++)n[o]=o;return n}function validateChannels(r,e,t){Array.isArray(e)||(e=[e]);for(let n=0;n<e.length;n++)e[n]=validateChannel(r,e[n],t);return e}function validateChannel(r,e,t=!0){if(e===void 0)throw new RangeError(`validateChannel : the channel has to be >=0 and <${r.channels}`);if(typeof e=="string"){switch(r.colorModel){case GREY$1:break;case RGB$1:if("rgb".includes(e))switch(e){case"r":e=0;break;case"g":e=1;break;case"b":e=2;break}break;case HSL:if("hsl".includes(e))switch(e){case"h":e=0;break;case"s":e=1;break;case"l":e=2;break}break;case HSV:if("hsv".includes(e))switch(e){case"h":e=0;break;case"s":e=1;break;case"v":e=2;break}break;case CMYK$1:if("cmyk".includes(e))switch(e){case"c":e=0;break;case"m":e=1;break;case"y":e=2;break;case"k":e=3;break}break;default:throw new Error(`Unexpected color model: ${r.colorModel}`)}if(e==="a"){if(!r.alpha)throw new Error("validateChannel : the image does not contain alpha channel");e=r.components}if(typeof e=="string")throw new Error(`validateChannel : undefined channel: ${e}`)}if(e>=r.channels)throw new RangeError(`validateChannel : the channel has to be >=0 and <${r.channels}`);if(!t&&e>=r.components)throw new RangeError("validateChannel : alpha channel may not be selected");return e}function medianFilter(r={}){let{radius:e=1,border:t="copy",channels:n}=r;if(this.checkProcessable("medianFilter",{bitDepth:[8,16]}),e<1)throw new Error("radius must be greater than 0");n=validateArrayOfChannels(this,n);let o=e,a=e,l=Image$1.createFrom(this),s=(o*2+1)*(a*2+1),m=new Array(s);for(let y=0;y<n.length;y++){let D=n[y];for(let W=a;W<this.height-a;W++)for(let Ee=o;Ee<this.width-o;Ee++){let dt=0;for(let ir=-a;ir<=a;ir++)for(let Hr=-o;Hr<=o;Hr++){let Bn=((W+ir)*this.width+Ee+Hr)*this.channels+D;m[dt++]=this.data[Bn]}let Ht=(W*this.width+Ee)*this.channels+D;l.data[Ht]=quickSelectMedian(m)}}if(this.alpha&&!n.includes(this.channels))for(let y=this.components;y<this.data.length;y=y+this.channels)l.data[y]=this.data[y];return l.setBorder({size:[o,a],algorithm:t}),l}function gaussianFilter(r={}){let{radius:e=1,sigma:t,channels:n,border:o="copy"}=r;this.checkProcessable("gaussian",{bitDepth:[8,16]});const a=getKernel(e,t);return this.convolution([a,a],{border:o,channels:n,algorithm:"separable"})}function getKernel(r,e){const t=r*2+1,n=new Array(t),o=e||((t-1)*.5-1)*.3+.8,a=-.5/(o*o);let l=0;for(let s=0;s<t;s++){const m=s-r,y=Math.exp(a*m*m);n[s]=y,l+=y}for(let s=0;s<t;s++)n[s]/=l;return n}const SOBEL_X=[[-1,0,1],[-2,0,2],[-1,0,1]],SOBEL_Y=[[-1,-2,-1],[0,0,0],[1,2,1]],SCHARR_X=[[3,0,-3],[10,0,-10],[3,0,-3]],SCHARR_Y=[[3,10,3],[0,0,0],[-3,-10,-3]];var src$3={},fftlib={};(function(r){(function(){var e;e=r;var t={release:"0.3.0",date:"2013-03"};e.toString=function(){return"version "+t.release+", released "+t.date};for(var n=0,o=null,a=null,l={init:function(y){if(y!==0&&!(y&y-1))n=y,l._initArray(),l._makeBitReversalTable(),l._makeCosSinTable();else throw new Error("init: radix-2 required")},fft1d:function(y,D){l.fft(y,D,1)},ifft1d:function(y,D){var W=1/n;l.fft(y,D,-1);for(var Ee=0;Ee<n;Ee++)y[Ee]*=W,D[Ee]*=W},bt1d:function(y,D){l.fft(y,D,-1)},fft2d:function(y,D){for(var W=[],Ee=[],dt=0,Ht=0;Ht<n;Ht++){dt=Ht*n;for(var ir=0;ir<n;ir++)W[ir]=y[ir+dt],Ee[ir]=D[ir+dt];l.fft1d(W,Ee);for(var Hr=0;Hr<n;Hr++)y[Hr+dt]=W[Hr],D[Hr+dt]=Ee[Hr]}for(var Bn=0;Bn<n;Bn++){for(var Vn=0;Vn<n;Vn++)dt=Bn+Vn*n,W[Vn]=y[dt],Ee[Vn]=D[dt];l.fft1d(W,Ee);for(var Wr=0;Wr<n;Wr++)dt=Bn+Wr*n,y[dt]=W[Wr],D[dt]=Ee[Wr]}},ifft2d:function(y,D){for(var W=[],Ee=[],dt=0,Ht=0;Ht<n;Ht++){dt=Ht*n;for(var ir=0;ir<n;ir++)W[ir]=y[ir+dt],Ee[ir]=D[ir+dt];l.ifft1d(W,Ee);for(var Hr=0;Hr<n;Hr++)y[Hr+dt]=W[Hr],D[Hr+dt]=Ee[Hr]}for(var Bn=0;Bn<n;Bn++){for(var Vn=0;Vn<n;Vn++)dt=Bn+Vn*n,W[Vn]=y[dt],Ee[Vn]=D[dt];l.ifft1d(W,Ee);for(var Wr=0;Wr<n;Wr++)dt=Bn+Wr*n,y[dt]=W[Wr],D[dt]=Ee[Wr]}},fft:function(y,D,W){for(var Ee,dt,Ht,ir,Hr,Bn,Vn,Wr,ps,il=n>>2,gl=0;gl<n;gl++)ir=o[gl],gl<ir&&(Hr=y[gl],y[gl]=y[ir],y[ir]=Hr,Hr=D[gl],D[gl]=D[ir],D[ir]=Hr);for(var ml=1;ml<n;ml<<=1){dt=0,Ee=n/(ml<<1);for(var sl=0;sl<ml;sl++){Bn=a[dt+il],Vn=W*a[dt];for(var ll=sl;ll<n;ll+=ml<<1)Ht=ll+ml,Wr=Bn*y[Ht]+Vn*D[Ht],ps=Bn*D[Ht]-Vn*y[Ht],y[Ht]=y[ll]-Wr,y[ll]+=Wr,D[Ht]=D[ll]-ps,D[ll]+=ps;dt+=Ee}}},_initArray:function(){typeof Uint32Array<"u"?o=new Uint32Array(n):o=[],typeof Float64Array<"u"?a=new Float64Array(n*1.25):a=[]},_paddingZero:function(){},_makeBitReversalTable:function(){var y=0,D=0,W=0;for(o[0]=0;++y<n;){for(W=n>>1;W<=D;)D-=W,W>>=1;D+=W,o[y]=D}},_makeCosSinTable:function(){var y=n>>1,D=n>>2,W=n>>3,Ee=y+D,dt=Math.sin(Math.PI/n),Ht=2*dt*dt,ir=Math.sqrt(Ht*(2-Ht)),Hr=a[D]=1,Bn=a[0]=0;dt=2*Ht;for(var Vn=1;Vn<W;Vn++)Hr-=Ht,Ht+=dt*Hr,Bn+=ir,ir-=dt*Bn,a[Vn]=Bn,a[D-Vn]=Hr;W!==0&&(a[W]=Math.sqrt(.5));for(var Wr=0;Wr<D;Wr++)a[y-Wr]=a[Wr];for(var ps=0;ps<Ee;ps++)a[ps+y]=-a[ps]}},s=["init","fft1d","ifft1d","fft2d","ifft2d"],m=0;m<s.length;m++)e[s[m]]=l[s[m]];return e.bt=l.bt1d,e.fft=l.fft1d,e.ifft=l.ifft1d,e}).call(commonjsGlobal)})(fftlib);var FFT$1=fftlib,FFTUtils$1={DEBUG:!1,ifft2DArray:function(r,e,t){var n=new Array(e*t),o=e/2,a=(t-1)*2;FFT$1.init(o);for(var l={re:new Array(o),im:new Array(o)},s=0;s<t;s++){for(var m=o-1;m>=0;m--)l.re[m]=r[m*2*t+s],l.im[m]=r[(m*2+1)*t+s];FFT$1.bt(l.re,l.im);for(var m=o-1;m>=0;m--)n[m*2*t+s]=l.re[m],n[(m*2+1)*t+s]=l.im[m]}var y=new Array(o*a);FFT$1.init(a);for(var D={re:new Array(a),im:new Array(a)},W=a*o,m=0;m<e;m+=2){D.re[0]=n[m*t],D.im[0]=n[(m+1)*t];for(var s=1;s<t;s++)D.re[s]=n[m*t+s],D.im[s]=n[(m+1)*t+s],D.re[a-s]=n[m*t+s],D.im[a-s]=-n[(m+1)*t+s];FFT$1.bt(D.re,D.im);for(var Ee=m/2*a,s=a-1;s>=0;s--)y[Ee+s]=D.re[s]/W}return y},fft2DArray:function(r,e,t,n){Object.assign({},{inplace:!0});var o=t/2+1,a=e*2,l=new Array(a*o);FFT$1.init(t);for(var s={re:new Array(t),im:new Array(t)},m={re:new Array(t),im:new Array(t)},y={re:new Array(t),im:new Array(t)},D,W,Ee,dt,Ht,ir=0;ir<e/2;ir++){D=ir*2*t,s.re=r.slice(D,D+t),D=(ir*2+1)*t,s.im=r.slice(D,D+t),FFT$1.fft1d(s.re,s.im),this.reconstructTwoRealFFT(s,m,y),W=ir*4*o,Ee=(ir*4+1)*o,dt=(ir*4+2)*o,Ht=(ir*4+3)*o;for(var Hr=o-1;Hr>=0;Hr--)l[W+Hr]=m.re[Hr],l[Ee+Hr]=m.im[Hr],l[dt+Hr]=y.re[Hr],l[Ht+Hr]=y.im[Hr]}m=null,y=null;var Bn=new Array(a*o);FFT$1.init(e);for(var Vn={re:new Array(e),im:new Array(e)},Wr=o-1;Wr>=0;Wr--){for(var ir=e-1;ir>=0;ir--)Vn.re[ir]=l[ir*2*o+Wr],Vn.im[ir]=l[(ir*2+1)*o+Wr],isNaN(Vn.re[ir])&&(Vn.re[ir]=0),isNaN(Vn.im[ir])&&(Vn.im[ir]=0);FFT$1.fft1d(Vn.re,Vn.im);for(var ir=e-1;ir>=0;ir--)Bn[ir*2*o+Wr]=Vn.re[ir],Bn[(ir*2+1)*o+Wr]=Vn.im[ir]}return Bn},reconstructTwoRealFFT:function(r,e,t){var n=r.re.length;e.re[0]=r.re[0],e.im[0]=0,t.re[0]=r.im[0],t.im[0]=0;for(var o,a,l,s,m,y=n/2;y>0;y--)m=n-y,o=.5*(r.re[y]-r.re[m]),a=.5*(r.re[y]+r.re[m]),l=.5*(r.im[y]-r.im[m]),s=.5*(r.im[y]+r.im[m]),e.re[y]=a,e.im[y]=l,e.re[m]=a,e.im[m]=-l,t.re[y]=s,t.im[y]=-o,t.re[m]=s,t.im[m]=o},convolute2DI:function(r,e,t,n){for(var o,a,l=0;l<t/2;l++)for(var s=0;s<n;s++)o=r[l*2*n+s]*e[l*2*n+s]-r[(l*2+1)*n+s]*e[(l*2+1)*n+s],a=r[l*2*n+s]*e[(l*2+1)*n+s]+r[(l*2+1)*n+s]*e[l*2*n+s],r[l*2*n+s]=o,r[(l*2+1)*n+s]=a},convolute:function(r,e,t,n,o){for(var a=new Array(n*t),l=0;l<t*n;l++)a[l]=r[l];a=this.fft2DArray(a,t,n);for(var s=e.length,m=e[0].length,y=new Array(n*t),l=0;l<n*t;l++)y[l]=0;for(var D,W,Ee=Math.floor((s-1)/2),dt=Math.floor((m-1)/2),Ht=0;Ht<s;Ht++){D=(Ht-Ee+t)%t;for(var ir=0;ir<m;ir++)W=(ir-dt+n)%n,y[D*n+W]=e[Ht][ir]}y=this.fft2DArray(y,t,n);var Hr=t*2,Bn=n/2+1;return this.convolute2DI(a,y,Hr,Bn),this.ifft2DArray(a,Hr,Bn)},toRadix2:function(r,e,t){var n,o,a,l,s=t,m=e;if(!(t!==0&&!(t&t-1))){for(s=0;t>>++s;);s=1<<s}if(!(e!==0&&!(e&e-1))){for(m=0;e>>++m;);m=1<<m}if(m==e&&s==t)return{data:r,rows:e,cols:t};var y=new Array(m*s),D=Math.floor((m-e)/2)-e,W=Math.floor((s-t)/2)-t;for(n=0;n<m;n++)for(a=n*s,l=(n-D)%e*t,o=0;o<s;o++)y[a+o]=r[l+(o-W)%t];return{data:y,rows:m,cols:s}},crop:function(r,e,t,n,o,a){if(e==n&&t==o)return r;Object.assign({},a);var l=new Array(o*n),s=Math.floor((e-n)/2),m=Math.floor((t-o)/2),y,D,W,Ee;for(W=0;W<n;W++)for(y=W*o,D=(W+s)*t,Ee=0;Ee<o;Ee++)l[y+Ee]=r[D+(Ee+m)];return l}},FFTUtils_1=FFTUtils$1;src$3.FFTUtils=FFTUtils_1;src$3.FFT=fftlib;var FFTUtils=src$3.FFTUtils;function convolutionFFT(r,e,t){var n=matrix2Array(r),o=n.data,a=Object.assign({normalize:!1,divisor:1,rows:n.rows,cols:n.cols},t),l,s;if(a.rows&&a.cols)l=a.rows,s=a.cols;else throw new Error("Invalid number of rows or columns "+l+" "+s);var m=a.divisor,y,D,W=e.length,Ee=e[0].length;if(a.normalize)for(m=0,y=0;y<W;y++)for(D=0;D<Ee;D++)m+=e[y][D];if(m===0)throw new RangeError("convolution: The divisor is equal to zero");var dt=FFTUtils.toRadix2(o,l,s),Ht=FFTUtils.convolute(dt.data,e,dt.rows,dt.cols);if(Ht=FFTUtils.crop(Ht,dt.rows,dt.cols,l,s),m!=0&&m!=1)for(y=0;y<Ht.length;y++)Ht[y]/=m;return Ht}function convolutionDirect(r,e,t){var n=matrix2Array(r),o=n.data,a=Object.assign({normalize:!1,divisor:1,rows:n.rows,cols:n.cols},t),l,s;if(a.rows&&a.cols)l=a.rows,s=a.cols;else throw new Error("Invalid number of rows or columns "+l+" "+s);var m=a.divisor,y=e.length,D=e[0].length,W,Ee,dt,Ht,ir,Hr,Bn,Vn,Wr;if(a.normalize)for(m=0,W=0;W<y;W++)for(Ee=0;Ee<D;Ee++)m+=e[W][Ee];if(m===0)throw new RangeError("convolution: The divisor is equal to zero");var ps=new Array(l*s),il=Math.floor(y/2),gl=Math.floor(D/2);for(Ht=0;Ht<l;Ht++)for(dt=0;dt<s;dt++){for(Hr=0,Ee=0;Ee<y;Ee++)for(W=0;W<D;W++)Bn=e[y-Ee-1][D-W-1],Vn=(Ht+Ee-il+l)%l,Wr=(dt+W-gl+s)%s,ir=Vn*s+Wr,Hr+=o[ir]*Bn;ir=Ht*s+dt,ps[ir]=Hr/m}return ps}function LoG(r,e,t){var n=1e3;t&&t.factor&&(n=t.factor);var o=new Array(e),a,l,s,m;n*=-1;var y=(e-1)/2,D=2*r*r;for(a=0;a<e;a++)for(o[a]=new Array(e),m=(a-y)*(a-y),l=0;l<e;l++)s=-((l-y)*(l-y)+m)/D,o[a][l]=Math.round(n*(1+s)*Math.exp(s));return o}function matrix2Array(r){var e=r,t,n;if(typeof r[0]!="number"){t=r.length,n=r[0].length,e=new Array(t*n);for(var o=0;o<t;o++)for(var a=0;a<n;a++)e[o*n+a]=r[o][a]}else{var l=Math.sqrt(r.length);Number.isInteger(l)&&(t=l,n=l)}return{data:e,rows:t,cols:n}}var src$2={fft:convolutionFFT,direct:convolutionDirect,kernelFactory:{LoG},matrix2Array},_isFinite=Number.isFinite||function(r){return!(typeof r!="number"||r!==r||r===1/0||r===-1/0)},isFinite$1=_isFinite,isInteger=Number.isInteger||function(r){return typeof r=="number"&&isFinite$1(r)&&Math.floor(r)===r};const isInteger$1=getDefaultExportFromCjs(isInteger);function validateKernel(r){let e,t;if(Array.isArray(r))if(Array.isArray(r[0])){if(!(r.length&1)||!(r[0].length&1))throw new RangeError("validateKernel: Kernel rows and columns should be odd numbers");e=Math.floor(r.length/2),t=Math.floor(r[0].length/2)}else{let n=Math.sqrt(r.length);if(isInteger$1(n))t=e=Math.floor(Math.sqrt(r.length)/2);else throw new RangeError("validateKernel: Kernel array should be a square");let o=new Array(n);for(let a=0;a<n;a++){o[a]=new Array(n);for(let l=0;l<n;l++)o[a][l]=r[a*n+l]}r=o}else throw new Error(`validateKernel: Invalid Kernel: ${r}`);return{kernel:r,kWidth:t,kHeight:e}}function clamp(r,e){return Math.round(Math.min(Math.max(r,0),e.maxValue))}function directConvolution(r,e,t){if(t===void 0){const a=r.length+e.length-1;t=new Array(a)}fill(t);for(var n=0;n<r.length;n++)for(var o=0;o<e.length;o++)t[n+o]+=r[n]*e[o];return t}function fill(r){for(var e=0;e<r.length;e++)r[e]=0}function FFT(r){if(this.size=r|0,this.size<=1||this.size&this.size-1)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=r<<1;for(var e=new Array(this.size*2),t=0;t<e.length;t+=2){const m=Math.PI*t/this.size;e[t]=Math.cos(m),e[t+1]=-Math.sin(m)}this.table=e;for(var n=0,o=1;this.size>o;o<<=1)n++;this._width=n%2===0?n-1:n,this._bitrev=new Array(1<<this._width);for(var a=0;a<this._bitrev.length;a++){this._bitrev[a]=0;for(var l=0;l<this._width;l+=2){var s=this._width-l-2;this._bitrev[a]|=(a>>>l&3)<<s}}this._out=null,this._data=null,this._inv=0}FFT.prototype.fromComplexArray=function r(e,t){for(var n=t||new Array(e.length>>>1),o=0;o<e.length;o+=2)n[o>>>1]=e[o];return n};FFT.prototype.createComplexArray=function r(){const e=new Array(this._csize);for(var t=0;t<e.length;t++)e[t]=0;return e};FFT.prototype.toComplexArray=function r(e,t){for(var n=t||this.createComplexArray(),o=0;o<n.length;o+=2)n[o]=e[o>>>1],n[o+1]=0;return n};FFT.prototype.completeSpectrum=function r(e){for(var t=this._csize,n=t>>>1,o=2;o<n;o+=2)e[t-o]=e[o],e[t-o+1]=-e[o+1]};FFT.prototype.transform=function r(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._out=e,this._data=t,this._inv=0,this._transform4(),this._out=null,this._data=null};FFT.prototype.realTransform=function r(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._out=e,this._data=t,this._inv=0,this._realTransform4(),this._out=null,this._data=null};FFT.prototype.inverseTransform=function r(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._out=e,this._data=t,this._inv=1,this._transform4();for(var n=0;n<e.length;n++)e[n]/=this.size;this._out=null,this._data=null};FFT.prototype._transform4=function r(){var e=this._out,t=this._csize,n=this._width,o=1<<n,a=t/o<<1,l,s,m=this._bitrev;if(a===4)for(l=0,s=0;l<t;l+=a,s++){const ir=m[s];this._singleTransform2(l,ir,o)}else for(l=0,s=0;l<t;l+=a,s++){const ir=m[s];this._singleTransform4(l,ir,o)}var y=this._inv?-1:1,D=this.table;for(o>>=2;o>=2;o>>=2){a=t/o<<1;var W=a>>>2;for(l=0;l<t;l+=a)for(var Ee=l+W,dt=l,Ht=0;dt<Ee;dt+=2,Ht+=o){const ir=dt,Hr=ir+W,Bn=Hr+W,Vn=Bn+W,Wr=e[ir],ps=e[ir+1],il=e[Hr],gl=e[Hr+1],ml=e[Bn],sl=e[Bn+1],ll=e[Vn],rl=e[Vn+1],th=Wr,nh=ps,bh=D[Ht],Fh=y*D[Ht+1],Bh=il*bh-gl*Fh,Ed=il*Fh+gl*bh,Td=D[2*Ht],td=y*D[2*Ht+1],Fd=ml*Td-sl*td,Ld=ml*td+sl*Td,Ud=D[3*Ht],Xd=y*D[3*Ht+1],wd=ll*Ud-rl*Xd,zd=ll*Xd+rl*Ud,Rd=th+Fd,op=nh+Ld,Wd=th-Fd,Op=nh-Ld,ep=Bh+wd,zp=Ed+zd,Kd=y*(Bh-wd),Ap=y*(Ed-zd),Ip=Rd+ep,Yh=op+zp,Ad=Rd-ep,kp=op-zp,up=Wd+Ap,rp=Op-Kd,fd=Wd-Ap,Cp=Op+Kd;e[ir]=Ip,e[ir+1]=Yh,e[Hr]=up,e[Hr+1]=rp,e[Bn]=Ad,e[Bn+1]=kp,e[Vn]=fd,e[Vn+1]=Cp}}};FFT.prototype._singleTransform2=function r(e,t,n){const o=this._out,a=this._data,l=a[t],s=a[t+1],m=a[t+n],y=a[t+n+1],D=l+m,W=s+y,Ee=l-m,dt=s-y;o[e]=D,o[e+1]=W,o[e+2]=Ee,o[e+3]=dt};FFT.prototype._singleTransform4=function r(e,t,n){const o=this._out,a=this._data,l=this._inv?-1:1,s=n*2,m=n*3,y=a[t],D=a[t+1],W=a[t+n],Ee=a[t+n+1],dt=a[t+s],Ht=a[t+s+1],ir=a[t+m],Hr=a[t+m+1],Bn=y+dt,Vn=D+Ht,Wr=y-dt,ps=D-Ht,il=W+ir,gl=Ee+Hr,ml=l*(W-ir),sl=l*(Ee-Hr),ll=Bn+il,rl=Vn+gl,th=Wr+sl,nh=ps-ml,bh=Bn-il,Fh=Vn-gl,Bh=Wr-sl,Ed=ps+ml;o[e]=ll,o[e+1]=rl,o[e+2]=th,o[e+3]=nh,o[e+4]=bh,o[e+5]=Fh,o[e+6]=Bh,o[e+7]=Ed};FFT.prototype._realTransform4=function r(){var e=this._out,t=this._csize,n=this._width,o=1<<n,a=t/o<<1,l,s,m=this._bitrev;if(a===4)for(l=0,s=0;l<t;l+=a,s++){const Up=m[s];this._singleRealTransform2(l,Up>>>1,o>>>1)}else for(l=0,s=0;l<t;l+=a,s++){const Up=m[s];this._singleRealTransform4(l,Up>>>1,o>>>1)}var y=this._inv?-1:1,D=this.table;for(o>>=2;o>=2;o>>=2){a=t/o<<1;var W=a>>>1,Ee=W>>>1,dt=Ee>>>1;for(l=0;l<t;l+=a)for(var Ht=0,ir=0;Ht<=dt;Ht+=2,ir+=o){var Hr=l+Ht,Bn=Hr+Ee,Vn=Bn+Ee,Wr=Vn+Ee,ps=e[Hr],il=e[Hr+1],gl=e[Bn],ml=e[Bn+1],sl=e[Vn],ll=e[Vn+1],rl=e[Wr],th=e[Wr+1],nh=ps,bh=il,Fh=D[ir],Bh=y*D[ir+1],Ed=gl*Fh-ml*Bh,Td=gl*Bh+ml*Fh,td=D[2*ir],Fd=y*D[2*ir+1],Ld=sl*td-ll*Fd,Ud=sl*Fd+ll*td,Xd=D[3*ir],wd=y*D[3*ir+1],zd=rl*Xd-th*wd,Rd=rl*wd+th*Xd,op=nh+Ld,Wd=bh+Ud,Op=nh-Ld,ep=bh-Ud,zp=Ed+zd,Kd=Td+Rd,Ap=y*(Ed-zd),Ip=y*(Td-Rd),Yh=op+zp,Ad=Wd+Kd,kp=Op+Ip,up=ep-Ap;if(e[Hr]=Yh,e[Hr+1]=Ad,e[Bn]=kp,e[Bn+1]=up,Ht===0){var rp=op-zp,fd=Wd-Kd;e[Vn]=rp,e[Vn+1]=fd;continue}if(Ht!==dt){var Cp=Op,Fp=-ep,_p=op,kd=-Wd,$f=-y*Ip,Uf=-y*Ap,cd=-y*Kd,cp=-y*zp,xp=Cp+$f,Ep=Fp+Uf,Vp=_p+cp,bd=kd-cd,Yd=l+Ee-Ht,np=l+W-Ht;e[Yd]=xp,e[Yd+1]=Ep,e[np]=Vp,e[np+1]=bd}}}};FFT.prototype._singleRealTransform2=function r(e,t,n){const o=this._out,a=this._data,l=a[t],s=a[t+n],m=l+s,y=l-s;o[e]=m,o[e+1]=0,o[e+2]=y,o[e+3]=0};FFT.prototype._singleRealTransform4=function r(e,t,n){const o=this._out,a=this._data,l=this._inv?-1:1,s=n*2,m=n*3,y=a[t],D=a[t+n],W=a[t+s],Ee=a[t+m],dt=y+W,Ht=y-W,ir=D+Ee,Hr=l*(D-Ee),Bn=dt+ir,Vn=Ht,Wr=-Hr,ps=dt-ir,il=Ht,gl=Hr;o[e]=Bn,o[e+1]=0,o[e+2]=Vn,o[e+3]=Wr,o[e+4]=ps,o[e+5]=0,o[e+6]=il,o[e+7]=gl};function convolutionSeparable(r,e,t,n){const o=new Array(r.length);let a,l,s,m;m=e[1],s=(m.length-1)/2,l=new Array(t+m.length-1),a=new Array(t);for(let y=0;y<n;y++){for(let D=0;D<t;D++)a[D]=r[y*t+D];directConvolution(a,m,l);for(let D=0;D<t;D++)o[y*t+D]=l[s+D]}m=e[0],s=(m.length-1)/2,l=new Array(n+m.length-1),a=new Array(n);for(let y=0;y<t;y++){for(let D=0;D<n;D++)a[D]=o[D*t+y];directConvolution(a,m,l);for(let D=0;D<n;D++)o[D*t+y]=l[s+D]}return o}const toString$1=Object.prototype.toString;function isAnyArray(r){const e=toString$1.call(r);return e.endsWith("Array]")&&!e.includes("Big")}function max$1(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(r))throw new TypeError("input must be an array");if(r.length===0)throw new TypeError("input must not be empty");var t=e.fromIndex,n=t===void 0?0:t,o=e.toIndex,a=o===void 0?r.length:o;if(n<0||n>=r.length||!Number.isInteger(n))throw new Error("fromIndex must be a positive integer smaller than length");if(a<=n||a>r.length||!Number.isInteger(a))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var l=r[n],s=n+1;s<a;s++)r[s]>l&&(l=r[s]);return l}function min$1(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(r))throw new TypeError("input must be an array");if(r.length===0)throw new TypeError("input must not be empty");var t=e.fromIndex,n=t===void 0?0:t,o=e.toIndex,a=o===void 0?r.length:o;if(n<0||n>=r.length||!Number.isInteger(n))throw new Error("fromIndex must be a positive integer smaller than length");if(a<=n||a>r.length||!Number.isInteger(a))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var l=r[n],s=n+1;s<a;s++)r[s]<l&&(l=r[s]);return l}function rescale(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(isAnyArray(r)){if(r.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var t;if(e.output!==void 0){if(!isAnyArray(e.output))throw new TypeError("output option must be an array if specified");t=e.output}else t=new Array(r.length);var n=min$1(r),o=max$1(r);if(n===o)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var a=e.min,l=a===void 0?e.autoMinMax?n:0:a,s=e.max,m=s===void 0?e.autoMinMax?o:1:s;if(l>=m)throw new RangeError("min option must be smaller than max option");for(var y=(m-l)/(o-n),D=0;D<r.length;D++)t[D]=(r[D]-n)*y+l;return t}const indent=" ".repeat(2),indentData=" ".repeat(4);function inspectMatrix(){return inspectMatrixWithOptions(this)}function inspectMatrixWithOptions(r,e={}){const{maxRows:t=15,maxColumns:n=10,maxNumSize:o=8,padMinus:a="auto"}=e;return`${r.constructor.name} {
${indent}[
${indentData}${inspectData(r,t,n,o,a)}
${indent}]
${indent}rows: ${r.rows}
${indent}columns: ${r.columns}
}`}function inspectData(r,e,t,n,o){const{rows:a,columns:l}=r,s=Math.min(a,e),m=Math.min(l,t),y=[];if(o==="auto"){o=!1;e:for(let D=0;D<s;D++)for(let W=0;W<m;W++)if(r.get(D,W)<0){o=!0;break e}}for(let D=0;D<s;D++){let W=[];for(let Ee=0;Ee<m;Ee++)W.push(formatNumber(r.get(D,Ee),n,o));y.push(`${W.join(" ")}`)}return m!==l&&(y[y.length-1]+=` ... ${l-t} more columns`),s!==a&&y.push(`... ${a-e} more rows`),y.join(`
${indentData}`)}function formatNumber(r,e,t){return(r>=0&&t?` ${formatNumber2(r,e-1)}`:formatNumber2(r,e)).padEnd(e)}function formatNumber2(r,e){let t=r.toString();if(t.length<=e)return t;let n=r.toFixed(e);if(n.length>e&&(n=r.toFixed(Math.max(0,e-(n.length-e)))),n.length<=e&&!n.startsWith("0.000")&&!n.startsWith("-0.000"))return n;let o=r.toExponential(e);return o.length>e&&(o=r.toExponential(Math.max(0,e-(o.length-e)))),o.slice(0)}function installMathOperations(r,e){r.prototype.add=function(n){return typeof n=="number"?this.addS(n):this.addM(n)},r.prototype.addS=function(n){for(let o=0;o<this.rows;o++)for(let a=0;a<this.columns;a++)this.set(o,a,this.get(o,a)+n);return this},r.prototype.addM=function(n){if(n=e.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let a=0;a<this.columns;a++)this.set(o,a,this.get(o,a)+n.get(o,a));return this},r.add=function(n,o){return new e(n).add(o)},r.prototype.sub=function(n){return typeof n=="number"?this.subS(n):this.subM(n)},r.prototype.subS=function(n){for(let o=0;o<this.rows;o++)for(let a=0;a<this.columns;a++)this.set(o,a,this.get(o,a)-n);return this},r.prototype.subM=function(n){if(n=e.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let a=0;a<this.columns;a++)this.set(o,a,this.get(o,a)-n.get(o,a));return this},r.sub=function(n,o){return new e(n).sub(o)},r.prototype.subtract=r.prototype.sub,r.prototype.subtractS=r.prototype.subS,r.prototype.subtractM=r.prototype.subM,r.subtract=r.sub,r.prototype.mul=function(n){return typeof n=="number"?this.mulS(n):this.mulM(n)},r.prototype.mulS=function(n){for(let o=0;o<this.rows;o++)for(let a=0;a<this.columns;a++)this.set(o,a,this.get(o,a)*n);return this},r.prototype.mulM=function(n){if(n=e.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let a=0;a<this.columns;a++)this.set(o,a,this.get(o,a)*n.get(o,a));return this},r.mul=function(n,o){return new e(n).mul(o)},r.prototype.multiply=r.prototype.mul,r.prototype.multiplyS=r.prototype.mulS,r.prototype.multiplyM=r.prototype.mulM,r.multiply=r.mul,r.prototype.div=function(n){return typeof n=="number"?this.divS(n):this.divM(n)},r.prototype.divS=function(n){for(let o=0;o<this.rows;o++)for(let a=0;a<this.columns;a++)this.set(o,a,this.get(o,a)/n);return this},r.prototype.divM=function(n){if(n=e.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let a=0;a<this.columns;a++)this.set(o,a,this.get(o,a)/n.get(o,a));return this},r.div=function(n,o){return new e(n).div(o)},r.prototype.divide=r.prototype.div,r.prototype.divideS=r.prototype.divS,r.prototype.divideM=r.prototype.divM,r.divide=r.div,r.prototype.mod=function(n){return typeof n=="number"?this.modS(n):this.modM(n)},r.prototype.modS=function(n){for(let o=0;o<this.rows;o++)for(let a=0;a<this.columns;a++)this.set(o,a,this.get(o,a)%n);return this},r.prototype.modM=function(n){if(n=e.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let a=0;a<this.columns;a++)this.set(o,a,this.get(o,a)%n.get(o,a));return this},r.mod=function(n,o){return new e(n).mod(o)},r.prototype.modulus=r.prototype.mod,r.prototype.modulusS=r.prototype.modS,r.prototype.modulusM=r.prototype.modM,r.modulus=r.mod,r.prototype.and=function(n){return typeof n=="number"?this.andS(n):this.andM(n)},r.prototype.andS=function(n){for(let o=0;o<this.rows;o++)for(let a=0;a<this.columns;a++)this.set(o,a,this.get(o,a)&n);return this},r.prototype.andM=function(n){if(n=e.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let a=0;a<this.columns;a++)this.set(o,a,this.get(o,a)&n.get(o,a));return this},r.and=function(n,o){return new e(n).and(o)},r.prototype.or=function(n){return typeof n=="number"?this.orS(n):this.orM(n)},r.prototype.orS=function(n){for(let o=0;o<this.rows;o++)for(let a=0;a<this.columns;a++)this.set(o,a,this.get(o,a)|n);return this},r.prototype.orM=function(n){if(n=e.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let a=0;a<this.columns;a++)this.set(o,a,this.get(o,a)|n.get(o,a));return this},r.or=function(n,o){return new e(n).or(o)},r.prototype.xor=function(n){return typeof n=="number"?this.xorS(n):this.xorM(n)},r.prototype.xorS=function(n){for(let o=0;o<this.rows;o++)for(let a=0;a<this.columns;a++)this.set(o,a,this.get(o,a)^n);return this},r.prototype.xorM=function(n){if(n=e.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let a=0;a<this.columns;a++)this.set(o,a,this.get(o,a)^n.get(o,a));return this},r.xor=function(n,o){return new e(n).xor(o)},r.prototype.leftShift=function(n){return typeof n=="number"?this.leftShiftS(n):this.leftShiftM(n)},r.prototype.leftShiftS=function(n){for(let o=0;o<this.rows;o++)for(let a=0;a<this.columns;a++)this.set(o,a,this.get(o,a)<<n);return this},r.prototype.leftShiftM=function(n){if(n=e.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let a=0;a<this.columns;a++)this.set(o,a,this.get(o,a)<<n.get(o,a));return this},r.leftShift=function(n,o){return new e(n).leftShift(o)},r.prototype.signPropagatingRightShift=function(n){return typeof n=="number"?this.signPropagatingRightShiftS(n):this.signPropagatingRightShiftM(n)},r.prototype.signPropagatingRightShiftS=function(n){for(let o=0;o<this.rows;o++)for(let a=0;a<this.columns;a++)this.set(o,a,this.get(o,a)>>n);return this},r.prototype.signPropagatingRightShiftM=function(n){if(n=e.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let a=0;a<this.columns;a++)this.set(o,a,this.get(o,a)>>n.get(o,a));return this},r.signPropagatingRightShift=function(n,o){return new e(n).signPropagatingRightShift(o)},r.prototype.rightShift=function(n){return typeof n=="number"?this.rightShiftS(n):this.rightShiftM(n)},r.prototype.rightShiftS=function(n){for(let o=0;o<this.rows;o++)for(let a=0;a<this.columns;a++)this.set(o,a,this.get(o,a)>>>n);return this},r.prototype.rightShiftM=function(n){if(n=e.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let a=0;a<this.columns;a++)this.set(o,a,this.get(o,a)>>>n.get(o,a));return this},r.rightShift=function(n,o){return new e(n).rightShift(o)},r.prototype.zeroFillRightShift=r.prototype.rightShift,r.prototype.zeroFillRightShiftS=r.prototype.rightShiftS,r.prototype.zeroFillRightShiftM=r.prototype.rightShiftM,r.zeroFillRightShift=r.rightShift,r.prototype.not=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,~this.get(n,o));return this},r.not=function(n){return new e(n).not()},r.prototype.abs=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.abs(this.get(n,o)));return this},r.abs=function(n){return new e(n).abs()},r.prototype.acos=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.acos(this.get(n,o)));return this},r.acos=function(n){return new e(n).acos()},r.prototype.acosh=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.acosh(this.get(n,o)));return this},r.acosh=function(n){return new e(n).acosh()},r.prototype.asin=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.asin(this.get(n,o)));return this},r.asin=function(n){return new e(n).asin()},r.prototype.asinh=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.asinh(this.get(n,o)));return this},r.asinh=function(n){return new e(n).asinh()},r.prototype.atan=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.atan(this.get(n,o)));return this},r.atan=function(n){return new e(n).atan()},r.prototype.atanh=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.atanh(this.get(n,o)));return this},r.atanh=function(n){return new e(n).atanh()},r.prototype.cbrt=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.cbrt(this.get(n,o)));return this},r.cbrt=function(n){return new e(n).cbrt()},r.prototype.ceil=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.ceil(this.get(n,o)));return this},r.ceil=function(n){return new e(n).ceil()},r.prototype.clz32=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.clz32(this.get(n,o)));return this},r.clz32=function(n){return new e(n).clz32()},r.prototype.cos=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.cos(this.get(n,o)));return this},r.cos=function(n){return new e(n).cos()},r.prototype.cosh=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.cosh(this.get(n,o)));return this},r.cosh=function(n){return new e(n).cosh()},r.prototype.exp=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.exp(this.get(n,o)));return this},r.exp=function(n){return new e(n).exp()},r.prototype.expm1=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.expm1(this.get(n,o)));return this},r.expm1=function(n){return new e(n).expm1()},r.prototype.floor=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.floor(this.get(n,o)));return this},r.floor=function(n){return new e(n).floor()},r.prototype.fround=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.fround(this.get(n,o)));return this},r.fround=function(n){return new e(n).fround()},r.prototype.log=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.log(this.get(n,o)));return this},r.log=function(n){return new e(n).log()},r.prototype.log1p=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.log1p(this.get(n,o)));return this},r.log1p=function(n){return new e(n).log1p()},r.prototype.log10=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.log10(this.get(n,o)));return this},r.log10=function(n){return new e(n).log10()},r.prototype.log2=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.log2(this.get(n,o)));return this},r.log2=function(n){return new e(n).log2()},r.prototype.round=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.round(this.get(n,o)));return this},r.round=function(n){return new e(n).round()},r.prototype.sign=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.sign(this.get(n,o)));return this},r.sign=function(n){return new e(n).sign()},r.prototype.sin=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.sin(this.get(n,o)));return this},r.sin=function(n){return new e(n).sin()},r.prototype.sinh=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.sinh(this.get(n,o)));return this},r.sinh=function(n){return new e(n).sinh()},r.prototype.sqrt=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.sqrt(this.get(n,o)));return this},r.sqrt=function(n){return new e(n).sqrt()},r.prototype.tan=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.tan(this.get(n,o)));return this},r.tan=function(n){return new e(n).tan()},r.prototype.tanh=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.tanh(this.get(n,o)));return this},r.tanh=function(n){return new e(n).tanh()},r.prototype.trunc=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.trunc(this.get(n,o)));return this},r.trunc=function(n){return new e(n).trunc()},r.pow=function(n,o){return new e(n).pow(o)},r.prototype.pow=function(n){return typeof n=="number"?this.powS(n):this.powM(n)},r.prototype.powS=function(n){for(let o=0;o<this.rows;o++)for(let a=0;a<this.columns;a++)this.set(o,a,Math.pow(this.get(o,a),n));return this},r.prototype.powM=function(n){if(n=e.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let a=0;a<this.columns;a++)this.set(o,a,Math.pow(this.get(o,a),n.get(o,a)));return this}}function checkRowIndex(r,e,t){let n=t?r.rows:r.rows-1;if(e<0||e>n)throw new RangeError("Row index out of range")}function checkColumnIndex(r,e,t){let n=t?r.columns:r.columns-1;if(e<0||e>n)throw new RangeError("Column index out of range")}function checkRowVector(r,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==r.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function checkColumnVector(r,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==r.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function checkRowIndices(r,e){if(!isAnyArray(e))throw new TypeError("row indices must be an array");for(let t=0;t<e.length;t++)if(e[t]<0||e[t]>=r.rows)throw new RangeError("row indices are out of range")}function checkColumnIndices(r,e){if(!isAnyArray(e))throw new TypeError("column indices must be an array");for(let t=0;t<e.length;t++)if(e[t]<0||e[t]>=r.columns)throw new RangeError("column indices are out of range")}function checkRange(r,e,t,n,o){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(checkNumber("startRow",e),checkNumber("endRow",t),checkNumber("startColumn",n),checkNumber("endColumn",o),e>t||n>o||e<0||e>=r.rows||t<0||t>=r.rows||n<0||n>=r.columns||o<0||o>=r.columns)throw new RangeError("Submatrix indices are out of range")}function newArray$2(r,e=0){let t=[];for(let n=0;n<r;n++)t.push(e);return t}function checkNumber(r,e){if(typeof e!="number")throw new TypeError(`${r} must be a number`)}function checkNonEmpty(r){if(r.isEmpty())throw new Error("Empty matrix has no elements to index")}function sumByRow(r){let e=newArray$2(r.rows);for(let t=0;t<r.rows;++t)for(let n=0;n<r.columns;++n)e[t]+=r.get(t,n);return e}function sumByColumn(r){let e=newArray$2(r.columns);for(let t=0;t<r.rows;++t)for(let n=0;n<r.columns;++n)e[n]+=r.get(t,n);return e}function sumAll(r){let e=0;for(let t=0;t<r.rows;t++)for(let n=0;n<r.columns;n++)e+=r.get(t,n);return e}function productByRow(r){let e=newArray$2(r.rows,1);for(let t=0;t<r.rows;++t)for(let n=0;n<r.columns;++n)e[t]*=r.get(t,n);return e}function productByColumn(r){let e=newArray$2(r.columns,1);for(let t=0;t<r.rows;++t)for(let n=0;n<r.columns;++n)e[n]*=r.get(t,n);return e}function productAll(r){let e=1;for(let t=0;t<r.rows;t++)for(let n=0;n<r.columns;n++)e*=r.get(t,n);return e}function varianceByRow(r,e,t){const n=r.rows,o=r.columns,a=[];for(let l=0;l<n;l++){let s=0,m=0,y=0;for(let D=0;D<o;D++)y=r.get(l,D)-t[l],s+=y,m+=y*y;e?a.push((m-s*s/o)/(o-1)):a.push((m-s*s/o)/o)}return a}function varianceByColumn(r,e,t){const n=r.rows,o=r.columns,a=[];for(let l=0;l<o;l++){let s=0,m=0,y=0;for(let D=0;D<n;D++)y=r.get(D,l)-t[l],s+=y,m+=y*y;e?a.push((m-s*s/n)/(n-1)):a.push((m-s*s/n)/n)}return a}function varianceAll(r,e,t){const n=r.rows,o=r.columns,a=n*o;let l=0,s=0,m=0;for(let y=0;y<n;y++)for(let D=0;D<o;D++)m=r.get(y,D)-t,l+=m,s+=m*m;return e?(s-l*l/a)/(a-1):(s-l*l/a)/a}function centerByRow(r,e){for(let t=0;t<r.rows;t++)for(let n=0;n<r.columns;n++)r.set(t,n,r.get(t,n)-e[t])}function centerByColumn(r,e){for(let t=0;t<r.rows;t++)for(let n=0;n<r.columns;n++)r.set(t,n,r.get(t,n)-e[n])}function centerAll(r,e){for(let t=0;t<r.rows;t++)for(let n=0;n<r.columns;n++)r.set(t,n,r.get(t,n)-e)}function getScaleByRow(r){const e=[];for(let t=0;t<r.rows;t++){let n=0;for(let o=0;o<r.columns;o++)n+=Math.pow(r.get(t,o),2)/(r.columns-1);e.push(Math.sqrt(n))}return e}function scaleByRow(r,e){for(let t=0;t<r.rows;t++)for(let n=0;n<r.columns;n++)r.set(t,n,r.get(t,n)/e[t])}function getScaleByColumn(r){const e=[];for(let t=0;t<r.columns;t++){let n=0;for(let o=0;o<r.rows;o++)n+=Math.pow(r.get(o,t),2)/(r.rows-1);e.push(Math.sqrt(n))}return e}function scaleByColumn(r,e){for(let t=0;t<r.rows;t++)for(let n=0;n<r.columns;n++)r.set(t,n,r.get(t,n)/e[n])}function getScaleAll(r){const e=r.size-1;let t=0;for(let n=0;n<r.columns;n++)for(let o=0;o<r.rows;o++)t+=Math.pow(r.get(o,n),2)/e;return Math.sqrt(t)}function scaleAll(r,e){for(let t=0;t<r.rows;t++)for(let n=0;n<r.columns;n++)r.set(t,n,r.get(t,n)/e)}class AbstractMatrix{static from1DArray(e,t,n){if(e*t!==n.length)throw new RangeError("data length does not match given dimensions");let a=new Matrix$2(e,t);for(let l=0;l<e;l++)for(let s=0;s<t;s++)a.set(l,s,n[l*t+s]);return a}static rowVector(e){let t=new Matrix$2(1,e.length);for(let n=0;n<e.length;n++)t.set(0,n,e[n]);return t}static columnVector(e){let t=new Matrix$2(e.length,1);for(let n=0;n<e.length;n++)t.set(n,0,e[n]);return t}static zeros(e,t){return new Matrix$2(e,t)}static ones(e,t){return new Matrix$2(e,t).fill(1)}static rand(e,t,n={}){if(typeof n!="object")throw new TypeError("options must be an object");const{random:o=Math.random}=n;let a=new Matrix$2(e,t);for(let l=0;l<e;l++)for(let s=0;s<t;s++)a.set(l,s,o());return a}static randInt(e,t,n={}){if(typeof n!="object")throw new TypeError("options must be an object");const{min:o=0,max:a=1e3,random:l=Math.random}=n;if(!Number.isInteger(o))throw new TypeError("min must be an integer");if(!Number.isInteger(a))throw new TypeError("max must be an integer");if(o>=a)throw new RangeError("min must be smaller than max");let s=a-o,m=new Matrix$2(e,t);for(let y=0;y<e;y++)for(let D=0;D<t;D++){let W=o+Math.round(l()*s);m.set(y,D,W)}return m}static eye(e,t,n){t===void 0&&(t=e),n===void 0&&(n=1);let o=Math.min(e,t),a=this.zeros(e,t);for(let l=0;l<o;l++)a.set(l,l,n);return a}static diag(e,t,n){let o=e.length;t===void 0&&(t=o),n===void 0&&(n=t);let a=Math.min(o,t,n),l=this.zeros(t,n);for(let s=0;s<a;s++)l.set(s,s,e[s]);return l}static min(e,t){e=this.checkMatrix(e),t=this.checkMatrix(t);let n=e.rows,o=e.columns,a=new Matrix$2(n,o);for(let l=0;l<n;l++)for(let s=0;s<o;s++)a.set(l,s,Math.min(e.get(l,s),t.get(l,s)));return a}static max(e,t){e=this.checkMatrix(e),t=this.checkMatrix(t);let n=e.rows,o=e.columns,a=new this(n,o);for(let l=0;l<n;l++)for(let s=0;s<o;s++)a.set(l,s,Math.max(e.get(l,s),t.get(l,s)));return a}static checkMatrix(e){return AbstractMatrix.isMatrix(e)?e:new Matrix$2(e)}static isMatrix(e){return e!=null&&e.klass==="Matrix"}get size(){return this.rows*this.columns}apply(e){if(typeof e!="function")throw new TypeError("callback must be a function");for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)e.call(this,t,n);return this}to1DArray(){let e=[];for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)e.push(this.get(t,n));return e}to2DArray(){let e=[];for(let t=0;t<this.rows;t++){e.push([]);for(let n=0;n<this.columns;n++)e[t].push(this.get(t,n))}return e}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let e=0;e<this.rows;e++)for(let t=0;t<=e;t++)if(this.get(e,t)!==this.get(t,e))return!1;return!0}return!1}isEchelonForm(){let e=0,t=0,n=-1,o=!0,a=!1;for(;e<this.rows&&o;){for(t=0,a=!1;t<this.columns&&a===!1;)this.get(e,t)===0?t++:this.get(e,t)===1&&t>n?(a=!0,n=t):(o=!1,a=!0);e++}return o}isReducedEchelonForm(){let e=0,t=0,n=-1,o=!0,a=!1;for(;e<this.rows&&o;){for(t=0,a=!1;t<this.columns&&a===!1;)this.get(e,t)===0?t++:this.get(e,t)===1&&t>n?(a=!0,n=t):(o=!1,a=!0);for(let l=t+1;l<this.rows;l++)this.get(e,l)!==0&&(o=!1);e++}return o}echelonForm(){let e=this.clone(),t=0,n=0;for(;t<e.rows&&n<e.columns;){let o=t;for(let a=t;a<e.rows;a++)e.get(a,n)>e.get(o,n)&&(o=a);if(e.get(o,n)===0)n++;else{e.swapRows(t,o);let a=e.get(t,n);for(let l=n;l<e.columns;l++)e.set(t,l,e.get(t,l)/a);for(let l=t+1;l<e.rows;l++){let s=e.get(l,n)/e.get(t,n);e.set(l,n,0);for(let m=n+1;m<e.columns;m++)e.set(l,m,e.get(l,m)-e.get(t,m)*s)}t++,n++}}return e}reducedEchelonForm(){let e=this.echelonForm(),t=e.columns,n=e.rows,o=n-1;for(;o>=0;)if(e.maxRow(o)===0)o--;else{let a=0,l=!1;for(;a<n&&l===!1;)e.get(o,a)===1?l=!0:a++;for(let s=0;s<o;s++){let m=e.get(s,a);for(let y=a;y<t;y++){let D=e.get(s,y)-m*e.get(o,y);e.set(s,y,D)}}o--}return e}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{rows:t=1,columns:n=1}=e;if(!Number.isInteger(t)||t<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(n)||n<=0)throw new TypeError("columns must be a positive integer");let o=new Matrix$2(this.rows*t,this.columns*n);for(let a=0;a<t;a++)for(let l=0;l<n;l++)o.setSubMatrix(this,this.rows*a,this.columns*l);return o}fill(e){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,e);return this}neg(){return this.mulS(-1)}getRow(e){checkRowIndex(this,e);let t=[];for(let n=0;n<this.columns;n++)t.push(this.get(e,n));return t}getRowVector(e){return Matrix$2.rowVector(this.getRow(e))}setRow(e,t){checkRowIndex(this,e),t=checkRowVector(this,t);for(let n=0;n<this.columns;n++)this.set(e,n,t[n]);return this}swapRows(e,t){checkRowIndex(this,e),checkRowIndex(this,t);for(let n=0;n<this.columns;n++){let o=this.get(e,n);this.set(e,n,this.get(t,n)),this.set(t,n,o)}return this}getColumn(e){checkColumnIndex(this,e);let t=[];for(let n=0;n<this.rows;n++)t.push(this.get(n,e));return t}getColumnVector(e){return Matrix$2.columnVector(this.getColumn(e))}setColumn(e,t){checkColumnIndex(this,e),t=checkColumnVector(this,t);for(let n=0;n<this.rows;n++)this.set(n,e,t[n]);return this}swapColumns(e,t){checkColumnIndex(this,e),checkColumnIndex(this,t);for(let n=0;n<this.rows;n++){let o=this.get(n,e);this.set(n,e,this.get(n,t)),this.set(n,t,o)}return this}addRowVector(e){e=checkRowVector(this,e);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)+e[n]);return this}subRowVector(e){e=checkRowVector(this,e);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)-e[n]);return this}mulRowVector(e){e=checkRowVector(this,e);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)*e[n]);return this}divRowVector(e){e=checkRowVector(this,e);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)/e[n]);return this}addColumnVector(e){e=checkColumnVector(this,e);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)+e[t]);return this}subColumnVector(e){e=checkColumnVector(this,e);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)-e[t]);return this}mulColumnVector(e){e=checkColumnVector(this,e);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)*e[t]);return this}divColumnVector(e){e=checkColumnVector(this,e);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)/e[t]);return this}mulRow(e,t){checkRowIndex(this,e);for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)*t);return this}mulColumn(e,t){checkColumnIndex(this,e);for(let n=0;n<this.rows;n++)this.set(n,e,this.get(n,e)*t);return this}max(e){if(this.isEmpty())return NaN;switch(e){case"row":{const t=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.get(n,o)>t[n]&&(t[n]=this.get(n,o));return t}case"column":{const t=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.get(n,o)>t[o]&&(t[o]=this.get(n,o));return t}case void 0:{let t=this.get(0,0);for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.get(n,o)>t&&(t=this.get(n,o));return t}default:throw new Error(`invalid option: ${e}`)}}maxIndex(){checkNonEmpty(this);let e=this.get(0,0),t=[0,0];for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.get(n,o)>e&&(e=this.get(n,o),t[0]=n,t[1]=o);return t}min(e){if(this.isEmpty())return NaN;switch(e){case"row":{const t=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.get(n,o)<t[n]&&(t[n]=this.get(n,o));return t}case"column":{const t=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.get(n,o)<t[o]&&(t[o]=this.get(n,o));return t}case void 0:{let t=this.get(0,0);for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.get(n,o)<t&&(t=this.get(n,o));return t}default:throw new Error(`invalid option: ${e}`)}}minIndex(){checkNonEmpty(this);let e=this.get(0,0),t=[0,0];for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.get(n,o)<e&&(e=this.get(n,o),t[0]=n,t[1]=o);return t}maxRow(e){if(checkRowIndex(this,e),this.isEmpty())return NaN;let t=this.get(e,0);for(let n=1;n<this.columns;n++)this.get(e,n)>t&&(t=this.get(e,n));return t}maxRowIndex(e){checkRowIndex(this,e),checkNonEmpty(this);let t=this.get(e,0),n=[e,0];for(let o=1;o<this.columns;o++)this.get(e,o)>t&&(t=this.get(e,o),n[1]=o);return n}minRow(e){if(checkRowIndex(this,e),this.isEmpty())return NaN;let t=this.get(e,0);for(let n=1;n<this.columns;n++)this.get(e,n)<t&&(t=this.get(e,n));return t}minRowIndex(e){checkRowIndex(this,e),checkNonEmpty(this);let t=this.get(e,0),n=[e,0];for(let o=1;o<this.columns;o++)this.get(e,o)<t&&(t=this.get(e,o),n[1]=o);return n}maxColumn(e){if(checkColumnIndex(this,e),this.isEmpty())return NaN;let t=this.get(0,e);for(let n=1;n<this.rows;n++)this.get(n,e)>t&&(t=this.get(n,e));return t}maxColumnIndex(e){checkColumnIndex(this,e),checkNonEmpty(this);let t=this.get(0,e),n=[0,e];for(let o=1;o<this.rows;o++)this.get(o,e)>t&&(t=this.get(o,e),n[0]=o);return n}minColumn(e){if(checkColumnIndex(this,e),this.isEmpty())return NaN;let t=this.get(0,e);for(let n=1;n<this.rows;n++)this.get(n,e)<t&&(t=this.get(n,e));return t}minColumnIndex(e){checkColumnIndex(this,e),checkNonEmpty(this);let t=this.get(0,e),n=[0,e];for(let o=1;o<this.rows;o++)this.get(o,e)<t&&(t=this.get(o,e),n[0]=o);return n}diag(){let e=Math.min(this.rows,this.columns),t=[];for(let n=0;n<e;n++)t.push(this.get(n,n));return t}norm(e="frobenius"){let t=0;if(e==="max")return this.max();if(e==="frobenius"){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)t=t+this.get(n,o)*this.get(n,o);return Math.sqrt(t)}else throw new RangeError(`unknown norm type: ${e}`)}cumulativeSum(){let e=0;for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)e+=this.get(t,n),this.set(t,n,e);return this}dot(e){AbstractMatrix.isMatrix(e)&&(e=e.to1DArray());let t=this.to1DArray();if(t.length!==e.length)throw new RangeError("vectors do not have the same size");let n=0;for(let o=0;o<t.length;o++)n+=t[o]*e[o];return n}mmul(e){e=Matrix$2.checkMatrix(e);let t=this.rows,n=this.columns,o=e.columns,a=new Matrix$2(t,o),l=new Float64Array(n);for(let s=0;s<o;s++){for(let m=0;m<n;m++)l[m]=e.get(m,s);for(let m=0;m<t;m++){let y=0;for(let D=0;D<n;D++)y+=this.get(m,D)*l[D];a.set(m,s,y)}}return a}strassen2x2(e){e=Matrix$2.checkMatrix(e);let t=new Matrix$2(2,2);const n=this.get(0,0),o=e.get(0,0),a=this.get(0,1),l=e.get(0,1),s=this.get(1,0),m=e.get(1,0),y=this.get(1,1),D=e.get(1,1),W=(n+y)*(o+D),Ee=(s+y)*o,dt=n*(l-D),Ht=y*(m-o),ir=(n+a)*D,Hr=(s-n)*(o+l),Bn=(a-y)*(m+D),Vn=W+Ht-ir+Bn,Wr=dt+ir,ps=Ee+Ht,il=W-Ee+dt+Hr;return t.set(0,0,Vn),t.set(0,1,Wr),t.set(1,0,ps),t.set(1,1,il),t}strassen3x3(e){e=Matrix$2.checkMatrix(e);let t=new Matrix$2(3,3);const n=this.get(0,0),o=this.get(0,1),a=this.get(0,2),l=this.get(1,0),s=this.get(1,1),m=this.get(1,2),y=this.get(2,0),D=this.get(2,1),W=this.get(2,2),Ee=e.get(0,0),dt=e.get(0,1),Ht=e.get(0,2),ir=e.get(1,0),Hr=e.get(1,1),Bn=e.get(1,2),Vn=e.get(2,0),Wr=e.get(2,1),ps=e.get(2,2),il=(n+o+a-l-s-D-W)*Hr,gl=(n-l)*(-dt+Hr),ml=s*(-Ee+dt+ir-Hr-Bn-Vn+ps),sl=(-n+l+s)*(Ee-dt+Hr),ll=(l+s)*(-Ee+dt),rl=n*Ee,th=(-n+y+D)*(Ee-Ht+Bn),nh=(-n+y)*(Ht-Bn),bh=(y+D)*(-Ee+Ht),Fh=(n+o+a-s-m-y-D)*Bn,Bh=D*(-Ee+Ht+ir-Hr-Bn-Vn+Wr),Ed=(-a+D+W)*(Hr+Vn-Wr),Td=(a-W)*(Hr-Wr),td=a*Vn,Fd=(D+W)*(-Vn+Wr),Ld=(-a+s+m)*(Bn+Vn-ps),Ud=(a-m)*(Bn-ps),Xd=(s+m)*(-Vn+ps),wd=o*ir,zd=m*Wr,Rd=l*Ht,op=y*dt,Wd=W*ps,Op=rl+td+wd,ep=il+sl+ll+rl+Ed+td+Fd,zp=rl+th+bh+Fh+td+Ld+Xd,Kd=gl+ml+sl+rl+td+Ld+Ud,Ap=gl+sl+ll+rl+zd,Ip=td+Ld+Ud+Xd+Rd,Yh=rl+th+nh+Bh+Ed+Td+td,Ad=Ed+Td+td+Fd+op,kp=rl+th+nh+bh+Wd;return t.set(0,0,Op),t.set(0,1,ep),t.set(0,2,zp),t.set(1,0,Kd),t.set(1,1,Ap),t.set(1,2,Ip),t.set(2,0,Yh),t.set(2,1,Ad),t.set(2,2,kp),t}mmulStrassen(e){e=Matrix$2.checkMatrix(e);let t=this.clone(),n=t.rows,o=t.columns,a=e.rows,l=e.columns;o!==a&&console.warn(`Multiplying ${n} x ${o} and ${a} x ${l} matrix: dimensions do not match.`);function s(W,Ee,dt){let Ht=W.rows,ir=W.columns;if(Ht===Ee&&ir===dt)return W;{let Hr=AbstractMatrix.zeros(Ee,dt);return Hr=Hr.setSubMatrix(W,0,0),Hr}}let m=Math.max(n,a),y=Math.max(o,l);t=s(t,m,y),e=s(e,m,y);function D(W,Ee,dt,Ht){if(dt<=512||Ht<=512)return W.mmul(Ee);dt%2===1&&Ht%2===1?(W=s(W,dt+1,Ht+1),Ee=s(Ee,dt+1,Ht+1)):dt%2===1?(W=s(W,dt+1,Ht),Ee=s(Ee,dt+1,Ht)):Ht%2===1&&(W=s(W,dt,Ht+1),Ee=s(Ee,dt,Ht+1));let ir=parseInt(W.rows/2,10),Hr=parseInt(W.columns/2,10),Bn=W.subMatrix(0,ir-1,0,Hr-1),Vn=Ee.subMatrix(0,ir-1,0,Hr-1),Wr=W.subMatrix(0,ir-1,Hr,W.columns-1),ps=Ee.subMatrix(0,ir-1,Hr,Ee.columns-1),il=W.subMatrix(ir,W.rows-1,0,Hr-1),gl=Ee.subMatrix(ir,Ee.rows-1,0,Hr-1),ml=W.subMatrix(ir,W.rows-1,Hr,W.columns-1),sl=Ee.subMatrix(ir,Ee.rows-1,Hr,Ee.columns-1),ll=D(AbstractMatrix.add(Bn,ml),AbstractMatrix.add(Vn,sl),ir,Hr),rl=D(AbstractMatrix.add(il,ml),Vn,ir,Hr),th=D(Bn,AbstractMatrix.sub(ps,sl),ir,Hr),nh=D(ml,AbstractMatrix.sub(gl,Vn),ir,Hr),bh=D(AbstractMatrix.add(Bn,Wr),sl,ir,Hr),Fh=D(AbstractMatrix.sub(il,Bn),AbstractMatrix.add(Vn,ps),ir,Hr),Bh=D(AbstractMatrix.sub(Wr,ml),AbstractMatrix.add(gl,sl),ir,Hr),Ed=AbstractMatrix.add(ll,nh);Ed.sub(bh),Ed.add(Bh);let Td=AbstractMatrix.add(th,bh),td=AbstractMatrix.add(rl,nh),Fd=AbstractMatrix.sub(ll,rl);Fd.add(th),Fd.add(Fh);let Ld=AbstractMatrix.zeros(2*Ed.rows,2*Ed.columns);return Ld=Ld.setSubMatrix(Ed,0,0),Ld=Ld.setSubMatrix(Td,Ed.rows,0),Ld=Ld.setSubMatrix(td,0,Ed.columns),Ld=Ld.setSubMatrix(Fd,Ed.rows,Ed.columns),Ld.subMatrix(0,dt-1,0,Ht-1)}return D(t,e,m,y)}scaleRows(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:t=0,max:n=1}=e;if(!Number.isFinite(t))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(t>=n)throw new RangeError("min must be smaller than max");let o=new Matrix$2(this.rows,this.columns);for(let a=0;a<this.rows;a++){const l=this.getRow(a);l.length>0&&rescale(l,{min:t,max:n,output:l}),o.setRow(a,l)}return o}scaleColumns(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:t=0,max:n=1}=e;if(!Number.isFinite(t))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(t>=n)throw new RangeError("min must be smaller than max");let o=new Matrix$2(this.rows,this.columns);for(let a=0;a<this.columns;a++){const l=this.getColumn(a);l.length&&rescale(l,{min:t,max:n,output:l}),o.setColumn(a,l)}return o}flipRows(){const e=Math.ceil(this.columns/2);for(let t=0;t<this.rows;t++)for(let n=0;n<e;n++){let o=this.get(t,n),a=this.get(t,this.columns-1-n);this.set(t,n,a),this.set(t,this.columns-1-n,o)}return this}flipColumns(){const e=Math.ceil(this.rows/2);for(let t=0;t<this.columns;t++)for(let n=0;n<e;n++){let o=this.get(n,t),a=this.get(this.rows-1-n,t);this.set(n,t,a),this.set(this.rows-1-n,t,o)}return this}kroneckerProduct(e){e=Matrix$2.checkMatrix(e);let t=this.rows,n=this.columns,o=e.rows,a=e.columns,l=new Matrix$2(t*o,n*a);for(let s=0;s<t;s++)for(let m=0;m<n;m++)for(let y=0;y<o;y++)for(let D=0;D<a;D++)l.set(o*s+y,a*m+D,this.get(s,m)*e.get(y,D));return l}kroneckerSum(e){if(e=Matrix$2.checkMatrix(e),!this.isSquare()||!e.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let t=this.rows,n=e.rows,o=this.kroneckerProduct(Matrix$2.eye(n,n)),a=Matrix$2.eye(t,t).kroneckerProduct(e);return o.add(a)}transpose(){let e=new Matrix$2(this.columns,this.rows);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)e.set(n,t,this.get(t,n));return e}sortRows(e=compareNumbers){for(let t=0;t<this.rows;t++)this.setRow(t,this.getRow(t).sort(e));return this}sortColumns(e=compareNumbers){for(let t=0;t<this.columns;t++)this.setColumn(t,this.getColumn(t).sort(e));return this}subMatrix(e,t,n,o){checkRange(this,e,t,n,o);let a=new Matrix$2(t-e+1,o-n+1);for(let l=e;l<=t;l++)for(let s=n;s<=o;s++)a.set(l-e,s-n,this.get(l,s));return a}subMatrixRow(e,t,n){if(t===void 0&&(t=0),n===void 0&&(n=this.columns-1),t>n||t<0||t>=this.columns||n<0||n>=this.columns)throw new RangeError("Argument out of range");let o=new Matrix$2(e.length,n-t+1);for(let a=0;a<e.length;a++)for(let l=t;l<=n;l++){if(e[a]<0||e[a]>=this.rows)throw new RangeError(`Row index out of range: ${e[a]}`);o.set(a,l-t,this.get(e[a],l))}return o}subMatrixColumn(e,t,n){if(t===void 0&&(t=0),n===void 0&&(n=this.rows-1),t>n||t<0||t>=this.rows||n<0||n>=this.rows)throw new RangeError("Argument out of range");let o=new Matrix$2(n-t+1,e.length);for(let a=0;a<e.length;a++)for(let l=t;l<=n;l++){if(e[a]<0||e[a]>=this.columns)throw new RangeError(`Column index out of range: ${e[a]}`);o.set(l-t,a,this.get(l,e[a]))}return o}setSubMatrix(e,t,n){if(e=Matrix$2.checkMatrix(e),e.isEmpty())return this;let o=t+e.rows-1,a=n+e.columns-1;checkRange(this,t,o,n,a);for(let l=0;l<e.rows;l++)for(let s=0;s<e.columns;s++)this.set(t+l,n+s,e.get(l,s));return this}selection(e,t){checkRowIndices(this,e),checkColumnIndices(this,t);let n=new Matrix$2(e.length,t.length);for(let o=0;o<e.length;o++){let a=e[o];for(let l=0;l<t.length;l++){let s=t[l];n.set(o,l,this.get(a,s))}}return n}trace(){let e=Math.min(this.rows,this.columns),t=0;for(let n=0;n<e;n++)t+=this.get(n,n);return t}clone(){let e=new Matrix$2(this.rows,this.columns);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)e.set(t,n,this.get(t,n));return e}sum(e){switch(e){case"row":return sumByRow(this);case"column":return sumByColumn(this);case void 0:return sumAll(this);default:throw new Error(`invalid option: ${e}`)}}product(e){switch(e){case"row":return productByRow(this);case"column":return productByColumn(this);case void 0:return productAll(this);default:throw new Error(`invalid option: ${e}`)}}mean(e){const t=this.sum(e);switch(e){case"row":{for(let n=0;n<this.rows;n++)t[n]/=this.columns;return t}case"column":{for(let n=0;n<this.columns;n++)t[n]/=this.rows;return t}case void 0:return t/this.size;default:throw new Error(`invalid option: ${e}`)}}variance(e,t={}){if(typeof e=="object"&&(t=e,e=void 0),typeof t!="object")throw new TypeError("options must be an object");const{unbiased:n=!0,mean:o=this.mean(e)}=t;if(typeof n!="boolean")throw new TypeError("unbiased must be a boolean");switch(e){case"row":{if(!isAnyArray(o))throw new TypeError("mean must be an array");return varianceByRow(this,n,o)}case"column":{if(!isAnyArray(o))throw new TypeError("mean must be an array");return varianceByColumn(this,n,o)}case void 0:{if(typeof o!="number")throw new TypeError("mean must be a number");return varianceAll(this,n,o)}default:throw new Error(`invalid option: ${e}`)}}standardDeviation(e,t){typeof e=="object"&&(t=e,e=void 0);const n=this.variance(e,t);if(e===void 0)return Math.sqrt(n);for(let o=0;o<n.length;o++)n[o]=Math.sqrt(n[o]);return n}center(e,t={}){if(typeof e=="object"&&(t=e,e=void 0),typeof t!="object")throw new TypeError("options must be an object");const{center:n=this.mean(e)}=t;switch(e){case"row":{if(!isAnyArray(n))throw new TypeError("center must be an array");return centerByRow(this,n),this}case"column":{if(!isAnyArray(n))throw new TypeError("center must be an array");return centerByColumn(this,n),this}case void 0:{if(typeof n!="number")throw new TypeError("center must be a number");return centerAll(this,n),this}default:throw new Error(`invalid option: ${e}`)}}scale(e,t={}){if(typeof e=="object"&&(t=e,e=void 0),typeof t!="object")throw new TypeError("options must be an object");let n=t.scale;switch(e){case"row":{if(n===void 0)n=getScaleByRow(this);else if(!isAnyArray(n))throw new TypeError("scale must be an array");return scaleByRow(this,n),this}case"column":{if(n===void 0)n=getScaleByColumn(this);else if(!isAnyArray(n))throw new TypeError("scale must be an array");return scaleByColumn(this,n),this}case void 0:{if(n===void 0)n=getScaleAll(this);else if(typeof n!="number")throw new TypeError("scale must be a number");return scaleAll(this,n),this}default:throw new Error(`invalid option: ${e}`)}}toString(e){return inspectMatrixWithOptions(this,e)}}AbstractMatrix.prototype.klass="Matrix";typeof Symbol<"u"&&(AbstractMatrix.prototype[Symbol.for("nodejs.util.inspect.custom")]=inspectMatrix);function compareNumbers(r,e){return r-e}function isArrayOfNumbers(r){return r.every(e=>typeof e=="number")}AbstractMatrix.random=AbstractMatrix.rand;AbstractMatrix.randomInt=AbstractMatrix.randInt;AbstractMatrix.diagonal=AbstractMatrix.diag;AbstractMatrix.prototype.diagonal=AbstractMatrix.prototype.diag;AbstractMatrix.identity=AbstractMatrix.eye;AbstractMatrix.prototype.negate=AbstractMatrix.prototype.neg;AbstractMatrix.prototype.tensorProduct=AbstractMatrix.prototype.kroneckerProduct;let Matrix$2=class QS extends AbstractMatrix{constructor(e,t){if(super(),QS.isMatrix(e))return e.clone();if(Number.isInteger(e)&&e>=0)if(this.data=[],Number.isInteger(t)&&t>=0)for(let n=0;n<e;n++)this.data.push(new Float64Array(t));else throw new TypeError("nColumns must be a positive integer");else if(isAnyArray(e)){const n=e;if(e=n.length,t=e?n[0].length:0,typeof t!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let o=0;o<e;o++){if(n[o].length!==t)throw new RangeError("Inconsistent array dimensions");if(!isArrayOfNumbers(n[o]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(n[o]))}}else throw new TypeError("First argument must be a positive number or an array");this.rows=e,this.columns=t}set(e,t,n){return this.data[e][t]=n,this}get(e,t){return this.data[e][t]}removeRow(e){return checkRowIndex(this,e),this.data.splice(e,1),this.rows-=1,this}addRow(e,t){return t===void 0&&(t=e,e=this.rows),checkRowIndex(this,e,!0),t=Float64Array.from(checkRowVector(this,t)),this.data.splice(e,0,t),this.rows+=1,this}removeColumn(e){checkColumnIndex(this,e);for(let t=0;t<this.rows;t++){const n=new Float64Array(this.columns-1);for(let o=0;o<e;o++)n[o]=this.data[t][o];for(let o=e+1;o<this.columns;o++)n[o-1]=this.data[t][o];this.data[t]=n}return this.columns-=1,this}addColumn(e,t){typeof t>"u"&&(t=e,e=this.columns),checkColumnIndex(this,e,!0),t=checkColumnVector(this,t);for(let n=0;n<this.rows;n++){const o=new Float64Array(this.columns+1);let a=0;for(;a<e;a++)o[a]=this.data[n][a];for(o[a++]=t[n];a<this.columns+1;a++)o[a]=this.data[n][a-1];this.data[n]=o}return this.columns+=1,this}};installMathOperations(AbstractMatrix,Matrix$2);class BaseView extends AbstractMatrix{constructor(e,t,n){super(),this.matrix=e,this.rows=t,this.columns=n}}class MatrixColumnView extends BaseView{constructor(e,t){checkColumnIndex(e,t),super(e,e.rows,1),this.column=t}set(e,t,n){return this.matrix.set(e,this.column,n),this}get(e){return this.matrix.get(e,this.column)}}class MatrixColumnSelectionView extends BaseView{constructor(e,t){checkColumnIndices(e,t),super(e,e.rows,t.length),this.columnIndices=t}set(e,t,n){return this.matrix.set(e,this.columnIndices[t],n),this}get(e,t){return this.matrix.get(e,this.columnIndices[t])}}class MatrixFlipColumnView extends BaseView{constructor(e){super(e,e.rows,e.columns)}set(e,t,n){return this.matrix.set(e,this.columns-t-1,n),this}get(e,t){return this.matrix.get(e,this.columns-t-1)}}class MatrixFlipRowView extends BaseView{constructor(e){super(e,e.rows,e.columns)}set(e,t,n){return this.matrix.set(this.rows-e-1,t,n),this}get(e,t){return this.matrix.get(this.rows-e-1,t)}}class MatrixRowView extends BaseView{constructor(e,t){checkRowIndex(e,t),super(e,1,e.columns),this.row=t}set(e,t,n){return this.matrix.set(this.row,t,n),this}get(e,t){return this.matrix.get(this.row,t)}}class MatrixRowSelectionView extends BaseView{constructor(e,t){checkRowIndices(e,t),super(e,t.length,e.columns),this.rowIndices=t}set(e,t,n){return this.matrix.set(this.rowIndices[e],t,n),this}get(e,t){return this.matrix.get(this.rowIndices[e],t)}}class MatrixSelectionView extends BaseView{constructor(e,t,n){checkRowIndices(e,t),checkColumnIndices(e,n),super(e,t.length,n.length),this.rowIndices=t,this.columnIndices=n}set(e,t,n){return this.matrix.set(this.rowIndices[e],this.columnIndices[t],n),this}get(e,t){return this.matrix.get(this.rowIndices[e],this.columnIndices[t])}}class MatrixSubView extends BaseView{constructor(e,t,n,o,a){checkRange(e,t,n,o,a),super(e,n-t+1,a-o+1),this.startRow=t,this.startColumn=o}set(e,t,n){return this.matrix.set(this.startRow+e,this.startColumn+t,n),this}get(e,t){return this.matrix.get(this.startRow+e,this.startColumn+t)}}let MatrixTransposeView$1=class extends BaseView{constructor(e){super(e,e.columns,e.rows)}set(e,t,n){return this.matrix.set(t,e,n),this}get(e,t){return this.matrix.get(t,e)}};class WrapperMatrix1D extends AbstractMatrix{constructor(e,t={}){const{rows:n=1}=t;if(e.length%n!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=n,this.columns=e.length/n,this.data=e}set(e,t,n){let o=this._calculateIndex(e,t);return this.data[o]=n,this}get(e,t){let n=this._calculateIndex(e,t);return this.data[n]}_calculateIndex(e,t){return e*this.columns+t}}class WrapperMatrix2D extends AbstractMatrix{constructor(e){super(),this.data=e,this.rows=e.length,this.columns=e[0].length}set(e,t,n){return this.data[e][t]=n,this}get(e,t){return this.data[e][t]}}function wrap(r,e){if(isAnyArray(r))return r[0]&&isAnyArray(r[0])?new WrapperMatrix2D(r):new WrapperMatrix1D(r,e);throw new Error("the argument is not an array")}class LuDecomposition{constructor(e){e=WrapperMatrix2D.checkMatrix(e);let t=e.clone(),n=t.rows,o=t.columns,a=new Float64Array(n),l=1,s,m,y,D,W,Ee,dt,Ht,ir;for(s=0;s<n;s++)a[s]=s;for(Ht=new Float64Array(n),m=0;m<o;m++){for(s=0;s<n;s++)Ht[s]=t.get(s,m);for(s=0;s<n;s++){for(ir=Math.min(s,m),W=0,y=0;y<ir;y++)W+=t.get(s,y)*Ht[y];Ht[s]-=W,t.set(s,m,Ht[s])}for(D=m,s=m+1;s<n;s++)Math.abs(Ht[s])>Math.abs(Ht[D])&&(D=s);if(D!==m){for(y=0;y<o;y++)Ee=t.get(D,y),t.set(D,y,t.get(m,y)),t.set(m,y,Ee);dt=a[D],a[D]=a[m],a[m]=dt,l=-l}if(m<n&&t.get(m,m)!==0)for(s=m+1;s<n;s++)t.set(s,m,t.get(s,m)/t.get(m,m))}this.LU=t,this.pivotVector=a,this.pivotSign=l}isSingular(){let e=this.LU,t=e.columns;for(let n=0;n<t;n++)if(e.get(n,n)===0)return!0;return!1}solve(e){e=Matrix$2.checkMatrix(e);let t=this.LU;if(t.rows!==e.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let o=e.columns,a=e.subMatrixRow(this.pivotVector,0,o-1),l=t.columns,s,m,y;for(y=0;y<l;y++)for(s=y+1;s<l;s++)for(m=0;m<o;m++)a.set(s,m,a.get(s,m)-a.get(y,m)*t.get(s,y));for(y=l-1;y>=0;y--){for(m=0;m<o;m++)a.set(y,m,a.get(y,m)/t.get(y,y));for(s=0;s<y;s++)for(m=0;m<o;m++)a.set(s,m,a.get(s,m)-a.get(y,m)*t.get(s,y))}return a}get determinant(){let e=this.LU;if(!e.isSquare())throw new Error("Matrix must be square");let t=this.pivotSign,n=e.columns;for(let o=0;o<n;o++)t*=e.get(o,o);return t}get lowerTriangularMatrix(){let e=this.LU,t=e.rows,n=e.columns,o=new Matrix$2(t,n);for(let a=0;a<t;a++)for(let l=0;l<n;l++)a>l?o.set(a,l,e.get(a,l)):a===l?o.set(a,l,1):o.set(a,l,0);return o}get upperTriangularMatrix(){let e=this.LU,t=e.rows,n=e.columns,o=new Matrix$2(t,n);for(let a=0;a<t;a++)for(let l=0;l<n;l++)a<=l?o.set(a,l,e.get(a,l)):o.set(a,l,0);return o}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function hypotenuse$1(r,e){let t=0;return Math.abs(r)>Math.abs(e)?(t=e/r,Math.abs(r)*Math.sqrt(1+t*t)):e!==0?(t=r/e,Math.abs(e)*Math.sqrt(1+t*t)):0}class QrDecomposition{constructor(e){e=WrapperMatrix2D.checkMatrix(e);let t=e.clone(),n=e.rows,o=e.columns,a=new Float64Array(o),l,s,m,y;for(m=0;m<o;m++){let D=0;for(l=m;l<n;l++)D=hypotenuse$1(D,t.get(l,m));if(D!==0){for(t.get(m,m)<0&&(D=-D),l=m;l<n;l++)t.set(l,m,t.get(l,m)/D);for(t.set(m,m,t.get(m,m)+1),s=m+1;s<o;s++){for(y=0,l=m;l<n;l++)y+=t.get(l,m)*t.get(l,s);for(y=-y/t.get(m,m),l=m;l<n;l++)t.set(l,s,t.get(l,s)+y*t.get(l,m))}}a[m]=-D}this.QR=t,this.Rdiag=a}solve(e){e=Matrix$2.checkMatrix(e);let t=this.QR,n=t.rows;if(e.rows!==n)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let o=e.columns,a=e.clone(),l=t.columns,s,m,y,D;for(y=0;y<l;y++)for(m=0;m<o;m++){for(D=0,s=y;s<n;s++)D+=t.get(s,y)*a.get(s,m);for(D=-D/t.get(y,y),s=y;s<n;s++)a.set(s,m,a.get(s,m)+D*t.get(s,y))}for(y=l-1;y>=0;y--){for(m=0;m<o;m++)a.set(y,m,a.get(y,m)/this.Rdiag[y]);for(s=0;s<y;s++)for(m=0;m<o;m++)a.set(s,m,a.get(s,m)-a.get(y,m)*t.get(s,y))}return a.subMatrix(0,l-1,0,o-1)}isFullRank(){let e=this.QR.columns;for(let t=0;t<e;t++)if(this.Rdiag[t]===0)return!1;return!0}get upperTriangularMatrix(){let e=this.QR,t=e.columns,n=new Matrix$2(t,t),o,a;for(o=0;o<t;o++)for(a=0;a<t;a++)o<a?n.set(o,a,e.get(o,a)):o===a?n.set(o,a,this.Rdiag[o]):n.set(o,a,0);return n}get orthogonalMatrix(){let e=this.QR,t=e.rows,n=e.columns,o=new Matrix$2(t,n),a,l,s,m;for(s=n-1;s>=0;s--){for(a=0;a<t;a++)o.set(a,s,0);for(o.set(s,s,1),l=s;l<n;l++)if(e.get(s,s)!==0){for(m=0,a=s;a<t;a++)m+=e.get(a,s)*o.get(a,l);for(m=-m/e.get(s,s),a=s;a<t;a++)o.set(a,l,o.get(a,l)+m*e.get(a,s))}}return o}}class SingularValueDecomposition{constructor(e,t={}){if(e=WrapperMatrix2D.checkMatrix(e),e.isEmpty())throw new Error("Matrix must be non-empty");let n=e.rows,o=e.columns;const{computeLeftSingularVectors:a=!0,computeRightSingularVectors:l=!0,autoTranspose:s=!1}=t;let m=!!a,y=!!l,D=!1,W;if(n<o)if(!s)W=e.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{W=e.transpose(),n=W.rows,o=W.columns,D=!0;let rl=m;m=y,y=rl}else W=e.clone();let Ee=Math.min(n,o),dt=Math.min(n+1,o),Ht=new Float64Array(dt),ir=new Matrix$2(n,Ee),Hr=new Matrix$2(o,o),Bn=new Float64Array(o),Vn=new Float64Array(n),Wr=new Float64Array(dt);for(let rl=0;rl<dt;rl++)Wr[rl]=rl;let ps=Math.min(n-1,o),il=Math.max(0,Math.min(o-2,n)),gl=Math.max(ps,il);for(let rl=0;rl<gl;rl++){if(rl<ps){Ht[rl]=0;for(let th=rl;th<n;th++)Ht[rl]=hypotenuse$1(Ht[rl],W.get(th,rl));if(Ht[rl]!==0){W.get(rl,rl)<0&&(Ht[rl]=-Ht[rl]);for(let th=rl;th<n;th++)W.set(th,rl,W.get(th,rl)/Ht[rl]);W.set(rl,rl,W.get(rl,rl)+1)}Ht[rl]=-Ht[rl]}for(let th=rl+1;th<o;th++){if(rl<ps&&Ht[rl]!==0){let nh=0;for(let bh=rl;bh<n;bh++)nh+=W.get(bh,rl)*W.get(bh,th);nh=-nh/W.get(rl,rl);for(let bh=rl;bh<n;bh++)W.set(bh,th,W.get(bh,th)+nh*W.get(bh,rl))}Bn[th]=W.get(rl,th)}if(m&&rl<ps)for(let th=rl;th<n;th++)ir.set(th,rl,W.get(th,rl));if(rl<il){Bn[rl]=0;for(let th=rl+1;th<o;th++)Bn[rl]=hypotenuse$1(Bn[rl],Bn[th]);if(Bn[rl]!==0){Bn[rl+1]<0&&(Bn[rl]=0-Bn[rl]);for(let th=rl+1;th<o;th++)Bn[th]/=Bn[rl];Bn[rl+1]+=1}if(Bn[rl]=-Bn[rl],rl+1<n&&Bn[rl]!==0){for(let th=rl+1;th<n;th++)Vn[th]=0;for(let th=rl+1;th<n;th++)for(let nh=rl+1;nh<o;nh++)Vn[th]+=Bn[nh]*W.get(th,nh);for(let th=rl+1;th<o;th++){let nh=-Bn[th]/Bn[rl+1];for(let bh=rl+1;bh<n;bh++)W.set(bh,th,W.get(bh,th)+nh*Vn[bh])}}if(y)for(let th=rl+1;th<o;th++)Hr.set(th,rl,Bn[th])}}let ml=Math.min(o,n+1);if(ps<o&&(Ht[ps]=W.get(ps,ps)),n<ml&&(Ht[ml-1]=0),il+1<ml&&(Bn[il]=W.get(il,ml-1)),Bn[ml-1]=0,m){for(let rl=ps;rl<Ee;rl++){for(let th=0;th<n;th++)ir.set(th,rl,0);ir.set(rl,rl,1)}for(let rl=ps-1;rl>=0;rl--)if(Ht[rl]!==0){for(let th=rl+1;th<Ee;th++){let nh=0;for(let bh=rl;bh<n;bh++)nh+=ir.get(bh,rl)*ir.get(bh,th);nh=-nh/ir.get(rl,rl);for(let bh=rl;bh<n;bh++)ir.set(bh,th,ir.get(bh,th)+nh*ir.get(bh,rl))}for(let th=rl;th<n;th++)ir.set(th,rl,-ir.get(th,rl));ir.set(rl,rl,1+ir.get(rl,rl));for(let th=0;th<rl-1;th++)ir.set(th,rl,0)}else{for(let th=0;th<n;th++)ir.set(th,rl,0);ir.set(rl,rl,1)}}if(y)for(let rl=o-1;rl>=0;rl--){if(rl<il&&Bn[rl]!==0)for(let th=rl+1;th<o;th++){let nh=0;for(let bh=rl+1;bh<o;bh++)nh+=Hr.get(bh,rl)*Hr.get(bh,th);nh=-nh/Hr.get(rl+1,rl);for(let bh=rl+1;bh<o;bh++)Hr.set(bh,th,Hr.get(bh,th)+nh*Hr.get(bh,rl))}for(let th=0;th<o;th++)Hr.set(th,rl,0);Hr.set(rl,rl,1)}let sl=ml-1,ll=Number.EPSILON;for(;ml>0;){let rl,th;for(rl=ml-2;rl>=-1&&rl!==-1;rl--){const nh=Number.MIN_VALUE+ll*Math.abs(Ht[rl]+Math.abs(Ht[rl+1]));if(Math.abs(Bn[rl])<=nh||Number.isNaN(Bn[rl])){Bn[rl]=0;break}}if(rl===ml-2)th=4;else{let nh;for(nh=ml-1;nh>=rl&&nh!==rl;nh--){let bh=(nh!==ml?Math.abs(Bn[nh]):0)+(nh!==rl+1?Math.abs(Bn[nh-1]):0);if(Math.abs(Ht[nh])<=ll*bh){Ht[nh]=0;break}}nh===rl?th=3:nh===ml-1?th=1:(th=2,rl=nh)}switch(rl++,th){case 1:{let nh=Bn[ml-2];Bn[ml-2]=0;for(let bh=ml-2;bh>=rl;bh--){let Fh=hypotenuse$1(Ht[bh],nh),Bh=Ht[bh]/Fh,Ed=nh/Fh;if(Ht[bh]=Fh,bh!==rl&&(nh=-Ed*Bn[bh-1],Bn[bh-1]=Bh*Bn[bh-1]),y)for(let Td=0;Td<o;Td++)Fh=Bh*Hr.get(Td,bh)+Ed*Hr.get(Td,ml-1),Hr.set(Td,ml-1,-Ed*Hr.get(Td,bh)+Bh*Hr.get(Td,ml-1)),Hr.set(Td,bh,Fh)}break}case 2:{let nh=Bn[rl-1];Bn[rl-1]=0;for(let bh=rl;bh<ml;bh++){let Fh=hypotenuse$1(Ht[bh],nh),Bh=Ht[bh]/Fh,Ed=nh/Fh;if(Ht[bh]=Fh,nh=-Ed*Bn[bh],Bn[bh]=Bh*Bn[bh],m)for(let Td=0;Td<n;Td++)Fh=Bh*ir.get(Td,bh)+Ed*ir.get(Td,rl-1),ir.set(Td,rl-1,-Ed*ir.get(Td,bh)+Bh*ir.get(Td,rl-1)),ir.set(Td,bh,Fh)}break}case 3:{const nh=Math.max(Math.abs(Ht[ml-1]),Math.abs(Ht[ml-2]),Math.abs(Bn[ml-2]),Math.abs(Ht[rl]),Math.abs(Bn[rl])),bh=Ht[ml-1]/nh,Fh=Ht[ml-2]/nh,Bh=Bn[ml-2]/nh,Ed=Ht[rl]/nh,Td=Bn[rl]/nh,td=((Fh+bh)*(Fh-bh)+Bh*Bh)/2,Fd=bh*Bh*(bh*Bh);let Ld=0;(td!==0||Fd!==0)&&(td<0?Ld=0-Math.sqrt(td*td+Fd):Ld=Math.sqrt(td*td+Fd),Ld=Fd/(td+Ld));let Ud=(Ed+bh)*(Ed-bh)+Ld,Xd=Ed*Td;for(let wd=rl;wd<ml-1;wd++){let zd=hypotenuse$1(Ud,Xd);zd===0&&(zd=Number.MIN_VALUE);let Rd=Ud/zd,op=Xd/zd;if(wd!==rl&&(Bn[wd-1]=zd),Ud=Rd*Ht[wd]+op*Bn[wd],Bn[wd]=Rd*Bn[wd]-op*Ht[wd],Xd=op*Ht[wd+1],Ht[wd+1]=Rd*Ht[wd+1],y)for(let Wd=0;Wd<o;Wd++)zd=Rd*Hr.get(Wd,wd)+op*Hr.get(Wd,wd+1),Hr.set(Wd,wd+1,-op*Hr.get(Wd,wd)+Rd*Hr.get(Wd,wd+1)),Hr.set(Wd,wd,zd);if(zd=hypotenuse$1(Ud,Xd),zd===0&&(zd=Number.MIN_VALUE),Rd=Ud/zd,op=Xd/zd,Ht[wd]=zd,Ud=Rd*Bn[wd]+op*Ht[wd+1],Ht[wd+1]=-op*Bn[wd]+Rd*Ht[wd+1],Xd=op*Bn[wd+1],Bn[wd+1]=Rd*Bn[wd+1],m&&wd<n-1)for(let Wd=0;Wd<n;Wd++)zd=Rd*ir.get(Wd,wd)+op*ir.get(Wd,wd+1),ir.set(Wd,wd+1,-op*ir.get(Wd,wd)+Rd*ir.get(Wd,wd+1)),ir.set(Wd,wd,zd)}Bn[ml-2]=Ud;break}case 4:{if(Ht[rl]<=0&&(Ht[rl]=Ht[rl]<0?-Ht[rl]:0,y))for(let nh=0;nh<=sl;nh++)Hr.set(nh,rl,-Hr.get(nh,rl));for(;rl<sl&&!(Ht[rl]>=Ht[rl+1]);){let nh=Ht[rl];if(Ht[rl]=Ht[rl+1],Ht[rl+1]=nh,y&&rl<o-1)for(let bh=0;bh<o;bh++)nh=Hr.get(bh,rl+1),Hr.set(bh,rl+1,Hr.get(bh,rl)),Hr.set(bh,rl,nh);if(m&&rl<n-1)for(let bh=0;bh<n;bh++)nh=ir.get(bh,rl+1),ir.set(bh,rl+1,ir.get(bh,rl)),ir.set(bh,rl,nh);rl++}ml--;break}}}if(D){let rl=Hr;Hr=ir,ir=rl}this.m=n,this.n=o,this.s=Ht,this.U=ir,this.V=Hr}solve(e){let t=e,n=this.threshold,o=this.s.length,a=Matrix$2.zeros(o,o);for(let Ee=0;Ee<o;Ee++)Math.abs(this.s[Ee])<=n?a.set(Ee,Ee,0):a.set(Ee,Ee,1/this.s[Ee]);let l=this.U,s=this.rightSingularVectors,m=s.mmul(a),y=s.rows,D=l.rows,W=Matrix$2.zeros(y,D);for(let Ee=0;Ee<y;Ee++)for(let dt=0;dt<D;dt++){let Ht=0;for(let ir=0;ir<o;ir++)Ht+=m.get(Ee,ir)*l.get(dt,ir);W.set(Ee,dt,Ht)}return W.mmul(t)}solveForDiagonal(e){return this.solve(Matrix$2.diag(e))}inverse(){let e=this.V,t=this.threshold,n=e.rows,o=e.columns,a=new Matrix$2(n,this.s.length);for(let D=0;D<n;D++)for(let W=0;W<o;W++)Math.abs(this.s[W])>t&&a.set(D,W,e.get(D,W)/this.s[W]);let l=this.U,s=l.rows,m=l.columns,y=new Matrix$2(n,s);for(let D=0;D<n;D++)for(let W=0;W<s;W++){let Ee=0;for(let dt=0;dt<m;dt++)Ee+=a.get(D,dt)*l.get(W,dt);y.set(D,W,Ee)}return y}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let e=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,t=0,n=this.s;for(let o=0,a=n.length;o<a;o++)n[o]>e&&t++;return t}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return Matrix$2.diag(this.s)}}function inverse(r,e=!1){return r=WrapperMatrix2D.checkMatrix(r),e?new SingularValueDecomposition(r).inverse():solve(r,Matrix$2.eye(r.rows))}function solve(r,e,t=!1){return r=WrapperMatrix2D.checkMatrix(r),e=WrapperMatrix2D.checkMatrix(e),t?new SingularValueDecomposition(r).solve(e):r.isSquare()?new LuDecomposition(r).solve(e):new QrDecomposition(r).solve(e)}function determinant(r){if(r=Matrix$2.checkMatrix(r),r.isSquare()){if(r.columns===0)return 1;let e,t,n,o;if(r.columns===2)return e=r.get(0,0),t=r.get(0,1),n=r.get(1,0),o=r.get(1,1),e*o-t*n;if(r.columns===3){let a,l,s;return a=new MatrixSelectionView(r,[1,2],[1,2]),l=new MatrixSelectionView(r,[1,2],[0,2]),s=new MatrixSelectionView(r,[1,2],[0,1]),e=r.get(0,0),t=r.get(0,1),n=r.get(0,2),e*determinant(a)-t*determinant(l)+n*determinant(s)}else return new LuDecomposition(r).determinant}else throw Error("determinant can only be calculated for a square matrix")}function xrange(r,e){let t=[];for(let n=0;n<r;n++)n!==e&&t.push(n);return t}function dependenciesOneRow(r,e,t,n=1e-9,o=1e-9){if(r>o)return new Array(e.rows+1).fill(0);{let a=e.addRow(t,[0]);for(let l=0;l<a.rows;l++)Math.abs(a.get(l,0))<n&&a.set(l,0,0);return a.to1DArray()}}function linearDependencies(r,e={}){const{thresholdValue:t=1e-9,thresholdError:n=1e-9}=e;r=Matrix$2.checkMatrix(r);let o=r.rows,a=new Matrix$2(o,o);for(let l=0;l<o;l++){let s=Matrix$2.columnVector(r.getRow(l)),m=r.subMatrixRow(xrange(o,l)).transpose(),D=new SingularValueDecomposition(m).solve(s),W=Matrix$2.sub(s,m.mmul(D)).abs().max();a.setRow(l,dependenciesOneRow(W,D,l,t,n))}return a}function pseudoInverse(r,e=Number.EPSILON){if(r=Matrix$2.checkMatrix(r),r.isEmpty())return r.transpose();let t=new SingularValueDecomposition(r,{autoTranspose:!0}),n=t.leftSingularVectors,o=t.rightSingularVectors,a=t.diagonal;for(let l=0;l<a.length;l++)Math.abs(a[l])>e?a[l]=1/a[l]:a[l]=0;return o.mmul(Matrix$2.diag(a).mmul(n.transpose()))}function covariance(r,e=r,t={}){r=new Matrix$2(r);let n=!1;if(typeof e=="object"&&!Matrix$2.isMatrix(e)&&!isAnyArray(e)?(t=e,e=r,n=!0):e=new Matrix$2(e),r.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:o=!0}=t;o&&(r=r.center("column"),n||(e=e.center("column")));const a=r.transpose().mmul(e);for(let l=0;l<a.rows;l++)for(let s=0;s<a.columns;s++)a.set(l,s,a.get(l,s)*(1/(r.rows-1)));return a}function correlation(r,e=r,t={}){r=new Matrix$2(r);let n=!1;if(typeof e=="object"&&!Matrix$2.isMatrix(e)&&!isAnyArray(e)?(t=e,e=r,n=!0):e=new Matrix$2(e),r.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:o=!0,scale:a=!0}=t;o&&(r.center("column"),n||e.center("column")),a&&(r.scale("column"),n||e.scale("column"));const l=r.standardDeviation("column",{unbiased:!0}),s=n?l:e.standardDeviation("column",{unbiased:!0}),m=r.transpose().mmul(e);for(let y=0;y<m.rows;y++)for(let D=0;D<m.columns;D++)m.set(y,D,m.get(y,D)*(1/(l[y]*s[D]))*(1/(r.rows-1)));return m}class EigenvalueDecomposition{constructor(e,t={}){const{assumeSymmetric:n=!1}=t;if(e=WrapperMatrix2D.checkMatrix(e),!e.isSquare())throw new Error("Matrix is not a square matrix");if(e.isEmpty())throw new Error("Matrix must be non-empty");let o=e.columns,a=new Matrix$2(o,o),l=new Float64Array(o),s=new Float64Array(o),m=e,y,D,W=!1;if(n?W=!0:W=e.isSymmetric(),W){for(y=0;y<o;y++)for(D=0;D<o;D++)a.set(y,D,m.get(y,D));tred2(o,s,l,a),tql2(o,s,l,a)}else{let Ee=new Matrix$2(o,o),dt=new Float64Array(o);for(D=0;D<o;D++)for(y=0;y<o;y++)Ee.set(y,D,m.get(y,D));orthes(o,Ee,dt,a),hqr2(o,s,l,a,Ee)}this.n=o,this.e=s,this.d=l,this.V=a}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let e=this.n,t=this.e,n=this.d,o=new Matrix$2(e,e),a,l;for(a=0;a<e;a++){for(l=0;l<e;l++)o.set(a,l,0);o.set(a,a,n[a]),t[a]>0?o.set(a,a+1,t[a]):t[a]<0&&o.set(a,a-1,t[a])}return o}}function tred2(r,e,t,n){let o,a,l,s,m,y,D,W;for(m=0;m<r;m++)t[m]=n.get(r-1,m);for(s=r-1;s>0;s--){for(W=0,l=0,y=0;y<s;y++)W=W+Math.abs(t[y]);if(W===0)for(e[s]=t[s-1],m=0;m<s;m++)t[m]=n.get(s-1,m),n.set(s,m,0),n.set(m,s,0);else{for(y=0;y<s;y++)t[y]/=W,l+=t[y]*t[y];for(o=t[s-1],a=Math.sqrt(l),o>0&&(a=-a),e[s]=W*a,l=l-o*a,t[s-1]=o-a,m=0;m<s;m++)e[m]=0;for(m=0;m<s;m++){for(o=t[m],n.set(m,s,o),a=e[m]+n.get(m,m)*o,y=m+1;y<=s-1;y++)a+=n.get(y,m)*t[y],e[y]+=n.get(y,m)*o;e[m]=a}for(o=0,m=0;m<s;m++)e[m]/=l,o+=e[m]*t[m];for(D=o/(l+l),m=0;m<s;m++)e[m]-=D*t[m];for(m=0;m<s;m++){for(o=t[m],a=e[m],y=m;y<=s-1;y++)n.set(y,m,n.get(y,m)-(o*e[y]+a*t[y]));t[m]=n.get(s-1,m),n.set(s,m,0)}}t[s]=l}for(s=0;s<r-1;s++){if(n.set(r-1,s,n.get(s,s)),n.set(s,s,1),l=t[s+1],l!==0){for(y=0;y<=s;y++)t[y]=n.get(y,s+1)/l;for(m=0;m<=s;m++){for(a=0,y=0;y<=s;y++)a+=n.get(y,s+1)*n.get(y,m);for(y=0;y<=s;y++)n.set(y,m,n.get(y,m)-a*t[y])}}for(y=0;y<=s;y++)n.set(y,s+1,0)}for(m=0;m<r;m++)t[m]=n.get(r-1,m),n.set(r-1,m,0);n.set(r-1,r-1,1),e[0]=0}function tql2(r,e,t,n){let o,a,l,s,m,y,D,W,Ee,dt,Ht,ir,Hr,Bn,Vn,Wr;for(l=1;l<r;l++)e[l-1]=e[l];e[r-1]=0;let ps=0,il=0,gl=Number.EPSILON;for(y=0;y<r;y++){for(il=Math.max(il,Math.abs(t[y])+Math.abs(e[y])),D=y;D<r&&!(Math.abs(e[D])<=gl*il);)D++;if(D>y)do{for(o=t[y],W=(t[y+1]-o)/(2*e[y]),Ee=hypotenuse$1(W,1),W<0&&(Ee=-Ee),t[y]=e[y]/(W+Ee),t[y+1]=e[y]*(W+Ee),dt=t[y+1],a=o-t[y],l=y+2;l<r;l++)t[l]-=a;for(ps=ps+a,W=t[D],Ht=1,ir=Ht,Hr=Ht,Bn=e[y+1],Vn=0,Wr=0,l=D-1;l>=y;l--)for(Hr=ir,ir=Ht,Wr=Vn,o=Ht*e[l],a=Ht*W,Ee=hypotenuse$1(W,e[l]),e[l+1]=Vn*Ee,Vn=e[l]/Ee,Ht=W/Ee,W=Ht*t[l]-Vn*o,t[l+1]=a+Vn*(Ht*o+Vn*t[l]),m=0;m<r;m++)a=n.get(m,l+1),n.set(m,l+1,Vn*n.get(m,l)+Ht*a),n.set(m,l,Ht*n.get(m,l)-Vn*a);W=-Vn*Wr*Hr*Bn*e[y]/dt,e[y]=Vn*W,t[y]=Ht*W}while(Math.abs(e[y])>gl*il);t[y]=t[y]+ps,e[y]=0}for(l=0;l<r-1;l++){for(m=l,W=t[l],s=l+1;s<r;s++)t[s]<W&&(m=s,W=t[s]);if(m!==l)for(t[m]=t[l],t[l]=W,s=0;s<r;s++)W=n.get(s,l),n.set(s,l,n.get(s,m)),n.set(s,m,W)}}function orthes(r,e,t,n){let o=0,a=r-1,l,s,m,y,D,W,Ee;for(W=o+1;W<=a-1;W++){for(Ee=0,y=W;y<=a;y++)Ee=Ee+Math.abs(e.get(y,W-1));if(Ee!==0){for(m=0,y=a;y>=W;y--)t[y]=e.get(y,W-1)/Ee,m+=t[y]*t[y];for(s=Math.sqrt(m),t[W]>0&&(s=-s),m=m-t[W]*s,t[W]=t[W]-s,D=W;D<r;D++){for(l=0,y=a;y>=W;y--)l+=t[y]*e.get(y,D);for(l=l/m,y=W;y<=a;y++)e.set(y,D,e.get(y,D)-l*t[y])}for(y=0;y<=a;y++){for(l=0,D=a;D>=W;D--)l+=t[D]*e.get(y,D);for(l=l/m,D=W;D<=a;D++)e.set(y,D,e.get(y,D)-l*t[D])}t[W]=Ee*t[W],e.set(W,W-1,Ee*s)}}for(y=0;y<r;y++)for(D=0;D<r;D++)n.set(y,D,y===D?1:0);for(W=a-1;W>=o+1;W--)if(e.get(W,W-1)!==0){for(y=W+1;y<=a;y++)t[y]=e.get(y,W-1);for(D=W;D<=a;D++){for(s=0,y=W;y<=a;y++)s+=t[y]*n.get(y,D);for(s=s/t[W]/e.get(W,W-1),y=W;y<=a;y++)n.set(y,D,n.get(y,D)+s*t[y])}}}function hqr2(r,e,t,n,o){let a=r-1,l=0,s=r-1,m=Number.EPSILON,y=0,D=0,W=0,Ee=0,dt=0,Ht=0,ir=0,Hr=0,Bn,Vn,Wr,ps,il,gl,ml,sl,ll,rl,th,nh,bh,Fh,Bh;for(Bn=0;Bn<r;Bn++)for((Bn<l||Bn>s)&&(t[Bn]=o.get(Bn,Bn),e[Bn]=0),Vn=Math.max(Bn-1,0);Vn<r;Vn++)D=D+Math.abs(o.get(Bn,Vn));for(;a>=l;){for(ps=a;ps>l&&(Ht=Math.abs(o.get(ps-1,ps-1))+Math.abs(o.get(ps,ps)),Ht===0&&(Ht=D),!(Math.abs(o.get(ps,ps-1))<m*Ht));)ps--;if(ps===a)o.set(a,a,o.get(a,a)+y),t[a]=o.get(a,a),e[a]=0,a--,Hr=0;else if(ps===a-1){if(ml=o.get(a,a-1)*o.get(a-1,a),W=(o.get(a-1,a-1)-o.get(a,a))/2,Ee=W*W+ml,ir=Math.sqrt(Math.abs(Ee)),o.set(a,a,o.get(a,a)+y),o.set(a-1,a-1,o.get(a-1,a-1)+y),sl=o.get(a,a),Ee>=0){for(ir=W>=0?W+ir:W-ir,t[a-1]=sl+ir,t[a]=t[a-1],ir!==0&&(t[a]=sl-ml/ir),e[a-1]=0,e[a]=0,sl=o.get(a,a-1),Ht=Math.abs(sl)+Math.abs(ir),W=sl/Ht,Ee=ir/Ht,dt=Math.sqrt(W*W+Ee*Ee),W=W/dt,Ee=Ee/dt,Vn=a-1;Vn<r;Vn++)ir=o.get(a-1,Vn),o.set(a-1,Vn,Ee*ir+W*o.get(a,Vn)),o.set(a,Vn,Ee*o.get(a,Vn)-W*ir);for(Bn=0;Bn<=a;Bn++)ir=o.get(Bn,a-1),o.set(Bn,a-1,Ee*ir+W*o.get(Bn,a)),o.set(Bn,a,Ee*o.get(Bn,a)-W*ir);for(Bn=l;Bn<=s;Bn++)ir=n.get(Bn,a-1),n.set(Bn,a-1,Ee*ir+W*n.get(Bn,a)),n.set(Bn,a,Ee*n.get(Bn,a)-W*ir)}else t[a-1]=sl+W,t[a]=sl+W,e[a-1]=ir,e[a]=-ir;a=a-2,Hr=0}else{if(sl=o.get(a,a),ll=0,ml=0,ps<a&&(ll=o.get(a-1,a-1),ml=o.get(a,a-1)*o.get(a-1,a)),Hr===10){for(y+=sl,Bn=l;Bn<=a;Bn++)o.set(Bn,Bn,o.get(Bn,Bn)-sl);Ht=Math.abs(o.get(a,a-1))+Math.abs(o.get(a-1,a-2)),sl=ll=.75*Ht,ml=-.4375*Ht*Ht}if(Hr===30&&(Ht=(ll-sl)/2,Ht=Ht*Ht+ml,Ht>0)){for(Ht=Math.sqrt(Ht),ll<sl&&(Ht=-Ht),Ht=sl-ml/((ll-sl)/2+Ht),Bn=l;Bn<=a;Bn++)o.set(Bn,Bn,o.get(Bn,Bn)-Ht);y+=Ht,sl=ll=ml=.964}for(Hr=Hr+1,il=a-2;il>=ps&&(ir=o.get(il,il),dt=sl-ir,Ht=ll-ir,W=(dt*Ht-ml)/o.get(il+1,il)+o.get(il,il+1),Ee=o.get(il+1,il+1)-ir-dt-Ht,dt=o.get(il+2,il+1),Ht=Math.abs(W)+Math.abs(Ee)+Math.abs(dt),W=W/Ht,Ee=Ee/Ht,dt=dt/Ht,!(il===ps||Math.abs(o.get(il,il-1))*(Math.abs(Ee)+Math.abs(dt))<m*(Math.abs(W)*(Math.abs(o.get(il-1,il-1))+Math.abs(ir)+Math.abs(o.get(il+1,il+1))))));)il--;for(Bn=il+2;Bn<=a;Bn++)o.set(Bn,Bn-2,0),Bn>il+2&&o.set(Bn,Bn-3,0);for(Wr=il;Wr<=a-1&&(Fh=Wr!==a-1,Wr!==il&&(W=o.get(Wr,Wr-1),Ee=o.get(Wr+1,Wr-1),dt=Fh?o.get(Wr+2,Wr-1):0,sl=Math.abs(W)+Math.abs(Ee)+Math.abs(dt),sl!==0&&(W=W/sl,Ee=Ee/sl,dt=dt/sl)),sl!==0);Wr++)if(Ht=Math.sqrt(W*W+Ee*Ee+dt*dt),W<0&&(Ht=-Ht),Ht!==0){for(Wr!==il?o.set(Wr,Wr-1,-Ht*sl):ps!==il&&o.set(Wr,Wr-1,-o.get(Wr,Wr-1)),W=W+Ht,sl=W/Ht,ll=Ee/Ht,ir=dt/Ht,Ee=Ee/W,dt=dt/W,Vn=Wr;Vn<r;Vn++)W=o.get(Wr,Vn)+Ee*o.get(Wr+1,Vn),Fh&&(W=W+dt*o.get(Wr+2,Vn),o.set(Wr+2,Vn,o.get(Wr+2,Vn)-W*ir)),o.set(Wr,Vn,o.get(Wr,Vn)-W*sl),o.set(Wr+1,Vn,o.get(Wr+1,Vn)-W*ll);for(Bn=0;Bn<=Math.min(a,Wr+3);Bn++)W=sl*o.get(Bn,Wr)+ll*o.get(Bn,Wr+1),Fh&&(W=W+ir*o.get(Bn,Wr+2),o.set(Bn,Wr+2,o.get(Bn,Wr+2)-W*dt)),o.set(Bn,Wr,o.get(Bn,Wr)-W),o.set(Bn,Wr+1,o.get(Bn,Wr+1)-W*Ee);for(Bn=l;Bn<=s;Bn++)W=sl*n.get(Bn,Wr)+ll*n.get(Bn,Wr+1),Fh&&(W=W+ir*n.get(Bn,Wr+2),n.set(Bn,Wr+2,n.get(Bn,Wr+2)-W*dt)),n.set(Bn,Wr,n.get(Bn,Wr)-W),n.set(Bn,Wr+1,n.get(Bn,Wr+1)-W*Ee)}}}if(D!==0){for(a=r-1;a>=0;a--)if(W=t[a],Ee=e[a],Ee===0)for(ps=a,o.set(a,a,1),Bn=a-1;Bn>=0;Bn--){for(ml=o.get(Bn,Bn)-W,dt=0,Vn=ps;Vn<=a;Vn++)dt=dt+o.get(Bn,Vn)*o.get(Vn,a);if(e[Bn]<0)ir=ml,Ht=dt;else if(ps=Bn,e[Bn]===0?o.set(Bn,a,ml!==0?-dt/ml:-dt/(m*D)):(sl=o.get(Bn,Bn+1),ll=o.get(Bn+1,Bn),Ee=(t[Bn]-W)*(t[Bn]-W)+e[Bn]*e[Bn],gl=(sl*Ht-ir*dt)/Ee,o.set(Bn,a,gl),o.set(Bn+1,a,Math.abs(sl)>Math.abs(ir)?(-dt-ml*gl)/sl:(-Ht-ll*gl)/ir)),gl=Math.abs(o.get(Bn,a)),m*gl*gl>1)for(Vn=Bn;Vn<=a;Vn++)o.set(Vn,a,o.get(Vn,a)/gl)}else if(Ee<0)for(ps=a-1,Math.abs(o.get(a,a-1))>Math.abs(o.get(a-1,a))?(o.set(a-1,a-1,Ee/o.get(a,a-1)),o.set(a-1,a,-(o.get(a,a)-W)/o.get(a,a-1))):(Bh=cdiv(0,-o.get(a-1,a),o.get(a-1,a-1)-W,Ee),o.set(a-1,a-1,Bh[0]),o.set(a-1,a,Bh[1])),o.set(a,a-1,0),o.set(a,a,1),Bn=a-2;Bn>=0;Bn--){for(rl=0,th=0,Vn=ps;Vn<=a;Vn++)rl=rl+o.get(Bn,Vn)*o.get(Vn,a-1),th=th+o.get(Bn,Vn)*o.get(Vn,a);if(ml=o.get(Bn,Bn)-W,e[Bn]<0)ir=ml,dt=rl,Ht=th;else if(ps=Bn,e[Bn]===0?(Bh=cdiv(-rl,-th,ml,Ee),o.set(Bn,a-1,Bh[0]),o.set(Bn,a,Bh[1])):(sl=o.get(Bn,Bn+1),ll=o.get(Bn+1,Bn),nh=(t[Bn]-W)*(t[Bn]-W)+e[Bn]*e[Bn]-Ee*Ee,bh=(t[Bn]-W)*2*Ee,nh===0&&bh===0&&(nh=m*D*(Math.abs(ml)+Math.abs(Ee)+Math.abs(sl)+Math.abs(ll)+Math.abs(ir))),Bh=cdiv(sl*dt-ir*rl+Ee*th,sl*Ht-ir*th-Ee*rl,nh,bh),o.set(Bn,a-1,Bh[0]),o.set(Bn,a,Bh[1]),Math.abs(sl)>Math.abs(ir)+Math.abs(Ee)?(o.set(Bn+1,a-1,(-rl-ml*o.get(Bn,a-1)+Ee*o.get(Bn,a))/sl),o.set(Bn+1,a,(-th-ml*o.get(Bn,a)-Ee*o.get(Bn,a-1))/sl)):(Bh=cdiv(-dt-ll*o.get(Bn,a-1),-Ht-ll*o.get(Bn,a),ir,Ee),o.set(Bn+1,a-1,Bh[0]),o.set(Bn+1,a,Bh[1]))),gl=Math.max(Math.abs(o.get(Bn,a-1)),Math.abs(o.get(Bn,a))),m*gl*gl>1)for(Vn=Bn;Vn<=a;Vn++)o.set(Vn,a-1,o.get(Vn,a-1)/gl),o.set(Vn,a,o.get(Vn,a)/gl)}for(Bn=0;Bn<r;Bn++)if(Bn<l||Bn>s)for(Vn=Bn;Vn<r;Vn++)n.set(Bn,Vn,o.get(Bn,Vn));for(Vn=r-1;Vn>=l;Vn--)for(Bn=l;Bn<=s;Bn++){for(ir=0,Wr=l;Wr<=Math.min(Vn,s);Wr++)ir=ir+n.get(Bn,Wr)*o.get(Wr,Vn);n.set(Bn,Vn,ir)}}}function cdiv(r,e,t,n){let o,a;return Math.abs(t)>Math.abs(n)?(o=n/t,a=t+o*n,[(r+o*e)/a,(e-o*r)/a]):(o=t/n,a=n+o*t,[(o*r+e)/a,(o*e-r)/a])}class CholeskyDecomposition{constructor(e){if(e=WrapperMatrix2D.checkMatrix(e),!e.isSymmetric())throw new Error("Matrix is not symmetric");let t=e,n=t.rows,o=new Matrix$2(n,n),a=!0,l,s,m;for(s=0;s<n;s++){let y=0;for(m=0;m<s;m++){let D=0;for(l=0;l<m;l++)D+=o.get(m,l)*o.get(s,l);D=(t.get(s,m)-D)/o.get(m,m),o.set(s,m,D),y=y+D*D}for(y=t.get(s,s)-y,a&=y>0,o.set(s,s,Math.sqrt(Math.max(y,0))),m=s+1;m<n;m++)o.set(s,m,0)}this.L=o,this.positiveDefinite=!!a}isPositiveDefinite(){return this.positiveDefinite}solve(e){e=WrapperMatrix2D.checkMatrix(e);let t=this.L,n=t.rows;if(e.rows!==n)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let o=e.columns,a=e.clone(),l,s,m;for(m=0;m<n;m++)for(s=0;s<o;s++){for(l=0;l<m;l++)a.set(m,s,a.get(m,s)-a.get(l,s)*t.get(m,l));a.set(m,s,a.get(m,s)/t.get(m,m))}for(m=n-1;m>=0;m--)for(s=0;s<o;s++){for(l=m+1;l<n;l++)a.set(m,s,a.get(m,s)-a.get(l,s)*t.get(l,m));a.set(m,s,a.get(m,s)/t.get(m,m))}return a}get lowerTriangularMatrix(){return this.L}}class nipals{constructor(e,t={}){e=WrapperMatrix2D.checkMatrix(e);let{Y:n}=t;const{scaleScores:o=!1,maxIterations:a=1e3,terminationCriteria:l=1e-10}=t;let s;if(n){if(isAnyArray(n)&&typeof n[0]=="number"?n=Matrix$2.columnVector(n):n=WrapperMatrix2D.checkMatrix(n),n.rows!==e.rows)throw new Error("Y should have the same number of rows as X");s=n.getColumnVector(0)}else s=e.getColumnVector(0);let m=1,y,D,W,Ee;for(let dt=0;dt<a&&m>l;dt++)W=e.transpose().mmul(s).div(s.transpose().mmul(s).get(0,0)),W=W.div(W.norm()),y=e.mmul(W).div(W.transpose().mmul(W).get(0,0)),dt>0&&(m=y.clone().sub(Ee).pow(2).sum()),Ee=y.clone(),n?(D=n.transpose().mmul(y).div(y.transpose().mmul(y).get(0,0)),D=D.div(D.norm()),s=n.mmul(D).div(D.transpose().mmul(D).get(0,0))):s=y;if(n){let dt=e.transpose().mmul(y).div(y.transpose().mmul(y).get(0,0));dt=dt.div(dt.norm());let Ht=e.clone().sub(y.clone().mmul(dt.transpose())),ir=s.transpose().mmul(y).div(y.transpose().mmul(y).get(0,0)),Hr=n.clone().sub(y.clone().mulS(ir.get(0,0)).mmul(D.transpose()));this.t=y,this.p=dt.transpose(),this.w=W.transpose(),this.q=D,this.u=s,this.s=y.transpose().mmul(y),this.xResidual=Ht,this.yResidual=Hr,this.betas=ir}else this.w=W.transpose(),this.s=y.transpose().mmul(y).sqrt(),o?this.t=y.clone().div(this.s.get(0,0)):this.t=y,this.xResidual=e.sub(y.mmul(W.transpose()))}}const src$1=Object.freeze(Object.defineProperty({__proto__:null,AbstractMatrix,CHO:CholeskyDecomposition,CholeskyDecomposition,EVD:EigenvalueDecomposition,EigenvalueDecomposition,LU:LuDecomposition,LuDecomposition,Matrix:Matrix$2,MatrixColumnSelectionView,MatrixColumnView,MatrixFlipColumnView,MatrixFlipRowView,MatrixRowSelectionView,MatrixRowView,MatrixSelectionView,MatrixSubView,MatrixTransposeView:MatrixTransposeView$1,NIPALS:nipals,Nipals:nipals,QR:QrDecomposition,QrDecomposition,SVD:SingularValueDecomposition,SingularValueDecomposition,WrapperMatrix1D,WrapperMatrix2D,correlation,covariance,default:Matrix$2,determinant,inverse,linearDependencies,pseudoInverse,solve,wrap},Symbol.toStringTag,{value:"Module"}));function getSeparatedKernel(r){const e=new SingularValueDecomposition(r,{autoTranspose:!0});if(e.rank!==1)return null;const t=Math.sqrt(e.s[0]),n=e.U.to2DArray().map(a=>a[0]*t),o=e.V.to2DArray().map(a=>a[0]*t);return[n,o]}function convolution(r,e={}){let{channels:t,bitDepth:n,normalize:o=!1,divisor:a=1,border:l="copy",algorithm:s="auto"}=e,m={};n&&(m.bitDepth=n);let y=Image$1.createFrom(this,m);if(t=validateArrayOfChannels(this,t),s!=="separable")({kernel:r}=validateKernel(r));else if(!Array.isArray(r)||r.length!==2)throw new RangeError("separable convolution requires two arrays of numbers to represent the kernel");if(s==="auto"){let ps=getSeparatedKernel(r);ps!==null?(s="separable",r=ps):(r.length>9||r[0].length>9)&&this.width<=4096&&this.height<=4096?s="fft":s="direct"}let D,W;s==="separable"?(D=Math.floor(r[0].length/2),W=Math.floor(r[1].length/2)):(D=Math.floor(r.length/2),W=Math.floor(r[0].length/2));let Ee=y.isClamped,dt=new Array(this.height*this.width),Ht,ir,Hr,Bn,Vn,Wr;for(Bn=0;Bn<t.length;Bn++){for(Vn=t[Bn],Hr=0;Hr<this.height;Hr++)for(ir=0;ir<this.width;ir++)Ht=Hr*this.width+ir,dt[Ht]=this.data[Ht*this.channels+Vn];if(s==="direct")Wr=src$2.direct(dt,r,{rows:this.height,cols:this.width,normalize:o,divisor:a});else if(s==="separable"){if(Wr=convolutionSeparable(dt,r,this.width,this.height),o){a=0;for(let ps=0;ps<r[0].length;ps++)for(let il=0;il<r[1].length;il++)a+=r[0][ps]*r[1][il]}if(a!==1)for(let ps=0;ps<Wr.length;ps++)Wr[ps]/=a}else Wr=src$2.fft(dt,r,{rows:this.height,cols:this.width,normalize:o,divisor:a});for(Hr=0;Hr<this.height;Hr++)for(ir=0;ir<this.width;ir++)Ht=Hr*this.width+ir,Ee?y.data[Ht*this.channels+Vn]=clamp(Wr[Ht],y):y.data[Ht*this.channels+Vn]=Wr[Ht]}if(this.alpha&&!t.includes(this.channels))for(ir=this.components;ir<this.data.length;ir=ir+this.channels)y.data[ir]=this.data[ir];return l!=="periodic"&&y.setBorder({size:[W,D],algorithm:l}),y}function gradientFilter(r={}){let{direction:e="xy",border:t="copy",kernelX:n,kernelY:o,channels:a,bitDepth:l=this.bitDepth}=r;switch(this.checkProcessable("gradientFilter",{bitDepth:[8,16]}),e){case"x":if(!n)throw new Error("kernelX option is missing");return convolution.call(this,n,{channels:a,border:t,bitDepth:l});case"y":if(!o)throw new Error("kernelY option is missing");return convolution.call(this,o,{channels:a,border:t,bitDepth:l});case"xy":{if(!n)throw new Error("kernelX option is missing");if(!o)throw new Error("kernelY option is missing");const s=convolution.call(this,n,{channels:a,border:t,bitDepth:32}),m=convolution.call(this,o,{channels:a,border:t,bitDepth:32});return s.hypotenuse(m,{bitDepth:l,channels:a})}default:throw new Error(`Unknown parameter direction: ${e}`)}}function sobelFilter(r){return gradientFilter.call(this,Object.assign({},r,{kernelX:SOBEL_X,kernelY:SOBEL_Y}))}function scharrFilter(r){return gradientFilter.call(this,Object.assign({},r,{kernelX:SCHARR_X,kernelY:SCHARR_Y}))}var newArray_1=newArray;function newArray(r,e){r=r||0;for(var t=new Array(r),n=0;n<r;n++)t[n]=e;return t}const newArray$1=getDefaultExportFromCjs(newArray_1);function level(r={}){let{algorithm:e="range",channels:t,min:n=this.min,max:o=this.max}=r;switch(this.checkProcessable("level",{bitDepth:[8,16,32]}),t=validateArrayOfChannels(this,{channels:t}),t.length!==this.channel&&(Array.isArray(n)&&n.length===this.channels&&(n=n.filter((a,l)=>t.includes(l))),Array.isArray(o)&&o.length===this.channels&&(o=o.filter((a,l)=>t.includes(l)))),e){case"range":n<0&&(n=0),o>this.maxValue&&(o=this.maxValue),Array.isArray(n)||(n=newArray$1(t.length,n)),Array.isArray(o)||(o=newArray$1(t.length,o)),processImage(this,n,o,t);break;default:throw new Error(`level: algorithm not implement: ${e}`)}return this}function processImage(r,e,t,n){let o=1e-5,a=new Array(n.length);for(let l=0;l<n.length;l++)e[l]===0&&t[l]===r.maxValue||t[l]===e[l]?a[l]=0:a[l]=(r.maxValue+1-o)/(t[l]-e[l]),e[l]+=(.5-o/2)/a[l];for(let l=0;l<n.length;l++){let s=n[l];if(a[l]!==0)for(let m=0;m<r.data.length;m+=r.channels)r.data[m+s]=Math.min(Math.max(0,(r.data[m+s]-e[l])*a[l]+.5|0),r.maxValue)}}var toString=Object.prototype.toString,isArrayType=function r(e){return toString.call(e).substr(-6,5)==="Array"};const isArray=getDefaultExportFromCjs(isArrayType);function checkNumberArray(r){if(isNaN(r)){if(r instanceof Image$1)return r.data;if(!isArray(r))throw new Error("checkNumberArray: the value should be either a number, array or Image");return r}else{if(r<=0)throw new Error("checkNumberArray: the value must be greater than 0");return r}}function add(r,e={}){let{channels:t}=e;if(this.checkProcessable("add",{bitDepth:[8,16]}),t=validateArrayOfChannels(this,{channels:t}),r=checkNumberArray(r),isNaN(r)){if(this.data.length!==r.length)throw new Error("add: the data size is different");for(let n=0;n<t.length;n++){let o=t[n];for(let a=0;a<this.data.length;a+=this.channels)this.data[a+o]=Math.max(0,Math.min(this.maxValue,this.data[a+o]+r[a+o]>>0))}}else for(let n=0;n<t.length;n++){let o=t[n];for(let a=0;a<this.data.length;a+=this.channels)this.data[a+o]=Math.min(this.maxValue,this.data[a+o]+r>>0)}return this}function subtract(r,e={}){let{channels:t}=e;if(this.checkProcessable("subtract",{bitDepth:[8,16]}),t=validateArrayOfChannels(this,{channels:t}),r=checkNumberArray(r),isNaN(r)){if(this.data.length!==r.length)throw new Error("subtract: the data size is different");for(let n=0;n<t.length;n++){let o=t[n];for(let a=0;a<this.data.length;a+=this.channels)this.data[a+o]=Math.max(0,Math.min(this.maxValue,this.data[a+o]-r[a+o]>>0))}}else for(let n=0;n<t.length;n++){let o=t[n];for(let a=0;a<this.data.length;a+=this.channels)this.data[a+o]=Math.max(0,this.data[a+o]-r>>0)}return this}function subtractImage(r,e={}){let{channels:t,absolute:n=!1}=e;if(this.checkProcessable("subtractImage",{bitDepth:[8,16]}),this.width!==r.width||this.height!==r.height)throw new Error("subtractImage: both images must have the same size");if(this.alpha!==r.alpha||this.bitDepth!==r.bitDepth)throw new Error("subtractImage: both images must have the same alpha and bitDepth");if(this.channels!==r.channels)throw new Error("subtractImage: both images must have the same number of channels");let o=this.clone();t=validateArrayOfChannels(this,{channels:t});for(let a=0;a<t.length;a++){let l=t[a];for(let s=l;s<this.data.length;s+=this.channels){let m=this.data[s]-r.data[s];n?o.data[s]=Math.abs(m):o.data[s]=Math.max(m,0)}}return o}function hypotenuse(r,e={}){let{bitDepth:t=this.bitDepth,channels:n}=e;if(this.checkProcessable("hypotenuse",{bitDepth:[8,16,32]}),this.width!==r.width||this.height!==r.height)throw new Error("hypotenuse: both images must have the same size");if(this.alpha!==r.alpha||this.bitDepth!==r.bitDepth)throw new Error("hypotenuse: both images must have the same alpha and bitDepth");if(this.channels!==r.channels)throw new Error("hypotenuse: both images must have the same number of channels");let o=Image$1.createFrom(this,{bitDepth:t});n=validateArrayOfChannels(this,{channels:n});let a=o.isClamped;for(let l=0;l<n.length;l++){let s=n[l];for(let m=s;m<this.data.length;m+=this.channels){let y=Math.hypot(this.data[m],r.data[m]);a?o.data[m]=Math.min(Math.max(Math.round(y),0),o.maxValue):o.data[m]=y}}return o}function multiply(r,e={}){let{channels:t}=e;if(this.checkProcessable("multiply",{bitDepth:[8,16]}),r<=0)throw new Error("multiply: the value must be greater than 0");if(t=validateArrayOfChannels(this,{channels:t}),r=checkNumberArray(r),isNaN(r)){if(this.data.length!==r.length)throw new Error("multiply: the data size is different");for(let n=0;n<t.length;n++){let o=t[n];for(let a=0;a<this.data.length;a+=this.channels)this.data[a+o]=Math.max(0,Math.min(this.maxValue,this.data[a+o]*r[a+o]>>0))}}else for(let n=0;n<t.length;n++){let o=t[n];for(let a=0;a<this.data.length;a+=this.channels)this.data[a+o]=Math.min(this.maxValue,this.data[a+o]*r>>0)}return this}function divide(r,e={}){let{channels:t}=e;if(this.checkProcessable("divide",{bitDepth:[8,16]}),t=validateArrayOfChannels(this,{channels:t}),r=checkNumberArray(r),isNaN(r)){if(this.data.length!==r.length)throw new Error("divide: the: the data size is different");for(let n=0;n<t.length;n++){let o=t[n];for(let a=0;a<this.data.length;a+=this.channels)this.data[a+o]=Math.max(0,Math.min(this.maxValue,this.data[a+o]/r[a+o]>>0))}}else for(let n=0;n<t.length;n++){let o=t[n];for(let a=0;a<this.data.length;a+=this.channels)this.data[a+o]=Math.min(this.maxValue,this.data[a+o]/r>>0)}return this}class BaseRegression{constructor(){if(new.target===BaseRegression)throw new Error("BaseRegression must be subclassed")}predict(e){if(typeof e=="number")return this._predict(e);if(isAnyArray(e)){const t=[];for(let n=0;n<e.length;n++)t.push(this._predict(e[n]));return t}else throw new TypeError("x must be a number or array")}_predict(){throw new Error("_predict must be implemented")}train(){}toString(){return""}toLaTeX(){return""}score(e,t){if(!isAnyArray(e)||!isAnyArray(t)||e.length!==t.length)throw new Error("x and y must be arrays of the same length");const n=e.length,o=new Array(n);for(let dt=0;dt<n;dt++)o[dt]=this._predict(e[dt]);let a=0,l=0,s=0,m=0,y=0,D=0,W=0;for(let dt=0;dt<n;dt++)a+=o[dt],l+=t[dt],y+=o[dt]*o[dt],D+=t[dt]*t[dt],W+=o[dt]*t[dt],t[dt]!==0&&(s+=(t[dt]-o[dt])*(t[dt]-o[dt])/t[dt]),m+=(t[dt]-o[dt])*(t[dt]-o[dt]);const Ee=(n*W-a*l)/Math.sqrt((n*y-a*a)*(n*D-l*l));return{r:Ee,r2:Ee*Ee,chi2:s,rmsd:Math.sqrt(m/n)}}}const require$$0$1=getAugmentedNamespace(src$1);function squaredEuclidean$4(r,e){let t=0;for(let n=0;n<r.length;n++)t+=(r[n]-e[n])*(r[n]-e[n]);return t}function euclidean$2(r,e){return Math.sqrt(squaredEuclidean$4(r,e))}const euclidean$3=Object.freeze(Object.defineProperty({__proto__:null,euclidean:euclidean$2,squaredEuclidean:squaredEuclidean$4},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(euclidean$3),{squaredEuclidean:squaredEuclidean$3}=require$$0,defaultOptions$b={sigma:1};let GaussianKernel$1=class{constructor(e){e=Object.assign({},defaultOptions$b,e),this.sigma=e.sigma,this.divisor=2*e.sigma*e.sigma}compute(e,t){const n=squaredEuclidean$3(e,t);return Math.exp(-n/this.divisor)}};var gaussianKernel=GaussianKernel$1;const defaultOptions$a={degree:1,constant:1,scale:1};let PolynomialKernel$1=class{constructor(e){e=Object.assign({},defaultOptions$a,e),this.degree=e.degree,this.constant=e.constant,this.scale=e.scale}compute(e,t){for(var n=0,o=0;o<e.length;o++)n+=e[o]*t[o];return Math.pow(this.scale*n+this.constant,this.degree)}};var polynomialKernel=PolynomialKernel$1;const defaultOptions$9={alpha:.01,constant:-Math.E};let SigmoidKernel$1=class{constructor(e){e=Object.assign({},defaultOptions$9,e),this.alpha=e.alpha,this.constant=e.constant}compute(e,t){for(var n=0,o=0;o<e.length;o++)n+=e[o]*t[o];return Math.tanh(this.alpha*n+this.constant)}};var sigmoidKernel=SigmoidKernel$1;const defaultOptions$8={sigma:1,degree:1};let ANOVAKernel$1=class{constructor(e){e=Object.assign({},defaultOptions$8,e),this.sigma=e.sigma,this.degree=e.degree}compute(e,t){for(var n=0,o=Math.min(e.length,t.length),a=1;a<=o;++a)n+=Math.pow(Math.exp(-this.sigma*Math.pow(Math.pow(e[a-1],a)-Math.pow(t[a-1],a),2)),this.degree);return n}};var anovaKernel=ANOVAKernel$1;const{squaredEuclidean:squaredEuclidean$2}=require$$0,defaultOptions$7={sigma:1};let CauchyKernel$1=class{constructor(e){e=Object.assign({},defaultOptions$7,e),this.sigma=e.sigma}compute(e,t){return 1/(1+squaredEuclidean$2(e,t)/(this.sigma*this.sigma))}};var cauchyKernel=CauchyKernel$1;const{euclidean:euclidean$1}=require$$0,defaultOptions$6={sigma:1};let ExponentialKernel$1=class{constructor(e){e=Object.assign({},defaultOptions$6,e),this.sigma=e.sigma,this.divisor=2*e.sigma*e.sigma}compute(e,t){const n=euclidean$1(e,t);return Math.exp(-n/this.divisor)}};var exponentialKernel=ExponentialKernel$1;class HistogramIntersectionKernel{compute(e,t){for(var n=Math.min(e.length,t.length),o=0,a=0;a<n;++a)o+=Math.min(e[a],t[a]);return o}}var histogramIntersectionKernel=HistogramIntersectionKernel;const{euclidean}=require$$0,defaultOptions$5={sigma:1};let LaplacianKernel$1=class{constructor(e){e=Object.assign({},defaultOptions$5,e),this.sigma=e.sigma}compute(e,t){const n=euclidean(e,t);return Math.exp(-n/this.sigma)}};var laplacianKernel=LaplacianKernel$1;const{squaredEuclidean:squaredEuclidean$1}=require$$0,defaultOptions$4={constant:1};let MultiquadraticKernel$1=class{constructor(e){e=Object.assign({},defaultOptions$4,e),this.constant=e.constant}compute(e,t){return Math.sqrt(squaredEuclidean$1(e,t)+this.constant*this.constant)}};var multiquadraticKernel=MultiquadraticKernel$1;const{squaredEuclidean}=require$$0,defaultOptions$3={constant:1};class RationalQuadraticKernel{constructor(e){e=Object.assign({},defaultOptions$3,e),this.constant=e.constant}compute(e,t){const n=squaredEuclidean(e,t);return 1-n/(n+this.constant)}}var rationalQuadraticKernel=RationalQuadraticKernel;const{Matrix:Matrix$1,MatrixTransposeView}=require$$0$1,GaussianKernel=gaussianKernel,PolynomialKernel=polynomialKernel,SigmoidKernel=sigmoidKernel,ANOVAKernel=anovaKernel,CauchyKernel=cauchyKernel,ExponentialKernel=exponentialKernel,HistogramKernel=histogramIntersectionKernel,LaplacianKernel=laplacianKernel,MultiquadraticKernel=multiquadraticKernel,RationalKernel=rationalQuadraticKernel,kernelType={gaussian:GaussianKernel,rbf:GaussianKernel,polynomial:PolynomialKernel,poly:PolynomialKernel,anova:ANOVAKernel,cauchy:CauchyKernel,exponential:ExponentialKernel,histogram:HistogramKernel,min:HistogramKernel,laplacian:LaplacianKernel,multiquadratic:MultiquadraticKernel,rational:RationalKernel,sigmoid:SigmoidKernel,mlp:SigmoidKernel};class Kernel{constructor(e,t){if(this.kernelType=e,e!=="linear")if(typeof e=="string"){e=e.toLowerCase();var n=kernelType[e];if(n)this.kernelFunction=new n(t);else throw new Error(`unsupported kernel type: ${e}`)}else if(typeof e=="object"&&typeof e.compute=="function")this.kernelFunction=e;else throw new TypeError("first argument must be a valid kernel type or instance")}compute(e,t){if(e=Matrix$1.checkMatrix(e),t===void 0?t=e:t=Matrix$1.checkMatrix(t),this.kernelType==="linear")return e.mmul(new MatrixTransposeView(t));const n=new Matrix$1(e.rows,t.rows);if(e===t)for(let o=0;o<e.rows;o++)for(let a=o;a<e.rows;a++){const l=this.kernelFunction.compute(e.getRow(o),e.getRow(a));n.set(o,a,l),n.set(a,o,l)}else for(let o=0;o<e.rows;o++)for(let a=0;a<t.rows;a++)n.set(o,a,this.kernelFunction.compute(e.getRow(o),t.getRow(a)));return n}}var kernel=Kernel;const Kernel$1=getDefaultExportFromCjs(kernel),defaultOptions$2={lambda:.1,kernelType:"gaussian",kernelOptions:{},computeCoefficient:!1};class KernelRidgeRegression extends BaseRegression{constructor(e,t,n){if(super(),e===!0)this.alpha=t.alpha,this.inputs=t.inputs,this.kernelType=t.kernelType,this.kernelOptions=t.kernelOptions,this.kernel=new Kernel$1(t.kernelType,t.kernelOptions);else{e=Matrix$2.checkMatrix(e),n=Object.assign({},defaultOptions$2,n);const o=new Kernel$1(n.kernelType,n.kernelOptions),a=o.compute(e),l=e.rows;a.add(Matrix$2.eye(l,l).mul(n.lambda)),this.alpha=solve(a,t),this.inputs=e,this.kernelType=n.kernelType,this.kernelOptions=n.kernelOptions,this.kernel=o}}_predict(e){return this.kernel.compute([e],this.inputs).mmul(this.alpha).getRow(0)}toJSON(){return{name:"kernelRidgeRegression",alpha:this.alpha,inputs:this.inputs,kernelType:this.kernelType,kernelOptions:this.kernelOptions}}static load(e){if(e.name!=="kernelRidgeRegression")throw new TypeError("not a KRR model");return new KernelRidgeRegression(!0,e)}}function background$1(r,e,t){const n=new KernelRidgeRegression(r,e,t),o=new Array(this.size);for(let s=0;s<this.width;s++)for(let m=0;m<this.height;m++)o[m*this.width+s]=[s,m];const a=n.predict(o),l=Image$1.createFrom(this);for(let s=0;s<this.size;s++)l.data[s]=Math.min(this.maxValue,Math.max(0,a[s][0]));return l}function dilate(r={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:t=1}=r;if(this.checkProcessable("dilate",{bitDepth:[1,8,16],components:1,alpha:0}),e.columns%2===0||e.rows%2===0)throw new TypeError("dilate: The number of rows and columns of the kernel must be odd");let n=!0;e:for(const a of e)for(const l of a)if(l!==1){n=!1;break e}let o=this;for(let a=0;a<t;a++)if(this.bitDepth===1)if(n){const l=o.clone();o=dilateOnceBinaryOnlyOnes(o,l,e.length,e[0].length)}else{const l=Image$1.createFrom(o);o=dilateOnceBinary(o,l,e)}else if(n){const l=Image$1.createFrom(o);o=dilateOnceGreyOnlyOnes(o,l,e.length,e[0].length)}else{const l=Image$1.createFrom(o);o=dilateOnceGrey(o,l,e)}return o}function dilateOnceGrey(r,e,t){const n=t.length,o=t[0].length;let a=(n-1)/2,l=(o-1)/2;for(let s=0;s<r.height;s++)for(let m=0;m<r.width;m++){let y=0;for(let D=0;D<o;D++)for(let W=0;W<n;W++){if(t[W][D]!==1)continue;let Ee=W-a+m,dt=D-l+s;if(Ee<0||dt<0||Ee>=r.width||dt>=r.height)continue;const Ht=r.getValueXY(Ee,dt,0);Ht>y&&(y=Ht)}e.setValueXY(m,s,0,y)}return e}function dilateOnceGreyOnlyOnes(r,e,t,n){const o=(t-1)/2,a=(n-1)/2,l=[];for(let s=0;s<r.width;s++)l.push(0);for(let s=0;s<r.height;s++){for(let m=0;m<r.width;m++){let y=0;for(let D=Math.max(0,s-a);D<Math.min(r.height,s+a+1);D++){const W=r.getValueXY(m,D,0);W>y&&(y=W)}l[m]=y}for(let m=0;m<r.width;m++){let y=0;for(let D=Math.max(0,m-o);D<Math.min(r.width,m+o+1);D++)l[D]>y&&(y=l[D]);e.setValueXY(m,s,0,y)}}return e}function dilateOnceBinary(r,e,t){const n=t.length,o=t[0].length;let a=(n-1)/2,l=(o-1)/2;for(let s=0;s<r.height;s++)for(let m=0;m<r.width;m++){let y=0;e:for(let D=0;D<o;D++)for(let W=0;W<n;W++){if(t[W][D]!==1)continue;let Ee=W-a+m,dt=D-l+s;if(dt<0||Ee<0||Ee>=r.width||dt>=r.height)continue;if(r.getBitXY(Ee,dt)===1){y=1;break e}}y===1&&e.setBitXY(m,s)}return e}function dilateOnceBinaryOnlyOnes(r,e,t,n){const o=(t-1)/2,a=(n-1)/2,l=[];for(let s=0;s<r.width;s++)l.push(1);for(let s=0;s<r.height;s++){for(let m=0;m<r.width;m++){l[m]=0;for(let y=Math.max(0,s-a);y<Math.min(r.height,s+a+1);y++)if(r.getBitXY(m,y)===1){l[m]=1;break}}for(let m=0;m<r.width;m++)if(e.getBitXY(m,s)!==1){for(let y=Math.max(0,m-o);y<Math.min(r.width,m+o+1);y++)if(l[y]===1){e.setBitXY(m,s);break}}}return e}function erode(r={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:t=1}=r;if(this.checkProcessable("erode",{bitDepth:[1,8,16],components:1,alpha:0}),e.columns%2===0||e.rows%2===0)throw new TypeError("erode: The number of rows and columns of the kernel must be odd");let n=!0;e:for(const a of e)for(const l of a)if(l!==1){n=!1;break e}let o=this;for(let a=0;a<t;a++)if(this.bitDepth===1)if(n){const l=o.clone();o=erodeOnceBinaryOnlyOnes(o,l,e.length,e[0].length)}else{const l=Image$1.createFrom(o);o=erodeOnceBinary(o,l,e)}else if(n){const l=Image$1.createFrom(o);o=erodeOnceGreyOnlyOnes(o,l,e.length,e[0].length)}else{const l=Image$1.createFrom(o);o=erodeOnceGrey(o,l,e)}return o}function erodeOnceGrey(r,e,t){const n=t.length,o=t[0].length;let a=(n-1)/2,l=(o-1)/2;for(let s=0;s<r.height;s++)for(let m=0;m<r.width;m++){let y=r.maxValue;for(let D=0;D<o;D++)for(let W=0;W<n;W++){if(t[W][D]!==1)continue;let Ee=W-a+m,dt=D-l+s;if(Ee<0||dt<0||Ee>=r.width||dt>=r.height)continue;const Ht=r.getValueXY(Ee,dt,0);Ht<y&&(y=Ht)}e.setValueXY(m,s,0,y)}return e}function erodeOnceGreyOnlyOnes(r,e,t,n){const o=(t-1)/2,a=(n-1)/2,l=[];for(let s=0;s<r.width;s++)l.push(0);for(let s=0;s<r.height;s++){for(let m=0;m<r.width;m++){let y=r.maxValue;for(let D=Math.max(0,s-a);D<Math.min(r.height,s+a+1);D++){const W=r.getValueXY(m,D,0);W<y&&(y=W)}l[m]=y}for(let m=0;m<r.width;m++){let y=r.maxValue;for(let D=Math.max(0,m-o);D<Math.min(r.width,m+o+1);D++)l[D]<y&&(y=l[D]);e.setValueXY(m,s,0,y)}}return e}function erodeOnceBinary(r,e,t){const n=t.length,o=t[0].length;let a=(n-1)/2,l=(o-1)/2;for(let s=0;s<r.height;s++)for(let m=0;m<r.width;m++){let y=1;e:for(let D=0;D<o;D++)for(let W=0;W<n;W++){if(t[W][D]!==1)continue;let Ee=W-a+m,dt=D-l+s;if(dt<0||Ee<0||Ee>=r.width||dt>=r.height)continue;if(r.getBitXY(Ee,dt)===0){y=0;break e}}y===1&&e.setBitXY(m,s)}return e}function erodeOnceBinaryOnlyOnes(r,e,t,n){const o=(t-1)/2,a=(n-1)/2,l=[];for(let s=0;s<r.width;s++)l.push(0);for(let s=0;s<r.height;s++){for(let m=0;m<r.width;m++){l[m]=1;for(let y=Math.max(0,s-a);y<Math.min(r.height,s+a+1);y++)if(r.getBitXY(m,y)===0){l[m]=0;break}}for(let m=0;m<r.width;m++)if(e.getBitXY(m,s)!==0){for(let y=Math.max(0,m-o);y<Math.min(r.width,m+o+1);y++)if(l[y]===0){e.clearBitXY(m,s);break}}}return e}function open$1(r={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:t=1}=r;if(this.checkProcessable("open",{bitDepth:[8,16],components:1,alpha:0}),e.columns%2===0||e.rows%2===0)throw new TypeError("open: The number of rows and columns of the kernel must be odd");let n=this;for(let o=0;o<t;o++)n=n.erode({kernel:e}),n=n.dilate({kernel:e});return n}function close(r={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:t=1}=r;if(this.checkProcessable("close",{bitDepth:[1,8,16],components:1,alpha:0}),e.columns%2===0||e.rows%2===0)throw new TypeError("close: The number of rows and columns of the kernel must be odd");let n=this;for(let o=0;o<t;o++)n=n.dilate({kernel:e}).erode({kernel:e});return n}function topHat(r={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:t=1}=r;if(this.checkProcessable("topHat",{bitDepth:[8,16],components:1,alpha:0}),e.length%2===0||e[0].length%2===0)throw new TypeError("topHat: The number of rows and columns of the kernel must be odd");let n=this;for(let o=0;o<t;o++)n=n.open({kernel:e}).subtractImage(n,{absolute:!0});return n}function blackHat(r={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:t=1}=r;if(this.checkProcessable("blackHat",{bitDepth:[8,16],components:1,alpha:0}),e.columns%2===0||e.rows%2===0)throw new TypeError("blackHat: The number of rows and columns of the kernel must be odd");let n=this;for(let o=0;o<t;o++)n=n.close({kernel:e}).subtractImage(n,{absolute:!0});return n}function morphologicalGradient(r={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:t=1}=r;if(this.checkProcessable("morphologicalGradient",{bitDepth:[8,16],components:1,alpha:0}),e.columns%2===0||e.rows%2===0)throw new TypeError("morphologicalGradient: The number of rows and columns of the kernel must be odd");let n=this;for(let o=0;o<t;o++){let a=n.dilate({kernel:e}),l=n.erode({kernel:e});n=a.subtractImage(l,{absolute:!0})}return n}function order4Points(r){let e=0,t=0,n=0,o=0,a=r[0][0],l=0;for(let y=1;y<r.length;y++)r[y][0]<a&&(a=r[y][0],l=y);let s=r[(l+1)%r.length][0],m=(l+1)%r.length;for(let y=1;y<r.length;y++)r[y][0]<s&&y!==l&&(s=r[y][0],m=y);return r[m][1]<r[l][1]?(e=r[m],o=r[l],l!==(m+1)%4?(t=r[(m+1)%4],n=r[(m+2)%4]):(t=r[(m+2)%4],n=r[(m+3)%4])):(o=r[m],e=r[l],m!==(l+1)%4?(t=r[(l+1)%4],n=r[(l+2)%4]):(t=r[(l+2)%4],n=r[(l+3)%4])),[e,t,n,o]}function distance2Points(r,e){return Math.sqrt(Math.pow(r[0]-e[0],2)+Math.pow(r[1]-e[1],2))}function crossVect(r,e){return[r[1]*e[2]-r[2]*e[1],r[2]*e[0]-r[0]*e[2],r[0]*e[1]-r[1]*e[0]]}function dotVect(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function computeWidthAndHeigth(r,e,t,n,o,a){let l=Math.max(distance2Points(r,e),distance2Points(n,t)),s=Math.max(distance2Points(r,n),distance2Points(e,t)),m=0,y=0,D=Math.ceil(o/2),W=Math.ceil(a/2),Ee=l/s,dt=[r[0],r[1],1],Ht=[e[0],e[1],1],ir=[n[0],n[1],1],Hr=[t[0],t[1],1],Bn=dotVect(crossVect(dt,Hr),ir)/dotVect(crossVect(Ht,Hr),ir),Vn=dotVect(crossVect(dt,Hr),Ht)/dotVect(crossVect(ir,Hr),Ht),Wr=[Bn*Ht[0]-dt[0],Bn*Ht[1]-dt[1],Bn*Ht[2]-dt[2]],ps=[Vn*ir[0]-dt[0],Vn*ir[1]-dt[1],Vn*ir[2]-dt[2]],il=Wr[0],gl=Wr[1],ml=Wr[2],sl=ps[0],ll=ps[1],rl=ps[2],th=1/(ml*rl)*(il*sl-(il*rl+ml*sl)*D+ml*rl*D*D+(gl*ll-(gl*rl+ml*ll)*W+ml*rl*W*W));th>=0?th=Math.sqrt(th):th=Math.sqrt(-th);let nh=new Matrix$2([[th,0,D],[0,th,W],[0,0,1]]),bh=nh.transpose(),Fh=inverse(bh),Bh=inverse(nh),Ed=Matrix$2.rowVector(Wr),Td=Matrix$2.rowVector(ps),td=Math.sqrt(dotVect(Ed.mmul(Fh).mmul(Bh).to1DArray(),Wr)/dotVect(Td.mmul(Fh).mmul(Bh).to1DArray(),ps));return td===0||Ee===0?(m=Math.ceil(l),y=Math.ceil(s)):td<Ee?(m=Math.ceil(l),y=Math.ceil(m/td)):(y=Math.ceil(s),m=Math.ceil(td*y)),[m,y]}function projectionPoint(r,e,t,n,o,a,l,s,m,y,D,W){let[Ee,dt]=[(t*r+n*e+o)/(m*r+y*e+1),(a*r+l*e+s)/(m*r+y*e+1)];return D.getValueXY(Math.floor(Ee),Math.floor(dt),W)}function warpingFourPoints(r,e={}){let{calculateRatio:t=!0}=e;if(r.length!==4)throw new Error(`The array pts must have four elements, which are the four corners. Currently, pts have ${r.length} elements`);let[n,o,a,l]=r,s=[n,o,a,l],[m,y,D,W]=order4Points(s),Ee,dt;t?[Ee,dt]=computeWidthAndHeigth(m,y,D,W,this.width,this.height):(Ee=Math.ceil(Math.max(distance2Points(m,y),distance2Points(W,D))),dt=Math.ceil(Math.max(distance2Points(m,W),distance2Points(y,D))));let Ht=Image$1.createFrom(this,{width:Ee,height:dt}),[ir,Hr]=m,[Bn,Vn]=y,[Wr,ps]=D,[il,gl]=W,[ml,sl]=[0,0],[ll,rl]=[0,Ee-1],[th,nh]=[dt-1,Ee-1],[bh,Fh]=[dt-1,0],Bh=new Matrix$2([[ml,sl,1,0,0,0,-ml*ir,-sl*ir],[ll,rl,1,0,0,0,-ll*Bn,-rl*Bn],[th,nh,1,0,0,0,-th*Wr,-sl*Wr],[bh,Fh,1,0,0,0,-bh*il,-Fh*il],[0,0,0,ml,sl,1,-ml*Hr,-sl*Hr],[0,0,0,ll,rl,1,-ll*Vn,-rl*Vn],[0,0,0,th,nh,1,-th*ps,-nh*ps],[0,0,0,bh,Fh,1,-bh*gl,-Fh*gl]]),Ed=Matrix$2.columnVector([ir,Bn,Wr,il,Hr,Vn,ps,gl]),td=new SingularValueDecomposition(Bh).solve(Ed),[Fd,Ld,Ud,Xd,wd,zd,Rd,op]=td.to1DArray(),Wd=new Matrix$2(dt,Ee);for(let Op=0;Op<this.channels;Op++){for(let ep=0;ep<dt;ep++)for(let zp=0;zp<Ee;zp++)Wd.set(ep,zp,projectionPoint(ep,zp,Fd,Ld,Ud,Xd,wd,zd,Rd,op,this,Op));Ht.setMatrix(Wd,{channel:Op})}return Ht}function crop(r={}){let{x:e=0,y:t=0,width:n=this.width-e,height:o=this.height-t}=r;if(this.checkProcessable("crop",{bitDepth:[1,8,16]}),e=Math.round(e),t=Math.round(t),n=Math.round(n),o=Math.round(o),e>this.width-1||t>this.height-1)throw new RangeError(`crop: origin (x:${e}, y:${t}) out of range (${this.width-1}; ${this.height-1})`);if(n<=0||o<=0)throw new RangeError(`crop: width and height (width:${n}; height:${o}) must be positive numbers`);if(e<0||t<0)throw new RangeError(`crop: x and y (x:${e}, y:${t}) must be positive numbers`);if(n>this.width-e||o>this.height-t)throw new RangeError(`crop: (x: ${e}, y:${t}, width:${n}, height:${o}) size is out of range`);let a=this;if(this.bitDepth===1){const l=new Image$1(n,o,{kind:"BINARY",parent:this});a=cropBinary(this,l,e,t,n,o)}else{const l=Image$1.createFrom(this,{width:n,height:o,position:[e,t]});a=cropDefault(this,l,e,t,n,o)}return a}function cropDefault(r,e,t,n,o,a){let l=o*r.channels,s=n+a,m=0,y=t*r.channels;for(let D=n;D<s;D++){let W=D*r.width*r.channels+y,Ee=W+l;for(;W<Ee;W++)e.data[m++]=r.data[W]}return e}function cropBinary(r,e,t,n,o,a){let l=o*r.channels,s=n+a,m=0,y=t*r.channels;for(let D=n;D<s;D++){let W=D*r.width*r.channels+y,Ee=W+l;for(;W<Ee;W++)r.getBit(W)&&e.setBit(m),++m}return e}function cropAlpha(r={}){this.checkProcessable("cropAlpha",{alpha:1});const{threshold:e=this.maxValue}=r;let t=findLeft(this,e,this.components);if(t===-1)throw new Error("Could not find new dimensions. Threshold may be too high.");let n=findTop(this,e,this.components,t),o=findBottom(this,e,this.components,t),a=findRight(this,e,this.components,t,n,o);return this.crop({x:t,y:n,width:a-t+1,height:o-n+1})}function findLeft(r,e,t){for(let n=0;n<r.width;n++)for(let o=0;o<r.height;o++)if(r.getValueXY(n,o,t)>=e)return n;return-1}function findTop(r,e,t,n){for(let o=0;o<r.height;o++)for(let a=n;a<r.width;a++)if(r.getValueXY(a,o,t)>=e)return o;return-1}function findBottom(r,e,t,n){for(let o=r.height-1;o>=0;o--)for(let a=n;a<r.width;a++)if(r.getValueXY(a,o,t)>=e)return o;return-1}function findRight(r,e,t,n,o,a){for(let l=r.width-1;l>=n;l--)for(let s=o;s<=a;s++)if(r.getValueXY(l,s,t)>=e)return l;return-1}function getFactor(r){if(typeof r=="string"){const e=r[r.length-1];r=parseFloat(r),e==="%"&&(r/=100)}return r}function getThreshold$1(r,e){if(!e)throw Error("getThreshold : the maxValue should be specified");if(typeof r=="string"){if(r[r.length-1]!=="%")throw Error("getThreshold : if the value is a string it must finish by %");return parseFloat(r)/100*e}else{if(typeof r=="number")return r<1?r*e:r;throw Error("getThreshold : the value is not valid")}}function factorDimensions(r,e,t){r=getFactor(r);let n=Math.round(r*e),o=Math.round(r*t);return n<=0&&(n=1),o<=0&&(o=1),{width:n,height:o}}function checkRow(r,e){if(e<0||e>=r.height)throw new RangeError(`row must be included between 0 and ${r.height-1}. Current value: ${e}`)}function checkColumn(r,e){if(e<0||e>=r.width)throw new RangeError(`column must be included between 0 and ${r.width-1}. Current value: ${e}`)}function checkChannel(r,e){if(e<0||e>=r.channels)throw new RangeError(`channel must be included between 0 and ${r.channels-1}. Current value: ${e}`)}const validInterpolations={nearestneighbor:"nearestNeighbor",nearestneighbour:"nearestNeighbor",bilinear:"bilinear"};function checkInterpolation(r){if(typeof r!="string")throw new TypeError("interpolation must be a string");if(r=r.toLowerCase(),!validInterpolations[r])throw new RangeError(`invalid interpolation algorithm: ${r}`);return validInterpolations[r]}function nearestNeighbor(r,e,t){const n=this.width/e,o=this.height/t;if(this.bitDepth>1)for(let a=0;a<e;a++){const l=Math.floor((a+.5)*n);for(let s=0;s<t;s++){const m=Math.floor((s+.5)*o);for(let y=0;y<this.channels;y++)r.setValueXY(a,s,y,this.getValueXY(l,m,y))}}else for(let a=0;a<e;a++){const l=Math.floor((a+.5)*n);for(let s=0;s<t;s++){const m=Math.floor((s+.5)*o);this.getBitXY(l,m)&&r.setBitXY(a,s)}}}function resize(r={}){const{factor:e=1,interpolation:t=validInterpolations.nearestneighbor,preserveAspectRatio:n=!0}=r,o=checkInterpolation(t);let a=r.width,l=r.height;if(a||(l&&n?a=Math.round(l*(this.width/this.height)):a=this.width),l||(n?l=Math.round(a*(this.height/this.width)):l=this.height),{width:a,height:l}=factorDimensions(e,a,l),a===this.width&&l===this.height){const D=this.clone();return D.position=[0,0],D}let s=Math.round((this.width-a)/2),m=Math.round((this.height-l)/2);const y=Image$1.createFrom(this,{width:a,height:l,position:[s,m]});switch(o){case validInterpolations.nearestneighbor:nearestNeighbor.call(this,y,a,l);break;default:throw new Error(`unsupported resize interpolation: ${o}`)}return y}function hsv(){this.checkProcessable("hsv",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let r=Image$1.createFrom(this,{colorModel:HSV}),e=0,t=this.data;for(let n=0;n<t.length;n+=this.channels){let o=t[n],a=t[n+1],l=t[n+2],s=Math.min(o,a,l),m=Math.max(o,a,l),y=m-s,D=0,W=m===0?0:y/m,Ee=m;if(m!==s){switch(m){case o:D=(a-l)/y+(a<l?6:0);break;case a:D=(l-o)/y+2;break;case l:D=(o-a)/y+4;break;default:throw new Error("unreachable")}D/=6}r.data[e++]=D*this.maxValue,r.data[e++]=W*this.maxValue,r.data[e++]=Ee,this.alpha&&(r.data[e++]=t[n+3])}return r}function hsl$1(){this.checkProcessable("hsl",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let r=Image$1.createFrom(this,{colorModel:HSL}),e=Math.floor(this.maxValue/2),t=0,n=this.data;for(let o=0;o<n.length;o+=this.channels){let a=n[o],l=n[o+1],s=n[o+2],m=Math.max(a,l,s),y=Math.min(a,l,s),D=0,W=0,Ee=(m+y)/2;if(m!==y){let dt=m-y;switch(W=Ee>e?dt/(2-m-y):dt/(m+y),m){case a:D=(l-s)/dt+(l<s?6:0);break;case l:D=(s-a)/dt+2;break;case s:D=(a-l)/dt+4;break;default:throw new Error("unreachable")}D/=6}r.data[t++]=D*this.maxValue,r.data[t++]=W*this.maxValue,r.data[t++]=Ee,this.alpha&&(r.data[t++]=n[o+3])}return r}function cmyk(){this.checkProcessable("cmyk",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let r=Image$1.createFrom(this,{components:4,colorModel:CMYK$1}),e=0,t=this.data;for(let n=0;n<t.length;n+=this.channels){let o=t[n],a=t[n+1],l=t[n+2],s=Math.min(this.maxValue-o,this.maxValue-a,this.maxValue-l),m=(this.maxValue-o-s)/(1-s/this.maxValue),y=(this.maxValue-a-s)/(1-s/this.maxValue),D=(this.maxValue-l-s)/(1-s/this.maxValue);r.data[e++]=Math.round(m),r.data[e++]=Math.round(y),r.data[e++]=Math.round(D),r.data[e++]=Math.round(s),this.alpha&&(r.data[e++]=t[n+3])}return r}function rgba8(){return new Image$1(this.width,this.height,this.getRGBAData(),{kind:"RGBA",parent:this})}const methods$1={luma709(r,e,t){return r*6966+e*23436+t*2366>>15},luma601(r,e,t){return r*9798+e*19235+t*3735>>15},maximum(r,e,t){return Math.max(r,e,t)},minimum(r,e,t){return Math.min(r,e,t)},average(r,e,t){return(r+e+t)/3>>0},minmax(r,e,t){return(Math.max(r,e,t)+Math.min(r,e,t))/2},red(r){return r},green(r,e){return e},blue(r,e,t){return t},cyan(r,e,t,n){let o=methods$1.black(r,e,t,n);return(n.maxValue-r-o)/(1-o/n.maxValue)>>0},magenta(r,e,t,n){let o=methods$1.black(r,e,t,n);return(n.maxValue-e-o)/(1-o/n.maxValue)>>0},yellow(r,e,t,n){let o=methods$1.black(r,e,t,n);return(n.maxValue-t-o)/(1-o/n.maxValue)>>0},black(r,e,t,n){return Math.min(n.maxValue-r,n.maxValue-e,n.maxValue-t)},hue(r,e,t,n){let o=methods$1.min(r,e,t),a=methods$1.max(r,e,t);if(a===o)return 0;let l=0,s=a-o;switch(a){case r:l=(e-t)/s+(e<t?6:0);break;case e:l=(t-r)/s+2;break;case t:l=(r-e)/s+4;break;default:throw new Error("unreachable")}return l/6*n.maxValue>>0},saturation(r,e,t,n){let o=methods$1.min(r,e,t),a=methods$1.max(r,e,t),l=a-o;return a===0?0:l/a*n.maxValue},lightness(r,e,t){let n=methods$1.min(r,e,t);return(methods$1.max(r,e,t)+n)/2}};Object.defineProperty(methods$1,"luminosity",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"luminance",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"min",{enumerable:!1,value:methods$1.minimum});Object.defineProperty(methods$1,"max",{enumerable:!1,value:methods$1.maximum});Object.defineProperty(methods$1,"brightness",{enumerable:!1,value:methods$1.maximum});Object.keys(methods$1).forEach(r=>{});function grey(r={}){let{algorithm:e="luma709",keepAlpha:t=!1,mergeAlpha:n=!0}=r;if(typeof e!="string"&&typeof e!="function")throw new TypeError("algorithm must be a string or a function");this.checkProcessable("grey",{bitDepth:[8,16],alpha:[0,1]}),this.components===1&&(e="red"),t&=this.alpha,n&=this.alpha,t&&(n=!1);let o=getOutputImage(this,r,{components:1,alpha:t,colorModel:GREY$1}),a;if(typeof e=="function")a=e;else if(a=methods$1[e.toLowerCase()],!a)throw new Error(`unsupported grey algorithm: ${e}`);let l=0;for(let s=0;s<this.data.length;s+=this.channels)n?o.data[l++]=clamp(a(this.data[s],this.data[s+1],this.data[s+2],this)*this.data[s+this.components]/this.maxValue,this):(o.data[l++]=clamp(a(this.data[s],this.data[s+1],this.data[s+2],this),this),o.alpha&&(o.data[l++]=this.data[s+this.components]));return o}function huang(r){let e=0;for(let D=0;D<r.length;D++)if(r[D]!==0){e=D;break}let t=r.length-1;for(let D=r.length-1;D>=e;D--)if(r[D]!==0){t=D;break}let n=1/(t-e),o=new Array(r.length),a=0,l=0;for(let D=e;D<r.length;D++)a+=D*r[D],l+=r[D],o[D]=a/l;let s=new Array(r.length);a=l=0;for(let D=t;D>0;D--)a+=D*r[D],l+=r[D],s[D-1]=a/l;let m=-1,y=Number.MAX_VALUE;for(let D=0;D<r.length;D++){let W=0,Ee;for(let dt=0;dt<=D;dt++)Ee=1/(1+n*Math.abs(dt-o[D])),Ee<1e-6||Ee>.999999||(W+=r[dt]*(-Ee*Math.log(Ee)-(1-Ee)*Math.log(1-Ee)));for(let dt=D+1;dt<r.length;dt++)Ee=1/(1+n*Math.abs(dt-s[D])),Ee<1e-6||Ee>.999999||(W+=r[dt]*(-Ee*Math.log(Ee)-(1-Ee)*Math.log(1-Ee)));W<y&&(y=W,m=D)}return m}function intermodes(r){let e=r.slice(),t=0;for(;!bimodalTest$1(e);){let o=0,a=0,l=e[0];for(let s=0;s<r.length-1;s++)o=a,a=l,l=e[s+1],e[s]=(o+a+l)/3;if(e[r.length-1]=(a+l)/3,t++,t>1e4)throw new Error("Intermodes Threshold not found after 10000 iterations")}let n=0;for(let o=1;o<r.length-1;o++)e[o-1]<e[o]&&e[o+1]<e[o]&&(n+=o);return Math.floor(n/2)}function bimodalTest$1(r){let e=!1,t=0;for(let n=1;n<r.length-1;n++)if(r[n-1]<r[n]&&r[n+1]<r[n]&&(t++,t>2))return!1;return t===2&&(e=!0),e}function isodata(r){let e,t,n,o,a=0;for(let l=1;l<r.length;l++)if(r[l]>0){a=l+1;break}for(;;){e=0,n=0;for(let l=0;l<a;l++)n=n+r[l],e=e+r[l]*l;o=0,t=0;for(let l=a+1;l<r.length;l++)t+=r[l],o+=r[l]*l;if(n>0&&t>0&&(e/=n,o/=t,a===Math.round((e+o)/2)))break;if(a++,a>r.length-2)throw new Error("Threshold not found")}return a}function li(r,e){let t,n,o,a,l,s,m,y,D,W,Ee,dt;Ee=.5,W=0;for(let Ht=0;Ht<r.length;Ht++)W+=Ht*r[Ht];W/=e,m=W;do{s=m,t=s+.5|0,n=0,a=0;for(let Ht=0;Ht<=t;Ht++)n+=Ht*r[Ht],a+=r[Ht];y=a===0?0:n/a,o=0,l=0;for(let Ht=t+1;Ht<r.length;Ht++)o+=Ht*r[Ht],l+=r[Ht];D=l===0?0:o/l,dt=(y-D)/(Math.log(y)-Math.log(D)),dt<-Number.EPSILON?m=dt-.5|0:m=dt+.5|0}while(Math.abs(m-s)>Ee);return t}function maxEntropy(r,e){let t=new Array(r.length);for(let Ee=0;Ee<r.length;Ee++)t[Ee]=r[Ee]/e;let n=new Array(r.length),o=new Array(r.length);n[0]=t[0],o[0]=1-n[0];for(let Ee=1;Ee<r.length;Ee++)n[Ee]=n[Ee-1]+t[Ee],o[Ee]=1-n[Ee];let a=0;for(let Ee=0;Ee<r.length;Ee++)if(Math.abs(n[Ee])>=Number.EPSILON){a=Ee;break}let l=r.length-1;for(let Ee=r.length-1;Ee>=a;Ee--)if(Math.abs(o[Ee])>=Number.EPSILON){l=Ee;break}let s=-1,m,y=Number.MIN_VALUE,D,W;for(let Ee=a;Ee<=l;Ee++){D=0;for(let dt=0;dt<=Ee;dt++)r[dt]!==0&&(D-=t[dt]/n[Ee]*Math.log(t[dt]/n[Ee]));W=0;for(let dt=Ee+1;dt<r.length;dt++)r[dt]!==0&&(W-=t[dt]/o[Ee]*Math.log(t[dt]/o[Ee]));m=D+W,y<m&&(y=m,s=Ee)}return s}function mean$1(r,e){let t=0;for(let n=0;n<r.length;n++)t+=n*r[n];return Math.floor(t/e)}function minError(r,e){let t,n=-2,o,a,l,s,m,y,D,W,Ee,dt,Ht,ir=0;for(let Hr=0;Hr<r.length;Hr++)ir+=Hr*r[Hr];for(ir/=e,t=ir;t!==n;){let Hr=sumA(r,t),Bn=sumA(r,r.length-1),Vn=sumB(r,t),Wr=sumB(r,r.length-1),ps=sumC(r,t),il=sumC(r,r.length-1);if(o=Vn/Hr,a=(Wr-Vn)/(Bn-Hr),l=Hr/Bn,s=(Bn-Hr)/Bn,m=ps/Hr-o*o,y=(il-ps)/(Bn-Hr)-a*a,D=1/m-1/y,W=o/m-a/y,Ee=o*o/m-a*a/y+Math.log10(m*(s*s)/(y*(l*l))),dt=W*W-D*Ee,dt<0)return t;n=t,Ht=(W+Math.sqrt(dt))/D,isNaN(Ht)?t=n:t=Math.floor(Ht)}return t}function sumA(r,e){let t=0;for(let n=0;n<=e;n++)t+=r[n];return t}function sumB(r,e){let t=0;for(let n=0;n<=e;n++)t+=n*r[n];return t}function sumC(r,e){let t=0;for(let n=0;n<=e;n++)t+=n*n*r[n];return t}function minimum(r){if(r.length<2)return 0;let e=0,t=-1,n=-1,o=new Array(r.length);for(let a=0;a<r.length;a++)o[a]=r[a],r[a]>0&&(n=a);for(;!bimodalTest(o);)if(o=smoothed(o),e++,e>1e4)return t;return t=minimumBetweenPeeks(o,n),t}function smoothed(r){let e=new Array(r.length);for(let t=1;t<r.length-1;t++)e[t]=(r[t-1]+r[t]+r[t+1])/3;return e[0]=(r[0]+r[1])/3,e[r.length-1]=(r[r.length-2]+r[r.length-1])/3,e}function minimumBetweenPeeks(r,e){let t;for(let n=1;n<e;n++)if(r[n-1]>r[n]&&r[n+1]>=r[n]){t=n;break}return t}function bimodalTest(r){let e=r.length,t=!1,n=0;for(let o=1;o<e-1;o++)if(r[o-1]<r[o]&&r[o+1]<r[o]&&(n++,n>2))return!1;return n===2&&(t=!0),t}function moments(r,e){let t=1,n=0,o=0,a=0,l=0,s,m,y,D,W,Ee,dt=-1,Ht=r.length,ir=new Array(Ht);for(let Hr=0;Hr<Ht;Hr++)ir[Hr]=r[Hr]/e;for(let Hr=0;Hr<Ht;Hr++)n+=Hr*ir[Hr],o+=Hr*Hr*ir[Hr],a+=Hr*Hr*Hr*ir[Hr];m=t*o-n*n,y=(-o*o+n*a)/m,D=(t*-a+o*n)/m,W=.5*(-D-Math.sqrt(D*D-4*y)),Ee=.5*(-D+Math.sqrt(D*D-4*y)),s=(Ee-n)/(Ee-W);for(let Hr=0;Hr<Ht;Hr++)if(l+=ir[Hr],l>s){dt=Hr;break}return dt}function otsu(r,e){let t=0,n=0,o=0,a=0,l=0;for(let s=0;s<r.length;s++)l+=s*r[s];for(let s=0;s<r.length;s++){n=n+r[s];const m=e-n;if(n===0||m===0)continue;t=t+s*r[s];const y=(l-t)/m,D=n*m*(t/n-y)*(t/n-y);D>=o&&(a=s,o=D)}return a}function percentile(r){let e=-1,t=.5,n=new Array(r.length),o=partialSum(r,r.length-1),a=1;for(let l=0;l<r.length;l++)n[l]=Math.abs(partialSum(r,l)/o-t),n[l]<a&&(a=n[l],e=l);return e}function partialSum(r,e){let t=0;for(let n=0;n<=e;n++)t+=r[n];return t}function renyiEntropy(r,e){let t,n,o,a=new Array(r.length),l=new Array(r.length),s=new Array(r.length),m=0,y=0,D=0,W=0,Ee=0,dt=0,ir=1/(1-.5),Bn=1/(1-2);for(let il=0;il<r.length;il++)a[il]=r[il]/e;l[0]=a[0],s[0]=1-l[0];for(let il=1;il<r.length;il++)l[il]=l[il-1]+a[il],s[il]=1-l[il];n=0;for(let il=0;il<r.length;il++)if(Math.abs(l[il])>=Number.EPSILON){n=il;break}o=r.length-1;for(let il=r.length-1;il>=n;il--)if(Math.abs(s[il])>=Number.EPSILON){o=il;break}for(let il=n;il<=o;il++){let gl=0,ml=0,sl=0;for(let Bh=0;Bh<=il;Bh++)r[Bh]!==0&&(gl-=a[Bh]/l[il]*Math.log(a[Bh]/l[il])),ml+=Math.sqrt(a[Bh]/l[il]),sl+=a[Bh]*a[Bh]/(l[il]*l[il]);let ll=0,rl=0,th=0;for(let Bh=il+1;Bh<r.length;Bh++)r[Bh]!==0&&(ll-=a[Bh]/s[il]*Math.log(a[Bh]/s[il])),rl+=Math.sqrt(a[Bh]/s[il]),th+=a[Bh]*a[Bh]/(s[il]*s[il]);let nh=gl+ll,bh=ir*(ml*rl>0?Math.log(ml*rl):0),Fh=Bn*(sl*th>0?Math.log(sl*th):0);nh>W&&(W=nh,m=il),bh>Ee&&(Ee=bh,y=il),Fh>dt&&(dt=Fh,D=il)}let Vn=[m,y,D];Vn.sort((il,gl)=>il-gl);let Wr;Math.abs(Vn[0]-Vn[1])<=5?Math.abs(Vn[1]-Vn[2])<=5?Wr=[1,2,1]:Wr=[0,1,3]:Math.abs(Vn[1]-Vn[2])<=5?Wr=[3,1,0]:Wr=[1,2,1];let ps=l[Vn[2]]-l[Vn[0]];return t=Math.round(Vn[0]*(l[Vn[0]]+.25*ps*Wr[0])+.25*Vn[1]*ps*Wr[1]+Vn[2]*(s[Vn[2]]+.25*ps*Wr[2])),t}function shanbhag(r,e){let t=new Array(r.length);for(let dt=0;dt<r.length;dt++)t[dt]=r[dt]/e;let n=new Array(r.length),o=new Array(r.length);n[0]=t[0],o[0]=1-n[0];for(let dt=1;dt<r.length;dt++)n[dt]=n[dt-1]+t[dt],o[dt]=1-n[dt];let a=0;for(let dt=0;dt<r.length;dt++)if(Math.abs(n[dt])>=Number.EPSILON){a=dt;break}let l=r.length-1;for(let dt=r.length-1;dt>=a;dt--)if(Math.abs(o[dt])>=Number.EPSILON){l=dt;break}let s=-1,m=Number.MAX_VALUE,y,D,W,Ee;for(let dt=a;dt<=l;dt++){W=0,y=.5/n[dt];for(let Ht=1;Ht<=dt;Ht++)W-=t[Ht]*Math.log(1-y*n[Ht-1]);W*=y,Ee=0,y=.5/o[dt];for(let Ht=dt+1;Ht<r.length;Ht++)Ee-=t[Ht]*Math.log(1-y*o[Ht]);Ee*=y,D=Math.abs(W-Ee),D<m&&(m=D,s=dt)}return s}function triangle$1(r){let e=0,t=0,n=0,o=0;for(let W=0;W<r.length;W++)if(r[W]>0){e=W;break}e>0&&e--;for(let W=r.length-1;W>0;W--)if(r[W]>0){o=W;break}o<r.length-1&&o++;for(let W=0;W<r.length;W++)r[W]>t&&(n=W,t=r[W]);let a=!1;if(n-e<o-n){a=!0;let W=0,Ee=r.length-1;for(;W<Ee;){let dt=r[W];r[W]=r[Ee],r[Ee]=dt,W++,Ee--}e=r.length-1-o,n=r.length-1-n}if(e===n)return e;let l,s,m;l=r[n],s=e-n,m=Math.sqrt(l*l+s*s),l/=m,s/=m,m=l*e+s*r[e];let y=e,D=0;for(let W=e+1;W<=n;W++){let Ee=l*W+s*r[W]-m;Ee>D&&(y=W,D=Ee)}if(y--,a){let W=0,Ee=r.length-1;for(;W<Ee;){let dt=r[W];r[W]=r[Ee],r[Ee]=dt,W++,Ee--}return r.length-1-y}else return y}function yen(r,e){let t=new Array(r.length);for(let y=0;y<r.length;y++)t[y]=r[y]/e;let n=new Array(r.length);n[0]=t[0];for(let y=1;y<r.length;y++)n[y]=n[y-1]+t[y];let o=new Array(r.length);o[0]=t[0]*t[0];for(let y=1;y<r.length;y++)o[y]=o[y-1]+t[y]*t[y];let a=new Array(r.length);a[r.length-1]=0;for(let y=r.length-2;y>=0;y--)a[y]=a[y+1]+t[y+1]*t[y+1];let l=-1,s=Number.MIN_VALUE,m;for(let y=0;y<r.length;y++)m=-1*(o[y]*a[y]>0?Math.log(o[y]*a[y]):0)+2*(n[y]*(1-n[y])>0?Math.log(n[y]*(1-n[y])):0),m>s&&(s=m,l=y);return l}const methods={huang,intermodes,isodata,li,maxentropy:maxEntropy,mean:mean$1,minerror:minError,minimum,moments,otsu,percentile,renyientropy:renyiEntropy,shanbhag,triangle:triangle$1,yen},names={};Object.keys(methods).forEach(r=>{names[r]=r});function getThreshold(r={}){let{algorithm:e=names.otsu}=r;this.checkProcessable("getThreshold",{components:1,bitDepth:[8,16]});let t=methods[e.toLowerCase()];if(t){let n=this.getHistogram();return t(n,this.size)}else throw new Error(`unknown thresholding algorithm: ${e}`)}const THRESHOLD="threshold";function mask(r={}){let{algorithm:e=THRESHOLD,threshold:t=.5,useAlpha:n=!0,invert:o=!1}=r;this.checkProcessable("mask",{components:1,bitDepth:[8,16]}),e===THRESHOLD?t=getThreshold$1(t,this.maxValue):t=getThreshold.call(this,r);let a=new Image$1(this.width,this.height,{kind:"BINARY",parent:this}),l=0;if(this.alpha&&n)for(let s=0;s<this.data.length;s+=this.channels){let m=this.data[s]+(this.maxValue-this.data[s])*(this.maxValue-this.data[s+1])/this.maxValue;(o&&m<=t||!o&&m>=t)&&a.setBit(l),l++}else for(let s=0;s<this.data.length;s+=this.channels)(o&&this.data[s]<=t||!o&&this.data[s]>=t)&&a.setBit(l),l++;return a}function copyImage(r,e,t,n){let o=r.width,a=r.height,l=e.width,s=r.channels;for(let m=0;m<o;m++)for(let y=0;y<a;y++)for(let D=0;D<s;D++){let W=(y*o+m)*s+D,Ee=((n+y)*l+t+m)*s+D;e.data[Ee]=r.data[W]}}function pad(r={}){let{size:e=0,algorithm:t="copy",color:n}=r;if(this.checkProcessable("pad",{bitDepth:[8,16]}),t==="set"){if(n.length!==this.channels)throw new Error(`pad: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let m=0;m<n.length;m++)n[m]===0&&(n[m]=.001)}else n=newArray$1(this.channels,null);Array.isArray(e)||(e=[e,e]);let o=this.width+e[0]*2,a=this.height+e[1]*2,l=this.channels,s=Image$1.createFrom(this,{width:o,height:a});copyImage(this,s,e[0],e[1]);for(let m=e[0];m<o-e[0];m++)for(let y=0;y<l;y++){let D=n[y]||s.data[(e[1]*o+m)*l+y];for(let W=0;W<e[1];W++)s.data[(W*o+m)*l+y]=D;D=n[y]||s.data[((a-e[1]-1)*o+m)*l+y];for(let W=a-e[1];W<a;W++)s.data[(W*o+m)*l+y]=D}for(let m=0;m<a;m++)for(let y=0;y<l;y++){let D=n[y]||s.data[(m*o+e[0])*l+y];for(let W=0;W<e[0];W++)s.data[(m*o+W)*l+y]=D;D=n[y]||s.data[(m*o+o-e[0]-1)*l+y];for(let W=o-e[0];W<o;W++)s.data[(m*o+W)*l+y]=D}return s}function colorDepth(r=8){if(this.checkProcessable("colorDepth",{bitDepth:[1,8,16]}),![8,16].includes(r))throw Error("You need to specify the new colorDepth as 8 or 16");if(this.bitDepth===r)return this.clone();let e=Image$1.createFrom(this,{bitDepth:r});switch(r){case 8:if(this.bitDepth===1)for(let t=0;t<this.size;t++)this.getBit(t)&&(e.data[t]=255);else for(let t=0;t<this.data.length;t++)e.data[t]=this.data[t]>>8;break;case 16:if(this.bitDepth===1)for(let t=0;t<this.size;t++)this.getBit(t)&&(e.data[t]=65535);else for(let t=0;t<this.data.length;t++)e.data[t]=this.data[t]<<8|this.data[t];break;default:throw new Error("colorDepth conversion unexpected case")}return e}function rotateFree(r,e={}){const{interpolation:t=validInterpolations.nearestneighbor,width:n=this.width,height:o=this.height}=e;if(typeof r!="number")throw new TypeError("degrees must be a number");const a=checkInterpolation(t),l=r*Math.PI/180,s=Math.floor(Math.abs(n*Math.cos(l))+Math.abs(o*Math.sin(l))),m=Math.floor(Math.abs(o*Math.cos(l))+Math.abs(n*Math.sin(l))),y=Math.cos(-l),D=Math.sin(-l);let W=s/2,Ee=m/2;s%2===0?(W=W-.5,m%2===0?Ee=Ee-.5:Ee=Math.floor(Ee)):(W=Math.floor(W),m%2===0?Ee=Ee-.5:Ee=Math.floor(Ee));const dt=Math.floor(n/2-W),Ht=Math.floor(o/2-Ee);if(this.bitDepth===1){const ir=new Image$1(s,m,{kind:"BINARY",parent:this});switch(a){case validInterpolations.nearestneighbor:return rotateBinaryNearestNeighbor(this,ir,dt,Ht,W,Ee,y,D);case validInterpolations.bilinear:return rotateBinaryBilinear(this,ir,dt,Ht,W,Ee,y,D);default:throw new Error(`unsupported rotate interpolation: ${a}`)}}else{const ir=Image$1.createFrom(this,{width:s,height:m});switch(a){case validInterpolations.nearestneighbor:return rotateNearestNeighbor(this,ir,dt,Ht,W,Ee,y,D);case validInterpolations.bilinear:return rotateBilinear(this,ir,dt,Ht,W,Ee,y,D);default:throw new Error(`unsupported rotate interpolation: ${a}`)}}}function rotateNearestNeighbor(r,e,t,n,o,a,l,s){for(let m=0;m<e.width;m+=1)for(let y=0;y<e.height;y+=1)for(let D=0;D<r.channels;D++){let W=Math.round((m-o)*l-(y-a)*s+o)+t,Ee=Math.round((y-a)*l+(m-o)*s+a)+n;W<0||W>=r.width||Ee<0||Ee>=r.height?r.alpha===1&&D===r.channels-1?e.setValueXY(m,y,D,0):e.setValueXY(m,y,D,r.maxValue):e.setValueXY(m,y,D,r.getValueXY(W,Ee,D))}return e}function rotateBinaryNearestNeighbor(r,e,t,n,o,a,l,s){for(let m=0;m<e.width;m+=1)for(let y=0;y<e.height;y+=1){let D=Math.round((m-o)*l-(y-a)*s+o)+t,W=Math.round((y-a)*l+(m-o)*s+a)+n;(D<0||D>=r.width||W<0||W>=r.height||r.getBitXY(D,W))&&e.setBitXY(m,y)}return e}function rotateBilinear(r,e,t,n,o,a,l,s){let m=r.width*r.channels;for(let y=0;y<e.height;y++)for(let D=0;D<e.width;D++){let W=(D-o)*l-(y-a)*s+o+t,Ee=(y-a)*l+(D-o)*s+a+n,dt=W|0,Ht=Ee|0,ir=W-dt,Hr=Ee-Ht;for(let Bn=0;Bn<r.channels;Bn++)if(W<0||W>=r.width||Ee<0||Ee>=r.height)r.alpha===1&&Bn===r.channels-1?e.setValueXY(D,y,Bn,0):e.setValueXY(D,y,Bn,r.maxValue);else{let Vn=(Ht*r.width+dt)*r.channels+Bn,Wr=r.data[Vn],ps=r.data[Vn+r.channels],il=r.data[Vn+m],gl=r.data[Vn+m+r.channels],ml=Wr+ir*(ps-Wr)+Hr*(il-Wr)+ir*Hr*(Wr-ps-il+gl)|0;e.setValueXY(D,y,Bn,ml)}}return e}function rotateBinaryBilinear(r,e,t,n,o,a,l,s){let m=r.width;for(let y=0;y<e.height;y++)for(let D=0;D<e.width;D++){let W=(D-o)*l-(y-a)*s+o+t,Ee=(y-a)*l+(D-o)*s+a+n,dt=W|0,Ht=Ee|0,ir=W-dt,Hr=Ee-Ht;if(W<0||W>=r.width||Ee<0||Ee>=r.height)e.setBitXY(D,y);else{let Bn=Ht*r.width+dt,Vn=r.getBit(Bn),Wr=r.getBit(Bn+1),ps=r.getBit(Bn+m),il=r.getBit(Bn+1+m);(Vn|ir&Wr-Vn|Hr&ps-Vn|ir&Hr&Vn-Wr-ps+il)>0&&e.setBitXY(D,y)}}return e}function rotate$1(r,e){if(this.checkProcessable("rotate",{bitDepth:[1,8,16]}),typeof r!="number")throw new TypeError("angle must be a number");switch(r<0&&(r=Math.ceil(-r/360)*360+r),r%360){case 0:return this.clone();case 90:return rotateRight.call(this);case 180:return rotate180.call(this);case 270:return rotateLeft.call(this);default:return rotateFree.call(this,r,e)}}function rotateLeft(){if(this.bitDepth===1){const r=new Image$1(this.height,this.width,{kind:"BINARY",parent:this}),e=r.height-1;for(let t=0;t<this.height;t++)for(let n=0;n<this.width;n++)this.getBitXY(n,t)&&r.setBitXY(t,e-n);return r}else{const r=Image$1.createFrom(this,{width:this.height,height:this.width}),e=r.height-1;for(let t=0;t<this.height;t++)for(let n=0;n<this.width;n++)for(let o=0;o<this.channels;o++)r.setValueXY(t,e-n,o,this.getValueXY(n,t,o));return r}}function rotateRight(){if(this.bitDepth===1){const r=new Image$1(this.height,this.width,{kind:"BINARY",parent:this}),e=r.width-1;for(let t=0;t<this.height;t++)for(let n=0;n<this.width;n++)this.getBitXY(n,t)&&r.setBitXY(e-t,n);return r}else{const r=Image$1.createFrom(this,{width:this.height,height:this.width}),e=r.width-1;for(let t=0;t<this.height;t++)for(let n=0;n<this.width;n++)for(let o=0;o<this.channels;o++)r.setValueXY(e-t,n,o,this.getValueXY(n,t,o));return r}}function rotate180(){if(this.bitDepth===1){const r=new Image$1(this.width,this.height,{kind:"BINARY",parent:this}),e=r.width-1,t=r.height-1;for(let n=0;n<this.height;n++)for(let o=0;o<this.width;o++)this.getBitXY(o,n)&&r.setBitXY(e-o,t-n);return r}else{const r=Image$1.createFrom(this),e=r.width-1,t=r.height-1;for(let n=0;n<this.height;n++)for(let o=0;o<this.width;o++)for(let a=0;a<this.channels;a++)r.setValueXY(e-o,t-n,a,this.getValueXY(o,n,a));return r}}function insert(r,e={}){const t=getImageParameters(r);this.checkProcessable("insert",t);let{x:n=0,y:o=0}=e;const a=getOutputImageOrInPlace(this,e,{copy:!0}),l=Math.min(a.height,o+r.height),s=Math.min(a.width,n+r.width);if(a.bitDepth===1)for(let m=o;m<l;m++)for(let y=n;y<s;y++)r.getBitXY(y-n,m-o)?a.setBitXY(y,m):a.clearBitXY(y,m);else for(let m=o;m<l;m++)for(let y=n;y<s;y++)a.setPixelXY(y,m,r.getPixelXY(y-n,m-o));return a}function setBorder(r={}){let{size:e=0,algorithm:t="copy",color:n}=r;if(this.checkProcessable("setBorder",{bitDepth:[8,16,32,64]}),t==="set"){if(n.length!==this.channels)throw new Error(`setBorder: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let s=0;s<n.length;s++)n[s]===0&&(n[s]=.001)}else n=newArray$1(this.channels,null);Array.isArray(e)||(e=[e,e]);let o=e[0],a=e[1],l=this.channels;for(let s=o;s<this.width-o;s++)for(let m=0;m<l;m++){let y=n[m]||this.data[(s+this.width*a)*l+m];for(let D=0;D<a;D++)this.data[(D*this.width+s)*l+m]=y;y=n[m]||this.data[(s+this.width*(this.height-a-1))*l+m];for(let D=this.height-a;D<this.height;D++)this.data[(D*this.width+s)*l+m]=y}for(let s=0;s<this.height;s++)for(let m=0;m<l;m++){let y=n[m]||this.data[(s*this.width+o)*l+m];for(let D=0;D<o;D++)this.data[(s*this.width+D)*l+m]=y;y=n[m]||this.data[(s*this.width+this.width-o-1)*l+m];for(let D=this.width-o;D<this.width;D++)this.data[(s*this.width+D)*l+m]=y}return this}function split(r={}){let{preserveAlpha:e=!0}=r;if(this.checkProcessable("split",{bitDepth:[8,16]}),this.components===1)return new Stack([this.clone()]);let t=new Stack,n=this.data;if(this.alpha&&e)for(let o=0;o<this.components;o++){let a=Image$1.createFrom(this,{components:1,alpha:!0,colorModel:GREY$1}),l=0;for(let s=0;s<n.length;s+=this.channels)a.data[l++]=n[s+o],a.data[l++]=n[s+this.components];t.push(a)}else for(let o=0;o<this.channels;o++){let a=Image$1.createFrom(this,{components:1,alpha:!1,colorModel:GREY$1}),l=0;for(let s=0;s<n.length;s+=this.channels)a.data[l++]=n[s+o];t.push(a)}return t}function getChannel(r,e={}){let{keepAlpha:t=!1,mergeAlpha:n=!1}=e;t&=this.alpha,n&=this.alpha,this.checkProcessable("getChannel",{bitDepth:[8,16]}),r=validateChannel(this,r);let o=Image$1.createFrom(this,{components:1,alpha:t,colorModel:GREY$1}),a=0;for(let l=0;l<this.data.length;l+=this.channels)n?o.data[a++]=this.data[l+r]*this.data[l+this.components]/this.maxValue:(o.data[a++]=this.data[l+r],t&&(o.data[a++]=this.data[l+this.components]));return o}function combineChannels(r=defaultCombineMethod,e={}){let{mergeAlpha:t=!1,keepAlpha:n=!1}=e;t&=this.alpha,n&=this.alpha,this.checkProcessable("combineChannels",{bitDepth:[8,16]});let o=Image$1.createFrom(this,{components:1,alpha:n,colorModel:GREY$1}),a=0;for(let l=0;l<this.size;l++){let s=r(this.getPixel(l));t?o.data[a++]=s*this.data[l*this.channels+this.components]/this.maxValue:(o.data[a++]=s,n&&(o.data[a++]=this.data[l*this.channels+this.components]))}return o}function defaultCombineMethod(r){return(r[0]+r[1]+r[2])/3}function setChannel(r,e){if(this.checkProcessable("setChannel",{bitDepth:[8,16]}),e.checkProcessable("setChannel (image parameter check)",{bitDepth:[this.bitDepth],alpha:[0],components:[1]}),e.width!==this.width||e.height!==this.height)throw new Error("Images must have exactly the same width and height");r=validateChannel(this,r);let t=r;for(let n=0;n<e.data.length;n++)this.data[t]=e.data[n],t+=this.channels;return this}function getSimilarity(r,e={}){let{shift:t=[0,0],average:n,channels:o,defaultAlpha:a,normalize:l,border:s=[0,0]}=e;if(this.checkProcessable("getSimilarity",{bitDepth:[8,16]}),Array.isArray(s)||(s=[s,s]),o=validateArrayOfChannels(this,{channels:o,defaultAlpha:a}),this.bitDepth!==r.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==r.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==r.colorModel)throw new Error("Both images must have the same colorModel");typeof n>"u"&&(n=!0);let m=Math.max(s[0],-t[0]),y=Math.min(this.width-s[0],this.width-t[0]),D=Math.max(s[1],-t[1]),W=Math.min(this.height-s[1],this.height-t[1]),Ee=newArray$1(o.length,0);for(let dt=0;dt<o.length;dt++){let Ht=o[dt],ir=l?this.sum[Ht]:Math.max(this.sum[Ht],r.sum[Ht]),Hr=l?r.sum[Ht]:Math.max(this.sum[Ht],r.sum[Ht]);if(ir!==0&&Hr!==0)for(let Bn=m;Bn<y;Bn++)for(let Vn=D;Vn<W;Vn++){let Wr=Bn*this.multiplierX+Vn*this.multiplierY+Ht,ps=Wr+t[0]*this.multiplierX+t[1]*this.multiplierY;Ee[dt]+=Math.min(this.data[Wr]/ir,r.data[ps]/Hr)}}return n?Ee.reduce((dt,Ht)=>dt+Ht)/Ee.length:Ee}function getPixelsGrid(r={}){let{sampling:e=[10,10],painted:t=!1,mask:n}=r;this.checkProcessable("getPixelsGrid",{bitDepth:[8,16],channels:1}),Array.isArray(e)||(e=[e,e]);const o=e[0],a=e[1],l=[],s=[],m=this.width/o,y=this.height/a;let D=Math.floor(m/2);for(let Ee=0;Ee<o;Ee++){let dt=Math.floor(y/2);for(let Ht=0;Ht<a;Ht++){let ir=Math.round(D),Hr=Math.round(dt);(!n||n.getBitXY(ir,Hr))&&(l.push([ir,Hr]),s.push(this.getPixelXY(ir,Hr))),dt+=y}D+=m}const W={xyS:l,zS:s};return t&&(W.painted=this.rgba8().paintPoints(l)),W}function Matrix(r,e,t){const n=new Array(r);for(let o=0;o<r;o++)n[o]=new Array(e);if(t)for(let o=0;o<r;o++)for(let a=0;a<e;a++)n[o][a]=t;return n.width=r,n.height=e,Object.setPrototypeOf(n,Matrix.prototype),n}Matrix.prototype.localMin=function(r,e){let t=this[r][e],n=[r,e];for(let o=Math.max(0,r-1);o<Math.min(this.length,r+2);o++)for(let a=Math.max(0,e-1);a<Math.min(this[0].length,e+2);a++)this[o][a]<t&&(t=this[o][a],n=[o,a]);return{position:n,value:t}};Matrix.prototype.localMax=function(r,e){let t=this[r][e],n=[r,e];for(let o=Math.max(0,r-1);o<Math.min(this.length,r+2);o++)for(let a=Math.max(0,e-1);a<Math.min(this[0].length,e+2);a++)this[o][a]>t&&(t=this[o][a],n=[o,a]);return{position:n,value:t}};Matrix.prototype.localSearch=function(r,e,t){let n=[];for(let o=Math.max(0,r-1);o<Math.min(this.length,r+2);o++)for(let a=Math.max(0,e-1);a<Math.min(this[0].length,e+2);a++)this[o][a]===t&&n.push([o,a]);return n};function getBestMatch(r,e={}){let{border:t}=e;if(this.checkProcessable("getChannel",{bitDepth:[8,16]}),this.bitDepth!==r.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==r.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==r.colorModel)throw new Error("Both images must have the same colorModel");let n=new Matrix(r.width,r.height,-1/0),o=Math.floor(r.width/2),a=Math.floor(r.height/2),l=o,s=a,m=!1;for(;!m;){let y=n.localSearch(o,a,-1/0);for(let W=0;W<y.length;W++){let Ee=y[W],dt=this.getSimilarity(r,{border:t,shift:[l-Ee[0],s-Ee[1]]});n[Ee[0]][Ee[1]]=dt}let D=n.localMax(o,a);D.position[0]!==o||D.position[1]!==a?(o=D.position[0],a=D.position[1]):m=!0}return[o-l,a-s]}function getRow(r,e=0){this.checkProcessable("getRow",{bitDepth:[8,16]}),checkRow(this,r),checkChannel(this,e);let t=new Array(this.width),n=0,o=r*this.width*this.channels+e,a=o+this.width*this.channels;for(let l=o;l<a;l+=this.channels)t[n++]=this.data[l];return t}function getColumn(r,e=0){this.checkProcessable("getColumn",{bitDepth:[8,16]}),checkColumn(this,r),checkChannel(this,e);let t=new Array(this.height),n=0,o=this.width*this.channels;for(let a=e+r*this.channels;a<this.data.length;a+=o)t[n++]=this.data[a];return t}function getMatrix(r={}){let{channel:e}=r;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),e===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");e=0}let t=new Matrix$2(this.height,this.width);for(let n=0;n<this.height;n++)for(let o=0;o<this.width;o++)t.set(n,o,this.getValueXY(o,n,e));return t}function setMatrix(r,e={}){r=new Matrix$2(r);let{channel:t}=e;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),t===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");t=0}if(this.width!==r.columns||this.height!==r.rows)throw new RangeError("The size of the matrix must be equal to the size of the image");for(let n=0;n<this.height;n++)for(let o=0;o<this.width;o++)this.setValueXY(o,n,t,r.get(n,o));return this}function getPixelsArray(){this.checkProcessable("getPixelsArray",{bitDepth:[8,16,32]});let r=new Array(this.size),e=0;for(let t=0;t<this.data.length;t+=this.channels){let n=new Array(this.components);for(let o=0;o<this.components;o++)n[o]=this.data[t+o];r[e++]=n}return r}function getIntersection(r){let e=this,t=e.getClosestCommonParent(r),n=e.getRelativePosition(t,{defaultFurther:!0}),o=getRelativePositionForAllPixels(e,n),a=r.getRelativePosition(t,{defaultFurther:!0}),l=getRelativePositionForAllPixels(r,a),s=getCommonSurface(o,l),m={whitePixelsMask1:[],whitePixelsMask2:[],commonWhitePixels:[]};for(let y=0;y<s.length;y++){let D=s[y],W=[D[0]-n[0],D[1]-n[1]],Ee=[D[0]-a[0],D[1]-a[1]],dt=e.getBitXY(W[0],W[1]),Ht=r.getBitXY(Ee[0],Ee[1]);dt===1&&Ht===1&&m.commonWhitePixels.push(D)}for(let y=0;y<o.length;y++){let D,W;y!==0&&(D=Math.floor(y/e.width),W=y%e.width),e.getBitXY(D,W)===1&&m.whitePixelsMask1.push(o[y])}for(let y=0;y<l.length;y++){let D=0,W=0;y!==0&&(D=Math.floor(y/r.width),W=y%r.width),r.getBitXY(D,W)===1&&m.whitePixelsMask2.push(l[y])}return m}function getRelativePositionForAllPixels(r,e){let t=[];for(let n=0;n<r.height;n++)for(let o=0;o<r.width;o++){let a=[n,o];t.push([a[0]+e[0],a[1]+e[1]])}return t}function getCommonSurface(r,e){let t=0,n=0,o=[];for(;t<r.length&&n<e.length;)r[t][0]===e[n][0]&&r[t][1]===e[n][1]?(o.push(r[t]),t++,n++):r[t][0]<e[n][0]||r[t][0]===e[n][0]&&r[t][1]<e[n][1]?t++:n++;return o}function getClosestCommonParent(r){let e=getDepth(this),t=getDepth(r),n;if(e>=t?n=getFurthestParent(this,e):n=getFurthestParent(r,t),e===0||t===0)return n;let o=this,a=r;for(;e!==t;)if(e>t){if(o=o.parent,o===null)return n;e=e-1}else{if(a=a.parent,a===null)return n;t=t-1}for(;o!==a&&o!==null&&a!==null;)if(o=o.parent,a=a.parent,o===null||a===null)return n;return o!==a?n:o}function getDepth(r){let e=0,t=r;for(;t.parent!=null;)t=t.parent,e++;return e}function getFurthestParent(r,e){let t=r;for(;e>0;)t=t.parent,e=e-1;return t}const defaultOptions$1={lowThreshold:10,highThreshold:30,gaussianBlur:1.1},Gx=[[-1,0,1],[-2,0,2],[-1,0,1]],Gy=[[-1,-2,-1],[0,0,0],[1,2,1]],convOptions={bitDepth:32,mode:"periodic"};function cannyEdgeDetector(r,e){r.checkProcessable("Canny edge detector",{bitDepth:8,channels:1,components:1}),e=Object.assign({},defaultOptions$1,e);const t=r.width,n=r.height,o=r.maxValue,a={sigma:e.gaussianBlur,radius:3},l=r.gaussianFilter(a),s=l.convolution(Gy,convOptions),m=l.convolution(Gx,convOptions),y=m.hypotenuse(s),D=r.constructor,W=new D(t,n,{kind:"GREY",bitDepth:32}),Ee=new D(t,n,{kind:"GREY",bitDepth:32}),dt=new D(t,n,{kind:"GREY"});for(var Ht=1;Ht<t-1;Ht++)for(var ir=1;ir<n-1;ir++){var Hr=(Math.round(Math.atan2(m.getValueXY(Ht,ir,0),s.getValueXY(Ht,ir,0))*(5/Math.PI))+5)%5;Hr===0&&(y.getValueXY(Ht,ir,0)<=y.getValueXY(Ht,ir-1,0)||y.getValueXY(Ht,ir,0)<=y.getValueXY(Ht,ir+1,0))||Hr===1&&(y.getValueXY(Ht,ir,0)<=y.getValueXY(Ht-1,ir+1,0)||y.getValueXY(Ht,ir,0)<=y.getValueXY(Ht+1,ir-1,0))||Hr===2&&(y.getValueXY(Ht,ir,0)<=y.getValueXY(Ht-1,ir,0)||y.getValueXY(Ht,ir,0)<=y.getValueXY(Ht+1,ir,0))||Hr===3&&(y.getValueXY(Ht,ir,0)<=y.getValueXY(Ht-1,ir-1,0)||y.getValueXY(Ht,ir,0)<=y.getValueXY(Ht+1,ir+1,0))||W.setValueXY(Ht,ir,0,y.getValueXY(Ht,ir,0))}for(Ht=0;Ht<t*n;++Ht){var Bn=W.data[Ht],Vn=0;Bn>e.highThreshold&&(Vn++,dt.data[Ht]=o),Bn>e.lowThreshold&&Vn++,Ee.data[Ht]=Vn}var Wr=[];for(Ht=1;Ht<t-1;++Ht)for(ir=1;ir<n-1;++ir)if(Ee.getValueXY(Ht,ir,0)===1){e:for(var ps=Ht-1;ps<Ht+2;++ps)for(var il=ir-1;il<ir+2;++il)if(Ee.getValueXY(ps,il,0)===2){Wr.push([Ht,ir]),dt.setValueXY(Ht,ir,0,o);break e}}for(;Wr.length>0;){var gl=[];for(Ht=0;Ht<Wr.length;++Ht)for(ir=-1;ir<2;++ir)for(ps=-1;ps<2;++ps)if(!(ir===0&&ps===0)){var ml=Wr[Ht][0]+ir,sl=Wr[Ht][1]+ps;Ee.getValueXY(ml,sl,0)===1&&dt.getValueXY(ml,sl,0)===0&&(gl.push([ml,sl]),dt.setValueXY(ml,sl,0,o))}Wr=gl}return dt}function cannyEdge(r){return cannyEdgeDetector(this,r)}function extract(r,e={}){let{position:t}=e;if(this.checkProcessable("extract",{bitDepth:[1,8,16]}),!t&&(t=r.getRelativePosition(this),!t))throw new Error("extract : can not extract an image because the relative position can not be determined, try to specify manually the position as an array of 2 elements [x,y].");if(this.bitDepth>1){let n=Image$1.createFrom(this,{width:r.width,height:r.height,alpha:1,position:t,parent:this});for(let o=0;o<r.width;o++)for(let a=0;a<r.height;a++){for(let l=0;l<this.channels;l++){let s=this.getValueXY(o+t[0],a+t[1],l);n.setValueXY(o,a,l,s)}r.getBitXY(o,a)||n.setValueXY(o,a,this.components,0)}return n}else{let n=Image$1.createFrom(this,{width:r.width,height:r.height,position:t,parent:this});for(let o=0;o<r.height;o++)for(let a=0;a<r.width;a++)r.getBitXY(a,o)&&this.getBitXY(a+t[0],o+t[1])&&n.setBitXY(a,o);return n}}var fastList={exports:{}};(function(r,e){(function(){function t(o,a,l){this.next=l,l&&(l.prev=this),this.prev=a,a&&(a.next=this),this.data=o}function n(){if(!(this instanceof n))return new n;this._head=null,this._tail=null,this.length=0}n.prototype={push:function(o){this._tail=new t(o,this._tail,null),this._head||(this._head=this._tail),this.length++},pop:function(){if(this.length!==0){var o=this._tail;return this._tail=o.prev,o.prev&&(o.prev=this._tail.next=null),this.length--,this.length===1?this._head=this._tail:this.length===0&&(this._head=this._tail=null),o.data}},unshift:function(o){this._head=new t(o,null,this._head),this._tail||(this._tail=this._head),this.length++},shift:function(){if(this.length!==0){var o=this._head;return this._head=o.next,o.next&&(o.next=this._head.prev=null),this.length--,this.length===1?this._tail=this._head:this.length===0&&(this._head=this._tail=null),o.data}},item:function(o){o<0&&(o=this.length+o);for(var a=this._head;o-- >0&&a;)a=a.next;return a?a.data:void 0},slice:function(o,a){if(o||(o=0),a||(a=this.length),a<0&&(a=this.length+a),o<0&&(o=this.length+o),a===o)return[];if(a<o)throw new Error("invalid offset: "+o+","+a+" (length="+this.length+")");for(var l=a-o,s=new Array(l),m=0,y=this._head;o-- >0&&y;)y=y.next;for(;m<l&&y;)s[m++]=y.data,y=y.next;return s},drop:function(){n.call(this)},forEach:function(o,a){for(var l=this._head,s=0,m=this.length;s<m&&l;)o.call(a||this,l.data,s,this),l=l.next,s++},map:function(o,a){var l=new n;return this.forEach(function(s,m,y){l.push(o.call(a||y,s,m,y))}),l},filter:function(o,a){var l=new n;return this.forEach(function(s,m,y){o.call(a||y,s,m,y)&&l.push(s)}),l},reduce:function(o,a,l){var s=0,m=this._head,y=this.length;for(a||(s=1,a=m&&m.data,m=m&&m.next);s<y&&m;)a=o.call(l||this,a,m.data,this),s++,m=m.next;return a}},r.exports=n})()})(fastList);var fastListExports=fastList.exports;const LinkedList=getDefaultExportFromCjs(fastListExports);function floodFill(r={}){const{x:e=0,y:t=0,inPlace:n=!0}=r,o=n?this:Image$1.createFrom(this);if(this.checkProcessable("floodFill",{bitDepth:1}),this.getBitXY(e,t))return o;const l=new LinkedList;for(l.push(new Node$1(e,t));l.length>0;){const s=l.shift();o.setBitXY(s.x,s.y);for(let m=s.x+1;m<this.width&&(!o.getBitXY(m,s.y)&&!this.getBitXY(m,s.y));m++)o.setBitXY(m,s.y),s.y+1<this.height&&!this.getBitXY(m,s.y+1)&&l.push(new Node$1(m,s.y+1)),s.y-1>=0&&!this.getBitXY(m,s.y-1)&&l.push(new Node$1(m,s.y-1));for(let m=s.x-1;m>=0&&(!o.getBitXY(m,s.y)&&!this.getBitXY(m,s.y));m++)o.setBitXY(m,s.y),s.y+1<this.height&&!this.getBitXY(m,s.y+1)&&l.push(new Node$1(m,s.y+1)),s.y-1>=0&&!this.getBitXY(m,s.y-1)&&l.push(new Node$1(m,s.y-1))}return o}function Node$1(r,e){this.x=r,this.y=e}function _extends(){return _extends=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},_extends.apply(this,arguments)}function hsv2rgb(r,e,t){e=e/100,t=t/100;var n=[],o=t*e,a=r/60,l=o*(1-Math.abs(a%2-1)),s=t-o;return a>=0&&a<1?n=[o,l,0]:a>=1&&a<2?n=[l,o,0]:a>=2&&a<3?n=[0,o,l]:r>=3&&a<4?n=[0,l,o]:r>=4&&a<5?n=[l,0,o]:r>=5&&a<=6?n=[o,0,l]:n=[0,0,0],{r:Math.round(255*(n[0]+s)),g:Math.round(255*(n[1]+s)),b:Math.round(255*(n[2]+s))}}function hsl2hsv(r,e,t){return e*=(t<50?t:100-t)/100,{h:r,s:2*e/(t+e)*100,v:t+e}}function hsl2rgb$1(r,e,t){var n=hsl2hsv(r,e,t);return hsv2rgb(n.h,n.s,n.v)}var colors={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]};function parse(r){return named(r)||hex3(r)||hex6(r)||rgb(r)||rgba$1(r)||hsl(r)||hsla(r)}function named(r){var e=colors[r.toLowerCase()];if(e)return{r:e[0],g:e[1],b:e[2],a:100}}function rgb(r){var e=r.match(/rgb\(([^)]+)\)/);if(e){var t=e[1].split(/ *, */).map(Number);return{r:t[0],g:t[1],b:t[2],a:100}}}function rgba$1(r){var e=r.match(/rgba\(([^)]+)\)/);if(e){var t=e[1].split(/ *, */).map(Number);return{r:t[0],g:t[1],b:t[2],a:t[3]*100}}}function hex6(r){if(r[0]==="#"&&r.length===7)return{r:parseInt(r.slice(1,3),16),g:parseInt(r.slice(3,5),16),b:parseInt(r.slice(5,7),16),a:100}}function hex3(r){if(r[0]==="#"&&r.length===4)return{r:parseInt(r[1]+r[1],16),g:parseInt(r[2]+r[2],16),b:parseInt(r[3]+r[3],16),a:100}}function hsl(r){var e=r.match(/hsl\(([^)]+)\)/);if(e){var t=e[1].split(/ *, */),n=parseInt(t[0],10),o=parseInt(t[1],10),a=parseInt(t[2],10),l=hsl2rgb$1(n,o,a);return _extends({},l,{a:100})}}function hsla(r){var e=r.match(/hsla\(([^)]+)\)/);if(e){var t=e[1].split(/ *, */),n=parseInt(t[0],10),o=parseInt(t[1],10),a=parseInt(t[2],10),l=parseInt(parseFloat(t[3])*100,10),s=hsl2rgb$1(n,o,a);return _extends({},s,{a:l})}}function css2array(r){let e=parse(r);return[e.r,e.g,e.b,Math.round(e.a*255/100)]}function hue2rgb(r,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?r+(e-r)*6*t:t<1/2?e:t<2/3?r+(e-r)*(2/3-t)*6:r}function hsl2rgb(r,e,t){let n,o,a,l,s,m;return e/=100,t/=100,e===0?l=s=m=t*255:(t<=.5?o=t*(e+1):o=t+e-t*e,n=t*2-o,a=r/360,l=hue2rgb(n,o,a+1/3),s=hue2rgb(n,o,a),m=hue2rgb(n,o,a-1/3)),{r:l,g:s,b:m}}function getDistinctColors(r){let e=new Array(r),t=0;for(let n=0;n<360;n+=360/r){t++;let o=hsl2rgb(n,100,30+t%4*15);e[t-1]=[Math.round(o.r*255),Math.round(o.g*255),Math.round(o.b*255)]}return e}function getRandomColor(){return[Math.floor(Math.random()*256),Math.floor(Math.random()*256),Math.floor(Math.random()*256)]}function getColors(r){let{color:e,colors:t,randomColors:n,numberColors:o=50}=r;if(e&&!Array.isArray(e)&&(e=css2array(e)),e)return[e];if(t)return t=t.map(function(a){return Array.isArray(a)?a:css2array(a)}),t;if(n){t=new Array(o);for(let a=0;a<o;a++)t[a]=getRandomColor()}return getDistinctColors(o)}function paintLabels(r,e,t={}){let{color:n="blue",colors:o,font:a="12px Helvetica",rotate:l=0}=t;if(this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1}),!Array.isArray(r))throw Error("paintLabels: labels must be an array");if(!Array.isArray(e))throw Error("paintLabels: positions must be an array");if(n&&!Array.isArray(n)&&(n=css2array(n)),o?o=o.map(function(y){return Array.isArray(y)?y:css2array(y)}):o=[n],r.length!==e.length)throw Error("paintLabels: positions and labels must be arrays from the same size");Array.isArray(a)||(a=[a]),Array.isArray(l)||(l=[l]);let m=this.getCanvas().getContext("2d");for(let y=0;y<r.length;y++){m.save();let D=o[y%o.length];m.fillStyle=`rgba(${D[0]},${D[1]},${D[2]},${D[3]/this.maxValue})`,m.font=a[y%a.length];let W=e[y];m.translate(W[0],W[1]),m.rotate(l[y%l.length]/180*Math.PI),m.fillText(r[y],0,0),m.restore()}return this.data=Uint8Array.from(m.getImageData(0,0,this.width,this.height).data),this}function paintMasks(r,e={}){let{alpha:t=255,labels:n=[],labelsPosition:o=[],labelColor:a="blue",labelFont:l="12px Helvetica"}=e;this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1});let s=getColors(Object.assign({},e,{numberColors:r.length}));Array.isArray(r)||(r=[r]);for(let m=0;m<r.length;m++){let y=r[m],D=s[m%s.length];for(let W=0;W<y.width;W++)for(let Ee=0;Ee<y.height;Ee++)if(y.getBitXY(W,Ee))for(let dt=0;dt<Math.min(this.components,D.length);dt++)if(t===255)this.setValueXY(W+y.position[0],Ee+y.position[1],dt,D[dt]);else{let Ht=this.getValueXY(W+y.position[0],Ee+y.position[1],dt);Ht=Math.round((Ht*(255-t)+D[dt]*t)/255),this.setValueXY(W+y.position[0],Ee+y.position[1],dt,Ht)}}if(Array.isArray(n)&&n.length>0){let y=this.getCanvas().getContext("2d");y.fillStyle=a,y.font=l;for(let D=0;D<Math.min(r.length,n.length);D++){let W=o[D]?o[D]:r[D].position;y.fillText(n[D],W[0],W[1])}this.data=Uint8Array.from(y.getImageData(0,0,this.width,this.height).data)}return this}function zerosMatrix(r,e){let t=new Array(r);for(let n=0;n<r;n++)t[n]=new Array(e).fill(0);return t}const cross=[[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]],smallCross=[[0,1,0],[1,1,1],[0,1,0]];class Shape{constructor(e={}){let{kind:t="cross",shape:n,size:o,width:a,height:l,filled:s=!0}=e;if(o&&(a=o,l=o),n)switch(n.toLowerCase()){case"square":case"rectangle":this.matrix=rectangle(a,l,{filled:s});break;case"circle":case"ellipse":this.matrix=ellipse(a,l,{filled:s});break;case"triangle":this.matrix=triangle(a,l,{filled:s});break;default:throw new Error(`Shape: unexpected shape: ${n}`)}else if(t)switch(t.toLowerCase()){case"cross":this.matrix=cross;break;case"smallcross":this.matrix=smallCross;break;default:throw new Error(`Shape: unexpected kind: ${t}`)}else throw new Error("Shape: expected a kind or a shape option");this.height=this.matrix.length,this.width=this.matrix[0].length,this.halfHeight=this.height/2>>0,this.halfWidth=this.width/2>>0}getPoints(){let e=this.matrix,t=[];for(let n=0;n<e.length;n++)for(let o=0;o<e[0].length;o++)e[n][o]&&t.push([o-this.halfWidth,n-this.halfHeight]);return t}getMask(){let e=new Image$1(this.width,this.height,{kind:BINARY});for(let t=0;t<this.matrix.length;t++)for(let n=0;n<this.matrix[0].length;n++)this.matrix[t][n]&&e.setBitXY(n,t);return e}}function rectangle(r,e,t){const n=zerosMatrix(e,r);if(t.filled)for(let o=0;o<e;o++)for(let a=0;a<r;a++)n[o][a]=1;else{for(let o of[0,e-1])for(let a=0;a<r;a++)n[o][a]=1;for(let o=0;o<e;o++)for(let a of[0,r-1])n[o][a]=1}return n}function ellipse(r,e,t){const n=zerosMatrix(e,r);let o=1-e%2,a=1-r%2,l=Math.floor((r-1)/2),s=Math.floor((e-1)/2),m=l*l,y=s*s;if(t.filled)for(let D=0;D<=s;D++){let W=Math.floor(Math.sqrt(m-m*D*D/y));for(let Ee=l-W;Ee<=l;Ee++)n[s-D][Ee]=1,n[s+D+o][Ee]=1,n[s-D][r-Ee-1]=1,n[s+D+o][r-Ee-1]=1}else{for(let D=0;D<=s;D++){let W=Math.floor(Math.sqrt(m-m*D*D/y)),Ee=l-W;n[s-D][Ee]=1,n[s+D+o][Ee]=1,n[s-D][r-Ee-1]=1,n[s+D+o][r-Ee-1]=1}for(let D=0;D<=l;D++){let W=Math.floor(Math.sqrt(y-y*D*D/m)),Ee=s-W;n[Ee][l-D]=1,n[Ee][l+D+a]=1,n[e-Ee-1][l-D]=1,n[e-Ee-1][l+D+a]=1}}return n}function triangle(r,e,t){if(!t.filled)throw new Error("Non filled triangle is not implemented");const n=zerosMatrix(e,r);for(let o=0;o<e;o++){let a=Math.floor((1-o/e)*r/2);for(let l=a;l<r-a;l++)n[o][l]=1}return n}function paintPoints(r,e={}){let{shape:t}=e;this.checkProcessable("paintPoints",{bitDepth:[8,16]});let n=getColors(Object.assign({},e,{numberColors:r.length})),o=new Shape(t).getPoints(),a=Math.min(this.channels,n[0].length);for(let l=0;l<r.length;l++){let s=n[l%n.length],m=r[l][0],y=r[l][1];for(let D=0;D<o.length;D++){let W=o[D][0],Ee=o[D][1];if(m+W>=0&&y+Ee>=0&&m+W<this.width&&y+Ee<this.height){let dt=(m+W+(y+Ee)*this.width)*this.channels;for(let Ht=0;Ht<a;Ht++)this.data[dt+Ht]=s[Ht]}}}return this}function paintPolyline(r,e={}){let{color:t=[this.maxValue,0,0],closed:n=!1}=e;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]});let o=Math.min(this.channels,t.length);for(let a=0;a<r.length-1+n;a++){let l=r[a],s=r[(a+1)%r.length],m=s[0]-l[0],y=s[1]-l[1],D=Math.max(Math.abs(m),Math.abs(y)),W=m/D,Ee=y/D,dt=l[0],Ht=l[1];for(let ir=0;ir<=D;ir++){let Hr=Math.round(dt),Bn=Math.round(Ht);if(Hr>=0&&Bn>=0&&Hr<this.width&&Bn<this.height)if(this.bitDepth===1)this.setBitXY(Hr,Bn);else{let Vn=(Hr+Bn*this.width)*this.channels;for(let Wr=0;Wr<o;Wr++)this.data[Vn+Wr]=t[Wr]}dt=dt+W,Ht=Ht+Ee}}return this}function paintPolylines(r,e={}){let t=Object.assign({},e);this.checkProcessable("paintPolylines",{bitDepth:[8,16]});let n=getColors(Object.assign({},e,{numberColors:r.length}));for(let o=0;o<r.length;o++)t.color=n[o%n.length],this.paintPolyline(r[o],t);return this}function paintPolygon(r,e={}){let{color:t=[this.maxValue,0,0],filled:n=!1}=e;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]}),e.closed=!0;let o=deleteDouble(r);if(n===!1)return this.paintPolyline(r,e);{let a=Array(this.height);for(let l=0;l<this.height;l++){a[l]=[];for(let s=0;s<this.width;s++)a[l].push(0)}for(let l=0;l<o.length;l++){const s=lineBetweenTwoPoints(o[l],o[(l+1)%o.length]);for(let m=0;m<this.height;m++)for(let y=0;y<this.width;y++)isAtTheRightOfTheLine(y,m,s,this.height)&&(a[m][y]=a[m][y]===0?1:0)}for(let l=0;l<this.height;l++)for(let s=0;s<this.width;s++)if(a[l][s]===1)if(this.bitDepth===1)this.setBitXY(s,l);else{let m=Math.min(this.channels,t.length),y=(s+l*this.width)*this.channels;for(let D=0;D<m;D++)this.data[y+D]=t[D]}return this.paintPolyline(r,e)}}function deleteDouble(r){let e=[];for(let t=0;t<r.length;t++)if(!(r[t][0]===r[(t+1)%r.length][0]&&r[t][1]===r[(t+1)%r.length][1])){if(r[t][0]===r[(t-1+r.length)%r.length][0]&&r[t][1]===r[(t-1+r.length)%r.length][1])continue;if(r[(t+1)%r.length][0]===r[(t-1+r.length)%r.length][0]&&r[(t-1+r.length)%r.length][1]===r[(t+1)%r.length][1])continue;e.push(r[t])}return e}function lineBetweenTwoPoints(r,e){if(r[0]===e[0])return{a:0,b:r[0],vertical:!0};{const t=(e[1]-r[1])/(e[0]-r[0]),n=r[1]-t*r[0];return{a:t,b:n,vertical:!1}}}function isAtTheRightOfTheLine(r,e,t,n){if(t.vertical===!0)return t.b<=r;if(t.a===0)return!1;{const o=(e-t.b)/t.a;return o<r&&o>=0&&o<=n}}function paintPolygons(r,e={}){let t=Object.assign({},e);this.checkProcessable("paintPolygons",{bitDepth:[8,16]});let n=getColors(Object.assign({},e,{numberColors:r.length}));for(let o=0;o<r.length;o++)t.color=n[o%n.length],this.paintPolygon(r[o],t);return this}function getHistogram(r={}){let{maxSlots:e=256,channel:t,useAlpha:n=!0}=r;if(this.checkProcessable("getHistogram",{bitDepth:[1,8,16]}),t===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");t=0}return getChannelHistogram.call(this,t,{useAlpha:n,maxSlots:e})}function getHistograms(r={}){const{maxSlots:e=256,useAlpha:t=!0}=r;this.checkProcessable("getHistograms",{bitDepth:[8,16]});let n=new Array(t?this.components:this.channels);for(let o=0;o<n.length;o++)n[o]=getChannelHistogram.call(this,o,{useAlpha:t,maxSlots:e});return n}function getChannelHistogram(r,e){let{useAlpha:t,maxSlots:n}=e;if(this.bitDepth===1){let m=[0,0];for(let y=0;y<this.height;y++)for(let D=0;D<this.width;D++){let W=this.getBitXY(y,D);W===0?m[0]+=1:W===1&&(m[1]+=1)}return m}let o=Math.log2(n);if(!isInteger$1(o))throw new RangeError("maxSlots must be a power of 2, for example: 64, 256, 1024");let a=0;this.bitDepth>o&&(a=this.bitDepth-o);let l=this.data,s=newArray$1(Math.pow(2,Math.min(this.bitDepth,o)),0);if(t&&this.alpha){let m=this.channels-r-1;for(let y=r;y<l.length;y+=this.channels)s[l[y]>>a]+=l[y+m]/this.maxValue}else for(let m=r;m<l.length;m+=this.channels)s[l[m]>>a]++;return s}function getColorHistogram(r={}){let{useAlpha:e=!0,nbSlots:t=512}=r;this.checkProcessable("getColorHistogram",{bitDepth:[8,16],components:[3]});let n=Math.log(t)/Math.log(8);if(n!==Math.floor(n))throw new RangeError("nbSlots must be a power of 8. Usually 8, 64, 512 or 4096");let o=this.bitDepth-n,a=this.data,l=newArray$1(Math.pow(8,n),0),s=Math.pow(2,n*2),m=Math.pow(2,n);for(let y=0;y<a.length;y+=this.channels){let D=(a[y]>>o)*s+(a[y+1]>>o)*m+(a[y+2]>>o);e&&this.alpha?l[D]+=a[y+this.channels-1]/this.maxValue:l[D]++}return l}function min(){this.checkProcessable("min",{bitDepth:[8,16,32]});let r=newArray$1(this.channels,1/0);for(let e=0;e<this.data.length;e+=this.channels)for(let t=0;t<this.channels;t++)this.data[e+t]<r[t]&&(r[t]=this.data[e+t]);return r}function max(){this.checkProcessable("max",{bitDepth:[8,16,32]});let r=newArray$1(this.channels,-1/0);for(let e=0;e<this.data.length;e+=this.channels)for(let t=0;t<this.channels;t++)this.data[e+t]>r[t]&&(r[t]=this.data[e+t]);return r}function sum(){this.checkProcessable("sum",{bitDepth:[8,16]});let r=newArray$1(this.channels,0);for(let e=0;e<this.data.length;e+=this.channels)for(let t=0;t<this.channels;t++)r[t]+=this.data[e+t];return r}function getMoment(r=0,e=0){this.checkProcessable("getMoment",{bitDepth:[1]});let t=0;for(let n=0;n<this.width;n++)for(let o=0;o<this.height;o++)this.getBitXY(n,o)===1&&(t+=n**r*o**e);return t}function localMaxima(r={}){let{mask:e,region:t=3,removeClosePoints:n=0,invert:o=!1,maxEquals:a=2}=r,l=this;this.checkProcessable("localMaxima",{bitDepth:[8,16],components:1}),t*=4;let s=o?0:1,m=[1,0,-1,0,1,1,-1,-1,2,0,-2,0,2,2,-2,-2],y=[0,1,0,-1,1,-1,1,-1,0,2,0,-2,2,-2,2,-2],D=t<=8?1:2,W=[];for(let Ee=D;Ee<l.height-D;Ee++)for(let dt=D;dt<l.width-D;dt++){if(e&&e.getBitXY(dt,Ee)!==s)continue;let Ht=0,ir=0,Hr=l.data[dt+Ee*l.width];for(let Bn=0;Bn<t;Bn++)o?l.data[dt+m[Bn]+(Ee+y[Bn])*l.width]>Hr&&Ht++:l.data[dt+m[Bn]+(Ee+y[Bn])*l.width]<Hr&&Ht++,l.data[dt+m[Bn]+(Ee+y[Bn])*l.width]===Hr&&ir++;Ht+ir===t&&ir<=a&&W.push([dt,Ee])}if(n>0)for(let Ee=0;Ee<W.length;Ee++)for(let dt=Ee+1;dt<W.length;dt++)Math.sqrt(Math.pow(W[Ee][0]-W[dt][0],2)+Math.pow(W[Ee][1]-W[dt][1],2))<n&&(W[Ee][0]=W[Ee][0]+W[dt][0]>>1,W[Ee][1]=W[Ee][1]+W[dt][1]>>1,W.splice(dt,1),dt--);return W}function mean(){let r=this.getHistograms({maxSlots:this.maxValue+1}),e=new Array(r.length);for(let t=0;t<r.length;t++){let n=r[t];e[t]=mean$2(n)}return e}function median(){let r=this.getHistograms({maxSlots:this.maxValue+1}),e=new Array(r.length);for(let t=0;t<r.length;t++){let n=r[t];e[t]=median$2(n)}return e}function points(){this.checkProcessable("points",{bitDepth:[1]});const r=[];for(let e=0;e<this.width;e++)for(let t=0;t<this.height;t++)this.getBitXY(e,t)===1&&r.push([e,t]);return r}function extendedPoints(){this.checkProcessable("extendedPoints",{bitDepth:[1]});const r=[];for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++)if(this.getBitXY(t,e)===1)for(r.push([t,e]),this.getBitXY(t+1,e)!==1?(r.push([t+1,e]),r.push([t+1,e+1]),this.getBitXY(t,e+1)!==1&&r.push([t,e+1])):this.getBitXY(t,e+1)!==1&&(r.push([t,e+1]),r.push([t+1,e+1]));t<this.width-2&&this.getBitXY(t+1,e)===1&&this.getBitXY(t+2,e)===1;)t++;return r}function getRelativePosition(r,e={}){if(this===r)return[0,0];let t=[0,0],n=this;for(;n;){if(n===r)return t;n.position&&(t[0]+=n.position[0],t[1]+=n.position[1]),n=n.parent}return e.defaultFurther?t:!1}function countAlphaPixels(r={}){let{alpha:e=1}=r;this.checkProcessable("countAlphaPixels",{bitDepth:[8,16],alpha:1});let t=0;if(e!==void 0){for(let n=this.components;n<this.data.length;n+=this.channels)this.data[n]===e&&t++;return t}else return this.size}function monotoneChainConvexHull$1(r,e={}){const{sorted:t}=e;t||(r=r.slice().sort(byXThenY));const n=r.length,o=new Array(n*2);let a=0;for(let s=0;s<n;s++){const m=r[s];for(;a>=2&&cw(o[a-2],o[a-1],m)<=0;)a--;o[a++]=m}const l=a+1;for(let s=n-2;s>=0;s--){const m=r[s];for(;a>=l&&cw(o[a-2],o[a-1],m)<=0;)a--;o[a++]=m}return o.slice(0,a-1)}function cw(r,e,t){return(e[1]-r[1])*(t[0]-r[0])-(e[0]-r[0])*(t[1]-r[1])}function byXThenY(r,e){return r[0]===e[0]?r[1]-e[1]:r[0]-e[0]}function monotoneChainConvexHull(){return monotoneChainConvexHull$1(this.extendedPoints,{sorted:!1})}function round(r){for(let e=0;e<r.length;e++)r[e][0]=Math.round(r[e][0]),r[e][1]=Math.round(r[e][1]);return r}function difference(r,e){return[r[0]-e[0],r[1]-e[1]]}function normalize(r){let e=Math.sqrt(r[0]**2+r[1]**2);return[r[0]/e,r[1]/e]}function rotate(r,e,t){t===void 0&&(t=new Array(e.length));let n=Math.cos(r),o=Math.sin(r);for(let a=0;a<t.length;++a)t[a]=[n*e[a][0]-o*e[a][1],o*e[a][0]+n*e[a][1]];return t}function perimeter(r){let e=0;for(let t=0;t<r.length;t++){let n=r[t][0],o=r[t][1],a=r[t===r.length-1?0:t+1][0],l=r[t===r.length-1?0:t+1][1];e+=Math.sqrt((a-n)**2+(l-o)**2)}return e}function surface(r){let e=0;for(let t=0;t<r.length;t++){let n=r[t][0],o=r[t===r.length-1?0:t+1][1],a=r[t===r.length-1?0:t+1][0],l=r[t][1];e+=n*o*.5,e-=a*l*.5}return Math.abs(e)}function minMax(r){let e=1/0,t=1/0,n=-1/0,o=-1/0;for(let a=0;a<r.length;a++)r[a][0]<e&&(e=r[a][0]),r[a][0]>n&&(n=r[a][0]),r[a][1]<t&&(t=r[a][1]),r[a][1]>o&&(o=r[a][1]);return[[e,t],[n,o]]}function moveToZeroZero(r,e){e===void 0&&(e=new Array(r.length).fill(0).map(()=>[]));let t=minMax(r),n=t[0][0],o=t[0][1];for(let a=0;a<r.length;a++)e[a][0]=r[a][0]-n,e[a][1]=r[a][1]-o;return e}function minimalBoundingRectangle(r={}){const{originalPoints:e=monotoneChainConvexHull.call(this)}=r;if(e.length===0)return[];if(e.length===1)return[e[0],e[0],e[0],e[0]];const t=new Array(e.length);let n=1/0,o=0,a;for(let l=0;l<t.length;l++){let s=getAngle$1(e[l],e[(l+1)%t.length]);rotate(-s,e,t);let m=t[l][0],y=t[l][1],D=t[(l+1)%t.length][0],W=t[(l+1)%t.length][1],Ee=!0,dt=0,Ht=0,ir=0;for(let Wr=0;Wr<t.length;Wr++){let ps=t[Wr][0],il=t[Wr][1],gl=(ps-m)/(D-m);Ee===!0?(Ee=!1,dt=gl,Ht=gl):(gl<dt&&(dt=gl),gl>Ht&&(Ht=gl));let ml=(-(D-m)*il+D*y-W*m)/(D-m);Math.abs(ml)>Math.abs(ir)&&(ir=ml)}let Hr=[m+dt*(D-m),y],Bn=[m+Ht*(D-m),y],Vn=Math.abs(ir*(dt-Ht)*(D-m));Vn<n&&(o=s,n=Vn,a=[Hr,Bn,[Bn[0],Bn[1]-ir],[Hr[0],Hr[1]-ir]])}return rotate(o,a,a),a}function getAngle$1(r,e){let t=difference(e,r),n=normalize(t),o=Math.acos(n[0]);return n[1]<0?-o:o}function extend$1(r){let e={inPlace:!0};r.extendMethod("invert",invert),r.extendMethod("abs",abs),r.extendMethod("level",level,e),r.extendMethod("add",add,e),r.extendMethod("subtract",subtract,e),r.extendMethod("subtractImage",subtractImage),r.extendMethod("multiply",multiply,e),r.extendMethod("divide",divide,e),r.extendMethod("hypotenuse",hypotenuse),r.extendMethod("background",background$1),r.extendMethod("flipX",flipX),r.extendMethod("flipY",flipY),r.extendMethod("blurFilter",blurFilter),r.extendMethod("medianFilter",medianFilter),r.extendMethod("gaussianFilter",gaussianFilter),r.extendMethod("sobelFilter",sobelFilter),r.extendMethod("gradientFilter",gradientFilter),r.extendMethod("scharrFilter",scharrFilter),r.extendMethod("dilate",dilate),r.extendMethod("erode",erode),r.extendMethod("open",open$1),r.extendMethod("close",close),r.extendMethod("topHat",topHat),r.extendMethod("blackHat",blackHat),r.extendMethod("morphologicalGradient",morphologicalGradient),r.extendMethod("warpingFourPoints",warpingFourPoints),r.extendMethod("crop",crop),r.extendMethod("cropAlpha",cropAlpha),r.extendMethod("resize",resize).extendMethod("scale",resize),r.extendMethod("hsv",hsv),r.extendMethod("hsl",hsl$1),r.extendMethod("cmyk",cmyk),r.extendMethod("rgba8",rgba8),r.extendMethod("grey",grey).extendMethod("gray",grey),r.extendMethod("mask",mask),r.extendMethod("pad",pad),r.extendMethod("colorDepth",colorDepth),r.extendMethod("setBorder",setBorder,e),r.extendMethod("rotate",rotate$1),r.extendMethod("rotateLeft",rotateLeft),r.extendMethod("rotateRight",rotateRight),r.extendMethod("insert",insert),r.extendMethod("getRow",getRow),r.extendMethod("getColumn",getColumn),r.extendMethod("getMatrix",getMatrix),r.extendMethod("setMatrix",setMatrix),r.extendMethod("getPixelsArray",getPixelsArray),r.extendMethod("getIntersection",getIntersection),r.extendMethod("getClosestCommonParent",getClosestCommonParent),r.extendMethod("getThreshold",getThreshold),r.extendMethod("split",split),r.extendMethod("getChannel",getChannel),r.extendMethod("combineChannels",combineChannels),r.extendMethod("setChannel",setChannel),r.extendMethod("getSimilarity",getSimilarity),r.extendMethod("getPixelsGrid",getPixelsGrid),r.extendMethod("getBestMatch",getBestMatch),r.extendMethod("cannyEdge",cannyEdge),r.extendMethod("convolution",convolution),r.extendMethod("extract",extract),r.extendMethod("floodFill",floodFill),r.extendMethod("paintLabels",paintLabels,e),r.extendMethod("paintMasks",paintMasks,e),r.extendMethod("paintPoints",paintPoints,e),r.extendMethod("paintPolyline",paintPolyline,e),r.extendMethod("paintPolylines",paintPolylines,e),r.extendMethod("paintPolygon",paintPolygon,e),r.extendMethod("paintPolygons",paintPolygons,e),r.extendMethod("countAlphaPixels",countAlphaPixels),r.extendMethod("monotoneChainConvexHull",monotoneChainConvexHull),r.extendMethod("minimalBoundingRectangle",minimalBoundingRectangle),r.extendMethod("getHistogram",getHistogram).extendProperty("histogram",getHistogram),r.extendMethod("getHistograms",getHistograms).extendProperty("histograms",getHistograms),r.extendMethod("getColorHistogram",getColorHistogram).extendProperty("colorHistogram",getColorHistogram),r.extendMethod("getMin",min).extendProperty("min",min),r.extendMethod("getMax",max).extendProperty("max",max),r.extendMethod("getSum",sum).extendProperty("sum",sum),r.extendMethod("getMoment",getMoment).extendProperty("moment",getMoment),r.extendMethod("getLocalMaxima",localMaxima),r.extendMethod("getMedian",median).extendProperty("median",median),r.extendMethod("getMean",mean).extendProperty("mean",mean),r.extendMethod("getPoints",points).extendProperty("points",points),r.extendMethod("getExtendedPoints",extendedPoints).extendProperty("extendedPoints",extendedPoints),r.extendMethod("getRelativePosition",getRelativePosition)}var quantities={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(commonjsGlobal,function(){function t(Cr){return typeof Cr=="string"||Cr instanceof String}var n=Number.isFinite||window.isFinite;function o(Cr){return n(Cr)}function a(Cr){return Cr}function l(Cr){var fs={};return Cr.filter(function(ul){return fs.hasOwnProperty(ul)?!1:fs[ul]=!0})}function s(Cr,fs){if(fs.length!==Cr.length)return!1;for(var ul=0;ul<Cr.length;ul++)if(fs[ul].compareArray&&!fs[ul].compareArray(Cr[ul])||fs[ul]!==Cr[ul])return!1;return!0}function m(Cr,fs){Object.keys(fs).forEach(function(ul){Cr[ul]=fs[ul]})}function y(){for(var Cr=1,fs=0,ul=0;ul<arguments.length;ul++){var ih=arguments[ul];fs=fs+Ee(ih),Cr*=ih}return fs!==0?W(Cr,fs):Cr}function D(Cr,fs){if(fs===0)throw new Error("Divide by zero");var ul=Math.pow(10,Ee(fs)),ih=ul/(ul*fs);return y(Cr,ih)}function W(Cr,fs){return Math.round(Cr*Math.pow(10,fs))/Math.pow(10,fs)}function Ee(Cr){if(!isFinite(Cr))return 0;for(var fs=0;Cr%1!==0;)Cr*=10,fs++;return fs}function dt(){var Cr;if(!this)return Cr=Object.create(dt.prototype),dt.apply(Cr,arguments),Cr;Cr=Error.apply(this,arguments),this.name="QtyError",this.message=Cr.message,this.stack=Cr.stack}dt.prototype=Object.create(Error.prototype,{constructor:{value:dt}});function Ht(Cr,fs){throw new dt("Incompatible units: "+Cr+" and "+fs)}var ir={"<googol>":[["googol"],1e100,"prefix"],"<kibi>":[["Ki","Kibi","kibi"],Math.pow(2,10),"prefix"],"<mebi>":[["Mi","Mebi","mebi"],Math.pow(2,20),"prefix"],"<gibi>":[["Gi","Gibi","gibi"],Math.pow(2,30),"prefix"],"<tebi>":[["Ti","Tebi","tebi"],Math.pow(2,40),"prefix"],"<pebi>":[["Pi","Pebi","pebi"],Math.pow(2,50),"prefix"],"<exi>":[["Ei","Exi","exi"],Math.pow(2,60),"prefix"],"<zebi>":[["Zi","Zebi","zebi"],Math.pow(2,70),"prefix"],"<yebi>":[["Yi","Yebi","yebi"],Math.pow(2,80),"prefix"],"<yotta>":[["Y","Yotta","yotta"],1e24,"prefix"],"<zetta>":[["Z","Zetta","zetta"],1e21,"prefix"],"<exa>":[["E","Exa","exa"],1e18,"prefix"],"<peta>":[["P","Peta","peta"],1e15,"prefix"],"<tera>":[["T","Tera","tera"],1e12,"prefix"],"<giga>":[["G","Giga","giga"],1e9,"prefix"],"<mega>":[["M","Mega","mega"],1e6,"prefix"],"<kilo>":[["k","kilo"],1e3,"prefix"],"<hecto>":[["h","Hecto","hecto"],100,"prefix"],"<deca>":[["da","Deca","deca","deka"],10,"prefix"],"<deci>":[["d","Deci","deci"],.1,"prefix"],"<centi>":[["c","Centi","centi"],.01,"prefix"],"<milli>":[["m","Milli","milli"],.001,"prefix"],"<micro>":[["u","","","Micro","mc","micro"],1e-6,"prefix"],"<nano>":[["n","Nano","nano"],1e-9,"prefix"],"<pico>":[["p","Pico","pico"],1e-12,"prefix"],"<femto>":[["f","Femto","femto"],1e-15,"prefix"],"<atto>":[["a","Atto","atto"],1e-18,"prefix"],"<zepto>":[["z","Zepto","zepto"],1e-21,"prefix"],"<yocto>":[["y","Yocto","yocto"],1e-24,"prefix"],"<1>":[["1","<1>"],1,""],"<meter>":[["m","meter","meters","metre","metres"],1,"length",["<meter>"]],"<inch>":[["in","inch","inches",'"'],.0254,"length",["<meter>"]],"<foot>":[["ft","foot","feet","'"],.3048,"length",["<meter>"]],"<yard>":[["yd","yard","yards"],.9144,"length",["<meter>"]],"<mile>":[["mi","mile","miles"],1609.344,"length",["<meter>"]],"<naut-mile>":[["nmi","naut-mile"],1852,"length",["<meter>"]],"<league>":[["league","leagues"],4828,"length",["<meter>"]],"<furlong>":[["furlong","furlongs"],201.2,"length",["<meter>"]],"<rod>":[["rd","rod","rods"],5.029,"length",["<meter>"]],"<mil>":[["mil","mils"],254e-7,"length",["<meter>"]],"<angstrom>":[["ang","angstrom","angstroms"],1e-10,"length",["<meter>"]],"<fathom>":[["fathom","fathoms"],1.829,"length",["<meter>"]],"<pica>":[["pica","picas"],.00423333333,"length",["<meter>"]],"<point>":[["pt","point","points"],.000352777778,"length",["<meter>"]],"<redshift>":[["z","red-shift","redshift"],1302773e20,"length",["<meter>"]],"<AU>":[["AU","astronomical-unit"],1495979e5,"length",["<meter>"]],"<light-second>":[["ls","light-second"],299792500,"length",["<meter>"]],"<light-minute>":[["lmin","light-minute"],1798755e4,"length",["<meter>"]],"<light-year>":[["ly","light-year"],9460528e9,"length",["<meter>"]],"<parsec>":[["pc","parsec","parsecs"],3085678e10,"length",["<meter>"]],"<datamile>":[["DM","datamile"],1828.8,"length",["<meter>"]],"<kilogram>":[["kg","kilogram","kilograms"],1,"mass",["<kilogram>"]],"<AMU>":[["u","AMU","amu"],1660538921e-36,"mass",["<kilogram>"]],"<dalton>":[["Da","Dalton","Daltons","dalton","daltons"],1660538921e-36,"mass",["<kilogram>"]],"<slug>":[["slug","slugs"],14.5939029,"mass",["<kilogram>"]],"<short-ton>":[["tn","ton","short-ton"],907.18474,"mass",["<kilogram>"]],"<metric-ton>":[["tonne","metric-ton"],1e3,"mass",["<kilogram>"]],"<carat>":[["ct","carat","carats"],2e-4,"mass",["<kilogram>"]],"<pound>":[["lbs","lb","pound","pounds","#"],.45359237,"mass",["<kilogram>"]],"<ounce>":[["oz","ounce","ounces"],.0283495231,"mass",["<kilogram>"]],"<gram>":[["g","gram","grams","gramme","grammes"],.001,"mass",["<kilogram>"]],"<grain>":[["grain","grains","gr"],6479891e-11,"mass",["<kilogram>"]],"<dram>":[["dram","drams","dr"],.0017718452,"mass",["<kilogram>"]],"<stone>":[["stone","stones","st"],6.35029318,"mass",["<kilogram>"]],"<hectare>":[["hectare"],1e4,"area",["<meter>","<meter>"]],"<acre>":[["acre","acres"],4046.85642,"area",["<meter>","<meter>"]],"<sqft>":[["sqft"],1,"area",["<foot>","<foot>"]],"<liter>":[["l","L","liter","liters","litre","litres"],.001,"volume",["<meter>","<meter>","<meter>"]],"<gallon>":[["gal","gallon","gallons"],.0037854118,"volume",["<meter>","<meter>","<meter>"]],"<gallon-imp>":[["galimp","gallon-imp","gallons-imp"],.00454609,"volume",["<meter>","<meter>","<meter>"]],"<quart>":[["qt","quart","quarts"],.00094635295,"volume",["<meter>","<meter>","<meter>"]],"<pint>":[["pt","pint","pints"],.000473176475,"volume",["<meter>","<meter>","<meter>"]],"<pint-imp>":[["ptimp","pint-imp","pints-imp"],.00056826125,"volume",["<meter>","<meter>","<meter>"]],"<cup>":[["cu","cup","cups"],.000236588238,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce>":[["floz","fluid-ounce","fluid-ounces"],295735297e-13,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce-imp>":[["flozimp","floz-imp","fluid-ounce-imp","fluid-ounces-imp"],284130625e-13,"volume",["<meter>","<meter>","<meter>"]],"<tablespoon>":[["tb","tbsp","tbs","tablespoon","tablespoons"],147867648e-13,"volume",["<meter>","<meter>","<meter>"]],"<teaspoon>":[["tsp","teaspoon","teaspoons"],492892161e-14,"volume",["<meter>","<meter>","<meter>"]],"<bushel>":[["bu","bsh","bushel","bushels"],.035239072,"volume",["<meter>","<meter>","<meter>"]],"<oilbarrel>":[["bbl","oilbarrel","oilbarrels","oil-barrel","oil-barrels"],.158987294928,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel>":[["bl","bl-us","beerbarrel","beerbarrels","beer-barrel","beer-barrels"],.1173477658,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel-imp>":[["blimp","bl-imp","beerbarrel-imp","beerbarrels-imp","beer-barrel-imp","beer-barrels-imp"],.16365924,"volume",["<meter>","<meter>","<meter>"]],"<kph>":[["kph"],.277777778,"speed",["<meter>"],["<second>"]],"<mph>":[["mph"],.44704,"speed",["<meter>"],["<second>"]],"<knot>":[["kt","kn","kts","knot","knots"],.514444444,"speed",["<meter>"],["<second>"]],"<fps>":[["fps"],.3048,"speed",["<meter>"],["<second>"]],"<gee>":[["gee"],9.80665,"acceleration",["<meter>"],["<second>","<second>"]],"<Gal>":[["Gal"],.01,"acceleration",["<meter>"],["<second>","<second>"]],"<kelvin>":[["degK","kelvin"],1,"temperature",["<kelvin>"]],"<celsius>":[["degC","celsius","celsius","centigrade"],1,"temperature",["<kelvin>"]],"<fahrenheit>":[["degF","fahrenheit"],5/9,"temperature",["<kelvin>"]],"<rankine>":[["degR","rankine"],5/9,"temperature",["<kelvin>"]],"<temp-K>":[["tempK","temp-K"],1,"temperature",["<temp-K>"]],"<temp-C>":[["tempC","temp-C"],1,"temperature",["<temp-K>"]],"<temp-F>":[["tempF","temp-F"],5/9,"temperature",["<temp-K>"]],"<temp-R>":[["tempR","temp-R"],5/9,"temperature",["<temp-K>"]],"<second>":[["s","sec","secs","second","seconds"],1,"time",["<second>"]],"<minute>":[["min","mins","minute","minutes"],60,"time",["<second>"]],"<hour>":[["h","hr","hrs","hour","hours"],3600,"time",["<second>"]],"<day>":[["d","day","days"],3600*24,"time",["<second>"]],"<week>":[["wk","week","weeks"],7*3600*24,"time",["<second>"]],"<fortnight>":[["fortnight","fortnights"],1209600,"time",["<second>"]],"<year>":[["y","yr","year","years","annum"],31556926,"time",["<second>"]],"<decade>":[["decade","decades"],315569260,"time",["<second>"]],"<century>":[["century","centuries"],3155692600,"time",["<second>"]],"<pascal>":[["Pa","pascal","Pascal"],1,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<bar>":[["bar","bars"],1e5,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<mmHg>":[["mmHg"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inHg>":[["inHg"],3386.3881472,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<torr>":[["torr"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<atm>":[["atm","ATM","atmosphere","atmospheres"],101325,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<psi>":[["psi"],6894.76,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<cmh2o>":[["cmH2O","cmh2o"],98.0638,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inh2o>":[["inH2O","inh2o"],249.082052,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<poise>":[["P","poise"],.1,"viscosity",["<kilogram>"],["<meter>","<second>"]],"<stokes>":[["St","stokes"],1e-4,"viscosity",["<meter>","<meter>"],["<second>"]],"<mole>":[["mol","mole"],1,"substance",["<mole>"]],"<molar>":[["M","molar"],1e3,"concentration",["<mole>"],["<meter>","<meter>","<meter>"]],"<wtpercent>":[["wt%","wtpercent"],10,"concentration",["<kilogram>"],["<meter>","<meter>","<meter>"]],"<katal>":[["kat","katal","Katal"],1,"activity",["<mole>"],["<second>"]],"<unit>":[["U","enzUnit","unit"],16667e-19,"activity",["<mole>"],["<second>"]],"<farad>":[["F","farad","Farad"],1,"capacitance",["<second>","<second>","<second>","<second>","<ampere>","<ampere>"],["<meter>","<meter>","<kilogram>"]],"<coulomb>":[["C","coulomb","Coulomb"],1,"charge",["<ampere>","<second>"]],"<Ah>":[["Ah"],3600,"charge",["<ampere>","<second>"]],"<ampere>":[["A","Ampere","ampere","amp","amps"],1,"current",["<ampere>"]],"<siemens>":[["S","Siemens","siemens"],1,"conductance",["<second>","<second>","<second>","<ampere>","<ampere>"],["<kilogram>","<meter>","<meter>"]],"<henry>":[["H","Henry","henry"],1,"inductance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>","<ampere>"]],"<volt>":[["V","Volt","volt","volts"],1,"potential",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>"]],"<ohm>":[["Ohm","ohm","",""],1,"resistance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>","<ampere>"]],"<weber>":[["Wb","weber","webers"],1,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<tesla>":[["T","tesla","teslas"],1,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<gauss>":[["G","gauss"],1e-4,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<maxwell>":[["Mx","maxwell","maxwells"],1e-8,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<oersted>":[["Oe","oersted","oersteds"],250/Math.PI,"magnetism",["<ampere>"],["<meter>"]],"<joule>":[["J","joule","Joule","joules"],1,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<erg>":[["erg","ergs"],1e-7,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<btu>":[["BTU","btu","BTUs"],1055.056,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<calorie>":[["cal","calorie","calories"],4.184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Calorie>":[["Cal","Calorie","Calories"],4184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<therm-US>":[["th","therm","therms","Therm","therm-US"],105480400,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Wh>":[["Wh"],3600,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<newton>":[["N","Newton","newton"],1,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<dyne>":[["dyn","dyne"],1e-5,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<pound-force>":[["lbf","pound-force"],4.448222,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<hertz>":[["Hz","hertz","Hertz"],1,"frequency",["<1>"],["<second>"]],"<radian>":[["rad","radian","radians"],1,"angle",["<radian>"]],"<degree>":[["deg","degree","degrees"],Math.PI/180,"angle",["<radian>"]],"<gradian>":[["gon","grad","gradian","grads"],Math.PI/200,"angle",["<radian>"]],"<steradian>":[["sr","steradian","steradians"],1,"solid_angle",["<steradian>"]],"<rotation>":[["rotation"],2*Math.PI,"angle",["<radian>"]],"<rpm>":[["rpm"],2*Math.PI/60,"angular_velocity",["<radian>"],["<second>"]],"<byte>":[["B","byte","bytes"],1,"information",["<byte>"]],"<bit>":[["b","bit","bits"],.125,"information",["<byte>"]],"<Bps>":[["Bps"],1,"information_rate",["<byte>"],["<second>"]],"<bps>":[["bps"],.125,"information_rate",["<byte>"],["<second>"]],"<dollar>":[["USD","dollar"],1,"currency",["<dollar>"]],"<cents>":[["cents"],.01,"currency",["<dollar>"]],"<candela>":[["cd","candela"],1,"luminosity",["<candela>"]],"<lumen>":[["lm","lumen"],1,"luminous_power",["<candela>","<steradian>"]],"<lux>":[["lux"],1,"illuminance",["<candela>","<steradian>"],["<meter>","<meter>"]],"<watt>":[["W","watt","watts"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere>":[["VA","volt-ampere"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere-reactive>":[["var","Var","VAr","VAR","volt-ampere-reactive"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<horsepower>":[["hp","horsepower"],745.699872,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<gray>":[["Gy","gray","grays"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<roentgen>":[["R","roentgen"],.00933,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<sievert>":[["Sv","sievert","sieverts"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<becquerel>":[["Bq","becquerel","becquerels"],1,"radiation",["<1>"],["<second>"]],"<curie>":[["Ci","curie","curies"],37e9,"radiation",["<1>"],["<second>"]],"<cpm>":[["cpm"],1/60,"rate",["<count>"],["<second>"]],"<dpm>":[["dpm"],1/60,"rate",["<count>"],["<second>"]],"<bpm>":[["bpm"],1/60,"rate",["<count>"],["<second>"]],"<dot>":[["dot","dots"],1,"resolution",["<each>"]],"<pixel>":[["pixel","px"],1,"resolution",["<each>"]],"<ppi>":[["ppi"],1,"resolution",["<pixel>"],["<inch>"]],"<dpi>":[["dpi"],1,"typography",["<dot>"],["<inch>"]],"<cell>":[["cells","cell"],1,"counting",["<each>"]],"<each>":[["each"],1,"counting",["<each>"]],"<count>":[["count"],1,"counting",["<each>"]],"<base-pair>":[["bp","base-pair"],1,"counting",["<each>"]],"<nucleotide>":[["nt","nucleotide"],1,"counting",["<each>"]],"<molecule>":[["molecule","molecules"],1,"counting",["<1>"]],"<dozen>":[["doz","dz","dozen"],12,"prefix_only",["<each>"]],"<percent>":[["%","percent"],.01,"prefix_only",["<1>"]],"<ppm>":[["ppm"],1e-6,"prefix_only",["<1>"]],"<ppt>":[["ppt"],1e-9,"prefix_only",["<1>"]],"<gross>":[["gr","gross"],144,"prefix_only",["<dozen>","<dozen>"]],"<decibel>":[["dB","decibel","decibels"],1,"logarithmic",["<decibel>"]]},Hr=["<meter>","<kilogram>","<second>","<mole>","<ampere>","<radian>","<kelvin>","<temp-K>","<byte>","<dollar>","<candela>","<each>","<steradian>","<decibel>"],Bn="<1>",Vn=[Bn];function Wr(Cr,fs){var ul=fs[1],ih=fs[3]||[],ch=fs[4]||[];if(!o(ul))throw new dt(Cr+": Invalid unit definition. 'scalar' must be a number");ih.forEach(function(vh){if(ir[vh]===void 0)throw new dt(Cr+": Invalid unit definition. Unit "+vh+" in 'numerator' is not recognized")}),ch.forEach(function(vh){if(ir[vh]===void 0)throw new dt(Cr+": Invalid unit definition. Unit "+vh+" in 'denominator' is not recognized")})}var ps={},il={},gl={},ml={},sl={};for(var ll in ir)if(ir.hasOwnProperty(ll)){var rl=ir[ll];if(rl[2]==="prefix"){ps[ll]=rl[1];for(var th=0;th<rl[0].length;th++)il[rl[0][th]]=ll}else{Wr(ll,rl),gl[ll]={scalar:rl[1],numerator:rl[3],denominator:rl[4]};for(var nh=0;nh<rl[0].length;nh++)ml[rl[0][nh]]=ll}sl[ll]=rl[0][0]}function bh(Cr){var fs,ul=[],ih=Object.keys(ir);if(typeof Cr>"u")for(fs=0;fs<ih.length;fs++)["","prefix"].indexOf(ir[ih[fs]][2])===-1&&ul.push(ih[fs].substr(1,ih[fs].length-2));else{if(this.getKinds().indexOf(Cr)===-1)throw new dt("Kind not recognized");for(fs=0;fs<ih.length;fs++)ir[ih[fs]][2]===Cr&&ul.push(ih[fs].substr(1,ih[fs].length-2))}return ul.sort(function(ch,vh){return ch.toLowerCase()<vh.toLowerCase()?-1:ch.toLowerCase()>vh.toLowerCase()?1:0})}function Fh(Cr){if(!ml[Cr])throw new dt("Unit not recognized");return ir[ml[Cr]][0]}var Bh=["length","time","temperature","mass","current","substance","luminosity","currency","information","angle"];function Ed(){if(this.signature)return this.signature;for(var Cr=Td.call(this),fs=0;fs<Cr.length;fs++)Cr[fs]*=Math.pow(20,fs);return Cr.reduce(function(ul,ih){return ul+ih},0)}function Td(){if(!this.isBase())return Td.call(this.toBase());for(var Cr=new Array(Bh.length),fs=0;fs<Cr.length;fs++)Cr[fs]=0;for(var ul,ih,ch=0;ch<this.numerator.length;ch++)(ul=ir[this.numerator[ch]])&&(ih=Bh.indexOf(ul[2]),ih>=0&&(Cr[ih]=Cr[ih]+1));for(var vh=0;vh<this.denominator.length;vh++)(ul=ir[this.denominator[vh]])&&(ih=Bh.indexOf(ul[2]),ih>=0&&(Cr[ih]=Cr[ih]-1));return Cr}var td="[+-]",Fd="\\d+",Ld=td+"?"+Fd,Ud="\\."+Fd,Xd="(?:"+Fd+"(?:"+Ud+")?)|(?:"+Ud+")",wd="[Ee]"+Ld,zd="(?:"+Xd+")(?:"+wd+")?",Rd=td+"?\\s*"+zd,op="("+Rd+")?\\s*([^/]*)(?:/(.+))?",Wd=new RegExp("^"+op+"$"),Op="\\^|\\*{2}",ep="[01234]",zp=new RegExp("([^ \\*\\d]+?)(?:"+Op+")?(-?"+ep+"(?![a-zA-Z]))"),Kd=new RegExp("([^ \\*\\d]+?)(?:"+Op+")?("+ep+"(?![a-zA-Z]))");function Ap(Cr){t(Cr)||(Cr=Cr.toString()),Cr=Cr.trim();var fs=Wd.exec(Cr);if(!fs)throw new dt(Cr+": Quantity not recognized");var ul=fs[1];ul?(ul=ul.replace(/\s/g,""),this.scalar=parseFloat(ul)):this.scalar=1;for(var ih=fs[2],ch=fs[3],vh,Th,Nh;fs=zp.exec(ih);){if(vh=parseFloat(fs[2]),isNaN(vh))throw new dt("Unit exponent is not a number");if(vh===0&&!up.test(fs[1]))throw new dt("Unit not recognized");Th=fs[1]+" ",Nh="";for(var Qh=0;Qh<Math.abs(vh);Qh++)Nh+=Th;vh>=0?ih=ih.replace(fs[0],Nh):(ch=ch?ch+Nh:Nh,ih=ih.replace(fs[0],""))}for(;fs=Kd.exec(ch);){if(vh=parseFloat(fs[2]),isNaN(vh))throw new dt("Unit exponent is not a number");if(vh===0&&!up.test(fs[1]))throw new dt("Unit not recognized");Th=fs[1]+" ",Nh="";for(var rd=0;rd<vh;rd++)Nh+=Th;ch=ch.replace(fs[0],Nh)}ih&&(this.numerator=Cp(ih.trim())),ch&&(this.denominator=Cp(ch.trim()))}var Ip=Object.keys(il).sort(function(Cr,fs){return fs.length-Cr.length}).join("|"),Yh=Object.keys(ml).sort(function(Cr,fs){return fs.length-Cr.length}).join("|"),Ad="\\b|$",kp="("+Ip+")??("+Yh+")(?:"+Ad+")",up=new RegExp("^\\s*("+kp+"[\\s\\*]*)+$"),rp=new RegExp(kp,"g"),fd={};function Cp(Cr){var fs=fd[Cr];if(fs)return fs;var ul,ih=[];if(!up.test(Cr))throw new dt("Unit not recognized");for(;ul=rp.exec(Cr);)ih.push(ul.slice(1));return ih=ih.map(function(ch){return il[ch[0]]?[il[ch[0]],ml[ch[1]]]:[ml[ch[1]]]}),ih=ih.reduce(function(ch,vh){return ch.concat(vh)},[]),ih=ih.filter(function(ch){return ch}),fd[Cr]=ih,ih}function Fp(Cr){if(!t(Cr))throw new dt("Argument should be a string");try{return this(Cr)}catch{return null}}function _p(Cr){return Cr instanceof kd}function kd(Cr,fs){if($f.apply(null,arguments),!_p(this))return new kd(Cr,fs);if(this.scalar=null,this.baseScalar=null,this.signature=null,this._conversionCache={},this.numerator=Vn,this.denominator=Vn,Uf(Cr)?(this.scalar=Cr.scalar,this.numerator=Cr.numerator&&Cr.numerator.length!==0?Cr.numerator:Vn,this.denominator=Cr.denominator&&Cr.denominator.length!==0?Cr.denominator:Vn):fs?(Ap.call(this,fs),this.scalar=Cr):Ap.call(this,Cr),this.denominator.join("*").indexOf("temp")>=0)throw new dt("Cannot divide with temperatures");if(this.numerator.join("*").indexOf("temp")>=0){if(this.numerator.length>1)throw new dt("Cannot multiply by temperatures");if(!s(this.denominator,Vn))throw new dt("Cannot divide with temperatures")}if(this.initValue=Cr,cd.call(this),this.isTemperature()&&this.baseScalar<0)throw new dt("Temperatures must not be less than absolute zero")}kd.prototype={constructor:kd};function $f(Cr,fs){if(fs){if(!(o(Cr)&&t(fs)))throw new dt("Only number accepted as initialization value when units are explicitly provided")}else if(!(t(Cr)||o(Cr)||_p(Cr)||Uf(Cr)))throw new dt("Only string, number or quantity accepted as single initialization value")}function Uf(Cr){return Cr&&typeof Cr=="object"&&Cr.hasOwnProperty("scalar")}function cd(){if(this.baseScalar)return this.baseScalar;if(this.isBase())this.baseScalar=this.scalar,this.signature=Ed.call(this);else{var Cr=this.toBase();this.baseScalar=Cr.scalar,this.signature=Cr.signature}}var cp={"-312078":"elastance","-312058":"resistance","-312038":"inductance","-152058":"potential","-152040":"magnetism","-152038":"magnetism","-7997":"specific_volume","-79":"snap","-59":"jolt","-39":"acceleration","-38":"radiation","-20":"frequency","-19":"speed","-18":"viscosity","-17":"volumetric_flow","-1":"wavenumber",0:"unitless",1:"length",2:"area",3:"volume",20:"time",400:"temperature",7941:"yank",7942:"power",7959:"pressure",7961:"force",7962:"energy",7979:"viscosity",7981:"momentum",7982:"angular_momentum",7997:"density",7998:"area_density",8e3:"mass",152020:"radiation_exposure",159999:"magnetism",16e4:"current",160020:"charge",312058:"conductance",312078:"capacitance",3199980:"activity",3199997:"molar_concentration",32e5:"substance",63999998:"illuminance",64e6:"luminous_power",128e7:"currency","25599999980":"information_rate","25600000000":"information","511999999980":"angular_velocity","512000000000":"angle"};function xp(){return l(Object.keys(cp).map(function(Cr){return cp[Cr]}))}kd.prototype.kind=function(){return cp[this.signature.toString()]},m(kd.prototype,{isDegrees:function(){return(this.signature===null||this.signature===400)&&this.numerator.length===1&&s(this.denominator,Vn)&&(this.numerator[0].match(/<temp-[CFRK]>/)||this.numerator[0].match(/<(kelvin|celsius|rankine|fahrenheit)>/))},isTemperature:function(){return this.isDegrees()&&this.numerator[0].match(/<temp-[CFRK]>/)}});function Ep(Cr,fs){var ul=Cr.units(),ih=fs.to(ul),ch=kd(Yd(ul));return kd({scalar:Cr.scalar-ih.scalar,numerator:ch.numerator,denominator:ch.denominator})}function Vp(Cr,fs){var ul=fs.to(Yd(Cr.units()));return kd({scalar:Cr.scalar-ul.scalar,numerator:Cr.numerator,denominator:Cr.denominator})}function bd(Cr,fs){var ul=fs.to(Yd(Cr.units()));return kd({scalar:Cr.scalar+ul.scalar,numerator:Cr.numerator,denominator:Cr.denominator})}function Yd(Cr){if(Cr==="tempK")return"degK";if(Cr==="tempC")return"degC";if(Cr==="tempF")return"degF";if(Cr==="tempR")return"degR";throw new dt("Unknown type for temp conversion from: "+Cr)}function np(Cr,fs){var ul=Up(Cr),ih=fs.units(),ch;if(ih==="degK")ch=ul.scalar;else if(ih==="degC")ch=ul.scalar;else if(ih==="degF")ch=ul.scalar*9/5;else if(ih==="degR")ch=ul.scalar*9/5;else throw new dt("Unknown type for degree conversion to: "+ih);return kd({scalar:ch,numerator:fs.numerator,denominator:fs.denominator})}function Up(Cr){var fs=Cr.units(),ul;if(fs.match(/(deg)[CFRK]/))ul=Cr.baseScalar;else if(fs==="tempK")ul=Cr.scalar;else if(fs==="tempC")ul=Cr.scalar;else if(fs==="tempF")ul=Cr.scalar*5/9;else if(fs==="tempR")ul=Cr.scalar*5/9;else throw new dt("Unknown type for temp conversion from: "+fs);return kd({scalar:ul,numerator:["<kelvin>"],denominator:Vn})}function Qp(Cr,fs){var ul=fs.units(),ih;if(ul==="tempK")ih=Cr.baseScalar;else if(ul==="tempC")ih=Cr.baseScalar-273.15;else if(ul==="tempF")ih=Cr.baseScalar*9/5-459.67;else if(ul==="tempR")ih=Cr.baseScalar*9/5;else throw new dt("Unknown type for temp conversion to: "+ul);return kd({scalar:ih,numerator:fs.numerator,denominator:fs.denominator})}function Rp(Cr){var fs=Cr.units(),ul;if(fs.match(/(deg)[CFRK]/))ul=Cr.baseScalar;else if(fs==="tempK")ul=Cr.scalar;else if(fs==="tempC")ul=Cr.scalar+273.15;else if(fs==="tempF")ul=(Cr.scalar+459.67)*5/9;else if(fs==="tempR")ul=Cr.scalar*5/9;else throw new dt("Unknown type for temp conversion from: "+fs);return kd({scalar:ul,numerator:["<temp-K>"],denominator:Vn})}m(kd.prototype,{to:function(Cr){var fs,ul;if(Cr==null)return this;if(!t(Cr))return this.to(Cr.units());if(fs=this._conversionCache[Cr],fs)return fs;if(ul=kd(Cr),ul.units()===this.units())return this;if(!this.isCompatible(ul))this.isInverse(ul)?ul=this.inverse().to(Cr):Ht(this.units(),ul.units());else if(ul.isTemperature())ul=Qp(this,ul);else if(ul.isDegrees())ul=np(this,ul);else{var ih=D(this.baseScalar,ul.baseScalar);ul=kd({scalar:ih,numerator:ul.numerator,denominator:ul.denominator})}return this._conversionCache[Cr]=ul,ul},toBase:function(){if(this.isBase())return this;if(this.isTemperature())return Rp(this);var Cr=bg[this.units()];return Cr||(Cr=Ih(this.numerator,this.denominator),bg[this.units()]=Cr),Cr.mul(this.scalar)},toFloat:function(){if(this.isUnitless())return this.scalar;throw new dt("Can't convert to Float unless unitless.  Use Unit#scalar")},toPrec:function(Cr){if(t(Cr)&&(Cr=kd(Cr)),o(Cr)&&(Cr=kd(Cr+" "+this.units())),this.isUnitless()?Cr.isUnitless()||Ht(this.units(),Cr.units()):Cr=Cr.to(this.units()),Cr.scalar===0)throw new dt("Divide by zero");var fs=y(Math.round(this.scalar/Cr.scalar),Cr.scalar);return kd(fs+this.units())}});function ng(Cr,fs){var ul=kd(Cr),ih=kd(fs);if(ul.eq(ih))return a;var ch;return ul.isTemperature()?ch=function(vh){return ul.mul(vh).to(ih).scalar}:ch=function(vh){return vh*ul.baseScalar/ih.baseScalar},function(Th){var Nh,Qh,rd;if(Array.isArray(Th)){for(Qh=Th.length,rd=[],Nh=0;Nh<Qh;Nh++)rd.push(ch(Th[Nh]));return rd}else return ch(Th)}}var bg={};function Ih(Cr,fs){for(var ul=[],ih=[],ch=1,vh,Th=0;Th<Cr.length;Th++)vh=Cr[Th],ps[vh]?ch=y(ch,ps[vh]):gl[vh]&&(ch*=gl[vh].scalar,gl[vh].numerator&&ul.push(gl[vh].numerator),gl[vh].denominator&&ih.push(gl[vh].denominator));for(var Nh=0;Nh<fs.length;Nh++)vh=fs[Nh],ps[vh]?ch/=ps[vh]:gl[vh]&&(ch/=gl[vh].scalar,gl[vh].numerator&&ih.push(gl[vh].numerator),gl[vh].denominator&&ul.push(gl[vh].denominator));return ul=ul.reduce(function(Qh,rd){return Qh.concat(rd)},[]),ih=ih.reduce(function(Qh,rd){return Qh.concat(rd)},[]),kd({scalar:ch,numerator:ul,denominator:ih})}kd.parse=Fp,kd.getUnits=bh,kd.getAliases=Fh,kd.mulSafe=y,kd.divSafe=D,kd.getKinds=xp,kd.swiftConverter=ng,kd.Error=dt,m(kd.prototype,{add:function(Cr){if(t(Cr)&&(Cr=kd(Cr)),this.isCompatible(Cr)||Ht(this.units(),Cr.units()),this.isTemperature()&&Cr.isTemperature())throw new dt("Cannot add two temperatures");return this.isTemperature()?bd(this,Cr):Cr.isTemperature()?bd(Cr,this):kd({scalar:this.scalar+Cr.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},sub:function(Cr){if(t(Cr)&&(Cr=kd(Cr)),this.isCompatible(Cr)||Ht(this.units(),Cr.units()),this.isTemperature()&&Cr.isTemperature())return Ep(this,Cr);if(this.isTemperature())return Vp(this,Cr);if(Cr.isTemperature())throw new dt("Cannot subtract a temperature from a differential degree unit");return kd({scalar:this.scalar-Cr.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},mul:function(Cr){if(o(Cr))return kd({scalar:y(this.scalar,Cr),numerator:this.numerator,denominator:this.denominator});if(t(Cr)&&(Cr=kd(Cr)),(this.isTemperature()||Cr.isTemperature())&&!(this.isUnitless()||Cr.isUnitless()))throw new dt("Cannot multiply by temperatures");var fs=this,ul=Cr;fs.isCompatible(ul)&&fs.signature!==400&&(ul=ul.to(fs));var ih=rh(fs.numerator,fs.denominator,ul.numerator,ul.denominator);return kd({scalar:y(fs.scalar,ul.scalar,ih[2]),numerator:ih[0],denominator:ih[1]})},div:function(Cr){if(o(Cr)){if(Cr===0)throw new dt("Divide by zero");return kd({scalar:this.scalar/Cr,numerator:this.numerator,denominator:this.denominator})}else t(Cr)&&(Cr=kd(Cr));if(Cr.scalar===0)throw new dt("Divide by zero");if(Cr.isTemperature())throw new dt("Cannot divide with temperatures");if(this.isTemperature()&&!Cr.isUnitless())throw new dt("Cannot divide with temperatures");var fs=this,ul=Cr;fs.isCompatible(ul)&&fs.signature!==400&&(ul=ul.to(fs));var ih=rh(fs.numerator,fs.denominator,ul.denominator,ul.numerator);return kd({scalar:y(fs.scalar,ih[2])/ul.scalar,numerator:ih[0],denominator:ih[1]})},inverse:function(){if(this.isTemperature())throw new dt("Cannot divide with temperatures");if(this.scalar===0)throw new dt("Divide by zero");return kd({scalar:1/this.scalar,numerator:this.denominator,denominator:this.numerator})}});function rh(Cr,fs,ul,ih){function ch(qd){return qd!==Bn}Cr=Cr.filter(ch),ul=ul.filter(ch),fs=fs.filter(ch),ih=ih.filter(ch);var vh={};function Th(qd,wp){for(var pp,Wp,Vf,Wf=0;Wf<qd.length;Wf++)if(ps[qd[Wf]]?(pp=qd[Wf+1],Wp=qd[Wf],Vf=ps[Wp],Wf++):(pp=qd[Wf],Wp=null,Vf=1),pp&&pp!==Bn)if(vh[pp]){vh[pp][0]+=wp;var dg=vh[pp][2]?ps[vh[pp][2]]:1;vh[pp][wp===1?3:4]*=D(Vf,dg)}else vh[pp]=[wp,pp,Wp,1,1]}Th(Cr,1),Th(fs,-1),Th(ul,1),Th(ih,-1);var Nh=[],Qh=[],rd=1;for(var _d in vh)if(vh.hasOwnProperty(_d)){var ip=vh[_d],Dp;if(ip[0]>0)for(Dp=0;Dp<ip[0];Dp++)Nh.push(ip[2]===null?ip[1]:[ip[2],ip[1]]);else if(ip[0]<0)for(Dp=0;Dp<-ip[0];Dp++)Qh.push(ip[2]===null?ip[1]:[ip[2],ip[1]]);rd*=D(ip[3],ip[4])}return Nh.length===0&&(Nh=Vn),Qh.length===0&&(Qh=Vn),Nh=Nh.reduce(function(qd,wp){return qd.concat(wp)},[]),Qh=Qh.reduce(function(qd,wp){return qd.concat(wp)},[]),[Nh,Qh,rd]}m(kd.prototype,{eq:function(Cr){return this.compareTo(Cr)===0},lt:function(Cr){return this.compareTo(Cr)===-1},lte:function(Cr){return this.eq(Cr)||this.lt(Cr)},gt:function(Cr){return this.compareTo(Cr)===1},gte:function(Cr){return this.eq(Cr)||this.gt(Cr)},compareTo:function(Cr){if(t(Cr))return this.compareTo(kd(Cr));if(this.isCompatible(Cr)||Ht(this.units(),Cr.units()),this.baseScalar<Cr.baseScalar)return-1;if(this.baseScalar===Cr.baseScalar)return 0;if(this.baseScalar>Cr.baseScalar)return 1},same:function(Cr){return this.scalar===Cr.scalar&&this.units()===Cr.units()}}),m(kd.prototype,{isUnitless:function(){return[this.numerator,this.denominator].every(function(Cr){return s(Cr,Vn)})},isCompatible:function(Cr){return t(Cr)?this.isCompatible(kd(Cr)):_p(Cr)&&Cr.signature!==void 0?this.signature===Cr.signature:!1},isInverse:function(Cr){return this.inverse().isCompatible(Cr)},isBase:function(){return this._isBase!==void 0?this._isBase:this.isDegrees()&&this.numerator[0].match(/<(kelvin|temp-K)>/)?(this._isBase=!0,this._isBase):(this.numerator.concat(this.denominator).forEach(function(Cr){Cr!==Bn&&Hr.indexOf(Cr)===-1&&(this._isBase=!1)},this),this._isBase===!1?this._isBase:(this._isBase=!0,this._isBase))}});function sh(){}sh.prototype.get=function(Cr){return arguments.length>1&&(Cr=Array.apply(null,arguments)),Cr.reduce(function(fs,ul,ih){if(fs){var ch=fs[ul];return ih===Cr.length-1?ch?ch.data:void 0:ch}},this)},sh.prototype.set=function(Cr,fs){return arguments.length>2&&(Cr=Array.prototype.slice.call(arguments,0,-1),fs=arguments[arguments.length-1]),Cr.reduce(function(ul,ih,ch){var vh=ul[ih];return vh===void 0&&(vh=ul[ih]={}),ch===Cr.length-1?(vh.data=fs,fs):vh},this)};function oh(Cr,fs){return(Cr+" "+fs).trim()}kd.formatter=oh,m(kd.prototype,{units:function(){if(this._units!==void 0)return this._units;var Cr=s(this.numerator,Vn),fs=s(this.denominator,Vn);if(Cr&&fs)return this._units="",this._units;var ul=$h(this.numerator),ih=$h(this.denominator);return this._units=ul+(fs?"":"/"+ih),this._units},toString:function(Cr,fs){var ul;if(o(Cr))ul=this.units(),fs=Cr;else if(t(Cr))ul=Cr;else if(_p(Cr))return this.toPrec(Cr).toString(fs);var ih=this.to(ul),ch=fs!==void 0?W(ih.scalar,fs):ih.scalar;return ih=(ch+" "+ih.units()).trim(),ih},format:function(Cr,fs){arguments.length===1&&typeof Cr=="function"&&(fs=Cr,Cr=void 0),fs=fs||kd.formatter;var ul=this.to(Cr);return fs.call(this,ul.scalar,ul.units())}});var Dh=new sh;function $h(Cr){var fs=Dh.get(Cr);if(fs)return fs;var ul=s(Cr,Vn);return ul?fs="1":fs=gs(yl(Cr)).join("*"),Dh.set(Cr,fs),fs}function yl(Cr){for(var fs=[],ul,ih,ch=0;ch<Cr.length;ch++)ul=Cr[ch],ih=Cr[ch+1],ps[ul]?(fs.push(sl[ul]+sl[ih]),ch++):fs.push(sl[ul]);return fs}function gs(Cr){var fs=Cr.reduce(function(ul,ih){var ch=ul[ih];return ch||ul.push(ch=ul[ih]=[ih,0]),ch[1]++,ul},[]);return fs.map(function(ul){return ul[0]+(ul[1]>1?ul[1]:"")})}return kd.version="1.7.6",kd})})(quantities);var quantitiesExports=quantities.exports;const Qty=getDefaultExportFromCjs(quantitiesExports);function deepValue(r,e=""){let t=e.split(".");for(let n of t){if(r[n]===void 0)return;r=r[n]}return r}var orientation={exports:{}},twoProduct_1=twoProduct$1,SPLITTER=+(Math.pow(2,27)+1);function twoProduct$1(r,e,t){var n=r*e,o=SPLITTER*r,a=o-r,l=o-a,s=r-l,m=SPLITTER*e,y=m-e,D=m-y,W=e-D,Ee=n-l*D,dt=Ee-s*D,Ht=dt-l*W,ir=s*W-Ht;return t?(t[0]=ir,t[1]=n,t):[ir,n]}var robustSum=linearExpansionSum;function scalarScalar$1(r,e){var t=r+e,n=t-r,o=t-n,a=e-n,l=r-o,s=l+a;return s?[s,t]:[t]}function linearExpansionSum(r,e){var t=r.length|0,n=e.length|0;if(t===1&&n===1)return scalarScalar$1(r[0],e[0]);var o=t+n,a=new Array(o),l=0,s=0,m=0,y=Math.abs,D=r[s],W=y(D),Ee=e[m],dt=y(Ee),Ht,ir;W<dt?(ir=D,s+=1,s<t&&(D=r[s],W=y(D))):(ir=Ee,m+=1,m<n&&(Ee=e[m],dt=y(Ee))),s<t&&W<dt||m>=n?(Ht=D,s+=1,s<t&&(D=r[s],W=y(D))):(Ht=Ee,m+=1,m<n&&(Ee=e[m],dt=y(Ee)));for(var Hr=Ht+ir,Bn=Hr-Ht,Vn=ir-Bn,Wr=Vn,ps=Hr,il,gl,ml,sl,ll;s<t&&m<n;)W<dt?(Ht=D,s+=1,s<t&&(D=r[s],W=y(D))):(Ht=Ee,m+=1,m<n&&(Ee=e[m],dt=y(Ee))),ir=Wr,Hr=Ht+ir,Bn=Hr-Ht,Vn=ir-Bn,Vn&&(a[l++]=Vn),il=ps+Hr,gl=il-ps,ml=il-gl,sl=Hr-gl,ll=ps-ml,Wr=ll+sl,ps=il;for(;s<t;)Ht=D,ir=Wr,Hr=Ht+ir,Bn=Hr-Ht,Vn=ir-Bn,Vn&&(a[l++]=Vn),il=ps+Hr,gl=il-ps,ml=il-gl,sl=Hr-gl,ll=ps-ml,Wr=ll+sl,ps=il,s+=1,s<t&&(D=r[s]);for(;m<n;)Ht=Ee,ir=Wr,Hr=Ht+ir,Bn=Hr-Ht,Vn=ir-Bn,Vn&&(a[l++]=Vn),il=ps+Hr,gl=il-ps,ml=il-gl,sl=Hr-gl,ll=ps-ml,Wr=ll+sl,ps=il,m+=1,m<n&&(Ee=e[m]);return Wr&&(a[l++]=Wr),ps&&(a[l++]=ps),l||(a[l++]=0),a.length=l,a}var twoSum$1=fastTwoSum;function fastTwoSum(r,e,t){var n=r+e,o=n-r,a=n-o,l=e-o,s=r-a;return t?(t[0]=s+l,t[1]=n,t):[s+l,n]}var twoProduct=twoProduct_1,twoSum=twoSum$1,robustScale=scaleLinearExpansion;function scaleLinearExpansion(r,e){var t=r.length;if(t===1){var n=twoProduct(r[0],e);return n[0]?n:[n[1]]}var o=new Array(2*t),a=[.1,.1],l=[.1,.1],s=0;twoProduct(r[0],e,a),a[0]&&(o[s++]=a[0]);for(var m=1;m<t;++m){twoProduct(r[m],e,l);var y=a[1];twoSum(y,l[0],a),a[0]&&(o[s++]=a[0]);var D=l[1],W=a[1],Ee=D+W,dt=Ee-D,Ht=W-dt;a[1]=Ee,Ht&&(o[s++]=Ht)}return a[1]&&(o[s++]=a[1]),s===0&&(o[s++]=0),o.length=s,o}var robustDiff=robustSubtract;function scalarScalar(r,e){var t=r+e,n=t-r,o=t-n,a=e-n,l=r-o,s=l+a;return s?[s,t]:[t]}function robustSubtract(r,e){var t=r.length|0,n=e.length|0;if(t===1&&n===1)return scalarScalar(r[0],-e[0]);var o=t+n,a=new Array(o),l=0,s=0,m=0,y=Math.abs,D=r[s],W=y(D),Ee=-e[m],dt=y(Ee),Ht,ir;W<dt?(ir=D,s+=1,s<t&&(D=r[s],W=y(D))):(ir=Ee,m+=1,m<n&&(Ee=-e[m],dt=y(Ee))),s<t&&W<dt||m>=n?(Ht=D,s+=1,s<t&&(D=r[s],W=y(D))):(Ht=Ee,m+=1,m<n&&(Ee=-e[m],dt=y(Ee)));for(var Hr=Ht+ir,Bn=Hr-Ht,Vn=ir-Bn,Wr=Vn,ps=Hr,il,gl,ml,sl,ll;s<t&&m<n;)W<dt?(Ht=D,s+=1,s<t&&(D=r[s],W=y(D))):(Ht=Ee,m+=1,m<n&&(Ee=-e[m],dt=y(Ee))),ir=Wr,Hr=Ht+ir,Bn=Hr-Ht,Vn=ir-Bn,Vn&&(a[l++]=Vn),il=ps+Hr,gl=il-ps,ml=il-gl,sl=Hr-gl,ll=ps-ml,Wr=ll+sl,ps=il;for(;s<t;)Ht=D,ir=Wr,Hr=Ht+ir,Bn=Hr-Ht,Vn=ir-Bn,Vn&&(a[l++]=Vn),il=ps+Hr,gl=il-ps,ml=il-gl,sl=Hr-gl,ll=ps-ml,Wr=ll+sl,ps=il,s+=1,s<t&&(D=r[s]);for(;m<n;)Ht=Ee,ir=Wr,Hr=Ht+ir,Bn=Hr-Ht,Vn=ir-Bn,Vn&&(a[l++]=Vn),il=ps+Hr,gl=il-ps,ml=il-gl,sl=Hr-gl,ll=ps-ml,Wr=ll+sl,ps=il,m+=1,m<n&&(Ee=-e[m]);return Wr&&(a[l++]=Wr),ps&&(a[l++]=ps),l||(a[l++]=0),a.length=l,a}(function(r){var e=twoProduct_1,t=robustSum,n=robustScale,o=robustDiff,a=5,l=11102230246251565e-32,s=(3+16*l)*l,m=(7+56*l)*l;function y(Wr,ps,il,gl){return function(sl,ll,rl){var th=Wr(Wr(ps(ll[1],rl[0]),ps(-rl[1],ll[0])),Wr(ps(sl[1],ll[0]),ps(-ll[1],sl[0]))),nh=Wr(ps(sl[1],rl[0]),ps(-rl[1],sl[0])),bh=gl(th,nh);return bh[bh.length-1]}}function D(Wr,ps,il,gl){return function(sl,ll,rl,th){var nh=Wr(Wr(il(Wr(ps(rl[1],th[0]),ps(-th[1],rl[0])),ll[2]),Wr(il(Wr(ps(ll[1],th[0]),ps(-th[1],ll[0])),-rl[2]),il(Wr(ps(ll[1],rl[0]),ps(-rl[1],ll[0])),th[2]))),Wr(il(Wr(ps(ll[1],th[0]),ps(-th[1],ll[0])),sl[2]),Wr(il(Wr(ps(sl[1],th[0]),ps(-th[1],sl[0])),-ll[2]),il(Wr(ps(sl[1],ll[0]),ps(-ll[1],sl[0])),th[2])))),bh=Wr(Wr(il(Wr(ps(rl[1],th[0]),ps(-th[1],rl[0])),sl[2]),Wr(il(Wr(ps(sl[1],th[0]),ps(-th[1],sl[0])),-rl[2]),il(Wr(ps(sl[1],rl[0]),ps(-rl[1],sl[0])),th[2]))),Wr(il(Wr(ps(ll[1],rl[0]),ps(-rl[1],ll[0])),sl[2]),Wr(il(Wr(ps(sl[1],rl[0]),ps(-rl[1],sl[0])),-ll[2]),il(Wr(ps(sl[1],ll[0]),ps(-ll[1],sl[0])),rl[2])))),Fh=gl(nh,bh);return Fh[Fh.length-1]}}function W(Wr,ps,il,gl){return function(sl,ll,rl,th,nh){var bh=Wr(Wr(Wr(il(Wr(il(Wr(ps(th[1],nh[0]),ps(-nh[1],th[0])),rl[2]),Wr(il(Wr(ps(rl[1],nh[0]),ps(-nh[1],rl[0])),-th[2]),il(Wr(ps(rl[1],th[0]),ps(-th[1],rl[0])),nh[2]))),ll[3]),Wr(il(Wr(il(Wr(ps(th[1],nh[0]),ps(-nh[1],th[0])),ll[2]),Wr(il(Wr(ps(ll[1],nh[0]),ps(-nh[1],ll[0])),-th[2]),il(Wr(ps(ll[1],th[0]),ps(-th[1],ll[0])),nh[2]))),-rl[3]),il(Wr(il(Wr(ps(rl[1],nh[0]),ps(-nh[1],rl[0])),ll[2]),Wr(il(Wr(ps(ll[1],nh[0]),ps(-nh[1],ll[0])),-rl[2]),il(Wr(ps(ll[1],rl[0]),ps(-rl[1],ll[0])),nh[2]))),th[3]))),Wr(il(Wr(il(Wr(ps(rl[1],th[0]),ps(-th[1],rl[0])),ll[2]),Wr(il(Wr(ps(ll[1],th[0]),ps(-th[1],ll[0])),-rl[2]),il(Wr(ps(ll[1],rl[0]),ps(-rl[1],ll[0])),th[2]))),-nh[3]),Wr(il(Wr(il(Wr(ps(th[1],nh[0]),ps(-nh[1],th[0])),ll[2]),Wr(il(Wr(ps(ll[1],nh[0]),ps(-nh[1],ll[0])),-th[2]),il(Wr(ps(ll[1],th[0]),ps(-th[1],ll[0])),nh[2]))),sl[3]),il(Wr(il(Wr(ps(th[1],nh[0]),ps(-nh[1],th[0])),sl[2]),Wr(il(Wr(ps(sl[1],nh[0]),ps(-nh[1],sl[0])),-th[2]),il(Wr(ps(sl[1],th[0]),ps(-th[1],sl[0])),nh[2]))),-ll[3])))),Wr(Wr(il(Wr(il(Wr(ps(ll[1],nh[0]),ps(-nh[1],ll[0])),sl[2]),Wr(il(Wr(ps(sl[1],nh[0]),ps(-nh[1],sl[0])),-ll[2]),il(Wr(ps(sl[1],ll[0]),ps(-ll[1],sl[0])),nh[2]))),th[3]),Wr(il(Wr(il(Wr(ps(ll[1],th[0]),ps(-th[1],ll[0])),sl[2]),Wr(il(Wr(ps(sl[1],th[0]),ps(-th[1],sl[0])),-ll[2]),il(Wr(ps(sl[1],ll[0]),ps(-ll[1],sl[0])),th[2]))),-nh[3]),il(Wr(il(Wr(ps(rl[1],th[0]),ps(-th[1],rl[0])),ll[2]),Wr(il(Wr(ps(ll[1],th[0]),ps(-th[1],ll[0])),-rl[2]),il(Wr(ps(ll[1],rl[0]),ps(-rl[1],ll[0])),th[2]))),sl[3]))),Wr(il(Wr(il(Wr(ps(rl[1],th[0]),ps(-th[1],rl[0])),sl[2]),Wr(il(Wr(ps(sl[1],th[0]),ps(-th[1],sl[0])),-rl[2]),il(Wr(ps(sl[1],rl[0]),ps(-rl[1],sl[0])),th[2]))),-ll[3]),Wr(il(Wr(il(Wr(ps(ll[1],th[0]),ps(-th[1],ll[0])),sl[2]),Wr(il(Wr(ps(sl[1],th[0]),ps(-th[1],sl[0])),-ll[2]),il(Wr(ps(sl[1],ll[0]),ps(-ll[1],sl[0])),th[2]))),rl[3]),il(Wr(il(Wr(ps(ll[1],rl[0]),ps(-rl[1],ll[0])),sl[2]),Wr(il(Wr(ps(sl[1],rl[0]),ps(-rl[1],sl[0])),-ll[2]),il(Wr(ps(sl[1],ll[0]),ps(-ll[1],sl[0])),rl[2]))),-th[3]))))),Fh=Wr(Wr(Wr(il(Wr(il(Wr(ps(th[1],nh[0]),ps(-nh[1],th[0])),rl[2]),Wr(il(Wr(ps(rl[1],nh[0]),ps(-nh[1],rl[0])),-th[2]),il(Wr(ps(rl[1],th[0]),ps(-th[1],rl[0])),nh[2]))),sl[3]),il(Wr(il(Wr(ps(th[1],nh[0]),ps(-nh[1],th[0])),sl[2]),Wr(il(Wr(ps(sl[1],nh[0]),ps(-nh[1],sl[0])),-th[2]),il(Wr(ps(sl[1],th[0]),ps(-th[1],sl[0])),nh[2]))),-rl[3])),Wr(il(Wr(il(Wr(ps(rl[1],nh[0]),ps(-nh[1],rl[0])),sl[2]),Wr(il(Wr(ps(sl[1],nh[0]),ps(-nh[1],sl[0])),-rl[2]),il(Wr(ps(sl[1],rl[0]),ps(-rl[1],sl[0])),nh[2]))),th[3]),il(Wr(il(Wr(ps(rl[1],th[0]),ps(-th[1],rl[0])),sl[2]),Wr(il(Wr(ps(sl[1],th[0]),ps(-th[1],sl[0])),-rl[2]),il(Wr(ps(sl[1],rl[0]),ps(-rl[1],sl[0])),th[2]))),-nh[3]))),Wr(Wr(il(Wr(il(Wr(ps(rl[1],nh[0]),ps(-nh[1],rl[0])),ll[2]),Wr(il(Wr(ps(ll[1],nh[0]),ps(-nh[1],ll[0])),-rl[2]),il(Wr(ps(ll[1],rl[0]),ps(-rl[1],ll[0])),nh[2]))),sl[3]),il(Wr(il(Wr(ps(rl[1],nh[0]),ps(-nh[1],rl[0])),sl[2]),Wr(il(Wr(ps(sl[1],nh[0]),ps(-nh[1],sl[0])),-rl[2]),il(Wr(ps(sl[1],rl[0]),ps(-rl[1],sl[0])),nh[2]))),-ll[3])),Wr(il(Wr(il(Wr(ps(ll[1],nh[0]),ps(-nh[1],ll[0])),sl[2]),Wr(il(Wr(ps(sl[1],nh[0]),ps(-nh[1],sl[0])),-ll[2]),il(Wr(ps(sl[1],ll[0]),ps(-ll[1],sl[0])),nh[2]))),rl[3]),il(Wr(il(Wr(ps(ll[1],rl[0]),ps(-rl[1],ll[0])),sl[2]),Wr(il(Wr(ps(sl[1],rl[0]),ps(-rl[1],sl[0])),-ll[2]),il(Wr(ps(sl[1],ll[0]),ps(-ll[1],sl[0])),rl[2]))),-nh[3])))),Bh=gl(bh,Fh);return Bh[Bh.length-1]}}function Ee(Wr){var ps=Wr===3?y:Wr===4?D:W;return ps(t,e,n,o)}var dt=Ee(3),Ht=Ee(4),ir=[function(){return 0},function(){return 0},function(ps,il){return il[0]-ps[0]},function(ps,il,gl){var ml=(ps[1]-gl[1])*(il[0]-gl[0]),sl=(ps[0]-gl[0])*(il[1]-gl[1]),ll=ml-sl,rl;if(ml>0){if(sl<=0)return ll;rl=ml+sl}else if(ml<0){if(sl>=0)return ll;rl=-(ml+sl)}else return ll;var th=s*rl;return ll>=th||ll<=-th?ll:dt(ps,il,gl)},function(ps,il,gl,ml){var sl=ps[0]-ml[0],ll=il[0]-ml[0],rl=gl[0]-ml[0],th=ps[1]-ml[1],nh=il[1]-ml[1],bh=gl[1]-ml[1],Fh=ps[2]-ml[2],Bh=il[2]-ml[2],Ed=gl[2]-ml[2],Td=ll*bh,td=rl*nh,Fd=rl*th,Ld=sl*bh,Ud=sl*nh,Xd=ll*th,wd=Fh*(Td-td)+Bh*(Fd-Ld)+Ed*(Ud-Xd),zd=(Math.abs(Td)+Math.abs(td))*Math.abs(Fh)+(Math.abs(Fd)+Math.abs(Ld))*Math.abs(Bh)+(Math.abs(Ud)+Math.abs(Xd))*Math.abs(Ed),Rd=m*zd;return wd>Rd||-wd>Rd?wd:Ht(ps,il,gl,ml)}];function Hr(Wr){var ps=ir[Wr.length];return ps||(ps=ir[Wr.length]=Ee(Wr.length)),ps.apply(void 0,Wr)}function Bn(Wr,ps,il,gl,ml,sl,ll){return function(th,nh,bh,Fh,Bh){switch(arguments.length){case 0:case 1:return 0;case 2:return gl(th,nh);case 3:return ml(th,nh,bh);case 4:return sl(th,nh,bh,Fh);case 5:return ll(th,nh,bh,Fh,Bh)}for(var Ed=new Array(arguments.length),Td=0;Td<arguments.length;++Td)Ed[Td]=arguments[Td];return Wr(Ed)}}function Vn(){for(;ir.length<=a;)ir.push(Ee(ir.length));r.exports=Bn.apply(void 0,[Hr].concat(ir));for(var Wr=0;Wr<=a;++Wr)r.exports[Wr]=ir[Wr]}Vn()})(orientation);var orientationExports=orientation.exports,robustPnp=robustPointInPolygon,orient=orientationExports;function robustPointInPolygon(r,e){for(var t=e[0],n=e[1],o=r.length,a=1,l=o,s=0,m=o-1;s<l;m=s++){var y=r[s],D=r[m],W=y[1],Ee=D[1];if(Ee<W){if(Ee<n&&n<W){var dt=orient(y,D,e);if(dt===0)return 0;a^=0<dt|0}else if(n===W){var Ht=r[(s+1)%o],ir=Ht[1];if(W<ir){var dt=orient(y,D,e);if(dt===0)return 0;a^=0<dt|0}}}else if(W<Ee){if(W<n&&n<Ee){var dt=orient(y,D,e);if(dt===0)return 0;a^=dt<0|0}else if(n===W){var Ht=r[(s+1)%o],ir=Ht[1];if(ir<W){var dt=orient(y,D,e);if(dt===0)return 0;a^=dt<0|0}}}else if(n===W){var Hr=Math.min(y[0],D[0]),Bn=Math.max(y[0],D[0]);if(s===0){for(;m>0;){var Vn=(m+o-1)%o,Wr=r[Vn];if(Wr[1]!==n)break;var ps=Wr[0];Hr=Math.min(Hr,ps),Bn=Math.max(Bn,ps),m=Vn}if(m===0)return Hr<=t&&t<=Bn?0:1;l=m+1}for(var il=r[(m+o-1)%o][1];s+1<l;){var Wr=r[s+1];if(Wr[1]!==n)break;var ps=Wr[0];Hr=Math.min(Hr,ps),Bn=Math.max(Bn,ps),s+=1}if(Hr<=t&&t<=Bn)return 0;var gl=r[(s+1)%o][1];t<Hr&&il<n!=gl<n&&(a^=1)}}return 2*a-1}const robustPointInPolygon$1=getDefaultExportFromCjs(robustPnp);function feretDiameters(r={}){const{originalPoints:e=monotoneChainConvexHull.call(this)}=r;if(e.length===0)return{min:0,max:0,minLine:[],maxLine:[],aspectRatio:1};if(e.length===1)return{min:1,max:1,minLine:[e[0],e[0]],maxLine:[e[0],e[0]],aspectRatio:1};const t=new Array(e.length);let n=1/0,o=0,a=[];for(let y=0;y<e.length;y++){let D=getAngle(e[y],e[(y+1)%e.length]);rotate(-D,e,t);let W=0,Ee=[];for(let dt=0;dt<e.length;dt++){let Ht=Math.abs(t[y][1]-t[dt][1]);Ht>W&&(W=Ht,Ee=[],Ee.push([t[dt][0],t[y][1]],[t[dt][0],t[dt][1]]))}W<n&&(n=W,o=D,a=Ee)}rotate(o,a,a);let l=0,s=[],m=0;for(let y=0;y<e.length-1;y++)for(let D=y+1;D<e.length;D++){let W=(e[y][0]-e[D][0])**2+(e[y][1]-e[D][1])**2;W>m&&(m=W,l=Math.sqrt(W),s=[e[y],e[D]])}return{min:n,minLine:a,max:l,maxLine:s,aspectRatio:n/l}}function getAngle(r,e){let t=difference(e,r),n=normalize(t),o=Math.acos(n[0]);return n[1]<0?-o:o}class Roi{constructor(e,t){this.map=e,this.id=t,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY,this.meanX=0,this.meanY=0,this.surface=0,this.computed={}}getMask(e={}){const{scale:t=1,kind:n=""}=e;let o;switch(n){case"contour":o=this.contourMask;break;case"box":o=this.boxMask;break;case"filled":o=this.filledMask;break;case"center":o=this.centerMask;break;case"mbr":o=this.mbrFilledMask;break;case"hull":o=this.convexHullFilledMask;break;case"hullContour":o=this.convexHullMask;break;case"mbrContour":o=this.mbrMask;break;case"feret":o=this.feretMask;break;default:o=this.mask}return t<1&&(o=o.resize({factor:t}),o.parent=this.mask.parent,o.position[0]+=this.minX,o.position[1]+=this.minY),o}get mean(){throw new Error("Roi mean not implemented yet")}get center(){return this.computed.center||(this.computed.center=[this.width/2>>0,this.height/2>>0]),this.computed.center}get ratio(){return this.width/this.height}get width(){return this.maxX-this.minX+1}get height(){return this.maxY-this.minY+1}_computExternalIDs(){let e=this.borderIDs,t=this.borderLengths;this.computed.externalIDs=[],this.computed.externalLengths=[];let n=this.internalIDs;for(let o=0;o<e.length;o++)n.includes(e[o])||(this.computed.externalIDs.push(e[o]),this.computed.externalLengths.push(t[o]))}get externalIDs(){return this.computed.externalIDs?this.computed.externalIDs:(this._computExternalIDs(),this.computed.externalIDs)}get externalLengths(){return this.computed.externalLengths?this.computed.externalLengths:(this._computExternalIDs(),this.computed.externalLengths)}_computeBorderIDs(){let e=getBorders(this);this.computed.borderIDs=e.ids,this.computed.borderLengths=e.lengths}get borderIDs(){return this.computed.borderIDs?this.computed.borderIDs:(this._computeBorderIDs(),this.computed.borderIDs)}get borderLengths(){return this.computed.borderLengths?this.computed.borderLengths:(this._computeBorderIDs(),this.computed.borderLengths)}get boxIDs(){return this.computed.boxIDs||(this.computed.boxIDs=getBoxIDs(this)),this.computed.boxIDs}get internalIDs(){return this.computed.internalIDs||(this.computed.internalIDs=getInternalIDs(this)),this.computed.internalIDs}get box(){return this.computed.box||(this.computed.box=getBox(this)),this.computed.box}get external(){return this.computed.external||(this.computed.external=getExternal(this)),this.computed.external}get holesInfo(){return this.computed.holesInfo||(this.computed.holesInfo=getHolesInfo(this)),this.computed.holesInfo}get border(){return this.computed.border||(this.computed.border=getBorder(this)),this.computed.border}get contourMask(){if(!this.computed.contourMask){let e=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let t=0;t<this.width;t++)for(let n=0;n<this.height;n++)this.map.data[t+this.minX+(n+this.minY)*this.map.width]===this.id&&(t>0&&t<this.width-1&&n>0&&n<this.height-1?(this.map.data[t-1+this.minX+(n+this.minY)*this.map.width]!==this.id||this.map.data[t+1+this.minX+(n+this.minY)*this.map.width]!==this.id||this.map.data[t+this.minX+(n-1+this.minY)*this.map.width]!==this.id||this.map.data[t+this.minX+(n+1+this.minY)*this.map.width]!==this.id)&&e.setBitXY(t,n):e.setBitXY(t,n));this.computed.contourMask=e}return this.computed.contourMask}get boxMask(){if(!this.computed.boxMask){let e=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let t=0;t<this.width;t++)e.setBitXY(t,0),e.setBitXY(t,this.height-1);for(let t=0;t<this.height;t++)e.setBitXY(0,t),e.setBitXY(this.width-1,t);this.computed.boxMask=e}return this.computed.boxMask}get mask(){if(!this.computed.mask){let e=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let t=0;t<this.width;t++)for(let n=0;n<this.height;n++)this.map.data[t+this.minX+(n+this.minY)*this.map.width]===this.id&&e.setBitXY(t,n);this.computed.mask=e}return this.computed.mask}get filledMask(){if(!this.computed.filledMask){let e=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let t=0;t<this.width;t++)for(let n=0;n<this.height;n++){let o=t+this.minX+(n+this.minY)*this.map.width;this.internalIDs.includes(this.map.data[o])&&e.setBitXY(t,n)}this.computed.filledMask=e}return this.computed.filledMask}get centerMask(){if(!this.computed.centerMask){let e=new Shape({kind:"smallCross"}).getMask();e.parent=this.map.parent,e.position=[this.minX+this.center[0]-1,this.minY+this.center[1]-1],this.computed.centerMask=e}return this.computed.centerMask}get convexHull(){if(!this.computed.convexHull){const e=[];for(let n=0;n<this.width;n++)for(let o=0;o<this.height;o++)this.map.data[n+this.minX+(o+this.minY)*this.map.width]===this.id&&(n>0&&n<this.width-1&&o>0&&o<this.height-1?(this.map.data[n-1+this.minX+(o+this.minY)*this.map.width]!==this.id||this.map.data[n+1+this.minX+(o+this.minY)*this.map.width]!==this.id||this.map.data[n+this.minX+(o-1+this.minY)*this.map.width]!==this.id||this.map.data[n+this.minX+(o+1+this.minY)*this.map.width]!==this.id)&&(e.push([n,o]),e.push([n+1,o]),e.push([n,o+1]),e.push([n+1,o+1])):(e.push([n,o]),e.push([n+1,o]),e.push([n,o+1]),e.push([n+1,o+1])));const t=monotoneChainConvexHull$1(e);this.computed.convexHull={polyline:t,surface:surface(t),perimeter:perimeter(t)}}return this.computed.convexHull}get convexHullMask(){if(!this.computed.convexHullMask){const e=this.convexHull,t=new Image$1(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});t.paintPolyline(e.polyline,{closed:!0}),this.computed.convexHullMask=t}return this.computed.convexHullMask}get convexHullFilledMask(){if(!this.computed.convexHullFilledMask){const e=this.convexHull,t=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let n=0;n<this.width;n++)for(let o=0;o<this.height;o++)robustPointInPolygon$1(e.polyline,[n,o])!==1&&t.setBitXY(n,o);this.computed.convexHullFilledMask=t}return this.computed.convexHullFilledMask}get mbr(){if(!this.computed.mbr){let e=minimalBoundingRectangle({originalPoints:this.convexHull.polyline});if(e.length===0)this.computed.mbr={width:0,height:0,surface:0,perimeter:0,rectangle:e};else{let t=e[0],n=e[1],o=e[2],a=Math.sqrt((t[0]-n[0])**2+(t[1]-n[1])**2),l=Math.sqrt((o[0]-n[0])**2+(o[1]-n[1])**2);this.computed.mbr={width:a,height:l,elongation:1-a/l,aspectRatio:a/l,surface:a*l,perimeter:(a+l)*2,rectangle:e}}}return this.computed.mbr}get fillRatio(){return this.surface/(this.surface+this.holesInfo.surface)}get feretDiameters(){return this.computed.feretDiameters||(this.computed.feretDiameters=feretDiameters({originalPoints:this.convexHull.polyline})),this.computed.feretDiameters}get eqpc(){return this.computed.eqpc||(this.computed.eqpc=2*Math.sqrt(this.surface/Math.PI)),this.computed.eqpc}get perimeterInfo(){return this.computed.perimeterInfo||(this.computed.perimeterInfo=getPerimeterInfo(this)),this.computed.perimeterInfo}get perimeter(){let e=this.perimeterInfo,t=2-Math.sqrt(2);return e.one+e.two*2+e.three*3+e.four*4-t*(e.two+e.three*2+e.four)}get ped(){return this.computed.ped||(this.computed.ped=this.perimeter/Math.PI),this.computed.ped}get feretMask(){if(!this.computed.feretMask){const e=new Image$1(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});e.paintPolyline(this.feretDiameters.minLine),e.paintPolyline(this.feretDiameters.maxLine),this.computed.feretMask=e}return this.computed.feretMask}get mbrMask(){if(!this.computed.mbrMask){let e=round(this.mbr.rectangle);if(e.length>0){const t=minMax(e),n=new Image$1(t[1][0]-t[0][0]+1,t[1][1]-t[0][1]+1,{kind:BINARY,position:[this.minX+t[0][0],this.minY+t[0][1]],parent:this.map.parent});e=moveToZeroZero(e),n.paintPolyline(e,{closed:!0}),this.computed.mbrMask=n}else this.computed.mbrMask=new Image$1(1,1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent})}return this.computed.mbrMask}get mbrFilledMask(){if(!this.computed.mbrFilledMask){const e=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent}),t=this.mask.minimalBoundingRectangle();for(let n=0;n<this.width;n++)for(let o=0;o<this.height;o++)robustPointInPolygon$1(t,[n,o])!==1&&e.setBitXY(n,o);this.computed.mbrFilledMask=e}return this.computed.mbrFilledMask}get points(){if(!this.computed.points){let e=[];for(let t=0;t<this.height;t++)for(let n=0;n<this.width;n++){let o=(t+this.minY)*this.map.width+n+this.minX;this.map.data[o]===this.id&&e.push([n,t])}this.computed.points=e}return this.computed.points}get maxLengthPoints(){if(!this.computed.maxLengthPoints){let e=0,t;const n=this.points;for(let o=0;o<n.length;o++)for(let a=o+1;a<n.length;a++){let l=Math.pow(n[o][0]-n[a][0],2)+Math.pow(n[o][1]-n[a][1],2);l>=e&&(e=l,t=[n[o],n[a]])}this.computed.maxLengthPoints=t}return this.computed.maxLengthPoints}get maxLength(){if(!this.computed.maxLength){let e=Math.sqrt(Math.pow(this.maxLengthPoints[0][0]-this.maxLengthPoints[1][0],2)+Math.pow(this.maxLengthPoints[0][1]-this.maxLengthPoints[1][1],2));this.computed.maxLength=e}return this.computed.maxLength}get roundness(){return 4*this.surface/(Math.PI*this.feretDiameters.max**2)}get sphericity(){return 2*Math.sqrt(this.surface*Math.PI)/this.perimeter}get solidity(){return this.surface/this.convexHull.surface}get angle(){if(!this.computed.angle){let e=this.maxLengthPoints,t=-Math.atan2(e[0][1]-e[1][1],e[0][0]-e[1][0])*180/Math.PI;this.computed.angle=t}return this.computed.angle}toJSON(){return{id:this.id,minX:this.minX,maxX:this.maxX,minY:this.minY,maxY:this.maxY,meanX:this.meanX,meanY:this.meanY,height:this.height,width:this.width,surface:this.surface,mbrWidth:this.mbr.width,mbrHeight:this.mbr.height,mbrSurface:this.mbr.surface,eqpc:this.eqpc,ped:this.ped,feretDiameterMin:this.feretDiameters.min,feretDiameterMax:this.feretDiameters.max,aspectRatio:this.feretDiameters.aspectRatio,fillRatio:this.fillRatio,sphericity:this.sphericity,roundness:this.roundness,solidity:this.solidity,perimeter:this.perimeter}}}function getBorders(r){let e=r.map,t=e.data,n=new Set,o=new Map,a=new Set,l=[1,0,-1,0],s=[0,1,0,-1];for(let D=r.minX;D<=r.maxX;D++)for(let W=r.minY;W<=r.maxY;W++){let Ee=D+W*e.width;if(t[Ee]===r.id)for(let dt=0;dt<4;dt++){let Ht=D+l[dt],ir=W+s[dt];if(Ht>=0&&ir>=0&&Ht<e.width&&ir<e.height){let Hr=Ht+ir*e.width;if(t[Hr]!==r.id&&!a.has(Hr)){a.add(Hr),n.add(t[Hr]);let Bn=o.get(t[Hr]);Bn?o.set(t[Hr],++Bn):o.set(t[Hr],1)}}}}let m=Array.from(n),y=m.map(function(D){return o.get(D)});return{ids:m,lengths:y}}function getBoxIDs(r){let e=new Set,t=r.map,n=t.data;for(let o of[0,r.height-1])for(let a=0;a<r.width;a++){let l=(o+r.minY)*t.width+a+r.minX;if(a-r.minX>0&&n[l]===r.id&&n[l-1]!==r.id){let s=n[l-1];e.add(s)}if(t.width-a-r.minX>1&&n[l]===r.id&&n[l+1]!==r.id){let s=n[l+1];e.add(s)}}for(let o of[0,r.width-1])for(let a=0;a<r.height;a++){let l=(a+r.minY)*t.width+o+r.minX;if(a-r.minY>0&&n[l]===r.id&&n[l-t.width]!==r.id){let s=n[l-t.width];e.add(s)}if(t.height-a-r.minY>1&&n[l]===r.id&&n[l+t.width]!==r.id){let s=n[l+t.width];e.add(s)}}return Array.from(e)}function getBox(r){let e=0,t=r.map,n=t.data,o=[0];r.height>1&&(o[1]=r.height-1);for(let l of o)for(let s=1;s<r.width-1;s++){let m=(l+r.minY)*t.width+s+r.minX;n[m]===r.id&&e++}let a=[0];r.width>1&&(a[1]=r.width-1);for(let l of a)for(let s=0;s<r.height;s++){let m=(s+r.minY)*t.width+l+r.minX;n[m]===r.id&&e++}return e}function getBorder(r){let e=0,t=r.map,n=t.data;for(let o=1;o<r.width-1;o++)for(let a=1;a<r.height-1;a++){let l=(a+r.minY)*t.width+o+r.minX;n[l]===r.id&&(n[l-1]!==r.id||n[l+1]!==r.id||n[l-t.width]!==r.id||n[l+t.width]!==r.id)&&e++}return e+r.box}function getPerimeterInfo(r){let e=r.map,t=e.data,n=0,o=0,a=0,l=0;for(let s=0;s<r.width;s++)for(let m=0;m<r.height;m++){let y=(m+r.minY)*e.width+s+r.minX;if(t[y]===r.id){let D=0;switch((s===0||r.externalIDs.includes(t[y-1]))&&D++,(s===r.width-1||r.externalIDs.includes(t[y+1]))&&D++,(m===0||r.externalIDs.includes(t[y-e.width]))&&D++,(m===r.height-1||r.externalIDs.includes(t[y+e.width]))&&D++,D){case 1:n++;break;case 2:o++;break;case 3:a++;break;case 4:l++;break}}}return{one:n,two:o,three:a,four:l}}function getExternal(r){let e=0,t=r.map,n=t.data;for(let o=1;o<r.width-1;o++)for(let a=1;a<r.height-1;a++){let l=(a+r.minY)*t.width+o+r.minX;n[l]===r.id&&(r.externalIDs.includes(n[l-1])||r.externalIDs.includes(n[l+1])||r.externalIDs.includes(n[l-t.width])||r.externalIDs.includes(n[l+t.width]))&&e++}return e+r.box}function getHolesInfo(r){let e=0,t=r.map.width,n=r.map.data;for(let o=1;o<r.width-1;o++)for(let a=1;a<r.height-1;a++){let l=(a+r.minY)*t+o+r.minX;r.internalIDs.includes(n[l])&&n[l]!==r.id&&e++}return{number:r.internalIDs.length-1,surface:e}}function getInternalIDs(r){let e=[r.id],t=r.map,n=t.data;if(r.height>2)for(let a=0;a<r.width;a++){let l=r.minY*t.width+a+r.minX;if(e.includes(n[l])){let s=n[l+t.width];!e.includes(s)&&!r.boxIDs.includes(s)&&e.push(s)}}let o=new Array(4);for(let a=1;a<r.width-1;a++)for(let l=1;l<r.height-1;l++){let s=(l+r.minY)*t.width+a+r.minX;if(e.includes(n[s])){o[0]=n[s-1],o[1]=n[s+1],o[2]=n[s-t.width],o[3]=n[s+t.width];for(let m=0;m<4;m++){let y=o[m];!e.includes(y)&&!r.boxIDs.includes(y)&&e.push(y)}}}return e}class RoiLayer{constructor(e,t){this.roiMap=e,this.options=t,this.roi=this.createRoi()}createRoi(){let e=this.roiMap.data,t={};this.roiMap.positive=0,this.roiMap.negative=0;for(let s=0;s<e.length;s++)e[s]&&!t[e[s]]&&(t[e[s]]=!0,e[s]>0?this.roiMap.positive++:this.roiMap.negative++);let n={};for(let s in t)n[s]=new Roi(this.roiMap,s*1);let o=this.roiMap.width,a=this.roiMap.height;for(let s=0;s<a;s++)for(let m=0;m<o;m++){let y=s*o+m;if(e[y]!==0){const D=e[y],W=n[D];m<W.minX&&(W.minX=m),m>W.maxX&&(W.maxX=m),s<W.minY&&(W.minY=s),s>W.maxY&&(W.maxY=s),W.meanX+=m,W.meanY+=s,W.surface++}}let l=[];for(let s in t)n[s].meanX/=n[s].surface,n[s].meanY/=n[s].surface,l.push(n[s]);return l}}function commonBorderLength(r){let e=r.data,t=[1,0,-1,0],n=[0,1,0,-1],o=r.minMax,a=-o.min,l=o.max+a,s=[];for(let y=0;y<=l;y++)s.push(Object.create(null));for(let y=0;y<r.width;y++)for(let D=0;D<r.height;D++){let W=y+D*r.width,Ee=e[W];if(Ee!==0){let dt=Object.create(null),Ht=!1;for(let ir=0;ir<4;ir++){let Hr=y+t[ir],Bn=D+n[ir];if(Hr>=0&&Bn>=0&&Hr<r.width&&Bn<r.height){let Vn=e[Hr+Bn*r.width];Ee!==Vn&&(Ht=!0,Vn!==0&&dt[Vn]===void 0&&(dt[Vn]=!0,s[Vn+a][Ee]?s[Vn+a][Ee]++:s[Vn+a][Ee]=1))}else Ht=!0}Ht&&(s[Ee+a][Ee]?s[Ee+a][Ee]++:s[Ee+a][Ee]=1)}}let m={};for(let y=0;y<s.length;y++)Object.keys(s[y]).length>0&&(m[y-a]=s[y]);return m}function mergeRoi(r={}){const{algorithm:e="commonBorderLength",minCommonBorderLength:t=5,maxCommonBorderLength:n=100,minCommonBorderRatio:o=.3,maxCommonBorderRatio:a=1}=r;let l=function(Hr,Bn,Vn){return Hr[Vn]>=t&&Hr[Vn]<=n};typeof e=="function"&&(l=e),e.toLowerCase()==="commonborderratio"&&(l=function(Hr,Bn,Vn){let Wr=Math.min(Hr[Vn]/Hr[Bn],1);return Wr>=o&&Wr<=a});const s=this,m=s.commonBorderLength;let y={},D={};for(let Hr of Object.keys(m)){let Bn=m[Hr],Vn=Object.keys(Bn);for(let Wr of Vn)if(Wr!==Hr&&l(Bn,Hr,Wr)){let ps=Wr;D[Wr]&&(ps=D[Wr]);let il=Hr;if(D[Hr]&&(il=D[Hr]),Number(ps)!==il){let gl=Math.min(ps,il),ml=Math.max(ps,il);if(y[gl]||(y[gl]={}),y[gl][ml]=!0,D[ml]=gl,y[ml]){for(let sl of Object.keys(y[ml]))y[gl][sl]=!0,D[sl]=gl;delete y[ml]}}}}let W=s.minMax,Ee=-W.min,dt=W.max+Ee,Ht=new Array(dt+1).fill(0);for(let Hr of Object.keys(D))Ht[Number(Hr)+Ee]=D[Hr];let ir=s.data;for(let Hr=0;Hr<ir.length;Hr++){let Bn=ir[Hr];if(Bn!==0){let Vn=Ht[Bn+Ee];Vn!==0&&(ir[Hr]=Vn)}}return s.computed={},s}class RoiMap{constructor(e,t){this.parent=e,this.width=e.width,this.height=e.height,this.data=t,this.negative=0,this.positive=0}get total(){return this.negative+this.positive}get minMax(){let e=Number.MAX_SAFE_INTEGER,t=Number.MIN_SAFE_INTEGER;for(let n=0;n<this.data.length;n++)this.data[n]<e&&(e=this.data[n]),this.data[n]>t&&(t=this.data[n]);return{min:e,max:t}}get commonBorderLength(){return commonBorderLength(this)}mergeRoi(e={}){return mergeRoi.call(this,e)}mergeRois(e){const t=e[0],n=e.slice(1);for(let o=0;o<this.data.length;o++)n.includes(this.data[o])&&(this.data[o]=t)}rowsInfo(){let e=new Array(this.height),t=0;for(let n=0;n<this.data.length;n+=this.width){let o={row:t,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};e[t++]=o;let a={},l={},s=[],m=this.data[n],y=0;for(let D=n;D<n+this.width;D++){let W=this.data[D];m!==W&&(m=W,s.push(y),y=0),y++,W>0?(o.positivePixel++,a[W]||(a[W]=!0)):W<0?(o.negativePixel++,l[W]||(l[W]=!0)):o.zeroPixel++}s.push(y),o.medianChange=s.sort((D,W)=>D-W)[Math.floor(s.length/2)],o.positiveRoiIDs=Object.keys(a),o.negativeRoiIDs=Object.keys(l),o.positiveRoi=o.positiveRoiIDs.length,o.negativeRoi=o.negativeRoiIDs.length}return e}colsInfo(){let e=new Array(this.width),t=0;for(let n=0;n<this.width;n++){let o={col:t,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};e[t++]=o;let a={},l={},s=[],m=this.data[n],y=0;for(let D=n;D<n+this.data.length;D+=this.width){let W=this.data[D];m!==W&&(m=W,s.push(y),y=0),y++,W>0?(o.positivePixel++,a[W]||(a[W]=!0)):W<0?(o.negativePixel++,l[W]||(l[W]=!0)):o.zeroPixel++}s.push(y),o.medianChange=s.sort((D,W)=>D-W)[Math.floor(s.length/2)],o.positiveRoiIDs=Object.keys(a),o.negativeRoiIDs=Object.keys(l),o.positiveRoi=o.positiveRoiIDs.length,o.negativeRoi=o.negativeRoiIDs.length}return e}}function fromMask(r,e={}){const{allowCorners:t=!1}=e,n=65535;let o=new Int16Array(r.size),a=0,l=0,s=new Uint16Array(n+1),m=new Uint16Array(n+1);for(let D=0;D<r.width;D++)for(let W=0;W<r.height;W++)o[W*r.width+D]===0&&y(D,W);function y(D,W){let Ee=0,dt=0,Ht=r.getBitXY(D,W),ir=Ht?++a:--l;if(a>32767||l<-32768)throw new Error("Too many regions of interest");for(s[0]=D,m[0]=W;Ee<=dt;){let Hr=s[Ee&n],Bn=m[Ee&n];if(o[Bn*r.width+Hr]=ir,Hr>0&&o[Bn*r.width+Hr-1]===0&&r.getBitXY(Hr-1,Bn)===Ht&&(dt++,s[dt&n]=Hr-1,m[dt&n]=Bn,o[Bn*r.width+Hr-1]=-32768),Bn>0&&o[(Bn-1)*r.width+Hr]===0&&r.getBitXY(Hr,Bn-1)===Ht&&(dt++,s[dt&n]=Hr,m[dt&n]=Bn-1,o[(Bn-1)*r.width+Hr]=-32768),Hr<r.width-1&&o[Bn*r.width+Hr+1]===0&&r.getBitXY(Hr+1,Bn)===Ht&&(dt++,s[dt&n]=Hr+1,m[dt&n]=Bn,o[Bn*r.width+Hr+1]=-32768),Bn<r.height-1&&o[(Bn+1)*r.width+Hr]===0&&r.getBitXY(Hr,Bn+1)===Ht&&(dt++,s[dt&n]=Hr,m[dt&n]=Bn+1,o[(Bn+1)*r.width+Hr]=-32768),t&&(Hr>0&&Bn>0&&o[(Bn-1)*r.width+Hr-1]===0&&r.getBitXY(Hr-1,Bn-1)===Ht&&(dt++,s[dt&n]=Hr-1,m[dt&n]=Bn-1,o[(Bn-1)*r.width+Hr-1]=-32768),Hr<r.width-1&&Bn>0&&o[(Bn-1)*r.width+Hr+1]===0&&r.getBitXY(Hr+1,Bn-1)===Ht&&(dt++,s[dt&n]=Hr+1,m[dt&n]=Bn-1,o[(Bn-1)*r.width+Hr+1]=-32768),Hr>0&&Bn<r.height-1&&o[(Bn+1)*r.width+Hr-1]===0&&r.getBitXY(Hr-1,Bn+1)===Ht&&(dt++,s[dt&n]=Hr-1,m[dt&n]=Bn+1,o[(Bn+1)*r.width+Hr-1]=-32768),Hr<r.width-1&&Bn<r.height-1&&o[(Bn+1)*r.width+Hr+1]===0&&r.getBitXY(Hr+1,Bn+1)===Ht&&(dt++,s[dt&n]=Hr+1,m[dt&n]=Bn+1,o[(Bn+1)*r.width+Hr+1]=-32768)),Ee++,dt-Ee>n)throw new Error("analyseMask can not finish, the array to manage internal data is not big enough.You could improve mask by changing MAX_ARRAY")}}return new RoiMap(r,o)}class DisjointSet{constructor(){this.nodes=new Map}add(e){var t=this.nodes.get(e);return t||(t=new DisjointSetNode(e),this.nodes.set(e,t)),t}union(e,t){const n=this.find(e),o=this.find(t);n!==o&&(n.rank<o.rank?n.parent=o:n.rank>o.rank?o.parent=n:(o.parent=n,n.rank++))}find(e){for(var t=e;t.parent!==null;)t=t.parent;for(var n=e;n.parent!==null;){var o=n;n=n.parent,o.parent=t}return t}connected(e,t){return this.find(e)===this.find(t)}}var DisjointSet_1=DisjointSet;function DisjointSetNode(r){this.value=r,this.parent=null,this.rank=0}const DisjointSet$1=getDefaultExportFromCjs(DisjointSet_1),direction4X=[-1,0],direction4Y=[0,-1],neighbours4=[null,null],direction8X=[-1,-1,0,1],direction8Y=[0,-1,-1,-1],neighbours8=[null,null,null,null];function fromMaskConnectedComponentLabelingAlgorithm(r,e={}){const{allowCorners:t=!1}=e;let n=4;t&&(n=8);let o,a,l;if(n===8)o=direction8X,a=direction8Y,l=neighbours8;else if(n===4)o=direction4X,a=direction4Y,l=neighbours4;else throw new RangeError(`unsupported neighbours count: ${n}`);const s=r.size,m=r.width,y=r.height,D=new Array(s),W=new Uint32Array(s),Ee=new DisjointSet$1;let dt=1;for(let Ht=0;Ht<y;Ht++)for(let ir=0;ir<m;ir++){const Hr=ir+Ht*m;if(r.getBit(Hr)){let Bn=null;for(let Vn=0;Vn<l.length;Vn++){const Wr=ir+o[Vn],ps=Ht+a[Vn];if(Wr>=0&&ps>=0&&Wr<m&&ps<y){const il=Wr+ps*m;let gl=D[il];gl?(l[Vn]=gl,(!Bn||l[Vn].value<Bn.value)&&(Bn=l[Vn])):l[Vn]=null}}if(!Bn)D[Hr]=Ee.add(dt++);else{D[Hr]=Bn;for(let Vn=0;Vn<l.length;Vn++)l[Vn]&&l[Vn]!==Bn&&Ee.union(Bn,l[Vn])}}}for(let Ht=0;Ht<y;Ht++)for(let ir=0;ir<m;ir++){const Hr=ir+Ht*m;r.getBit(Hr)&&(W[Hr]=Ee.find(D[Hr]).value)}return new RoiMap(r,W)}function fromMaxima(r={}){let{allowCorner:e=!0,onlyTop:t=!1,invert:n=!1}=r,o=this;o.checkProcessable("fromMaxima",{components:[1]});const a=1,l=2;let s=0,m=0,y=new Int16Array(o.size),D=new Int8Array(o.size),W=new Float32Array(o.size),Ee=1048575,dt=new Uint16Array(Ee+1),Ht=new Uint16Array(Ee+1),ir=0,Hr=0,Bn=new Uint16Array(Ee+1),Vn=new Uint16Array(Ee+1),Wr=0,ps=0;for(il(o);ir<Hr;){let sl=dt[ir&Ee],ll=Ht[ir&Ee];ml(sl,ll,l),ir++}return new RoiMap(o,y);function il({maxima:sl=!0}){for(let ll=1;ll<o.height-1;ll++)for(let rl=1;rl<o.width-1;rl++){let th=rl+ll*o.width;if(D[th]===0){let nh=sl?o.data[th]:-o.data[rl+ll*o.width];if(o.data[ll*o.width+rl-1]>nh||o.data[ll*o.width+rl+1]>nh||o.data[(ll-1)*o.width+rl]>nh||o.data[(ll+1)*o.width+rl]>nh||e&&(o.data[(ll-1)*o.width+rl-1]>nh||o.data[(ll-1)*o.width+rl+1]>nh||o.data[(ll+1)*o.width+rl-1]>nh||o.data[(ll+1)*o.width+rl+1]>nh))continue;y[th]=sl?++s:--m,gl(rl,ll)||(sl?--s:++m)}}}function gl(sl,ll){let rl=Hr;Wr=0,ps=1,Bn[0]=sl,Vn[0]=ll;let th=!0;for(;Wr<ps;){let nh=Bn[Wr&Ee],bh=Vn[Wr&Ee];th&=ml(nh,bh,a),Wr++}if(!th){for(let nh=0;nh<ps;nh++){let bh=Bn[nh&Ee],Bh=Vn[nh&Ee]*o.width+bh;y[Bh]=0}Hr=rl}return th}function ml(sl,ll,rl){let th=y[ll*o.width+sl],nh=o.data[ll*o.width+sl];for(let bh=ll-1;bh<=ll+1;bh++)for(let Fh=sl-1;Fh<=sl+1;Fh++){let Bh=bh*o.width+Fh;if(D[Bh]===0)switch(D[Bh]=1,W[Bh]=o.data[Bh]-nh,rl){case a:if(W[Bh]===0){if(Fh===0||bh===0||Fh===o.width-1||bh===o.height-1)return!1;y[Bh]=th,Bn[ps&Ee]=Fh,Vn[ps&Ee]=bh,ps++}else{if(W[Bh]>0)return!1;t||(y[Bh]=th,dt[Hr&Ee]=Fh,Ht[Hr&Ee]=bh,Hr++)}break;case l:W[Bh]<=0&&(y[Bh]=th,dt[Hr&Ee]=Fh,Ht[Hr&Ee]=bh,Hr++);break;default:throw new Error("unreachable")}}return!0}}function fromPoints(r,e={}){let t=new Shape(e),n=new Int16Array(this.size),o=0,a=t.getPoints();for(let l=0;l<r.length;l++){o++;let s=r[l][0],m=r[l][1];for(let y=0;y<a.length;y++){let D=a[y][0],W=a[y][1];s+D>=0&&m+W>=0&&s+D<this.width&&m+W<this.height&&(n[s+D+(m+W)*this.width]=o)}}return new RoiMap(this,n)}function commonjsRequire(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var priorityQueue={exports:{}};(function(r,e){(function(t){r.exports=t()})(function(){return function t(n,o,a){function l(y,D){if(!o[y]){if(!n[y]){var W=typeof commonjsRequire=="function"&&commonjsRequire;if(!D&&W)return W(y,!0);if(s)return s(y,!0);var Ee=new Error("Cannot find module '"+y+"'");throw Ee.code="MODULE_NOT_FOUND",Ee}var dt=o[y]={exports:{}};n[y][0].call(dt.exports,function(Ht){var ir=n[y][1][Ht];return l(ir||Ht)},dt,dt.exports,t,n,o,a)}return o[y].exports}for(var s=typeof commonjsRequire=="function"&&commonjsRequire,m=0;m<a.length;m++)l(a[m]);return l}({1:[function(t,n,o){var a,l,s,m,y,D=function(Ee,dt){for(var Ht in dt)W.call(dt,Ht)&&(Ee[Ht]=dt[Ht]);function ir(){this.constructor=Ee}return ir.prototype=dt.prototype,Ee.prototype=new ir,Ee.__super__=dt.prototype,Ee},W={}.hasOwnProperty;a=t("./PriorityQueue/AbstractPriorityQueue"),l=t("./PriorityQueue/ArrayStrategy"),m=t("./PriorityQueue/BinaryHeapStrategy"),s=t("./PriorityQueue/BHeapStrategy"),y=function(Ee){D(dt,Ee);function dt(Ht){Ht||(Ht={}),Ht.strategy||(Ht.strategy=m),Ht.comparator||(Ht.comparator=function(ir,Hr){return(ir||0)-(Hr||0)}),dt.__super__.constructor.call(this,Ht)}return dt}(a),y.ArrayStrategy=l,y.BinaryHeapStrategy=m,y.BHeapStrategy=s,n.exports=y},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(t,n,o){n.exports=function(){function a(l){var s;if((l!=null?l.strategy:void 0)==null)throw"Must pass options.strategy, a strategy";if((l!=null?l.comparator:void 0)==null)throw"Must pass options.comparator, a comparator";this.priv=new l.strategy(l),this.length=(l!=null&&(s=l.initialValues)!=null?s.length:void 0)||0}return a.prototype.queue=function(l){this.length++,this.priv.queue(l)},a.prototype.dequeue=function(l){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},a.prototype.peek=function(l){if(!this.length)throw"Empty queue";return this.priv.peek()},a.prototype.clear=function(){return this.length=0,this.priv.clear()},a}()},{}],3:[function(t,n,o){var a;a=function(l,s,m){var y,D,W;for(D=0,y=l.length;D<y;)W=D+y>>>1,m(l[W],s)>=0?D=W+1:y=W;return D},n.exports=function(){function l(s){var m;this.options=s,this.comparator=this.options.comparator,this.data=((m=this.options.initialValues)!=null?m.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return l.prototype.queue=function(s){var m;m=a(this.data,s,this.comparator),this.data.splice(m,0,s)},l.prototype.dequeue=function(){return this.data.pop()},l.prototype.peek=function(){return this.data[this.data.length-1]},l.prototype.clear=function(){this.data.length=0},l}()},{}],4:[function(t,n,o){n.exports=function(){function a(l){var s,m,y,D,W,Ee,dt,Ht;for(this.comparator=(l!=null?l.comparator:void 0)||function(ir,Hr){return ir-Hr},this.pageSize=(l!=null?l.pageSize:void 0)||512,this.length=0,dt=0;1<<dt<this.pageSize;)dt+=1;if(1<<dt!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=dt,this._emptyMemoryPageTemplate=s=[],m=0,W=this.pageSize;0<=W?m<W:m>W;0<=W?++m:--m)s.push(null);if(this._memory=[],this._mask=this.pageSize-1,l.initialValues)for(Ee=l.initialValues,y=0,D=Ee.length;y<D;y++)Ht=Ee[y],this.queue(Ht)}return a.prototype.queue=function(l){this.length+=1,this._write(this.length,l),this._bubbleUp(this.length,l)},a.prototype.dequeue=function(){var l,s;return l=this._read(1),s=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,s),this._bubbleDown(1,s)),l},a.prototype.peek=function(){return this._read(1)},a.prototype.clear=function(){this.length=0,this._memory.length=0},a.prototype._write=function(l,s){var m;for(m=l>>this._shift;m>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[m][l&this._mask]=s},a.prototype._read=function(l){return this._memory[l>>this._shift][l&this._mask]},a.prototype._bubbleUp=function(l,s){var m,y,D,W;for(m=this.comparator;l>1&&(y=l&this._mask,l<this.pageSize||y>3?D=l&~this._mask|y>>1:y<2?(D=l-this.pageSize>>this._shift,D+=D&~(this._mask>>1),D|=this.pageSize>>1):D=l-2,W=this._read(D),!(m(W,s)<0));)this._write(D,s),this._write(l,W),l=D},a.prototype._bubbleDown=function(l,s){var m,y,D,W,Ee;for(Ee=this.comparator;l<this.length;)if(l>this._mask&&!(l&this._mask-1)?m=y=l+2:l&this.pageSize>>1?(m=(l&~this._mask)>>1,m|=l&this._mask>>1,m=m+1<<this._shift,y=m+1):(m=l+(l&this._mask),y=m+1),m!==y&&y<=this.length)if(D=this._read(m),W=this._read(y),Ee(D,s)<0&&Ee(D,W)<=0)this._write(m,s),this._write(l,D),l=m;else if(Ee(W,s)<0)this._write(y,s),this._write(l,W),l=y;else break;else if(m<=this.length)if(D=this._read(m),Ee(D,s)<0)this._write(m,s),this._write(l,D),l=m;else break;else break},a}()},{}],5:[function(t,n,o){n.exports=function(){function a(l){var s;this.comparator=(l!=null?l.comparator:void 0)||function(m,y){return m-y},this.length=0,this.data=((s=l.initialValues)!=null?s.slice(0):void 0)||[],this._heapify()}return a.prototype._heapify=function(){var l,s,m;if(this.data.length>0)for(l=s=1,m=this.data.length;1<=m?s<m:s>m;l=1<=m?++s:--s)this._bubbleUp(l)},a.prototype.queue=function(l){this.data.push(l),this._bubbleUp(this.data.length-1)},a.prototype.dequeue=function(){var l,s;return s=this.data[0],l=this.data.pop(),this.data.length>0&&(this.data[0]=l,this._bubbleDown(0)),s},a.prototype.peek=function(){return this.data[0]},a.prototype.clear=function(){this.length=0,this.data.length=0},a.prototype._bubbleUp=function(l){for(var s,m;l>0&&(s=l-1>>>1,this.comparator(this.data[l],this.data[s])<0);)m=this.data[s],this.data[s]=this.data[l],this.data[l]=m,l=s},a.prototype._bubbleDown=function(l){var s,m,y,D,W;for(s=this.data.length-1;m=(l<<1)+1,D=m+1,y=l,m<=s&&this.comparator(this.data[m],this.data[y])<0&&(y=m),D<=s&&this.comparator(this.data[D],this.data[y])<0&&(y=D),y!==l;)W=this.data[y],this.data[y]=this.data[l],this.data[l]=W,l=y},a}()},{}]},{},[1])(1)})})(priorityQueue);var priorityQueueExports=priorityQueue.exports;const PriorityQueue=getDefaultExportFromCjs(priorityQueueExports),dxs=[1,0,-1,0,1,1,-1,-1],dys=[0,1,0,-1,1,-1,1,-1];function fromWaterShed(r={}){let{points:e,mask:t,image:n,fillMaxValue:o=this.maxValue,invert:a=!1}=r,l=n||this;l.checkProcessable("fromWaterShed",{bitDepth:[8,16],components:1}),a=!a,e||(e=l.getLocalMaxima({invert:a,mask:t}));let s=a?0:1,m=new Int16Array(l.size),y=l.width,D=l.height,W=new PriorityQueue({comparator:(Ee,dt)=>Ee[2]-dt[2],strategy:PriorityQueue.BinaryHeapStrategy});for(let Ee=0;Ee<e.length;Ee++){let dt=e[Ee][0]+e[Ee][1]*y;m[dt]=Ee+1;let Ht=l.data[dt];(a&&Ht<=o||!a&&Ht>=o)&&W.queue([e[Ee][0],e[Ee][1],Ht])}for(;W.length>0;){let Ee=W.dequeue(),dt=Ee[0]+Ee[1]*y;for(let Ht=0;Ht<4;Ht++){let ir=Ee[0]+dxs[Ht],Hr=Ee[1]+dys[Ht];if(ir>=0&&Hr>=0&&ir<y&&Hr<D){let Bn=ir+Hr*y;if(!t||t.getBit(Bn)===s){let Vn=l.data[Bn];(a&&Vn<=o||!a&&Vn>=o)&&m[Bn]===0&&(m[Bn]=m[dt],W.queue([Ee[0]+dxs[Ht],Ee[1]+dys[Ht],Vn]))}}}}return new RoiMap(l,m)}class RoiManager{constructor(e,t={}){this._image=e,this._options=t,this._options.label||(this._options.label="default"),this._layers={},this._painted=null}fromMaxima(e={}){let t=Object.assign({},this._options,e),n=fromMaxima.call(this._image,e);this._layers[t.label]=new RoiLayer(n,t)}fromPoints(e,t={}){let n=Object.assign({},this._options,t),o=fromPoints.call(this._image,e,t);return this._layers[n.label]=new RoiLayer(o,n),this}putMap(e,t={}){let n=new RoiMap(this._image,e),o=Object.assign({},this._options,t);return this._layers[o.label]=new RoiLayer(n,o),this}fromWaterShed(e={}){let t=Object.assign({},this._options,e),n=fromWaterShed.call(this._image,e);this._layers[t.label]=new RoiLayer(n,t)}fromMask(e,t={}){let n=Object.assign({},this._options,t),o=fromMask.call(this._image,e,t);return this._layers[n.label]=new RoiLayer(o,n),this}fromMaskConnectedComponentLabelingAlgorithm(e,t={}){let n=Object.assign({},this._options,t),o=fromMaskConnectedComponentLabelingAlgorithm.call(this._image,e,t);return this._layers[n.label]=new RoiLayer(o,n),this}getMap(e={}){let t=Object.assign({},this._options,e);return this._assertLayerWithLabel(t.label),this._layers[t.label].roiMap}rowsInfo(e={}){return this.getMap(e).rowsInfo()}colsInfo(e={}){return this.getMap(e).rowsInfo()}getRoiIds(e={}){let t=this.getRois(e);if(t){let n=new Array(t.length);for(let o=0;o<t.length;o++)n[o]=t[o].id;return n}throw new Error("ROIs not found")}getRois(e={}){let{label:t=this._options.label,positive:n=!0,negative:o=!0,minSurface:a=0,maxSurface:l=Number.POSITIVE_INFINITY,minWidth:s=0,maxWidth:m=Number.POSITIVE_INFINITY,minHeight:y=0,maxHeight:D=Number.POSITIVE_INFINITY,minRatio:W=0,maxRatio:Ee=Number.POSITIVE_INFINITY}=e;if(!this._layers[t])throw new Error(`this Roi layer (${t}) does not exist`);const dt=this._layers[t].roi,Ht=[];for(const ir of dt)(ir.id<0&&o||ir.id>0&&n)&&ir.surface>=a&&ir.surface<=l&&ir.width>=s&&ir.width<=m&&ir.height>=y&&ir.height<=D&&ir.ratio>=W&&ir.ratio<=Ee&&Ht.push(ir);return Ht}getRoi(e,t={}){const{label:n=this._options.label}=t;if(!this._layers[n])throw new Error(`this Roi layer (${n}) does not exist`);const o=this._layers[n].roi.find(a=>a.id===e);if(!o)throw new Error(`found no Roi with id ${e}`);return o}getMasks(e={}){let t=this.getRois(e),n=new Array(t.length);for(let o=0;o<t.length;o++)n[o]=t[o].getMask(e);return n}getAnalysisMasks(e={}){const{analysisProperty:t}=e;let n=`${t}Mask`,o=this.getRois(e);return o.length===0||!o[0][n]?[]:o.map(a=>a[n])}getData(e={}){let t=Object.assign({},this._options,e);return this._assertLayerWithLabel(t.label),this._layers[t.label].roiMap.data}paint(e={}){let{labelProperty:t,analysisProperty:n}=e;this._painted||(this._painted=this._image.rgba8());let o=this.getMasks(e);if(t){const a=this.getRois(e);e.labels=a.map(y=>deepValue(y,t));const l=Math.max(...e.labels);let s=!1,m=!1;if(t.includes("surface")?s=!0:/(?:perimeter|min|max|external|width|height|length)/.test(t)&&(m=!0),isFinite(l)){let y="";if(e.unit!=="pixel"&&e.pixelSize&&(m||s)){y=s?`${e.unit}^2`:e.unit;let D=s?"m^2":"m",W=s?e.pixelSize**2:e.pixelSize;const Ee=Qty.swiftConverter(D,y);e.labels=e.labels.map(dt=>Ee(W*dt))}l>50?e.labels=e.labels.map(D=>Math.round(D)+y):l>10?e.labels=e.labels.map(D=>D.toFixed(1)+y):e.labels=e.labels.map(D=>D.toFixed(2)+y)}e.labelsPosition=a.map(y=>[y.meanX,y.meanY])}if(this._painted.paintMasks(o,e),n){let a=this.getAnalysisMasks(e);this._painted.paintMasks(a,{color:e.analysisColor,alpha:e.analysisAlpha})}return this._painted}getMask(e={}){let t=new Image$1(this._image.width,this._image.height,{kind:"BINARY"}),n=this.getMasks(e);for(let o=0;o<n.length;o++){let a=n[o];for(let l=0;l<a.width;l++)for(let s=0;s<a.height;s++)a.getBitXY(l,s)&&t.setBitXY(l+a.position[0],s+a.position[1])}return t}resetPainted(e={}){const{image:t}=e;t?this._painted=this.image.rgba8():this._painted=this._image.rgba8()}mergeRoi(e={}){const t=this.getMap(e);return t.mergeRoi(e),this.putMap(t.data,e),this}mergeRois(e,t={}){if(!Array.isArray(e)||e.some(o=>!Number.isInteger(o)))throw new Error("Roi ids must be an array of integers");if(e.length<2)throw new Error("Roi ids must have at least two elements");if(new Set(e).size!==e.length)throw new Error("Roi ids must be all different");e.forEach(o=>this.getRoi(o));const n=this.getMap(t);return n.mergeRois(e),this.putMap(n.data,t),this}findCorrespondingRoi(e,t={}){let n=this.getRois(t),o=[];for(let a=0;a<n.length;a++){let l=n[a],s=l.minX,m=l.minY,y=l.points,D=Math.sign(l.id),W=correspondingRoisInformation(s,m,y,e,D);o.push(W)}return o}_assertLayerWithLabel(e){if(!this._layers[e])throw new Error(`no layer with label ${e}`)}}function correspondingRoisInformation(r,e,t,n,o){let a={id:[],surface:[],roiSurfaceCovered:[],same:0,opposite:0,total:0};for(let l=0;l<t.length;l++){let s=t[l],m=s[0],y=s[1],D=m+r+(y+e)*n.width,W=n.data[D];(W>0||W<0)&&(a.id.includes(W)?a.surface[a.id.indexOf(W)]+=1:(a.id.push(W),a.surface.push(1)))}for(let l=0;l<a.id.length;l++)Math.sign(a.id[l])===o?a.same+=a.surface[l]:a.opposite+=a.surface[l],a.roiSurfaceCovered[l]=a.surface[l]/t.length;return a.total=a.opposite+a.same,a}const objectToString=Object.prototype.toString;let Image$1=class KC{constructor(e,t,n,o){if(arguments.length===1?(o=e,{width:e,height:t,data:n}=o):n&&!n.length&&(o=n,{data:n}=o),e===void 0&&(e=1),t===void 0&&(t=1),o===void 0&&(o={}),typeof o!="object"||o===null)throw new TypeError("options must be an object");if(!Number.isInteger(e)||e<=0)throw new RangeError("width must be a positive integer");if(!Number.isInteger(t)||t<=0)throw new RangeError("height must be a positive integer");const{kind:a=RGBA}=o;if(typeof a!="string")throw new TypeError("kind must be a string");const l=getKind(a),s=Object.assign({},o);for(const ir in l)s[ir]===void 0&&(s[ir]=l[ir]);verifyKindDefinition(s);const{components:m,bitDepth:y,colorModel:D}=s,W=s.alpha+0,Ee=e*t,dt=m+W,Ht=y===32?Number.MAX_VALUE:2**y-1;if(n===void 0)n=createPixelArray(Ee,m,W,dt,y,Ht);else{const ir=getTheoreticalPixelArraySize(Ee,dt,y);if(n.length!==ir)throw new RangeError(`incorrect data size: ${n.length}. Should be ${ir}`)}this.width=e,this.height=t,this.data=n,this.size=Ee,this.components=m,this.alpha=W,this.bitDepth=y,this.maxValue=Ht,this.colorModel=D,this.channels=dt,this.meta=o.meta||{},Object.defineProperty(this,"parent",{enumerable:!1,writable:!0,configurable:!0,value:o.parent||null}),this.position=o.position||[0,0],this.computed=null,this.sizes=[this.width,this.height],this.multiplierX=this.channels,this.multiplierY=this.channels*this.width,this.isClamped=this.bitDepth<32,this.borderSizes=[0,0]}get[Symbol.toStringTag](){return"IJSImage"}static isImage(e){return objectToString.call(e)==="[object IJSImage]"}static fromCanvas(e){const n=e.getContext("2d").getImageData(0,0,e.width,e.height);return new KC(n.width,n.height,n.data)}static createFrom(e,t){const n=getImageParameters(e);return Object.assign(n,{parent:e,position:[0,0]},t),new KC(n)}getRoiManager(e){return new RoiManager(this,e)}clone(){const e=this.data.slice();return new KC(this.width,this.height,e,this)}apply(e){for(let t=0;t<this.height;t++)for(let n=0;n<this.width;n++){let o=(t*this.width+n)*this.channels;e.call(this,o)}}};setValueMethods(Image$1);setBitMethods(Image$1);setExportMethods(Image$1);Image$1.prototype.checkProcessable=checkProcessable;Image$1.prototype.getRGBAData=getRGBAData;Image$1.load=load;Image$1.extendMethod=extendMethod;Image$1.extendProperty=extendProperty;extend$1(Image$1);var workerTemplate$1={},worker$1=function(){self.window=self;function r(){this._listeners={}}r.prototype.on=function(t,n){if(this._listeners[t])throw new RangeError("there is already a listener for "+t);if(typeof n!="function")throw new TypeError("callback argument must be a function");this._listeners[t]=n},r.prototype._send=function(t,n,o){o===void 0?o=[]:Array.isArray(o)||(o=[o]),self.postMessage({id:t,data:n},o)},r.prototype._trigger=function(t,n){if(!this._listeners[t])throw new Error("event "+t+" is not defined");this._listeners[t].apply(null,n)};var e=new r;self.onmessage=function(t){switch(t.data.action){case"exec":t.data.args.unshift(function(n,o){e._send(t.data.id,n,o)}),e._trigger(t.data.event,t.data.args);break;case"ping":e._send(t.data.id,"pong");break;default:throw new Error("unexpected action: "+t.data.action)}}},workerStr=worker$1.toString().split('"CODE";');workerTemplate$1.newWorkerURL=function r(e,t){var n=new Blob(["(",workerStr[0],"importScripts.apply(self, "+JSON.stringify(t)+`);
`,"(",e,")();",workerStr[1],")();"],{type:"application/javascript"});return URL.createObjectURL(n)};var workerTemplate=workerTemplate$1,CORES=navigator.hardwareConcurrency||1;function WorkerManager(r,e){if(typeof r!="string"&&typeof r!="function")throw new TypeError("func argument must be a function");if(e===void 0&&(e={}),typeof e!="object"||e===null)throw new TypeError("options argument must be an object");this._workerCode=r.toString(),e.maxWorkers===void 0||e.maxWorkers==="auto"?this._numWorkers=Math.min(CORES-1,1):e.maxWorkers>0?this._numWorkers=Math.min(e.maxWorkers,CORES):this._numWorkers=CORES,this._workers=new Map,this._timeout=e.timeout||0,this._terminateOnError=!!e.terminateOnError;var t=e.deps;typeof t=="string"&&(t=[t]),Array.isArray(t)||(t=void 0),this._id=0,this._terminated=!1,this._working=0,this._waiting=[],this._init(t)}WorkerManager.prototype._init=function(r){for(var e=workerTemplate.newWorkerURL(this._workerCode,r),t=0;t<this._numWorkers;t++){var n=new Worker(e);n.onmessage=this._onmessage.bind(this,n),n.onerror=this._onerror.bind(this,n),n.running=!1,n.id=t,this._workers.set(n,null)}URL.revokeObjectURL(e)};WorkerManager.prototype._onerror=function(r,e){if(!this._terminated){this._working--,r.running=!1;var t=this._workers.get(r);t&&t[1](e.message),this._workers.set(r,null),this._terminateOnError?this.terminate():this._exec()}};WorkerManager.prototype._onmessage=function(r,e){if(!this._terminated){this._working--,r.running=!1;var t=this._workers.get(r);t&&t[0](e.data.data),this._workers.set(r,null),this._exec()}};WorkerManager.prototype._exec=function(){for(var r of this._workers.keys()){if(this._working===this._numWorkers||this._waiting.length===0)return;if(!r.running)for(var e=0;e<this._waiting.length;e++){var t=this._waiting[e];if(!(typeof t[4]=="number"&&t[4]!==r.id)){this._waiting.splice(e,1),r.postMessage({action:"exec",event:t[0],args:t[1]},t[2]),r.running=!0,r.time=Date.now(),this._workers.set(r,t[3]),this._working++;break}}}};WorkerManager.prototype.terminate=function(){if(!this._terminated){for(var r of this._workers)r[0].terminate(),r[1]&&r[1][1](new Error("Terminated"));this._workers.clear(),this._waiting=[],this._working=0,this._terminated=!0}};WorkerManager.prototype.postAll=function(r,e){if(this._terminated)throw new Error("Cannot post (terminated)");var t=[];for(var n of this._workers.keys())t.push(this.post(r,e,[],n.id));return Promise.all(t)};WorkerManager.prototype.post=function(r,e,t,n){e===void 0&&(e=[]),t===void 0&&(t=[]),Array.isArray(e)||(e=[e]),Array.isArray(t)||(t=[t]);var o=this;return new Promise(function(a,l){if(o._terminated)throw new Error("Cannot post (terminated)");o._waiting.push([r,e,t,[a,l],n]),o._exec()})};var src=WorkerManager;const WorkerManager$1=getDefaultExportFromCjs(src),defaultOptions={regression:{kernelType:"polynomial",kernelOptions:{degree:2,constant:1}},threshold:.02,roi:{minSurface:100,positive:!1},sampling:20,include:[]};function run(r,e,t){e=Object.assign({},defaultOptions,e);const n=this.manager;return Array.isArray(r)?Promise.all(r.map(function(o){const a=runOnce(n,o,e);return typeof t=="function"&&a.then(t),a})):runOnce(n,r,e)}function runOnce(r,e,t){return r.post("data",[e,t]).then(function(n){for(let o in n)n[o]=new Image$1(n[o]);return n})}function work(){worker.on("data",function(r,e,t){e=new IJS(e);const n={},o=[],a=e.grey(),l=a.sobelFilter();dt("sobel",l);const s=l.level().mask({threshold:t.threshold});dt("mask",s);const m=l.getRoiManager();m.fromMask(s);const y=m.getMask(t.roi);dt("realMask",y);const D=a.getPixelsGrid({sampling:t.sampling,mask:y}),W=e.getBackground(D.xyS,D.zS,t.regression);dt("background",W);const Ee=e.subtract(W);n.result=Ee,o.push(Ee.data.buffer),r(n,o);function dt(Ht,ir){t.include.includes(Ht)&&(n[Ht]=ir,o.push(ir.data.buffer))}})}const background={run,work};function extend(r){r.extendMethod("background",background)}let Worker$1=class eT{constructor(){this._url=null,this._deps=[null]}checkUrl(){if(this._url===null)throw new Error("image worker must be initialized with an URL")}get url(){return this._url}set url(e){if(typeof e!="string")throw new TypeError("worker URL must be a string");this._url=e,this._deps[0]=e}static extendMethod(e,t){let n,o,a={};function l(...s){return n||(this.checkUrl(),o=this.url,n=new WorkerManager$1(t.work,{deps:o}),a.manager=n),t.run.call(a,...s)}l.reset=function(){n&&(n.terminate(),n=new WorkerManager$1(t.work,{deps:o}),a.manager=n)},eT.prototype[e]=l}};extend(Worker$1);await __vitePreload(()=>import("https://cdn.jsdelivr.net/npm/gdal3.js@2.4.0/dist/package/gdal3.js"),[]);let Gdal=await initGdalJs({path:"https://cdn.jsdelivr.net/npm/gdal3.js@2.4.0/dist/package",useWorker:!1});async function manipulateImage(r,e,t,n,o,a,l){let s="32767",m="65535",y="0",D="bilinear",W=[],Ee,dt=await Image$1.load(r);return n===!0&&(dt=await dt.flipX()),o===!0&&(dt=await dt.flipY()),e>0&&(dt=await dt.blurFilter(e)),Ee=await dt.toBuffer(),a!=="0"&&a!=="1081"?l===!0&&(t===!0?W=["-ot","UInt16","-of","PNG","-scale",y,m,s,m,"-outsize",a,a,"-r",D]:W=["-ot","UInt16","-of","PNG","-outsize",a,a,"-r",D],Ee=await processGdal(Ee,"heightmap.png",W,"png")):t===!0&&(W=["-ot","UInt16","-of","PNG","-scale",y,m,s,m,"-r",D],Ee=await processGdal(Ee,"heightmap.png",W,"png")),Ee}async function loadImageFromArray(r,e={}){try{return await Image$1.load(r,e)}catch(t){console.log(t)}}function convertImage(r,e,t,n,o){return new Image$1(r,e,t,{kind:o,bitDepth:n})}async function processGdal(r,e,t,n){let o=new Blob([r],{type:"image/"+n});const a=new File([o],e),s=(await Gdal.open(a)).datasets[0];console.log("gdal translate");const m=await Gdal.gdal_translate(s,t),y=await Gdal.getFileBytes(m);return Gdal.close(s),y}const imageUtils={manipulateImage,loadImageFromArray,convertImage};var tilesInBbox={};function lonToX(r,e){var t=Math.pow(2,e),n=Math.floor((r+180)/360*t);return n}function latToY(r,e){var t=r*Math.PI/180,n=Math.pow(2,e),o=Math.floor((1-Math.log(Math.tan(t)+1/Math.cos(t))/Math.PI)/2*n);return o}tilesInBbox.tilesInBbox=function(r,e){for(var t=[],n=lonToX(r.left,e),o=lonToX(r.right,e),a=latToY(r.top,e),l=latToY(r.bottom,e),s=n;s<=o;){for(var m=a;m<=l;)t.push({x:s,y:m,z:e}),m++;s++}return t};var vectorTile={},pointGeometry=Point$1;function Point$1(r,e){this.x=r,this.y=e}Point$1.prototype={clone:function(){return new Point$1(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,e){return this.clone()._rotateAround(r,e)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var e=r.x-this.x,t=r.y-this.y;return e*e+t*t},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult:function(r){var e=r[0]*this.x+r[1]*this.y,t=r[2]*this.x+r[3]*this.y;return this.x=e,this.y=t,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var e=Math.cos(r),t=Math.sin(r),n=e*this.x-t*this.y,o=t*this.x+e*this.y;return this.x=n,this.y=o,this},_rotateAround:function(r,e){var t=Math.cos(r),n=Math.sin(r),o=e.x+t*(this.x-e.x)-n*(this.y-e.y),a=e.y+n*(this.x-e.x)+t*(this.y-e.y);return this.x=o,this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}};Point$1.convert=function(r){return r instanceof Point$1?r:Array.isArray(r)?new Point$1(r[0],r[1]):r};var Point=pointGeometry,vectortilefeature=VectorTileFeature$1;function VectorTileFeature$1(r,e,t,n,o){this.properties={},this.extent=t,this.type=0,this._pbf=r,this._geometry=-1,this._keys=n,this._values=o,r.readFields(readFeature,this,e)}function readFeature(r,e,t){r==1?e.id=t.readVarint():r==2?readTag(t,e):r==3?e.type=t.readVarint():r==4&&(e._geometry=t.pos)}function readTag(r,e){for(var t=r.readVarint()+r.pos;r.pos<t;){var n=e._keys[r.readVarint()],o=e._values[r.readVarint()];e.properties[n]=o}}VectorTileFeature$1.types=["Unknown","Point","LineString","Polygon"];VectorTileFeature$1.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,t=1,n=0,o=0,a=0,l=[],s;r.pos<e;){if(n<=0){var m=r.readVarint();t=m&7,n=m>>3}if(n--,t===1||t===2)o+=r.readSVarint(),a+=r.readSVarint(),t===1&&(s&&l.push(s),s=[]),s.push(new Point(o,a));else if(t===7)s&&s.push(s[0].clone());else throw new Error("unknown command "+t)}return s&&l.push(s),l};VectorTileFeature$1.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,t=1,n=0,o=0,a=0,l=1/0,s=-1/0,m=1/0,y=-1/0;r.pos<e;){if(n<=0){var D=r.readVarint();t=D&7,n=D>>3}if(n--,t===1||t===2)o+=r.readSVarint(),a+=r.readSVarint(),o<l&&(l=o),o>s&&(s=o),a<m&&(m=a),a>y&&(y=a);else if(t!==7)throw new Error("unknown command "+t)}return[l,m,s,y]};VectorTileFeature$1.prototype.toGeoJSON=function(r,e,t){var n=this.extent*Math.pow(2,t),o=this.extent*r,a=this.extent*e,l=this.loadGeometry(),s=VectorTileFeature$1.types[this.type],m,y;function D(dt){for(var Ht=0;Ht<dt.length;Ht++){var ir=dt[Ht],Hr=180-(ir.y+a)*360/n;dt[Ht]=[(ir.x+o)*360/n-180,360/Math.PI*Math.atan(Math.exp(Hr*Math.PI/180))-90]}}switch(this.type){case 1:var W=[];for(m=0;m<l.length;m++)W[m]=l[m][0];l=W,D(l);break;case 2:for(m=0;m<l.length;m++)D(l[m]);break;case 3:for(l=classifyRings(l),m=0;m<l.length;m++)for(y=0;y<l[m].length;y++)D(l[m][y]);break}l.length===1?l=l[0]:s="Multi"+s;var Ee={type:"Feature",geometry:{type:s,coordinates:l},properties:this.properties};return"id"in this&&(Ee.id=this.id),Ee};function classifyRings(r){var e=r.length;if(e<=1)return[r];for(var t=[],n,o,a=0;a<e;a++){var l=signedArea(r[a]);l!==0&&(o===void 0&&(o=l<0),o===l<0?(n&&t.push(n),n=[r[a]]):n.push(r[a]))}return n&&t.push(n),t}function signedArea(r){for(var e=0,t=0,n=r.length,o=n-1,a,l;t<n;o=t++)a=r[t],l=r[o],e+=(l.x-a.x)*(a.y+l.y);return e}var VectorTileFeature=vectortilefeature,vectortilelayer=VectorTileLayer$1;function VectorTileLayer$1(r,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(readLayer,this,e),this.length=this._features.length}function readLayer(r,e,t){r===15?e.version=t.readVarint():r===1?e.name=t.readString():r===5?e.extent=t.readVarint():r===2?e._features.push(t.pos):r===3?e._keys.push(t.readString()):r===4&&e._values.push(readValueMessage(t))}function readValueMessage(r){for(var e=null,t=r.readVarint()+r.pos;r.pos<t;){var n=r.readVarint()>>3;e=n===1?r.readString():n===2?r.readFloat():n===3?r.readDouble():n===4?r.readVarint64():n===5?r.readVarint():n===6?r.readSVarint():n===7?r.readBoolean():null}return e}VectorTileLayer$1.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var e=this._pbf.readVarint()+this._pbf.pos;return new VectorTileFeature(this._pbf,e,this.extent,this._keys,this._values)};var VectorTileLayer=vectortilelayer,vectortile=VectorTile;function VectorTile(r,e){this.layers=r.readFields(readTile,{},e)}function readTile(r,e,t){if(r===3){var n=new VectorTileLayer(t,t.readVarint()+t.pos);n.length&&(e[n.name]=n)}}vectorTile.VectorTile=vectortile;vectorTile.VectorTileFeature=vectortilefeature;vectorTile.VectorTileLayer=vectortilelayer;var ieee754$1={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ieee754$1.read=function(r,e,t,n,o){var a,l,s=o*8-n-1,m=(1<<s)-1,y=m>>1,D=-7,W=t?o-1:0,Ee=t?-1:1,dt=r[e+W];for(W+=Ee,a=dt&(1<<-D)-1,dt>>=-D,D+=s;D>0;a=a*256+r[e+W],W+=Ee,D-=8);for(l=a&(1<<-D)-1,a>>=-D,D+=n;D>0;l=l*256+r[e+W],W+=Ee,D-=8);if(a===0)a=1-y;else{if(a===m)return l?NaN:(dt?-1:1)*(1/0);l=l+Math.pow(2,n),a=a-y}return(dt?-1:1)*l*Math.pow(2,a-n)};ieee754$1.write=function(r,e,t,n,o,a){var l,s,m,y=a*8-o-1,D=(1<<y)-1,W=D>>1,Ee=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,dt=n?0:a-1,Ht=n?1:-1,ir=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,l=D):(l=Math.floor(Math.log(e)/Math.LN2),e*(m=Math.pow(2,-l))<1&&(l--,m*=2),l+W>=1?e+=Ee/m:e+=Ee*Math.pow(2,1-W),e*m>=2&&(l++,m/=2),l+W>=D?(s=0,l=D):l+W>=1?(s=(e*m-1)*Math.pow(2,o),l=l+W):(s=e*Math.pow(2,W-1)*Math.pow(2,o),l=0));o>=8;r[t+dt]=s&255,dt+=Ht,s/=256,o-=8);for(l=l<<o|s,y+=o;y>0;r[t+dt]=l&255,dt+=Ht,l/=256,y-=8);r[t+dt-Ht]|=ir*128};var pbf=Pbf,ieee754=ieee754$1;function Pbf(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}Pbf.Varint=0;Pbf.Fixed64=1;Pbf.Bytes=2;Pbf.Fixed32=5;var SHIFT_LEFT_32=65536*65536,SHIFT_RIGHT_32=1/SHIFT_LEFT_32,TEXT_DECODER_MIN_LENGTH=12,utf8TextDecoder=typeof TextDecoder>"u"?null:new TextDecoder("utf8");Pbf.prototype={destroy:function(){this.buf=null},readFields:function(r,e,t){for(t=t||this.length;this.pos<t;){var n=this.readVarint(),o=n>>3,a=this.pos;this.type=n&7,r(o,e,this),this.pos===a&&this.skip(n)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=readUInt32(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=readInt32(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=readUInt32(this.buf,this.pos)+readUInt32(this.buf,this.pos+4)*SHIFT_LEFT_32;return this.pos+=8,r},readSFixed64:function(){var r=readUInt32(this.buf,this.pos)+readInt32(this.buf,this.pos+4)*SHIFT_LEFT_32;return this.pos+=8,r},readFloat:function(){var r=ieee754.read(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=ieee754.read(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e=this.buf,t,n;return n=e[this.pos++],t=n&127,n<128||(n=e[this.pos++],t|=(n&127)<<7,n<128)||(n=e[this.pos++],t|=(n&127)<<14,n<128)||(n=e[this.pos++],t|=(n&127)<<21,n<128)?t:(n=e[this.pos],t|=(n&15)<<28,readVarintRemainder(t,r,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2===1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=TEXT_DECODER_MIN_LENGTH&&utf8TextDecoder?readUtf8TextDecoder(this.buf,e,r):readUtf8(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==Pbf.Bytes)return r.push(this.readVarint(e));var t=readPackedEnd(this);for(r=r||[];this.pos<t;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==Pbf.Bytes)return r.push(this.readSVarint());var e=readPackedEnd(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==Pbf.Bytes)return r.push(this.readBoolean());var e=readPackedEnd(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==Pbf.Bytes)return r.push(this.readFloat());var e=readPackedEnd(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==Pbf.Bytes)return r.push(this.readDouble());var e=readPackedEnd(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==Pbf.Bytes)return r.push(this.readFixed32());var e=readPackedEnd(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==Pbf.Bytes)return r.push(this.readSFixed32());var e=readPackedEnd(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==Pbf.Bytes)return r.push(this.readFixed64());var e=readPackedEnd(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==Pbf.Bytes)return r.push(this.readSFixed64());var e=readPackedEnd(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=r&7;if(e===Pbf.Varint)for(;this.buf[this.pos++]>127;);else if(e===Pbf.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Pbf.Fixed32)this.pos+=4;else if(e===Pbf.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),writeInt32(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),writeInt32(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),writeInt32(this.buf,r&-1,this.pos),writeInt32(this.buf,Math.floor(r*SHIFT_RIGHT_32),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),writeInt32(this.buf,r&-1,this.pos),writeInt32(this.buf,Math.floor(r*SHIFT_RIGHT_32),this.pos+4),this.pos+=8},writeVarint:function(r){if(r=+r||0,r>268435455||r<0){writeBigVarint(r,this);return}this.realloc(4),this.buf[this.pos++]=r&127|(r>127?128:0),!(r<=127)&&(this.buf[this.pos++]=(r>>>=7)&127|(r>127?128:0),!(r<=127)&&(this.buf[this.pos++]=(r>>>=7)&127|(r>127?128:0),!(r<=127)&&(this.buf[this.pos++]=r>>>7&127)))},writeSVarint:function(r){this.writeVarint(r<0?-r*2-1:r*2)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(r.length*4),this.pos++;var e=this.pos;this.pos=writeUtf8(this.buf,r,this.pos);var t=this.pos-e;t>=128&&makeRoomForExtraLength(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t},writeFloat:function(r){this.realloc(4),ieee754.write(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),ieee754.write(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var t=0;t<e;t++)this.buf[this.pos++]=r[t]},writeRawMessage:function(r,e){this.pos++;var t=this.pos;r(e,this);var n=this.pos-t;n>=128&&makeRoomForExtraLength(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeMessage:function(r,e,t){this.writeTag(r,Pbf.Bytes),this.writeRawMessage(e,t)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,writePackedVarint,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,writePackedSVarint,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,writePackedBoolean,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,writePackedFloat,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,writePackedDouble,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,writePackedFixed32,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,writePackedSFixed32,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,writePackedFixed64,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,writePackedSFixed64,e)},writeBytesField:function(r,e){this.writeTag(r,Pbf.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,Pbf.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,Pbf.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,Pbf.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,Pbf.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,Pbf.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,Pbf.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,Pbf.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,Pbf.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,Pbf.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,!!e)}};function readVarintRemainder(r,e,t){var n=t.buf,o,a;if(a=n[t.pos++],o=(a&112)>>4,a<128||(a=n[t.pos++],o|=(a&127)<<3,a<128)||(a=n[t.pos++],o|=(a&127)<<10,a<128)||(a=n[t.pos++],o|=(a&127)<<17,a<128)||(a=n[t.pos++],o|=(a&127)<<24,a<128)||(a=n[t.pos++],o|=(a&1)<<31,a<128))return toNum(r,o,e);throw new Error("Expected varint not more than 10 bytes")}function readPackedEnd(r){return r.type===Pbf.Bytes?r.readVarint()+r.pos:r.pos+1}function toNum(r,e,t){return t?e*4294967296+(r>>>0):(e>>>0)*4294967296+(r>>>0)}function writeBigVarint(r,e){var t,n;if(r>=0?(t=r%4294967296|0,n=r/4294967296|0):(t=~(-r%4294967296),n=~(-r/4294967296),t^4294967295?t=t+1|0:(t=0,n=n+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),writeBigVarintLow(t,n,e),writeBigVarintHigh(n,e)}function writeBigVarintLow(r,e,t){t.buf[t.pos++]=r&127|128,r>>>=7,t.buf[t.pos++]=r&127|128,r>>>=7,t.buf[t.pos++]=r&127|128,r>>>=7,t.buf[t.pos++]=r&127|128,r>>>=7,t.buf[t.pos]=r&127}function writeBigVarintHigh(r,e){var t=(r&7)<<4;e.buf[e.pos++]|=t|((r>>>=3)?128:0),r&&(e.buf[e.pos++]=r&127|((r>>>=7)?128:0),r&&(e.buf[e.pos++]=r&127|((r>>>=7)?128:0),r&&(e.buf[e.pos++]=r&127|((r>>>=7)?128:0),r&&(e.buf[e.pos++]=r&127|((r>>>=7)?128:0),r&&(e.buf[e.pos++]=r&127)))))}function makeRoomForExtraLength(r,e,t){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));t.realloc(n);for(var o=t.pos-1;o>=r;o--)t.buf[o+n]=t.buf[o]}function writePackedVarint(r,e){for(var t=0;t<r.length;t++)e.writeVarint(r[t])}function writePackedSVarint(r,e){for(var t=0;t<r.length;t++)e.writeSVarint(r[t])}function writePackedFloat(r,e){for(var t=0;t<r.length;t++)e.writeFloat(r[t])}function writePackedDouble(r,e){for(var t=0;t<r.length;t++)e.writeDouble(r[t])}function writePackedBoolean(r,e){for(var t=0;t<r.length;t++)e.writeBoolean(r[t])}function writePackedFixed32(r,e){for(var t=0;t<r.length;t++)e.writeFixed32(r[t])}function writePackedSFixed32(r,e){for(var t=0;t<r.length;t++)e.writeSFixed32(r[t])}function writePackedFixed64(r,e){for(var t=0;t<r.length;t++)e.writeFixed64(r[t])}function writePackedSFixed64(r,e){for(var t=0;t<r.length;t++)e.writeSFixed64(r[t])}function readUInt32(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+r[e+3]*16777216}function writeInt32(r,e,t){r[t]=e,r[t+1]=e>>>8,r[t+2]=e>>>16,r[t+3]=e>>>24}function readInt32(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}function readUtf8(r,e,t){for(var n="",o=e;o<t;){var a=r[o],l=null,s=a>239?4:a>223?3:a>191?2:1;if(o+s>t)break;var m,y,D;s===1?a<128&&(l=a):s===2?(m=r[o+1],(m&192)===128&&(l=(a&31)<<6|m&63,l<=127&&(l=null))):s===3?(m=r[o+1],y=r[o+2],(m&192)===128&&(y&192)===128&&(l=(a&15)<<12|(m&63)<<6|y&63,(l<=2047||l>=55296&&l<=57343)&&(l=null))):s===4&&(m=r[o+1],y=r[o+2],D=r[o+3],(m&192)===128&&(y&192)===128&&(D&192)===128&&(l=(a&15)<<18|(m&63)<<12|(y&63)<<6|D&63,(l<=65535||l>=1114112)&&(l=null))),l===null?(l=65533,s=1):l>65535&&(l-=65536,n+=String.fromCharCode(l>>>10&1023|55296),l=56320|l&1023),n+=String.fromCharCode(l),o+=s}return n}function readUtf8TextDecoder(r,e,t){return utf8TextDecoder.decode(r.subarray(e,t))}function writeUtf8(r,e,t){for(var n=0,o,a;n<e.length;n++){if(o=e.charCodeAt(n),o>55295&&o<57344)if(a)if(o<56320){r[t++]=239,r[t++]=191,r[t++]=189,a=o;continue}else o=a-55296<<10|o-56320|65536,a=null;else{o>56319||n+1===e.length?(r[t++]=239,r[t++]=191,r[t++]=189):a=o;continue}else a&&(r[t++]=239,r[t++]=191,r[t++]=189,a=null);o<128?r[t++]=o:(o<2048?r[t++]=o>>6|192:(o<65536?r[t++]=o>>12|224:(r[t++]=o>>18|240,r[t++]=o>>12&63|128),r[t++]=o>>6&63|128),r[t++]=o&63|128)}return t}const Protobuf=getDefaultExportFromCjs(pbf);let vectTile=await vectorTile.VectorTile,cache$1;caches.open("tiles").then(r=>cache$1=r);function getTileInfo(r,e,t,n,o,a,l){}function getFeaturesFromBB(r,e,t){const n=new mapboxgl.LngLatBounds(e);let o=n.getSouthWest(),a=n.getNorthEast(),l=r.project(o),s=r.project(a),m=r.queryRenderedFeatures([l,s]);return t===!0&&(m=getUniqueFeatures(m)),m}function getUniqueFeatures(r){const e=new Set,t=[];for(const n of r){const o=n.properties.name,a=n.geometry.type;let l=o+"-"+a;e.has(l)||(e.add(l),t.push(n))}return t}async function unrealRemoteControl(r,e){let t,n={},o="";const a={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)};try{t=await fetch(e,a)}catch(l){o=l}return n.response=t,n.error=o,n}async function downloadToTile(r,e,t=0,n=0,o=!1){let a={},l;const s=await caches.match(e);if(s&&s.ok){console.log("tile: load from cache");let m=await s.arrayBuffer();return r===!0?(l=await imageUtils.loadImageFromArray(m),l):(o===!0?a.buffer=new Uint8Array(m):a.buffer=m,a.x=t,a.y=n,a)}else{console.log("tile: load by fetch, cache downloaded file");try{const m=await fetch(e);if(m.ok){let y=m.clone(),D=await m.arrayBuffer();return cache$1.put(e,y),r===!0?(l=await imageUtils.loadImageFromArray(D),l):(o===!0?a.buffer=new Uint8Array(D):a.buffer=D,a.x=t,a.y=n,a)}else throw new Error("download tileerror:",m.status)}catch(m){console.log(m.message)}}}function toWatermap(r,e){let t=r.length,n=document.getElementById("wMap-canvas");const o=n.getContext("2d",{willReadFrequently:!0});n.width=e,n.height=e;let a=e/(t*4096);o.fillStyle="#FFFFFF",o.fillRect(0,0,e,e),o.fillStyle="#000000",o.beginPath(),console.log(r);for(let m=0;m<t;m++)for(let y=0;y<t;y++)if(typeof r[m][y]!="boolean"&&r[m][y].layers.water){let D=r[m][y].layers.water.feature(0).loadGeometry();for(let W=0;W<D.length;W++){o.moveTo(Math.round(D[W][0].x*a+y*e/t),Math.round(D[W][0].y*a+m*e/t));for(let Ee=1;Ee<D[W].length;Ee++)o.lineTo(Math.round(D[W][Ee].x*a+y*e/t),Math.round(D[W][Ee].y*a+m*e/t))}}if(o.closePath(),o.fill(),document.getElementById("drawStrm").checked){o.strokeStyle="#000000",o.lineWidth=1,o.beginPath();for(let m=0;m<t;m++)for(let y=0;y<t;y++)if(typeof r[m][y]!="boolean"&&r[m][y].layers.waterway){let D=r[m][y].layers.waterway.feature(0).loadGeometry();for(let W=0;W<D.length;W++){o.moveTo(Math.round(D[W][0].x*a+y*e/t),Math.round(D[W][0].y*a+m*e/t));for(let Ee=1;Ee<D[W].length;Ee++)o.lineTo(Math.round(D[W][Ee].x*a+y*e/t),Math.round(D[W][Ee].y*a+m*e/t))}}o.stroke()}let l=Create2DArray(e,1),s=o.getImageData(0,0,e,e);for(let m=0;m<e;m++)for(let y=0;y<e;y++){let D=m*e*4+y*4;l[m][y]=s.data[D]/255}return l}function sanatizeMap(r,e,t){let o=Create2DArray(1081,0),a=1e5;for(let l=t;l<t+1081;l++)for(let s=e;s<e+1081;s++){let m=r[l][s];m>=0&&m<a&&(a=m),o[l-t][s-e]=m}for(let l=0;l<1081;l++)for(let s=0;s<1081;s++)o[l][s]<0&&(o[l][s]=a);return o}function sanatizeWatermap(r,e,t){let o=Create2DArray(1081,0);for(let a=t;a<t+1081;a++)for(let l=e;l<t+1081;l++){let s=r[a][l];o[a-t][l-e]=s}return o}async function downloadPbfToTile(r){const e=await caches.match(r);if(e&&e.ok){console.log("pbf: load from cache");let t=await e.arrayBuffer();return new vectTile(new Protobuf(new Uint8Array(t)))}else{console.log("pbf: load by fetch, cache downloaded file");try{const t=await fetch(r);if(t.ok){let n=t.clone(),o=await t.arrayBuffer(),a=new vectTile(new Protobuf(new Uint8Array(o)));return cache$1.put(r,n),a}else throw new Error("download Pbf error:",t.status)}catch(t){return console.log(t.message),!0}}}function long2tile(r,e){return Math.floor((r+180)/360*Math.pow(2,e))}function lat2tile(r,e){return Math.floor((1-Math.log(Math.tan(r*Math.PI/180)+1/Math.cos(r*Math.PI/180))/Math.PI)/2*Math.pow(2,e))}function tile2long(r,e){return r/Math.pow(2,e)*360-180}function tile2lat(r,e){let t=Math.PI-2*Math.PI*r/Math.pow(2,e);return 180/Math.PI*Math.atan(.5*(Math.exp(t)-Math.exp(-t)))}function toHeightmap(r,e,t){let n=r.length,o=Create2DArray(n*512,0),a=Create2DArray(Math.ceil(1080*(e/t)),0),l=o.length,s=a.length,m=(s-1)/(l-1);for(let D=0;D<n;D++)for(let W=0;W<n;W++){let Ee=r[D][W].getRGBAData();for(let dt=0;dt<512;dt++)for(let Ht=0;Ht<512;Ht++){let ir=dt*512*4+Ht*4;o[D*512+dt][W*512+Ht]=-1e5+(Ee[ir]*256*256+Ee[ir+1]*256+Ee[ir+2])}}let y=Array(s);for(let D=0;D<s;D++)y[D]=D/m;for(let D=0;D<s-1;D++)for(let W=0;W<s-1;W++){let Ee=Math.floor(y[D]),dt=Math.floor(y[W]),Ht=Ee+1,ir=dt+1,Hr=y[D]-Ee,Bn=y[W]-dt;a[D][W]=Math.round((1-Bn)*(1-Hr)*o[Ee][dt]+Bn*(1-Hr)*o[Ee][ir]+(1-Bn)*Hr*o[Ht][dt]+Bn*Hr*o[Ht][ir])}for(let D=0;D<s;D++)a[D][s-1]=o[D][s-1];for(let D=0;D<s;D++)a[s-1][D]=o[s-1][D];return a}function calcMinMaxHeight(r){const e=r.length,t=r[0].length,n={min:1e5,max:-1e5};for(let o=0;o<e;o++)for(let a=0;a<t;a++){let l=r[o][a];l>n.max&&(n.max=l),l<n.min&&(n.min=l)}return n.min=n.min/10,n.max=n.max/10,n}function getTileCount(r,e){let t={bottom:e.bottomright[1],left:e.topleft[0],top:e.topleft[1],right:e.bottomright[0]};return tilesInBbox.tilesInBbox(t,r)}function getTileCountAdjusted(r,e,t=!1){let n={},o=long2tile(e.topleft[0],r),a=lat2tile(e.topleft[1],r),l=long2tile(e.bottomright[0],r),s=lat2tile(e.bottomright[1],r),m=Math.max(l-o+1,s-a+1);if(t===!1&&m>6){let y=r,D,W,Ee,dt,Ht;do y--,D=long2tile(e.topleft[0],y),W=lat2tile(e.topleft[1],y),Ee=long2tile(e.bottomright[0],y),dt=lat2tile(e.bottomright[1],y),Ht=Math.max(Ee-D+1,dt-W+1);while(Ht>6);o=D,a=W,r=y,m=Ht}return n.tileCnt=m,n.zoom=r,n.x=o,n.y=a,n}function deleteCaches(){confirm(`Delete the caches.
Is that okay?`)&&caches.delete("tiles").then(()=>{caches.open("tiles").then(r=>cache$1=r)})}function convertMapboxMaptilerStyles(r,e){return[{mapbox:"streets-v11",maptiler:"STREETS",maptiler_map:"streets-v2",diff:!1},{mapbox:"dark-v10",maptiler:"STREETS.DARK",maptilerAltName:"Streets v2 Dark",maptiler_map:"streets-v2",diff:!1},{mapbox:"light-v10",maptiler:"STREETS.LIGHT",maptilerAltName:"Streets v2 Light",maptiler_map:"streets-v2",diff:!1},{mapbox:"outdoors-v11",maptiler:"OUTDOOR",maptiler_map:"outdoor-v2",diff:!1},{mapbox:"satellite-v9",maptiler:"SATELLITE",maptiler_map:"satellite",diff:!0},{mapbox:"weightmap"}].filter(o=>o[r]===e)}function Create2DArray(r,e=null){let t=new Array(r);for(let n=0;n<r;n++)t[n]=new Array(r).fill(e);return t}const mapUtils={getTileInfo,getFeaturesFromBB,unrealRemoteControl,downloadToTile,tile2lat,tile2long,lat2tile,long2tile,toHeightmap,calcMinMaxHeight,getTileCount,getTileCountAdjusted,deleteCaches,convertMapboxMaptilerStyles,Create2DArray,downloadPbfToTile,toWatermap,sanatizeMap,sanatizeWatermap};var clearIntervalAsync$1={},setIntervalAsyncTimer={};Object.defineProperty(setIntervalAsyncTimer,"__esModule",{value:!0});setIntervalAsyncTimer.SetIntervalAsyncTimer=void 0;const MIN_INTERVAL_MS=10,MAX_INTERVAL_MS=2147483647;var r1,vw,Ub,$b,$E,ZC,tT;const HE=class HE{constructor(){H1(this,$b);H1(this,ZC);H1(this,r1,void 0);H1(this,vw,void 0);H1(this,Ub,!1)}static startTimer(e,t,n,...o){var l;n=Math.min(Math.max(Math.trunc(n),MIN_INTERVAL_MS),MAX_INTERVAL_MS);const a=new HE;return WC(l=a,$b,$E).call(l,e,t,n,n,...o),a}static async stopTimer(e){j1(e,Ub,!0),i1(e,r1)&&clearTimeout(i1(e,r1)),i1(e,vw)&&await i1(e,vw)}};r1=new WeakMap,vw=new WeakMap,Ub=new WeakMap,$b=new WeakSet,$E=function(e,t,n,o,...a){j1(this,r1,setTimeout(async()=>{j1(this,r1,void 0),j1(this,vw,WC(this,ZC,tT).call(this,e,t,n,...a)),await i1(this,vw),j1(this,vw,void 0)},o))},ZC=new WeakSet,tT=async function(e,t,n,...o){const a=new Date().getTime();try{await t(...o)}finally{if(!i1(this,Ub)){const l=new Date().getTime()-a,s=e==="dynamic"?n>l?n-l:0:n;WC(this,$b,$E).call(this,e,t,n,s,...o)}}};let SetIntervalAsyncTimer=HE;setIntervalAsyncTimer.SetIntervalAsyncTimer=SetIntervalAsyncTimer;Object.defineProperty(clearIntervalAsync$1,"__esModule",{value:!0});var clearIntervalAsync_2=clearIntervalAsync$1.clearIntervalAsync=void 0;const set_interval_async_timer_cjs_1=setIntervalAsyncTimer;async function clearIntervalAsync(r){if(!(r instanceof set_interval_async_timer_cjs_1.SetIntervalAsyncTimer))throw new TypeError("First argument is not an instance of SetIntervalAsyncTimer");await set_interval_async_timer_cjs_1.SetIntervalAsyncTimer.stopTimer(r)}clearIntervalAsync_2=clearIntervalAsync$1.clearIntervalAsync=clearIntervalAsync;var setIntervalAsync={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.setIntervalAsync=r.clearIntervalAsync=void 0;const e=clearIntervalAsync$1;Object.defineProperty(r,"clearIntervalAsync",{enumerable:!0,get:function(){return e.clearIntervalAsync}});const t=setIntervalAsyncTimer;function n(o,a,...l){if(typeof o!="function")throw new TypeError("First argument is not a function");if(typeof a!="number")throw new TypeError("Second argument is not a number");return t.SetIntervalAsyncTimer.startTimer("dynamic",o,a,...l)}r.setIntervalAsync=n})(setIntervalAsync);const myWorker=new Worker(new URL("/assets/worker-5b95cea1.js",self.location),{type:"module"}),defaultWaterdepth=40,meanKernel=[[1,1,1],[1,1,1],[1,1,1]],sharpenKernel=[[-.00391,-.01563,-.02344,-.01563,-.00391],[-.01563,-.0625,-.09375,-.0625,-.01563],[-.02344,-.09375,1.8598,-.09375,-.02344],[-.01563,-.0625,-.09375,-.0625,-.01563],[-.00391,-.01563,-.02344,-.01563,-.00391]],pbElement=document.getElementById("progress"),previewImage=document.getElementById("previewImage"),progressMsg=document.getElementById("progressMsg"),progressArea=document.getElementById("progressArea"),eGridDiv=document.querySelector("#myGrid"),modal=document.getElementById("modal"),modalMsg=document.getElementById("modalMsg"),zoom=document.getElementById("zoom"),worldpart=document.getElementById("worldpart").checked,worldpartiongridsize=document.getElementById("worldpartiongridsize").value,landscapename=document.getElementById("landscapename").value,processCount=document.getElementById("processCount"),processStatus=document.getElementById("processStatus"),togglePassword=document.querySelector("#togglePassword"),apiKey=document.querySelector("#apiKey");let cache;togglePassword.addEventListener("click",function(r){const e=apiKey.getAttribute("type")==="password"?"text":"password";apiKey.setAttribute("type",e),this.classList.toggle("fa-eye-slash")});let distance,urlKey,urlType,map,geocoder,heightmapFileName,subDirName,vectorType,promiseArray=[],mapSize=50,vmapSize=mapSize*1.05,tileSize=mapSize/9,timer,ticks=0,mapCanvas,panels=document.getElementsByClassName("panel"),icons=document.getElementsByClassName("icon"),iconClass=[],weightmapGrid=null,event_source,rows=[{name:"Forest",color:[201,28,19]},{name:"Water",color:[[78,112,155],[103,178,178],[85,155,200],[90,163,195],[64,90,104],[82,122,183],[95,141,175],[91,142,184],[100,141,167],[111,140,146],[46,116,81],[62,129,142],[58,126,131],[55,121,118],[68,135,169],[65,132,155],[83,142,208],[83,142,199],[19,36,52],[26,48,70],[21,39,56],[12,21,31],[14,26,37],[28,52,76],[37,68,100],[43,78,114],[41,74,108],[65,119,172],[68,124,180],[91,141,182],[26,39,49],[64,112,158],[15,28,40],[24,43,63],[39,71,104],[21,39,57],[18,32,47],[58,107,156],[39,72,105],[12,23,33],[37,69,100],[45,83,121],[53,97,141],[28,51,74],[19,35,52],[43,78,113],[25,45,66],[65,118,172],[48,87,127],[23,41,60],[41,75,109],[16,30,44],[35,65,94],[71,130,188],[68,124,181],[14,25,37],[62,113,164],[31,56,82],[73,134,194],[50,92,133],[74,137,198],[77,140,204],[56,103,149],[55,100,146],[57,104,151],[56,103,149],[78,143,208],[42,77,112],[50,92,133],[62,113,165],[75,133,180],[56,104,148],[62,113,165],[78,143,207],[50,92,133],[36,65,94],[69,122,175],[28,50,73],[21,38,55],[33,61,88],[15,27,39],[66,131,154],[89,119,144],[73,129,175],[66,131,154],[99,141,169],[65,168,154],[75,165,173],[62,134,142],[111,140,147]]},{name:"Scrub",color:[[143,253,139],[142,253,138]]},{name:"Trees",color:[34,106,32]},{name:"Rock",color:[101,100,93]},{name:"Sand",color:[243,234,129]},{name:"Grass",color:[[33,226,29],[33,225,29]]},{name:"Glacier",color:[[255,255,255],[254,254,254]]},{name:"Landcover",color:[0,0,0]},{name:"Hillshade",color:[[241,110,218],[242,110,219],[242,110,220]]},{name:"Land",color:[154,136,66]},{name:"Farmland",color:[[140,17,155],[140,17,156]]}],userSettings,grid;init();async function init(){checkFileApiSupport()===!1?toggleModal("open","This browser does not support File System Access API.  Try Edge or Chrome."):(userSettings=await loadUserSettings(),grid=await loadSettings(),initMap())}function checkFileApiSupport(){return fileUtils.checkFileApiSupport()}let gridOptions={columnDefs:[{headerName:"Name",field:"name",editable:!0},{headerName:"Color",field:"color",editable:!0}],defaultColDef:{flex:1,minWidth:100,resizable:!0,headerCheckboxSelection:isFirstColumn,checkboxSelection:isFirstColumn},suppressRowClickSelection:!0,rowSelection:"multiple",rowData:rows};function isFirstColumn(r){return r.columnApi.getAllDisplayedColumns()[0]===r.column}for(let r=0;r<panels.length;r++)iconClass.push(icons[r].className);function initWeightmapGrid(){weightmapGrid===null&&(weightmapGrid=new Grid(eGridDiv,gridOptions))}function initMap(){try{caches.open("tiles").then(e=>cache=e),console.log("init");let r=document.getElementsByClassName("mapboxgl-ctrl-geocoder");scope.apiKey.length>0?(scope.serverType==="mapbox"?(mapboxgl.accessToken=scope.apiKey,urlKey="access_token=",urlType="@2x.png",vectorType=".vector.pbf",map=new mapboxgl.Map({container:"map",style:scope.stylesUrl+"outdoors-v11",center:[grid.lng,grid.lat],zoom:grid.zoom,preserveDrawingBuffer:!0}),geocoder=new MapboxGeocoder$1({accessToken:mapboxgl.accessToken,mapboxgl,marker:!1,placeholder:"Try: Lng , Lat or Name"}),r.length===0&&document.getElementById("geocoder").appendChild(geocoder.onAdd(map))):(config.apiKey=scope.apiKey,urlKey="key=",urlType=".webp",vectorType=".pbf",map=new Map$1({container:"map",style:MapStyle.OUTDOOR,center:[grid.lng,grid.lat],zoom:grid.zoom,preserveDrawingBuffer:!0,navigationControl:!1,geolocateControl:!1}),geocoder=new zf({apiKey:config.apiKey,class:"geocoder",showResultsWhileTyping:!0,placeholder:"Try: Lng , Lat or Name",enableReverse:!0}),document.getElementById("outdoors-v11").check=!0,r.length===0&&document.getElementById("geocoder").appendChild(geocoder.onAdd(map))),map.on("zoomend",()=>{let e=Math.round(map.getZoom());zoom.innerHTML=e.toString()}),map.on("error",function(e){toggleModal("open",`Mapbox error: ${e.error.message} Please check your api key and other map settings in the settings panel`),console.log(e),togglePanel(4)}),map.on("load",function(){console.log("load"),mapCanvas=map.getCanvasContainer(),zoom.innerHTML=Math.round(grid.zoom).toString(),map.getCanvas().addEventListener("wheel",e=>{const t=e.deltaY<0?1:-1;if(e.preventDefault(),e.shiftKey){map.scrollZoom.disable();let n=scope.mapSize;if(t===1?n+=1:n-=1,n>=4&&n<=1e3){scope.mapSize=n;let o=document.getElementById("mapSize");changeMapsize(o)}}else map.scrollZoom.enable()}),scope.mapSize=mapSize,scope.baseLevel=0,scope.heightScale=100}),map.on("style.load",function(e){addSource(),addLayer(),setMouse()}),map.on("click",function(e){grid.lng=e.lngLat.lng,grid.lat=e.lngLat.lat,setGrid(grid.lng,grid.lat,vmapSize),map.panTo(new mapboxgl.LngLat(grid.lng,grid.lat)),saveSettings(),zoom.innerHTML=Math.round(grid.zoom).toString(),updateInfopanel()}),map.on("idle",function(){scope.waterDepth=parseInt(grid.waterDepth)||50,scope.landscapeSize=parseInt(grid.landscapeSize)||2017,scope.worldpartlandscapeSize=parseInt(grid.worldpartlandscapeSize)||2041,scope.exportType=parseInt(grid.exportType)||"unrealHeightmap",saveSettings()}),scope.serverType==="mapbox"&&geocoder.on("result",function(e){grid.lng=e.result.center[0],grid.lat=e.result.center[1],setGrid(grid.lng,grid.lat,vmapSize),map.panTo(new mapboxgl.LngLat(grid.lng,grid.lat)),saveSettings(),updateInfopanel()})):(toggleModal("open","Please check your api key and other map settings in the settings panel"),togglePanel(4))}catch(r){toggleModal("open",`${r.message} Could be missing api key in the settings panel`),console.log(r)}}function onMove(r){grid.lng=r.lngLat.lng,grid.lat=r.lngLat.lat,setGrid(r.lngLat.lng,r.lngLat.lat,vmapSize)}function onUp(r){grid.lng=r.lngLat.lng,grid.lat=r.lngLat.lat,setGrid(r.lngLat.lng,r.lngLat.lat,vmapSize),map.off("mousemove",onMove),map.off("touchmove",onMove),updateInfopanel()}function addSource(){map.addSource("grid",{type:"geojson",data:getGrid(grid.lng,grid.lat,vmapSize)}),map.addSource("start",{type:"geojson",data:getGrid(grid.lng,grid.lat,vmapSize/9)})}function addLayer(){map.addLayer({id:"grid",type:"fill",source:"grid",paint:{"fill-color":"blue","fill-outline-color":"blue","fill-opacity":.25}}),map.addLayer({id:"startsquare",type:"fill",source:"start",paint:{"fill-color":"blue","fill-outline-color":"blue","fill-opacity":.3}})}function setMouse(){map.on("mouseenter","startsquare",function(){mapCanvas.style.cursor="move"}),map.on("mouseleave","startsquare",function(){mapCanvas.style.cursor="",saveSettings()}),map.on("mousedown","startsquare",function(r){r.preventDefault(),mapCanvas.style.cursor="grab",map.on("mousemove",onMove),map.once("mouseup",onUp)}),map.on("touchstart","startsquare",function(r){r.points.length===1&&(r.preventDefault(),map.on("touchmove",onMove),map.once("touchend",onUp))})}function setLngLat(r){let e=document.getElementById("lngInput"),t=document.getElementById("latInput");switch(r){case"current_position":e.value=grid.lng,t.value=grid.lat;break;case"clear":e.value="",t.value="";break;case"apply":e.value&&t.value&&(grid.lng=parseFloat(e.value),grid.lat=parseFloat(t.value),setGrid(grid.lng,grid.lat,vmapSize),map.panTo(new mapboxgl.LngLat(grid.lng,grid.lat)),saveSettings(),updateInfopanel());break}}function setGrid(r,e,t){map.getSource("grid").setData(getGrid(r,e,t)),map.getSource("start").setData(getGrid(r,e,t/9)),grid.zoom=map.getZoom()}function getExtent(r,e,t=vmapSize){let n=Math.sqrt(2*Math.pow(t/2,2)),o=point([r,e]),a=destination(o,n,-45,{units:"kilometers"}).geometry.coordinates,l=destination(o,n,135,{units:"kilometers"}).geometry.coordinates;return{topleft:a,bottomright:l}}function getGrid(r,e,t){let n=getExtent(r,e,t);return squareGrid([n.topleft[0],n.topleft[1],n.bottomright[0],n.bottomright[1]],tileSize,{units:"kilometers"})}async function loadUserSettings(){let r=await idbKeyval.get("userSettings")||{};if(r.dirHandle?scope.downloadDirectory=r.dirHandle.name:scope.downloadDirectory="",scope.serverType||(scope.serverType=r.serverType||"mapbox"),scope.serverType==="mapbox"){scope.apiKey=r.mapboxApiKey||"",scope.terrianUrl=r.mapboxTerrianUrl||"https://api.mapbox.com/v4/mapbox.terrain-rgb/",scope.stylesUrl=r.mapboxStylesUrl||"mapbox://styles/mapbox/",scope.vectorUrl=r.mapboxVectorUrl||"https://api.mapbox.com/v4/mapbox.mapbox-streets-v8/",scope.weightMapUrl=r.mapboxWeightMapUrl||"",scope.satelliteMapUrl=r.mapboxSatelliteMapUrl||"https://api.mapbox.com/v4/mapbox.satellite/",scope.mapUrl=r.mapboxMapUrl||"https://api.mapbox.com/styles/v1/";let e=r.weightmapColors||[];e.length===0?r.weightmapColors=rows:rows=e}else scope.serverType==="maptiler"&&(scope.apiKey=r.maptilerApiKey||"",scope.terrianUrl=r.maptilerTerrianUrl||"https://api.maptiler.com/tiles/terrain-rgb-v2/",scope.stylesUrl=r.maptilerStylesUrl||"https://api.maptiler.com/maps/outdoor/style.json",scope.vectorUrl=r.maptilerVectorUrl||"https://api.maptiler.com/tiles/v3/",scope.weightMapUrl=r.maptilerWeightMapUrl||"",scope.satelliteMapUrl=r.maptilerSatelliteMapUrl||"https://api.maptiler.com/tiles/satellite-v2/",scope.mapUrl=r.maptilerMapUrl||"https://api.maptiler.com/maps/");return scope.desktopServerUrl=r.desktopServerUrl||"http://localhost:5000/",scope.desktopDownloadDirectory=r.desktopDownloadDirectory||"",r}async function saveUserSettings(){userSettings.serverType=scope.serverType,scope.serverType==="mapbox"?(userSettings.mapboxApiKey=scope.apiKey,userSettings.mapboxTerrianUrl=scope.terrianUrl,userSettings.mapboxStylesUrl=scope.stylesUrl,userSettings.mapboxWeightMapUrl=scope.weightMapUrl,userSettings.mapboxSatelliteMapUrl=scope.satelliteMapUrl,userSettings.mapboxMapUrl=scope.mapUrl,userSettings.mapboxVectorUrl=scope.vectorUrl,userSettings.weightmapColors=gridOptions.rowData):(userSettings.maptilerApiKey=scope.apiKey,userSettings.maptilerTerrianUrl=scope.terrianUrl,userSettings.maptilerStylesUrl=scope.stylesUrl,userSettings.maptilerWeightMapUrl=scope.weightMapUrl,userSettings.maptilerSatelliteMapUrl=scope.satelliteMapUrl,userSettings.maptilerMapUrl=scope.mapUrl,userSettings.maptilerVectorUrl=scope.vectorUrl),userSettings.desktopServerUrl=scope.desktopServerUrl,userSettings.desktopDownloadDirectory=scope.desktopDownloadDirectory,idbKeyval.set("userSettings",userSettings),await loadUserSettings(),map&&map.remove(),location.reload()}async function loadSettings(){let r=await idbKeyval.get("grid")||{};return r.lng=parseFloat(r.lng)||-121.75954,r.lat=parseFloat(r.lat)||46.85255,r.zoom=parseFloat(r.zoom)||11,r.minHeight=parseFloat(r.minHeight)||0,r.maxHeight=parseFloat(r.maxHeight)||0,document.getElementById("waterDepth").value=parseInt(r.waterDepth)||defaultWaterdepth,document.getElementById("drawStrm").checked=r.drawStreams||!1,document.getElementById("blurPasses").value=parseInt(r.blurPasses)||0,document.getElementById("blurPostPasses").value=parseInt(r.blurPostPasses)||0,document.getElementById("plainsHeight").value=parseInt(r.plainsHeight)||0,document.getElementById("streamDepth").value=parseInt(r.streamDepth)||0,r}function saveSettings(){grid.zoom=map.getZoom(),grid.waterDepth=parseInt(document.getElementById("waterDepth").value),grid.landscapeSize=scope.landscapeSize,grid.worldpartlandscapeSize=scope.worldpartlandscapeSize,grid.exportType=scope.exportType,grid.drawStreams=document.getElementById("drawStrm").checked,grid.plainsHeight=parseInt(document.getElementById("plainsHeight").value),grid.blurPasses=parseInt(document.getElementById("blurPasses").value),grid.blurPostPasses=parseInt(document.getElementById("blurPostPasses").value),grid.streamDepth=parseInt(document.getElementById("streamDepth").value),idbKeyval.set("grid",grid)}function togglePanel(r){let e=[];for(let t=0;t<panels.length;t++)e.push(panels[t].classList.contains("slide-in"));for(let t=0;t<panels.length;t++)e[t]&&t!=r&&(panels[t].setAttribute("class","panel slide-out"),icons[t].setAttribute("class",iconClass[t]));switch(panels[r].setAttribute("class",e[r]?"panel slide-out":"panel slide-in"),icons[r].setAttribute("class",e[r]?iconClass[r]:"icon fas fa-angle-left"),r){case 0:break;case 1:break;case 2:if(!e[2]){let t,n;scope.serverType==="mapbox"?t=map.getStyle().metadata["mapbox:origin"]:(t=map.getStyle().name,n=mapUtils.convertMapboxMaptilerStyles("maptiler",t.toUpperCase()),n.length===0&&(n=mapUtils.convertMapboxMaptilerStyles("maptilerAltName",t)),n.length>0&&(t=n[0].mapbox,document.getElementById(t).checked=!0))}break;case 3:break;case 4:break;case 5:initWeightmapGrid();break}}function updateInfopanel(){document.getElementById("lng").innerHTML=grid.lng.toFixed(5),document.getElementById("lat").innerHTML=grid.lat.toFixed(5),document.getElementById("minh").innerHTML=grid.minHeight,document.getElementById("maxh").innerHTML=grid.maxHeight}function zoomIn(){map.zoomIn()}function zoomOut(){map.zoomOut()}function changeMapsize(r){r.value<4&&(r.value=4),mapSize=r.value/1,vmapSize=mapSize*1.05,tileSize=mapSize/9,setGrid(grid.lng,grid.lat,vmapSize),grid.minHeight=null,grid.maxHeight=null,updateInfopanel()}async function setBaseLevel(){grid.minHeight===null&&await getHeightmap(),scope.baseLevel=grid.minHeight,saveSettings()}async function setHeightScale(){grid.maxHeight===null&&await getHeightmap(),scope.heightScale=Math.min(250,Math.floor((1024-scope.waterDepth)/(grid.maxHeight-scope.baseLevel)*100)),saveSettings()}function incPb(r,e=1){let t=r.value+e;r.value===r.max?r.value=0:r.value=t}function setMapStyle(r){const e=r.id;if(scope.serverType==="mapbox")e==="weightmap"?map.setStyle("mapbox://styles/"+scope.weightMapUrl):map.setStyle(scope.stylesUrl+e);else{let t=mapUtils.convertMapboxMaptilerStyles("mapbox",e);if(t.length>0){const n=t[0].maptiler.split(".");let o;n.length===2?o=MapStyle[n[0]][n[1]]:o=MapStyle[n[0]],map.setStyle(o,{diff:t[0].diff})}}}function startTimer(r=!1){overlayOn(),progressArea.style.display="block",timer=setIntervalAsync.setIntervalAsync(async()=>{ticks++,incPb(pbElement),r===!0&&(processCount.innerHTML=`Time: ${ticks}`)},10)}function stopTimer(){clearIntervalAsync_2(timer),pbElement.value=0,console.log("complete in ",ticks*10," ms"),ticks=0,progressMsg.innerHTML="",progressArea.style.display="none",processCount.innerHTML="",processStatus.innerHTML="",overlayOff()}async function getHeightmap(r=14,e=!1){return new Promise(async(t,n)=>{let o=await downloadTiles(scope.terrianUrl,!0,r,e);o.heightmap=mapUtils.toHeightmap(o.tiles,o.distance,mapSize),o.xOffset=Math.round(o.leftDistance/o.distance*o.heightmap.length),o.yOffset=Math.round(o.topDistance/o.distance*o.heightmap.length),o.sanatizedMap=mapUtils.sanatizeMap(o.heightmap,o.xOffset,o.yOffset);let a=mapUtils.calcMinMaxHeight(o.heightmap);grid.minHeight=a.min,grid.maxHeight=a.max,document.getElementById("lng").innerHTML,document.getElementById("lat").innerHTML,o?t(o):n("timout")})}async function downloadTiles(r,e=!0,t=14,n=!1){return new Promise(async(o,a)=>{let l=getExtent(grid.lng,grid.lat,mapSize/1080*1081),s=mapUtils.getTileCountAdjusted(t,l,n),m=s.x,y=s.y,D=s.zoom,W=s.tileCnt,Ee={};document.getElementById("satZoomVal").value=D,document.getElementById("zoomlevel").innerHTML=D,document.getElementById("satZoomTileCount").innerHTML=mapUtils.getTileCount(D,l).length.toString(),document.getElementById("heightmapZoomTileCount").innerHTML=mapUtils.getTileCount(D,l).length.toString(),document.getElementById("heightmapZoomVal").value=D;let dt=mapUtils.tile2long(m,D),Ht=mapUtils.tile2lat(y,D),ir=mapUtils.tile2long(m+W,D),Hr=mapUtils.tile2lat(y+W,D),Bn,Vn;distance=distance$1(point([dt,Ht]),point([ir,Hr]),{units:"kilometers"})/Math.SQRT2;let Wr=distance$1(point([dt,Ht]),point([dt,l.topleft[1]]),{units:"kilometers"}),ps=distance$1(point([dt,Ht]),point([l.topleft[0],Ht]),{units:"kilometers"});e===!0?Bn=mapUtils.Create2DArray(W):Bn=[],promiseArray=[];let il=1,gl=W*W;progressCount(il,gl,"downloading");for(let ml=0;ml<W;ml++)for(let sl=0;sl<W;sl++){let ll=r+D+"/"+(m+sl)+"/"+(y+ml)+urlType+"?"+urlKey+scope.apiKey;e===!0?promiseArray.push(mapUtils.downloadToTile(!0,ll).then(rl=>{Bn[ml][sl]=rl,progressCount(il++,gl,"downloading")})):promiseArray.push(mapUtils.downloadToTile(!1,ll,m+sl,y+ml).then(rl=>{Bn.push(rl),progressCount(il++,gl,"downloading")}))}if(await Promise.all(promiseArray),e===!0){promiseArray=[],Vn=mapUtils.Create2DArray(W),r=scope.vectorUrl;for(let ml=0;ml<W;ml++)for(let sl=0;sl<W;sl++){let ll=r+D+"/"+(m+sl)+"/"+(y+ml)+vectorType+"?"+urlKey+scope.apiKey;promiseArray.push(mapUtils.downloadPbfToTile(ll).then(rl=>{Vn[ml][sl]=rl,progressCount(il++,gl,"downloading vector tiles")}))}}await Promise.all(promiseArray),Ee.tiles=Bn,Ee.vTiles=Vn,Ee.distance=distance,Ee.topDistance=Wr,Ee.leftDistance=ps,Ee.zoom=s.zoom,Ee.x=m,Ee.y=y,Ee.zoom=D,Ee.tileCnt=s.tileCnt,Ee?o(Ee):a("timout")})}function progressCount(r,e,t){processCount.innerHTML=`${t}  ${r} of ${e}`}function setUrlInfo(r){scope.serverType==="mapbox"?(r==="height"&&(urlType="@2x.png"),r==="style"&&(urlType="")):scope.serverType==="maptiler"&&(r==="height"?urlType=".webp":r==="jpg"?urlType=".jpg":r==="png"&&(urlType=".png"))}function convertHeightmap(r,e){let n=new Uint8ClampedArray(2337122),o=mapUtils.Create2DArray(1081,0),a=Math.round(scope.waterDepth/parseFloat(scope.heightScale)*100*10)/10;for(let dt=0;dt<1081;dt++)for(let Ht=0;Ht<1081;Ht++){let Hr=(r[dt][Ht]-scope.baseLevel*10+Math.round(a*10*e[dt][Ht]))/10;o[dt][Ht]=Math.max(0,Hr)}let l=parseInt(document.getElementById("levelCorrection").value);o=levelMap(o,grid.minHeight+a,grid.maxHeight,l);let s=parseInt(document.getElementById("blurPasses").value),m=parseInt(document.getElementById("blurPostPasses").value),y=parseInt(document.getElementById("plainsHeight").value);for(let dt=0;dt<s;dt++)o=filterMap(o,0,y+a,meanKernel);for(let dt=0;dt<m;dt++)o=filterMap(o,y+a,grid.maxHeight,sharpenKernel);let D=parseInt(document.getElementById("streamDepth").value),W=0;if(document.getElementById("drawStrm").checked)for(let dt=0;dt<1081;dt++)for(let Ht=0;Ht<1081;Ht++){let ir=o[dt][Ht];ir>W&&(W=ir),ir>D&&(o[dt][Ht]=ir-(1-e[dt][Ht])*D)}for(let dt=0;dt<m;dt++)o=filterMap(o,0,W,meanKernel);for(let dt=0;dt<1081;dt++)for(let Ht=0;Ht<1081;Ht++){let ir=Math.round(o[dt][Ht]/100*parseFloat(scope.heightScale)/.015625);ir>65535&&(ir=65535);let Hr=dt*1081*2+Ht*2;n[Hr+0]=ir>>8,n[Hr+1]=ir&255}let Ee=getExtent(grid.lng,grid.lat,mapSize);return console.log(Ee.topleft[0],Ee.topleft[1],Ee.bottomright[0],Ee.bottomright[1]),n}function interpolateArray(r,e){let t=function(a,l,s){return a+(l-a)*s},n=new Array,o=new Number((r.length-1)/(e-1));n[0]=r[0];for(let a=1;a<e-1;a++){let l=a*o,s=new Number(Math.floor(l)).toFixed(),m=new Number(Math.ceil(l)).toFixed(),y=l-s;n[a]=t(r[s],r[m],y)}return n[e-1]=r[r.length-1],n}function levelMap(r,e,t,n){let o;switch(n){case 1:o=[.1,1,1.9];break;case 2:o=[.15,.45,.75,1.1,1.4,1.7,1.9,1.9];break;case 3:o=[.1,.2,1,1.1,1.2,1.3,1.4,1.5,1.6];break;case 9:o=[.1,.2,.5,1,1.3,1.7,2.5];break;default:return console.log("no map leveling"),r}const a=interpolateArray(o,256),l=r.length,s=r[0].length,m=Math.round((t-e)/a.length);let y=[e],D=e;for(let Ht=0;Ht<a.length;Ht++)y.push(Math.round((D+m*a[Ht])*10)/10),D=y[Ht+1];const W=mapUtils.Create2DArray(l,0);let Ee=0;for(let Ht=0;Ht<l;Ht++)for(let ir=0;ir<s;ir++){let Hr=r[Ht][ir];if(Hr-e>0){let Bn=Math.min(a.length-1,Math.floor((Hr-e)/m));Hr=y[Bn]+(Hr-y[Bn])*a[Bn],Hr=Math.round(Hr*10)/10}W[Ht][ir]=Hr,Hr>Ee&&(Ee=Hr)}console.log(`min ${e} max ${t} highest high ${Ee}`);let dt=10;if(Ee>t){dt=Math.floor((t-e)/Ee*100)/10;for(let Ht=0;Ht<l;Ht++)for(let ir=0;ir<s;ir++){let Hr=W[Ht][ir];Hr-e>0&&(W[Ht][ir]=Math.round(Hr*dt)/10)}}return console.log(`leveled map with style ${n}, rescale ${dt/10}`),W}function filterMap(r,e,t,n){const o=r.length,a=r[0].length,l=parseInt((n.length-1)/2),s=mapUtils.Create2DArray(o,0);for(let m=0;m<o;m++)for(let y=0;y<a;y++){let D=r[m][y];if(D>=e&&D<e+t){let W=0,Ee=0;for(let dt=-l;dt<=l;dt++)for(let Ht=-l;Ht<=l;Ht++)m+dt>=0&&m+dt<o&&y+Ht>=0&&y+Ht<a&&(Ee+=n[dt+l][Ht+l],W+=r[m+dt][y+Ht]*n[dt+l][Ht+l]);Ee&&(D=W/Ee)}s[m][y]=D}return s}async function previewHeightmap(){progressMsg.innerHTML="Processing heightmap",startTimer();let r,e,t;setUrlInfo("height");let n=document.getElementById("autoCalcBaseHeight").checked,o=await getHeightmap(),a=mapUtils.sanatizeWatermap(mapUtils.toWatermap(o.vTiles,o.heightmap.length),o.xOffset,o.yOffset);n===!0&&await autoCalculateBaseHeight(),r=convertHeightmap(o.sanatizedMap,a),e=UPNG.encodeLL([r],1081,1081,1,0,16),t=download("testheightmap.png",e,!0),previewImage.src=t,updateInfopanel(),stopTimer()}async function workerProcess(r){return new Promise(async(e,t)=>{myWorker.postMessage(r),myWorker.onmessage=function(n){let o=n.data;o.process==="worker"&&o.msg==="complete"?(stopTimer(),e(!0)):o.process==="weightMap"&&o.msg==="update"?processStatus.innerHTML=`Converting ${o.name}  `:o.process==="combineTilesJimp"&&o.msg==="update"&&progressCount(o.count,o.totalCount,"")}})}async function setupEventSource(){event_source===void 0&&(event_source=new EventSource(userSettings.desktopServerUrl+"subscribe"),event_source.onmessage=function(r){let e=JSON.parse(r.data);if(e.event==="stitch_tiles"&&e.count){let t;e.total_count?t=e.total_count:t="unknown",progressCount(e.count,t,e.process)}else e.event==="stitch_tiles"&&(processCount.innerHTML=e.process)})}async function exportMap(){let r=await userSettings.dirHandle,e=document.getElementById("satZoomVal").value,t=document.getElementById("overrideSatZoom").checked,n=document.getElementById("heightmapZoomVal").value,o=document.getElementById("overrideHeightmapZoom").checked,a=document.getElementById("heightmap").checked,l=document.getElementById("satellite").checked,s,m=!1;if(e>14||n>14)if(s=await isServerRunning(),s===!1){toggleModal("open","To use a zoom level of greater than 14 please download the desktop version, download link in help file.  Cannot connect to desktop server");return}else await setupEventSource(),m=!0;try{if(await fileUtils.verifyPermission(r,!0)===!1){console.error(`User did not grant permission to '${r.name}'`);return}}catch(Td){toggleModal("open","Please choose a download directory in the settings panel"),togglePanel(4),console.log(Td);return}let y,D,W=document.getElementById("autoCalcBaseHeight").checked,Ee=document.getElementById("mapimage").checked,dt=document.getElementById("weightmapdl").checked,Ht=document.getElementById("geojson").checked,ir=document.getElementById("sealevel").checked,Hr=document.getElementById("flipx").checked,Bn=document.getElementById("flipy").checked,Vn=document.getElementById("useworldpart").checked,Wr=document.getElementById("blurradius").value,ps=document.getElementById("weightmapblurradius").value,il="";Vn===!0?il=scope.worldpartlandscapeSize.toString():il=scope.landscapeSize.toString();let gl,ml;ml=grid.lng.toFixed(5),gl=grid.lat.toFixed(5);let sl=512,ll=getExtent(grid.lng,grid.lat,mapSize/1080*1081),rl=[ll.topleft[0],ll.bottomright[1],ll.bottomright[0],ll.topleft[1]],th=[ll.topleft[0],ll.topleft[1],ll.bottomright[0],ll.bottomright[1]],nh,bh;e.length===0?nh=14:nh=e,n.length===0?bh=14:bh=n;let Fh="["+rl+"]",Bh={};subDirName="",subDirName=`tile_lat_${gl}_lng_${ml}`;const Ed=await r.getDirectoryHandle(subDirName,{create:!0});if(scope.exportType==="unrealSend"&&a!==!0){toggleModal("open","Send to Unreal requires image download type heightmap to be checked");return}if(a===!0||l===!0||Ee===!0||dt===!0||Ht===!0){if(a===!0){heightmapFileName=`heightmap_landscape_size_${il}.png`,progressMsg.innerHTML="Processing heightmap",console.log("heightmap"),startTimer(),setUrlInfo("height");let Td=mapUtils.getTileCountAdjusted(bh,ll,o);if(Bh={},Bh.function="heightmap",Bh.heightmapblurradius=Wr,Bh.sealevel=ir,Bh.flipx=Hr,Bh.flipy=Bn,Bh.landscapeSize=il,Bh.dirHandle=Ed,Bh.filename=heightmapFileName,Bh.bbox=th,Bh.zoom=parseInt(Td.zoom),Bh.access_token=urlType+"?"+urlKey+scope.apiKey,Bh.api_url=scope.terrianUrl,Bh.base_dir=scope.desktopDownloadDirectory,Bh.sub_dir=subDirName,Bh.is_heightmap=!0,m===!0)console.log("send backend"),await processFromBackend(Bh),stopTimer();else{let td=await getHeightmap(bh,o),Fd=mapUtils.sanatizeWatermap(mapUtils.toWatermap(td.vTiles,td.heightmap.length),td.xOffset,td.yOffset);W===!0&&await autoCalculateBaseHeight(),y=convertHeightmap(td.sanatizedMap,Fd),D=UPNG.encodeLL([y],1081,1081,1,0,16),console.log("finished convert heightmap"),updateInfopanel(),stopTimer(),console.log("start manipulating image"),progressMsg.innerHTML="Manipulating and resizing image",startTimer(!0),Bh.png=D,Bh.function="manipulateImage",Bh.isHeightmap=!0,await workerProcess(Bh),stopTimer()}}if(l===!0){console.log("Processing satellite"),progressMsg.innerHTML="Processing satellite",startTimer(),setUrlInfo("jpg");let Td=mapUtils.getTileCountAdjusted(nh,ll,t),td=`satellite_zoom_${Td.zoom}.png`;if(Bh={},Bh.function="satellite",Bh.dirHandle=Ed,Bh.heightmapblurradius=Wr,Bh.sealevel=ir,Bh.flipx=Hr,Bh.flipy=Bn,Bh.landscapeSize=il,Bh.filename=td,Bh.bbox=th,Bh.zoom=parseInt(Td.zoom),Bh.access_token=urlType+"?"+urlKey+scope.apiKey,Bh.api_url=scope.satelliteMapUrl,Bh.base_dir=scope.desktopDownloadDirectory,Bh.sub_dir=subDirName,Bh.is_heightmap=!1,m===!0)console.log("send backend"),await processFromBackend(Bh),stopTimer();else{let Fd=await downloadTiles(scope.satelliteMapUrl,!1,nh,t);console.log("Combining images"),progressMsg.innerHTML="Combining images",startTimer(),Bh.function="combineImages",Bh.objTiles=Fd,Bh.tileSize=sl,Bh.dirHandle=Ed,Bh.lng=ml,Bh.lat=gl,Bh.zoom=Fd.zoom,Bh.filename=td,await workerProcess(Bh),stopTimer()}}if(Ee===!0){console.log("Processing map image"),progressMsg.innerHTML="Processing map image",startTimer();let Td,td,Fd,Ld;if(scope.serverType==="mapbox"){Td=map.getStyle().metadata["mapbox:origin"],Td===void 0?(Fd=scope.mapUrl+scope.weightMapUrl+"/static/",console.log("weight")):(td=mapUtils.convertMapboxMaptilerStyles("mapbox",Td),Fd=scope.mapUrl+"mapbox/"+td[0].mapbox+"/static/");let Ud=1280,Xd=1280;Fd=Fd+Fh+`/${Xd}x${Ud}?access_token=${scope.apiKey}&attribution=false&logo=false`,Ld=`map_image_width_${Ud}_height_${Xd}.png`;let wd=await mapUtils.downloadToTile(!1,Fd);await saveImage(Ed,wd.buffer,Ld,"png"),stopTimer()}else if(scope.serverType==="maptiler"){setUrlInfo("png"),Td=map.getStyle().name,td=mapUtils.convertMapboxMaptilerStyles("maptiler",Td.toUpperCase()),Fd=scope.mapUrl+td[0].maptiler_map+"/";let Ud=await downloadTiles(Fd,!1,zoom,!1);stopTimer(),Ld="map_image.png",console.log("Combining images"),progressMsg.innerHTML="Combining images",startTimer(),Bh={},Bh.function="combineImages",Bh.objTiles=Ud,Bh.tileSize=sl,Bh.dirHandle=Ed,Bh.lng=ml,Bh.lat=gl,Bh.zoom=Ud.zoom,Bh.filename=Ld,await workerProcess(Bh),stopTimer()}}if(dt===!0){if(scope.serverType==="mapbox"){console.log("Processing weightmap image"),progressMsg.innerHTML="Processing weightmap image",startTimer(!0);let Td=scope.mapUrl+scope.weightMapUrl+"/static/",td=1280,Fd=1280;Td=Td+Fh+`/${Fd}x${td}?access_token=${scope.apiKey}&attribution=false&logo=false`;let Ld=`weightmap_image_width_${td}_height_${Fd}.png`,Ud=await mapUtils.downloadToTile(!1,Td);await saveImage(Ed,Ud.buffer,Ld,"png"),Bh={},Bh.function="weightMap",Bh.weight_data=userSettings.weightmapColors,Bh.weightMapUrl=scope.weightMapUrl,Bh.dirHandle=Ed,Bh.objTile=Ud,Bh.lng=grid.lng,Bh.lat=grid.lat,Bh.weightmapblurradius=ps,Bh.landscapeSize=il,await workerProcess(Bh),stopTimer()}else console.log("Weightmaps are not available for Maptiler");stopTimer()}if(Ht===!0){console.log("Processing geojson"),progressMsg.innerHTML="Processing geojson",startTimer();let Td=mapUtils.getFeaturesFromBB(map,rl,!0),td=JSON.stringify(Td),Fd=`features_lat_${gl}_lng_${ml}.json`;await fileUtils.writeFileToDisk(Ed,Fd,td),stopTimer()}scope.exportType==="unrealSend"&&await sendToUnreal()}else toggleModal("open","Please select at least one image type to download")}async function isServerRunning(){try{return(await(await fetch(userSettings.desktopServerUrl,{method:"GET"})).json()).msg==="server is running"}catch(r){return console.log(r),stopTimer(),!1}}async function processFromBackend(r){try{let e=JSON.stringify(r),n=await(await fetch(userSettings.desktopServerUrl+"process_tiles",{method:"POST",headers:{"Content-Type":"application/json"},body:e})).json()}catch(e){console.log(e),stopTimer()}}async function autoCalculateBaseHeight(){await setBaseLevel(),await setHeightScale()}function download(r,e,t=!1){let n=window.document.createElement("a");if(t)return window.URL.createObjectURL(new Blob([e],{type:"application/octet-stream"}));n.href=window.URL.createObjectURL(new Blob([e],{type:"application/octet-stream"})),n.download=r,document.body.appendChild(n),n.click(),document.body.removeChild(n)}function overlayOn(){document.getElementById("overlay").style.display="block"}function overlayOff(){document.getElementById("overlay").style.display="none"}function exportTypeChange(r){scope.exportType=r.value}function landscapeSizeChange(r){scope.landscapeSize=r.value}function worldpartlandscapeSizeChange(r){scope.worldpartlandscapeSize=r.value}async function serverTypeChange(r){scope.serverType=r.value,await loadUserSettings()}async function openDirectory(){try{userSettings.dirHandle=await fileUtils.getDirHandle()}catch(r){if(r.name==="AbortError")return;console.error("An error occured trying to open the file.",r)}userSettings.dirHandle?(scope.downloadDirectory=userSettings.dirHandle.name,idbKeyval.set("userSettings",userSettings)):console.log("error dirhandle")}function toggleModal(r,e){r==="open"?(modalMsg.innerHTML=e,modal.classList.add("show-modal")):r==="close"&&(modalMsg.innerHTML="",modal.classList.remove("show-modal"))}function getTilesResolutionSize(r){let e=r[0],t=r[r.length-1],n=[e.x,t.x],o=[e.y,t.y],a=n[1]-n[0],l=o[1]-o[0];a=Math.max(1,a),l=Math.max(1,l);let s=512,m=512,y=s*a,D=m*l,W={};return W.totalHeight=D,W.totalWidth=y,W}function overrideSatZoomChange(r){let e=getExtent(grid.lng,grid.lat,mapSize/1080*1081),t=mapUtils.getTileCount(r,e),n=getTilesResolutionSize(t),o=t.length;document.getElementById("satZoomTileCount").innerHTML=o.toString(),r>14&&(document.getElementById("satresolution").innerHTML=`Expected sat resolution if zoom > 14 Height: ${n.totalHeight} Width: ${n.totalWidth}`)}function overrideHeightmapZoomChange(r){let e=getExtent(grid.lng,grid.lat,mapSize/1080*1081),t=mapUtils.getTileCount(r,e),n=getTilesResolutionSize(t),o=t.length;document.getElementById("heightmapZoomTileCount").innerHTML=o.toString(),r>14&&(document.getElementById("heightresolution").innerHTML=`Expected height resolution if zoom > 14 Height: ${n.totalHeight} Width: ${n.totalWidth}`)}async function saveImage(r,e,t,n){let o=new Blob([e],{type:"image/"+n});await fileUtils.writeFileToDisk(r,t,o)}async function saveWeightmapGrid(){gridOptions.api.stopEditing(),await saveUserSettings()}async function deleteWeightmapGrid(){gridOptions.api.stopEditing();let r=gridOptions.api.getSelectedNodes(),e=gridOptions.rowData;for(let t=0;t<r.length;t++)for(let n=0;n<e.length;n++)e[n]===r[t].data&&e.splice(n,1);gridOptions.api.setRowData(e),await saveUserSettings()}function addWeightmapGrid(){gridOptions.rowData.push({name:"New Value",color:"1,1,1"}),gridOptions.api.setRowData(gridOptions.rowData)}function help(){open("help.html","help",`scrollbars=yes,resizable=no,status=no,location=no,toolbar=no,menubar=no,
width=900,height=600,left=500,top=100`)}async function sendToUnreal(){startTimer("Sending to Unreal"),console.log("sendtounreal");let r="http://localhost:30010/",e="remote/object/call",t={},n,o,a,l="Mapbox_BP";if(t={objectPath:"/Script/UnrealEd.Default__EditorActorSubsystem",functionName:"GetAllLevelActors"},n=await mapUtils.unrealRemoteControl(t,r+e),n.error)n.error.message==="Failed to fetch"?toggleModal("open","Cannot connect to Unreal server. Please make sure your project is open and Mapbox_BP is in the scene.  Also make sure you launched the Map using the Select Map button as this starts the Unreal Web Server"):toggleModal("open",n.error.message);else{let s=await n.response.json();for(let m of s.ReturnValue)if(o=m.includes(l),o===!0){a=m;break}else a=null;if(a){let m;worldpart===!0?m=worldpartiongridsize:m=0,t={objectPath:a,functionName:"GenerateMapboxLandscape",parameters:{LandscapeName:landscapename,LandscapeSize:scope.landscapeSize.toString(),TileHeightmapFileName:subDirName+"/"+heightmapFileName,TileGeojsonFileName:"",TileInfoFileName:"",MapMiddleLngX:"",MapMiddleLatY:"",MapBtmRLng:"",MapBtmLLng:"",MapTopLLat:"",MapBtmLLat:"",RunFunction:"Unreal Heightmap",SlippyMapTileString:"",HeightMapTexturesPath:"/Game/ImportedHeightMaps/",AlphaBrushName:"",AlphaBrushDestinationPath:"",AlphaBrushTemplatePath:"",AlphaBrushTexturesPath:"",HeightmapProperty:"HeightMap",WorldPartitionGridSize:m.toString()}},n=await mapUtils.unrealRemoteControl(t,r+e),n.error?(console.log(n.error),toggleModal("open",n.error.message)):console.log(await n.response.json())}else toggleModal("open","Could not find Mapbox_BP in scene")}stopTimer()}window.toggleModal=toggleModal;window.togglePanel=togglePanel;window.openDirectory=openDirectory;window.saveUserSettings=saveUserSettings;window.serverTypeChange=serverTypeChange;window.landscapeSizeChange=landscapeSizeChange;window.exportMap=exportMap;window.previewHeightmap=previewHeightmap;window.setMapStyle=setMapStyle;window.setLngLat=setLngLat;window.zoomIn=zoomIn;window.zoomOut=zoomOut;window.exportTypeChange=exportTypeChange;window.changeMapsize=changeMapsize;window.overrideSatZoomChange=overrideSatZoomChange;window.overrideHeightmapZoomChange=overrideHeightmapZoomChange;window.saveWeightmapGrid=saveWeightmapGrid;window.deleteWeightmapGrid=deleteWeightmapGrid;window.addWeightmapGrid=addWeightmapGrid;window.worldpartlandscapeSizeChange=worldpartlandscapeSizeChange;window.help=help;
