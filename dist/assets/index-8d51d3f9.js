var $E=(n,t,e)=>{if(!t.has(n))throw TypeError("Cannot "+e)};var r1=(n,t,e)=>($E(n,t,"read from private field"),e?e.call(n):t.get(n)),j1=(n,t,e)=>{if(t.has(n))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(n):t.set(n,e)},H1=(n,t,e,r)=>($E(n,t,"write to private field"),r?r.call(n,e):t.set(n,e),e);var WC=(n,t,e)=>($E(n,t,"access private method"),e);function _mergeNamespaces(n,t){for(var e=0;e<t.length;e++){const r=t[e];if(typeof r!="string"&&!Array.isArray(r)){for(const o in r)if(o!=="default"&&!(o in n)){const s=Object.getOwnPropertyDescriptor(r,o);s&&Object.defineProperty(n,o,s.get?s:{enumerable:!0,get:()=>r[o]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function e(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=e(o);fetch(o.href,s)}})();const styles="",all="";var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function getAugmentedNamespace(n){if(n.__esModule)return n;var t=n.default;if(typeof t=="function"){var e=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var o=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(e,r,o.get?o:{enumerable:!0,get:function(){return n[r]}})}),e}var mapboxGl$1={exports:{}};(function(n,t){(function(e,r){n.exports=r()})(commonjsGlobal,function(){var e,r,o;function s(a,h){if(!e)e=h;else if(!r)r=h;else{var y="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+r+")(sharedChunk); self.onerror = null;",C={};e(C),o=h(C),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(o.workerUrl=window.URL.createObjectURL(new Blob([y],{type:"text/javascript"})))}}s(["exports"],function(a){var h=typeof self<"u"?self:{},y="2.15.0";let C;const L={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(C==null){const c=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{C={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):c}catch{C=c}}return C},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!L.API_URL)return null;try{const c=new URL(L.API_URL);return c.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":c.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Y={supported:!1,testSupport:function(c){!Ir&&Bt&&(Wr?yi(c):ze=c)}};let ze,Bt,Ir=!1,Wr=!1;function yi(c){const u=c.createTexture();c.bindTexture(c.TEXTURE_2D,u);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,Bt),c.isContextLost())return;Y.supported=!0}catch{}c.deleteTexture(u),Ir=!0}h.document&&(Bt=h.document.createElement("img"),Bt.onload=function(){ze&&yi(ze),ze=null,Wr=!0},Bt.onerror=function(){Ir=!0,ze=null},Bt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Bn="01";function vi(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var wo=ia;function ia(c,u,p,w){this.cx=3*c,this.bx=3*(p-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(w-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=u,this.p2x=p,this.p2y=w}ia.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,u){if(u===void 0&&(u=1e-6),c<0)return 0;if(c>1)return 1;for(var p=c,w=0;w<8;w++){var A=this.sampleCurveX(p)-c;if(Math.abs(A)<u)return p;var N=this.sampleCurveDerivativeX(p);if(Math.abs(N)<1e-6)break;p-=A/N}var _e=0,dt=1;for(p=c,w=0;w<20&&(A=this.sampleCurveX(p),!(Math.abs(A-c)<u));w++)c>A?_e=p:dt=p,p=.5*(dt-_e)+_e;return p},solve:function(c,u){return this.sampleCurveY(this.solveCurveX(c,u))}};var gl=vi(wo),ml=il;function il(c,u){this.x=c,this.y=u}il.prototype={clone:function(){return new il(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,u){return this.clone()._rotateAround(c,u)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var u=c.x-this.x,p=c.y-this.y;return u*u+p*p},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,u){return Math.atan2(this.x*u-this.y*c,this.x*c+this.y*u)},_matMult:function(c){var u=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=u,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var u=Math.cos(c),p=Math.sin(c),w=p*this.x+u*this.y;return this.x=u*this.x-p*this.y,this.y=w,this},_rotateAround:function(c,u){var p=Math.cos(c),w=Math.sin(c),A=u.y+w*(this.x-u.x)+p*(this.y-u.y);return this.x=u.x+p*(this.x-u.x)-w*(this.y-u.y),this.y=A,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},il.convert=function(c){return c instanceof il?c:Array.isArray(c)?new il(c[0],c[1]):c};var sl=vi(ml);const ol=Math.PI/180,_l=180/Math.PI;function rh(c){return c*ol}function wh(c){return c*_l}const Fh=[[0,0],[1,0],[1,1],[0,1]];function Mh(c){if(c<=0)return 0;if(c>=1)return 1;const u=c*c,p=u*c;return 4*(c<.5?p:3*(c-u)+p-.75)}function vp(c,u,p,w){const A=new gl(c,u,p,w);return function(N){return A.solve(N)}}const gp=vp(.25,.1,.25,1);function Jh(c,u,p){return Math.min(p,Math.max(u,c))}function Lp(c,u,p){return(p=Jh((p-c)/(u-c),0,1))*p*(3-2*p)}function Ip(c,u,p){const w=p-u,A=((c-u)%w+w)%w+u;return A===u?p:A}function $p(c,u,p){if(!c.length)return p(null,[]);let w=c.length;const A=new Array(c.length);let N=null;c.forEach((_e,dt)=>{u(_e,(ir,Cr)=>{ir&&(N=ir),A[dt]=Cr,--w==0&&p(N,A)})})}function Xp(c){const u=[];for(const p in c)u.push(c[p]);return u}function Cp(c,...u){for(const p of u)for(const w in p)c[w]=p[w];return c}let Gp=1;function Rp(){return Gp++}function od(){return function c(u){return u?(u^Math.random()*(16>>u/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,c)}()}function Wp(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))}function Ld(c){return!!c&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(c)}function ed(c,u){c.forEach(p=>{u[p]&&(u[p]=u[p].bind(u))})}function Gd(c,u){return c.indexOf(u,c.length-u.length)!==-1}function Kp(c,u,p){const w={};for(const A in c)w[A]=u.call(p||this,c[A],A,c);return w}function Ad(c,u,p){const w={};for(const A in c)u.call(p||this,c[A],A,c)&&(w[A]=c[A]);return w}function Id(c){return Array.isArray(c)?c.map(Id):typeof c=="object"&&c?Kp(c,Id):c}const Yh={};function Ap(c){Yh[c]||(typeof console<"u"&&console.warn(c),Yh[c]=!0)}function kd(c,u,p){return(p.y-c.y)*(u.x-c.x)>(u.y-c.y)*(p.x-c.x)}function cd(c){let u=0;for(let p,w,A=0,N=c.length,_e=N-1;A<N;_e=A++)p=c[A],w=c[_e],u+=(w.x-p.x)*(p.y+w.y);return u}function id(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function fp(c){const u={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(p,w,A,N)=>{const _e=A||N;return u[w]=!_e||_e.toLowerCase(),""}),u["max-age"]){const p=parseInt(u["max-age"],10);isNaN(p)?delete u["max-age"]:u["max-age"]=p}return u}let Cd=null;function Fd(c){if(Cd==null){const u=c.navigator?c.navigator.userAgent:null;Cd=!!c.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return Cd}function yd(c){try{const u=h[c];return u.setItem("_mapbox_test_",1),u.removeItem("_mapbox_test_"),!0}catch{return!1}}function kp(c,u){return[c[4*u],c[4*u+1],c[4*u+2],c[4*u+3]]}const Uf="mapbox-tiles";let $f=500,up=50,ud,xd;function Ed(){try{return h.caches}catch{}}function Vd(){Ed()&&!ud&&(ud=h.caches.open(Uf))}function Ep(c){const u=c.indexOf("?");if(u<0)return c;const p=function(A){const N=A.indexOf("?");return N>0?A.slice(N+1).split("&"):[]}(c),w=p.filter(A=>{const N=A.split("=");return N[0]==="language"||N[0]==="worldview"});return w.length?`${c.slice(0,u)}?${w.join("&")}`:c.slice(0,u)}let Yp=1/0;const nd={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(nd);class $d extends Error{constructor(u,p,w){p===401&&vl(w)&&(u+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(u),this.status=p,this.url=w}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Qd=id()?()=>self.worker&&self.worker.referrer:()=>(h.location.protocol==="blob:"?h.parent:h).location.href,Rd=function(c,u){if(!(/^file:/.test(p=c.url)||/^file:/.test(Qd())&&!/^\w+:/.test(p))){if(h.fetch&&h.Request&&h.AbortController&&h.Request.prototype.hasOwnProperty("signal"))return function(w,A){const N=new h.AbortController,_e=new h.Request(w.url,{method:w.method||"GET",body:w.body,credentials:w.credentials,headers:w.headers,referrer:Qd(),referrerPolicy:w.referrerPolicy,signal:N.signal});let dt=!1,ir=!1;const Cr=(Gn=_e.url).indexOf("sku=")>0&&vl(Gn);var Gn;w.type==="json"&&_e.headers.set("Accept","application/json");const hs=(ll,ul,th)=>{if(ir)return;if(ll&&ll.message!=="SecurityError"&&Ap(ll.toString()),ul&&th)return rl(ul);const fh=Date.now();h.fetch(_e).then(Ch=>{if(Ch.ok){const zh=Cr?Ch.clone():null;return rl(Ch,zh,fh)}return A(new $d(Ch.statusText,Ch.status,w.url))}).catch(Ch=>{Ch.name!=="AbortError"&&A(new Error(`${Ch.message} ${w.url}`))})},rl=(ll,ul,th)=>{(w.type==="arrayBuffer"?ll.arrayBuffer():w.type==="json"?ll.json():ll.text()).then(fh=>{ir||(ul&&th&&function(Ch,zh,Eh){if(Vd(),!ud)return;const Bh={status:zh.status,statusText:zh.statusText,headers:new h.Headers};zh.headers.forEach((cp,sp)=>Bh.headers.set(sp,cp));const Hh=fp(zh.headers.get("Cache-Control")||"");if(Hh["no-store"])return;Hh["max-age"]&&Bh.headers.set("Expires",new Date(Eh+1e3*Hh["max-age"]).toUTCString());const jh=Bh.headers.get("Expires");jh&&(new Date(jh).getTime()-Eh<42e4||function(cp,sp){if(xd===void 0)try{new Response(new ReadableStream),xd=!0}catch{xd=!1}xd?sp(cp.body):cp.blob().then(sp)}(zh,cp=>{const sp=new h.Response(cp,Bh);Vd(),ud&&ud.then(Sp=>Sp.put(Ep(Ch.url),sp)).catch(Sp=>Ap(Sp.message))}))}(_e,ul,th),dt=!0,A(null,fh,ll.headers.get("Cache-Control"),ll.headers.get("Expires")))}).catch(fh=>{ir||A(new Error(fh.message))})};return Cr?function(ll,ul){if(Vd(),!ud)return ul(null);const th=Ep(ll.url);ud.then(fh=>{fh.match(th).then(Ch=>{const zh=function(Eh){if(!Eh)return!1;const Bh=new Date(Eh.headers.get("Expires")||0),Hh=fp(Eh.headers.get("Cache-Control")||"");return Bh>Date.now()&&!Hh["no-cache"]}(Ch);fh.delete(th),zh&&fh.put(th,Ch.clone()),ul(null,Ch,zh)}).catch(ul)}).catch(ul)}(_e,hs):hs(null,null),{cancel:()=>{ir=!0,dt||N.abort()}}}(c,u);if(id()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,u,void 0,!0)}var p;return function(w,A){const N=new h.XMLHttpRequest;N.open(w.method||"GET",w.url,!0),w.type==="arrayBuffer"&&(N.responseType="arraybuffer");for(const _e in w.headers)N.setRequestHeader(_e,w.headers[_e]);return w.type==="json"&&(N.responseType="text",N.setRequestHeader("Accept","application/json")),N.withCredentials=w.credentials==="include",N.onerror=()=>{A(new Error(N.statusText))},N.onload=()=>{if((N.status>=200&&N.status<300||N.status===0)&&N.response!==null){let _e=N.response;if(w.type==="json")try{_e=JSON.parse(N.response)}catch(dt){return A(dt)}A(null,_e,N.getResponseHeader("Cache-Control"),N.getResponseHeader("Expires"))}else A(new $d(N.statusText,N.status,w.url))},N.send(w.body),{cancel:()=>N.abort()}}(c,u)},ng=function(c,u){return Rd(Cp(c,{type:"arrayBuffer"}),u)};function bg(c){const u=h.document.createElement("a");return u.href=c,u.protocol===h.document.location.protocol&&u.host===h.document.location.host}const Ih="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let nh,sh;nh=[],sh=0;const oh=function(c,u){if(Y.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),sh>=L.MAX_PARALLEL_IMAGE_REQUESTS){const N={requestParameters:c,callback:u,cancelled:!1,cancel(){this.cancelled=!0}};return nh.push(N),N}sh++;let p=!1;const w=()=>{if(!p)for(p=!0,sh--;nh.length&&sh<L.MAX_PARALLEL_IMAGE_REQUESTS;){const N=nh.shift(),{requestParameters:_e,callback:dt,cancelled:ir}=N;ir||(N.cancel=oh(_e,dt).cancel)}},A=ng(c,(N,_e,dt,ir)=>{w(),N?u(N):_e&&(h.createImageBitmap?function(Cr,Gn){const hs=new h.Blob([new Uint8Array(Cr)],{type:"image/png"});h.createImageBitmap(hs).then(rl=>{Gn(null,rl)}).catch(rl=>{Gn(new Error(`Could not load image because of ${rl.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_e,(Cr,Gn)=>u(Cr,Gn,dt,ir)):function(Cr,Gn){const hs=new h.Image,rl=h.URL;hs.onload=()=>{Gn(null,hs),rl.revokeObjectURL(hs.src),hs.onload=null,h.requestAnimationFrame(()=>{hs.src=Ih})},hs.onerror=()=>Gn(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const ll=new h.Blob([new Uint8Array(Cr)],{type:"image/png"});hs.src=Cr.byteLength?rl.createObjectURL(ll):Ih}(_e,(Cr,Gn)=>u(Cr,Gn,dt,ir)))});return{cancel:()=>{A.cancel(),w()}}},Oh="NO_ACCESS_TOKEN";function Uh(c){return c.indexOf("mapbox:")===0}function vl(c){return L.API_URL_REGEX.test(c)}function gs(c){return L.API_CDN_URL_REGEX.test(c)}function di(c){return L.API_STYLE_REGEX.test(c)&&!fs(c)}function fs(c){return L.API_SPRITE_REGEX.test(c)}const cl=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ih(c){const u=c.match(cl);if(!u)throw new Error("Unable to parse URL object");return{protocol:u[1],authority:u[2],path:u[3]||"/",params:u[4]?u[4].split("&"):[]}}function uh(c){const u=c.params.length?`?${c.params.join("&")}`:"";return`${c.protocol}://${c.authority}${c.path}${u}`}const vh="mapbox.eventData";function Th(c){if(!c)return null;const u=c.split(".");if(!u||u.length!==3)return null;try{return JSON.parse(decodeURIComponent(h.atob(u[1]).split("").map(p=>"%"+("00"+p.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class kh{constructor(u){this.type=u,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(u){const p=Th(L.ACCESS_TOKEN);let w="";return w=p&&p.u?h.btoa(encodeURIComponent(p.u).replace(/%([0-9A-F]{2})/g,(A,N)=>String.fromCharCode(+("0x"+N)))):L.ACCESS_TOKEN||"",u?`${vh}.${u}:${w}`:`${vh}:${w}`}fetchEventData(){const u=yd("localStorage"),p=this.getStorageKey(),w=this.getStorageKey("uuid");if(u)try{const A=h.localStorage.getItem(p);A&&(this.eventData=JSON.parse(A));const N=h.localStorage.getItem(w);N&&(this.anonId=N)}catch{Ap("Unable to read from LocalStorage")}}saveEventData(){const u=yd("localStorage"),p=this.getStorageKey(),w=this.getStorageKey("uuid");if(u)try{h.localStorage.setItem(w,this.anonId),Object.keys(this.eventData).length>=1&&h.localStorage.setItem(p,JSON.stringify(this.eventData))}catch{Ap("Unable to write to LocalStorage")}}processRequests(u){}postEvent(u,p,w,A){if(!L.EVENTS_URL)return;const N=ih(L.EVENTS_URL);N.params.push(`access_token=${A||L.ACCESS_TOKEN||""}`);const _e={event:this.type,created:new Date(u).toISOString()},dt=p?Cp(_e,p):_e,ir={url:uh(N),headers:{"Content-Type":"text/plain"},body:JSON.stringify([dt])};this.pendingRequest=function(Cr,Gn){return Rd(Cp(Cr,{method:"POST"}),Gn)}(ir,Cr=>{this.pendingRequest=null,w(Cr),this.saveEventData(),this.processRequests(A)})}queueRequest(u,p){this.queue.push(u),this.processRequests(p)}}const ep=new class extends kh{constructor(c){super("appUserTurnstile"),this._customAccessToken=c}postTurnstileEvent(c,u){L.EVENTS_URL&&L.ACCESS_TOKEN&&Array.isArray(c)&&c.some(p=>Uh(p)||vl(p))&&this.queueRequest(Date.now(),u)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const u=Th(L.ACCESS_TOKEN),p=u?u.u:L.ACCESS_TOKEN;let w=p!==this.eventData.tokenU;Ld(this.anonId)||(this.anonId=od(),w=!0);const A=this.queue.shift();if(this.eventData.lastSuccess){const N=new Date(this.eventData.lastSuccess),_e=new Date(A),dt=(A-this.eventData.lastSuccess)/864e5;w=w||dt>=1||dt<-1||N.getDate()!==_e.getDate()}else w=!0;w?this.postEvent(A,{sdkIdentifier:"mapbox-gl-js",sdkVersion:y,skuId:Bn,"enabled.telemetry":!1,userId:this.anonId},N=>{N||(this.eventData.lastSuccess=A,this.eventData.tokenU=p)},c):this.processRequests()}},ip=ep.postTurnstileEvent.bind(ep),_p=new class extends kh{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(c,u,p,w){this.skuToken=u,this.errorCb=w,L.EVENTS_URL&&(p||L.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},p):this.errorCb(new Error(Oh)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:u,timestamp:p}=this.queue.shift();u&&this.success[u]||(this.anonId||this.fetchEventData(),Ld(this.anonId)||(this.anonId=od()),this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:y,skuId:Bn,skuToken:this.skuToken,userId:this.anonId},w=>{w?this.errorCb(w):u&&(this.success[u]=!0)},c))}},rd=_p.postMapLoadEvent.bind(_p),Dd=new class extends kh{constructor(){super("gljs.performance")}postPerformanceEvent(c,u){L.EVENTS_URL&&(c||L.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:u},c)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:u,performanceData:p}=this.queue.shift(),w=function(A){const N=h.performance.getEntriesByType("resource"),_e=h.performance.getEntriesByType("mark"),dt=function(rl){const ll={};if(rl){for(const ul in rl)if(ul!=="other")for(const th of rl[ul]){const fh=`${ul}ResolveRangeMin`,Ch=`${ul}ResolveRangeMax`,zh=`${ul}RequestCount`,Eh=`${ul}RequestCachedCount`;ll[fh]=Math.min(ll[fh]||1/0,th.startTime),ll[Ch]=Math.max(ll[Ch]||-1/0,th.responseEnd);const Bh=Hh=>{ll[Hh]===void 0&&(ll[Hh]=0),++ll[Hh]};th.transferSize!==void 0&&th.transferSize===0&&Bh(Eh),Bh(zh)}}return ll}(function(rl,ll){const ul={};if(rl)for(const th of rl){const fh=ll(th);ul[fh]===void 0&&(ul[fh]=[]),ul[fh].push(th)}return ul}(N,pg)),ir=h.devicePixelRatio,Cr=h.navigator.connection||h.navigator.mozConnection||h.navigator.webkitConnection,Gn={counters:[],metadata:[],attributes:[]},hs=(rl,ll,ul)=>{ul!=null&&rl.push({name:ll,value:ul.toString()})};for(const rl in dt)hs(Gn.counters,rl,dt[rl]);if(A.interactionRange[0]!==1/0&&A.interactionRange[1]!==-1/0&&(hs(Gn.counters,"interactionRangeMin",A.interactionRange[0]),hs(Gn.counters,"interactionRangeMax",A.interactionRange[1])),_e)for(const rl of Object.keys(Vf)){const ll=Vf[rl],ul=_e.find(th=>th.name===ll);ul&&hs(Gn.counters,ll,ul.startTime)}return hs(Gn.counters,"visibilityHidden",A.visibilityHidden),hs(Gn.attributes,"style",function(rl){if(rl)for(const ll of rl){const ul=ll.name.split("?")[0];if(di(ul)){const th=ul.split("/").slice(-2);if(th.length===2)return`mapbox://styles/${th[0]}/${th[1]}`}}}(N)),hs(Gn.attributes,"terrainEnabled",A.terrainEnabled?"true":"false"),hs(Gn.attributes,"fogEnabled",A.fogEnabled?"true":"false"),hs(Gn.attributes,"projection",A.projection),hs(Gn.attributes,"zoom",A.zoom),hs(Gn.metadata,"devicePixelRatio",ir),hs(Gn.metadata,"connectionEffectiveType",Cr?Cr.effectiveType:void 0),hs(Gn.metadata,"navigatorUserAgent",h.navigator.userAgent),hs(Gn.metadata,"screenWidth",h.screen.width),hs(Gn.metadata,"screenHeight",h.screen.height),hs(Gn.metadata,"windowWidth",h.innerWidth),hs(Gn.metadata,"windowHeight",h.innerHeight),hs(Gn.metadata,"mapWidth",A.width/ir),hs(Gn.metadata,"mapHeight",A.height/ir),hs(Gn.metadata,"webglRenderer",A.renderer),hs(Gn.metadata,"webglVendor",A.vendor),hs(Gn.metadata,"sdkVersion",y),hs(Gn.metadata,"sdkIdentifier","mapbox-gl-js"),Gn}(p);for(const A of w.metadata);for(const A of w.counters);for(const A of w.attributes);this.postEvent(u,w,()=>{},c)}},qp=Dd.postPerformanceEvent.bind(Dd),wd=new class extends kh{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(c,u,p,w){if(!L.API_URL||!L.SESSION_PATH)return;const A=ih(L.API_URL+L.SESSION_PATH);A.params.push(`sku=${u||""}`),A.params.push(`access_token=${w||L.ACCESS_TOKEN||""}`);const N={url:uh(A),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(_e,dt){return Rd(Cp(_e,{method:"GET"}),dt)}(N,_e=>{this.pendingRequest=null,p(_e),this.saveEventData(),this.processRequests(w)})}getSessionAPI(c,u,p,w){this.skuToken=u,this.errorCb=w,L.SESSION_PATH&&L.API_URL&&(p||L.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},p):this.errorCb(new Error(Oh)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:u,timestamp:p}=this.queue.shift();u&&this.success[u]||this.getSession(p,this.skuToken,w=>{w?this.errorCb(w):u&&(this.success[u]=!0)},c)}},dd=wd.getSessionAPI.bind(wd),Wd=new Set,Vf={create:"create",load:"load",fullLoad:"fullLoad"},Wf={mark(c){h.performance.mark(c)},measure(c,u,p){h.performance.measure(c,u,p)}};function pg(c){const u=c.name.split("?")[0];return gs(u)&&u.includes("mapbox-gl.js")?"javascript":gs(u)&&u.includes("mapbox-gl.css")?"css":function(p){return L.API_FONTS_REGEX.test(p)}(u)?"fontRange":fs(u)?"sprite":di(u)?"style":function(p){return L.API_TILEJSON_REGEX.test(p)}(u)?"tilejson":"other"}const Jd=h.performance;function Yd(c){const u=c?c.url.toString():void 0;return Jd.getEntriesByName(u)}let Cg,oy,Bg,Xg;const nm={now:()=>Bg!==void 0?Bg:h.performance.now(),setNow(c){Bg=c},restoreNow(){Bg=void 0},frame(c){const u=h.requestAnimationFrame(c);return{cancel:()=>h.cancelAnimationFrame(u)}},getImageData(c,u=0){const{width:p,height:w}=c;Xg||(Xg=h.document.createElement("canvas"));const A=Xg.getContext("2d",{willReadFrequently:!0});if(!A)throw new Error("failed to create canvas 2d context");return(p>Xg.width||w>Xg.height)&&(Xg.width=p,Xg.height=w),A.clearRect(-u,-u,p+2*u,w+2*u),A.drawImage(c,0,0,p,w),A.getImageData(-u,-u,p+2*u,w+2*u)},resolveURL:c=>(Cg||(Cg=h.document.createElement("a")),Cg.href=c,Cg.href),get devicePixelRatio(){return h.devicePixelRatio},get prefersReducedMotion(){return!!h.matchMedia&&(oy==null&&(oy=h.matchMedia("(prefers-reduced-motion: reduce)")),oy.matches)}};function u_(c,u,p){p[c]&&p[c].indexOf(u)!==-1||(p[c]=p[c]||[],p[c].push(u))}function xv(c,u,p){if(p&&p[c]){const w=p[c].indexOf(u);w!==-1&&p[c].splice(w,1)}}class Dg{constructor(u,p={}){Cp(this,p),this.type=u}}class sy extends Dg{constructor(u,p={}){super("error",Cp({error:u},p))}}class fy{on(u,p){return this._listeners=this._listeners||{},u_(u,p,this._listeners),this}off(u,p){return xv(u,p,this._listeners),xv(u,p,this._oneTimeListeners),this}once(u,p){return p?(this._oneTimeListeners=this._oneTimeListeners||{},u_(u,p,this._oneTimeListeners),this):new Promise(w=>this.once(u,w))}fire(u,p){typeof u=="string"&&(u=new Dg(u,p||{}));const w=u.type;if(this.listens(w)){u.target=this;const A=this._listeners&&this._listeners[w]?this._listeners[w].slice():[];for(const dt of A)dt.call(this,u);const N=this._oneTimeListeners&&this._oneTimeListeners[w]?this._oneTimeListeners[w].slice():[];for(const dt of N)xv(w,dt,this._oneTimeListeners),dt.call(this,u);const _e=this._eventedParent;_e&&(Cp(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_e.fire(u))}else u instanceof sy&&console.error(u.error);return this}listens(u){return!!(this._listeners&&this._listeners[u]&&this._listeners[u].length>0||this._oneTimeListeners&&this._oneTimeListeners[u]&&this._oneTimeListeners[u].length>0||this._eventedParent&&this._eventedParent.listens(u))}setEventedParent(u,p){return this._eventedParent=u,this._eventedParentData=p,this}}var hp=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function gy(c,...u){for(const p of u)for(const w in p)c[w]=p[w];return c}function xg(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function hm(c){if(Array.isArray(c))return c.map(hm);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const u={};for(const p in c)u[p]=hm(c[p]);return u}return xg(c)}class xm extends Error{constructor(u,p){super(p),this.message=p,this.key=u}}var my=xm;class wv{constructor(u,p=[]){this.parent=u,this.bindings={};for(const[w,A]of p)this.bindings[w]=A}concat(u){return new wv(this,u)}get(u){if(this.bindings[u])return this.bindings[u];if(this.parent)return this.parent.get(u);throw new Error(`${u} not found in scope.`)}has(u){return!!this.bindings[u]||!!this.parent&&this.parent.has(u)}}var qy=wv;const lg={kind:"null"},ad={kind:"number"},qf={kind:"string"},Hf={kind:"boolean"},Wm={kind:"color"},yy={kind:"object"},Kf={kind:"value"},qm={kind:"collator"},k_={kind:"formatted"},B_={kind:"resolvedImage"};function ay(c,u){return{kind:"array",itemType:c,N:u}}function Og(c){if(c.kind==="array"){const u=Og(c.itemType);return typeof c.N=="number"?`array<${u}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${u}>`}return c.kind}const B0=[lg,ad,qf,Hf,Wm,k_,yy,ay(Kf),B_];function Ey(c,u){if(u.kind==="error")return null;if(c.kind==="array"){if(u.kind==="array"&&(u.N===0&&u.itemType.kind==="value"||!Ey(c.itemType,u.itemType))&&(typeof c.N!="number"||c.N===u.N))return null}else{if(c.kind===u.kind)return null;if(c.kind==="value"){for(const p of B0)if(!Ey(p,u))return null}}return`Expected ${Og(c)} but found ${Og(u)} instead.`}function z_(c,u){return u.some(p=>p.kind===c.kind)}function bv(c,u){return u.some(p=>p==="null"?c===null:p==="array"?Array.isArray(c):p==="object"?c&&!Array.isArray(c)&&typeof c=="object":p===typeof c)}var z0,Ly={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function c_(c){return(c=Math.round(c))<0?0:c>255?255:c}function Fm(c){return c_(c[c.length-1]==="%"?parseFloat(c)/100*255:parseInt(c))}function G_(c){return(u=c[c.length-1]==="%"?parseFloat(c)/100:parseFloat(c))<0?0:u>1?1:u;var u}function Fy(c,u,p){return p<0?p+=1:p>1&&(p-=1),6*p<1?c+(u-c)*p*6:2*p<1?u:3*p<2?c+(u-c)*(2/3-p)*6:c}try{z0={}.parseCSSColor=function(c){var u,p=c.replace(/ /g,"").toLowerCase();if(p in Ly)return Ly[p].slice();if(p[0]==="#")return p.length===4?(u=parseInt(p.substr(1),16))>=0&&u<=4095?[(3840&u)>>4|(3840&u)>>8,240&u|(240&u)>>4,15&u|(15&u)<<4,1]:null:p.length===7&&(u=parseInt(p.substr(1),16))>=0&&u<=16777215?[(16711680&u)>>16,(65280&u)>>8,255&u,1]:null;var w=p.indexOf("("),A=p.indexOf(")");if(w!==-1&&A+1===p.length){var N=p.substr(0,w),_e=p.substr(w+1,A-(w+1)).split(","),dt=1;switch(N){case"rgba":if(_e.length!==4)return null;dt=G_(_e.pop());case"rgb":return _e.length!==3?null:[Fm(_e[0]),Fm(_e[1]),Fm(_e[2]),dt];case"hsla":if(_e.length!==4)return null;dt=G_(_e.pop());case"hsl":if(_e.length!==3)return null;var ir=(parseFloat(_e[0])%360+360)%360/360,Cr=G_(_e[1]),Gn=G_(_e[2]),hs=Gn<=.5?Gn*(Cr+1):Gn+Cr-Gn*Cr,rl=2*Gn-hs;return[c_(255*Fy(rl,hs,ir+1/3)),c_(255*Fy(rl,hs,ir)),c_(255*Fy(rl,hs,ir-1/3)),dt];default:return null}}return null}}catch{}class pm{constructor(u,p,w,A=1){this.r=u,this.g=p,this.b=w,this.a=A}static parse(u){if(!u)return;if(u instanceof pm)return u;if(typeof u!="string")return;const p=z0(u);return p?new pm(p[0]/255*p[3],p[1]/255*p[3],p[2]/255*p[3],p[3]):void 0}toString(){const[u,p,w,A]=this.toArray();return`rgba(${Math.round(u)},${Math.round(p)},${Math.round(w)},${A})`}toArray(){const{r:u,g:p,b:w,a:A}=this;return A===0?[0,0,0,0]:[255*u/A,255*p/A,255*w/A,A]}toArray01(){const{r:u,g:p,b:w,a:A}=this;return A===0?[0,0,0,0]:[u/A,p/A,w/A,A]}toArray01PremultipliedAlpha(){const{r:u,g:p,b:w,a:A}=this;return[u,p,w,A]}}pm.black=new pm(0,0,0,1),pm.white=new pm(1,1,1,1),pm.transparent=new pm(0,0,0,0),pm.red=new pm(1,0,0,1),pm.blue=new pm(0,0,1,1);var zg=pm;class Cv{constructor(u,p,w){this.sensitivity=u?p?"variant":"case":p?"accent":"base",this.locale=w,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(u,p){return this.collator.compare(u,p)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class h_{constructor(u,p,w,A,N){this.text=u.normalize?u.normalize():u,this.image=p,this.scale=w,this.fontStack=A,this.textColor=N}}class dm{constructor(u){this.sections=u}static fromString(u){return new dm([new h_(u,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(u=>u.text.length!==0||u.image&&u.image.name.length!==0)}static factory(u){return u instanceof dm?u:dm.fromString(u)}toString(){return this.sections.length===0?"":this.sections.map(u=>u.text).join("")}serialize(){const u=["format"];for(const p of this.sections){if(p.image){u.push(["image",p.image.name]);continue}u.push(p.text);const w={};p.fontStack&&(w["text-font"]=["literal",p.fontStack.split(",")]),p.scale&&(w["font-scale"]=p.scale),p.textColor&&(w["text-color"]=["rgba"].concat(p.textColor.toArray())),u.push(w)}return u}}class Vm{constructor(u){this.name=u.name,this.available=u.available}toString(){return this.name}static fromString(u){return u?new Vm({name:u,available:!1}):null}serialize(){return["image",this.name]}}function Km(c,u,p,w){return typeof c=="number"&&c>=0&&c<=255&&typeof u=="number"&&u>=0&&u<=255&&typeof p=="number"&&p>=0&&p<=255?w===void 0||typeof w=="number"&&w>=0&&w<=1?null:`Invalid rgba value [${[c,u,p,w].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof w=="number"?[c,u,p,w]:[c,u,p]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Em(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof zg||c instanceof Cv||c instanceof dm||c instanceof Vm)return!0;if(Array.isArray(c)){for(const u of c)if(!Em(u))return!1;return!0}if(typeof c=="object"){for(const u in c)if(!Em(c[u]))return!1;return!0}return!1}function Gg(c){if(c===null)return lg;if(typeof c=="string")return qf;if(typeof c=="boolean")return Hf;if(typeof c=="number")return ad;if(c instanceof zg)return Wm;if(c instanceof Cv)return qm;if(c instanceof dm)return k_;if(c instanceof Vm)return B_;if(Array.isArray(c)){const u=c.length;let p;for(const w of c){const A=Gg(w);if(p){if(p===A)continue;p=Kf;break}p=A}return ay(p||Kf,u)}return yy}function p_(c){const u=typeof c;return c===null?"":u==="string"||u==="number"||u==="boolean"?String(c):c instanceof zg||c instanceof dm||c instanceof Vm?c.toString():JSON.stringify(c)}class Ev{constructor(u,p){this.type=u,this.value=p}static parse(u,p){if(u.length!==2)return p.error(`'literal' expression requires exactly one argument, but found ${u.length-1} instead.`);if(!Em(u[1]))return p.error("invalid value");const w=u[1];let A=Gg(w);const N=p.expectedType;return A.kind!=="array"||A.N!==0||!N||N.kind!=="array"||typeof N.N=="number"&&N.N!==0||(A=N),new Ev(A,w)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof zg?["rgba"].concat(this.value.toArray()):this.value instanceof dm?this.value.serialize():this.value}}var Ky=Ev,em=class{constructor(c){this.name="ExpressionEvaluationError",this.message=c}toJSON(){return this.message}};const Zy={string:qf,number:ad,boolean:Hf,object:yy};class ug{constructor(u,p){this.type=u,this.args=p}static parse(u,p){if(u.length<2)return p.error("Expected at least one argument.");let w,A=1;const N=u[0];if(N==="array"){let dt,ir;if(u.length>2){const Cr=u[1];if(typeof Cr!="string"||!(Cr in Zy)||Cr==="object")return p.error('The item type argument of "array" must be one of string, number, boolean',1);dt=Zy[Cr],A++}else dt=Kf;if(u.length>3){if(u[2]!==null&&(typeof u[2]!="number"||u[2]<0||u[2]!==Math.floor(u[2])))return p.error('The length argument to "array" must be a positive integer literal',2);ir=u[2],A++}w=ay(dt,ir)}else w=Zy[N];const _e=[];for(;A<u.length;A++){const dt=p.parse(u[A],A,Kf);if(!dt)return null;_e.push(dt)}return new ug(w,_e)}evaluate(u){for(let p=0;p<this.args.length;p++){const w=this.args[p].evaluate(u);if(!Ey(this.type,Gg(w)))return w;if(p===this.args.length-1)throw new em(`Expected value to be of type ${Og(this.type)}, but found ${Og(Gg(w))} instead.`)}return null}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every(u=>u.outputDefined())}serialize(){const u=this.type,p=[u.kind];if(u.kind==="array"){const w=u.itemType;if(w.kind==="string"||w.kind==="number"||w.kind==="boolean"){p.push(w.kind);const A=u.N;(typeof A=="number"||this.args.length>1)&&p.push(A)}}return p.concat(this.args.map(w=>w.serialize()))}}var Sy=ug;class Ty{constructor(u){this.type=k_,this.sections=u}static parse(u,p){if(u.length<2)return p.error("Expected at least one argument.");const w=u[1];if(!Array.isArray(w)&&typeof w=="object")return p.error("First argument must be an image or text section.");const A=[];let N=!1;for(let _e=1;_e<=u.length-1;++_e){const dt=u[_e];if(N&&typeof dt=="object"&&!Array.isArray(dt)){N=!1;let ir=null;if(dt["font-scale"]&&(ir=p.parse(dt["font-scale"],1,ad),!ir))return null;let Cr=null;if(dt["text-font"]&&(Cr=p.parse(dt["text-font"],1,ay(qf)),!Cr))return null;let Gn=null;if(dt["text-color"]&&(Gn=p.parse(dt["text-color"],1,Wm),!Gn))return null;const hs=A[A.length-1];hs.scale=ir,hs.font=Cr,hs.textColor=Gn}else{const ir=p.parse(u[_e],1,Kf);if(!ir)return null;const Cr=ir.type.kind;if(Cr!=="string"&&Cr!=="value"&&Cr!=="null"&&Cr!=="resolvedImage")return p.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");N=!0,A.push({content:ir,scale:null,font:null,textColor:null})}}return new Ty(A)}evaluate(u){return new dm(this.sections.map(p=>{const w=p.content.evaluate(u);return Gg(w)===B_?new h_("",w,null,null,null):new h_(p_(w),null,p.scale?p.scale.evaluate(u):null,p.font?p.font.evaluate(u).join(","):null,p.textColor?p.textColor.evaluate(u):null)}))}eachChild(u){for(const p of this.sections)u(p.content),p.scale&&u(p.scale),p.font&&u(p.font),p.textColor&&u(p.textColor)}outputDefined(){return!1}serialize(){const u=["format"];for(const p of this.sections){u.push(p.content.serialize());const w={};p.scale&&(w["font-scale"]=p.scale.serialize()),p.font&&(w["text-font"]=p.font.serialize()),p.textColor&&(w["text-color"]=p.textColor.serialize()),u.push(w)}return u}}class a0{constructor(u){this.type=B_,this.input=u}static parse(u,p){if(u.length!==2)return p.error("Expected two arguments.");const w=p.parse(u[1],1,qf);return w?new a0(w):p.error("No image name provided.")}evaluate(u){const p=this.input.evaluate(u),w=Vm.fromString(p);return w&&u.availableImages&&(w.available=u.availableImages.indexOf(p)>-1),w}eachChild(u){u(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const zx={"to-boolean":Hf,"to-color":Wm,"to-number":ad,"to-string":qf};class d_{constructor(u,p){this.type=u,this.args=p}static parse(u,p){if(u.length<2)return p.error("Expected at least one argument.");const w=u[0];if((w==="to-boolean"||w==="to-string")&&u.length!==2)return p.error("Expected one argument.");const A=zx[w],N=[];for(let _e=1;_e<u.length;_e++){const dt=p.parse(u[_e],_e,Kf);if(!dt)return null;N.push(dt)}return new d_(A,N)}evaluate(u){if(this.type.kind==="boolean")return!!this.args[0].evaluate(u);if(this.type.kind==="color"){let p,w;for(const A of this.args){if(p=A.evaluate(u),w=null,p instanceof zg)return p;if(typeof p=="string"){const N=u.parseColor(p);if(N)return N}else if(Array.isArray(p)&&(w=p.length<3||p.length>4?`Invalid rbga value ${JSON.stringify(p)}: expected an array containing either three or four numeric values.`:Km(p[0],p[1],p[2],p[3]),!w))return new zg(p[0]/255,p[1]/255,p[2]/255,p[3])}throw new em(w||`Could not parse color from value '${typeof p=="string"?p:String(JSON.stringify(p))}'`)}if(this.type.kind==="number"){let p=null;for(const w of this.args){if(p=w.evaluate(u),p===null)return 0;const A=Number(p);if(!isNaN(A))return A}throw new em(`Could not convert ${JSON.stringify(p)} to number.`)}return this.type.kind==="formatted"?dm.fromString(p_(this.args[0].evaluate(u))):this.type.kind==="resolvedImage"?Vm.fromString(p_(this.args[0].evaluate(u))):p_(this.args[0].evaluate(u))}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every(u=>u.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ty([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new a0(this.args[0]).serialize();const u=[`to-${this.type.kind}`];return this.eachChild(p=>{u.push(p.serialize())}),u}}var Sv=d_;const Ny=["Unknown","Point","LineString","Polygon"];var xx=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ny[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const c=this.featureDistanceData.center,u=this.featureDistanceData.scale,{x:p,y:w}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(p*u-c[0])+this.featureDistanceData.bearing[1]*(w*u-c[1])}return 0}parseColor(c){let u=this._parseColorCache[c];return u||(u=this._parseColorCache[c]=zg.parse(c)),u}};class V_{constructor(u,p,w,A){this.name=u,this.type=p,this._evaluate=w,this.args=A}evaluate(u){return this._evaluate(u,this.args)}eachChild(u){this.args.forEach(u)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(u=>u.serialize()))}static parse(u,p){const w=u[0],A=V_.definitions[w];if(!A)return p.error(`Unknown expression "${w}". If you wanted a literal array, use ["literal", [...]].`,0);const N=Array.isArray(A)?A[0]:A.type,_e=Array.isArray(A)?[[A[1],A[2]]]:A.overloads,dt=_e.filter(([Cr])=>!Array.isArray(Cr)||Cr.length===u.length-1);let ir=null;for(const[Cr,Gn]of dt){ir=new Iv(p.registry,p.path,null,p.scope);const hs=[];let rl=!1;for(let ll=1;ll<u.length;ll++){const ul=u[ll],th=Array.isArray(Cr)?Cr[ll-1]:Cr.type,fh=ir.parse(ul,1+hs.length,th);if(!fh){rl=!0;break}hs.push(fh)}if(!rl)if(Array.isArray(Cr)&&Cr.length!==hs.length)ir.error(`Expected ${Cr.length} arguments, but found ${hs.length} instead.`);else{for(let ll=0;ll<hs.length;ll++){const ul=Array.isArray(Cr)?Cr[ll]:Cr.type,th=hs[ll];ir.concat(ll+1).checkSubtype(ul,th.type)}if(ir.errors.length===0)return new V_(w,N,Gn,hs)}}if(dt.length===1)p.errors.push(...ir.errors);else{const Cr=(dt.length?dt:_e).map(([hs])=>{return rl=hs,Array.isArray(rl)?`(${rl.map(Og).join(", ")})`:`(${Og(rl.type)}...)`;var rl}).join(" | "),Gn=[];for(let hs=1;hs<u.length;hs++){const rl=p.parse(u[hs],1+Gn.length);if(!rl)return null;Gn.push(Og(rl.type))}p.error(`Expected arguments of type ${Cr}, but found (${Gn.join(", ")}) instead.`)}return null}static register(u,p){V_.definitions=p;for(const w in p)u[w]=V_}}var Xy=V_;class l0{constructor(u,p,w){this.type=qm,this.locale=w,this.caseSensitive=u,this.diacriticSensitive=p}static parse(u,p){if(u.length!==2)return p.error("Expected one argument.");const w=u[1];if(typeof w!="object"||Array.isArray(w))return p.error("Collator options argument must be an object.");const A=p.parse(w["case-sensitive"]!==void 0&&w["case-sensitive"],1,Hf);if(!A)return null;const N=p.parse(w["diacritic-sensitive"]!==void 0&&w["diacritic-sensitive"],1,Hf);if(!N)return null;let _e=null;return w.locale&&(_e=p.parse(w.locale,1,qf),!_e)?null:new l0(A,N,_e)}evaluate(u){return new Cv(this.caseSensitive.evaluate(u),this.diacriticSensitive.evaluate(u),this.locale?this.locale.evaluate(u):null)}eachChild(u){u(this.caseSensitive),u(this.diacriticSensitive),this.locale&&u(this.locale)}outputDefined(){return!1}serialize(){const u={};return u["case-sensitive"]=this.caseSensitive.serialize(),u["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(u.locale=this.locale.serialize()),["collator",u]}}const Ay=8192;function $_(c,u){c[0]=Math.min(c[0],u[0]),c[1]=Math.min(c[1],u[1]),c[2]=Math.max(c[2],u[0]),c[3]=Math.max(c[3],u[1])}function f_(c,u){return!(c[0]<=u[0]||c[2]>=u[2]||c[1]<=u[1]||c[3]>=u[3])}function U_(c,u){const p=(180+c[0])/360,w=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,A=Math.pow(2,u.z);return[Math.round(p*A*Ay),Math.round(w*A*Ay)]}function j_(c,u,p){const w=c[0]-u[0],A=c[1]-u[1],N=c[0]-p[0],_e=c[1]-p[1];return w*_e-N*A==0&&w*N<=0&&A*_e<=0}function u0(c,u){let p=!1;for(let _e=0,dt=u.length;_e<dt;_e++){const ir=u[_e];for(let Cr=0,Gn=ir.length;Cr<Gn-1;Cr++){if(j_(c,ir[Cr],ir[Cr+1]))return!1;(A=ir[Cr])[1]>(w=c)[1]!=(N=ir[Cr+1])[1]>w[1]&&w[0]<(N[0]-A[0])*(w[1]-A[1])/(N[1]-A[1])+A[0]&&(p=!p)}}var w,A,N;return p}function G0(c,u){for(let p=0;p<u.length;p++)if(u0(c,u[p]))return!0;return!1}function c0(c,u,p,w){const A=w[0]-p[0],N=w[1]-p[1],_e=(c[0]-p[0])*N-A*(c[1]-p[1]),dt=(u[0]-p[0])*N-A*(u[1]-p[1]);return _e>0&&dt<0||_e<0&&dt>0}function _y(c,u,p){for(const Cr of p)for(let Gn=0;Gn<Cr.length-1;++Gn)if((dt=[(_e=Cr[Gn+1])[0]-(N=Cr[Gn])[0],_e[1]-N[1]])[0]*(ir=[(A=u)[0]-(w=c)[0],A[1]-w[1]])[1]-dt[1]*ir[0]!=0&&c0(w,A,N,_e)&&c0(N,_e,w,A))return!0;var w,A,N,_e,dt,ir;return!1}function hg(c,u){for(let p=0;p<c.length;++p)if(!u0(c[p],u))return!1;for(let p=0;p<c.length-1;++p)if(_y(c[p],c[p+1],u))return!1;return!0}function Tv(c,u){for(let p=0;p<u.length;p++)if(hg(c,u[p]))return!0;return!1}function g_(c,u,p){const w=[];for(let A=0;A<c.length;A++){const N=[];for(let _e=0;_e<c[A].length;_e++){const dt=U_(c[A][_e],p);$_(u,dt),N.push(dt)}w.push(N)}return w}function wx(c,u,p){const w=[];for(let A=0;A<c.length;A++){const N=g_(c[A],u,p);w.push(N)}return w}function h0(c,u,p,w){if(c[0]<p[0]||c[0]>p[2]){const A=.5*w;let N=c[0]-p[0]>A?-w:p[0]-c[0]>A?w:0;N===0&&(N=c[0]-p[2]>A?-w:p[2]-c[0]>A?w:0),c[0]+=N}$_(u,c)}function yg(c,u,p,w){const A=Math.pow(2,w.z)*Ay,N=[w.x*Ay,w.y*Ay],_e=[];if(!c)return _e;for(const dt of c)for(const ir of dt){const Cr=[ir.x+N[0],ir.y+N[1]];h0(Cr,u,p,A),_e.push(Cr)}return _e}function Av(c,u,p,w){const A=Math.pow(2,w.z)*Ay,N=[w.x*Ay,w.y*Ay],_e=[];if(!c)return _e;for(const ir of c){const Cr=[];for(const Gn of ir){const hs=[Gn.x+N[0],Gn.y+N[1]];$_(u,hs),Cr.push(hs)}_e.push(Cr)}if(u[2]-u[0]<=A/2){(dt=u)[0]=dt[1]=1/0,dt[2]=dt[3]=-1/0;for(const ir of _e)for(const Cr of ir)h0(Cr,u,p,A)}var dt;return _e}class Rv{constructor(u,p){this.type=Hf,this.geojson=u,this.geometries=p}static parse(u,p){if(u.length!==2)return p.error(`'within' expression requires exactly one argument, but found ${u.length-1} instead.`);if(Em(u[1])){const w=u[1];if(w.type==="FeatureCollection")for(let A=0;A<w.features.length;++A){const N=w.features[A].geometry.type;if(N==="Polygon"||N==="MultiPolygon")return new Rv(w,w.features[A].geometry)}else if(w.type==="Feature"){const A=w.geometry.type;if(A==="Polygon"||A==="MultiPolygon")return new Rv(w,w.geometry)}else if(w.type==="Polygon"||w.type==="MultiPolygon")return new Rv(w,w)}return p.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(u){if(u.geometry()!=null&&u.canonicalID()!=null){if(u.geometryType()==="Point")return function(p,w){const A=[1/0,1/0,-1/0,-1/0],N=[1/0,1/0,-1/0,-1/0],_e=p.canonicalID();if(!_e)return!1;if(w.type==="Polygon"){const dt=g_(w.coordinates,N,_e),ir=yg(p.geometry(),A,N,_e);if(!f_(A,N))return!1;for(const Cr of ir)if(!u0(Cr,dt))return!1}if(w.type==="MultiPolygon"){const dt=wx(w.coordinates,N,_e),ir=yg(p.geometry(),A,N,_e);if(!f_(A,N))return!1;for(const Cr of ir)if(!G0(Cr,dt))return!1}return!0}(u,this.geometries);if(u.geometryType()==="LineString")return function(p,w){const A=[1/0,1/0,-1/0,-1/0],N=[1/0,1/0,-1/0,-1/0],_e=p.canonicalID();if(!_e)return!1;if(w.type==="Polygon"){const dt=g_(w.coordinates,N,_e),ir=Av(p.geometry(),A,N,_e);if(!f_(A,N))return!1;for(const Cr of ir)if(!hg(Cr,dt))return!1}if(w.type==="MultiPolygon"){const dt=wx(w.coordinates,N,_e),ir=Av(p.geometry(),A,N,_e);if(!f_(A,N))return!1;for(const Cr of ir)if(!Tv(Cr,dt))return!1}return!0}(u,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var p0=Rv;function ky(c){if(c instanceof Xy&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof p0)return!1;let u=!0;return c.eachChild(p=>{u&&!ky(p)&&(u=!1)}),u}function Yy(c){if(c instanceof Xy&&c.name==="feature-state")return!1;let u=!0;return c.eachChild(p=>{u&&!Yy(p)&&(u=!1)}),u}function Jy(c,u){if(c instanceof Xy&&u.indexOf(c.name)>=0)return!1;let p=!0;return c.eachChild(w=>{p&&!Jy(w,u)&&(p=!1)}),p}class d0{constructor(u,p){this.type=p.type,this.name=u,this.boundExpression=p}static parse(u,p){if(u.length!==2||typeof u[1]!="string")return p.error("'var' expression requires exactly one string literal argument.");const w=u[1];return p.scope.has(w)?new d0(w,p.scope.get(w)):p.error(`Unknown variable "${w}". Make sure "${w}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(u){return this.boundExpression.evaluate(u)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Vx=d0;class H_{constructor(u,p=[],w,A=new qy,N=[]){this.registry=u,this.path=p,this.key=p.map(_e=>`[${_e}]`).join(""),this.scope=A,this.errors=N,this.expectedType=w}parse(u,p,w,A,N={}){return p?this.concat(p,w,A)._parse(u,N):this._parse(u,N)}_parse(u,p){function w(A,N,_e){return _e==="assert"?new Sy(N,[A]):_e==="coerce"?new Sv(N,[A]):A}if(u!==null&&typeof u!="string"&&typeof u!="boolean"&&typeof u!="number"||(u=["literal",u]),Array.isArray(u)){if(u.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const A=u[0];if(typeof A!="string")return this.error(`Expression name must be a string, but found ${typeof A} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const N=this.registry[A];if(N){let _e=N.parse(u,this);if(!_e)return null;if(this.expectedType){const dt=this.expectedType,ir=_e.type;if(dt.kind!=="string"&&dt.kind!=="number"&&dt.kind!=="boolean"&&dt.kind!=="object"&&dt.kind!=="array"||ir.kind!=="value")if(dt.kind!=="color"&&dt.kind!=="formatted"&&dt.kind!=="resolvedImage"||ir.kind!=="value"&&ir.kind!=="string"){if(this.checkSubtype(dt,ir))return null}else _e=w(_e,dt,p.typeAnnotation||"coerce");else _e=w(_e,dt,p.typeAnnotation||"assert")}if(!(_e instanceof Ky)&&_e.type.kind!=="resolvedImage"&&Lg(_e)){const dt=new xx;try{_e=new Ky(_e.type,_e.evaluate(dt))}catch(ir){return this.error(ir.message),null}}return _e}return this.error(`Unknown expression "${A}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(u===void 0?"'undefined' value invalid. Use null instead.":typeof u=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof u} instead.`)}concat(u,p,w){const A=typeof u=="number"?this.path.concat(u):this.path,N=w?this.scope.concat(w):this.scope;return new H_(this.registry,A,p||null,N,this.errors)}error(u,...p){const w=`${this.key}${p.map(A=>`[${A}]`).join("")}`;this.errors.push(new my(w,u))}checkSubtype(u,p){const w=Ey(u,p);return w&&this.error(w),w}}var Iv=H_;function Lg(c){if(c instanceof Vx)return Lg(c.boundExpression);if(c instanceof Xy&&c.name==="error"||c instanceof l0||c instanceof p0)return!1;const u=c instanceof Sv||c instanceof Sy;let p=!0;return c.eachChild(w=>{p=u?p&&Lg(w):p&&w instanceof Ky}),!!p&&ky(c)&&Jy(c,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Pv(c,u){const p=c.length-1;let w,A,N=0,_e=p,dt=0;for(;N<=_e;)if(dt=Math.floor((N+_e)/2),w=c[dt],A=c[dt+1],w<=u){if(dt===p||u<A)return dt;N=dt+1}else{if(!(w>u))throw new em("Input is not a number.");_e=dt-1}return 0}class rg{constructor(u,p,w){this.type=u,this.input=p,this.labels=[],this.outputs=[];for(const[A,N]of w)this.labels.push(A),this.outputs.push(N)}static parse(u,p){if(u.length-1<4)return p.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if((u.length-1)%2!=0)return p.error("Expected an even number of arguments.");const w=p.parse(u[1],1,ad);if(!w)return null;const A=[];let N=null;p.expectedType&&p.expectedType.kind!=="value"&&(N=p.expectedType);for(let _e=1;_e<u.length;_e+=2){const dt=_e===1?-1/0:u[_e],ir=u[_e+1],Cr=_e,Gn=_e+1;if(typeof dt!="number")return p.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Cr);if(A.length&&A[A.length-1][0]>=dt)return p.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',Cr);const hs=p.parse(ir,Gn,N);if(!hs)return null;N=N||hs.type,A.push([dt,hs])}return new rg(N,w,A)}evaluate(u){const p=this.labels,w=this.outputs;if(p.length===1)return w[0].evaluate(u);const A=this.input.evaluate(u);if(A<=p[0])return w[0].evaluate(u);const N=p.length;return A>=p[N-1]?w[N-1].evaluate(u):w[Pv(p,A)].evaluate(u)}eachChild(u){u(this.input);for(const p of this.outputs)u(p)}outputDefined(){return this.outputs.every(u=>u.outputDefined())}serialize(){const u=["step",this.input.serialize()];for(let p=0;p<this.labels.length;p++)p>0&&u.push(this.labels[p]),u.push(this.outputs[p].serialize());return u}}var Mv=rg;function jd(c,u,p){return c*(1-p)+u*p}var _g=Object.freeze({__proto__:null,array:function(c,u,p){return c.map((w,A)=>jd(w,u[A],p))},color:function(c,u,p){return new zg(jd(c.r,u.r,p),jd(c.g,u.g,p),jd(c.b,u.b,p),jd(c.a,u.a,p))},number:jd});const W_=.95047,V0=1.08883,$0=4/29,q_=6/29,U0=3*q_*q_,j0=q_*q_*q_,H0=Math.PI/180,bx=180/Math.PI;function f0(c){return c>j0?Math.pow(c,1/3):c/U0+$0}function K_(c){return c>q_?c*c*c:U0*(c-$0)}function Z_(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function W0(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Cx(c){const u=W0(c.r),p=W0(c.g),w=W0(c.b),A=f0((.4124564*u+.3575761*p+.1804375*w)/W_),N=f0((.2126729*u+.7151522*p+.072175*w)/1);return{l:116*N-16,a:500*(A-N),b:200*(N-f0((.0193339*u+.119192*p+.9503041*w)/V0)),alpha:c.a}}function Yg(c){let u=(c.l+16)/116,p=isNaN(c.a)?u:u+c.a/500,w=isNaN(c.b)?u:u-c.b/200;return u=1*K_(u),p=W_*K_(p),w=V0*K_(w),new zg(Z_(3.2404542*p-1.5371385*u-.4985314*w),Z_(-.969266*p+1.8760108*u+.041556*w),Z_(.0556434*p-.2040259*u+1.0572252*w),c.alpha)}function X_(c,u,p){const w=u-c;return c+p*(w>180||w<-180?w-360*Math.round(w/360):w)}const Nm={forward:Cx,reverse:Yg,interpolate:function(c,u,p){return{l:jd(c.l,u.l,p),a:jd(c.a,u.a,p),b:jd(c.b,u.b,p),alpha:jd(c.alpha,u.alpha,p)}}},Y_={forward:function(c){const{l:u,a:p,b:w}=Cx(c),A=Math.atan2(w,p)*bx;return{h:A<0?A+360:A,c:Math.sqrt(p*p+w*w),l:u,alpha:c.a}},reverse:function(c){const u=c.h*H0,p=c.c;return Yg({l:c.l,a:Math.cos(u)*p,b:Math.sin(u)*p,alpha:c.alpha})},interpolate:function(c,u,p){return{h:X_(c.h,u.h,p),c:jd(c.c,u.c,p),l:jd(c.l,u.l,p),alpha:jd(c.alpha,u.alpha,p)}}};var g0=Object.freeze({__proto__:null,hcl:Y_,lab:Nm});class Dv{constructor(u,p,w,A,N){this.type=u,this.operator=p,this.interpolation=w,this.input=A,this.labels=[],this.outputs=[];for(const[_e,dt]of N)this.labels.push(_e),this.outputs.push(dt)}static interpolationFactor(u,p,w,A){let N=0;if(u.name==="exponential")N=Qy(p,u.base,w,A);else if(u.name==="linear")N=Qy(p,1,w,A);else if(u.name==="cubic-bezier"){const _e=u.controlPoints;N=new gl(_e[0],_e[1],_e[2],_e[3]).solve(Qy(p,1,w,A))}return N}static parse(u,p){let[w,A,N,..._e]=u;if(!Array.isArray(A)||A.length===0)return p.error("Expected an interpolation type expression.",1);if(A[0]==="linear")A={name:"linear"};else if(A[0]==="exponential"){const Cr=A[1];if(typeof Cr!="number")return p.error("Exponential interpolation requires a numeric base.",1,1);A={name:"exponential",base:Cr}}else{if(A[0]!=="cubic-bezier")return p.error(`Unknown interpolation type ${String(A[0])}`,1,0);{const Cr=A.slice(1);if(Cr.length!==4||Cr.some(Gn=>typeof Gn!="number"||Gn<0||Gn>1))return p.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);A={name:"cubic-bezier",controlPoints:Cr}}}if(u.length-1<4)return p.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if((u.length-1)%2!=0)return p.error("Expected an even number of arguments.");if(N=p.parse(N,2,ad),!N)return null;const dt=[];let ir=null;w==="interpolate-hcl"||w==="interpolate-lab"?ir=Wm:p.expectedType&&p.expectedType.kind!=="value"&&(ir=p.expectedType);for(let Cr=0;Cr<_e.length;Cr+=2){const Gn=_e[Cr],hs=_e[Cr+1],rl=Cr+3,ll=Cr+4;if(typeof Gn!="number")return p.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',rl);if(dt.length&&dt[dt.length-1][0]>=Gn)return p.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',rl);const ul=p.parse(hs,ll,ir);if(!ul)return null;ir=ir||ul.type,dt.push([Gn,ul])}return ir.kind==="number"||ir.kind==="color"||ir.kind==="array"&&ir.itemType.kind==="number"&&typeof ir.N=="number"?new Dv(ir,w,A,N,dt):p.error(`Type ${Og(ir)} is not interpolatable.`)}evaluate(u){const p=this.labels,w=this.outputs;if(p.length===1)return w[0].evaluate(u);const A=this.input.evaluate(u);if(A<=p[0])return w[0].evaluate(u);const N=p.length;if(A>=p[N-1])return w[N-1].evaluate(u);const _e=Pv(p,A),dt=Dv.interpolationFactor(this.interpolation,A,p[_e],p[_e+1]),ir=w[_e].evaluate(u),Cr=w[_e+1].evaluate(u);return this.operator==="interpolate"?_g[this.type.kind.toLowerCase()](ir,Cr,dt):this.operator==="interpolate-hcl"?Y_.reverse(Y_.interpolate(Y_.forward(ir),Y_.forward(Cr),dt)):Nm.reverse(Nm.interpolate(Nm.forward(ir),Nm.forward(Cr),dt))}eachChild(u){u(this.input);for(const p of this.outputs)u(p)}outputDefined(){return this.outputs.every(u=>u.outputDefined())}serialize(){let u;u=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const p=[this.operator,u,this.input.serialize()];for(let w=0;w<this.labels.length;w++)p.push(this.labels[w],this.outputs[w].serialize());return p}}function Qy(c,u,p,w){const A=w-p,N=c-p;return A===0?0:u===1?N/A:(Math.pow(u,N)-1)/(Math.pow(u,A)-1)}var Zm=Dv;class e_{constructor(u,p){this.type=u,this.args=p}static parse(u,p){if(u.length<2)return p.error("Expectected at least one argument.");let w=null;const A=p.expectedType;A&&A.kind!=="value"&&(w=A);const N=[];for(const dt of u.slice(1)){const ir=p.parse(dt,1+N.length,w,void 0,{typeAnnotation:"omit"});if(!ir)return null;w=w||ir.type,N.push(ir)}const _e=A&&N.some(dt=>Ey(A,dt.type));return new e_(_e?Kf:w,N)}evaluate(u){let p,w=null,A=0;for(const N of this.args){if(A++,w=N.evaluate(u),w&&w instanceof Vm&&!w.available&&(p||(p=w),w=null,A===this.args.length))return p;if(w!==null)break}return w}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every(u=>u.outputDefined())}serialize(){const u=["coalesce"];return this.eachChild(p=>{u.push(p.serialize())}),u}}var q0=e_;class Ov{constructor(u,p){this.type=p.type,this.bindings=[].concat(u),this.result=p}evaluate(u){return this.result.evaluate(u)}eachChild(u){for(const p of this.bindings)u(p[1]);u(this.result)}static parse(u,p){if(u.length<4)return p.error(`Expected at least 3 arguments, but found ${u.length-1} instead.`);const w=[];for(let N=1;N<u.length-1;N+=2){const _e=u[N];if(typeof _e!="string")return p.error(`Expected string, but found ${typeof _e} instead.`,N);if(/[^a-zA-Z0-9_]/.test(_e))return p.error("Variable names must contain only alphanumeric characters or '_'.",N);const dt=p.parse(u[N+1],N+1);if(!dt)return null;w.push([_e,dt])}const A=p.parse(u[u.length-1],u.length-1,p.expectedType,w);return A?new Ov(w,A):null}outputDefined(){return this.result.outputDefined()}serialize(){const u=["let"];for(const[p,w]of this.bindings)u.push(p,w.serialize());return u.push(this.result.serialize()),u}}var K0=Ov;class Z0{constructor(u,p,w){this.type=u,this.index=p,this.input=w}static parse(u,p){if(u.length!==3)return p.error(`Expected 2 arguments, but found ${u.length-1} instead.`);const w=p.parse(u[1],1,ad),A=p.parse(u[2],2,ay(p.expectedType||Kf));return w&&A?new Z0(A.type.itemType,w,A):null}evaluate(u){const p=this.index.evaluate(u),w=this.input.evaluate(u);if(p<0)throw new em(`Array index out of bounds: ${p} < 0.`);if(p>=w.length)throw new em(`Array index out of bounds: ${p} > ${w.length-1}.`);if(p!==Math.floor(p))throw new em(`Array index must be an integer, but found ${p} instead.`);return w[p]}eachChild(u){u(this.index),u(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var X0=Z0;class vy{constructor(u,p){this.type=Hf,this.needle=u,this.haystack=p}static parse(u,p){if(u.length!==3)return p.error(`Expected 2 arguments, but found ${u.length-1} instead.`);const w=p.parse(u[1],1,Kf),A=p.parse(u[2],2,Kf);return w&&A?z_(w.type,[Hf,qf,ad,lg,Kf])?new vy(w,A):p.error(`Expected first argument to be of type boolean, string, number or null, but found ${Og(w.type)} instead`):null}evaluate(u){const p=this.needle.evaluate(u),w=this.haystack.evaluate(u);if(w==null)return!1;if(!bv(p,["boolean","string","number","null"]))throw new em(`Expected first argument to be of type boolean, string, number or null, but found ${Og(Gg(p))} instead.`);if(!bv(w,["string","array"]))throw new em(`Expected second argument to be of type array or string, but found ${Og(Gg(w))} instead.`);return w.indexOf(p)>=0}eachChild(u){u(this.needle),u(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var J_=vy;class m_{constructor(u,p,w){this.type=ad,this.needle=u,this.haystack=p,this.fromIndex=w}static parse(u,p){if(u.length<=2||u.length>=5)return p.error(`Expected 3 or 4 arguments, but found ${u.length-1} instead.`);const w=p.parse(u[1],1,Kf),A=p.parse(u[2],2,Kf);if(!w||!A)return null;if(!z_(w.type,[Hf,qf,ad,lg,Kf]))return p.error(`Expected first argument to be of type boolean, string, number or null, but found ${Og(w.type)} instead`);if(u.length===4){const N=p.parse(u[3],3,ad);return N?new m_(w,A,N):null}return new m_(w,A)}evaluate(u){const p=this.needle.evaluate(u),w=this.haystack.evaluate(u);if(!bv(p,["boolean","string","number","null"]))throw new em(`Expected first argument to be of type boolean, string, number or null, but found ${Og(Gg(p))} instead.`);if(!bv(w,["string","array"]))throw new em(`Expected second argument to be of type array or string, but found ${Og(Gg(w))} instead.`);if(this.fromIndex){const A=this.fromIndex.evaluate(u);return w.indexOf(p,A)}return w.indexOf(p)}eachChild(u){u(this.needle),u(this.haystack),this.fromIndex&&u(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const u=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),u]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Ex=m_;class Q_{constructor(u,p,w,A,N,_e){this.inputType=u,this.type=p,this.input=w,this.cases=A,this.outputs=N,this.otherwise=_e}static parse(u,p){if(u.length<5)return p.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if(u.length%2!=1)return p.error("Expected an even number of arguments.");let w,A;p.expectedType&&p.expectedType.kind!=="value"&&(A=p.expectedType);const N={},_e=[];for(let Cr=2;Cr<u.length-1;Cr+=2){let Gn=u[Cr];const hs=u[Cr+1];Array.isArray(Gn)||(Gn=[Gn]);const rl=p.concat(Cr);if(Gn.length===0)return rl.error("Expected at least one branch label.");for(const ul of Gn){if(typeof ul!="number"&&typeof ul!="string")return rl.error("Branch labels must be numbers or strings.");if(typeof ul=="number"&&Math.abs(ul)>Number.MAX_SAFE_INTEGER)return rl.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ul=="number"&&Math.floor(ul)!==ul)return rl.error("Numeric branch labels must be integer values.");if(w){if(rl.checkSubtype(w,Gg(ul)))return null}else w=Gg(ul);if(N[String(ul)]!==void 0)return rl.error("Branch labels must be unique.");N[String(ul)]=_e.length}const ll=p.parse(hs,Cr,A);if(!ll)return null;A=A||ll.type,_e.push(ll)}const dt=p.parse(u[1],1,Kf);if(!dt)return null;const ir=p.parse(u[u.length-1],u.length-1,A);return ir?dt.type.kind!=="value"&&p.concat(1).checkSubtype(w,dt.type)?null:new Q_(w,A,dt,N,_e,ir):null}evaluate(u){const p=this.input.evaluate(u);return(Gg(p)===this.inputType&&this.outputs[this.cases[p]]||this.otherwise).evaluate(u)}eachChild(u){u(this.input),this.outputs.forEach(u),u(this.otherwise)}outputDefined(){return this.outputs.every(u=>u.outputDefined())&&this.otherwise.outputDefined()}serialize(){const u=["match",this.input.serialize()],p=Object.keys(this.cases).sort(),w=[],A={};for(const _e of p){const dt=A[this.cases[_e]];dt===void 0?(A[this.cases[_e]]=w.length,w.push([this.cases[_e],[_e]])):w[dt][1].push(_e)}const N=_e=>this.inputType.kind==="number"?Number(_e):_e;for(const[_e,dt]of w)u.push(dt.length===1?N(dt[0]):dt.map(N)),u.push(this.outputs[_e].serialize());return u.push(this.otherwise.serialize()),u}}var $x=Q_;class Y0{constructor(u,p,w){this.type=u,this.branches=p,this.otherwise=w}static parse(u,p){if(u.length<4)return p.error(`Expected at least 3 arguments, but found only ${u.length-1}.`);if(u.length%2!=0)return p.error("Expected an odd number of arguments.");let w;p.expectedType&&p.expectedType.kind!=="value"&&(w=p.expectedType);const A=[];for(let _e=1;_e<u.length-1;_e+=2){const dt=p.parse(u[_e],_e,Hf);if(!dt)return null;const ir=p.parse(u[_e+1],_e+1,w);if(!ir)return null;A.push([dt,ir]),w=w||ir.type}const N=p.parse(u[u.length-1],u.length-1,w);return N?new Y0(w,A,N):null}evaluate(u){for(const[p,w]of this.branches)if(p.evaluate(u))return w.evaluate(u);return this.otherwise.evaluate(u)}eachChild(u){for(const[p,w]of this.branches)u(p),u(w);u(this.otherwise)}outputDefined(){return this.branches.every(([u,p])=>p.outputDefined())&&this.otherwise.outputDefined()}serialize(){const u=["case"];return this.eachChild(p=>{u.push(p.serialize())}),u}}var Lv=Y0;class Fv{constructor(u,p,w,A){this.type=u,this.input=p,this.beginIndex=w,this.endIndex=A}static parse(u,p){if(u.length<=2||u.length>=5)return p.error(`Expected 3 or 4 arguments, but found ${u.length-1} instead.`);const w=p.parse(u[1],1,Kf),A=p.parse(u[2],2,ad);if(!w||!A)return null;if(!z_(w.type,[ay(Kf),qf,Kf]))return p.error(`Expected first argument to be of type array or string, but found ${Og(w.type)} instead`);if(u.length===4){const N=p.parse(u[3],3,ad);return N?new Fv(w.type,w,A,N):null}return new Fv(w.type,w,A)}evaluate(u){const p=this.input.evaluate(u),w=this.beginIndex.evaluate(u);if(!bv(p,["string","array"]))throw new em(`Expected first argument to be of type array or string, but found ${Og(Gg(p))} instead.`);if(this.endIndex){const A=this.endIndex.evaluate(u);return p.slice(w,A)}return p.slice(w)}eachChild(u){u(this.input),u(this.beginIndex),this.endIndex&&u(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const u=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),u]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Ry=Fv;function $m(c,u){return c==="=="||c==="!="?u.kind==="boolean"||u.kind==="string"||u.kind==="number"||u.kind==="null"||u.kind==="value":u.kind==="string"||u.kind==="number"||u.kind==="value"}function Nv(c,u,p,w){return w.compare(u,p)===0}function Vg(c,u,p){const w=c!=="=="&&c!=="!=";return class XS{constructor(N,_e,dt){this.type=Hf,this.lhs=N,this.rhs=_e,this.collator=dt,this.hasUntypedArgument=N.type.kind==="value"||_e.type.kind==="value"}static parse(N,_e){if(N.length!==3&&N.length!==4)return _e.error("Expected two or three arguments.");const dt=N[0];let ir=_e.parse(N[1],1,Kf);if(!ir)return null;if(!$m(dt,ir.type))return _e.concat(1).error(`"${dt}" comparisons are not supported for type '${Og(ir.type)}'.`);let Cr=_e.parse(N[2],2,Kf);if(!Cr)return null;if(!$m(dt,Cr.type))return _e.concat(2).error(`"${dt}" comparisons are not supported for type '${Og(Cr.type)}'.`);if(ir.type.kind!==Cr.type.kind&&ir.type.kind!=="value"&&Cr.type.kind!=="value")return _e.error(`Cannot compare types '${Og(ir.type)}' and '${Og(Cr.type)}'.`);w&&(ir.type.kind==="value"&&Cr.type.kind!=="value"?ir=new Sy(Cr.type,[ir]):ir.type.kind!=="value"&&Cr.type.kind==="value"&&(Cr=new Sy(ir.type,[Cr])));let Gn=null;if(N.length===4){if(ir.type.kind!=="string"&&Cr.type.kind!=="string"&&ir.type.kind!=="value"&&Cr.type.kind!=="value")return _e.error("Cannot use collator to compare non-string types.");if(Gn=_e.parse(N[3],3,qm),!Gn)return null}return new XS(ir,Cr,Gn)}evaluate(N){const _e=this.lhs.evaluate(N),dt=this.rhs.evaluate(N);if(w&&this.hasUntypedArgument){const ir=Gg(_e),Cr=Gg(dt);if(ir.kind!==Cr.kind||ir.kind!=="string"&&ir.kind!=="number")throw new em(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${ir.kind}, ${Cr.kind}) instead.`)}if(this.collator&&!w&&this.hasUntypedArgument){const ir=Gg(_e),Cr=Gg(dt);if(ir.kind!=="string"||Cr.kind!=="string")return u(N,_e,dt)}return this.collator?p(N,_e,dt,this.collator.evaluate(N)):u(N,_e,dt)}eachChild(N){N(this.lhs),N(this.rhs),this.collator&&N(this.collator)}outputDefined(){return!0}serialize(){const N=[c];return this.eachChild(_e=>{N.push(_e.serialize())}),N}}}const y_=Vg("==",function(c,u,p){return u===p},Nv),xw=Vg("!=",function(c,u,p){return u!==p},function(c,u,p,w){return!Nv(0,u,p,w)}),ww=Vg("<",function(c,u,p){return u<p},function(c,u,p,w){return w.compare(u,p)<0}),bw=Vg(">",function(c,u,p){return u>p},function(c,u,p,w){return w.compare(u,p)>0}),kv=Vg("<=",function(c,u,p){return u<=p},function(c,u,p,w){return w.compare(u,p)<=0}),Bv=Vg(">=",function(c,u,p){return u>=p},function(c,u,p,w){return w.compare(u,p)>=0});class ly{constructor(u,p,w,A,N,_e){this.type=qf,this.number=u,this.locale=p,this.currency=w,this.unit=A,this.minFractionDigits=N,this.maxFractionDigits=_e}static parse(u,p){if(u.length!==3)return p.error("Expected two arguments.");const w=p.parse(u[1],1,ad);if(!w)return null;const A=u[2];if(typeof A!="object"||Array.isArray(A))return p.error("NumberFormat options argument must be an object.");let N=null;if(A.locale&&(N=p.parse(A.locale,1,qf),!N))return null;let _e=null;if(A.currency&&(_e=p.parse(A.currency,1,qf),!_e))return null;let dt=null;if(A.unit&&(dt=p.parse(A.unit,1,qf),!dt))return null;let ir=null;if(A["min-fraction-digits"]&&(ir=p.parse(A["min-fraction-digits"],1,ad),!ir))return null;let Cr=null;return A["max-fraction-digits"]&&(Cr=p.parse(A["max-fraction-digits"],1,ad),!Cr)?null:new ly(w,N,_e,dt,ir,Cr)}evaluate(u){return new Intl.NumberFormat(this.locale?this.locale.evaluate(u):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(u):void 0,unit:this.unit?this.unit.evaluate(u):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(u):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(u):void 0}).format(this.number.evaluate(u))}eachChild(u){u(this.number),this.locale&&u(this.locale),this.currency&&u(this.currency),this.unit&&u(this.unit),this.minFractionDigits&&u(this.minFractionDigits),this.maxFractionDigits&&u(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const u={};return this.locale&&(u.locale=this.locale.serialize()),this.currency&&(u.currency=this.currency.serialize()),this.unit&&(u.unit=this.unit.serialize()),this.minFractionDigits&&(u["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(u["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),u]}}class Td{constructor(u){this.type=ad,this.input=u}static parse(u,p){if(u.length!==2)return p.error(`Expected 1 argument, but found ${u.length-1} instead.`);const w=p.parse(u[1],1);return w?w.type.kind!=="array"&&w.type.kind!=="string"&&w.type.kind!=="value"?p.error(`Expected argument of type string or array, but found ${Og(w.type)} instead.`):new Td(w):null}evaluate(u){const p=this.input.evaluate(u);if(typeof p=="string"||Array.isArray(p))return p.length;throw new em(`Expected value to be of type string or array, but found ${Og(Gg(p))} instead.`)}eachChild(u){u(this.input)}outputDefined(){return!1}serialize(){const u=["length"];return this.eachChild(p=>{u.push(p.serialize())}),u}}const m0={"==":y_,"!=":xw,">":bw,"<":ww,">=":Bv,"<=":kv,array:Sy,at:X0,boolean:Sy,case:Lv,coalesce:q0,collator:l0,format:Ty,image:a0,in:J_,"index-of":Ex,interpolate:Zm,"interpolate-hcl":Zm,"interpolate-lab":Zm,length:Td,let:K0,literal:Ky,match:$x,number:Sy,"number-format":ly,object:Sy,slice:Ry,step:Mv,string:Sy,"to-boolean":Sv,"to-color":Sv,"to-number":Sv,"to-string":Sv,var:Vx,within:p0};function zv(c,[u,p,w,A]){u=u.evaluate(c),p=p.evaluate(c),w=w.evaluate(c);const N=A?A.evaluate(c):1,_e=Km(u,p,w,N);if(_e)throw new em(_e);return new zg(u/255*N,p/255*N,w/255*N,N)}function Sm(c,u){return c in u}function y0(c,u){const p=u[c];return p===void 0?null:p}function sd(c){return{type:c}}Xy.register(m0,{error:[{kind:"error"},[qf],(c,[u])=>{throw new em(u.evaluate(c))}],typeof:[qf,[Kf],(c,[u])=>Og(Gg(u.evaluate(c)))],"to-rgba":[ay(ad,4),[Wm],(c,[u])=>u.evaluate(c).toArray()],rgb:[Wm,[ad,ad,ad],zv],rgba:[Wm,[ad,ad,ad,ad],zv],has:{type:Hf,overloads:[[[qf],(c,[u])=>Sm(u.evaluate(c),c.properties())],[[qf,yy],(c,[u,p])=>Sm(u.evaluate(c),p.evaluate(c))]]},get:{type:Kf,overloads:[[[qf],(c,[u])=>y0(u.evaluate(c),c.properties())],[[qf,yy],(c,[u,p])=>y0(u.evaluate(c),p.evaluate(c))]]},"feature-state":[Kf,[qf],(c,[u])=>y0(u.evaluate(c),c.featureState||{})],properties:[yy,[],c=>c.properties()],"geometry-type":[qf,[],c=>c.geometryType()],id:[Kf,[],c=>c.id()],zoom:[ad,[],c=>c.globals.zoom],pitch:[ad,[],c=>c.globals.pitch||0],"distance-from-center":[ad,[],c=>c.distanceFromCenter()],"heatmap-density":[ad,[],c=>c.globals.heatmapDensity||0],"line-progress":[ad,[],c=>c.globals.lineProgress||0],"sky-radial-progress":[ad,[],c=>c.globals.skyRadialProgress||0],accumulated:[Kf,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[ad,sd(ad),(c,u)=>{let p=0;for(const w of u)p+=w.evaluate(c);return p}],"*":[ad,sd(ad),(c,u)=>{let p=1;for(const w of u)p*=w.evaluate(c);return p}],"-":{type:ad,overloads:[[[ad,ad],(c,[u,p])=>u.evaluate(c)-p.evaluate(c)],[[ad],(c,[u])=>-u.evaluate(c)]]},"/":[ad,[ad,ad],(c,[u,p])=>u.evaluate(c)/p.evaluate(c)],"%":[ad,[ad,ad],(c,[u,p])=>u.evaluate(c)%p.evaluate(c)],ln2:[ad,[],()=>Math.LN2],pi:[ad,[],()=>Math.PI],e:[ad,[],()=>Math.E],"^":[ad,[ad,ad],(c,[u,p])=>Math.pow(u.evaluate(c),p.evaluate(c))],sqrt:[ad,[ad],(c,[u])=>Math.sqrt(u.evaluate(c))],log10:[ad,[ad],(c,[u])=>Math.log(u.evaluate(c))/Math.LN10],ln:[ad,[ad],(c,[u])=>Math.log(u.evaluate(c))],log2:[ad,[ad],(c,[u])=>Math.log(u.evaluate(c))/Math.LN2],sin:[ad,[ad],(c,[u])=>Math.sin(u.evaluate(c))],cos:[ad,[ad],(c,[u])=>Math.cos(u.evaluate(c))],tan:[ad,[ad],(c,[u])=>Math.tan(u.evaluate(c))],asin:[ad,[ad],(c,[u])=>Math.asin(u.evaluate(c))],acos:[ad,[ad],(c,[u])=>Math.acos(u.evaluate(c))],atan:[ad,[ad],(c,[u])=>Math.atan(u.evaluate(c))],min:[ad,sd(ad),(c,u)=>Math.min(...u.map(p=>p.evaluate(c)))],max:[ad,sd(ad),(c,u)=>Math.max(...u.map(p=>p.evaluate(c)))],abs:[ad,[ad],(c,[u])=>Math.abs(u.evaluate(c))],round:[ad,[ad],(c,[u])=>{const p=u.evaluate(c);return p<0?-Math.round(-p):Math.round(p)}],floor:[ad,[ad],(c,[u])=>Math.floor(u.evaluate(c))],ceil:[ad,[ad],(c,[u])=>Math.ceil(u.evaluate(c))],"filter-==":[Hf,[qf,Kf],(c,[u,p])=>c.properties()[u.value]===p.value],"filter-id-==":[Hf,[Kf],(c,[u])=>c.id()===u.value],"filter-type-==":[Hf,[qf],(c,[u])=>c.geometryType()===u.value],"filter-<":[Hf,[qf,Kf],(c,[u,p])=>{const w=c.properties()[u.value],A=p.value;return typeof w==typeof A&&w<A}],"filter-id-<":[Hf,[Kf],(c,[u])=>{const p=c.id(),w=u.value;return typeof p==typeof w&&p<w}],"filter->":[Hf,[qf,Kf],(c,[u,p])=>{const w=c.properties()[u.value],A=p.value;return typeof w==typeof A&&w>A}],"filter-id->":[Hf,[Kf],(c,[u])=>{const p=c.id(),w=u.value;return typeof p==typeof w&&p>w}],"filter-<=":[Hf,[qf,Kf],(c,[u,p])=>{const w=c.properties()[u.value],A=p.value;return typeof w==typeof A&&w<=A}],"filter-id-<=":[Hf,[Kf],(c,[u])=>{const p=c.id(),w=u.value;return typeof p==typeof w&&p<=w}],"filter->=":[Hf,[qf,Kf],(c,[u,p])=>{const w=c.properties()[u.value],A=p.value;return typeof w==typeof A&&w>=A}],"filter-id->=":[Hf,[Kf],(c,[u])=>{const p=c.id(),w=u.value;return typeof p==typeof w&&p>=w}],"filter-has":[Hf,[Kf],(c,[u])=>u.value in c.properties()],"filter-has-id":[Hf,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[Hf,[ay(qf)],(c,[u])=>u.value.indexOf(c.geometryType())>=0],"filter-id-in":[Hf,[ay(Kf)],(c,[u])=>u.value.indexOf(c.id())>=0],"filter-in-small":[Hf,[qf,ay(Kf)],(c,[u,p])=>p.value.indexOf(c.properties()[u.value])>=0],"filter-in-large":[Hf,[qf,ay(Kf)],(c,[u,p])=>function(w,A,N,_e){for(;N<=_e;){const dt=N+_e>>1;if(A[dt]===w)return!0;A[dt]>w?_e=dt-1:N=dt+1}return!1}(c.properties()[u.value],p.value,0,p.value.length-1)],all:{type:Hf,overloads:[[[Hf,Hf],(c,[u,p])=>u.evaluate(c)&&p.evaluate(c)],[sd(Hf),(c,u)=>{for(const p of u)if(!p.evaluate(c))return!1;return!0}]]},any:{type:Hf,overloads:[[[Hf,Hf],(c,[u,p])=>u.evaluate(c)||p.evaluate(c)],[sd(Hf),(c,u)=>{for(const p of u)if(p.evaluate(c))return!0;return!1}]]},"!":[Hf,[Hf],(c,[u])=>!u.evaluate(c)],"is-supported-script":[Hf,[qf],(c,[u])=>{const p=c.globals&&c.globals.isSupportedScript;return!p||p(u.evaluate(c))}],upcase:[qf,[qf],(c,[u])=>u.evaluate(c).toUpperCase()],downcase:[qf,[qf],(c,[u])=>u.evaluate(c).toLowerCase()],concat:[qf,sd(Kf),(c,u)=>u.map(p=>p_(p.evaluate(c))).join("")],"resolved-locale":[qf,[qm],(c,[u])=>u.evaluate(c).resolvedLocale()]});var __=m0;function J0(c){return{result:"success",value:c}}function v_(c){return{result:"error",value:c}}function t_(c){return c["property-type"]==="data-driven"}function _0(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function ev(c){return!!c.expression&&c.expression.interpolated}function og(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function Gv(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function Q0(c){return c}function tv(c,u){const p=u.type==="color",w=c.stops&&typeof c.stops[0][0]=="object",A=w||!(w||c.property!==void 0),N=c.type||(ev(u)?"exponential":"interval");if(p&&((c=gy({},c)).stops&&(c.stops=c.stops.map(Cr=>[Cr[0],zg.parse(Cr[1])])),c.default=zg.parse(c.default?c.default:u.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!g0[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let _e,dt,ir;if(N==="exponential")_e=km;else if(N==="interval")_e=Tm;else if(N==="categorical"){_e=Vv,dt=Object.create(null);for(const Cr of c.stops)dt[Cr[0]]=Cr[1];ir=typeof c.stops[0][0]}else{if(N!=="identity")throw new Error(`Unknown function type "${N}"`);_e=Sx}if(w){const Cr={},Gn=[];for(let ll=0;ll<c.stops.length;ll++){const ul=c.stops[ll],th=ul[0].zoom;Cr[th]===void 0&&(Cr[th]={zoom:th,type:c.type,property:c.property,default:c.default,stops:[]},Gn.push(th)),Cr[th].stops.push([ul[0].value,ul[1]])}const hs=[];for(const ll of Gn)hs.push([Cr[ll].zoom,tv(Cr[ll],u)]);const rl={name:"linear"};return{kind:"composite",interpolationType:rl,interpolationFactor:Zm.interpolationFactor.bind(void 0,rl),zoomStops:hs.map(ll=>ll[0]),evaluate:({zoom:ll},ul)=>km({stops:hs,base:c.base},u,ll).evaluate(ll,ul)}}if(A){const Cr=N==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:Cr,interpolationFactor:Zm.interpolationFactor.bind(void 0,Cr),zoomStops:c.stops.map(Gn=>Gn[0]),evaluate:({zoom:Gn})=>_e(c,u,Gn,dt,ir)}}return{kind:"source",evaluate(Cr,Gn){const hs=Gn&&Gn.properties?Gn.properties[c.property]:void 0;return hs===void 0?x_(c.default,u.default):_e(c,u,hs,dt,ir)}}}function x_(c,u,p){return c!==void 0?c:u!==void 0?u:p!==void 0?p:void 0}function Vv(c,u,p,w,A){return x_(typeof p===A?w[p]:void 0,c.default,u.default)}function Tm(c,u,p){if(og(p)!=="number")return x_(c.default,u.default);const w=c.stops.length;if(w===1||p<=c.stops[0][0])return c.stops[0][1];if(p>=c.stops[w-1][0])return c.stops[w-1][1];const A=Pv(c.stops.map(N=>N[0]),p);return c.stops[A][1]}function km(c,u,p){const w=c.base!==void 0?c.base:1;if(og(p)!=="number")return x_(c.default,u.default);const A=c.stops.length;if(A===1||p<=c.stops[0][0])return c.stops[0][1];if(p>=c.stops[A-1][0])return c.stops[A-1][1];const N=Pv(c.stops.map(Gn=>Gn[0]),p),_e=function(Gn,hs,rl,ll){const ul=ll-rl,th=Gn-rl;return ul===0?0:hs===1?th/ul:(Math.pow(hs,th)-1)/(Math.pow(hs,ul)-1)}(p,w,c.stops[N][0],c.stops[N+1][0]),dt=c.stops[N][1],ir=c.stops[N+1][1];let Cr=_g[u.type]||Q0;if(c.colorSpace&&c.colorSpace!=="rgb"){const Gn=g0[c.colorSpace];Cr=(hs,rl)=>Gn.reverse(Gn.interpolate(Gn.forward(hs),Gn.forward(rl),_e))}return typeof dt.evaluate=="function"?{evaluate(...Gn){const hs=dt.evaluate.apply(void 0,Gn),rl=ir.evaluate.apply(void 0,Gn);if(hs!==void 0&&rl!==void 0)return Cr(hs,rl,_e)}}:Cr(dt,ir,_e)}function Sx(c,u,p){return u.type==="color"?p=zg.parse(p):u.type==="formatted"?p=dm.fromString(p.toString()):u.type==="resolvedImage"?p=Vm.fromString(p.toString()):og(p)===u.type||u.type==="enum"&&u.values[p]||(p=void 0),x_(p,c.default,u.default)}class $v{constructor(u,p){this.expression=u,this._warningHistory={},this._evaluator=new xx,this._defaultValue=p?function(w){return w.type==="color"&&(Gv(w.default)||Array.isArray(w.default))?new zg(0,0,0,0):w.type==="color"?zg.parse(w.default)||null:w.default===void 0?null:w.default}(p):null,this._enumValues=p&&p.type==="enum"?p.values:null}evaluateWithoutErrorHandling(u,p,w,A,N,_e,dt,ir){return this._evaluator.globals=u,this._evaluator.feature=p,this._evaluator.featureState=w,this._evaluator.canonical=A||null,this._evaluator.availableImages=N||null,this._evaluator.formattedSection=_e,this._evaluator.featureTileCoord=dt||null,this._evaluator.featureDistanceData=ir||null,this.expression.evaluate(this._evaluator)}evaluate(u,p,w,A,N,_e,dt,ir){this._evaluator.globals=u,this._evaluator.feature=p||null,this._evaluator.featureState=w||null,this._evaluator.canonical=A||null,this._evaluator.availableImages=N||null,this._evaluator.formattedSection=_e||null,this._evaluator.featureTileCoord=dt||null,this._evaluator.featureDistanceData=ir||null;try{const Cr=this.expression.evaluate(this._evaluator);if(Cr==null||typeof Cr=="number"&&Cr!=Cr)return this._defaultValue;if(this._enumValues&&!(Cr in this._enumValues))throw new em(`Expected value to be one of ${Object.keys(this._enumValues).map(Gn=>JSON.stringify(Gn)).join(", ")}, but found ${JSON.stringify(Cr)} instead.`);return Cr}catch(Cr){return this._warningHistory[Cr.message]||(this._warningHistory[Cr.message]=!0,typeof console<"u"&&console.warn(Cr.message)),this._defaultValue}}}function r_(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in __}function w_(c,u){const p=new Iv(__,[],u?function(A){const N={color:Wm,string:qf,number:ad,enum:qf,boolean:Hf,formatted:k_,resolvedImage:B_};return A.type==="array"?ay(N[A.value]||Kf,A.length):N[A.type]}(u):void 0),w=p.parse(c,void 0,void 0,void 0,u&&u.type==="string"?{typeAnnotation:"coerce"}:void 0);return w?J0(new $v(w,u)):v_(p.errors)}class ex{constructor(u,p){this.kind=u,this._styleExpression=p,this.isStateDependent=u!=="constant"&&!Yy(p.expression)}evaluateWithoutErrorHandling(u,p,w,A,N,_e){return this._styleExpression.evaluateWithoutErrorHandling(u,p,w,A,N,_e)}evaluate(u,p,w,A,N,_e){return this._styleExpression.evaluate(u,p,w,A,N,_e)}}class Bm{constructor(u,p,w,A){this.kind=u,this.zoomStops=w,this._styleExpression=p,this.isStateDependent=u!=="camera"&&!Yy(p.expression),this.interpolationType=A}evaluateWithoutErrorHandling(u,p,w,A,N,_e){return this._styleExpression.evaluateWithoutErrorHandling(u,p,w,A,N,_e)}evaluate(u,p,w,A,N,_e){return this._styleExpression.evaluate(u,p,w,A,N,_e)}interpolationFactor(u,p,w){return this.interpolationType?Zm.interpolationFactor(this.interpolationType,u,p,w):0}}function Eg(c,u){if((c=w_(c,u)).result==="error")return c;const p=c.value.expression,w=ky(p);if(!w&&!t_(u))return v_([new my("","data expressions not supported")]);const A=Jy(p,["zoom","pitch","distance-from-center"]);if(!A&&!_0(u))return v_([new my("","zoom expressions not supported")]);const N=Uv(p);return N||A?N instanceof my?v_([N]):N instanceof Zm&&!ev(u)?v_([new my("",'"interpolate" expressions cannot be used with this property')]):J0(N?new Bm(w?"camera":"composite",c.value,N.labels,N instanceof Zm?N.interpolation:void 0):new ex(w?"constant":"source",c.value)):v_([new my("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class rv{constructor(u,p){this._parameters=u,this._specification=p,gy(this,tv(this._parameters,this._specification))}static deserialize(u){return new rv(u._parameters,u._specification)}static serialize(u){return{_parameters:u._parameters,_specification:u._specification}}}function Uv(c){let u=null;if(c instanceof K0)u=Uv(c.result);else if(c instanceof q0){for(const p of c.args)if(u=Uv(p),u)break}else(c instanceof Mv||c instanceof Zm)&&c.input instanceof Xy&&c.input.name==="zoom"&&(u=c);return u instanceof my||c.eachChild(p=>{const w=Uv(p);w instanceof my?u=w:!u&&w?u=new my("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):u&&w&&u!==w&&(u=new my("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),u}class fd{constructor(u,p,w,A){this.message=(u?`${u}: `:"")+w,A&&(this.identifier=A),p!=null&&p.__line__&&(this.line=p.__line__)}}function Um(c){const u=c.key,p=c.value,w=c.valueSpec||{},A=c.objectElementValidators||{},N=c.style,_e=c.styleSpec;let dt=[];const ir=og(p);if(ir!=="object")return[new fd(u,p,`object expected, ${ir} found`)];for(const Cr in p){const Gn=Cr.split(".")[0];let hs;A[Gn]?hs=A[Gn]:w[Gn]?hs=fm:A["*"]?hs=A["*"]:w["*"]&&(hs=fm),hs?dt=dt.concat(hs({key:(u&&`${u}.`)+Cr,value:p[Cr],valueSpec:w[Gn]||w["*"],style:N,styleSpec:_e,object:p,objectKey:Cr},p)):dt.push(new fd(u,p[Cr],`unknown property "${Cr}"`))}for(const Cr in w)A[Cr]||w[Cr].required&&w[Cr].default===void 0&&p[Cr]===void 0&&dt.push(new fd(u,p,`missing required property "${Cr}"`));return dt}function Tx(c){const u=c.value,p=c.valueSpec,w=c.style,A=c.styleSpec,N=c.key,_e=c.arrayElementValidator||fm;if(og(u)!=="array")return[new fd(N,u,`array expected, ${og(u)} found`)];if(p.length&&u.length!==p.length)return[new fd(N,u,`array length ${p.length} expected, length ${u.length} found`)];if(p["min-length"]&&u.length<p["min-length"])return[new fd(N,u,`array length at least ${p["min-length"]} expected, length ${u.length} found`)];let dt={type:p.value,values:p.values,minimum:p.minimum,maximum:p.maximum,function:void 0};A.$version<7&&(dt.function=p.function),og(p.value)==="object"&&(dt=p.value);let ir=[];for(let Cr=0;Cr<u.length;Cr++)ir=ir.concat(_e({array:u,arrayIndex:Cr,value:u[Cr],valueSpec:dt,style:w,styleSpec:A,key:`${N}[${Cr}]`}));return ir}function iv(c){const u=c.key,p=c.value,w=c.valueSpec;let A=og(p);if(A==="number"&&p!=p&&(A="NaN"),A!=="number")return[new fd(u,p,`number expected, ${A} found`)];if("minimum"in w){let N=w.minimum;if(og(w.minimum)==="array"&&(N=w.minimum[c.arrayIndex]),p<N)return[new fd(u,p,`${p} is less than the minimum value ${N}`)]}if("maximum"in w){let N=w.maximum;if(og(w.maximum)==="array"&&(N=w.maximum[c.arrayIndex]),p>N)return[new fd(u,p,`${p} is greater than the maximum value ${N}`)]}return[]}function Xm(c){const u=c.valueSpec,p=xg(c.value.type);let w,A,N,_e={};const dt=p!=="categorical"&&c.value.property===void 0,ir=!dt,Cr=og(c.value.stops)==="array"&&og(c.value.stops[0])==="array"&&og(c.value.stops[0][0])==="object",Gn=Um({key:c.key,value:c.value,valueSpec:c.styleSpec.function,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(ll){if(p==="identity")return[new fd(ll.key,ll.value,'identity function may not have a "stops" property')];let ul=[];const th=ll.value;return ul=ul.concat(Tx({key:ll.key,value:th,valueSpec:ll.valueSpec,style:ll.style,styleSpec:ll.styleSpec,arrayElementValidator:hs})),og(th)==="array"&&th.length===0&&ul.push(new fd(ll.key,th,"array must have at least one stop")),ul},default:function(ll){return fm({key:ll.key,value:ll.value,valueSpec:u,style:ll.style,styleSpec:ll.styleSpec})}}});return p==="identity"&&dt&&Gn.push(new fd(c.key,c.value,'missing required property "property"')),p==="identity"||c.value.stops||Gn.push(new fd(c.key,c.value,'missing required property "stops"')),p==="exponential"&&c.valueSpec.expression&&!ev(c.valueSpec)&&Gn.push(new fd(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(ir&&!t_(c.valueSpec)?Gn.push(new fd(c.key,c.value,"property functions not supported")):dt&&!_0(c.valueSpec)&&Gn.push(new fd(c.key,c.value,"zoom functions not supported"))),p!=="categorical"&&!Cr||c.value.property!==void 0||Gn.push(new fd(c.key,c.value,'"property" property is required')),Gn;function hs(ll){let ul=[];const th=ll.value,fh=ll.key;if(og(th)!=="array")return[new fd(fh,th,`array expected, ${og(th)} found`)];if(th.length!==2)return[new fd(fh,th,`array length 2 expected, length ${th.length} found`)];if(Cr){if(og(th[0])!=="object")return[new fd(fh,th,`object expected, ${og(th[0])} found`)];if(th[0].zoom===void 0)return[new fd(fh,th,"object stop key must have zoom")];if(th[0].value===void 0)return[new fd(fh,th,"object stop key must have value")];const Ch=xg(th[0].zoom);if(typeof Ch!="number")return[new fd(fh,th[0].zoom,"stop zoom values must be numbers")];if(N&&N>Ch)return[new fd(fh,th[0].zoom,"stop zoom values must appear in ascending order")];Ch!==N&&(N=Ch,A=void 0,_e={}),ul=ul.concat(Um({key:`${fh}[0]`,value:th[0],valueSpec:{zoom:{}},style:ll.style,styleSpec:ll.styleSpec,objectElementValidators:{zoom:iv,value:rl}}))}else ul=ul.concat(rl({key:`${fh}[0]`,value:th[0],valueSpec:{},style:ll.style,styleSpec:ll.styleSpec},th));return r_(hm(th[1]))?ul.concat([new fd(`${fh}[1]`,th[1],"expressions are not allowed in function stops.")]):ul.concat(fm({key:`${fh}[1]`,value:th[1],valueSpec:u,style:ll.style,styleSpec:ll.styleSpec}))}function rl(ll,ul){const th=og(ll.value),fh=xg(ll.value),Ch=ll.value!==null?ll.value:ul;if(w){if(th!==w)return[new fd(ll.key,Ch,`${th} stop domain type must match previous stop domain type ${w}`)]}else w=th;if(th!=="number"&&th!=="string"&&th!=="boolean"&&typeof fh!="number"&&typeof fh!="string"&&typeof fh!="boolean")return[new fd(ll.key,Ch,"stop domain value must be a number, string, or boolean")];if(th!=="number"&&p!=="categorical"){let zh=`number expected, ${th} found`;return t_(u)&&p===void 0&&(zh+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new fd(ll.key,Ch,zh)]}return p!=="categorical"||th!=="number"||typeof fh=="number"&&isFinite(fh)&&Math.floor(fh)===fh?p!=="categorical"&&th==="number"&&typeof fh=="number"&&typeof A=="number"&&A!==void 0&&fh<A?[new fd(ll.key,Ch,"stop domain values must appear in ascending order")]:(A=fh,p==="categorical"&&fh in _e?[new fd(ll.key,Ch,"stop domain values must be unique")]:(_e[fh]=!0,[])):[new fd(ll.key,Ch,`integer expected, found ${String(fh)}`)]}}function tm(c){const u=(c.expressionContext==="property"?Eg:w_)(hm(c.value),c.valueSpec);if(u.result==="error")return u.value.map(w=>new fd(`${c.key}${w.key}`,c.value,w.message));const p=u.value.expression||u.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!p.outputDefined())return[new fd(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!Yy(p))return[new fd(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter")return Nd(p,c);if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!Jy(p,["zoom","feature-state"]))return[new fd(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!ky(p))return[new fd(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Nd(c,u){const p=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(u.valueSpec&&u.valueSpec.expression)for(const A of u.valueSpec.expression.parameters)p.delete(A);if(p.size===0)return[];const w=[];return c instanceof Xy&&p.has(c.name)?[new fd(u.key,u.value,`["${c.name}"] expression is not supported in a filter for a ${u.object.type} layer with id: ${u.object.id}`)]:(c.eachChild(A=>{w.push(...Nd(A,u))}),w)}function Kd(c){const u=c.key,p=c.value,w=c.valueSpec,A=[];return Array.isArray(w.values)?w.values.indexOf(xg(p))===-1&&A.push(new fd(u,p,`expected one of [${w.values.join(", ")}], ${JSON.stringify(p)} found`)):Object.keys(w.values).indexOf(xg(p))===-1&&A.push(new fd(u,p,`expected one of [${Object.keys(w.values).join(", ")}], ${JSON.stringify(p)} found`)),A}function nv(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const u of c.slice(1))if(!nv(u)&&typeof u!="boolean")return!1;return!0;default:return!0}}function jv(c,u="fill"){if(c==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};nv(c)||(c=Pg(c));const p=c;let w=!0;try{w=function(Cr){if(!ov(Cr))return Cr;let Gn=hm(Cr);return Am(Gn),Gn=tx(Gn),Gn}(p)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(p,null,2)}
        `)}const A=hp[`filter_${u}`],N=w_(w,A);let _e=null;if(N.result==="error")throw new Error(N.value.map(Cr=>`${Cr.key}: ${Cr.message}`).join(", "));_e=(Cr,Gn,hs)=>N.value.evaluate(Cr,Gn,{},hs);let dt=null,ir=null;if(w!==p){const Cr=w_(p,A);if(Cr.result==="error")throw new Error(Cr.value.map(Gn=>`${Gn.key}: ${Gn.message}`).join(", "));dt=(Gn,hs,rl,ll,ul)=>Cr.value.evaluate(Gn,hs,{},rl,void 0,void 0,ll,ul),ir=!ky(Cr.value.expression)}return{filter:_e,dynamicFilter:dt||void 0,needGeometry:By(w),needFeature:!!ir}}function tx(c){if(!Array.isArray(c))return c;const u=function(p){if(xy.has(p[0])){for(let w=1;w<p.length;w++)if(ov(p[w]))return!0}return p}(c);return u===!0?u:u.map(p=>tx(p))}function Am(c){let u=!1;const p=[];if(c[0]==="case"){for(let w=1;w<c.length-1;w+=2)u=u||ov(c[w]),p.push(c[w+1]);p.push(c[c.length-1])}else if(c[0]==="match"){u=u||ov(c[1]);for(let w=2;w<c.length-1;w+=2)p.push(c[w+1]);p.push(c[c.length-1])}else if(c[0]==="step"){u=u||ov(c[1]);for(let w=1;w<c.length-1;w+=2)p.push(c[w+1])}u&&(c.length=0,c.push("any",...p));for(let w=1;w<c.length;w++)Am(c[w])}function ov(c){if(!Array.isArray(c))return!1;if((u=c[0])==="pitch"||u==="distance-from-center")return!0;var u;for(let p=1;p<c.length;p++)if(ov(c[p]))return!0;return!1}const xy=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Cw(c,u){return c<u?-1:c>u?1:0}function By(c){if(!Array.isArray(c))return!1;if(c[0]==="within")return!0;for(let u=1;u<c.length;u++)if(By(c[u]))return!0;return!1}function Pg(c){if(!c)return!0;const u=c[0];return c.length<=1?u!=="any":u==="=="?Jg(c[1],c[2],"=="):u==="!="?sv(Jg(c[1],c[2],"==")):u==="<"||u===">"||u==="<="||u===">="?Jg(c[1],c[2],u):u==="any"?(p=c.slice(1),["any"].concat(p.map(Pg))):u==="all"?["all"].concat(c.slice(1).map(Pg)):u==="none"?["all"].concat(c.slice(1).map(Pg).map(sv)):u==="in"?rx(c[1],c.slice(2)):u==="!in"?sv(rx(c[1],c.slice(2))):u==="has"?b_(c[1]):u==="!has"?sv(b_(c[1])):u!=="within"||c;var p}function Jg(c,u,p){switch(c){case"$type":return[`filter-type-${p}`,u];case"$id":return[`filter-id-${p}`,u];default:return[`filter-${p}`,c,u]}}function rx(c,u){if(u.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",u]];case"$id":return["filter-id-in",["literal",u]];default:return u.length>200&&!u.some(p=>typeof p!=typeof u[0])?["filter-in-large",c,["literal",u.sort(Cw)]]:["filter-in-small",c,["literal",u]]}}function b_(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function sv(c){return["!",c]}function av(c){return nv(hm(c.value))?tm(gy({},c,{expressionContext:"filter",valueSpec:c.styleSpec[`filter_${c.layerType||"fill"}`]})):Ym(c)}function Ym(c){const u=c.value,p=c.key;if(og(u)!=="array")return[new fd(p,u,`array expected, ${og(u)} found`)];const w=c.styleSpec;let A,N=[];if(u.length<1)return[new fd(p,u,"filter array must have at least 1 element")];switch(N=N.concat(Kd({key:`${p}[0]`,value:u[0],valueSpec:w.filter_operator,style:c.style,styleSpec:c.styleSpec})),xg(u[0])){case"<":case"<=":case">":case">=":u.length>=2&&xg(u[1])==="$type"&&N.push(new fd(p,u,`"$type" cannot be use with operator "${u[0]}"`));case"==":case"!=":u.length!==3&&N.push(new fd(p,u,`filter array for operator "${u[0]}" must have 3 elements`));case"in":case"!in":u.length>=2&&(A=og(u[1]),A!=="string"&&N.push(new fd(`${p}[1]`,u[1],`string expected, ${A} found`)));for(let _e=2;_e<u.length;_e++)A=og(u[_e]),xg(u[1])==="$type"?N=N.concat(Kd({key:`${p}[${_e}]`,value:u[_e],valueSpec:w.geometry_type,style:c.style,styleSpec:c.styleSpec})):A!=="string"&&A!=="number"&&A!=="boolean"&&N.push(new fd(`${p}[${_e}]`,u[_e],`string, number, or boolean expected, ${A} found`));break;case"any":case"all":case"none":for(let _e=1;_e<u.length;_e++)N=N.concat(Ym({key:`${p}[${_e}]`,value:u[_e],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":A=og(u[1]),u.length!==2?N.push(new fd(p,u,`filter array for "${u[0]}" operator must have 2 elements`)):A!=="string"&&N.push(new fd(`${p}[1]`,u[1],`string expected, ${A} found`));break;case"within":A=og(u[1]),u.length!==2?N.push(new fd(p,u,`filter array for "${u[0]}" operator must have 2 elements`)):A!=="object"&&N.push(new fd(`${p}[1]`,u[1],`object expected, ${A} found`))}return N}function Hv(c,u){const p=c.key,w=c.style,A=c.styleSpec,N=c.value,_e=c.objectKey,dt=A[`${u}_${c.layerType}`];if(!dt)return[];const ir=_e.match(/^(.*)-transition$/);if(u==="paint"&&ir&&dt[ir[1]]&&dt[ir[1]].transition)return fm({key:p,value:N,valueSpec:A.transition,style:w,styleSpec:A});const Cr=c.valueSpec||dt[_e];if(!Cr)return[new fd(p,N,`unknown property "${_e}"`)];let Gn;if(og(N)==="string"&&t_(Cr)&&!Cr.tokens&&(Gn=/^{([^}]+)}$/.exec(N))){const rl=`\`{ "type": "identity", "property": ${Gn?JSON.stringify(Gn[1]):'"_"'} }\``;return[new fd(p,N,`"${_e}" does not support interpolation syntax
Use an identity property function instead: ${rl}.`)]}const hs=[];return c.layerType==="symbol"&&(_e==="text-field"&&w&&!w.glyphs&&hs.push(new fd(p,N,'use of "text-field" requires a style "glyphs" property')),_e==="text-font"&&Gv(hm(N))&&xg(N.type)==="identity"&&hs.push(new fd(p,N,'"text-font" does not support identity functions'))),hs.concat(fm({key:c.key,value:N,valueSpec:Cr,style:w,styleSpec:A,expressionContext:"property",propertyType:u,propertyKey:_e}))}function C_(c){return Hv(c,"paint")}function Wv(c){return Hv(c,"layout")}function qv(c){let u=[];const p=c.value,w=c.key,A=c.style,N=c.styleSpec;p.type||p.ref||u.push(new fd(w,p,'either "type" or "ref" is required'));let _e=xg(p.type);const dt=xg(p.ref);if(p.id){const ir=xg(p.id);for(let Cr=0;Cr<c.arrayIndex;Cr++){const Gn=A.layers[Cr];xg(Gn.id)===ir&&u.push(new fd(w,p.id,`duplicate layer id "${p.id}", previously used at line ${Gn.id.__line__}`))}}if("ref"in p){let ir;["type","source","source-layer","filter","layout"].forEach(Cr=>{Cr in p&&u.push(new fd(w,p[Cr],`"${Cr}" is prohibited for ref layers`))}),A.layers.forEach(Cr=>{xg(Cr.id)===dt&&(ir=Cr)}),ir?ir.ref?u.push(new fd(w,p.ref,"ref cannot reference another ref layer")):_e=xg(ir.type):typeof dt=="string"&&u.push(new fd(w,p.ref,`ref layer "${dt}" not found`))}else if(_e!=="background"&&_e!=="sky")if(p.source){const ir=A.sources&&A.sources[p.source],Cr=ir&&xg(ir.type);ir?Cr==="vector"&&_e==="raster"?u.push(new fd(w,p.source,`layer "${p.id}" requires a raster source`)):Cr==="raster"&&_e!=="raster"?u.push(new fd(w,p.source,`layer "${p.id}" requires a vector source`)):Cr!=="vector"||p["source-layer"]?Cr==="raster-dem"&&_e!=="hillshade"?u.push(new fd(w,p.source,"raster-dem source can only be used with layer type 'hillshade'.")):_e!=="line"||!p.paint||!p.paint["line-gradient"]&&!p.paint["line-trim-offset"]||Cr==="geojson"&&ir.lineMetrics||u.push(new fd(w,p,`layer "${p.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):u.push(new fd(w,p,`layer "${p.id}" must specify a "source-layer"`)):u.push(new fd(w,p.source,`source "${p.source}" not found`))}else u.push(new fd(w,p,'missing required property "source"'));return u=u.concat(Um({key:w,value:p,valueSpec:N.layer,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{"*":()=>[],type:()=>fm({key:`${w}.type`,value:p.type,valueSpec:N.layer.type,style:c.style,styleSpec:c.styleSpec,object:p,objectKey:"type"}),filter:ir=>av(gy({layerType:_e},ir)),layout:ir=>Um({layer:p,key:ir.key,value:ir.value,valueSpec:{},style:ir.style,styleSpec:ir.styleSpec,objectElementValidators:{"*":Cr=>Wv(gy({layerType:_e},Cr))}}),paint:ir=>Um({layer:p,key:ir.key,value:ir.value,valueSpec:{},style:ir.style,styleSpec:ir.styleSpec,objectElementValidators:{"*":Cr=>C_(gy({layerType:_e},Cr))}})}})),u}function zy(c){const u=c.value,p=c.key,w=og(u);return w!=="string"?[new fd(p,u,`string expected, ${w} found`)]:[]}const lv={promoteId:function({key:c,value:u}){if(og(u)==="string")return zy({key:c,value:u});{const p=[];for(const w in u)p.push(...zy({key:`${c}.${w}`,value:u[w]}));return p}}};function E_(c){const u=c.value,p=c.key,w=c.styleSpec,A=c.style;if(!u.type)return[new fd(p,u,'"type" is required')];const N=xg(u.type);let _e;switch(N){case"vector":case"raster":case"raster-dem":return _e=Um({key:p,value:u,valueSpec:w[`source_${N.replace("-","_")}`],style:c.style,styleSpec:w,objectElementValidators:lv}),_e;case"geojson":if(_e=Um({key:p,value:u,valueSpec:w.source_geojson,style:A,styleSpec:w,objectElementValidators:lv}),u.cluster)for(const dt in u.clusterProperties){const[ir,Cr]=u.clusterProperties[dt],Gn=typeof ir=="string"?[ir,["accumulated"],["get",dt]]:ir;_e.push(...tm({key:`${p}.${dt}.map`,value:Cr,expressionContext:"cluster-map"})),_e.push(...tm({key:`${p}.${dt}.reduce`,value:Gn,expressionContext:"cluster-reduce"}))}return _e;case"video":return Um({key:p,value:u,valueSpec:w.source_video,style:A,styleSpec:w});case"image":return Um({key:p,value:u,valueSpec:w.source_image,style:A,styleSpec:w});case"canvas":return[new fd(p,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Kd({key:`${p}.type`,value:u.type,valueSpec:{values:Ax(w)},style:A,styleSpec:w})}}function Ax(c){return c.source.reduce((u,p)=>{const w=c[p];return w.type.type==="enum"&&(u=u.concat(Object.keys(w.type.values))),u},[])}function v0(c){const u=c.value,p=c.styleSpec,w=p.light,A=c.style;let N=[];const _e=og(u);if(u===void 0)return N;if(_e!=="object")return N=N.concat([new fd("light",u,`object expected, ${_e} found`)]),N;for(const dt in u){const ir=dt.match(/^(.*)-transition$/);N=N.concat(ir&&w[ir[1]]&&w[ir[1]].transition?fm({key:dt,value:u[dt],valueSpec:p.transition,style:A,styleSpec:p}):w[dt]?fm({key:dt,value:u[dt],valueSpec:w[dt],style:A,styleSpec:p}):[new fd(dt,u[dt],`unknown property "${dt}"`)])}return N}function i_(c){const u=c.value,p=c.key,w=c.style,A=c.styleSpec,N=A.terrain;let _e=[];const dt=og(u);if(u===void 0)return _e;if(dt!=="object")return _e=_e.concat([new fd("terrain",u,`object expected, ${dt} found`)]),_e;for(const ir in u){const Cr=ir.match(/^(.*)-transition$/);_e=_e.concat(Cr&&N[Cr[1]]&&N[Cr[1]].transition?fm({key:ir,value:u[ir],valueSpec:A.transition,style:w,styleSpec:A}):N[ir]?fm({key:ir,value:u[ir],valueSpec:N[ir],style:w,styleSpec:A}):[new fd(ir,u[ir],`unknown property "${ir}"`)])}if(u.source){const ir=w.sources&&w.sources[u.source],Cr=ir&&xg(ir.type);ir?Cr!=="raster-dem"&&_e.push(new fd(p,u.source,`terrain cannot be used with a source of type ${String(Cr)}, it only be used with a "raster-dem" source type`)):_e.push(new fd(p,u.source,`source "${u.source}" not found`))}else _e.push(new fd(p,u,'terrain is missing required property "source"'));return _e}function x0(c){const u=c.value,p=c.style,w=c.styleSpec,A=w.fog;let N=[];const _e=og(u);if(u===void 0)return N;if(_e!=="object")return N=N.concat([new fd("fog",u,`object expected, ${_e} found`)]),N;for(const dt in u){const ir=dt.match(/^(.*)-transition$/);N=N.concat(ir&&A[ir[1]]&&A[ir[1]].transition?fm({key:dt,value:u[dt],valueSpec:w.transition,style:p,styleSpec:w}):A[dt]?fm({key:dt,value:u[dt],valueSpec:A[dt],style:p,styleSpec:w}):[new fd(dt,u[dt],`unknown property "${dt}"`)])}return N}const ix={"*":()=>[],array:Tx,boolean:function(c){const u=c.value,p=c.key,w=og(u);return w!=="boolean"?[new fd(p,u,`boolean expected, ${w} found`)]:[]},number:iv,color:function(c){const u=c.key,p=c.value,w=og(p);return w!=="string"?[new fd(u,p,`color expected, ${w} found`)]:z0(p)===null?[new fd(u,p,`color expected, "${p}" found`)]:[]},enum:Kd,filter:av,function:Xm,layer:qv,object:Um,source:E_,light:v0,terrain:i_,fog:x0,string:zy,formatted:function(c){return zy(c).length===0?[]:tm(c)},resolvedImage:function(c){return zy(c).length===0?[]:tm(c)},projection:function(c){const u=c.value,p=c.styleSpec,w=p.projection,A=c.style;let N=[];const _e=og(u);if(_e==="object")for(const dt in u)N=N.concat(fm({key:dt,value:u[dt],valueSpec:w[dt],style:A,styleSpec:p}));else _e!=="string"&&(N=N.concat([new fd("projection",u,`object or string expected, ${_e} found`)]));return N}};function fm(c){const u=c.value,p=c.valueSpec,w=c.styleSpec;return p.expression&&Gv(xg(u))?Xm(c):p.expression&&r_(hm(u))?tm(c):p.type&&ix[p.type]?ix[p.type](c):Um(gy({},c,{valueSpec:p.type?w[p.type]:p}))}function nx(c){const u=c.value,p=c.key,w=zy(c);return w.length||(u.indexOf("{fontstack}")===-1&&w.push(new fd(p,u,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&w.push(new fd(p,u,'"glyphs" url must include a "{range}" token'))),w}function w0(c,u=hp){return D(fm({key:"",value:c,valueSpec:u.$root,styleSpec:u,style:c,objectElementValidators:{glyphs:nx,"*":()=>[]}}))}const ot=c=>D(C_(c)),m=c=>D(Wv(c));function D(c){return c.slice().sort((u,p)=>u.line&&p.line?u.line-p.line:0)}function Ee(c,u){let p=!1;if(u&&u.length)for(const w of u)c.fire(new sy(new Error(w.message))),p=!0;return p}var ct=kn,or=3;function kn(c,u,p){var w=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;var A=new Int32Array(this.arrayBuffer);c=A[0],this.d=(u=A[1])+2*(p=A[2]);for(var N=0;N<this.d*this.d;N++){var _e=A[or+N],dt=A[or+N+1];w.push(_e===dt?null:A.subarray(_e,dt))}var ir=A[or+w.length+1];this.keys=A.subarray(A[or+w.length],ir),this.bboxes=A.subarray(ir),this.insert=this._insertReadonly}else{this.d=u+2*p;for(var Cr=0;Cr<this.d*this.d;Cr++)w.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=c,this.padding=p,this.scale=u/c,this.uid=0;var Gn=p/u*c;this.min=-Gn,this.max=c+Gn}kn.prototype.insert=function(c,u,p,w,A){this._forEachCell(u,p,w,A,this._insertCell,this.uid++),this.keys.push(c),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(w),this.bboxes.push(A)},kn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},kn.prototype._insertCell=function(c,u,p,w,A,N){this.cells[A].push(N)},kn.prototype.query=function(c,u,p,w,A){var N=this.min,_e=this.max;if(c<=N&&u<=N&&_e<=p&&_e<=w&&!A)return Array.prototype.slice.call(this.keys);var dt=[];return this._forEachCell(c,u,p,w,this._queryCell,dt,{},A),dt},kn.prototype._queryCell=function(c,u,p,w,A,N,_e,dt){var ir=this.cells[A];if(ir!==null)for(var Cr=this.keys,Gn=this.bboxes,hs=0;hs<ir.length;hs++){var rl=ir[hs];if(_e[rl]===void 0){var ll=4*rl;(dt?dt(Gn[ll+0],Gn[ll+1],Gn[ll+2],Gn[ll+3]):c<=Gn[ll+2]&&u<=Gn[ll+3]&&p>=Gn[ll+0]&&w>=Gn[ll+1])?(_e[rl]=!0,N.push(Cr[rl])):_e[rl]=!1}}},kn.prototype._forEachCell=function(c,u,p,w,A,N,_e,dt){for(var ir=this._convertToCellCoord(c),Cr=this._convertToCellCoord(u),Gn=this._convertToCellCoord(p),hs=this._convertToCellCoord(w),rl=ir;rl<=Gn;rl++)for(var ll=Cr;ll<=hs;ll++){var ul=this.d*ll+rl;if((!dt||dt(this._convertFromCellCoord(rl),this._convertFromCellCoord(ll),this._convertFromCellCoord(rl+1),this._convertFromCellCoord(ll+1)))&&A.call(this,c,u,p,w,ul,N,_e,dt))return}},kn.prototype._convertFromCellCoord=function(c){return(c-this.padding)/this.scale},kn.prototype._convertToCellCoord=function(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))},kn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var c=this.cells,u=or+this.cells.length+1+1,p=0,w=0;w<this.cells.length;w++)p+=this.cells[w].length;var A=new Int32Array(u+p+this.keys.length+this.bboxes.length);A[0]=this.extent,A[1]=this.n,A[2]=this.padding;for(var N=u,_e=0;_e<c.length;_e++){var dt=c[_e];A[or+_e]=N,A.set(dt,N),N+=dt.length}return A[or+c.length]=N,A.set(this.keys,N),A[or+c.length+1]=N+=this.keys.length,A.set(this.bboxes,N),N+=this.bboxes.length,A.buffer};var ds=vi(ct);const ps={};function vs(c,u,p={}){Object.defineProperty(c,"_classRegistryKey",{value:u,writeable:!1}),ps[u]={klass:c,omit:p.omit||[]}}vs(Object,"Object"),ds.serialize=function(c,u){const p=c.toArrayBuffer();return u&&u.push(p),{buffer:p}},ds.deserialize=function(c){return new ds(c.buffer)},Object.defineProperty(ds,"name",{value:"Grid"}),vs(ds,"Grid"),vs(zg,"Color"),vs(Error,"Error"),vs($d,"AJAXError"),vs(Vm,"ResolvedImage"),vs(rv,"StylePropertyFunction"),vs($v,"StyleExpression",{omit:["_evaluator"]}),vs(Bm,"ZoomDependentExpression"),vs(ex,"ZoomConstantExpression"),vs(Xy,"CompoundExpression",{omit:["_evaluate"]});for(const c in __)ps[__[c]._classRegistryKey]||vs(__[c],`Expression${c}`);function fl(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function pl(c){return h.ImageBitmap&&c instanceof h.ImageBitmap}function ph(c,u){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp)return c;if(fl(c)||pl(c))return u&&u.push(c),c;if(ArrayBuffer.isView(c)){const p=c;return u&&u.push(p.buffer),p}if(c instanceof h.ImageData)return u&&u.push(c.data.buffer),c;if(Array.isArray(c)){const p=[];for(const w of c)p.push(ph(w,u));return p}if(typeof c=="object"){const p=c.constructor,w=p._classRegistryKey;if(!w)throw new Error(`can't serialize object of unregistered class ${w}`);const A=p.serialize?p.serialize(c,u):{};if(!p.serialize){for(const N in c)c.hasOwnProperty(N)&&(ps[w].omit.indexOf(N)>=0||(A[N]=ph(c[N],u)));c instanceof Error&&(A.message=c.message)}if(A.$name)throw new Error("$name property is reserved for worker serialization logic.");return w!=="Object"&&(A.$name=w),A}throw new Error("can't serialize object of type "+typeof c)}function Ah(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||fl(c)||pl(c)||ArrayBuffer.isView(c)||c instanceof h.ImageData)return c;if(Array.isArray(c))return c.map(Ah);if(typeof c=="object"){const u=c.$name||"Object",{klass:p}=ps[u];if(!p)throw new Error(`can't deserialize unregistered class ${u}`);if(p.deserialize)return p.deserialize(c);const w=Object.create(p.prototype);for(const A of Object.keys(c))A!=="$name"&&(w[A]=Ah(c[A]));return w}throw new Error("can't deserialize object of type "+typeof c)}const hh={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function Rh(c){for(const u of c)if(ap(u.charCodeAt(0)))return!0;return!1}function Gh(c){for(const u of c)if(!Kh(u.charCodeAt(0)))return!1;return!0}function Kh(c){return!(hh.Arabic(c)||hh["Arabic Supplement"](c)||hh["Arabic Extended-A"](c)||hh["Arabic Presentation Forms-A"](c)||hh["Arabic Presentation Forms-B"](c))}function ap(c){return!(c!==746&&c!==747&&(c<4352||!(hh["Bopomofo Extended"](c)||hh.Bopomofo(c)||hh["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||hh["CJK Compatibility Ideographs"](c)||hh["CJK Compatibility"](c)||hh["CJK Radicals Supplement"](c)||hh["CJK Strokes"](c)||!(!hh["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||hh["CJK Unified Ideographs Extension A"](c)||hh["CJK Unified Ideographs"](c)||hh["Enclosed CJK Letters and Months"](c)||hh["Hangul Compatibility Jamo"](c)||hh["Hangul Jamo Extended-A"](c)||hh["Hangul Jamo Extended-B"](c)||hh["Hangul Jamo"](c)||hh["Hangul Syllables"](c)||hh.Hiragana(c)||hh["Ideographic Description Characters"](c)||hh.Kanbun(c)||hh["Kangxi Radicals"](c)||hh["Katakana Phonetic Extensions"](c)||hh.Katakana(c)&&c!==12540||!(!hh["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!hh["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||hh["Unified Canadian Aboriginal Syllabics"](c)||hh["Unified Canadian Aboriginal Syllabics Extended"](c)||hh["Vertical Forms"](c)||hh["Yijing Hexagram Symbols"](c)||hh["Yi Syllables"](c)||hh["Yi Radicals"](c))))}function Lh(c){return!(ap(c)||function(u){return!!(hh["Latin-1 Supplement"](u)&&(u===167||u===169||u===174||u===177||u===188||u===189||u===190||u===215||u===247)||hh["General Punctuation"](u)&&(u===8214||u===8224||u===8225||u===8240||u===8241||u===8251||u===8252||u===8258||u===8263||u===8264||u===8265||u===8273)||hh["Letterlike Symbols"](u)||hh["Number Forms"](u)||hh["Miscellaneous Technical"](u)&&(u>=8960&&u<=8967||u>=8972&&u<=8991||u>=8996&&u<=9e3||u===9003||u>=9085&&u<=9114||u>=9150&&u<=9165||u===9167||u>=9169&&u<=9179||u>=9186&&u<=9215)||hh["Control Pictures"](u)&&u!==9251||hh["Optical Character Recognition"](u)||hh["Enclosed Alphanumerics"](u)||hh["Geometric Shapes"](u)||hh["Miscellaneous Symbols"](u)&&!(u>=9754&&u<=9759)||hh["Miscellaneous Symbols and Arrows"](u)&&(u>=11026&&u<=11055||u>=11088&&u<=11097||u>=11192&&u<=11243)||hh["CJK Symbols and Punctuation"](u)||hh.Katakana(u)||hh["Private Use Area"](u)||hh["CJK Compatibility Forms"](u)||hh["Small Form Variants"](u)||hh["Halfwidth and Fullwidth Forms"](u)||u===8734||u===8756||u===8757||u>=9984&&u<=10087||u>=10102&&u<=10131||u===65532||u===65533)}(c))}function op(c){return c>=1424&&c<=2303||hh["Arabic Presentation Forms-A"](c)||hh["Arabic Presentation Forms-B"](c)}function yp(c,u){return!(!u&&op(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||hh.Khmer(c))}function Np(c){for(const u of c)if(op(u.charCodeAt(0)))return!0;return!1}const jp="deferred",td="loading",Vp="loaded";let gd=null,F="unavailable",f=null;const T=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&(F="error"),gd&&gd(c)};function X(){Ve.fire(new Dg("pluginStateChange",{pluginStatus:F,pluginURL:f}))}const Ve=new fy,kt=function(){return F},Hr=function(){if(F!==jp||!f)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");F=td,X(),f&&ng({url:f},c=>{c?T(c):(F=Vp,X())})},pi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>F===Vp||pi.applyArabicShaping!=null,isLoading:()=>F===td,setState(c){F=c.pluginStatus,f=c.pluginURL},isParsed:()=>pi.applyArabicShaping!=null&&pi.processBidirectionalText!=null&&pi.processStyledBidirectionalText!=null,getPluginURL:()=>f};class Vn{constructor(u,p){this.zoom=u,p?(this.now=p.now,this.fadeDuration=p.fadeDuration,this.transition=p.transition,this.pitch=p.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(u){return function(p,w){for(const A of p)if(!yp(A.charCodeAt(0),w))return!1;return!0}(u,pi.isLoaded())}}class oa{constructor(u,p){this.property=u,this.value=p,this.expression=function(w,A){if(Gv(w))return new rv(w,A);if(r_(w)){const N=Eg(w,A);if(N.result==="error")throw new Error(N.value.map(_e=>`${_e.key}: ${_e.message}`).join(", "));return N.value}{let N=w;return typeof w=="string"&&A.type==="color"&&(N=zg.parse(w)),{kind:"constant",evaluate:()=>N}}}(p===void 0?u.specification.default:p,u.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(u,p,w){return this.property.possiblyEvaluate(this,u,p,w)}}class sa{constructor(u){this.property=u,this.value=new oa(u,void 0)}transitioned(u,p){return new lh(this.property,this.value,p,Cp({},u.transition,this.transition),u.now)}untransitioned(){return new lh(this.property,this.value,null,{},0)}}class dl{constructor(u){this._properties=u,this._values=Object.create(u.defaultTransitionablePropertyValues)}getValue(u){return Id(this._values[u].value.value)}setValue(u,p){this._values.hasOwnProperty(u)||(this._values[u]=new sa(this._values[u].property)),this._values[u].value=new oa(this._values[u].property,p===null?void 0:Id(p))}getTransition(u){return Id(this._values[u].transition)}setTransition(u,p){this._values.hasOwnProperty(u)||(this._values[u]=new sa(this._values[u].property)),this._values[u].transition=Id(p)||void 0}serialize(){const u={};for(const p of Object.keys(this._values)){const w=this.getValue(p);w!==void 0&&(u[p]=w);const A=this.getTransition(p);A!==void 0&&(u[`${p}-transition`]=A)}return u}transitioned(u,p){const w=new gh(this._properties);for(const A of Object.keys(this._values))w._values[A]=this._values[A].transitioned(u,p._values[A]);return w}untransitioned(){const u=new gh(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].untransitioned();return u}}class lh{constructor(u,p,w,A,N){const _e=A.delay||0,dt=A.duration||0;N=N||0,this.property=u,this.value=p,this.begin=N+_e,this.end=this.begin+dt,u.specification.transition&&(A.delay||A.duration)&&(this.prior=w)}possiblyEvaluate(u,p,w){const A=u.now||0,N=this.value.possiblyEvaluate(u,p,w),_e=this.prior;if(_e){if(A>this.end)return this.prior=null,N;if(this.value.isDataDriven())return this.prior=null,N;if(A<this.begin)return _e.possiblyEvaluate(u,p,w);{const dt=(A-this.begin)/(this.end-this.begin);return this.property.interpolate(_e.possiblyEvaluate(u,p,w),N,Mh(dt))}}return N}}class gh{constructor(u){this._properties=u,this._values=Object.create(u.defaultTransitioningPropertyValues)}possiblyEvaluate(u,p,w){const A=new xh(this._properties);for(const N of Object.keys(this._values))A._values[N]=this._values[N].possiblyEvaluate(u,p,w);return A}hasTransition(){for(const u of Object.keys(this._values))if(this._values[u].prior)return!0;return!1}}class _h{constructor(u){this._properties=u,this._values=Object.create(u.defaultPropertyValues)}getValue(u){return Id(this._values[u].value)}setValue(u,p){this._values[u]=new oa(this._values[u].property,p===null?void 0:Id(p))}serialize(){const u={};for(const p of Object.keys(this._values)){const w=this.getValue(p);w!==void 0&&(u[p]=w)}return u}possiblyEvaluate(u,p,w){const A=new xh(this._properties);for(const N of Object.keys(this._values))A._values[N]=this._values[N].possiblyEvaluate(u,p,w);return A}}class yh{constructor(u,p,w){this.property=u,this.value=p,this.parameters=w}isConstant(){return this.value.kind==="constant"}constantOr(u){return this.value.kind==="constant"?this.value.value:u}evaluate(u,p,w,A){return this.property.evaluate(this.value,this.parameters,u,p,w,A)}}class xh{constructor(u){this._properties=u,this._values=Object.create(u.defaultPossiblyEvaluatedValues)}get(u){return this._values[u]}}class yl{constructor(u){this.specification=u}possiblyEvaluate(u,p){return u.expression.evaluate(p)}interpolate(u,p,w){const A=_g[this.specification.type];return A?A(u,p,w):u}}class mh{constructor(u,p){this.specification=u,this.overrides=p}possiblyEvaluate(u,p,w,A){return new yh(this,u.expression.kind==="constant"||u.expression.kind==="camera"?{kind:"constant",value:u.expression.evaluate(p,null,{},w,A)}:u.expression,p)}interpolate(u,p,w){if(u.value.kind!=="constant"||p.value.kind!=="constant")return u;if(u.value.value===void 0||p.value.value===void 0)return new yh(this,{kind:"constant",value:void 0},u.parameters);const A=_g[this.specification.type];return A?new yh(this,{kind:"constant",value:A(u.value.value,p.value.value,w)},u.parameters):u}evaluate(u,p,w,A,N,_e){return u.kind==="constant"?u.value:u.evaluate(p,w,A,N,_e)}}class bh{constructor(u){this.specification=u}possiblyEvaluate(u,p,w,A){return!!u.expression.evaluate(p,null,{},w,A)}interpolate(){return!1}}class Sh{constructor(u){this.properties=u,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const p=new Vn(0,{});for(const w in u){const A=u[w];A.specification.overridable&&this.overridableProperties.push(w);const N=this.defaultPropertyValues[w]=new oa(A,void 0),_e=this.defaultTransitionablePropertyValues[w]=new sa(A);this.defaultTransitioningPropertyValues[w]=_e.untransitioned(),this.defaultPossiblyEvaluatedValues[w]=N.possiblyEvaluate(p)}}}function Nh(c,u){return 256*(c=Jh(Math.floor(c),0,255))+Jh(Math.floor(u),0,255)}vs(mh,"DataDrivenProperty"),vs(yl,"DataConstantProperty"),vs(bh,"ColorRampProperty");const $h={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Vh{constructor(u,p){this._structArray=u,this._pos1=p*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Wh{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(u,p){return u._trim(),p&&(u.isTransferred=!0,p.push(u.arrayBuffer)),{length:u.length,arrayBuffer:u.arrayBuffer}}static deserialize(u){const p=Object.create(this.prototype);return p.arrayBuffer=u.arrayBuffer,p.length=u.length,p.capacity=u.arrayBuffer.byteLength/p.bytesPerElement,p._refreshViews(),p}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(u){this.reserve(u),this.length=u}reserve(u){if(u>this.capacity){this.capacity=Math.max(u,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const p=this.uint8;this._refreshViews(),p&&this.uint8.set(p)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Zh(c,u=1){let p=0,w=0;return{members:c.map(A=>{const N=$h[A.type].BYTES_PER_ELEMENT,_e=p=rp(p,Math.max(u,N)),dt=A.components||1;return w=Math.max(w,N),p+=N*dt,{name:A.name,type:A.type,components:dt,offset:_e}}),size:rp(p,Math.max(w,u)),alignment:u}}function rp(c,u){return Math.ceil(c/u)*u}class Bp extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,p){const w=this.length;return this.resize(w+1),this.emplace(w,u,p)}emplace(u,p,w){const A=2*u;return this.int16[A+0]=p,this.int16[A+1]=w,u}}Bp.prototype.bytesPerElement=4,vs(Bp,"StructArrayLayout2i4");class tp extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,p,w){const A=this.length;return this.resize(A+1),this.emplace(A,u,p,w)}emplace(u,p,w,A){const N=3*u;return this.int16[N+0]=p,this.int16[N+1]=w,this.int16[N+2]=A,u}}tp.prototype.bytesPerElement=6,vs(tp,"StructArrayLayout3i6");class Tp extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,p,w,A){const N=this.length;return this.resize(N+1),this.emplace(N,u,p,w,A)}emplace(u,p,w,A,N){const _e=4*u;return this.int16[_e+0]=p,this.int16[_e+1]=w,this.int16[_e+2]=A,this.int16[_e+3]=N,u}}Tp.prototype.bytesPerElement=8,vs(Tp,"StructArrayLayout4i8");class pp extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,p,w,A,N,_e,dt){const ir=this.length;return this.resize(ir+1),this.emplace(ir,u,p,w,A,N,_e,dt)}emplace(u,p,w,A,N,_e,dt,ir){const Cr=6*u,Gn=12*u,hs=3*u;return this.int16[Cr+0]=p,this.int16[Cr+1]=w,this.uint8[Gn+4]=A,this.uint8[Gn+5]=N,this.uint8[Gn+6]=_e,this.uint8[Gn+7]=dt,this.float32[hs+2]=ir,u}}pp.prototype.bytesPerElement=12,vs(pp,"StructArrayLayout2i4ub1f12");class bp extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,p,w,A){const N=this.length;return this.resize(N+1),this.emplace(N,u,p,w,A)}emplace(u,p,w,A,N){const _e=4*u;return this.float32[_e+0]=p,this.float32[_e+1]=w,this.float32[_e+2]=A,this.float32[_e+3]=N,u}}bp.prototype.bytesPerElement=16,vs(bp,"StructArrayLayout4f16");class np extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,p,w,A,N){const _e=this.length;return this.resize(_e+1),this.emplace(_e,u,p,w,A,N)}emplace(u,p,w,A,N,_e){const dt=6*u,ir=3*u;return this.uint16[dt+0]=p,this.uint16[dt+1]=w,this.uint16[dt+2]=A,this.uint16[dt+3]=N,this.float32[ir+2]=_e,u}}np.prototype.bytesPerElement=12,vs(np,"StructArrayLayout4ui1f12");class wp extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,p,w,A){const N=this.length;return this.resize(N+1),this.emplace(N,u,p,w,A)}emplace(u,p,w,A,N){const _e=4*u;return this.uint16[_e+0]=p,this.uint16[_e+1]=w,this.uint16[_e+2]=A,this.uint16[_e+3]=N,u}}wp.prototype.bytesPerElement=8,vs(wp,"StructArrayLayout4ui8");class Fp extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,p,w,A,N,_e){const dt=this.length;return this.resize(dt+1),this.emplace(dt,u,p,w,A,N,_e)}emplace(u,p,w,A,N,_e,dt){const ir=6*u;return this.int16[ir+0]=p,this.int16[ir+1]=w,this.int16[ir+2]=A,this.int16[ir+3]=N,this.int16[ir+4]=_e,this.int16[ir+5]=dt,u}}Fp.prototype.bytesPerElement=12,vs(Fp,"StructArrayLayout6i12");class Pp extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,p,w,A,N,_e,dt,ir,Cr,Gn,hs,rl){const ll=this.length;return this.resize(ll+1),this.emplace(ll,u,p,w,A,N,_e,dt,ir,Cr,Gn,hs,rl)}emplace(u,p,w,A,N,_e,dt,ir,Cr,Gn,hs,rl,ll){const ul=12*u;return this.int16[ul+0]=p,this.int16[ul+1]=w,this.int16[ul+2]=A,this.int16[ul+3]=N,this.uint16[ul+4]=_e,this.uint16[ul+5]=dt,this.uint16[ul+6]=ir,this.uint16[ul+7]=Cr,this.int16[ul+8]=Gn,this.int16[ul+9]=hs,this.int16[ul+10]=rl,this.int16[ul+11]=ll,u}}Pp.prototype.bytesPerElement=24,vs(Pp,"StructArrayLayout4i4ui4i24");class Up extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,p,w,A,N,_e){const dt=this.length;return this.resize(dt+1),this.emplace(dt,u,p,w,A,N,_e)}emplace(u,p,w,A,N,_e,dt){const ir=10*u,Cr=5*u;return this.int16[ir+0]=p,this.int16[ir+1]=w,this.int16[ir+2]=A,this.float32[Cr+2]=N,this.float32[Cr+3]=_e,this.float32[Cr+4]=dt,u}}Up.prototype.bytesPerElement=20,vs(Up,"StructArrayLayout3i3f20");class zd extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(u){const p=this.length;return this.resize(p+1),this.emplace(p,u)}emplace(u,p){return this.uint32[1*u+0]=p,u}}zd.prototype.bytesPerElement=4,vs(zd,"StructArrayLayout1ul4");class jf extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,p,w,A,N,_e,dt,ir,Cr,Gn,hs,rl,ll){const ul=this.length;return this.resize(ul+1),this.emplace(ul,u,p,w,A,N,_e,dt,ir,Cr,Gn,hs,rl,ll)}emplace(u,p,w,A,N,_e,dt,ir,Cr,Gn,hs,rl,ll,ul){const th=20*u,fh=10*u;return this.int16[th+0]=p,this.int16[th+1]=w,this.int16[th+2]=A,this.int16[th+3]=N,this.int16[th+4]=_e,this.float32[fh+3]=dt,this.float32[fh+4]=ir,this.float32[fh+5]=Cr,this.float32[fh+6]=Gn,this.int16[th+14]=hs,this.uint32[fh+8]=rl,this.uint16[th+18]=ll,this.uint16[th+19]=ul,u}}jf.prototype.bytesPerElement=40,vs(jf,"StructArrayLayout5i4f1i1ul2ui40");class Pd extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,p,w,A,N,_e,dt){const ir=this.length;return this.resize(ir+1),this.emplace(ir,u,p,w,A,N,_e,dt)}emplace(u,p,w,A,N,_e,dt,ir){const Cr=8*u;return this.int16[Cr+0]=p,this.int16[Cr+1]=w,this.int16[Cr+2]=A,this.int16[Cr+4]=N,this.int16[Cr+5]=_e,this.int16[Cr+6]=dt,this.int16[Cr+7]=ir,u}}Pd.prototype.bytesPerElement=16,vs(Pd,"StructArrayLayout3i2i2i16");class Zd extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,p,w,A,N){const _e=this.length;return this.resize(_e+1),this.emplace(_e,u,p,w,A,N)}emplace(u,p,w,A,N,_e){const dt=4*u,ir=8*u;return this.float32[dt+0]=p,this.float32[dt+1]=w,this.float32[dt+2]=A,this.int16[ir+6]=N,this.int16[ir+7]=_e,u}}Zd.prototype.bytesPerElement=16,vs(Zd,"StructArrayLayout2f1f2i16");class ig extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,p,w,A){const N=this.length;return this.resize(N+1),this.emplace(N,u,p,w,A)}emplace(u,p,w,A,N){const _e=12*u,dt=3*u;return this.uint8[_e+0]=p,this.uint8[_e+1]=w,this.float32[dt+1]=A,this.float32[dt+2]=N,u}}ig.prototype.bytesPerElement=12,vs(ig,"StructArrayLayout2ub2f12");class Jf extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,p,w){const A=this.length;return this.resize(A+1),this.emplace(A,u,p,w)}emplace(u,p,w,A){const N=3*u;return this.float32[N+0]=p,this.float32[N+1]=w,this.float32[N+2]=A,u}}Jf.prototype.bytesPerElement=12,vs(Jf,"StructArrayLayout3f12");class Bd extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,p,w){const A=this.length;return this.resize(A+1),this.emplace(A,u,p,w)}emplace(u,p,w,A){const N=3*u;return this.uint16[N+0]=p,this.uint16[N+1]=w,this.uint16[N+2]=A,u}}Bd.prototype.bytesPerElement=6,vs(Bd,"StructArrayLayout3ui6");class fg extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(u,p,w,A,N,_e,dt,ir,Cr,Gn,hs,rl,ll,ul,th,fh,Ch,zh,Eh,Bh,Hh){const jh=this.length;return this.resize(jh+1),this.emplace(jh,u,p,w,A,N,_e,dt,ir,Cr,Gn,hs,rl,ll,ul,th,fh,Ch,zh,Eh,Bh,Hh)}emplace(u,p,w,A,N,_e,dt,ir,Cr,Gn,hs,rl,ll,ul,th,fh,Ch,zh,Eh,Bh,Hh,jh){const cp=30*u,sp=15*u,Sp=60*u;return this.int16[cp+0]=p,this.int16[cp+1]=w,this.int16[cp+2]=A,this.float32[sp+2]=N,this.float32[sp+3]=_e,this.uint16[cp+8]=dt,this.uint16[cp+9]=ir,this.uint32[sp+5]=Cr,this.uint32[sp+6]=Gn,this.uint32[sp+7]=hs,this.uint16[cp+16]=rl,this.uint16[cp+17]=ll,this.uint16[cp+18]=ul,this.float32[sp+10]=th,this.float32[sp+11]=fh,this.uint8[Sp+48]=Ch,this.uint8[Sp+49]=zh,this.uint8[Sp+50]=Eh,this.uint32[sp+13]=Bh,this.int16[cp+28]=Hh,this.uint8[Sp+58]=jh,u}}fg.prototype.bytesPerElement=60,vs(fg,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Sg extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(u,p,w,A,N,_e,dt,ir,Cr,Gn,hs,rl,ll,ul,th,fh,Ch,zh,Eh,Bh,Hh,jh,cp,sp,Sp,Hp,mp,Dp,Op,zp){const Zp=this.length;return this.resize(Zp+1),this.emplace(Zp,u,p,w,A,N,_e,dt,ir,Cr,Gn,hs,rl,ll,ul,th,fh,Ch,zh,Eh,Bh,Hh,jh,cp,sp,Sp,Hp,mp,Dp,Op,zp)}emplace(u,p,w,A,N,_e,dt,ir,Cr,Gn,hs,rl,ll,ul,th,fh,Ch,zh,Eh,Bh,Hh,jh,cp,sp,Sp,Hp,mp,Dp,Op,zp,Zp){const xp=38*u,pd=19*u;return this.int16[xp+0]=p,this.int16[xp+1]=w,this.int16[xp+2]=A,this.float32[pd+2]=N,this.float32[pd+3]=_e,this.int16[xp+8]=dt,this.int16[xp+9]=ir,this.int16[xp+10]=Cr,this.int16[xp+11]=Gn,this.int16[xp+12]=hs,this.int16[xp+13]=rl,this.uint16[xp+14]=ll,this.uint16[xp+15]=ul,this.uint16[xp+16]=th,this.uint16[xp+17]=fh,this.uint16[xp+18]=Ch,this.uint16[xp+19]=zh,this.uint16[xp+20]=Eh,this.uint16[xp+21]=Bh,this.uint16[xp+22]=Hh,this.uint16[xp+23]=jh,this.uint16[xp+24]=cp,this.uint16[xp+25]=sp,this.uint16[xp+26]=Sp,this.uint16[xp+27]=Hp,this.uint16[xp+28]=mp,this.uint32[pd+15]=Dp,this.float32[pd+16]=Op,this.float32[pd+17]=zp,this.float32[pd+18]=Zp,u}}Sg.prototype.bytesPerElement=76,vs(Sg,"StructArrayLayout3i2f6i15ui1ul3f76");class Tg extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u){const p=this.length;return this.resize(p+1),this.emplace(p,u)}emplace(u,p){return this.float32[1*u+0]=p,u}}Tg.prototype.bytesPerElement=4,vs(Tg,"StructArrayLayout1f4");class gg extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,p,w,A,N){const _e=this.length;return this.resize(_e+1),this.emplace(_e,u,p,w,A,N)}emplace(u,p,w,A,N,_e){const dt=5*u;return this.float32[dt+0]=p,this.float32[dt+1]=w,this.float32[dt+2]=A,this.float32[dt+3]=N,this.float32[dt+4]=_e,u}}gg.prototype.bytesPerElement=20,vs(gg,"StructArrayLayout5f20");class Jm extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,p,w,A){const N=this.length;return this.resize(N+1),this.emplace(N,u,p,w,A)}emplace(u,p,w,A,N){const _e=6*u;return this.uint32[3*u+0]=p,this.uint16[_e+2]=w,this.uint16[_e+3]=A,this.uint16[_e+4]=N,u}}Jm.prototype.bytesPerElement=12,vs(Jm,"StructArrayLayout1ul3ui12");class om extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,p){const w=this.length;return this.resize(w+1),this.emplace(w,u,p)}emplace(u,p,w){const A=2*u;return this.uint16[A+0]=p,this.uint16[A+1]=w,u}}om.prototype.bytesPerElement=4,vs(om,"StructArrayLayout2ui4");class uy extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u){const p=this.length;return this.resize(p+1),this.emplace(p,u)}emplace(u,p){return this.uint16[1*u+0]=p,u}}uy.prototype.bytesPerElement=2,vs(uy,"StructArrayLayout1ui2");class Iy extends Wh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,p){const w=this.length;return this.resize(w+1),this.emplace(w,u,p)}emplace(u,p,w){const A=2*u;return this.float32[A+0]=p,this.float32[A+1]=w,u}}Iy.prototype.bytesPerElement=8,vs(Iy,"StructArrayLayout2f8");class $g extends Vh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}$g.prototype.size=40;class Ag extends jf{get(u){return new $g(this,u)}}vs(Ag,"CollisionBoxArray");class mg extends Vh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(u){this._structArray.uint8[this._pos1+49]=u}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(u){this._structArray.uint8[this._pos1+50]=u}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(u){this._structArray.uint32[this._pos4+13]=u}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(u){this._structArray.uint8[this._pos1+58]=u}}mg.prototype.size=60;class dg extends fg{get(u){return new mg(this,u)}}vs(dg,"PlacedSymbolArray");class wm extends Vh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(u){this._structArray.uint32[this._pos4+15]=u}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}wm.prototype.size=76;class Mg extends Sg{get(u){return new wm(this,u)}}vs(Mg,"SymbolInstanceArray");class cy extends Tg{getoffsetX(u){return this.float32[1*u+0]}}vs(cy,"GlyphOffsetArray");class Kv extends Bp{getx(u){return this.int16[2*u+0]}gety(u){return this.int16[2*u+1]}}vs(Kv,"SymbolLineVertexArray");class b0 extends Vh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}b0.prototype.size=12;class Zv extends Jm{get(u){return new b0(this,u)}}vs(Zv,"FeatureIndexArray");class S_ extends om{geta_centroid_pos0(u){return this.uint16[2*u+0]}geta_centroid_pos1(u){return this.uint16[2*u+1]}}vs(S_,"FillExtrusionCentroidArray");const uv=Zh([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Xv=Zh([{name:"a_dash",components:4,type:"Uint16"}]);var Ux={exports:{}},C0={exports:{}};C0.exports=function(c,u){var p,w,A,N,_e,dt,ir,Cr;for(w=c.length-(p=3&c.length),A=u,_e=3432918353,dt=461845907,Cr=0;Cr<w;)ir=255&c.charCodeAt(Cr)|(255&c.charCodeAt(++Cr))<<8|(255&c.charCodeAt(++Cr))<<16|(255&c.charCodeAt(++Cr))<<24,++Cr,A=27492+(65535&(N=5*(65535&(A=(A^=ir=(65535&(ir=(ir=(65535&ir)*_e+(((ir>>>16)*_e&65535)<<16)&4294967295)<<15|ir>>>17))*dt+(((ir>>>16)*dt&65535)<<16)&4294967295)<<13|A>>>19))+((5*(A>>>16)&65535)<<16)&4294967295))+((58964+(N>>>16)&65535)<<16);switch(ir=0,p){case 3:ir^=(255&c.charCodeAt(Cr+2))<<16;case 2:ir^=(255&c.charCodeAt(Cr+1))<<8;case 1:A^=ir=(65535&(ir=(ir=(65535&(ir^=255&c.charCodeAt(Cr)))*_e+(((ir>>>16)*_e&65535)<<16)&4294967295)<<15|ir>>>17))*dt+(((ir>>>16)*dt&65535)<<16)&4294967295}return A^=c.length,A=2246822507*(65535&(A^=A>>>16))+((2246822507*(A>>>16)&65535)<<16)&4294967295,A=3266489909*(65535&(A^=A>>>13))+((3266489909*(A>>>16)&65535)<<16)&4294967295,(A^=A>>>16)>>>0};var jx=C0.exports,n1={exports:{}};n1.exports=function(c,u){for(var p,w=c.length,A=u^w,N=0;w>=4;)p=1540483477*(65535&(p=255&c.charCodeAt(N)|(255&c.charCodeAt(++N))<<8|(255&c.charCodeAt(++N))<<16|(255&c.charCodeAt(++N))<<24))+((1540483477*(p>>>16)&65535)<<16),A=1540483477*(65535&A)+((1540483477*(A>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),w-=4,++N;switch(w){case 3:A^=(255&c.charCodeAt(N+2))<<16;case 2:A^=(255&c.charCodeAt(N+1))<<8;case 1:A=1540483477*(65535&(A^=255&c.charCodeAt(N)))+((1540483477*(A>>>16)&65535)<<16)}return A=1540483477*(65535&(A^=A>>>13))+((1540483477*(A>>>16)&65535)<<16),(A^=A>>>15)>>>0};var Hx=jx,n_=n1.exports;Ux.exports=Hx,Ux.exports.murmur3=Hx,Ux.exports.murmur2=n_;var o1=vi(Ux.exports);class Ew{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(u,p,w,A){this.ids.push(jb(u)),this.positions.push(p,w,A)}getPositions(u){const p=jb(u);let w=0,A=this.ids.length-1;for(;w<A;){const _e=w+A>>1;this.ids[_e]>=p?A=_e:w=_e+1}const N=[];for(;this.ids[w]===p;)N.push({index:this.positions[3*w],start:this.positions[3*w+1],end:this.positions[3*w+2]}),w++;return N}static serialize(u,p){const w=new Float64Array(u.ids),A=new Uint32Array(u.positions);return W1(w,A,0,w.length-1),p&&p.push(w.buffer,A.buffer),{ids:w,positions:A}}static deserialize(u){const p=new Ew;return p.ids=u.ids,p.positions=u.positions,p.indexed=!0,p}}function jb(c){const u=+c;return!isNaN(u)&&Number.MIN_SAFE_INTEGER<=u&&u<=Number.MAX_SAFE_INTEGER?u:o1(String(c))}function W1(c,u,p,w){for(;p<w;){const A=c[p+w>>1];let N=p-1,_e=w+1;for(;;){do N++;while(c[N]<A);do _e--;while(c[_e]>A);if(N>=_e)break;s1(c,N,_e),s1(u,3*N,3*_e),s1(u,3*N+1,3*_e+1),s1(u,3*N+2,3*_e+2)}_e-p<w-_e?(W1(c,u,p,_e),p=_e+1):(W1(c,u,_e+1,w),w=_e)}}function s1(c,u,p){const w=c[u];c[u]=c[p],c[p]=w}vs(Ew,"FeaturePositionMap");class cv{constructor(u){this.gl=u.gl,this.initialized=!1}fetchUniformLocation(u,p){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(u,p),this.initialized=!0),!!this.location}}class Rx extends cv{constructor(u){super(u),this.current=0}set(u,p,w){this.fetchUniformLocation(u,p)&&this.current!==w&&(this.current=w,this.gl.uniform1f(this.location,w))}}class q1 extends cv{constructor(u){super(u),this.current=[0,0,0,0]}set(u,p,w){this.fetchUniformLocation(u,p)&&(w[0]===this.current[0]&&w[1]===this.current[1]&&w[2]===this.current[2]&&w[3]===this.current[3]||(this.current=w,this.gl.uniform4f(this.location,w[0],w[1],w[2],w[3])))}}class ox extends cv{constructor(u){super(u),this.current=zg.transparent}set(u,p,w){this.fetchUniformLocation(u,p)&&(w.r===this.current.r&&w.g===this.current.g&&w.b===this.current.b&&w.a===this.current.a||(this.current=w,this.gl.uniform4f(this.location,w.r,w.g,w.b,w.a)))}}const Sw=new Float32Array(16),XC=new Float32Array(9),YC=new Float32Array(4);function K1(c){return[Nh(255*c.r,255*c.g),Nh(255*c.b,255*c.a)]}class Tw{constructor(u,p,w){this.value=u,this.uniformNames=p.map(A=>`u_${A}`),this.type=w}setUniform(u,p,w,A,N){p.set(u,N,A.constantOr(this.value))}getBinding(u,p){return this.type==="color"?new ox(u):new Rx(u)}}class Wx{constructor(u,p){this.uniformNames=p.map(w=>`u_${w}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(u){this.pixelRatio=u.pixelRatio||1,this.pattern=u.tl.concat(u.br)}setUniform(u,p,w,A,N){const _e=N==="u_pattern"||N==="u_dash"?this.pattern:N==="u_pixel_ratio"?this.pixelRatio:null;_e&&p.set(u,N,_e)}getBinding(u,p){return p==="u_pattern"||p==="u_dash"?new q1(u):new Rx(u)}}class E0{constructor(u,p,w,A){this.expression=u,this.type=w,this.maxValue=0,this.paintVertexAttributes=p.map(N=>({name:`a_${N}`,type:"Float32",components:w==="color"?2:1,offset:0})),this.paintVertexArray=new A}populatePaintArray(u,p,w,A,N,_e){const dt=this.paintVertexArray.length,ir=this.expression.evaluate(new Vn(0),p,{},N,A,_e);this.paintVertexArray.resize(u),this._setPaintValue(dt,u,ir)}updatePaintArray(u,p,w,A,N){const _e=this.expression.evaluate({zoom:0},w,A,void 0,N);this._setPaintValue(u,p,_e)}_setPaintValue(u,p,w){if(this.type==="color"){const A=K1(w);for(let N=u;N<p;N++)this.paintVertexArray.emplace(N,A[0],A[1])}else{for(let A=u;A<p;A++)this.paintVertexArray.emplace(A,w);this.maxValue=Math.max(this.maxValue,Math.abs(w))}}upload(u){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=u.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class hv{constructor(u,p,w,A,N,_e){this.expression=u,this.uniformNames=p.map(dt=>`u_${dt}_t`),this.type=w,this.useIntegerZoom=A,this.zoom=N,this.maxValue=0,this.paintVertexAttributes=p.map(dt=>({name:`a_${dt}`,type:"Float32",components:w==="color"?4:2,offset:0})),this.paintVertexArray=new _e}populatePaintArray(u,p,w,A,N,_e){const dt=this.expression.evaluate(new Vn(this.zoom),p,{},N,A,_e),ir=this.expression.evaluate(new Vn(this.zoom+1),p,{},N,A,_e),Cr=this.paintVertexArray.length;this.paintVertexArray.resize(u),this._setPaintValue(Cr,u,dt,ir)}updatePaintArray(u,p,w,A,N){const _e=this.expression.evaluate({zoom:this.zoom},w,A,void 0,N),dt=this.expression.evaluate({zoom:this.zoom+1},w,A,void 0,N);this._setPaintValue(u,p,_e,dt)}_setPaintValue(u,p,w,A){if(this.type==="color"){const N=K1(w),_e=K1(A);for(let dt=u;dt<p;dt++)this.paintVertexArray.emplace(dt,N[0],N[1],_e[0],_e[1])}else{for(let N=u;N<p;N++)this.paintVertexArray.emplace(N,w,A);this.maxValue=Math.max(this.maxValue,Math.abs(w),Math.abs(A))}}upload(u){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=u.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(u,p,w,A,N){const _e=this.useIntegerZoom?Math.floor(w.zoom):w.zoom,dt=Jh(this.expression.interpolationFactor(_e,this.zoom,this.zoom+1),0,1);p.set(u,N,dt)}getBinding(u,p){return new Rx(u)}}class Yv{constructor(u,p,w,A,N){this.expression=u,this.layerId=N,this.paintVertexAttributes=(w==="array"?Xv:uv).members;for(let _e=0;_e<p.length;++_e);this.paintVertexArray=new A}populatePaintArray(u,p,w){const A=this.paintVertexArray.length;this.paintVertexArray.resize(u),this._setPaintValues(A,u,p.patterns&&p.patterns[this.layerId],w)}updatePaintArray(u,p,w,A,N,_e){this._setPaintValues(u,p,w.patterns&&w.patterns[this.layerId],_e)}_setPaintValues(u,p,w,A){if(!A||!w)return;const N=A[w];if(!N)return;const{tl:_e,br:dt,pixelRatio:ir}=N;for(let Cr=u;Cr<p;Cr++)this.paintVertexArray.emplace(Cr,_e[0],_e[1],dt[0],dt[1],ir)}upload(u){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=u.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class sx{constructor(u,p,w=()=>!0){this.binders={},this._buffers=[];const A=[];for(const N in u.paint._values){if(!w(N))continue;const _e=u.paint.get(N);if(!(_e instanceof yh&&t_(_e.property.specification)))continue;const dt=gm(N,u.type),ir=_e.value,Cr=_e.property.specification.type,Gn=!!_e.property.useIntegerZoom,hs=N==="line-dasharray"||N.endsWith("pattern"),rl=N==="line-dasharray"&&u.layout.get("line-cap").value.kind!=="constant";if(ir.kind!=="constant"||rl)if(ir.kind==="source"||rl||hs){const ll=Aw(N,Cr,"source");this.binders[N]=hs?new Yv(ir,dt,Cr,ll,u.id):new E0(ir,dt,Cr,ll),A.push(`/a_${N}`)}else{const ll=Aw(N,Cr,"composite");this.binders[N]=new hv(ir,dt,Cr,Gn,p,ll),A.push(`/z_${N}`)}else this.binders[N]=hs?new Wx(ir.value,dt):new Tw(ir.value,dt,Cr),A.push(`/u_${N}`)}this.cacheKey=A.sort().join("")}getMaxValue(u){const p=this.binders[u];return p instanceof E0||p instanceof hv?p.maxValue:0}populatePaintArrays(u,p,w,A,N,_e){for(const dt in this.binders){const ir=this.binders[dt];(ir instanceof E0||ir instanceof hv||ir instanceof Yv)&&ir.populatePaintArray(u,p,w,A,N,_e)}}setConstantPatternPositions(u){for(const p in this.binders){const w=this.binders[p];w instanceof Wx&&w.setConstantPatternPositions(u)}}updatePaintArrays(u,p,w,A,N,_e){let dt=!1;for(const ir in u){const Cr=p.getPositions(ir);for(const Gn of Cr){const hs=w.feature(Gn.index);for(const rl in this.binders){const ll=this.binders[rl];if((ll instanceof E0||ll instanceof hv||ll instanceof Yv)&&ll.expression.isStateDependent===!0){const ul=A.paint.get(rl);ll.expression=ul.value,ll.updatePaintArray(Gn.start,Gn.end,hs,u[ir],N,_e),dt=!0}}}}return dt}defines(){const u=[];for(const p in this.binders){const w=this.binders[p];(w instanceof Tw||w instanceof Wx)&&u.push(...w.uniformNames.map(A=>`#define HAS_UNIFORM_${A}`))}return u}getBinderAttributes(){const u=[];for(const p in this.binders){const w=this.binders[p];if(w instanceof E0||w instanceof hv||w instanceof Yv)for(let A=0;A<w.paintVertexAttributes.length;A++)u.push(w.paintVertexAttributes[A].name)}return u}getBinderUniforms(){const u=[];for(const p in this.binders){const w=this.binders[p];if(w instanceof Tw||w instanceof Wx||w instanceof hv)for(const A of w.uniformNames)u.push(A)}return u}getPaintVertexBuffers(){return this._buffers}getUniforms(u){const p=[];for(const w in this.binders){const A=this.binders[w];if(A instanceof Tw||A instanceof Wx||A instanceof hv)for(const N of A.uniformNames)p.push({name:N,property:w,binding:A.getBinding(u,N)})}return p}setUniforms(u,p,w,A,N){for(const{name:_e,property:dt,binding:ir}of w)this.binders[dt].setUniform(u,ir,N,A.get(dt),_e)}updatePaintBuffers(){this._buffers=[];for(const u in this.binders){const p=this.binders[u];(p instanceof E0||p instanceof hv||p instanceof Yv)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(u){for(const p in this.binders){const w=this.binders[p];(w instanceof E0||w instanceof hv||w instanceof Yv)&&w.upload(u)}this.updatePaintBuffers()}destroy(){for(const u in this.binders){const p=this.binders[u];(p instanceof E0||p instanceof hv||p instanceof Yv)&&p.destroy()}}}class T_{constructor(u,p,w=()=>!0){this.programConfigurations={};for(const A of u)this.programConfigurations[A.id]=new sx(A,p,w);this.needsUpload=!1,this._featureMap=new Ew,this._bufferOffset=0}populatePaintArrays(u,p,w,A,N,_e,dt){for(const ir in this.programConfigurations)this.programConfigurations[ir].populatePaintArrays(u,p,A,N,_e,dt);p.id!==void 0&&this._featureMap.add(p.id,w,this._bufferOffset,u),this._bufferOffset=u,this.needsUpload=!0}updatePaintArrays(u,p,w,A,N){for(const _e of w)this.needsUpload=this.programConfigurations[_e.id].updatePaintArrays(u,this._featureMap,p,_e,A,N)||this.needsUpload}get(u){return this.programConfigurations[u]}upload(u){if(this.needsUpload){for(const p in this.programConfigurations)this.programConfigurations[p].upload(u);this.needsUpload=!1}}destroy(){for(const u in this.programConfigurations)this.programConfigurations[u].destroy()}}const JC={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function gm(c,u){return JC[c]||[c.replace(`${u}-`,"").replace(/-/g,"_")]}const a1={"line-pattern":{source:np,composite:np},"fill-pattern":{source:np,composite:np},"fill-extrusion-pattern":{source:np,composite:np},"line-dasharray":{source:wp,composite:wp}},Hb={color:{source:Iy,composite:bp},number:{source:Tg,composite:Iy}};function Aw(c,u,p){const w=a1[c];return w&&w[p]||Hb[u][p]}vs(Tw,"ConstantBinder"),vs(Wx,"PatternConstantBinder"),vs(E0,"SourceExpressionBinder"),vs(Yv,"PatternCompositeBinder"),vs(hv,"CompositeExpressionBinder"),vs(sx,"ProgramConfiguration",{omit:["_buffers"]}),vs(T_,"ProgramConfigurationSet");const Rw="-transition";class Py extends fy{constructor(u,p){if(super(),this.id=u.id,this.type=u.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,u.type!=="custom"&&(this.metadata=u.metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&u.type!=="sky"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),p.layout&&(this._unevaluatedLayout=new _h(p.layout)),p.paint)){this._transitionablePaint=new dl(p.paint);for(const w in u.paint)this.setPaintProperty(w,u.paint[w],{validate:!1});for(const w in u.layout)this.setLayoutProperty(w,u.layout[w],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xh(p.paint)}}getLayoutProperty(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)}setLayoutProperty(u,p,w={}){p!=null&&this._validate(m,`layers.${this.id}.layout.${u}`,u,p,w)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,p):this.visibility=p)}getPaintProperty(u){return Gd(u,Rw)?this._transitionablePaint.getTransition(u.slice(0,-11)):this._transitionablePaint.getValue(u)}setPaintProperty(u,p,w={}){if(p!=null&&this._validate(ot,`layers.${this.id}.paint.${u}`,u,p,w))return!1;if(Gd(u,Rw))return this._transitionablePaint.setTransition(u.slice(0,-11),p||void 0),!1;{const A=this._transitionablePaint._values[u],N=A.value.isDataDriven(),_e=A.value;this._transitionablePaint.setValue(u,p),this._handleSpecialPaintPropertyUpdate(u);const dt=this._transitionablePaint._values[u].value,ir=dt.isDataDriven(),Cr=Gd(u,"pattern")||u==="line-dasharray";return ir||N||Cr||this._handleOverridablePaintPropertyUpdate(u,_e,dt)}}_handleSpecialPaintPropertyUpdate(u){}getProgramIds(){return null}getProgramConfiguration(u){return null}_handleOverridablePaintPropertyUpdate(u,p,w){return!1}isHidden(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"}updateTransitions(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(u,p){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,p)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,p)}serialize(){const u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),Ad(u,(p,w)=>!(p===void 0||w==="layout"&&!Object.keys(p).length||w==="paint"&&!Object.keys(p).length))}_validate(u,p,w,A,N={}){return(!N||N.validate!==!1)&&Ee(this,u.call(w0,{key:p,layerType:this.type,objectKey:w,value:A,styleSpec:hp,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const u in this.paint._values){const p=this.paint.get(u);if(p instanceof yh&&t_(p.property.specification)&&(p.value.kind==="source"||p.value.kind==="composite")&&p.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=jv(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Wb=Zh([{name:"a_pos",components:2,type:"Int16"}],4),qb=Zh([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Kg{constructor(u=[]){this.segments=u}prepareSegment(u,p,w,A){let N=this.segments[this.segments.length-1];return u>Kg.MAX_VERTEX_ARRAY_LENGTH&&Ap(`Max vertices per segment is ${Kg.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${u}`),(!N||N.vertexLength+u>Kg.MAX_VERTEX_ARRAY_LENGTH||N.sortKey!==A)&&(N={vertexOffset:p.length,primitiveOffset:w.length,vertexLength:0,primitiveLength:0},A!==void 0&&(N.sortKey=A),this.segments.push(N)),N}get(){return this.segments}destroy(){for(const u of this.segments)for(const p in u.vaos)u.vaos[p].destroy()}static simpleSegment(u,p,w,A){return new Kg([{vertexOffset:u,primitiveOffset:p,vertexLength:w,primitiveLength:A,vaos:{},sortKey:0}])}}Kg.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,vs(Kg,"SegmentVector");var Hd=8192;class Jv{constructor(u,p){u&&(p?this.setSouthWest(u).setNorthEast(p):u.length===4?this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]]):this.setSouthWest(u[0]).setNorthEast(u[1]))}setNorthEast(u){return this._ne=u instanceof Rg?new Rg(u.lng,u.lat):Rg.convert(u),this}setSouthWest(u){return this._sw=u instanceof Rg?new Rg(u.lng,u.lat):Rg.convert(u),this}extend(u){const p=this._sw,w=this._ne;let A,N;if(u instanceof Rg)A=u,N=u;else{if(!(u instanceof Jv))return Array.isArray(u)?u.length===4||u.every(Array.isArray)?this.extend(Jv.convert(u)):this.extend(Rg.convert(u)):typeof u=="object"&&u!==null&&u.hasOwnProperty("lat")&&(u.hasOwnProperty("lon")||u.hasOwnProperty("lng"))?this.extend(Rg.convert(u)):this;if(A=u._sw,N=u._ne,!A||!N)return this}return p||w?(p.lng=Math.min(A.lng,p.lng),p.lat=Math.min(A.lat,p.lat),w.lng=Math.max(N.lng,w.lng),w.lat=Math.max(N.lat,w.lat)):(this._sw=new Rg(A.lng,A.lat),this._ne=new Rg(N.lng,N.lat)),this}getCenter(){return new Rg((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Rg(this.getWest(),this.getNorth())}getSouthEast(){return new Rg(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(u){const{lng:p,lat:w}=Rg.convert(u);let A=this._sw.lng<=p&&p<=this._ne.lng;return this._sw.lng>this._ne.lng&&(A=this._sw.lng>=p&&p>=this._ne.lng),this._sw.lat<=w&&w<=this._ne.lat&&A}static convert(u){return!u||u instanceof Jv?u:new Jv(u)}}var Iw=1e-6,Vy=typeof Float32Array<"u"?Float32Array:Array;function Z1(){var c=new Vy(9);return Vy!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c}function qx(c,u,p){var w=u[0],A=u[1],N=u[2],_e=u[3],dt=u[4],ir=u[5],Cr=u[6],Gn=u[7],hs=u[8],rl=p[0],ll=p[1],ul=p[2],th=p[3],fh=p[4],Ch=p[5],zh=p[6],Eh=p[7],Bh=p[8];return c[0]=rl*w+ll*_e+ul*Cr,c[1]=rl*A+ll*dt+ul*Gn,c[2]=rl*N+ll*ir+ul*hs,c[3]=th*w+fh*_e+Ch*Cr,c[4]=th*A+fh*dt+Ch*Gn,c[5]=th*N+fh*ir+Ch*hs,c[6]=zh*w+Eh*_e+Bh*Cr,c[7]=zh*A+Eh*dt+Bh*Gn,c[8]=zh*N+Eh*ir+Bh*hs,c}function pv(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function Pw(c,u){var p=u[0],w=u[1],A=u[2],N=u[3],_e=u[4],dt=u[5],ir=u[6],Cr=u[7],Gn=u[8],hs=u[9],rl=u[10],ll=u[11],ul=u[12],th=u[13],fh=u[14],Ch=u[15],zh=p*dt-w*_e,Eh=p*ir-A*_e,Bh=p*Cr-N*_e,Hh=w*ir-A*dt,jh=w*Cr-N*dt,cp=A*Cr-N*ir,sp=Gn*th-hs*ul,Sp=Gn*fh-rl*ul,Hp=Gn*Ch-ll*ul,mp=hs*fh-rl*th,Dp=hs*Ch-ll*th,Op=rl*Ch-ll*fh,zp=zh*Op-Eh*Dp+Bh*mp+Hh*Hp-jh*Sp+cp*sp;return zp?(c[0]=(dt*Op-ir*Dp+Cr*mp)*(zp=1/zp),c[1]=(A*Dp-w*Op-N*mp)*zp,c[2]=(th*cp-fh*jh+Ch*Hh)*zp,c[3]=(rl*jh-hs*cp-ll*Hh)*zp,c[4]=(ir*Hp-_e*Op-Cr*Sp)*zp,c[5]=(p*Op-A*Hp+N*Sp)*zp,c[6]=(fh*Bh-ul*cp-Ch*Eh)*zp,c[7]=(Gn*cp-rl*Bh+ll*Eh)*zp,c[8]=(_e*Dp-dt*Hp+Cr*sp)*zp,c[9]=(w*Hp-p*Dp-N*sp)*zp,c[10]=(ul*jh-th*Bh+Ch*zh)*zp,c[11]=(hs*Bh-Gn*jh-ll*zh)*zp,c[12]=(dt*Sp-_e*mp-ir*sp)*zp,c[13]=(p*mp-w*Sp+A*sp)*zp,c[14]=(th*Eh-ul*Hh-fh*zh)*zp,c[15]=(Gn*Hh-hs*Eh+rl*zh)*zp,c):null}function Ix(c,u,p){var w=u[0],A=u[1],N=u[2],_e=u[3],dt=u[4],ir=u[5],Cr=u[6],Gn=u[7],hs=u[8],rl=u[9],ll=u[10],ul=u[11],th=u[12],fh=u[13],Ch=u[14],zh=u[15],Eh=p[0],Bh=p[1],Hh=p[2],jh=p[3];return c[0]=Eh*w+Bh*dt+Hh*hs+jh*th,c[1]=Eh*A+Bh*ir+Hh*rl+jh*fh,c[2]=Eh*N+Bh*Cr+Hh*ll+jh*Ch,c[3]=Eh*_e+Bh*Gn+Hh*ul+jh*zh,c[4]=(Eh=p[4])*w+(Bh=p[5])*dt+(Hh=p[6])*hs+(jh=p[7])*th,c[5]=Eh*A+Bh*ir+Hh*rl+jh*fh,c[6]=Eh*N+Bh*Cr+Hh*ll+jh*Ch,c[7]=Eh*_e+Bh*Gn+Hh*ul+jh*zh,c[8]=(Eh=p[8])*w+(Bh=p[9])*dt+(Hh=p[10])*hs+(jh=p[11])*th,c[9]=Eh*A+Bh*ir+Hh*rl+jh*fh,c[10]=Eh*N+Bh*Cr+Hh*ll+jh*Ch,c[11]=Eh*_e+Bh*Gn+Hh*ul+jh*zh,c[12]=(Eh=p[12])*w+(Bh=p[13])*dt+(Hh=p[14])*hs+(jh=p[15])*th,c[13]=Eh*A+Bh*ir+Hh*rl+jh*fh,c[14]=Eh*N+Bh*Cr+Hh*ll+jh*Ch,c[15]=Eh*_e+Bh*Gn+Hh*ul+jh*zh,c}function Px(c,u,p){var w,A,N,_e,dt,ir,Cr,Gn,hs,rl,ll,ul,th=p[0],fh=p[1],Ch=p[2];return u===c?(c[12]=u[0]*th+u[4]*fh+u[8]*Ch+u[12],c[13]=u[1]*th+u[5]*fh+u[9]*Ch+u[13],c[14]=u[2]*th+u[6]*fh+u[10]*Ch+u[14],c[15]=u[3]*th+u[7]*fh+u[11]*Ch+u[15]):(A=u[1],N=u[2],_e=u[3],dt=u[4],ir=u[5],Cr=u[6],Gn=u[7],hs=u[8],rl=u[9],ll=u[10],ul=u[11],c[0]=w=u[0],c[1]=A,c[2]=N,c[3]=_e,c[4]=dt,c[5]=ir,c[6]=Cr,c[7]=Gn,c[8]=hs,c[9]=rl,c[10]=ll,c[11]=ul,c[12]=w*th+dt*fh+hs*Ch+u[12],c[13]=A*th+ir*fh+rl*Ch+u[13],c[14]=N*th+Cr*fh+ll*Ch+u[14],c[15]=_e*th+Gn*fh+ul*Ch+u[15]),c}function S0(c,u,p){var w=p[0],A=p[1],N=p[2];return c[0]=u[0]*w,c[1]=u[1]*w,c[2]=u[2]*w,c[3]=u[3]*w,c[4]=u[4]*A,c[5]=u[5]*A,c[6]=u[6]*A,c[7]=u[7]*A,c[8]=u[8]*N,c[9]=u[9]*N,c[10]=u[10]*N,c[11]=u[11]*N,c[12]=u[12],c[13]=u[13],c[14]=u[14],c[15]=u[15],c}function Mw(c,u,p){var w=Math.sin(p),A=Math.cos(p),N=u[4],_e=u[5],dt=u[6],ir=u[7],Cr=u[8],Gn=u[9],hs=u[10],rl=u[11];return u!==c&&(c[0]=u[0],c[1]=u[1],c[2]=u[2],c[3]=u[3],c[12]=u[12],c[13]=u[13],c[14]=u[14],c[15]=u[15]),c[4]=N*A+Cr*w,c[5]=_e*A+Gn*w,c[6]=dt*A+hs*w,c[7]=ir*A+rl*w,c[8]=Cr*A-N*w,c[9]=Gn*A-_e*w,c[10]=hs*A-dt*w,c[11]=rl*A-ir*w,c}function Dw(c,u,p){var w=Math.sin(p),A=Math.cos(p),N=u[0],_e=u[1],dt=u[2],ir=u[3],Cr=u[8],Gn=u[9],hs=u[10],rl=u[11];return u!==c&&(c[4]=u[4],c[5]=u[5],c[6]=u[6],c[7]=u[7],c[12]=u[12],c[13]=u[13],c[14]=u[14],c[15]=u[15]),c[0]=N*A-Cr*w,c[1]=_e*A-Gn*w,c[2]=dt*A-hs*w,c[3]=ir*A-rl*w,c[8]=N*w+Cr*A,c[9]=_e*w+Gn*A,c[10]=dt*w+hs*A,c[11]=ir*w+rl*A,c}function X1(c,u){return c[0]=u[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=u[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=u[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function Kb(c,u,p){var w,A,N,_e=p[0],dt=p[1],ir=p[2],Cr=Math.hypot(_e,dt,ir);return Cr<Iw?null:(_e*=Cr=1/Cr,dt*=Cr,ir*=Cr,w=Math.sin(u),A=Math.cos(u),c[0]=_e*_e*(N=1-A)+A,c[1]=dt*_e*N+ir*w,c[2]=ir*_e*N-dt*w,c[3]=0,c[4]=_e*dt*N-ir*w,c[5]=dt*dt*N+A,c[6]=ir*dt*N+_e*w,c[7]=0,c[8]=_e*ir*N+dt*w,c[9]=dt*ir*N-_e*w,c[10]=ir*ir*N+A,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c)}Math.hypot||(Math.hypot=function(){for(var c=0,u=arguments.length;u--;)c+=arguments[u]*arguments[u];return Math.sqrt(c)});var QC=Ix;function Y1(){var c=new Vy(3);return Vy!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function Zb(c){var u=new Vy(3);return u[0]=c[0],u[1]=c[1],u[2]=c[2],u}function A_(c){return Math.hypot(c[0],c[1],c[2])}function Kx(c,u,p){var w=new Vy(3);return w[0]=c,w[1]=u,w[2]=p,w}function Qv(c,u,p){return c[0]=u[0]+p[0],c[1]=u[1]+p[1],c[2]=u[2]+p[2],c}function ax(c,u,p){return c[0]=u[0]-p[0],c[1]=u[1]-p[1],c[2]=u[2]-p[2],c}function Xb(c,u,p){return c[0]=u[0]*p[0],c[1]=u[1]*p[1],c[2]=u[2]*p[2],c}function Ow(c,u,p){return c[0]=Math.min(u[0],p[0]),c[1]=Math.min(u[1],p[1]),c[2]=Math.min(u[2],p[2]),c}function Lw(c,u,p){return c[0]=Math.max(u[0],p[0]),c[1]=Math.max(u[1],p[1]),c[2]=Math.max(u[2],p[2]),c}function $y(c,u,p){return c[0]=u[0]*p,c[1]=u[1]*p,c[2]=u[2]*p,c}function Zx(c,u,p,w){return c[0]=u[0]+p[0]*w,c[1]=u[1]+p[1]*w,c[2]=u[2]+p[2]*w,c}function wy(c,u){var p=u[0],w=u[1],A=u[2],N=p*p+w*w+A*A;return N>0&&(N=1/Math.sqrt(N)),c[0]=u[0]*N,c[1]=u[1]*N,c[2]=u[2]*N,c}function R_(c,u){return c[0]*u[0]+c[1]*u[1]+c[2]*u[2]}function J1(c,u,p){var w=u[0],A=u[1],N=u[2],_e=p[0],dt=p[1],ir=p[2];return c[0]=A*ir-N*dt,c[1]=N*_e-w*ir,c[2]=w*dt-A*_e,c}function sm(c,u,p){var w=u[0],A=u[1],N=u[2],_e=p[3]*w+p[7]*A+p[11]*N+p[15];return c[0]=(p[0]*w+p[4]*A+p[8]*N+p[12])/(_e=_e||1),c[1]=(p[1]*w+p[5]*A+p[9]*N+p[13])/_e,c[2]=(p[2]*w+p[6]*A+p[10]*N+p[14])/_e,c}function l1(c,u,p){var w=p[0],A=p[1],N=p[2],_e=u[0],dt=u[1],ir=u[2],Cr=A*ir-N*dt,Gn=N*_e-w*ir,hs=w*dt-A*_e,rl=A*hs-N*Gn,ll=N*Cr-w*hs,ul=w*Gn-A*Cr,th=2*p[3];return Gn*=th,hs*=th,ll*=2,ul*=2,c[0]=_e+(Cr*=th)+(rl*=2),c[1]=dt+Gn+ll,c[2]=ir+hs+ul,c}var T0,o_=ax,eE=Xb,tE=A_;function Q1(c,u,p){return c[0]=u[0]*p,c[1]=u[1]*p,c[2]=u[2]*p,c[3]=u[3]*p,c}function Yb(c,u){var p=u[0],w=u[1],A=u[2],N=u[3],_e=p*p+w*w+A*A+N*N;return _e>0&&(_e=1/Math.sqrt(_e)),c[0]=p*_e,c[1]=w*_e,c[2]=A*_e,c[3]=N*_e,c}function dv(c,u,p){var w=u[0],A=u[1],N=u[2],_e=u[3];return c[0]=p[0]*w+p[4]*A+p[8]*N+p[12]*_e,c[1]=p[1]*w+p[5]*A+p[9]*N+p[13]*_e,c[2]=p[2]*w+p[6]*A+p[10]*N+p[14]*_e,c[3]=p[3]*w+p[7]*A+p[11]*N+p[15]*_e,c}function eb(){var c=new Vy(4);return Vy!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c[3]=1,c}function Jb(c){return c[0]=0,c[1]=0,c[2]=0,c[3]=1,c}function Qb(c,u,p){p*=.5;var w=u[0],A=u[1],N=u[2],_e=u[3],dt=Math.sin(p),ir=Math.cos(p);return c[0]=w*ir+_e*dt,c[1]=A*ir+N*dt,c[2]=N*ir-A*dt,c[3]=_e*ir-w*dt,c}function eC(c,u,p){p*=.5;var w=u[0],A=u[1],N=u[2],_e=u[3],dt=Math.sin(p),ir=Math.cos(p);return c[0]=w*ir-N*dt,c[1]=A*ir+_e*dt,c[2]=N*ir+w*dt,c[3]=_e*ir-A*dt,c}Y1(),T0=new Vy(4),Vy!=Float32Array&&(T0[0]=0,T0[1]=0,T0[2]=0,T0[3]=0);var rE=Yb;Y1(),Kx(1,0,0),Kx(0,1,0),eb(),eb(),Z1();const iE=Zh([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:tC}=iE,tb=Zh([{name:"a_pos_3",components:3,type:"Int16"}]);var Mx=Zh([{name:"a_pos",type:"Int16",components:2}]);class u1{constructor(u,p){this.pos=u,this.dir=p}intersectsPlane(u,p,w){const A=R_(p,this.dir);if(Math.abs(A)<1e-6)return!1;const N=((u[0]-this.pos[0])*p[0]+(u[1]-this.pos[1])*p[1]+(u[2]-this.pos[2])*p[2])/A;return w[0]=this.pos[0]+this.dir[0]*N,w[1]=this.pos[1]+this.dir[1]*N,w[2]=this.pos[2]+this.dir[2]*N,!0}closestPointOnSphere(u,p,w){if(function(ll,ul){var th=ll[0],fh=ll[1],Ch=ll[2],zh=ul[0],Eh=ul[1],Bh=ul[2];return Math.abs(th-zh)<=Iw*Math.max(1,Math.abs(th),Math.abs(zh))&&Math.abs(fh-Eh)<=Iw*Math.max(1,Math.abs(fh),Math.abs(Eh))&&Math.abs(Ch-Bh)<=Iw*Math.max(1,Math.abs(Ch),Math.abs(Bh))}(this.pos,u)||p===0)return w[0]=w[1]=w[2]=0,!1;const[A,N,_e]=this.dir,dt=this.pos[0]-u[0],ir=this.pos[1]-u[1],Cr=this.pos[2]-u[2],Gn=A*A+N*N+_e*_e,hs=2*(dt*A+ir*N+Cr*_e),rl=hs*hs-4*Gn*(dt*dt+ir*ir+Cr*Cr-p*p);if(rl<0){const ll=Math.max(-hs/2,0),ul=dt+A*ll,th=ir+N*ll,fh=Cr+_e*ll,Ch=Math.hypot(ul,th,fh);return w[0]=ul*p/Ch,w[1]=th*p/Ch,w[2]=fh*p/Ch,!1}{const ll=(-hs-Math.sqrt(rl))/(2*Gn);if(ll<0){const ul=Math.hypot(dt,ir,Cr);return w[0]=dt*p/ul,w[1]=ir*p/ul,w[2]=Cr*p/ul,!1}return w[0]=dt+A*ll,w[1]=ir+N*ll,w[2]=Cr+_e*ll,!0}}}class c1{constructor(u,p,w,A,N){this.TL=u,this.TR=p,this.BR=w,this.BL=A,this.horizon=N}static fromInvProjectionMatrix(u,p,w){const A=[-1,1,1],N=[1,1,1],_e=[1,-1,1],dt=[-1,-1,1],ir=sm(A,A,u),Cr=sm(N,N,u),Gn=sm(_e,_e,u),hs=sm(dt,dt,u);return new c1(ir,Cr,Gn,hs,p/w)}}class h1{constructor(u,p){this.points=u,this.planes=p}static fromInvProjectionMatrix(u,p,w,A){const N=Math.pow(2,w),_e=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(ir=>{const Cr=dv([],ir,u),Gn=1/Cr[3]/p*N;return function(hs,rl,ll){return hs[0]=rl[0]*ll[0],hs[1]=rl[1]*ll[1],hs[2]=rl[2]*ll[2],hs[3]=rl[3]*ll[3],hs}(Cr,Cr,[Gn,Gn,A?1/Cr[3]:Gn,Gn])}),dt=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(ir=>{const Cr=wy([],J1([],o_([],_e[ir[0]],_e[ir[1]]),o_([],_e[ir[2]],_e[ir[1]]))),Gn=-R_(Cr,_e[ir[1]]);return Cr.concat(Gn)});return new h1(_e,dt)}}class by{static fromPoints(u){const p=[1/0,1/0,1/0],w=[-1/0,-1/0,-1/0];for(const A of u)Ow(p,p,A),Lw(w,w,A);return new by(p,w)}static applyTransform(u,p){const w=u.getCorners();for(let A=0;A<w.length;++A)sm(w[A],w[A],p);return by.fromPoints(w)}constructor(u,p){this.min=u,this.max=p,this.center=$y([],Qv([],this.min,this.max),.5)}quadrant(u){const p=[u%2==0,u<2],w=Zb(this.min),A=Zb(this.max);for(let N=0;N<p.length;N++)w[N]=p[N]?this.min[N]:this.center[N],A[N]=p[N]?this.center[N]:this.max[N];return A[2]=this.max[2],new by(w,A)}distanceX(u){return Math.max(Math.min(this.max[0],u[0]),this.min[0])-u[0]}distanceY(u){return Math.max(Math.min(this.max[1],u[1]),this.min[1])-u[1]}distanceZ(u){return Math.max(Math.min(this.max[2],u[2]),this.min[2])-u[2]}getCorners(){const u=this.min,p=this.max;return[[u[0],u[1],u[2]],[p[0],u[1],u[2]],[p[0],p[1],u[2]],[u[0],p[1],u[2]],[u[0],u[1],p[2]],[p[0],u[1],p[2]],[p[0],p[1],p[2]],[u[0],p[1],p[2]]]}intersects(u){const p=this.getCorners();let w=!0;for(let A=0;A<u.planes.length;A++){const N=u.planes[A];let _e=0;for(let dt=0;dt<p.length;dt++)_e+=R_(N,p[dt])+N[3]>=0;if(_e===0)return 0;_e!==p.length&&(w=!1)}if(w)return 2;for(let A=0;A<3;A++){let N=Number.MAX_VALUE,_e=-Number.MAX_VALUE;for(let dt=0;dt<u.points.length;dt++){const ir=u.points[dt][A]-this.min[A];N=Math.min(N,ir),_e=Math.max(_e,ir)}if(_e<0||N>this.max[A]-this.min[A])return 0}return 1}}const Xx=5,rb=6,e0=Hd/Math.PI/2,nE=16383,Dx=64,Yx=[Dx,32,16],I_=-e0,P_=e0,Fw=[new by([I_,I_,I_],[P_,P_,P_]),new by([I_,I_,I_],[0,0,P_]),new by([0,I_,I_],[P_,0,P_]),new by([I_,0,I_],[0,P_,P_]),new by([0,0,I_],[P_,P_,P_])];function mm(c){return c*e0/zw}function ib(c,u,p,w=!0){const A=$y([],c._camera.position,c.worldSize),N=[u,p,1,1];dv(N,N,c.pixelMatrixInverse),Q1(N,N,1/N[3]);const _e=wy([],o_([],N,A)),dt=c.globeMatrix,ir=[dt[12],dt[13],dt[14]],Cr=o_([],ir,A),Gn=A_(Cr),hs=wy([],Cr),rl=c.worldSize/(2*Math.PI),ll=R_(hs,_e),ul=Math.asin(rl/Gn);if(ul<Math.acos(ll)){if(!w)return null;const Hp=[],mp=[];$y(Hp,_e,Gn/ll),wy(mp,o_(mp,Hp,Cr)),wy(_e,Qv(_e,Cr,$y(_e,mp,Math.tan(ul)*Gn)))}const th=[];new u1(A,_e).closestPointOnSphere(ir,rl,th);const fh=wy([],kp(dt,0)),Ch=wy([],kp(dt,1)),zh=wy([],kp(dt,2)),Eh=R_(fh,th),Bh=R_(Ch,th),Hh=R_(zh,th),jh=wh(Math.asin(-Bh/rl));let cp=wh(Math.atan2(Eh,Hh));cp=c.center.lng+function(Hp,mp){const Dp=(mp-Hp+180)%360-180;return Dp<-180?Dp+360:Dp}(c.center.lng,cp);const sp=am(cp),Sp=Jh(M_(jh),0,1);return new P0(sp,Sp)}class rC{constructor(u,p,w){this.a=o_([],u,w),this.b=o_([],p,w),this.center=w;const A=wy([],this.a),N=wy([],this.b);this.angle=Math.acos(R_(A,N))}}function p1(c,u){if(c.angle===0)return null;let p;return p=c.a[u]===0?1/c.angle*.5*Math.PI:1/c.angle*Math.atan(c.b[u]/c.a[u]/Math.sin(c.angle)-1/Math.tan(c.angle)),p<0||p>1?null:function(w,A,N,_e){const dt=Math.sin(N);return w*(Math.sin((1-_e)*N)/dt)+A*(Math.sin(_e*N)/dt)}(c.a[u],c.b[u],c.angle,Jh(p,0,1))+c.center[u]}function cg(c){if(c.z<=1)return Fw[c.z+2*c.y+c.x];const u=d1(I0(c));return by.fromPoints(u)}function A0(c,u,p){return $y(c,c,1-p),Zx(c,c,u,p)}function nb(c,u){const p=ew(u.zoom);if(p===0)return cg(c);const w=I0(c),A=d1(w),N=am(w.getWest())*u.worldSize,_e=am(w.getEast())*u.worldSize,dt=M_(w.getNorth())*u.worldSize,ir=M_(w.getSouth())*u.worldSize,Cr=[N,dt,0],Gn=[_e,dt,0],hs=[N,ir,0],rl=[_e,ir,0],ll=Pw([],u.globeMatrix);return sm(Cr,Cr,ll),sm(Gn,Gn,ll),sm(hs,hs,ll),sm(rl,rl,ll),A[0]=A0(A[0],hs,p),A[1]=A0(A[1],rl,p),A[2]=A0(A[2],Gn,p),A[3]=A0(A[3],Cr,p),by.fromPoints(A)}function ob(c,u,p){for(const w of c)sm(w,w,u),$y(w,w,p)}function R0(c,u,p){const w=u/c.worldSize,A=c.globeMatrix;if(p.z<=1){const sp=cg(p).getCorners();return ob(sp,A,w),by.fromPoints(sp)}const N=I0(p),_e=d1(N);ob(_e,A,w);const dt=Number.MAX_VALUE,ir=[-dt,-dt,-dt],Cr=[dt,dt,dt];if(N.contains(c.center)){for(const Hp of _e)Ow(Cr,Cr,Hp),Lw(ir,ir,Hp);ir[2]=0;const sp=c.point,Sp=[sp.x*w,sp.y*w,0];return Ow(Cr,Cr,Sp),Lw(ir,ir,Sp),new by(Cr,ir)}const Gn=[A[12]*w,A[13]*w,A[14]*w],hs=N.getCenter(),rl=Jh(c.center.lat,-ym,ym),ll=Jh(hs.lat,-ym,ym),ul=am(c.center.lng),th=M_(rl);let fh=ul-am(hs.lng);const Ch=th-M_(ll);fh>.5?fh-=1:fh<-.5&&(fh+=1);let zh=0;Math.abs(fh)>Math.abs(Ch)?zh=fh>=0?1:3:(zh=Ch>=0?0:2,Zx(Gn,Gn,[A[4]*w,A[5]*w,A[6]*w],-Math.sin(rh(Ch>=0?N.getSouth():N.getNorth()))*e0));const Eh=_e[zh],Bh=_e[(zh+1)%4],Hh=new rC(Eh,Bh,Gn),jh=[p1(Hh,0)||Eh[0],p1(Hh,1)||Eh[1],p1(Hh,2)||Eh[2]],cp=ew(c.zoom);if(cp>0){const sp=function({x:Hp,y:mp,z:Dp},Op,zp,Zp,xp){const pd=1/(1<<Dp);let Od=Hp*pd,md=Od+pd,Zf=mp*pd,Qp=Zf+pd,qd=0;const Xf=(Od+md)/2-Zp;return Xf>.5?qd=-1:Xf<-.5&&(qd=1),Od=((Od+qd)*Op-(Zp*=Op))*zp+Zp,md=((md+qd)*Op-Zp)*zp+Zp,Zf=(Zf*Op-(xp*=Op))*zp+xp,Qp=(Qp*Op-xp)*zp+xp,[[Od,Qp,0],[md,Qp,0],[md,Zf,0],[Od,Zf,0]]}(p,u,c._pixelsPerMercatorPixel,ul,th);for(let Hp=0;Hp<_e.length;Hp++)A0(_e[Hp],sp[Hp],cp);const Sp=Qv([],sp[zh],sp[(zh+1)%4]);$y(Sp,Sp,.5),A0(jh,Sp,cp)}for(const sp of _e)Ow(Cr,Cr,sp),Lw(ir,ir,sp);return Cr[2]=Math.min(Eh[2],Bh[2]),Ow(Cr,Cr,jh),Lw(ir,ir,jh),new by(Cr,ir)}function I0({x:c,y:u,z:p}){const w=1/(1<<p),A=new Rg(zm(c*w),bm((u+1)*w)),N=new Rg(zm((c+1)*w),bm(u*w));return new Jv(A,N)}function d1(c){const u=rh(c.getNorth()),p=rh(c.getSouth()),w=Math.cos(u),A=Math.cos(p),N=Math.sin(u),_e=Math.sin(p),dt=c.getWest(),ir=c.getEast();return[Jx(A,_e,dt),Jx(A,_e,ir),Jx(w,N,ir),Jx(w,N,dt)]}function Jx(c,u,p,w=e0){return p=rh(p),[c*Math.sin(p)*w,-u*w,c*Math.cos(p)*w]}function Qx(c,u,p){return Jx(Math.cos(rh(c)),Math.sin(rh(c)),u,p)}function Nw(c,u,p,w){const A=1<<p.z,N=(c/Hd+p.x)/A;return Qx(bm((u/Hd+p.y)/A),zm(N),w)}function f1({min:c,max:u}){return nE/Math.max(u[0]-c[0],u[1]-c[1],u[2]-c[2])}const iC=new Float64Array(16);function kw(c){const u=f1(c),p=X1(iC,[u,u,u]);return Px(p,p,((w=[])[0]=-(A=c.min)[0],w[1]=-A[1],w[2]=-A[2],w));var w,A}function sb(c){const u=(w=c.min,(p=iC)[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=w[0],p[13]=w[1],p[14]=w[2],p[15]=1,p);var p,w;const A=1/f1(c);return S0(u,u,[A,A,A])}function nC(c,u,p,w,A){const N=function(ir){const Cr=Hd/(2*Math.PI);return ir/(2*Math.PI)/Cr}(p),_e=[c,u,-p/(2*Math.PI)],dt=pv(new Float64Array(16));return Px(dt,dt,_e),S0(dt,dt,[N,N,N]),Mw(dt,dt,rh(-A)),Dw(dt,dt,rh(-w)),dt}function ew(c){return Lp(Xx,rb,c)}function Bw(c,u){const p=Qx(u.lat,u.lng),w=function(ul){const th=Qx(ul._center.lat,ul._center.lng);let fh=J1([],Kx(0,1,0),th);const Ch=Kb([],-ul.angle,th);fh=sm(fh,fh,Ch),Kb(Ch,-ul._pitch,fh);const zh=wy([],th);return $y(zh,zh,mm(ul.cameraToCenterDistance/ul.pixelsPerMeter)),sm(zh,zh,Ch),Qv([],th,zh)}(c);return _e=(A=ax([],w,p))[0],dt=A[1],ir=A[2],Cr=(N=p)[0],Gn=N[1],hs=N[2],ll=(rl=Math.sqrt(_e*_e+dt*dt+ir*ir)*Math.sqrt(Cr*Cr+Gn*Gn+hs*hs))&&R_(A,N)/rl,Math.acos(Math.min(Math.max(ll,-1),1));var A,N,_e,dt,ir,Cr,Gn,hs,rl,ll}function lx(c,u){return Bw(c,u)>Math.PI/2*1.01}const ab=rh(85),lb=Math.cos(ab),ub=Math.sin(ab),zw=63710088e-1,oC=2*Math.PI*zw;class ux{constructor(u,p){if(isNaN(u)||isNaN(p))throw new Error(`Invalid LngLat object: (${u}, ${p})`);if(this.lng=+u,this.lat=+p,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ux(Ip(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(u){const p=Math.PI/180,w=this.lat*p,A=u.lat*p,N=Math.sin(w)*Math.sin(A)+Math.cos(w)*Math.cos(A)*Math.cos((u.lng-this.lng)*p);return zw*Math.acos(Math.min(N,1))}toBounds(u=0){const p=360*u/40075017,w=p/Math.cos(Math.PI/180*this.lat);return new Jv(new ux(this.lng-w,this.lat-p),new ux(this.lng+w,this.lat+p))}toEcef(u){const p=mm(u);return Qx(this.lat,this.lng,e0+p)}static convert(u){if(u instanceof ux)return u;if(Array.isArray(u)&&(u.length===2||u.length===3))return new ux(Number(u[0]),Number(u[1]));if(!Array.isArray(u)&&typeof u=="object"&&u!==null)return new ux(Number("lng"in u?u.lng:u.lon),Number(u.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Rg=ux;function g1(c){return oC*Math.cos(c*Math.PI/180)}function am(c){return(180+c)/360}function M_(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function D_(c,u){return c/g1(u)}function zm(c){return 360*c-180}function bm(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function tw(c,u){return c*g1(bm(u))}const ym=85.051129;function Gw(c){return 1/Math.cos(c*Math.PI/180)}class P0{constructor(u,p,w=0){this.x=+u,this.y=+p,this.z=+w}static fromLngLat(u,p=0){const w=Rg.convert(u);return new P0(am(w.lng),M_(w.lat),D_(p,w.lat))}toLngLat(){return new Rg(zm(this.x),bm(this.y))}toAltitude(){return tw(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/oC*Gw(bm(this.y))}}function cb(c,u,p,w,A,N,_e,dt,ir){const Cr=(u+w)/2,Gn=(p+A)/2,hs=new sl(Cr,Gn);dt(hs),function(rl,ll,ul,th,fh,Ch){const zh=ul-fh,Eh=th-Ch;return Math.abs((th-ll)*zh-(ul-rl)*Eh)/Math.hypot(zh,Eh)}(hs.x,hs.y,N.x,N.y,_e.x,_e.y)>=ir?(cb(c,u,p,Cr,Gn,N,hs,dt,ir),cb(c,Cr,Gn,w,A,hs,_e,dt,ir)):c.push(_e)}function hb(c,u,p){let w=c[0],A=w.x,N=w.y;u(w);const _e=[w];for(let dt=1;dt<c.length;dt++){const ir=c[dt],{x:Cr,y:Gn}=ir;u(ir),cb(_e,A,N,Cr,Gn,w,ir,u,p),A=Cr,N=Gn,w=ir}return _e}function m1(c,u,p,w){if(w(u,p)){const A=u.add(p)._mult(.5);m1(c,u,A,w),m1(c,A,p,w)}else c.push(p)}function oE(c,u){let p=c[0];const w=[p];for(let A=1;A<c.length;A++){const N=c[A];m1(w,p,N,u),p=N}return w}const y1=Math.pow(2,14)-1,pb=-y1-1;function db(c,u){const p=Math.round(c.x*u),w=Math.round(c.y*u);return c.x=Jh(p,pb,y1),c.y=Jh(w,pb,y1),(p<c.x||p>c.x+1||w<c.y||w>c.y+1)&&Ap("Geometry exceeds allowed extent, reduce your vector tile buffer size"),c}function fv(c,u,p){const w=c.loadGeometry(),A=c.extent,N=Hd/A;if(u&&p&&p.projection.isReprojectedInTileSpace){const _e=1<<u.z,{scale:dt,x:ir,y:Cr,projection:Gn}=p,hs=rl=>{const ll=zm((u.x+rl.x/A)/_e),ul=bm((u.y+rl.y/A)/_e),th=Gn.project(ll,ul);rl.x=(th.x*dt-ir)*A,rl.y=(th.y*dt-Cr)*A};for(let rl=0;rl<w.length;rl++)if(c.type!==1)w[rl]=hb(w[rl],hs,1);else{const ll=[];for(const ul of w[rl])ul.x<0||ul.x>=A||ul.y<0||ul.y>=A||(hs(ul),ll.push(ul));w[rl]=ll}}for(const _e of w)for(const dt of _e)db(dt,N);return w}function Ox(c,u){return{type:c.type,id:c.id,properties:c.properties,geometry:u?fv(c):[]}}function _1(c,u,p,w,A){c.emplaceBack(2*u+(w+1)/2,2*p+(A+1)/2)}function Vw(c,u,p){c.emplaceBack(u.x,u.y,u.z,p[0]*16384,p[1]*16384,p[2]*16384)}class Lx{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(p=>p.id),this.index=u.index,this.hasPattern=!1,this.projection=u.projection,this.layoutVertexArray=new Bp,this.indexArray=new Bd,this.segments=new Kg,this.programConfigurations=new T_(u.layers,u.zoom),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id)}populate(u,p,w,A){const N=this.layers[0],_e=[];let dt=null;N.type==="circle"&&(dt=N.layout.get("circle-sort-key"));for(const{feature:Cr,id:Gn,index:hs,sourceLayerIndex:rl}of u){const ll=this.layers[0]._featureFilter.needGeometry,ul=Ox(Cr,ll);if(!this.layers[0]._featureFilter.filter(new Vn(this.zoom),ul,w))continue;const th=dt?dt.evaluate(ul,{},w):void 0,fh={id:Gn,properties:Cr.properties,type:Cr.type,sourceLayerIndex:rl,index:hs,geometry:ll?ul.geometry:fv(Cr,w,A),patterns:{},sortKey:th};_e.push(fh)}dt&&_e.sort((Cr,Gn)=>Cr.sortKey-Gn.sortKey);let ir=null;A.projection.name==="globe"&&(this.globeExtVertexArray=new Fp,ir=A.projection);for(const Cr of _e){const{geometry:Gn,index:hs,sourceLayerIndex:rl}=Cr,ll=u[hs].feature;this.addFeature(Cr,Gn,hs,p.availableImages,w,ir),p.featureIndex.insert(ll,Gn,hs,rl,this.index)}}update(u,p,w,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,p,this.stateDependentLayers,w,A)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,Wb.members),this.indexBuffer=u.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=u.createVertexBuffer(this.globeExtVertexArray,qb.members))),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(u,p,w,A,N,_e){for(const dt of p)for(const ir of dt){const Cr=ir.x,Gn=ir.y;if(Cr<0||Cr>=Hd||Gn<0||Gn>=Hd)continue;if(_e){const ll=_e.projectTilePoint(Cr,Gn,N),ul=_e.upVector(N,Cr,Gn),th=this.globeExtVertexArray;Vw(th,ll,ul),Vw(th,ll,ul),Vw(th,ll,ul),Vw(th,ll,ul)}const hs=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,u.sortKey),rl=hs.vertexLength;_1(this.layoutVertexArray,Cr,Gn,-1,-1),_1(this.layoutVertexArray,Cr,Gn,1,-1),_1(this.layoutVertexArray,Cr,Gn,1,1),_1(this.layoutVertexArray,Cr,Gn,-1,1),this.indexArray.emplaceBack(rl,rl+1,rl+2),this.indexArray.emplaceBack(rl,rl+2,rl+3),hs.vertexLength+=4,hs.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,w,{},A,N)}}function gv(c,u){for(let p=0;p<c.length;p++)if(M0(u,c[p]))return!0;for(let p=0;p<u.length;p++)if(M0(c,u[p]))return!0;return!!mb(c,u)}function cx(c,u,p){return!!M0(c,u)||!!rw(u,c,p)}function fb(c,u){if(c.length===1)return sC(u,c[0]);for(let p=0;p<u.length;p++){const w=u[p];for(let A=0;A<w.length;A++)if(M0(c,w[A]))return!0}for(let p=0;p<c.length;p++)if(sC(u,c[p]))return!0;for(let p=0;p<u.length;p++)if(mb(c,u[p]))return!0;return!1}function gb(c,u,p){if(c.length>1){if(mb(c,u))return!0;for(let w=0;w<u.length;w++)if(rw(u[w],c,p))return!0}for(let w=0;w<c.length;w++)if(rw(c[w],u,p))return!0;return!1}function mb(c,u){if(c.length===0||u.length===0)return!1;for(let p=0;p<c.length-1;p++){const w=c[p],A=c[p+1];for(let N=0;N<u.length-1;N++)if(sE(w,A,u[N],u[N+1]))return!0}return!1}function sE(c,u,p,w){return kd(c,p,w)!==kd(u,p,w)&&kd(c,u,p)!==kd(c,u,w)}function rw(c,u,p){const w=p*p;if(u.length===1)return c.distSqr(u[0])<w;for(let A=1;A<u.length;A++)if(v1(c,u[A-1],u[A])<w)return!0;return!1}function v1(c,u,p){const w=u.distSqr(p);if(w===0)return c.distSqr(u);const A=((c.x-u.x)*(p.x-u.x)+(c.y-u.y)*(p.y-u.y))/w;return c.distSqr(A<0?u:A>1?p:p.sub(u)._mult(A)._add(u))}function sC(c,u){let p,w,A,N=!1;for(let _e=0;_e<c.length;_e++){p=c[_e];for(let dt=0,ir=p.length-1;dt<p.length;ir=dt++)w=p[dt],A=p[ir],w.y>u.y!=A.y>u.y&&u.x<(A.x-w.x)*(u.y-w.y)/(A.y-w.y)+w.x&&(N=!N)}return N}function M0(c,u){let p=!1;for(let w=0,A=c.length-1;w<c.length;A=w++){const N=c[w],_e=c[A];N.y>u.y!=_e.y>u.y&&u.x<(_e.x-N.x)*(u.y-N.y)/(_e.y-N.y)+N.x&&(p=!p)}return p}function x1(c,u,p,w,A){for(const _e of c)if(u<=_e.x&&p<=_e.y&&w>=_e.x&&A>=_e.y)return!0;const N=[new sl(u,p),new sl(u,A),new sl(w,A),new sl(w,p)];if(c.length>2){for(const _e of N)if(M0(c,_e))return!0}for(let _e=0;_e<c.length-1;_e++)if(iw(c[_e],c[_e+1],N))return!0;return!1}function iw(c,u,p){const w=p[0],A=p[2];if(c.x<w.x&&u.x<w.x||c.x>A.x&&u.x>A.x||c.y<w.y&&u.y<w.y||c.y>A.y&&u.y>A.y)return!1;const N=kd(c,u,p[0]);return N!==kd(c,u,p[1])||N!==kd(c,u,p[2])||N!==kd(c,u,p[3])}function Fx(c,u,p){const w=u.paint.get(c).value;return w.kind==="constant"?w.value:p.programConfigurations.get(u.id).getMaxValue(c)}function $w(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function w1(c,u,p,w,A){if(!u[0]&&!u[1])return c;const N=sl.convert(u)._mult(A);p==="viewport"&&N._rotate(-w);const _e=[];for(let dt=0;dt<c.length;dt++)_e.push(c[dt].sub(N));return _e}function yb(c,u,p,w){const A=sl.convert(c)._mult(w);return u==="viewport"&&A._rotate(-p),A}vs(Lx,"CircleBucket",{omit:["layers"]});const b1=new Sh({"circle-sort-key":new mh(hp.layout_circle["circle-sort-key"])});var aC={paint:new Sh({"circle-radius":new mh(hp.paint_circle["circle-radius"]),"circle-color":new mh(hp.paint_circle["circle-color"]),"circle-blur":new mh(hp.paint_circle["circle-blur"]),"circle-opacity":new mh(hp.paint_circle["circle-opacity"]),"circle-translate":new yl(hp.paint_circle["circle-translate"]),"circle-translate-anchor":new yl(hp.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new yl(hp.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new yl(hp.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new mh(hp.paint_circle["circle-stroke-width"]),"circle-stroke-color":new mh(hp.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new mh(hp.paint_circle["circle-stroke-opacity"])}),layout:b1};function lC(c,u,p,w,A,N,_e,dt,ir){if(N&&c.queryGeometry.isAboveHorizon)return!1;N&&(ir*=c.pixelToTileUnitsFactor);const Cr=c.tileID.canonical,Gn=p.projection.upVectorScale(Cr,p.center.lat,p.worldSize).metersToTile;for(const hs of u)for(const rl of hs){const ll=rl.add(dt),ul=A&&p.elevation?p.elevation.exaggeration()*A.getElevationAt(ll.x,ll.y,!0):0,th=p.projection.projectTilePoint(ll.x,ll.y,Cr);if(ul>0){const Eh=p.projection.upVector(Cr,ll.x,ll.y);th.x+=Eh[0]*Gn*ul,th.y+=Eh[1]*Gn*ul,th.z+=Eh[2]*Gn*ul}const fh=N?ll:uC(th.x,th.y,th.z,w),Ch=N?c.tilespaceRays.map(Eh=>lE(Eh,ul)):c.queryGeometry.screenGeometry,zh=dv([],[th.x,th.y,th.z,1],w);if(!_e&&N?ir*=zh[3]/p.cameraToCenterDistance:_e&&!N&&(ir*=p.cameraToCenterDistance/zh[3]),N){const Eh=bm((rl.y/Hd+Cr.y)/(1<<Cr.z));ir/=p.projection.pixelsPerMeter(Eh,1)/D_(1,Eh)}if(cx(Ch,fh,ir))return!0}return!1}function uC(c,u,p,w){const A=dv([],[c,u,p,1],w);return new sl(A[0]/A[3],A[1]/A[3])}const cC=Kx(0,0,0),aE=Kx(0,0,1);function lE(c,u){const p=Y1();return cC[2]=u,c.intersectsPlane(cC,aE,p),new sl(p[0],p[1])}class hC extends Lx{}function C1(c,{width:u,height:p},w,A){if(A){if(A instanceof Uint8ClampedArray)A=new Uint8Array(A.buffer);else if(A.length!==u*p*w)throw new RangeError("mismatched image size")}else A=new Uint8Array(u*p*w);return c.width=u,c.height=p,c.data=A,c}function D0(c,u,p){const{width:w,height:A}=u;w===c.width&&A===c.height||(E1(c,u,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,w),height:Math.min(c.height,A)},p),c.width=w,c.height=A,c.data=u.data)}function E1(c,u,p,w,A,N){if(A.width===0||A.height===0)return u;if(A.width>c.width||A.height>c.height||p.x>c.width-A.width||p.y>c.height-A.height)throw new RangeError("out of range source coordinates for image copy");if(A.width>u.width||A.height>u.height||w.x>u.width-A.width||w.y>u.height-A.height)throw new RangeError("out of range destination coordinates for image copy");const _e=c.data,dt=u.data;for(let ir=0;ir<A.height;ir++){const Cr=((p.y+ir)*c.width+p.x)*N,Gn=((w.y+ir)*u.width+w.x)*N;for(let hs=0;hs<A.width*N;hs++)dt[Gn+hs]=_e[Cr+hs]}return u}vs(hC,"HeatmapBucket",{omit:["layers"]});class t0{constructor(u,p){C1(this,u,1,p)}resize(u){D0(this,new t0(u),1)}clone(){return new t0({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(u,p,w,A,N){E1(u,p,w,A,N,1)}}class My{constructor(u,p){C1(this,u,4,p)}resize(u){D0(this,new My(u),4)}replace(u,p){p?this.data.set(u):this.data=u instanceof Uint8ClampedArray?new Uint8Array(u.buffer):u}clone(){return new My({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(u,p,w,A,N){E1(u,p,w,A,N,4)}}vs(t0,"AlphaImage"),vs(My,"RGBAImage");var pC={paint:new Sh({"heatmap-radius":new mh(hp.paint_heatmap["heatmap-radius"]),"heatmap-weight":new mh(hp.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new yl(hp.paint_heatmap["heatmap-intensity"]),"heatmap-color":new bh(hp.paint_heatmap["heatmap-color"]),"heatmap-opacity":new yl(hp.paint_heatmap["heatmap-opacity"])})};function S1(c){const u={},p=c.resolution||256,w=c.clips?c.clips.length:1,A=c.image||new My({width:p,height:w}),N=(_e,dt,ir)=>{u[c.evaluationKey]=ir;const Cr=c.expression.evaluate(u);A.data[_e+dt+0]=Math.floor(255*Cr.r/Cr.a),A.data[_e+dt+1]=Math.floor(255*Cr.g/Cr.a),A.data[_e+dt+2]=Math.floor(255*Cr.b/Cr.a),A.data[_e+dt+3]=Math.floor(255*Cr.a)};if(c.clips)for(let _e=0,dt=0;_e<w;++_e,dt+=4*p)for(let ir=0,Cr=0;ir<p;ir++,Cr+=4){const Gn=ir/(p-1),{start:hs,end:rl}=c.clips[_e];N(dt,Cr,hs*(1-Gn)+rl*Gn)}else for(let _e=0,dt=0;_e<p;_e++,dt+=4)N(0,dt,_e/(p-1));return A}var _b={paint:new Sh({"hillshade-illumination-direction":new yl(hp.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new yl(hp.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new yl(hp.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new yl(hp.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new yl(hp.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new yl(hp.paint_hillshade["hillshade-accent-color"])})};const T1=Zh([{name:"a_pos",components:2,type:"Int16"}],4),{members:dC}=T1;var Uw={exports:{}};function jw(c,u,p){p=p||2;var w,A,N,_e,dt,ir,Cr,Gn=u&&u.length,hs=Gn?u[0]*p:c.length,rl=Uy(c,0,hs,p,!0),ll=[];if(!rl||rl.next===rl.prev)return ll;if(Gn&&(rl=function(th,fh,Ch,zh){var Eh,Bh,Hh,jh=[];for(Eh=0,Bh=fh.length;Eh<Bh;Eh++)(Hh=Uy(th,fh[Eh]*zh,Eh<Bh-1?fh[Eh+1]*zh:th.length,zh,!1))===Hh.next&&(Hh.steiner=!0),jh.push(xC(Hh));for(jh.sort(_C),Eh=0;Eh<jh.length;Eh++)Ch=uE(jh[Eh],Ch);return Ch}(c,u,rl,p)),c.length>80*p){w=N=c[0],A=_e=c[1];for(var ul=p;ul<hs;ul+=p)(dt=c[ul])<w&&(w=dt),(ir=c[ul+1])<A&&(A=ir),dt>N&&(N=dt),ir>_e&&(_e=ir);Cr=(Cr=Math.max(N-w,_e-A))!==0?32767/Cr:0}return nw(rl,ll,p,w,A,Cr,0),ll}function Uy(c,u,p,w,A){var N,_e;if(A===aw(c,u,p,w)>0)for(N=u;N<p;N+=w)_e=vb(N,c[N],c[N+1],_e);else for(N=p-w;N>=u;N-=w)_e=vb(N,c[N],c[N+1],_e);return _e&&A1(_e,_e.next)&&(hx(_e),_e=_e.next),_e}function mv(c,u){if(!c)return c;u||(u=c);var p,w=c;do if(p=!1,w.steiner||!A1(w,w.next)&&lm(w.prev,w,w.next)!==0)w=w.next;else{if(hx(w),(w=u=w.prev)===w.next)break;p=!0}while(p||w!==u);return u}function nw(c,u,p,w,A,N,_e){if(c){!_e&&N&&function(Gn,hs,rl,ll){var ul=Gn;do ul.z===0&&(ul.z=r0(ul.x,ul.y,hs,rl,ll)),ul.prevZ=ul.prev,ul.nextZ=ul.next,ul=ul.next;while(ul!==Gn);ul.prevZ.nextZ=null,ul.prevZ=null,function(th){var fh,Ch,zh,Eh,Bh,Hh,jh,cp,sp=1;do{for(Ch=th,th=null,Bh=null,Hh=0;Ch;){for(Hh++,zh=Ch,jh=0,fh=0;fh<sp&&(jh++,zh=zh.nextZ);fh++);for(cp=sp;jh>0||cp>0&&zh;)jh!==0&&(cp===0||!zh||Ch.z<=zh.z)?(Eh=Ch,Ch=Ch.nextZ,jh--):(Eh=zh,zh=zh.nextZ,cp--),Bh?Bh.nextZ=Eh:th=Eh,Eh.prevZ=Bh,Bh=Eh;Ch=zh}Bh.nextZ=null,sp*=2}while(Hh>1)}(ul)}(c,w,A,N);for(var dt,ir,Cr=c;c.prev!==c.next;)if(dt=c.prev,ir=c.next,N?gC(c,w,A,N):fC(c))u.push(dt.i/p|0),u.push(c.i/p|0),u.push(ir.i/p|0),hx(c),c=ir.next,Cr=ir.next;else if((c=ir)===Cr){_e?_e===1?nw(c=mC(mv(c),u,p),u,p,w,A,N,2):_e===2&&yC(c,u,p,w,A,N):nw(mv(c),u,p,w,A,N,1);break}}}function fC(c){var u=c.prev,p=c,w=c.next;if(lm(u,p,w)>=0)return!1;for(var A=u.x,N=p.x,_e=w.x,dt=u.y,ir=p.y,Cr=w.y,Gn=A<N?A<_e?A:_e:N<_e?N:_e,hs=dt<ir?dt<Cr?dt:Cr:ir<Cr?ir:Cr,rl=A>N?A>_e?A:_e:N>_e?N:_e,ll=dt>ir?dt>Cr?dt:Cr:ir>Cr?ir:Cr,ul=w.next;ul!==u;){if(ul.x>=Gn&&ul.x<=rl&&ul.y>=hs&&ul.y<=ll&&Nx(A,dt,N,ir,_e,Cr,ul.x,ul.y)&&lm(ul.prev,ul,ul.next)>=0)return!1;ul=ul.next}return!0}function gC(c,u,p,w){var A=c.prev,N=c,_e=c.next;if(lm(A,N,_e)>=0)return!1;for(var dt=A.x,ir=N.x,Cr=_e.x,Gn=A.y,hs=N.y,rl=_e.y,ll=dt<ir?dt<Cr?dt:Cr:ir<Cr?ir:Cr,ul=Gn<hs?Gn<rl?Gn:rl:hs<rl?hs:rl,th=dt>ir?dt>Cr?dt:Cr:ir>Cr?ir:Cr,fh=Gn>hs?Gn>rl?Gn:rl:hs>rl?hs:rl,Ch=r0(ll,ul,u,p,w),zh=r0(th,fh,u,p,w),Eh=c.prevZ,Bh=c.nextZ;Eh&&Eh.z>=Ch&&Bh&&Bh.z<=zh;){if(Eh.x>=ll&&Eh.x<=th&&Eh.y>=ul&&Eh.y<=fh&&Eh!==A&&Eh!==_e&&Nx(dt,Gn,ir,hs,Cr,rl,Eh.x,Eh.y)&&lm(Eh.prev,Eh,Eh.next)>=0||(Eh=Eh.prevZ,Bh.x>=ll&&Bh.x<=th&&Bh.y>=ul&&Bh.y<=fh&&Bh!==A&&Bh!==_e&&Nx(dt,Gn,ir,hs,Cr,rl,Bh.x,Bh.y)&&lm(Bh.prev,Bh,Bh.next)>=0))return!1;Bh=Bh.nextZ}for(;Eh&&Eh.z>=Ch;){if(Eh.x>=ll&&Eh.x<=th&&Eh.y>=ul&&Eh.y<=fh&&Eh!==A&&Eh!==_e&&Nx(dt,Gn,ir,hs,Cr,rl,Eh.x,Eh.y)&&lm(Eh.prev,Eh,Eh.next)>=0)return!1;Eh=Eh.prevZ}for(;Bh&&Bh.z<=zh;){if(Bh.x>=ll&&Bh.x<=th&&Bh.y>=ul&&Bh.y<=fh&&Bh!==A&&Bh!==_e&&Nx(dt,Gn,ir,hs,Cr,rl,Bh.x,Bh.y)&&lm(Bh.prev,Bh,Bh.next)>=0)return!1;Bh=Bh.nextZ}return!0}function mC(c,u,p){var w=c;do{var A=w.prev,N=w.next.next;!A1(A,N)&&bC(A,w,w.next,N)&&ow(A,N)&&ow(N,A)&&(u.push(A.i/p|0),u.push(w.i/p|0),u.push(N.i/p|0),hx(w),hx(w.next),w=c=N),w=w.next}while(w!==c);return mv(w)}function yC(c,u,p,w,A,N){var _e=c;do{for(var dt=_e.next.next;dt!==_e.prev;){if(_e.i!==dt.i&&wC(_e,dt)){var ir=Ww(_e,dt);return _e=mv(_e,_e.next),ir=mv(ir,ir.next),nw(_e,u,p,w,A,N,0),void nw(ir,u,p,w,A,N,0)}dt=dt.next}_e=_e.next}while(_e!==c)}function _C(c,u){return c.x-u.x}function uE(c,u){var p=function(A,N){var _e,dt=N,ir=A.x,Cr=A.y,Gn=-1/0;do{if(Cr<=dt.y&&Cr>=dt.next.y&&dt.next.y!==dt.y){var hs=dt.x+(Cr-dt.y)*(dt.next.x-dt.x)/(dt.next.y-dt.y);if(hs<=ir&&hs>Gn&&(Gn=hs,_e=dt.x<dt.next.x?dt:dt.next,hs===ir))return _e}dt=dt.next}while(dt!==N);if(!_e)return null;var rl,ll=_e,ul=_e.x,th=_e.y,fh=1/0;dt=_e;do ir>=dt.x&&dt.x>=ul&&ir!==dt.x&&Nx(Cr<th?ir:Gn,Cr,ul,th,Cr<th?Gn:ir,Cr,dt.x,dt.y)&&(rl=Math.abs(Cr-dt.y)/(ir-dt.x),ow(dt,A)&&(rl<fh||rl===fh&&(dt.x>_e.x||dt.x===_e.x&&vC(_e,dt)))&&(_e=dt,fh=rl)),dt=dt.next;while(dt!==ll);return _e}(c,u);if(!p)return u;var w=Ww(p,c);return mv(w,w.next),mv(p,p.next)}function vC(c,u){return lm(c.prev,c,u.prev)<0&&lm(u.next,c,c.next)<0}function r0(c,u,p,w,A){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-p)*A|0)|c<<8))|c<<4))|c<<2))|c<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-w)*A|0)|u<<8))|u<<4))|u<<2))|u<<1))<<1}function xC(c){var u=c,p=c;do(u.x<p.x||u.x===p.x&&u.y<p.y)&&(p=u),u=u.next;while(u!==c);return p}function Nx(c,u,p,w,A,N,_e,dt){return(A-_e)*(u-dt)>=(c-_e)*(N-dt)&&(c-_e)*(w-dt)>=(p-_e)*(u-dt)&&(p-_e)*(N-dt)>=(A-_e)*(w-dt)}function wC(c,u){return c.next.i!==u.i&&c.prev.i!==u.i&&!function(p,w){var A=p;do{if(A.i!==p.i&&A.next.i!==p.i&&A.i!==w.i&&A.next.i!==w.i&&bC(A,A.next,p,w))return!0;A=A.next}while(A!==p);return!1}(c,u)&&(ow(c,u)&&ow(u,c)&&function(p,w){var A=p,N=!1,_e=(p.x+w.x)/2,dt=(p.y+w.y)/2;do A.y>dt!=A.next.y>dt&&A.next.y!==A.y&&_e<(A.next.x-A.x)*(dt-A.y)/(A.next.y-A.y)+A.x&&(N=!N),A=A.next;while(A!==p);return N}(c,u)&&(lm(c.prev,c,u.prev)||lm(c,u.prev,u))||A1(c,u)&&lm(c.prev,c,c.next)>0&&lm(u.prev,u,u.next)>0)}function lm(c,u,p){return(u.y-c.y)*(p.x-u.x)-(u.x-c.x)*(p.y-u.y)}function A1(c,u){return c.x===u.x&&c.y===u.y}function bC(c,u,p,w){var A=O0(lm(c,u,p)),N=O0(lm(c,u,w)),_e=O0(lm(p,w,c)),dt=O0(lm(p,w,u));return A!==N&&_e!==dt||!(A!==0||!Hw(c,p,u))||!(N!==0||!Hw(c,w,u))||!(_e!==0||!Hw(p,c,w))||!(dt!==0||!Hw(p,u,w))}function Hw(c,u,p){return u.x<=Math.max(c.x,p.x)&&u.x>=Math.min(c.x,p.x)&&u.y<=Math.max(c.y,p.y)&&u.y>=Math.min(c.y,p.y)}function O0(c){return c>0?1:c<0?-1:0}function ow(c,u){return lm(c.prev,c,c.next)<0?lm(c,u,c.next)>=0&&lm(c,c.prev,u)>=0:lm(c,u,c.prev)<0||lm(c,c.next,u)<0}function Ww(c,u){var p=new sw(c.i,c.x,c.y),w=new sw(u.i,u.x,u.y),A=c.next,N=u.prev;return c.next=u,u.prev=c,p.next=A,A.prev=p,w.next=p,p.prev=w,N.next=w,w.prev=N,w}function vb(c,u,p,w){var A=new sw(c,u,p);return w?(A.next=w.next,A.prev=w,w.next.prev=A,w.next=A):(A.prev=A,A.next=A),A}function hx(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function sw(c,u,p){this.i=c,this.x=u,this.y=p,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function aw(c,u,p,w){for(var A=0,N=u,_e=p-w;N<p;N+=w)A+=(c[_e]-c[N])*(c[N+1]+c[_e+1]),_e=N;return A}Uw.exports=jw,Uw.exports.default=jw,jw.deviation=function(c,u,p,w){var A=u&&u.length,N=Math.abs(aw(c,0,A?u[0]*p:c.length,p));if(A)for(var _e=0,dt=u.length;_e<dt;_e++)N-=Math.abs(aw(c,u[_e]*p,_e<dt-1?u[_e+1]*p:c.length,p));var ir=0;for(_e=0;_e<w.length;_e+=3){var Cr=w[_e]*p,Gn=w[_e+1]*p,hs=w[_e+2]*p;ir+=Math.abs((c[Cr]-c[hs])*(c[Gn+1]-c[Cr+1])-(c[Cr]-c[Gn])*(c[hs+1]-c[Cr+1]))}return N===0&&ir===0?0:Math.abs((ir-N)/N)},jw.flatten=function(c){for(var u=c[0][0].length,p={vertices:[],holes:[],dimensions:u},w=0,A=0;A<c.length;A++){for(var N=0;N<c[A].length;N++)for(var _e=0;_e<u;_e++)p.vertices.push(c[A][N][_e]);A>0&&p.holes.push(w+=c[A-1].length)}return p};var xb=vi(Uw.exports);function cE(c,u,p,w,A){CC(c,u,p||0,w||c.length-1,A||lw)}function CC(c,u,p,w,A){for(;w>p;){if(w-p>600){var N=w-p+1,_e=u-p+1,dt=Math.log(N),ir=.5*Math.exp(2*dt/3),Cr=.5*Math.sqrt(dt*ir*(N-ir)/N)*(_e-N/2<0?-1:1);CC(c,u,Math.max(p,Math.floor(u-_e*ir/N+Cr)),Math.min(w,Math.floor(u+(N-_e)*ir/N+Cr)),A)}var Gn=c[u],hs=p,rl=w;for(qw(c,p,u),A(c[w],Gn)>0&&qw(c,p,w);hs<rl;){for(qw(c,hs,rl),hs++,rl--;A(c[hs],Gn)<0;)hs++;for(;A(c[rl],Gn)>0;)rl--}A(c[p],Gn)===0?qw(c,p,rl):qw(c,++rl,w),rl<=u&&(p=rl+1),u<=rl&&(w=rl-1)}}function qw(c,u,p){var w=c[u];c[u]=c[p],c[p]=w}function lw(c,u){return c<u?-1:c>u?1:0}function Kw(c,u){const p=c.length;if(p<=1)return[c];const w=[];let A,N;for(let _e=0;_e<p;_e++){const dt=cd(c[_e]);dt!==0&&(c[_e].area=Math.abs(dt),N===void 0&&(N=dt<0),N===dt<0?(A&&w.push(A),A=[c[_e]]):A.push(c[_e]))}if(A&&w.push(A),u>1)for(let _e=0;_e<w.length;_e++)w[_e].length<=u||(cE(w[_e],u,1,w[_e].length-1,EC),w[_e]=w[_e].slice(0,u));return w}function EC(c,u){return u.area-c.area}function Zw(c,u,p){const w=p.patternDependencies;let A=!1;for(const N of u){const _e=N.paint.get(`${c}-pattern`);_e.isConstant()||(A=!0);const dt=_e.constantOr(null);dt&&(A=!0,w[dt]=!0)}return A}function wb(c,u,p,w,A){const N=A.patternDependencies;for(const _e of u){const dt=_e.paint.get(`${c}-pattern`).value;if(dt.kind!=="constant"){let ir=dt.evaluate({zoom:w},p,{},A.availableImages);ir=ir&&ir.name?ir.name:ir,N[ir]=!0,p.patterns[_e.id]=ir}}return p}class Xw{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(p=>p.id),this.index=u.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Bp,this.indexArray=new Bd,this.indexArray2=new om,this.programConfigurations=new T_(u.layers,u.zoom),this.segments=new Kg,this.segments2=new Kg,this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.projection=u.projection}populate(u,p,w,A){this.hasPattern=Zw("fill",this.layers,p);const N=this.layers[0].layout.get("fill-sort-key"),_e=[];for(const{feature:dt,id:ir,index:Cr,sourceLayerIndex:Gn}of u){const hs=this.layers[0]._featureFilter.needGeometry,rl=Ox(dt,hs);if(!this.layers[0]._featureFilter.filter(new Vn(this.zoom),rl,w))continue;const ll=N?N.evaluate(rl,{},w,p.availableImages):void 0,ul={id:ir,properties:dt.properties,type:dt.type,sourceLayerIndex:Gn,index:Cr,geometry:hs?rl.geometry:fv(dt,w,A),patterns:{},sortKey:ll};_e.push(ul)}N&&_e.sort((dt,ir)=>dt.sortKey-ir.sortKey);for(const dt of _e){const{geometry:ir,index:Cr,sourceLayerIndex:Gn}=dt;if(this.hasPattern){const hs=wb("fill",this.layers,dt,this.zoom,p);this.patternFeatures.push(hs)}else this.addFeature(dt,ir,Cr,w,{},p.availableImages);p.featureIndex.insert(u[Cr].feature,ir,Cr,Gn,this.index)}}update(u,p,w,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,p,this.stateDependentLayers,w,A)}addFeatures(u,p,w,A,N){for(const _e of this.patternFeatures)this.addFeature(_e,_e.geometry,_e.index,p,w,A)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,dC),this.indexBuffer=u.createIndexBuffer(this.indexArray),this.indexBuffer2=u.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(u,p,w,A,N,_e=[]){for(const dt of Kw(p,500)){let ir=0;for(const ul of dt)ir+=ul.length;const Cr=this.segments.prepareSegment(ir,this.layoutVertexArray,this.indexArray),Gn=Cr.vertexLength,hs=[],rl=[];for(const ul of dt){if(ul.length===0)continue;ul!==dt[0]&&rl.push(hs.length/2);const th=this.segments2.prepareSegment(ul.length,this.layoutVertexArray,this.indexArray2),fh=th.vertexLength;this.layoutVertexArray.emplaceBack(ul[0].x,ul[0].y),this.indexArray2.emplaceBack(fh+ul.length-1,fh),hs.push(ul[0].x),hs.push(ul[0].y);for(let Ch=1;Ch<ul.length;Ch++)this.layoutVertexArray.emplaceBack(ul[Ch].x,ul[Ch].y),this.indexArray2.emplaceBack(fh+Ch-1,fh+Ch),hs.push(ul[Ch].x),hs.push(ul[Ch].y);th.vertexLength+=ul.length,th.primitiveLength+=ul.length}const ll=xb(hs,rl);for(let ul=0;ul<ll.length;ul+=3)this.indexArray.emplaceBack(Gn+ll[ul],Gn+ll[ul+1],Gn+ll[ul+2]);Cr.vertexLength+=ir,Cr.primitiveLength+=ll.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,w,N,_e,A)}}vs(Xw,"FillBucket",{omit:["layers","patternFeatures"]});const SC=new Sh({"fill-sort-key":new mh(hp.layout_fill["fill-sort-key"])});var hE={paint:new Sh({"fill-antialias":new yl(hp.paint_fill["fill-antialias"]),"fill-opacity":new mh(hp.paint_fill["fill-opacity"]),"fill-color":new mh(hp.paint_fill["fill-color"]),"fill-outline-color":new mh(hp.paint_fill["fill-outline-color"]),"fill-translate":new yl(hp.paint_fill["fill-translate"]),"fill-translate-anchor":new yl(hp.paint_fill["fill-translate-anchor"]),"fill-pattern":new mh(hp.paint_fill["fill-pattern"])}),layout:SC};const TC=Zh([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),bb=Zh([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Cb=Zh([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:AC}=TC;var px={},Eb=ml,Sb=dx;function dx(c,u,p,w,A){this.properties={},this.extent=p,this.type=0,this._pbf=c,this._geometry=-1,this._keys=w,this._values=A,c.readFields(R1,this,u)}function R1(c,u,p){c==1?u.id=p.readVarint():c==2?function(w,A){for(var N=w.readVarint()+w.pos;w.pos<N;){var _e=A._keys[w.readVarint()],dt=A._values[w.readVarint()];A.properties[_e]=dt}}(p,u):c==3?u.type=p.readVarint():c==4&&(u._geometry=p.pos)}function Yw(c){for(var u,p,w=0,A=0,N=c.length,_e=N-1;A<N;_e=A++)w+=((p=c[_e]).x-(u=c[A]).x)*(u.y+p.y);return w}dx.types=["Unknown","Point","LineString","Polygon"],dx.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var u,p=c.readVarint()+c.pos,w=1,A=0,N=0,_e=0,dt=[];c.pos<p;){if(A<=0){var ir=c.readVarint();w=7&ir,A=ir>>3}if(A--,w===1||w===2)N+=c.readSVarint(),_e+=c.readSVarint(),w===1&&(u&&dt.push(u),u=[]),u.push(new Eb(N,_e));else{if(w!==7)throw new Error("unknown command "+w);u&&u.push(u[0].clone())}}return u&&dt.push(u),dt},dx.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var u=c.readVarint()+c.pos,p=1,w=0,A=0,N=0,_e=1/0,dt=-1/0,ir=1/0,Cr=-1/0;c.pos<u;){if(w<=0){var Gn=c.readVarint();p=7&Gn,w=Gn>>3}if(w--,p===1||p===2)(A+=c.readSVarint())<_e&&(_e=A),A>dt&&(dt=A),(N+=c.readSVarint())<ir&&(ir=N),N>Cr&&(Cr=N);else if(p!==7)throw new Error("unknown command "+p)}return[_e,ir,dt,Cr]},dx.prototype.toGeoJSON=function(c,u,p){var w,A,N=this.extent*Math.pow(2,p),_e=this.extent*c,dt=this.extent*u,ir=this.loadGeometry(),Cr=dx.types[this.type];function Gn(ll){for(var ul=0;ul<ll.length;ul++){var th=ll[ul];ll[ul]=[360*(th.x+_e)/N-180,360/Math.PI*Math.atan(Math.exp((180-360*(th.y+dt)/N)*Math.PI/180))-90]}}switch(this.type){case 1:var hs=[];for(w=0;w<ir.length;w++)hs[w]=ir[w][0];Gn(ir=hs);break;case 2:for(w=0;w<ir.length;w++)Gn(ir[w]);break;case 3:for(ir=function(ll){var ul=ll.length;if(ul<=1)return[ll];for(var th,fh,Ch=[],zh=0;zh<ul;zh++){var Eh=Yw(ll[zh]);Eh!==0&&(fh===void 0&&(fh=Eh<0),fh===Eh<0?(th&&Ch.push(th),th=[ll[zh]]):th.push(ll[zh]))}return th&&Ch.push(th),Ch}(ir),w=0;w<ir.length;w++)for(A=0;A<ir[w].length;A++)Gn(ir[w][A])}ir.length===1?ir=ir[0]:Cr="Multi"+Cr;var rl={type:"Feature",geometry:{type:Cr,coordinates:ir},properties:this.properties};return"id"in this&&(rl.id=this.id),rl};var Tb=Sb,I1=P1;function P1(c,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(pE,this,u),this.length=this._features.length}function pE(c,u,p){c===15?u.version=p.readVarint():c===1?u.name=p.readString():c===5?u.extent=p.readVarint():c===2?u._features.push(p.pos):c===3?u._keys.push(p.readString()):c===4&&u._values.push(function(w){for(var A=null,N=w.readVarint()+w.pos;w.pos<N;){var _e=w.readVarint()>>3;A=_e===1?w.readString():_e===2?w.readFloat():_e===3?w.readDouble():_e===4?w.readVarint64():_e===5?w.readVarint():_e===6?w.readSVarint():_e===7?w.readBoolean():null}return A}(p))}P1.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var u=this._pbf.readVarint()+this._pbf.pos;return new Tb(this._pbf,u,this.extent,this._keys,this._values)};var x=I1;function g(c,u,p){if(c===3){var w=new x(p,p.readVarint()+p.pos);w.length&&(u[w.name]=w)}}var S=px.VectorTile=function(c,u){this.layers=c.readFields(g,{},u)},W=px.VectorTileFeature=Sb;function ut(c,u,p,w){const A=[],N=w===0?(_e,dt,ir,Cr,Gn,hs)=>{_e.push(new sl(hs,ir+(hs-dt)/(Cr-dt)*(Gn-ir)))}:(_e,dt,ir,Cr,Gn,hs)=>{_e.push(new sl(dt+(hs-ir)/(Gn-ir)*(Cr-dt),hs))};for(const _e of c){const dt=[];for(const ir of _e){if(ir.length<=2)continue;const Cr=[];for(let rl=0;rl<ir.length-1;rl++){const ll=ir[rl].x,ul=ir[rl].y,th=ir[rl+1].x,fh=ir[rl+1].y,Ch=w===0?ll:ul,zh=w===0?th:fh;Ch<u?zh>u&&N(Cr,ll,ul,th,fh,u):Ch>p?zh<p&&N(Cr,ll,ul,th,fh,p):Cr.push(ir[rl]),zh<u&&Ch>=u&&N(Cr,ll,ul,th,fh,u),zh>p&&Ch<=p&&N(Cr,ll,ul,th,fh,p)}let Gn=ir[ir.length-1];const hs=w===0?Gn.x:Gn.y;hs>=u&&hs<=p&&Cr.push(Gn),Cr.length&&(Gn=Cr[Cr.length-1],Cr[0].x===Gn.x&&Cr[0].y===Gn.y||Cr.push(Cr[0]),dt.push(Cr))}dt.length&&A.push(dt)}return A}px.VectorTileLayer=I1;const Ht=W.types,Jt=Math.pow(2,13);function In(c,u,p,w,A,N,_e,dt){c.emplaceBack((u<<1)+_e,(p<<1)+N,(Math.floor(w*Jt)<<1)+A,Math.round(dt))}function So(c,u,p){c.emplaceBack(u.x,u.y,u.z,p[0]*16384,p[1]*16384,p[2]*16384)}class al{constructor(){this.acc=new sl(0,0),this.polyCount=[]}startRing(u){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new sl(u.x,u.y),this.max=new sl(u.x,u.y))}append(u,p){this.currentPolyCount.edges++,this.acc._add(u);const w=this.min,A=this.max;u.x<w.x?w.x=u.x:u.x>A.x&&(A.x=u.x),u.y<w.y?w.y=u.y:u.y>A.y&&(A.y=u.y),((u.x===0||u.x===Hd)&&u.x===p.x)!=((u.y===0||u.y===Hd)&&u.y===p.y)&&this.processBorderOverlap(u,p),p.x<0!=u.x<0&&this.addBorderIntersection(0,jd(p.y,u.y,(0-p.x)/(u.x-p.x))),p.x>Hd!=u.x>Hd&&this.addBorderIntersection(1,jd(p.y,u.y,(Hd-p.x)/(u.x-p.x))),p.y<0!=u.y<0&&this.addBorderIntersection(2,jd(p.x,u.x,(0-p.y)/(u.y-p.y))),p.y>Hd!=u.y>Hd&&this.addBorderIntersection(3,jd(p.x,u.x,(Hd-p.y)/(u.y-p.y)))}addBorderIntersection(u,p){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const w=this.borders[u];p<w[0]&&(w[0]=p),p>w[1]&&(w[1]=p)}processBorderOverlap(u,p){if(u.x===p.x){if(u.y===p.y)return;const w=u.x===0?0:1;this.addBorderIntersection(w,p.y),this.addBorderIntersection(w,u.y)}else{const w=u.y===0?2:3;this.addBorderIntersection(w,p.x),this.addBorderIntersection(w,u.x)}}centroid(){const u=this.polyCount.reduce((p,w)=>p+w.edges,0);return u!==0?this.acc.div(u)._round():new sl(0,0)}span(){return new sl(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((u,p)=>u+ +(p[0]!==Number.MAX_VALUE),0)}}class hl{constructor(u){this.zoom=u.zoom,this.canonical=u.canonical,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(p=>p.id),this.index=u.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=u.projection,this.layoutVertexArray=new Tp,this.centroidVertexArray=new S_,this.indexArray=new Bd,this.programConfigurations=new T_(u.layers,u.zoom),this.segments=new Kg,this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.enableTerrain=u.enableTerrain}populate(u,p,w,A){this.features=[],this.hasPattern=Zw("fill-extrusion",this.layers,p),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(N){const _e=Math.exp(Math.PI*(1-N.y/(1<<N.z)*2));return 80150034*_e/(_e*_e+1)/Hd/(1<<N.z)}(w),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:N,id:_e,index:dt,sourceLayerIndex:ir}of u){const Cr=this.layers[0]._featureFilter.needGeometry,Gn=Ox(N,Cr);if(!this.layers[0]._featureFilter.filter(new Vn(this.zoom),Gn,w))continue;const hs={id:_e,sourceLayerIndex:ir,index:dt,geometry:Cr?Gn.geometry:fv(N,w,A),properties:N.properties,type:N.type,patterns:{}},rl=this.layoutVertexArray.length;this.hasPattern?this.features.push(wb("fill-extrusion",this.layers,hs,this.zoom,p)):this.addFeature(hs,hs.geometry,dt,w,{},p.availableImages,A),p.featureIndex.insert(N,hs.geometry,dt,ir,this.index,rl)}this.sortBorders()}addFeatures(u,p,w,A,N){for(const _e of this.features){const{geometry:dt}=_e;this.addFeature(_e,dt,_e.index,p,w,A,N)}this.sortBorders()}update(u,p,w,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,p,this.stateDependentLayers,w,A)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,AC),this.indexBuffer=u.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=u.createVertexBuffer(this.layoutVertexExtArray,Cb.members,!0))),this.programConfigurations.upload(u),this.uploaded=!0}uploadCentroid(u){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=u.createVertexBuffer(this.centroidVertexArray,bb.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(u,p,w,A,N,_e,dt){const ir=[new sl(0,0),new sl(Hd,Hd)],Cr=dt.projection,Gn=Cr.name==="globe",hs=this.enableTerrain&&!Gn?new al:null,rl=Ht[u.type]==="Polygon";Gn&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Fp);const ll=Kw(p,500);for(let Ch=ll.length-1;Ch>=0;Ch--){const zh=ll[Ch];(zh.length===0||(ul=zh[0]).every(Eh=>Eh.x<=0)||ul.every(Eh=>Eh.x>=Hd)||ul.every(Eh=>Eh.y<=0)||ul.every(Eh=>Eh.y>=Hd))&&ll.splice(Ch,1)}var ul;let th;if(Gn)th=Qh(ll,ir,A);else{th=[];for(const Ch of ll)th.push({polygon:Ch,bounds:ir})}const fh=rl?this.edgeRadius:0;for(const{polygon:Ch,bounds:zh}of th){let Eh=0,Bh=0;for(const jh of Ch)rl&&!jh[0].equals(jh[jh.length-1])&&jh.push(jh[0]),Bh+=rl?jh.length-1:jh.length;const Hh=this.segments.prepareSegment((rl?5:4)*Bh,this.layoutVertexArray,this.indexArray);if(rl){const jh=[],cp=[];Eh=Hh.vertexLength;for(const Sp of Ch){let Hp,mp;Sp.length&&Sp!==Ch[0]&&cp.push(jh.length/2),Hp=Sp[1].sub(Sp[0])._perp()._unit();for(let Dp=1;Dp<Sp.length;Dp++){const Op=Sp[Dp],zp=Sp[Dp===Sp.length-1?1:Dp+1];let{x:Zp,y:xp}=Op;if(fh){mp=zp.sub(Op)._perp()._unit();const pd=Hp.add(mp)._unit(),Od=fh*Math.min(4,1/(Hp.x*pd.x+Hp.y*pd.y));Zp+=Od*pd.x,xp+=Od*pd.y,Hp=mp}In(this.layoutVertexArray,Zp,xp,0,0,1,1,0),Hh.vertexLength++,jh.push(Op.x,Op.y),Gn&&So(this.layoutVertexExtArray,Cr.projectTilePoint(Zp,xp,A),Cr.upVector(A,Zp,xp))}}const sp=xb(jh,cp);for(let Sp=0;Sp<sp.length;Sp+=3)this.indexArray.emplaceBack(Eh+sp[Sp],Eh+sp[Sp+2],Eh+sp[Sp+1]),Hh.primitiveLength++}for(const jh of Ch){hs&&jh.length&&hs.startRing(jh[0]);let cp,sp,Sp,Hp=jh.length>4&&Dh(jh[jh.length-2],jh[0],jh[1]),mp=fh?ah(jh[jh.length-2],jh[0],jh[1],fh):0;sp=jh[1].sub(jh[0])._perp()._unit();let Dp=!0;for(let Op=1,zp=0;Op<jh.length;Op++){let Zp=jh[Op-1],xp=jh[Op];const pd=jh[Op===jh.length-1?1:Op+1];if(hs&&rl&&hs.currentPolyCount.top++,dh(xp,Zp,zh)){fh&&(sp=pd.sub(xp)._perp()._unit(),Dp=!Dp);continue}hs&&hs.append(xp,Zp);const Od=xp.sub(Zp)._perp(),md=Od.x/(Math.abs(Od.x)+Math.abs(Od.y)),Zf=Od.y>0?1:0,Qp=Zp.dist(xp);if(zp+Qp>32768&&(zp=0),fh){Sp=pd.sub(xp)._perp()._unit();let Yf=ch(Zp,xp,pd,eh(sp,Sp),fh);isNaN(Yf)&&(Yf=0);const Gf=xp.sub(Zp)._unit();Zp=Zp.add(Gf.mult(mp))._round(),xp=xp.add(Gf.mult(-Yf))._round(),mp=Yf,sp=Sp}const qd=Hh.vertexLength,Xf=jh.length>4&&Dh(Zp,xp,pd);let vg=Ph(zp,Hp,Dp);if(In(this.layoutVertexArray,Zp.x,Zp.y,md,Zf,0,0,vg),In(this.layoutVertexArray,Zp.x,Zp.y,md,Zf,0,1,vg),zp+=Qp,vg=Ph(zp,Xf,!Dp),Hp=Xf,In(this.layoutVertexArray,xp.x,xp.y,md,Zf,0,0,vg),In(this.layoutVertexArray,xp.x,xp.y,md,Zf,0,1,vg),Hh.vertexLength+=4,this.indexArray.emplaceBack(qd+0,qd+1,qd+2),this.indexArray.emplaceBack(qd+1,qd+3,qd+2),Hh.primitiveLength+=2,fh){const Yf=Eh+(Op===1?jh.length-2:Op-2),Gf=Op===1?Eh:Yf+1;if(this.indexArray.emplaceBack(qd+1,Yf,qd+3),this.indexArray.emplaceBack(Yf,Gf,qd+3),Hh.primitiveLength+=2,cp===void 0&&(cp=qd),!dh(pd,jh[Op],zh)){const qg=Op===jh.length-1?cp:Hh.vertexLength;this.indexArray.emplaceBack(qd+2,qd+3,qg),this.indexArray.emplaceBack(qd+3,qg+1,qg),this.indexArray.emplaceBack(qd+3,Gf,qg+1),Hh.primitiveLength+=3}Dp=!Dp}if(Gn){const Yf=this.layoutVertexExtArray,Gf=Cr.projectTilePoint(Zp.x,Zp.y,A),qg=Cr.projectTilePoint(xp.x,xp.y,A),Qf=Cr.upVector(A,Zp.x,Zp.y),eg=Cr.upVector(A,xp.x,xp.y);So(Yf,Gf,Qf),So(Yf,Gf,Qf),So(Yf,qg,eg),So(Yf,qg,eg)}}rl&&(Eh+=jh.length-1)}}if(hs&&hs.polyCount.length>0){if(hs.borders){hs.vertexArrayOffset=this.centroidVertexArray.length;const Ch=hs.borders,zh=this.featuresOnBorder.push(hs)-1;for(let Eh=0;Eh<4;Eh++)Ch[Eh][0]!==Number.MAX_VALUE&&this.borders[Eh].push(zh)}this.encodeCentroid(hs.borders?void 0:hs.centroid(),hs)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,w,N,_e,A)}sortBorders(){for(let u=0;u<4;u++)this.borders[u].sort((p,w)=>this.featuresOnBorder[p].borders[u][0]-this.featuresOnBorder[w].borders[u][0])}encodeCentroid(u,p,w=!0){let A,N;if(u)if(u.y!==0){const dt=p.span()._mult(this.tileToMeter);A=(Math.max(u.x,1)<<3)+Math.min(7,Math.round(dt.x/10)),N=(Math.max(u.y,1)<<3)+Math.min(7,Math.round(dt.y/10))}else A=Math.ceil(7*(u.x+450)),N=0;else A=0,N=+w;let _e=w?this.centroidVertexArray.length:p.vertexArrayOffset;for(const dt of p.polyCount){w&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*dt.edges+dt.top);for(let ir=0;ir<dt.top;ir++)this.centroidVertexArray.emplace(_e++,A,N);for(let ir=0;ir<2*dt.edges;ir++)this.centroidVertexArray.emplace(_e++,0,N),this.centroidVertexArray.emplace(_e++,A,N)}}}function eh(c,u){const p=c.add(u)._unit();return c.x*p.x+c.y*p.y}function ah(c,u,p,w){const A=u.sub(c)._perp()._unit(),N=p.sub(u)._perp()._unit();return ch(c,u,p,eh(A,N),w)}function ch(c,u,p,w,A){const N=Math.sqrt(1-w*w);return Math.min(c.dist(u)/3,u.dist(p)/3,A*N/w)}function dh(c,u,p){return c.x<p[0].x&&u.x<p[0].x||c.x>p[1].x&&u.x>p[1].x||c.y<p[0].y&&u.y<p[0].y||c.y>p[1].y&&u.y>p[1].y}function Dh(c,u,p){if(c.x<0||c.x>=Hd||u.x<0||u.x>=Hd||p.x<0||p.x>=Hd)return!1;const w=p.sub(u),A=w.perp(),N=c.sub(u);return(w.x*N.x+w.y*N.y)/Math.sqrt((w.x*w.x+w.y*w.y)*(N.x*N.x+N.y*N.y))>-.866&&A.x*N.x+A.y*N.y<0}function Ph(c,u,p){const w=u?2|c:-3&c;return p?1|w:-2&w}function Xh(){const c=Math.PI/32,u=Math.tan(c),p=zw;return p*Math.sqrt(1+2*u*u)-p}function Qh(c,u,p){const w=1<<p.z,A=zm(p.x/w),N=zm((p.x+1)/w),_e=bm(p.y/w),dt=bm((p.y+1)/w);return function(ir,Cr,Gn,hs,rl=0,ll){const ul=[];if(!ir.length||!Gn||!hs)return ul;const th=(jh,cp)=>{for(const sp of jh)ul.push({polygon:sp,bounds:cp})},fh=Math.ceil(Math.log2(Gn)),Ch=Math.ceil(Math.log2(hs)),zh=fh-Ch,Eh=[];for(let jh=0;jh<Math.abs(zh);jh++)Eh.push(zh>0?0:1);for(let jh=0;jh<Math.min(fh,Ch);jh++)Eh.push(0),Eh.push(1);let Bh=ir;if(Bh=ut(Bh,Cr[0].y-rl,Cr[1].y+rl,1),Bh=ut(Bh,Cr[0].x-rl,Cr[1].x+rl,0),!Bh.length)return ul;const Hh=[];for(Eh.length?Hh.push({polygons:Bh,bounds:Cr,depth:0}):th(Bh,Cr);Hh.length;){const jh=Hh.pop(),cp=jh.depth,sp=Eh[cp],Sp=jh.bounds[0],Hp=jh.bounds[1],mp=sp===0?Sp.x:Sp.y,Dp=sp===0?Hp.x:Hp.y,Op=ll?ll(sp,mp,Dp):.5*(mp+Dp),zp=ut(jh.polygons,mp-rl,Op+rl,sp),Zp=ut(jh.polygons,Op-rl,Dp+rl,sp);if(zp.length){const xp=[Sp,new sl(sp===0?Op:Hp.x,sp===1?Op:Hp.y)];Eh.length>cp+1?Hh.push({polygons:zp,bounds:xp,depth:cp+1}):th(zp,xp)}if(Zp.length){const xp=[new sl(sp===0?Op:Sp.x,sp===1?Op:Sp.y),Hp];Eh.length>cp+1?Hh.push({polygons:Zp,bounds:xp,depth:cp+1}):th(Zp,xp)}}return ul}(c,u,Math.ceil((N-A)/11.25),Math.ceil((_e-dt)/11.25),1,(ir,Cr,Gn)=>{if(ir===0)return .5*(Cr+Gn);{const hs=bm((p.y+Cr/Hd)/w);return(M_(.5*(bm((p.y+Gn/Hd)/w)+hs))*w-p.y)*Hd}})}vs(hl,"FillExtrusionBucket",{omit:["layers","features"]}),vs(al,"PartMetadata");const qh=new Sh({"fill-extrusion-edge-radius":new yl(hp["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var lp={paint:new Sh({"fill-extrusion-opacity":new yl(hp["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new mh(hp["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new yl(hp["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new yl(hp["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new mh(hp["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new mh(hp["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new mh(hp["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new yl(hp["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new yl(hp["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new yl(hp["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new yl(hp["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:qh};function dp(c,u,p){var w=2*Math.PI*6378137/256/Math.pow(2,p);return[c*w-2*Math.PI*6378137/2,u*w-2*Math.PI*6378137/2]}class Mp{constructor(u,p,w){this.z=u,this.x=p,this.y=w,this.key=_d(0,u,u,p,w)}equals(u){return this.z===u.z&&this.x===u.x&&this.y===u.y}url(u,p){const w=function(N,_e,dt){var ir=dp(256*N,256*(_e=Math.pow(2,dt)-_e-1),dt),Cr=dp(256*(N+1),256*(_e+1),dt);return ir[0]+","+ir[1]+","+Cr[0]+","+Cr[1]}(this.x,this.y,this.z),A=function(N,_e,dt){let ir,Cr="";for(let Gn=N;Gn>0;Gn--)ir=1<<Gn-1,Cr+=(_e&ir?1:0)+(dt&ir?2:0);return Cr}(this.z,this.x,this.y);return u[(this.x+this.y)%u.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",A).replace("{bbox-epsg-3857}",w)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Md{constructor(u,p){this.wrap=u,this.canonical=p,this.key=_d(u,p.z,p.z,p.x,p.y)}}class bd{constructor(u,p,w,A,N){this.overscaledZ=u,this.wrap=p,this.canonical=new Mp(w,+A,+N),this.key=p===0&&u===w?this.canonical.key:_d(p,u,w,A,N)}equals(u){return this.overscaledZ===u.overscaledZ&&this.wrap===u.wrap&&this.canonical.equals(u.canonical)}scaledTo(u){const p=this.canonical.z-u;return u>this.canonical.z?new bd(u,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new bd(u,this.wrap,u,this.canonical.x>>p,this.canonical.y>>p)}calculateScaledKey(u,p=!0){if(this.overscaledZ===u&&p)return this.key;if(u>this.canonical.z)return _d(this.wrap*+p,u,this.canonical.z,this.canonical.x,this.canonical.y);{const w=this.canonical.z-u;return _d(this.wrap*+p,u,u,this.canonical.x>>w,this.canonical.y>>w)}}isChildOf(u){if(u.wrap!==this.wrap)return!1;const p=this.canonical.z-u.canonical.z;return u.overscaledZ===0||u.overscaledZ<this.overscaledZ&&u.canonical.x===this.canonical.x>>p&&u.canonical.y===this.canonical.y>>p}children(u){if(this.overscaledZ>=u)return[new bd(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const p=this.canonical.z+1,w=2*this.canonical.x,A=2*this.canonical.y;return[new bd(p,this.wrap,p,w,A),new bd(p,this.wrap,p,w+1,A),new bd(p,this.wrap,p,w,A+1),new bd(p,this.wrap,p,w+1,A+1)]}isLessThan(u){return this.wrap<u.wrap||!(this.wrap>u.wrap)&&(this.overscaledZ<u.overscaledZ||!(this.overscaledZ>u.overscaledZ)&&(this.canonical.x<u.canonical.x||!(this.canonical.x>u.canonical.x)&&this.canonical.y<u.canonical.y))}wrapped(){return new bd(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(u){return new bd(this.overscaledZ,u,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Md(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function _d(c,u,p,w,A){const N=1<<Math.min(p,22);let _e=N*(A%N)+w%N;return c&&p<22&&(_e+=N*N*((c<0?-2*c-1:2*c)%(1<<2*(22-p)))),16*(32*_e+p)+(u-p)}vs(Mp,"CanonicalTileID"),vs(bd,"OverscaledTileID",{omit:["projMatrix"]});class hd extends sl{constructor(u,p,w){super(u,p),this.z=w}}function ld(c,u){return c.x*u.x+c.y*u.y}function Sd(c,u){if(c.length===1){let p=0;const w=u[p++];let A;for(;!A||w.equals(A);)if(A=u[p++],!A)return 1/0;for(;p<u.length;p++){const N=u[p],_e=c[0],dt=A.sub(w),ir=N.sub(w),Cr=_e.sub(w),Gn=ld(dt,dt),hs=ld(dt,ir),rl=ld(ir,ir),ll=ld(Cr,dt),ul=ld(Cr,ir),th=Gn*rl-hs*hs,fh=(rl*ll-hs*ul)/th,Ch=(Gn*ul-hs*ll)/th,zh=w.z*(1-fh-Ch)+A.z*fh+N.z*Ch;if(isFinite(zh))return zh}return 1/0}{let p=1/0;for(const w of u)p=Math.min(p,w.z);return p}}function vd(c,u,p,w,A,N,_e,dt){const ir=_e*A.getElevationAt(c,u,!0,!0),Cr=N[0]!==0,Gn=Cr?N[1]===0?_e*(N[0]/7-450):_e*function(hs,rl,ll){const ul=Math.floor(rl[0]/8),th=Math.floor(rl[1]/8),fh=10*(rl[0]-8*ul),Ch=10*(rl[1]-8*th),zh=hs.getElevationAt(ul,th,!0,!0),Eh=hs.getMeterToDEM(ll),Bh=Math.floor(.5*(fh*Eh-1)),Hh=Math.floor(.5*(Ch*Eh-1)),jh=hs.tileCoordToPixel(ul,th),cp=2*Bh+1,sp=2*Hh+1,Sp=function(Zp,xp,pd,Od,md){return[Zp.getElevationAtPixel(xp,pd,!0),Zp.getElevationAtPixel(xp+md,pd,!0),Zp.getElevationAtPixel(xp,pd+md,!0),Zp.getElevationAtPixel(xp+Od,pd+md,!0)]}(hs,jh.x-Bh,jh.y-Hh,cp,sp),Hp=Math.abs(Sp[0]-Sp[1]),mp=Math.abs(Sp[2]-Sp[3]),Dp=Math.abs(Sp[0]-Sp[2])+Math.abs(Sp[1]-Sp[3]),Op=Math.min(.25,.5*Eh*(Hp+mp)/cp),zp=Math.min(.25,.5*Eh*Dp/sp);return zh+Math.max(Op*fh,zp*Ch)}(A,N,dt):ir;return{base:ir+(p===0)?-1:p,top:Cr?Math.max(Gn+w,ir+p+2):ir+w}}const Jp=Zh([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Xd}=Jp,Ud=Zh([{name:"a_packed",components:4,type:"Float32"}]),{members:ag}=Ud,Wg=W.types,Zg=Math.cos(Math.PI/180*37.5);class um{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(p=>p.id),this.index=u.index,this.projection=u.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(p=>{this.gradients[p.id]={}}),this.layoutVertexArray=new pp,this.layoutVertexArray2=new bp,this.indexArray=new Bd,this.programConfigurations=new T_(u.layers,u.zoom),this.segments=new Kg,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id)}populate(u,p,w,A){this.hasPattern=Zw("line",this.layers,p);const N=this.layers[0].layout.get("line-sort-key"),_e=[];for(const{feature:Gn,id:hs,index:rl,sourceLayerIndex:ll}of u){const ul=this.layers[0]._featureFilter.needGeometry,th=Ox(Gn,ul);if(!this.layers[0]._featureFilter.filter(new Vn(this.zoom),th,w))continue;const fh=N?N.evaluate(th,{},w):void 0,Ch={id:hs,properties:Gn.properties,type:Gn.type,sourceLayerIndex:ll,index:rl,geometry:ul?th.geometry:fv(Gn,w,A),patterns:{},sortKey:fh};_e.push(Ch)}N&&_e.sort((Gn,hs)=>Gn.sortKey-hs.sortKey);const{lineAtlas:dt,featureIndex:ir}=p,Cr=this.addConstantDashes(dt);for(const Gn of _e){const{geometry:hs,index:rl,sourceLayerIndex:ll}=Gn;if(Cr&&this.addFeatureDashes(Gn,dt),this.hasPattern){const ul=wb("line",this.layers,Gn,this.zoom,p);this.patternFeatures.push(ul)}else this.addFeature(Gn,hs,rl,w,dt.positions,p.availableImages);ir.insert(u[rl].feature,hs,rl,ll,this.index)}}addConstantDashes(u){let p=!1;for(const w of this.layers){const A=w.paint.get("line-dasharray").value,N=w.layout.get("line-cap").value;if(A.kind!=="constant"||N.kind!=="constant")p=!0;else{const _e=N.value,dt=A.value;if(!dt)continue;u.addDash(dt,_e)}}return p}addFeatureDashes(u,p){const w=this.zoom;for(const A of this.layers){const N=A.paint.get("line-dasharray").value,_e=A.layout.get("line-cap").value;if(N.kind==="constant"&&_e.kind==="constant")continue;let dt,ir;if(N.kind==="constant"){if(dt=N.value,!dt)continue}else dt=N.evaluate({zoom:w},u);ir=_e.kind==="constant"?_e.value:_e.evaluate({zoom:w},u),p.addDash(dt,ir),u.patterns[A.id]=p.getKey(dt,ir)}}update(u,p,w,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,p,this.stateDependentLayers,w,A)}addFeatures(u,p,w,A,N){for(const _e of this.patternFeatures)this.addFeature(_e,_e.geometry,_e.index,p,w,A)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=u.createVertexBuffer(this.layoutVertexArray2,ag)),this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,Xd),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(u){if(u.properties&&u.properties.hasOwnProperty("mapbox_clip_start")&&u.properties.hasOwnProperty("mapbox_clip_end"))return{start:+u.properties.mapbox_clip_start,end:+u.properties.mapbox_clip_end}}addFeature(u,p,w,A,N,_e){const dt=this.layers[0].layout,ir=dt.get("line-join").evaluate(u,{}),Cr=dt.get("line-cap").evaluate(u,{}),Gn=dt.get("line-miter-limit"),hs=dt.get("line-round-limit");this.lineClips=this.lineFeatureClips(u);for(const rl of p)this.addLine(rl,u,ir,Cr,Gn,hs);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,w,N,_e,A)}addLine(u,p,w,A,N,_e){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ch=0;Ch<u.length-1;Ch++)this.totalDistance+=u[Ch].dist(u[Ch+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const dt=Wg[p.type]==="Polygon";let ir=u.length;for(;ir>=2&&u[ir-1].equals(u[ir-2]);)ir--;let Cr=0;for(;Cr<ir-1&&u[Cr].equals(u[Cr+1]);)Cr++;if(ir<(dt?3:2))return;w==="bevel"&&(N=1.05);const Gn=this.overscaling<=16?15*Hd/(512*this.overscaling):0,hs=this.segments.prepareSegment(10*ir,this.layoutVertexArray,this.indexArray);let rl,ll,ul,th,fh;this.e1=this.e2=-1,dt&&(rl=u[ir-2],fh=u[Cr].sub(rl)._unit()._perp());for(let Ch=Cr;Ch<ir;Ch++){if(ul=Ch===ir-1?dt?u[Cr+1]:void 0:u[Ch+1],ul&&u[Ch].equals(ul))continue;fh&&(th=fh),rl&&(ll=rl),rl=u[Ch],fh=ul?ul.sub(rl)._unit()._perp():th,th=th||fh;let zh=th.add(fh);zh.x===0&&zh.y===0||zh._unit();const Eh=th.x*fh.x+th.y*fh.y,Bh=zh.x*fh.x+zh.y*fh.y,Hh=Bh!==0?1/Bh:1/0,jh=2*Math.sqrt(2-2*Bh),cp=Bh<Zg&&ll&&ul,sp=th.x*fh.y-th.y*fh.x>0;if(cp&&Ch>Cr){const mp=rl.dist(ll);if(mp>2*Gn){const Dp=rl.sub(rl.sub(ll)._mult(Gn/mp)._round());this.updateDistance(ll,Dp),this.addCurrentVertex(Dp,th,0,0,hs),ll=Dp}}const Sp=ll&&ul;let Hp=Sp?w:dt?"butt":A;if(Sp&&Hp==="round"&&(Hh<_e?Hp="miter":Hh<=2&&(Hp="fakeround")),Hp==="miter"&&Hh>N&&(Hp="bevel"),Hp==="bevel"&&(Hh>2&&(Hp="flipbevel"),Hh<N&&(Hp="miter")),ll&&this.updateDistance(ll,rl),Hp==="miter")zh._mult(Hh),this.addCurrentVertex(rl,zh,0,0,hs);else if(Hp==="flipbevel"){if(Hh>100)zh=fh.mult(-1);else{const mp=Hh*th.add(fh).mag()/th.sub(fh).mag();zh._perp()._mult(mp*(sp?-1:1))}this.addCurrentVertex(rl,zh,0,0,hs),this.addCurrentVertex(rl,zh.mult(-1),0,0,hs)}else if(Hp==="bevel"||Hp==="fakeround"){const mp=-Math.sqrt(Hh*Hh-1),Dp=sp?mp:0,Op=sp?0:mp;if(ll&&this.addCurrentVertex(rl,th,Dp,Op,hs),Hp==="fakeround"){const zp=Math.round(180*jh/Math.PI/20);for(let Zp=1;Zp<zp;Zp++){let xp=Zp/zp;if(xp!==.5){const Od=xp-.5;xp+=xp*Od*(xp-1)*((1.0904+Eh*(Eh*(3.55645-1.43519*Eh)-3.2452))*Od*Od+(.848013+Eh*(.215638*Eh-1.06021)))}const pd=fh.sub(th)._mult(xp)._add(th)._unit()._mult(sp?-1:1);this.addHalfVertex(rl,pd.x,pd.y,!1,sp,0,hs)}}ul&&this.addCurrentVertex(rl,fh,-Dp,-Op,hs)}else if(Hp==="butt")this.addCurrentVertex(rl,zh,0,0,hs);else if(Hp==="square"){const mp=ll?1:-1;ll||this.addCurrentVertex(rl,zh,mp,mp,hs),this.addCurrentVertex(rl,zh,0,0,hs),ll&&this.addCurrentVertex(rl,zh,mp,mp,hs)}else Hp==="round"&&(ll&&(this.addCurrentVertex(rl,th,0,0,hs),this.addCurrentVertex(rl,th,1,1,hs,!0)),ul&&(this.addCurrentVertex(rl,fh,-1,-1,hs,!0),this.addCurrentVertex(rl,fh,0,0,hs)));if(cp&&Ch<ir-1){const mp=rl.dist(ul);if(mp>2*Gn){const Dp=rl.add(ul.sub(rl)._mult(Gn/mp)._round());this.updateDistance(rl,Dp),this.addCurrentVertex(Dp,fh,0,0,hs),rl=Dp}}}}addCurrentVertex(u,p,w,A,N,_e=!1){const dt=p.y*A-p.x,ir=-p.y-p.x*A;this.addHalfVertex(u,p.x+p.y*w,p.y-p.x*w,_e,!1,w,N),this.addHalfVertex(u,dt,ir,_e,!0,-A,N)}addHalfVertex({x:u,y:p},w,A,N,_e,dt,ir){this.layoutVertexArray.emplaceBack((u<<1)+(N?1:0),(p<<1)+(_e?1:0),Math.round(63*w)+128,Math.round(63*A)+128,1+(dt===0?0:dt<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const Cr=ir.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,Cr),ir.primitiveLength++),_e?this.e2=Cr:this.e1=Cr}updateScaledDistance(){if(this.lineClips){const u=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=u*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(u,p){this.distance+=u.dist(p),this.updateScaledDistance()}}vs(um,"LineBucket",{omit:["layers","patternFeatures"]});const s_=new Sh({"line-cap":new mh(hp.layout_line["line-cap"]),"line-join":new mh(hp.layout_line["line-join"]),"line-miter-limit":new yl(hp.layout_line["line-miter-limit"]),"line-round-limit":new yl(hp.layout_line["line-round-limit"]),"line-sort-key":new mh(hp.layout_line["line-sort-key"])});var jm={paint:new Sh({"line-opacity":new mh(hp.paint_line["line-opacity"]),"line-color":new mh(hp.paint_line["line-color"]),"line-translate":new yl(hp.paint_line["line-translate"]),"line-translate-anchor":new yl(hp.paint_line["line-translate-anchor"]),"line-width":new mh(hp.paint_line["line-width"]),"line-gap-width":new mh(hp.paint_line["line-gap-width"]),"line-offset":new mh(hp.paint_line["line-offset"]),"line-blur":new mh(hp.paint_line["line-blur"]),"line-dasharray":new mh(hp.paint_line["line-dasharray"]),"line-pattern":new mh(hp.paint_line["line-pattern"]),"line-gradient":new bh(hp.paint_line["line-gradient"]),"line-trim-offset":new yl(hp.paint_line["line-trim-offset"])}),layout:s_};const _m=new class extends mh{possiblyEvaluate(c,u){return u=new Vn(Math.floor(u.zoom),{now:u.now,fadeDuration:u.fadeDuration,transition:u.transition}),super.possiblyEvaluate(c,u)}evaluate(c,u,p,w){return u=Cp({},u,{zoom:Math.floor(u.zoom)}),super.evaluate(c,u,p,w)}}(jm.paint.properties["line-width"].specification);function Rm(c,u){return u>0?u+2*c:c}_m.useIntegerZoom=!0;const Qm=Zh([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),hy=Zh([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Dy=Zh([{name:"a_projected_pos",components:4,type:"Float32"}],4);Zh([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Cm=Zh([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),ey=Zh([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Zh([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ty=Zh([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Cy=Zh([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Zh([{name:"triangle",components:3,type:"Uint16"}]),Zh([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Zh([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Zh([{type:"Float32",name:"offsetX"}]),Zh([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Ig=24;const rm=128;function Qg(c,u){const{expression:p}=u;if(p.kind==="constant")return{kind:"constant",layoutSize:p.evaluate(new Vn(c+1))};if(p.kind==="source")return{kind:"source"};{const{zoomStops:w,interpolationType:A}=p;let N=0;for(;N<w.length&&w[N]<=c;)N++;N=Math.max(0,N-1);let _e=N;for(;_e<w.length&&w[_e]<c+1;)_e++;_e=Math.min(w.length-1,_e);const dt=w[N],ir=w[_e];return p.kind==="composite"?{kind:"composite",minZoom:dt,maxZoom:ir,interpolationType:A}:{kind:"camera",minZoom:dt,maxZoom:ir,minSize:p.evaluate(new Vn(dt)),maxSize:p.evaluate(new Vn(ir)),interpolationType:A}}}function Im(c,{uSize:u,uSizeT:p},{lowerSize:w,upperSize:A}){return c.kind==="source"?w/rm:c.kind==="composite"?jd(w/rm,A/rm,p):u}function tg(c,u){let p=0,w=0;if(c.kind==="constant")w=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:A,minZoom:N,maxZoom:_e}=c,dt=A?Jh(Zm.interpolationFactor(A,u,N,_e),0,1):0;c.kind==="camera"?w=jd(c.minSize,c.maxSize,dt):p=dt}return{uSizeT:p,uSize:w}}var jy=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:rm,evaluateSizeForFeature:Im,evaluateSizeForZoom:tg,getSizeData:Qg});function ry(c,u,p){return c.sections.forEach(w=>{w.text=function(A,N,_e){const dt=N.layout.get("text-transform").evaluate(_e,{});return dt==="uppercase"?A=A.toLocaleUpperCase():dt==="lowercase"&&(A=A.toLocaleLowerCase()),pi.applyArabicShaping&&(A=pi.applyArabicShaping(A)),A}(w.text,u,p)}),c}const Pm={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function O_(c){return c==="︶"||c==="﹈"||c==="︸"||c==="﹄"||c==="﹂"||c==="︾"||c==="︼"||c==="︺"||c==="︘"||c==="﹀"||c==="︐"||c==="︓"||c==="︔"||c==="｀"||c==="￣"||c==="︑"||c==="︒"}function yv(c){return c==="︵"||c==="﹇"||c==="︷"||c==="﹃"||c==="﹁"||c==="︽"||c==="︻"||c==="︹"||c==="︗"||c==="︿"}var L_=sg,i0=function(c,u,p,w,A){var N,_e,dt=8*A-w-1,ir=(1<<dt)-1,Cr=ir>>1,Gn=-7,hs=p?A-1:0,rl=p?-1:1,ll=c[u+hs];for(hs+=rl,N=ll&(1<<-Gn)-1,ll>>=-Gn,Gn+=dt;Gn>0;N=256*N+c[u+hs],hs+=rl,Gn-=8);for(_e=N&(1<<-Gn)-1,N>>=-Gn,Gn+=w;Gn>0;_e=256*_e+c[u+hs],hs+=rl,Gn-=8);if(N===0)N=1-Cr;else{if(N===ir)return _e?NaN:1/0*(ll?-1:1);_e+=Math.pow(2,w),N-=Cr}return(ll?-1:1)*_e*Math.pow(2,N-w)},a_=function(c,u,p,w,A,N){var _e,dt,ir,Cr=8*N-A-1,Gn=(1<<Cr)-1,hs=Gn>>1,rl=A===23?Math.pow(2,-24)-Math.pow(2,-77):0,ll=w?0:N-1,ul=w?1:-1,th=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(dt=isNaN(u)?1:0,_e=Gn):(_e=Math.floor(Math.log(u)/Math.LN2),u*(ir=Math.pow(2,-_e))<1&&(_e--,ir*=2),(u+=_e+hs>=1?rl/ir:rl*Math.pow(2,1-hs))*ir>=2&&(_e++,ir/=2),_e+hs>=Gn?(dt=0,_e=Gn):_e+hs>=1?(dt=(u*ir-1)*Math.pow(2,A),_e+=hs):(dt=u*Math.pow(2,hs-1)*Math.pow(2,A),_e=0));A>=8;c[p+ll]=255&dt,ll+=ul,dt/=256,A-=8);for(_e=_e<<A|dt,Cr+=A;Cr>0;c[p+ll]=255&_e,ll+=ul,_e/=256,Cr-=8);c[p+ll-ul]|=128*th};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function sg(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}sg.Varint=0,sg.Fixed64=1,sg.Bytes=2,sg.Fixed32=5;var py=4294967296,n0=1/py,uw=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function o0(c){return c.type===sg.Bytes?c.readVarint()+c.pos:c.pos+1}function fx(c,u,p){return p?4294967296*u+(c>>>0):4294967296*(u>>>0)+(c>>>0)}function M1(c,u,p){var w=u<=16383?1:u<=2097151?2:u<=268435455?3:Math.floor(Math.log(u)/(7*Math.LN2));p.realloc(w);for(var A=p.pos-1;A>=c;A--)p.buf[A+w]=p.buf[A]}function L0(c,u){for(var p=0;p<c.length;p++)u.writeVarint(c[p])}function RC(c,u){for(var p=0;p<c.length;p++)u.writeSVarint(c[p])}function Ab(c,u){for(var p=0;p<c.length;p++)u.writeFloat(c[p])}function Rb(c,u){for(var p=0;p<c.length;p++)u.writeDouble(c[p])}function IC(c,u){for(var p=0;p<c.length;p++)u.writeBoolean(c[p])}function dE(c,u){for(var p=0;p<c.length;p++)u.writeFixed32(c[p])}function fE(c,u){for(var p=0;p<c.length;p++)u.writeSFixed32(c[p])}function gE(c,u){for(var p=0;p<c.length;p++)u.writeFixed64(c[p])}function mE(c,u){for(var p=0;p<c.length;p++)u.writeSFixed64(c[p])}function D1(c,u){return(c[u]|c[u+1]<<8|c[u+2]<<16)+16777216*c[u+3]}function hw(c,u,p){c[p]=u,c[p+1]=u>>>8,c[p+2]=u>>>16,c[p+3]=u>>>24}function PC(c,u){return(c[u]|c[u+1]<<8|c[u+2]<<16)+(c[u+3]<<24)}sg.prototype={destroy:function(){this.buf=null},readFields:function(c,u,p){for(p=p||this.length;this.pos<p;){var w=this.readVarint(),A=w>>3,N=this.pos;this.type=7&w,c(A,u,this),this.pos===N&&this.skip(w)}return u},readMessage:function(c,u){return this.readFields(c,u,this.readVarint()+this.pos)},readFixed32:function(){var c=D1(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=PC(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=D1(this.buf,this.pos)+D1(this.buf,this.pos+4)*py;return this.pos+=8,c},readSFixed64:function(){var c=D1(this.buf,this.pos)+PC(this.buf,this.pos+4)*py;return this.pos+=8,c},readFloat:function(){var c=i0(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=i0(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var u,p,w=this.buf;return u=127&(p=w[this.pos++]),p<128?u:(u|=(127&(p=w[this.pos++]))<<7,p<128?u:(u|=(127&(p=w[this.pos++]))<<14,p<128?u:(u|=(127&(p=w[this.pos++]))<<21,p<128?u:function(A,N,_e){var dt,ir,Cr=_e.buf;if(dt=(112&(ir=Cr[_e.pos++]))>>4,ir<128||(dt|=(127&(ir=Cr[_e.pos++]))<<3,ir<128)||(dt|=(127&(ir=Cr[_e.pos++]))<<10,ir<128)||(dt|=(127&(ir=Cr[_e.pos++]))<<17,ir<128)||(dt|=(127&(ir=Cr[_e.pos++]))<<24,ir<128)||(dt|=(1&(ir=Cr[_e.pos++]))<<31,ir<128))return fx(A,dt,N);throw new Error("Expected varint not more than 10 bytes")}(u|=(15&(p=w[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var c=this.readVarint()+this.pos,u=this.pos;return this.pos=c,c-u>=12&&uw?function(p,w,A){return uw.decode(p.subarray(w,A))}(this.buf,u,c):function(p,w,A){for(var N="",_e=w;_e<A;){var dt,ir,Cr,Gn=p[_e],hs=null,rl=Gn>239?4:Gn>223?3:Gn>191?2:1;if(_e+rl>A)break;rl===1?Gn<128&&(hs=Gn):rl===2?(192&(dt=p[_e+1]))==128&&(hs=(31&Gn)<<6|63&dt)<=127&&(hs=null):rl===3?(ir=p[_e+2],(192&(dt=p[_e+1]))==128&&(192&ir)==128&&((hs=(15&Gn)<<12|(63&dt)<<6|63&ir)<=2047||hs>=55296&&hs<=57343)&&(hs=null)):rl===4&&(ir=p[_e+2],Cr=p[_e+3],(192&(dt=p[_e+1]))==128&&(192&ir)==128&&(192&Cr)==128&&((hs=(15&Gn)<<18|(63&dt)<<12|(63&ir)<<6|63&Cr)<=65535||hs>=1114112)&&(hs=null)),hs===null?(hs=65533,rl=1):hs>65535&&(hs-=65536,N+=String.fromCharCode(hs>>>10&1023|55296),hs=56320|1023&hs),N+=String.fromCharCode(hs),_e+=rl}return N}(this.buf,u,c)},readBytes:function(){var c=this.readVarint()+this.pos,u=this.buf.subarray(this.pos,c);return this.pos=c,u},readPackedVarint:function(c,u){if(this.type!==sg.Bytes)return c.push(this.readVarint(u));var p=o0(this);for(c=c||[];this.pos<p;)c.push(this.readVarint(u));return c},readPackedSVarint:function(c){if(this.type!==sg.Bytes)return c.push(this.readSVarint());var u=o0(this);for(c=c||[];this.pos<u;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==sg.Bytes)return c.push(this.readBoolean());var u=o0(this);for(c=c||[];this.pos<u;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==sg.Bytes)return c.push(this.readFloat());var u=o0(this);for(c=c||[];this.pos<u;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==sg.Bytes)return c.push(this.readDouble());var u=o0(this);for(c=c||[];this.pos<u;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==sg.Bytes)return c.push(this.readFixed32());var u=o0(this);for(c=c||[];this.pos<u;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==sg.Bytes)return c.push(this.readSFixed32());var u=o0(this);for(c=c||[];this.pos<u;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==sg.Bytes)return c.push(this.readFixed64());var u=o0(this);for(c=c||[];this.pos<u;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==sg.Bytes)return c.push(this.readSFixed64());var u=o0(this);for(c=c||[];this.pos<u;)c.push(this.readSFixed64());return c},skip:function(c){var u=7&c;if(u===sg.Varint)for(;this.buf[this.pos++]>127;);else if(u===sg.Bytes)this.pos=this.readVarint()+this.pos;else if(u===sg.Fixed32)this.pos+=4;else{if(u!==sg.Fixed64)throw new Error("Unimplemented type: "+u);this.pos+=8}},writeTag:function(c,u){this.writeVarint(c<<3|u)},realloc:function(c){for(var u=this.length||16;u<this.pos+c;)u*=2;if(u!==this.length){var p=new Uint8Array(u);p.set(this.buf),this.buf=p,this.length=u}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),hw(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),hw(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),hw(this.buf,-1&c,this.pos),hw(this.buf,Math.floor(c*n0),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),hw(this.buf,-1&c,this.pos),hw(this.buf,Math.floor(c*n0),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(u,p){var w,A;if(u>=0?(w=u%4294967296|0,A=u/4294967296|0):(A=~(-u/4294967296),4294967295^(w=~(-u%4294967296))?w=w+1|0:(w=0,A=A+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");p.realloc(10),function(N,_e,dt){dt.buf[dt.pos++]=127&N|128,N>>>=7,dt.buf[dt.pos++]=127&N|128,N>>>=7,dt.buf[dt.pos++]=127&N|128,N>>>=7,dt.buf[dt.pos++]=127&N|128,dt.buf[dt.pos]=127&(N>>>=7)}(w,0,p),function(N,_e){var dt=(7&N)<<4;_e.buf[_e.pos++]|=dt|((N>>>=3)?128:0),N&&(_e.buf[_e.pos++]=127&N|((N>>>=7)?128:0),N&&(_e.buf[_e.pos++]=127&N|((N>>>=7)?128:0),N&&(_e.buf[_e.pos++]=127&N|((N>>>=7)?128:0),N&&(_e.buf[_e.pos++]=127&N|((N>>>=7)?128:0),N&&(_e.buf[_e.pos++]=127&N)))))}(A,p)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(!!c)},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var u=this.pos;this.pos=function(w,A,N){for(var _e,dt,ir=0;ir<A.length;ir++){if((_e=A.charCodeAt(ir))>55295&&_e<57344){if(!dt){_e>56319||ir+1===A.length?(w[N++]=239,w[N++]=191,w[N++]=189):dt=_e;continue}if(_e<56320){w[N++]=239,w[N++]=191,w[N++]=189,dt=_e;continue}_e=dt-55296<<10|_e-56320|65536,dt=null}else dt&&(w[N++]=239,w[N++]=191,w[N++]=189,dt=null);_e<128?w[N++]=_e:(_e<2048?w[N++]=_e>>6|192:(_e<65536?w[N++]=_e>>12|224:(w[N++]=_e>>18|240,w[N++]=_e>>12&63|128),w[N++]=_e>>6&63|128),w[N++]=63&_e|128)}return N}(this.buf,c,this.pos);var p=this.pos-u;p>=128&&M1(u,p,this),this.pos=u-1,this.writeVarint(p),this.pos+=p},writeFloat:function(c){this.realloc(4),a_(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),a_(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var u=c.length;this.writeVarint(u),this.realloc(u);for(var p=0;p<u;p++)this.buf[this.pos++]=c[p]},writeRawMessage:function(c,u){this.pos++;var p=this.pos;c(u,this);var w=this.pos-p;w>=128&&M1(p,w,this),this.pos=p-1,this.writeVarint(w),this.pos+=w},writeMessage:function(c,u,p){this.writeTag(c,sg.Bytes),this.writeRawMessage(u,p)},writePackedVarint:function(c,u){u.length&&this.writeMessage(c,L0,u)},writePackedSVarint:function(c,u){u.length&&this.writeMessage(c,RC,u)},writePackedBoolean:function(c,u){u.length&&this.writeMessage(c,IC,u)},writePackedFloat:function(c,u){u.length&&this.writeMessage(c,Ab,u)},writePackedDouble:function(c,u){u.length&&this.writeMessage(c,Rb,u)},writePackedFixed32:function(c,u){u.length&&this.writeMessage(c,dE,u)},writePackedSFixed32:function(c,u){u.length&&this.writeMessage(c,fE,u)},writePackedFixed64:function(c,u){u.length&&this.writeMessage(c,gE,u)},writePackedSFixed64:function(c,u){u.length&&this.writeMessage(c,mE,u)},writeBytesField:function(c,u){this.writeTag(c,sg.Bytes),this.writeBytes(u)},writeFixed32Field:function(c,u){this.writeTag(c,sg.Fixed32),this.writeFixed32(u)},writeSFixed32Field:function(c,u){this.writeTag(c,sg.Fixed32),this.writeSFixed32(u)},writeFixed64Field:function(c,u){this.writeTag(c,sg.Fixed64),this.writeFixed64(u)},writeSFixed64Field:function(c,u){this.writeTag(c,sg.Fixed64),this.writeSFixed64(u)},writeVarintField:function(c,u){this.writeTag(c,sg.Varint),this.writeVarint(u)},writeSVarintField:function(c,u){this.writeTag(c,sg.Varint),this.writeSVarint(u)},writeStringField:function(c,u){this.writeTag(c,sg.Bytes),this.writeString(u)},writeFloatField:function(c,u){this.writeTag(c,sg.Fixed32),this.writeFloat(u)},writeDoubleField:function(c,u){this.writeTag(c,sg.Fixed64),this.writeDouble(u)},writeBooleanField:function(c,u){this.writeVarintField(c,!!u)}};var O1=vi(L_);const l_=3;function L1(c,u,p){u.glyphs=[],c===1&&p.readMessage(MC,u)}function MC(c,u,p){if(c===3){const{id:w,bitmap:A,width:N,height:_e,left:dt,top:ir,advance:Cr}=p.readMessage(Oy,{});u.glyphs.push({id:w,bitmap:new t0({width:N+2*l_,height:_e+2*l_},A),metrics:{width:N,height:_e,left:dt,top:ir,advance:Cr}})}else c===4?u.ascender=p.readSVarint():c===5&&(u.descender=p.readSVarint())}function Oy(c,u,p){c===1?u.id=p.readVarint():c===2?u.bitmap=p.readBytes():c===3?u.width=p.readVarint():c===4?u.height=p.readVarint():c===5?u.left=p.readSVarint():c===6?u.top=p.readSVarint():c===7&&(u.advance=p.readVarint())}const _v=l_;function kx(c){let u=0,p=0;for(const _e of c)u+=_e.w*_e.h,p=Math.max(p,_e.w);c.sort((_e,dt)=>dt.h-_e.h);const w=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(u/.95)),p),h:1/0}];let A=0,N=0;for(const _e of c)for(let dt=w.length-1;dt>=0;dt--){const ir=w[dt];if(!(_e.w>ir.w||_e.h>ir.h)){if(_e.x=ir.x,_e.y=ir.y,N=Math.max(N,_e.y+_e.h),A=Math.max(A,_e.x+_e.w),_e.w===ir.w&&_e.h===ir.h){const Cr=w.pop();dt<w.length&&(w[dt]=Cr)}else _e.h===ir.h?(ir.x+=_e.w,ir.w-=_e.w):_e.w===ir.w?(ir.y+=_e.h,ir.h-=_e.h):(w.push({x:ir.x+_e.w,y:ir.y,w:ir.w-_e.w,h:_e.h}),ir.y+=_e.h,ir.h-=_e.h);break}}return{w:A,h:N,fill:u/(A*N)||0}}const Hm=1;class F1{constructor(u,{pixelRatio:p,version:w,stretchX:A,stretchY:N,content:_e}){this.paddedRect=u,this.pixelRatio=p,this.stretchX=A,this.stretchY=N,this.content=_e,this.version=w}get tl(){return[this.paddedRect.x+Hm,this.paddedRect.y+Hm]}get br(){return[this.paddedRect.x+this.paddedRect.w-Hm,this.paddedRect.y+this.paddedRect.h-Hm]}get displaySize(){return[(this.paddedRect.w-2*Hm)/this.pixelRatio,(this.paddedRect.h-2*Hm)/this.pixelRatio]}}class gx{constructor(u,p){const w={},A={};this.haveRenderCallbacks=[];const N=[];this.addImages(u,w,N),this.addImages(p,A,N);const{w:_e,h:dt}=kx(N),ir=new My({width:_e||1,height:dt||1});for(const Cr in u){const Gn=u[Cr],hs=w[Cr].paddedRect;My.copy(Gn.data,ir,{x:0,y:0},{x:hs.x+Hm,y:hs.y+Hm},Gn.data)}for(const Cr in p){const Gn=p[Cr],hs=A[Cr].paddedRect,rl=hs.x+Hm,ll=hs.y+Hm,ul=Gn.data.width,th=Gn.data.height;My.copy(Gn.data,ir,{x:0,y:0},{x:rl,y:ll},Gn.data),My.copy(Gn.data,ir,{x:0,y:th-1},{x:rl,y:ll-1},{width:ul,height:1}),My.copy(Gn.data,ir,{x:0,y:0},{x:rl,y:ll+th},{width:ul,height:1}),My.copy(Gn.data,ir,{x:ul-1,y:0},{x:rl-1,y:ll},{width:1,height:th}),My.copy(Gn.data,ir,{x:0,y:0},{x:rl+ul,y:ll},{width:1,height:th})}this.image=ir,this.iconPositions=w,this.patternPositions=A}addImages(u,p,w){for(const A in u){const N=u[A],_e={x:0,y:0,w:N.data.width+2*Hm,h:N.data.height+2*Hm};w.push(_e),p[A]=new F1(_e,N),N.hasRenderCallback&&this.haveRenderCallbacks.push(A)}}patchUpdatedImages(u,p){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(w=>u.hasImage(w)),u.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const w in u.updatedImages)this.patchUpdatedImage(this.iconPositions[w],u.getImage(w),p),this.patchUpdatedImage(this.patternPositions[w],u.getImage(w),p)}patchUpdatedImage(u,p,w){if(!u||!p||u.version===p.version)return;u.version=p.version;const[A,N]=u.tl;w.update(p.data,void 0,{x:A,y:N})}}vs(F1,"ImagePosition"),vs(gx,"ImageAtlas");const vv={horizontal:1,vertical:2,horizontalOnly:3},HE=-17;class Ib{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(u,p){const w=new Ib;return w.scale=u||1,w.fontStack=p,w}static forImage(u){const p=new Ib;return p.imageName=u,p}}class N1{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(u,p){const w=new N1;for(let A=0;A<u.sections.length;A++){const N=u.sections[A];N.image?w.addImageSection(N):w.addTextSection(N,p)}return w}length(){return this.text.length}getSection(u){return this.sections[this.sectionIndex[u]]}getSections(){return this.sections}getSectionIndex(u){return this.sectionIndex[u]}getCharCode(u){return this.text.charCodeAt(u)}verticalizePunctuation(u){this.text=function(p,w){let A="";for(let N=0;N<p.length;N++){const _e=p.charCodeAt(N+1)||null,dt=p.charCodeAt(N-1)||null;A+=!w&&(_e&&Lh(_e)&&!Pm[p[N+1]]||dt&&Lh(dt)&&!Pm[p[N-1]])||!Pm[p[N]]?p[N]:Pm[p[N]]}return A}(this.text,u)}trim(){let u=0;for(let w=0;w<this.text.length&&DC[this.text.charCodeAt(w)];w++)u++;let p=this.text.length;for(let w=this.text.length-1;w>=0&&w>=u&&DC[this.text.charCodeAt(w)];w--)p--;this.text=this.text.substring(u,p),this.sectionIndex=this.sectionIndex.slice(u,p)}substring(u,p){const w=new N1;return w.text=this.text.substring(u,p),w.sectionIndex=this.sectionIndex.slice(u,p),w.sections=this.sections,w}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((u,p)=>Math.max(u,this.sections[p].scale),0)}addTextSection(u,p){this.text+=u.text,this.sections.push(Ib.forText(u.scale,u.fontStack||p));const w=this.sections.length-1;for(let A=0;A<u.text.length;++A)this.sectionIndex.push(w)}addImageSection(u){const p=u.image?u.image.name:"";if(p.length===0)return void Ap("Can't add FormattedSection with an empty image.");const w=this.getNextImageSectionCharCode();w?(this.text+=String.fromCharCode(w),this.sections.push(Ib.forImage(p)),this.sectionIndex.push(this.sections.length-1)):Ap("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function yE(c,u,p,w,A,N,_e,dt,ir,Cr,Gn,hs,rl,ll,ul){const th=N1.fromFeature(c,A);hs===vv.vertical&&th.verticalizePunctuation(rl);let fh=[];const Ch=function(jh,cp,sp,Sp,Hp,mp){if(!jh)return[];const Dp=[],Op=function(pd,Od,md,Zf,Qp,qd){let Xf=0;for(let vg=0;vg<pd.length();vg++){const Yf=pd.getSection(vg);Xf+=WE(pd.getCharCode(vg),Yf,Zf,Qp,Od,qd)}return Xf/Math.max(1,Math.ceil(Xf/md))}(jh,cp,sp,Sp,Hp,mp),zp=jh.text.indexOf("​")>=0;let Zp=0;for(let pd=0;pd<jh.length();pd++){const Od=jh.getSection(pd),md=jh.getCharCode(pd);if(DC[md]||(Zp+=WE(md,Od,Sp,Hp,cp,mp)),pd<jh.length()-1){const Zf=!((xp=md)<11904||!(hh["Bopomofo Extended"](xp)||hh.Bopomofo(xp)||hh["CJK Compatibility Forms"](xp)||hh["CJK Compatibility Ideographs"](xp)||hh["CJK Compatibility"](xp)||hh["CJK Radicals Supplement"](xp)||hh["CJK Strokes"](xp)||hh["CJK Symbols and Punctuation"](xp)||hh["CJK Unified Ideographs Extension A"](xp)||hh["CJK Unified Ideographs"](xp)||hh["Enclosed CJK Letters and Months"](xp)||hh["Halfwidth and Fullwidth Forms"](xp)||hh.Hiragana(xp)||hh["Ideographic Description Characters"](xp)||hh["Kangxi Radicals"](xp)||hh["Katakana Phonetic Extensions"](xp)||hh.Katakana(xp)||hh["Vertical Forms"](xp)||hh["Yi Radicals"](xp)||hh["Yi Syllables"](xp)));(rT[md]||Zf||Od.imageName)&&Dp.push(KE(pd+1,Zp,Op,Dp,iT(md,jh.getCharCode(pd+1),Zf&&zp),!1))}}var xp;return ZE(KE(jh.length(),Zp,Op,Dp,0,!0))}(th,Cr,N,u,w,ll),{processBidirectionalText:zh,processStyledBidirectionalText:Eh}=pi;if(zh&&th.sections.length===1){const jh=zh(th.toString(),Ch);for(const cp of jh){const sp=new N1;sp.text=cp,sp.sections=th.sections;for(let Sp=0;Sp<cp.length;Sp++)sp.sectionIndex.push(0);fh.push(sp)}}else if(Eh){const jh=Eh(th.text,th.sectionIndex,Ch);for(const cp of jh){const sp=new N1;sp.text=cp[0],sp.sectionIndex=cp[1],sp.sections=th.sections,fh.push(sp)}}else fh=function(jh,cp){const sp=[],Sp=jh.text;let Hp=0;for(const mp of cp)sp.push(jh.substring(Hp,mp)),Hp=mp;return Hp<Sp.length&&sp.push(jh.substring(Hp,Sp.length)),sp}(th,Ch);const Bh=[],Hh={positionedLines:Bh,text:th.toString(),top:Gn[1],bottom:Gn[1],left:Gn[0],right:Gn[0],writingMode:hs,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(jh,cp,sp,Sp,Hp,mp,Dp,Op,zp,Zp,xp,pd){let Od=0,md=0,Zf=0;const Qp=Op==="right"?1:Op==="left"?0:.5;let qd=!1;for(const Qf of Hp){const eg=Qf.getSections();for(const Fg of eg){if(Fg.imageName)continue;const Ug=cp[Fg.fontStack];if(Ug&&(qd=Ug.ascender!==void 0&&Ug.descender!==void 0,!qd))break}if(!qd)break}let Xf=0;for(const Qf of Hp){Qf.trim();const eg=Qf.getMaxScale(),Fg=(eg-1)*Ig,Ug={positionedGlyphs:[],lineOffset:0};jh.positionedLines[Xf]=Ug;const jg=Ug.positionedGlyphs;let Ng=0;if(!Qf.length()){md+=mp,++Xf;continue}let im=0,vm=0;for(let kg=0;kg<Qf.length();kg++){const Gm=Qf.getSection(kg),Dm=Qf.getSectionIndex(kg),cm=Qf.getCharCode(kg);let wg=Gm.scale,Om=null,Hg=null,Hy=null,Lm=Ig,dy=0;const iy=!(zp===vv.horizontal||!xp&&!ap(cm)||xp&&(DC[cm]||(vg=cm,hh.Arabic(vg)||hh["Arabic Supplement"](vg)||hh["Arabic Extended-A"](vg)||hh["Arabic Presentation Forms-A"](vg)||hh["Arabic Presentation Forms-B"](vg))));if(Gm.imageName){const Wy=Sp[Gm.imageName];if(!Wy)continue;Hy=Gm.imageName,jh.iconsInText=jh.iconsInText||!0,Hg=Wy.paddedRect;const ny=Wy.displaySize;wg=wg*Ig/pd,Om={width:ny[0],height:ny[1],left:Hm,top:-_v,advance:iy?ny[1]:ny[0],localGlyph:!1},dy=qd?-Om.height*wg:HE+eg*Ig-ny[1]*wg,Lm=Om.advance;const k0=(iy?ny[0]:ny[1])*wg-Ig*eg;k0>0&&k0>Ng&&(Ng=k0)}else{const Wy=sp[Gm.fontStack];if(!Wy)continue;Wy[cm]&&(Hg=Wy[cm]);const ny=cp[Gm.fontStack];if(!ny)continue;const k0=ny.glyphs[cm];if(!k0)continue;if(Om=k0.metrics,Lm=cm!==8203?Ig:0,qd){const U1=ny.ascender!==void 0?Math.abs(ny.ascender):0,zb=ny.descender!==void 0?Math.abs(ny.descender):0,Gb=(U1+zb)*wg;im<Gb&&(im=Gb,vm=(U1-zb)/2*wg),dy=-U1*wg}else dy=HE+(eg-wg)*Ig}iy?(jh.verticalizable=!0,jg.push({glyph:cm,imageName:Hy,x:Od,y:md+dy,vertical:iy,scale:wg,localGlyph:Om.localGlyph,fontStack:Gm.fontStack,sectionIndex:Dm,metrics:Om,rect:Hg}),Od+=Lm*wg+Zp):(jg.push({glyph:cm,imageName:Hy,x:Od,y:md+dy,vertical:iy,scale:wg,localGlyph:Om.localGlyph,fontStack:Gm.fontStack,sectionIndex:Dm,metrics:Om,rect:Hg}),Od+=Om.advance*wg+Zp)}jg.length!==0&&(Zf=Math.max(Od-Zp,Zf),qd?XE(jg,Qp,Ng,vm,mp*eg/2):XE(jg,Qp,Ng,0,mp/2)),Od=0;const Mm=mp*eg+Ng;Ug.lineOffset=Math.max(Ng,Fg),md+=Mm,++Xf}var vg;const Yf=md,{horizontalAlign:Gf,verticalAlign:qg}=_E(Dp);(function(Qf,eg,Fg,Ug,jg,Ng){const im=(eg-Fg)*jg,vm=-Ng*Ug;for(const Mm of Qf)for(const kg of Mm.positionedGlyphs)kg.x+=im,kg.y+=vm})(jh.positionedLines,Qp,Gf,qg,Zf,Yf),jh.top+=-qg*Yf,jh.bottom=jh.top+Yf,jh.left+=-Gf*Zf,jh.right=jh.left+Zf,jh.hasBaseline=qd}(Hh,u,p,w,fh,_e,dt,ir,hs,Cr,rl,ul),!function(jh){for(const cp of jh)if(cp.positionedGlyphs.length!==0)return!1;return!0}(Bh)&&Hh}const DC={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},rT={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function WE(c,u,p,w,A,N){if(u.imageName){const _e=w[u.imageName];return _e?_e.displaySize[0]*u.scale*Ig/N+A:0}{const _e=p[u.fontStack],dt=_e&&_e.glyphs[c];return dt?dt.metrics.advance*u.scale+A:0}}function qE(c,u,p,w){const A=Math.pow(c-u,2);return w?c<u?A/2:2*A:A+Math.abs(p)*p}function iT(c,u,p){let w=0;return c===10&&(w-=1e4),p&&(w+=150),c!==40&&c!==65288||(w+=50),u!==41&&u!==65289||(w+=50),w}function KE(c,u,p,w,A,N){let _e=null,dt=qE(u,p,A,N);for(const ir of w){const Cr=qE(u-ir.x,p,A,N)+ir.badness;Cr<=dt&&(_e=ir,dt=Cr)}return{index:c,x:u,priorBreak:_e,badness:dt}}function ZE(c){return c?ZE(c.priorBreak).concat(c.index):[]}function _E(c){let u=.5,p=.5;switch(c){case"right":case"top-right":case"bottom-right":u=1;break;case"left":case"top-left":case"bottom-left":u=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":p=1;break;case"top":case"top-right":case"top-left":p=0}return{horizontalAlign:u,verticalAlign:p}}function XE(c,u,p,w,A){if(!(u||p||w||A))return;const N=c.length-1,_e=c[N],dt=(_e.x+_e.metrics.advance*_e.scale)*u;for(let ir=0;ir<=N;ir++)c[ir].x-=dt,c[ir].y+=p+w+A}function nT(c,u,p){const{horizontalAlign:w,verticalAlign:A}=_E(p),N=u[0]-c.displaySize[0]*w,_e=u[1]-c.displaySize[1]*A;return{image:c,top:_e,bottom:_e+c.displaySize[1],left:N,right:N+c.displaySize[0]}}function YE(c,u,p,w,A,N){const _e=c.image;let dt;if(_e.content){const fh=_e.content,Ch=_e.pixelRatio||1;dt=[fh[0]/Ch,fh[1]/Ch,_e.displaySize[0]-fh[2]/Ch,_e.displaySize[1]-fh[3]/Ch]}const ir=u.left*N,Cr=u.right*N;let Gn,hs,rl,ll;p==="width"||p==="both"?(ll=A[0]+ir-w[3],hs=A[0]+Cr+w[1]):(ll=A[0]+(ir+Cr-_e.displaySize[0])/2,hs=ll+_e.displaySize[0]);const ul=u.top*N,th=u.bottom*N;return p==="height"||p==="both"?(Gn=A[1]+ul-w[0],rl=A[1]+th+w[2]):(Gn=A[1]+(ul+th-_e.displaySize[1])/2,rl=Gn+_e.displaySize[1]),{image:_e,top:Gn,right:hs,bottom:rl,left:ll,collisionPadding:dt}}class Bx extends sl{constructor(u,p,w,A,N){super(u,p),this.angle=A,this.z=w,N!==void 0&&(this.segment=N)}clone(){return new Bx(this.x,this.y,this.z,this.angle,this.segment)}}function JE(c,u,p,w,A){if(u.segment===void 0)return!0;let N=u,_e=u.segment+1,dt=0;for(;dt>-p/2;){if(_e--,_e<0)return!1;dt-=c[_e].dist(N),N=c[_e]}dt+=c[_e].dist(c[_e+1]),_e++;const ir=[];let Cr=0;for(;dt<p/2;){const Gn=c[_e],hs=c[_e+1];if(!hs)return!1;let rl=c[_e-1].angleTo(Gn)-Gn.angleTo(hs);for(rl=Math.abs((rl+3*Math.PI)%(2*Math.PI)-Math.PI),ir.push({distance:dt,angleDelta:rl}),Cr+=rl;dt-ir[0].distance>w;)Cr-=ir.shift().angleDelta;if(Cr>A)return!1;_e++,dt+=Gn.dist(hs)}return!0}function QE(c){let u=0;for(let p=0;p<c.length-1;p++)u+=c[p].dist(c[p+1]);return u}function eS(c,u,p){return c?.6*u*p:0}function tS(c,u){return Math.max(c?c.right-c.left:0,u?u.right-u.left:0)}function oT(c,u,p,w,A,N){const _e=eS(p,A,N),dt=tS(p,w)*N;let ir=0;const Cr=QE(c)/2;for(let Gn=0;Gn<c.length-1;Gn++){const hs=c[Gn],rl=c[Gn+1],ll=hs.dist(rl);if(ir+ll>Cr){const ul=(Cr-ir)/ll,th=jd(hs.x,rl.x,ul),fh=jd(hs.y,rl.y,ul),Ch=new Bx(th,fh,0,rl.angleTo(hs),Gn);return!_e||JE(c,Ch,dt,_e,u)?Ch:void 0}ir+=ll}}function sT(c,u,p,w,A,N,_e,dt,ir){const Cr=eS(w,N,_e),Gn=tS(w,A),hs=Gn*_e,rl=c[0].x===0||c[0].x===ir||c[0].y===0||c[0].y===ir;return u-hs<u/4&&(u=hs+u/4),rS(c,rl?u/2*dt%u:(Gn/2+2*N)*_e*dt%u,u,Cr,p,hs,rl,!1,ir)}function rS(c,u,p,w,A,N,_e,dt,ir){const Cr=N/2,Gn=QE(c);let hs=0,rl=u-p,ll=[];for(let ul=0;ul<c.length-1;ul++){const th=c[ul],fh=c[ul+1],Ch=th.dist(fh),zh=fh.angleTo(th);for(;rl+p<hs+Ch;){rl+=p;const Eh=(rl-hs)/Ch,Bh=jd(th.x,fh.x,Eh),Hh=jd(th.y,fh.y,Eh);if(Bh>=0&&Bh<ir&&Hh>=0&&Hh<ir&&rl-Cr>=0&&rl+Cr<=Gn){const jh=new Bx(Bh,Hh,0,zh,ul);jh._round(),w&&!JE(c,jh,N,w,A)||ll.push(jh)}}hs+=Ch}return dt||ll.length||_e||(ll=rS(c,hs/2,p,w,A,N,_e,!0,ir)),ll}function iS(c,u,p,w,A){const N=[];for(let _e=0;_e<c.length;_e++){const dt=c[_e];let ir;for(let Cr=0;Cr<dt.length-1;Cr++){let Gn=dt[Cr],hs=dt[Cr+1];Gn.x<u&&hs.x<u||(Gn.x<u?Gn=new sl(u,Gn.y+(u-Gn.x)/(hs.x-Gn.x)*(hs.y-Gn.y))._round():hs.x<u&&(hs=new sl(u,Gn.y+(u-Gn.x)/(hs.x-Gn.x)*(hs.y-Gn.y))._round()),Gn.y<p&&hs.y<p||(Gn.y<p?Gn=new sl(Gn.x+(p-Gn.y)/(hs.y-Gn.y)*(hs.x-Gn.x),p)._round():hs.y<p&&(hs=new sl(Gn.x+(p-Gn.y)/(hs.y-Gn.y)*(hs.x-Gn.x),p)._round()),Gn.x>=w&&hs.x>=w||(Gn.x>=w?Gn=new sl(w,Gn.y+(w-Gn.x)/(hs.x-Gn.x)*(hs.y-Gn.y))._round():hs.x>=w&&(hs=new sl(w,Gn.y+(w-Gn.x)/(hs.x-Gn.x)*(hs.y-Gn.y))._round()),Gn.y>=A&&hs.y>=A||(Gn.y>=A?Gn=new sl(Gn.x+(A-Gn.y)/(hs.y-Gn.y)*(hs.x-Gn.x),A)._round():hs.y>=A&&(hs=new sl(Gn.x+(A-Gn.y)/(hs.y-Gn.y)*(hs.x-Gn.x),A)._round()),ir&&Gn.equals(ir[ir.length-1])||(ir=[Gn],N.push(ir)),ir.push(hs)))))}}return N}vs(Bx,"Anchor");const Pb=1e20;function nS(c,u,p,w,A,N,_e,dt,ir){for(let Cr=u;Cr<u+w;Cr++)oS(c,p*N+Cr,N,A,_e,dt,ir);for(let Cr=p;Cr<p+A;Cr++)oS(c,Cr*N+u,1,w,_e,dt,ir)}function oS(c,u,p,w,A,N,_e){N[0]=0,_e[0]=-Pb,_e[1]=Pb,A[0]=c[u];for(let dt=1,ir=0,Cr=0;dt<w;dt++){A[dt]=c[u+dt*p];const Gn=dt*dt;do{const hs=N[ir];Cr=(A[dt]-A[hs]+Gn-hs*hs)/(dt-hs)/2}while(Cr<=_e[ir]&&--ir>-1);ir++,N[ir]=dt,_e[ir]=Cr,_e[ir+1]=Pb}for(let dt=0,ir=0;dt<w;dt++){for(;_e[ir+1]<dt;)ir++;const Cr=N[ir],Gn=dt-Cr;c[u+dt*p]=A[Cr]+Gn*Gn}}const F0=2,vE={none:0,ideographs:1,all:2};class k1{constructor(u,p,w){this.requestManager=u,this.localGlyphMode=p,this.localFontFamily=w,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(u){this.url=u}getGlyphs(u,p){const w=[];for(const A in u)for(const N of u[A])w.push({stack:A,id:N});$p(w,({stack:A,id:N},_e)=>{let dt=this.entries[A];dt||(dt=this.entries[A]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let ir=dt.glyphs[N];if(ir!==void 0)return void _e(null,{stack:A,id:N,glyph:ir});if(ir=this._tinySDF(dt,A,N),ir)return dt.glyphs[N]=ir,void _e(null,{stack:A,id:N,glyph:ir});const Cr=Math.floor(N/256);if(256*Cr>65535)return void _e(new Error("glyphs > 65535 not supported"));if(dt.ranges[Cr])return void _e(null,{stack:A,id:N,glyph:ir});let Gn=dt.requests[Cr];Gn||(Gn=dt.requests[Cr]=[],k1.loadGlyphRange(A,Cr,this.url,this.requestManager,(hs,rl)=>{if(rl){dt.ascender=rl.ascender,dt.descender=rl.descender;for(const ll in rl.glyphs)this._doesCharSupportLocalGlyph(+ll)||(dt.glyphs[+ll]=rl.glyphs[+ll]);dt.ranges[Cr]=!0}for(const ll of Gn)ll(hs,rl);delete dt.requests[Cr]})),Gn.push((hs,rl)=>{hs?_e(hs):rl&&_e(null,{stack:A,id:N,glyph:rl.glyphs[N]||null})})},(A,N)=>{if(A)p(A);else if(N){const _e={};for(const{stack:dt,id:ir,glyph:Cr}of N)_e[dt]===void 0&&(_e[dt]={}),_e[dt].glyphs===void 0&&(_e[dt].glyphs={}),_e[dt].glyphs[ir]=Cr&&{id:Cr.id,bitmap:Cr.bitmap.clone(),metrics:Cr.metrics},_e[dt].ascender=this.entries[dt].ascender,_e[dt].descender=this.entries[dt].descender;p(null,_e)}})}_doesCharSupportLocalGlyph(u){return this.localGlyphMode!==vE.none&&(this.localGlyphMode===vE.all?!!this.localFontFamily:!!this.localFontFamily&&(hh["CJK Unified Ideographs"](u)||hh["Hangul Syllables"](u)||hh.Hiragana(u)||hh.Katakana(u)||hh["CJK Symbols and Punctuation"](u)))}_tinySDF(u,p,w){const A=this.localFontFamily;if(!A||!this._doesCharSupportLocalGlyph(w))return;let N=u.tinySDF;if(!N){let th="400";/bold/i.test(p)?th="900":/medium/i.test(p)?th="500":/light/i.test(p)&&(th="200"),N=u.tinySDF=new k1.TinySDF({fontFamily:A,fontWeight:th,fontSize:24*F0,buffer:3*F0,radius:8*F0}),N.fontWeight=th}if(this.localGlyphs[N.fontWeight][w])return this.localGlyphs[N.fontWeight][w];const _e=String.fromCharCode(w),{data:dt,width:ir,height:Cr,glyphWidth:Gn,glyphHeight:hs,glyphLeft:rl,glyphTop:ll,glyphAdvance:ul}=N.draw(_e);return this.localGlyphs[N.fontWeight][w]={id:w,bitmap:new t0({width:ir,height:Cr},dt),metrics:{width:Gn/F0,height:hs/F0,left:rl/F0,top:ll/F0-27,advance:ul/F0,localGlyph:!0}}}}k1.loadGlyphRange=function(c,u,p,w,A){const N=256*u,_e=N+255,dt=w.transformRequest(w.normalizeGlyphsURL(p).replace("{fontstack}",c).replace("{range}",`${N}-${_e}`),nd.Glyphs);ng(dt,(ir,Cr)=>{if(ir)A(ir);else if(Cr){const Gn={},hs=function(rl){return new O1(rl).readFields(L1,{})}(Cr);for(const rl of hs.glyphs)Gn[rl.id]=rl;A(null,{glyphs:Gn,ascender:hs.ascender,descender:hs.descender})}})},k1.TinySDF=class{constructor({fontSize:c=24,buffer:u=3,radius:p=8,cutoff:w=.25,fontFamily:A="sans-serif",fontWeight:N="normal",fontStyle:_e="normal"}={}){this.buffer=u,this.cutoff=w,this.radius=p;const dt=this.size=c+4*u,ir=this._createCanvas(dt),Cr=this.ctx=ir.getContext("2d",{willReadFrequently:!0});Cr.font=`${_e} ${N} ${c}px ${A}`,Cr.textBaseline="alphabetic",Cr.textAlign="left",Cr.fillStyle="black",this.gridOuter=new Float64Array(dt*dt),this.gridInner=new Float64Array(dt*dt),this.f=new Float64Array(dt),this.z=new Float64Array(dt+1),this.v=new Uint16Array(dt)}_createCanvas(c){const u=document.createElement("canvas");return u.width=u.height=c,u}draw(c){const{width:u,actualBoundingBoxAscent:p,actualBoundingBoxDescent:w,actualBoundingBoxLeft:A,actualBoundingBoxRight:N}=this.ctx.measureText(c),_e=Math.ceil(p),dt=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(N-A))),ir=Math.min(this.size-this.buffer,_e+Math.ceil(w)),Cr=dt+2*this.buffer,Gn=ir+2*this.buffer,hs=Math.max(Cr*Gn,0),rl=new Uint8ClampedArray(hs),ll={data:rl,width:Cr,height:Gn,glyphWidth:dt,glyphHeight:ir,glyphTop:_e,glyphLeft:0,glyphAdvance:u};if(dt===0||ir===0)return ll;const{ctx:ul,buffer:th,gridInner:fh,gridOuter:Ch}=this;ul.clearRect(th,th,dt,ir),ul.fillText(c,th,th+_e);const zh=ul.getImageData(th,th,dt,ir);Ch.fill(Pb,0,hs),fh.fill(0,0,hs);for(let Eh=0;Eh<ir;Eh++)for(let Bh=0;Bh<dt;Bh++){const Hh=zh.data[4*(Eh*dt+Bh)+3]/255;if(Hh===0)continue;const jh=(Eh+th)*Cr+Bh+th;if(Hh===1)Ch[jh]=0,fh[jh]=Pb;else{const cp=.5-Hh;Ch[jh]=cp>0?cp*cp:0,fh[jh]=cp<0?cp*cp:0}}nS(Ch,0,0,Cr,Gn,Cr,this.f,this.v,this.z),nS(fh,th,th,dt,ir,Cr,this.f,this.v,this.z);for(let Eh=0;Eh<hs;Eh++){const Bh=Math.sqrt(Ch[Eh])-Math.sqrt(fh[Eh]);rl[Eh]=Math.round(255-255*(Bh/this.radius+this.cutoff))}return ll}};const B1=Hm;function sS(c,u,p,w){const A=[],N=c.image,_e=N.pixelRatio,dt=N.paddedRect.w-2*B1,ir=N.paddedRect.h-2*B1,Cr=c.right-c.left,Gn=c.bottom-c.top,hs=N.stretchX||[[0,dt]],rl=N.stretchY||[[0,ir]],ll=(mp,Dp)=>mp+Dp[1]-Dp[0],ul=hs.reduce(ll,0),th=rl.reduce(ll,0),fh=dt-ul,Ch=ir-th;let zh=0,Eh=ul,Bh=0,Hh=th,jh=0,cp=fh,sp=0,Sp=Ch;if(N.content&&w){const mp=N.content;zh=OC(hs,0,mp[0]),Bh=OC(rl,0,mp[1]),Eh=OC(hs,mp[0],mp[2]),Hh=OC(rl,mp[1],mp[3]),jh=mp[0]-zh,sp=mp[1]-Bh,cp=mp[2]-mp[0]-Eh,Sp=mp[3]-mp[1]-Hh}const Hp=(mp,Dp,Op,zp)=>{const Zp=LC(mp.stretch-zh,Eh,Cr,c.left),xp=FC(mp.fixed-jh,cp,mp.stretch,ul),pd=LC(Dp.stretch-Bh,Hh,Gn,c.top),Od=FC(Dp.fixed-sp,Sp,Dp.stretch,th),md=LC(Op.stretch-zh,Eh,Cr,c.left),Zf=FC(Op.fixed-jh,cp,Op.stretch,ul),Qp=LC(zp.stretch-Bh,Hh,Gn,c.top),qd=FC(zp.fixed-sp,Sp,zp.stretch,th),Xf=new sl(Zp,pd),vg=new sl(md,pd),Yf=new sl(md,Qp),Gf=new sl(Zp,Qp),qg=new sl(xp/_e,Od/_e),Qf=new sl(Zf/_e,qd/_e),eg=u*Math.PI/180;if(eg){const jg=Math.sin(eg),Ng=Math.cos(eg),im=[Ng,-jg,jg,Ng];Xf._matMult(im),vg._matMult(im),Gf._matMult(im),Yf._matMult(im)}const Fg=mp.stretch+mp.fixed,Ug=Dp.stretch+Dp.fixed;return{tl:Xf,tr:vg,bl:Gf,br:Yf,tex:{x:N.paddedRect.x+B1+Fg,y:N.paddedRect.y+B1+Ug,w:Op.stretch+Op.fixed-Fg,h:zp.stretch+zp.fixed-Ug},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:qg,pixelOffsetBR:Qf,minFontScaleX:cp/_e/Cr,minFontScaleY:Sp/_e/Gn,isSDF:p}};if(w&&(N.stretchX||N.stretchY)){const mp=aS(hs,fh,ul),Dp=aS(rl,Ch,th);for(let Op=0;Op<mp.length-1;Op++){const zp=mp[Op],Zp=mp[Op+1];for(let xp=0;xp<Dp.length-1;xp++)A.push(Hp(zp,Dp[xp],Zp,Dp[xp+1]))}}else A.push(Hp({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:dt+1},{fixed:0,stretch:ir+1}));return A}function OC(c,u,p){let w=0;for(const A of c)w+=Math.max(u,Math.min(p,A[1]))-Math.max(u,Math.min(p,A[0]));return w}function aS(c,u,p){const w=[{fixed:-B1,stretch:0}];for(const[A,N]of c){const _e=w[w.length-1];w.push({fixed:A-_e.stretch,stretch:_e.stretch}),w.push({fixed:A-_e.stretch,stretch:_e.stretch+(N-A)})}return w.push({fixed:u+B1,stretch:p}),w}function LC(c,u,p,w){return c/u*p+w}function FC(c,u,p,w){return c-u*p/w}function aT(c,u,p,w){const A=u+c.positionedLines[w].lineOffset;return w===0?p+A/2:p+(A+(u+c.positionedLines[w-1].lineOffset))/2}class lT{constructor(u=[],p=uT){if(this.data=u,this.length=this.data.length,this.compare=p,this.length>0)for(let w=(this.length>>1)-1;w>=0;w--)this._down(w)}push(u){this.data.push(u),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const u=this.data[0],p=this.data.pop();return this.length--,this.length>0&&(this.data[0]=p,this._down(0)),u}peek(){return this.data[0]}_up(u){const{data:p,compare:w}=this,A=p[u];for(;u>0;){const N=u-1>>1,_e=p[N];if(w(A,_e)>=0)break;p[u]=_e,u=N}p[u]=A}_down(u){const{data:p,compare:w}=this,A=this.length>>1,N=p[u];for(;u<A;){let _e=1+(u<<1),dt=p[_e];const ir=_e+1;if(ir<this.length&&w(p[ir],dt)<0&&(_e=ir,dt=p[ir]),w(dt,N)>=0)break;p[u]=dt,u=_e}p[u]=N}}function uT(c,u){return c<u?-1:c>u?1:0}function cT(c,u=1,p=!1){let w=1/0,A=1/0,N=-1/0,_e=-1/0;const dt=c[0];for(let ll=0;ll<dt.length;ll++){const ul=dt[ll];(!ll||ul.x<w)&&(w=ul.x),(!ll||ul.y<A)&&(A=ul.y),(!ll||ul.x>N)&&(N=ul.x),(!ll||ul.y>_e)&&(_e=ul.y)}const ir=Math.min(N-w,_e-A);let Cr=ir/2;const Gn=new lT([],hT);if(ir===0)return new sl(w,A);for(let ll=w;ll<N;ll+=ir)for(let ul=A;ul<_e;ul+=ir)Gn.push(new z1(ll+Cr,ul+Cr,Cr,c));let hs=function(ll){let ul=0,th=0,fh=0;const Ch=ll[0];for(let zh=0,Eh=Ch.length,Bh=Eh-1;zh<Eh;Bh=zh++){const Hh=Ch[zh],jh=Ch[Bh],cp=Hh.x*jh.y-jh.x*Hh.y;th+=(Hh.x+jh.x)*cp,fh+=(Hh.y+jh.y)*cp,ul+=3*cp}return new z1(th/ul,fh/ul,0,ll)}(c),rl=Gn.length;for(;Gn.length;){const ll=Gn.pop();(ll.d>hs.d||!hs.d)&&(hs=ll,p&&console.log("found best %d after %d probes",Math.round(1e4*ll.d)/1e4,rl)),ll.max-hs.d<=u||(Cr=ll.h/2,Gn.push(new z1(ll.p.x-Cr,ll.p.y-Cr,Cr,c)),Gn.push(new z1(ll.p.x+Cr,ll.p.y-Cr,Cr,c)),Gn.push(new z1(ll.p.x-Cr,ll.p.y+Cr,Cr,c)),Gn.push(new z1(ll.p.x+Cr,ll.p.y+Cr,Cr,c)),rl+=4)}return p&&(console.log(`num probes: ${rl}`),console.log(`best distance: ${hs.d}`)),hs.p}function hT(c,u){return u.max-c.max}class z1{constructor(u,p,w,A){this.p=new sl(u,p),this.h=w,this.d=function(N,_e){let dt=!1,ir=1/0;for(let Cr=0;Cr<_e.length;Cr++){const Gn=_e[Cr];for(let hs=0,rl=Gn.length,ll=rl-1;hs<rl;ll=hs++){const ul=Gn[hs],th=Gn[ll];ul.y>N.y!=th.y>N.y&&N.x<(th.x-ul.x)*(N.y-ul.y)/(th.y-ul.y)+ul.x&&(dt=!dt),ir=Math.min(ir,v1(N,ul,th))}}return(dt?1:-1)*Math.sqrt(ir)}(this.p,A),this.max=this.d+this.h*Math.SQRT2}}const G1=7,xE=Number.POSITIVE_INFINITY,pT=Math.sqrt(2);function lS(c,[u,p]){let w=0,A=0;if(p===xE){u<0&&(u=0);const N=u/pT;switch(c){case"top-right":case"top-left":A=N-G1;break;case"bottom-right":case"bottom-left":A=-N+G1;break;case"bottom":A=-u+G1;break;case"top":A=u-G1}switch(c){case"top-right":case"bottom-right":w=-N;break;case"top-left":case"bottom-left":w=N;break;case"left":w=u;break;case"right":w=-u}}else{switch(u=Math.abs(u),p=Math.abs(p),c){case"top-right":case"top-left":case"top":A=p-G1;break;case"bottom-right":case"bottom-left":case"bottom":A=-p+G1}switch(c){case"top-right":case"bottom-right":case"right":w=-u;break;case"top-left":case"bottom-left":case"left":w=u}}return[w,A]}function dT(c,u,p,w,A,N,_e,dt,ir,Cr){c.createArrays(),c.tilePixelRatio=Hd/(512*c.overscaling),c.compareText={},c.iconsNeedLinear=!1;const Gn=c.layers[0].layout,hs=c.layers[0]._unevaluatedLayout._values,rl={};if(c.textSizeData.kind==="composite"){const{minZoom:th,maxZoom:fh}=c.textSizeData;rl.compositeTextSizes=[hs["text-size"].possiblyEvaluate(new Vn(th),dt),hs["text-size"].possiblyEvaluate(new Vn(fh),dt)]}if(c.iconSizeData.kind==="composite"){const{minZoom:th,maxZoom:fh}=c.iconSizeData;rl.compositeIconSizes=[hs["icon-size"].possiblyEvaluate(new Vn(th),dt),hs["icon-size"].possiblyEvaluate(new Vn(fh),dt)]}rl.layoutTextSize=hs["text-size"].possiblyEvaluate(new Vn(ir+1),dt),rl.layoutIconSize=hs["icon-size"].possiblyEvaluate(new Vn(ir+1),dt),rl.textMaxSize=hs["text-size"].possiblyEvaluate(new Vn(18),dt);const ll=Gn.get("text-rotation-alignment")==="map"&&Gn.get("symbol-placement")!=="point",ul=Gn.get("text-size");for(const th of c.features){const fh=Gn.get("text-font").evaluate(th,{},dt).join(","),Ch=ul.evaluate(th,{},dt),zh=rl.layoutTextSize.evaluate(th,{},dt),Eh=(rl.layoutIconSize.evaluate(th,{},dt),{horizontal:{},vertical:void 0}),Bh=th.text;let Hh,jh=[0,0];if(Bh){const Sp=Bh.toString(),Hp=Gn.get("text-letter-spacing").evaluate(th,{},dt)*Ig,mp=Gn.get("text-line-height").evaluate(th,{},dt)*Ig,Dp=Gh(Sp)?Hp:0,Op=Gn.get("text-anchor").evaluate(th,{},dt),zp=Gn.get("text-variable-anchor");if(!zp){const md=Gn.get("text-radial-offset").evaluate(th,{},dt);jh=md?lS(Op,[md*Ig,xE]):Gn.get("text-offset").evaluate(th,{},dt).map(Zf=>Zf*Ig)}let Zp=ll?"center":Gn.get("text-justify").evaluate(th,{},dt);const xp=Gn.get("symbol-placement")==="point",pd=xp?Gn.get("text-max-width").evaluate(th,{},dt)*Ig:1/0,Od=md=>{c.allowVerticalPlacement&&Rh(Sp)&&(Eh.vertical=yE(Bh,u,p,A,fh,pd,mp,Op,md,Dp,jh,vv.vertical,!0,zh,Ch))};if(!ll&&zp){const md=Zp==="auto"?zp.map(Qp=>wE(Qp)):[Zp];let Zf=!1;for(let Qp=0;Qp<md.length;Qp++){const qd=md[Qp];if(!Eh.horizontal[qd])if(Zf)Eh.horizontal[qd]=Eh.horizontal[0];else{const Xf=yE(Bh,u,p,A,fh,pd,mp,"center",qd,Dp,jh,vv.horizontal,!1,zh,Ch);Xf&&(Eh.horizontal[qd]=Xf,Zf=Xf.positionedLines.length===1)}}Od("left")}else{if(Zp==="auto"&&(Zp=wE(Op)),xp||Gn.get("text-writing-mode").indexOf("horizontal")>=0||!Rh(Sp)){const md=yE(Bh,u,p,A,fh,pd,mp,Op,Zp,Dp,jh,vv.horizontal,!1,zh,Ch);md&&(Eh.horizontal[Zp]=md)}Od(xp?"left":Zp)}}let cp=!1;if(th.icon&&th.icon.name){const Sp=w[th.icon.name];Sp&&(Hh=nT(A[th.icon.name],Gn.get("icon-offset").evaluate(th,{},dt),Gn.get("icon-anchor").evaluate(th,{},dt)),cp=Sp.sdf,c.sdfIcons===void 0?c.sdfIcons=Sp.sdf:c.sdfIcons!==Sp.sdf&&Ap("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Sp.pixelRatio!==c.pixelRatio||Gn.get("icon-rotate").constantOr(1)!==0)&&(c.iconsNeedLinear=!0))}const sp=cS(Eh.horizontal)||Eh.vertical;c.iconsInText||(c.iconsInText=!!sp&&sp.iconsInText),(sp||Hh)&&fT(c,th,Eh,Hh,w,rl,zh,0,jh,cp,_e,dt,Cr)}N&&c.generateCollisionDebugBuffers(ir,c.collisionBoxArray)}function wE(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function fT(c,u,p,w,A,N,_e,dt,ir,Cr,Gn,hs,rl){let ll=N.textMaxSize.evaluate(u,{},hs);ll===void 0&&(ll=_e);const ul=c.layers[0].layout,th=ul.get("icon-offset").evaluate(u,{},hs),fh=cS(p.horizontal)||p.vertical,Ch=rl.name==="globe",zh=Ig,Eh=_e/zh,Bh=c.tilePixelRatio*ll/zh,Hh=(Op=c.overscaling,c.zoom>18&&Op>2&&(Op>>=1),Math.max(Hd/(512*Op),1)*ul.get("symbol-spacing")),jh=ul.get("text-padding")*c.tilePixelRatio,cp=ul.get("icon-padding")*c.tilePixelRatio,sp=rh(ul.get("text-max-angle")),Sp=ul.get("text-rotation-alignment")==="map"&&ul.get("symbol-placement")!=="point",Hp=ul.get("icon-rotation-alignment")==="map"&&ul.get("symbol-placement")!=="point",mp=ul.get("symbol-placement"),Dp=Hh/2;var Op;const zp=ul.get("icon-text-fit");let Zp;w&&zp!=="none"&&(c.allowVerticalPlacement&&p.vertical&&(Zp=YE(w,p.vertical,zp,ul.get("icon-text-fit-padding"),th,Eh)),fh&&(w=YE(w,fh,zp,ul.get("icon-text-fit-padding"),th,Eh)));const xp=(pd,Od,md)=>{if(Od.x<0||Od.x>=Hd||Od.y<0||Od.y>=Hd)return;let Zf=null;if(Ch){const{x:Qp,y:qd,z:Xf}=rl.projectTilePoint(Od.x,Od.y,md);Zf={anchor:new Bx(Qp,qd,Xf,0,void 0),up:rl.upVector(md,Od.x,Od.y)}}(function(Qp,qd,Xf,vg,Yf,Gf,qg,Qf,eg,Fg,Ug,jg,Ng,im,vm,Mm,kg,Gm,Dm,cm,wg,Om,Hg,Hy,Lm){const dy=Qp.addToLineVertexArray(qd,vg);let iy,Wy,ny,k0,U1,zb,Gb,jS=0,HS=0,WS=0,qS=0,NE=-1,kE=-1;const vx={};let KS=o1("");const e1=Xf?Xf.anchor:qd;let BE=0,zE=0;if(eg._unevaluatedLayout.getValue("text-radial-offset")===void 0?[BE,zE]=eg.layout.get("text-offset").evaluate(wg,{},Lm).map(F_=>F_*Ig):(BE=eg.layout.get("text-radial-offset").evaluate(wg,{},Lm)*Ig,zE=xE),Qp.allowVerticalPlacement&&Yf.vertical){const F_=Yf.vertical;if(vm)zb=bE(F_),Qf&&(Gb=bE(Qf));else{const N_=eg.layout.get("text-rotate").evaluate(wg,{},Lm)+90;ny=NC(Fg,e1,qd,Ug,jg,Ng,F_,im,N_,Mm),Qf&&(k0=NC(Fg,e1,qd,Ug,jg,Ng,Qf,Gm,N_))}}if(Gf){const F_=eg.layout.get("icon-rotate").evaluate(wg,{},Lm),N_=eg.layout.get("icon-text-fit")!=="none",Vb=sS(Gf,F_,Hg,N_),VE=Qf?sS(Qf,F_,Hg,N_):void 0;Wy=NC(Fg,e1,qd,Ug,jg,Ng,Gf,Gm,F_),jS=4*Vb.length;const ZS=Qp.iconSizeData;let t1=null;ZS.kind==="source"?(t1=[rm*eg.layout.get("icon-size").evaluate(wg,{},Lm)],t1[0]>pw&&Ap(`${Qp.layerIds[0]}: Value for "icon-size" is >= ${Mb}. Reduce your "icon-size".`)):ZS.kind==="composite"&&(t1=[rm*Om.compositeIconSizes[0].evaluate(wg,{},Lm),rm*Om.compositeIconSizes[1].evaluate(wg,{},Lm)],(t1[0]>pw||t1[1]>pw)&&Ap(`${Qp.layerIds[0]}: Value for "icon-size" is >= ${Mb}. Reduce your "icon-size".`)),Qp.addSymbols(Qp.icon,Vb,t1,cm,Dm,wg,!1,Xf,qd,dy.lineStartIndex,dy.lineLength,-1,Hy,Lm),NE=Qp.icon.placedSymbolArray.length-1,VE&&(HS=4*VE.length,Qp.addSymbols(Qp.icon,VE,t1,cm,Dm,wg,vv.vertical,Xf,qd,dy.lineStartIndex,dy.lineLength,-1,Hy,Lm),kE=Qp.icon.placedSymbolArray.length-1)}for(const F_ in Yf.horizontal){const N_=Yf.horizontal[F_];iy||(KS=o1(N_.text),vm?U1=bE(N_):iy=NC(Fg,e1,qd,Ug,jg,Ng,N_,im,eg.layout.get("text-rotate").evaluate(wg,{},Lm),Mm));const Vb=N_.positionedLines.length===1;if(WS+=uS(Qp,Xf,qd,N_,qg,eg,vm,wg,Mm,dy,Yf.vertical?vv.horizontal:vv.horizontalOnly,Vb?Object.keys(Yf.horizontal):[F_],vx,NE,Om,Hy,Lm),Vb)break}Yf.vertical&&(qS+=uS(Qp,Xf,qd,Yf.vertical,qg,eg,vm,wg,Mm,dy,vv.vertical,["vertical"],vx,kE,Om,Hy,Lm));let _w=-1;const GE=(F_,N_)=>F_?Math.max(F_,N_):N_;_w=GE(U1,_w),_w=GE(zb,_w),_w=GE(Gb,_w);const $T=_w>-1?1:0;Qp.glyphOffsetArray.length>=fw.MAX_GLYPHS&&Ap("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),wg.sortKey!==void 0&&Qp.addToSortKeyRanges(Qp.symbolInstances.length,wg.sortKey),Qp.symbolInstances.emplaceBack(e1.x,e1.y,e1.z,qd.x,qd.y,vx.right>=0?vx.right:-1,vx.center>=0?vx.center:-1,vx.left>=0?vx.left:-1,vx.vertical>=0?vx.vertical:-1,NE,kE,KS,iy!==void 0?iy:Qp.collisionBoxArray.length,iy!==void 0?iy+1:Qp.collisionBoxArray.length,ny!==void 0?ny:Qp.collisionBoxArray.length,ny!==void 0?ny+1:Qp.collisionBoxArray.length,Wy!==void 0?Wy:Qp.collisionBoxArray.length,Wy!==void 0?Wy+1:Qp.collisionBoxArray.length,k0||Qp.collisionBoxArray.length,k0?k0+1:Qp.collisionBoxArray.length,Ug,WS,qS,jS,HS,$T,0,BE,zE,_w)})(c,Od,Zf,pd,p,w,A,Zp,c.layers[0],c.collisionBoxArray,u.index,u.sourceLayerIndex,c.index,jh,Sp,ir,0,cp,Hp,th,u,N,Cr,Gn,hs)};if(mp==="line")for(const pd of iS(u.geometry,0,0,Hd,Hd)){const Od=sT(pd,Hh,sp,p.vertical||fh,w,zh,Bh,c.overscaling,Hd);for(const md of Od)fh&&gT(c,fh.text,Dp,md)||xp(pd,md,hs)}else if(mp==="line-center"){for(const pd of u.geometry)if(pd.length>1){const Od=oT(pd,sp,p.vertical||fh,w,zh,Bh);Od&&xp(pd,Od,hs)}}else if(u.type==="Polygon")for(const pd of Kw(u.geometry,0)){const Od=cT(pd,16);xp(pd[0],new Bx(Od.x,Od.y,0,0,void 0),hs)}else if(u.type==="LineString")for(const pd of u.geometry)xp(pd,new Bx(pd[0].x,pd[0].y,0,0,void 0),hs);else if(u.type==="Point")for(const pd of u.geometry)for(const Od of pd)xp([Od],new Bx(Od.x,Od.y,0,0,void 0),hs)}const Mb=255,pw=Mb*rm;function uS(c,u,p,w,A,N,_e,dt,ir,Cr,Gn,hs,rl,ll,ul,th,fh){const Ch=function(Bh,Hh,jh,cp,sp,Sp,Hp,mp){const Dp=[];if(Hh.positionedLines.length===0)return Dp;const Op=cp.layout.get("text-rotate").evaluate(Sp,{})*Math.PI/180,zp=function(md){const Zf=md[0],Qp=md[1],qd=Zf*Qp;return qd>0?[Zf,-Qp]:qd<0?[-Zf,Qp]:Zf===0?[Qp,Zf]:[Qp,-Zf]}(jh);let Zp=Math.abs(Hh.top-Hh.bottom);for(const md of Hh.positionedLines)Zp-=md.lineOffset;const xp=Hh.positionedLines.length,pd=Zp/xp;let Od=Hh.top-jh[1];for(let md=0;md<xp;++md){const Zf=Hh.positionedLines[md];Od=aT(Hh,pd,Od,md);for(const Qp of Zf.positionedGlyphs){if(!Qp.rect)continue;const qd=Qp.rect||{};let Xf=_v+1,vg=!0,Yf=1,Gf=0;if(Qp.imageName){const Hg=Hp[Qp.imageName];if(!Hg)continue;if(Hg.sdf){Ap("SDF images are not supported in formatted text and will be ignored.");continue}vg=!1,Yf=Hg.pixelRatio,Xf=Hm/Yf}const qg=(sp||mp)&&Qp.vertical,Qf=Qp.metrics.advance*Qp.scale/2,eg=Qp.metrics,Fg=Qp.rect;if(Fg===null)continue;mp&&Hh.verticalizable&&(Gf=Qp.imageName?Qf-Qp.metrics.width*Qp.scale/2:0);const Ug=sp?[Qp.x+Qf,Qp.y]:[0,0];let jg=[0,0],Ng=[0,0],im=!1;sp||(qg?(Ng=[Qp.x+Qf+zp[0],Qp.y+zp[1]-Gf],im=!0):jg=[Qp.x+Qf+jh[0],Qp.y+jh[1]-Gf]);const vm=Fg.w*Qp.scale/(Yf*(Qp.localGlyph?F0:1)),Mm=Fg.h*Qp.scale/(Yf*(Qp.localGlyph?F0:1));let kg,Gm,Dm,cm;if(qg){const Hg=Qp.y-Od,Hy=new sl(-Qf,Qf-Hg),Lm=-Math.PI/2,dy=new sl(...Ng);kg=new sl(-Qf+jg[0],jg[1]),kg._rotateAround(Lm,Hy)._add(dy),kg.x+=-Hg+Qf,kg.y-=(eg.left-Xf)*Qp.scale;const iy=Qp.imageName?eg.advance*Qp.scale:Ig*Qp.scale,Wy=String.fromCharCode(Qp.glyph);O_(Wy)?kg.x+=(1-Xf)*Qp.scale:yv(Wy)?kg.x+=iy-eg.height*Qp.scale+(-Xf-1)*Qp.scale:kg.x+=Qp.imageName||eg.width+2*Xf===Fg.w&&eg.height+2*Xf===Fg.h?(iy-Mm)/2:(iy-(eg.height+2*Xf)*Qp.scale)/2,Gm=new sl(kg.x,kg.y-vm),Dm=new sl(kg.x+Mm,kg.y),cm=new sl(kg.x+Mm,kg.y-vm)}else{const Hg=(eg.left-Xf)*Qp.scale-Qf+jg[0],Hy=(-eg.top-Xf)*Qp.scale+jg[1],Lm=Hg+vm,dy=Hy+Mm;kg=new sl(Hg,Hy),Gm=new sl(Lm,Hy),Dm=new sl(Hg,dy),cm=new sl(Lm,dy)}if(Op){let Hg;Hg=sp?new sl(0,0):im?new sl(zp[0],zp[1]):new sl(jh[0],jh[1]),kg._rotateAround(Op,Hg),Gm._rotateAround(Op,Hg),Dm._rotateAround(Op,Hg),cm._rotateAround(Op,Hg)}const wg=new sl(0,0),Om=new sl(0,0);Dp.push({tl:kg,tr:Gm,bl:Dm,br:cm,tex:qd,writingMode:Hh.writingMode,glyphOffset:Ug,sectionIndex:Qp.sectionIndex,isSDF:vg,pixelOffsetTL:wg,pixelOffsetBR:Om,minFontScaleX:0,minFontScaleY:0})}}return Dp}(0,w,ir,N,_e,dt,A,c.allowVerticalPlacement),zh=c.textSizeData;let Eh=null;zh.kind==="source"?(Eh=[rm*N.layout.get("text-size").evaluate(dt,{},fh)],Eh[0]>pw&&Ap(`${c.layerIds[0]}: Value for "text-size" is >= ${Mb}. Reduce your "text-size".`)):zh.kind==="composite"&&(Eh=[rm*ul.compositeTextSizes[0].evaluate(dt,{},fh),rm*ul.compositeTextSizes[1].evaluate(dt,{},fh)],(Eh[0]>pw||Eh[1]>pw)&&Ap(`${c.layerIds[0]}: Value for "text-size" is >= ${Mb}. Reduce your "text-size".`)),c.addSymbols(c.text,Ch,Eh,ir,_e,dt,Gn,u,p,Cr.lineStartIndex,Cr.lineLength,ll,th,fh);for(const Bh of hs)rl[Bh]=c.text.placedSymbolArray.length-1;return 4*Ch.length}function cS(c){for(const u in c)return c[u];return null}function NC(c,u,p,w,A,N,_e,dt,ir,Cr){let Gn=_e.top,hs=_e.bottom,rl=_e.left,ll=_e.right;const ul=_e.collisionPadding;if(ul&&(rl-=ul[0],Gn-=ul[1],ll+=ul[2],hs+=ul[3]),ir){const th=new sl(rl,Gn),fh=new sl(ll,Gn),Ch=new sl(rl,hs),zh=new sl(ll,hs),Eh=rh(ir);let Bh=new sl(0,0);Cr&&(Bh=new sl(Cr[0],Cr[1])),th._rotateAround(Eh,Bh),fh._rotateAround(Eh,Bh),Ch._rotateAround(Eh,Bh),zh._rotateAround(Eh,Bh),rl=Math.min(th.x,fh.x,Ch.x,zh.x),ll=Math.max(th.x,fh.x,Ch.x,zh.x),Gn=Math.min(th.y,fh.y,Ch.y,zh.y),hs=Math.max(th.y,fh.y,Ch.y,zh.y)}return c.emplaceBack(u.x,u.y,u.z,p.x,p.y,rl,Gn,ll,hs,dt,w,A,N),c.length-1}function bE(c){c.collisionPadding&&(c.top-=c.collisionPadding[1],c.bottom+=c.collisionPadding[3]);const u=c.bottom-c.top;return u>0?Math.max(10,u):null}function gT(c,u,p,w){const A=c.compareText;if(u in A){const N=A[u];for(let _e=N.length-1;_e>=0;_e--)if(w.dist(N[_e])<p)return!0}else A[u]=[];return A[u].push(w),!1}function hS(c,u){const p=c.fovAboveCenter,w=c.elevation?c.elevation.getMinElevationBelowMSL()*u:0,A=(c._camera.position[2]*c.worldSize-w)/Math.cos(c._pitch),N=Math.sin(p)*A/Math.sin(Math.max(Math.PI/2-c._pitch-p,.01)),_e=Math.sin(c._pitch)*N+A;return Math.min(1.01*_e,A*(1/c._horizonShift))}function Jw(c,u){if(!u.isReprojectedInTileSpace)return{scale:1<<c.z,x:c.x,y:c.y,x2:c.x+1,y2:c.y+1,projection:u};const p=Math.pow(2,-c.z),w=c.x*p,A=(c.x+1)*p,N=c.y*p,_e=(c.y+1)*p,dt=zm(w),ir=zm(A),Cr=bm(N),Gn=bm(_e),hs=u.project(dt,Cr),rl=u.project(ir,Cr),ll=u.project(ir,Gn),ul=u.project(dt,Gn);let th=Math.min(hs.x,rl.x,ll.x,ul.x),fh=Math.min(hs.y,rl.y,ll.y,ul.y),Ch=Math.max(hs.x,rl.x,ll.x,ul.x),zh=Math.max(hs.y,rl.y,ll.y,ul.y);const Eh=p/16;function Bh(jh,cp,sp,Sp,Hp,mp){const Dp=(sp+Hp)/2,Op=(Sp+mp)/2,zp=u.project(zm(Dp),bm(Op)),Zp=Math.max(0,th-zp.x,fh-zp.y,zp.x-Ch,zp.y-zh);th=Math.min(th,zp.x),Ch=Math.max(Ch,zp.x),fh=Math.min(fh,zp.y),zh=Math.max(zh,zp.y),Zp>Eh&&(Bh(jh,zp,sp,Sp,Dp,Op),Bh(zp,cp,Dp,Op,Hp,mp))}Bh(hs,rl,w,N,A,N),Bh(rl,ll,A,N,A,_e),Bh(ll,ul,A,_e,w,_e),Bh(ul,hs,w,_e,w,N),th-=Eh,fh-=Eh,Ch+=Eh,zh+=Eh;const Hh=1/Math.max(Ch-th,zh-fh);return{scale:Hh,x:th*Hh,y:fh*Hh,x2:Ch*Hh,y2:zh*Hh,projection:u}}const mT=pv(new Float32Array(16));class dw{constructor(u){this.spec=u,this.name=u.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(u,p){return{x:0,y:0,z:0}}unproject(u,p){return new Rg(0,0)}projectTilePoint(u,p,w){return{x:u,y:p,z:0}}locationPoint(u,p,w=!0){return u._coordinatePoint(u.locationCoordinate(p),w)}pixelsPerMeter(u,p){return D_(1,u)*p}pixelSpaceConversion(u,p,w){return 1}farthestPixelDistance(u){return hS(u,u.pixelsPerMeter)}pointCoordinate(u,p,w,A){const N=u.horizonLineFromTop(!1),_e=new sl(p,Math.max(N,w));return u.rayIntersectionCoordinate(u.pointRayIntersection(_e,A))}pointCoordinate3D(u,p,w){const A=new sl(p,w);if(u.elevation)return u.elevation.pointCoordinate(A);{const N=this.pointCoordinate(u,A.x,A.y,0);return[N.x,N.y,N.z]}}isPointAboveHorizon(u,p){if(u.elevation)return!this.pointCoordinate3D(u,p.x,p.y);const w=u.horizonLineFromTop();return p.y<w}createInversionMatrix(u,p){return mT}createTileMatrix(u,p,w){let A,N,_e;const dt=w.canonical,ir=pv(new Float64Array(16));if(this.isReprojectedInTileSpace){const Cr=Jw(dt,this);A=1,N=Cr.x+w.wrap*Cr.scale,_e=Cr.y,S0(ir,ir,[A/Cr.scale,A/Cr.scale,u.pixelsPerMeter/p])}else A=p/u.zoomScale(dt.z),N=(dt.x+Math.pow(2,dt.z)*w.wrap)*A,_e=dt.y*A;return Px(ir,ir,[N,_e,0]),S0(ir,ir,[A/Hd,A/Hd,1]),ir}upVector(u,p,w){return[0,0,1]}upVectorScale(u,p,w){return{metersToTile:1}}}class yT extends dw{constructor(u){super(u),this.range=[4,7],this.center=u.center||[-96,37.5];const[p,w]=this.parallels=u.parallels||[29.5,45.5],A=Math.sin(rh(p));this.n=(A+Math.sin(rh(w)))/2,this.c=1+A*(2*this.n-A),this.r0=Math.sqrt(this.c)/this.n}project(u,p){const{n:w,c:A,r0:N}=this,_e=rh(u-this.center[0]),dt=rh(p),ir=Math.sqrt(A-2*w*Math.sin(dt))/w;return{x:ir*Math.sin(_e*w),y:ir*Math.cos(_e*w)-N,z:0}}unproject(u,p){const{n:w,c:A,r0:N}=this,_e=N+p;let dt=Math.atan2(u,Math.abs(_e))*Math.sign(_e);_e*w<0&&(dt-=Math.PI*Math.sign(u)*Math.sign(_e));const ir=rh(this.center[0])*w;dt=Ip(dt,-Math.PI-ir,Math.PI-ir);const Cr=Jh(wh(dt/w)+this.center[0],-180,180),Gn=Math.asin(Jh((A-(u*u+_e*_e)*w*w)/(2*w),-1,1)),hs=Jh(wh(Gn),-ym,ym);return new Rg(Cr,hs)}}const Db=1.340264,Ob=-.081106,Lb=893e-6,Fb=.003796,kC=Math.sqrt(3)/2;class _T extends dw{project(u,p){p=p/180*Math.PI,u=u/180*Math.PI;const w=Math.asin(kC*Math.sin(p)),A=w*w,N=A*A*A;return{x:.5*(u*Math.cos(w)/(kC*(Db+3*Ob*A+N*(7*Lb+9*Fb*A)))/Math.PI+.5),y:1-.5*(w*(Db+Ob*A+N*(Lb+Fb*A))/Math.PI+1),z:0}}unproject(u,p){u=(2*u-.5)*Math.PI;let w=p=(2*(1-p)-1)*Math.PI,A=w*w,N=A*A*A;for(let Gn,hs,rl,ll=0;ll<12&&(hs=w*(Db+Ob*A+N*(Lb+Fb*A))-p,rl=Db+3*Ob*A+N*(7*Lb+9*Fb*A),Gn=hs/rl,w=Jh(w-Gn,-Math.PI/3,Math.PI/3),A=w*w,N=A*A*A,!(Math.abs(Gn)<1e-12));++ll);const _e=kC*u*(Db+3*Ob*A+N*(7*Lb+9*Fb*A))/Math.cos(w),dt=Math.asin(Math.sin(w)/kC),ir=Jh(180*_e/Math.PI,-180,180),Cr=Jh(180*dt/Math.PI,-ym,ym);return new Rg(ir,Cr)}}class vT extends dw{constructor(u){super(u),this.wrap=!0,this.supportsWorldCopies=!0}project(u,p){return{x:.5+u/360,y:.5-p/360,z:0}}unproject(u,p){const w=360*(u-.5),A=Jh(360*(.5-p),-ym,ym);return new Rg(w,A)}}const V1=Math.PI/2;function BC(c){return Math.tan((V1+c)/2)}class xT extends dw{constructor(u){super(u),this.center=u.center||[0,30];const[p,w]=this.parallels=u.parallels||[30,30];let A=rh(p),N=rh(w);this.southernCenter=A+N<0,this.southernCenter&&(A=-A,N=-N);const _e=Math.cos(A),dt=BC(A);this.n=A===N?Math.sin(A):Math.log(_e/Math.cos(N))/Math.log(BC(N)/dt),this.f=_e*Math.pow(BC(A),this.n)/this.n}project(u,p){p=rh(p),this.southernCenter&&(p=-p),u=rh(u-this.center[0]);const w=1e-6,{n:A,f:N}=this;N>0?p<-V1+w&&(p=-V1+w):p>V1-w&&(p=V1-w);const _e=N/Math.pow(BC(p),A);let dt=_e*Math.sin(A*u),ir=N-_e*Math.cos(A*u);return dt=.5*(dt/Math.PI+.5),ir=.5*(ir/Math.PI+.5),{x:dt,y:this.southernCenter?ir:1-ir,z:0}}unproject(u,p){u=(2*u-.5)*Math.PI,this.southernCenter&&(p=1-p),p=(2*(1-p)-.5)*Math.PI;const{n:w,f:A}=this,N=A-p,_e=Math.sign(N),dt=Math.sign(w)*Math.sqrt(u*u+N*N);let ir=Math.atan2(u,Math.abs(N))*_e;N*w<0&&(ir-=Math.PI*Math.sign(u)*_e);const Cr=Jh(wh(ir/w)+this.center[0],-180,180),Gn=Jh(wh(2*Math.atan(Math.pow(A/dt,1/w))-V1),-ym,ym);return new Rg(Cr,this.southernCenter?-Gn:Gn)}}class pS extends dw{constructor(u){super(u),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(u,p){return{x:am(u),y:M_(p),z:0}}unproject(u,p){const w=zm(u),A=bm(p);return new Rg(w,A)}}const dS=rh(ym);class wT extends dw{project(u,p){const w=(p=rh(p))*p,A=w*w;return{x:.5*((u=rh(u))*(.8707-.131979*w+A*(A*(.003971*w-.001529*A)-.013791))/Math.PI+.5),y:1-.5*(p*(1.007226+w*(.015085+A*(.028874*w-.044475-.005916*A)))/Math.PI+1),z:0}}unproject(u,p){u=(2*u-.5)*Math.PI;let w=p=(2*(1-p)-1)*Math.PI,A=25,N=0,_e=w*w;do{_e=w*w;const Cr=_e*_e;N=(w*(1.007226+_e*(.015085+Cr*(.028874*_e-.044475-.005916*Cr)))-p)/(1.007226+_e*(.045255+Cr*(.259866*_e-.311325-.005916*11*Cr))),w=Jh(w-N,-dS,dS)}while(Math.abs(N)>1e-6&&--A>0);_e=w*w;const dt=Jh(wh(u/(.8707+_e*(_e*(_e*_e*_e*(.003971-.001529*_e)-.013791)-.131979))),-180,180),ir=wh(w);return new Rg(dt,ir)}}const fS=rh(ym);class bT extends dw{project(u,p){p=rh(p),u=rh(u);const w=Math.cos(p),A=2/Math.PI,N=Math.acos(w*Math.cos(u/2)),_e=Math.sin(N)/N,dt=.5*(u*A+2*w*Math.sin(u/2)/_e)||0,ir=.5*(p+Math.sin(p)/_e)||0;return{x:.5*(dt/Math.PI+.5),y:1-.5*(ir/Math.PI+1),z:0}}unproject(u,p){let w=u=(2*u-.5)*Math.PI,A=p=(2*(1-p)-1)*Math.PI,N=25;const _e=1e-6;let dt=0,ir=0;do{const Cr=Math.cos(A),Gn=Math.sin(A),hs=2*Gn*Cr,rl=Gn*Gn,ll=Cr*Cr,ul=Math.cos(w/2),th=Math.sin(w/2),fh=2*ul*th,Ch=th*th,zh=1-ll*ul*ul,Eh=zh?1/zh:0,Bh=zh?Math.acos(Cr*ul)*Math.sqrt(1/zh):0,Hh=.5*(2*Bh*Cr*th+2*w/Math.PI)-u,jh=.5*(Bh*Gn+A)-p,cp=.5*Eh*(ll*Ch+Bh*Cr*ul*rl)+1/Math.PI,sp=Eh*(fh*hs/4-Bh*Gn*th),Sp=.125*Eh*(hs*th-Bh*Gn*ll*fh),Hp=.5*Eh*(rl*ul+Bh*Ch*Cr)+.5,mp=sp*Sp-Hp*cp;dt=(jh*sp-Hh*Hp)/mp,ir=(Hh*Sp-jh*cp)/mp,w=Jh(w-dt,-Math.PI,Math.PI),A=Jh(A-ir,-fS,fS)}while((Math.abs(dt)>_e||Math.abs(ir)>_e)&&--N>0);return new Rg(wh(w),wh(A))}}class gS extends dw{constructor(u){super(u),this.center=u.center||[0,0],this.parallels=u.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(rh(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(u,p){const{scale:w,cosPhi:A}=this;return{x:rh(u)*A*w+.5,y:-Math.sin(rh(p))/A*w+.5,z:0}}unproject(u,p){const{scale:w,cosPhi:A}=this,N=-(p-.5)/w,_e=Jh(wh((u-.5)/w)/A,-180,180),dt=Math.asin(Jh(N*A,-1,1)),ir=Jh(wh(dt),-ym,ym);return new Rg(_e,ir)}}class CT extends pS{constructor(u){super(u),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(u,p,w){const A=Nw(u,p,w);return sm(A,A,kw(cg(w))),{x:A[0],y:A[1],z:A[2]}}locationPoint(u,p){const w=Qx(p.lat,p.lng),A=wy([],w),N=u.elevation?u.elevation.getAtPointOrZero(u.locationCoordinate(p),u._centerAltitude):u._centerAltitude;Zx(w,w,A,D_(1,0)*Hd*N);const _e=pv(new Float64Array(16));return Ix(_e,u.pixelMatrix,u.globeMatrix),sm(w,w,_e),new sl(w[0],w[1])}pixelsPerMeter(u,p){return D_(1,0)*p}pixelSpaceConversion(u,p,w){const A=D_(1,u)*p,N=jd(D_(1,45)*p,A,w);return this.pixelsPerMeter(u,p)/N}createTileMatrix(u,p,w){const A=sb(cg(w.canonical));return Ix(new Float64Array(16),u.globeMatrix,A)}createInversionMatrix(u,p){const{center:w}=u,A=kw(cg(p));return Dw(A,A,rh(w.lng)),Mw(A,A,rh(w.lat)),S0(A,A,[u._pixelsPerMercatorPixel,u._pixelsPerMercatorPixel,1]),Float32Array.from(A)}pointCoordinate(u,p,w,A){return ib(u,p,w,!0)||new P0(0,0)}pointCoordinate3D(u,p,w){const A=this.pointCoordinate(u,p,w,0);return[A.x,A.y,A.z]}isPointAboveHorizon(u,p){return!ib(u,p.x,p.y,!1)}farthestPixelDistance(u){const p=function(A,N){const _e=A.cameraToCenterDistance,dt=A._centerAltitude*N,ir=A._camera,Cr=A._camera.forward(),Gn=Qv([],$y([],Cr,-_e),[0,0,dt]),hs=A.worldSize/(2*Math.PI),rl=[0,0,-hs],ll=A.width/A.height,ul=Math.tan(A.fovAboveCenter),th=$y([],ir.up(),ul),fh=$y([],ir.right(),ul*ll),Ch=wy([],Qv([],Qv([],Cr,th),fh)),zh=[];let Eh;if(new u1(Gn,Ch).closestPointOnSphere(rl,hs,zh)){const Bh=Qv([],zh,rl),Hh=o_([],Bh,Gn);Eh=Math.cos(A.fovAboveCenter)*A_(Hh)}else{const Bh=o_([],Gn,rl),Hh=o_([],rl,Gn);wy(Hh,Hh);const jh=A_(Bh)-hs;Eh=Math.sqrt(jh*(jh+2*hs));const cp=Math.acos(Eh/(hs+jh))-Math.acos(R_(Cr,Hh));Eh*=Math.cos(cp)}return 1.01*Eh}(u,this.pixelsPerMeter(u.center.lat,u.worldSize)),w=ew(u.zoom);if(w>0){const A=hS(u,D_(1,u.center.lat)*u.worldSize),N=u.worldSize/(2*Math.PI),_e=Math.max(u.width,u.height)/u.worldSize*Math.PI;return jd(p,A+N*(1-Math.cos(_e)),Math.pow(w,10))}return p}upVector(u,p,w){return Nw(p,w,u,1)}upVectorScale(u){return{metersToTile:mm(f1(cg(u)))}}}function mS(c){const u=c.parallels,p=!!u&&Math.abs(u[0]+u[1])<.01;switch(c.name){case"mercator":return new pS(c);case"equirectangular":return new vT(c);case"naturalEarth":return new wT(c);case"equalEarth":return new _T(c);case"winkelTripel":return new bT(c);case"albers":return p?new gS(c):new yT(c);case"lambertConformalConic":return p?new gS(c):new xT(c);case"globe":return new CT(c)}throw new Error(`Invalid projection name: ${c.name}`)}const ET=W.types,ST=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function zC(c,u,p,w,A,N,_e,dt,ir,Cr,Gn,hs,rl){const ll=dt?Math.min(pw,Math.round(dt[0])):0,ul=dt?Math.min(pw,Math.round(dt[1])):0;c.emplaceBack(u,p,Math.round(32*w),Math.round(32*A),N,_e,(ll<<1)+(ir?1:0),ul,16*Cr,16*Gn,256*hs,256*rl)}function GC(c,u,p,w,A,N,_e){c.emplaceBack(u,p,w,A,N,_e)}function VC(c,u,p,w,A){c.emplaceBack(u,p,w,A),c.emplaceBack(u,p,w,A),c.emplaceBack(u,p,w,A),c.emplaceBack(u,p,w,A)}function TT(c){for(const u of c.sections)if(Np(u.text))return!0;return!1}class CE{constructor(u){this.layoutVertexArray=new Pp,this.indexArray=new Bd,this.programConfigurations=u,this.segments=new Kg,this.dynamicLayoutVertexArray=new bp,this.opacityVertexArray=new zd,this.placedSymbolArray=new dg,this.globeExtVertexArray=new Up}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(u,p,w,A){this.isEmpty()||(w&&(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,Qm.members),this.indexBuffer=u.createIndexBuffer(this.indexArray,p),this.dynamicLayoutVertexBuffer=u.createVertexBuffer(this.dynamicLayoutVertexArray,Dy.members,!0),this.opacityVertexBuffer=u.createVertexBuffer(this.opacityVertexArray,ST,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=u.createVertexBuffer(this.globeExtVertexArray,hy.members,!0)),this.opacityVertexBuffer.itemSize=1),(w||A)&&this.programConfigurations.upload(u))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}vs(CE,"SymbolBuffers");class EE{constructor(u,p,w){this.layoutVertexArray=new u,this.layoutAttributes=p,this.indexArray=new w,this.segments=new Kg,this.collisionVertexArray=new ig,this.collisionVertexArrayExt=new Jf}upload(u){this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=u.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=u.createVertexBuffer(this.collisionVertexArray,Cm.members,!0),this.collisionVertexBufferExt=u.createVertexBuffer(this.collisionVertexArrayExt,ey.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}vs(EE,"CollisionBuffers");class fw{constructor(u){this.collisionBoxArray=u.collisionBoxArray,this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(_e=>_e.id),this.index=u.index,this.pixelRatio=u.pixelRatio,this.sourceLayerIndex=u.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=pv([]),this.placementViewportMatrix=pv([]);const p=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Qg(this.zoom,p["text-size"]),this.iconSizeData=Qg(this.zoom,p["icon-size"]);const w=this.layers[0].layout,A=w.get("symbol-sort-key"),N=w.get("symbol-z-order");this.canOverlap=w.get("text-allow-overlap")||w.get("icon-allow-overlap")||w.get("text-ignore-placement")||w.get("icon-ignore-placement"),this.sortFeaturesByKey=N!=="viewport-y"&&A.constantOr(1)!==void 0,this.sortFeaturesByY=(N==="viewport-y"||N==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=w.get("text-writing-mode").map(_e=>vv[_e]),this.stateDependentLayerIds=this.layers.filter(_e=>_e.isStateDependent()).map(_e=>_e.id),this.sourceID=u.sourceID,this.projection=u.projection}createArrays(){this.text=new CE(new T_(this.layers,this.zoom,u=>/^text/.test(u))),this.icon=new CE(new T_(this.layers,this.zoom,u=>/^icon/.test(u))),this.glyphOffsetArray=new cy,this.lineVertexArray=new Kv,this.symbolInstances=new Mg}calculateGlyphDependencies(u,p,w,A,N){for(let _e=0;_e<u.length;_e++)if(p[u.charCodeAt(_e)]=!0,A&&N){const dt=Pm[u.charAt(_e)];dt&&(p[dt.charCodeAt(0)]=!0)}}populate(u,p,w,A){const N=this.layers[0],_e=N.layout,dt=this.projection.name==="globe",ir=_e.get("text-font"),Cr=_e.get("text-field"),Gn=_e.get("icon-image"),hs=(Cr.value.kind!=="constant"||Cr.value.value instanceof dm&&!Cr.value.value.isEmpty()||Cr.value.value.toString().length>0)&&(ir.value.kind!=="constant"||ir.value.value.length>0),rl=Gn.value.kind!=="constant"||!!Gn.value.value||Object.keys(Gn.parameters).length>0,ll=_e.get("symbol-sort-key");if(this.features=[],!hs&&!rl)return;const ul=p.iconDependencies,th=p.glyphDependencies,fh=p.availableImages,Ch=new Vn(this.zoom);for(const{feature:zh,id:Eh,index:Bh,sourceLayerIndex:Hh}of u){const jh=N._featureFilter.needGeometry,cp=Ox(zh,jh);if(!N._featureFilter.filter(Ch,cp,w))continue;if(jh||(cp.geometry=fv(zh,w,A)),dt&&zh.type!==1&&w.z<=5){const mp=cp.geometry,Dp=.98078528056,Op=(zp,Zp)=>R_(Nw(zp.x,zp.y,w,1),Nw(Zp.x,Zp.y,w,1))<Dp;for(let zp=0;zp<mp.length;zp++)mp[zp]=oE(mp[zp],Op)}let sp,Sp;if(hs){const mp=N.getValueAndResolveTokens("text-field",cp,w,fh),Dp=dm.factory(mp);TT(Dp)&&(this.hasRTLText=!0),(!this.hasRTLText||kt()==="unavailable"||this.hasRTLText&&pi.isParsed())&&(sp=ry(Dp,N,cp))}if(rl){const mp=N.getValueAndResolveTokens("icon-image",cp,w,fh);Sp=mp instanceof Vm?mp:Vm.fromString(mp)}if(!sp&&!Sp)continue;const Hp=this.sortFeaturesByKey?ll.evaluate(cp,{},w):void 0;if(this.features.push({id:Eh,text:sp,icon:Sp,index:Bh,sourceLayerIndex:Hh,geometry:cp.geometry,properties:zh.properties,type:ET[zh.type],sortKey:Hp}),Sp&&(ul[Sp.name]=!0),sp){const mp=ir.evaluate(cp,{},w).join(","),Dp=_e.get("text-rotation-alignment")==="map"&&_e.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(vv.vertical)>=0;for(const Op of sp.sections)if(Op.image)ul[Op.image.name]=!0;else{const zp=Rh(sp.toString()),Zp=Op.fontStack||mp,xp=th[Zp]=th[Zp]||{};this.calculateGlyphDependencies(Op.text,xp,Dp,this.allowVerticalPlacement,zp)}}}_e.get("symbol-placement")==="line"&&(this.features=function(zh){const Eh={},Bh={},Hh=[];let jh=0;function cp(mp){Hh.push(zh[mp]),jh++}function sp(mp,Dp,Op){const zp=Bh[mp];return delete Bh[mp],Bh[Dp]=zp,Hh[zp].geometry[0].pop(),Hh[zp].geometry[0]=Hh[zp].geometry[0].concat(Op[0]),zp}function Sp(mp,Dp,Op){const zp=Eh[Dp];return delete Eh[Dp],Eh[mp]=zp,Hh[zp].geometry[0].shift(),Hh[zp].geometry[0]=Op[0].concat(Hh[zp].geometry[0]),zp}function Hp(mp,Dp,Op){const zp=Op?Dp[0][Dp[0].length-1]:Dp[0][0];return`${mp}:${zp.x}:${zp.y}`}for(let mp=0;mp<zh.length;mp++){const Dp=zh[mp],Op=Dp.geometry,zp=Dp.text?Dp.text.toString():null;if(!zp){cp(mp);continue}const Zp=Hp(zp,Op),xp=Hp(zp,Op,!0);if(Zp in Bh&&xp in Eh&&Bh[Zp]!==Eh[xp]){const pd=Sp(Zp,xp,Op),Od=sp(Zp,xp,Hh[pd].geometry);delete Eh[Zp],delete Bh[xp],Bh[Hp(zp,Hh[Od].geometry,!0)]=Od,Hh[pd].geometry=null}else Zp in Bh?sp(Zp,xp,Op):xp in Eh?Sp(Zp,xp,Op):(cp(mp),Eh[Zp]=jh-1,Bh[xp]=jh-1)}return Hh.filter(mp=>mp.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((zh,Eh)=>zh.sortKey-Eh.sortKey)}update(u,p,w,A){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(u,p,this.layers,w,A),this.icon.programConfigurations.updatePaintArrays(u,p,this.layers,w,A))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(u){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(u),this.iconCollisionBox.upload(u)),this.text.upload(u,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(u,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=mS(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(u,p){const w=this.lineVertexArray.length;if(u.segment!==void 0)for(const{x:A,y:N}of p)this.lineVertexArray.emplaceBack(A,N);return{lineStartIndex:w,lineLength:this.lineVertexArray.length-w}}addSymbols(u,p,w,A,N,_e,dt,ir,Cr,Gn,hs,rl,ll,ul){const th=u.indexArray,fh=u.layoutVertexArray,Ch=u.globeExtVertexArray,zh=u.segments.prepareSegment(4*p.length,fh,th,this.canOverlap?_e.sortKey:void 0),Eh=this.glyphOffsetArray.length,Bh=zh.vertexLength,Hh=this.allowVerticalPlacement&&dt===vv.vertical?Math.PI/2:0,jh=_e.text&&_e.text.sections;for(let sp=0;sp<p.length;sp++){const{tl:Sp,tr:Hp,bl:mp,br:Dp,tex:Op,pixelOffsetTL:zp,pixelOffsetBR:Zp,minFontScaleX:xp,minFontScaleY:pd,glyphOffset:Od,isSDF:md,sectionIndex:Zf}=p[sp],Qp=zh.vertexLength,qd=Od[1];if(zC(fh,Cr.x,Cr.y,Sp.x,qd+Sp.y,Op.x,Op.y,w,md,zp.x,zp.y,xp,pd),zC(fh,Cr.x,Cr.y,Hp.x,qd+Hp.y,Op.x+Op.w,Op.y,w,md,Zp.x,zp.y,xp,pd),zC(fh,Cr.x,Cr.y,mp.x,qd+mp.y,Op.x,Op.y+Op.h,w,md,zp.x,Zp.y,xp,pd),zC(fh,Cr.x,Cr.y,Dp.x,qd+Dp.y,Op.x+Op.w,Op.y+Op.h,w,md,Zp.x,Zp.y,xp,pd),ir){const{x:Xf,y:vg,z:Yf}=ir.anchor,[Gf,qg,Qf]=ir.up;GC(Ch,Xf,vg,Yf,Gf,qg,Qf),GC(Ch,Xf,vg,Yf,Gf,qg,Qf),GC(Ch,Xf,vg,Yf,Gf,qg,Qf),GC(Ch,Xf,vg,Yf,Gf,qg,Qf),VC(u.dynamicLayoutVertexArray,Xf,vg,Yf,Hh)}else VC(u.dynamicLayoutVertexArray,Cr.x,Cr.y,Cr.z,Hh);th.emplaceBack(Qp,Qp+1,Qp+2),th.emplaceBack(Qp+1,Qp+2,Qp+3),zh.vertexLength+=4,zh.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Od[0]),sp!==p.length-1&&Zf===p[sp+1].sectionIndex||u.programConfigurations.populatePaintArrays(fh.length,_e,_e.index,{},ll,ul,jh&&jh[Zf])}const cp=ir?ir.anchor:Cr;u.placedSymbolArray.emplaceBack(cp.x,cp.y,cp.z,Cr.x,Cr.y,Eh,this.glyphOffsetArray.length-Eh,Bh,Gn,hs,Cr.segment,w?w[0]:0,w?w[1]:0,A[0],A[1],dt,0,!1,0,rl,0)}_commitLayoutVertex(u,p,w,A,N,_e,dt){u.emplaceBack(p,w,A,N,_e,Math.round(dt.x),Math.round(dt.y))}_addCollisionDebugVertices(u,p,w,A,N,_e,dt){const ir=w.segments.prepareSegment(4,w.layoutVertexArray,w.indexArray),Cr=ir.vertexLength,Gn=dt.tileAnchorX,hs=dt.tileAnchorY;for(let ll=0;ll<4;ll++)w.collisionVertexArray.emplaceBack(0,0,0,0);w.collisionVertexArrayExt.emplaceBack(p,-u.padding,-u.padding),w.collisionVertexArrayExt.emplaceBack(p,u.padding,-u.padding),w.collisionVertexArrayExt.emplaceBack(p,u.padding,u.padding),w.collisionVertexArrayExt.emplaceBack(p,-u.padding,u.padding),this._commitLayoutVertex(w.layoutVertexArray,A,N,_e,Gn,hs,new sl(u.x1,u.y1)),this._commitLayoutVertex(w.layoutVertexArray,A,N,_e,Gn,hs,new sl(u.x2,u.y1)),this._commitLayoutVertex(w.layoutVertexArray,A,N,_e,Gn,hs,new sl(u.x2,u.y2)),this._commitLayoutVertex(w.layoutVertexArray,A,N,_e,Gn,hs,new sl(u.x1,u.y2)),ir.vertexLength+=4;const rl=w.indexArray;rl.emplaceBack(Cr,Cr+1),rl.emplaceBack(Cr+1,Cr+2),rl.emplaceBack(Cr+2,Cr+3),rl.emplaceBack(Cr+3,Cr),ir.primitiveLength+=4}_addTextDebugCollisionBoxes(u,p,w,A,N,_e){for(let dt=A;dt<N;dt++){const ir=w.get(dt),Cr=this.getSymbolInstanceTextSize(u,_e,p,dt);this._addCollisionDebugVertices(ir,Cr,this.textCollisionBox,ir.projectedAnchorX,ir.projectedAnchorY,ir.projectedAnchorZ,_e)}}_addIconDebugCollisionBoxes(u,p,w,A,N,_e){for(let dt=A;dt<N;dt++){const ir=w.get(dt),Cr=this.getSymbolInstanceIconSize(u,p,_e.placedIconSymbolIndex);this._addCollisionDebugVertices(ir,Cr,this.iconCollisionBox,ir.projectedAnchorX,ir.projectedAnchorY,ir.projectedAnchorZ,_e)}}generateCollisionDebugBuffers(u,p){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new EE(Pd,ty.members,om),this.iconCollisionBox=new EE(Pd,ty.members,om);const w=tg(this.iconSizeData,u),A=tg(this.textSizeData,u);for(let N=0;N<this.symbolInstances.length;N++){const _e=this.symbolInstances.get(N);this._addTextDebugCollisionBoxes(A,u,p,_e.textBoxStartIndex,_e.textBoxEndIndex,_e),this._addTextDebugCollisionBoxes(A,u,p,_e.verticalTextBoxStartIndex,_e.verticalTextBoxEndIndex,_e),this._addIconDebugCollisionBoxes(w,u,p,_e.iconBoxStartIndex,_e.iconBoxEndIndex,_e),this._addIconDebugCollisionBoxes(w,u,p,_e.verticalIconBoxStartIndex,_e.verticalIconBoxEndIndex,_e)}}getSymbolInstanceTextSize(u,p,w,A){const N=this.text.placedSymbolArray.get(p.rightJustifiedTextSymbolIndex>=0?p.rightJustifiedTextSymbolIndex:p.centerJustifiedTextSymbolIndex>=0?p.centerJustifiedTextSymbolIndex:p.leftJustifiedTextSymbolIndex>=0?p.leftJustifiedTextSymbolIndex:p.verticalPlacedTextSymbolIndex>=0?p.verticalPlacedTextSymbolIndex:A),_e=Im(this.textSizeData,u,N)/Ig;return this.tilePixelRatio*_e}getSymbolInstanceIconSize(u,p,w){const A=this.icon.placedSymbolArray.get(w),N=Im(this.iconSizeData,u,A);return this.tilePixelRatio*N}_commitDebugCollisionVertexUpdate(u,p,w){u.emplaceBack(p,-w,-w),u.emplaceBack(p,w,-w),u.emplaceBack(p,w,w),u.emplaceBack(p,-w,w)}_updateTextDebugCollisionBoxes(u,p,w,A,N,_e){for(let dt=A;dt<N;dt++){const ir=w.get(dt),Cr=this.getSymbolInstanceTextSize(u,_e,p,dt);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,Cr,ir.padding)}}_updateIconDebugCollisionBoxes(u,p,w,A,N,_e){for(let dt=A;dt<N;dt++){const ir=w.get(dt),Cr=this.getSymbolInstanceIconSize(u,p,_e);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,Cr,ir.padding)}}updateCollisionDebugBuffers(u,p){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const w=tg(this.iconSizeData,u),A=tg(this.textSizeData,u);for(let N=0;N<this.symbolInstances.length;N++){const _e=this.symbolInstances.get(N);this._updateTextDebugCollisionBoxes(A,u,p,_e.textBoxStartIndex,_e.textBoxEndIndex,_e),this._updateTextDebugCollisionBoxes(A,u,p,_e.verticalTextBoxStartIndex,_e.verticalTextBoxEndIndex,_e),this._updateIconDebugCollisionBoxes(w,u,p,_e.iconBoxStartIndex,_e.iconBoxEndIndex,_e.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(w,u,p,_e.verticalIconBoxStartIndex,_e.verticalIconBoxEndIndex,_e.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(u,p,w,A,N,_e,dt,ir,Cr){const Gn={};if(p<w){const{x1:hs,y1:rl,x2:ll,y2:ul,padding:th,projectedAnchorX:fh,projectedAnchorY:Ch,projectedAnchorZ:zh,tileAnchorX:Eh,tileAnchorY:Bh,featureIndex:Hh}=u.get(p);Gn.textBox={x1:hs,y1:rl,x2:ll,y2:ul,padding:th,projectedAnchorX:fh,projectedAnchorY:Ch,projectedAnchorZ:zh,tileAnchorX:Eh,tileAnchorY:Bh},Gn.textFeatureIndex=Hh}if(A<N){const{x1:hs,y1:rl,x2:ll,y2:ul,padding:th,projectedAnchorX:fh,projectedAnchorY:Ch,projectedAnchorZ:zh,tileAnchorX:Eh,tileAnchorY:Bh,featureIndex:Hh}=u.get(A);Gn.verticalTextBox={x1:hs,y1:rl,x2:ll,y2:ul,padding:th,projectedAnchorX:fh,projectedAnchorY:Ch,projectedAnchorZ:zh,tileAnchorX:Eh,tileAnchorY:Bh},Gn.verticalTextFeatureIndex=Hh}if(_e<dt){const{x1:hs,y1:rl,x2:ll,y2:ul,padding:th,projectedAnchorX:fh,projectedAnchorY:Ch,projectedAnchorZ:zh,tileAnchorX:Eh,tileAnchorY:Bh,featureIndex:Hh}=u.get(_e);Gn.iconBox={x1:hs,y1:rl,x2:ll,y2:ul,padding:th,projectedAnchorX:fh,projectedAnchorY:Ch,projectedAnchorZ:zh,tileAnchorX:Eh,tileAnchorY:Bh},Gn.iconFeatureIndex=Hh}if(ir<Cr){const{x1:hs,y1:rl,x2:ll,y2:ul,padding:th,projectedAnchorX:fh,projectedAnchorY:Ch,projectedAnchorZ:zh,tileAnchorX:Eh,tileAnchorY:Bh,featureIndex:Hh}=u.get(ir);Gn.verticalIconBox={x1:hs,y1:rl,x2:ll,y2:ul,padding:th,projectedAnchorX:fh,projectedAnchorY:Ch,projectedAnchorZ:zh,tileAnchorX:Eh,tileAnchorY:Bh},Gn.verticalIconFeatureIndex=Hh}return Gn}deserializeCollisionBoxes(u){this.collisionArrays=[];for(let p=0;p<this.symbolInstances.length;p++){const w=this.symbolInstances.get(p);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(u,w.textBoxStartIndex,w.textBoxEndIndex,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w.iconBoxStartIndex,w.iconBoxEndIndex,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(u,p){const w=u.placedSymbolArray.get(p),A=w.vertexStartIndex+4*w.numGlyphs;for(let N=w.vertexStartIndex;N<A;N+=4)u.indexArray.emplaceBack(N,N+1,N+2),u.indexArray.emplaceBack(N+1,N+2,N+3)}getSortedSymbolIndexes(u){if(this.sortedAngle===u&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const p=Math.sin(u),w=Math.cos(u),A=[],N=[],_e=[];for(let dt=0;dt<this.symbolInstances.length;++dt){_e.push(dt);const ir=this.symbolInstances.get(dt);A.push(0|Math.round(p*ir.tileAnchorX+w*ir.tileAnchorY)),N.push(ir.featureIndex)}return _e.sort((dt,ir)=>A[dt]-A[ir]||N[ir]-N[dt]),_e}addToSortKeyRanges(u,p){const w=this.sortKeyRanges[this.sortKeyRanges.length-1];w&&w.sortKey===p?w.symbolInstanceEnd=u+1:this.sortKeyRanges.push({sortKey:p,symbolInstanceStart:u,symbolInstanceEnd:u+1})}sortFeatures(u){if(this.sortFeaturesByY&&this.sortedAngle!==u&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(u),this.sortedAngle=u,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const p of this.symbolInstanceIndexes){const w=this.symbolInstances.get(p);this.featureSortOrder.push(w.featureIndex);const{rightJustifiedTextSymbolIndex:A,centerJustifiedTextSymbolIndex:N,leftJustifiedTextSymbolIndex:_e,verticalPlacedTextSymbolIndex:dt,placedIconSymbolIndex:ir,verticalPlacedIconSymbolIndex:Cr}=w;A>=0&&this.addIndicesForPlacedSymbol(this.text,A),N>=0&&N!==A&&this.addIndicesForPlacedSymbol(this.text,N),_e>=0&&_e!==N&&_e!==A&&this.addIndicesForPlacedSymbol(this.text,_e),dt>=0&&this.addIndicesForPlacedSymbol(this.text,dt),ir>=0&&this.addIndicesForPlacedSymbol(this.icon,ir),Cr>=0&&this.addIndicesForPlacedSymbol(this.icon,Cr)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}vs(fw,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),fw.MAX_GLYPHS=65535,fw.addDynamicAttributes=VC;const AT=new Sh({"symbol-placement":new yl(hp.layout_symbol["symbol-placement"]),"symbol-spacing":new yl(hp.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new yl(hp.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new mh(hp.layout_symbol["symbol-sort-key"]),"symbol-z-order":new yl(hp.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new yl(hp.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new yl(hp.layout_symbol["icon-ignore-placement"]),"icon-optional":new yl(hp.layout_symbol["icon-optional"]),"icon-rotation-alignment":new yl(hp.layout_symbol["icon-rotation-alignment"]),"icon-size":new mh(hp.layout_symbol["icon-size"]),"icon-text-fit":new yl(hp.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new yl(hp.layout_symbol["icon-text-fit-padding"]),"icon-image":new mh(hp.layout_symbol["icon-image"]),"icon-rotate":new mh(hp.layout_symbol["icon-rotate"]),"icon-padding":new yl(hp.layout_symbol["icon-padding"]),"icon-keep-upright":new yl(hp.layout_symbol["icon-keep-upright"]),"icon-offset":new mh(hp.layout_symbol["icon-offset"]),"icon-anchor":new mh(hp.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new yl(hp.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new yl(hp.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new yl(hp.layout_symbol["text-rotation-alignment"]),"text-field":new mh(hp.layout_symbol["text-field"]),"text-font":new mh(hp.layout_symbol["text-font"]),"text-size":new mh(hp.layout_symbol["text-size"]),"text-max-width":new mh(hp.layout_symbol["text-max-width"]),"text-line-height":new mh(hp.layout_symbol["text-line-height"]),"text-letter-spacing":new mh(hp.layout_symbol["text-letter-spacing"]),"text-justify":new mh(hp.layout_symbol["text-justify"]),"text-radial-offset":new mh(hp.layout_symbol["text-radial-offset"]),"text-variable-anchor":new yl(hp.layout_symbol["text-variable-anchor"]),"text-anchor":new mh(hp.layout_symbol["text-anchor"]),"text-max-angle":new yl(hp.layout_symbol["text-max-angle"]),"text-writing-mode":new yl(hp.layout_symbol["text-writing-mode"]),"text-rotate":new mh(hp.layout_symbol["text-rotate"]),"text-padding":new yl(hp.layout_symbol["text-padding"]),"text-keep-upright":new yl(hp.layout_symbol["text-keep-upright"]),"text-transform":new mh(hp.layout_symbol["text-transform"]),"text-offset":new mh(hp.layout_symbol["text-offset"]),"text-allow-overlap":new yl(hp.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new yl(hp.layout_symbol["text-ignore-placement"]),"text-optional":new yl(hp.layout_symbol["text-optional"])});var SE={paint:new Sh({"icon-opacity":new mh(hp.paint_symbol["icon-opacity"]),"icon-color":new mh(hp.paint_symbol["icon-color"]),"icon-halo-color":new mh(hp.paint_symbol["icon-halo-color"]),"icon-halo-width":new mh(hp.paint_symbol["icon-halo-width"]),"icon-halo-blur":new mh(hp.paint_symbol["icon-halo-blur"]),"icon-translate":new yl(hp.paint_symbol["icon-translate"]),"icon-translate-anchor":new yl(hp.paint_symbol["icon-translate-anchor"]),"text-opacity":new mh(hp.paint_symbol["text-opacity"]),"text-color":new mh(hp.paint_symbol["text-color"],{runtimeType:Wm,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new mh(hp.paint_symbol["text-halo-color"]),"text-halo-width":new mh(hp.paint_symbol["text-halo-width"]),"text-halo-blur":new mh(hp.paint_symbol["text-halo-blur"]),"text-translate":new yl(hp.paint_symbol["text-translate"]),"text-translate-anchor":new yl(hp.paint_symbol["text-translate-anchor"])}),layout:AT};class yS{constructor(u){this.type=u.property.overrides?u.property.overrides.runtimeType:lg,this.defaultValue=u}evaluate(u){if(u.formattedSection){const p=this.defaultValue.property.overrides;if(p&&p.hasOverride(u.formattedSection))return p.getOverride(u.formattedSection)}return u.feature&&u.featureState?this.defaultValue.evaluate(u.feature,u.featureState):this.defaultValue.property.specification.default}eachChild(u){this.defaultValue.isConstant()||u(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}vs(yS,"FormatSectionOverride",{omit:["defaultValue"]});class $C extends Py{constructor(u){super(u,SE)}recalculate(u,p){super.recalculate(u,p),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const w=this.layout.get("text-writing-mode");if(w){const A=[];for(const N of w)A.indexOf(N)<0&&A.push(N);this.layout._values["text-writing-mode"]=A}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(u,p,w,A){const N=this.layout.get(u).evaluate(p,{},w,A),_e=this._unevaluatedLayout._values[u];return _e.isDataDriven()||r_(_e.value)||!N?N:function(dt,ir){return ir.replace(/{([^{}]+)}/g,(Cr,Gn)=>Gn in dt?String(dt[Gn]):"")}(p.properties,N)}createBucket(u){return new fw(u)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const u of SE.paint.overridableProperties){if(!$C.hasPaintOverride(this.layout,u))continue;const p=this.paint.get(u),w=new yS(p),A=new $v(w,p.property.specification);let N=null;N=p.value.kind==="constant"||p.value.kind==="source"?new ex("source",A):new Bm("composite",A,p.value.zoomStops,p.value._interpolationType),this.paint._values[u]=new yh(p.property,N,p.parameters)}}_handleOverridablePaintPropertyUpdate(u,p,w){return!(!this.layout||p.isDataDriven()||w.isDataDriven())&&$C.hasPaintOverride(this.layout,u)}static hasPaintOverride(u,p){const w=u.get("text-field"),A=SE.paint.properties[p];let N=!1;const _e=dt=>{for(const ir of dt)if(A.overrides&&A.overrides.hasOverride(ir))return void(N=!0)};if(w.value.kind==="constant"&&w.value.value instanceof dm)_e(w.value.value.sections);else if(w.value.kind==="source"){const dt=Cr=>{N||(Cr instanceof Ky&&Gg(Cr.value)===k_?_e(Cr.value.sections):Cr instanceof Ty?_e(Cr.sections):Cr.eachChild(dt))},ir=w.value;ir._styleExpression&&dt(ir._styleExpression.expression)}return N}getProgramConfiguration(u){return new sx(this,u)}}var RT={paint:new Sh({"background-color":new yl(hp.paint_background["background-color"]),"background-pattern":new yl(hp.paint_background["background-pattern"]),"background-opacity":new yl(hp.paint_background["background-opacity"])})},IT={paint:new Sh({"raster-opacity":new yl(hp.paint_raster["raster-opacity"]),"raster-hue-rotate":new yl(hp.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new yl(hp.paint_raster["raster-brightness-min"]),"raster-brightness-max":new yl(hp.paint_raster["raster-brightness-max"]),"raster-saturation":new yl(hp.paint_raster["raster-saturation"]),"raster-contrast":new yl(hp.paint_raster["raster-contrast"]),"raster-resampling":new yl(hp.paint_raster["raster-resampling"]),"raster-fade-duration":new yl(hp.paint_raster["raster-fade-duration"])})};class PT extends Py{constructor(u){super(u,{}),this.implementation=u}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(u){this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)}onRemove(u){this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)}}var MT={paint:new Sh({"sky-type":new yl(hp.paint_sky["sky-type"]),"sky-atmosphere-sun":new yl(hp.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new yl(hp.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new yl(hp.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new yl(hp.paint_sky["sky-gradient-radius"]),"sky-gradient":new bh(hp.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new yl(hp.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new yl(hp.paint_sky["sky-atmosphere-color"]),"sky-opacity":new yl(hp.paint_sky["sky-opacity"])})};function TE(c,u,p){const w=[0,0,1],A=Jb([]);return eC(A,A,p?-rh(c)+Math.PI:rh(c)),Qb(A,A,-rh(u)),l1(w,w,A),wy(w,w)}const DT={circle:class extends Py{constructor(c){super(c,aC)}createBucket(c){return new Lx(c)}queryRadius(c){const u=c;return Fx("circle-radius",this,u)+Fx("circle-stroke-width",this,u)+$w(this.paint.get("circle-translate"))}queryIntersectsFeature(c,u,p,w,A,N,_e,dt){const ir=yb(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),N.angle,c.pixelToTileUnitsFactor),Cr=this.paint.get("circle-radius").evaluate(u,p)+this.paint.get("circle-stroke-width").evaluate(u,p);return lC(c,w,N,_e,dt,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",ir,Cr)}getProgramIds(){return["circle"]}getProgramConfiguration(c){return new sx(this,c)}},heatmap:class extends Py{createBucket(c){return new hC(c)}constructor(c){super(c,pC),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=S1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(c){return Fx("heatmap-radius",this,c)}queryIntersectsFeature(c,u,p,w,A,N,_e,dt){const ir=this.paint.get("heatmap-radius").evaluate(u,p);return lC(c,w,N,_e,dt,!0,!0,new sl(0,0),ir)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(c){return new sx(this,c)}},hillshade:class extends Py{constructor(c){super(c,_b)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Py{constructor(c){super(c,hE)}getProgramIds(){const c=this.paint.get("fill-pattern"),u=c&&c.constantOr(1),p=[u?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&p.push(u&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),p}getProgramConfiguration(c){return new sx(this,c)}recalculate(c,u){super.recalculate(c,u);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new Xw(c)}queryRadius(){return $w(this.paint.get("fill-translate"))}queryIntersectsFeature(c,u,p,w,A,N){return!c.queryGeometry.isAboveHorizon&&fb(w1(c.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),N.angle,c.pixelToTileUnitsFactor),w)}isTileClipped(){return!0}},"fill-extrusion":class extends Py{constructor(c){super(c,lp)}createBucket(c){return new hl(c)}queryRadius(){return $w(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(c){return new sx(this,c)}queryIntersectsFeature(c,u,p,w,A,N,_e,dt,ir){const Cr=yb(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),N.angle,c.pixelToTileUnitsFactor),Gn=this.paint.get("fill-extrusion-height").evaluate(u,p),hs=this.paint.get("fill-extrusion-base").evaluate(u,p),rl=[0,0],ll=dt&&N.elevation,ul=N.elevation?N.elevation.exaggeration():1,th=c.tile.getBucket(this);if(ll&&th instanceof hl){const Bh=th.centroidVertexArray,Hh=ir+1;Hh<Bh.length&&(rl[0]=Bh.geta_centroid_pos0(Hh),rl[1]=Bh.geta_centroid_pos1(Hh))}if(rl[0]===0&&rl[1]===1)return!1;N.projection.name==="globe"&&(w=Qh([w],[new sl(0,0),new sl(Hd,Hd)],c.tileID.canonical).map(Bh=>Bh.polygon).flat());const fh=ll?dt:null,[Ch,zh]=function(Bh,Hh,jh,cp,sp,Sp,Hp,mp,Dp,Op,zp){return Bh.projection.name==="globe"?function(Zp,xp,pd,Od,md,Zf,Qp,qd,Xf,vg,Yf){const Gf=[],qg=[],Qf=Zp.projection.upVectorScale(Yf,Zp.center.lat,Zp.worldSize).metersToTile,eg=[0,0,0,1],Fg=[0,0,0,1],Ug=(Ng,im,vm,Mm)=>{Ng[0]=im,Ng[1]=vm,Ng[2]=Mm,Ng[3]=1},jg=Xh();pd>0&&(pd+=jg),Od+=jg;for(const Ng of xp){const im=[],vm=[];for(const Mm of Ng){const kg=Mm.x+md.x,Gm=Mm.y+md.y,Dm=Zp.projection.projectTilePoint(kg,Gm,Yf),cm=Zp.projection.upVector(Yf,Mm.x,Mm.y);let wg=pd,Om=Od;if(Qp){const Hg=vd(kg,Gm,pd,Od,Qp,qd,Xf,vg);wg+=Hg.base,Om+=Hg.top}pd!==0?Ug(eg,Dm.x+cm[0]*Qf*wg,Dm.y+cm[1]*Qf*wg,Dm.z+cm[2]*Qf*wg):Ug(eg,Dm.x,Dm.y,Dm.z),Ug(Fg,Dm.x+cm[0]*Qf*Om,Dm.y+cm[1]*Qf*Om,Dm.z+cm[2]*Qf*Om),sm(eg,eg,Zf),sm(Fg,Fg,Zf),im.push(new hd(eg[0],eg[1],eg[2])),vm.push(new hd(Fg[0],Fg[1],Fg[2]))}Gf.push(im),qg.push(vm)}return[Gf,qg]}(Bh,Hh,jh,cp,sp,Sp,Hp,mp,Dp,Op,zp):Hp?function(Zp,xp,pd,Od,md,Zf,Qp,qd,Xf){const vg=[],Yf=[],Gf=[0,0,0,1];for(const qg of Zp){const Qf=[],eg=[];for(const Fg of qg){const Ug=Fg.x+Od.x,jg=Fg.y+Od.y,Ng=vd(Ug,jg,xp,pd,Zf,Qp,qd,Xf);Gf[0]=Ug,Gf[1]=jg,Gf[2]=Ng.base,Gf[3]=1,dv(Gf,Gf,md),Gf[3]=Math.max(Gf[3],1e-5);const im=new hd(Gf[0]/Gf[3],Gf[1]/Gf[3],Gf[2]/Gf[3]);Gf[0]=Ug,Gf[1]=jg,Gf[2]=Ng.top,Gf[3]=1,dv(Gf,Gf,md),Gf[3]=Math.max(Gf[3],1e-5);const vm=new hd(Gf[0]/Gf[3],Gf[1]/Gf[3],Gf[2]/Gf[3]);Qf.push(im),eg.push(vm)}vg.push(Qf),Yf.push(eg)}return[vg,Yf]}(Hh,jh,cp,sp,Sp,Hp,mp,Dp,Op):function(Zp,xp,pd,Od,md){const Zf=[],Qp=[],qd=md[8]*xp,Xf=md[9]*xp,vg=md[10]*xp,Yf=md[11]*xp,Gf=md[8]*pd,qg=md[9]*pd,Qf=md[10]*pd,eg=md[11]*pd;for(const Fg of Zp){const Ug=[],jg=[];for(const Ng of Fg){const im=Ng.x+Od.x,vm=Ng.y+Od.y,Mm=md[0]*im+md[4]*vm+md[12],kg=md[1]*im+md[5]*vm+md[13],Gm=md[2]*im+md[6]*vm+md[14],Dm=md[3]*im+md[7]*vm+md[15],cm=Mm+qd,wg=kg+Xf,Om=Gm+vg,Hg=Math.max(Dm+Yf,1e-5),Hy=Mm+Gf,Lm=kg+qg,dy=Gm+Qf,iy=Math.max(Dm+eg,1e-5);Ug.push(new hd(cm/Hg,wg/Hg,Om/Hg)),jg.push(new hd(Hy/iy,Lm/iy,dy/iy))}Zf.push(Ug),Qp.push(jg)}return[Zf,Qp]}(Hh,jh,cp,sp,Sp)}(N,w,hs,Gn,Cr,_e,fh,rl,ul,N.center.lat,c.tileID.canonical),Eh=c.queryGeometry;return function(Bh,Hh,jh){let cp=1/0;fb(jh,Hh)&&(cp=Sd(jh,Hh[0]));for(let sp=0;sp<Hh.length;sp++){const Sp=Hh[sp],Hp=Bh[sp];for(let mp=0;mp<Sp.length-1;mp++){const Dp=Sp[mp],Op=[Dp,Sp[mp+1],Hp[mp+1],Hp[mp],Dp];gv(jh,Op)&&(cp=Math.min(cp,Sd(jh,Op)))}}return cp!==1/0&&cp}(Ch,zh,Eh.isPointQuery()?Eh.screenBounds:Eh.screenGeometry)}},line:class extends Py{constructor(c){super(c,jm),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const u=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=u._styleExpression&&u._styleExpression.expression instanceof Mv,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(c,u){super.recalculate(c,u),this.paint._values["line-floorwidth"]=_m.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new um(c)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(c){return new sx(this,c)}queryRadius(c){const u=c,p=Rm(Fx("line-width",this,u),Fx("line-gap-width",this,u)),w=Fx("line-offset",this,u);return p/2+Math.abs(w)+$w(this.paint.get("line-translate"))}queryIntersectsFeature(c,u,p,w,A,N){if(c.queryGeometry.isAboveHorizon)return!1;const _e=w1(c.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),N.angle,c.pixelToTileUnitsFactor),dt=c.pixelToTileUnitsFactor/2*Rm(this.paint.get("line-width").evaluate(u,p),this.paint.get("line-gap-width").evaluate(u,p)),ir=this.paint.get("line-offset").evaluate(u,p);return ir&&(w=function(Cr,Gn){const hs=[],rl=new sl(0,0);for(let ll=0;ll<Cr.length;ll++){const ul=Cr[ll],th=[];for(let fh=0;fh<ul.length;fh++){const Ch=ul[fh],zh=ul[fh+1],Eh=fh===0?rl:Ch.sub(ul[fh-1])._unit()._perp(),Bh=fh===ul.length-1?rl:zh.sub(Ch)._unit()._perp(),Hh=Eh._add(Bh)._unit();Hh._mult(1/(Hh.x*Bh.x+Hh.y*Bh.y)),th.push(Hh._mult(Gn)._add(Ch))}hs.push(th)}return hs}(w,ir*c.pixelToTileUnitsFactor)),function(Cr,Gn,hs){for(let rl=0;rl<Gn.length;rl++){const ll=Gn[rl];if(Cr.length>=3){for(let ul=0;ul<ll.length;ul++)if(M0(Cr,ll[ul]))return!0}if(gb(Cr,ll,hs))return!0}return!1}(_e,w,dt)}isTileClipped(){return!0}},symbol:$C,background:class extends Py{constructor(c){super(c,RT)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Py{constructor(c){super(c,IT)}getProgramIds(){return["raster"]}},sky:class extends Py{constructor(c){super(c,MT),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="sky-gradient"?this._updateColorRamp():c!=="sky-atmosphere-sun"&&c!=="sky-atmosphere-halo-color"&&c!=="sky-atmosphere-color"&&c!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=S1({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(c){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const u=c.style.light.properties.get("position");return this._lightPosition.azimuthal!==u.azimuthal||this._lightPosition.polar!==u.polar}return!1}getCenter(c,u){if(this.paint.get("sky-type")==="atmosphere"){const w=this.paint.get("sky-atmosphere-sun"),A=!w,N=c.style.light,_e=N.properties.get("position");return A&&N.properties.get("anchor")==="viewport"&&Ap("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),A?TE(_e.azimuthal,90-_e.polar,u):TE(w[0],90-w[1],u)}const p=this.paint.get("sky-gradient-center");return TE(p[0],90-p[1],u)}is3D(){return!1}isSky(){return!0}markSkyboxValid(c){this._skyboxInvalidated=!1,this._lightPosition=c.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const c=this.paint.get("sky-type");return c==="atmosphere"?["skyboxCapture","skybox"]:c==="gradient"?["skyboxGradient"]:null}}};class Nb{constructor(u,p,w,A){this.context=u,this.format=w,this.texture=u.gl.createTexture(),this.update(p,A)}update(u,p,w){const{width:A,height:N}=u,{context:_e}=this,{gl:dt}=_e,{HTMLImageElement:ir,HTMLCanvasElement:Cr,HTMLVideoElement:Gn,ImageData:hs,ImageBitmap:rl}=h;if(dt.bindTexture(dt.TEXTURE_2D,this.texture),_e.pixelStoreUnpackFlipY.set(!1),_e.pixelStoreUnpack.set(1),_e.pixelStoreUnpackPremultiplyAlpha.set(this.format===dt.RGBA&&(!p||p.premultiply!==!1)),w||this.size&&this.size[0]===A&&this.size[1]===N){const{x:ll,y:ul}=w||{x:0,y:0};u instanceof ir||u instanceof Cr||u instanceof Gn||u instanceof hs||rl&&u instanceof rl?dt.texSubImage2D(dt.TEXTURE_2D,0,ll,ul,dt.RGBA,dt.UNSIGNED_BYTE,u):dt.texSubImage2D(dt.TEXTURE_2D,0,ll,ul,A,N,dt.RGBA,dt.UNSIGNED_BYTE,u.data)}else this.size=[A,N],u instanceof ir||u instanceof Cr||u instanceof Gn||u instanceof hs||rl&&u instanceof rl?dt.texImage2D(dt.TEXTURE_2D,0,this.format,this.format,dt.UNSIGNED_BYTE,u):dt.texImage2D(dt.TEXTURE_2D,0,this.format,A,N,0,this.format,dt.UNSIGNED_BYTE,u.data);this.useMipmap=!!(p&&p.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&dt.generateMipmap(dt.TEXTURE_2D)}bind(u,p){const{context:w}=this,{gl:A}=w;A.bindTexture(A.TEXTURE_2D,this.texture),u!==this.filter&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,u),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,this.useMipmap?u===A.NEAREST?A.NEAREST_MIPMAP_NEAREST:A.LINEAR_MIPMAP_NEAREST:u),this.filter=u),p!==this.wrap&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,p),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,p),this.wrap=p)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:u}=this.context;u.deleteTexture(this.texture),this.texture=null}}class OT{constructor(u){this._callback=u,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class LT{constructor(){this.tasks={},this.taskQueue=[],ed(["process"],this),this.invoker=new OT(this.process),this.nextId=0}add(u,p){const w=this.nextId++,A=function({type:N,isSymbolTile:_e,zoom:dt}){return dt=dt||0,N==="message"?0:N!=="maybePrepare"||_e?N!=="parseTile"||_e?N==="parseTile"&&_e?300-dt:N==="maybePrepare"&&_e?400-dt:500:200-dt:100-dt}(p);if(A===0){id();try{u()}finally{}return{cancel:()=>{}}}return this.tasks[w]={fn:u,metadata:p,priority:A,id:w},this.taskQueue.push(w),this.invoker.trigger(),{cancel:()=>{delete this.tasks[w]}}}process(){id();try{if(this.taskQueue=this.taskQueue.filter(w=>!!this.tasks[w]),!this.taskQueue.length)return;const u=this.pick();if(u===null)return;const p=this.tasks[u];if(delete this.tasks[u],this.taskQueue.length&&this.invoker.trigger(),!p)return;p.fn()}finally{}}pick(){let u=null,p=1/0;for(let A=0;A<this.taskQueue.length;A++){const N=this.tasks[this.taskQueue[A]];N.priority<p&&(p=N.priority,u=A)}if(u===null)return null;const w=this.taskQueue[u];return this.taskQueue.splice(u,1),w}remove(){this.invoker.remove()}}class _S{constructor(u){this._stringToNumber={},this._numberToString=[];for(let p=0;p<u.length;p++){const w=u[p];this._stringToNumber[w]=p,this._numberToString[p]=w}}encode(u){return this._stringToNumber[u]}decode(u){return this._numberToString[u]}}const FT=["tile","layer","source","sourceLayer","state"];class vS{constructor(u,p,w,A,N){this.type="Feature",this._vectorTileFeature=u,this._z=p,this._x=w,this._y=A,this.properties=u.properties,this.id=N}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(u){this._geometry=u}toJSON(){const u={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(u.id=this.id);for(const p of FT)this[p]!==void 0&&(u[p]=this[p]);return u}}const s0=32,mx=33,gw=new Uint16Array(8184);for(let c=0;c<2046;c++){let u=c+2,p=0,w=0,A=0,N=0,_e=0,dt=0;for(1&u?A=N=_e=s0:p=w=dt=s0;(u>>=1)>1;){const Cr=p+A>>1,Gn=w+N>>1;1&u?(A=p,N=w,p=_e,w=dt):(p=A,w=N,A=_e,N=dt),_e=Cr,dt=Gn}const ir=4*c;gw[ir+0]=p,gw[ir+1]=w,gw[ir+2]=A,gw[ir+3]=N}const yx=new Uint16Array(2178),mw=new Uint8Array(1089),UC=new Uint16Array(1089);function xS(c){return c===0?-.03125:c===32?.03125:0}var wS=Zh([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const bS={type:2,extent:Hd,loadGeometry:()=>[[new sl(0,0),new sl(Hd+1,0),new sl(Hd+1,Hd+1),new sl(0,Hd+1),new sl(0,0)]]};class AE{constructor(u,p,w,A,N){this.tileID=u,this.uid=Rp(),this.uses=0,this.tileSize=p,this.tileZoom=w,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=N,this.expiredRequestCount=0,this.state="loading",A&&A.transform&&(this.projection=A.transform.projection)}registerFadeDuration(u){const p=u+this.timeAdded;p<nm.now()||this.fadeEndTime&&p<this.fadeEndTime||(this.fadeEndTime=p)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Jw(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(u,p,w){if(this.unloadVectorData(),this.state="loaded",u){u.featureIndex&&(this.latestFeatureIndex=u.featureIndex,u.rawTileData?(this.latestRawTileData=u.rawTileData,this.latestFeatureIndex.rawTileData=u.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=u.collisionBoxArray,this.buckets=function(A,N){const _e={};if(!N)return _e;for(const dt of A){const ir=dt.layerIds.map(Cr=>N.getLayer(Cr)).filter(Boolean);if(ir.length!==0){dt.layers=ir,dt.stateDependentLayerIds&&(dt.stateDependentLayers=dt.stateDependentLayerIds.map(Cr=>ir.filter(Gn=>Gn.id===Cr)[0]));for(const Cr of ir)_e[Cr.id]=dt}}return _e}(u.buckets,p.style),this.hasSymbolBuckets=!1;for(const A in this.buckets){const N=this.buckets[A];if(N instanceof fw){if(this.hasSymbolBuckets=!0,!w)break;N.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const A in this.buckets){const N=this.buckets[A];if(N instanceof fw&&N.hasRTLText){this.hasRTLText=!0,pi.isLoading()||pi.isLoaded()||kt()!=="deferred"||Hr();break}}this.queryPadding=0;for(const A in this.buckets){const N=this.buckets[A];this.queryPadding=Math.max(this.queryPadding,p.style.getLayer(A).queryRadius(N))}u.imageAtlas&&(this.imageAtlas=u.imageAtlas),u.glyphAtlasImage&&(this.glyphAtlasImage=u.glyphAtlasImage),u.lineAtlas&&(this.lineAtlas=u.lineAtlas)}else this.collisionBoxArray=new Ag}unloadVectorData(){if(this.hasData()){for(const u in this.buckets)this.buckets[u].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(u){return this.buckets[u.id]}upload(u){for(const w in this.buckets){const A=this.buckets[w];A.uploadPending()&&A.upload(u)}const p=u.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Nb(u,this.imageAtlas.image,p.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Nb(u,this.glyphAtlasImage,p.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Nb(u,this.lineAtlas.image,p.ALPHA),this.lineAtlas.uploaded=!0)}prepare(u){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(u,this.imageAtlasTexture)}queryRenderedFeatures(u,p,w,A,N,_e,dt,ir){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:A,pixelPosMatrix:dt,transform:_e,params:N,tileTransform:this.tileTransform},u,p,w):{}}querySourceFeatures(u,p){const w=this.latestFeatureIndex;if(!w||!w.rawTileData)return;const A=w.loadVTLayers(),N=p?p.sourceLayer:"",_e=A._geojsonTileLayer||A[N];if(!_e)return;const dt=jv(p&&p.filter),{z:ir,x:Cr,y:Gn}=this.tileID.canonical,hs={z:ir,x:Cr,y:Gn};for(let rl=0;rl<_e.length;rl++){const ll=_e.feature(rl);if(dt.needGeometry){const fh=Ox(ll,!0);if(!dt.filter(new Vn(this.tileID.overscaledZ),fh,this.tileID.canonical))continue}else if(!dt.filter(new Vn(this.tileID.overscaledZ),ll))continue;const ul=w.getId(ll,N),th=new vS(ll,ir,Cr,Gn,ul);th.tile=hs,u.push(th)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(u){const p=this.expirationTime;if(u.cacheControl){const w=fp(u.cacheControl);w["max-age"]&&(this.expirationTime=Date.now()+1e3*w["max-age"])}else u.expires&&(this.expirationTime=new Date(u.expires).getTime());if(this.expirationTime){const w=Date.now();let A=!1;if(this.expirationTime>w)A=!1;else if(p)if(this.expirationTime<p)A=!0;else{const N=this.expirationTime-p;N?this.expirationTime=w+Math.max(N,3e4):A=!0}else A=!0;A?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(u,p){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(u).length===0||!p)return;const w=this.latestFeatureIndex.loadVTLayers(),A=p.style.listImages();for(const N in this.buckets){if(!p.style.hasLayer(N))continue;const _e=this.buckets[N],dt=_e.layers[0].sourceLayer||"_geojsonTileLayer",ir=w[dt],Cr=u[dt];if(!ir||!Cr||Object.keys(Cr).length===0)continue;if(_e.update(Cr,ir,A,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_e instanceof um||_e instanceof Xw){const hs=p.style._getSourceCache(_e.layers[0].source);p._terrain&&p._terrain.enabled&&hs&&_e.programConfigurations.needsUpload&&p._terrain._clearRenderCacheForTile(hs.id,this.tileID)}const Gn=p&&p.style&&p.style.getLayer(N);Gn&&(this.queryPadding=Math.max(this.queryPadding,Gn.queryRadius(_e)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<nm.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(u){this.symbolFadeHoldUntil=nm.now()+u}setTexture(u,p){const w=p.context,A=w.gl;this.texture=this.texture||p.getTileTexture(u.width),this.texture?this.texture.update(u,{useMipmap:!0}):(this.texture=new Nb(w,u,A.RGBA,{useMipmap:!0}),this.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE))}setDependencies(u,p){const w={};for(const A of p)w[A]=!0;this.dependencies[u]=w}hasDependency(u,p){for(const w of u){const A=this.dependencies[w];if(A){for(const N of p)if(A[N])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(u,p){if(!p||p.name==="mercator"||this._tileDebugBuffer)return;const w=fv(bS,this.tileID.canonical,this.tileTransform)[0],A=new Bp,N=new uy;for(let _e=0;_e<w.length;_e++){const{x:dt,y:ir}=w[_e];A.emplaceBack(dt,ir),N.emplaceBack(_e)}N.emplaceBack(0),this._tileDebugIndexBuffer=u.createIndexBuffer(N),this._tileDebugBuffer=u.createVertexBuffer(A,Mx.members),this._tileDebugSegments=Kg.simpleSegment(0,0,A.length,N.length)}_makeTileBoundsBuffers(u,p){if(this._tileBoundsBuffer||!p||p.name==="mercator")return;const w=fv(bS,this.tileID.canonical,this.tileTransform)[0];let A,N;if(this.isRaster){const _e=function(dt,ir){const Cr=Jw(dt,ir),Gn=Math.pow(2,dt.z);for(let fh=0;fh<mx;fh++)for(let Ch=0;Ch<mx;Ch++){const zh=zm((dt.x+(Ch+xS(Ch))/s0)/Gn),Eh=bm((dt.y+(fh+xS(fh))/s0)/Gn),Bh=ir.project(zh,Eh),Hh=fh*mx+Ch;yx[2*Hh+0]=Math.round((Bh.x*Cr.scale-Cr.x)*Hd),yx[2*Hh+1]=Math.round((Bh.y*Cr.scale-Cr.y)*Hd)}mw.fill(0),UC.fill(0);for(let fh=2045;fh>=0;fh--){const Ch=4*fh,zh=gw[Ch+0],Eh=gw[Ch+1],Bh=gw[Ch+2],Hh=gw[Ch+3],jh=zh+Bh>>1,cp=Eh+Hh>>1,sp=jh+cp-Eh,Sp=cp+zh-jh,Hp=Eh*mx+zh,mp=Hh*mx+Bh,Dp=cp*mx+jh,Op=Math.hypot((yx[2*Hp+0]+yx[2*mp+0])/2-yx[2*Dp+0],(yx[2*Hp+1]+yx[2*mp+1])/2-yx[2*Dp+1])>=16;mw[Dp]=mw[Dp]||(Op?1:0),fh<1022&&(mw[Dp]=mw[Dp]||mw[(Eh+Sp>>1)*mx+(zh+sp>>1)]||mw[(Hh+Sp>>1)*mx+(Bh+sp>>1)])}const hs=new Tp,rl=new Bd;let ll=0;function ul(fh,Ch){const zh=Ch*mx+fh;return UC[zh]===0&&(hs.emplaceBack(yx[2*zh+0],yx[2*zh+1],fh*Hd/s0,Ch*Hd/s0),UC[zh]=++ll),UC[zh]-1}function th(fh,Ch,zh,Eh,Bh,Hh){const jh=fh+zh>>1,cp=Ch+Eh>>1;if(Math.abs(fh-Bh)+Math.abs(Ch-Hh)>1&&mw[cp*mx+jh])th(Bh,Hh,fh,Ch,jh,cp),th(zh,Eh,Bh,Hh,jh,cp);else{const sp=ul(fh,Ch),Sp=ul(zh,Eh),Hp=ul(Bh,Hh);rl.emplaceBack(sp,Sp,Hp)}}return th(0,0,s0,s0,s0,0),th(s0,s0,0,0,0,s0),{vertices:hs,indices:rl}}(this.tileID.canonical,p);A=_e.vertices,N=_e.indices}else{A=new Tp,N=new Bd;for(const{x:dt,y:ir}of w)A.emplaceBack(dt,ir,0,0);const _e=xb(A.int16,void 0,4);for(let dt=0;dt<_e.length;dt+=3)N.emplaceBack(_e[dt],_e[dt+1],_e[dt+2])}this._tileBoundsBuffer=u.createVertexBuffer(A,wS.members),this._tileBoundsIndexBuffer=u.createIndexBuffer(N),this._tileBoundsSegments=Kg.simpleSegment(0,0,A.length,N.length)}_makeGlobeTileDebugBuffers(u,p){const w=p.projection;if(!w||w.name!=="globe"||p.freezeTileCoverage)return;const A=this.tileID.canonical,N=kw(nb(A,p)),_e=ew(p.zoom);let dt;_e>0&&(dt=Pw(new Float64Array(16),p.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(u,A,p,N,dt,_e),this._makeGlobeTileDebugTextBuffer(u,A,p,N,dt,_e)}_globePoint(u,p,w,A,N,_e,dt){let ir=Nw(u,p,w);if(_e){const Cr=1<<w.z,Gn=am(A.center.lng),hs=M_(A.center.lat),rl=(w.x+.5)/Cr-Gn;let ll=0;rl>.5?ll=-1:rl<-.5&&(ll=1);let ul=(u/Hd+w.x)/Cr+ll,th=(p/Hd+w.y)/Cr;ul=(ul-Gn)*A._pixelsPerMercatorPixel+Gn,th=(th-hs)*A._pixelsPerMercatorPixel+hs;const fh=[ul*A.worldSize,th*A.worldSize,0];sm(fh,fh,_e),ir=A0(ir,fh,dt)}return sm(ir,ir,N)}_makeGlobeTileDebugBorderBuffer(u,p,w,A,N,_e){const dt=new Bp,ir=new uy,Cr=new tp,Gn=(rl,ll,ul,th,fh)=>{const Ch=(ul-rl)/(fh-1),zh=(th-ll)/(fh-1),Eh=dt.length;for(let Bh=0;Bh<fh;Bh++){const Hh=rl+Bh*Ch,jh=ll+Bh*zh;dt.emplaceBack(Hh,jh);const cp=this._globePoint(Hh,jh,p,w,A,N,_e);Cr.emplaceBack(cp[0],cp[1],cp[2]),ir.emplaceBack(Eh+Bh)}},hs=Hd;Gn(0,0,hs,0,16),Gn(hs,0,hs,hs,16),Gn(hs,hs,0,hs,16),Gn(0,hs,0,0,16),this._tileDebugIndexBuffer=u.createIndexBuffer(ir),this._tileDebugBuffer=u.createVertexBuffer(dt,Mx.members),this._globeTileDebugBorderBuffer=u.createVertexBuffer(Cr,tb.members),this._tileDebugSegments=Kg.simpleSegment(0,0,dt.length,ir.length)}_makeGlobeTileDebugTextBuffer(u,p,w,A,N,_e){const dt=Hd/4,ir=new Bp,Cr=new Bd,Gn=new tp,hs=25;Cr.reserve(32),ir.reserve(hs),Gn.reserve(hs);const rl=(ll,ul)=>hs*ll+ul;for(let ll=0;ll<hs;ll++){const ul=ll*dt;for(let th=0;th<hs;th++){const fh=th*dt;ir.emplaceBack(fh,ul);const Ch=this._globePoint(fh,ul,p,w,A,N,_e);Gn.emplaceBack(Ch[0],Ch[1],Ch[2])}}for(let ll=0;ll<4;ll++)for(let ul=0;ul<4;ul++){const th=rl(ll,ul),fh=rl(ll,ul+1),Ch=rl(ll+1,ul),zh=rl(ll+1,ul+1);Cr.emplaceBack(th,fh,Ch),Cr.emplaceBack(Ch,fh,zh)}this._tileDebugTextIndexBuffer=u.createIndexBuffer(Cr),this._tileDebugTextBuffer=u.createVertexBuffer(ir,Mx.members),this._globeTileDebugTextBuffer=u.createVertexBuffer(Gn,tb.members),this._tileDebugTextSegments=Kg.simpleSegment(0,0,hs,32)}}class NT{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(u,p,w){const A=String(p);if(this.stateChanges[u]=this.stateChanges[u]||{},this.stateChanges[u][A]=this.stateChanges[u][A]||{},Cp(this.stateChanges[u][A],w),this.deletedStates[u]===null){this.deletedStates[u]={};for(const N in this.state[u])N!==A&&(this.deletedStates[u][N]=null)}else if(this.deletedStates[u]&&this.deletedStates[u][A]===null){this.deletedStates[u][A]={};for(const N in this.state[u][A])w[N]||(this.deletedStates[u][A][N]=null)}else for(const N in w)this.deletedStates[u]&&this.deletedStates[u][A]&&this.deletedStates[u][A][N]===null&&delete this.deletedStates[u][A][N]}removeFeatureState(u,p,w){if(this.deletedStates[u]===null)return;const A=String(p);if(this.deletedStates[u]=this.deletedStates[u]||{},w&&p!==void 0)this.deletedStates[u][A]!==null&&(this.deletedStates[u][A]=this.deletedStates[u][A]||{},this.deletedStates[u][A][w]=null);else if(p!==void 0)if(this.stateChanges[u]&&this.stateChanges[u][A])for(w in this.deletedStates[u][A]={},this.stateChanges[u][A])this.deletedStates[u][A][w]=null;else this.deletedStates[u][A]=null;else this.deletedStates[u]=null}getState(u,p){const w=String(p),A=Cp({},(this.state[u]||{})[w],(this.stateChanges[u]||{})[w]);if(this.deletedStates[u]===null)return{};if(this.deletedStates[u]){const N=this.deletedStates[u][p];if(N===null)return{};for(const _e in N)delete A[_e]}return A}initializeTileState(u,p){u.setFeatureState(this.state,p)}coalesceChanges(u,p){const w={};for(const A in this.stateChanges){this.state[A]=this.state[A]||{};const N={};for(const _e in this.stateChanges[A])this.state[A][_e]||(this.state[A][_e]={}),Cp(this.state[A][_e],this.stateChanges[A][_e]),N[_e]=this.state[A][_e];w[A]=N}for(const A in this.deletedStates){this.state[A]=this.state[A]||{};const N={};if(this.deletedStates[A]===null)for(const _e in this.state[A])N[_e]={},this.state[A][_e]={};else for(const _e in this.deletedStates[A]){if(this.deletedStates[A][_e]===null)this.state[A][_e]={};else if(this.state[A][_e])for(const dt of Object.keys(this.deletedStates[A][_e]))delete this.state[A][_e][dt];N[_e]=this.state[A][_e]}w[A]=w[A]||{},Cp(w[A],N)}if(this.stateChanges={},this.deletedStates={},Object.keys(w).length!==0)for(const A in u)u[A].setFeatureState(w,p)}}class CS{constructor(u){this.size=u,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(u,p){const w=this.toIdx(u,p);return{min:this.minimums[w],max:this.maximums[w]}}isLeaf(u,p){return this.leaves[this.toIdx(u,p)]}toIdx(u,p){return p*this.size+u}}function ES(c,u,p,w){let A=0,N=Number.MAX_VALUE;for(let _e=0;_e<3;_e++)if(Math.abs(w[_e])<1e-15){if(p[_e]<c[_e]||p[_e]>u[_e])return null}else{const dt=1/w[_e];let ir=(c[_e]-p[_e])*dt,Cr=(u[_e]-p[_e])*dt;if(ir>Cr){const Gn=ir;ir=Cr,Cr=Gn}if(ir>A&&(A=ir),Cr<N&&(N=Cr),A>N)return null}return A}function SS(c,u,p,w,A,N,_e,dt,ir,Cr,Gn){const hs=w-c,rl=A-u,ll=N-p,ul=_e-c,th=dt-u,fh=ir-p,Ch=Gn[1]*fh-Gn[2]*th,zh=Gn[2]*ul-Gn[0]*fh,Eh=Gn[0]*th-Gn[1]*ul,Bh=hs*Ch+rl*zh+ll*Eh;if(Math.abs(Bh)<1e-15)return null;const Hh=1/Bh,jh=Cr[0]-c,cp=Cr[1]-u,sp=Cr[2]-p,Sp=(jh*Ch+cp*zh+sp*Eh)*Hh;if(Sp<0||Sp>1)return null;const Hp=cp*ll-sp*rl,mp=sp*hs-jh*ll,Dp=jh*rl-cp*hs,Op=(Gn[0]*Hp+Gn[1]*mp+Gn[2]*Dp)*Hh;return Op<0||Sp+Op>1?null:(ul*Hp+th*mp+fh*Dp)*Hh}function TS(c,u,p){return(c-u)/(p-u)}function AS(c,u,p,w,A,N,_e,dt,ir){const Cr=1<<p,Gn=N-w,hs=_e-A,rl=(c+1)/Cr*Gn+w,ll=(u+0)/Cr*hs+A,ul=(u+1)/Cr*hs+A;dt[0]=(c+0)/Cr*Gn+w,dt[1]=ll,ir[0]=rl,ir[1]=ul}class RS{constructor(u){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=u,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const p=function(N){const _e=Math.ceil(Math.log2(N.dim/8)),dt=[];let ir=Math.ceil(Math.pow(2,_e));const Cr=1/ir,Gn=(ll,ul,th,fh,Ch)=>{const zh=fh?1:0,Eh=(ll+1)*th-zh,Bh=ul*th,Hh=(ul+1)*th-zh;Ch[0]=ll*th,Ch[1]=Bh,Ch[2]=Eh,Ch[3]=Hh};let hs=new CS(ir);const rl=[];for(let ll=0;ll<ir*ir;ll++){Gn(ll%ir,Math.floor(ll/ir),Cr,!1,rl);const ul=yw(rl[0],rl[1],N),th=yw(rl[2],rl[1],N),fh=yw(rl[2],rl[3],N),Ch=yw(rl[0],rl[3],N);hs.minimums.push(Math.min(ul,th,fh,Ch)),hs.maximums.push(Math.max(ul,th,fh,Ch)),hs.leaves.push(1)}for(dt.push(hs),ir/=2;ir>=1;ir/=2){const ll=dt[dt.length-1];hs=new CS(ir);for(let ul=0;ul<ir*ir;ul++){Gn(ul%ir,Math.floor(ul/ir),2,!0,rl);const th=ll.getElevation(rl[0],rl[1]),fh=ll.getElevation(rl[2],rl[1]),Ch=ll.getElevation(rl[2],rl[3]),zh=ll.getElevation(rl[0],rl[3]),Eh=ll.isLeaf(rl[0],rl[1]),Bh=ll.isLeaf(rl[2],rl[1]),Hh=ll.isLeaf(rl[2],rl[3]),jh=ll.isLeaf(rl[0],rl[3]),cp=Math.min(th.min,fh.min,Ch.min,zh.min),sp=Math.max(th.max,fh.max,Ch.max,zh.max),Sp=Eh&&Bh&&Hh&&jh;hs.maximums.push(sp),hs.minimums.push(cp),hs.leaves.push(sp-cp<=5&&Sp?1:0)}dt.push(hs)}return dt}(this.dem),w=p.length-1,A=p[w];this._addNode(A.minimums[0],A.maximums[0],A.leaves[0]),this._construct(p,0,0,w,0)}raycastRoot(u,p,w,A,N,_e,dt=1){return ES([u,p,-100],[w,A,this.maximums[0]*dt],N,_e)}raycast(u,p,w,A,N,_e,dt=1){if(!this.nodeCount)return null;const ir=this.raycastRoot(u,p,w,A,N,_e,dt);if(ir==null)return null;const Cr=[],Gn=[],hs=[],rl=[],ll=[{idx:0,t:ir,nodex:0,nodey:0,depth:0}];for(;ll.length>0;){const{idx:ul,t:th,nodex:fh,nodey:Ch,depth:zh}=ll.pop();if(this.leaves[ul]){AS(fh,Ch,zh,u,p,w,A,hs,rl);const Bh=1<<zh,Hh=(fh+0)/Bh,jh=(fh+1)/Bh,cp=(Ch+0)/Bh,sp=(Ch+1)/Bh,Sp=yw(Hh,cp,this.dem)*dt,Hp=yw(jh,cp,this.dem)*dt,mp=yw(jh,sp,this.dem)*dt,Dp=yw(Hh,sp,this.dem)*dt,Op=SS(hs[0],hs[1],Sp,rl[0],hs[1],Hp,rl[0],rl[1],mp,N,_e),zp=SS(rl[0],rl[1],mp,hs[0],rl[1],Dp,hs[0],hs[1],Sp,N,_e),Zp=Math.min(Op!==null?Op:Number.MAX_VALUE,zp!==null?zp:Number.MAX_VALUE);if(Zp!==Number.MAX_VALUE)return Zp;{const xp=Zx([],N,_e,th);if(IS(Sp,Hp,Dp,mp,TS(xp[0],hs[0],rl[0]),TS(xp[1],hs[1],rl[1]))>=xp[2])return th}continue}let Eh=0;for(let Bh=0;Bh<this._siblingOffset.length;Bh++){AS((fh<<1)+this._siblingOffset[Bh][0],(Ch<<1)+this._siblingOffset[Bh][1],zh+1,u,p,w,A,hs,rl),hs[2]=-100,rl[2]=this.maximums[this.childOffsets[ul]+Bh]*dt;const Hh=ES(hs,rl,N,_e);if(Hh!=null){const jh=Hh;Cr[Bh]=jh;let cp=!1;for(let sp=0;sp<Eh&&!cp;sp++)jh>=Cr[Gn[sp]]&&(Gn.splice(sp,0,Bh),cp=!0);cp||(Gn[Eh]=Bh),Eh++}}for(let Bh=0;Bh<Eh;Bh++){const Hh=Gn[Bh];ll.push({idx:this.childOffsets[ul]+Hh,t:Cr[Hh],nodex:(fh<<1)+this._siblingOffset[Hh][0],nodey:(Ch<<1)+this._siblingOffset[Hh][1],depth:zh+1})}}return null}_addNode(u,p,w){return this.minimums.push(u),this.maximums.push(p),this.leaves.push(w),this.childOffsets.push(0),this.nodeCount++}_construct(u,p,w,A,N){if(u[A].isLeaf(p,w)===1)return;this.childOffsets[N]||(this.childOffsets[N]=this.nodeCount);const _e=A-1,dt=u[_e];let ir=0,Cr=0;for(let Gn=0;Gn<this._siblingOffset.length;Gn++){const hs=2*p+this._siblingOffset[Gn][0],rl=2*w+this._siblingOffset[Gn][1],ll=dt.getElevation(hs,rl),ul=dt.isLeaf(hs,rl),th=this._addNode(ll.min,ll.max,ul);ul&&(ir|=1<<Gn),Cr||(Cr=th)}for(let Gn=0;Gn<this._siblingOffset.length;Gn++)ir&1<<Gn||this._construct(u,2*p+this._siblingOffset[Gn][0],2*w+this._siblingOffset[Gn][1],_e,Cr+Gn)}}function IS(c,u,p,w,A,N){return jd(jd(c,p,N),jd(u,w,N),A)}function yw(c,u,p){const w=p.dim,A=Jh(c*w-.5,0,w-1),N=Jh(u*w-.5,0,w-1),_e=Math.floor(A),dt=Math.floor(N),ir=Math.min(_e+1,w-1),Cr=Math.min(dt+1,w-1);return IS(p.get(_e,dt),p.get(ir,dt),p.get(_e,Cr),p.get(ir,Cr),A-_e,N-dt)}const PS={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function kT(c,u,p){return(256*c*256+256*u+p)/10-1e4}function BT(c,u,p){return 256*c+u+p/256-32768}class jC{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(u,p,w,A=!1,N=!1){if(this.uid=u,p.height!==p.width)throw new RangeError("DEM tiles must be square");if(w&&w!=="mapbox"&&w!=="terrarium")return Ap(`"${w}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=p.height;const _e=this.dim=p.height-2,dt=new Uint32Array(p.data.buffer);if(this.pixels=new Uint8Array(p.data.buffer),this.encoding=w||"mapbox",this.borderReady=A,!A){for(let ir=0;ir<_e;ir++)dt[this._idx(-1,ir)]=dt[this._idx(0,ir)],dt[this._idx(_e,ir)]=dt[this._idx(_e-1,ir)],dt[this._idx(ir,-1)]=dt[this._idx(ir,0)],dt[this._idx(ir,_e)]=dt[this._idx(ir,_e-1)];dt[this._idx(-1,-1)]=dt[this._idx(0,0)],dt[this._idx(_e,-1)]=dt[this._idx(_e-1,0)],dt[this._idx(-1,_e)]=dt[this._idx(0,_e-1)],dt[this._idx(_e,_e)]=dt[this._idx(_e-1,_e-1)],N&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new RS(this)}get(u,p,w=!1){w&&(u=Jh(u,-1,this.dim),p=Jh(p,-1,this.dim));const A=4*this._idx(u,p);return(this.encoding==="terrarium"?BT:kT)(this.pixels[A],this.pixels[A+1],this.pixels[A+2])}static getUnpackVector(u){return PS[u]}get unpackVector(){return PS[this.encoding]}_idx(u,p){if(u<-1||u>=this.dim+1||p<-1||p>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(p+1)*this.stride+(u+1)}static pack(u,p){const w=[0,0,0,0],A=jC.getUnpackVector(p);let N=Math.floor((u+A[3])/A[2]);return w[2]=N%256,N=Math.floor(N/256),w[1]=N%256,N=Math.floor(N/256),w[0]=N,w}getPixels(){return new My({width:this.stride,height:this.stride},this.pixels)}backfillBorder(u,p,w){if(this.dim!==u.dim)throw new Error("dem dimension mismatch");let A=p*this.dim,N=p*this.dim+this.dim,_e=w*this.dim,dt=w*this.dim+this.dim;switch(p){case-1:A=N-1;break;case 1:N=A+1}switch(w){case-1:_e=dt-1;break;case 1:dt=_e+1}const ir=-p*this.dim,Cr=-w*this.dim;for(let Gn=_e;Gn<dt;Gn++)for(let hs=A;hs<N;hs++){const rl=4*this._idx(hs,Gn),ll=4*this._idx(hs+ir,Gn+Cr);this.pixels[rl+0]=u.pixels[ll+0],this.pixels[rl+1]=u.pixels[ll+1],this.pixels[rl+2]=u.pixels[ll+2],this.pixels[rl+3]=u.pixels[ll+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}vs(jC,"DEMData"),vs(RS,"DemMinMaxQuadTree",{omit:["dem"]});class zT{constructor(u,p){this.max=u,this.onRemove=p,this.reset()}reset(){for(const u in this.data)for(const p of this.data[u])p.timeout&&clearTimeout(p.timeout),this.onRemove(p.value);return this.data={},this.order=[],this}add(u,p,w){const A=u.wrapped().key;this.data[A]===void 0&&(this.data[A]=[]);const N={value:p,timeout:void 0};if(w!==void 0&&(N.timeout=setTimeout(()=>{this.remove(u,N)},w)),this.data[A].push(N),this.order.push(A),this.order.length>this.max){const _e=this._getAndRemoveByKey(this.order[0]);_e&&this.onRemove(_e)}return this}has(u){return u.wrapped().key in this.data}getAndRemove(u){return this.has(u)?this._getAndRemoveByKey(u.wrapped().key):null}_getAndRemoveByKey(u){const p=this.data[u].shift();return p.timeout&&clearTimeout(p.timeout),this.data[u].length===0&&delete this.data[u],this.order.splice(this.order.indexOf(u),1),p.value}getByKey(u){const p=this.data[u];return p?p[0].value:null}get(u){return this.has(u)?this.data[u.wrapped().key][0].value:null}remove(u,p){if(!this.has(u))return this;const w=u.wrapped().key,A=p===void 0?0:this.data[w].indexOf(p),N=this.data[w][A];return this.data[w].splice(A,1),N.timeout&&clearTimeout(N.timeout),this.data[w].length===0&&delete this.data[w],this.onRemove(N.value),this.order.splice(this.order.indexOf(w),1),this}setMaxSize(u){for(this.max=u;this.order.length>this.max;){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}filter(u){const p=[];for(const w in this.data)for(const A of this.data[w])u(A.value)||p.push(A);for(const w of p)this.remove(w.value.tileID,w)}}class $1{constructor(u,p,w){this.func=u,this.mask=p,this.range=w}}$1.ReadOnly=!1,$1.ReadWrite=!0,$1.disabled=new $1(519,$1.ReadOnly,[0,1]);const RE=7680;class IE{constructor(u,p,w,A,N,_e){this.test=u,this.ref=p,this.mask=w,this.fail=A,this.depthFail=N,this.pass=_e}}IE.disabled=new IE({func:519,mask:0},0,0,RE,RE,RE);class _x{constructor(u,p,w){this.blendFunction=u,this.blendColor=p,this.mask=w}}_x.Replace=[1,0],_x.disabled=new _x(_x.Replace,zg.transparent,[!1,!1,!1,!1]),_x.unblended=new _x(_x.Replace,zg.transparent,[!0,!0,!0,!0]),_x.alphaBlended=new _x([1,771],zg.transparent,[!0,!0,!0,!0]);const PE=1029,ME=2305;class N0{constructor(u,p,w){this.enable=u,this.mode=p,this.frontFace=w}}N0.disabled=new N0(!1,PE,ME),N0.backCCW=new N0(!0,PE,ME),N0.backCW=new N0(!0,PE,2304),N0.frontCW=new N0(!0,1028,2304),N0.frontCCW=new N0(!0,1028,ME);class Qw extends fy{constructor(u,p,w){super(),this.id=u,this._onlySymbols=w,p.on("data",A=>{A.dataType==="source"&&A.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&A.dataType==="source"&&A.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),p.on("error",()=>{this._sourceErrored=!0}),this._source=p,this._tiles={},this._cache=new zT(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new NT,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(u){this.map=u,this._minTileCacheSize=this._minTileCacheSize===void 0&&u?u._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&u?u._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const u in this._tiles){const p=this._tiles[u];if(p.state!=="loaded"&&p.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const u=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,u&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(u,p){return u.isSymbolTile=this._onlySymbols,this._source.loadTile(u,p)}_unloadTile(u){if(this._source.unloadTile)return this._source.unloadTile(u,()=>{})}_abortTile(u){if(this._source.abortTile)return this._source.abortTile(u,()=>{})}serialize(){return this._source.serialize()}prepare(u){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const p in this._tiles){const w=this._tiles[p];w.upload(u),w.prepare(this.map.style.imageManager)}}getIds(){return Xp(this._tiles).map(u=>u.tileID).sort(MS).map(u=>u.key)}getRenderableIds(u){const p=[];for(const w in this._tiles)this._isIdRenderable(+w,u)&&p.push(this._tiles[w]);return u?p.sort((w,A)=>{const N=w.tileID,_e=A.tileID,dt=new sl(N.canonical.x,N.canonical.y)._rotate(this.transform.angle),ir=new sl(_e.canonical.x,_e.canonical.y)._rotate(this.transform.angle);return N.overscaledZ-_e.overscaledZ||ir.y-dt.y||ir.x-dt.x}).map(w=>w.tileID.key):p.map(w=>w.tileID).sort(MS).map(w=>w.key)}hasRenderableParent(u){const p=this.findLoadedParent(u,0);return!!p&&this._isIdRenderable(p.tileID.key)}_isIdRenderable(u,p){return this._tiles[u]&&this._tiles[u].hasData()&&!this._coveredTiles[u]&&(p||!this._tiles[u].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const u in this._tiles)this._tiles[u].state!=="errored"&&this._reloadTile(+u,"reloading")}}_reloadTile(u,p){const w=this._tiles[u];w&&(w.state!=="loading"&&(w.state=p),this._loadTile(w,this._tileLoaded.bind(this,w,u,p)))}_tileLoaded(u,p,w,A){if(A)if(u.state="errored",A.status!==404)this._source.fire(new sy(A,{tile:u}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const N=this.map.painter.terrain;this.update(this.transform,N.getScaledDemTileSize(),!0),N.resetTileLookupCache(this.id)}else this.update(this.transform);else u.timeAdded=nm.now(),w==="expired"&&(u.refreshedUponExpiration=!0),this._setTileReloadTimer(p,u),this._source.type==="raster-dem"&&u.dem&&this._backfillDEM(u),this._state.initializeTileState(u,this.map?this.map.painter:null),this._source.fire(new Dg("data",{dataType:"source",tile:u,coord:u.tileID,sourceCacheId:this.id}))}_backfillDEM(u){const p=this.getRenderableIds();for(let A=0;A<p.length;A++){const N=p[A];if(u.neighboringTiles&&u.neighboringTiles[N]){const _e=this.getTileByID(N);w(u,_e),w(_e,u)}}function w(A,N){if(!A.dem||A.dem.borderReady)return;A.needsHillshadePrepare=!0,A.needsDEMTextureUpload=!0;let _e=N.tileID.canonical.x-A.tileID.canonical.x;const dt=N.tileID.canonical.y-A.tileID.canonical.y,ir=Math.pow(2,A.tileID.canonical.z),Cr=N.tileID.key;_e===0&&dt===0||Math.abs(dt)>1||(Math.abs(_e)>1&&(Math.abs(_e+ir)===1?_e+=ir:Math.abs(_e-ir)===1&&(_e-=ir)),N.dem&&A.dem&&(A.dem.backfillBorder(N.dem,_e,dt),A.neighboringTiles&&A.neighboringTiles[Cr]&&(A.neighboringTiles[Cr].backfilled=!0)))}}getTile(u){return this.getTileByID(u.key)}getTileByID(u){return this._tiles[u]}_retainLoadedChildren(u,p,w,A){for(const N in this._tiles){let _e=this._tiles[N];if(A[N]||!_e.hasData()||_e.tileID.overscaledZ<=p||_e.tileID.overscaledZ>w)continue;let dt=_e.tileID;for(;_e&&_e.tileID.overscaledZ>p+1;){const Cr=_e.tileID.scaledTo(_e.tileID.overscaledZ-1);_e=this._tiles[Cr.key],_e&&_e.hasData()&&(dt=Cr)}let ir=dt;for(;ir.overscaledZ>p;)if(ir=ir.scaledTo(ir.overscaledZ-1),u[ir.key]){A[dt.key]=dt;break}}}findLoadedParent(u,p){if(u.key in this._loadedParentTiles){const w=this._loadedParentTiles[u.key];return w&&w.tileID.overscaledZ>=p?w:null}for(let w=u.overscaledZ-1;w>=p;w--){const A=u.scaledTo(w),N=this._getLoadedTile(A);if(N)return N}}_getLoadedTile(u){const p=this._tiles[u.key];return p&&p.hasData()?p:this._cache.getByKey(this._source.reparseOverscaled?u.wrapped().key:u.canonical.key)}updateCacheSize(u,p){p=p||this._source.tileSize;const w=Math.ceil(u.width/p)+1,A=Math.ceil(u.height/p)+1,N=Math.floor(w*A*5),_e=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,N):N,dt=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_e):_e;this._cache.setMaxSize(dt)}handleWrapJump(u){const p=Math.round((u-(this._prevLng===void 0?u:this._prevLng))/360);if(this._prevLng=u,p){const w={};for(const A in this._tiles){const N=this._tiles[A];N.tileID=N.tileID.unwrapTo(N.tileID.wrap+p),w[N.tileID.key]=N}this._tiles=w;for(const A in this._timers)clearTimeout(this._timers[A]),delete this._timers[A];for(const A in this._tiles)this._setTileReloadTimer(+A,this._tiles[A])}}update(u,p,w){if(this.transform=u,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!w)return;let A;this.updateCacheSize(u,p),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?A=u.getVisibleUnwrappedCoordinates(this._source.tileID).map(dt=>new bd(dt.canonical.z,dt.wrap,dt.canonical.z,dt.canonical.x,dt.canonical.y)):(A=u.coveringTiles({tileSize:p||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!w,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(A=A.filter(dt=>this._source.hasTile(dt)))):A=[];const N=this._updateRetainedTiles(A);if(DS(this._source.type)&&A.length!==0){const dt={},ir={},Cr=Object.keys(N);for(const hs of Cr){const rl=N[hs],ll=this._tiles[hs];if(!ll||ll.fadeEndTime&&ll.fadeEndTime<=nm.now())continue;const ul=this.findLoadedParent(rl,Math.max(rl.overscaledZ-Qw.maxOverzooming,this._source.minzoom));ul&&(this._addTile(ul.tileID),dt[ul.tileID.key]=ul.tileID),ir[hs]=rl}const Gn=A[A.length-1].overscaledZ;for(const hs in this._tiles){const rl=this._tiles[hs];if(N[hs]||!rl.hasData())continue;let ll=rl.tileID;for(;ll.overscaledZ>Gn;){ll=ll.scaledTo(ll.overscaledZ-1);const ul=this._tiles[ll.key];if(ul&&ul.hasData()&&ir[ll.key]){N[hs]=rl.tileID;break}}}for(const hs in dt)N[hs]||(this._coveredTiles[hs]=!0,N[hs]=dt[hs])}for(const dt in N)this._tiles[dt].clearFadeHold();const _e=function(dt,ir){const Cr=[];for(const Gn in dt)Gn in ir||Cr.push(Gn);return Cr}(this._tiles,N);for(const dt of _e){const ir=this._tiles[dt];ir.hasSymbolBuckets&&!ir.holdingForFade()?ir.setHoldDuration(this.map._fadeDuration):ir.hasSymbolBuckets&&!ir.symbolFadeFinished()||this._removeTile(+dt)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const u in this._tiles)this._tiles[u].holdingForFade()&&this._removeTile(+u)}_updateRetainedTiles(u){const p={};if(u.length===0)return p;const w={},A=u.reduce((Cr,Gn)=>Math.min(Cr,Gn.overscaledZ),1/0),N=u[0].overscaledZ,_e=Math.max(N-Qw.maxOverzooming,this._source.minzoom),dt=Math.max(N+Qw.maxUnderzooming,this._source.minzoom),ir={};for(const Cr of u){const Gn=this._addTile(Cr);p[Cr.key]=Cr,Gn.hasData()||A<this._source.maxzoom&&(ir[Cr.key]=Cr)}this._retainLoadedChildren(ir,A,dt,p);for(const Cr of u){let Gn=this._tiles[Cr.key];if(Gn.hasData())continue;if(Cr.canonical.z>=this._source.maxzoom){const rl=Cr.children(this._source.maxzoom)[0],ll=this.getTile(rl);if(ll&&ll.hasData()){p[rl.key]=rl;continue}}else{const rl=Cr.children(this._source.maxzoom);if(p[rl[0].key]&&p[rl[1].key]&&p[rl[2].key]&&p[rl[3].key])continue}let hs=Gn.wasRequested();for(let rl=Cr.overscaledZ-1;rl>=_e;--rl){const ll=Cr.scaledTo(rl);if(w[ll.key]||(w[ll.key]=!0,Gn=this.getTile(ll),!Gn&&hs&&(Gn=this._addTile(ll)),Gn&&(p[ll.key]=ll,hs=Gn.wasRequested(),Gn.hasData())))break}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const u in this._tiles){const p=[];let w,A=this._tiles[u].tileID;for(;A.overscaledZ>0;){if(A.key in this._loadedParentTiles){w=this._loadedParentTiles[A.key];break}p.push(A.key);const N=A.scaledTo(A.overscaledZ-1);if(w=this._getLoadedTile(N),w)break;A=N}for(const N of p)this._loadedParentTiles[N]=w}}_addTile(u){let p=this._tiles[u.key];if(p)return p;p=this._cache.getAndRemove(u),p&&(this._setTileReloadTimer(u.key,p),p.tileID=u,this._state.initializeTileState(p,this.map?this.map.painter:null),this._cacheTimers[u.key]&&(clearTimeout(this._cacheTimers[u.key]),delete this._cacheTimers[u.key],this._setTileReloadTimer(u.key,p)));const w=!!p;if(!w){const A=this.map?this.map.painter:null;p=new AE(u,this._source.tileSize*u.overscaleFactor(),this.transform.tileZoom,A,this._isRaster),this._loadTile(p,this._tileLoaded.bind(this,p,u.key,p.state))}return p?(p.uses++,this._tiles[u.key]=p,w||this._source.fire(new Dg("dataloading",{tile:p,coord:p.tileID,dataType:"source"})),p):null}_setTileReloadTimer(u,p){u in this._timers&&(clearTimeout(this._timers[u]),delete this._timers[u]);const w=p.getExpiryTimeout();w&&(this._timers[u]=setTimeout(()=>{this._reloadTile(u,"expired"),delete this._timers[u]},w))}_removeTile(u){const p=this._tiles[u];p&&(p.uses--,delete this._tiles[u],this._timers[u]&&(clearTimeout(this._timers[u]),delete this._timers[u]),p.uses>0||(p.hasData()&&p.state!=="reloading"?this._cache.add(p.tileID,p,p.getExpiryTimeout()):(p.aborted=!0,this._abortTile(p),this._unloadTile(p))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const u in this._tiles)this._removeTile(+u);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(u,p,w){const A=[],N=this.transform;if(!N)return A;const _e=N.projection.name==="globe",dt=am(N.center.lng);for(const ir in this._tiles){const Cr=this._tiles[ir];if(w&&Cr.clearQueryDebugViz(),Cr.holdingForFade())continue;let Gn;if(_e){const hs=Cr.tileID.canonical;if(hs.z===0){const rl=[Math.abs(Jh(dt,...kb(hs,-1))-dt),Math.abs(Jh(dt,...kb(hs,1))-dt)];Gn=[0,2*rl.indexOf(Math.min(...rl))-1]}else{const rl=[Math.abs(Jh(dt,...kb(hs,-1))-dt),Math.abs(Jh(dt,...kb(hs,0))-dt),Math.abs(Jh(dt,...kb(hs,1))-dt)];Gn=[rl.indexOf(Math.min(...rl))-1]}}else Gn=[0];for(const hs of Gn){const rl=u.containsTile(Cr,N,p,hs);rl&&A.push(rl)}}return A}getVisibleCoordinates(u){const p=this.getRenderableIds(u).map(w=>this._tiles[w].tileID);for(const w of p)w.projMatrix=this.transform.calculateProjMatrix(w.toUnwrapped());return p}hasTransition(){if(this._source.hasTransition())return!0;if(DS(this._source.type))for(const u in this._tiles){const p=this._tiles[u];if(p.fadeEndTime!==void 0&&p.fadeEndTime>=nm.now())return!0}return!1}setFeatureState(u,p,w){this._state.updateState(u=u||"_geojsonTileLayer",p,w)}removeFeatureState(u,p,w){this._state.removeFeatureState(u=u||"_geojsonTileLayer",p,w)}getFeatureState(u,p){return this._state.getState(u=u||"_geojsonTileLayer",p)}setDependencies(u,p,w){const A=this._tiles[u];A&&A.setDependencies(p,w)}reloadTilesForDependencies(u,p){for(const w in this._tiles)this._tiles[w].hasDependency(u,p)&&this._reloadTile(+w,"reloading");this._cache.filter(w=>!w.hasDependency(u,p))}_preloadTiles(u,p){if(!this._sourceLoaded){const dt=()=>{this._sourceLoaded&&(this._source.off("data",dt),this._preloadTiles(u,p))};return void this._source.on("data",dt)}const w=new Map,A=Array.isArray(u)?u:[u],N=this.map.painter.terrain,_e=this.usedForTerrain&&N?N.getScaledDemTileSize():this._source.tileSize;for(const dt of A){const ir=dt.coveringTiles({tileSize:_e,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const Cr of ir)w.set(Cr.key,Cr);this.usedForTerrain&&dt.updateElevation(!1)}$p(Array.from(w.values()),(dt,ir)=>{const Cr=new AE(dt,this._source.tileSize*dt.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(Cr,Gn=>{this._source.type==="raster-dem"&&Cr.dem&&this._backfillDEM(Cr),ir(Gn,Cr)})},p)}}function MS(c,u){const p=Math.abs(2*c.wrap)-+(c.wrap<0),w=Math.abs(2*u.wrap)-+(u.wrap<0);return c.overscaledZ-u.overscaledZ||w-p||u.canonical.y-c.canonical.y||u.canonical.x-c.canonical.x}function DS(c){return c==="raster"||c==="image"||c==="video"||c==="custom"}function kb(c,u){const p=1<<c.z;return[c.x/p+u,(c.x+1)/p+u]}Qw.maxOverzooming=10,Qw.maxUnderzooming=3;class HC{constructor(u,p,w){this._demTile=u,this._dem=this._demTile.dem,this._scale=p,this._offset=w}static create(u,p,w){const A=w||u.findDEMTileFor(p);if(!A||!A.dem)return;const N=A.dem,_e=A.tileID,dt=1<<p.canonical.z-_e.canonical.z;return new HC(A,A.tileSize/Hd/dt,[(p.canonical.x/dt-_e.canonical.x)*N.dim,(p.canonical.y/dt-_e.canonical.y)*N.dim])}tileCoordToPixel(u,p){const w=p*this._scale+this._offset[1],A=Math.floor(u*this._scale+this._offset[0]),N=Math.floor(w);return new sl(A,N)}getElevationAt(u,p,w,A){const N=u*this._scale+this._offset[0],_e=p*this._scale+this._offset[1],dt=Math.floor(N),ir=Math.floor(_e),Cr=this._dem;return A=!!A,w?jd(jd(Cr.get(dt,ir,A),Cr.get(dt,ir+1,A),_e-ir),jd(Cr.get(dt+1,ir,A),Cr.get(dt+1,ir+1,A),_e-ir),N-dt):Cr.get(dt,ir,A)}getElevationAtPixel(u,p,w){return this._dem.get(u,p,!!w)}getMeterToDEM(u){return(1<<this._demTile.tileID.canonical.z)*D_(1,u)*this._dem.stride}}class LS{constructor(u,p){this.tileID=u,this.x=u.canonical.x,this.y=u.canonical.y,this.z=u.canonical.z,this.grid=new ds(Hd,16,0),this.featureIndexArray=new Zv,this.promoteId=p}insert(u,p,w,A,N,_e=0){const dt=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(w,A,N,_e);const ir=this.grid;for(let Cr=0;Cr<p.length;Cr++){const Gn=p[Cr],hs=[1/0,1/0,-1/0,-1/0];for(let rl=0;rl<Gn.length;rl++){const ll=Gn[rl];hs[0]=Math.min(hs[0],ll.x),hs[1]=Math.min(hs[1],ll.y),hs[2]=Math.max(hs[2],ll.x),hs[3]=Math.max(hs[3],ll.y)}hs[0]<Hd&&hs[1]<Hd&&hs[2]>=0&&hs[3]>=0&&ir.insert(dt,hs[0],hs[1],hs[2],hs[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new S(new O1(this.rawTileData)).layers,this.sourceLayerCoder=new _S(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const u in this.vtLayers)this.vtFeatures[u]=[]}return this.vtLayers}query(u,p,w,A){this.loadVTLayers();const N=u.params||{},_e=jv(N.filter),dt=u.tileResult,ir=u.transform,Cr=dt.bufferedTilespaceBounds,Gn=this.grid.query(Cr.min.x,Cr.min.y,Cr.max.x,Cr.max.y,(ul,th,fh,Ch)=>x1(dt.bufferedTilespaceGeometry,ul,th,fh,Ch));Gn.sort(GT);let hs=null;ir.elevation&&Gn.length>0&&(hs=HC.create(ir.elevation,this.tileID));const rl={};let ll;for(let ul=0;ul<Gn.length;ul++){const th=Gn[ul];if(th===ll)continue;ll=th;const fh=this.featureIndexArray.get(th);let Ch=null;this.loadMatchingFeature(rl,fh,_e,N.layers,N.availableImages,p,w,A,(zh,Eh,Bh,Hh=0)=>(Ch||(Ch=fv(zh,this.tileID.canonical,u.tileTransform)),Eh.queryIntersectsFeature(dt,zh,Bh,Ch,this.z,u.transform,u.pixelPosMatrix,hs,Hh)))}return rl}loadMatchingFeature(u,p,w,A,N,_e,dt,ir,Cr){const{featureIndex:Gn,bucketIndex:hs,sourceLayerIndex:rl,layoutVertexArrayOffset:ll}=p,ul=this.bucketLayerIDs[hs];if(A&&!function(zh,Eh){for(let Bh=0;Bh<zh.length;Bh++)if(Eh.indexOf(zh[Bh])>=0)return!0;return!1}(A,ul))return;const th=this.sourceLayerCoder.decode(rl),fh=this.vtLayers[th].feature(Gn);if(w.needGeometry){const zh=Ox(fh,!0);if(!w.filter(new Vn(this.tileID.overscaledZ),zh,this.tileID.canonical))return}else if(!w.filter(new Vn(this.tileID.overscaledZ),fh))return;const Ch=this.getId(fh,th);for(let zh=0;zh<ul.length;zh++){const Eh=ul[zh];if(A&&A.indexOf(Eh)<0)continue;const Bh=_e[Eh];if(!Bh)continue;let Hh={};Ch!==void 0&&ir&&(Hh=ir.getState(Bh.sourceLayer||"_geojsonTileLayer",Ch));const jh=Cp({},dt[Eh]);jh.paint=FS(jh.paint,Bh.paint,fh,Hh,N),jh.layout=FS(jh.layout,Bh.layout,fh,Hh,N);const cp=!Cr||Cr(fh,Bh,Hh,ll);if(!cp)continue;const sp=new vS(fh,this.z,this.x,this.y,Ch);sp.layer=jh;let Sp=u[Eh];Sp===void 0&&(Sp=u[Eh]=[]),Sp.push({featureIndex:Gn,feature:sp,intersectionZ:cp})}}lookupSymbolFeatures(u,p,w,A,N,_e,dt,ir){const Cr={};this.loadVTLayers();const Gn=jv(N);for(const hs of u)this.loadMatchingFeature(Cr,{bucketIndex:w,sourceLayerIndex:A,featureIndex:hs,layoutVertexArrayOffset:0},Gn,_e,dt,ir,p);return Cr}loadFeature(u){const{featureIndex:p,sourceLayerIndex:w}=u;this.loadVTLayers();const A=this.sourceLayerCoder.decode(w),N=this.vtFeatures[A];if(N[p])return N[p];const _e=this.vtLayers[A].feature(p);return N[p]=_e,_e}hasLayer(u){for(const p of this.bucketLayerIDs)for(const w of p)if(u===w)return!0;return!1}getId(u,p){let w=u.id;if(this.promoteId){const A=typeof this.promoteId=="string"?this.promoteId:this.promoteId[p];A!=null&&(w=u.properties[A]),typeof w=="boolean"&&(w=Number(w))}return w}}function FS(c,u,p,w,A){return Kp(c,(N,_e)=>{const dt=u instanceof xh?u.get(_e):null;return dt&&dt.evaluate?dt.evaluate(p,w,A):dt})}function GT(c,u){return u-c}vs(LS,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class NS{constructor(u,p){this.width=u,this.height=p,this.nextRow=0,this.image=new t0({width:u,height:p}),this.positions={},this.uploaded=!1}getDash(u,p){const w=this.getKey(u,p);return this.positions[w]}trim(){const u=this.width,p=this.height=Wp(this.nextRow);this.image.resize({width:u,height:p})}getKey(u,p){return u.join(",")+p}getDashRanges(u,p,w){const A=[];let N=u.length%2==1?-u[u.length-1]*w:0,_e=u[0]*w,dt=!0;A.push({left:N,right:_e,isDash:dt,zeroLength:u[0]===0});let ir=u[0];for(let Cr=1;Cr<u.length;Cr++){dt=!dt;const Gn=u[Cr];N=ir*w,ir+=Gn,_e=ir*w,A.push({left:N,right:_e,isDash:dt,zeroLength:Gn===0})}return A}addRoundDash(u,p,w){const A=p/2;for(let N=-w;N<=w;N++){const _e=this.width*(this.nextRow+w+N);let dt=0,ir=u[dt];for(let Cr=0;Cr<this.width;Cr++){Cr/ir.right>1&&(ir=u[++dt]);const Gn=Math.abs(Cr-ir.left),hs=Math.abs(Cr-ir.right),rl=Math.min(Gn,hs);let ll;const ul=N/w*(A+1);if(ir.isDash){const th=A-Math.abs(ul);ll=Math.sqrt(rl*rl+th*th)}else ll=A-Math.sqrt(rl*rl+ul*ul);this.image.data[_e+Cr]=Math.max(0,Math.min(255,ll+128))}}}addRegularDash(u,p){for(let ir=u.length-1;ir>=0;--ir){const Cr=u[ir],Gn=u[ir+1];Cr.zeroLength?u.splice(ir,1):Gn&&Gn.isDash===Cr.isDash&&(Gn.left=Cr.left,u.splice(ir,1))}const w=u[0],A=u[u.length-1];w.isDash===A.isDash&&(w.left=A.left-this.width,A.right=w.right+this.width);const N=this.width*this.nextRow;let _e=0,dt=u[_e];for(let ir=0;ir<this.width;ir++){ir/dt.right>1&&(dt=u[++_e]);const Cr=Math.abs(ir-dt.left),Gn=Math.abs(ir-dt.right),hs=Math.min(Cr,Gn);this.image.data[N+ir]=Math.max(0,Math.min(255,(dt.isDash?hs:-hs)+p+128))}}addDash(u,p){const w=this.getKey(u,p);if(this.positions[w])return this.positions[w];const A=p==="round",N=A?7:0,_e=2*N+1;if(this.nextRow+_e>this.height)return Ap("LineAtlas out of space"),null;u.length===0&&u.push(1);let dt=0;for(let Gn=0;Gn<u.length;Gn++)u[Gn]<0&&(Ap("Negative value is found in line dasharray, replacing values with 0"),u[Gn]=0),dt+=u[Gn];if(dt!==0){const Gn=this.width/dt,hs=this.getDashRanges(u,this.width,Gn);A?this.addRoundDash(hs,Gn,N):this.addRegularDash(hs,p==="square"?.5*Gn:0)}const ir=this.nextRow+N;this.nextRow+=_e;const Cr={tl:[ir,N],br:[dt,0]};return this.positions[w]=Cr,Cr}}vs(NS,"LineAtlas");const kS=1*F0;class BS{constructor(u){const p={},w=[];for(const dt in u){const ir=u[dt],Cr=p[dt]={};for(const Gn in ir.glyphs){const hs=ir.glyphs[+Gn];if(!hs||hs.bitmap.width===0||hs.bitmap.height===0)continue;const rl=hs.metrics.localGlyph?kS:1,ll={x:0,y:0,w:hs.bitmap.width+2*rl,h:hs.bitmap.height+2*rl};w.push(ll),Cr[Gn]=ll}}const{w:A,h:N}=kx(w),_e=new t0({width:A||1,height:N||1});for(const dt in u){const ir=u[dt];for(const Cr in ir.glyphs){const Gn=ir.glyphs[+Cr];if(!Gn||Gn.bitmap.width===0||Gn.bitmap.height===0)continue;const hs=p[dt][Cr],rl=Gn.metrics.localGlyph?kS:1;t0.copy(Gn.bitmap,_e,{x:0,y:0},{x:hs.x+rl,y:hs.y+rl},Gn.bitmap)}}this.image=_e,this.positions=p}}vs(BS,"GlyphAtlas");class VT{constructor(u){this.tileID=new bd(u.tileID.overscaledZ,u.tileID.wrap,u.tileID.canonical.z,u.tileID.canonical.x,u.tileID.canonical.y),this.tileZoom=u.tileZoom,this.uid=u.uid,this.zoom=u.zoom,this.canonical=u.tileID.canonical,this.pixelRatio=u.pixelRatio,this.tileSize=u.tileSize,this.source=u.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=u.showCollisionBoxes,this.collectResourceTiming=!!u.collectResourceTiming,this.returnDependencies=!!u.returnDependencies,this.promoteId=u.promoteId,this.enableTerrain=!!u.enableTerrain,this.isSymbolTile=u.isSymbolTile,this.tileTransform=Jw(u.tileID.canonical,u.projection),this.projection=u.projection}parse(u,p,w,A,N){this.status="parsing",this.data=u,this.collisionBoxArray=new Ag;const _e=new _S(Object.keys(u.layers).sort()),dt=new LS(this.tileID,this.promoteId);dt.bucketLayerIDs=[];const ir={},Cr=new NS(256,256),Gn={featureIndex:dt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Cr,availableImages:w},hs=p.familiesBySource[this.source];for(const Hh in hs){const jh=u.layers[Hh];if(!jh)continue;let cp=!1,sp=!1;for(const mp of hs[Hh])mp[0].type==="symbol"?cp=!0:sp=!0;if(this.isSymbolTile===!0&&!cp||this.isSymbolTile===!1&&!sp)continue;jh.version===1&&Ap(`Vector tile source "${this.source}" layer "${Hh}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Sp=_e.encode(Hh),Hp=[];for(let mp=0;mp<jh.length;mp++){const Dp=jh.feature(mp),Op=dt.getId(Dp,Hh);Hp.push({feature:Dp,id:Op,index:mp,sourceLayerIndex:Sp})}for(const mp of hs[Hh]){const Dp=mp[0];this.isSymbolTile!==void 0&&Dp.type==="symbol"!==this.isSymbolTile||Dp.minzoom&&this.zoom<Math.floor(Dp.minzoom)||Dp.maxzoom&&this.zoom>=Dp.maxzoom||Dp.visibility!=="none"&&(DE(mp,this.zoom,w),(ir[Dp.id]=Dp.createBucket({index:dt.bucketLayerIDs.length,layers:mp,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Sp,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:w})).populate(Hp,Gn,this.tileID.canonical,this.tileTransform),dt.bucketLayerIDs.push(mp.map(Op=>Op.id)))}}let rl,ll,ul,th;Cr.trim();const fh={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ch=()=>{if(rl)return N(rl);if(ll&&ul&&th){const Hh=new BS(ll),jh=new gx(ul,th);for(const cp in ir){const sp=ir[cp];sp instanceof fw?(DE(sp.layers,this.zoom,w),dT(sp,ll,Hh.positions,ul,jh.iconPositions,this.showCollisionBoxes,w,this.tileID.canonical,this.tileZoom,this.projection)):sp.hasPattern&&(sp instanceof um||sp instanceof Xw||sp instanceof hl)&&(DE(sp.layers,this.zoom,w),sp.addFeatures(Gn,this.tileID.canonical,jh.patternPositions,w,this.tileTransform))}this.status="done",N(null,{buckets:Xp(ir).filter(cp=>!cp.isEmpty()),featureIndex:dt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Hh.image,lineAtlas:Cr,imageAtlas:jh,glyphMap:this.returnDependencies?ll:null,iconMap:this.returnDependencies?ul:null,glyphPositions:this.returnDependencies?Hh.positions:null})}},zh=Kp(Gn.glyphDependencies,Hh=>Object.keys(Hh).map(Number));Object.keys(zh).length?A.send("getGlyphs",{uid:this.uid,stacks:zh},(Hh,jh)=>{rl||(rl=Hh,ll=jh,Ch())},void 0,!1,fh):ll={};const Eh=Object.keys(Gn.iconDependencies);Eh.length?A.send("getImages",{icons:Eh,source:this.source,tileID:this.tileID,type:"icons"},(Hh,jh)=>{rl||(rl=Hh,ul=jh,Ch())},void 0,!1,fh):ul={};const Bh=Object.keys(Gn.patternDependencies);Bh.length?A.send("getImages",{icons:Bh,source:this.source,tileID:this.tileID,type:"patterns"},(Hh,jh)=>{rl||(rl=Hh,th=jh,Ch())},void 0,!1,fh):th={},Ch()}}function DE(c,u,p){const w=new Vn(u);for(const A of c)A.recalculate(w,p)}class zS{constructor(u){this.entries={},this.scheduler=u}request(u,p,w,A){const N=this.entries[u]=this.entries[u]||{callbacks:[]};if(N.result){const[_e,dt]=N.result;return this.scheduler?this.scheduler.add(()=>{A(_e,dt)},p):A(_e,dt),()=>{}}return N.callbacks.push(A),N.cancel||(N.cancel=w((_e,dt)=>{N.result=[_e,dt];for(const ir of N.callbacks)this.scheduler?this.scheduler.add(()=>{ir(_e,dt)},p):ir(_e,dt);setTimeout(()=>delete this.entries[u],3e3)})),()=>{N.result||(N.callbacks=N.callbacks.filter(_e=>_e!==A),N.callbacks.length||(N.cancel(),delete this.entries[u]))}}}function GS(c,u,p){const w=JSON.stringify(c.request);return c.data&&(this.deduped.entries[w]={result:[null,c.data]}),this.deduped.request(w,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom},A=>{const N=ng(c.request,(_e,dt,ir,Cr)=>{_e?A(_e):dt&&A(null,{vectorTile:p?void 0:new S(new O1(dt)),rawData:dt,cacheControl:ir,expires:Cr})});return()=>{N.cancel(),A()}},u)}const VS=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class OE{static from(u){if(!(u instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[p,w]=new Uint8Array(u,0,2);if(p!==219)throw new Error("Data does not appear to be in a KDBush format.");const A=w>>4;if(A!==1)throw new Error(`Got v${A} data when expected v1.`);const N=VS[15&w];if(!N)throw new Error("Unrecognized array type.");const[_e]=new Uint16Array(u,2,1),[dt]=new Uint32Array(u,4,1);return new OE(dt,_e,N,u)}constructor(u,p=64,w=Float64Array,A){if(isNaN(u)||u<0)throw new Error(`Unpexpected numItems value: ${u}.`);this.numItems=+u,this.nodeSize=Math.min(Math.max(+p,2),65535),this.ArrayType=w,this.IndexArrayType=u<65536?Uint16Array:Uint32Array;const N=VS.indexOf(this.ArrayType),_e=2*u*this.ArrayType.BYTES_PER_ELEMENT,dt=u*this.IndexArrayType.BYTES_PER_ELEMENT,ir=(8-dt%8)%8;if(N<0)throw new Error(`Unexpected typed array class: ${w}.`);A&&A instanceof ArrayBuffer?(this.data=A,this.ids=new this.IndexArrayType(this.data,8,u),this.coords=new this.ArrayType(this.data,8+dt+ir,2*u),this._pos=2*u,this._finished=!0):(this.data=new ArrayBuffer(8+_e+dt+ir),this.ids=new this.IndexArrayType(this.data,8,u),this.coords=new this.ArrayType(this.data,8+dt+ir,2*u),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+N]),new Uint16Array(this.data,2,1)[0]=p,new Uint32Array(this.data,4,1)[0]=u)}add(u,p){const w=this._pos>>1;return this.ids[w]=w,this.coords[this._pos++]=u,this.coords[this._pos++]=p,w}finish(){const u=this._pos>>1;if(u!==this.numItems)throw new Error(`Added ${u} items when expected ${this.numItems}.`);return LE(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(u,p,w,A){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:N,coords:_e,nodeSize:dt}=this,ir=[0,N.length-1,0],Cr=[];for(;ir.length;){const Gn=ir.pop()||0,hs=ir.pop()||0,rl=ir.pop()||0;if(hs-rl<=dt){for(let fh=rl;fh<=hs;fh++){const Ch=_e[2*fh],zh=_e[2*fh+1];Ch>=u&&Ch<=w&&zh>=p&&zh<=A&&Cr.push(N[fh])}continue}const ll=rl+hs>>1,ul=_e[2*ll],th=_e[2*ll+1];ul>=u&&ul<=w&&th>=p&&th<=A&&Cr.push(N[ll]),(Gn===0?u<=ul:p<=th)&&(ir.push(rl),ir.push(ll-1),ir.push(1-Gn)),(Gn===0?w>=ul:A>=th)&&(ir.push(ll+1),ir.push(hs),ir.push(1-Gn))}return Cr}within(u,p,w){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:A,coords:N,nodeSize:_e}=this,dt=[0,A.length-1,0],ir=[],Cr=w*w;for(;dt.length;){const Gn=dt.pop()||0,hs=dt.pop()||0,rl=dt.pop()||0;if(hs-rl<=_e){for(let fh=rl;fh<=hs;fh++)US(N[2*fh],N[2*fh+1],u,p)<=Cr&&ir.push(A[fh]);continue}const ll=rl+hs>>1,ul=N[2*ll],th=N[2*ll+1];US(ul,th,u,p)<=Cr&&ir.push(A[ll]),(Gn===0?u-w<=ul:p-w<=th)&&(dt.push(rl),dt.push(ll-1),dt.push(1-Gn)),(Gn===0?u+w>=ul:p+w>=th)&&(dt.push(ll+1),dt.push(hs),dt.push(1-Gn))}return ir}}function LE(c,u,p,w,A,N){if(A-w<=p)return;const _e=w+A>>1;$S(c,u,_e,w,A,N),LE(c,u,p,w,_e-1,1-N),LE(c,u,p,_e+1,A,1-N)}function $S(c,u,p,w,A,N){for(;A>w;){if(A-w>600){const Cr=A-w+1,Gn=p-w+1,hs=Math.log(Cr),rl=.5*Math.exp(2*hs/3),ll=.5*Math.sqrt(hs*rl*(Cr-rl)/Cr)*(Gn-Cr/2<0?-1:1);$S(c,u,p,Math.max(w,Math.floor(p-Gn*rl/Cr+ll)),Math.min(A,Math.floor(p+(Cr-Gn)*rl/Cr+ll)),N)}const _e=u[2*p+N];let dt=w,ir=A;for(Bb(c,u,w,p),u[2*A+N]>_e&&Bb(c,u,w,A);dt<ir;){for(Bb(c,u,dt,ir),dt++,ir--;u[2*dt+N]<_e;)dt++;for(;u[2*ir+N]>_e;)ir--}u[2*w+N]===_e?Bb(c,u,w,ir):(ir++,Bb(c,u,ir,A)),ir<=p&&(w=ir+1),p<=ir&&(A=ir-1)}}function Bb(c,u,p,w){FE(c,p,w),FE(u,2*p,2*w),FE(u,2*p+1,2*w+1)}function FE(c,u,p){const w=c[u];c[u]=c[p],c[p]=w}function US(c,u,p,w){const A=c-p,N=u-w;return A*A+N*N}a.ARRAY_TYPE=Vy,a.AUTH_ERR_MSG=Oh,a.Aabb=by,a.Actor=class{constructor(c,u,p){this.target=c,this.parent=u,this.mapId=p,this.callbacks={},this.cancelCallbacks={},ed(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=id()?c:h,this.scheduler=new LT}send(c,u,p,w,A=!1,N){const _e=Math.round(1e18*Math.random()).toString(36).substring(0,10);p&&(p.metadata=N,this.callbacks[_e]=p);const dt=Fd(this.globalScope)?void 0:[];return this.target.postMessage({id:_e,type:c,hasCallback:!!p,targetMapId:w,mustQueue:A,sourceMapId:this.mapId,data:ph(u,dt)},dt),{cancel:()=>{p&&delete this.callbacks[_e],this.target.postMessage({id:_e,type:"<cancel>",targetMapId:w,sourceMapId:this.mapId})}}}receive(c){const u=c.data,p=u.id;if(p&&(!u.targetMapId||this.mapId===u.targetMapId))if(u.type==="<cancel>"){const w=this.cancelCallbacks[p];delete this.cancelCallbacks[p],w&&w.cancel()}else if(u.mustQueue||id()){const w=this.callbacks[p];this.cancelCallbacks[p]=this.scheduler.add(()=>this.processTask(p,u),w&&w.metadata||{type:"message"})}else this.processTask(p,u)}processTask(c,u){if(u.type==="<response>"){const p=this.callbacks[c];delete this.callbacks[c],p&&(u.error?p(Ah(u.error)):p(null,Ah(u.data)))}else{const p=Fd(this.globalScope)?void 0:[],w=u.hasCallback?(N,_e)=>{delete this.cancelCallbacks[c],this.target.postMessage({id:c,type:"<response>",sourceMapId:this.mapId,error:N?ph(N):null,data:ph(_e,p)},p)}:N=>{},A=Ah(u.data);if(this.parent[u.type])this.parent[u.type](u.sourceMapId,A,w);else if(this.parent.getWorkerSource){const N=u.type.split(".");this.parent.getWorkerSource(u.sourceMapId,N[0],A.source)[N[1]](A,w)}else w(new Error(`Could not find function ${u.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.CanonicalTileID=Mp,a.Color=zg,a.ColorMode=_x,a.CullFaceMode=N0,a.DEMData=jC,a.DataConstantProperty=yl,a.DedupedRequest=zS,a.DepthMode=$1,a.EXTENT=Hd,a.Elevation=class{isDataAvailableAtPoint(c){const u=this._source();if(this.isUsingMockSource()||!u||c.y<0||c.y>1)return!1;const p=u.getSource().maxzoom,w=1<<p,A=Math.floor(c.x),N=Math.floor((c.x-A)*w),_e=Math.floor(c.y*w),dt=this.findDEMTileFor(new bd(p,A,p,N,_e));return!(!dt||!dt.dem)}getAtPointOrZero(c,u=0){return this.getAtPoint(c,u)||0}getAtPoint(c,u,p=!0){if(this.isUsingMockSource())return null;u==null&&(u=null);const w=this._source();if(!w||c.y<0||c.y>1)return u;const A=w.getSource().maxzoom,N=1<<A,_e=Math.floor(c.x),dt=c.x-_e,ir=new bd(A,_e,A,Math.floor(dt*N),Math.floor(c.y*N)),Cr=this.findDEMTileFor(ir);if(!Cr||!Cr.dem)return u;const Gn=Cr.dem,hs=1<<Cr.tileID.canonical.z,rl=(dt*hs-Cr.tileID.canonical.x)*Gn.dim,ll=(c.y*hs-Cr.tileID.canonical.y)*Gn.dim,ul=Math.floor(rl),th=Math.floor(ll);return(p?this.exaggeration():1)*jd(jd(Gn.get(ul,th),Gn.get(ul,th+1),ll-th),jd(Gn.get(ul+1,th),Gn.get(ul+1,th+1),ll-th),rl-ul)}getAtTileOffset(c,u,p){const w=1<<c.canonical.z;return this.getAtPointOrZero(new P0(c.wrap+(c.canonical.x+u/Hd)/w,(c.canonical.y+p/Hd)/w))}getAtTileOffsetFunc(c,u,p,w){return A=>{const N=this.getAtTileOffset(c,A.x,A.y),_e=w.upVector(c.canonical,A.x,A.y);return $y(_e,_e,N*w.upVectorScale(c.canonical,u,p).metersToTile),_e}}getForTilePoints(c,u,p,w){if(this.isUsingMockSource())return!1;const A=HC.create(this,c,w);return!!A&&(u.forEach(N=>{N[2]=this.exaggeration()*A.getElevationAt(N[0],N[1],p)}),!0)}getMinMaxForTile(c){if(this.isUsingMockSource())return null;const u=this.findDEMTileFor(c);if(!u||!u.dem)return null;const p=u.dem.tree,w=u.tileID,A=1<<c.canonical.z-w.canonical.z;let N=c.canonical.x/A-w.canonical.x,_e=c.canonical.y/A-w.canonical.y,dt=0;for(let ir=0;ir<c.canonical.z-w.canonical.z&&!p.leaves[dt];ir++){N*=2,_e*=2;const Cr=2*Math.floor(_e)+Math.floor(N);dt=p.childOffsets[dt]+Cr,N%=1,_e%=1}return{min:this.exaggeration()*p.minimums[dt],max:this.exaggeration()*p.maximums[dt]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(c,u,p){throw new Error("Pure virtual method called.")}pointCoordinate(c){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(c){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},a.ErrorEvent=sy,a.EvaluationParameters=Vn,a.Event=Dg,a.Evented=fy,a.FillExtrusionBucket=hl,a.Frustum=h1,a.FrustumCorners=c1,a.GLOBE_RADIUS=e0,a.GLOBE_SCALE_MATCH_LATITUDE=45,a.GLOBE_ZOOM_THRESHOLD_MAX=rb,a.GLOBE_ZOOM_THRESHOLD_MIN=Xx,a.GlobeSharedBuffers=class{constructor(c){this._createGrid(c),this._createPoles(c)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const c of this._poleSegments)c.destroy();for(const c of this._gridSegments)c.withSkirts.destroy(),c.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const c of this._wireframeSegments)c.destroy()}}_fillGridMeshWithLods(c,u){const p=new Bp,w=new Bd,A=[],N=c+1+2,_e=u[0]+1,dt=u[0]+1+(1+u.length),ir=(Cr,Gn,hs)=>{let rl=Cr===N-1?Cr-2:Cr===0?Cr:Cr-1;return rl+=hs?24575:0,[rl,Gn]};for(let Cr=0;Cr<N;++Cr)p.emplaceBack(...ir(Cr,0,!0));for(let Cr=0;Cr<_e;++Cr)for(let Gn=0;Gn<N;++Gn)p.emplaceBack(...ir(Gn,Cr,(Gn===0||Gn===N-1)&&!0));for(let Cr=0;Cr<u.length;++Cr){const Gn=u[Cr];for(let hs=0;hs<N;++hs)p.emplaceBack(...ir(hs,Gn,!0))}for(let Cr=0;Cr<u.length;++Cr){const Gn=w.length,hs=u[Cr]+1+2,rl=new Bd;for(let th=0;th<hs-1;th++){const fh=th===hs-2,Ch=fh?N*(dt-u.length+Cr-th):N;for(let zh=0;zh<N-1;zh++){const Eh=th*N+zh;th===0||fh||zh===0||zh===N-2?(rl.emplaceBack(Eh+1,Eh,Eh+Ch),rl.emplaceBack(Eh+Ch,Eh+Ch+1,Eh+1)):(w.emplaceBack(Eh+1,Eh,Eh+Ch),w.emplaceBack(Eh+Ch,Eh+Ch+1,Eh+1))}}const ll=Kg.simpleSegment(0,Gn,p.length,w.length-Gn);for(let th=0;th<rl.uint16.length;th+=3)w.emplaceBack(rl.uint16[th],rl.uint16[th+1],rl.uint16[th+2]);const ul=Kg.simpleSegment(0,Gn,p.length,w.length-Gn);A.push({withoutSkirts:ll,withSkirts:ul})}return{vertices:p,indices:w,segments:A}}_createGrid(c){const u=this._fillGridMeshWithLods(Dx,Yx);this._gridSegments=u.segments,this._gridBuffer=c.createVertexBuffer(u.vertices,Mx.members),this._gridIndexBuffer=c.createIndexBuffer(u.indices,!0)}_createPoles(c){const u=new Bd;for(let A=0;A<=Dx;A++)u.emplaceBack(0,A+1,A+2);this._poleIndexBuffer=c.createIndexBuffer(u,!0);const p=new gg,w=new gg;this._poleSegments=[];for(let A=0,N=0;A<Xx;A++){const _e=360/(1<<A);p.emplaceBack(0,-e0,0,.5,0),w.emplaceBack(0,-e0,0,.5,1);for(let dt=0;dt<=Dx;dt++){const ir=dt/Dx,Cr=jd(0,_e,ir),[Gn,hs,rl]=Jx(lb,ub,Cr,e0);p.emplaceBack(Gn,hs,rl,ir,0),w.emplaceBack(Gn,hs,rl,ir,1)}this._poleSegments.push(Kg.simpleSegment(N,0,66,64)),N+=66}this._poleNorthVertexBuffer=c.createVertexBuffer(p,tC,!1),this._poleSouthVertexBuffer=c.createVertexBuffer(w,tC,!1)}getGridBuffers(c,u){return[this._gridBuffer,this._gridIndexBuffer,u?this._gridSegments[c].withSkirts:this._gridSegments[c].withoutSkirts]}getPoleBuffers(c){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[c]]}getWirefameBuffers(c,u){if(!this._wireframeSegments){const p=new om,w=Dx,A=w+1+2,N=1;this._wireframeSegments=[];for(let _e=0,dt=0;_e<Yx.length;_e++){const ir=Yx[_e];for(let Gn=N;Gn<ir+N;Gn++)for(let hs=N;hs<w+N;hs++){const rl=Gn*A+hs;p.emplaceBack(rl,rl+1),p.emplaceBack(rl,rl+A),p.emplaceBack(rl,rl+A+1)}const Cr=ir*w*3;this._wireframeSegments.push(Kg.simpleSegment(0,dt,(ir+1)*A,Cr)),dt+=Cr}this._wireframeIndexBuffer=c.createIndexBuffer(p)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[u]]}},a.GlyphManager=k1,a.ImagePosition=F1,a.KDBush=OE,a.LivePerformanceUtils=Wf,a.LngLat=Rg,a.LngLatBounds=Jv,a.LocalGlyphMode=vE,a.MAX_MERCATOR_LATITUDE=ym,a.MercatorCoordinate=P0,a.ONE_EM=Ig,a.OverscaledTileID=bd,a.PerformanceMarkers=Vf,a.Point=sl,a.Properties=Sh,a.RGBAImage=My,a.Ray=u1,a.RequestManager=class{constructor(c,u,p){this._transformRequestFn=c,this._customAccessToken=u,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){const c=function(){let u="";for(let p=0;p<10;p++)u+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Bn,u].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=c.token,this._skuTokenExpiresAt=c.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(c,u){return this._transformRequestFn&&this._transformRequestFn(c,u)||{url:c}}normalizeStyleURL(c,u){if(!Uh(c))return c;const p=ih(c);return p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||u)}normalizeGlyphsURL(c,u){if(!Uh(c))return c;const p=ih(c);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||u)}normalizeSourceURL(c,u,p,w){if(!Uh(c))return c;const A=ih(c);return A.path=`/v4/${A.authority}.json`,A.params.push("secure"),p&&A.params.push(`language=${p}`),w&&A.params.push(`worldview=${w}`),this._makeAPIURL(A,this._customAccessToken||u)}normalizeSpriteURL(c,u,p,w){const A=ih(c);return Uh(c)?(A.path=`/styles/v1${A.path}/sprite${u}${p}`,this._makeAPIURL(A,this._customAccessToken||w)):(A.path+=`${u}${p}`,uh(A))}normalizeTileURL(c,u,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),c&&!Uh(c))return c;const w=ih(c);w.path=w.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${u||p&&w.authority!=="raster"&&p===512?"@2x":""}${Y.supported?".webp":"$1"}`),w.authority==="raster"?w.path=`/${L.RASTER_URL_PREFIX}${w.path}`:(w.path=w.path.replace(/^.+\/v4\//,"/"),w.path=`/${L.TILE_URL_VERSION}${w.path}`);const A=this._customAccessToken||function(N){for(const _e of N){const dt=_e.match(/^access_token=(.*)$/);if(dt)return dt[1]}return null}(w.params)||L.ACCESS_TOKEN;return L.REQUIRE_ACCESS_TOKEN&&A&&this._skuToken&&w.params.push(`sku=${this._skuToken}`),this._makeAPIURL(w,A)}canonicalizeTileURL(c,u){const p=ih(c);if(!p.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!p.path.match(/\.[\w]+$/))return c;let w="mapbox://";p.path.match(/^\/raster\/v1\//)?w+=`raster/${p.path.replace(`/${L.RASTER_URL_PREFIX}/`,"")}`:w+=`tiles/${p.path.replace(`/${L.TILE_URL_VERSION}/`,"")}`;let A=p.params;return u&&(A=A.filter(N=>!N.match(/^access_token=/))),A.length&&(w+=`?${A.join("&")}`),w}canonicalizeTileset(c,u){const p=!!u&&Uh(u),w=[];for(const A of c.tiles||[])vl(A)?w.push(this.canonicalizeTileURL(A,p)):w.push(A);return w}_makeAPIURL(c,u){const p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",w=ih(L.API_URL);if(c.protocol=w.protocol,c.authority=w.authority,c.protocol==="http"){const A=c.params.indexOf("secure");A>=0&&c.params.splice(A,1)}if(w.path!=="/"&&(c.path=`${w.path}${c.path}`),!L.REQUIRE_ACCESS_TOKEN)return uh(c);if(u=u||L.ACCESS_TOKEN,!this._silenceAuthErrors){if(!u)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if(u[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return c.params=c.params.filter(A=>A.indexOf("access_token")===-1),c.params.push(`access_token=${u||""}`),uh(c)}},a.ResourceType=nd,a.SegmentVector=Kg,a.SourceCache=Qw,a.StencilMode=IE,a.StructArrayLayout1ui2=uy,a.StructArrayLayout2f1f2i16=Zd,a.StructArrayLayout2i4=Bp,a.StructArrayLayout2ui4=om,a.StructArrayLayout3f12=Jf,a.StructArrayLayout3ui6=Bd,a.StructArrayLayout4i8=Tp,a.StructArrayLayout5f20=gg,a.Texture=Nb,a.Tile=AE,a.Transitionable=dl,a.Uniform1f=Rx,a.Uniform1i=class extends cv{constructor(c){super(c),this.current=0}set(c,u,p){this.fetchUniformLocation(c,u)&&this.current!==p&&(this.current=p,this.gl.uniform1i(this.location,p))}},a.Uniform2f=class extends cv{constructor(c){super(c),this.current=[0,0]}set(c,u,p){this.fetchUniformLocation(c,u)&&(p[0]===this.current[0]&&p[1]===this.current[1]||(this.current=p,this.gl.uniform2f(this.location,p[0],p[1])))}},a.Uniform3f=class extends cv{constructor(c){super(c),this.current=[0,0,0]}set(c,u,p){this.fetchUniformLocation(c,u)&&(p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]||(this.current=p,this.gl.uniform3f(this.location,p[0],p[1],p[2])))}},a.Uniform4f=q1,a.UniformColor=ox,a.UniformMatrix2f=class extends cv{constructor(c){super(c),this.current=YC}set(c,u,p){if(this.fetchUniformLocation(c,u)){for(let w=0;w<4;w++)if(p[w]!==this.current[w]){this.current=p,this.gl.uniformMatrix2fv(this.location,!1,p);break}}}},a.UniformMatrix3f=class extends cv{constructor(c){super(c),this.current=XC}set(c,u,p){if(this.fetchUniformLocation(c,u)){for(let w=0;w<9;w++)if(p[w]!==this.current[w]){this.current=p,this.gl.uniformMatrix3fv(this.location,!1,p);break}}}},a.UniformMatrix4f=class extends cv{constructor(c){super(c),this.current=Sw}set(c,u,p){if(this.fetchUniformLocation(c,u)){if(p[12]!==this.current[12]||p[0]!==this.current[0])return this.current=p,void this.gl.uniformMatrix4fv(this.location,!1,p);for(let w=1;w<16;w++)if(p[w]!==this.current[w]){this.current=p,this.gl.uniformMatrix4fv(this.location,!1,p);break}}}},a.UnwrappedTileID=Md,a.ValidationError=fd,a.VectorTileFeature=W,a.VectorTileWorkerSource=class extends fy{constructor(c,u,p,w,A){super(),this.actor=c,this.layerIndex=u,this.availableImages=p,this.loadVectorData=A||GS,this.loading={},this.loaded={},this.deduped=new zS(c.scheduler),this.isSpriteLoaded=w,this.scheduler=c.scheduler}loadTile(c,u){const p=c.uid,w=c&&c.request,A=w&&w.collectResourceTiming,N=this.loading[p]=new VT(c);N.abort=this.loadVectorData(c,(_e,dt)=>{const ir=!this.loading[p];if(delete this.loading[p],ir||_e||!dt)return N.status="done",ir||(this.loaded[p]=N),u(_e);const Cr=dt.rawData,Gn={};dt.expires&&(Gn.expires=dt.expires),dt.cacheControl&&(Gn.cacheControl=dt.cacheControl),N.vectorTile=dt.vectorTile||new S(new O1(Cr));const hs=()=>{N.parse(N.vectorTile,this.layerIndex,this.availableImages,this.actor,(rl,ll)=>{if(rl||!ll)return u(rl);const ul={};if(A){const th=Yd(w);th.length>0&&(ul.resourceTiming=JSON.parse(JSON.stringify(th)))}u(null,Cp({rawTileData:Cr.slice(0)},ll,Gn,ul))})};this.isSpriteLoaded?hs():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(hs,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom}):hs()}),this.loaded=this.loaded||{},this.loaded[p]=N})}reloadTile(c,u){const p=this.loaded,w=c.uid,A=this;if(p&&p[w]){const N=p[w];N.showCollisionBoxes=c.showCollisionBoxes,N.enableTerrain=!!c.enableTerrain,N.projection=c.projection,N.tileTransform=Jw(c.tileID.canonical,c.projection);const _e=(dt,ir)=>{const Cr=N.reloadCallback;Cr&&(delete N.reloadCallback,N.parse(N.vectorTile,A.layerIndex,this.availableImages,A.actor,Cr)),u(dt,ir)};N.status==="parsing"?N.reloadCallback=_e:N.status==="done"&&(N.vectorTile?N.parse(N.vectorTile,this.layerIndex,this.availableImages,this.actor,_e):_e())}}abortTile(c,u){const p=c.uid,w=this.loading[p];w&&(w.abort&&w.abort(),delete this.loading[p]),u()}removeTile(c,u){const p=this.loaded,w=c.uid;p&&p[w]&&delete p[w],u()}},a.WritingMode=vv,a.ZoomDependentExpression=Bm,a.add=Qv,a.addDynamicAttributes=VC,a.adjoint=function(c,u){var p=u[0],w=u[1],A=u[2],N=u[3],_e=u[4],dt=u[5],ir=u[6],Cr=u[7],Gn=u[8];return c[0]=_e*Gn-dt*Cr,c[1]=A*Cr-w*Gn,c[2]=w*dt-A*_e,c[3]=dt*ir-N*Gn,c[4]=p*Gn-A*ir,c[5]=A*N-p*dt,c[6]=N*Cr-_e*ir,c[7]=w*ir-p*Cr,c[8]=p*_e-w*N,c},a.asyncAll=$p,a.bezier=vp,a.bindAll=ed,a.boundsAttributes=wS,a.bufferConvexPolygon=function(c,u){const p=[];for(let w=0;w<c.length;w++){const A=Ip(w-1,-1,c.length-1),N=Ip(w+1,-1,c.length-1),_e=c[w],dt=c[N],ir=c[A].sub(_e).unit(),Cr=dt.sub(_e).unit(),Gn=Cr.angleWithSep(ir.x,ir.y),hs=ir.add(Cr).unit().mult(-1*u/Math.sin(Gn/2));p.push(_e.add(hs))}return p},a.cacheEntryPossiblyAdded=function(c){Yp++,Yp>up&&(c.getActor().send("enforceCacheSizeLimit",$f),Yp=0)},a.calculateGlobeLabelMatrix=function(c,u){const{x:p,y:w}=c.point,A=nC(p,w,c.worldSize/c._pixelsPerMercatorPixel,0,0);return Ix(A,A,sb(cg(u)))},a.calculateGlobeMatrix=function(c){const{x:u,y:p}=c.point,{lng:w,lat:A}=c._center;return nC(u,p,c.worldSize,w,A)},a.calculateGlobeMercatorMatrix=function(c){const u=c.pixelsPerMeter,p=u/D_(1,c.center.lat),w=pv(new Float64Array(16));return Px(w,w,[c.point.x,c.point.y,0]),S0(w,w,[p,p,u]),Float32Array.from(w)},a.circumferenceAtLatitude=g1,a.clamp=Jh,a.clearTileCache=function(c){if(!Ed())return;const u=h.caches.delete(Uf);c&&u.catch(c).then(()=>c())},a.clipLine=iS,a.clone=function(c){var u=new Vy(16);return u[0]=c[0],u[1]=c[1],u[2]=c[2],u[3]=c[3],u[4]=c[4],u[5]=c[5],u[6]=c[6],u[7]=c[7],u[8]=c[8],u[9]=c[9],u[10]=c[10],u[11]=c[11],u[12]=c[12],u[13]=c[13],u[14]=c[14],u[15]=c[15],u},a.clone$1=Id,a.collisionCircleLayout=Cy,a.config=L,a.conjugate=function(c,u){return c[0]=-u[0],c[1]=-u[1],c[2]=-u[2],c[3]=u[3],c},a.create=function(){var c=new Vy(16);return Vy!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},a.create$1=Z1,a.createExpression=w_,a.createLayout=Zh,a.createStyleLayer=function(c){return c.type==="custom"?new PT(c):new DT[c.type](c)},a.cross=J1,a.degToRad=rh,a.distance=function(c,u){return Math.hypot(u[0]-c[0],u[1]-c[1],u[2]-c[2])},a.div=function(c,u,p){return c[0]=u[0]/p[0],c[1]=u[1]/p[1],c[2]=u[2]/p[2],c},a.dot=R_,a.earthRadius=zw,a.ease=gp,a.easeCubicInOut=Mh,a.ecefToLatLng=function([c,u,p]){const w=Math.hypot(c,u,p),A=Math.atan2(c,p),N=.5*Math.PI-Math.acos(-u/w);return new Rg(wh(A),wh(N))},a.emitValidationErrors=Ee,a.endsWith=Gd,a.enforceCacheSizeLimit=function(c){Vd(),ud&&ud.then(u=>{u.keys().then(p=>{for(let w=0;w<p.length-c;w++)u.delete(p[w])})})},a.evaluateSizeForFeature=Im,a.evaluateSizeForZoom=tg,a.evaluateVariableOffset=lS,a.evented=Ve,a.exactEquals=function(c,u){return c[0]===u[0]&&c[1]===u[1]&&c[2]===u[2]&&c[3]===u[3]},a.exactEquals$1=function(c,u){return c[0]===u[0]&&c[1]===u[1]&&c[2]===u[2]},a.exported=nm,a.exported$1=Y,a.extend=Cp,a.extend$1=gy,a.fillExtrusionHeightLift=Xh,a.filterObject=Ad,a.fromMat4=function(c,u){return c[0]=u[0],c[1]=u[1],c[2]=u[2],c[3]=u[4],c[4]=u[5],c[5]=u[6],c[6]=u[8],c[7]=u[9],c[8]=u[10],c},a.fromQuat=function(c,u){var p=u[0],w=u[1],A=u[2],N=u[3],_e=p+p,dt=w+w,ir=A+A,Cr=p*_e,Gn=w*_e,hs=w*dt,rl=A*_e,ll=A*dt,ul=A*ir,th=N*_e,fh=N*dt,Ch=N*ir;return c[0]=1-hs-ul,c[1]=Gn+Ch,c[2]=rl-fh,c[3]=0,c[4]=Gn-Ch,c[5]=1-Cr-ul,c[6]=ll+th,c[7]=0,c[8]=rl+fh,c[9]=ll-th,c[10]=1-Cr-hs,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},a.fromRotation=function(c,u){var p=Math.sin(u),w=Math.cos(u);return c[0]=w,c[1]=p,c[2]=0,c[3]=-p,c[4]=w,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},a.fromScaling=X1,a.furthestTileCorner=function(c){const u=Math.round((c+45+360)%360/90)%4;return Fh[u]},a.getAABBPointSquareDist=function(c,u,p){let w=0;for(let A=0;A<2;++A){const N=p?p[A]:0;c[A]>N&&(w+=(c[A]-N)*(c[A]-N)),u[A]<N&&(w+=(N-u[A])*(N-u[A]))}return w},a.getAnchorAlignment=_E,a.getAnchorJustification=wE,a.getBounds=function(c){let u=1/0,p=1/0,w=-1/0,A=-1/0;for(const N of c)u=Math.min(u,N.x),p=Math.min(p,N.y),w=Math.max(w,N.x),A=Math.max(A,N.y);return{min:new sl(u,p),max:new sl(w,A)}},a.getColumn=kp,a.getDefaultExportFromCjs=vi,a.getGridMatrix=function(c,u,p,w){const A=u.getNorth(),N=u.getSouth(),_e=u.getWest(),dt=u.getEast(),ir=1<<c.z,Cr=dt-_e,Gn=A-N,hs=Cr/Dx,rl=-Gn/Yx[p],ll=[0,hs,0,rl,0,0,A,_e,0];if(c.z>0){const ul=180/w;qx(ll,ll,[ul/Cr+1,0,0,0,ul/Gn+1,0,-.5*ul/hs,.5*ul/rl,1])}return ll[2]=ir,ll[5]=c.x,ll[8]=c.y,ll},a.getImage=oh,a.getJSON=function(c,u){return Rd(Cp(c,{type:"json"}),u)},a.getLatitudinalLod=function(c){const u=ym-5;c=Jh(c,-u,u)/u*90;const p=Math.pow(Math.abs(Math.sin(rh(c))),3);return Math.round(p*(Yx.length-1))},a.getMapSessionAPI=dd,a.getPerformanceMeasurement=Yd,a.getProjection=mS,a.getRTLTextPluginStatus=kt,a.getReferrer=Qd,a.getTilePoint=function(c,{x:u,y:p},w=0){return new sl(((u-w)*c.scale-c.x)*Hd,(p*c.scale-c.y)*Hd)},a.getTileVec3=function(c,u,p=0){return Kx(((u.x-p)*c.scale-c.x)*Hd,(u.y*c.scale-c.y)*Hd,tw(u.z,u.y))},a.getVideo=function(c,u){const p=h.document.createElement("video");p.muted=!0,p.onloadstart=function(){u(null,p)};for(let w=0;w<c.length;w++){const A=h.document.createElement("source");bg(c[w])||(p.crossOrigin="Anonymous"),A.src=c[w],p.appendChild(A)}return{cancel:()=>{}}},a.globeCenterToScreenPoint=function(c){const u=[0,0,0],p=pv(new Float64Array(16));return Ix(p,c.pixelMatrix,c.globeMatrix),sm(u,u,p),new sl(u[0],u[1])},a.globeDenormalizeECEF=sb,a.globeECEFOrigin=function(c,u){const p=[0,0,0];return sm(p,p,kw(cg(u.canonical))),sm(p,p,c),p},a.globeMetersToEcef=mm,a.globeNormalizeECEF=kw,a.globePixelsToTileUnits=function(c,u){return Hd/(512*Math.pow(2,c))*f1(cg(u))},a.globePoleMatrixForTile=function(c,u,p){const w=pv(new Float64Array(16)),A=(u/(1<<c)-.5)*Math.PI*2;return Dw(w,p.globeMatrix,A),Float32Array.from(w)},a.globeTileBounds=cg,a.globeTiltAtLngLat=Bw,a.globeToMercatorTransition=ew,a.globeUseCustomAntiAliasing=function(c,u,p){const w=ew(p.zoom),A=c.style.map._antialias,N=!!u.extStandardDerivatives,_e=u.extStandardDerivativesForceOff||c.terrain&&c.terrain.exaggeration()>0;return w===0&&!A&&!_e&&N},a.identity=pv,a.identity$1=Jb,a.invert=Pw,a.isFullscreen=function(){return!!h.document.fullscreenElement||!!h.document.webkitFullscreenElement},a.isLngLatBehindGlobe=lx,a.isMapAuthenticated=function(c){return Wd.has(c)},a.isMapboxURL=Uh,a.isSafariWithAntialiasingBug=function(c){const u=c.navigator?c.navigator.userAgent:null;return!!Fd(c)&&u&&(u.match("Version/15.4")||u.match("Version/15.5")||u.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},a.latFromMercatorY=bm,a.latLngToECEF=Qx,a.len=tE,a.length=A_,a.length$1=function(c){return Math.hypot(c[0],c[1],c[2],c[3])},a.lngFromMercatorX=zm,a.loadVectorTile=GS,a.makeRequest=Rd,a.mapValue=function(c,u,p,w,A){return Jh((c-u)/(p-u)*(A-w)+w,w,A)},a.mercatorScale=Gw,a.mercatorXfromLng=am,a.mercatorYfromLat=M_,a.mercatorZfromAltitude=D_,a.mul=QC,a.mul$1=eE,a.multiply=Ix,a.multiply$1=qx,a.multiply$2=Xb,a.nextPowerOfTwo=Wp,a.normalize=wy,a.normalize$1=rE,a.normalize$2=Yb,a.number=jd,a.ortho=function(c,u,p,w,A,N,_e){var dt=1/(u-p),ir=1/(w-A),Cr=1/(N-_e);return c[0]=-2*dt,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*ir,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*Cr,c[11]=0,c[12]=(u+p)*dt,c[13]=(A+w)*ir,c[14]=(_e+N)*Cr,c[15]=1,c},a.pbf=L_,a.perspective=function(c,u,p,w,A){var N,_e=1/Math.tan(u/2);return c[0]=_e/p,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=_e,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,A!=null&&A!==1/0?(c[10]=(A+w)*(N=1/(w-A)),c[14]=2*A*w*N):(c[10]=-1,c[14]=-2*w),c},a.pick=function(c,u){const p={};for(let w=0;w<u.length;w++){const A=u[w];A in c&&(p[A]=c[A])}return p},a.plugin=pi,a.pointGeometry=ml,a.polesInViewport=function(c){const u=pv(new Float64Array(16));Ix(u,c.pixelMatrix,c.globeMatrix);const p=[0,I_,0],w=[0,P_,0];return sm(p,p,u),sm(w,w,u),[p[0]>0&&p[0]<=c.width&&p[1]>0&&p[1]<=c.height&&!lx(c,new Rg(c.center.lat,90)),w[0]>0&&w[0]<=c.width&&w[1]>0&&w[1]<=c.height&&!lx(c,new Rg(c.center.lat,-90))]},a.polygonContainsPoint=M0,a.polygonIntersectsBox=x1,a.polygonIntersectsPolygon=gv,a.polygonizeBounds=function(c,u,p=0,w=!0){const A=new sl(p,p),N=c.sub(A),_e=u.add(A),dt=[N,new sl(_e.x,N.y),_e,new sl(N.x,_e.y)];return w&&dt.push(N.clone()),dt},a.posAttributes=Mx,a.postMapLoadEvent=rd,a.postPerformanceEvent=qp,a.postTurnstileEvent=ip,a.potpack=kx,a.prevPowerOfTwo=function(c){return c<=1?1:Math.pow(2,Math.floor(Math.log(c)/Math.LN2))},a.radToDeg=wh,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.registerForPluginStateChange=function(c){return c({pluginStatus:F,pluginURL:f}),Ve.on("pluginStateChange",c),c},a.removeAuthState=function(c){Wd.delete(c)},a.renderColorRamp=S1,a.resample=hb,a.rotateX=Mw,a.rotateX$1=Qb,a.rotateY=Dw,a.rotateY$1=eC,a.rotateZ=function(c,u,p){var w=Math.sin(p),A=Math.cos(p),N=u[0],_e=u[1],dt=u[2],ir=u[3],Cr=u[4],Gn=u[5],hs=u[6],rl=u[7];return u!==c&&(c[8]=u[8],c[9]=u[9],c[10]=u[10],c[11]=u[11],c[12]=u[12],c[13]=u[13],c[14]=u[14],c[15]=u[15]),c[0]=N*A+Cr*w,c[1]=_e*A+Gn*w,c[2]=dt*A+hs*w,c[3]=ir*A+rl*w,c[4]=Cr*A-N*w,c[5]=Gn*A-_e*w,c[6]=hs*A-dt*w,c[7]=rl*A-ir*w,c},a.rotateZ$1=function(c,u,p){p*=.5;var w=u[0],A=u[1],N=u[2],_e=u[3],dt=Math.sin(p),ir=Math.cos(p);return c[0]=w*ir+A*dt,c[1]=A*ir-w*dt,c[2]=N*ir+_e*dt,c[3]=_e*ir-N*dt,c},a.scale=S0,a.scale$1=Q1,a.scale$2=$y,a.scaleAndAdd=Zx,a.set=function(c,u,p,w){return c[0]=u,c[1]=p,c[2]=w,c},a.setCacheLimits=function(c,u){$f=c,up=u},a.setColumn=function(c,u,p){c[4*u+0]=p[0],c[4*u+1]=p[1],c[4*u+2]=p[2],c[4*u+3]=p[3]},a.setRTLTextPlugin=function(c,u,p=!1){if(F===jp||F===td||F===Vp)throw new Error("setRTLTextPlugin cannot be called multiple times.");f=nm.resolveURL(c),F=jp,gd=u,X(),p||Hr()},a.smoothstep=Lp,a.spec=hp,a.squaredLength=function(c){var u=c[0],p=c[1],w=c[2];return u*u+p*p+w*w},a.storeAuthState=function(c,u){u?Wd.add(c):Wd.delete(c)},a.sub=o_,a.subtract=ax,a.symbolSize=jy,a.tileAABB=function(c,u,p,w,A,N,_e,dt,ir){if(ir.name==="globe")return R0(c,u,new Mp(p,w,A));const Cr=Jw({z:p,x:w,y:A},ir);return new by([(N+Cr.x/Cr.scale)*u,u*(Cr.y/Cr.scale),_e],[(N+Cr.x2/Cr.scale)*u,u*(Cr.y2/Cr.scale),dt])},a.tileCornersToBounds=I0,a.tileTransform=Jw,a.transformMat3=function(c,u,p){var w=u[0],A=u[1],N=u[2];return c[0]=w*p[0]+A*p[3]+N*p[6],c[1]=w*p[1]+A*p[4]+N*p[7],c[2]=w*p[2]+A*p[5]+N*p[8],c},a.transformMat4=sm,a.transformMat4$1=dv,a.transformQuat=l1,a.transitionTileAABBinECEF=nb,a.translate=Px,a.transpose=function(c,u){if(c===u){var p=u[1],w=u[2],A=u[5];c[1]=u[3],c[2]=u[6],c[3]=p,c[5]=u[7],c[6]=w,c[7]=A}else c[0]=u[0],c[1]=u[3],c[2]=u[6],c[3]=u[1],c[4]=u[4],c[5]=u[7],c[6]=u[2],c[7]=u[5],c[8]=u[8];return c},a.triggerPluginCompletionEvent=T,a.uniqueId=Rp,a.updateGlobeVertexNormal=function(c,u,p,w,A){const N=5*u+2;c.float32[N+0]=p,c.float32[N+1]=w,c.float32[N+2]=A},a.validateCustomStyleLayer=function(c){const u=[],p=c.id;return p===void 0&&u.push({message:`layers.${p}: missing required property "id"`}),c.render===void 0&&u.push({message:`layers.${p}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&u.push({message:`layers.${p}: property "renderingMode" must be either "2d" or "3d"`}),u},a.validateFilter=c=>D(av(c)),a.validateFog=c=>D(x0(c)),a.validateLayer=c=>D(qv(c)),a.validateLight=c=>D(v0(c)),a.validateSource=c=>D(E_(c)),a.validateStyle=w0,a.validateTerrain=c=>D(i_(c)),a.values=Xp,a.vectorTile=px,a.version=y,a.warnOnce=Ap,a.window=h,a.wrap=Ip}),s(["./shared"],function(a){function h(Ih){if(typeof Ih=="number"||typeof Ih=="boolean"||typeof Ih=="string"||Ih==null)return JSON.stringify(Ih);if(Array.isArray(Ih)){let sh="[";for(const oh of Ih)sh+=`${h(oh)},`;return`${sh}]`}let nh="{";for(const sh of Object.keys(Ih).sort())nh+=`${sh}:${h(Ih[sh])},`;return`${nh}}`}function y(Ih){let nh="";for(const sh of a.refProperties)nh+=`/${h(Ih[sh])}`;return nh}class C{constructor(nh){this.keyCache={},nh&&this.replace(nh)}replace(nh){this._layerConfigs={},this._layers={},this.update(nh,[])}update(nh,sh){for(const Oh of nh)this._layerConfigs[Oh.id]=Oh,(this._layers[Oh.id]=a.createStyleLayer(Oh)).compileFilter(),this.keyCache[Oh.id]&&delete this.keyCache[Oh.id];for(const Oh of sh)delete this.keyCache[Oh],delete this._layerConfigs[Oh],delete this._layers[Oh];this.familiesBySource={};const oh=function(Oh,Uh){const vl={};for(let di=0;di<Oh.length;di++){const fs=Uh&&Uh[Oh[di].id]||y(Oh[di]);Uh&&(Uh[Oh[di].id]=fs);let cl=vl[fs];cl||(cl=vl[fs]=[]),cl.push(Oh[di])}const gs=[];for(const di in vl)gs.push(vl[di]);return gs}(a.values(this._layerConfigs),this.keyCache);for(const Oh of oh){const Uh=Oh.map(ih=>this._layers[ih.id]),vl=Uh[0];if(vl.visibility==="none")continue;const gs=vl.source||"";let di=this.familiesBySource[gs];di||(di=this.familiesBySource[gs]={});const fs=vl.sourceLayer||"_geojsonTileLayer";let cl=di[fs];cl||(cl=di[fs]=[]),cl.push(Uh)}}}class L{loadTile(nh,sh){const{uid:oh,encoding:Oh,rawImageData:Uh,padding:vl,buildQuadTree:gs}=nh,di=a.window.ImageBitmap&&Uh instanceof a.window.ImageBitmap?this.getImageData(Uh,vl):Uh;sh(null,new a.DEMData(oh,di,Oh,vl<1,gs))}getImageData(nh,sh){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(nh.width,nh.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=nh.width,this.offscreenCanvas.height=nh.height,this.offscreenCanvasContext.drawImage(nh,0,0,nh.width,nh.height);const oh=this.offscreenCanvasContext.getImageData(-sh,-sh,nh.width+2*sh,nh.height+2*sh);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),oh}}function Y(Ih,nh){if(Ih.length!==0){ze(Ih[0],nh);for(var sh=1;sh<Ih.length;sh++)ze(Ih[sh],!nh)}}function ze(Ih,nh){for(var sh=0,oh=0,Oh=0,Uh=Ih.length,vl=Uh-1;Oh<Uh;vl=Oh++){var gs=(Ih[Oh][0]-Ih[vl][0])*(Ih[vl][1]+Ih[Oh][1]),di=sh+gs;oh+=Math.abs(sh)>=Math.abs(gs)?sh-di+gs:gs-di+sh,sh=di}sh+oh>=0!=!!nh&&Ih.reverse()}var Bt=a.getDefaultExportFromCjs(function Ih(nh,sh){var oh,Oh=nh&&nh.type;if(Oh==="FeatureCollection")for(oh=0;oh<nh.features.length;oh++)Ih(nh.features[oh],sh);else if(Oh==="GeometryCollection")for(oh=0;oh<nh.geometries.length;oh++)Ih(nh.geometries[oh],sh);else if(Oh==="Feature")Ih(nh.geometry,sh);else if(Oh==="Polygon")Y(nh.coordinates,sh);else if(Oh==="MultiPolygon")for(oh=0;oh<nh.coordinates.length;oh++)Y(nh.coordinates[oh],sh);return nh});const Ir=a.VectorTileFeature.prototype.toGeoJSON;var Wr={exports:{}},yi=a.pointGeometry,Bn=a.vectorTile.VectorTileFeature,vi=wo;function wo(Ih,nh){this.options=nh||{},this.features=Ih,this.length=Ih.length}function ia(Ih,nh){this.id=typeof Ih.id=="number"?Ih.id:void 0,this.type=Ih.type,this.rawGeometry=Ih.type===1?[Ih.geometry]:Ih.geometry,this.properties=Ih.tags,this.extent=nh||4096}wo.prototype.feature=function(Ih){return new ia(this.features[Ih],this.options.extent)},ia.prototype.loadGeometry=function(){var Ih=this.rawGeometry;this.geometry=[];for(var nh=0;nh<Ih.length;nh++){for(var sh=Ih[nh],oh=[],Oh=0;Oh<sh.length;Oh++)oh.push(new yi(sh[Oh][0],sh[Oh][1]));this.geometry.push(oh)}return this.geometry},ia.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ih=this.geometry,nh=1/0,sh=-1/0,oh=1/0,Oh=-1/0,Uh=0;Uh<Ih.length;Uh++)for(var vl=Ih[Uh],gs=0;gs<vl.length;gs++){var di=vl[gs];nh=Math.min(nh,di.x),sh=Math.max(sh,di.x),oh=Math.min(oh,di.y),Oh=Math.max(Oh,di.y)}return[nh,oh,sh,Oh]},ia.prototype.toGeoJSON=Bn.prototype.toGeoJSON;var gl=a.pbf,ml=vi;function il(Ih){var nh=new gl;return function(sh,oh){for(var Oh in sh.layers)oh.writeMessage(3,sl,sh.layers[Oh])}(Ih,nh),nh.finish()}function sl(Ih,nh){var sh;nh.writeVarintField(15,Ih.version||1),nh.writeStringField(1,Ih.name||""),nh.writeVarintField(5,Ih.extent||4096);var oh={keys:[],values:[],keycache:{},valuecache:{}};for(sh=0;sh<Ih.length;sh++)oh.feature=Ih.feature(sh),nh.writeMessage(2,ol,oh);var Oh=oh.keys;for(sh=0;sh<Oh.length;sh++)nh.writeStringField(3,Oh[sh]);var Uh=oh.values;for(sh=0;sh<Uh.length;sh++)nh.writeMessage(4,Mh,Uh[sh])}function ol(Ih,nh){var sh=Ih.feature;sh.id!==void 0&&nh.writeVarintField(1,sh.id),nh.writeMessage(2,_l,Ih),nh.writeVarintField(3,sh.type),nh.writeMessage(4,Fh,sh)}function _l(Ih,nh){var sh=Ih.feature,oh=Ih.keys,Oh=Ih.values,Uh=Ih.keycache,vl=Ih.valuecache;for(var gs in sh.properties){var di=sh.properties[gs],fs=Uh[gs];if(di!==null){fs===void 0&&(oh.push(gs),Uh[gs]=fs=oh.length-1),nh.writeVarint(fs);var cl=typeof di;cl!=="string"&&cl!=="boolean"&&cl!=="number"&&(di=JSON.stringify(di));var ih=cl+":"+di,uh=vl[ih];uh===void 0&&(Oh.push(di),vl[ih]=uh=Oh.length-1),nh.writeVarint(uh)}}}function rh(Ih,nh){return(nh<<3)+(7&Ih)}function wh(Ih){return Ih<<1^Ih>>31}function Fh(Ih,nh){for(var sh=Ih.loadGeometry(),oh=Ih.type,Oh=0,Uh=0,vl=sh.length,gs=0;gs<vl;gs++){var di=sh[gs],fs=1;oh===1&&(fs=di.length),nh.writeVarint(rh(1,fs));for(var cl=oh===3?di.length-1:di.length,ih=0;ih<cl;ih++){ih===1&&oh!==1&&nh.writeVarint(rh(2,cl-1));var uh=di[ih].x-Oh,vh=di[ih].y-Uh;nh.writeVarint(wh(uh)),nh.writeVarint(wh(vh)),Oh+=uh,Uh+=vh}oh===3&&nh.writeVarint(rh(7,1))}}function Mh(Ih,nh){var sh=typeof Ih;sh==="string"?nh.writeStringField(1,Ih):sh==="boolean"?nh.writeBooleanField(7,Ih):sh==="number"&&(Ih%1!=0?nh.writeDoubleField(3,Ih):Ih<0?nh.writeSVarintField(6,Ih):nh.writeVarintField(5,Ih))}Wr.exports=il,Wr.exports.fromVectorTileJs=il,Wr.exports.fromGeojsonVt=function(Ih,nh){nh=nh||{};var sh={};for(var oh in Ih)sh[oh]=new ml(Ih[oh].features,nh),sh[oh].name=oh,sh[oh].version=nh.version,sh[oh].extent=nh.extent;return il({layers:sh})},Wr.exports.GeoJSONWrapper=ml;var vp=a.getDefaultExportFromCjs(Wr.exports);const gp={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ih=>Ih},Jh=Math.fround||(Lp=new Float32Array(1),Ih=>(Lp[0]=+Ih,Lp[0]));var Lp;const Ip=3,$p=5,Xp=6;class Cp{constructor(nh){this.options=Object.assign(Object.create(gp),nh),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(nh){const{log:sh,minZoom:oh,maxZoom:Oh}=this.options;sh&&console.time("total time");const Uh=`prepare ${nh.length} points`;sh&&console.time(Uh),this.points=nh;const vl=[];for(let di=0;di<nh.length;di++){const fs=nh[di];if(!fs.geometry)continue;const[cl,ih]=fs.geometry.coordinates,uh=Jh(od(cl)),vh=Jh(Wp(ih));vl.push(uh,vh,1/0,di,-1,1),this.options.reduce&&vl.push(0)}let gs=this.trees[Oh+1]=this._createTree(vl);sh&&console.timeEnd(Uh);for(let di=Oh;di>=oh;di--){const fs=+Date.now();gs=this.trees[di]=this._createTree(this._cluster(gs,di)),sh&&console.log("z%d: %d clusters in %dms",di,gs.numItems,+Date.now()-fs)}return sh&&console.timeEnd("total time"),this}getClusters(nh,sh){let oh=((nh[0]+180)%360+360)%360-180;const Oh=Math.max(-90,Math.min(90,nh[1]));let Uh=nh[2]===180?180:((nh[2]+180)%360+360)%360-180;const vl=Math.max(-90,Math.min(90,nh[3]));if(nh[2]-nh[0]>=360)oh=-180,Uh=180;else if(oh>Uh){const ih=this.getClusters([oh,Oh,180,vl],sh),uh=this.getClusters([-180,Oh,Uh,vl],sh);return ih.concat(uh)}const gs=this.trees[this._limitZoom(sh)],di=gs.range(od(oh),Wp(vl),od(Uh),Wp(Oh)),fs=gs.data,cl=[];for(const ih of di){const uh=this.stride*ih;cl.push(fs[uh+$p]>1?Gp(fs,uh,this.clusterProps):this.points[fs[uh+Ip]])}return cl}getChildren(nh){const sh=this._getOriginId(nh),oh=this._getOriginZoom(nh),Oh="No cluster with the specified id.",Uh=this.trees[oh];if(!Uh)throw new Error(Oh);const vl=Uh.data;if(sh*this.stride>=vl.length)throw new Error(Oh);const gs=this.options.radius/(this.options.extent*Math.pow(2,oh-1)),di=Uh.within(vl[sh*this.stride],vl[sh*this.stride+1],gs),fs=[];for(const cl of di){const ih=cl*this.stride;vl[ih+4]===nh&&fs.push(vl[ih+$p]>1?Gp(vl,ih,this.clusterProps):this.points[vl[ih+Ip]])}if(fs.length===0)throw new Error(Oh);return fs}getLeaves(nh,sh,oh){const Oh=[];return this._appendLeaves(Oh,nh,sh=sh||10,oh=oh||0,0),Oh}getTile(nh,sh,oh){const Oh=this.trees[this._limitZoom(nh)],Uh=Math.pow(2,nh),{extent:vl,radius:gs}=this.options,di=gs/vl,fs=(oh-di)/Uh,cl=(oh+1+di)/Uh,ih={features:[]};return this._addTileFeatures(Oh.range((sh-di)/Uh,fs,(sh+1+di)/Uh,cl),Oh.data,sh,oh,Uh,ih),sh===0&&this._addTileFeatures(Oh.range(1-di/Uh,fs,1,cl),Oh.data,Uh,oh,Uh,ih),sh===Uh-1&&this._addTileFeatures(Oh.range(0,fs,di/Uh,cl),Oh.data,-1,oh,Uh,ih),ih.features.length?ih:null}getClusterExpansionZoom(nh){let sh=this._getOriginZoom(nh)-1;for(;sh<=this.options.maxZoom;){const oh=this.getChildren(nh);if(sh++,oh.length!==1)break;nh=oh[0].properties.cluster_id}return sh}_appendLeaves(nh,sh,oh,Oh,Uh){const vl=this.getChildren(sh);for(const gs of vl){const di=gs.properties;if(di&&di.cluster?Uh+di.point_count<=Oh?Uh+=di.point_count:Uh=this._appendLeaves(nh,di.cluster_id,oh,Oh,Uh):Uh<Oh?Uh++:nh.push(gs),nh.length===oh)break}return Uh}_createTree(nh){const sh=new a.KDBush(nh.length/this.stride|0,this.options.nodeSize,Float32Array);for(let oh=0;oh<nh.length;oh+=this.stride)sh.add(nh[oh],nh[oh+1]);return sh.finish(),sh.data=nh,sh}_addTileFeatures(nh,sh,oh,Oh,Uh,vl){for(const gs of nh){const di=gs*this.stride,fs=sh[di+$p]>1;let cl,ih,uh;if(fs)cl=Rp(sh,di,this.clusterProps),ih=sh[di],uh=sh[di+1];else{const kh=this.points[sh[di+Ip]];cl=kh.properties;const[ep,ip]=kh.geometry.coordinates;ih=od(ep),uh=Wp(ip)}const vh={type:1,geometry:[[Math.round(this.options.extent*(ih*Uh-oh)),Math.round(this.options.extent*(uh*Uh-Oh))]],tags:cl};let Th;Th=fs||this.options.generateId?sh[di+Ip]:this.points[sh[di+Ip]].id,Th!==void 0&&(vh.id=Th),vl.features.push(vh)}}_limitZoom(nh){return Math.max(this.options.minZoom,Math.min(Math.floor(+nh),this.options.maxZoom+1))}_cluster(nh,sh){const{radius:oh,extent:Oh,reduce:Uh,minPoints:vl}=this.options,gs=oh/(Oh*Math.pow(2,sh)),di=nh.data,fs=[],cl=this.stride;for(let ih=0;ih<di.length;ih+=cl){if(di[ih+2]<=sh)continue;di[ih+2]=sh;const uh=di[ih],vh=di[ih+1],Th=nh.within(di[ih],di[ih+1],gs),kh=di[ih+$p];let ep=kh;for(const ip of Th){const _p=ip*cl;di[_p+2]>sh&&(ep+=di[_p+$p])}if(ep>kh&&ep>=vl){let ip,_p=uh*kh,rd=vh*kh,Dd=-1;const qp=((ih/cl|0)<<5)+(sh+1)+this.points.length;for(const wd of Th){const dd=wd*cl;if(di[dd+2]<=sh)continue;di[dd+2]=sh;const Wd=di[dd+$p];_p+=di[dd]*Wd,rd+=di[dd+1]*Wd,di[dd+4]=qp,Uh&&(ip||(ip=this._map(di,ih,!0),Dd=this.clusterProps.length,this.clusterProps.push(ip)),Uh(ip,this._map(di,dd)))}di[ih+4]=qp,fs.push(_p/ep,rd/ep,1/0,qp,-1,ep),Uh&&fs.push(Dd)}else{for(let ip=0;ip<cl;ip++)fs.push(di[ih+ip]);if(ep>1)for(const ip of Th){const _p=ip*cl;if(!(di[_p+2]<=sh)){di[_p+2]=sh;for(let rd=0;rd<cl;rd++)fs.push(di[_p+rd])}}}}return fs}_getOriginId(nh){return nh-this.points.length>>5}_getOriginZoom(nh){return(nh-this.points.length)%32}_map(nh,sh,oh){if(nh[sh+$p]>1){const vl=this.clusterProps[nh[sh+Xp]];return oh?Object.assign({},vl):vl}const Oh=this.points[nh[sh+Ip]].properties,Uh=this.options.map(Oh);return oh&&Uh===Oh?Object.assign({},Uh):Uh}}function Gp(Ih,nh,sh){return{type:"Feature",id:Ih[nh+Ip],properties:Rp(Ih,nh,sh),geometry:{type:"Point",coordinates:[(oh=Ih[nh],360*(oh-.5)),Ld(Ih[nh+1])]}};var oh}function Rp(Ih,nh,sh){const oh=Ih[nh+$p],Oh=oh>=1e4?`${Math.round(oh/1e3)}k`:oh>=1e3?Math.round(oh/100)/10+"k":oh,Uh=Ih[nh+Xp],vl=Uh===-1?{}:Object.assign({},sh[Uh]);return Object.assign(vl,{cluster:!0,cluster_id:Ih[nh+Ip],point_count:oh,point_count_abbreviated:Oh})}function od(Ih){return Ih/360+.5}function Wp(Ih){const nh=Math.sin(Ih*Math.PI/180),sh=.5-.25*Math.log((1+nh)/(1-nh))/Math.PI;return sh<0?0:sh>1?1:sh}function Ld(Ih){const nh=(180-360*Ih)*Math.PI/180;return 360*Math.atan(Math.exp(nh))/Math.PI-90}function ed(Ih,nh,sh,oh){for(var Oh,Uh=oh,vl=sh-nh>>1,gs=sh-nh,di=Ih[nh],fs=Ih[nh+1],cl=Ih[sh],ih=Ih[sh+1],uh=nh+3;uh<sh;uh+=3){var vh=Gd(Ih[uh],Ih[uh+1],di,fs,cl,ih);if(vh>Uh)Oh=uh,Uh=vh;else if(vh===Uh){var Th=Math.abs(uh-vl);Th<gs&&(Oh=uh,gs=Th)}}Uh>oh&&(Oh-nh>3&&ed(Ih,nh,Oh,oh),Ih[Oh+2]=Uh,sh-Oh>3&&ed(Ih,Oh,sh,oh))}function Gd(Ih,nh,sh,oh,Oh,Uh){var vl=Oh-sh,gs=Uh-oh;if(vl!==0||gs!==0){var di=((Ih-sh)*vl+(nh-oh)*gs)/(vl*vl+gs*gs);di>1?(sh=Oh,oh=Uh):di>0&&(sh+=vl*di,oh+=gs*di)}return(vl=Ih-sh)*vl+(gs=nh-oh)*gs}function Kp(Ih,nh,sh,oh){var Oh={id:Ih===void 0?null:Ih,type:nh,geometry:sh,tags:oh,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Uh){var vl=Uh.geometry,gs=Uh.type;if(gs==="Point"||gs==="MultiPoint"||gs==="LineString")Ad(Uh,vl);else if(gs==="Polygon"||gs==="MultiLineString")for(var di=0;di<vl.length;di++)Ad(Uh,vl[di]);else if(gs==="MultiPolygon")for(di=0;di<vl.length;di++)for(var fs=0;fs<vl[di].length;fs++)Ad(Uh,vl[di][fs])}(Oh),Oh}function Ad(Ih,nh){for(var sh=0;sh<nh.length;sh+=3)Ih.minX=Math.min(Ih.minX,nh[sh]),Ih.minY=Math.min(Ih.minY,nh[sh+1]),Ih.maxX=Math.max(Ih.maxX,nh[sh]),Ih.maxY=Math.max(Ih.maxY,nh[sh+1])}function Id(Ih,nh,sh,oh){if(nh.geometry){var Oh=nh.geometry.coordinates,Uh=nh.geometry.type,vl=Math.pow(sh.tolerance/((1<<sh.maxZoom)*sh.extent),2),gs=[],di=nh.id;if(sh.promoteId?di=nh.properties[sh.promoteId]:sh.generateId&&(di=oh||0),Uh==="Point")Yh(Oh,gs);else if(Uh==="MultiPoint")for(var fs=0;fs<Oh.length;fs++)Yh(Oh[fs],gs);else if(Uh==="LineString")Ap(Oh,gs,vl,!1);else if(Uh==="MultiLineString"){if(sh.lineMetrics){for(fs=0;fs<Oh.length;fs++)Ap(Oh[fs],gs=[],vl,!1),Ih.push(Kp(di,"LineString",gs,nh.properties));return}kd(Oh,gs,vl,!1)}else if(Uh==="Polygon")kd(Oh,gs,vl,!0);else{if(Uh!=="MultiPolygon"){if(Uh==="GeometryCollection"){for(fs=0;fs<nh.geometry.geometries.length;fs++)Id(Ih,{id:di,geometry:nh.geometry.geometries[fs],properties:nh.properties},sh,oh);return}throw new Error("Input data is not a valid GeoJSON object.")}for(fs=0;fs<Oh.length;fs++){var cl=[];kd(Oh[fs],cl,vl,!0),gs.push(cl)}}Ih.push(Kp(di,Uh,gs,nh.properties))}}function Yh(Ih,nh){nh.push(cd(Ih[0])),nh.push(id(Ih[1])),nh.push(0)}function Ap(Ih,nh,sh,oh){for(var Oh,Uh,vl=0,gs=0;gs<Ih.length;gs++){var di=cd(Ih[gs][0]),fs=id(Ih[gs][1]);nh.push(di),nh.push(fs),nh.push(0),gs>0&&(vl+=oh?(Oh*fs-di*Uh)/2:Math.sqrt(Math.pow(di-Oh,2)+Math.pow(fs-Uh,2))),Oh=di,Uh=fs}var cl=nh.length-3;nh[2]=1,ed(nh,0,cl,sh),nh[cl+2]=1,nh.size=Math.abs(vl),nh.start=0,nh.end=nh.size}function kd(Ih,nh,sh,oh){for(var Oh=0;Oh<Ih.length;Oh++){var Uh=[];Ap(Ih[Oh],Uh,sh,oh),nh.push(Uh)}}function cd(Ih){return Ih/360+.5}function id(Ih){var nh=Math.sin(Ih*Math.PI/180),sh=.5-.25*Math.log((1+nh)/(1-nh))/Math.PI;return sh<0?0:sh>1?1:sh}function fp(Ih,nh,sh,oh,Oh,Uh,vl,gs){if(oh/=nh,Uh>=(sh/=nh)&&vl<oh)return Ih;if(vl<sh||Uh>=oh)return null;for(var di=[],fs=0;fs<Ih.length;fs++){var cl=Ih[fs],ih=cl.geometry,uh=cl.type,vh=Oh===0?cl.minX:cl.minY,Th=Oh===0?cl.maxX:cl.maxY;if(vh>=sh&&Th<oh)di.push(cl);else if(!(Th<sh||vh>=oh)){var kh=[];if(uh==="Point"||uh==="MultiPoint")Cd(ih,kh,sh,oh,Oh);else if(uh==="LineString")Fd(ih,kh,sh,oh,Oh,!1,gs.lineMetrics);else if(uh==="MultiLineString")kp(ih,kh,sh,oh,Oh,!1);else if(uh==="Polygon")kp(ih,kh,sh,oh,Oh,!0);else if(uh==="MultiPolygon")for(var ep=0;ep<ih.length;ep++){var ip=[];kp(ih[ep],ip,sh,oh,Oh,!0),ip.length&&kh.push(ip)}if(kh.length){if(gs.lineMetrics&&uh==="LineString"){for(ep=0;ep<kh.length;ep++)di.push(Kp(cl.id,uh,kh[ep],cl.tags));continue}uh!=="LineString"&&uh!=="MultiLineString"||(kh.length===1?(uh="LineString",kh=kh[0]):uh="MultiLineString"),uh!=="Point"&&uh!=="MultiPoint"||(uh=kh.length===3?"Point":"MultiPoint"),di.push(Kp(cl.id,uh,kh,cl.tags))}}}return di.length?di:null}function Cd(Ih,nh,sh,oh,Oh){for(var Uh=0;Uh<Ih.length;Uh+=3){var vl=Ih[Uh+Oh];vl>=sh&&vl<=oh&&(nh.push(Ih[Uh]),nh.push(Ih[Uh+1]),nh.push(Ih[Uh+2]))}}function Fd(Ih,nh,sh,oh,Oh,Uh,vl){for(var gs,di,fs=yd(Ih),cl=Oh===0?$f:up,ih=Ih.start,uh=0;uh<Ih.length-3;uh+=3){var vh=Ih[uh],Th=Ih[uh+1],kh=Ih[uh+2],ep=Ih[uh+3],ip=Ih[uh+4],_p=Oh===0?vh:Th,rd=Oh===0?ep:ip,Dd=!1;vl&&(gs=Math.sqrt(Math.pow(vh-ep,2)+Math.pow(Th-ip,2))),_p<sh?rd>sh&&(di=cl(fs,vh,Th,ep,ip,sh),vl&&(fs.start=ih+gs*di)):_p>oh?rd<oh&&(di=cl(fs,vh,Th,ep,ip,oh),vl&&(fs.start=ih+gs*di)):Uf(fs,vh,Th,kh),rd<sh&&_p>=sh&&(di=cl(fs,vh,Th,ep,ip,sh),Dd=!0),rd>oh&&_p<=oh&&(di=cl(fs,vh,Th,ep,ip,oh),Dd=!0),!Uh&&Dd&&(vl&&(fs.end=ih+gs*di),nh.push(fs),fs=yd(Ih)),vl&&(ih+=gs)}var qp=Ih.length-3;vh=Ih[qp],Th=Ih[qp+1],kh=Ih[qp+2],(_p=Oh===0?vh:Th)>=sh&&_p<=oh&&Uf(fs,vh,Th,kh),qp=fs.length-3,Uh&&qp>=3&&(fs[qp]!==fs[0]||fs[qp+1]!==fs[1])&&Uf(fs,fs[0],fs[1],fs[2]),fs.length&&nh.push(fs)}function yd(Ih){var nh=[];return nh.size=Ih.size,nh.start=Ih.start,nh.end=Ih.end,nh}function kp(Ih,nh,sh,oh,Oh,Uh){for(var vl=0;vl<Ih.length;vl++)Fd(Ih[vl],nh,sh,oh,Oh,Uh,!1)}function Uf(Ih,nh,sh,oh){Ih.push(nh),Ih.push(sh),Ih.push(oh)}function $f(Ih,nh,sh,oh,Oh,Uh){var vl=(Uh-nh)/(oh-nh);return Ih.push(Uh),Ih.push(sh+(Oh-sh)*vl),Ih.push(1),vl}function up(Ih,nh,sh,oh,Oh,Uh){var vl=(Uh-sh)/(Oh-sh);return Ih.push(nh+(oh-nh)*vl),Ih.push(Uh),Ih.push(1),vl}function ud(Ih,nh){for(var sh=[],oh=0;oh<Ih.length;oh++){var Oh,Uh=Ih[oh],vl=Uh.type;if(vl==="Point"||vl==="MultiPoint"||vl==="LineString")Oh=xd(Uh.geometry,nh);else if(vl==="MultiLineString"||vl==="Polygon"){Oh=[];for(var gs=0;gs<Uh.geometry.length;gs++)Oh.push(xd(Uh.geometry[gs],nh))}else if(vl==="MultiPolygon")for(Oh=[],gs=0;gs<Uh.geometry.length;gs++){for(var di=[],fs=0;fs<Uh.geometry[gs].length;fs++)di.push(xd(Uh.geometry[gs][fs],nh));Oh.push(di)}sh.push(Kp(Uh.id,vl,Oh,Uh.tags))}return sh}function xd(Ih,nh){var sh=[];sh.size=Ih.size,Ih.start!==void 0&&(sh.start=Ih.start,sh.end=Ih.end);for(var oh=0;oh<Ih.length;oh+=3)sh.push(Ih[oh]+nh,Ih[oh+1],Ih[oh+2]);return sh}function Ed(Ih,nh){if(Ih.transformed)return Ih;var sh,oh,Oh,Uh=1<<Ih.z,vl=Ih.x,gs=Ih.y;for(sh=0;sh<Ih.features.length;sh++){var di=Ih.features[sh],fs=di.geometry,cl=di.type;if(di.geometry=[],cl===1)for(oh=0;oh<fs.length;oh+=2)di.geometry.push(Vd(fs[oh],fs[oh+1],nh,Uh,vl,gs));else for(oh=0;oh<fs.length;oh++){var ih=[];for(Oh=0;Oh<fs[oh].length;Oh+=2)ih.push(Vd(fs[oh][Oh],fs[oh][Oh+1],nh,Uh,vl,gs));di.geometry.push(ih)}}return Ih.transformed=!0,Ih}function Vd(Ih,nh,sh,oh,Oh,Uh){return[Math.round(sh*(Ih*oh-Oh)),Math.round(sh*(nh*oh-Uh))]}function Ep(Ih,nh,sh,oh,Oh){for(var Uh=nh===Oh.maxZoom?0:Oh.tolerance/((1<<nh)*Oh.extent),vl={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:sh,y:oh,z:nh,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},gs=0;gs<Ih.length;gs++){vl.numFeatures++,Yp(vl,Ih[gs],Uh,Oh);var di=Ih[gs].minX,fs=Ih[gs].minY,cl=Ih[gs].maxX,ih=Ih[gs].maxY;di<vl.minX&&(vl.minX=di),fs<vl.minY&&(vl.minY=fs),cl>vl.maxX&&(vl.maxX=cl),ih>vl.maxY&&(vl.maxY=ih)}return vl}function Yp(Ih,nh,sh,oh){var Oh=nh.geometry,Uh=nh.type,vl=[];if(Uh==="Point"||Uh==="MultiPoint")for(var gs=0;gs<Oh.length;gs+=3)vl.push(Oh[gs]),vl.push(Oh[gs+1]),Ih.numPoints++,Ih.numSimplified++;else if(Uh==="LineString")nd(vl,Oh,Ih,sh,!1,!1);else if(Uh==="MultiLineString"||Uh==="Polygon")for(gs=0;gs<Oh.length;gs++)nd(vl,Oh[gs],Ih,sh,Uh==="Polygon",gs===0);else if(Uh==="MultiPolygon")for(var di=0;di<Oh.length;di++){var fs=Oh[di];for(gs=0;gs<fs.length;gs++)nd(vl,fs[gs],Ih,sh,!0,gs===0)}if(vl.length){var cl=nh.tags||null;if(Uh==="LineString"&&oh.lineMetrics){for(var ih in cl={},nh.tags)cl[ih]=nh.tags[ih];cl.mapbox_clip_start=Oh.start/Oh.size,cl.mapbox_clip_end=Oh.end/Oh.size}var uh={geometry:vl,type:Uh==="Polygon"||Uh==="MultiPolygon"?3:Uh==="LineString"||Uh==="MultiLineString"?2:1,tags:cl};nh.id!==null&&(uh.id=nh.id),Ih.features.push(uh)}}function nd(Ih,nh,sh,oh,Oh,Uh){var vl=oh*oh;if(oh>0&&nh.size<(Oh?vl:oh))sh.numPoints+=nh.length/3;else{for(var gs=[],di=0;di<nh.length;di+=3)(oh===0||nh[di+2]>vl)&&(sh.numSimplified++,gs.push(nh[di]),gs.push(nh[di+1])),sh.numPoints++;Oh&&function(fs,cl){for(var ih=0,uh=0,vh=fs.length,Th=vh-2;uh<vh;Th=uh,uh+=2)ih+=(fs[uh]-fs[Th])*(fs[uh+1]+fs[Th+1]);if(ih>0===cl)for(uh=0,vh=fs.length;uh<vh/2;uh+=2){var kh=fs[uh],ep=fs[uh+1];fs[uh]=fs[vh-2-uh],fs[uh+1]=fs[vh-1-uh],fs[vh-2-uh]=kh,fs[vh-1-uh]=ep}}(gs,Uh),Ih.push(gs)}}function $d(Ih,nh){var sh=(nh=this.options=function(Oh,Uh){for(var vl in Uh)Oh[vl]=Uh[vl];return Oh}(Object.create(this.options),nh)).debug;if(sh&&console.time("preprocess data"),nh.maxZoom<0||nh.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(nh.promoteId&&nh.generateId)throw new Error("promoteId and generateId cannot be used together.");var oh=function(Oh,Uh){var vl=[];if(Oh.type==="FeatureCollection")for(var gs=0;gs<Oh.features.length;gs++)Id(vl,Oh.features[gs],Uh,gs);else Id(vl,Oh.type==="Feature"?Oh:{geometry:Oh},Uh);return vl}(Ih,nh);this.tiles={},this.tileCoords=[],sh&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",nh.indexMaxZoom,nh.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),oh=function(Oh,Uh){var vl=Uh.buffer/Uh.extent,gs=Oh,di=fp(Oh,1,-1-vl,vl,0,-1,2,Uh),fs=fp(Oh,1,1-vl,2+vl,0,-1,2,Uh);return(di||fs)&&(gs=fp(Oh,1,-vl,1+vl,0,-1,2,Uh)||[],di&&(gs=ud(di,1).concat(gs)),fs&&(gs=gs.concat(ud(fs,-1)))),gs}(oh,nh),oh.length&&this.splitTile(oh,0,0,0),sh&&(oh.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Qd(Ih,nh,sh){return 32*((1<<Ih)*sh+nh)+Ih}function Rd(Ih,nh){const sh=Ih.tileID.canonical;if(!this._geoJSONIndex)return nh(null,null);const oh=this._geoJSONIndex.getTile(sh.z,sh.x,sh.y);if(!oh)return nh(null,null);const Oh=new class{constructor(vl){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=vl.length,this._features=vl}feature(vl){return new class{constructor(gs){this._feature=gs,this.extent=a.EXTENT,this.type=gs.type,this.properties=gs.tags,"id"in gs&&!isNaN(gs.id)&&(this.id=parseInt(gs.id,10))}loadGeometry(){if(this._feature.type===1){const gs=[];for(const di of this._feature.geometry)gs.push([new a.Point(di[0],di[1])]);return gs}{const gs=[];for(const di of this._feature.geometry){const fs=[];for(const cl of di)fs.push(new a.Point(cl[0],cl[1]));gs.push(fs)}return gs}}toGeoJSON(gs,di,fs){return Ir.call(this,gs,di,fs)}}(this._features[vl])}}(oh.features);let Uh=vp(Oh);Uh.byteOffset===0&&Uh.byteLength===Uh.buffer.byteLength||(Uh=new Uint8Array(Uh)),nh(null,{vectorTile:Oh,rawData:Uh.buffer})}$d.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},$d.prototype.splitTile=function(Ih,nh,sh,oh,Oh,Uh,vl){for(var gs=[Ih,nh,sh,oh],di=this.options,fs=di.debug;gs.length;){oh=gs.pop(),sh=gs.pop(),nh=gs.pop(),Ih=gs.pop();var cl=1<<nh,ih=Qd(nh,sh,oh),uh=this.tiles[ih];if(!uh&&(fs>1&&console.time("creation"),uh=this.tiles[ih]=Ep(Ih,nh,sh,oh,di),this.tileCoords.push({z:nh,x:sh,y:oh}),fs)){fs>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",nh,sh,oh,uh.numFeatures,uh.numPoints,uh.numSimplified),console.timeEnd("creation"));var vh="z"+nh;this.stats[vh]=(this.stats[vh]||0)+1,this.total++}if(uh.source=Ih,Oh){if(nh===di.maxZoom||nh===Oh)continue;var Th=1<<Oh-nh;if(sh!==Math.floor(Uh/Th)||oh!==Math.floor(vl/Th))continue}else if(nh===di.indexMaxZoom||uh.numPoints<=di.indexMaxPoints)continue;if(uh.source=null,Ih.length!==0){fs>1&&console.time("clipping");var kh,ep,ip,_p,rd,Dd,qp=.5*di.buffer/di.extent,wd=.5-qp,dd=.5+qp,Wd=1+qp;kh=ep=ip=_p=null,rd=fp(Ih,cl,sh-qp,sh+dd,0,uh.minX,uh.maxX,di),Dd=fp(Ih,cl,sh+wd,sh+Wd,0,uh.minX,uh.maxX,di),Ih=null,rd&&(kh=fp(rd,cl,oh-qp,oh+dd,1,uh.minY,uh.maxY,di),ep=fp(rd,cl,oh+wd,oh+Wd,1,uh.minY,uh.maxY,di),rd=null),Dd&&(ip=fp(Dd,cl,oh-qp,oh+dd,1,uh.minY,uh.maxY,di),_p=fp(Dd,cl,oh+wd,oh+Wd,1,uh.minY,uh.maxY,di),Dd=null),fs>1&&console.timeEnd("clipping"),gs.push(kh||[],nh+1,2*sh,2*oh),gs.push(ep||[],nh+1,2*sh,2*oh+1),gs.push(ip||[],nh+1,2*sh+1,2*oh),gs.push(_p||[],nh+1,2*sh+1,2*oh+1)}}},$d.prototype.getTile=function(Ih,nh,sh){var oh=this.options,Oh=oh.extent,Uh=oh.debug;if(Ih<0||Ih>24)return null;var vl=1<<Ih,gs=Qd(Ih,nh=(nh%vl+vl)%vl,sh);if(this.tiles[gs])return Ed(this.tiles[gs],Oh);Uh>1&&console.log("drilling down to z%d-%d-%d",Ih,nh,sh);for(var di,fs=Ih,cl=nh,ih=sh;!di&&fs>0;)fs--,cl=Math.floor(cl/2),ih=Math.floor(ih/2),di=this.tiles[Qd(fs,cl,ih)];return di&&di.source?(Uh>1&&console.log("found parent tile z%d-%d-%d",fs,cl,ih),Uh>1&&console.time("drilling down"),this.splitTile(di.source,fs,cl,ih,Ih,nh,sh),Uh>1&&console.timeEnd("drilling down"),this.tiles[gs]?Ed(this.tiles[gs],Oh):null):null};class ng extends a.VectorTileWorkerSource{constructor(nh,sh,oh,Oh,Uh){super(nh,sh,oh,Oh,Rd),Uh&&(this.loadGeoJSON=Uh)}loadData(nh,sh){const oh=nh&&nh.request,Oh=oh&&oh.collectResourceTiming;this.loadGeoJSON(nh,(Uh,vl)=>{if(Uh||!vl)return sh(Uh);if(typeof vl!="object")return sh(new Error(`Input data given to '${nh.source}' is not a valid GeoJSON object.`));{Bt(vl,!0);try{if(nh.filter){const di=a.createExpression(nh.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(di.result==="error")throw new Error(di.value.map(cl=>`${cl.key}: ${cl.message}`).join(", "));vl={type:"FeatureCollection",features:vl.features.filter(cl=>di.value.evaluate({zoom:0},cl))}}this._geoJSONIndex=nh.cluster?new Cp(function({superclusterOptions:di,clusterProperties:fs}){if(!fs||!di)return di;const cl={},ih={},uh={accumulated:null,zoom:0},vh={properties:null},Th=Object.keys(fs);for(const kh of Th){const[ep,ip]=fs[kh],_p=a.createExpression(ip),rd=a.createExpression(typeof ep=="string"?[ep,["accumulated"],["get",kh]]:ep);cl[kh]=_p.value,ih[kh]=rd.value}return di.map=kh=>{vh.properties=kh;const ep={};for(const ip of Th)ep[ip]=cl[ip].evaluate(uh,vh);return ep},di.reduce=(kh,ep)=>{vh.properties=ep;for(const ip of Th)uh.accumulated=kh[ip],kh[ip]=ih[ip].evaluate(uh,vh)},di}(nh)).load(vl.features):function(di,fs){return new $d(di,fs)}(vl,nh.geojsonVtOptions)}catch(di){return sh(di)}this.loaded={};const gs={};if(Oh){const di=a.getPerformanceMeasurement(oh);di&&(gs.resourceTiming={},gs.resourceTiming[nh.source]=JSON.parse(JSON.stringify(di)))}sh(null,gs)}})}reloadTile(nh,sh){const oh=this.loaded;return oh&&oh[nh.uid]?super.reloadTile(nh,sh):this.loadTile(nh,sh)}loadGeoJSON(nh,sh){if(nh.request)a.getJSON(nh.request,sh);else{if(typeof nh.data!="string")return sh(new Error(`Input data given to '${nh.source}' is not a valid GeoJSON object.`));try{return sh(null,JSON.parse(nh.data))}catch{return sh(new Error(`Input data given to '${nh.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(nh,sh){try{sh(null,this._geoJSONIndex.getClusterExpansionZoom(nh.clusterId))}catch(oh){sh(oh)}}getClusterChildren(nh,sh){try{sh(null,this._geoJSONIndex.getChildren(nh.clusterId))}catch(oh){sh(oh)}}getClusterLeaves(nh,sh){try{sh(null,this._geoJSONIndex.getLeaves(nh.clusterId,nh.limit,nh.offset))}catch(oh){sh(oh)}}}class bg{constructor(nh){this.self=nh,this.actor=new a.Actor(nh,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.getProjection({name:"mercator"}),this.workerSourceTypes={vector:a.VectorTileWorkerSource,geojson:ng},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(sh,oh)=>{if(this.workerSourceTypes[sh])throw new Error(`Worker source with name "${sh}" already registered.`);this.workerSourceTypes[sh]=oh},this.self.registerRTLTextPlugin=sh=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=sh.applyArabicShaping,a.plugin.processBidirectionalText=sh.processBidirectionalText,a.plugin.processStyledBidirectionalText=sh.processStyledBidirectionalText}}clearCaches(nh,sh,oh){delete this.layerIndexes[nh],delete this.availableImages[nh],delete this.workerSources[nh],delete this.demWorkerSources[nh],oh()}checkIfReady(nh,sh,oh){oh()}setReferrer(nh,sh){this.referrer=sh}spriteLoaded(nh,sh){this.isSpriteLoaded[nh]=sh;for(const oh in this.workerSources[nh]){const Oh=this.workerSources[nh][oh];for(const Uh in Oh)Oh[Uh]instanceof a.VectorTileWorkerSource&&(Oh[Uh].isSpriteLoaded=sh,Oh[Uh].fire(new a.Event("isSpriteLoaded")))}}setImages(nh,sh,oh){this.availableImages[nh]=sh;for(const Oh in this.workerSources[nh]){const Uh=this.workerSources[nh][Oh];for(const vl in Uh)Uh[vl].availableImages=sh}oh()}enableTerrain(nh,sh,oh){this.terrain=sh,oh()}setProjection(nh,sh){this.projections[nh]=a.getProjection(sh)}setLayers(nh,sh,oh){this.getLayerIndex(nh).replace(sh),oh()}updateLayers(nh,sh,oh){this.getLayerIndex(nh).update(sh.layers,sh.removedIds),oh()}loadTile(nh,sh,oh){const Oh=this.enableTerrain?a.extend({enableTerrain:this.terrain},sh):sh;Oh.projection=this.projections[nh]||this.defaultProjection,this.getWorkerSource(nh,sh.type,sh.source).loadTile(Oh,oh)}loadDEMTile(nh,sh,oh){const Oh=this.enableTerrain?a.extend({buildQuadTree:this.terrain},sh):sh;this.getDEMWorkerSource(nh,sh.source).loadTile(Oh,oh)}reloadTile(nh,sh,oh){const Oh=this.enableTerrain?a.extend({enableTerrain:this.terrain},sh):sh;Oh.projection=this.projections[nh]||this.defaultProjection,this.getWorkerSource(nh,sh.type,sh.source).reloadTile(Oh,oh)}abortTile(nh,sh,oh){this.getWorkerSource(nh,sh.type,sh.source).abortTile(sh,oh)}removeTile(nh,sh,oh){this.getWorkerSource(nh,sh.type,sh.source).removeTile(sh,oh)}removeSource(nh,sh,oh){if(!this.workerSources[nh]||!this.workerSources[nh][sh.type]||!this.workerSources[nh][sh.type][sh.source])return;const Oh=this.workerSources[nh][sh.type][sh.source];delete this.workerSources[nh][sh.type][sh.source],Oh.removeSource!==void 0?Oh.removeSource(sh,oh):oh()}loadWorkerSource(nh,sh,oh){try{this.self.importScripts(sh.url),oh()}catch(Oh){oh(Oh.toString())}}syncRTLPluginState(nh,sh,oh){try{a.plugin.setState(sh);const Oh=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&Oh!=null){this.self.importScripts(Oh);const Uh=a.plugin.isParsed();oh(Uh?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Oh}`),Uh)}}catch(Oh){oh(Oh.toString())}}getAvailableImages(nh){let sh=this.availableImages[nh];return sh||(sh=[]),sh}getLayerIndex(nh){let sh=this.layerIndexes[nh];return sh||(sh=this.layerIndexes[nh]=new C),sh}getWorkerSource(nh,sh,oh){if(this.workerSources[nh]||(this.workerSources[nh]={}),this.workerSources[nh][sh]||(this.workerSources[nh][sh]={}),!this.workerSources[nh][sh][oh]){const Oh={send:(Uh,vl,gs,di,fs,cl)=>{this.actor.send(Uh,vl,gs,nh,fs,cl)},scheduler:this.actor.scheduler};this.workerSources[nh][sh][oh]=new this.workerSourceTypes[sh](Oh,this.getLayerIndex(nh),this.getAvailableImages(nh),this.isSpriteLoaded[nh])}return this.workerSources[nh][sh][oh]}getDEMWorkerSource(nh,sh){return this.demWorkerSources[nh]||(this.demWorkerSources[nh]={}),this.demWorkerSources[nh][sh]||(this.demWorkerSources[nh][sh]=new L),this.demWorkerSources[nh][sh]}enforceCacheSizeLimit(nh,sh){a.enforceCacheSizeLimit(sh)}getWorkerPerformanceMetrics(nh,sh,oh){oh(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new bg(self)),bg}),s(["./shared"],function(a){function h(F,f){if(Array.isArray(F)){if(!Array.isArray(f)||F.length!==f.length)return!1;for(let T=0;T<F.length;T++)if(!h(F[T],f[T]))return!1;return!0}if(typeof F=="object"&&F!==null&&f!==null){if(typeof f!="object"||Object.keys(F).length!==Object.keys(f).length)return!1;for(const T in F)if(!h(F[T],f[T]))return!1;return!0}return F===f}var y=C;function C(F){return!function(f){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var X,Ve,kt=new Blob([""],{type:"text/javascript"}),Hr=URL.createObjectURL(kt);try{Ve=new Worker(Hr),X=!0}catch{X=!1}return Ve&&Ve.terminate(),URL.revokeObjectURL(Hr),X}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var X=document.createElement("canvas");X.width=X.height=1;var Ve=X.getContext("2d");if(!Ve)return!1;var kt=Ve.getImageData(0,0,1,1);return kt&&kt.width===X.width}()?(L[T=f&&f.failIfMajorPerformanceCaveat]===void 0&&(L[T]=function(X){var Ve,kt=function(Hr){var pi=document.createElement("canvas"),Vn=Object.create(C.webGLContextAttributes);return Vn.failIfMajorPerformanceCaveat=Hr,pi.getContext("webgl",Vn)||pi.getContext("experimental-webgl",Vn)}(X);if(!kt)return!1;try{Ve=kt.createShader(kt.VERTEX_SHADER)}catch{return!1}return!(!Ve||kt.isContextLost())&&(kt.shaderSource(Ve,"void main() {}"),kt.compileShader(Ve),kt.getShaderParameter(Ve,kt.COMPILE_STATUS)===!0)}(T)),L[T]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var T}(F)}var L={};function Y(F,f,T){const X=a.window.document.createElement(F);return f!==void 0&&(X.className=f),T&&T.appendChild(X),X}function ze(F,f,T){const X=a.window.document.createElementNS("http://www.w3.org/2000/svg",F);for(const Ve of Object.keys(f))X.setAttributeNS(null,Ve,f[Ve]);return T&&T.appendChild(X),X}C.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Bt=a.window.document&&a.window.document.documentElement.style,Ir=Bt&&Bt.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Wr;function yi(){Bt&&Ir&&(Wr=Bt[Ir],Bt[Ir]="none")}function Bn(){Bt&&Ir&&(Bt[Ir]=Wr)}function vi(F){F.preventDefault(),F.stopPropagation(),a.window.removeEventListener("click",vi,!0)}function wo(){a.window.addEventListener("click",vi,!0),a.window.setTimeout(()=>{a.window.removeEventListener("click",vi,!0)},0)}function ia(F,f){const T=F.getBoundingClientRect();return il(F,T,f)}function gl(F,f){const T=F.getBoundingClientRect(),X=[];for(let Ve=0;Ve<f.length;Ve++)X.push(il(F,T,f[Ve]));return X}function ml(F){return a.window.InstallTrigger!==void 0&&F.button===2&&F.ctrlKey&&a.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:F.button}function il(F,f,T){const X=F.offsetWidth===f.width?1:F.offsetWidth/f.width;return new a.Point((T.clientX-f.left)*X,(T.clientY-f.top)*X)}function sl(F,f){var T=f[0],X=f[1],Ve=f[2],kt=f[3],Hr=T*kt-Ve*X;return Hr?(F[0]=kt*(Hr=1/Hr),F[1]=-X*Hr,F[2]=-Ve*Hr,F[3]=T*Hr,F):null}function ol(F){const{userImage:f}=F;return!!(f&&f.render&&f.render())&&(F.data.replace(new Uint8Array(f.data.buffer)),!0)}class _l extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(f){if(this.loaded!==f&&(this.loaded=f,f)){for(const{ids:T,callback:X}of this.requestors)this._notify(T,X);this.requestors=[]}}hasImage(f){return!!this.getImage(f)}getImage(f){return this.images[f]}addImage(f,T){this._validate(f,T)&&(this.images[f]=T)}_validate(f,T){let X=!0;return this._validateStretch(T.stretchX,T.data&&T.data.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${f}" has invalid "stretchX" value`))),X=!1),this._validateStretch(T.stretchY,T.data&&T.data.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${f}" has invalid "stretchY" value`))),X=!1),this._validateContent(T.content,T)||(this.fire(new a.ErrorEvent(new Error(`Image "${f}" has invalid "content" value`))),X=!1),X}_validateStretch(f,T){if(!f)return!0;let X=0;for(const Ve of f){if(Ve[0]<X||Ve[1]<Ve[0]||T<Ve[1])return!1;X=Ve[1]}return!0}_validateContent(f,T){return!(f&&(f.length!==4||f[0]<0||T.data.width<f[0]||f[1]<0||T.data.height<f[1]||f[2]<0||T.data.width<f[2]||f[3]<0||T.data.height<f[3]||f[2]<f[0]||f[3]<f[1]))}updateImage(f,T){T.version=this.images[f].version+1,this.images[f]=T,this.updatedImages[f]=!0}removeImage(f){const T=this.images[f];delete this.images[f],delete this.patterns[f],T.userImage&&T.userImage.onRemove&&T.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(f,T){let X=!0;if(!this.isLoaded())for(const Ve of f)this.images[Ve]||(X=!1);this.isLoaded()||X?this._notify(f,T):this.requestors.push({ids:f,callback:T})}_notify(f,T){const X={};for(const Ve of f){this.images[Ve]||this.fire(new a.Event("styleimagemissing",{id:Ve}));const kt=this.images[Ve];kt?X[Ve]={data:kt.data.clone(),pixelRatio:kt.pixelRatio,sdf:kt.sdf,version:kt.version,stretchX:kt.stretchX,stretchY:kt.stretchY,content:kt.content,hasRenderCallback:!!(kt.userImage&&kt.userImage.render)}:a.warnOnce(`Image "${Ve}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}T(null,X)}getPixelSize(){const{width:f,height:T}=this.atlasImage;return{width:f,height:T}}getPattern(f){const T=this.patterns[f],X=this.getImage(f);if(!X)return null;if(T&&T.position.version===X.version)return T.position;if(T)T.position.version=X.version;else{const Ve={w:X.data.width+2,h:X.data.height+2,x:0,y:0},kt=new a.ImagePosition(Ve,X);this.patterns[f]={bin:Ve,position:kt}}return this._updatePatternAtlas(),this.patterns[f].position}bind(f){const T=f.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.Texture(f,this.atlasImage,T.RGBA),this.atlasTexture&&this.atlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE)}_updatePatternAtlas(){const f=[];for(const kt in this.patterns)f.push(this.patterns[kt].bin);const{w:T,h:X}=a.potpack(f),Ve=this.atlasImage;Ve.resize({width:T||1,height:X||1});for(const kt in this.patterns){const{bin:Hr}=this.patterns[kt],pi=Hr.x+1,Vn=Hr.y+1,oa=this.images[kt].data,sa=oa.width,dl=oa.height;a.RGBAImage.copy(oa,Ve,{x:0,y:0},{x:pi,y:Vn},{width:sa,height:dl}),a.RGBAImage.copy(oa,Ve,{x:0,y:dl-1},{x:pi,y:Vn-1},{width:sa,height:1}),a.RGBAImage.copy(oa,Ve,{x:0,y:0},{x:pi,y:Vn+dl},{width:sa,height:1}),a.RGBAImage.copy(oa,Ve,{x:sa-1,y:0},{x:pi-1,y:Vn},{width:1,height:dl}),a.RGBAImage.copy(oa,Ve,{x:0,y:0},{x:pi+sa,y:Vn},{width:1,height:dl})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(f){for(const T of f){if(this.callbackDispatchedThisFrame[T])continue;this.callbackDispatchedThisFrame[T]=!0;const X=this.images[T];ol(X)&&this.updateImage(T,X)}}}const rh=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(F,f){return function([T,X,Ve]){const kt=a.degToRad(X+90),Hr=a.degToRad(Ve);return{x:T*Math.cos(kt)*Math.sin(Hr),y:T*Math.sin(kt)*Math.sin(Hr),z:T*Math.cos(Hr),azimuthal:X,polar:Ve}}(F.expression.evaluate(f))}interpolate(F,f,T){return{x:a.number(F.x,f.x,T),y:a.number(F.y,f.y,T),z:a.number(F.z,f.z,T),azimuthal:a.number(F.azimuthal,f.azimuthal,T),polar:a.number(F.polar,f.polar,T)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)});class wh extends a.Evented{constructor(f){super(),this._transitionable=new a.Transitionable(rh),this.setLight(f),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(f,T={}){if(!this._validate(a.validateLight,f,T))for(const X in f){const Ve=f[X];a.endsWith(X,"-transition")?this._transitionable.setTransition(X.slice(0,-11),Ve):this._transitionable.setValue(X,Ve)}}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,T,X){return(!X||X.validate!==!1)&&a.emitValidationErrors(this,f.call(a.validateStyle,a.extend({value:T,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}const Fh=new a.Properties({source:new a.DataConstantProperty(a.spec.terrain.source),exaggeration:new a.DataConstantProperty(a.spec.terrain.exaggeration)});let Mh=class extends a.Evented{constructor(F,f){super(),this._transitionable=new a.Transitionable(Fh),this.set(F),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=f}get(){return this._transitionable.serialize()}set(F){for(const f in F){const T=F[f];a.endsWith(f,"-transition")?this._transitionable.setTransition(f.slice(0,-11),T):this._transitionable.setValue(f,T)}}updateTransitions(F){this._transitioning=this._transitionable.transitioned(F,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(F){this.properties=this._transitioning.possiblyEvaluate(F)}};function vp(F,f,T,X){const Ve=a.smoothstep(45,65,T),[kt,Hr]=gp(F,X),pi=a.length(f);let Vn=1-Math.min(1,Math.exp((pi-kt)/(Hr-kt)*-6));return Vn*=Vn*Vn,Vn=Math.min(1,1.00747*Vn),Vn*Ve*F.alpha}function gp(F,f){const T=.5/Math.tan(.5*f);return[F.range[0]+T,F.range[1]+T]}const Jh=new a.Properties({range:new a.DataConstantProperty(a.spec.fog.range),color:new a.DataConstantProperty(a.spec.fog.color),"high-color":new a.DataConstantProperty(a.spec.fog["high-color"]),"space-color":new a.DataConstantProperty(a.spec.fog["space-color"]),"horizon-blend":new a.DataConstantProperty(a.spec.fog["horizon-blend"]),"star-intensity":new a.DataConstantProperty(a.spec.fog["star-intensity"])});class Lp extends a.Evented{constructor(f,T){super(),this._transitionable=new a.Transitionable(Jh),this.set(f),this._transitioning=this._transitionable.untransitioned(),this._transform=T}get state(){const f=this._transform,T=f.projection.name==="globe",X=a.globeToMercatorTransition(f.zoom),Ve=this.properties.get("range"),kt=[.5,3];return{range:T?[a.number(kt[0],Ve[0],X),a.number(kt[1],Ve[1],X)]:Ve,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(f,T={}){if(!this._validate(a.validateFog,f,T)){for(const X of Object.keys(a.spec.fog))f&&f[X]===void 0&&(f[X]=a.spec.fog[X].default);for(const X in f){const Ve=f[X];a.endsWith(X,"-transition")?this._transitionable.setTransition(X.slice(0,-11),Ve):this._transitionable.setValue(X,Ve)}}}getOpacity(f){if(!this._transform.projection.supportsFog)return 0;const T=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.smoothstep(45,65,f))*T.a}getOpacityAtLatLng(f,T){return this._transform.projection.supportsFog?function(X,Ve,kt){const Hr=a.MercatorCoordinate.fromLngLat(Ve),pi=kt.elevation?kt.elevation.getAtPointOrZero(Hr):0,Vn=[Hr.x,Hr.y,pi];return a.transformMat4(Vn,Vn,kt.mercatorFogMatrix),vp(X,Vn,kt.pitch,kt._fov)}(this.state,f,T):0}getFovAdjustedRange(f){return this._transform.projection.supportsFog?gp(this.state,f):[0,1]}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,T,X){return(!X||X.validate!==!1)&&a.emitValidationErrors(this,f.call(a.validateStyle,a.extend({value:T,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class Ip{constructor(f,T){this.workerPool=f,this.actors=[],this.currentActor=0,this.id=a.uniqueId();const X=this.workerPool.acquire(this.id);for(let Ve=0;Ve<X.length;Ve++){const kt=new Ip.Actor(X[Ve],T,this.id);kt.name=`Worker ${Ve}`,this.actors.push(kt)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(f,T,X){a.asyncAll(this.actors,(Ve,kt)=>{Ve.send(f,T,kt)},X=X||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(f=>{f.remove()}),this.actors=[],this.workerPool.release(this.id)}}function $p(F,f,T){return f*(a.EXTENT/(F.tileSize*Math.pow(2,T-F.tileID.overscaledZ)))}Ip.Actor=a.Actor;class Xp{constructor(f,T,X,Ve){this.screenBounds=f,this.cameraPoint=T,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=X,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,Ve)}static createFromScreenPoints(f,T){let X,Ve;if(f instanceof a.Point||typeof f[0]=="number"){const kt=a.Point.convert(f);X=[kt],Ve=T.isPointAboveHorizon(kt)}else{const kt=a.Point.convert(f[0]),Hr=a.Point.convert(f[1]);X=[kt,Hr],Ve=a.polygonizeBounds(kt,Hr).every(pi=>T.isPointAboveHorizon(pi))}return new Xp(X,T.getCameraPoint(),Ve,T)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(f){return a.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],f)}bufferedCameraGeometry(f){const T=this.screenBounds[0],X=this.screenBounds.length===1?this.screenBounds[0].add(new a.Point(1,1)):this.screenBounds[1],Ve=a.polygonizeBounds(T,X,0,!1);return this.cameraPoint.y>X.y&&(this.cameraPoint.x>T.x&&this.cameraPoint.x<X.x?Ve.splice(3,0,this.cameraPoint):this.cameraPoint.x>=X.x?Ve[2]=this.cameraPoint:this.cameraPoint.x<=T.x&&(Ve[3]=this.cameraPoint)),a.bufferConvexPolygon(Ve,f)}bufferedCameraGeometryGlobe(f){const T=this.screenBounds[0],X=this.screenBounds.length===1?this.screenBounds[0].add(new a.Point(1,1)):this.screenBounds[1],Ve=a.polygonizeBounds(T,X,f),kt=this.cameraPoint.clone();switch(3*((kt.y>T.y)+(kt.y>X.y))+((kt.x>T.x)+(kt.x>X.x))){case 0:Ve[0]=kt,Ve[4]=kt.clone();break;case 1:Ve.splice(1,0,kt);break;case 2:Ve[1]=kt;break;case 3:Ve.splice(4,0,kt);break;case 5:Ve.splice(2,0,kt);break;case 6:Ve[3]=kt;break;case 7:Ve.splice(3,0,kt);break;case 8:Ve[2]=kt}return Ve}containsTile(f,T,X,Ve=0){const kt=f.queryPadding/T._pixelsPerMercatorPixel+1,Hr=X?this._bufferedCameraMercator(kt,T):this._bufferedScreenMercator(kt,T);let pi=f.tileID.wrap+(Hr.unwrapped?Ve:0);const Vn=Hr.polygon.map(xh=>a.getTilePoint(f.tileTransform,xh,pi));if(!a.polygonIntersectsBox(Vn,0,0,a.EXTENT,a.EXTENT))return;pi=f.tileID.wrap+(this.screenGeometryMercator.unwrapped?Ve:0);const oa=this.screenGeometryMercator.polygon.map(xh=>a.getTileVec3(f.tileTransform,xh,pi)),sa=oa.map(xh=>new a.Point(xh[0],xh[1])),dl=T.getFreeCameraOptions().position||new a.MercatorCoordinate(0,0,0),lh=a.getTileVec3(f.tileTransform,dl,pi),gh=oa.map(xh=>{const yl=a.sub(xh,xh,lh);return a.normalize(yl,yl),new a.Ray(lh,yl)}),_h=$p(f,1,T.zoom)*T._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:sa,tilespaceRays:gh,bufferedTilespaceGeometry:Vn,bufferedTilespaceBounds:(yh=a.getBounds(Vn),yh.min.x=a.clamp(yh.min.x,0,a.EXTENT),yh.min.y=a.clamp(yh.min.y,0,a.EXTENT),yh.max.x=a.clamp(yh.max.x,0,a.EXTENT),yh.max.y=a.clamp(yh.max.y,0,a.EXTENT),yh),tile:f,tileID:f.tileID,pixelToTileUnitsFactor:_h};var yh}_bufferedScreenMercator(f,T){const X=Rp(f);if(this._screenRaycastCache[X])return this._screenRaycastCache[X];{let Ve;return Ve=T.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(f),T):{polygon:this.bufferedScreenGeometry(f).map(kt=>T.pointCoordinate3D(kt)),unwrapped:!0},this._screenRaycastCache[X]=Ve,Ve}}_bufferedCameraMercator(f,T){const X=Rp(f);if(this._cameraRaycastCache[X])return this._cameraRaycastCache[X];{let Ve;return Ve=T.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(f),T):{polygon:this.bufferedCameraGeometry(f).map(kt=>T.pointCoordinate3D(kt)),unwrapped:!0},this._cameraRaycastCache[X]=Ve,Ve}}_projectAndResample(f,T){const X=function(kt,Hr){const pi=a.multiply([],Hr.pixelMatrix,Hr.globeMatrix),Vn=[0,-a.GLOBE_RADIUS,0,1],oa=[0,a.GLOBE_RADIUS,0,1],sa=[0,0,0,1];a.transformMat4$1(Vn,Vn,pi),a.transformMat4$1(oa,oa,pi),a.transformMat4$1(sa,sa,pi);const dl=new a.Point(Vn[0]/Vn[3],Vn[1]/Vn[3]),lh=new a.Point(oa[0]/oa[3],oa[1]/oa[3]),gh=a.polygonContainsPoint(kt,dl)&&Vn[3]<sa[3],_h=a.polygonContainsPoint(kt,lh)&&oa[3]<sa[3];if(!gh&&!_h)return null;const yh=function(Vh,Wh,Zh){for(let rp=1;rp<Vh.length;rp++){const Bp=Gp(Wh.pointCoordinate3D(Vh[rp-1]).x),tp=Gp(Wh.pointCoordinate3D(Vh[rp]).x);if(Zh<0){if(Bp<tp)return{idx:rp,t:-Bp/(tp-1-Bp)}}else if(tp<Bp)return{idx:rp,t:(1-Bp)/(tp+1-Bp)}}return null}(kt,Hr,gh?-1:1);if(!yh)return null;const{idx:xh,t:yl}=yh;let mh=xh>1?Cp(kt.slice(0,xh),Hr):[],bh=xh<kt.length?Cp(kt.slice(xh),Hr):[];mh=mh.map(Vh=>new a.Point(Gp(Vh.x),Vh.y)),bh=bh.map(Vh=>new a.Point(Gp(Vh.x),Vh.y));const Sh=[...mh];Sh.length===0&&Sh.push(bh[bh.length-1]);const Nh=a.number(Sh[Sh.length-1].y,(bh.length===0?mh[0]:bh[0]).y,yl);let $h;return $h=gh?[new a.Point(0,Nh),new a.Point(0,0),new a.Point(1,0),new a.Point(1,Nh)]:[new a.Point(1,Nh),new a.Point(1,1),new a.Point(0,1),new a.Point(0,Nh)],Sh.push(...$h),bh.length===0?Sh.push(mh[0]):Sh.push(...bh),{polygon:Sh.map(Vh=>new a.MercatorCoordinate(Vh.x,Vh.y)),unwrapped:!1}}(f,T);if(X)return X;const Ve=function(kt,Hr){let pi=!1,Vn=-1/0,oa=0;for(let dl=0;dl<kt.length-1;dl++)kt[dl].x>Vn&&(Vn=kt[dl].x,oa=dl);for(let dl=0;dl<kt.length-1;dl++){const lh=(oa+dl)%(kt.length-1),gh=kt[lh],_h=kt[lh+1];Math.abs(gh.x-_h.x)>.5&&(gh.x<_h.x?(gh.x+=1,lh===0&&(kt[kt.length-1].x+=1)):(_h.x+=1,lh+1===kt.length-1&&(kt[0].x+=1)),pi=!0)}const sa=a.mercatorXfromLng(Hr.center.lng);return pi&&sa<Math.abs(sa-1)&&kt.forEach(dl=>{dl.x-=1}),{polygon:kt,unwrapped:pi}}(Cp(f,T).map(kt=>new a.Point(Gp(kt.x),kt.y)),T);return{polygon:Ve.polygon.map(kt=>new a.MercatorCoordinate(kt.x,kt.y)),unwrapped:Ve.unwrapped}}}function Cp(F,f){return a.resample(F,T=>{const X=f.pointCoordinate3D(T);T.x=X.x,T.y=X.y},1/256)}function Gp(F){return F<0?1+F%1:F%1}function Rp(F){return 100*F|0}function od(F,f,T,X,Ve){const kt=function(Hr,pi){if(Hr)return Ve(Hr);if(pi){F.url&&pi.tiles&&F.tiles&&delete F.tiles;const Vn=a.pick(a.extend(pi,F),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);pi.vector_layers&&(Vn.vectorLayers=pi.vector_layers,Vn.vectorLayerIds=Vn.vectorLayers.map(oa=>oa.id)),Vn.tiles=f.canonicalizeTileset(Vn,F.url),Ve(null,Vn)}};return F.url?a.getJSON(f.transformRequest(f.normalizeSourceURL(F.url,null,T,X),a.ResourceType.Source),kt):a.exported.frame(()=>kt(null,F))}class Wp{constructor(f,T,X){this.bounds=a.LngLatBounds.convert(this.validateBounds(f)),this.minzoom=T||0,this.maxzoom=X||24}validateBounds(f){return Array.isArray(f)&&f.length===4?[Math.max(-180,f[0]),Math.max(-90,f[1]),Math.min(180,f[2]),Math.min(90,f[3])]:[-180,-90,180,90]}contains(f){const T=Math.pow(2,f.z),X=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*T),Ve=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*T),kt=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*T),Hr=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*T);return f.x>=X&&f.x<kt&&f.y>=Ve&&f.y<Hr}}class Ld{constructor(f,T,X){this.context=f;const Ve=f.gl;this.buffer=Ve.createBuffer(),this.dynamicDraw=!!X,this.context.unbindVAO(),f.bindElementBuffer.set(this.buffer),Ve.bufferData(Ve.ELEMENT_ARRAY_BUFFER,T.arrayBuffer,this.dynamicDraw?Ve.DYNAMIC_DRAW:Ve.STATIC_DRAW),this.dynamicDraw||T.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(f){const T=this.context.gl;this.context.unbindVAO(),this.bind(),T.bufferSubData(T.ELEMENT_ARRAY_BUFFER,0,f.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ed={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Gd{constructor(f,T,X,Ve){this.length=T.length,this.attributes=X,this.itemSize=T.bytesPerElement,this.dynamicDraw=Ve,this.context=f;const kt=f.gl;this.buffer=kt.createBuffer(),f.bindVertexBuffer.set(this.buffer),kt.bufferData(kt.ARRAY_BUFFER,T.arrayBuffer,this.dynamicDraw?kt.DYNAMIC_DRAW:kt.STATIC_DRAW),this.dynamicDraw||T.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(f){const T=this.context.gl;this.bind(),T.bufferSubData(T.ARRAY_BUFFER,0,f.arrayBuffer)}enableAttributes(f,T){for(let X=0;X<this.attributes.length;X++){const Ve=T.attributes[this.attributes[X].name];Ve!==void 0&&f.enableVertexAttribArray(Ve)}}setVertexAttribPointers(f,T,X){for(let Ve=0;Ve<this.attributes.length;Ve++){const kt=this.attributes[Ve],Hr=T.attributes[kt.name];Hr!==void 0&&f.vertexAttribPointer(Hr,kt.components,f[ed[kt.type]],!1,this.itemSize,kt.offset+this.itemSize*(X||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Kp{constructor(f){this.gl=f.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(f){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ad extends Kp{getDefault(){return a.Color.transparent}set(f){const T=this.current;(f.r!==T.r||f.g!==T.g||f.b!==T.b||f.a!==T.a||this.dirty)&&(this.gl.clearColor(f.r,f.g,f.b,f.a),this.current=f,this.dirty=!1)}}class Id extends Kp{getDefault(){return 1}set(f){(f!==this.current||this.dirty)&&(this.gl.clearDepth(f),this.current=f,this.dirty=!1)}}class Yh extends Kp{getDefault(){return 0}set(f){(f!==this.current||this.dirty)&&(this.gl.clearStencil(f),this.current=f,this.dirty=!1)}}class Ap extends Kp{getDefault(){return[!0,!0,!0,!0]}set(f){const T=this.current;(f[0]!==T[0]||f[1]!==T[1]||f[2]!==T[2]||f[3]!==T[3]||this.dirty)&&(this.gl.colorMask(f[0],f[1],f[2],f[3]),this.current=f,this.dirty=!1)}}class kd extends Kp{getDefault(){return!0}set(f){(f!==this.current||this.dirty)&&(this.gl.depthMask(f),this.current=f,this.dirty=!1)}}class cd extends Kp{getDefault(){return 255}set(f){(f!==this.current||this.dirty)&&(this.gl.stencilMask(f),this.current=f,this.dirty=!1)}}class id extends Kp{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(f){const T=this.current;(f.func!==T.func||f.ref!==T.ref||f.mask!==T.mask||this.dirty)&&(this.gl.stencilFunc(f.func,f.ref,f.mask),this.current=f,this.dirty=!1)}}class fp extends Kp{getDefault(){const f=this.gl;return[f.KEEP,f.KEEP,f.KEEP]}set(f){const T=this.current;(f[0]!==T[0]||f[1]!==T[1]||f[2]!==T[2]||this.dirty)&&(this.gl.stencilOp(f[0],f[1],f[2]),this.current=f,this.dirty=!1)}}class Cd extends Kp{getDefault(){return!1}set(f){if(f===this.current&&!this.dirty)return;const T=this.gl;f?T.enable(T.STENCIL_TEST):T.disable(T.STENCIL_TEST),this.current=f,this.dirty=!1}}class Fd extends Kp{getDefault(){return[0,1]}set(f){const T=this.current;(f[0]!==T[0]||f[1]!==T[1]||this.dirty)&&(this.gl.depthRange(f[0],f[1]),this.current=f,this.dirty=!1)}}class yd extends Kp{getDefault(){return!1}set(f){if(f===this.current&&!this.dirty)return;const T=this.gl;f?T.enable(T.DEPTH_TEST):T.disable(T.DEPTH_TEST),this.current=f,this.dirty=!1}}class kp extends Kp{getDefault(){return this.gl.LESS}set(f){(f!==this.current||this.dirty)&&(this.gl.depthFunc(f),this.current=f,this.dirty=!1)}}class Uf extends Kp{getDefault(){return!1}set(f){if(f===this.current&&!this.dirty)return;const T=this.gl;f?T.enable(T.BLEND):T.disable(T.BLEND),this.current=f,this.dirty=!1}}class $f extends Kp{getDefault(){const f=this.gl;return[f.ONE,f.ZERO]}set(f){const T=this.current;(f[0]!==T[0]||f[1]!==T[1]||this.dirty)&&(this.gl.blendFunc(f[0],f[1]),this.current=f,this.dirty=!1)}}class up extends Kp{getDefault(){return a.Color.transparent}set(f){const T=this.current;(f.r!==T.r||f.g!==T.g||f.b!==T.b||f.a!==T.a||this.dirty)&&(this.gl.blendColor(f.r,f.g,f.b,f.a),this.current=f,this.dirty=!1)}}class ud extends Kp{getDefault(){return this.gl.FUNC_ADD}set(f){(f!==this.current||this.dirty)&&(this.gl.blendEquation(f),this.current=f,this.dirty=!1)}}class xd extends Kp{getDefault(){return!1}set(f){if(f===this.current&&!this.dirty)return;const T=this.gl;f?T.enable(T.CULL_FACE):T.disable(T.CULL_FACE),this.current=f,this.dirty=!1}}class Ed extends Kp{getDefault(){return this.gl.BACK}set(f){(f!==this.current||this.dirty)&&(this.gl.cullFace(f),this.current=f,this.dirty=!1)}}class Vd extends Kp{getDefault(){return this.gl.CCW}set(f){(f!==this.current||this.dirty)&&(this.gl.frontFace(f),this.current=f,this.dirty=!1)}}let Ep,Yp=class extends Kp{getDefault(){return null}set(F){(F!==this.current||this.dirty)&&(this.gl.useProgram(F),this.current=F,this.dirty=!1)}};class nd extends Kp{getDefault(){return this.gl.TEXTURE0}set(f){(f!==this.current||this.dirty)&&(this.gl.activeTexture(f),this.current=f,this.dirty=!1)}}class $d extends Kp{getDefault(){const f=this.gl;return[0,0,f.drawingBufferWidth,f.drawingBufferHeight]}set(f){const T=this.current;(f[0]!==T[0]||f[1]!==T[1]||f[2]!==T[2]||f[3]!==T[3]||this.dirty)&&(this.gl.viewport(f[0],f[1],f[2],f[3]),this.current=f,this.dirty=!1)}}class Qd extends Kp{getDefault(){return null}set(f){if(f===this.current&&!this.dirty)return;const T=this.gl;T.bindFramebuffer(T.FRAMEBUFFER,f),this.current=f,this.dirty=!1}}class Rd extends Kp{getDefault(){return null}set(f){if(f===this.current&&!this.dirty)return;const T=this.gl;T.bindRenderbuffer(T.RENDERBUFFER,f),this.current=f,this.dirty=!1}}class ng extends Kp{getDefault(){return null}set(f){if(f===this.current&&!this.dirty)return;const T=this.gl;T.bindTexture(T.TEXTURE_2D,f),this.current=f,this.dirty=!1}}class bg extends Kp{getDefault(){return null}set(f){if(f===this.current&&!this.dirty)return;const T=this.gl;T.bindBuffer(T.ARRAY_BUFFER,f),this.current=f,this.dirty=!1}}class Ih extends Kp{getDefault(){return null}set(f){const T=this.gl;T.bindBuffer(T.ELEMENT_ARRAY_BUFFER,f),this.current=f,this.dirty=!1}}class nh extends Kp{constructor(f){super(f),this.vao=f.extVertexArrayObject}getDefault(){return null}set(f){this.vao&&(f!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(f),this.current=f,this.dirty=!1)}}class sh extends Kp{getDefault(){return 4}set(f){if(f===this.current&&!this.dirty)return;const T=this.gl;T.pixelStorei(T.UNPACK_ALIGNMENT,f),this.current=f,this.dirty=!1}}class oh extends Kp{getDefault(){return!1}set(f){if(f===this.current&&!this.dirty)return;const T=this.gl;T.pixelStorei(T.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f),this.current=f,this.dirty=!1}}class Oh extends Kp{getDefault(){return!1}set(f){if(f===this.current&&!this.dirty)return;const T=this.gl;T.pixelStorei(T.UNPACK_FLIP_Y_WEBGL,f),this.current=f,this.dirty=!1}}class Uh extends Kp{constructor(f,T){super(f),this.context=f,this.parent=T}getDefault(){return null}}class vl extends Uh{setDirty(){this.dirty=!0}set(f){if(f===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const T=this.gl;T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_2D,f,0),this.current=f,this.dirty=!1}}class gs extends Uh{attachment(){return this.gl.DEPTH_ATTACHMENT}set(f){if(f===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const T=this.gl;T.framebufferRenderbuffer(T.FRAMEBUFFER,this.attachment(),T.RENDERBUFFER,f),this.current=f,this.dirty=!1}}class di extends gs{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class fs{constructor(f,T,X,Ve){this.context=f,this.width=T,this.height=X;const kt=this.framebuffer=f.gl.createFramebuffer();this.colorAttachment=new vl(f,kt),Ve&&(this.depthAttachment=new gs(f,kt))}destroy(){const f=this.context.gl,T=this.colorAttachment.get();if(T&&f.deleteTexture(T),this.depthAttachment){const X=this.depthAttachment.get();X&&f.deleteRenderbuffer(X)}f.deleteFramebuffer(this.framebuffer)}}class cl{constructor(f,T=!1){if(this.gl=f,this.isWebGL2=T,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),T){const X=f;this.extVertexArrayObject={createVertexArrayOES:X.createVertexArray.bind(f),deleteVertexArrayOES:X.deleteVertexArray.bind(f),bindVertexArrayOES:X.bindVertexArray.bind(f)}}this.clearColor=new Ad(this),this.clearDepth=new Id(this),this.clearStencil=new Yh(this),this.colorMask=new Ap(this),this.depthMask=new kd(this),this.stencilMask=new cd(this),this.stencilFunc=new id(this),this.stencilOp=new fp(this),this.stencilTest=new Cd(this),this.depthRange=new Fd(this),this.depthTest=new yd(this),this.depthFunc=new kp(this),this.blend=new Uf(this),this.blendFunc=new $f(this),this.blendColor=new up(this),this.blendEquation=new ud(this),this.cullFace=new xd(this),this.cullFaceSide=new Ed(this),this.frontFace=new Vd(this),this.program=new Yp(this),this.activeTexture=new nd(this),this.viewport=new $d(this),this.bindFramebuffer=new Qd(this),this.bindRenderbuffer=new Rd(this),this.bindTexture=new ng(this),this.bindVertexBuffer=new bg(this),this.bindElementBuffer=new Ih(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new nh(this),this.pixelStoreUnpack=new sh(this),this.pixelStoreUnpackPremultiplyAlpha=new oh(this),this.pixelStoreUnpackFlipY=new Oh(this),this.extTextureFilterAnisotropic=f.getExtension("EXT_texture_filter_anisotropic")||f.getExtension("MOZ_EXT_texture_filter_anisotropic")||f.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=f.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=f.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=f.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=f.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),T||(this.extTextureHalfFloat=f.getExtension("OES_texture_half_float")),(T||this.extTextureHalfFloat&&f.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=f.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=T||f.getExtension("OES_standard_derivatives"),this.extTimerQuery=f.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=f.getParameter(f.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(f,T){return new Ld(this,f,T)}createVertexBuffer(f,T,X){return new Gd(this,f,T,X)}createRenderbuffer(f,T,X){const Ve=this.gl,kt=Ve.createRenderbuffer();return this.bindRenderbuffer.set(kt),Ve.renderbufferStorage(Ve.RENDERBUFFER,f,T,X),this.bindRenderbuffer.set(null),kt}createFramebuffer(f,T,X){return new fs(this,f,T,X)}clear({color:f,depth:T,stencil:X}){const Ve=this.gl;let kt=0;f&&(kt|=Ve.COLOR_BUFFER_BIT,this.clearColor.set(f),this.colorMask.set([!0,!0,!0,!0])),T!==void 0&&(kt|=Ve.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(T),this.depthMask.set(!0)),X!==void 0&&(kt|=Ve.STENCIL_BUFFER_BIT,this.clearStencil.set(X),this.stencilMask.set(255)),Ve.clear(kt)}setCullFace(f){f.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(f.mode),this.frontFace.set(f.frontFace))}setDepthMode(f){f.func!==this.gl.ALWAYS||f.mask?(this.depthTest.set(!0),this.depthFunc.set(f.func),this.depthMask.set(f.mask),this.depthRange.set(f.range)):this.depthTest.set(!1)}setStencilMode(f){f.test.func!==this.gl.ALWAYS||f.mask?(this.stencilTest.set(!0),this.stencilMask.set(f.mask),this.stencilOp.set([f.fail,f.depthFail,f.pass]),this.stencilFunc.set({func:f.test.func,ref:f.ref,mask:f.test.mask})):this.stencilTest.set(!1)}setColorMode(f){h(f.blendFunction,a.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(f.blendFunction),this.blendColor.set(f.blendColor)),this.colorMask.set(f.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ih extends a.Evented{constructor(f,T,X,Ve){if(super(),this.id=f,this.dispatcher=X,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(T,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},T),this._collectResourceTiming=T.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(Ve),this._tileWorkers={},this._deduped=new a.DedupedRequest}load(f){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"}));const T=Array.isArray(this.map._language)?this.map._language.join():this.map._language,X=this.map._worldview;this._tileJSONRequest=od(this._options,this.map._requestManager,T,X,(Ve,kt)=>{this._tileJSONRequest=null,this._loaded=!0,Ve?(T&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${T}`),X&&X.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${X}`),this.fire(new a.ErrorEvent(Ve))):kt&&(a.extend(this,kt),kt.bounds&&(this.tileBounds=new Wp(kt.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(kt.tiles,this.map._requestManager._customAccessToken),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))),f&&f(Ve)})}loaded(){return this._loaded}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}onAdd(f){this.map=f,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(f){return this._options.tiles=f,this.reload(),this}setUrl(f){return this.url=f,this._options.url=f,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return a.extend({},this._options)}loadTile(f,T){const X=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),Ve={request:this.map._requestManager.transformRequest(X,a.ResourceType.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:f.isSymbolTile};if(Ve.request.collectResourceTiming=this._collectResourceTiming,f.actor&&f.state!=="expired")f.state==="loading"?f.reloadCallback=T:f.request=f.actor.send("reloadTile",Ve,kt.bind(this));else if(f.actor=this._tileWorkers[X]=this._tileWorkers[X]||this.dispatcher.getActor(),this.dispatcher.ready)f.request=f.actor.send("loadTile",Ve,kt.bind(this),void 0,!0);else{const Hr=a.loadVectorTile.call({deduped:this._deduped},Ve,(pi,Vn)=>{pi||!Vn?kt.call(this,pi):(Ve.data={cacheControl:Vn.cacheControl,expires:Vn.expires,rawData:Vn.rawData.slice(0)},f.actor&&f.actor.send("loadTile",Ve,kt.bind(this),void 0,!0))},!0);f.request={cancel:Hr}}function kt(Hr,pi){return delete f.request,f.aborted?T(null):Hr&&Hr.status!==404?T(Hr):(pi&&pi.resourceTiming&&(f.resourceTiming=pi.resourceTiming),this.map._refreshExpiredTiles&&pi&&f.setExpiryData(pi),f.loadVectorData(pi,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),T(null),void(f.reloadCallback&&(this.loadTile(f,f.reloadCallback),f.reloadCallback=null)))}}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.actor&&f.actor.send("abortTile",{uid:f.uid,type:this.type,source:this.id})}unloadTile(f){f.unloadVectorData(),f.actor&&f.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class uh extends a.Evented{constructor(f,T,X,Ve){super(),this.id=f,this.dispatcher=X,this.setEventedParent(Ve),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},T),a.extend(this,a.pick(T,["url","scheme","tileSize"]))}load(f){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=od(this._options,this.map._requestManager,null,null,(T,X)=>{this._tileJSONRequest=null,this._loaded=!0,T?this.fire(new a.ErrorEvent(T)):X&&(a.extend(this,X),X.bounds&&(this.tileBounds=new Wp(X.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(X.tiles),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))),f&&f(T)})}loaded(){return this._loaded}onAdd(f){this.map=f,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(f){return this._options.tiles=f,this.reload(),this}setUrl(f){return this.url=f,this._options.url=f,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return a.extend({},this._options)}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,T){const X=a.exported.devicePixelRatio>=2,Ve=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),X,this.tileSize);f.request=a.getImage(this.map._requestManager.transformRequest(Ve,a.ResourceType.Tile),(kt,Hr,pi,Vn)=>(delete f.request,f.aborted?(f.state="unloaded",T(null)):kt?(f.state="errored",T(kt)):Hr?(this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:pi,expires:Vn}),f.setTexture(Hr,this.map.painter),f.state="loaded",a.cacheEntryPossiblyAdded(this.dispatcher),void T(null)):T(null)))}static loadTileData(f,T,X){f.setTexture(T,X)}static unloadTileData(f,T){f.texture&&T.saveTileTexture(f.texture)}abortTile(f,T){f.request&&(f.request.cancel(),delete f.request),T()}unloadTile(f,T){f.texture&&this.map.painter.saveTileTexture(f.texture),T()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function vh(F,f,T,X,Ve,kt,Hr,pi){const Vn=[F,T,Ve,f,X,kt,1,1,1],oa=[Hr,pi,1],sa=a.adjoint([],Vn),[dl,lh,gh]=a.transformMat3(oa,oa,a.transpose(sa,sa));return a.multiply$1(Vn,[dl,0,0,0,lh,0,0,0,gh],Vn)}class Th extends a.Evented{constructor(f,T,X,Ve){super(),this.id=f,this.dispatcher=X,this.coordinates=T.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(Ve),this.options=T,this._dirty=!1}load(f,T){this._loaded=T||!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),(X,Ve)=>{if(this._imageRequest=null,this._loaded=!0,X)this.fire(new a.ErrorEvent(X));else if(Ve){const{HTMLImageElement:kt}=a.window;this.image=Ve instanceof kt?a.exported.getImageData(Ve):Ve,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,f&&(this.coordinates=f),this._finishLoading()}})}loaded(){return this._loaded}updateImage(f){return this.image&&f.url?(this._imageRequest&&f.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=f.url,this.load(f.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(f){this.map=f,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(f){this.coordinates=f,this._boundsArray=void 0;const T=f.map(a.MercatorCoordinate.fromLngLat);return this.tileID=function(X){let Ve=1/0,kt=1/0,Hr=-1/0,pi=-1/0;for(const dl of X)Ve=Math.min(Ve,dl.x),kt=Math.min(kt,dl.y),Hr=Math.max(Hr,dl.x),pi=Math.max(pi,dl.y);const Vn=Math.max(Hr-Ve,pi-kt),oa=Math.max(0,Math.floor(-Math.log(Vn)/Math.LN2)),sa=Math.pow(2,oa);return new a.CanonicalTileID(oa,Math.floor((Ve+Hr)/2*sa),Math.floor((kt+pi)/2*sa))}(T),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(f){for(const Vn in this.tiles){const oa=this.tiles[Vn];oa.state!=="loaded"&&(oa.state="loaded",oa.texture=this.texture)}if(this._boundsArray)return;const T=a.tileTransform(this.tileID,this.map.transform.projection),[X,Ve,kt,Hr]=this.coordinates.map(Vn=>{const oa=T.projection.project(Vn[0],Vn[1]);return a.getTilePoint(T,oa)._round()});this.perspectiveTransform=function(Vn,oa,sa,dl,lh,gh,_h,yh,xh,yl){const mh=vh(0,0,Vn,0,0,oa,Vn,oa),bh=vh(sa,dl,lh,gh,_h,yh,xh,yl);return a.multiply$1(bh,a.adjoint(mh,mh),bh),[bh[6]/bh[8]*Vn/a.EXTENT,bh[7]/bh[8]*oa/a.EXTENT]}(this.width,this.height,X.x,X.y,Ve.x,Ve.y,Hr.x,Hr.y,kt.x,kt.y);const pi=this._boundsArray=new a.StructArrayLayout4i8;pi.emplaceBack(X.x,X.y,0,0),pi.emplaceBack(Ve.x,Ve.y,a.EXTENT,0),pi.emplaceBack(Hr.x,Hr.y,0,a.EXTENT),pi.emplaceBack(kt.x,kt.y,a.EXTENT,a.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=f.createVertexBuffer(pi,a.boundsAttributes.members),this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const f=this.map.painter.context,T=f.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new a.Texture(f,this.image,T.RGBA),this.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(f)}loadTile(f,T){this.tileID&&this.tileID.equals(f.tileID.canonical)?(this.tiles[String(f.tileID.wrap)]=f,f.buckets={},T(null)):(f.state="errored",T(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const kh={vector:ih,raster:uh,"raster-dem":class extends uh{constructor(F,f,T,X){super(F,f,T,X),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},f),this.encoding=f.encoding||"mapbox"}loadTile(F,f){const T=this.map._requestManager.normalizeTileURL(F.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function X(Ve,kt){Ve&&(F.state="errored",f(Ve)),kt&&(F.dem=kt,F.dem.onDeserialize(),F.needsHillshadePrepare=!0,F.needsDEMTextureUpload=!0,F.state="loaded",f(null))}F.request=a.getImage(this.map._requestManager.transformRequest(T,a.ResourceType.Tile),(function(Ve,kt,Hr,pi){if(delete F.request,F.aborted)F.state="unloaded",f(null);else if(Ve)F.state="errored",f(Ve);else if(kt){this.map._refreshExpiredTiles&&F.setExpiryData({cacheControl:Hr,expires:pi});const Vn=a.window.ImageBitmap&&kt instanceof a.window.ImageBitmap&&(Ep==null&&(Ep=a.window.OffscreenCanvas&&new a.window.OffscreenCanvas(1,1).getContext("2d")&&typeof a.window.createImageBitmap=="function"),Ep),oa=1-(kt.width-a.prevPowerOfTwo(kt.width))/2;oa<1||F.neighboringTiles||(F.neighboringTiles=this._getNeighboringTiles(F.tileID));const sa=Vn?kt:a.exported.getImageData(kt,oa),dl={uid:F.uid,coord:F.tileID,source:this.id,rawImageData:sa,encoding:this.encoding,padding:oa};F.actor&&F.state!=="expired"||(F.actor=this.dispatcher.getActor(),F.actor.send("loadDEMTile",dl,X.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(F){const f=F.canonical,T=Math.pow(2,f.z),X=(f.x-1+T)%T,Ve=f.x===0?F.wrap-1:F.wrap,kt=(f.x+1+T)%T,Hr=f.x+1===T?F.wrap+1:F.wrap,pi={};return pi[new a.OverscaledTileID(F.overscaledZ,Ve,f.z,X,f.y).key]={backfilled:!1},pi[new a.OverscaledTileID(F.overscaledZ,Hr,f.z,kt,f.y).key]={backfilled:!1},f.y>0&&(pi[new a.OverscaledTileID(F.overscaledZ,Ve,f.z,X,f.y-1).key]={backfilled:!1},pi[new a.OverscaledTileID(F.overscaledZ,F.wrap,f.z,f.x,f.y-1).key]={backfilled:!1},pi[new a.OverscaledTileID(F.overscaledZ,Hr,f.z,kt,f.y-1).key]={backfilled:!1}),f.y+1<T&&(pi[new a.OverscaledTileID(F.overscaledZ,Ve,f.z,X,f.y+1).key]={backfilled:!1},pi[new a.OverscaledTileID(F.overscaledZ,F.wrap,f.z,f.x,f.y+1).key]={backfilled:!1},pi[new a.OverscaledTileID(F.overscaledZ,Hr,f.z,kt,f.y+1).key]={backfilled:!1}),pi}unloadTile(F){F.demTexture&&this.map.painter.saveTileTexture(F.demTexture),F.fbo&&(F.fbo.destroy(),delete F.fbo),F.dem&&delete F.dem,delete F.neighboringTiles,F.state="unloaded"}},geojson:class extends a.Evented{constructor(F,f,T,X){super(),this.id=F,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=T.getActor(),this.setEventedParent(X),this._data=f.data,this._options=a.extend({},f),this._collectResourceTiming=f.collectResourceTiming,f.maxzoom!==void 0&&(this.maxzoom=f.maxzoom),f.type&&(this.type=f.type),f.attribution&&(this.attribution=f.attribution),this.promoteId=f.promoteId;const Ve=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:f.cluster||!1,geojsonVtOptions:{buffer:(f.buffer!==void 0?f.buffer:128)*Ve,tolerance:(f.tolerance!==void 0?f.tolerance:.375)*Ve,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:f.lineMetrics||!1,generateId:f.generateId||!1},superclusterOptions:{maxZoom:f.clusterMaxZoom!==void 0?f.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,f.clusterMinPoints||2),extent:a.EXTENT,radius:(f.clusterRadius!==void 0?f.clusterRadius:50)*Ve,log:!1,generateId:f.generateId||!1},clusterProperties:f.clusterProperties,filter:f.filter},f.workerOptions)}onAdd(F){this.map=F,this.setData(this._data)}setData(F){return this._data=F,this._updateWorkerData(),this}getClusterExpansionZoom(F,f){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:F,source:this.id},f),this}getClusterChildren(F,f){return this.actor.send("geojson.getClusterChildren",{clusterId:F,source:this.id},f),this}getClusterLeaves(F,f,T,X){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:F,limit:f,offset:T},X),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.Event("dataloading",{dataType:"source"})),this._loaded=!1;const F=a.extend({},this.workerOptions),f=this._data;typeof f=="string"?(F.request=this.map._requestManager.transformRequest(a.exported.resolveURL(f),a.ResourceType.Source),F.request.collectResourceTiming=this._collectResourceTiming):F.data=JSON.stringify(f),this._pendingLoad=this.actor.send(`${this.type}.loadData`,F,(T,X)=>{if(this._loaded=!0,this._pendingLoad=null,T)this.fire(new a.ErrorEvent(T));else{const Ve={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&X&&X.resourceTiming&&X.resourceTiming[this.id]&&(Ve.resourceTiming=X.resourceTiming[this.id]),this.fire(new a.Event("data",Ve)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(F,f){const T=F.actor?"reloadTile":"loadTile";F.actor=this.actor,F.request=this.actor.send(T,{type:this.type,uid:F.uid,tileID:F.tileID,tileZoom:F.tileZoom,zoom:F.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(X,Ve)=>(delete F.request,F.unloadVectorData(),F.aborted?f(null):X?f(X):(F.loadVectorData(Ve,this.map.painter,T==="reloadTile"),f(null))),void 0,T==="loadTile")}abortTile(F){F.request&&(F.request.cancel(),delete F.request),F.aborted=!0}unloadTile(F){F.unloadVectorData(),this.actor.send("removeTile",{uid:F.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Th{constructor(F,f,T,X){super(F,f,T,X),this.roundZoom=!0,this.type="video",this.options=f}load(){this._loaded=!1;const F=this.options;this.urls=[];for(const f of F.urls)this.urls.push(this.map._requestManager.transformRequest(f,a.ResourceType.Source).url);a.getVideo(this.urls,(f,T)=>{this._loaded=!0,f?this.fire(new a.ErrorEvent(f)):T&&(this.video=T,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(F){if(this.video){const f=this.video.seekable;F<f.start(0)||F>f.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${f.start(0)} and ${f.end(0)}-second mark.`))):this.video.currentTime=F}}getVideo(){return this.video}onAdd(F){this.map||(this.map=F,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const F=this.map.painter.context,f=F.gl;this.texture?this.video.paused||(this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,f.UNSIGNED_BYTE,this.video)):(this.texture=new a.Texture(F,this.video,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(F)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Th,canvas:class extends Th{constructor(F,f,T,X){super(F,f,T,X),f.coordinates?Array.isArray(f.coordinates)&&f.coordinates.length===4&&!f.coordinates.some(Ve=>!Array.isArray(Ve)||Ve.length!==2||Ve.some(kt=>typeof kt!="number"))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${F}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${F}`,null,'missing required property "coordinates"'))),f.animate&&typeof f.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${F}`,null,'optional "animate" property must be a boolean value'))),f.canvas?typeof f.canvas=="string"||f.canvas instanceof a.window.HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${F}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${F}`,null,'missing required property "canvas"'))),this.options=f,this.animate=f.animate===void 0||f.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof a.window.HTMLCanvasElement?this.options.canvas:a.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(F){this.map=F,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let F=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,F=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,F=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const f=this.map.painter.context;this.texture?(F||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.Texture(f,this.canvas,f.gl.RGBA,{premultiply:!0}),this._prepareData(f)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const F of[this.canvas.width,this.canvas.height])if(isNaN(F)||F<=0)return!0;return!1}},custom:class extends a.Evented{constructor(F,f,T,X){super(),this.id=F,this.type="custom",this._dataType="raster",this._dispatcher=T,this._implementation=f,this.setEventedParent(X),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Wp(this._implementation.bounds,this.minzoom,this.maxzoom)),f.update=this._update.bind(this),f.clearTiles=this._clearTiles.bind(this),f.coveringTiles=this._coveringTiles.bind(this),a.extend(this,a.pick(f,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(F){this._map=F,this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(F),this.load()}onRemove(F){this._implementation.onRemove&&this._implementation.onRemove(F)}hasTile(F){if(this._implementation.hasTile){const{x:f,y:T,z:X}=F.canonical;return this._implementation.hasTile({x:f,y:T,z:X})}return!this.tileBounds||this.tileBounds.contains(F.canonical)}loadTile(F,f){const{x:T,y:X,z:Ve}=F.tileID.canonical,kt=new a.window.AbortController;F.request=Promise.resolve(this._implementation.loadTile({x:T,y:X,z:Ve},{signal:kt.signal})).then((function(Hr){return delete F.request,F.aborted?(F.state="unloaded",f(null)):Hr===void 0?(F.state="errored",f(null)):Hr===null?(this.loadTileData(F,{width:this.tileSize,height:this.tileSize,data:null}),F.state="loaded",f(null)):function(pi){return pi instanceof a.window.ImageData||pi instanceof a.window.HTMLCanvasElement||pi instanceof a.window.ImageBitmap||pi instanceof a.window.HTMLImageElement}(Hr)?(this.loadTileData(F,Hr),F.state="loaded",void f(null)):(F.state="errored",f(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(Hr=>{Hr.code!==20&&(F.state="errored",f(Hr))}),F.request.cancel=()=>kt.abort()}loadTileData(F,f){uh.loadTileData(F,f,this._map.painter)}unloadTileData(F){uh.unloadTileData(F,this._map.painter)}unloadTile(F,f){if(this.unloadTileData(F),this._implementation.unloadTile){const{x:T,y:X,z:Ve}=F.tileID.canonical;this._implementation.unloadTile({x:T,y:X,z:Ve})}f()}abortTile(F,f){F.request&&F.request.cancel&&(F.request.cancel(),delete F.request),f()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(F=>({x:F.canonical.x,y:F.canonical.y,z:F.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}}},ep=function(F,f,T,X){const Ve=new kh[f.type](F,f,T,X);if(Ve.id!==F)throw new Error(`Expected Source id to be ${F} instead of ${Ve.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],Ve),Ve};function ip(F,f){const T=a.identity([]);return a.scale(T,T,[.5*F.width,.5*-F.height,1]),a.translate(T,T,[1,-1,0]),a.multiply(T,T,F.calculateProjMatrix(f.toUnwrapped())),Float32Array.from(T)}function _p(F,f,T,X,Ve,kt,Hr,pi=!1){const Vn=F.tilesIn(X,Hr,pi);Vn.sort(Dd);const oa=[];for(const dl of Vn)oa.push({wrappedTileID:dl.tile.tileID.wrapped().key,queryResults:dl.tile.queryRenderedFeatures(f,T,F._state,dl,Ve,kt,ip(F.transform,dl.tile.tileID),pi)});const sa=function(dl){const lh={},gh={};for(const _h of dl){const yh=_h.queryResults,xh=_h.wrappedTileID,yl=gh[xh]=gh[xh]||{};for(const mh in yh){const bh=yh[mh],Sh=yl[mh]=yl[mh]||{},Nh=lh[mh]=lh[mh]||[];for(const $h of bh)Sh[$h.featureIndex]||(Sh[$h.featureIndex]=!0,Nh.push($h))}}return lh}(oa);for(const dl in sa)sa[dl].forEach(lh=>{const gh=lh.feature,_h=gh.layer;_h&&_h.type!=="background"&&_h.type!=="sky"&&(gh.source=_h.source,_h["source-layer"]&&(gh.sourceLayer=_h["source-layer"]),gh.state=gh.id!==void 0?F.getFeatureState(_h["source-layer"],gh.id):{})});return sa}function rd(F,f){const T=F.getRenderableIds().map(kt=>F.getTileByID(kt)),X=[],Ve={};for(let kt=0;kt<T.length;kt++){const Hr=T[kt],pi=Hr.tileID.canonical.key;Ve[pi]||(Ve[pi]=!0,Hr.querySourceFeatures(X,f))}return X}function Dd(F,f){const T=F.tileID,X=f.tileID;return T.overscaledZ-X.overscaledZ||T.canonical.y-X.canonical.y||T.wrap-X.wrap||T.canonical.x-X.canonical.x}function qp(){return gd.workerClass!=null?new gd.workerClass:new a.window.Worker(gd.workerUrl)}const wd="mapboxgl_preloaded_worker_pool";class dd{constructor(){this.active={}}acquire(f){if(!this.workers)for(this.workers=[];this.workers.length<dd.workerCount;)this.workers.push(new qp);return this.active[f]=!0,this.workers.slice()}release(f){delete this.active[f],this.numActive()===0&&(this.workers.forEach(T=>{T.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[wd]}numActive(){return Object.keys(this.active).length}}let Wd;function Vf(){return Wd||(Wd=new dd),Wd}function Wf(F,f){const T={};for(const X in F)X!=="ref"&&(T[X]=F[X]);return a.refProperties.forEach(X=>{X in f&&(T[X]=f[X])}),T}function pg(F){F=F.slice();const f=Object.create(null);for(let T=0;T<F.length;T++)f[F[T].id]=F[T];for(let T=0;T<F.length;T++)"ref"in F[T]&&(F[T]=Wf(F[T],f[F[T].ref]));return F}dd.workerCount=2;const Jd={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Yd(F,f,T){T.push({command:Jd.addSource,args:[F,f[F]]})}function Cg(F,f,T){f.push({command:Jd.removeSource,args:[F]}),T[F]=!0}function oy(F,f,T,X){Cg(F,T,X),Yd(F,f,T)}function Bg(F,f,T){let X;for(X in F[T])if(F[T].hasOwnProperty(X)&&X!=="data"&&!h(F[T][X],f[T][X]))return!1;for(X in f[T])if(f[T].hasOwnProperty(X)&&X!=="data"&&!h(F[T][X],f[T][X]))return!1;return!0}function Xg(F,f,T,X,Ve,kt){let Hr;for(Hr in f=f||{},F=F||{})F.hasOwnProperty(Hr)&&(h(F[Hr],f[Hr])||T.push({command:kt,args:[X,Hr,f[Hr],Ve]}));for(Hr in f)f.hasOwnProperty(Hr)&&!F.hasOwnProperty(Hr)&&(h(F[Hr],f[Hr])||T.push({command:kt,args:[X,Hr,f[Hr],Ve]}))}function nm(F){return F.id}function u_(F,f){return F[f.id]=f,F}class xv{constructor(f,T){this.reset(f,T)}reset(f,T){this.points=f||[],this._distances=[0];for(let X=1;X<this.points.length;X++)this._distances[X]=this._distances[X-1]+this.points[X].dist(this.points[X-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(T||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(f){if(this.points.length===1)return this.points[0];f=a.clamp(f,0,1);let T=1,X=this._distances[T];const Ve=f*this.paddedLength+this.padding;for(;X<Ve&&T<this._distances.length;)X=this._distances[++T];const kt=T-1,Hr=this._distances[kt],pi=X-Hr,Vn=pi>0?(Ve-Hr)/pi:0;return this.points[kt].mult(1-Vn).add(this.points[T].mult(Vn))}}class Dg{constructor(f,T,X){const Ve=this.boxCells=[],kt=this.circleCells=[];this.xCellCount=Math.ceil(f/X),this.yCellCount=Math.ceil(T/X);for(let Hr=0;Hr<this.xCellCount*this.yCellCount;Hr++)Ve.push([]),kt.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=f,this.height=T,this.xScale=this.xCellCount/f,this.yScale=this.yCellCount/T,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(f,T,X,Ve,kt){this._forEachCell(T,X,Ve,kt,this._insertBoxCell,this.boxUid++),this.boxKeys.push(f),this.bboxes.push(T),this.bboxes.push(X),this.bboxes.push(Ve),this.bboxes.push(kt)}insertCircle(f,T,X,Ve){this._forEachCell(T-Ve,X-Ve,T+Ve,X+Ve,this._insertCircleCell,this.circleUid++),this.circleKeys.push(f),this.circles.push(T),this.circles.push(X),this.circles.push(Ve)}_insertBoxCell(f,T,X,Ve,kt,Hr){this.boxCells[kt].push(Hr)}_insertCircleCell(f,T,X,Ve,kt,Hr){this.circleCells[kt].push(Hr)}_query(f,T,X,Ve,kt,Hr){if(X<0||f>this.width||Ve<0||T>this.height)return!kt&&[];const pi=[];if(f<=0&&T<=0&&this.width<=X&&this.height<=Ve){if(kt)return!0;for(let Vn=0;Vn<this.boxKeys.length;Vn++)pi.push({key:this.boxKeys[Vn],x1:this.bboxes[4*Vn],y1:this.bboxes[4*Vn+1],x2:this.bboxes[4*Vn+2],y2:this.bboxes[4*Vn+3]});for(let Vn=0;Vn<this.circleKeys.length;Vn++){const oa=this.circles[3*Vn],sa=this.circles[3*Vn+1],dl=this.circles[3*Vn+2];pi.push({key:this.circleKeys[Vn],x1:oa-dl,y1:sa-dl,x2:oa+dl,y2:sa+dl})}return Hr?pi.filter(Hr):pi}return this._forEachCell(f,T,X,Ve,this._queryCell,pi,{hitTest:kt,seenUids:{box:{},circle:{}}},Hr),kt?pi.length>0:pi}_queryCircle(f,T,X,Ve,kt){const Hr=f-X,pi=f+X,Vn=T-X,oa=T+X;if(pi<0||Hr>this.width||oa<0||Vn>this.height)return!Ve&&[];const sa=[];return this._forEachCell(Hr,Vn,pi,oa,this._queryCellCircle,sa,{hitTest:Ve,circle:{x:f,y:T,radius:X},seenUids:{box:{},circle:{}}},kt),Ve?sa.length>0:sa}query(f,T,X,Ve,kt){return this._query(f,T,X,Ve,!1,kt)}hitTest(f,T,X,Ve,kt){return this._query(f,T,X,Ve,!0,kt)}hitTestCircle(f,T,X,Ve){return this._queryCircle(f,T,X,!0,Ve)}_queryCell(f,T,X,Ve,kt,Hr,pi,Vn){const oa=pi.seenUids,sa=this.boxCells[kt];if(sa!==null){const lh=this.bboxes;for(const gh of sa)if(!oa.box[gh]){oa.box[gh]=!0;const _h=4*gh;if(f<=lh[_h+2]&&T<=lh[_h+3]&&X>=lh[_h+0]&&Ve>=lh[_h+1]&&(!Vn||Vn(this.boxKeys[gh]))){if(pi.hitTest)return Hr.push(!0),!0;Hr.push({key:this.boxKeys[gh],x1:lh[_h],y1:lh[_h+1],x2:lh[_h+2],y2:lh[_h+3]})}}}const dl=this.circleCells[kt];if(dl!==null){const lh=this.circles;for(const gh of dl)if(!oa.circle[gh]){oa.circle[gh]=!0;const _h=3*gh;if(this._circleAndRectCollide(lh[_h],lh[_h+1],lh[_h+2],f,T,X,Ve)&&(!Vn||Vn(this.circleKeys[gh]))){if(pi.hitTest)return Hr.push(!0),!0;{const yh=lh[_h],xh=lh[_h+1],yl=lh[_h+2];Hr.push({key:this.circleKeys[gh],x1:yh-yl,y1:xh-yl,x2:yh+yl,y2:xh+yl})}}}}}_queryCellCircle(f,T,X,Ve,kt,Hr,pi,Vn){const oa=pi.circle,sa=pi.seenUids,dl=this.boxCells[kt];if(dl!==null){const gh=this.bboxes;for(const _h of dl)if(!sa.box[_h]){sa.box[_h]=!0;const yh=4*_h;if(this._circleAndRectCollide(oa.x,oa.y,oa.radius,gh[yh+0],gh[yh+1],gh[yh+2],gh[yh+3])&&(!Vn||Vn(this.boxKeys[_h])))return Hr.push(!0),!0}}const lh=this.circleCells[kt];if(lh!==null){const gh=this.circles;for(const _h of lh)if(!sa.circle[_h]){sa.circle[_h]=!0;const yh=3*_h;if(this._circlesCollide(gh[yh],gh[yh+1],gh[yh+2],oa.x,oa.y,oa.radius)&&(!Vn||Vn(this.circleKeys[_h])))return Hr.push(!0),!0}}}_forEachCell(f,T,X,Ve,kt,Hr,pi,Vn){const oa=this._convertToXCellCoord(f),sa=this._convertToYCellCoord(T),dl=this._convertToXCellCoord(X),lh=this._convertToYCellCoord(Ve);for(let gh=oa;gh<=dl;gh++)for(let _h=sa;_h<=lh;_h++)if(kt.call(this,f,T,X,Ve,this.xCellCount*_h+gh,Hr,pi,Vn))return}_convertToXCellCoord(f){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(f*this.xScale)))}_convertToYCellCoord(f){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(f*this.yScale)))}_circlesCollide(f,T,X,Ve,kt,Hr){const pi=Ve-f,Vn=kt-T,oa=X+Hr;return oa*oa>pi*pi+Vn*Vn}_circleAndRectCollide(f,T,X,Ve,kt,Hr,pi){const Vn=(Hr-Ve)/2,oa=Math.abs(f-(Ve+Vn));if(oa>Vn+X)return!1;const sa=(pi-kt)/2,dl=Math.abs(T-(kt+sa));if(dl>sa+X)return!1;if(oa<=Vn||dl<=sa)return!0;const lh=oa-Vn,gh=dl-sa;return lh*lh+gh*gh<=X*X}}const sy={unknown:0,flipRequired:1,flipNotRequired:2},fy=Math.tan(85*Math.PI/180);function hp(F,f,T,X,Ve,kt,Hr){const pi=a.create();if(T)if(kt.name==="globe"){const Vn=a.calculateGlobeLabelMatrix(Ve,f);a.multiply(pi,pi,Vn)}else{const Vn=sl([],Hr);pi[0]=Vn[0],pi[1]=Vn[1],pi[4]=Vn[2],pi[5]=Vn[3],X||a.rotateZ(pi,pi,Ve.angle)}else a.multiply(pi,Ve.labelPlaneMatrix,F);return pi}function gy(F,f,T,X,Ve,kt,Hr){const pi=hp(F,f,T,X,Ve,kt,Hr);return kt.name==="globe"&&T||(pi[2]=pi[6]=pi[10]=pi[14]=0),pi}function xg(F,f,T,X,Ve,kt,Hr){if(T){if(kt.name==="globe"){const pi=hp(F,f,T,X,Ve,kt,Hr);return a.invert(pi,pi),a.multiply(pi,F,pi),pi}{const pi=a.clone(F),Vn=a.identity([]);return Vn[0]=Hr[0],Vn[1]=Hr[1],Vn[4]=Hr[2],Vn[5]=Hr[3],a.multiply(pi,pi,Vn),X||a.rotateZ(pi,pi,-Ve.angle),pi}}return Ve.glCoordMatrix}function hm(F,f,T,X){const Ve=[F,f,T,1];T?a.transformMat4$1(Ve,Ve,X):Kf(Ve,Ve,X);const kt=Ve[3];return Ve[0]/=kt,Ve[1]/=kt,Ve[2]/=kt,Ve}function xm(F,f){return Math.min(.5+F/f*.5,1.5)}function my(F,f){const T=F[0]/F[3],X=F[1]/F[3];return T>=-f[0]&&T<=f[0]&&X>=-f[1]&&X<=f[1]}function wv(F,f,T,X,Ve,kt,Hr,pi,Vn,oa){const sa=T.transform,dl=X?F.textSizeData:F.iconSizeData,lh=a.evaluateSizeForZoom(dl,T.transform.zoom),gh=sa.projection.name==="globe",_h=[256/T.width*2+1,256/T.height*2+1],yh=X?F.text.dynamicLayoutVertexArray:F.icon.dynamicLayoutVertexArray;yh.clear();let xh=null;gh&&(xh=X?F.text.globeExtVertexArray:F.icon.globeExtVertexArray);const yl=F.lineVertexArray,mh=X?F.text.placedSymbolArray:F.icon.placedSymbolArray,bh=T.transform.width/T.transform.height;let Sh,Nh=!1;for(let $h=0;$h<mh.length;$h++){const Vh=mh.get($h),{numGlyphs:Wh,writingMode:Zh}=Vh;if(Zh!==a.WritingMode.vertical||Nh||Sh===a.WritingMode.horizontal||(Nh=!0),Sh=Zh,(Vh.hidden||Zh===a.WritingMode.vertical)&&!Nh){yy(Wh,yh);continue}Nh=!1;const rp=new a.Point(Vh.tileAnchorX,Vh.tileAnchorY);let{x:Bp,y:tp,z:Tp}=sa.projection.projectTilePoint(rp.x,rp.y,oa.canonical);if(Vn){const[jf,Pd,Zd]=Vn(rp);Bp+=jf,tp+=Pd,Tp+=Zd}const pp=[Bp,tp,Tp,1];if(a.transformMat4$1(pp,pp,f),!my(pp,_h)){yy(Wh,yh);continue}const bp=xm(T.transform.cameraToCenterDistance,pp[3]),np=a.evaluateSizeForFeature(dl,lh,Vh),wp=Hr?np/bp:np*bp,Fp=hm(Bp,tp,Tp,Ve);if(Fp[3]<=0){yy(Wh,yh);continue}let Pp={};const Up=Hr?null:Vn,zd=ad(Vh,wp,!1,pi,f,Ve,kt,F.glyphOffsetArray,yl,yh,xh,Fp,rp,Pp,bh,Up,sa.projection,oa,Hr);Nh=zd.useVertical,Up&&zd.needsFlipping&&(Pp={}),(zd.notEnoughRoom||Nh||zd.needsFlipping&&ad(Vh,wp,!0,pi,f,Ve,kt,F.glyphOffsetArray,yl,yh,xh,Fp,rp,Pp,bh,Up,sa.projection,oa,Hr).notEnoughRoom)&&yy(Wh,yh)}X?(F.text.dynamicLayoutVertexBuffer.updateData(yh),xh&&F.text.globeExtVertexBuffer.updateData(xh)):(F.icon.dynamicLayoutVertexBuffer.updateData(yh),xh&&F.icon.globeExtVertexBuffer.updateData(xh))}function qy(F,f,T,X,Ve,kt,Hr,pi,Vn,oa,sa,dl,lh,gh,_h,yh){const{lineStartIndex:xh,glyphStartIndex:yl,segment:mh}=pi,bh=yl+pi.numGlyphs,Sh=xh+pi.lineLength,Nh=f.getoffsetX(yl),$h=f.getoffsetX(bh-1),Vh=Wm(F*Nh,T,X,Ve,kt,Hr,mh,xh,Sh,Vn,oa,sa,dl,lh,!0,gh,_h,yh);if(!Vh)return null;const Wh=Wm(F*$h,T,X,Ve,kt,Hr,mh,xh,Sh,Vn,oa,sa,dl,lh,!0,gh,_h,yh);return Wh?{first:Vh,last:Wh}:null}function lg(F,f,T,X){return F===a.WritingMode.horizontal&&Math.abs(X)>Math.abs(T)?{useVertical:!0}:F===a.WritingMode.vertical?X>0?{needsFlipping:!0}:null:f!==sy.unknown&&function(Ve,kt){return Ve===0||Math.abs(kt/Ve)>fy}(T,X)?f===sy.flipRequired?{needsFlipping:!0}:null:T<0?{needsFlipping:!0}:null}function ad(F,f,T,X,Ve,kt,Hr,pi,Vn,oa,sa,dl,lh,gh,_h,yh,xh,yl,mh){const bh=f/24,Sh=F.lineOffsetX*bh,Nh=F.lineOffsetY*bh,{lineStartIndex:$h,glyphStartIndex:Vh,numGlyphs:Wh,segment:Zh,writingMode:rp,flipState:Bp}=F,tp=$h+F.lineLength,Tp=pp=>{if(sa){const[Fp,Pp,Up]=pp.up,zd=oa.length;a.updateGlobeVertexNormal(sa,zd+0,Fp,Pp,Up),a.updateGlobeVertexNormal(sa,zd+1,Fp,Pp,Up),a.updateGlobeVertexNormal(sa,zd+2,Fp,Pp,Up),a.updateGlobeVertexNormal(sa,zd+3,Fp,Pp,Up)}const[bp,np,wp]=pp.point;a.addDynamicAttributes(oa,bp,np,wp,pp.angle)};if(Wh>1){const pp=qy(bh,pi,Sh,Nh,T,dl,lh,F,Vn,kt,gh,yh,!1,xh,yl,mh);if(!pp)return{notEnoughRoom:!0};if(X&&!T){let[bp,np,wp]=pp.first.point,[Fp,Pp,Up]=pp.last.point;[bp,np]=hm(bp,np,wp,Hr),[Fp,Pp]=hm(Fp,Pp,Up,Hr);const zd=lg(rp,Bp,(Fp-bp)*_h,Pp-np);if(F.flipState=zd&&zd.needsFlipping?sy.flipRequired:sy.flipNotRequired,zd)return zd}Tp(pp.first);for(let bp=Vh+1;bp<Vh+Wh-1;bp++){const np=Wm(bh*pi.getoffsetX(bp),Sh,Nh,T,dl,lh,Zh,$h,tp,Vn,kt,gh,yh,!1,!1,xh,yl,mh);if(!np)return oa.length-=4*(bp-Vh),{notEnoughRoom:!0};Tp(np)}Tp(pp.last)}else{if(X&&!T){const bp=hm(lh.x,lh.y,0,Ve),np=$h+Zh+1,wp=new a.Point(Vn.getx(np),Vn.gety(np)),Fp=hm(wp.x,wp.y,0,Ve),Pp=Fp[3]>0?Fp:Hf(lh,wp,bp,1,Ve,void 0,xh,yl.canonical),Up=lg(rp,Bp,(Pp[0]-bp[0])*_h,Pp[1]-bp[1]);if(F.flipState=Up&&Up.needsFlipping?sy.flipRequired:sy.flipNotRequired,Up)return Up}const pp=Wm(bh*pi.getoffsetX(Vh),Sh,Nh,T,dl,lh,Zh,$h,tp,Vn,kt,gh,yh,!1,!1,xh,yl,mh);if(!pp)return{notEnoughRoom:!0};Tp(pp)}return{}}function qf(F,f,T,X,Ve){const{x:kt,y:Hr,z:pi}=X.projectTilePoint(F.x,F.y,f);if(!Ve)return hm(kt,Hr,pi,T);const[Vn,oa,sa]=Ve(F);return hm(kt+Vn,Hr+oa,pi+sa,T)}function Hf(F,f,T,X,Ve,kt,Hr,pi){const Vn=qf(F.sub(f)._unit()._add(F),pi,Ve,Hr,kt);return a.sub(Vn,T,Vn),a.normalize(Vn,Vn),a.scaleAndAdd(Vn,T,Vn,X)}function Wm(F,f,T,X,Ve,kt,Hr,pi,Vn,oa,sa,dl,lh,gh,_h,yh,xh,yl){const mh=X?F-f:F+f;let bh=mh>0?1:-1,Sh=0;X&&(bh*=-1,Sh=Math.PI),bh<0&&(Sh+=Math.PI);let Nh=pi+Hr+(bh>0?0:1)|0,$h=Ve,Vh=Ve,Wh=0,Zh=0;const rp=Math.abs(mh),Bp=[],tp=[];let Tp=kt,pp=Tp;const bp=()=>Hf(pp,Tp,Vh,rp-Wh+1,sa,lh,yh,xh.canonical);for(;Wh+Zh<=rp;){if(Nh+=bh,Nh<pi||Nh>=Vn)return null;if(Vh=$h,pp=Tp,Bp.push(Vh),gh&&tp.push(pp),Tp=new a.Point(oa.getx(Nh),oa.gety(Nh)),$h=dl[Nh],!$h){const Zd=qf(Tp,xh.canonical,sa,yh,lh);$h=Zd[3]>0?dl[Nh]=Zd:bp()}Wh+=Zh,Zh=a.distance(Vh,$h)}_h&&lh&&(dl[Nh]&&($h=bp(),Zh=a.distance(Vh,$h)),dl[Nh]=$h);const np=(rp-Wh)/Zh,wp=Tp.sub(pp)._mult(np)._add(pp),Fp=a.sub([],$h,Vh),Pp=a.scaleAndAdd([],Vh,Fp,np);let Up=[0,0,1],zd=Fp[0],jf=Fp[1];if(yl&&(Up=yh.upVector(xh.canonical,wp.x,wp.y),Up[0]!==0||Up[1]!==0||Up[2]!==1)){const Zd=[Up[2],0,-Up[0]],ig=a.cross([],Up,Zd);a.normalize(Zd,Zd),a.normalize(ig,ig),zd=a.dot(Fp,Zd),jf=a.dot(Fp,ig)}if(T){const Zd=a.cross([],Up,Fp);a.normalize(Zd,Zd),a.scaleAndAdd(Pp,Pp,Zd,T*bh)}const Pd=Sh+Math.atan2(jf,zd);return Bp.push(Pp),gh&&tp.push(wp),{point:Pp,angle:Pd,path:Bp,tilePath:tp,up:Up}}function yy(F,f){const T=f.length,X=T+4*F;f.resize(X),f.float32.fill(-1/0,4*T,4*X)}function Kf(F,f,T){const X=f[0],Ve=f[1];return F[0]=T[0]*X+T[4]*Ve+T[12],F[1]=T[1]*X+T[5]*Ve+T[13],F[3]=T[3]*X+T[7]*Ve+T[15],F}const qm=100;class k_{constructor(f,T,X=new Dg(f.width+200,f.height+200,25),Ve=new Dg(f.width+200,f.height+200,25)){this.transform=f,this.grid=X,this.ignoredGrid=Ve,this.pitchfactor=Math.cos(f._pitch)*f.cameraToCenterDistance,this.screenRightBoundary=f.width+qm,this.screenBottomBoundary=f.height+qm,this.gridRightBoundary=f.width+200,this.gridBottomBoundary=f.height+200,this.fogState=T}placeCollisionBox(f,T,X,Ve,kt,Hr,pi,Vn){let oa=X.projectedAnchorX,sa=X.projectedAnchorY,dl=X.projectedAnchorZ;const lh=X.elevation,gh=X.tileID,_h=f.getProjection();if(lh&&gh){const[$h,Vh,Wh]=_h.upVector(gh.canonical,X.tileAnchorX,X.tileAnchorY),Zh=_h.upVectorScale(gh.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;oa+=$h*lh*Zh,sa+=Vh*lh*Zh,dl+=Wh*lh*Zh}const yh=this.projectAndGetPerspectiveRatio(pi,oa,sa,dl,X.tileID,_h.name==="globe"||!!lh||this.transform.pitch>0,_h),xh=Hr*yh.perspectiveRatio,yl=(X.x1*T+Ve.x-X.padding)*xh+yh.point.x,mh=(X.y1*T+Ve.y-X.padding)*xh+yh.point.y,bh=(X.x2*T+Ve.x+X.padding)*xh+yh.point.x,Sh=(X.y2*T+Ve.y+X.padding)*xh+yh.point.y,Nh=yh.perspectiveRatio<=.55||yh.occluded;return!this.isInsideGrid(yl,mh,bh,Sh)||!kt&&this.grid.hitTest(yl,mh,bh,Sh,Vn)||Nh?{box:[],offscreen:!1,occluded:yh.occluded}:{box:[yl,mh,bh,Sh],offscreen:this.isOffscreen(yl,mh,bh,Sh),occluded:!1}}placeCollisionCircles(f,T,X,Ve,kt,Hr,pi,Vn,oa,sa,dl,lh,gh,_h,yh){const xh=[],yl=this.transform.elevation,mh=f.getProjection(),bh=yl?yl.getAtTileOffsetFunc(yh,this.transform.center.lat,this.transform.worldSize,mh):null,Sh=new a.Point(X.tileAnchorX,X.tileAnchorY);let{x:Nh,y:$h,z:Vh}=mh.projectTilePoint(Sh.x,Sh.y,yh.canonical);if(bh){const[wp,Fp,Pp]=bh(Sh);Nh+=wp,$h+=Fp,Vh+=Pp}const Wh=mh.name==="globe",Zh=this.projectAndGetPerspectiveRatio(pi,Nh,$h,Vh,yh,Wh||!!yl||this.transform.pitch>0,mh),{perspectiveRatio:rp}=Zh,Bp=(dl?Hr/rp:Hr*rp)/a.ONE_EM,tp=hm(Nh,$h,Vh,Vn),Tp=Zh.signedDistanceFromCamera>0?qy(Bp,kt,X.lineOffsetX*Bp,X.lineOffsetY*Bp,!1,tp,Sh,X,Ve,Vn,{},yl&&!dl?bh:null,dl&&!!yl,mh,yh,dl):null;let pp=!1,bp=!1,np=!0;if(Tp&&!Zh.occluded){const wp=.5*gh*rp+_h,Fp=new a.Point(-100,-100),Pp=new a.Point(this.screenRightBoundary,this.screenBottomBoundary),Up=new xv,{first:zd,last:jf}=Tp,Pd=zd.path.length;let Zd=[];for(let Bd=Pd-1;Bd>=1;Bd--)Zd.push(zd.path[Bd]);for(let Bd=1;Bd<jf.path.length;Bd++)Zd.push(jf.path[Bd]);const ig=2.5*wp;oa&&(Zd=Zd.map(([Bd,fg,Sg],Tg)=>(bh&&!Wh&&(Sg=bh(Tg<Pd-1?zd.tilePath[Pd-1-Tg]:jf.tilePath[Tg-Pd+2])[2]),hm(Bd,fg,Sg,oa))),Zd.some(Bd=>Bd[3]<=0)&&(Zd=[]));let Jf=[];if(Zd.length>0){let Bd=1/0,fg=-1/0,Sg=1/0,Tg=-1/0;for(const gg of Zd)Bd=Math.min(Bd,gg[0]),Sg=Math.min(Sg,gg[1]),fg=Math.max(fg,gg[0]),Tg=Math.max(Tg,gg[1]);fg>=Fp.x&&Bd<=Pp.x&&Tg>=Fp.y&&Sg<=Pp.y&&(Jf=[Zd.map(gg=>new a.Point(gg[0],gg[1]))],(Bd<Fp.x||fg>Pp.x||Sg<Fp.y||Tg>Pp.y)&&(Jf=a.clipLine(Jf,Fp.x,Fp.y,Pp.x,Pp.y)))}for(const Bd of Jf){Up.reset(Bd,.25*wp);let fg=0;fg=Up.length<=.5*wp?1:Math.ceil(Up.paddedLength/ig)+1;for(let Sg=0;Sg<fg;Sg++){const Tg=Sg/Math.max(fg-1,1),gg=Up.lerp(Tg),Jm=gg.x+qm,om=gg.y+qm;xh.push(Jm,om,wp,0);const uy=Jm-wp,Iy=om-wp,$g=Jm+wp,Ag=om+wp;if(np=np&&this.isOffscreen(uy,Iy,$g,Ag),bp=bp||this.isInsideGrid(uy,Iy,$g,Ag),!T&&this.grid.hitTestCircle(Jm,om,wp,lh)&&(pp=!0,!sa))return{circles:[],offscreen:!1,collisionDetected:pp,occluded:!1}}}}return{circles:!sa&&pp||!bp?[]:xh,offscreen:np,collisionDetected:pp,occluded:Zh.occluded}}queryRenderedSymbols(f){if(f.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const T=[];let X=1/0,Ve=1/0,kt=-1/0,Hr=-1/0;for(const sa of f){const dl=new a.Point(sa.x+qm,sa.y+qm);X=Math.min(X,dl.x),Ve=Math.min(Ve,dl.y),kt=Math.max(kt,dl.x),Hr=Math.max(Hr,dl.y),T.push(dl)}const pi=this.grid.query(X,Ve,kt,Hr).concat(this.ignoredGrid.query(X,Ve,kt,Hr)),Vn={},oa={};for(const sa of pi){const dl=sa.key;if(Vn[dl.bucketInstanceId]===void 0&&(Vn[dl.bucketInstanceId]={}),Vn[dl.bucketInstanceId][dl.featureIndex])continue;const lh=[new a.Point(sa.x1,sa.y1),new a.Point(sa.x2,sa.y1),new a.Point(sa.x2,sa.y2),new a.Point(sa.x1,sa.y2)];a.polygonIntersectsPolygon(T,lh)&&(Vn[dl.bucketInstanceId][dl.featureIndex]=!0,oa[dl.bucketInstanceId]===void 0&&(oa[dl.bucketInstanceId]=[]),oa[dl.bucketInstanceId].push(dl.featureIndex))}return oa}insertCollisionBox(f,T,X,Ve,kt){(T?this.ignoredGrid:this.grid).insert({bucketInstanceId:X,featureIndex:Ve,collisionGroupID:kt},f[0],f[1],f[2],f[3])}insertCollisionCircles(f,T,X,Ve,kt){const Hr=T?this.ignoredGrid:this.grid,pi={bucketInstanceId:X,featureIndex:Ve,collisionGroupID:kt};for(let Vn=0;Vn<f.length;Vn+=4)Hr.insertCircle(pi,f[Vn],f[Vn+1],f[Vn+2])}projectAndGetPerspectiveRatio(f,T,X,Ve,kt,Hr,pi){const Vn=[T,X,Ve,1];let oa=!1;Ve||this.transform.pitch>0?(a.transformMat4$1(Vn,Vn,f),this.fogState&&kt&&pi.name!=="globe"&&(oa=function(lh,gh,_h,yh,xh,yl){const mh=yl.calculateFogTileMatrix(xh),bh=[gh,_h,yh];return a.transformMat4(bh,bh,mh),vp(lh,bh,yl.pitch,yl._fov)}(this.fogState,T,X,Ve,kt.toUnwrapped(),this.transform)>.9)):Kf(Vn,Vn,f);const sa=Vn[3];return{point:new a.Point((Vn[0]/sa+1)/2*this.transform.width+qm,(-Vn[1]/sa+1)/2*this.transform.height+qm),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(pi)/sa*.5,1.5),signedDistanceFromCamera:sa,occluded:Hr&&Vn[2]>sa||oa}}isOffscreen(f,T,X,Ve){return X<qm||f>=this.screenRightBoundary||Ve<qm||T>this.screenBottomBoundary}isInsideGrid(f,T,X,Ve){return X>=0&&f<this.gridRightBoundary&&Ve>=0&&T<this.gridBottomBoundary}getViewportMatrix(){const f=a.identity([]);return a.translate(f,f,[-100,-100,0]),f}}function B_(F,f,T){const X=f.createTileMatrix(F,F.worldSize,T.toUnwrapped());return a.multiply(new Float32Array(16),F.projMatrix,X)}function ay(F,f,T){if(f.projection.name===T.projection.name)return F.projMatrix;const X=T.clone();return X.setProjection(f.projection),B_(X,f.getProjection(),F)}function Og(F,f,T){return f.name===T.projection.name?F.projMatrix:B_(T,f,F)}class B0{constructor(f,T,X,Ve){this.opacity=f?Math.max(0,Math.min(1,f.opacity+(f.placed?T:-T))):Ve&&X?1:0,this.placed=X}isHidden(){return this.opacity===0&&!this.placed}}class Ey{constructor(f,T,X,Ve,kt,Hr=!1){this.text=new B0(f?f.text:null,T,X,kt),this.icon=new B0(f?f.icon:null,T,Ve,kt),this.clipped=Hr}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class z_{constructor(f,T,X,Ve=!1){this.text=f,this.icon=T,this.skipFade=X,this.clipped=Ve}}class bv{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class z0{constructor(f,T,X,Ve,kt){this.bucketInstanceId=f,this.featureIndex=T,this.sourceLayerIndex=X,this.bucketIndex=Ve,this.tileID=kt}}class Ly{constructor(f){this.crossSourceCollisions=f,this.maxGroupID=0,this.collisionGroups={}}get(f){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[f]){const T=++this.maxGroupID;this.collisionGroups[f]={ID:T,predicate:X=>X.collisionGroupID===T}}return this.collisionGroups[f]}}function c_(F,f,T,X,Ve){const{horizontalAlign:kt,verticalAlign:Hr}=a.getAnchorAlignment(F),pi=-(kt-.5)*f,Vn=-(Hr-.5)*T,oa=a.evaluateVariableOffset(F,X);return new a.Point(pi+oa[0]*Ve,Vn+oa[1]*Ve)}function Fm(F,f,T,X,Ve){const kt=new a.Point(F,f);return T&&kt._rotate(X?Ve:-Ve),kt}class G_{constructor(f,T,X,Ve,kt){this.transform=f.clone(),this.projection=f.projection.name,this.collisionIndex=new k_(this.transform,kt),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=T,this.retainedQueryData={},this.collisionGroups=new Ly(X),this.collisionCircleArrays={},this.prevPlacement=Ve,Ve&&(Ve.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(f,T,X,Ve){const kt=X.getBucket(T),Hr=X.latestFeatureIndex;if(!kt||!Hr||T.id!==kt.layerIds[0])return;const pi=kt.layers[0].layout,Vn=X.collisionBoxArray,oa=Math.pow(2,this.transform.zoom-X.tileID.overscaledZ),sa=X.tileSize/a.EXTENT,dl=X.tileID.toUnwrapped();this.transform.setProjection(kt.projection);const lh=(gh=X.tileID,_h=kt.getProjection(),yh=this.transform,_h.name===this.projection?yh.calculateProjMatrix(gh.toUnwrapped()):B_(yh,_h,gh));var gh,_h,yh;const xh=pi.get("text-pitch-alignment")==="map",yl=pi.get("text-rotation-alignment")==="map";T.compileFilter();const mh=T.dynamicFilter(),bh=T.dynamicFilterNeedsFeature(),Sh=this.transform.calculatePixelsToTileUnitsMatrix(X),Nh=gy(lh,X.tileID.canonical,xh,yl,this.transform,kt.getProjection(),Sh);let $h=null;if(xh){const Zh=xg(lh,X.tileID.canonical,xh,yl,this.transform,kt.getProjection(),Sh);$h=a.multiply([],this.transform.labelPlaneMatrix,Zh)}let Vh=null;mh&&X.latestFeatureIndex&&(Vh={unwrappedTileID:dl,dynamicFilter:mh,dynamicFilterNeedsFeature:bh,featureIndex:X.latestFeatureIndex}),this.retainedQueryData[kt.bucketInstanceId]=new z0(kt.bucketInstanceId,Hr,kt.sourceLayerIndex,kt.index,X.tileID);const Wh={bucket:kt,layout:pi,posMatrix:lh,textLabelPlaneMatrix:Nh,labelToScreenMatrix:$h,clippingData:Vh,scale:oa,textPixelRatio:sa,holdingForFade:X.holdingForFade(),collisionBoxArray:Vn,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(kt.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.evaluateSizeForZoom(kt.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(kt.sourceID)};if(Ve)for(const Zh of kt.sortKeyRanges){const{sortKey:rp,symbolInstanceStart:Bp,symbolInstanceEnd:tp}=Zh;f.push({sortKey:rp,symbolInstanceStart:Bp,symbolInstanceEnd:tp,parameters:Wh})}else f.push({symbolInstanceStart:0,symbolInstanceEnd:kt.symbolInstances.length,parameters:Wh})}attemptAnchorPlacement(f,T,X,Ve,kt,Hr,pi,Vn,oa,sa,dl,lh,gh,_h,yh,xh,yl,mh){const{textOffset0:bh,textOffset1:Sh,crossTileID:Nh}=lh,$h=[bh,Sh],Vh=c_(f,X,Ve,$h,kt),Wh=this.collisionIndex.placeCollisionBox(_h,kt,T,Fm(Vh.x,Vh.y,Hr,pi,this.transform.angle),dl,Vn,oa,sa.predicate);if(xh){const Zh=_h.getSymbolInstanceIconSize(mh,this.transform.zoom,lh.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(_h,Zh,xh,Fm(Vh.x,Vh.y,Hr,pi,this.transform.angle),dl,Vn,oa,sa.predicate).box.length===0)return}if(Wh.box.length>0){let Zh;return this.prevPlacement&&this.prevPlacement.variableOffsets[Nh]&&this.prevPlacement.placements[Nh]&&this.prevPlacement.placements[Nh].text&&(Zh=this.prevPlacement.variableOffsets[Nh].anchor),this.variableOffsets[Nh]={textOffset:$h,width:X,height:Ve,anchor:f,textScale:kt,prevAnchor:Zh},this.markUsedJustification(_h,f,lh,yh),_h.allowVerticalPlacement&&(this.markUsedOrientation(_h,yh,lh),this.placedOrientations[Nh]=yh),{shift:Vh,placedGlyphBoxes:Wh}}}placeLayerBucketPart(f,T,X,Ve){const{bucket:kt,layout:Hr,posMatrix:pi,textLabelPlaneMatrix:Vn,labelToScreenMatrix:oa,clippingData:sa,textPixelRatio:dl,holdingForFade:lh,collisionBoxArray:gh,partiallyEvaluatedTextSize:_h,partiallyEvaluatedIconSize:yh,collisionGroup:xh}=f.parameters,yl=Hr.get("text-optional"),mh=Hr.get("icon-optional"),bh=Hr.get("text-allow-overlap"),Sh=Hr.get("icon-allow-overlap"),Nh=Hr.get("text-rotation-alignment")==="map",$h=Hr.get("text-pitch-alignment")==="map",Vh=Hr.get("icon-text-fit")!=="none",Wh=Hr.get("symbol-z-order")==="viewport-y";this.transform.setProjection(kt.projection);let Zh=bh&&(Sh||!kt.hasIconData()||mh),rp=Sh&&(bh||!kt.hasTextData()||yl);!kt.collisionArrays&&gh&&kt.deserializeCollisionBoxes(gh),X&&Ve&&kt.updateCollisionDebugBuffers(this.transform.zoom,gh);const Bp=(tp,Tp,pp)=>{const{crossTileID:bp,numVerticalGlyphVertices:np}=tp;if(sa){const $g={zoom:this.transform.zoom,pitch:this.transform.pitch};let Ag=null;if(sa.dynamicFilterNeedsFeature){const mg=this.retainedQueryData[kt.bucketInstanceId];Ag=sa.featureIndex.loadFeature({featureIndex:tp.featureIndex,bucketIndex:mg.bucketIndex,sourceLayerIndex:mg.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,sa.dynamicFilter)($g,Ag,this.retainedQueryData[kt.bucketInstanceId].tileID.canonical,new a.Point(tp.tileAnchorX,tp.tileAnchorY),this.transform.calculateDistanceTileData(sa.unwrappedTileID)))return this.placements[bp]=new z_(!1,!1,!1,!0),void T.add(bp)}if(T.has(bp))return;if(lh)return void(this.placements[bp]=new z_(!1,!1,!1));let wp=!1,Fp=!1,Pp=!0,Up=!1,zd=!1,jf=null,Pd={box:null,offscreen:null,occluded:null},Zd={box:null,offscreen:null,occluded:null},ig=null,Jf=null,Bd=null,fg=0,Sg=0,Tg=0;pp.textFeatureIndex?fg=pp.textFeatureIndex:tp.useRuntimeCollisionCircles&&(fg=tp.featureIndex),pp.verticalTextFeatureIndex&&(Sg=pp.verticalTextFeatureIndex);const gg=$g=>{$g.tileID=this.retainedQueryData[kt.bucketInstanceId].tileID;const Ag=this.transform.elevation;(Ag||$g.elevation)&&($g.elevation=Ag?Ag.getAtTileOffset($g.tileID,$g.tileAnchorX,$g.tileAnchorY):0)},Jm=pp.textBox;if(Jm){gg(Jm);const $g=mg=>{let dg=a.WritingMode.horizontal;if(kt.allowVerticalPlacement&&!mg&&this.prevPlacement){const wm=this.prevPlacement.placedOrientations[bp];wm&&(this.placedOrientations[bp]=wm,dg=wm,this.markUsedOrientation(kt,dg,tp))}return dg},Ag=(mg,dg)=>{if(kt.allowVerticalPlacement&&np>0&&pp.verticalTextBox){for(const wm of kt.writingModes)if(wm===a.WritingMode.vertical?(Pd=dg(),Zd=Pd):Pd=mg(),Pd&&Pd.box&&Pd.box.length)break}else Pd=mg()};if(Hr.get("text-variable-anchor")){let mg=Hr.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[bp]){const Mg=this.prevPlacement.variableOffsets[bp];mg.indexOf(Mg.anchor)>0&&(mg=mg.filter(cy=>cy!==Mg.anchor),mg.unshift(Mg.anchor))}const dg=(Mg,cy,Kv)=>{const b0=kt.getSymbolInstanceTextSize(_h,tp,this.transform.zoom,Tp),Zv=(Mg.x2-Mg.x1)*b0+2*Mg.padding,S_=(Mg.y2-Mg.y1)*b0+2*Mg.padding,uv=Vh&&!Sh?cy:null;uv&&gg(uv);let Xv={box:[],offscreen:!1,occluded:!1};const Ux=bh?2*mg.length:mg.length;for(let C0=0;C0<Ux;++C0){const jx=this.attemptAnchorPlacement(mg[C0%mg.length],Mg,Zv,S_,b0,Nh,$h,dl,pi,xh,C0>=mg.length,tp,Tp,kt,Kv,uv,_h,yh);if(jx&&(Xv=jx.placedGlyphBoxes,Xv&&Xv.box&&Xv.box.length)){wp=!0,jf=jx.shift;break}}return Xv};Ag(()=>dg(Jm,pp.iconBox,a.WritingMode.horizontal),()=>{const Mg=pp.verticalTextBox;return Mg&&gg(Mg),kt.allowVerticalPlacement&&!(Pd&&Pd.box&&Pd.box.length)&&np>0&&Mg?dg(Mg,pp.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Pd&&(wp=Pd.box,Pp=Pd.offscreen,Up=Pd.occluded);const wm=$g(!(!Pd||!Pd.box));if(!wp&&this.prevPlacement){const Mg=this.prevPlacement.variableOffsets[bp];Mg&&(this.variableOffsets[bp]=Mg,this.markUsedJustification(kt,Mg.anchor,tp,wm))}}else{const mg=(dg,wm)=>{const Mg=kt.getSymbolInstanceTextSize(_h,tp,this.transform.zoom,Tp),cy=this.collisionIndex.placeCollisionBox(kt,Mg,dg,new a.Point(0,0),bh,dl,pi,xh.predicate);return cy&&cy.box&&cy.box.length&&(this.markUsedOrientation(kt,wm,tp),this.placedOrientations[bp]=wm),cy};Ag(()=>mg(Jm,a.WritingMode.horizontal),()=>{const dg=pp.verticalTextBox;return kt.allowVerticalPlacement&&np>0&&dg?(gg(dg),mg(dg,a.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),$g(!!(Pd&&Pd.box&&Pd.box.length))}}if(ig=Pd,wp=ig&&ig.box&&ig.box.length>0,Pp=ig&&ig.offscreen,Up=ig&&ig.occluded,tp.useRuntimeCollisionCircles){const $g=kt.text.placedSymbolArray.get(tp.centerJustifiedTextSymbolIndex>=0?tp.centerJustifiedTextSymbolIndex:tp.verticalPlacedTextSymbolIndex),Ag=a.evaluateSizeForFeature(kt.textSizeData,_h,$g),mg=Hr.get("text-padding");Jf=this.collisionIndex.placeCollisionCircles(kt,bh,$g,kt.lineVertexArray,kt.glyphOffsetArray,Ag,pi,Vn,oa,X,$h,xh.predicate,tp.collisionCircleDiameter*Ag/a.ONE_EM,mg,this.retainedQueryData[kt.bucketInstanceId].tileID),wp=bh||Jf.circles.length>0&&!Jf.collisionDetected,Pp=Pp&&Jf.offscreen,Up=Jf.occluded}if(pp.iconFeatureIndex&&(Tg=pp.iconFeatureIndex),pp.iconBox){const $g=Ag=>{gg(Ag);const mg=Vh&&jf?Fm(jf.x,jf.y,Nh,$h,this.transform.angle):new a.Point(0,0),dg=kt.getSymbolInstanceIconSize(yh,this.transform.zoom,tp.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(kt,dg,Ag,mg,Sh,dl,pi,xh.predicate)};Zd&&Zd.box&&Zd.box.length&&pp.verticalIconBox?(Bd=$g(pp.verticalIconBox),Fp=Bd.box.length>0):(Bd=$g(pp.iconBox),Fp=Bd.box.length>0),Pp=Pp&&Bd.offscreen,zd=Bd.occluded}const om=yl||tp.numHorizontalGlyphVertices===0&&np===0,uy=mh||tp.numIconVertices===0;if(om||uy?uy?om||(Fp=Fp&&wp):wp=Fp&&wp:Fp=wp=Fp&&wp,wp&&ig&&ig.box&&this.collisionIndex.insertCollisionBox(ig.box,Hr.get("text-ignore-placement"),kt.bucketInstanceId,Zd&&Zd.box&&Sg?Sg:fg,xh.ID),Fp&&Bd&&this.collisionIndex.insertCollisionBox(Bd.box,Hr.get("icon-ignore-placement"),kt.bucketInstanceId,Tg,xh.ID),Jf&&(wp&&this.collisionIndex.insertCollisionCircles(Jf.circles,Hr.get("text-ignore-placement"),kt.bucketInstanceId,fg,xh.ID),X)){const $g=kt.bucketInstanceId;let Ag=this.collisionCircleArrays[$g];Ag===void 0&&(Ag=this.collisionCircleArrays[$g]=new bv);for(let mg=0;mg<Jf.circles.length;mg+=4)Ag.circles.push(Jf.circles[mg+0]),Ag.circles.push(Jf.circles[mg+1]),Ag.circles.push(Jf.circles[mg+2]),Ag.circles.push(Jf.collisionDetected?1:0)}const Iy=kt.projection.name!=="globe";Zh=Zh&&(Iy||!Up),rp=rp&&(Iy||!zd),this.placements[bp]=new z_(wp||Zh,Fp||rp,Pp||kt.justReloaded),T.add(bp)};if(Wh){const tp=kt.getSortedSymbolIndexes(this.transform.angle);for(let Tp=tp.length-1;Tp>=0;--Tp){const pp=tp[Tp];Bp(kt.symbolInstances.get(pp),pp,kt.collisionArrays[pp])}}else for(let tp=f.symbolInstanceStart;tp<f.symbolInstanceEnd;tp++)Bp(kt.symbolInstances.get(tp),tp,kt.collisionArrays[tp]);if(X&&kt.bucketInstanceId in this.collisionCircleArrays){const tp=this.collisionCircleArrays[kt.bucketInstanceId];a.invert(tp.invProjMatrix,pi),tp.viewportMatrix=this.collisionIndex.getViewportMatrix()}kt.justReloaded=!1}markUsedJustification(f,T,X,Ve){const{leftJustifiedTextSymbolIndex:kt,centerJustifiedTextSymbolIndex:Hr,rightJustifiedTextSymbolIndex:pi,verticalPlacedTextSymbolIndex:Vn,crossTileID:oa}=X,sa=a.getAnchorJustification(T),dl=Ve===a.WritingMode.vertical?Vn:sa==="left"?kt:sa==="center"?Hr:sa==="right"?pi:-1;kt>=0&&(f.text.placedSymbolArray.get(kt).crossTileID=dl>=0&&kt!==dl?0:oa),Hr>=0&&(f.text.placedSymbolArray.get(Hr).crossTileID=dl>=0&&Hr!==dl?0:oa),pi>=0&&(f.text.placedSymbolArray.get(pi).crossTileID=dl>=0&&pi!==dl?0:oa),Vn>=0&&(f.text.placedSymbolArray.get(Vn).crossTileID=dl>=0&&Vn!==dl?0:oa)}markUsedOrientation(f,T,X){const Ve=T===a.WritingMode.horizontal||T===a.WritingMode.horizontalOnly?T:0,kt=T===a.WritingMode.vertical?T:0,{leftJustifiedTextSymbolIndex:Hr,centerJustifiedTextSymbolIndex:pi,rightJustifiedTextSymbolIndex:Vn,verticalPlacedTextSymbolIndex:oa}=X,sa=f.text.placedSymbolArray;Hr>=0&&(sa.get(Hr).placedOrientation=Ve),pi>=0&&(sa.get(pi).placedOrientation=Ve),Vn>=0&&(sa.get(Vn).placedOrientation=Ve),oa>=0&&(sa.get(oa).placedOrientation=kt)}commit(f){this.commitTime=f,this.zoomAtLastRecencyCheck=this.transform.zoom;const T=this.prevPlacement;let X=!1;this.prevZoomAdjustment=T?T.zoomAdjustment(this.transform.zoom):0;const Ve=T?T.symbolFadeChange(f):1,kt=T?T.opacities:{},Hr=T?T.variableOffsets:{},pi=T?T.placedOrientations:{};for(const Vn in this.placements){const oa=this.placements[Vn],sa=kt[Vn];sa?(this.opacities[Vn]=new Ey(sa,Ve,oa.text,oa.icon,null,oa.clipped),X=X||oa.text!==sa.text.placed||oa.icon!==sa.icon.placed):(this.opacities[Vn]=new Ey(null,Ve,oa.text,oa.icon,oa.skipFade,oa.clipped),X=X||oa.text||oa.icon)}for(const Vn in kt){const oa=kt[Vn];if(!this.opacities[Vn]){const sa=new Ey(oa,Ve,!1,!1);sa.isHidden()||(this.opacities[Vn]=sa,X=X||oa.text.placed||oa.icon.placed)}}for(const Vn in Hr)this.variableOffsets[Vn]||!this.opacities[Vn]||this.opacities[Vn].isHidden()||(this.variableOffsets[Vn]=Hr[Vn]);for(const Vn in pi)this.placedOrientations[Vn]||!this.opacities[Vn]||this.opacities[Vn].isHidden()||(this.placedOrientations[Vn]=pi[Vn]);X?this.lastPlacementChangeTime=f:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=T?T.lastPlacementChangeTime:f)}updateLayerOpacities(f,T){const X=new Set;for(const Ve of T){const kt=Ve.getBucket(f);kt&&Ve.latestFeatureIndex&&f.id===kt.layerIds[0]&&this.updateBucketOpacities(kt,X,Ve.collisionBoxArray)}}updateBucketOpacities(f,T,X){f.hasTextData()&&f.text.opacityVertexArray.clear(),f.hasIconData()&&f.icon.opacityVertexArray.clear(),f.hasIconCollisionBoxData()&&f.iconCollisionBox.collisionVertexArray.clear(),f.hasTextCollisionBoxData()&&f.textCollisionBox.collisionVertexArray.clear();const Ve=f.layers[0].layout,kt=!!f.layers[0].dynamicFilter(),Hr=new Ey(null,0,!1,!1,!0),pi=Ve.get("text-allow-overlap"),Vn=Ve.get("icon-allow-overlap"),oa=Ve.get("text-variable-anchor"),sa=Ve.get("text-rotation-alignment")==="map",dl=Ve.get("text-pitch-alignment")==="map",lh=Ve.get("icon-text-fit")!=="none",gh=new Ey(null,0,pi&&(Vn||!f.hasIconData()||Ve.get("icon-optional")),Vn&&(pi||!f.hasTextData()||Ve.get("text-optional")),!0);!f.collisionArrays&&X&&(f.hasIconCollisionBoxData()||f.hasTextCollisionBoxData())&&f.deserializeCollisionBoxes(X);const _h=(xh,yl,mh)=>{for(let bh=0;bh<yl/4;bh++)xh.opacityVertexArray.emplaceBack(mh)};let yh=0;for(let xh=0;xh<f.symbolInstances.length;xh++){const yl=f.symbolInstances.get(xh),{numHorizontalGlyphVertices:mh,numVerticalGlyphVertices:bh,crossTileID:Sh,numIconVertices:Nh}=yl,$h=T.has(Sh);let Vh=this.opacities[Sh];$h?Vh=Hr:Vh||(Vh=gh,this.opacities[Sh]=Vh),T.add(Sh);const Wh=mh>0||bh>0,Zh=Nh>0,rp=this.placedOrientations[Sh],Bp=rp===a.WritingMode.vertical,tp=rp===a.WritingMode.horizontal||rp===a.WritingMode.horizontalOnly;if(!Wh&&!Zh||Vh.isHidden()||yh++,Wh){const Tp=Em(Vh.text);_h(f.text,mh,Bp?Gg:Tp),_h(f.text,bh,tp?Gg:Tp);const pp=Vh.text.isHidden(),{leftJustifiedTextSymbolIndex:bp,centerJustifiedTextSymbolIndex:np,rightJustifiedTextSymbolIndex:wp,verticalPlacedTextSymbolIndex:Fp}=yl,Pp=f.text.placedSymbolArray,Up=pp||Bp?1:0;bp>=0&&(Pp.get(bp).hidden=Up),np>=0&&(Pp.get(np).hidden=Up),wp>=0&&(Pp.get(wp).hidden=Up),Fp>=0&&(Pp.get(Fp).hidden=pp||tp?1:0);const zd=this.variableOffsets[Sh];zd&&this.markUsedJustification(f,zd.anchor,yl,rp);const jf=this.placedOrientations[Sh];jf&&(this.markUsedJustification(f,"left",yl,jf),this.markUsedOrientation(f,jf,yl))}if(Zh){const Tp=Em(Vh.icon),{placedIconSymbolIndex:pp,verticalPlacedIconSymbolIndex:bp}=yl,np=f.icon.placedSymbolArray,wp=Vh.icon.isHidden()?1:0;pp>=0&&(_h(f.icon,Nh,Bp?Gg:Tp),np.get(pp).hidden=wp),bp>=0&&(_h(f.icon,yl.numVerticalIconVertices,tp?Gg:Tp),np.get(bp).hidden=wp)}if(f.hasIconCollisionBoxData()||f.hasTextCollisionBoxData()){const Tp=f.collisionArrays[xh];if(Tp){let pp=new a.Point(0,0),bp=!0;if(Tp.textBox||Tp.verticalTextBox){if(oa){const wp=this.variableOffsets[Sh];wp?(pp=c_(wp.anchor,wp.width,wp.height,wp.textOffset,wp.textScale),sa&&pp._rotate(dl?this.transform.angle:-this.transform.angle)):bp=!1}kt&&(bp=!Vh.clipped),Tp.textBox&&Fy(f.textCollisionBox.collisionVertexArray,Vh.text.placed,!bp||Bp,pp.x,pp.y),Tp.verticalTextBox&&Fy(f.textCollisionBox.collisionVertexArray,Vh.text.placed,!bp||tp,pp.x,pp.y)}const np=bp&&!!(!tp&&Tp.verticalIconBox);Tp.iconBox&&Fy(f.iconCollisionBox.collisionVertexArray,Vh.icon.placed,np,lh?pp.x:0,lh?pp.y:0),Tp.verticalIconBox&&Fy(f.iconCollisionBox.collisionVertexArray,Vh.icon.placed,!np,lh?pp.x:0,lh?pp.y:0)}}}if(f.fullyClipped=yh===0,f.sortFeatures(this.transform.angle),this.retainedQueryData[f.bucketInstanceId]&&(this.retainedQueryData[f.bucketInstanceId].featureSortOrder=f.featureSortOrder),f.hasTextData()&&f.text.opacityVertexBuffer&&f.text.opacityVertexBuffer.updateData(f.text.opacityVertexArray),f.hasIconData()&&f.icon.opacityVertexBuffer&&f.icon.opacityVertexBuffer.updateData(f.icon.opacityVertexArray),f.hasIconCollisionBoxData()&&f.iconCollisionBox.collisionVertexBuffer&&f.iconCollisionBox.collisionVertexBuffer.updateData(f.iconCollisionBox.collisionVertexArray),f.hasTextCollisionBoxData()&&f.textCollisionBox.collisionVertexBuffer&&f.textCollisionBox.collisionVertexBuffer.updateData(f.textCollisionBox.collisionVertexArray),f.bucketInstanceId in this.collisionCircleArrays){const xh=this.collisionCircleArrays[f.bucketInstanceId];f.placementInvProjMatrix=xh.invProjMatrix,f.placementViewportMatrix=xh.viewportMatrix,f.collisionCircleArray=xh.circles,delete this.collisionCircleArrays[f.bucketInstanceId]}}symbolFadeChange(f){return this.fadeDuration===0?1:(f-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(f){return Math.max(0,(this.transform.zoom-f)/1.5)}hasTransitions(f){return this.stale||f-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(f,T){const X=this.zoomAtLastRecencyCheck===T?1-this.zoomAdjustment(T):1;return this.zoomAtLastRecencyCheck=T,this.commitTime+this.fadeDuration*X>f}setStale(){this.stale=!0}}function Fy(F,f,T,X,Ve){F.emplaceBack(f?1:0,T?1:0,X||0,Ve||0),F.emplaceBack(f?1:0,T?1:0,X||0,Ve||0),F.emplaceBack(f?1:0,T?1:0,X||0,Ve||0),F.emplaceBack(f?1:0,T?1:0,X||0,Ve||0)}const pm=Math.pow(2,25),zg=Math.pow(2,24),Cv=Math.pow(2,17),h_=Math.pow(2,16),dm=Math.pow(2,9),Vm=Math.pow(2,8),Km=Math.pow(2,1);function Em(F){if(F.opacity===0&&!F.placed)return 0;if(F.opacity===1&&F.placed)return 4294967295;const f=F.placed?1:0,T=Math.floor(127*F.opacity);return T*pm+f*zg+T*Cv+f*h_+T*dm+f*Vm+T*Km+f}const Gg=0;class p_{constructor(f){this._sortAcrossTiles=f.layout.get("symbol-z-order")!=="viewport-y"&&f.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(f,T,X,Ve,kt){const Hr=this._bucketParts;for(;this._currentTileIndex<f.length;)if(T.getBucketParts(Hr,Ve,f[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,kt())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,Hr.sort((pi,Vn)=>pi.sortKey-Vn.sortKey));this._currentPartIndex<Hr.length;){const pi=Hr[this._currentPartIndex];if(T.placeLayerBucketPart(pi,this._seenCrossTileIDs,X,pi.symbolInstanceStart===0),this._currentPartIndex++,kt())return!0}return!1}}class Ev{constructor(f,T,X,Ve,kt,Hr,pi,Vn){this.placement=new G_(f,kt,Hr,pi,Vn),this._currentPlacementIndex=T.length-1,this._forceFullPlacement=X,this._showCollisionBoxes=Ve,this._done=!1}isDone(){return this._done}continuePlacement(f,T,X){const Ve=a.exported.now(),kt=()=>{const Hr=a.exported.now()-Ve;return!this._forceFullPlacement&&Hr>2};for(;this._currentPlacementIndex>=0;){const Hr=T[f[this._currentPlacementIndex]],pi=this.placement.collisionIndex.transform.zoom;if(Hr.type==="symbol"&&(!Hr.minzoom||Hr.minzoom<=pi)&&(!Hr.maxzoom||Hr.maxzoom>pi)){if(this._inProgressLayer||(this._inProgressLayer=new p_(Hr)),this._inProgressLayer.continuePlacement(X[Hr.source],this.placement,this._showCollisionBoxes,Hr,kt))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(f){return this.placement.commit(f),this.placement}}const Ky=512/a.EXTENT/2;class em{constructor(f,T,X){this.tileID=f,this.bucketInstanceId=X,this.index=new a.KDBush(T.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const Ve=f.canonical.x*a.EXTENT,kt=f.canonical.y*a.EXTENT;for(let Hr=0;Hr<T.length;Hr++){const{key:pi,crossTileID:Vn,tileAnchorX:oa,tileAnchorY:sa}=T.get(Hr),dl=Math.floor((Ve+oa)*Ky),lh=Math.floor((kt+sa)*Ky);this.index.add(dl,lh),this.keys.push(pi),this.crossTileIDs.push(Vn)}this.index.finish()}findMatches(f,T,X){const Ve=this.tileID.canonical.z<T.canonical.z?1:Math.pow(2,this.tileID.canonical.z-T.canonical.z),kt=Ky/Math.pow(2,T.canonical.z-this.tileID.canonical.z),Hr=T.canonical.x*a.EXTENT,pi=T.canonical.y*a.EXTENT;for(let Vn=0;Vn<f.length;Vn++){const oa=f.get(Vn);if(oa.crossTileID)continue;const{key:sa,tileAnchorX:dl,tileAnchorY:lh}=oa,gh=Math.floor((Hr+dl)*kt),_h=Math.floor((pi+lh)*kt),yh=this.index.range(gh-Ve,_h-Ve,gh+Ve,_h+Ve);for(const xh of yh){const yl=this.crossTileIDs[xh];if(this.keys[xh]===sa&&!X.has(yl)){X.add(yl),oa.crossTileID=yl;break}}}}}class Zy{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ug{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(f){const T=Math.round((f-this.lng)/360);if(T!==0)for(const X in this.indexes){const Ve=this.indexes[X],kt={};for(const Hr in Ve){const pi=Ve[Hr];pi.tileID=pi.tileID.unwrapTo(pi.tileID.wrap+T),kt[pi.tileID.key]=pi}this.indexes[X]=kt}this.lng=f}addBucket(f,T,X){if(this.indexes[f.overscaledZ]&&this.indexes[f.overscaledZ][f.key]){if(this.indexes[f.overscaledZ][f.key].bucketInstanceId===T.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(f.overscaledZ,this.indexes[f.overscaledZ][f.key])}for(let kt=0;kt<T.symbolInstances.length;kt++)T.symbolInstances.get(kt).crossTileID=0;this.usedCrossTileIDs[f.overscaledZ]||(this.usedCrossTileIDs[f.overscaledZ]=new Set);const Ve=this.usedCrossTileIDs[f.overscaledZ];for(const kt in this.indexes){const Hr=this.indexes[kt];if(Number(kt)>f.overscaledZ)for(const pi in Hr){const Vn=Hr[pi];Vn.tileID.isChildOf(f)&&Vn.findMatches(T.symbolInstances,f,Ve)}else{const pi=Hr[f.scaledTo(Number(kt)).key];pi&&pi.findMatches(T.symbolInstances,f,Ve)}}for(let kt=0;kt<T.symbolInstances.length;kt++){const Hr=T.symbolInstances.get(kt);Hr.crossTileID||(Hr.crossTileID=X.generate(),Ve.add(Hr.crossTileID))}return this.indexes[f.overscaledZ]===void 0&&(this.indexes[f.overscaledZ]={}),this.indexes[f.overscaledZ][f.key]=new em(f,T.symbolInstances,T.bucketInstanceId),!0}removeBucketCrossTileIDs(f,T){for(const X of T.crossTileIDs)this.usedCrossTileIDs[f].delete(X)}removeStaleBuckets(f){let T=!1;for(const X in this.indexes){const Ve=this.indexes[X];for(const kt in Ve)f[Ve[kt].bucketInstanceId]||(this.removeBucketCrossTileIDs(X,Ve[kt]),delete Ve[kt],T=!0)}return T}}class Sy{constructor(){this.layerIndexes={},this.crossTileIDs=new Zy,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(f,T,X,Ve){let kt=this.layerIndexes[f.id];kt===void 0&&(kt=this.layerIndexes[f.id]=new ug);let Hr=!1;const pi={};Ve.name!=="globe"&&kt.handleWrapJump(X);for(const Vn of T){const oa=Vn.getBucket(f);oa&&f.id===oa.layerIds[0]&&(oa.bucketInstanceId||(oa.bucketInstanceId=++this.maxBucketInstanceId),kt.addBucket(Vn.tileID,oa,this.crossTileIDs)&&(Hr=!0),pi[oa.bucketInstanceId]=!0)}return kt.removeStaleBuckets(pi)&&(Hr=!0),Hr}pruneUnusedLayers(f){const T={};f.forEach(X=>{T[X]=!0});for(const X in this.layerIndexes)T[X]||delete this.layerIndexes[X]}}const Ty=(F,f)=>a.emitValidationErrors(F,f&&f.filter(T=>T.identifier!=="source.canvas")),a0=a.pick(Jd,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),zx=a.pick(Jd,["setCenter","setZoom","setBearing","setPitch"]),d_={version:8,layers:[],sources:{}},Sv={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ny extends a.Evented{constructor(f,T={}){super(),this.map=f,this.dispatcher=new Ip(Vf(),this),this.imageManager=new _l,this.imageManager.setEventedParent(this),this.glyphManager=new a.GlyphManager(f._requestManager,T.localFontFamily?a.LocalGlyphMode.all:T.localIdeographFontFamily?a.LocalGlyphMode.ideographs:a.LocalGlyphMode.none,T.localFontFamily||T.localIdeographFontFamily),this.crossTileSymbolIndex=new Sy,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const X=this;this._rtlTextPluginCallback=Ny.registerForPluginStateChange(Ve=>{X.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:Ve.pluginStatus,pluginURL:Ve.pluginURL},(kt,Hr)=>{if(a.triggerPluginCompletionEvent(kt),Hr&&Hr.every(pi=>pi))for(const pi in X._sourceCaches){const Vn=X._sourceCaches[pi],oa=Vn.getSource().type;oa!=="vector"&&oa!=="geojson"||Vn.reload()}})}),this.on("data",Ve=>{if(Ve.dataType!=="source"||Ve.sourceDataType!=="metadata")return;const kt=this.getSource(Ve.sourceId);if(kt&&kt.vectorLayerIds)for(const Hr in this._layers){const pi=this._layers[Hr];pi.source===kt.id&&this._validateLayer(pi)}})}loadURL(f,T={}){this.fire(new a.Event("dataloading",{dataType:"style"}));const X=typeof T.validate=="boolean"?T.validate:!a.isMapboxURL(f);f=this.map._requestManager.normalizeStyleURL(f,T.accessToken);const Ve=this.map._requestManager.transformRequest(f,a.ResourceType.Style);this._request=a.getJSON(Ve,(kt,Hr)=>{this._request=null,kt?this.fire(new a.ErrorEvent(kt)):Hr&&this._load(Hr,X)})}loadJSON(f,T={}){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,this._load(f,T.validate!==!1)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(d_,!1)}_updateLayerCount(f,T){const X=T?1:-1;f.is3D()&&(this._num3DLayers+=X),f.type==="circle"&&(this._numCircleLayers+=X),f.type==="symbol"&&(this._numSymbolLayers+=X)}_load(f,T){if(T&&Ty(this,a.validateStyle(f)))return;this._loaded=!0,this.stylesheet=a.clone$1(f),this._updateMapProjection();for(const Ve in f.sources)this.addSource(Ve,f.sources[Ve],{validate:!1});this._changed=!1,f.sprite?this._loadSprite(f.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(f.glyphs);const X=pg(this.stylesheet.layers);this._order=X.map(Ve=>Ve.id),this._layers={},this._serializedLayers={};for(const Ve of X){const kt=a.createStyleLayer(Ve);kt.setEventedParent(this,{layer:{id:kt.id}}),this._layers[kt.id]=kt,this._serializedLayers[kt.id]=kt.serialize(),this._updateLayerCount(kt,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new wh(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(f){f?this.stylesheet.projection=f:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(f){this._spriteRequest=function(T,X,Ve){let kt,Hr,pi;const Vn=a.exported.devicePixelRatio>1?"@2x":"";let oa=a.getJSON(X.transformRequest(X.normalizeSpriteURL(T,Vn,".json"),a.ResourceType.SpriteJSON),(lh,gh)=>{oa=null,pi||(pi=lh,kt=gh,dl())}),sa=a.getImage(X.transformRequest(X.normalizeSpriteURL(T,Vn,".png"),a.ResourceType.SpriteImage),(lh,gh)=>{sa=null,pi||(pi=lh,Hr=gh,dl())});function dl(){if(pi)Ve(pi);else if(kt&&Hr){const lh=a.exported.getImageData(Hr),gh={};for(const _h in kt){const{width:yh,height:xh,x:yl,y:mh,sdf:bh,pixelRatio:Sh,stretchX:Nh,stretchY:$h,content:Vh}=kt[_h],Wh=new a.RGBAImage({width:yh,height:xh});a.RGBAImage.copy(lh,Wh,{x:yl,y:mh},{x:0,y:0},{width:yh,height:xh}),gh[_h]={data:Wh,pixelRatio:Sh,sdf:bh,stretchX:Nh,stretchY:$h,content:Vh}}Ve(null,gh)}}return{cancel(){oa&&(oa.cancel(),oa=null),sa&&(sa.cancel(),sa=null)}}}(f,this.map._requestManager,(T,X)=>{if(this._spriteRequest=null,T)this.fire(new a.ErrorEvent(T));else if(X)for(const Ve in X)this.imageManager.addImage(Ve,X[Ve]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new a.Event("data",{dataType:"style"}))})}_validateLayer(f){const T=this.getSource(f.source);if(!T)return;const X=f.sourceLayer;X&&(T.type==="geojson"||T.vectorLayerIds&&T.vectorLayerIds.indexOf(X)===-1)&&this.fire(new a.ErrorEvent(new Error(`Source layer "${X}" does not exist on source "${T.id}" as specified by style layer "${f.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const f in this._sourceCaches)if(!this._sourceCaches[f].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(f){const T=[];for(const X of f){const Ve=this._layers[X];Ve.type!=="custom"&&T.push(Ve.serialize())}return T}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const f in this._sourceCaches)if(this._sourceCaches[f].hasTransition())return!0;for(const f in this._layers)if(this._layers[f].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(f){return!!this.terrain&&(typeof f.isLayerDraped=="function"?f.isLayerDraped():Sv[f.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(f){if(!this._loaded)return;const T=this._changed;if(this._changed){const Ve=Object.keys(this._updatedLayers),kt=Object.keys(this._removedLayers);(Ve.length||kt.length)&&this._updateWorkerLayers(Ve,kt);for(const Hr in this._updatedSources){const pi=this._updatedSources[Hr];pi==="reload"?this._reloadSource(Hr):pi==="clear"&&this._clearSource(Hr)}this._updateTilesForChangedImages();for(const Hr in this._updatedPaintProps)this._layers[Hr].updateTransitions(f);this.light.updateTransitions(f),this.fog&&this.fog.updateTransitions(f),this._resetUpdates()}const X={};for(const Ve in this._sourceCaches){const kt=this._sourceCaches[Ve];X[Ve]=kt.used,kt.used=!1}for(const Ve of this._order){const kt=this._layers[Ve];if(kt.recalculate(f,this._availableImages),!kt.isHidden(f.zoom)){const pi=this._getLayerSourceCache(kt);pi&&(pi.used=!0)}const Hr=this.map.painter;if(Hr){const pi=kt.getProgramIds();if(!pi)continue;const Vn=kt.getProgramConfiguration(f.zoom);for(const oa of pi)Hr.useProgram(oa,Vn)}}for(const Ve in X){const kt=this._sourceCaches[Ve];X[Ve]!==kt.used&&kt.getSource().fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:kt.getSource().id}))}this.light.recalculate(f),this.terrain&&this.terrain.recalculate(f),this.fog&&this.fog.recalculate(f),this.z=f.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),T&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const f=Object.keys(this._changedImages);if(f.length){for(const T in this._sourceCaches)this._sourceCaches[T].reloadTilesForDependencies(["icons","patterns"],f);this._changedImages={}}}_updateWorkerLayers(f,T){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(f),removedIds:T})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(f){if(this._checkLoaded(),Ty(this,a.validateStyle(f)))return!1;(f=a.clone$1(f)).layers=pg(f.layers);const T=function(Ve,kt){if(!Ve)return[{command:Jd.setStyle,args:[kt]}];let Hr=[];try{if(!h(Ve.version,kt.version))return[{command:Jd.setStyle,args:[kt]}];h(Ve.center,kt.center)||Hr.push({command:Jd.setCenter,args:[kt.center]}),h(Ve.zoom,kt.zoom)||Hr.push({command:Jd.setZoom,args:[kt.zoom]}),h(Ve.bearing,kt.bearing)||Hr.push({command:Jd.setBearing,args:[kt.bearing]}),h(Ve.pitch,kt.pitch)||Hr.push({command:Jd.setPitch,args:[kt.pitch]}),h(Ve.sprite,kt.sprite)||Hr.push({command:Jd.setSprite,args:[kt.sprite]}),h(Ve.glyphs,kt.glyphs)||Hr.push({command:Jd.setGlyphs,args:[kt.glyphs]}),h(Ve.transition,kt.transition)||Hr.push({command:Jd.setTransition,args:[kt.transition]}),h(Ve.light,kt.light)||Hr.push({command:Jd.setLight,args:[kt.light]}),h(Ve.fog,kt.fog)||Hr.push({command:Jd.setFog,args:[kt.fog]}),h(Ve.projection,kt.projection)||Hr.push({command:Jd.setProjection,args:[kt.projection]});const pi={},Vn=[];(function(dl,lh,gh,_h){let yh;for(yh in lh=lh||{},dl=dl||{})dl.hasOwnProperty(yh)&&(lh.hasOwnProperty(yh)||Cg(yh,gh,_h));for(yh in lh){if(!lh.hasOwnProperty(yh))continue;const xh=lh[yh];dl.hasOwnProperty(yh)?h(dl[yh],xh)||(dl[yh].type==="geojson"&&xh.type==="geojson"&&Bg(dl,lh,yh)?gh.push({command:Jd.setGeoJSONSourceData,args:[yh,xh.data]}):oy(yh,lh,gh,_h)):Yd(yh,lh,gh)}})(Ve.sources,kt.sources,Vn,pi);const oa=[];Ve.layers&&Ve.layers.forEach(dl=>{dl.source&&pi[dl.source]?Hr.push({command:Jd.removeLayer,args:[dl.id]}):oa.push(dl)});let sa=Ve.terrain;sa&&pi[sa.source]&&(Hr.push({command:Jd.setTerrain,args:[void 0]}),sa=void 0),Hr=Hr.concat(Vn),h(sa,kt.terrain)||Hr.push({command:Jd.setTerrain,args:[kt.terrain]}),function(dl,lh,gh){lh=lh||[];const _h=(dl=dl||[]).map(nm),yh=lh.map(nm),xh=dl.reduce(u_,{}),yl=lh.reduce(u_,{}),mh=_h.slice(),bh=Object.create(null);let Sh,Nh,$h,Vh,Wh,Zh,rp;for(Sh=0,Nh=0;Sh<_h.length;Sh++)$h=_h[Sh],yl.hasOwnProperty($h)?Nh++:(gh.push({command:Jd.removeLayer,args:[$h]}),mh.splice(mh.indexOf($h,Nh),1));for(Sh=0,Nh=0;Sh<yh.length;Sh++)$h=yh[yh.length-1-Sh],mh[mh.length-1-Sh]!==$h&&(xh.hasOwnProperty($h)?(gh.push({command:Jd.removeLayer,args:[$h]}),mh.splice(mh.lastIndexOf($h,mh.length-Nh),1)):Nh++,Zh=mh[mh.length-Sh],gh.push({command:Jd.addLayer,args:[yl[$h],Zh]}),mh.splice(mh.length-Sh,0,$h),bh[$h]=!0);for(Sh=0;Sh<yh.length;Sh++)if($h=yh[Sh],Vh=xh[$h],Wh=yl[$h],!bh[$h]&&!h(Vh,Wh))if(h(Vh.source,Wh.source)&&h(Vh["source-layer"],Wh["source-layer"])&&h(Vh.type,Wh.type)){for(rp in Xg(Vh.layout,Wh.layout,gh,$h,null,Jd.setLayoutProperty),Xg(Vh.paint,Wh.paint,gh,$h,null,Jd.setPaintProperty),h(Vh.filter,Wh.filter)||gh.push({command:Jd.setFilter,args:[$h,Wh.filter]}),h(Vh.minzoom,Wh.minzoom)&&h(Vh.maxzoom,Wh.maxzoom)||gh.push({command:Jd.setLayerZoomRange,args:[$h,Wh.minzoom,Wh.maxzoom]}),Vh)Vh.hasOwnProperty(rp)&&rp!=="layout"&&rp!=="paint"&&rp!=="filter"&&rp!=="metadata"&&rp!=="minzoom"&&rp!=="maxzoom"&&(rp.indexOf("paint.")===0?Xg(Vh[rp],Wh[rp],gh,$h,rp.slice(6),Jd.setPaintProperty):h(Vh[rp],Wh[rp])||gh.push({command:Jd.setLayerProperty,args:[$h,rp,Wh[rp]]}));for(rp in Wh)Wh.hasOwnProperty(rp)&&!Vh.hasOwnProperty(rp)&&rp!=="layout"&&rp!=="paint"&&rp!=="filter"&&rp!=="metadata"&&rp!=="minzoom"&&rp!=="maxzoom"&&(rp.indexOf("paint.")===0?Xg(Vh[rp],Wh[rp],gh,$h,rp.slice(6),Jd.setPaintProperty):h(Vh[rp],Wh[rp])||gh.push({command:Jd.setLayerProperty,args:[$h,rp,Wh[rp]]}))}else gh.push({command:Jd.removeLayer,args:[$h]}),Zh=mh[mh.lastIndexOf($h)+1],gh.push({command:Jd.addLayer,args:[Wh,Zh]})}(oa,kt.layers,Hr)}catch(pi){console.warn("Unable to compute style diff:",pi),Hr=[{command:Jd.setStyle,args:[kt]}]}return Hr}(this.serialize(),f).filter(Ve=>!(Ve.command in zx));if(T.length===0)return!1;const X=T.filter(Ve=>!(Ve.command in a0));if(X.length>0)throw new Error(`Unimplemented: ${X.map(Ve=>Ve.command).join(", ")}.`);return T.forEach(Ve=>{Ve.command!=="setTransition"&&Ve.command!=="setProjection"&&this[Ve.command].apply(this,Ve.args)}),this.stylesheet=f,this._updateMapProjection(),!0}addImage(f,T){return this.getImage(f)?this.fire(new a.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(f,T),this._afterImageUpdated(f),this)}updateImage(f,T){this.imageManager.updateImage(f,T)}getImage(f){return this.imageManager.getImage(f)}removeImage(f){return this.getImage(f)?(this.imageManager.removeImage(f),this._afterImageUpdated(f),this):this.fire(new a.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(f){this._availableImages=this.imageManager.listImages(),this._changedImages[f]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(f,T,X={}){if(this._checkLoaded(),this.getSource(f)!==void 0)throw new Error("There is already a source with this ID");if(!T.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(T).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(T.type)>=0&&this._validate(a.validateSource,`sources.${f}`,T,null,X))return;this.map&&this.map._collectResourceTiming&&(T.collectResourceTiming=!0);const Ve=ep(f,T,this.dispatcher,this);Ve.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(f),source:Ve.serialize(),sourceId:f}));const kt=Hr=>{const pi=(Hr?"symbol:":"other:")+f,Vn=this._sourceCaches[pi]=new a.SourceCache(pi,Ve,Hr);(Hr?this._symbolSourceCaches:this._otherSourceCaches)[f]=Vn,Vn.style=this,Vn.onAdd(this.map)};kt(!1),T.type!=="vector"&&T.type!=="geojson"||kt(!0),Ve.onAdd&&Ve.onAdd(this.map),this._changed=!0}removeSource(f){this._checkLoaded();const T=this.getSource(f);if(!T)throw new Error("There is no source with this ID");for(const Ve in this._layers)if(this._layers[Ve].source===f)return this.fire(new a.ErrorEvent(new Error(`Source "${f}" cannot be removed while layer "${Ve}" is using it.`)));if(this.terrain&&this.terrain.get().source===f)return this.fire(new a.ErrorEvent(new Error(`Source "${f}" cannot be removed while terrain is using it.`)));const X=this._getSourceCaches(f);for(const Ve of X)delete this._sourceCaches[Ve.id],delete this._updatedSources[Ve.id],Ve.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:Ve.getSource().id})),Ve.setEventedParent(null),Ve.clearTiles();return delete this._otherSourceCaches[f],delete this._symbolSourceCaches[f],T.setEventedParent(null),T.onRemove&&T.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(f,T){this._checkLoaded(),this.getSource(f).setData(T),this._changed=!0}getSource(f){const T=this._getSourceCache(f);return T&&T.getSource()}_getSources(){const f=[];for(const T in this._otherSourceCaches){const X=this._getSourceCache(T);X&&f.push(X.getSource())}return f}addLayer(f,T,X={}){this._checkLoaded();const Ve=f.id;if(this.getLayer(Ve))return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${Ve}" already exists on this map`)));let kt;if(f.type==="custom"){if(Ty(this,a.validateCustomStyleLayer(f)))return;kt=a.createStyleLayer(f)}else{if(typeof f.source=="object"&&(this.addSource(Ve,f.source),f=a.clone$1(f),f=a.extend(f,{source:Ve})),this._validate(a.validateLayer,`layers.${Ve}`,f,{arrayIndex:-1},X))return;kt=a.createStyleLayer(f),this._validateLayer(kt),kt.setEventedParent(this,{layer:{id:Ve}}),this._serializedLayers[kt.id]=kt.serialize(),this._updateLayerCount(kt,!0)}const Hr=T?this._order.indexOf(T):this._order.length;if(T&&Hr===-1)return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${T}" does not exist on this map.`)));this._order.splice(Hr,0,Ve),this._layerOrderChanged=!0,this._layers[Ve]=kt;const pi=this._getLayerSourceCache(kt);if(this._removedLayers[Ve]&&kt.source&&pi&&kt.type!=="custom"){const Vn=this._removedLayers[Ve];delete this._removedLayers[Ve],Vn.type!==kt.type?this._updatedSources[kt.source]="clear":(this._updatedSources[kt.source]="reload",pi.pause())}this._updateLayer(kt),kt.onAdd&&kt.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(f,T){if(this._checkLoaded(),this._changed=!0,!this._layers[f])return void this.fire(new a.ErrorEvent(new Error(`The layer '${f}' does not exist in the map's style and cannot be moved.`)));if(f===T)return;const X=this._order.indexOf(f);this._order.splice(X,1);const Ve=T?this._order.indexOf(T):this._order.length;T&&Ve===-1?this.fire(new a.ErrorEvent(new Error(`Layer with id "${T}" does not exist on this map.`))):(this._order.splice(Ve,0,f),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(f){this._checkLoaded();const T=this._layers[f];if(!T)return void this.fire(new a.ErrorEvent(new Error(`The layer '${f}' does not exist in the map's style and cannot be removed.`)));T.setEventedParent(null),this._updateLayerCount(T,!1);const X=this._order.indexOf(f);this._order.splice(X,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[f]=T,delete this._layers[f],delete this._serializedLayers[f],delete this._updatedLayers[f],delete this._updatedPaintProps[f],T.onRemove&&T.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(f){return this._layers[f]}hasLayer(f){return f in this._layers}hasLayerType(f){for(const T in this._layers)if(this._layers[T].type===f)return!0;return!1}setLayerZoomRange(f,T,X){this._checkLoaded();const Ve=this.getLayer(f);Ve?Ve.minzoom===T&&Ve.maxzoom===X||(T!=null&&(Ve.minzoom=T),X!=null&&(Ve.maxzoom=X),this._updateLayer(Ve)):this.fire(new a.ErrorEvent(new Error(`The layer '${f}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(f,T,X={}){this._checkLoaded();const Ve=this.getLayer(f);if(Ve){if(!h(Ve.filter,T))return T==null?(Ve.filter=void 0,void this._updateLayer(Ve)):void(this._validate(a.validateFilter,`layers.${Ve.id}.filter`,T,{layerType:Ve.type},X)||(Ve.filter=a.clone$1(T),this._updateLayer(Ve)))}else this.fire(new a.ErrorEvent(new Error(`The layer '${f}' does not exist in the map's style and cannot be filtered.`)))}getFilter(f){const T=this.getLayer(f);return T&&a.clone$1(T.filter)}setLayoutProperty(f,T,X,Ve={}){this._checkLoaded();const kt=this.getLayer(f);kt?h(kt.getLayoutProperty(T),X)||(kt.setLayoutProperty(T,X,Ve),this._updateLayer(kt)):this.fire(new a.ErrorEvent(new Error(`The layer '${f}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(f,T){const X=this.getLayer(f);if(X)return X.getLayoutProperty(T);this.fire(new a.ErrorEvent(new Error(`The layer '${f}' does not exist in the map's style.`)))}setPaintProperty(f,T,X,Ve={}){this._checkLoaded();const kt=this.getLayer(f);kt?h(kt.getPaintProperty(T),X)||(kt.setPaintProperty(T,X,Ve)&&this._updateLayer(kt),this._changed=!0,this._updatedPaintProps[f]=!0):this.fire(new a.ErrorEvent(new Error(`The layer '${f}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(f,T){const X=this.getLayer(f);return X&&X.getPaintProperty(T)}setFeatureState(f,T){this._checkLoaded();const X=f.source,Ve=f.sourceLayer,kt=this.getSource(X);if(!kt)return void this.fire(new a.ErrorEvent(new Error(`The source '${X}' does not exist in the map's style.`)));const Hr=kt.type;if(Hr==="geojson"&&Ve)return void this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(Hr==="vector"&&!Ve)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));f.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided.")));const pi=this._getSourceCaches(X);for(const Vn of pi)Vn.setFeatureState(Ve,f.id,T)}removeFeatureState(f,T){this._checkLoaded();const X=f.source,Ve=this.getSource(X);if(!Ve)return void this.fire(new a.ErrorEvent(new Error(`The source '${X}' does not exist in the map's style.`)));const kt=Ve.type,Hr=kt==="vector"?f.sourceLayer:void 0;if(kt==="vector"&&!Hr)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(T&&typeof f.id!="string"&&typeof f.id!="number")return void this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const pi=this._getSourceCaches(X);for(const Vn of pi)Vn.removeFeatureState(Hr,f.id,T)}getFeatureState(f){this._checkLoaded();const T=f.source,X=f.sourceLayer,Ve=this.getSource(T);if(Ve){if(Ve.type!=="vector"||X)return f.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(T)[0].getFeatureState(X,f.id);this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new a.ErrorEvent(new Error(`The source '${T}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const f={};for(const T in this._sourceCaches){const X=this._sourceCaches[T].getSource();f[X.id]||(f[X.id]=X.serialize())}return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:f,layers:this._serializeLayers(this._order)},T=>T!==void 0)}_updateLayer(f){this._updatedLayers[f.id]=!0;const T=this._getLayerSourceCache(f);f.source&&!this._updatedSources[f.source]&&T&&T.getSource().type!=="raster"&&(this._updatedSources[f.source]="reload",T.pause()),this._changed=!0,f.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(f){const T=Hr=>this._layers[Hr].type==="fill-extrusion",X={},Ve=[];for(let Hr=this._order.length-1;Hr>=0;Hr--){const pi=this._order[Hr];if(T(pi)){X[pi]=Hr;for(const Vn of f){const oa=Vn[pi];if(oa)for(const sa of oa)Ve.push(sa)}}}Ve.sort((Hr,pi)=>pi.intersectionZ-Hr.intersectionZ);const kt=[];for(let Hr=this._order.length-1;Hr>=0;Hr--){const pi=this._order[Hr];if(T(pi))for(let Vn=Ve.length-1;Vn>=0;Vn--){const oa=Ve[Vn].feature;if(X[oa.layer.id]<Hr)break;kt.push(oa),Ve.pop()}else for(const Vn of f){const oa=Vn[pi];if(oa)for(const sa of oa)kt.push(sa.feature)}}return kt}queryRenderedFeatures(f,T,X){T&&T.filter&&this._validate(a.validateFilter,"queryRenderedFeatures.filter",T.filter,null,T);const Ve={};if(T&&T.layers){if(!Array.isArray(T.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const Vn of T.layers){const oa=this._layers[Vn];if(!oa)return this.fire(new a.ErrorEvent(new Error(`The layer '${Vn}' does not exist in the map's style and cannot be queried for features.`))),[];Ve[oa.source]=!0}}const kt=[];T.availableImages=this._availableImages;const Hr=T&&T.layers?T.layers.some(Vn=>{const oa=this.getLayer(Vn);return oa&&oa.is3D()}):this.has3DLayers(),pi=Xp.createFromScreenPoints(f,X);for(const Vn in this._sourceCaches){const oa=this._sourceCaches[Vn].getSource().id;T.layers&&!Ve[oa]||kt.push(_p(this._sourceCaches[Vn],this._layers,this._serializedLayers,pi,T,X,Hr,!!this.map._showQueryGeometry))}return this.placement&&kt.push(function(Vn,oa,sa,dl,lh,gh,_h){const yh={},xh=gh.queryRenderedSymbols(dl),yl=[];for(const mh of Object.keys(xh).map(Number))yl.push(_h[mh]);yl.sort(Dd);for(const mh of yl){const bh=mh.featureIndex.lookupSymbolFeatures(xh[mh.bucketInstanceId],oa,mh.bucketIndex,mh.sourceLayerIndex,lh.filter,lh.layers,lh.availableImages,Vn);for(const Sh in bh){const Nh=yh[Sh]=yh[Sh]||[],$h=bh[Sh];$h.sort((Vh,Wh)=>{const Zh=mh.featureSortOrder;if(Zh){const rp=Zh.indexOf(Vh.featureIndex);return Zh.indexOf(Wh.featureIndex)-rp}return Wh.featureIndex-Vh.featureIndex});for(const Vh of $h)Nh.push(Vh)}}for(const mh in yh)yh[mh].forEach(bh=>{const Sh=bh.feature,Nh=sa(Vn[mh]);if(!Nh)return;const $h=Nh.getFeatureState(Sh.layer["source-layer"],Sh.id);Sh.source=Sh.layer.source,Sh.layer["source-layer"]&&(Sh.sourceLayer=Sh.layer["source-layer"]),Sh.state=$h});return yh}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),pi.screenGeometry,T,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(kt)}querySourceFeatures(f,T){T&&T.filter&&this._validate(a.validateFilter,"querySourceFeatures.filter",T.filter,null,T);const X=this._getSourceCaches(f);let Ve=[];for(const kt of X)Ve=Ve.concat(rd(kt,T));return Ve}addSourceType(f,T,X){return Ny.getSourceType(f)?X(new Error(`A source type called "${f}" already exists.`)):(Ny.setSourceType(f,T),T.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:f,url:T.workerSourceURL},X):X(null,null))}getLight(){return this.light.getLight()}setLight(f,T={}){this._checkLoaded();const X=this.light.getLight();let Ve=!1;for(const Hr in f)if(!h(f[Hr],X[Hr])){Ve=!0;break}if(!Ve)return;const kt=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(f,T),this.light.updateTransitions(kt)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(f,T=1){if(this._checkLoaded(),!f)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let X=f;if(T===1){if(typeof X.source=="object"){const Ve="terrain-dem-src";this.addSource(Ve,X.source),X=a.clone$1(X),X=a.extend(X,{source:Ve})}if(this._validate(a.validateTerrain,"terrain",X))return}if(!this.terrain||this.terrain&&T!==this.terrain.drapeRenderMode){if(!X)return;this._createTerrain(X,T)}else{const Ve=this.terrain,kt=Ve.get();for(const Hr of Object.keys(a.spec.terrain))!X.hasOwnProperty(Hr)&&a.spec.terrain[Hr].default&&(X[Hr]=a.spec.terrain[Hr].default);for(const Hr in X)if(!h(X[Hr],kt[Hr])){Ve.set(X),this.stylesheet.terrain=X;const pi=this._setTransitionParameters({duration:0});Ve.updateTransitions(pi);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(f){const T=this.fog=new Lp(f,this.map.transform);this.stylesheet.fog=f;const X=this._setTransitionParameters({duration:0});T.updateTransitions(X)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const f of this.map._markers)f._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(f){if(this._checkLoaded(),!f)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const T=this.fog,X=T.get();Object.keys(f).length===0&&T.set(f);for(const Ve in f)if(!h(f[Ve],X[Ve])){T.set(f),this.stylesheet.fog=f;const kt=this._setTransitionParameters({duration:0});T.updateTransitions(kt);break}}else this._createFog(f);this._markersNeedUpdate=!0}_setTransitionParameters(f){return{now:a.exported.now(),transition:a.extend(f,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const f=this._order.filter(X=>this.isLayerDraped(this._layers[X])),T=this._order.filter(X=>!this.isLayerDraped(this._layers[X]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...f),this._drapedFirstOrder.push(...T)}_createTerrain(f,T){const X=this.terrain=new Mh(f,T);this.stylesheet.terrain=f,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const Ve=this._setTransitionParameters({duration:0});X.updateTransitions(Ve)}_force3DLayerUpdate(){for(const f in this._layers){const T=this._layers[f];T.type==="fill-extrusion"&&this._updateLayer(T)}}_forceSymbolLayerUpdate(){for(const f in this._layers){const T=this._layers[f];T.type==="symbol"&&this._updateLayer(T)}}_validate(f,T,X,Ve,kt={}){return(!kt||kt.validate!==!1)&&Ty(this,f.call(a.validateStyle,a.extend({key:T,style:this.serialize(),value:X,styleSpec:a.spec},Ve)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const f in this._layers)this._layers[f].setEventedParent(null);for(const f in this._sourceCaches)this._sourceCaches[f].clearTiles(),this._sourceCaches[f].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(f){const T=this._getSourceCaches(f);for(const X of T)X.clearTiles()}_reloadSource(f){const T=this._getSourceCaches(f);for(const X of T)X.resume(),X.reload()}_reloadSources(){for(const f of this._getSources())f.reload&&f.reload()}_updateSources(f){for(const T in this._sourceCaches)this._sourceCaches[T].update(f)}_generateCollisionBoxes(){for(const f in this._sourceCaches){const T=this._sourceCaches[f];T.resume(),T.reload()}}_updatePlacement(f,T,X,Ve,kt=!1){let Hr=!1,pi=!1;const Vn={};for(const oa of this._order){const sa=this._layers[oa];if(sa.type!=="symbol")continue;if(!Vn[sa.source]){const lh=this._getLayerSourceCache(sa);if(!lh)continue;Vn[sa.source]=lh.getRenderableIds(!0).map(gh=>lh.getTileByID(gh)).sort((gh,_h)=>_h.tileID.overscaledZ-gh.tileID.overscaledZ||(gh.tileID.isLessThan(_h.tileID)?-1:1))}const dl=this.crossTileSymbolIndex.addLayer(sa,Vn[sa.source],f.center.lng,f.projection);Hr=Hr||dl}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),kt=kt||this._layerOrderChanged||X===0,this._layerOrderChanged&&this.fire(new a.Event("neworder")),(kt||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),f.zoom))&&(this.pauseablePlacement=new Ev(f,this._order,kt,T,X,Ve,this.placement,this.fog&&f.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Vn),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),pi=!0),Hr&&this.pauseablePlacement.placement.setStale()),pi||Hr)for(const oa of this._order){const sa=this._layers[oa];sa.type==="symbol"&&this.placement.updateLayerOpacities(sa,Vn[sa.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const f in this._sourceCaches)this._sourceCaches[f].releaseSymbolFadeTiles()}getImages(f,T,X){this.imageManager.getImages(T.icons,X),this._updateTilesForChangedImages();const Ve=kt=>{kt&&kt.setDependencies(T.tileID.key,T.type,T.icons)};Ve(this._otherSourceCaches[T.source]),Ve(this._symbolSourceCaches[T.source])}getGlyphs(f,T,X){this.glyphManager.getGlyphs(T.stacks,X)}getResource(f,T,X){return a.makeRequest(T,X)}_getSourceCache(f){return this._otherSourceCaches[f]}_getLayerSourceCache(f){return f.type==="symbol"?this._symbolSourceCaches[f.source]:this._otherSourceCaches[f.source]}_getSourceCaches(f){const T=[];return this._otherSourceCaches[f]&&T.push(this._otherSourceCaches[f]),this._symbolSourceCaches[f]&&T.push(this._symbolSourceCaches[f]),T}_isSourceCacheLoaded(f){const T=this._getSourceCaches(f);return T.length===0?(this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${f}'`))),!1):T.every(X=>X.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ny.getSourceType=function(F){return kh[F]},Ny.setSourceType=function(F,f){kh[F]=f},Ny.registerForPluginStateChange=a.registerForPluginStateChange;var xx=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,V_="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Xy=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,l0=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ay=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let $_={},f_={};const U_=[];_y(xx,U_),_y(Xy,U_),_y(l0,U_),_y(Ay,U_),$_=hg("",Xy),f_=hg(Ay,l0);const j_=hg(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),u0=xx,G0=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var c0={background:hg(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:hg(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:hg(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:hg("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:hg(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:hg(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:hg("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:hg("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:hg("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:hg(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:hg(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:hg(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:hg(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:hg(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:hg(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:hg(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:hg(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:hg(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:hg(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:hg(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:hg(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:hg(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:hg(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:hg(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:hg(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:hg(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,V_),skyboxGradient:hg(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,V_),skyboxCapture:hg(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:hg(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:hg(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function _y(F,f){const T=F.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let X of T)if(X=X.trim(),X[0]==="#"&&X.includes("if")&&!X.includes("endif")){X=X.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const Ve=X.split(" ");for(const kt of Ve)f.includes(kt)||f.push(kt)}}function hg(F,f){const T=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,X=f.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),Ve={},kt=[...U_];return _y(F,kt),_y(f,kt),{fragmentSource:F=F.replace(T,(Hr,pi,Vn,oa,sa)=>(Ve[sa]=!0,pi==="define"?`
#ifndef HAS_UNIFORM_u_${sa}
varying ${Vn} ${oa} ${sa};
#else
uniform ${Vn} ${oa} u_${sa};
#endif
`:`
#ifdef HAS_UNIFORM_u_${sa}
    ${Vn} ${oa} ${sa} = u_${sa};
#endif
`)),vertexSource:f=f.replace(T,(Hr,pi,Vn,oa,sa)=>{const dl=oa==="float"?"vec2":"vec4",lh=sa.match(/color/)?"color":dl;return Ve[sa]?pi==="define"?`
#ifndef HAS_UNIFORM_u_${sa}
uniform lowp float u_${sa}_t;
attribute ${Vn} ${dl} a_${sa};
varying ${Vn} ${oa} ${sa};
#else
uniform ${Vn} ${oa} u_${sa};
#endif
`:lh==="vec4"?`
#ifndef HAS_UNIFORM_u_${sa}
    ${sa} = a_${sa};
#else
    ${Vn} ${oa} ${sa} = u_${sa};
#endif
`:`
#ifndef HAS_UNIFORM_u_${sa}
    ${sa} = unpack_mix_${lh}(a_${sa}, u_${sa}_t);
#else
    ${Vn} ${oa} ${sa} = u_${sa};
#endif
`:pi==="define"?`
#ifndef HAS_UNIFORM_u_${sa}
uniform lowp float u_${sa}_t;
attribute ${Vn} ${dl} a_${sa};
#else
uniform ${Vn} ${oa} u_${sa};
#endif
`:lh==="vec4"?`
#ifndef HAS_UNIFORM_u_${sa}
    ${Vn} ${oa} ${sa} = a_${sa};
#else
    ${Vn} ${oa} ${sa} = u_${sa};
#endif
`:`
#ifndef HAS_UNIFORM_u_${sa}
    ${Vn} ${oa} ${sa} = unpack_mix_${lh}(a_${sa}, u_${sa}_t);
#else
    ${Vn} ${oa} ${sa} = u_${sa};
#endif
`}),staticAttributes:X,usedDefines:kt}}class Tv{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(f,T,X,Ve,kt,Hr,pi){this.context=f;let Vn=this.boundPaintVertexBuffers.length!==Ve.length;for(let sa=0;!Vn&&sa<Ve.length;sa++)this.boundPaintVertexBuffers[sa]!==Ve[sa]&&(Vn=!0);let oa=this.boundDynamicVertexBuffers.length!==pi.length;for(let sa=0;!oa&&sa<pi.length;sa++)this.boundDynamicVertexBuffers[sa]!==pi[sa]&&(oa=!0);if(!f.extVertexArrayObject||!this.vao||this.boundProgram!==T||this.boundLayoutVertexBuffer!==X||Vn||oa||this.boundIndexBuffer!==kt||this.boundVertexOffset!==Hr)this.freshBind(T,X,Ve,kt,Hr,pi);else{f.bindVertexArrayOES.set(this.vao);for(const sa of pi)sa&&sa.bind();kt&&kt.dynamicDraw&&kt.bind()}}freshBind(f,T,X,Ve,kt,Hr){let pi;const Vn=f.numAttributes,oa=this.context,sa=oa.gl;if(oa.extVertexArrayObject)this.vao&&this.destroy(),this.vao=oa.extVertexArrayObject.createVertexArrayOES(),oa.bindVertexArrayOES.set(this.vao),pi=0,this.boundProgram=f,this.boundLayoutVertexBuffer=T,this.boundPaintVertexBuffers=X,this.boundIndexBuffer=Ve,this.boundVertexOffset=kt,this.boundDynamicVertexBuffers=Hr;else{pi=oa.currentNumAttributes||0;for(let dl=Vn;dl<pi;dl++)sa.disableVertexAttribArray(dl)}T.enableAttributes(sa,f),T.bind(),T.setVertexAttribPointers(sa,f,kt);for(const dl of X)dl.enableAttributes(sa,f),dl.bind(),dl.setVertexAttribPointers(sa,f,kt);for(const dl of Hr)dl&&(dl.enableAttributes(sa,f),dl.bind(),dl.setVertexAttribPointers(sa,f,kt));Ve&&Ve.bind(),oa.currentNumAttributes=Vn}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function g_(F,f){const T=Math.pow(2,f.canonical.z),X=f.canonical.y;return[new a.MercatorCoordinate(0,X/T).toLngLat().lat,new a.MercatorCoordinate(0,(X+1)/T).toLngLat().lat]}function wx(F,f,T,X,Ve,kt,Hr){const pi=F.context,Vn=pi.gl,oa=T.fbo;if(!oa)return;F.prepareDrawTile();const sa=F.useProgram("hillshade");pi.activeTexture.set(Vn.TEXTURE0),Vn.bindTexture(Vn.TEXTURE_2D,oa.colorAttachment.get());const dl=((yh,xh,yl,mh)=>{const bh=yl.paint.get("hillshade-shadow-color"),Sh=yl.paint.get("hillshade-highlight-color"),Nh=yl.paint.get("hillshade-accent-color");let $h=yl.paint.get("hillshade-illumination-direction")*(Math.PI/180);yl.paint.get("hillshade-illumination-anchor")==="viewport"&&($h-=yh.transform.angle);const Vh=!yh.options.moving;return{u_matrix:mh||yh.transform.calculateProjMatrix(xh.tileID.toUnwrapped(),Vh),u_image:0,u_latrange:g_(0,xh.tileID),u_light:[yl.paint.get("hillshade-exaggeration"),$h],u_shadow:bh,u_highlight:Sh,u_accent:Nh}})(F,T,X,F.terrain?f.projMatrix:null);F.prepareDrawProgram(pi,sa,f.toUnwrapped());const{tileBoundsBuffer:lh,tileBoundsIndexBuffer:gh,tileBoundsSegments:_h}=F.getTileBoundsBuffers(T);sa.draw(pi,Vn.TRIANGLES,Ve,kt,Hr,a.CullFaceMode.disabled,dl,X.id,lh,gh,_h)}function h0(F,f,T){if(!f.needsDEMTextureUpload)return;const X=F.context,Ve=X.gl;X.pixelStoreUnpackPremultiplyAlpha.set(!1),f.demTexture=f.demTexture||F.getTileTexture(T.stride);const kt=T.getPixels();f.demTexture?f.demTexture.update(kt,{premultiply:!1}):f.demTexture=new a.Texture(X,kt,Ve.RGBA,{premultiply:!1}),f.needsDEMTextureUpload=!1}function yg(F,f,T,X,Ve,kt){const Hr=F.context,pi=Hr.gl;if(!f.dem)return;const Vn=f.dem;if(Hr.activeTexture.set(pi.TEXTURE1),h0(F,f,Vn),!f.demTexture)return;f.demTexture.bind(pi.NEAREST,pi.CLAMP_TO_EDGE);const oa=Vn.dim;Hr.activeTexture.set(pi.TEXTURE0);let sa=f.fbo;if(!sa){const _h=new a.Texture(Hr,{width:oa,height:oa,data:null},pi.RGBA);_h.bind(pi.LINEAR,pi.CLAMP_TO_EDGE),sa=f.fbo=Hr.createFramebuffer(oa,oa,!0),sa.colorAttachment.set(_h.texture)}Hr.bindFramebuffer.set(sa.framebuffer),Hr.viewport.set([0,0,oa,oa]);const{tileBoundsBuffer:dl,tileBoundsIndexBuffer:lh,tileBoundsSegments:gh}=F.getMercatorTileBoundsBuffers();F.useProgram("hillshadePrepare").draw(Hr,pi.TRIANGLES,X,Ve,kt,a.CullFaceMode.disabled,((_h,yh)=>{const xh=yh.stride,yl=a.create();return a.ortho(yl,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(yl,yl,[0,-a.EXTENT,0]),{u_matrix:yl,u_image:1,u_dimension:[xh,xh],u_zoom:_h.overscaledZ,u_unpack:yh.unpackVector}})(f.tileID,Vn),T.id,dl,lh,gh),f.needsHillshadePrepare=!1}const Av=F=>({u_matrix:new a.UniformMatrix4f(F),u_image0:new a.Uniform1i(F),u_skirt_height:new a.Uniform1f(F)}),Rv=(F,f)=>({u_matrix:F,u_image0:0,u_skirt_height:f}),p0=(F,f,T,X,Ve,kt,Hr,pi,Vn,oa,sa,dl,lh,gh,_h)=>({u_proj_matrix:Float32Array.from(F),u_globe_matrix:f,u_normalize_matrix:Float32Array.from(X),u_merc_matrix:T,u_zoom_transition:Ve,u_merc_center:kt,u_image0:0,u_frustum_tl:Hr,u_frustum_tr:pi,u_frustum_br:Vn,u_frustum_bl:oa,u_globe_pos:sa,u_globe_radius:dl,u_viewport:lh,u_grid_matrix:_h?Float32Array.from(_h):new Float32Array(9),u_skirt_height:gh});function ky(F,f){return F!=null&&f!=null&&!(!F.hasData()||!f.hasData())&&F.demTexture!=null&&f.demTexture!=null&&F.tileID.key!==f.tileID.key}const Yy=new class{constructor(){this.operations={}}newMorphing(F,f,T,X,Ve){if(F in this.operations){const kt=this.operations[F];kt.to.tileID.key!==T.tileID.key&&(kt.queued=T)}else this.operations[F]={startTime:X,phase:0,duration:Ve,from:f,to:T,queued:null}}getMorphValuesForProxy(F){if(!(F in this.operations))return null;const f=this.operations[F];return{from:f.from,to:f.to,phase:f.phase}}update(F){for(const f in this.operations){const T=this.operations[f];for(T.phase=(F-T.startTime)/T.duration;T.phase>=1||!this._validOp(T);)if(!this._nextOp(T,F)){delete this.operations[f];break}}}_nextOp(F,f){return!!F.queued&&(F.from=F.to,F.to=F.queued,F.queued=null,F.phase=0,F.startTime=f,!0)}_validOp(F){return F.from.hasData()&&F.to.hasData()}},Jy={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function d0(F){return 6*Math.pow(1.5,22-F)}function Vx(F,f){const T=1<<F.z;return!f&&(F.x===0||F.x===T-1)||F.y===0||F.y===T-1}const H_=F=>({u_matrix:F});function Iv(F,f,T,X,Ve){if(Ve>0){const kt=a.exported.now(),Hr=(kt-F.timeAdded)/Ve,pi=f?(kt-f.timeAdded)/Ve:-1,Vn=T.getSource(),oa=X.coveringZoomLevel({tileSize:Vn.tileSize,roundZoom:Vn.roundZoom}),sa=!f||Math.abs(f.tileID.overscaledZ-oa)>Math.abs(F.tileID.overscaledZ-oa),dl=sa&&F.refreshedUponExpiration?1:a.clamp(sa?Hr:1-pi,0,1);return F.refreshedUponExpiration&&Hr>=1&&(F.refreshedUponExpiration=!1),f?{opacity:1,mix:1-dl}:{opacity:dl,mix:0}}return{opacity:1,mix:0}}class Lg extends a.SourceCache{constructor(f){const T={type:"raster-dem",maxzoom:f.transform.maxZoom},X=new Ip(Vf(),null),Ve=ep("mock-dem",T,X,f.style);super("mock-dem",Ve,!1),Ve.setEventedParent(this),this._sourceLoaded=!0}_loadTile(f,T){f.state="loaded",T(null)}}class Pv extends a.SourceCache{constructor(f){const T=ep("proxy",{type:"geojson",maxzoom:f.transform.maxZoom},new Ip(Vf(),null),f.style);super("proxy",T,!1),T.setEventedParent(this),this.map=this.getSource().map=f,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(f,T,X){if(f.freezeTileCoverage)return;this.transform=f;const Ve=f.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((kt,Hr)=>{if(kt[Hr.key]="",!this._tiles[Hr.key]){const pi=new a.Tile(Hr,this._source.tileSize*Hr.overscaleFactor(),f.tileZoom);pi.state="loaded",this._tiles[Hr.key]=pi}return kt},{});for(const kt in this._tiles)kt in Ve||(this.freeFBO(kt),this._tiles[kt].unloadVectorData(),delete this._tiles[kt])}freeFBO(f){const T=this.proxyCachedFBO[f];if(T!==void 0){const X=Object.values(T);this.renderCachePool.push(...X),delete this.proxyCachedFBO[f]}}deallocRenderCache(){this.renderCache.forEach(f=>f.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class rg extends a.OverscaledTileID{constructor(f,T,X){super(f.overscaledZ,f.wrap,f.canonical.z,f.canonical.x,f.canonical.y),this.proxyTileKey=T,this.projMatrix=X}}class Mv extends a.Elevation{constructor(f,T){super(),this.painter=f,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[X,Ve,kt]=function(Vn){const oa=new a.StructArrayLayout2i4,sa=new a.StructArrayLayout3ui6,dl=131;oa.reserve(17161),sa.reserve(33800);const lh=a.EXTENT/128,gh=a.EXTENT+lh/2,_h=gh+lh;for(let xh=-lh;xh<_h;xh+=lh)for(let yl=-lh;yl<_h;yl+=lh){const mh=yl<0||yl>gh||xh<0||xh>gh?24575:0,bh=a.clamp(Math.round(yl),0,a.EXTENT),Sh=a.clamp(Math.round(xh),0,a.EXTENT);oa.emplaceBack(bh+mh,Sh)}const yh=(xh,yl)=>{const mh=yl*dl+xh;sa.emplaceBack(mh+1,mh,mh+dl),sa.emplaceBack(mh+dl,mh+dl+1,mh+1)};for(let xh=1;xh<129;xh++)for(let yl=1;yl<129;yl++)yh(yl,xh);return[0,129].forEach(xh=>{for(let yl=0;yl<130;yl++)yh(yl,xh),yh(xh,yl)}),[oa,sa,32768]}(),Hr=f.context;this.gridBuffer=Hr.createVertexBuffer(X,a.posAttributes.members),this.gridIndexBuffer=Hr.createIndexBuffer(Ve),this.gridSegments=a.SegmentVector.simpleSegment(0,0,X.length,Ve.length),this.gridNoSkirtSegments=a.SegmentVector.simpleSegment(0,0,X.length,kt),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Pv(T.map),this.orthoMatrix=a.create(),a.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,a.EXTENT,0,a.EXTENT,0,1);const pi=Hr.gl;this._overlapStencilMode=new a.StencilMode({func:pi.GEQUAL,mask:255},0,255,pi.KEEP,pi.KEEP,pi.REPLACE),this._previousZoom=f.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=T,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Lg(T.map)}set style(f){f.on("data",this._onStyleDataEvent.bind(this)),f.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=f,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(f,T,X){if(f&&f.terrain){this._style!==f&&(this.style=f),this.enabled=!0;const Ve=f.terrain.properties;this.sourceCache=f.terrain.drapeRenderMode===0?this._mockSourceCache:f._getSourceCache(Ve.get("source")),this._exaggeration=Ve.get("exaggeration");const kt=()=>{this.sourceCache.used&&a.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const Hr=this.getScaledDemTileSize();this.sourceCache.update(T,Hr,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,kt(),this._initializing=!0),kt(),T.updateElevation(!0,X),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(T),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(f){this._findCoveringTileCache[f]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const f=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||f.efficiency!==100&&a.warnOnce(`Terrain render cache efficiency is not optimal (${f.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${f.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(f){f.coord&&f.dataType==="source"?this._clearRenderCacheForTile(f.sourceCacheId,f.coord):f.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const f in this._style._sourceCaches)this._style._sourceCaches[f].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(f=>f.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const f=2*this.proxySourceCache.getSource().tileSize;return[f,f]}set useVertexMorphing(f){this._useVertexMorphing=f}updateTileBinding(f){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const T=this.proxySourceCache,X=this.painter.transform;this._initializing&&(this._initializing=X._centerAltitude===0&&this.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(X.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const Ve=this.proxyCoords=T.getIds().map(Vn=>{const oa=T.getTileByID(Vn).tileID;return oa.projMatrix=X.calculateProjMatrix(oa.toUnwrapped()),oa});(function(Vn,oa){const sa=oa.transform.pointCoordinate(oa.transform.getCameraPoint()),dl=new a.Point(sa.x,sa.y);Vn.sort((lh,gh)=>{if(gh.overscaledZ-lh.overscaledZ)return gh.overscaledZ-lh.overscaledZ;const _h=new a.Point(lh.canonical.x+(1<<lh.canonical.z)*lh.wrap,lh.canonical.y),yh=new a.Point(gh.canonical.x+(1<<gh.canonical.z)*gh.wrap,gh.canonical.y),xh=dl.mult(1<<lh.canonical.z);return xh.x-=.5,xh.y-=.5,xh.distSqr(_h)-xh.distSqr(yh)})})(Ve,this.painter),this._previousZoom=X.zoom;const kt=this.proxyToSource||{};this.proxyToSource={},Ve.forEach(Vn=>{this.proxyToSource[Vn.key]={}}),this.terrainTileForTile={};const Hr=this._style._sourceCaches;for(const Vn in Hr){const oa=Hr[Vn];if(!oa.used||(oa!==this.sourceCache&&this.resetTileLookupCache(oa.id),this._setupProxiedCoordsForOrtho(oa,f[Vn],kt),oa.usedForTerrain))continue;const sa=f[Vn];oa.getSource().reparseOverscaled&&this._assignTerrainTiles(sa)}this.proxiedCoords[T.id]=Ve.map(Vn=>new rg(Vn,Vn.key,this.orthoMatrix)),this._assignTerrainTiles(Ve),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(kt),this.renderingToTexture=!1,this._updateTimestamp=a.exported.now();const pi={};this._visibleDemTiles=[];for(const Vn of this.proxyCoords){const oa=this.terrainTileForTile[Vn.key];if(!oa)continue;const sa=oa.tileID.key;sa in pi||(this._visibleDemTiles.push(oa),pi[sa]=sa)}}_assignTerrainTiles(f){this._initializing||f.forEach(T=>{if(this.terrainTileForTile[T.key])return;const X=this._findTileCoveringTileID(T,this.sourceCache);X&&(this.terrainTileForTile[T.key]=X)})}_prepareDEMTextures(){const f=this.painter.context,T=f.gl;for(const X in this.terrainTileForTile){const Ve=this.terrainTileForTile[X],kt=Ve.dem;!kt||Ve.demTexture&&!Ve.needsDEMTextureUpload||(f.activeTexture.set(T.TEXTURE1),h0(this.painter,Ve,kt))}}_prepareDemTileUniforms(f,T,X,Ve){if(!T||T.demTexture==null)return!1;const kt=f.tileID.canonical,Hr=Math.pow(2,T.tileID.canonical.z-kt.z),pi=Ve||"";return X[`u_dem_tl${pi}`]=[kt.x*Hr%1,kt.y*Hr%1],X[`u_dem_scale${pi}`]=Hr,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const f=this.painter.context,T=f.gl;if(!this._emptyDepthBufferTexture){const X=new a.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new a.Texture(f,X,T.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let f=0;const T=this._visibleDemTiles.reduce((X,Ve)=>{if(!Ve.dem)return X;const kt=Ve.dem.tree.minimums[0];return kt>0&&f++,X+kt},0);return f?T/f:0}_updateEmptyDEMTexture(){const f=this.painter.context,T=f.gl;f.activeTexture.set(T.TEXTURE2);const X=this._getLoadedAreaMinimum(),Ve=new a.RGBAImage({width:1,height:1},new Uint8Array(a.DEMData.pack(X,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let kt=this._emptyDEMTexture;return kt?kt.update(Ve,{premultiply:!1}):kt=this._emptyDEMTexture=new a.Texture(f,Ve,T.RGBA,{premultiply:!1}),kt}setupElevationDraw(f,T,X){const Ve=this.painter.context,kt=Ve.gl,Hr=(pi=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:a.DEMData.getUnpackVector(pi),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var pi;Hr.u_dem_size=this.sourceCache.getSource().tileSize,Hr.u_exaggeration=this.exaggeration();let Vn=null,oa=null,sa=1;if(X&&X.morphing&&this._useVertexMorphing){const dl=X.morphing.srcDemTile,lh=X.morphing.dstDemTile;sa=X.morphing.phase,dl&&lh&&(this._prepareDemTileUniforms(f,dl,Hr,"_prev")&&(oa=dl),this._prepareDemTileUniforms(f,lh,Hr)&&(Vn=lh))}if(oa&&Vn?(Ve.activeTexture.set(kt.TEXTURE2),Vn.demTexture.bind(kt.NEAREST,kt.CLAMP_TO_EDGE,kt.NEAREST),Ve.activeTexture.set(kt.TEXTURE4),oa.demTexture.bind(kt.NEAREST,kt.CLAMP_TO_EDGE,kt.NEAREST),Hr.u_dem_lerp=sa):(Vn=this.terrainTileForTile[f.tileID.key],Ve.activeTexture.set(kt.TEXTURE2),(this._prepareDemTileUniforms(f,Vn,Hr)?Vn.demTexture:this.emptyDEMTexture).bind(kt.NEAREST,kt.CLAMP_TO_EDGE)),Ve.activeTexture.set(kt.TEXTURE3),X&&X.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(kt.NEAREST,kt.CLAMP_TO_EDGE),this._depthFBO&&(Hr.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(kt.NEAREST,kt.CLAMP_TO_EDGE),Hr.u_depth_size_inv=[1,1]),X&&X.useMeterToDem&&Vn){const dl=(1<<Vn.tileID.canonical.z)*a.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;Hr.u_meter_to_dem=dl}if(X&&X.labelPlaneMatrixInv&&(Hr.u_label_plane_matrix_inv=X.labelPlaneMatrixInv),T.setTerrainUniformValues(Ve,Hr),this.painter.transform.projection.name==="globe"){const dl=this.globeUniformValues(this.painter.transform,f.tileID.canonical,X&&X.useDenormalizedUpVectorScale);T.setGlobeUniformValues(Ve,dl)}}globeUniformValues(f,T,X){const Ve=f.projection;return{u_tile_tl_up:Ve.upVector(T,0,0),u_tile_tr_up:Ve.upVector(T,a.EXTENT,0),u_tile_br_up:Ve.upVector(T,a.EXTENT,a.EXTENT),u_tile_bl_up:Ve.upVector(T,0,a.EXTENT),u_tile_up_scale:X?a.globeMetersToEcef(1):Ve.upVectorScale(T,f.center.lat,f.worldSize).metersToTile}}renderToBackBuffer(f){const T=this.painter,X=this.painter.context;f.length!==0&&(X.bindFramebuffer.set(null),X.viewport.set([0,0,T.width,T.height]),T.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(Ve,kt,Hr,pi,Vn){if(Ve.transform.projection.name==="globe")(function(oa,sa,dl,lh,gh){const _h=oa.context,yh=_h.gl;let xh,yl;const mh=oa.options.showTerrainWireframe?2:0,bh=oa.transform,Sh=a.globeUseCustomAntiAliasing(oa,_h,bh),Nh=(bp,np)=>{if(yl===bp)return;const wp=[Jy[bp],"PROJECTION_GLOBE_VIEW"];Sh&&wp.push("CUSTOM_ANTIALIASING"),np&&wp.push(Jy[mh]),xh=oa.useProgram("globeRaster",null,wp),yl=bp},$h=oa.colorModeForRenderPass(),Vh=new a.DepthMode(yh.LEQUAL,a.DepthMode.ReadWrite,oa.depthRangeFor3D);Yy.update(gh);const Wh=a.calculateGlobeMercatorMatrix(bh),Zh=[a.mercatorXfromLng(bh.center.lng),a.mercatorYfromLat(bh.center.lat)],rp=mh?[!1,!0]:[!1],Bp=oa.globeSharedBuffers,tp=[bh.width*a.exported.devicePixelRatio,bh.height*a.exported.devicePixelRatio],Tp=Float32Array.from(bh.globeMatrix),pp={useDenormalizedUpVectorScale:!0};if(rp.forEach(bp=>{const np=oa.transform,wp=d0(np.zoom)*sa.exaggeration();yl=-1;const Fp=bp?yh.LINES:yh.TRIANGLES;for(const Pp of lh){const Up=dl.getTile(Pp),zd=a.StencilMode.disabled,jf=sa.prevTerrainTileForTile[Pp.key],Pd=sa.terrainTileForTile[Pp.key];ky(jf,Pd)&&Yy.newMorphing(Pp.key,jf,Pd,gh,250),_h.activeTexture.set(yh.TEXTURE0),Up.texture.bind(yh.LINEAR,yh.CLAMP_TO_EDGE);const Zd=Yy.getMorphValuesForProxy(Pp.key),ig=Zd?1:0;Zd&&a.extend$1(pp,{morphing:{srcDemTile:Zd.from,dstDemTile:Zd.to,phase:a.easeCubicInOut(Zd.phase)}});const Jf=a.tileCornersToBounds(Pp.canonical),Bd=a.getLatitudinalLod(Jf.getCenter().lat),fg=a.getGridMatrix(Pp.canonical,Jf,Bd,np.worldSize/np._pixelsPerMercatorPixel),Sg=a.globeNormalizeECEF(a.globeTileBounds(Pp.canonical)),Tg=p0(np.projMatrix,Tp,Wh,Sg,a.globeToMercatorTransition(np.zoom),Zh,np.frustumCorners.TL,np.frustumCorners.TR,np.frustumCorners.BR,np.frustumCorners.BL,np.globeCenterInViewSpace,np.globeRadius,tp,wp,fg);if(Nh(ig,bp),sa.setupElevationDraw(Up,xh,pp),oa.prepareDrawProgram(_h,xh,Pp.toUnwrapped()),Bp){const[gg,Jm,om]=bp?Bp.getWirefameBuffers(oa.context,Bd):Bp.getGridBuffers(Bd,wp!==0);xh.draw(_h,Fp,Vh,zd,$h,a.CullFaceMode.backCCW,Tg,"globe_raster",gg,Jm,om)}}}),Bp){const bp=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Sh&&bp.push("CUSTOM_ANTIALIASING"),xh=oa.useProgram("globeRaster",null,bp);for(const np of lh){const{x:wp,y:Fp,z:Pp}=np.canonical,Up=Fp===0,zd=Fp===(1<<Pp)-1,[jf,Pd,Zd,ig]=Bp.getPoleBuffers(Pp);if(ig&&(Up||zd)){const Jf=dl.getTile(np);_h.activeTexture.set(yh.TEXTURE0),Jf.texture.bind(yh.LINEAR,yh.CLAMP_TO_EDGE);let Bd=a.globePoleMatrixForTile(Pp,wp,bh);const fg=a.globeNormalizeECEF(a.globeTileBounds(np.canonical)),Sg=(Tg,gg)=>Tg.draw(_h,yh.TRIANGLES,Vh,a.StencilMode.disabled,$h,a.CullFaceMode.disabled,p0(bh.projMatrix,Bd,Bd,fg,0,Zh,bh.frustumCorners.TL,bh.frustumCorners.TR,bh.frustumCorners.BR,bh.frustumCorners.BL,bh.globeCenterInViewSpace,bh.globeRadius,tp,0),"globe_pole_raster",gg,Zd,ig);sa.setupElevationDraw(Jf,xh,pp),oa.prepareDrawProgram(_h,xh,np.toUnwrapped()),Up&&Sg(xh,jf),zd&&(Bd=a.scale(a.create(),Bd,[1,-1,1]),Sg(xh,Pd))}}}})(Ve,kt,Hr,pi,Vn);else{const oa=Ve.context,sa=oa.gl;let dl,lh;const gh=Ve.options.showTerrainWireframe?2:0,_h=(bh,Sh)=>{if(lh===bh)return;const Nh=[Jy[bh]];Sh&&Nh.push(Jy[gh]),dl=Ve.useProgram("terrainRaster",null,Nh),lh=bh},yh=Ve.colorModeForRenderPass(),xh=new a.DepthMode(sa.LEQUAL,a.DepthMode.ReadWrite,Ve.depthRangeFor3D);Yy.update(Vn);const yl=Ve.transform,mh=d0(yl.zoom)*kt.exaggeration();(gh?[!1,!0]:[!1]).forEach(bh=>{lh=-1;const Sh=bh?sa.LINES:sa.TRIANGLES,[Nh,$h]=bh?kt.getWirefameBuffer():[kt.gridIndexBuffer,kt.gridSegments];for(const Vh of pi){const Wh=Hr.getTile(Vh),Zh=a.StencilMode.disabled,rp=kt.prevTerrainTileForTile[Vh.key],Bp=kt.terrainTileForTile[Vh.key];ky(rp,Bp)&&Yy.newMorphing(Vh.key,rp,Bp,Vn,250),oa.activeTexture.set(sa.TEXTURE0),Wh.texture.bind(sa.LINEAR,sa.CLAMP_TO_EDGE,sa.LINEAR_MIPMAP_NEAREST);const tp=Yy.getMorphValuesForProxy(Vh.key),Tp=tp?1:0;let pp;tp&&(pp={morphing:{srcDemTile:tp.from,dstDemTile:tp.to,phase:a.easeCubicInOut(tp.phase)}});const bp=Rv(Vh.projMatrix,Vx(Vh.canonical,yl.renderWorldCopies)?mh/10:mh);_h(Tp,bh),kt.setupElevationDraw(Wh,dl,pp),Ve.prepareDrawProgram(oa,dl,Vh.toUnwrapped()),dl.draw(oa,Sh,xh,Zh,yh,a.CullFaceMode.backCCW,bp,"terrain_raster",kt.gridBuffer,Nh,$h)}})}}(T,this,this.proxySourceCache,f,this._updateTimestamp),this.renderingToTexture=!0,T.gpuTimingDeferredRenderEnd(),f.splice(0,f.length))}renderBatch(f){if(this._drapedRenderBatches.length===0)return f+1;this.renderingToTexture=!0;const T=this.painter,X=this.painter.context,Ve=this.proxySourceCache,kt=this.proxiedCoords[Ve.id],Hr=this._drapedRenderBatches.shift(),pi=[],Vn=T.style.order;let oa=0;for(const sa of kt){const dl=Ve.getTileByID(sa.proxyTileKey),lh=Ve.proxyCachedFBO[sa.key]?Ve.proxyCachedFBO[sa.key][f]:void 0,gh=lh!==void 0?Ve.renderCache[lh]:this.pool[oa++],_h=lh!==void 0;if(dl.texture=gh.tex,_h&&!gh.dirty){pi.push(dl.tileID);continue}let yh;X.bindFramebuffer.set(gh.fb.framebuffer),this.renderedToTile=!1,gh.dirty&&(X.clear({color:a.Color.transparent,stencil:0}),gh.dirty=!1);for(let xh=Hr.start;xh<=Hr.end;++xh){const yl=T.style._layers[Vn[xh]];if(yl.isHidden(T.transform.zoom))continue;const mh=T.style._getLayerSourceCache(yl),bh=mh?this.proxyToSource[sa.key][mh.id]:[sa];if(!bh)continue;const Sh=bh;X.viewport.set([0,0,gh.fb.width,gh.fb.height]),yh!==(mh?mh.id:null)&&(this._setupStencil(gh,bh,yl,mh),yh=mh?mh.id:null),T.renderLayer(T,mh,yl,Sh)}this.renderedToTile?(gh.dirty=!0,pi.push(dl.tileID)):_h||--oa,oa===5&&(oa=0,this.renderToBackBuffer(pi))}return this.renderToBackBuffer(pi),this.renderingToTexture=!1,X.bindFramebuffer.set(null),X.viewport.set([0,0,T.width,T.height]),Hr.end+1}postRender(){}renderCacheEfficiency(f){const T=f.order.length;if(T===0)return{efficiency:100};let X,Ve=0,kt=0,Hr=!1;for(let pi=0;pi<T;++pi){const Vn=f._layers[f.order[pi]];this._style.isLayerDraped(Vn)?(Hr&&++Ve,++kt):Hr||(Hr=!0,X=Vn.id)}return kt===0?{efficiency:100}:{efficiency:100*(1-Ve/kt),firstUndrapedLayer:X}}getMinElevationBelowMSL(){let f=0;return this._visibleDemTiles.filter(T=>T.dem).forEach(T=>{f=Math.min(f,T.dem.tree.minimums[0])}),f===0?f:(f-30)*this._exaggeration}raycast(f,T,X){if(!this._visibleDemTiles)return null;const Ve=this._visibleDemTiles.filter(kt=>kt.dem).map(kt=>{const Hr=kt.tileID,pi=1<<Hr.overscaledZ,{x:Vn,y:oa}=Hr.canonical,sa=Vn/pi,dl=(Vn+1)/pi,lh=oa/pi,gh=(oa+1)/pi;return{minx:sa,miny:lh,maxx:dl,maxy:gh,t:kt.dem.tree.raycastRoot(sa,lh,dl,gh,f,T,X),tile:kt}});Ve.sort((kt,Hr)=>(kt.t!==null?kt.t:Number.MAX_VALUE)-(Hr.t!==null?Hr.t:Number.MAX_VALUE));for(const kt of Ve){if(kt.t==null)return null;const Hr=kt.tile.dem.tree.raycast(kt.minx,kt.miny,kt.maxx,kt.maxy,f,T,X);if(Hr!=null)return Hr}return null}_createFBO(){const f=this.painter.context,T=f.gl,X=this.drapeBufferSize;f.activeTexture.set(T.TEXTURE0);const Ve=new a.Texture(f,{width:X[0],height:X[1],data:null},T.RGBA);Ve.bind(T.LINEAR,T.CLAMP_TO_EDGE);const kt=f.createFramebuffer(X[0],X[1],!1);return kt.colorAttachment.set(Ve.texture),kt.depthAttachment=new di(f,kt.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=f.createRenderbuffer(f.gl.DEPTH_STENCIL,X[0],X[1]),this._stencilRef=0,kt.depthAttachment.set(this._sharedDepthStencil),f.clear({stencil:0})):kt.depthAttachment.set(this._sharedDepthStencil),f.extTextureFilterAnisotropic&&!f.extTextureFilterAnisotropicForceOff&&T.texParameterf(T.TEXTURE_2D,f.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,f.extTextureFilterAnisotropicMax),{fb:kt,tex:Ve,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const f in this._style._sourceCaches)if(this._style._sourceCaches[f].hasTransition())return!0;return this._style.order.some(f=>{const T=this._style._layers[f],X=T.isHidden(this.painter.transform.zoom);return T.type==="custom"?!X&&T.shouldRedrape():!X&&T.hasTransition()})}_clearLineLayersFromRenderCache(){let f=!1;for(const X of this._style._getSources())if(X instanceof ih){f=!0;break}if(!f)return;const T={};for(let X=0;X<this._style.order.length;++X){const Ve=this._style._layers[this._style.order[X]],kt=this._style._getLayerSourceCache(Ve);if(kt&&!T[kt.id]&&!Ve.isHidden(this.painter.transform.zoom)&&Ve.type==="line"&&Ve.widthExpression()instanceof a.ZoomDependentExpression){T[kt.id]=!0;for(const Hr of this.proxyCoords){const pi=this.proxyToSource[Hr.key][kt.id];if(pi)for(const Vn of pi)this._clearRenderCacheForTile(kt.id,Vn)}}}}_clearRasterLayersFromRenderCache(){let f=!1;for(const X in this._style._sourceCaches)if(this._style._sourceCaches[X]._source instanceof uh){f=!0;break}if(!f)return;const T={};for(let X=0;X<this._style.order.length;++X){const Ve=this._style._layers[this._style.order[X]],kt=this._style._getLayerSourceCache(Ve);if(!kt||T[kt.id]||Ve.isHidden(this.painter.transform.zoom)||Ve.type!=="raster")continue;const Hr=Ve.paint.get("raster-fade-duration");for(const pi of this.proxyCoords){const Vn=this.proxyToSource[pi.key][kt.id];if(Vn)for(const oa of Vn){const sa=Iv(kt.getTile(oa),kt.findLoadedParent(oa,0),kt,this.painter.transform,Hr);(sa.opacity!==1||sa.mix!==0)&&this._clearRenderCacheForTile(kt.id,oa)}}}}_setupDrapedRenderBatches(){const f=this._style.order,T=f.length;if(T===0)return;const X=[];let Ve,kt=0,Hr=this._style._layers[f[kt]];for(;!this._style.isLayerDraped(Hr)&&Hr.isHidden(this.painter.transform.zoom)&&++kt<T;)Hr=this._style._layers[f[kt]];for(;kt<T;++kt){const pi=this._style._layers[f[kt]];pi.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(pi)?Ve===void 0&&(Ve=kt):Ve!==void 0&&(X.push({start:Ve,end:kt-1}),Ve=void 0))}Ve!==void 0&&X.push({start:Ve,end:kt-1}),this._drapedRenderBatches=X}_setupRenderCache(f){const T=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,T.renderCache.length>T.renderCachePool.length){const Hr=Object.values(T.proxyCachedFBO);T.proxyCachedFBO={};for(let pi=0;pi<Hr.length;++pi){const Vn=Object.values(Hr[pi]);T.renderCachePool.push(...Vn)}}return}this._clearRasterLayersFromRenderCache();const X=this.proxyCoords,Ve=this._tilesDirty;for(let Hr=X.length-1;Hr>=0;Hr--){const pi=X[Hr];if(T.getTileByID(pi.key),T.proxyCachedFBO[pi.key]!==void 0){const Vn=f[pi.key],oa=this.proxyToSource[pi.key];let sa=0;for(const dl in oa){const lh=oa[dl],gh=Vn[dl];if(!gh||gh.length!==lh.length||lh.some((_h,yh)=>_h!==gh[yh]||Ve[dl]&&Ve[dl].hasOwnProperty(_h.key))){sa=-1;break}++sa}for(const dl in T.proxyCachedFBO[pi.key])T.renderCache[T.proxyCachedFBO[pi.key][dl]].dirty=sa<0||sa!==Object.values(Vn).length}}const kt=[...this._drapedRenderBatches];kt.sort((Hr,pi)=>pi.end-pi.start-(Hr.end-Hr.start));for(const Hr of kt)for(const pi of X){if(T.proxyCachedFBO[pi.key])continue;let Vn=T.renderCachePool.pop();Vn===void 0&&T.renderCache.length<50&&(Vn=T.renderCache.length,T.renderCache.push(this._createFBO())),Vn!==void 0&&(T.proxyCachedFBO[pi.key]={},T.proxyCachedFBO[pi.key][Hr.start]=Vn,T.renderCache[Vn].dirty=!0)}this._tilesDirty={}}_setupStencil(f,T,X,Ve){if(!Ve||!this._sourceTilesOverlap[Ve.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const kt=this.painter.context,Hr=kt.gl;if(T.length<=1)return void(this._overlapStencilType=!1);let pi;if(X.isTileClipped())pi=T.length,this._overlapStencilMode.test={func:Hr.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(T[0].overscaledZ>T[T.length-1].overscaledZ))return void(this._overlapStencilType=!1);pi=1,this._overlapStencilMode.test={func:Hr.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+pi>255&&(kt.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=pi,this._overlapStencilMode.ref=this._stencilRef,X.isTileClipped()&&this._renderTileClippingMasks(T,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(f){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[f.key]),this._overlapStencilMode):a.StencilMode.disabled}_renderTileClippingMasks(f,T){const X=this.painter,Ve=this.painter.context,kt=Ve.gl;X._tileClippingMaskIDs={},Ve.setColorMode(a.ColorMode.disabled),Ve.setDepthMode(a.DepthMode.disabled);const Hr=X.useProgram("clippingMask");for(const pi of f){const Vn=X._tileClippingMaskIDs[pi.key]=--T;Hr.draw(Ve,kt.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:kt.ALWAYS,mask:0},Vn,255,kt.KEEP,kt.KEEP,kt.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,H_(pi.projMatrix),"$clipping",X.tileExtentBuffer,X.quadTriangleIndexBuffer,X.tileExtentSegments)}}pointCoordinate(f){const T=this.painter.transform;if(f.x<0||f.x>T.width||f.y<0||f.y>T.height)return null;const X=[f.x,f.y,1,1];a.transformMat4$1(X,X,T.pixelMatrixInverse),a.scale$1(X,X,1/X[3]),X[0]/=T.worldSize,X[1]/=T.worldSize;const Ve=T._camera.position,kt=a.mercatorZfromAltitude(1,T.center.lat),Hr=[Ve[0],Ve[1],Ve[2]/kt,0],pi=a.subtract([],X.slice(0,3),Hr);a.normalize(pi,pi);const Vn=this.raycast(Hr,pi,this._exaggeration);return Vn!==null&&Vn?(a.scaleAndAdd(Hr,Hr,pi,Vn),Hr[3]=Hr[2],Hr[2]*=kt,Hr):null}drawDepth(){const f=this.painter,T=f.context,X=this.proxySourceCache,Ve=Math.ceil(f.width),kt=Math.ceil(f.height);if(!this._depthFBO||this._depthFBO.width===Ve&&this._depthFBO.height===kt||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const Hr=T.gl,pi=T.createFramebuffer(Ve,kt,!0);T.activeTexture.set(Hr.TEXTURE0);const Vn=new a.Texture(T,{width:Ve,height:kt,data:null},Hr.RGBA);Vn.bind(Hr.NEAREST,Hr.CLAMP_TO_EDGE),pi.colorAttachment.set(Vn.texture);const oa=T.createRenderbuffer(T.gl.DEPTH_COMPONENT16,Ve,kt);pi.depthAttachment.set(oa),this._depthFBO=pi,this._depthTexture=Vn}T.bindFramebuffer.set(this._depthFBO.framebuffer),T.viewport.set([0,0,Ve,kt]),function(Hr,pi,Vn,oa){if(Hr.transform.projection.name==="globe")return;const sa=Hr.context,dl=sa.gl;sa.clear({depth:1});const lh=Hr.useProgram("terrainDepth"),gh=new a.DepthMode(dl.LESS,a.DepthMode.ReadWrite,Hr.depthRangeFor3D);for(const _h of oa){const yh=Vn.getTile(_h),xh=Rv(_h.projMatrix,0);pi.setupElevationDraw(yh,lh),lh.draw(sa,dl.TRIANGLES,gh,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.backCCW,xh,"terrain_depth",pi.gridBuffer,pi.gridIndexBuffer,pi.gridNoSkirtSegments)}}(f,this,X,this.proxyCoords)}_setupProxiedCoordsForOrtho(f,T,X){if(f.getSource()instanceof Th)return this._setupProxiedCoordsForImageSource(f,T,X);this._findCoveringTileCache[f.id]=this._findCoveringTileCache[f.id]||{};const Ve=this.proxiedCoords[f.id]=[],kt=this.proxyCoords;for(let pi=0;pi<kt.length;pi++){const Vn=kt[pi],oa=this._findTileCoveringTileID(Vn,f);if(oa){const sa=this._createProxiedId(Vn,oa,X[Vn.key]&&X[Vn.key][f.id]);Ve.push(sa),this.proxyToSource[Vn.key][f.id]=[sa]}}let Hr=!1;for(let pi=0;pi<T.length;pi++){const Vn=f.getTile(T[pi]);if(!Vn||!Vn.hasData())continue;const oa=this._findTileCoveringTileID(Vn.tileID,this.proxySourceCache);if(oa&&oa.tileID.canonical.z!==Vn.tileID.canonical.z){const sa=this.proxyToSource[oa.tileID.key][f.id],dl=this._createProxiedId(oa.tileID,Vn,X[oa.tileID.key]&&X[oa.tileID.key][f.id]);sa?sa.splice(sa.length-1,0,dl):this.proxyToSource[oa.tileID.key][f.id]=[dl],Ve.push(dl),Hr=!0}}this._sourceTilesOverlap[f.id]=Hr}_setupProxiedCoordsForImageSource(f,T,X){if(!f.getSource().loaded())return;const Ve=this.proxiedCoords[f.id]=[],kt=this.proxyCoords,Hr=f.getSource(),pi=new a.Point(Hr.tileID.x,Hr.tileID.y)._div(1<<Hr.tileID.z),Vn=Hr.coordinates.map(a.MercatorCoordinate.fromLngLat).reduce((sa,dl)=>(sa.min.x=Math.min(sa.min.x,dl.x-pi.x),sa.min.y=Math.min(sa.min.y,dl.y-pi.y),sa.max.x=Math.max(sa.max.x,dl.x-pi.x),sa.max.y=Math.max(sa.max.y,dl.y-pi.y),sa),{min:new a.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),oa=(sa,dl)=>{const lh=sa.wrap+sa.canonical.x/(1<<sa.canonical.z),gh=sa.canonical.y/(1<<sa.canonical.z),_h=a.EXTENT/(1<<sa.canonical.z),yh=dl.wrap+dl.canonical.x/(1<<dl.canonical.z),xh=dl.canonical.y/(1<<dl.canonical.z);return lh+_h<yh+Vn.min.x||lh>yh+Vn.max.x||gh+_h<xh+Vn.min.y||gh>xh+Vn.max.y};for(let sa=0;sa<kt.length;sa++){const dl=kt[sa];for(let lh=0;lh<T.length;lh++){const gh=f.getTile(T[lh]);if(!gh||!gh.hasData()||oa(dl,gh.tileID))continue;const _h=this._createProxiedId(dl,gh,X[dl.key]&&X[dl.key][f.id]),yh=this.proxyToSource[dl.key][f.id];yh?yh.push(_h):this.proxyToSource[dl.key][f.id]=[_h],Ve.push(_h)}}}_createProxiedId(f,T,X){let Ve=this.orthoMatrix;if(X){const kt=X.find(Hr=>Hr.key===T.tileID.key);if(kt)return kt}if(T.tileID.key!==f.key){const kt=f.canonical.z-T.tileID.canonical.z;let Hr,pi,Vn;Ve=a.create();const oa=T.tileID.wrap-f.wrap<<f.overscaledZ;kt>0?(Hr=a.EXTENT>>kt,pi=Hr*((T.tileID.canonical.x<<kt)-f.canonical.x+oa),Vn=Hr*((T.tileID.canonical.y<<kt)-f.canonical.y)):(Hr=a.EXTENT<<-kt,pi=a.EXTENT*(T.tileID.canonical.x-(f.canonical.x+oa<<-kt)),Vn=a.EXTENT*(T.tileID.canonical.y-(f.canonical.y<<-kt))),a.ortho(Ve,0,Hr,0,Hr,0,1),a.translate(Ve,Ve,[pi,Vn,0])}return new rg(T.tileID,f.key,Ve)}_findTileCoveringTileID(f,T){let X=T.getTile(f);if(X&&X.hasData())return X;const Ve=this._findCoveringTileCache[T.id],kt=Ve[f.key];if(X=kt?T.getTileByID(kt):null,X&&X.hasData()||kt===null)return X;let Hr=X?X.tileID:f,pi=Hr.overscaledZ;const Vn=T.getSource().minzoom,oa=[];if(!kt){const dl=T.getSource().maxzoom;if(f.canonical.z>=dl){const lh=f.canonical.z-dl;T.getSource().reparseOverscaled?(pi=Math.max(f.canonical.z+2,T.transform.tileZoom),Hr=new a.OverscaledTileID(pi,f.wrap,dl,f.canonical.x>>lh,f.canonical.y>>lh)):lh!==0&&(pi=dl,Hr=new a.OverscaledTileID(pi,f.wrap,dl,f.canonical.x>>lh,f.canonical.y>>lh))}Hr.key!==f.key&&(oa.push(Hr.key),X=T.getTile(Hr))}const sa=dl=>{oa.forEach(lh=>{Ve[lh]=dl}),oa.length=0};for(pi-=1;pi>=Vn&&(!X||!X.hasData());pi--){X&&sa(X.tileID.key);const dl=Hr.calculateScaledKey(pi);if(X=T.getTileByID(dl),X&&X.hasData())break;const lh=Ve[dl];if(lh===null)break;lh===void 0?oa.push(dl):X=T.getTileByID(lh)}return sa(X?X.tileID.key:null),X&&X.hasData()?X:null}findDEMTileFor(f){return this.enabled?this._findTileCoveringTileID(f,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(f,T){let X=this._tilesDirty[f];X||(X=this._tilesDirty[f]={}),X[T.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const f=function(T){let X=0;const Ve=new a.StructArrayLayout2ui4,kt=131;for(let Hr=1;Hr<129;Hr++){for(let pi=1;pi<129;pi++)X=Hr*kt+pi,Ve.emplaceBack(X,X+1),Ve.emplaceBack(X,X+kt),Ve.emplaceBack(X+1,X+kt),Hr===128&&Ve.emplaceBack(X+kt,X+kt+1);Ve.emplaceBack(X+1,X+1+kt)}return Ve}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(f),this.wireframeSegments=a.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,f.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class jd{static cacheKey(f,T,X,Ve){let kt=`${T}${Ve?Ve.cacheKey:""}`;for(const Hr of X)f.usedDefines.includes(Hr)&&(kt+=`/${Hr}`);return kt}constructor(f,T,X,Ve,kt,Hr){const pi=f.gl;this.program=pi.createProgram();const Vn=function(yl){const mh=[];for(let bh=0;bh<yl.length;bh++){if(yl[bh]===null)continue;const Sh=yl[bh].split(" ");mh.push(Sh.pop())}return mh}(X.staticAttributes),oa=Ve?Ve.getBinderAttributes():[],sa=Vn.concat(oa);let dl=Ve?Ve.defines():[];dl=dl.concat(Hr.map(yl=>`#define ${yl}`));const lh=f.isWebGL2?`#version 300 es
`:"",gh=lh+dl.concat(f.extStandardDerivatives&&lh.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(G0):G0,G0,u0,j_.fragmentSource,f_.fragmentSource,X.fragmentSource).join(`
`),_h=lh+dl.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,u0,j_.vertexSource,f_.vertexSource,$_.vertexSource,X.vertexSource).join(`
`),yh=pi.createShader(pi.FRAGMENT_SHADER);if(pi.isContextLost())return void(this.failedToCreate=!0);pi.shaderSource(yh,gh),pi.compileShader(yh),pi.attachShader(this.program,yh);const xh=pi.createShader(pi.VERTEX_SHADER);if(pi.isContextLost())this.failedToCreate=!0;else{pi.shaderSource(xh,_h),pi.compileShader(xh),pi.attachShader(this.program,xh),this.attributes={},this.numAttributes=sa.length;for(let yl=0;yl<this.numAttributes;yl++)sa[yl]&&(pi.bindAttribLocation(this.program,yl,sa[yl]),this.attributes[sa[yl]]=yl);pi.linkProgram(this.program),pi.deleteShader(xh),pi.deleteShader(yh),this.fixedUniforms=kt(f),this.binderUniforms=Ve?Ve.getUniforms(f):[],Hr.includes("TERRAIN")&&(this.terrainUniforms=(yl=>({u_dem:new a.Uniform1i(yl),u_dem_prev:new a.Uniform1i(yl),u_dem_unpack:new a.Uniform4f(yl),u_dem_tl:new a.Uniform2f(yl),u_dem_scale:new a.Uniform1f(yl),u_dem_tl_prev:new a.Uniform2f(yl),u_dem_scale_prev:new a.Uniform1f(yl),u_dem_size:new a.Uniform1f(yl),u_dem_lerp:new a.Uniform1f(yl),u_exaggeration:new a.Uniform1f(yl),u_depth:new a.Uniform1i(yl),u_depth_size_inv:new a.Uniform2f(yl),u_meter_to_dem:new a.Uniform1f(yl),u_label_plane_matrix_inv:new a.UniformMatrix4f(yl)}))(f)),Hr.includes("GLOBE")&&(this.globeUniforms=(yl=>({u_tile_tl_up:new a.Uniform3f(yl),u_tile_tr_up:new a.Uniform3f(yl),u_tile_br_up:new a.Uniform3f(yl),u_tile_bl_up:new a.Uniform3f(yl),u_tile_up_scale:new a.Uniform1f(yl)}))(f)),Hr.includes("FOG")&&(this.fogUniforms=(yl=>({u_fog_matrix:new a.UniformMatrix4f(yl),u_fog_range:new a.Uniform2f(yl),u_fog_color:new a.Uniform4f(yl),u_fog_horizon_blend:new a.Uniform1f(yl),u_fog_temporal_offset:new a.Uniform1f(yl),u_frustum_tl:new a.Uniform3f(yl),u_frustum_tr:new a.Uniform3f(yl),u_frustum_br:new a.Uniform3f(yl),u_frustum_bl:new a.Uniform3f(yl),u_globe_pos:new a.Uniform3f(yl),u_globe_radius:new a.Uniform1f(yl),u_globe_transition:new a.Uniform1f(yl),u_is_globe:new a.Uniform1i(yl),u_viewport:new a.Uniform2f(yl)}))(f))}}setTerrainUniformValues(f,T){if(!this.terrainUniforms)return;const X=this.terrainUniforms;if(!this.failedToCreate){f.program.set(this.program);for(const Ve in T)X[Ve]&&X[Ve].set(this.program,Ve,T[Ve])}}setGlobeUniformValues(f,T){if(!this.globeUniforms)return;const X=this.globeUniforms;if(!this.failedToCreate){f.program.set(this.program);for(const Ve in T)X[Ve]&&X[Ve].set(this.program,Ve,T[Ve])}}setFogUniformValues(f,T){if(!this.fogUniforms)return;const X=this.fogUniforms;if(!this.failedToCreate){f.program.set(this.program);for(const Ve in T)X[Ve].set(this.program,Ve,T[Ve])}}draw(f,T,X,Ve,kt,Hr,pi,Vn,oa,sa,dl,lh,gh,_h,yh){const xh=f.gl;if(this.failedToCreate)return;f.program.set(this.program),f.setDepthMode(X),f.setStencilMode(Ve),f.setColorMode(kt),f.setCullFace(Hr);for(const mh of Object.keys(this.fixedUniforms))this.fixedUniforms[mh].set(this.program,mh,pi[mh]);_h&&_h.setUniforms(this.program,f,this.binderUniforms,lh,{zoom:gh});const yl={[xh.LINES]:2,[xh.TRIANGLES]:3,[xh.LINE_STRIP]:1}[T];for(const mh of dl.get()){const bh=mh.vaos||(mh.vaos={});(bh[Vn]||(bh[Vn]=new Tv)).bind(f,this,oa,_h?_h.getPaintVertexBuffers():[],sa,mh.vertexOffset,yh||[]),xh.drawElements(T,mh.primitiveLength*yl,xh.UNSIGNED_SHORT,mh.primitiveOffset*yl*2)}}}function _g(F,f){const T=Math.pow(2,f.tileID.overscaledZ),X=f.tileSize*Math.pow(2,F.transform.tileZoom)/T,Ve=X*(f.tileID.canonical.x+f.tileID.wrap*T),kt=X*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_tile_units_to_pixels:1/$p(f,1,F.transform.tileZoom),u_pixel_coord_upper:[Ve>>16,kt>>16],u_pixel_coord_lower:[65535&Ve,65535&kt]}}const W_=a.create(),V0=(F,f,T,X,Ve,kt,Hr,pi,Vn,oa,sa)=>{const dl=f.style.light,lh=dl.properties.get("position"),gh=[lh.x,lh.y,lh.z],_h=a.create$1();dl.properties.get("anchor")==="viewport"&&(a.fromRotation(_h,-f.transform.angle),a.transformMat3(gh,gh,_h));const yh=dl.properties.get("color"),xh=f.transform,yl={u_matrix:F,u_lightpos:gh,u_lightintensity:dl.properties.get("intensity"),u_lightcolor:[yh.r,yh.g,yh.b],u_vertical_gradient:+T,u_opacity:X,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:W_,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:Ve,u_edge_radius:kt};return xh.projection.name==="globe"&&(yl.u_tile_id=[Hr.canonical.x,Hr.canonical.y,1<<Hr.canonical.z],yl.u_zoom_transition=Vn,yl.u_inv_rot_matrix=sa,yl.u_merc_center=oa,yl.u_up_dir=xh.projection.upVector(new a.CanonicalTileID(0,0,0),oa[0]*a.EXTENT,oa[1]*a.EXTENT),yl.u_height_lift=pi),yl},$0=(F,f,T,X,Ve,kt,Hr,pi,Vn,oa,sa,dl)=>{const lh=V0(F,f,T,X,Ve,kt,Hr,Vn,oa,sa,dl),gh={u_height_factor:-Math.pow(2,Hr.overscaledZ)/pi.tileSize/8};return a.extend(lh,_g(f,pi),gh)},q_=F=>({u_matrix:F}),U0=(F,f,T)=>a.extend(q_(F),_g(f,T)),j0=(F,f)=>({u_matrix:F,u_world:f}),H0=(F,f,T,X)=>a.extend(U0(F,f,T),{u_world:X}),bx=a.create(),f0=(F,f,T,X,Ve,kt)=>{const Hr=F.transform,pi=Hr.projection.name==="globe";let Vn;if(kt.paint.get("circle-pitch-alignment")==="map")if(pi){const sa=a.globePixelsToTileUnits(Hr.zoom,f.canonical)*Hr._pixelsPerMercatorPixel;Vn=Float32Array.from([sa,0,0,sa])}else Vn=Hr.calculatePixelsToTileUnitsMatrix(T);else Vn=new Float32Array([Hr.pixelsToGLUnits[0],0,0,Hr.pixelsToGLUnits[1]]);const oa={u_camera_to_center_distance:Hr.cameraToCenterDistance,u_matrix:F.translatePosMatrix(f.projMatrix,T,kt.paint.get("circle-translate"),kt.paint.get("circle-translate-anchor")),u_device_pixel_ratio:a.exported.devicePixelRatio,u_extrude_scale:Vn,u_inv_rot_matrix:bx,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(pi){oa.u_inv_rot_matrix=X,oa.u_merc_center=Ve,oa.u_tile_id=[f.canonical.x,f.canonical.y,1<<f.canonical.z],oa.u_zoom_transition=a.globeToMercatorTransition(Hr.zoom);const sa=Ve[0]*a.EXTENT,dl=Ve[1]*a.EXTENT;oa.u_up_dir=Hr.projection.upVector(new a.CanonicalTileID(0,0,0),sa,dl)}return oa},K_=F=>{const f=[];return F.paint.get("circle-pitch-alignment")==="map"&&f.push("PITCH_WITH_MAP"),F.paint.get("circle-pitch-scale")==="map"&&f.push("SCALE_WITH_MAP"),f},Z_=(F,f,T,X)=>{const Ve=a.EXTENT/T.tileSize;return{u_matrix:F,u_camera_to_center_distance:f.getCameraToCenterDistance(X),u_extrude_scale:[f.pixelsToGLUnits[0]/Ve,f.pixelsToGLUnits[1]/Ve]}},W0=(F,f,T=1)=>({u_matrix:F,u_color:f,u_overlay:0,u_overlay_scale:T}),Cx=a.create(),Yg=(F,f,T,X,Ve,kt,Hr)=>{const pi=F.transform,Vn=pi.projection.name==="globe",oa=Vn?a.globePixelsToTileUnits(pi.zoom,f.canonical)*pi._pixelsPerMercatorPixel:$p(T,1,kt),sa={u_matrix:f.projMatrix,u_extrude_scale:oa,u_intensity:Hr,u_inv_rot_matrix:Cx,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(Vn){sa.u_inv_rot_matrix=X,sa.u_merc_center=Ve,sa.u_tile_id=[f.canonical.x,f.canonical.y,1<<f.canonical.z],sa.u_zoom_transition=a.globeToMercatorTransition(pi.zoom);const dl=Ve[0]*a.EXTENT,lh=Ve[1]*a.EXTENT;sa.u_up_dir=pi.projection.upVector(new a.CanonicalTileID(0,0,0),dl,lh)}return sa},X_=(F,f,T,X,Ve,kt,Hr)=>{const pi=F.transform,Vn=pi.calculatePixelsToTileUnitsMatrix(f);return{u_matrix:g0(F,f,T,X),u_pixels_to_tile_units:Vn,u_device_pixel_ratio:kt,u_units_to_pixels:[1/pi.pixelsToGLUnits[0],1/pi.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:Ve,u_texsize:Dv(T)?f.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Y_(f,F.transform),u_alpha_discard_threshold:0,u_trim_offset:Hr}},Nm=(F,f,T,X,Ve)=>{const kt=F.transform;return{u_matrix:g0(F,f,T,X),u_texsize:f.imageAtlasTexture.size,u_pixels_to_tile_units:kt.calculatePixelsToTileUnitsMatrix(f),u_device_pixel_ratio:Ve,u_image:0,u_tile_units_to_pixels:Y_(f,kt),u_units_to_pixels:[1/kt.pixelsToGLUnits[0],1/kt.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Y_(F,f){return 1/$p(F,1,f.tileZoom)}function g0(F,f,T,X){return F.translatePosMatrix(X||f.tileID.projMatrix,f,T.paint.get("line-translate"),T.paint.get("line-translate-anchor"))}function Dv(F){const f=F.paint.get("line-dasharray").value;return f.value||f.kind!=="constant"}const Qy=(F,f,T,X,Ve,kt)=>{return{u_matrix:F,u_tl_parent:f,u_scale_parent:T,u_fade_t:X.mix,u_opacity:X.opacity*Ve.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:Ve.paint.get("raster-brightness-min"),u_brightness_high:Ve.paint.get("raster-brightness-max"),u_saturation_factor:(pi=Ve.paint.get("raster-saturation"),pi>0?1-1/(1.001-pi):-pi),u_contrast_factor:(Hr=Ve.paint.get("raster-contrast"),Hr>0?1/(1-Hr):1+Hr),u_spin_weights:Zm(Ve.paint.get("raster-hue-rotate")),u_perspective_transform:kt};var Hr,pi};function Zm(F){F*=Math.PI/180;const f=Math.sin(F),T=Math.cos(F);return[(2*T+1)/3,(-Math.sqrt(3)*f-T+1)/3,(Math.sqrt(3)*f-T+1)/3]}const e_=a.create(),q0=(F,f,T,X,Ve,kt,Hr,pi,Vn,oa,sa,dl,lh,gh,_h,yh)=>{const xh=Ve.transform,yl={u_is_size_zoom_constant:+(F==="constant"||F==="source"),u_is_size_feature_constant:+(F==="constant"||F==="camera"),u_size_t:f?f.uSizeT:0,u_size:f?f.uSize:0,u_camera_to_center_distance:xh.cameraToCenterDistance,u_rotate_symbol:+T,u_aspect_ratio:xh.width/xh.height,u_fade_change:Ve.options.fadeDuration?Ve.symbolFadeChange:1,u_matrix:kt,u_label_plane_matrix:Hr,u_coord_matrix:pi,u_is_text:+Vn,u_pitch_with_map:+X,u_texsize:oa,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:e_,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:e_,u_up_vector:[0,-1,0]};return yh.name==="globe"&&(yl.u_tile_id=[sa.canonical.x,sa.canonical.y,1<<sa.canonical.z],yl.u_zoom_transition=dl,yl.u_inv_rot_matrix=gh,yl.u_merc_center=lh,yl.u_camera_forward=xh._camera.forward(),yl.u_ecef_origin=a.globeECEFOrigin(xh.globeMatrix,sa.toUnwrapped()),yl.u_tile_matrix=Float32Array.from(xh.globeMatrix),yl.u_up_vector=_h),yl},Ov=(F,f,T,X,Ve,kt,Hr,pi,Vn,oa,sa,dl,lh,gh,_h,yh,xh)=>a.extend(q0(F,f,T,X,Ve,kt,Hr,pi,Vn,oa,dl,lh,gh,_h,yh,xh),{u_gamma_scale:X?Ve.transform.cameraToCenterDistance*Math.cos(Ve.terrain?0:Ve.transform._pitch):1,u_device_pixel_ratio:a.exported.devicePixelRatio,u_is_halo:+sa}),K0=(F,f,T,X,Ve,kt,Hr,pi,Vn,oa,sa,dl,lh,gh,_h,yh)=>a.extend(Ov(F,f,T,X,Ve,kt,Hr,pi,!0,Vn,!0,sa,dl,lh,gh,_h,yh),{u_texsize_icon:oa,u_texture_icon:1}),Z0=(F,f,T)=>({u_matrix:F,u_opacity:f,u_color:T}),X0=(F,f,T,X,Ve)=>a.extend(function(kt,Hr,pi){const Vn=Hr.imageManager.getPattern(kt.toString()),{width:oa,height:sa}=Hr.imageManager.getPixelSize(),dl=Math.pow(2,pi.tileID.overscaledZ),lh=pi.tileSize*Math.pow(2,Hr.transform.tileZoom)/dl,gh=lh*(pi.tileID.canonical.x+pi.tileID.wrap*dl),_h=lh*pi.tileID.canonical.y;return{u_image:0,u_pattern_tl:Vn.tl,u_pattern_br:Vn.br,u_texsize:[oa,sa],u_pattern_size:Vn.displaySize,u_tile_units_to_pixels:1/$p(pi,1,Hr.transform.tileZoom),u_pixel_coord_upper:[gh>>16,_h>>16],u_pixel_coord_lower:[65535&gh,65535&_h]}}(X,T,Ve),{u_matrix:F,u_opacity:f}),vy={fillExtrusion:F=>({u_matrix:new a.UniformMatrix4f(F),u_lightpos:new a.Uniform3f(F),u_lightintensity:new a.Uniform1f(F),u_lightcolor:new a.Uniform3f(F),u_vertical_gradient:new a.Uniform1f(F),u_opacity:new a.Uniform1f(F),u_edge_radius:new a.Uniform1f(F),u_ao:new a.Uniform2f(F),u_tile_id:new a.Uniform3f(F),u_zoom_transition:new a.Uniform1f(F),u_inv_rot_matrix:new a.UniformMatrix4f(F),u_merc_center:new a.Uniform2f(F),u_up_dir:new a.Uniform3f(F),u_height_lift:new a.Uniform1f(F)}),fillExtrusionPattern:F=>({u_matrix:new a.UniformMatrix4f(F),u_lightpos:new a.Uniform3f(F),u_lightintensity:new a.Uniform1f(F),u_lightcolor:new a.Uniform3f(F),u_vertical_gradient:new a.Uniform1f(F),u_height_factor:new a.Uniform1f(F),u_edge_radius:new a.Uniform1f(F),u_ao:new a.Uniform2f(F),u_tile_id:new a.Uniform3f(F),u_zoom_transition:new a.Uniform1f(F),u_inv_rot_matrix:new a.UniformMatrix4f(F),u_merc_center:new a.Uniform2f(F),u_up_dir:new a.Uniform3f(F),u_height_lift:new a.Uniform1f(F),u_image:new a.Uniform1i(F),u_texsize:new a.Uniform2f(F),u_pixel_coord_upper:new a.Uniform2f(F),u_pixel_coord_lower:new a.Uniform2f(F),u_tile_units_to_pixels:new a.Uniform1f(F),u_opacity:new a.Uniform1f(F)}),fill:F=>({u_matrix:new a.UniformMatrix4f(F)}),fillPattern:F=>({u_matrix:new a.UniformMatrix4f(F),u_image:new a.Uniform1i(F),u_texsize:new a.Uniform2f(F),u_pixel_coord_upper:new a.Uniform2f(F),u_pixel_coord_lower:new a.Uniform2f(F),u_tile_units_to_pixels:new a.Uniform1f(F)}),fillOutline:F=>({u_matrix:new a.UniformMatrix4f(F),u_world:new a.Uniform2f(F)}),fillOutlinePattern:F=>({u_matrix:new a.UniformMatrix4f(F),u_world:new a.Uniform2f(F),u_image:new a.Uniform1i(F),u_texsize:new a.Uniform2f(F),u_pixel_coord_upper:new a.Uniform2f(F),u_pixel_coord_lower:new a.Uniform2f(F),u_tile_units_to_pixels:new a.Uniform1f(F)}),circle:F=>({u_camera_to_center_distance:new a.Uniform1f(F),u_extrude_scale:new a.UniformMatrix2f(F),u_device_pixel_ratio:new a.Uniform1f(F),u_matrix:new a.UniformMatrix4f(F),u_inv_rot_matrix:new a.UniformMatrix4f(F),u_merc_center:new a.Uniform2f(F),u_tile_id:new a.Uniform3f(F),u_zoom_transition:new a.Uniform1f(F),u_up_dir:new a.Uniform3f(F)}),collisionBox:F=>({u_matrix:new a.UniformMatrix4f(F),u_camera_to_center_distance:new a.Uniform1f(F),u_extrude_scale:new a.Uniform2f(F)}),collisionCircle:F=>({u_matrix:new a.UniformMatrix4f(F),u_inv_matrix:new a.UniformMatrix4f(F),u_camera_to_center_distance:new a.Uniform1f(F),u_viewport_size:new a.Uniform2f(F)}),debug:F=>({u_color:new a.UniformColor(F),u_matrix:new a.UniformMatrix4f(F),u_overlay:new a.Uniform1i(F),u_overlay_scale:new a.Uniform1f(F)}),clippingMask:F=>({u_matrix:new a.UniformMatrix4f(F)}),heatmap:F=>({u_extrude_scale:new a.Uniform1f(F),u_intensity:new a.Uniform1f(F),u_matrix:new a.UniformMatrix4f(F),u_inv_rot_matrix:new a.UniformMatrix4f(F),u_merc_center:new a.Uniform2f(F),u_tile_id:new a.Uniform3f(F),u_zoom_transition:new a.Uniform1f(F),u_up_dir:new a.Uniform3f(F)}),heatmapTexture:F=>({u_image:new a.Uniform1i(F),u_color_ramp:new a.Uniform1i(F),u_opacity:new a.Uniform1f(F)}),hillshade:F=>({u_matrix:new a.UniformMatrix4f(F),u_image:new a.Uniform1i(F),u_latrange:new a.Uniform2f(F),u_light:new a.Uniform2f(F),u_shadow:new a.UniformColor(F),u_highlight:new a.UniformColor(F),u_accent:new a.UniformColor(F)}),hillshadePrepare:F=>({u_matrix:new a.UniformMatrix4f(F),u_image:new a.Uniform1i(F),u_dimension:new a.Uniform2f(F),u_zoom:new a.Uniform1f(F),u_unpack:new a.Uniform4f(F)}),line:F=>({u_matrix:new a.UniformMatrix4f(F),u_pixels_to_tile_units:new a.UniformMatrix2f(F),u_device_pixel_ratio:new a.Uniform1f(F),u_units_to_pixels:new a.Uniform2f(F),u_dash_image:new a.Uniform1i(F),u_gradient_image:new a.Uniform1i(F),u_image_height:new a.Uniform1f(F),u_texsize:new a.Uniform2f(F),u_tile_units_to_pixels:new a.Uniform1f(F),u_alpha_discard_threshold:new a.Uniform1f(F),u_trim_offset:new a.Uniform2f(F)}),linePattern:F=>({u_matrix:new a.UniformMatrix4f(F),u_texsize:new a.Uniform2f(F),u_pixels_to_tile_units:new a.UniformMatrix2f(F),u_device_pixel_ratio:new a.Uniform1f(F),u_image:new a.Uniform1i(F),u_units_to_pixels:new a.Uniform2f(F),u_tile_units_to_pixels:new a.Uniform1f(F),u_alpha_discard_threshold:new a.Uniform1f(F)}),raster:F=>({u_matrix:new a.UniformMatrix4f(F),u_tl_parent:new a.Uniform2f(F),u_scale_parent:new a.Uniform1f(F),u_fade_t:new a.Uniform1f(F),u_opacity:new a.Uniform1f(F),u_image0:new a.Uniform1i(F),u_image1:new a.Uniform1i(F),u_brightness_low:new a.Uniform1f(F),u_brightness_high:new a.Uniform1f(F),u_saturation_factor:new a.Uniform1f(F),u_contrast_factor:new a.Uniform1f(F),u_spin_weights:new a.Uniform3f(F),u_perspective_transform:new a.Uniform2f(F)}),symbolIcon:F=>({u_is_size_zoom_constant:new a.Uniform1i(F),u_is_size_feature_constant:new a.Uniform1i(F),u_size_t:new a.Uniform1f(F),u_size:new a.Uniform1f(F),u_camera_to_center_distance:new a.Uniform1f(F),u_rotate_symbol:new a.Uniform1i(F),u_aspect_ratio:new a.Uniform1f(F),u_fade_change:new a.Uniform1f(F),u_matrix:new a.UniformMatrix4f(F),u_label_plane_matrix:new a.UniformMatrix4f(F),u_coord_matrix:new a.UniformMatrix4f(F),u_is_text:new a.Uniform1i(F),u_pitch_with_map:new a.Uniform1i(F),u_texsize:new a.Uniform2f(F),u_tile_id:new a.Uniform3f(F),u_zoom_transition:new a.Uniform1f(F),u_inv_rot_matrix:new a.UniformMatrix4f(F),u_merc_center:new a.Uniform2f(F),u_camera_forward:new a.Uniform3f(F),u_tile_matrix:new a.UniformMatrix4f(F),u_up_vector:new a.Uniform3f(F),u_ecef_origin:new a.Uniform3f(F),u_texture:new a.Uniform1i(F)}),symbolSDF:F=>({u_is_size_zoom_constant:new a.Uniform1i(F),u_is_size_feature_constant:new a.Uniform1i(F),u_size_t:new a.Uniform1f(F),u_size:new a.Uniform1f(F),u_camera_to_center_distance:new a.Uniform1f(F),u_rotate_symbol:new a.Uniform1i(F),u_aspect_ratio:new a.Uniform1f(F),u_fade_change:new a.Uniform1f(F),u_matrix:new a.UniformMatrix4f(F),u_label_plane_matrix:new a.UniformMatrix4f(F),u_coord_matrix:new a.UniformMatrix4f(F),u_is_text:new a.Uniform1i(F),u_pitch_with_map:new a.Uniform1i(F),u_texsize:new a.Uniform2f(F),u_texture:new a.Uniform1i(F),u_gamma_scale:new a.Uniform1f(F),u_device_pixel_ratio:new a.Uniform1f(F),u_tile_id:new a.Uniform3f(F),u_zoom_transition:new a.Uniform1f(F),u_inv_rot_matrix:new a.UniformMatrix4f(F),u_merc_center:new a.Uniform2f(F),u_camera_forward:new a.Uniform3f(F),u_tile_matrix:new a.UniformMatrix4f(F),u_up_vector:new a.Uniform3f(F),u_ecef_origin:new a.Uniform3f(F),u_is_halo:new a.Uniform1i(F)}),symbolTextAndIcon:F=>({u_is_size_zoom_constant:new a.Uniform1i(F),u_is_size_feature_constant:new a.Uniform1i(F),u_size_t:new a.Uniform1f(F),u_size:new a.Uniform1f(F),u_camera_to_center_distance:new a.Uniform1f(F),u_rotate_symbol:new a.Uniform1i(F),u_aspect_ratio:new a.Uniform1f(F),u_fade_change:new a.Uniform1f(F),u_matrix:new a.UniformMatrix4f(F),u_label_plane_matrix:new a.UniformMatrix4f(F),u_coord_matrix:new a.UniformMatrix4f(F),u_is_text:new a.Uniform1i(F),u_pitch_with_map:new a.Uniform1i(F),u_texsize:new a.Uniform2f(F),u_texsize_icon:new a.Uniform2f(F),u_texture:new a.Uniform1i(F),u_texture_icon:new a.Uniform1i(F),u_gamma_scale:new a.Uniform1f(F),u_device_pixel_ratio:new a.Uniform1f(F),u_is_halo:new a.Uniform1i(F)}),background:F=>({u_matrix:new a.UniformMatrix4f(F),u_opacity:new a.Uniform1f(F),u_color:new a.UniformColor(F)}),backgroundPattern:F=>({u_matrix:new a.UniformMatrix4f(F),u_opacity:new a.Uniform1f(F),u_image:new a.Uniform1i(F),u_pattern_tl:new a.Uniform2f(F),u_pattern_br:new a.Uniform2f(F),u_texsize:new a.Uniform2f(F),u_pattern_size:new a.Uniform2f(F),u_pixel_coord_upper:new a.Uniform2f(F),u_pixel_coord_lower:new a.Uniform2f(F),u_tile_units_to_pixels:new a.Uniform1f(F)}),terrainRaster:Av,terrainDepth:Av,skybox:F=>({u_matrix:new a.UniformMatrix4f(F),u_sun_direction:new a.Uniform3f(F),u_cubemap:new a.Uniform1i(F),u_opacity:new a.Uniform1f(F),u_temporal_offset:new a.Uniform1f(F)}),skyboxGradient:F=>({u_matrix:new a.UniformMatrix4f(F),u_color_ramp:new a.Uniform1i(F),u_center_direction:new a.Uniform3f(F),u_radius:new a.Uniform1f(F),u_opacity:new a.Uniform1f(F),u_temporal_offset:new a.Uniform1f(F)}),skyboxCapture:F=>({u_matrix_3f:new a.UniformMatrix3f(F),u_sun_direction:new a.Uniform3f(F),u_sun_intensity:new a.Uniform1f(F),u_color_tint_r:new a.Uniform4f(F),u_color_tint_m:new a.Uniform4f(F),u_luminance:new a.Uniform1f(F)}),globeRaster:F=>({u_proj_matrix:new a.UniformMatrix4f(F),u_globe_matrix:new a.UniformMatrix4f(F),u_normalize_matrix:new a.UniformMatrix4f(F),u_merc_matrix:new a.UniformMatrix4f(F),u_zoom_transition:new a.Uniform1f(F),u_merc_center:new a.Uniform2f(F),u_image0:new a.Uniform1i(F),u_grid_matrix:new a.UniformMatrix3f(F),u_skirt_height:new a.Uniform1f(F),u_frustum_tl:new a.Uniform3f(F),u_frustum_tr:new a.Uniform3f(F),u_frustum_br:new a.Uniform3f(F),u_frustum_bl:new a.Uniform3f(F),u_globe_pos:new a.Uniform3f(F),u_globe_radius:new a.Uniform1f(F),u_viewport:new a.Uniform2f(F)}),globeAtmosphere:F=>({u_frustum_tl:new a.Uniform3f(F),u_frustum_tr:new a.Uniform3f(F),u_frustum_br:new a.Uniform3f(F),u_frustum_bl:new a.Uniform3f(F),u_horizon:new a.Uniform1f(F),u_transition:new a.Uniform1f(F),u_fadeout_range:new a.Uniform1f(F),u_color:new a.Uniform4f(F),u_high_color:new a.Uniform4f(F),u_space_color:new a.Uniform4f(F),u_star_intensity:new a.Uniform1f(F),u_star_density:new a.Uniform1f(F),u_star_size:new a.Uniform1f(F),u_temporal_offset:new a.Uniform1f(F),u_horizon_angle:new a.Uniform1f(F),u_rotation_matrix:new a.UniformMatrix4f(F)})};let J_;function m_(F,f,T,X,Ve,kt,Hr){const pi=F.context,Vn=pi.gl,oa=F.transform,sa=F.useProgram("collisionBox"),dl=[];let lh=0,gh=0;for(let Sh=0;Sh<X.length;Sh++){const Nh=X[Sh],$h=f.getTile(Nh),Vh=$h.getBucket(T);if(!Vh)continue;const Wh=ay(Nh,Vh,oa);let Zh=Wh;Ve[0]===0&&Ve[1]===0||(Zh=F.translatePosMatrix(Wh,$h,Ve,kt));const rp=Hr?Vh.textCollisionBox:Vh.iconCollisionBox,Bp=Vh.collisionCircleArray;if(Bp.length>0){const tp=a.create(),Tp=Zh;a.mul(tp,Vh.placementInvProjMatrix,oa.glCoordMatrix),a.mul(tp,tp,Vh.placementViewportMatrix),dl.push({circleArray:Bp,circleOffset:gh,transform:Tp,invTransform:tp,projection:Vh.getProjection()}),lh+=Bp.length/4,gh=lh}rp&&(F.terrain&&F.terrain.setupElevationDraw($h,sa),sa.draw(pi,Vn.LINES,a.DepthMode.disabled,a.StencilMode.disabled,F.colorModeForRenderPass(),a.CullFaceMode.disabled,Z_(Zh,oa,$h,Vh.getProjection()),T.id,rp.layoutVertexBuffer,rp.indexBuffer,rp.segments,null,oa.zoom,null,[rp.collisionVertexBuffer,rp.collisionVertexBufferExt]))}if(!Hr||!dl.length)return;const _h=F.useProgram("collisionCircle"),yh=new a.StructArrayLayout2f1f2i16;yh.resize(4*lh),yh._trim();let xh=0;for(const Sh of dl)for(let Nh=0;Nh<Sh.circleArray.length/4;Nh++){const $h=4*Nh,Vh=Sh.circleArray[$h+0],Wh=Sh.circleArray[$h+1],Zh=Sh.circleArray[$h+2],rp=Sh.circleArray[$h+3];yh.emplace(xh++,Vh,Wh,Zh,rp,0),yh.emplace(xh++,Vh,Wh,Zh,rp,1),yh.emplace(xh++,Vh,Wh,Zh,rp,2),yh.emplace(xh++,Vh,Wh,Zh,rp,3)}(!J_||J_.length<2*lh)&&(J_=function(Sh){const Nh=2*Sh,$h=new a.StructArrayLayout3ui6;$h.resize(Nh),$h._trim();for(let Vh=0;Vh<Nh;Vh++){const Wh=6*Vh;$h.uint16[Wh+0]=4*Vh+0,$h.uint16[Wh+1]=4*Vh+1,$h.uint16[Wh+2]=4*Vh+2,$h.uint16[Wh+3]=4*Vh+2,$h.uint16[Wh+4]=4*Vh+3,$h.uint16[Wh+5]=4*Vh+0}return $h}(lh));const yl=pi.createIndexBuffer(J_,!0),mh=pi.createVertexBuffer(yh,a.collisionCircleLayout.members,!0);for(const Sh of dl){const Nh={u_matrix:Sh.transform,u_inv_matrix:Sh.invTransform,u_camera_to_center_distance:(bh=oa).getCameraToCenterDistance(Sh.projection),u_viewport_size:[bh.width,bh.height]};_h.draw(pi,Vn.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,F.colorModeForRenderPass(),a.CullFaceMode.disabled,Nh,T.id,mh,yl,a.SegmentVector.simpleSegment(0,2*Sh.circleOffset,Sh.circleArray.length,Sh.circleArray.length/2),null,oa.zoom)}var bh;mh.destroy(),yl.destroy()}const Ex=a.create();function Q_({width:F,height:f,anchor:T,textOffset:X,textScale:Ve},kt){const{horizontalAlign:Hr,verticalAlign:pi}=a.getAnchorAlignment(T),Vn=-(Hr-.5)*F,oa=-(pi-.5)*f,sa=a.evaluateVariableOffset(T,X);return new a.Point((Vn/Ve+sa[0])*kt,(oa/Ve+sa[1])*kt)}function $x(F,f,T,X,Ve,kt,Hr,pi,Vn,oa,sa){const dl=F.text.placedSymbolArray,lh=F.text.dynamicLayoutVertexArray,gh=F.icon.dynamicLayoutVertexArray,_h={},yh=F.getProjection(),xh=Og(pi,yh,kt),yl=kt.elevation,mh=yh.upVectorScale(pi.canonical,kt.center.lat,kt.worldSize).metersToTile;lh.clear();for(let bh=0;bh<dl.length;bh++){const Sh=dl.get(bh),{tileAnchorX:Nh,tileAnchorY:$h,numGlyphs:Vh}=Sh,Wh=Sh.hidden||!Sh.crossTileID||F.allowVerticalPlacement&&!Sh.placedOrientation?null:X[Sh.crossTileID];if(Wh){let Zh=0,rp=0,Bp=0;if(yl){const Up=yl?yl.getAtTileOffset(pi,Nh,$h):0,[zd,jf,Pd]=yh.upVector(pi.canonical,Nh,$h);Zh=Up*zd*mh,rp=Up*jf*mh,Bp=Up*Pd*mh}let[tp,Tp,pp,bp]=hm(Sh.projectedAnchorX+Zh,Sh.projectedAnchorY+rp,Sh.projectedAnchorZ+Bp,T?xh:Hr);const np=xm(kt.getCameraToCenterDistance(yh),bp);let wp=Ve.evaluateSizeForFeature(F.textSizeData,oa,Sh)*np/a.ONE_EM;T&&(wp*=F.tilePixelRatio/Vn);const Fp=Q_(Wh,wp);T?({x:tp,y:Tp,z:pp}=yh.projectTilePoint(Nh+Fp.x,$h+Fp.y,pi.canonical),[tp,Tp,pp]=hm(tp+Zh,Tp+rp,pp+Bp,Hr)):(f&&Fp._rotate(-kt.angle),tp+=Fp.x,Tp+=Fp.y,pp=0);const Pp=F.allowVerticalPlacement&&Sh.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let Up=0;Up<Vh;Up++)a.addDynamicAttributes(lh,tp,Tp,pp,Pp);sa&&Sh.associatedIconIndex>=0&&(_h[Sh.associatedIconIndex]={x:tp,y:Tp,z:pp,angle:Pp})}else yy(Vh,lh)}if(sa){gh.clear();const bh=F.icon.placedSymbolArray;for(let Sh=0;Sh<bh.length;Sh++){const Nh=bh.get(Sh),{numGlyphs:$h}=Nh,Vh=_h[Sh];if(Nh.hidden||!Vh)yy($h,gh);else{const{x:Wh,y:Zh,z:rp,angle:Bp}=Vh;for(let tp=0;tp<$h;tp++)a.addDynamicAttributes(gh,Wh,Zh,rp,Bp)}}F.icon.dynamicLayoutVertexBuffer.updateData(gh)}F.text.dynamicLayoutVertexBuffer.updateData(lh)}function Y0(F,f,T){return T.iconsInText&&f?"symbolTextAndIcon":F?"symbolSDF":"symbolIcon"}function Lv(F,f,T,X,Ve,kt,Hr,pi,Vn,oa,sa,dl){const lh=F.context,gh=lh.gl,_h=F.transform,yh=pi==="map",xh=Vn==="map",yl=yh&&T.layout.get("symbol-placement")!=="point",mh=yh&&!xh&&!yl,bh=T.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Sh=!1;const Nh=F.depthModeForSublayer(0,a.DepthMode.ReadOnly),$h=[a.mercatorXfromLng(_h.center.lng),a.mercatorYfromLat(_h.center.lat)],Vh=T.layout.get("text-variable-anchor"),Wh=_h.projection.name==="globe",Zh=[],rp=[0,-1,0];let Bp=rp;!Wh&&!_h.mercatorFromTransition||yh||(Bp=function(tp){const Tp=tp._camera.getWorldToCamera(tp.worldSize,1),pp=a.multiply([],Tp,tp.globeMatrix);a.invert(pp,pp);const bp=[0,0,0],np=[0,1,0,0];return a.transformMat4$1(np,np,pp),bp[0]=np[0],bp[1]=np[1],bp[2]=np[2],a.normalize(bp,bp),bp}(_h));for(const tp of X){const Tp=f.getTile(tp),pp=Tp.getBucket(T);if(!pp||pp.projection.name==="mercator"&&Wh)continue;const bp=Ve?pp.text:pp.icon;if(!bp||pp.fullyClipped||!bp.segments.get().length)continue;const np=bp.programConfigurations.get(T.id),wp=Ve||pp.sdfIcons,Fp=Ve?pp.textSizeData:pp.iconSizeData,Pp=xh||_h.pitch!==0,Up=a.evaluateSizeForZoom(Fp,_h.zoom);let zd,jf,Pd,Zd,ig=[0,0],Jf=null;if(Ve)jf=Tp.glyphAtlasTexture,Pd=gh.LINEAR,zd=Tp.glyphAtlasTexture.size,pp.iconsInText&&(ig=Tp.imageAtlasTexture.size,Jf=Tp.imageAtlasTexture,Zd=Pp||F.options.rotating||F.options.zooming||Fp.kind==="composite"||Fp.kind==="camera"?gh.LINEAR:gh.NEAREST);else{const S_=T.layout.get("icon-size").constantOr(0)!==1||pp.iconsNeedLinear;jf=Tp.imageAtlasTexture,Pd=wp||F.options.rotating||F.options.zooming||S_||Pp?gh.LINEAR:gh.NEAREST,zd=Tp.imageAtlasTexture.size}const Bd=pp.projection.name==="globe",fg=Bd?Bp:rp,Sg=Bd?a.globeToMercatorTransition(_h.zoom):0,Tg=Og(tp,pp.getProjection(),_h),gg=_h.calculatePixelsToTileUnitsMatrix(Tp),Jm=hp(Tg,Tp.tileID.canonical,xh,yh,_h,pp.getProjection(),gg),om=F.terrain&&xh&&yl?a.invert(a.create(),Jm):Ex,uy=xg(Tg,Tp.tileID.canonical,xh,yh,_h,pp.getProjection(),gg),Iy=Vh&&pp.hasTextData(),$g=T.layout.get("icon-text-fit")!=="none"&&Iy&&pp.hasIconData();if(yl){const S_=_h.elevation,uv=S_?S_.getAtTileOffsetFunc(tp,_h.center.lat,_h.worldSize,pp.getProjection()):null,Xv=gy(Tg,Tp.tileID.canonical,xh,yh,_h,pp.getProjection(),gg);wv(pp,Tg,F,Ve,Xv,uy,xh,oa,uv,tp)}const Ag=yl||Ve&&Vh||$g,mg=F.translatePosMatrix(Tg,Tp,kt,Hr),dg=Ag?Ex:Jm,wm=F.translatePosMatrix(uy,Tp,kt,Hr,!0),Mg=pp.getProjection().createInversionMatrix(_h,tp.canonical),cy=[];F.terrainRenderModeElevated()&&xh&&cy.push("PITCH_WITH_MAP_TERRAIN"),Bd&&cy.push("PROJECTION_GLOBE_VIEW"),Ag&&cy.push("PROJECTED_POS_ON_VIEWPORT");const Kv=wp&&T.paint.get(Ve?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let b0;b0=wp?pp.iconsInText?K0(Fp.kind,Up,mh,xh,F,mg,dg,wm,zd,ig,tp,Sg,$h,Mg,fg,pp.getProjection()):Ov(Fp.kind,Up,mh,xh,F,mg,dg,wm,Ve,zd,!0,tp,Sg,$h,Mg,fg,pp.getProjection()):q0(Fp.kind,Up,mh,xh,F,mg,dg,wm,Ve,zd,tp,Sg,$h,Mg,fg,pp.getProjection());const Zv={program:F.useProgram(Y0(wp,Ve,pp),np,cy),buffers:bp,uniformValues:b0,atlasTexture:jf,atlasTextureIcon:Jf,atlasInterpolation:Pd,atlasInterpolationIcon:Zd,isSDF:wp,hasHalo:Kv,tile:Tp,labelPlaneMatrixInv:om};if(bh&&pp.canOverlap){Sh=!0;const S_=bp.segments.get();for(const uv of S_)Zh.push({segments:new a.SegmentVector([uv]),sortKey:uv.sortKey,state:Zv})}else Zh.push({segments:bp.segments,sortKey:0,state:Zv})}Sh&&Zh.sort((tp,Tp)=>tp.sortKey-Tp.sortKey);for(const tp of Zh){const Tp=tp.state;if(F.terrain&&F.terrain.setupElevationDraw(Tp.tile,Tp.program,{useDepthForOcclusion:!Wh,labelPlaneMatrixInv:Tp.labelPlaneMatrixInv}),lh.activeTexture.set(gh.TEXTURE0),Tp.atlasTexture.bind(Tp.atlasInterpolation,gh.CLAMP_TO_EDGE),Tp.atlasTextureIcon&&(lh.activeTexture.set(gh.TEXTURE1),Tp.atlasTextureIcon&&Tp.atlasTextureIcon.bind(Tp.atlasInterpolationIcon,gh.CLAMP_TO_EDGE)),Tp.isSDF){const pp=Tp.uniformValues;Tp.hasHalo&&(pp.u_is_halo=1,Fv(Tp.buffers,tp.segments,T,F,Tp.program,Nh,sa,dl,pp)),pp.u_is_halo=0}Fv(Tp.buffers,tp.segments,T,F,Tp.program,Nh,sa,dl,Tp.uniformValues)}}function Fv(F,f,T,X,Ve,kt,Hr,pi,Vn){const oa=X.context,sa=[F.dynamicLayoutVertexBuffer,F.opacityVertexBuffer,F.globeExtVertexBuffer];Ve.draw(oa,oa.gl.TRIANGLES,kt,Hr,pi,a.CullFaceMode.disabled,Vn,T.id,F.layoutVertexBuffer,F.indexBuffer,f,T.paint,X.transform.zoom,F.programConfigurations.get(T.id),sa)}function Ry(F,f,T,X,Ve,kt,Hr){const pi=F.context.gl,Vn=T.paint.get("fill-pattern"),oa=Vn&&Vn.constantOr(1);let sa,dl,lh,gh,_h;Hr?(dl=oa&&!T.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",sa=pi.LINES):(dl=oa?"fillPattern":"fill",sa=pi.TRIANGLES);for(const yh of X){const xh=f.getTile(yh);if(oa&&!xh.patternsLoaded())continue;const yl=xh.getBucket(T);if(!yl)continue;F.prepareDrawTile();const mh=yl.programConfigurations.get(T.id),bh=F.useProgram(dl,mh);oa&&(F.context.activeTexture.set(pi.TEXTURE0),xh.imageAtlasTexture.bind(pi.LINEAR,pi.CLAMP_TO_EDGE),mh.updatePaintBuffers());const Sh=Vn.constantOr(null);if(Sh&&xh.imageAtlas){const $h=xh.imageAtlas.patternPositions[Sh.toString()];$h&&mh.setConstantPatternPositions($h)}const Nh=F.translatePosMatrix(yh.projMatrix,xh,T.paint.get("fill-translate"),T.paint.get("fill-translate-anchor"));if(Hr){gh=yl.indexBuffer2,_h=yl.segments2;const $h=F.terrain&&F.terrain.renderingToTexture?F.terrain.drapeBufferSize:[pi.drawingBufferWidth,pi.drawingBufferHeight];lh=dl==="fillOutlinePattern"&&oa?H0(Nh,F,xh,$h):j0(Nh,$h)}else gh=yl.indexBuffer,_h=yl.segments,lh=oa?U0(Nh,F,xh):q_(Nh);F.prepareDrawProgram(F.context,bh,yh.toUnwrapped()),bh.draw(F.context,sa,Ve,F.stencilModeForClipping(yh),kt,a.CullFaceMode.disabled,lh,T.id,yl.layoutVertexBuffer,gh,_h,T.paint,F.transform.zoom,mh)}}function $m(F,f,T,X,Ve,kt,Hr){const pi=F.context,Vn=pi.gl,oa=F.transform,sa=T.paint.get("fill-extrusion-pattern"),dl=sa.constantOr(1),lh=T.paint.get("fill-extrusion-opacity"),gh=[T.paint.get("fill-extrusion-ambient-occlusion-intensity"),T.paint.get("fill-extrusion-ambient-occlusion-radius")],_h=T.layout.get("fill-extrusion-edge-radius"),yh=_h>0&&!T.paint.get("fill-extrusion-rounded-roof"),xh=yh?0:_h,yl=oa.projection.name==="globe"?a.fillExtrusionHeightLift():0,mh=oa.projection.name==="globe",bh=mh?a.globeToMercatorTransition(oa.zoom):0,Sh=[a.mercatorXfromLng(oa.center.lng),a.mercatorYfromLat(oa.center.lat)],Nh=[];mh&&Nh.push("PROJECTION_GLOBE_VIEW"),gh[0]>0&&Nh.push("FAUX_AO"),yh&&Nh.push("ZERO_ROOF_RADIUS");for(const $h of X){const Vh=f.getTile($h),Wh=Vh.getBucket(T);if(!Wh||Wh.projection.name!==oa.projection.name)continue;const Zh=Wh.programConfigurations.get(T.id),rp=F.useProgram(dl?"fillExtrusionPattern":"fillExtrusion",Zh,Nh);if(F.terrain){const wp=F.terrain;if(F.style.terrainSetForDrapingOnly())wp.setupElevationDraw(Vh,rp,{useMeterToDem:!0});else{if(!Wh.enableTerrain)continue;if(wp.setupElevationDraw(Vh,rp,{useMeterToDem:!0}),Nv(pi,f,$h,Wh,T,wp),!Wh.centroidVertexBuffer){const Fp=rp.attributes.a_centroid_pos;Fp!==void 0&&Vn.vertexAttrib2f(Fp,0,0)}}}dl&&(F.context.activeTexture.set(Vn.TEXTURE0),Vh.imageAtlasTexture.bind(Vn.LINEAR,Vn.CLAMP_TO_EDGE),Zh.updatePaintBuffers());const Bp=sa.constantOr(null);if(Bp&&Vh.imageAtlas){const wp=Vh.imageAtlas.patternPositions[Bp.toString()];wp&&Zh.setConstantPatternPositions(wp)}const tp=F.translatePosMatrix($h.projMatrix,Vh,T.paint.get("fill-extrusion-translate"),T.paint.get("fill-extrusion-translate-anchor")),Tp=oa.projection.createInversionMatrix(oa,$h.canonical),pp=T.paint.get("fill-extrusion-vertical-gradient"),bp=dl?$0(tp,F,pp,lh,gh,xh,$h,Vh,yl,bh,Sh,Tp):V0(tp,F,pp,lh,gh,xh,$h,yl,bh,Sh,Tp);F.prepareDrawProgram(pi,rp,$h.toUnwrapped());const np=[];F.terrain&&np.push(Wh.centroidVertexBuffer),mh&&np.push(Wh.layoutVertexExtBuffer),rp.draw(pi,pi.gl.TRIANGLES,Ve,kt,Hr,a.CullFaceMode.backCCW,bp,T.id,Wh.layoutVertexBuffer,Wh.indexBuffer,Wh.segments,T.paint,F.transform.zoom,Zh,np)}}function Nv(F,f,T,X,Ve,kt){const Hr=[yl=>{let mh=yl.canonical.x-1,bh=yl.wrap;return mh<0&&(mh=(1<<yl.canonical.z)-1,bh--),new a.OverscaledTileID(yl.overscaledZ,bh,yl.canonical.z,mh,yl.canonical.y)},yl=>{let mh=yl.canonical.x+1,bh=yl.wrap;return mh===1<<yl.canonical.z&&(mh=0,bh++),new a.OverscaledTileID(yl.overscaledZ,bh,yl.canonical.z,mh,yl.canonical.y)},yl=>new a.OverscaledTileID(yl.overscaledZ,yl.wrap,yl.canonical.z,yl.canonical.x,(yl.canonical.y===0?1<<yl.canonical.z:yl.canonical.y)-1),yl=>new a.OverscaledTileID(yl.overscaledZ,yl.wrap,yl.canonical.z,yl.canonical.x,yl.canonical.y===(1<<yl.canonical.z)-1?0:yl.canonical.y+1)],pi=yl=>{const mh=f.getSource().minzoom,bh=Nh=>{const $h=f.getTileByID(Nh);if($h&&$h.hasData())return $h.getBucket(Ve)},Sh=[0,-1,1];for(const Nh of Sh){if(yl.overscaledZ+Nh<mh)continue;const $h=bh(yl.calculateScaledKey(yl.overscaledZ+Nh));if($h)return $h}},Vn=[0,0,0],oa=(yl,mh)=>(Vn[0]=Math.min(yl.min.y,mh.min.y),Vn[1]=Math.max(yl.max.y,mh.max.y),Vn[2]=a.EXTENT-mh.min.x>yl.max.x?mh.min.x-a.EXTENT:yl.max.x,Vn),sa=(yl,mh)=>(Vn[0]=Math.min(yl.min.x,mh.min.x),Vn[1]=Math.max(yl.max.x,mh.max.x),Vn[2]=a.EXTENT-mh.min.y>yl.max.y?mh.min.y-a.EXTENT:yl.max.y,Vn),dl=[(yl,mh)=>oa(yl,mh),(yl,mh)=>oa(mh,yl),(yl,mh)=>sa(yl,mh),(yl,mh)=>sa(mh,yl)],lh=new a.Point(0,0);let gh,_h,yh;const xh=(yl,mh,bh,Sh,Nh)=>{const $h=[[Sh?bh:yl,Sh?yl:bh,0],[Sh?bh:mh,Sh?mh:bh,0]],Vh=Nh<0?a.EXTENT+Nh:Nh,Wh=[Sh?Vh:(yl+mh)/2,Sh?(yl+mh)/2:Vh,0];return bh===0&&Nh<0||bh!==0&&Nh>0?kt.getForTilePoints(yh,[Wh],!0,_h):$h.push(Wh),kt.getForTilePoints(T,$h,!0,gh),Math.max($h[0][2],$h[1][2],Wh[2])/kt.exaggeration()};for(let yl=0;yl<4;yl++){const mh=(yl<2?1:5)-yl,bh=X.borders[yl];if(bh.length===0)continue;const Sh=yh=Hr[yl](T),Nh=pi(Sh);if(!(Nh&&Nh instanceof a.FillExtrusionBucket&&Nh.enableTerrain)||X.borderDoneWithNeighborZ[yl]===Nh.canonical.z&&Nh.borderDoneWithNeighborZ[mh]===X.canonical.z||(_h=kt.findDEMTileFor(Sh),!_h||!_h.dem))continue;if(!gh){const Zh=kt.findDEMTileFor(T);if(!Zh||!Zh.dem)return;gh=Zh}const $h=Nh.borders[mh];let Vh=0;const Wh=Nh.borderDoneWithNeighborZ[mh]!==X.canonical.z;if(X.canonical.z===Nh.canonical.z){for(let Zh=0;Zh<bh.length;Zh++){const rp=X.featuresOnBorder[bh[Zh]],Bp=rp.borders[yl];let tp;for(;Vh<$h.length&&(tp=Nh.featuresOnBorder[$h[Vh]],!(tp.borders[mh][1]>Bp[0]+3));)Wh&&Nh.encodeCentroid(void 0,tp,!1),Vh++;if(tp&&Vh<$h.length){const Tp=Vh;let pp=0;for(;!(tp.borders[mh][0]>Bp[1]-3)&&(pp++,++Vh!==$h.length);)tp=Nh.featuresOnBorder[$h[Vh]];if(tp=Nh.featuresOnBorder[$h[Tp]],rp.intersectsCount()>1||tp.intersectsCount()>1||pp!==1){pp!==1&&(Vh=Tp),X.encodeCentroid(void 0,rp,!1),Wh&&Nh.encodeCentroid(void 0,tp,!1);continue}const bp=dl[yl](rp,tp),np=yl%2?a.EXTENT-1:0;lh.x=xh(bp[0],Math.min(a.EXTENT-1,bp[1]),np,yl<2,bp[2]),lh.y=0,X.encodeCentroid(lh,rp,!1),Wh&&Nh.encodeCentroid(lh,tp,!1)}else X.encodeCentroid(void 0,rp,!1)}X.borderDoneWithNeighborZ[yl]=Nh.canonical.z,X.needsCentroidUpdate=!0,Wh&&(Nh.borderDoneWithNeighborZ[mh]=X.canonical.z,Nh.needsCentroidUpdate=!0)}else{for(const Zh of bh)X.encodeCentroid(void 0,X.featuresOnBorder[Zh],!1);if(Wh){for(const Zh of $h)Nh.encodeCentroid(void 0,Nh.featuresOnBorder[Zh],!1);Nh.borderDoneWithNeighborZ[mh]=X.canonical.z,Nh.needsCentroidUpdate=!0}X.borderDoneWithNeighborZ[yl]=Nh.canonical.z,X.needsCentroidUpdate=!0}}(X.needsCentroidUpdate||!X.centroidVertexBuffer&&X.centroidVertexArray.length!==0)&&X.uploadCentroid(F)}const Vg=new a.Color(1,0,0,1),y_=new a.Color(0,1,0,1),xw=new a.Color(0,0,1,1),ww=new a.Color(1,0,1,1),bw=new a.Color(0,1,1,1);function kv(F,f,T){const X=F.context,Ve=F.transform,kt=X.gl,Hr=Ve.projection.name==="globe",pi=Hr?["PROJECTION_GLOBE_VIEW"]:null;let Vn=T.projMatrix;if(Hr&&a.globeToMercatorTransition(Ve.zoom)>0){const rp=a.transitionTileAABBinECEF(T.canonical,Ve),Bp=a.globeDenormalizeECEF(rp);Vn=a.multiply(new Float32Array(16),Ve.globeMatrix,Bp),a.multiply(Vn,Ve.projMatrix,Vn)}const oa=F.useProgram("debug",null,pi),sa=f.getTileByID(T.key);F.terrain&&F.terrain.setupElevationDraw(sa,oa);const dl=a.DepthMode.disabled,lh=a.StencilMode.disabled,gh=F.colorModeForRenderPass(),_h="$debug";X.activeTexture.set(kt.TEXTURE0),F.emptyTexture.bind(kt.LINEAR,kt.CLAMP_TO_EDGE),Hr?sa._makeGlobeTileDebugBuffers(F.context,Ve):sa._makeDebugTileBoundsBuffers(F.context,Ve.projection);const yh=sa._tileDebugBuffer||F.debugBuffer,xh=sa._tileDebugIndexBuffer||F.debugIndexBuffer,yl=sa._tileDebugSegments||F.debugSegments;oa.draw(X,kt.LINE_STRIP,dl,lh,gh,a.CullFaceMode.disabled,W0(Vn,a.Color.red),_h,yh,xh,yl,null,null,null,[sa._globeTileDebugBorderBuffer]);const mh=sa.latestRawTileData,bh=Math.floor((mh&&mh.byteLength||0)/1024),Sh=f.getTile(T).tileSize,Nh=512/Math.min(Sh,512)*(T.overscaledZ/Ve.zoom)*.5;let $h=T.canonical.toString();T.overscaledZ!==T.canonical.z&&($h+=` => ${T.overscaledZ}`),$h+=` ${bh}kb`,function(rp,Bp){rp.initDebugOverlayCanvas();const tp=rp.debugOverlayCanvas,Tp=rp.context.gl,pp=rp.debugOverlayCanvas.getContext("2d");pp.clearRect(0,0,tp.width,tp.height),pp.shadowColor="white",pp.shadowBlur=2,pp.lineWidth=1.5,pp.strokeStyle="white",pp.textBaseline="top",pp.font="bold 36px Open Sans, sans-serif",pp.fillText(Bp,5,5),pp.strokeText(Bp,5,5),rp.debugOverlayTexture.update(tp),rp.debugOverlayTexture.bind(Tp.LINEAR,Tp.CLAMP_TO_EDGE)}(F,$h);const Vh=sa._tileDebugTextBuffer||F.debugBuffer,Wh=sa._tileDebugTextIndexBuffer||F.quadTriangleIndexBuffer,Zh=sa._tileDebugTextSegments||F.debugSegments;oa.draw(X,kt.TRIANGLES,dl,lh,a.ColorMode.alphaBlended,a.CullFaceMode.disabled,W0(Vn,a.Color.transparent,Nh),_h,Vh,Wh,Zh,null,null,null,[sa._globeTileDebugTextBuffer])}function Bv(F,f,T,X){Td(F,0,f+T/2,F.transform.width,T,X)}function ly(F,f,T,X){Td(F,f-T/2,0,T,F.transform.height,X)}function Td(F,f,T,X,Ve,kt){const Hr=F.context,pi=Hr.gl;pi.enable(pi.SCISSOR_TEST),pi.scissor(f*a.exported.devicePixelRatio,T*a.exported.devicePixelRatio,X*a.exported.devicePixelRatio,Ve*a.exported.devicePixelRatio),Hr.clear({color:kt}),pi.disable(pi.SCISSOR_TEST)}const m0=a.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:zv}=m0;function Sm(F,f,T,X){F.emplaceBack(f,T,X)}class y0{constructor(f){this.vertexArray=new a.StructArrayLayout3f12,this.indices=new a.StructArrayLayout3ui6,Sm(this.vertexArray,-1,-1,1),Sm(this.vertexArray,1,-1,1),Sm(this.vertexArray,-1,1,1),Sm(this.vertexArray,1,1,1),Sm(this.vertexArray,-1,-1,-1),Sm(this.vertexArray,1,-1,-1),Sm(this.vertexArray,-1,1,-1),Sm(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=f.createVertexBuffer(this.vertexArray,zv),this.indexBuffer=f.createIndexBuffer(this.indices),this.segment=a.SegmentVector.simpleSegment(0,0,36,12)}}function sd(F,f,T,X,Ve,kt){const Hr=F.gl,pi=f.paint.get("sky-atmosphere-color"),Vn=f.paint.get("sky-atmosphere-halo-color"),oa=f.paint.get("sky-atmosphere-sun-intensity"),sa=((dl,lh,gh,_h,yh)=>({u_matrix_3f:dl,u_sun_direction:lh,u_sun_intensity:gh,u_color_tint_r:[_h.r,_h.g,_h.b,_h.a],u_color_tint_m:[yh.r,yh.g,yh.b,yh.a],u_luminance:5e-5}))(a.fromMat4(a.create$1(),X),Ve,oa,pi,Vn);Hr.framebufferTexture2D(Hr.FRAMEBUFFER,Hr.COLOR_ATTACHMENT0,Hr.TEXTURE_CUBE_MAP_POSITIVE_X+kt,f.skyboxTexture,0),T.draw(F,Hr.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.frontCW,sa,"skyboxCapture",f.skyboxGeometry.vertexBuffer,f.skyboxGeometry.indexBuffer,f.skyboxGeometry.segment)}const __=a.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class J0{constructor(f){const T=new a.StructArrayLayout5f20;T.emplaceBack(-1,1,1,0,0),T.emplaceBack(1,1,1,1,0),T.emplaceBack(1,-1,1,1,1),T.emplaceBack(-1,-1,1,0,1);const X=new a.StructArrayLayout3ui6;X.emplaceBack(0,1,2),X.emplaceBack(2,3,0),this.vertexBuffer=f.createVertexBuffer(T,__.members),this.indexBuffer=f.createIndexBuffer(X),this.segments=a.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const v_={symbol:function(F,f,T,X,Ve){if(F.renderPass!=="translucent")return;const kt=a.StencilMode.disabled,Hr=F.colorModeForRenderPass();T.layout.get("text-variable-anchor")&&function(pi,Vn,oa,sa,dl,lh,gh){const _h=Vn.transform,yh=dl==="map",xh=lh==="map";for(const yl of pi){const mh=sa.getTile(yl),bh=mh.getBucket(oa);if(!bh||!bh.text||!bh.text.segments.get().length)continue;const Sh=a.evaluateSizeForZoom(bh.textSizeData,_h.zoom),Nh=Og(yl,bh.getProjection(),_h),$h=_h.calculatePixelsToTileUnitsMatrix(mh),Vh=hp(Nh,mh.tileID.canonical,xh,yh,_h,bh.getProjection(),$h),Wh=oa.layout.get("icon-text-fit")!=="none"&&bh.hasIconData();if(Sh){const Zh=Math.pow(2,_h.zoom-mh.tileID.overscaledZ);$x(bh,yh,xh,gh,a.symbolSize,_h,Vh,yl,Zh,Sh,Wh)}}}(X,F,T,f,T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),Ve),T.paint.get("icon-opacity").constantOr(1)!==0&&Lv(F,f,T,X,!1,T.paint.get("icon-translate"),T.paint.get("icon-translate-anchor"),T.layout.get("icon-rotation-alignment"),T.layout.get("icon-pitch-alignment"),T.layout.get("icon-keep-upright"),kt,Hr),T.paint.get("text-opacity").constantOr(1)!==0&&Lv(F,f,T,X,!0,T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.layout.get("text-keep-upright"),kt,Hr),f.map.showCollisionBoxes&&(m_(F,f,T,X,T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),!0),m_(F,f,T,X,T.paint.get("icon-translate"),T.paint.get("icon-translate-anchor"),!1))},circle:function(F,f,T,X){if(F.renderPass!=="translucent")return;const Ve=T.paint.get("circle-opacity"),kt=T.paint.get("circle-stroke-width"),Hr=T.paint.get("circle-stroke-opacity"),pi=T.layout.get("circle-sort-key").constantOr(1)!==void 0;if(Ve.constantOr(1)===0&&(kt.constantOr(1)===0||Hr.constantOr(1)===0))return;const Vn=F.context,oa=Vn.gl,sa=F.transform,dl=F.depthModeForSublayer(0,a.DepthMode.ReadOnly),lh=a.StencilMode.disabled,gh=F.colorModeForRenderPass(),_h=sa.projection.name==="globe",yh=[a.mercatorXfromLng(sa.center.lng),a.mercatorYfromLat(sa.center.lat)],xh=[];for(let mh=0;mh<X.length;mh++){const bh=X[mh],Sh=f.getTile(bh),Nh=Sh.getBucket(T);if(!Nh||Nh.projection.name!==sa.projection.name)continue;const $h=Nh.programConfigurations.get(T.id),Vh=K_(T);_h&&Vh.push("PROJECTION_GLOBE_VIEW");const Wh=F.useProgram("circle",$h,Vh),Zh=Nh.layoutVertexBuffer,rp=Nh.globeExtVertexBuffer,Bp=Nh.indexBuffer,tp=sa.projection.createInversionMatrix(sa,bh.canonical),Tp={programConfiguration:$h,program:Wh,layoutVertexBuffer:Zh,globeExtVertexBuffer:rp,indexBuffer:Bp,uniformValues:f0(F,bh,Sh,tp,yh,T),tile:Sh};if(pi){const pp=Nh.segments.get();for(const bp of pp)xh.push({segments:new a.SegmentVector([bp]),sortKey:bp.sortKey,state:Tp})}else xh.push({segments:Nh.segments,sortKey:0,state:Tp})}pi&&xh.sort((mh,bh)=>mh.sortKey-bh.sortKey);const yl={useDepthForOcclusion:!_h};for(const mh of xh){const{programConfiguration:bh,program:Sh,layoutVertexBuffer:Nh,globeExtVertexBuffer:$h,indexBuffer:Vh,uniformValues:Wh,tile:Zh}=mh.state,rp=mh.segments;F.terrain&&F.terrain.setupElevationDraw(Zh,Sh,yl),F.prepareDrawProgram(Vn,Sh,Zh.tileID.toUnwrapped()),Sh.draw(Vn,oa.TRIANGLES,dl,lh,gh,a.CullFaceMode.disabled,Wh,T.id,Nh,Vh,rp,T.paint,sa.zoom,bh,[$h])}},heatmap:function(F,f,T,X){if(T.paint.get("heatmap-opacity")!==0)if(F.renderPass==="offscreen"){const Ve=F.context,kt=Ve.gl,Hr=a.StencilMode.disabled,pi=new a.ColorMode([kt.ONE,kt.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(gh,_h,yh,xh){const yl=gh.gl,mh=_h.width*xh,bh=_h.height*xh;gh.activeTexture.set(yl.TEXTURE1),gh.viewport.set([0,0,mh,bh]);let Sh=yh.heatmapFbo;if(!Sh||Sh&&(Sh.width!==mh||Sh.height!==bh)){Sh&&Sh.destroy();const Nh=yl.createTexture();yl.bindTexture(yl.TEXTURE_2D,Nh),yl.texParameteri(yl.TEXTURE_2D,yl.TEXTURE_WRAP_S,yl.CLAMP_TO_EDGE),yl.texParameteri(yl.TEXTURE_2D,yl.TEXTURE_WRAP_T,yl.CLAMP_TO_EDGE),yl.texParameteri(yl.TEXTURE_2D,yl.TEXTURE_MIN_FILTER,yl.LINEAR),yl.texParameteri(yl.TEXTURE_2D,yl.TEXTURE_MAG_FILTER,yl.LINEAR),Sh=yh.heatmapFbo=gh.createFramebuffer(mh,bh,!1),function($h,Vh,Wh,Zh,rp,Bp){const tp=$h.gl;tp.texImage2D(tp.TEXTURE_2D,0,$h.isWebGL2&&$h.extRenderToTextureHalfFloat?tp.RGBA16F:tp.RGBA,rp,Bp,0,tp.RGBA,$h.extRenderToTextureHalfFloat?$h.isWebGL2?tp.HALF_FLOAT:$h.extTextureHalfFloat.HALF_FLOAT_OES:tp.UNSIGNED_BYTE,null),Zh.colorAttachment.set(Wh)}(gh,0,Nh,Sh,mh,bh)}else yl.bindTexture(yl.TEXTURE_2D,Sh.colorAttachment.get()),gh.bindFramebuffer.set(Sh.framebuffer)})(Ve,F,T,F.transform.projection.name==="globe"?.5:.25),Ve.clear({color:a.Color.transparent});const Vn=F.transform,oa=Vn.projection.name==="globe",sa=oa?["PROJECTION_GLOBE_VIEW"]:null,dl=oa?a.CullFaceMode.frontCCW:a.CullFaceMode.disabled,lh=[a.mercatorXfromLng(Vn.center.lng),a.mercatorYfromLat(Vn.center.lat)];for(let gh=0;gh<X.length;gh++){const _h=X[gh];if(f.hasRenderableParent(_h))continue;const yh=f.getTile(_h),xh=yh.getBucket(T);if(!xh||xh.projection.name!==Vn.projection.name)continue;const yl=xh.programConfigurations.get(T.id),mh=F.useProgram("heatmap",yl,sa),{zoom:bh}=F.transform;F.terrain&&F.terrain.setupElevationDraw(yh,mh),F.prepareDrawProgram(Ve,mh,_h.toUnwrapped());const Sh=Vn.projection.createInversionMatrix(Vn,_h.canonical);mh.draw(Ve,kt.TRIANGLES,a.DepthMode.disabled,Hr,pi,dl,Yg(F,_h,yh,Sh,lh,bh,T.paint.get("heatmap-intensity")),T.id,xh.layoutVertexBuffer,xh.indexBuffer,xh.segments,T.paint,F.transform.zoom,yl,oa?[xh.globeExtVertexBuffer]:null)}Ve.viewport.set([0,0,F.width,F.height])}else F.renderPass==="translucent"&&(F.context.setColorMode(F.colorModeForRenderPass()),function(Ve,kt){const Hr=Ve.context,pi=Hr.gl,Vn=kt.heatmapFbo;if(!Vn)return;Hr.activeTexture.set(pi.TEXTURE0),pi.bindTexture(pi.TEXTURE_2D,Vn.colorAttachment.get()),Hr.activeTexture.set(pi.TEXTURE1);let oa=kt.colorRampTexture;oa||(oa=kt.colorRampTexture=new a.Texture(Hr,kt.colorRamp,pi.RGBA)),oa.bind(pi.LINEAR,pi.CLAMP_TO_EDGE),Ve.useProgram("heatmapTexture").draw(Hr,pi.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,Ve.colorModeForRenderPass(),a.CullFaceMode.disabled,((sa,dl,lh,gh)=>({u_image:0,u_color_ramp:1,u_opacity:dl.paint.get("heatmap-opacity")}))(0,kt),kt.id,Ve.viewportBuffer,Ve.quadTriangleIndexBuffer,Ve.viewportSegments,kt.paint,Ve.transform.zoom)}(F,T))},line:function(F,f,T,X){if(F.renderPass!=="translucent")return;const Ve=T.paint.get("line-opacity"),kt=T.paint.get("line-width");if(Ve.constantOr(1)===0||kt.constantOr(1)===0)return;const Hr=F.depthModeForSublayer(0,a.DepthMode.ReadOnly),pi=F.colorModeForRenderPass(),Vn=F.terrain&&F.terrain.renderingToTexture?1:a.exported.devicePixelRatio,oa=T.paint.get("line-dasharray"),sa=oa.constantOr(1),dl=T.layout.get("line-cap"),lh=T.paint.get("line-pattern"),gh=lh.constantOr(1),_h=T.paint.get("line-gradient"),yh=gh?"linePattern":"line",xh=F.context,yl=xh.gl,mh=(Sh=>{const Nh=[];Dv(Sh)&&Nh.push("RENDER_LINE_DASH"),Sh.paint.get("line-gradient")&&Nh.push("RENDER_LINE_GRADIENT");const $h=Sh.paint.get("line-trim-offset");$h[0]===0&&$h[1]===0||Nh.push("RENDER_LINE_TRIM_OFFSET");const Vh=Sh.paint.get("line-pattern").constantOr(1),Wh=Sh.paint.get("line-opacity").constantOr(1)!==1;return!Vh&&Wh&&Nh.push("RENDER_LINE_ALPHA_DISCARD"),Nh})(T);let bh=mh.includes("RENDER_LINE_ALPHA_DISCARD");F.terrain&&F.terrain.clipOrMaskOverlapStencilType()&&(bh=!1);for(const Sh of X){const Nh=f.getTile(Sh);if(gh&&!Nh.patternsLoaded())continue;const $h=Nh.getBucket(T);if(!$h)continue;F.prepareDrawTile();const Vh=$h.programConfigurations.get(T.id),Wh=F.useProgram(yh,Vh,mh),Zh=lh.constantOr(null);if(Zh&&Nh.imageAtlas){const wp=Nh.imageAtlas.patternPositions[Zh.toString()];wp&&Vh.setConstantPatternPositions(wp)}const rp=oa.constantOr(null),Bp=dl.constantOr(null);if(!gh&&rp&&Bp&&Nh.lineAtlas){const wp=Nh.lineAtlas.getDash(rp,Bp);wp&&Vh.setConstantPatternPositions(wp)}let[tp,Tp]=T.paint.get("line-trim-offset");(Bp==="round"||Bp==="square")&&tp!==Tp&&(tp===0&&(tp-=1),Tp===1&&(Tp+=1));const pp=F.terrain?Sh.projMatrix:null,bp=gh?Nm(F,Nh,T,pp,Vn):X_(F,Nh,T,pp,$h.lineClipsArray.length,Vn,[tp,Tp]);if(_h){const wp=$h.gradients[T.id];let Fp=wp.texture;if(T.gradientVersion!==wp.version){let Pp=256;if(T.stepInterpolant){const Up=f.getSource().maxzoom,zd=Sh.canonical.z===Up?Math.ceil(1<<F.transform.maxZoom-Sh.canonical.z):1;Pp=a.clamp(a.nextPowerOfTwo($h.maxLineLength/a.EXTENT*1024*zd),256,xh.maxTextureSize)}wp.gradient=a.renderColorRamp({expression:T.gradientExpression(),evaluationKey:"lineProgress",resolution:Pp,image:wp.gradient||void 0,clips:$h.lineClipsArray}),wp.texture?wp.texture.update(wp.gradient):wp.texture=new a.Texture(xh,wp.gradient,yl.RGBA),wp.version=T.gradientVersion,Fp=wp.texture}xh.activeTexture.set(yl.TEXTURE1),Fp.bind(T.stepInterpolant?yl.NEAREST:yl.LINEAR,yl.CLAMP_TO_EDGE)}sa&&(xh.activeTexture.set(yl.TEXTURE0),Nh.lineAtlasTexture.bind(yl.LINEAR,yl.REPEAT),Vh.updatePaintBuffers()),gh&&(xh.activeTexture.set(yl.TEXTURE0),Nh.imageAtlasTexture.bind(yl.LINEAR,yl.CLAMP_TO_EDGE),Vh.updatePaintBuffers()),F.prepareDrawProgram(xh,Wh,Sh.toUnwrapped());const np=wp=>{Wh.draw(xh,yl.TRIANGLES,Hr,wp,pi,a.CullFaceMode.disabled,bp,T.id,$h.layoutVertexBuffer,$h.indexBuffer,$h.segments,T.paint,F.transform.zoom,Vh,[$h.layoutVertexBuffer2])};if(bh){const wp=F.stencilModeForClipping(Sh).ref;wp===0&&F.terrain&&xh.clear({stencil:0});const Fp={func:yl.EQUAL,mask:255};bp.u_alpha_discard_threshold=.8,np(new a.StencilMode(Fp,wp,255,yl.KEEP,yl.KEEP,yl.INVERT)),bp.u_alpha_discard_threshold=0,np(new a.StencilMode(Fp,wp,255,yl.KEEP,yl.KEEP,yl.KEEP))}else np(F.stencilModeForClipping(Sh))}bh&&(F.resetStencilClippingMasks(),F.terrain&&xh.clear({stencil:0}))},fill:function(F,f,T,X){const Ve=T.paint.get("fill-color"),kt=T.paint.get("fill-opacity");if(kt.constantOr(1)===0)return;const Hr=F.colorModeForRenderPass(),pi=T.paint.get("fill-pattern"),Vn=F.opaquePassEnabledForLayer()&&!pi.constantOr(1)&&Ve.constantOr(a.Color.transparent).a===1&&kt.constantOr(0)===1?"opaque":"translucent";if(F.renderPass===Vn){const oa=F.depthModeForSublayer(1,F.renderPass==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly);Ry(F,f,T,X,oa,Hr,!1)}if(F.renderPass==="translucent"&&T.paint.get("fill-antialias")){const oa=F.depthModeForSublayer(T.getPaintProperty("fill-outline-color")?2:0,a.DepthMode.ReadOnly);Ry(F,f,T,X,oa,Hr,!0)}},"fill-extrusion":function(F,f,T,X){const Ve=T.paint.get("fill-extrusion-opacity");if(Ve!==0&&F.renderPass==="translucent"){const kt=new a.DepthMode(F.context.gl.LEQUAL,a.DepthMode.ReadWrite,F.depthRangeFor3D);if(Ve!==1||T.paint.get("fill-extrusion-pattern").constantOr(1))$m(F,f,T,X,kt,a.StencilMode.disabled,a.ColorMode.disabled),$m(F,f,T,X,kt,F.stencilModeFor3D(),F.colorModeForRenderPass()),F.resetStencilClippingMasks();else{const Hr=F.colorModeForRenderPass();$m(F,f,T,X,kt,a.StencilMode.disabled,Hr)}}},hillshade:function(F,f,T,X){if(F.renderPass!=="offscreen"&&F.renderPass!=="translucent")return;const Ve=F.context,kt=F.depthModeForSublayer(0,a.DepthMode.ReadOnly),Hr=F.colorModeForRenderPass(),pi=F.terrain&&F.terrain.renderingToTexture,[Vn,oa]=F.renderPass!=="translucent"||pi?[{},X]:F.stencilConfigForOverlap(X);for(const sa of oa){const dl=f.getTile(sa);if(dl.needsHillshadePrepare&&F.renderPass==="offscreen")yg(F,dl,T,kt,a.StencilMode.disabled,Hr);else if(F.renderPass==="translucent"){const lh=pi&&F.terrain?F.terrain.stencilModeForRTTOverlap(sa):Vn[sa.overscaledZ];wx(F,sa,dl,T,kt,lh,Hr)}}Ve.viewport.set([0,0,F.width,F.height]),F.resetStencilClippingMasks()},raster:function(F,f,T,X,Ve,kt){if(F.renderPass!=="translucent"||T.paint.get("raster-opacity")===0||!X.length)return;const Hr=F.context,pi=Hr.gl,Vn=f.getSource(),oa=F.useProgram("raster"),sa=F.colorModeForRenderPass(),dl=F.terrain&&F.terrain.renderingToTexture,[lh,gh]=Vn instanceof Th||dl?[{},X]:F.stencilConfigForOverlap(X),_h=gh[gh.length-1].overscaledZ,yh=!F.options.moving;for(const xh of gh){const yl=dl?a.DepthMode.disabled:F.depthModeForSublayer(xh.overscaledZ-_h,T.paint.get("raster-opacity")===1?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly,pi.LESS),mh=xh.toUnwrapped(),bh=f.getTile(xh);if(dl&&(!bh||!bh.hasData()))continue;const Sh=dl?xh.projMatrix:F.transform.calculateProjMatrix(mh,yh),Nh=F.terrain&&dl?F.terrain.stencilModeForRTTOverlap(xh):lh[xh.overscaledZ],$h=kt?0:T.paint.get("raster-fade-duration");bh.registerFadeDuration($h);const Vh=f.findLoadedParent(xh,0),Wh=Iv(bh,Vh,f,F.transform,$h);let Zh,rp;F.terrain&&F.terrain.prepareDrawTile();const Bp=T.paint.get("raster-resampling")==="nearest"?pi.NEAREST:pi.LINEAR;Hr.activeTexture.set(pi.TEXTURE0),bh.texture.bind(Bp,pi.CLAMP_TO_EDGE),Hr.activeTexture.set(pi.TEXTURE1),Vh?(Vh.texture.bind(Bp,pi.CLAMP_TO_EDGE),Zh=Math.pow(2,Vh.tileID.overscaledZ-bh.tileID.overscaledZ),rp=[bh.tileID.canonical.x*Zh%1,bh.tileID.canonical.y*Zh%1]):bh.texture.bind(Bp,pi.CLAMP_TO_EDGE),bh.texture.useMipmap&&Hr.extTextureFilterAnisotropic&&F.transform.pitch>20&&pi.texParameterf(pi.TEXTURE_2D,Hr.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Hr.extTextureFilterAnisotropicMax);const tp=Qy(Sh,rp||[0,0],Zh||1,Wh,T,Vn instanceof Th?Vn.perspectiveTransform:[0,0]);if(F.prepareDrawProgram(Hr,oa,mh),Vn instanceof Th)Vn.boundsBuffer&&Vn.boundsSegments&&oa.draw(Hr,pi.TRIANGLES,yl,a.StencilMode.disabled,sa,a.CullFaceMode.disabled,tp,T.id,Vn.boundsBuffer,F.quadTriangleIndexBuffer,Vn.boundsSegments);else{const{tileBoundsBuffer:Tp,tileBoundsIndexBuffer:pp,tileBoundsSegments:bp}=F.getTileBoundsBuffers(bh);oa.draw(Hr,pi.TRIANGLES,yl,Nh,sa,a.CullFaceMode.disabled,tp,T.id,Tp,pp,bp)}}F.resetStencilClippingMasks()},background:function(F,f,T,X){const Ve=T.paint.get("background-color"),kt=T.paint.get("background-opacity");if(kt===0)return;const Hr=F.context,pi=Hr.gl,Vn=F.transform,oa=Vn.tileSize,sa=T.paint.get("background-pattern");if(F.isPatternMissing(sa))return;const dl=!sa&&Ve.a===1&&kt===1&&F.opaquePassEnabledForLayer()?"opaque":"translucent";if(F.renderPass!==dl)return;const lh=a.StencilMode.disabled,gh=F.depthModeForSublayer(0,dl==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly),_h=F.colorModeForRenderPass(),yh=F.useProgram(sa?"backgroundPattern":"background");let xh,yl=X;yl||(xh=F.getBackgroundTiles(),yl=Object.values(xh).map(mh=>mh.tileID)),sa&&(Hr.activeTexture.set(pi.TEXTURE0),F.imageManager.bind(F.context));for(const mh of yl){const bh=mh.toUnwrapped(),Sh=X?mh.projMatrix:F.transform.calculateProjMatrix(bh);F.prepareDrawTile();const Nh=f?f.getTile(mh):xh?xh[mh.key]:new a.Tile(mh,oa,Vn.zoom,F),$h=sa?X0(Sh,kt,F,sa,{tileID:mh,tileSize:oa}):Z0(Sh,kt,Ve);F.prepareDrawProgram(Hr,yh,bh);const{tileBoundsBuffer:Vh,tileBoundsIndexBuffer:Wh,tileBoundsSegments:Zh}=F.getTileBoundsBuffers(Nh);yh.draw(Hr,pi.TRIANGLES,gh,lh,_h,a.CullFaceMode.disabled,$h,T.id,Vh,Wh,Zh)}},sky:function(F,f,T){const X=F.transform,Ve=X.projection.name==="mercator"||X.projection.name==="globe"?1:a.smoothstep(7,8,X.zoom),kt=T.paint.get("sky-opacity")*Ve;if(kt===0)return;const Hr=F.context,pi=T.paint.get("sky-type"),Vn=new a.DepthMode(Hr.gl.LEQUAL,a.DepthMode.ReadOnly,[0,1]),oa=F.frameCounter/1e3%1;pi==="atmosphere"?F.renderPass==="offscreen"?T.needsSkyboxCapture(F)&&(function(sa,dl,lh,gh){const _h=sa.context,yh=_h.gl;let xh=dl.skyboxFbo;if(!xh){xh=dl.skyboxFbo=_h.createFramebuffer(32,32,!1),dl.skyboxGeometry=new y0(_h),dl.skyboxTexture=_h.gl.createTexture(),yh.bindTexture(yh.TEXTURE_CUBE_MAP,dl.skyboxTexture),yh.texParameteri(yh.TEXTURE_CUBE_MAP,yh.TEXTURE_WRAP_S,yh.CLAMP_TO_EDGE),yh.texParameteri(yh.TEXTURE_CUBE_MAP,yh.TEXTURE_WRAP_T,yh.CLAMP_TO_EDGE),yh.texParameteri(yh.TEXTURE_CUBE_MAP,yh.TEXTURE_MIN_FILTER,yh.LINEAR),yh.texParameteri(yh.TEXTURE_CUBE_MAP,yh.TEXTURE_MAG_FILTER,yh.LINEAR);for(let Sh=0;Sh<6;++Sh)yh.texImage2D(yh.TEXTURE_CUBE_MAP_POSITIVE_X+Sh,0,yh.RGBA,32,32,0,yh.RGBA,yh.UNSIGNED_BYTE,null)}_h.bindFramebuffer.set(xh.framebuffer),_h.viewport.set([0,0,32,32]);const yl=dl.getCenter(sa,!0),mh=sa.useProgram("skyboxCapture"),bh=new Float64Array(16);a.identity(bh),a.rotateY(bh,bh,.5*-Math.PI),sd(_h,dl,mh,bh,yl,0),a.identity(bh),a.rotateY(bh,bh,.5*Math.PI),sd(_h,dl,mh,bh,yl,1),a.identity(bh),a.rotateX(bh,bh,.5*-Math.PI),sd(_h,dl,mh,bh,yl,2),a.identity(bh),a.rotateX(bh,bh,.5*Math.PI),sd(_h,dl,mh,bh,yl,3),a.identity(bh),sd(_h,dl,mh,bh,yl,4),a.identity(bh),a.rotateY(bh,bh,Math.PI),sd(_h,dl,mh,bh,yl,5),_h.viewport.set([0,0,sa.width,sa.height])}(F,T),T.markSkyboxValid(F)):F.renderPass==="sky"&&function(sa,dl,lh,gh,_h){const yh=sa.context,xh=yh.gl,yl=sa.transform,mh=sa.useProgram("skybox");yh.activeTexture.set(xh.TEXTURE0),xh.bindTexture(xh.TEXTURE_CUBE_MAP,dl.skyboxTexture);const bh=((Sh,Nh,$h,Vh,Wh)=>({u_matrix:Sh,u_sun_direction:Nh,u_cubemap:0,u_opacity:Vh,u_temporal_offset:Wh}))(yl.skyboxMatrix,dl.getCenter(sa,!1),0,gh,_h);sa.prepareDrawProgram(yh,mh),mh.draw(yh,xh.TRIANGLES,lh,a.StencilMode.disabled,sa.colorModeForRenderPass(),a.CullFaceMode.backCW,bh,"skybox",dl.skyboxGeometry.vertexBuffer,dl.skyboxGeometry.indexBuffer,dl.skyboxGeometry.segment)}(F,T,Vn,kt,oa):pi==="gradient"&&F.renderPass==="sky"&&function(sa,dl,lh,gh,_h){const yh=sa.context,xh=yh.gl,yl=sa.transform,mh=sa.useProgram("skyboxGradient");dl.skyboxGeometry||(dl.skyboxGeometry=new y0(yh)),yh.activeTexture.set(xh.TEXTURE0);let bh=dl.colorRampTexture;bh||(bh=dl.colorRampTexture=new a.Texture(yh,dl.colorRamp,xh.RGBA)),bh.bind(xh.LINEAR,xh.CLAMP_TO_EDGE);const Sh=((Nh,$h,Vh,Wh,Zh)=>({u_matrix:Nh,u_color_ramp:0,u_center_direction:$h,u_radius:a.degToRad(Vh),u_opacity:Wh,u_temporal_offset:Zh}))(yl.skyboxMatrix,dl.getCenter(sa,!1),dl.paint.get("sky-gradient-radius"),gh,_h);sa.prepareDrawProgram(yh,mh),mh.draw(yh,xh.TRIANGLES,lh,a.StencilMode.disabled,sa.colorModeForRenderPass(),a.CullFaceMode.backCW,Sh,"skyboxGradient",dl.skyboxGeometry.vertexBuffer,dl.skyboxGeometry.indexBuffer,dl.skyboxGeometry.segment)}(F,T,Vn,kt,oa)},debug:function(F,f,T){for(let X=0;X<T.length;X++)kv(F,f,T[X])},custom:function(F,f,T,X){const Ve=F.context,kt=T.implementation;if(!F.transform.projection.unsupportedLayers||!F.transform.projection.unsupportedLayers.includes("custom")||F.terrain&&(F.terrain.renderingToTexture||F.renderPass==="offscreen")&&T.isLayerDraped()){if(F.renderPass==="offscreen"){const Hr=kt.prerender;if(Hr){if(F.setCustomLayerDefaults(),Ve.setColorMode(F.colorModeForRenderPass()),F.transform.projection.name==="globe"){const pi=F.transform.pointMerc;Hr.call(kt,Ve.gl,F.transform.customLayerMatrix(),F.transform.getProjection(),F.transform.globeToMercatorMatrix(),a.globeToMercatorTransition(F.transform.zoom),[pi.x,pi.y],F.transform.pixelsPerMeterRatio)}else Hr.call(kt,Ve.gl,F.transform.customLayerMatrix());Ve.setDirty(),F.setBaseState()}}else if(F.renderPass==="translucent"){if(F.terrain&&F.terrain.renderingToTexture){const pi=kt.renderToTile;if(pi){const Vn=X[0].canonical,oa=new a.MercatorCoordinate(Vn.x+X[0].wrap*(1<<Vn.z),Vn.y,Vn.z);Ve.setDepthMode(a.DepthMode.disabled),Ve.setStencilMode(a.StencilMode.disabled),Ve.setColorMode(F.colorModeForRenderPass()),F.setCustomLayerDefaults(),pi.call(kt,Ve.gl,oa),Ve.setDirty(),F.setBaseState()}return}F.setCustomLayerDefaults(),Ve.setColorMode(F.colorModeForRenderPass()),Ve.setStencilMode(a.StencilMode.disabled);const Hr=kt.renderingMode==="3d"?new a.DepthMode(F.context.gl.LEQUAL,a.DepthMode.ReadWrite,F.depthRangeFor3D):F.depthModeForSublayer(0,a.DepthMode.ReadOnly);if(Ve.setDepthMode(Hr),F.transform.projection.name==="globe"){const pi=F.transform.pointMerc;kt.render(Ve.gl,F.transform.customLayerMatrix(),F.transform.getProjection(),F.transform.globeToMercatorMatrix(),a.globeToMercatorTransition(F.transform.zoom),[pi.x,pi.y],F.transform.pixelsPerMeterRatio)}else kt.render(Ve.gl,F.transform.customLayerMatrix());Ve.setDirty(),F.setBaseState(),Ve.bindFramebuffer.set(null)}}else a.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class t_{constructor(f,T,X=!1){this.context=new cl(f,X),this.transform=T,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=a.SourceCache.maxUnderzooming+a.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(f,T){const X=!!f&&!!f.terrain&&this.transform.projection.supportsTerrain;if(!(X||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Mv(this,f));const Ve=this._terrain;this.transform.elevation=X?Ve:null,Ve.update(f,this.transform,T)}_updateFog(f){const T=f.fog;if(!T||this.transform.projection.name==="globe"||T.getOpacity(this.transform.pitch)<1||T.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[X,Ve]=T.getFovAdjustedRange(this.transform._fov);if(X>Ve)return void(this.transform.fogCullDistSq=null);const kt=X+.78*(Ve-X);this.transform.fogCullDistSq=kt*kt}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(f,T){if(this.width=f*a.exported.devicePixelRatio,this.height=T*a.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const X of this.style.order)this.style._layers[X].resize()}setup(){const f=this.context,T=new a.StructArrayLayout2i4;T.emplaceBack(0,0),T.emplaceBack(a.EXTENT,0),T.emplaceBack(0,a.EXTENT),T.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=f.createVertexBuffer(T,a.posAttributes.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const X=new a.StructArrayLayout2i4;X.emplaceBack(0,0),X.emplaceBack(a.EXTENT,0),X.emplaceBack(0,a.EXTENT),X.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=f.createVertexBuffer(X,a.posAttributes.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const Ve=new a.StructArrayLayout2i4;Ve.emplaceBack(-1,-1),Ve.emplaceBack(1,-1),Ve.emplaceBack(-1,1),Ve.emplaceBack(1,1),this.viewportBuffer=f.createVertexBuffer(Ve,a.posAttributes.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const kt=new a.StructArrayLayout4i8;kt.emplaceBack(0,0,0,0),kt.emplaceBack(a.EXTENT,0,a.EXTENT,0),kt.emplaceBack(0,a.EXTENT,0,a.EXTENT),kt.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.mercatorBoundsBuffer=f.createVertexBuffer(kt,a.boundsAttributes.members),this.mercatorBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const Hr=new a.StructArrayLayout3ui6;Hr.emplaceBack(0,1,2),Hr.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=f.createIndexBuffer(Hr);const pi=new a.StructArrayLayout1ui2;for(const oa of[0,1,3,2,0])pi.emplaceBack(oa);this.debugIndexBuffer=f.createIndexBuffer(pi),this.emptyTexture=new a.Texture(f,new a.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),f.gl.RGBA),this.identityMat=a.create();const Vn=this.context.gl;this.stencilClearMode=new a.StencilMode({func:Vn.ALWAYS,mask:0},0,255,Vn.ZERO,Vn.ZERO,Vn.ZERO),this.loadTimeStamps.push(a.window.performance.now()),this.atmosphereBuffer=new J0(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(f){return f._makeTileBoundsBuffers(this.context,this.transform.projection),f._tileBoundsBuffer?{tileBoundsBuffer:f._tileBoundsBuffer,tileBoundsIndexBuffer:f._tileBoundsIndexBuffer,tileBoundsSegments:f._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const f=this.context,T=f.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(f,T.TRIANGLES,a.DepthMode.disabled,this.stencilClearMode,a.ColorMode.disabled,a.CullFaceMode.disabled,H_(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(f,T,X){if(!T||this.currentStencilSource===T.id||!f.isTileClipped()||!X||X.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let pi=!1;for(const Vn of X)if(this._tileClippingMaskIDs[Vn.key]===void 0){pi=!0;break}if(!pi)return}this.currentStencilSource=T.id;const Ve=this.context,kt=Ve.gl;this.nextStencilID+X.length>256&&this.clearStencil(),Ve.setColorMode(a.ColorMode.disabled),Ve.setDepthMode(a.DepthMode.disabled);const Hr=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const pi of X){const Vn=T.getTile(pi),oa=this._tileClippingMaskIDs[pi.key]=this.nextStencilID++,{tileBoundsBuffer:sa,tileBoundsIndexBuffer:dl,tileBoundsSegments:lh}=this.getTileBoundsBuffers(Vn);Hr.draw(Ve,kt.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:kt.ALWAYS,mask:0},oa,255,kt.KEEP,kt.KEEP,kt.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,H_(pi.projMatrix),"$clipping",sa,dl,lh)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const f=this.nextStencilID++,T=this.context.gl;return new a.StencilMode({func:T.NOTEQUAL,mask:255},f,255,T.KEEP,T.KEEP,T.REPLACE)}stencilModeForClipping(f){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(f);const T=this.context.gl;return new a.StencilMode({func:T.EQUAL,mask:255},this._tileClippingMaskIDs[f.key],0,T.KEEP,T.KEEP,T.REPLACE)}stencilConfigForOverlap(f){const T=this.context.gl,X=f.sort((Hr,pi)=>pi.overscaledZ-Hr.overscaledZ),Ve=X[X.length-1].overscaledZ,kt=X[0].overscaledZ-Ve+1;if(kt>1){this.currentStencilSource=void 0,this.nextStencilID+kt>256&&this.clearStencil();const Hr={};for(let pi=0;pi<kt;pi++)Hr[pi+Ve]=new a.StencilMode({func:T.GEQUAL,mask:255},pi+this.nextStencilID,255,T.KEEP,T.KEEP,T.REPLACE);return this.nextStencilID+=kt,[Hr,X]}return[{[Ve]:a.StencilMode.disabled},X]}colorModeForRenderPass(){const f=this.context.gl;return this._showOverdrawInspector?new a.ColorMode([f.CONSTANT_COLOR,f.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?a.ColorMode.unblended:a.ColorMode.alphaBlended}depthModeForSublayer(f,T,X){if(!this.opaquePassEnabledForLayer())return a.DepthMode.disabled;const Ve=1-((1+this.currentLayer)*this.numSublayers+f)*this.depthEpsilon;return new a.DepthMode(X||this.context.gl.LEQUAL,T,[Ve,Ve])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(f,T){this.style=f,this.options=T,this.imageManager=f.imageManager,this.glyphManager=f.glyphManager,this.symbolFadeChange=f.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const X=this.style.order,Ve=this.style._sourceCaches;for(const oa in Ve){const sa=Ve[oa];sa.used&&sa.prepare(this.context)}const kt={},Hr={},pi={};for(const oa in Ve){const sa=Ve[oa];kt[oa]=sa.getVisibleCoordinates(),Hr[oa]=kt[oa].slice().reverse(),pi[oa]=sa.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let oa=0;oa<X.length;oa++)if(this.style._layers[X[oa]].is3D()){this.opaquePassCutoff=oa;break}if(this.terrain&&(this.terrain.updateTileBinding(pi),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.GlobeSharedBuffers(this.context)),!a.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const oa of X){const sa=this.style._layers[oa],dl=f._getLayerSourceCache(sa);if(!sa.hasOffscreenPass()||sa.isHidden(this.transform.zoom))continue;const lh=dl?Hr[dl.id]:void 0;(sa.type==="custom"||sa.isSky()||lh&&lh.length)&&this.renderLayer(this,dl,sa,lh)}this.depthRangeFor3D=[0,1-(f.order.length+2)*this.numSublayers*this.depthEpsilon];const Vn=this.terrain;if(Vn&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&Vn.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:T.showOverdrawInspector?a.Color.black:a.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=T.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=X.length-1;this.currentLayer>=0;this.currentLayer--){const oa=this.style._layers[X[this.currentLayer]],sa=f._getLayerSourceCache(oa);if(oa.isSky())continue;const dl=sa?Hr[sa.id]:void 0;this._renderTileClippingMasks(oa,sa,dl),this.renderLayer(this,sa,oa,dl)}if(this.style.fog&&this.transform.projection.supportsFog&&function(oa,sa){const dl=oa.context,lh=dl.gl,gh=oa.transform,_h=new a.DepthMode(lh.LEQUAL,a.DepthMode.ReadOnly,[0,1]),yh=oa.useProgram("globeAtmosphere",null,gh.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),xh=a.globeToMercatorTransition(gh.zoom),yl=sa.properties.get("color").toArray01(),mh=sa.properties.get("high-color").toArray01(),bh=sa.properties.get("space-color").toArray01PremultipliedAlpha(),Sh=a.identity$1([]);a.rotateY$1(Sh,Sh,-a.degToRad(gh._center.lng)),a.rotateX$1(Sh,Sh,a.degToRad(gh._center.lat)),a.rotateZ$1(Sh,Sh,gh.angle),a.rotateX$1(Sh,Sh,-gh._pitch);const Nh=a.fromQuat(new Float32Array(16),Sh),$h=a.mapValue(sa.properties.get("star-intensity"),0,1,0,.25),Vh=5e-4,Wh=a.mapValue(sa.properties.get("horizon-blend"),0,1,Vh,.25),Zh=a.globeUseCustomAntiAliasing(oa,dl,gh)&&Wh===Vh?gh.worldSize/(2*Math.PI*1.025)-1:gh.globeRadius,rp=oa.frameCounter/1e3%1,Bp=a.length(gh.globeCenterInViewSpace),tp=Math.sqrt(Math.pow(Bp,2)-Math.pow(Zh,2)),Tp=Math.acos(tp/Bp),pp=((np,wp,Fp,Pp,Up,zd,jf,Pd,Zd,ig,Jf,Bd,fg,Sg)=>({u_frustum_tl:np,u_frustum_tr:wp,u_frustum_br:Fp,u_frustum_bl:Pp,u_horizon:Up,u_transition:zd,u_fadeout_range:jf,u_color:Pd,u_high_color:Zd,u_space_color:ig,u_star_intensity:Jf,u_star_size:5*a.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Bd,u_horizon_angle:fg,u_rotation_matrix:Sg}))(gh.frustumCorners.TL,gh.frustumCorners.TR,gh.frustumCorners.BR,gh.frustumCorners.BL,gh.frustumCorners.horizon,xh,Wh,yl,mh,bh,$h,rp,Tp,Nh);oa.prepareDrawProgram(dl,yh);const bp=oa.atmosphereBuffer;bp&&yh.draw(dl,lh.TRIANGLES,_h,a.StencilMode.disabled,a.ColorMode.alphaBlended,a.CullFaceMode.backCW,pp,"skybox",bp.vertexBuffer,bp.indexBuffer,bp.segments)}(this,this.style.fog),this.renderPass="sky",(a.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<X.length;this.currentLayer++){const oa=this.style._layers[X[this.currentLayer]],sa=f._getLayerSourceCache(oa);oa.isSky()&&this.renderLayer(this,sa,oa,sa?Hr[sa.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<X.length;){const oa=this.style._layers[X[this.currentLayer]],sa=f._getLayerSourceCache(oa);if(oa.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(oa)){if(oa.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const dl=sa?(oa.type==="symbol"?pi:Hr)[sa.id]:void 0;this._renderTileClippingMasks(oa,sa,sa?kt[sa.id]:void 0),this.renderLayer(this,sa,oa,dl),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let oa=null;a.values(this.style._layers).forEach(sa=>{const dl=f._getLayerSourceCache(sa);dl&&!sa.isHidden(this.transform.zoom)&&(!oa||oa.getSource().maxzoom<dl.getSource().maxzoom)&&(oa=dl)}),oa&&this.options.showTileBoundaries&&v_.debug(this,oa,oa.getVisibleCoordinates())}this.options.showPadding&&function(oa){const sa=oa.transform.padding;Bv(oa,oa.transform.height-(sa.top||0),3,Vg),Bv(oa,sa.bottom||0,3,y_),ly(oa,sa.left||0,3,xw),ly(oa,oa.transform.width-(sa.right||0),3,ww);const dl=oa.transform.centerPoint;(function(lh,gh,_h,yh){Td(lh,gh-1,_h-10,2,20,yh),Td(lh,gh-10,_h-1,20,2,yh)})(oa,dl.x,oa.transform.height-dl.y,bw)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(a.window.performance.now()),this.saveCanvasCopy())}renderLayer(f,T,X,Ve){X.isHidden(this.transform.zoom)||(X.type==="background"||X.type==="sky"||X.type==="custom"||Ve&&Ve.length)&&(this.id=X.id,this.gpuTimingStart(X),(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes(X.type)||f.terrain&&X.type==="custom")&&v_[X.type](f,T,X,Ve,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(f){if(!this.options.gpuTiming)return;const T=this.context.extTimerQuery;let X=this.gpuTimers[f.id];X||(X=this.gpuTimers[f.id]={calls:0,cpuTime:0,query:T.createQueryEXT()}),X.calls++,T.beginQueryEXT(T.TIME_ELAPSED_EXT,X.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const f=this.context.extTimerQuery,T=f.createQueryEXT();this.deferredRenderGpuTimeQueries.push(T),f.beginQueryEXT(f.TIME_ELAPSED_EXT,T)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const f=this.context.extTimerQuery;f.endQueryEXT(f.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const f=this.context.extTimerQuery;f.endQueryEXT(f.TIME_ELAPSED_EXT)}collectGpuTimers(){const f=this.gpuTimers;return this.gpuTimers={},f}collectDeferredRenderGpuQueries(){const f=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],f}queryGpuTimers(f){const T={};for(const X in f){const Ve=f[X],kt=this.context.extTimerQuery,Hr=kt.getQueryObjectEXT(Ve.query,kt.QUERY_RESULT_EXT)/1e6;kt.deleteQueryEXT(Ve.query),T[X]=Hr}return T}queryGpuTimeDeferredRender(f){if(!this.options.gpuTimingDeferredRender)return 0;const T=this.context.extTimerQuery;let X=0;for(const Ve of f)X+=T.getQueryObjectEXT(Ve,T.QUERY_RESULT_EXT)/1e6,T.deleteQueryEXT(Ve);return X}translatePosMatrix(f,T,X,Ve,kt){if(!X[0]&&!X[1])return f;const Hr=kt?Ve==="map"?this.transform.angle:0:Ve==="viewport"?-this.transform.angle:0;if(Hr){const oa=Math.sin(Hr),sa=Math.cos(Hr);X=[X[0]*sa-X[1]*oa,X[0]*oa+X[1]*sa]}const pi=[kt?X[0]:$p(T,X[0],this.transform.zoom),kt?X[1]:$p(T,X[1],this.transform.zoom),0],Vn=new Float32Array(16);return a.translate(Vn,f,pi),Vn}saveTileTexture(f){const T=this._tileTextures[f.size[0]];T?T.push(f):this._tileTextures[f.size[0]]=[f]}getTileTexture(f){const T=this._tileTextures[f];return T&&T.length>0?T.pop():null}isPatternMissing(f){return f===null||f!==void 0&&!this.imageManager.getPattern(f.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const f=this.terrain&&this.terrain.renderingToTexture,T=this.terrain&&this.terrain.exaggeration()===0,X=this.style&&this.style.fog,Ve=[];return this.terrainRenderModeElevated()&&Ve.push("TERRAIN"),this.transform.projection.name==="globe"&&Ve.push("GLOBE"),T&&Ve.push("ZERO_EXAGGERATION"),X&&!f&&X.getOpacity(this.transform.pitch)!==0&&Ve.push("FOG"),f&&Ve.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&Ve.push("OVERDRAW_INSPECTOR"),Ve}useProgram(f,T,X){this.cache=this.cache||{};const Ve=X||[],kt=this.currentGlobalDefines().concat(Ve),Hr=jd.cacheKey(c0[f],f,kt,T);return this.cache[Hr]||(this.cache[Hr]=new jd(this.context,f,c0[f],T,vy[f],kt)),this.cache[Hr]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const f=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(f.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=a.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(f,T,X){if(this.terrain&&this.terrain.renderingToTexture)return;const Ve=this.style.fog;if(Ve){const kt=Ve.getOpacity(this.transform.pitch),Hr=((pi,Vn,oa,sa,dl,lh,gh,_h,yh,xh,yl)=>{const mh=pi.transform,bh=Vn.properties.get("color").toArray01();bh[3]=sa;const Sh=pi.frameCounter/1e3%1;return{u_fog_matrix:oa?mh.calculateFogTileMatrix(oa):pi.identityMat,u_fog_range:Vn.getFovAdjustedRange(mh._fov),u_fog_color:bh,u_fog_horizon_blend:Vn.properties.get("horizon-blend"),u_fog_temporal_offset:Sh,u_frustum_tl:dl,u_frustum_tr:lh,u_frustum_br:gh,u_frustum_bl:_h,u_globe_pos:yh,u_globe_radius:xh,u_viewport:yl,u_globe_transition:a.globeToMercatorTransition(mh.zoom),u_is_globe:+(mh.projection.name==="globe")}})(this,Ve,X,kt,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.exported.devicePixelRatio,this.transform.height*a.exported.devicePixelRatio]);T.setFogUniformValues(f,Hr)}}setTileLoadedFlag(f){this.tileLoaded=f}saveCanvasCopy(){const f=this.canvasCopy();f&&(this.frameCopies.push(f),this.tileLoaded=!1)}canvasCopy(){const f=this.context.gl,T=f.createTexture();return f.bindTexture(f.TEXTURE_2D,T),f.copyTexImage2D(f.TEXTURE_2D,0,f.RGBA,0,0,f.drawingBufferWidth,f.drawingBufferHeight,0),T}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const f=this.style&&this.style.fog;return!!f&&f.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const f=this._backgroundTiles,T=this._backgroundTiles={},X=this.transform.coveringTiles({tileSize:512});for(const Ve of X)T[Ve.key]=f[Ve.key]||new a.Tile(Ve,512,this.transform.tileZoom,this);return T}clearBackgroundTiles(){this._backgroundTiles={}}}class _0{constructor(f=0,T=0,X=0,Ve=0){if(isNaN(f)||f<0||isNaN(T)||T<0||isNaN(X)||X<0||isNaN(Ve)||Ve<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=f,this.bottom=T,this.left=X,this.right=Ve}interpolate(f,T,X){return T.top!=null&&f.top!=null&&(this.top=a.number(f.top,T.top,X)),T.bottom!=null&&f.bottom!=null&&(this.bottom=a.number(f.bottom,T.bottom,X)),T.left!=null&&f.left!=null&&(this.left=a.number(f.left,T.left,X)),T.right!=null&&f.right!=null&&(this.right=a.number(f.right,T.right,X)),this}getCenter(f,T){const X=a.clamp((this.left+f-this.right)/2,0,f),Ve=a.clamp((this.top+T-this.bottom)/2,0,T);return new a.Point(X,Ve)}equals(f){return this.top===f.top&&this.bottom===f.bottom&&this.left===f.left&&this.right===f.right}clone(){return new _0(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ev(F,f){const T=a.getColumn(F,3);a.fromQuat(F,f),a.setColumn(F,3,T)}function og(F,f){const T=a.identity$1([]);return a.rotateZ$1(T,T,-f),a.rotateX$1(T,T,-F),T}function Gv(F,f){const T=[F[0],F[1],0],X=[f[0],f[1],0];if(a.length(T)>=1e-15){const Hr=a.normalize([],T);a.scale$2(X,Hr,a.dot(X,Hr)),f[0]=X[0],f[1]=X[1]}const Ve=a.cross([],f,F);if(a.len(Ve)<1e-15)return null;const kt=Math.atan2(-Ve[1],Ve[0]);return og(Math.atan2(Math.sqrt(F[0]*F[0]+F[1]*F[1]),-F[2]),kt)}class Q0{constructor(f,T){this.position=f,this.orientation=T}get position(){return this._position}set position(f){if(f){const T=f instanceof a.MercatorCoordinate?f:new a.MercatorCoordinate(f[0],f[1],f[2]);this._renderWorldCopies&&(T.x=a.wrap(T.x,0,1)),this._position=T}else this._position=null}lookAtPoint(f,T){if(this.orientation=null,!this.position)return;const X=this.position,Ve=this._elevation?this._elevation.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(f)):0,kt=a.MercatorCoordinate.fromLngLat(f,Ve),Hr=[kt.x-X.x,kt.y-X.y,kt.z-X.z];T||(T=[0,0,1]),T[2]=Math.abs(T[2]),this.orientation=Gv(Hr,T)}setPitchBearing(f,T){this.orientation=og(a.degToRad(f),a.degToRad(-T))}}class tv{constructor(f,T){this._transform=a.identity([]),this.orientation=T,this.position=f}get mercatorPosition(){const f=this.position;return new a.MercatorCoordinate(f[0],f[1],f[2])}get position(){const f=a.getColumn(this._transform,3);return[f[0],f[1],f[2]]}set position(f){var T;f&&a.setColumn(this._transform,3,[(T=f)[0],T[1],T[2],1])}get orientation(){return this._orientation}set orientation(f){this._orientation=f||a.identity$1([]),f&&ev(this._transform,this._orientation)}getPitchBearing(){const f=this.forward(),T=this.right();return{bearing:Math.atan2(-T[1],T[0]),pitch:Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2])}}setPitchBearing(f,T){this._orientation=og(f,T),ev(this._transform,this._orientation)}forward(){const f=a.getColumn(this._transform,2);return[-f[0],-f[1],-f[2]]}up(){const f=a.getColumn(this._transform,1);return[-f[0],-f[1],-f[2]]}right(){const f=a.getColumn(this._transform,0);return[f[0],f[1],f[2]]}getCameraToWorld(f,T){const X=new Float64Array(16);return a.invert(X,this.getWorldToCamera(f,T)),X}getWorldToCameraPosition(f,T,X){const Ve=this.position;a.scale$2(Ve,Ve,-f);const kt=new Float64Array(16);return a.fromScaling(kt,[X,X,X]),a.translate(kt,kt,Ve),kt[10]*=T,kt}getWorldToCamera(f,T){const X=new Float64Array(16),Ve=new Float64Array(4),kt=this.position;return a.conjugate(Ve,this._orientation),a.scale$2(kt,kt,-f),a.fromQuat(X,Ve),a.translate(X,X,kt),X[1]*=-1,X[5]*=-1,X[9]*=-1,X[13]*=-1,X[8]*=T,X[9]*=T,X[10]*=T,X[11]*=T,X}getCameraToClipPerspective(f,T,X,Ve){const kt=new Float64Array(16);return a.perspective(kt,f,T,X,Ve),kt}getDistanceToElevation(f,T=!1){const X=f===0?0:a.mercatorZfromAltitude(f,T?a.latFromMercatorY(this.position[1]):this.position[1]),Ve=this.forward();return(X-this.position[2])/Ve[2]}clone(){return new tv([...this.position],[...this.orientation])}}function x_(F,f){const T=Tm(F.projection,F.zoom,F.width,F.height),X=function(kt,Hr,pi,Vn,oa){const sa=new a.LngLat(pi.lng-180*km,pi.lat),dl=new a.LngLat(pi.lng+180*km,pi.lat),lh=kt.project(sa.lng,sa.lat),gh=kt.project(dl.lng,dl.lat),_h=-Math.atan2(gh.y-lh.y,gh.x-lh.x),yh=a.MercatorCoordinate.fromLngLat(pi);yh.y=a.clamp(yh.y,-1+km,1-km);const xh=yh.toLngLat(),yl=kt.project(xh.lng,xh.lat),mh=a.MercatorCoordinate.fromLngLat(xh);mh.x+=km;const bh=mh.toLngLat(),Sh=kt.project(bh.lng,bh.lat),Nh=$v(Sh.x-yl.x,Sh.y-yl.y,_h),$h=a.MercatorCoordinate.fromLngLat(xh);$h.y+=km;const Vh=$h.toLngLat(),Wh=kt.project(Vh.lng,Vh.lat),Zh=$v(Wh.x-yl.x,Wh.y-yl.y,_h),rp=Math.abs(Nh.x)/Math.abs(Zh.y),Bp=a.identity([]);a.rotateZ(Bp,Bp,-_h*(1-(oa?0:Vn)));const tp=a.identity([]);return a.scale(tp,tp,[1,1-(1-rp)*Vn,1]),tp[4]=-Zh.x/Zh.y*Vn,a.rotateZ(tp,tp,_h),a.multiply(tp,Bp,tp),tp}(F.projection,0,F.center,T,f),Ve=Vv(F);return a.scale(X,X,[Ve,Ve,1]),X}function Vv(F){const f=F.projection,T=Tm(F.projection,F.zoom,F.width,F.height),X=Sx(f,F.center),Ve=Sx(f,a.LngLat.convert(f.center));return Math.pow(2,X*T+(1-T)*Ve)}function Tm(F,f,T,X,Ve=1/0){const kt=F.range;if(!kt)return 0;const Hr=Math.min(Ve,Math.max(T,X)),pi=Math.log(Hr/1024)/Math.LN2;return a.smoothstep(kt[0]+pi,kt[1]+pi,f)}const km=1/4e4;function Sx(F,f){const T=a.clamp(f.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),X=new a.LngLat(f.lng-180*km,T),Ve=new a.LngLat(f.lng+180*km,T),kt=F.project(X.lng,T),Hr=F.project(Ve.lng,T),pi=a.MercatorCoordinate.fromLngLat(X),Vn=a.MercatorCoordinate.fromLngLat(Ve),oa=Hr.x-kt.x,sa=Hr.y-kt.y,dl=Vn.x-pi.x,lh=Vn.y-pi.y,gh=Math.sqrt((dl*dl+lh*lh)/(oa*oa+sa*sa));return Math.log(gh)/Math.LN2}function $v(F,f,T){const X=Math.cos(T),Ve=Math.sin(T);return{x:F*X-f*Ve,y:F*Ve+f*X}}class r_{constructor(f,T,X,Ve,kt,Hr,pi){this.tileSize=512,this._renderWorldCopies=kt===void 0||kt,this._minZoom=f||0,this._maxZoom=T||22,this._minPitch=X??0,this._maxPitch=Ve??60,this.setProjection(Hr),this.setMaxBounds(pi),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new _0,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new tv,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const f=new r_(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return f._elevation=this._elevation,f._centerAltitude=this._centerAltitude,f._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,f.tileSize=this.tileSize,f.mercatorFromTransition=this.mercatorFromTransition,f.width=this.width,f.height=this.height,f.cameraElevationReference=this.cameraElevationReference,f._center=this._center,f._setZoom(this.zoom),f._seaLevelZoom=this._seaLevelZoom,f.angle=this.angle,f._fov=this._fov,f._pitch=this._pitch,f._nearZ=this._nearZ,f._farZ=this._farZ,f._averageElevation=this._averageElevation,f._unmodified=this._unmodified,f._edgeInsets=this._edgeInsets.clone(),f._camera=this._camera.clone(),f._calcMatrices(),f.freezeTileCoverage=this.freezeTileCoverage,f.frustumCorners=this.frustumCorners,f}get elevation(){return this._elevation}set elevation(f){this._elevation!==f&&(this._elevation=f,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(f,T=!1){const X=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||X)&&this._updateCameraOnTerrain(),(f||X)&&this._constrainCamera(T),this._calcMatrices()}getProjection(){return a.pick(this.projection,["name","center","parallels"])}setProjection(f){this.projectionOptions=f||{name:"mercator"};const T=this.projection?this.getProjection():void 0;this.projection=a.getProjection(this.projectionOptions);const X=!h(T,this.getProjection());return X&&this._calcMatrices(),this.mercatorFromTransition=!1,X}setMercatorFromTransition(){const f=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.getProjection({name:"mercator"});const T=f!==this.projection.name;return T&&this._calcMatrices(),T}get minZoom(){return this._minZoom}set minZoom(f){this._minZoom!==f&&(this._minZoom=f,this.zoom=Math.max(this.zoom,f))}get maxZoom(){return this._maxZoom}set maxZoom(f){this._maxZoom!==f&&(this._maxZoom=f,this.zoom=Math.min(this.zoom,f))}get minPitch(){return this._minPitch}set minPitch(f){this._minPitch!==f&&(this._minPitch=f,this.pitch=Math.max(this.pitch,f))}get maxPitch(){return this._maxPitch}set maxPitch(f){this._maxPitch!==f&&(this._maxPitch=f,this.pitch=Math.min(this.pitch,f))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(f){f===void 0?f=!0:f===null&&(f=!1),this._renderWorldCopies=f}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const f=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(f))}get cameraWorldSize(){const f=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(f))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.Point(this.width,this.height)}get bearing(){return a.wrap(this.rotation,-180,180)}set bearing(f){this.rotation=f}get rotation(){return-this.angle/Math.PI*180}set rotation(f){const T=-f*Math.PI/180;var X;this.angle!==T&&(this._unmodified=!1,this.angle=T,this._calcMatrices(),this.rotationMatrix=(X=new a.ARRAY_TYPE(4),a.ARRAY_TYPE!=Float32Array&&(X[1]=0,X[2]=0),X[0]=1,X[3]=1,X),function(Ve,kt,Hr){var pi=kt[0],Vn=kt[1],oa=kt[2],sa=kt[3],dl=Math.sin(Hr),lh=Math.cos(Hr);Ve[0]=pi*lh+oa*dl,Ve[1]=Vn*lh+sa*dl,Ve[2]=pi*-dl+oa*lh,Ve[3]=Vn*-dl+sa*lh}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(f){const T=a.clamp(f,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==T&&(this._unmodified=!1,this._pitch=T,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const f=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/f)}set fov(f){f=Math.max(.01,Math.min(60,f)),this._fov!==f&&(this._unmodified=!1,this._fov=a.degToRad(f),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(f){this._averageElevation=f,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(f){const T=Math.min(Math.max(f,this.minZoom),this.maxZoom);this._zoom!==T&&(this._unmodified=!1,this._setZoom(T),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(f){this._zoom=f,this.scale=this.zoomScale(f),this.tileZoom=Math.floor(f),this.zoomFraction=f-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const f=this._elevation;this._centerAltitude=f.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=f.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const f=this._elevation,T=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],X=this.horizonLineFromTop();let Ve=0,kt=0;for(let Hr=0;Hr<T.length;Hr++){const pi=new a.Point(T[Hr][0]*this.width,X+T[Hr][1]*(this.height-X)),Vn=f.pointCoordinate(pi);if(!Vn)continue;const oa=1/Math.hypot(Vn[0]-this._camera.position[0],Vn[1]-this._camera.position[1]);Ve+=Vn[3]*oa,kt+=oa}return kt===0?NaN:Ve/kt}get center(){return this._center}set center(f){f.lat===this._center.lat&&f.lng===this._center.lng||(this._unmodified=!1,this._center=f,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const f=this._seaLevelZoom,T=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),X=this.pixelsPerMeter/this.worldSize*T,Ve=this._mercatorZfromZoom(f),kt=this._mercatorZfromZoom(this._maxZoom),Hr=Math.max(Ve-X,kt);this._setZoom(this._zoomFromMercatorZ(Hr))}get padding(){return this._edgeInsets.toJSON()}set padding(f){this._edgeInsets.equals(f)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,f,1),this._calcMatrices())}computeZoomRelativeTo(f){const T=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,f.toAltitude()));let X;X=f.z<this._camera.position[2]?[T.x,T.y,T.z]:[f.x,f.y,f.z];const Ve=a.length(a.sub([],this._camera.position,X));return a.clamp(this._zoomFromMercatorZ(Ve),this._minZoom,this._maxZoom)}setFreeCameraOptions(f){if(!this.height||!f.position&&!f.orientation)return;this._updateCameraState();let T=!1;if(f.orientation&&!a.exactEquals(f.orientation,this._camera.orientation)&&(T=this._setCameraOrientation(f.orientation)),f.position){const X=[f.position.x,f.position.y,f.position.z];a.exactEquals$1(X,this._camera.position)||(this._setCameraPosition(X),T=!0)}T&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const f=this._camera.position,T=new Q0;return T.position=new a.MercatorCoordinate(f[0],f[1],f[2]),T.orientation=this._camera.orientation,T._elevation=this.elevation,T._renderWorldCopies=this.renderWorldCopies,T}_setCameraOrientation(f){if(!a.length$1(f))return!1;a.normalize$1(f,f);const T=a.transformQuat([],[0,0,-1],f),X=a.transformQuat([],[0,-1,0],f);if(X[2]<0)return!1;const Ve=Gv(T,X);return!!Ve&&(this._camera.orientation=Ve,!0)}_setCameraPosition(f){const T=this.zoomScale(this.minZoom)*this.tileSize,X=this.zoomScale(this.maxZoom)*this.tileSize,Ve=this.cameraToCenterDistance;f[2]=a.clamp(f[2],Ve/X,Ve/T),this._camera.position=f}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(f){return this._edgeInsets.equals(f)}interpolatePadding(f,T,X){this._unmodified=!1,this._edgeInsets.interpolate(f,T,X),this._constrain(),this._calcMatrices()}coveringZoomLevel(f){const T=(f.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/f.tileSize));return Math.max(0,T)}getVisibleUnwrappedCoordinates(f){const T=[new a.UnwrappedTileID(0,f)];if(this.renderWorldCopies){const X=this.pointCoordinate(new a.Point(0,0)),Ve=this.pointCoordinate(new a.Point(this.width,0)),kt=this.pointCoordinate(new a.Point(this.width,this.height)),Hr=this.pointCoordinate(new a.Point(0,this.height)),pi=Math.floor(Math.min(X.x,Ve.x,kt.x,Hr.x)),Vn=Math.floor(Math.max(X.x,Ve.x,kt.x,Hr.x)),oa=1;for(let sa=pi-oa;sa<=Vn+oa;sa++)sa!==0&&T.push(new a.UnwrappedTileID(sa,f))}return T}coveringTiles(f){let T=this.coveringZoomLevel(f);const X=T,Ve=this.elevation&&!f.isTerrainDEM,kt=this.projection.name==="mercator";if(f.minzoom!==void 0&&T<f.minzoom)return[];f.maxzoom!==void 0&&T>f.maxzoom&&(T=f.maxzoom);const Hr=this.locationCoordinate(this.center),pi=this.center.lat,Vn=1<<T,oa=[Vn*Hr.x,Vn*Hr.y,0],sa=this.projection.name==="globe",dl=!sa,lh=a.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,T,dl),gh=sa?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),_h=Vn*a.mercatorZfromAltitude(1,this.center.lat),yh=this._camera.position[2]/a.mercatorZfromAltitude(1,this.center.lat),xh=[Vn*gh.x,Vn*gh.y,yh*(dl?1:_h)],yl=this.cameraToCenterDistance/f.tileSize*(f.roundZoom?1:.502),mh=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?T:0,bh=f.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,Sh=f.isTerrainDEM?-bh:this._elevation?this._elevation.getMinElevationBelowMSL():0,Nh=this.projection.isReprojectedInTileSpace?Vv(this):1,$h=np=>{const Fp=new a.MercatorCoordinate(np.x+25e-6,np.y,np.z),Pp=new a.MercatorCoordinate(np.x,np.y+25e-6,np.z),Up=np.toLngLat(),zd=Fp.toLngLat(),jf=Pp.toLngLat(),Pd=this.locationCoordinate(Up),Zd=this.locationCoordinate(zd),ig=this.locationCoordinate(jf),Jf=Math.hypot(Zd.x-Pd.x,Zd.y-Pd.y),Bd=Math.hypot(ig.x-Pd.x,ig.y-Pd.y);return Math.sqrt(Jf*Bd)*Nh/25e-6},Vh=np=>{const wp=bh,Fp=Sh;return{aabb:a.tileAABB(this,Vn,0,0,0,np,Fp,wp,this.projection),zoom:0,x:0,y:0,minZ:Fp,maxZ:wp,wrap:np,fullyVisible:!1}},Wh=[];let Zh=[];const rp=T,Bp=f.reparseOverscaled?X:T,tp=np=>np*np,Tp=tp((yh-this._centerAltitude)*_h),pp=np=>{if(!this._elevation||!np.tileID||!kt)return;const wp=this._elevation.getMinMaxForTile(np.tileID),Fp=np.aabb;wp?(Fp.min[2]=wp.min,Fp.max[2]=wp.max,Fp.center[2]=(Fp.min[2]+Fp.max[2])/2):(np.shouldSplit=bp(np),np.shouldSplit||(Fp.min[2]=Fp.max[2]=Fp.center[2]=this._centerAltitude))},bp=np=>{if(np.zoom<mh)return!0;if(np.zoom===rp)return!1;if(np.shouldSplit!=null)return np.shouldSplit;const wp=np.aabb.distanceX(xh),Fp=np.aabb.distanceY(xh);let Pp=Tp,Up=1;if(sa){Pp=tp(np.aabb.distanceZ(xh));const Pd=Math.pow(2,np.zoom),Zd=a.latFromMercatorY((np.y+1)/Pd),ig=a.latFromMercatorY(np.y/Pd),Jf=Math.min(Math.max(pi,Zd),ig),Bd=a.circumferenceAtLatitude(Jf)/a.circumferenceAtLatitude(pi);if(Up=Jf===pi?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Bd/this._mercatorScaleRatio),this.zoom<=a.GLOBE_ZOOM_THRESHOLD_MIN&&np.zoom===rp-1&&Bd>=.9)return!0}else if(Ve&&(Pp=tp(np.aabb.distanceZ(xh)*_h)),this.projection.isReprojectedInTileSpace&&X<=5){const Pd=Math.pow(2,np.zoom),Zd=$h(new a.MercatorCoordinate((np.x+.5)/Pd,(np.y+.5)/Pd));Up=Zd>.85?1:Zd}const zd=wp*wp+Fp*Fp+Pp,jf=tp((1<<rp-np.zoom)*yl*Up*((Pd,Zd)=>{if(Zd*tp(.707)<Pd)return 1;const ig=Math.sqrt(Zd/Pd);return ig/(1.4144271570014144+(Math.pow(1.1,ig-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Pp,Tp),zd));return zd<jf};if(this.renderWorldCopies)for(let np=1;np<=3;np++)Wh.push(Vh(-np)),Wh.push(Vh(np));for(Wh.push(Vh(0));Wh.length>0;){const np=Wh.pop(),wp=np.x,Fp=np.y;let Pp=np.fullyVisible;if(!Pp){const Up=np.aabb.intersects(lh);if(Up===0)continue;Pp=Up===2}if(np.zoom!==rp&&bp(np))for(let Up=0;Up<4;Up++){const zd=(wp<<1)+Up%2,jf=(Fp<<1)+(Up>>1),Pd={aabb:kt?np.aabb.quadrant(Up):a.tileAABB(this,Vn,np.zoom+1,zd,jf,np.wrap,np.minZ,np.maxZ,this.projection),zoom:np.zoom+1,x:zd,y:jf,wrap:np.wrap,fullyVisible:Pp,tileID:void 0,shouldSplit:void 0,minZ:np.minZ,maxZ:np.maxZ};Ve&&!sa&&(Pd.tileID=new a.OverscaledTileID(np.zoom+1===rp?Bp:np.zoom+1,np.wrap,np.zoom+1,zd,jf),pp(Pd)),Wh.push(Pd)}else{const Up=np.zoom===rp?Bp:np.zoom;if(f.minzoom&&f.minzoom>Up)continue;const zd=oa[0]-(.5+wp+(np.wrap<<np.zoom))*(1<<T-np.zoom),jf=oa[1]-.5-Fp,Pd=np.tileID?np.tileID:new a.OverscaledTileID(Up,np.wrap,np.zoom,wp,Fp);Zh.push({tileID:Pd,distanceSq:zd*zd+jf*jf})}}if(this.fogCullDistSq){const np=this.fogCullDistSq,wp=this.horizonLineFromTop();Zh=Zh.filter(Fp=>{const Pp=[0,0,0,1],Up=[a.EXTENT,a.EXTENT,0,1],zd=this.calculateFogTileMatrix(Fp.tileID.toUnwrapped());a.transformMat4$1(Pp,Pp,zd),a.transformMat4$1(Up,Up,zd);const jf=a.getAABBPointSquareDist(Pp,Up);if(jf===0)return!0;let Pd=!1;const Zd=this._elevation;if(Zd&&jf>np&&wp!==0){const ig=this.calculateProjMatrix(Fp.tileID.toUnwrapped());let Jf;f.isTerrainDEM||(Jf=Zd.getMinMaxForTile(Fp.tileID)),Jf||(Jf={min:Sh,max:bh});const Bd=a.furthestTileCorner(this.rotation),fg=[Bd[0]*a.EXTENT,Bd[1]*a.EXTENT,Jf.max];a.transformMat4(fg,fg,ig),Pd=(1-fg[1])*this.height*.5<wp}return jf<np||Pd})}return Zh.sort((np,wp)=>np.distanceSq-wp.distanceSq).map(np=>np.tileID)}resize(f,T){this.width=f,this.height=T,this.pixelsToGLUnits=[2/f,-2/T],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(f){return Math.pow(2,f)}scaleZoom(f){return Math.log(f)/Math.LN2}project(f){const T=a.clamp(f.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),X=this.projection.project(f.lng,T);return new a.Point(X.x*this.worldSize,X.y*this.worldSize)}unproject(f){return this.projection.unproject(f.x/this.worldSize,f.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/a.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(f,T){let X,Ve;const kt=this.centerPoint;if(this.projection.name==="globe"){const pi=this.worldSize;X=(T.x-kt.x)/pi,Ve=(T.y-kt.y)/pi}else{const pi=this.pointCoordinate(T),Vn=this.pointCoordinate(kt);X=pi.x-Vn.x,Ve=pi.y-Vn.y}const Hr=this.locationCoordinate(f);this.setLocation(new a.MercatorCoordinate(Hr.x-X,Hr.y-Ve))}setLocation(f){this.center=this.coordinateLocation(f),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(f){return this.projection.locationPoint(this,f)}locationPoint3D(f){return this.projection.locationPoint(this,f,!0)}pointLocation(f){return this.coordinateLocation(this.pointCoordinate(f))}pointLocation3D(f){return this.coordinateLocation(this.pointCoordinate3D(f))}locationCoordinate(f,T){const X=T?a.mercatorZfromAltitude(T,f.lat):void 0,Ve=this.projection.project(f.lng,f.lat);return new a.MercatorCoordinate(Ve.x,Ve.y,X)}coordinateLocation(f){return this.projection.unproject(f.x,f.y)}pointRayIntersection(f,T){const X=T??this._centerAltitude,Ve=[f.x,f.y,0,1],kt=[f.x,f.y,1,1];a.transformMat4$1(Ve,Ve,this.pixelMatrixInverse),a.transformMat4$1(kt,kt,this.pixelMatrixInverse);const Hr=kt[3];a.scale$1(Ve,Ve,1/Ve[3]),a.scale$1(kt,kt,1/Hr);const pi=Ve[2],Vn=kt[2];return{p0:Ve,p1:kt,t:pi===Vn?0:(X-pi)/(Vn-pi)}}screenPointToMercatorRay(f){const T=[f.x,f.y,0,1],X=[f.x,f.y,1,1];return a.transformMat4$1(T,T,this.pixelMatrixInverse),a.transformMat4$1(X,X,this.pixelMatrixInverse),a.scale$1(T,T,1/T[3]),a.scale$1(X,X,1/X[3]),T[2]=a.mercatorZfromAltitude(T[2],this._center.lat)*this.worldSize,X[2]=a.mercatorZfromAltitude(X[2],this._center.lat)*this.worldSize,a.scale$1(T,T,1/this.worldSize),a.scale$1(X,X,1/this.worldSize),new a.Ray([T[0],T[1],T[2]],a.normalize([],a.sub([],X,T)))}rayIntersectionCoordinate(f){const{p0:T,p1:X,t:Ve}=f,kt=a.mercatorZfromAltitude(T[2],this._center.lat),Hr=a.mercatorZfromAltitude(X[2],this._center.lat);return new a.MercatorCoordinate(a.number(T[0],X[0],Ve)/this.worldSize,a.number(T[1],X[1],Ve)/this.worldSize,a.number(kt,Hr,Ve))}pointCoordinate(f,T=this._centerAltitude){return this.projection.pointCoordinate(this,f.x,f.y,T)}pointCoordinate3D(f){if(!this.elevation)return this.pointCoordinate(f);let T=this.projection.pointCoordinate3D(this,f.x,f.y);if(T)return new a.MercatorCoordinate(T[0],T[1],T[2]);let X=0,Ve=this.horizonLineFromTop();if(f.y>Ve)return this.pointCoordinate(f);const kt=.02*Ve,Hr=f.clone();for(let pi=0;pi<10&&Ve-X>kt;pi++){Hr.y=a.number(X,Ve,.66);const Vn=this.projection.pointCoordinate3D(this,Hr.x,Hr.y);Vn?(Ve=Hr.y,T=Vn):X=Hr.y}return T?new a.MercatorCoordinate(T[0],T[1],T[2]):this.pointCoordinate(f)}isPointAboveHorizon(f){return this.projection.isPointAboveHorizon(this,f)}isPointOnSurface(f){if(f.y<0||f.y>this.height||f.x<0||f.x>this.width)return!1;if(this.elevation||this.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(f);const T=this.pointCoordinate(f);return T.y>=0&&T.y<=1}_coordinatePoint(f,T){const X=T&&this.elevation?this.elevation.getAtPointOrZero(f,this._centerAltitude):this._centerAltitude,Ve=[f.x*this.worldSize,f.y*this.worldSize,X+f.toAltitude(),1];return a.transformMat4$1(Ve,Ve,this.pixelMatrix),Ve[3]>0?new a.Point(Ve[0]/Ve[3],Ve[1]/Ve[3]):new a.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:f,left:T}=this._edgeInsets,X=this.height-this._edgeInsets.bottom,Ve=this.width-this._edgeInsets.right,kt=this.pointLocation3D(new a.Point(T,f)),Hr=this.pointLocation3D(new a.Point(Ve,f)),pi=this.pointLocation3D(new a.Point(Ve,X)),Vn=this.pointLocation3D(new a.Point(T,X));let oa=Math.min(kt.lng,Hr.lng,pi.lng,Vn.lng),sa=Math.max(kt.lng,Hr.lng,pi.lng,Vn.lng),dl=Math.min(kt.lat,Hr.lat,pi.lat,Vn.lat),lh=Math.max(kt.lat,Hr.lat,pi.lat,Vn.lat);const gh=Math.pow(2,-this.zoom)/16*270,_h=this.projection.name==="globe"?1:4,yh=(xh,yl,mh,bh,Sh)=>{const Nh=(xh+mh)/2,$h=(yl+bh)/2,Vh=new a.Point(Nh,$h),{lng:Wh,lat:Zh}=this.pointLocation3D(Vh),rp=Math.max(0,oa-Wh,dl-Zh,Wh-sa,Zh-lh);oa=Math.min(oa,Wh),sa=Math.max(sa,Wh),dl=Math.min(dl,Zh),lh=Math.max(lh,Zh),(Sh<_h||rp>gh)&&(yh(xh,yl,Nh,$h,Sh+1),yh(Nh,$h,mh,bh,Sh+1))};if(yh(T,f,Ve,f,1),yh(Ve,f,Ve,X,1),yh(Ve,X,T,X,1),yh(T,X,T,f,1),this.projection.name==="globe"){const[xh,yl]=a.polesInViewport(this);xh?(lh=90,sa=180,oa=-180):yl&&(dl=-90,sa=180,oa=-180)}return new a.LngLatBounds(new a.LngLat(oa,dl),new a.LngLat(sa,lh))}_getBoundsRectangular(f,T){const{top:X,left:Ve}=this._edgeInsets,kt=this.height-this._edgeInsets.bottom,Hr=this.width-this._edgeInsets.right,pi=new a.Point(Ve,X),Vn=new a.Point(Hr,X),oa=new a.Point(Hr,kt),sa=new a.Point(Ve,kt);let dl=this.pointCoordinate(pi,f),lh=this.pointCoordinate(Vn,f);const gh=this.pointCoordinate(oa,T),_h=this.pointCoordinate(sa,T),yh=(xh,yl)=>(yl.y-xh.y)/(yl.x-xh.x);return dl.y>1&&lh.y>=0?dl=new a.MercatorCoordinate((1-_h.y)/yh(_h,dl)+_h.x,1):dl.y<0&&lh.y<=1&&(dl=new a.MercatorCoordinate(-_h.y/yh(_h,dl)+_h.x,0)),lh.y>1&&dl.y>=0?lh=new a.MercatorCoordinate((1-gh.y)/yh(gh,lh)+gh.x,1):lh.y<0&&dl.y<=1&&(lh=new a.MercatorCoordinate(-gh.y/yh(gh,lh)+gh.x,0)),new a.LngLatBounds().extend(this.coordinateLocation(dl)).extend(this.coordinateLocation(lh)).extend(this.coordinateLocation(_h)).extend(this.coordinateLocation(gh))}_getBoundsRectangularTerrain(){const f=this.elevation;if(!f.visibleDemTiles.length||f.isUsingMockSource())return this._getBoundsRectangular(0,0);const T=f.visibleDemTiles.reduce((X,Ve)=>{if(Ve.dem){const kt=Ve.dem.tree;X.min=Math.min(X.min,kt.minimums[0]),X.max=Math.max(X.max,kt.maximums[0])}return X},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(T.min*f.exaggeration(),T.max*f.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(f=!0){const T=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,X=this.height/2-T*(1-this._horizonShift);return f?Math.max(0,X):X}getMaxBounds(){return this.maxBounds}setMaxBounds(f){this.maxBounds=f,this.minLat=-a.MAX_MERCATOR_LATITUDE,this.maxLat=a.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,f&&(this.minLat=f.getSouth(),this.maxLat=f.getNorth(),this.minLng=f.getWest(),this.maxLng=f.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=a.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=a.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=a.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(f,T){return this.projection.createTileMatrix(this,T,f)}calculateDistanceTileData(f){const T=f.key,X=this._distanceTileDataCache;if(X[T])return X[T];const Ve=f.canonical,kt=1/this.height,Hr=this.cameraWorldSize,pi=Hr/this.zoomScale(Ve.z),Vn=(Ve.x+Math.pow(2,Ve.z)*f.wrap)*pi,oa=Ve.y*pi,sa=this.point;sa.x*=Hr/this.worldSize,sa.y*=Hr/this.worldSize;const dl=this.angle,lh=Math.sin(-dl),gh=-Math.cos(-dl);return X[T]={bearing:[lh,gh],center:[(sa.x-Vn)*kt,(sa.y-oa)*kt],scale:pi/a.EXTENT*kt},X[T]}calculateFogTileMatrix(f){const T=f.key,X=this._fogTileMatrixCache;if(X[T])return X[T];const Ve=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,f);return a.multiply(Ve,this.worldToFogMatrix,Ve),X[T]=new Float32Array(Ve),X[T]}calculateProjMatrix(f,T=!1){const X=f.key,Ve=T?this._alignedProjMatrixCache:this._projMatrixCache;if(Ve[X])return Ve[X];const kt=this.calculatePosMatrix(f,this.worldSize);return a.multiply(kt,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:T?this.alignedProjMatrix:this.projMatrix,kt),Ve[X]=new Float32Array(kt),Ve[X]}calculatePixelsToTileUnitsMatrix(f){const T=f.tileID.key,X=this._pixelsToTileUnitsCache;if(X[T])return X[T];const Ve=function(kt,Hr){const{scale:pi}=kt.tileTransform,Vn=pi*a.EXTENT/(kt.tileSize*Math.pow(2,Hr.zoom-kt.tileID.overscaledZ+kt.tileID.canonical.z));return oa=new Float32Array(4),lh=(sa=Hr.inverseAdjustmentMatrix)[1],gh=sa[2],_h=sa[3],xh=(dl=[Vn,Vn])[1],oa[0]=sa[0]*(yh=dl[0]),oa[1]=lh*yh,oa[2]=gh*xh,oa[3]=_h*xh,oa;var oa,sa,dl,lh,gh,_h,yh,xh}(f,this);return X[T]=Ve,X[T]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const f=1/this.worldSize,T=a.fromScaling([],[f,f,f]);return a.multiply(T,T,this.globeMatrix),T}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const f=this._elevation;this._updateCameraState();const T=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,X=this._computeCameraPosition(T),Ve=this._camera.forward(),kt=a.mercatorZfromAltitude(1,this._center.lat);X[2]/=kt,Ve[2]/=kt,a.normalize(Ve,Ve);const Hr=f.raycast(X,Ve,f.exaggeration());if(Hr){const pi=a.scaleAndAdd([],X,Ve,Hr),Vn=new a.MercatorCoordinate(pi[0],pi[1],a.mercatorZfromAltitude(pi[2],a.latFromMercatorY(pi[1]))),oa=(Vn.z+a.length([Vn.x-X[0],Vn.y-X[1],Vn.z-X[2]*kt]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(oa),this._centerAltitude=Vn.toAltitude(),this._center=this.coordinateLocation(Vn),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(f=!1){if(!this._elevation)return;const T=this._elevation,X=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,Ve=this._computeCameraPosition(X),kt=T.getAtPointOrZero(new a.MercatorCoordinate(...Ve)),Hr=this.pixelsPerMeter/this.worldSize*kt,pi=this._minimumHeightOverTerrain(),Vn=Ve[2]-Hr;if(Vn<=pi)if(Vn<0||f){const oa=this.locationCoordinate(this._center,this._centerAltitude),sa=[Ve[0],Ve[1],oa.z-Ve[2]],dl=a.length(sa);sa[2]-=(pi-Vn)/this._pixelsPerMercatorPixel;const lh=a.length(sa);if(lh===0)return;a.scale$2(sa,sa,dl/lh*this._pixelsPerMercatorPixel),this._camera.position=[Ve[0],Ve[1],oa.z*this._pixelsPerMercatorPixel-sa[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const f=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||f){const lh=this.center;return lh.lat=a.clamp(lh.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!f)&&(lh.lng=a.clamp(lh.lng,this.minLng,this.maxLng)),this.center=lh,void(this._constraining=!1)}const T=this._unmodified,{x:X,y:Ve}=this.point;let kt=0,Hr=X,pi=Ve;const Vn=this.width/2,oa=this.height/2,sa=this.worldMinY*this.scale,dl=this.worldMaxY*this.scale;if(Ve-oa<sa&&(pi=sa+oa),Ve+oa>dl&&(pi=dl-oa),dl-sa<this.height&&(kt=Math.max(kt,this.height/(dl-sa)),pi=(dl+sa)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const lh=this.worldMinX*this.scale,gh=this.worldMaxX*this.scale,_h=this.worldSize/2-(lh+gh)/2;Hr=(X+_h+this.worldSize)%this.worldSize-_h,Hr-Vn<lh&&(Hr=lh+Vn),Hr+Vn>gh&&(Hr=gh-Vn),gh-lh<this.width&&(kt=Math.max(kt,this.width/(gh-lh)),Hr=(gh+lh)/2)}Hr===X&&pi===Ve||(this.center=this.unproject(new a.Point(Hr,pi))),kt&&(this.zoom+=this.scaleZoom(kt)),this._constrainCamera(),this._unmodified=T,this._constraining=!1}_minZoomForBounds(){let f=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(f=Math.max(f,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),f}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const f=this.centerOffset,T=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=a.mercatorZfromAltitude(1,this.center.lat)/a.mercatorZfromAltitude(1,a.GLOBE_SCALE_MATCH_LATITUDE));const X=Tm(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,X),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const Ve=this.projection.zAxisUnit==="meters"?T:1,kt=this._camera.getWorldToCamera(this.worldSize,Ve),Hr=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);Hr[8]=2*-f.x/this.width,Hr[9]=2*f.y/this.height;let pi=a.mul([],Hr,kt);if(this.projection.isReprojectedInTileSpace){const $h=this.locationCoordinate(this.center),Vh=a.identity([]);a.translate(Vh,Vh,[$h.x*this.worldSize,$h.y*this.worldSize,0]),a.multiply(Vh,Vh,x_(this)),a.translate(Vh,Vh,[-$h.x*this.worldSize,-$h.y*this.worldSize,0]),a.multiply(pi,pi,Vh),this.inverseAdjustmentMatrix=function(Wh){const Zh=x_(Wh,!0);return sl([],[Zh[0],Zh[1],Zh[4],Zh[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=a.scale([],pi,[this.worldSize,this.worldSize,this.worldSize/Ve,1]),this.projMatrix=pi,this.invProjMatrix=a.invert(new Float64Array(16),this.projMatrix);const Vn=a.invert([],Hr);this.frustumCorners=a.FrustumCorners.fromInvProjectionMatrix(Vn,this.horizonLineFromTop(),this.height);const oa=new Float32Array(16);a.identity(oa),a.scale(oa,oa,[1,-1,1]),a.rotateX(oa,oa,this._pitch),a.rotateZ(oa,oa,this.angle);const sa=a.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),dl=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;sa[8]=2*-f.x/this.width,sa[9]=2*(f.y+dl)/this.height,this.skyboxMatrix=a.multiply(oa,sa,oa);const lh=this.point,gh=lh.x,_h=lh.y,yh=this.width%2/2,xh=this.height%2/2,yl=Math.cos(this.angle),mh=Math.sin(this.angle),bh=gh-Math.round(gh)+yl*yh+mh*xh,Sh=_h-Math.round(_h)+yl*xh+mh*yh,Nh=new Float64Array(pi);if(a.translate(Nh,Nh,[bh>.5?bh-1:bh,Sh>.5?Sh-1:Sh,0]),this.alignedProjMatrix=Nh,pi=a.create(),a.scale(pi,pi,[this.width/2,-this.height/2,1]),a.translate(pi,pi,[1,-1,0]),this.labelPlaneMatrix=pi,pi=a.create(),a.scale(pi,pi,[1,-1,1]),a.translate(pi,pi,[-1,-1,0]),a.scale(pi,pi,[2/this.width,2/this.height,1]),this.glCoordMatrix=pi,this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},pi=a.invert(new Float64Array(16),this.pixelMatrix),!pi)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=pi,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.calculateGlobeMatrix(this);const $h=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.transformMat4($h,$h,kt),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=pi;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const f=this.cameraWorldSizeForFog,T=this.cameraPixelsPerMeter,X=this._camera.position,Ve=1/this.height/this._pixelsPerMercatorPixel,kt=[f,f,T];a.scale$2(kt,kt,Ve),a.scale$2(X,X,-1),a.multiply$2(X,X,kt);const Hr=a.create();a.translate(Hr,Hr,X),a.scale(Hr,Hr,kt),this.mercatorFogMatrix=Hr,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(f,T,Ve)}_computeCameraPosition(f){const T=(f=f||this.pixelsPerMeter)/this.pixelsPerMeter,X=this._camera.forward(),Ve=this.point,kt=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*T-f/this.worldSize*this._centerAltitude;return[Ve.x/this.worldSize-X[0]*kt,Ve.y/this.worldSize-X[1]*kt,f/this.worldSize*this._centerAltitude-X[2]*kt]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(f){const T=this._maxCameraBoundsDistance()*Math.cos(this._pitch),X=this._camera.position[2],Ve=f[2];let kt=1;this.projection.wrap&&(this.center=this.center.wrap()),Ve>0&&(kt=Math.min((T-X)/Ve,1)),this._camera.position=a.scaleAndAdd([],this._camera.position,f,kt),this._updateStateFromCamera()}_updateStateFromCamera(){const f=this._camera.position,T=this._camera.forward(),{pitch:X,bearing:Ve}=this._camera.getPitchBearing(),kt=a.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,Hr=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.degToRad(this._maxPitch)),pi=Math.max((f[2]-kt)/Math.cos(X),Hr),Vn=this._zoomFromMercatorZ(pi);a.scaleAndAdd(f,f,T,pi),this._pitch=a.clamp(X,a.degToRad(this.minPitch),a.degToRad(this.maxPitch)),this.angle=a.wrap(Ve,-Math.PI,Math.PI),this._setZoom(a.clamp(Vn,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.MercatorCoordinate(f[0],f[1],f[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(f){return Math.pow(2,f)*this.tileSize}_mercatorZfromZoom(f){return this.cameraToCenterDistance/this._worldSizeFromZoom(f)}_minimumHeightOverTerrain(){const f=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(f)}_zoomFromMercatorZ(f){return this.scaleZoom(this.cameraToCenterDistance/(f*this.tileSize))}zoomFromMercatorZAdjusted(f){let T=0,X=a.GLOBE_ZOOM_THRESHOLD_MAX,Ve=0,kt=1/0;for(;X-T>1e-6&&X>T;){const Hr=T+.5*(X-T),pi=this.tileSize*Math.pow(2,Hr),Vn=this.getCameraToCenterDistance(this.projection,Hr,pi),oa=this.scaleZoom(Vn/(f*this.tileSize)),sa=Math.abs(Hr-oa);sa<kt&&(kt=sa,Ve=Hr),Hr<oa?T=Hr:X=Hr}return Ve}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(f,T){const X=Math.min(f.x,T.x),Ve=Math.max(f.x,T.x),kt=Math.min(f.y,T.y),Hr=Math.max(f.y,T.y);if(kt<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const pi=[new a.Point(X,kt),new a.Point(Ve,Hr),new a.Point(X,Hr),new a.Point(Ve,kt)],Vn=this.renderWorldCopies?-3:0,oa=this.renderWorldCopies?4:1;for(const sa of pi){const dl=this.pointRayIntersection(sa);if(dl.t<0)return!0;const lh=this.rayIntersectionCoordinate(dl);if(lh.x<Vn||lh.y<0||lh.x>oa||lh.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.Point(0,0),new a.Point(this.width,this.height))}zoomDeltaToMovement(f,T){const X=a.length(a.sub([],this._camera.position,f)),Ve=this._zoomFromMercatorZ(X)+T;return X-this._mercatorZfromZoom(Ve)}getCameraPoint(){if(this.projection.name==="globe"){const f=function([T,X,Ve],kt){const Hr=[T,X,Ve,1];a.transformMat4$1(Hr,Hr,kt);const pi=Hr[3]=Math.max(Hr[3],1e-6);return Hr[0]/=pi,Hr[1]/=pi,Hr[2]/=pi,Hr}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.Point(f[0],f[1])}{const f=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.Point(0,f))}}getCameraToCenterDistance(f,T=this.zoom,X=this.worldSize){const Ve=Tm(f,T,this.width,this.height,1024),kt=f.pixelSpaceConversion(this.center.lat,X,Ve);return .5/Math.tan(.5*this._fov)*this.height*kt}getWorldToCameraMatrix(){const f=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&a.multiply(f,f,this.globeMatrix),f}}function w_(F,f){let T=!1,X=null;const Ve=()=>{X=null,T&&(F(),X=setTimeout(Ve,f),T=!1)};return()=>(T=!0,X||Ve(),X)}class ex{constructor(f){this._hashName=f&&encodeURIComponent(f),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=w_(this._updateHashUnthrottled.bind(this),300)}addTo(f){return this._map=f,a.window.addEventListener("hashchange",this._onHashChange,!1),f.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),a.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const f=this._map;if(!f)return"";const T=Bm(f);if(this._hashName){const X=this._hashName;let Ve=!1;const kt=a.window.location.hash.slice(1).split("&").map(Hr=>{const pi=Hr.split("=")[0];return pi===X?(Ve=!0,`${pi}=${T}`):Hr}).filter(Hr=>Hr);return Ve||kt.push(`${X}=${T}`),`#${kt.join("&")}`}return`#${T}`}_getCurrentHash(){const f=a.window.location.hash.replace("#","");if(this._hashName){let T;return f.split("&").map(X=>X.split("=")).forEach(X=>{X[0]===this._hashName&&(T=X)}),(T&&T[1]||"").split("/")}return f.split("/")}_onHashChange(){const f=this._map;if(!f)return!1;const T=this._getCurrentHash();if(T.length>=3&&!T.some(X=>isNaN(X))){const X=f.dragRotate.isEnabled()&&f.touchZoomRotate.isEnabled()?+(T[3]||0):f.getBearing();return f.jumpTo({center:[+T[2],+T[1]],zoom:+T[0],bearing:X,pitch:+(T[4]||0)}),!0}return!1}_updateHashUnthrottled(){const f=a.window.location.href.replace(/(#.+)?$/,this.getHashString());a.window.history.replaceState(a.window.history.state,null,f)}}function Bm(F,f){const T=F.getCenter(),X=Math.round(100*F.getZoom())/100,Ve=Math.ceil((X*Math.LN2+Math.log(512/360/.5))/Math.LN10),kt=Math.pow(10,Ve),Hr=Math.round(T.lng*kt)/kt,pi=Math.round(T.lat*kt)/kt,Vn=F.getBearing(),oa=F.getPitch();let sa=f?`/${Hr}/${pi}/${X}`:`${X}/${pi}/${Hr}`;return(Vn||oa)&&(sa+="/"+Math.round(10*Vn)/10),oa&&(sa+=`/${Math.round(oa)}`),sa}const Eg={linearity:.3,easing:a.bezier(0,0,.3,1)},rv=a.extend({deceleration:2500,maxSpeed:1400},Eg),Uv=a.extend({deceleration:20,maxSpeed:1400},Eg),fd=a.extend({deceleration:1e3,maxSpeed:360},Eg),Um=a.extend({deceleration:1e3,maxSpeed:90},Eg);class Tx{constructor(f){this._map=f,this.clear()}clear(){this._inertiaBuffer=[]}record(f){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:f})}_drainInertiaBuffer(){const f=this._inertiaBuffer,T=a.exported.now();for(;f.length>0&&T-f[0].time>160;)f.shift()}_onMoveEnd(f){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const T={zoom:0,bearing:0,pitch:0,pan:new a.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:kt}of this._inertiaBuffer)T.zoom+=kt.zoomDelta||0,T.bearing+=kt.bearingDelta||0,T.pitch+=kt.pitchDelta||0,kt.panDelta&&T.pan._add(kt.panDelta),kt.around&&(T.around=kt.around),kt.pinchAround&&(T.pinchAround=kt.pinchAround);const X=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,Ve={};if(T.pan.mag()){const kt=Xm(T.pan.mag(),X,a.extend({},rv,f||{}));Ve.offset=T.pan.mult(kt.amount/T.pan.mag()),Ve.center=this._map.transform.center,iv(Ve,kt)}if(T.zoom){const kt=Xm(T.zoom,X,Uv);Ve.zoom=this._map.transform.zoom+kt.amount,iv(Ve,kt)}if(T.bearing){const kt=Xm(T.bearing,X,fd);Ve.bearing=this._map.transform.bearing+a.clamp(kt.amount,-179,179),iv(Ve,kt)}if(T.pitch){const kt=Xm(T.pitch,X,Um);Ve.pitch=this._map.transform.pitch+kt.amount,iv(Ve,kt)}if(Ve.zoom||Ve.bearing){const kt=T.pinchAround===void 0?T.around:T.pinchAround;Ve.around=kt?this._map.unproject(kt):this._map.getCenter()}return this.clear(),Ve.noMoveStart=!0,Ve}}function iv(F,f){(!F.duration||F.duration<f.duration)&&(F.duration=f.duration,F.easing=f.easing)}function Xm(F,f,T){const{maxSpeed:X,linearity:Ve,deceleration:kt}=T,Hr=a.clamp(F*Ve/(f/1e3),-X,X),pi=Math.abs(Hr)/(kt*Ve);return{easing:T.easing,duration:1e3*pi,amount:Hr*(pi/2)}}class tm extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(f,T,X,Ve={}){const kt=ia(T.getCanvasContainer(),X),Hr=T.unproject(kt);super(f,a.extend({point:kt,lngLat:Hr,originalEvent:X},Ve)),this._defaultPrevented=!1,this.target=T}}class Nd extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(f,T,X){const Ve=f==="touchend"?X.changedTouches:X.touches,kt=gl(T.getCanvasContainer(),Ve),Hr=kt.map(Vn=>T.unproject(Vn)),pi=kt.reduce((Vn,oa,sa,dl)=>Vn.add(oa.div(dl.length)),new a.Point(0,0));super(f,{points:kt,point:pi,lngLats:Hr,lngLat:T.unproject(pi),originalEvent:X}),this._defaultPrevented=!1}}class Kd extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(f,T,X){super(f,{originalEvent:X}),this._defaultPrevented=!1}}class nv{constructor(f,T){this._map=f,this._clickTolerance=T.clickTolerance}reset(){this._mousedownPos=void 0}wheel(f){return this._firePreventable(new Kd(f.type,this._map,f))}mousedown(f,T){return this._mousedownPos=T,this._firePreventable(new tm(f.type,this._map,f))}mouseup(f){this._map.fire(new tm(f.type,this._map,f))}preclick(f){const T=a.extend({},f);T.type="preclick",this._map.fire(new tm(T.type,this._map,T))}click(f,T){this._mousedownPos&&this._mousedownPos.dist(T)>=this._clickTolerance||(this.preclick(f),this._map.fire(new tm(f.type,this._map,f)))}dblclick(f){return this._firePreventable(new tm(f.type,this._map,f))}mouseover(f){this._map.fire(new tm(f.type,this._map,f))}mouseout(f){this._map.fire(new tm(f.type,this._map,f))}touchstart(f){return this._firePreventable(new Nd(f.type,this._map,f))}touchmove(f){this._map.fire(new Nd(f.type,this._map,f))}touchend(f){this._map.fire(new Nd(f.type,this._map,f))}touchcancel(f){this._map.fire(new Nd(f.type,this._map,f))}_firePreventable(f){if(this._map.fire(f),f.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class jv{constructor(f){this._map=f}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(f){this._map.fire(new tm(f.type,this._map,f))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new tm("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(f){this._delayContextMenu?this._contextMenuEvent=f:this._map.fire(new tm(f.type,this._map,f)),this._map.listens("contextmenu")&&f.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class tx{constructor(f,T){this._map=f,this._el=f.getCanvasContainer(),this._container=f.getContainer(),this._clickTolerance=T.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(f,T){this.isEnabled()&&f.shiftKey&&f.button===0&&(yi(),this._startPos=this._lastPos=T,this._active=!0)}mousemoveWindow(f,T){if(!this._active)return;const X=T,Ve=this._startPos,kt=this._lastPos;if(!Ve||!kt||kt.equals(X)||!this._box&&X.dist(Ve)<this._clickTolerance)return;this._lastPos=X,this._box||(this._box=Y("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",f));const Hr=Math.min(Ve.x,X.x),pi=Math.max(Ve.x,X.x),Vn=Math.min(Ve.y,X.y),oa=Math.max(Ve.y,X.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${Hr}px,${Vn}px)`,this._box.style.width=pi-Hr+"px",this._box.style.height=oa-Vn+"px")})}mouseupWindow(f,T){if(!this._active)return;const X=this._startPos,Ve=T;if(X&&f.button===0){if(this.reset(),wo(),X.x!==Ve.x||X.y!==Ve.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:f})),{cameraAnimation:kt=>kt.fitScreenCoordinates(X,Ve,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",f)}}keydown(f){this._active&&f.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",f))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Bn(),delete this._startPos,delete this._lastPos}_fireEvent(f,T){return this._map.fire(new a.Event(f,{originalEvent:T}))}}function Am(F,f){const T={};for(let X=0;X<F.length;X++)T[F[X].identifier]=f[X];return T}class ov{constructor(f){this.reset(),this.numTouches=f.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(f,T,X){(this.centroid||X.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=f.timeStamp),X.length===this.numTouches&&(this.centroid=function(Ve){const kt=new a.Point(0,0);for(const Hr of Ve)kt._add(Hr);return kt.div(Ve.length)}(T),this.touches=Am(X,T)))}touchmove(f,T,X){if(this.aborted||!this.centroid)return;const Ve=Am(X,T);for(const kt in this.touches){const Hr=Ve[kt];(!Hr||Hr.dist(this.touches[kt])>30)&&(this.aborted=!0)}}touchend(f,T,X){if((!this.centroid||f.timeStamp-this.startTime>500)&&(this.aborted=!0),X.length===0){const Ve=!this.aborted&&this.centroid;if(this.reset(),Ve)return Ve}}}class xy{constructor(f){this.singleTap=new ov(f),this.numTaps=f.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(f,T,X){this.singleTap.touchstart(f,T,X)}touchmove(f,T,X){this.singleTap.touchmove(f,T,X)}touchend(f,T,X){const Ve=this.singleTap.touchend(f,T,X);if(Ve){const kt=f.timeStamp-this.lastTime<500,Hr=!this.lastTap||this.lastTap.dist(Ve)<30;if(kt&&Hr||this.reset(),this.count++,this.lastTime=f.timeStamp,this.lastTap=Ve,this.count===this.numTaps)return this.reset(),Ve}}}class Cw{constructor(){this._zoomIn=new xy({numTouches:1,numTaps:2}),this._zoomOut=new xy({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(f,T,X){this._zoomIn.touchstart(f,T,X),this._zoomOut.touchstart(f,T,X)}touchmove(f,T,X){this._zoomIn.touchmove(f,T,X),this._zoomOut.touchmove(f,T,X)}touchend(f,T,X){const Ve=this._zoomIn.touchend(f,T,X),kt=this._zoomOut.touchend(f,T,X);return Ve?(this._active=!0,f.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:Hr=>Hr.easeTo({duration:300,zoom:Hr.getZoom()+1,around:Hr.unproject(Ve)},{originalEvent:f})}):kt?(this._active=!0,f.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:Hr=>Hr.easeTo({duration:300,zoom:Hr.getZoom()-1,around:Hr.unproject(kt)},{originalEvent:f})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const By={0:1,2:2};class Pg{constructor(f){this.reset(),this._clickTolerance=f.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(f,T){return!1}_move(f,T){return{}}mousedown(f,T){if(this._lastPoint)return;const X=ml(f);this._correctButton(f,X)&&(this._lastPoint=T,this._eventButton=X)}mousemoveWindow(f,T){const X=this._lastPoint;if(X){if(f.preventDefault(),this._eventButton!=null&&function(Ve,kt){const Hr=By[kt];return Ve.buttons===void 0||(Ve.buttons&Hr)!==Hr}(f,this._eventButton))this.reset();else if(this._moved||!(T.dist(X)<this._clickTolerance))return this._moved=!0,this._lastPoint=T,this._move(X,T)}}mouseupWindow(f){this._lastPoint&&ml(f)===this._eventButton&&(this._moved&&wo(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jg extends Pg{mousedown(f,T){super.mousedown(f,T),this._lastPoint&&(this._active=!0)}_correctButton(f,T){return T===0&&!f.ctrlKey}_move(f,T){return{around:T,panDelta:T.sub(f)}}}class rx extends Pg{_correctButton(f,T){return T===0&&f.ctrlKey||T===2}_move(f,T){const X=.8*(T.x-f.x);if(X)return this._active=!0,{bearingDelta:X}}contextmenu(f){f.preventDefault()}}class b_ extends Pg{_correctButton(f,T){return T===0&&f.ctrlKey||T===2}_move(f,T){const X=-.5*(T.y-f.y);if(X)return this._active=!0,{pitchDelta:X}}contextmenu(f){f.preventDefault()}}class sv{constructor(f,T){this._map=f,this._el=f.getCanvasContainer(),this._minTouches=1,this._clickTolerance=T.clickTolerance||1,this.reset(),a.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.Point(0,0)}touchstart(f,T,X){return this._calculateTransform(f,T,X)}touchmove(f,T,X){if(this._active&&!(X.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(X.length===1&&!a.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return f.cancelable&&f.preventDefault(),this._calculateTransform(f,T,X)}}touchend(f,T,X){this._calculateTransform(f,T,X),this._active&&X.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(f,T,X){X.length>0&&(this._active=!0);const Ve=Am(X,T),kt=new a.Point(0,0),Hr=new a.Point(0,0);let pi=0;for(const oa in Ve){const sa=Ve[oa],dl=this._touches[oa];dl&&(kt._add(sa),Hr._add(sa.sub(dl)),pi++,Ve[oa]=sa)}if(this._touches=Ve,pi<this._minTouches||!Hr.mag())return;const Vn=Hr.div(pi);return this._sum._add(Vn),this._sum.mag()<this._clickTolerance?void 0:{around:kt.div(pi),panDelta:Vn}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Y("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class av{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(f){}_move(f,T,X){return{}}touchstart(f,T,X){this._firstTwoTouches||X.length<2||(this._firstTwoTouches=[X[0].identifier,X[1].identifier],this._start([T[0],T[1]]))}touchmove(f,T,X){const Ve=this._firstTwoTouches;if(!Ve)return;f.preventDefault();const[kt,Hr]=Ve,pi=Ym(X,T,kt),Vn=Ym(X,T,Hr);if(!pi||!Vn)return;const oa=this._aroundCenter?null:pi.add(Vn).div(2);return this._move([pi,Vn],oa,f)}touchend(f,T,X){if(!this._firstTwoTouches)return;const[Ve,kt]=this._firstTwoTouches,Hr=Ym(X,T,Ve),pi=Ym(X,T,kt);Hr&&pi||(this._active&&wo(),this.reset())}touchcancel(){this.reset()}enable(f){this._enabled=!0,this._aroundCenter=!!f&&f.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ym(F,f,T){for(let X=0;X<F.length;X++)if(F[X].identifier===T)return f[X]}function Hv(F,f){return Math.log(F/f)/Math.LN2}class C_ extends av{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(f){this._startDistance=this._distance=f[0].dist(f[1])}_move(f,T){const X=this._distance;if(this._distance=f[0].dist(f[1]),this._active||!(Math.abs(Hv(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Hv(this._distance,X),pinchAround:T}}}function Wv(F,f){return 180*F.angleWith(f)/Math.PI}class qv extends av{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(f){this._startVector=this._vector=f[0].sub(f[1]),this._minDiameter=f[0].dist(f[1])}_move(f,T){const X=this._vector;if(this._vector=f[0].sub(f[1]),X&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Wv(this._vector,X),pinchAround:T}}_isBelowThreshold(f){this._minDiameter=Math.min(this._minDiameter,f.mag());const T=25/(Math.PI*this._minDiameter)*360,X=this._startVector;if(!X)return!1;const Ve=Wv(f,X);return Math.abs(Ve)<T}}function zy(F){return Math.abs(F.y)>Math.abs(F.x)}class lv extends av{constructor(f){super(),this._map=f}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(f){this._lastPoints=f,zy(f[0].sub(f[1]))&&(this._valid=!1)}_move(f,T,X){const Ve=this._lastPoints;if(!Ve)return;const kt=f[0].sub(Ve[0]),Hr=f[1].sub(Ve[1]);return this._map._cooperativeGestures&&!a.isFullscreen()&&X.touches.length<3||(this._valid=this.gestureBeginsVertically(kt,Hr,X.timeStamp),!this._valid)?void 0:(this._lastPoints=f,this._active=!0,{pitchDelta:(kt.y+Hr.y)/2*-.5})}gestureBeginsVertically(f,T,X){if(this._valid!==void 0)return this._valid;const Ve=f.mag()>=2,kt=T.mag()>=2;if(!Ve&&!kt)return;if(!Ve||!kt)return this._firstMove==null&&(this._firstMove=X),X-this._firstMove<100&&void 0;const Hr=f.y>0==T.y>0;return zy(f)&&zy(T)&&Hr}}const E_={panStep:100,bearingStep:15,pitchStep:10};class Ax{constructor(){const f=E_;this._panStep=f.panStep,this._bearingStep=f.bearingStep,this._pitchStep=f.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(f){if(f.altKey||f.ctrlKey||f.metaKey)return;let T=0,X=0,Ve=0,kt=0,Hr=0;switch(f.keyCode){case 61:case 107:case 171:case 187:T=1;break;case 189:case 109:case 173:T=-1;break;case 37:f.shiftKey?X=-1:(f.preventDefault(),kt=-1);break;case 39:f.shiftKey?X=1:(f.preventDefault(),kt=1);break;case 38:f.shiftKey?Ve=1:(f.preventDefault(),Hr=-1);break;case 40:f.shiftKey?Ve=-1:(f.preventDefault(),Hr=1);break;default:return}return this._rotationDisabled&&(X=0,Ve=0),{cameraAnimation:pi=>{const Vn=pi.getZoom();pi.easeTo({duration:300,easeId:"keyboardHandler",easing:v0,zoom:T?Math.round(Vn)+T*(f.shiftKey?2:1):Vn,bearing:pi.getBearing()+X*this._bearingStep,pitch:pi.getPitch()+Ve*this._pitchStep,offset:[-kt*this._panStep,-Hr*this._panStep],center:pi.getCenter()},{originalEvent:f})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function v0(F){return F*(2-F)}const i_=4.000244140625;class x0{constructor(f,T){this._map=f,this._el=f.getCanvasContainer(),this._handler=T,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(f){this._defaultZoomRate=f}setWheelZoomRate(f){this._wheelZoomRate=f}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(f){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!f&&f.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(f){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(f.ctrlKey||f.metaKey||this.isZooming()||a.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let T=f.deltaMode===a.window.WheelEvent.DOM_DELTA_LINE?40*f.deltaY:f.deltaY;const X=a.exported.now(),Ve=X-(this._lastWheelEventTime||0);this._lastWheelEventTime=X,T!==0&&T%i_==0?this._type="wheel":T!==0&&Math.abs(T)<4?this._type="trackpad":Ve>400?(this._type=null,this._lastValue=T,this._timeout=setTimeout(this._onTimeout,40,f)):this._type||(this._type=Math.abs(Ve*T)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,T+=this._lastValue)),f.shiftKey&&T&&(T/=4),this._type&&(this._lastWheelEvent=f,this._delta-=T,this._active||this._start(f)),f.preventDefault()}_onTimeout(f){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(f)}_start(f){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const T=ia(this._el,f);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:T,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const f=this._map.transform;this._type==="wheel"&&f.projection.wrap&&(f._center.lng>=180||f._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const T=()=>f._terrainEnabled()&&this._aroundCoord?f.computeZoomRelativeTo(this._aroundCoord):f.zoom;if(this._delta!==0){const Vn=this._type==="wheel"&&Math.abs(this._delta)>i_?this._wheelZoomRate:this._defaultZoomRate;let oa=2/(1+Math.exp(-Math.abs(this._delta*Vn)));this._delta<0&&oa!==0&&(oa=1/oa);const sa=T(),dl=Math.pow(2,sa),lh=typeof this._targetZoom=="number"?f.zoomScale(this._targetZoom):dl;this._targetZoom=Math.min(f.maxZoom,Math.max(f.minZoom,f.scaleZoom(lh*oa))),this._type==="wheel"&&(this._startZoom=sa,this._easing=this._smoothOutEasing(200)),this._delta=0}const X=typeof this._targetZoom=="number"?this._targetZoom:T(),Ve=this._startZoom,kt=this._easing;let Hr,pi=!1;if(this._type==="wheel"&&Ve&&kt){const Vn=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),oa=kt(Vn);Hr=a.number(Ve,X,oa),Vn<1?this._frameId||(this._frameId=!0):pi=!0}else Hr=X,pi=!0;return this._active=!0,pi&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!pi,zoomDelta:Hr-T(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(f){let T=a.ease;if(this._prevEase){const X=this._prevEase,Ve=(a.exported.now()-X.start)/X.duration,kt=X.easing(Ve+.01)-X.easing(Ve),Hr=.27/Math.sqrt(kt*kt+1e-4)*.01,pi=Math.sqrt(.0729-Hr*Hr);T=a.bezier(Hr,pi,.25,1)}return this._prevEase={start:a.exported.now(),duration:f,easing:T},T}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Y("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(a.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class ix{constructor(f,T){this._clickZoom=f,this._tapZoom=T}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class fm{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(f,T){return f.preventDefault(),{cameraAnimation:X=>{X.easeTo({duration:300,zoom:X.getZoom()+(f.shiftKey?-1:1),around:X.unproject(T)},{originalEvent:f})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class nx{constructor(){this._tap=new xy({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(f,T,X){this._swipePoint||(this._tapTime&&f.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?X.length>0&&(this._swipePoint=T[0],this._swipeTouch=X[0].identifier):this._tap.touchstart(f,T,X))}touchmove(f,T,X){if(this._tapTime){if(this._swipePoint){if(X[0].identifier!==this._swipeTouch)return;const Ve=T[0],kt=Ve.y-this._swipePoint.y;return this._swipePoint=Ve,f.preventDefault(),this._active=!0,{zoomDelta:kt/128}}}else this._tap.touchmove(f,T,X)}touchend(f,T,X){this._tapTime?this._swipePoint&&X.length===0&&this.reset():this._tap.touchend(f,T,X)&&(this._tapTime=f.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class w0{constructor(f,T,X){this._el=f,this._mousePan=T,this._touchPan=X}enable(f){this._inertiaOptions=f||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ot{constructor(f,T,X){this._pitchWithRotate=f.pitchWithRotate,this._mouseRotate=T,this._mousePitch=X}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class m{constructor(f,T,X,Ve){this._el=f,this._touchZoom=T,this._touchRotate=X,this._tapDragZoom=Ve,this._rotationDisabled=!1,this._enabled=!0}enable(f){this._touchZoom.enable(f),this._rotationDisabled||this._touchRotate.enable(f),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const D=F=>F.zoom||F.drag||F.pitch||F.rotate;class Ee extends a.Event{}class ct{constructor(){this.constants=[1,1,.01],this.radius=0}setup(f,T){const X=a.sub([],T,f);this.radius=a.length(X[2]<0?a.div([],X,this.constants):[X[0],X[1],0])}projectRay(f){a.div(f,f,this.constants),a.normalize(f,f),a.mul$1(f,f,this.constants);const T=a.scale$2([],f,this.radius);if(T[2]>0){const X=a.scale$2([],[0,0,1],a.dot(T,[0,0,1])),Ve=a.scale$2([],a.normalize([],[T[0],T[1],0]),this.radius),kt=a.add([],T,a.scale$2([],a.sub([],a.add([],Ve,X),T),2));T[0]=kt[0],T[1]=kt[1]}return T}}function or(F){return F.panDelta&&F.panDelta.mag()||F.zoomDelta||F.bearingDelta||F.pitchDelta}class kn{constructor(f,T){this._map=f,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Tx(f),this._bearingSnap=T.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ct,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(T),a.bindAll(["handleEvent","handleWindowEvent"],this);const X=this._el;this._listeners=[[X,"touchstart",{passive:!0}],[X,"touchmove",{passive:!1}],[X,"touchend",void 0],[X,"touchcancel",void 0],[X,"mousedown",void 0],[X,"mousemove",void 0],[X,"mouseup",void 0],[a.window.document,"mousemove",{capture:!0}],[a.window.document,"mouseup",void 0],[X,"mouseover",void 0],[X,"mouseout",void 0],[X,"dblclick",void 0],[X,"click",void 0],[X,"keydown",{capture:!1}],[X,"keyup",void 0],[X,"wheel",{passive:!1}],[X,"contextmenu",void 0],[a.window,"blur",void 0]];for(const[Ve,kt,Hr]of this._listeners)Ve.addEventListener(kt,Ve===a.window.document?this.handleWindowEvent:this.handleEvent,Hr)}destroy(){for(const[f,T,X]of this._listeners)f.removeEventListener(T,f===a.window.document?this.handleWindowEvent:this.handleEvent,X)}_addDefaultHandlers(f){const T=this._map,X=T.getCanvasContainer();this._add("mapEvent",new nv(T,f));const Ve=T.boxZoom=new tx(T,f);this._add("boxZoom",Ve);const kt=new Cw,Hr=new fm;T.doubleClickZoom=new ix(Hr,kt),this._add("tapZoom",kt),this._add("clickZoom",Hr);const pi=new nx;this._add("tapDragZoom",pi);const Vn=T.touchPitch=new lv(T);this._add("touchPitch",Vn);const oa=new rx(f),sa=new b_(f);T.dragRotate=new ot(f,oa,sa),this._add("mouseRotate",oa,["mousePitch"]),this._add("mousePitch",sa,["mouseRotate"]);const dl=new Jg(f),lh=new sv(T,f);T.dragPan=new w0(X,dl,lh),this._add("mousePan",dl),this._add("touchPan",lh,["touchZoom","touchRotate"]);const gh=new qv,_h=new C_;T.touchZoomRotate=new m(X,_h,gh,pi),this._add("touchRotate",gh,["touchPan","touchZoom"]),this._add("touchZoom",_h,["touchPan","touchRotate"]),this._add("blockableMapEvent",new jv(T));const yh=T.scrollZoom=new x0(T,this);this._add("scrollZoom",yh,["mousePan"]);const xh=T.keyboard=new Ax;this._add("keyboard",xh);for(const yl of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])f.interactive&&f[yl]&&T[yl].enable(f[yl])}_add(f,T,X){this._handlers.push({handlerName:f,handler:T,allowed:X}),this._handlersById[f]=T}stop(f){if(!this._updatingCamera){for(const{handler:T}of this._handlers)T.reset();this._inertia.clear(),this._fireEvents({},{},f),this._changes=[]}}isActive(){for(const{handler:f}of this._handlers)if(f.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!D(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(f,T,X){for(const Ve in f)if(Ve!==X&&(!T||T.indexOf(Ve)<0))return!0;return!1}handleWindowEvent(f){this.handleEvent(f,`${f.type}Window`)}_getMapTouches(f){const T=[];for(const X of f)this._el.contains(X.target)&&T.push(X);return T}handleEvent(f,T){this._updatingCamera=!0;const X=f.type==="renderFrame",Ve=X?void 0:f,kt={needsRenderFrame:!1},Hr={},pi={},Vn=f.touches?this._getMapTouches(f.touches):void 0,oa=Vn?gl(this._el,Vn):X?void 0:ia(this._el,f);for(const{handlerName:lh,handler:gh,allowed:_h}of this._handlers){if(!gh.isEnabled())continue;let yh;this._blockedByActive(pi,_h,lh)?gh.reset():gh[T||f.type]&&(yh=gh[T||f.type](f,oa,Vn),this.mergeHandlerResult(kt,Hr,yh,lh,Ve),yh&&yh.needsRenderFrame&&this._triggerRenderFrame()),(yh||gh.isActive())&&(pi[lh]=gh)}const sa={};for(const lh in this._previousActiveHandlers)pi[lh]||(sa[lh]=Ve);this._previousActiveHandlers=pi,(Object.keys(sa).length||or(kt))&&(this._changes.push([kt,Hr,sa]),this._triggerRenderFrame()),(Object.keys(pi).length||or(kt))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:dl}=kt;dl&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],dl(this._map))}mergeHandlerResult(f,T,X,Ve,kt){if(!X)return;a.extend(f,X);const Hr={handlerName:Ve,originalEvent:X.originalEvent||kt};X.zoomDelta!==void 0&&(T.zoom=Hr),X.panDelta!==void 0&&(T.drag=Hr),X.pitchDelta!==void 0&&(T.pitch=Hr),X.bearingDelta!==void 0&&(T.rotate=Hr)}_applyChanges(){const f={},T={},X={};for(const[Ve,kt,Hr]of this._changes)Ve.panDelta&&(f.panDelta=(f.panDelta||new a.Point(0,0))._add(Ve.panDelta)),Ve.zoomDelta&&(f.zoomDelta=(f.zoomDelta||0)+Ve.zoomDelta),Ve.bearingDelta&&(f.bearingDelta=(f.bearingDelta||0)+Ve.bearingDelta),Ve.pitchDelta&&(f.pitchDelta=(f.pitchDelta||0)+Ve.pitchDelta),Ve.around!==void 0&&(f.around=Ve.around),Ve.aroundCoord!==void 0&&(f.aroundCoord=Ve.aroundCoord),Ve.pinchAround!==void 0&&(f.pinchAround=Ve.pinchAround),Ve.noInertia&&(f.noInertia=Ve.noInertia),a.extend(T,kt),a.extend(X,Hr);this._updateMapTransform(f,T,X),this._changes=[]}_updateMapTransform(f,T,X){const Ve=this._map,kt=Ve.transform,Hr=mh=>[mh.x,mh.y,mh.z];if((mh=>{const bh=this._eventsInProgress.drag;return bh&&!this._handlersById[bh.handlerName].isActive()})()&&!or(f)){const mh=kt.zoom;kt.cameraElevationReference="sea",kt.recenterOnTerrain(),kt.cameraElevationReference="ground",mh!==kt.zoom&&this._map._update(!0)}if(kt._isCameraConstrained&&Ve._stop(!0),!or(f))return void this._fireEvents(T,X,!0);let{panDelta:pi,zoomDelta:Vn,bearingDelta:oa,pitchDelta:sa,around:dl,aroundCoord:lh,pinchAround:gh}=f;kt._isCameraConstrained&&(Vn>0&&(Vn=0),kt._isCameraConstrained=!1),gh!==void 0&&(dl=gh),(Vn||(mh=>T[mh]&&!this._eventsInProgress[mh])("drag"))&&dl&&(this._dragOrigin=Hr(kt.pointCoordinate3D(dl)),this._trackingEllipsoid.setup(kt._camera.position,this._dragOrigin)),kt.cameraElevationReference="sea",Ve._stop(!0),dl=dl||Ve.transform.centerPoint,oa&&(kt.bearing+=oa),sa&&(kt.pitch+=sa),kt._updateCameraState();const _h=[0,0,0];if(pi)if(kt.projection.name==="mercator"){const mh=this._trackingEllipsoid.projectRay(kt.screenPointToMercatorRay(dl).dir),bh=this._trackingEllipsoid.projectRay(kt.screenPointToMercatorRay(dl.sub(pi)).dir);_h[0]=bh[0]-mh[0],_h[1]=bh[1]-mh[1]}else{const mh=kt.pointCoordinate(dl);if(kt.projection.name==="globe"){pi=pi.rotate(-kt.angle);const bh=kt._pixelsPerMercatorPixel/kt.worldSize;_h[0]=-pi.x*a.mercatorScale(a.latFromMercatorY(mh.y))*bh,_h[1]=-pi.y*a.mercatorScale(kt.center.lat)*bh}else{const bh=kt.pointCoordinate(dl.sub(pi));mh&&bh&&(_h[0]=bh.x-mh.x,_h[1]=bh.y-mh.y)}}const yh=kt.zoom,xh=[0,0,0];if(Vn){const mh=Hr(lh||kt.pointCoordinate3D(dl)),bh={dir:a.normalize([],a.sub([],mh,kt._camera.position))};if(bh.dir[2]<0){const Sh=kt.zoomDeltaToMovement(mh,Vn);a.scale$2(xh,bh.dir,Sh)}}const yl=a.add(_h,_h,xh);kt._translateCameraConstrained(yl),Vn&&Math.abs(kt.zoom-yh)>1e-4&&kt.recenterOnTerrain(),kt.cameraElevationReference="ground",this._map._update(),f.noInertia||this._inertia.record(f),this._fireEvents(T,X,!0)}_fireEvents(f,T,X){const Ve=D(this._eventsInProgress),kt=D(f),Hr={};for(const sa in f){const{originalEvent:dl}=f[sa];this._eventsInProgress[sa]||(Hr[`${sa}start`]=dl),this._eventsInProgress[sa]=f[sa]}!Ve&&kt&&this._fireEvent("movestart",kt.originalEvent);for(const sa in Hr)this._fireEvent(sa,Hr[sa]);kt&&this._fireEvent("move",kt.originalEvent);for(const sa in f){const{originalEvent:dl}=f[sa];this._fireEvent(sa,dl)}const pi={};let Vn;for(const sa in this._eventsInProgress){const{handlerName:dl,originalEvent:lh}=this._eventsInProgress[sa];this._handlersById[dl].isActive()||(delete this._eventsInProgress[sa],Vn=T[dl]||lh,pi[`${sa}end`]=Vn)}for(const sa in pi)this._fireEvent(sa,pi[sa]);const oa=D(this._eventsInProgress);if(X&&(Ve||kt)&&!oa){this._updatingCamera=!0;const sa=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),dl=lh=>lh!==0&&-this._bearingSnap<lh&&lh<this._bearingSnap;sa?(dl(sa.bearing||this._map.getBearing())&&(sa.bearing=0),this._map.easeTo(sa,{originalEvent:Vn})):(this._map.fire(new a.Event("moveend",{originalEvent:Vn})),dl(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(f,T){this._map.fire(new a.Event(f,T?{originalEvent:T}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(f=>{this._frameId=void 0,this.handleEvent(new Ee("renderFrame",{timeStamp:f})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const ds="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ps extends a.Evented{constructor(f,T){super(),this._moving=!1,this._zooming=!1,this.transform=f,this._bearingSnap=T.bearingSnap,this._respectPrefersReducedMotion=T.respectPrefersReducedMotion!==!1,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(f,T){return this.jumpTo({center:f},T)}panBy(f,T,X){return f=a.Point.convert(f).mult(-1),this.panTo(this.transform.center,a.extend({offset:f},T),X)}panTo(f,T,X){return this.easeTo(a.extend({center:f},T),X)}getZoom(){return this.transform.zoom}setZoom(f,T){return this.jumpTo({zoom:f},T),this}zoomTo(f,T,X){return this.easeTo(a.extend({zoom:f},T),X)}zoomIn(f,T){return this.zoomTo(this.getZoom()+1,f,T),this}zoomOut(f,T){return this.zoomTo(this.getZoom()-1,f,T),this}getBearing(){return this.transform.bearing}setBearing(f,T){return this.jumpTo({bearing:f},T),this}getPadding(){return this.transform.padding}setPadding(f,T){return this.jumpTo({padding:f},T),this}rotateTo(f,T,X){return this.easeTo(a.extend({bearing:f},T),X)}resetNorth(f,T){return this.rotateTo(0,a.extend({duration:1e3},f),T),this}resetNorthPitch(f,T){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},f),T),this}snapToNorth(f,T){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(f,T):this}getPitch(){return this.transform.pitch}setPitch(f,T){return this.jumpTo({pitch:f},T),this}cameraForBounds(f,T){f=a.LngLatBounds.convert(f);const X=T&&T.bearing||0,Ve=T&&T.pitch||0,kt=f.getNorthWest(),Hr=f.getSouthEast();return this._cameraForBounds(this.transform,kt,Hr,X,Ve,T)}_extendCameraOptions(f){const T={top:0,bottom:0,right:0,left:0};if(typeof(f=a.extend({padding:T,offset:[0,0],maxZoom:this.transform.maxZoom},f)).padding=="number"){const X=f.padding;f.padding={top:X,bottom:X,right:X,left:X}}return f.padding=a.extend(T,f.padding),f}_minimumAABBFrustumDistance(f,T){const X=T.max[0]-T.min[0],Ve=T.max[1]-T.min[1];return X/Ve>f.aspect?X/(2*Math.tan(.5*f.fovX)*f.aspect):Ve/(2*Math.tan(.5*f.fovY)*f.aspect)}_cameraForBoundsOnGlobe(f,T,X,Ve,kt,Hr){const pi=f.clone(),Vn=this._extendCameraOptions(Hr);pi.bearing=Ve,pi.pitch=kt;const oa=a.LngLat.convert(T),sa=a.LngLat.convert(X),dl=.5*(oa.lat+sa.lat),lh=.5*(oa.lng+sa.lng),gh=a.latLngToECEF(dl,lh),_h=a.normalize([],gh),yh=a.normalize([],a.cross([],_h,[0,1,0])),xh=a.cross([],yh,_h),yl=[yh[0],yh[1],yh[2],0,xh[0],xh[1],xh[2],0,_h[0],_h[1],_h[2],0,0,0,0,1],mh=[gh,a.latLngToECEF(oa.lat,oa.lng),a.latLngToECEF(sa.lat,oa.lng),a.latLngToECEF(sa.lat,sa.lng),a.latLngToECEF(oa.lat,sa.lng),a.latLngToECEF(dl,oa.lng),a.latLngToECEF(dl,sa.lng),a.latLngToECEF(oa.lat,lh),a.latLngToECEF(sa.lat,lh)];let bh=a.Aabb.fromPoints(mh.map(Pp=>[a.dot(yh,Pp),a.dot(xh,Pp),a.dot(_h,Pp)]));const Sh=a.transformMat4([],bh.center,yl);a.squaredLength(Sh)===0&&a.set(Sh,0,0,1),a.normalize(Sh,Sh),a.scale$2(Sh,Sh,a.GLOBE_RADIUS),pi.center=a.ecefToLatLng(Sh);const Nh=pi.getWorldToCameraMatrix(),$h=a.invert(new Float64Array(16),Nh);bh=a.Aabb.applyTransform(bh,a.multiply([],Nh,yl)),a.transformMat4(Sh,Sh,Nh);const Vh=.5*(bh.max[2]-bh.min[2]),Wh=this._minimumAABBFrustumDistance(pi,bh),Zh=a.scale$2([],[0,0,1],Vh),rp=a.add(Zh,Sh,Zh),Bp=Wh+(pi.pitch===0?0:a.distance(Sh,rp)),tp=pi.globeCenterInViewSpace,Tp=a.sub([],Sh,[tp[0],tp[1],tp[2]]);a.normalize(Tp,Tp),a.scale$2(Tp,Tp,Bp);const pp=a.add([],Sh,Tp);a.transformMat4(pp,pp,$h);const bp=a.earthRadius/a.GLOBE_RADIUS,np=a.length(pp),wp=a.mercatorZfromAltitude(Math.max(np*bp-a.earthRadius,Number.EPSILON),0),Fp=Math.min(pi.zoomFromMercatorZAdjusted(wp),Vn.maxZoom);return Fp>.5*(a.GLOBE_ZOOM_THRESHOLD_MIN+a.GLOBE_ZOOM_THRESHOLD_MAX)?(pi.setProjection({name:"mercator"}),pi.zoom=Fp,this._cameraForBounds(pi,T,X,Ve,kt,Hr)):{center:pi.center,zoom:Fp,bearing:Ve,pitch:kt}}queryTerrainElevation(f,T){const X=this.transform.elevation;return X?(T=a.extend({},{exaggerated:!0},T),X.getAtPoint(a.MercatorCoordinate.fromLngLat(f),null,T.exaggerated)):null}_cameraForBounds(f,T,X,Ve,kt,Hr){if(f.projection.name==="globe")return this._cameraForBoundsOnGlobe(f,T,X,Ve,kt,Hr);const pi=f.clone(),Vn=this._extendCameraOptions(Hr),oa=pi.padding;pi.bearing=Ve,pi.pitch=kt;const sa=a.LngLat.convert(T),dl=a.LngLat.convert(X),lh=new a.LngLat(sa.lng,dl.lat),gh=new a.LngLat(dl.lng,sa.lat),_h=pi.project(sa),yh=pi.project(dl),xh=this.queryTerrainElevation(sa),yl=this.queryTerrainElevation(dl),mh=this.queryTerrainElevation(lh),bh=this.queryTerrainElevation(gh),Sh=[[_h.x,_h.y,Math.min(xh||0,yl||0,mh||0,bh||0)],[yh.x,yh.y,Math.max(xh||0,yl||0,mh||0,bh||0)]];let Nh=a.Aabb.fromPoints(Sh);const $h=pi.getWorldToCameraMatrix(),Vh=a.invert(new Float64Array(16),$h);Nh=a.Aabb.applyTransform(Nh,$h);const Wh=a.sub([],Nh.max,Nh.min),Zh=oa.left||0,rp=oa.right||0,Bp=oa.bottom||0,tp=oa.top||0,{left:Tp,right:pp,top:bp,bottom:np}=Vn.padding,wp=.5*(Zh+rp),Fp=.5*(tp+Bp),Pp=Math.min(pi.scaleZoom(pi.scale*Math.min((pi.width-(Zh+rp+Tp+pp))/Wh[0],(pi.height-(Bp+tp+np+bp))/Wh[1])),Vn.maxZoom),Up=pi.scale/pi.zoomScale(Pp);Nh=new a.Aabb([Nh.min[0]-(Tp+wp)*Up,Nh.min[1]-(np+Fp)*Up,Nh.min[2]],[Nh.max[0]+(pp+wp)*Up,Nh.max[1]+(bp+Fp)*Up,Nh.max[2]]);const zd=.5*Wh[2],jf=this._minimumAABBFrustumDistance(pi,Nh),Pd=[0,0,1,0];a.transformMat4$1(Pd,Pd,$h),a.normalize$2(Pd,Pd);const Zd=a.scale$2([],Pd,jf+zd),ig=a.add([],Nh.center,Zd),Jf=(typeof Vn.offset.x=="number"&&typeof Vn.offset.y=="number"?new a.Point(Vn.offset.x,Vn.offset.y):a.Point.convert(Vn.offset)).rotate(-a.degToRad(Ve));Nh.center[0]-=Jf.x*Up,Nh.center[1]+=Jf.y*Up,a.transformMat4(Nh.center,Nh.center,Vh),a.transformMat4(ig,ig,Vh);const Bd=[Nh.center[0],Nh.center[1],ig[2]*pi.pixelsPerMeter];a.scale$2(Bd,Bd,1/pi.worldSize);const fg=a.lngFromMercatorX(Bd[0]),Sg=a.latFromMercatorY(Bd[1]),Tg=Math.min(pi._zoomFromMercatorZ(Bd[2]),Vn.maxZoom),gg=new a.LngLat(fg,Sg);return pi.mercatorFromTransition&&Tg<.5*(a.GLOBE_ZOOM_THRESHOLD_MIN+a.GLOBE_ZOOM_THRESHOLD_MAX)?(pi.setProjection({name:"globe"}),pi.zoom=Tg,this._cameraForBounds(pi,T,X,Ve,kt,Hr)):{center:gg,zoom:Tg,bearing:Ve,pitch:kt}}fitBounds(f,T,X){const Ve=this.cameraForBounds(f,T);return this._fitInternal(Ve,T,X)}fitScreenCoordinates(f,T,X,Ve,kt){const Hr=a.Point.convert(f),pi=a.Point.convert(T),Vn=new a.Point(Math.min(Hr.x,pi.x),Math.min(Hr.y,pi.y)),oa=new a.Point(Math.max(Hr.x,pi.x),Math.max(Hr.y,pi.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(Hr,pi))return this;const sa=this.transform.pointLocation3D(Vn),dl=this.transform.pointLocation3D(oa),lh=this.transform.pointLocation3D(new a.Point(Vn.x,oa.y)),gh=this.transform.pointLocation3D(new a.Point(oa.x,Vn.y)),_h=[Math.min(sa.lng,dl.lng,lh.lng,gh.lng),Math.min(sa.lat,dl.lat,lh.lat,gh.lat)],yh=[Math.max(sa.lng,dl.lng,lh.lng,gh.lng),Math.max(sa.lat,dl.lat,lh.lat,gh.lat)],xh=Ve&&Ve.pitch?Ve.pitch:this.getPitch(),yl=this._cameraForBounds(this.transform,_h,yh,X,xh,Ve);return this._fitInternal(yl,Ve,kt)}_fitInternal(f,T,X){return f?(delete(T=a.extend(f,T)).padding,T.linear?this.easeTo(T,X):this.flyTo(T,X)):this}jumpTo(f,T){this.stop();const X=f.preloadOnly?this.transform.clone():this.transform;let Ve=!1,kt=!1,Hr=!1;return"zoom"in f&&X.zoom!==+f.zoom&&(Ve=!0,X.zoom=+f.zoom),f.center!==void 0&&(X.center=a.LngLat.convert(f.center)),"bearing"in f&&X.bearing!==+f.bearing&&(kt=!0,X.bearing=+f.bearing),"pitch"in f&&X.pitch!==+f.pitch&&(Hr=!0,X.pitch=+f.pitch),f.padding==null||X.isPaddingEqual(f.padding)||(X.padding=f.padding),f.preloadOnly?(this._preloadTiles(X),this):(this.fire(new a.Event("movestart",T)).fire(new a.Event("move",T)),Ve&&this.fire(new a.Event("zoomstart",T)).fire(new a.Event("zoom",T)).fire(new a.Event("zoomend",T)),kt&&this.fire(new a.Event("rotatestart",T)).fire(new a.Event("rotate",T)).fire(new a.Event("rotateend",T)),Hr&&this.fire(new a.Event("pitchstart",T)).fire(new a.Event("pitch",T)).fire(new a.Event("pitchend",T)),this.fire(new a.Event("moveend",T)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.warnOnce(ds),this.transform.getFreeCameraOptions()}setFreeCameraOptions(f,T){const X=this.transform;if(!X.projection.supportsFreeCamera)return a.warnOnce(ds),this;this.stop();const Ve=X.zoom,kt=X.pitch,Hr=X.bearing;X.setFreeCameraOptions(f);const pi=Ve!==X.zoom,Vn=kt!==X.pitch,oa=Hr!==X.bearing;return this.fire(new a.Event("movestart",T)).fire(new a.Event("move",T)),pi&&this.fire(new a.Event("zoomstart",T)).fire(new a.Event("zoom",T)).fire(new a.Event("zoomend",T)),oa&&this.fire(new a.Event("rotatestart",T)).fire(new a.Event("rotate",T)).fire(new a.Event("rotateend",T)),Vn&&this.fire(new a.Event("pitchstart",T)).fire(new a.Event("pitch",T)).fire(new a.Event("pitchend",T)),this.fire(new a.Event("moveend",T)),this}easeTo(f,T){this._stop(!1,f.easeId),((f=a.extend({offset:[0,0],duration:500,easing:a.ease},f)).animate===!1||this._prefersReducedMotion(f))&&(f.duration=0);const X=this.transform,Ve=this.getZoom(),kt=this.getBearing(),Hr=this.getPitch(),pi=this.getPadding(),Vn="zoom"in f?+f.zoom:Ve,oa="bearing"in f?this._normalizeBearing(f.bearing,kt):kt,sa="pitch"in f?+f.pitch:Hr,dl="padding"in f?f.padding:X.padding,lh=a.Point.convert(f.offset);let gh,_h,yh;if(X.projection.name==="globe"){const Zh=a.MercatorCoordinate.fromLngLat(X.center),rp=lh.rotate(-X.angle);Zh.x+=rp.x/X.worldSize,Zh.y+=rp.y/X.worldSize;const Bp=Zh.toLngLat(),tp=a.LngLat.convert(f.center||Bp);this._normalizeCenter(tp),gh=X.centerPoint.add(rp),_h=new a.Point(Zh.x,Zh.y).mult(X.worldSize),yh=new a.Point(a.mercatorXfromLng(tp.lng),a.mercatorYfromLat(tp.lat)).mult(X.worldSize).sub(_h)}else{gh=X.centerPoint.add(lh);const Zh=X.pointLocation(gh),rp=a.LngLat.convert(f.center||Zh);this._normalizeCenter(rp),_h=X.project(Zh),yh=X.project(rp).sub(_h)}const xh=X.zoomScale(Vn-Ve);let yl,mh;f.around&&(yl=a.LngLat.convert(f.around),mh=X.locationPoint(yl));const bh=this._zooming||Vn!==Ve,Sh=this._rotating||kt!==oa,Nh=this._pitching||sa!==Hr,$h=!X.isPaddingEqual(dl),Vh=Zh=>rp=>{if(bh&&(Zh.zoom=a.number(Ve,Vn,rp)),Sh&&(Zh.bearing=a.number(kt,oa,rp)),Nh&&(Zh.pitch=a.number(Hr,sa,rp)),$h&&(Zh.interpolatePadding(pi,dl,rp),gh=Zh.centerPoint.add(lh)),yl)Zh.setLocationAtPoint(yl,mh);else{const Bp=Zh.zoomScale(Zh.zoom-Ve),tp=Vn>Ve?Math.min(2,xh):Math.max(.5,xh),Tp=Math.pow(tp,1-rp),pp=Zh.unproject(_h.add(yh.mult(rp*Tp)).mult(Bp));Zh.setLocationAtPoint(Zh.renderWorldCopies?pp.wrap():pp,gh)}return f.preloadOnly||this._fireMoveEvents(T),Zh};if(f.preloadOnly){const Zh=this._emulate(Vh,f.duration,X);return this._preloadTiles(Zh),this}const Wh={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=bh,this._rotating=Sh,this._pitching=Nh,this._padding=$h,this._easeId=f.easeId,this._prepareEase(T,f.noMoveStart,Wh),this._ease(Vh(X),Zh=>{X.recenterOnTerrain(),this._afterEase(T,Zh)},f),this}_prepareEase(f,T,X={}){this._moving=!0,this.transform.cameraElevationReference="sea",T||X.moving||this.fire(new a.Event("movestart",f)),this._zooming&&!X.zooming&&this.fire(new a.Event("zoomstart",f)),this._rotating&&!X.rotating&&this.fire(new a.Event("rotatestart",f)),this._pitching&&!X.pitching&&this.fire(new a.Event("pitchstart",f))}_fireMoveEvents(f){this.fire(new a.Event("move",f)),this._zooming&&this.fire(new a.Event("zoom",f)),this._rotating&&this.fire(new a.Event("rotate",f)),this._pitching&&this.fire(new a.Event("pitch",f))}_afterEase(f,T){if(this._easeId&&T&&this._easeId===T)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const X=this._zooming,Ve=this._rotating,kt=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,X&&this.fire(new a.Event("zoomend",f)),Ve&&this.fire(new a.Event("rotateend",f)),kt&&this.fire(new a.Event("pitchend",f)),this.fire(new a.Event("moveend",f))}flyTo(f,T){if(this._prefersReducedMotion(f)){const Pp=a.pick(f,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Pp,T)}this.stop(),f=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},f);const X=this.transform,Ve=this.getZoom(),kt=this.getBearing(),Hr=this.getPitch(),pi=this.getPadding(),Vn="zoom"in f?a.clamp(+f.zoom,X.minZoom,X.maxZoom):Ve,oa="bearing"in f?this._normalizeBearing(f.bearing,kt):kt,sa="pitch"in f?+f.pitch:Hr,dl="padding"in f?f.padding:X.padding,lh=X.zoomScale(Vn-Ve),gh=a.Point.convert(f.offset);let _h=X.centerPoint.add(gh);const yh=X.pointLocation(_h),xh=a.LngLat.convert(f.center||yh);this._normalizeCenter(xh);const yl=X.project(yh),mh=X.project(xh).sub(yl);let bh=f.curve;const Sh=Math.max(X.width,X.height),Nh=Sh/lh,$h=mh.mag();if("minZoom"in f){const Pp=a.clamp(Math.min(f.minZoom,Ve,Vn),X.minZoom,X.maxZoom),Up=Sh/X.zoomScale(Pp-Ve);bh=Math.sqrt(Up/$h*2)}const Vh=bh*bh;function Wh(Pp){const Up=(Nh*Nh-Sh*Sh+(Pp?-1:1)*Vh*Vh*$h*$h)/(2*(Pp?Nh:Sh)*Vh*$h);return Math.log(Math.sqrt(Up*Up+1)-Up)}function Zh(Pp){return(Math.exp(Pp)-Math.exp(-Pp))/2}function rp(Pp){return(Math.exp(Pp)+Math.exp(-Pp))/2}const Bp=Wh(0);let tp=function(Pp){return rp(Bp)/rp(Bp+bh*Pp)},Tp=function(Pp){return Sh*((rp(Bp)*(Zh(Up=Bp+bh*Pp)/rp(Up))-Zh(Bp))/Vh)/$h;var Up},pp=(Wh(1)-Bp)/bh;if(Math.abs($h)<1e-6||!isFinite(pp)){if(Math.abs(Sh-Nh)<1e-6)return this.easeTo(f,T);const Pp=Nh<Sh?-1:1;pp=Math.abs(Math.log(Nh/Sh))/bh,Tp=function(){return 0},tp=function(Up){return Math.exp(Pp*bh*Up)}}f.duration="duration"in f?+f.duration:1e3*pp/("screenSpeed"in f?+f.screenSpeed/bh:+f.speed),f.maxDuration&&f.duration>f.maxDuration&&(f.duration=0);const bp=kt!==oa,np=sa!==Hr,wp=!X.isPaddingEqual(dl),Fp=Pp=>Up=>{const zd=Up*pp,jf=1/tp(zd);Pp.zoom=Up===1?Vn:Ve+Pp.scaleZoom(jf),bp&&(Pp.bearing=a.number(kt,oa,Up)),np&&(Pp.pitch=a.number(Hr,sa,Up)),wp&&(Pp.interpolatePadding(pi,dl,Up),_h=Pp.centerPoint.add(gh));const Pd=Up===1?xh:Pp.unproject(yl.add(mh.mult(Tp(zd))).mult(jf));return Pp.setLocationAtPoint(Pp.renderWorldCopies?Pd.wrap():Pd,_h),Pp._updateCameraOnTerrain(),f.preloadOnly||this._fireMoveEvents(T),Pp};if(f.preloadOnly){const Pp=this._emulate(Fp,f.duration,X);return this._preloadTiles(Pp),this}return this._zooming=!0,this._rotating=bp,this._pitching=np,this._padding=wp,this._prepareEase(T,!1),this._ease(Fp(X),()=>this._afterEase(T),f),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(f,T){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const X=this._onEaseEnd;this._onEaseEnd=void 0,X.call(this,T)}if(!f){const X=this.handlers;X&&X.stop(!1)}return this}_ease(f,T,X){X.animate===!1||X.duration===0?(f(1),T()):(this._easeStart=a.exported.now(),this._easeOptions=X,this._onEaseFrame=f,this._onEaseEnd=T,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const f=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1),T=this._onEaseFrame;T&&T(this._easeOptions.easing(f)),f<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(f,T){f=a.wrap(f,-180,180);const X=Math.abs(f-T);return Math.abs(f-360-T)<X&&(f-=360),Math.abs(f+360-T)<X&&(f+=360),f}_normalizeCenter(f){const T=this.transform;if(!T.renderWorldCopies||T.maxBounds)return;const X=f.lng-T.center.lng;f.lng+=X>180?-360:X<-180?360:0}_prefersReducedMotion(f){return this._respectPrefersReducedMotion&&a.exported.prefersReducedMotion&&!(f&&f.essential)}_emulate(f,T,X){const Ve=Math.ceil(15*T/1e3),kt=[],Hr=f(X.clone());for(let pi=0;pi<=Ve;pi++){const Vn=Hr(pi/Ve);kt.push(Vn.clone())}return kt}}class vs{constructor(f={}){this.options=f,a.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(f){const T=this.options&&this.options.compact;return this._map=f,this._container=Y("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Y("button","mapboxgl-ctrl-attrib-button",this._container),Y("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Y("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),T&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),T===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(f,T){const X=this._map._getUIString(`AttributionControl.${T}`);f.setAttribute("aria-label",X),f.removeAttribute("title"),f.firstElementChild&&f.firstElementChild.setAttribute("title",X)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let f=this._editLink;f||(f=this._editLink=this._container.querySelector(".mapbox-improve-map"));const T=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.config.ACCESS_TOKEN}];if(f){const X=T.reduce((Ve,kt,Hr)=>(kt.value&&(Ve+=`${kt.key}=${kt.value}${Hr<T.length-1?"&":""}`),Ve),"?");f.href=`${a.config.FEEDBACK_URL}/${X}#${Bm(this._map,!0)}`,f.rel="noopener nofollow",this._setElementTitle(f,"MapFeedback")}}_updateData(f){!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let f=[];if(this._map.style.stylesheet){const Ve=this._map.style.stylesheet;this.styleOwner=Ve.owner,this.styleId=Ve.id}const T=this._map.style._sourceCaches;for(const Ve in T){const kt=T[Ve];if(kt.used){const Hr=kt.getSource();Hr.attribution&&f.indexOf(Hr.attribution)<0&&f.push(Hr.attribution)}}f.sort((Ve,kt)=>Ve.length-kt.length),f=f.filter((Ve,kt)=>{for(let Hr=kt+1;Hr<f.length;Hr++)if(f[Hr].indexOf(Ve)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?f=[...this.options.customAttribution,...f]:f.unshift(this.options.customAttribution));const X=f.join(" | ");X!==this._attribHTML&&(this._attribHTML=X,f.length?(this._innerContainer.innerHTML=X,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class fl{constructor(){a.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(f){this._map=f,this._container=Y("div","mapboxgl-ctrl");const T=Y("a","mapboxgl-ctrl-logo");return T.target="_blank",T.rel="noopener nofollow",T.href="https://www.mapbox.com/",T.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),T.setAttribute("rel","noopener nofollow"),this._container.appendChild(T),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(f){f&&f.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const f=this._map.style._sourceCaches;if(Object.entries(f).length===0)return!0;for(const T in f){const X=f[T].getSource();if(X.hasOwnProperty("mapbox_logo")&&!X.mapbox_logo)return!1}return!0}_updateCompact(){const f=this._container.children;if(f.length){const T=f[0];this._map.getCanvasContainer().offsetWidth<250?T.classList.add("mapboxgl-compact"):T.classList.remove("mapboxgl-compact")}}}class pl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(f){const T=++this._id;return this._queue.push({callback:f,id:T,cancelled:!1}),T}remove(f){const T=this._currentlyRunning,X=T?this._queue.concat(T):this._queue;for(const Ve of X)if(Ve.id===f)return void(Ve.cancelled=!0)}run(f=0){const T=this._currentlyRunning=this._queue;this._queue=[];for(const X of T)if(!X.cancelled&&(X.callback(f),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function ph(F,f,T){if(F=new a.LngLat(F.lng,F.lat),f){const X=new a.LngLat(F.lng-360,F.lat),Ve=new a.LngLat(F.lng+360,F.lat),kt=360*Math.ceil(Math.abs(F.lng-T.center.lng)/360),Hr=T.locationPoint(F).distSqr(f),pi=f.x<0||f.y<0||f.x>T.width||f.y>T.height;T.locationPoint(X).distSqr(f)<Hr&&(pi||Math.abs(X.lng-T.center.lng)<kt)?F=X:T.locationPoint(Ve).distSqr(f)<Hr&&(pi||Math.abs(Ve.lng-T.center.lng)<kt)&&(F=Ve)}for(;Math.abs(F.lng-T.center.lng)>180;){const X=T.locationPoint(F);if(X.x>=0&&X.y>=0&&X.x<=T.width&&X.y<=T.height)break;F.lng>T.center.lng?F.lng-=360:F.lng+=360}return F}const Ah={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class hh extends a.Evented{constructor(f,T){if(super(),(f instanceof a.window.HTMLElement||T)&&(f=a.extend({element:f},T)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=f&&f.anchor||"center",this._color=f&&f.color||"#3FB1CE",this._scale=f&&f.scale||1,this._draggable=f&&f.draggable||!1,this._clickTolerance=f&&f.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=f&&f.rotation||0,this._rotationAlignment=f&&f.rotationAlignment||"auto",this._pitchAlignment=f&&f.pitchAlignment&&f.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=f&&f.occludedOpacity||.2,f&&f.element)this._element=f.element,this._offset=a.Point.convert(f&&f.offset||[0,0]);else{this._defaultMarker=!0,this._element=Y("div");const Ve=41,kt=27,Hr=ze("svg",{display:"block",height:Ve*this._scale+"px",width:kt*this._scale+"px",viewBox:`0 0 ${kt} ${Ve}`},this._element),pi=ze("radialGradient",{id:"shadowGradient"},ze("defs",{},Hr));ze("stop",{offset:"10%","stop-opacity":.4},pi),ze("stop",{offset:"100%","stop-opacity":.05},pi),ze("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},Hr),ze("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},Hr),ze("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},Hr),ze("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},Hr),this._offset=a.Point.convert(f&&f.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",Ve=>{Ve.preventDefault()}),this._element.addEventListener("mousedown",Ve=>{Ve.preventDefault()});const X=this._element.classList;for(const Ve in Ah)X.remove(`mapboxgl-marker-anchor-${Ve}`);X.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(f){return f===this._map||(this.remove(),this._map=f,f.getCanvasContainer().appendChild(this._element),f.on("move",this._updateMoving),f.on("moveend",this._update),f.on("remove",this._clearFadeTimer),f._addMarker(this),this.setDraggable(this._draggable),this._update(),f.on("click",this._onMapClick)),this}remove(){const f=this._map;return f&&(f.off("click",this._onMapClick),f.off("move",this._updateMoving),f.off("moveend",this._update),f.off("mousedown",this._addDragHandler),f.off("touchstart",this._addDragHandler),f.off("mouseup",this._onUp),f.off("touchend",this._onUp),f.off("mousemove",this._onMove),f.off("touchmove",this._onMove),f.off("remove",this._clearFadeTimer),f._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=a.LngLat.convert(f),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(f){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),f){if(!("offset"in f.options)){const Ve=Math.sqrt(Math.pow(13.5,2)/2);f.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[Ve,-1*(38.1-13.5+Ve)],"bottom-right":[-Ve,-1*(38.1-13.5+Ve)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=f,f._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(f){const T=f.code,X=f.charCode||f.keyCode;T!=="Space"&&T!=="Enter"&&X!==32&&X!==13||this.togglePopup()}_onMapClick(f){const T=f.originalEvent.target,X=this._element;this._popup&&(T===X||X.contains(T))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const f=this._popup;return f?(f.isOpen()?(f.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(f.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const f=this._map,T=this._pos;if(!f||!T)return!1;const X=f.unproject(T),Ve=f.getFreeCameraOptions();if(!Ve.position)return!1;const kt=Ve.position.toLngLat();return kt.distanceTo(X)<.9*kt.distanceTo(this._lngLat)}_evaluateOpacity(){const f=this._map;if(!f)return;const T=this._pos;if(!T||T.x<0||T.x>f.transform.width||T.y<0||T.y>f.transform.height)return void this._clearFadeTimer();const X=f.unproject(T);let Ve;f._showingGlobe()&&a.isLngLatBehindGlobe(f.transform,this._lngLat)?Ve=0:(Ve=1-f._queryFogOpacity(X),f.transform._terrainEnabled()&&f.getTerrain()&&this._behindTerrain()&&(Ve*=this._occludedOpacity)),this._element.style.opacity=`${Ve}`,this._element.style.pointerEvents=Ve>0?"auto":"none",this._popup&&this._popup._setOpacity(Ve),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const f=this._pos;if(!f||!this._map)return;const T=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${f.x}px,${f.y}px)
            ${Ah[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${T.x}px,${T.y}px)
        `}_calculateXYTransform(){const f=this._pos,T=this._map,X=this.getPitchAlignment();if(!T||!f||X!=="map")return"";if(!T._showingGlobe()){const Vn=T.getPitch();return Vn?`rotateX(${Vn}deg)`:""}const Ve=a.radToDeg(a.globeTiltAtLngLat(T.transform,this._lngLat)),kt=f.sub(a.globeCenterToScreenPoint(T.transform)),Hr=Math.abs(kt.x)+Math.abs(kt.y);if(Hr===0)return"";const pi=Ve/Hr;return`rotateX(${-kt.y*pi}deg) rotateY(${kt.x*pi}deg)`}_calculateZTransform(){const f=this._pos,T=this._map;if(!T||!f)return"";let X=0;const Ve=this.getRotationAlignment();if(Ve==="map")if(T._showingGlobe()){const kt=T.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),Hr=T.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(kt);X=a.radToDeg(Math.atan2(Hr.y,Hr.x))-90}else X=-T.getBearing();else if(Ve==="horizon"){const kt=a.smoothstep(4,6,T.getZoom()),Hr=a.globeCenterToScreenPoint(T.transform);Hr.y+=kt*T.transform.height;const pi=f.sub(Hr),Vn=a.radToDeg(Math.atan2(pi.y,pi.x));X=(Vn>90?Vn-270:Vn+90)*(1-kt)}return X+=this._rotation,X?`rotateZ(${X}deg)`:""}_update(f){a.window.cancelAnimationFrame(this._updateFrameId);const T=this._map;T&&(T.transform.renderWorldCopies&&(this._lngLat=ph(this._lngLat,this._pos,T.transform)),this._pos=T.project(this._lngLat),f===!0?this._updateFrameId=a.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),T._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(T._showingGlobe()||T.getTerrain()||T.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(f){return this._offset=a.Point.convert(f),this._update(),this}_onMove(f){const T=this._map;if(!T)return;const X=this._pointerdownPos,Ve=this._positionDelta;if(X&&Ve){if(!this._isDragging){const kt=this._clickTolerance||T._clickTolerance;if(f.point.dist(X)<kt)return;this._isDragging=!0}this._pos=f.point.sub(Ve),this._lngLat=T.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const f=this._map;f&&(f.off("mousemove",this._onMove),f.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(f){const T=this._map,X=this._pos;T&&X&&this._element.contains(f.originalEvent.target)&&(f.preventDefault(),this._positionDelta=f.point.sub(X),this._pointerdownPos=f.point,this._state="pending",T.on("mousemove",this._onMove),T.on("touchmove",this._onMove),T.once("mouseup",this._onUp),T.once("touchend",this._onUp))}setDraggable(f){this._draggable=!!f;const T=this._map;return T&&(f?(T.on("mousedown",this._addDragHandler),T.on("touchstart",this._addDragHandler)):(T.off("mousedown",this._addDragHandler),T.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(f){return this._rotation=f||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(f){return this._rotationAlignment=f||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(f){return this._pitchAlignment=f||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(f){return this._occludedOpacity=f||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Rh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Gh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Kh(F=new a.Point(0,0),f="bottom"){if(typeof F=="number"){const T=Math.round(Math.sqrt(.5*Math.pow(F,2)));switch(f){case"top":return new a.Point(0,F);case"top-left":return new a.Point(T,T);case"top-right":return new a.Point(-T,T);case"bottom":return new a.Point(0,-F);case"bottom-left":return new a.Point(T,-T);case"bottom-right":return new a.Point(-T,-T);case"left":return new a.Point(F,0);case"right":return new a.Point(-F,0)}return new a.Point(0,0)}return F instanceof a.Point||Array.isArray(F)?a.Point.convert(F):a.Point.convert(F[f]||[0,0])}class ap{constructor(f){this.jumpTo(f)}getValue(f){if(f<=this._startTime)return this._start;if(f>=this._endTime)return this._end;const T=a.easeCubicInOut((f-this._startTime)/(this._endTime-this._startTime));return this._start*(1-T)+this._end*T}isEasing(f){return f>=this._startTime&&f<=this._endTime}jumpTo(f){this._startTime=-1/0,this._endTime=-1/0,this._start=f,this._end=f}easeTo(f,T,X){this._start=this.getValue(T),this._end=f,this._startTime=T,this._endTime=T+X}}const Lh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},op={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},yp={showCompass:!0,showZoom:!0,visualizePitch:!1};class Np{constructor(f,T,X=!1){this._clickTolerance=10,this.element=T,this.mouseRotate=new rx({clickTolerance:f.dragRotate._mouseRotate._clickTolerance}),this.map=f,X&&(this.mousePitch=new b_({clickTolerance:f.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),T.addEventListener("mousedown",this.mousedown),T.addEventListener("touchstart",this.touchstart,{passive:!1}),T.addEventListener("touchmove",this.touchmove),T.addEventListener("touchend",this.touchend),T.addEventListener("touchcancel",this.reset)}down(f,T){this.mouseRotate.mousedown(f,T),this.mousePitch&&this.mousePitch.mousedown(f,T),yi()}move(f,T){const X=this.map,Ve=this.mouseRotate.mousemoveWindow(f,T),kt=Ve&&Ve.bearingDelta;if(kt&&X.setBearing(X.getBearing()+kt),this.mousePitch){const Hr=this.mousePitch.mousemoveWindow(f,T),pi=Hr&&Hr.pitchDelta;pi&&X.setPitch(X.getPitch()+pi)}}off(){const f=this.element;f.removeEventListener("mousedown",this.mousedown),f.removeEventListener("touchstart",this.touchstart,{passive:!1}),f.removeEventListener("touchmove",this.touchmove),f.removeEventListener("touchend",this.touchend),f.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Bn(),a.window.removeEventListener("mousemove",this.mousemove),a.window.removeEventListener("mouseup",this.mouseup)}mousedown(f){this.down(a.extend({},f,{ctrlKey:!0,preventDefault:()=>f.preventDefault()}),ia(this.element,f)),a.window.addEventListener("mousemove",this.mousemove),a.window.addEventListener("mouseup",this.mouseup)}mousemove(f){this.move(f,ia(this.element,f))}mouseup(f){this.mouseRotate.mouseupWindow(f),this.mousePitch&&this.mousePitch.mouseupWindow(f),this.offTemp()}touchstart(f){f.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=gl(this.element,f.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>f.preventDefault()},this._startPos))}touchmove(f){f.targetTouches.length!==1?this.reset():(this._lastPos=gl(this.element,f.targetTouches)[0],this.move({preventDefault:()=>f.preventDefault()},this._lastPos))}touchend(f){f.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const jp={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},td={maxWidth:100,unit:"metric"},Vp={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},gd={version:a.version,supported:y,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends ps{constructor(F){if(a.LivePerformanceUtils.mark(a.PerformanceMarkers.create),(F=a.extend({},op,F)).minZoom!=null&&F.maxZoom!=null&&F.minZoom>F.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(F.minPitch!=null&&F.maxPitch!=null&&F.minPitch>F.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(F.minPitch!=null&&F.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(F.maxPitch!=null&&F.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(F.antialias&&a.isSafariWithAntialiasingBug(a.window)&&(F.antialias=!1,a.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new r_(F.minZoom,F.maxZoom,F.minPitch,F.maxPitch,F.renderWorldCopies),F),this._interactive=F.interactive,this._minTileCacheSize=F.minTileCacheSize,this._maxTileCacheSize=F.maxTileCacheSize,this._failIfMajorPerformanceCaveat=F.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=F.preserveDrawingBuffer,this._antialias=F.antialias,this._useWebGL2=F.useWebGL2,this._trackResize=F.trackResize,this._bearingSnap=F.bearingSnap,this._refreshExpiredTiles=F.refreshExpiredTiles,this._fadeDuration=F.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=F.crossSourceCollisions,this._collectResourceTiming=F.collectResourceTiming,this._optimizeForTerrain=F.optimizeForTerrain,this._language=this._parseLanguage(F.language),this._worldview=F.worldview,this._renderTaskQueue=new pl,this._domRenderTaskQueue=new pl,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.uniqueId(),this._locale=a.extend({},Lh,F.locale),this._clickTolerance=F.clickTolerance,this._cooperativeGestures=F.cooperativeGestures,this._performanceMetricsCollection=F.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ap(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new a.RequestManager(F.transformRequest,F.accessToken,F.testMode),this._silenceAuthErrors=!!F.testMode,typeof F.container=="string"){if(this._container=a.window.document.getElementById(F.container),!this._container)throw new Error(`Container '${F.container}' not found.`)}else{if(!(F.container instanceof a.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=F.container}if(this._container.childNodes.length>0&&a.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),F.maxBounds&&this.setMaxBounds(F.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),a.window!==void 0&&(a.window.addEventListener("online",this._onWindowOnline,!1),a.window.addEventListener("resize",this._onWindowResize,!1),a.window.addEventListener("orientationchange",this._onWindowResize,!1),a.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new kn(this,F),this._localFontFamily=F.localFontFamily,this._localIdeographFontFamily=F.localIdeographFontFamily,F.style&&this.setStyle(F.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),F.projection&&this.setProjection(F.projection),this._hash=F.hash&&new ex(typeof F.hash=="string"&&F.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:F.center,zoom:F.zoom,bearing:F.bearing,pitch:F.pitch}),F.bounds&&(this.resize(),this.fitBounds(F.bounds,a.extend({},F.fitBoundsOptions,{duration:0})))),this.resize(),F.attributionControl&&this.addControl(new vs({customAttribution:F.customAttribution})),this._logoControl=new fl,this.addControl(this._logoControl,F.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",f=>{this._update(f.dataType==="style"),this.fire(new a.Event(`${f.dataType}data`,f))}),this.on("dataloading",f=>{this.fire(new a.Event(`${f.dataType}dataloading`,f))})}_getMapId(){return this._mapId}addControl(F,f){if(f===void 0&&(f=F.getDefaultPosition?F.getDefaultPosition():"top-right"),!F||!F.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const T=F.onAdd(this);this._controls.push(F);const X=this._controlPositions[f];return f.indexOf("bottom")!==-1?X.insertBefore(T,X.firstChild):X.appendChild(T),this}removeControl(F){if(!F||!F.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const f=this._controls.indexOf(F);return f>-1&&this._controls.splice(f,1),F.onRemove(this),this}hasControl(F){return this._controls.indexOf(F)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(F){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const f=!this._moving;return f&&this.fire(new a.Event("movestart",F)).fire(new a.Event("move",F)),this.fire(new a.Event("resize",F)),f&&this.fire(new a.Event("moveend",F)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(F){return this.transform.setMaxBounds(a.LngLatBounds.convert(F)),this._update()}setMinZoom(F){if((F=F??-2)>=-2&&F<=this.transform.maxZoom)return this.transform.minZoom=F,this._update(),this.getZoom()<F?this.setZoom(F):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(F){if((F=F??22)>=this.transform.minZoom)return this.transform.maxZoom=F,this._update(),this.getZoom()>F?this.setZoom(F):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(F){if((F=F??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(F>=0&&F<=this.transform.maxPitch)return this.transform.minPitch=F,this._update(),this.getPitch()<F?this.setPitch(F):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(F){if((F=F??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(F>=this.transform.minPitch)return this.transform.maxPitch=F,this._update(),this.getPitch()>F?this.setPitch(F):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(F){return this.transform.renderWorldCopies=F,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(F){return F==="auto"?a.window.navigator.language:Array.isArray(F)?F.length===0?void 0:F.map(f=>f==="auto"?a.window.navigator.language:f):F}setLanguage(F){const f=this._parseLanguage(F);if(!this.style||f===this._language)return this;this._language=f,this.style._reloadSources();for(const T of this._controls)T._setLanguage&&T._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(F){return this.style&&F!==this._worldview?(this._worldview=F,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(F){return this._lazyInitEmptyStyle(),F?typeof F=="string"&&(F={name:F}):F=null,this._useExplicitProjection=!!F,this._prioritizeAndUpdateProjection(F,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const F=this.transform,f=F.projection.name;let T;f==="globe"&&F.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?(F.setMercatorFromTransition(),T=!0):f==="mercator"&&F.zoom<a.GLOBE_ZOOM_THRESHOLD_MAX&&(F.setProjection({name:"globe"}),T=!0),T&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(F,f){return this._updateProjection(F||f||{name:"mercator"})}_updateProjection(F){let f;if(f=F.name==="globe"&&this.transform.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(F),this.style.applyProjectionUpdate(),f){this.painter.clearBackgroundTiles();for(const T in this.style._sourceCaches)this.style._sourceCaches[T].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(F){return this.transform.locationPoint3D(a.LngLat.convert(F))}unproject(F){return this.transform.pointLocation3D(a.Point.convert(F))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(F,f,T){if(F==="mouseenter"||F==="mouseover"){let X=!1;const Ve=Hr=>{const pi=f.filter(oa=>this.getLayer(oa)),Vn=pi.length?this.queryRenderedFeatures(Hr.point,{layers:pi}):[];Vn.length?X||(X=!0,T.call(this,new tm(F,this,Hr.originalEvent,{features:Vn}))):X=!1},kt=()=>{X=!1};return{layers:new Set(f),listener:T,delegates:{mousemove:Ve,mouseout:kt}}}if(F==="mouseleave"||F==="mouseout"){let X=!1;const Ve=Hr=>{const pi=f.filter(Vn=>this.getLayer(Vn));(pi.length?this.queryRenderedFeatures(Hr.point,{layers:pi}):[]).length?X=!0:X&&(X=!1,T.call(this,new tm(F,this,Hr.originalEvent)))},kt=Hr=>{X&&(X=!1,T.call(this,new tm(F,this,Hr.originalEvent)))};return{layers:new Set(f),listener:T,delegates:{mousemove:Ve,mouseout:kt}}}{const X=Ve=>{const kt=f.filter(pi=>this.getLayer(pi)),Hr=kt.length?this.queryRenderedFeatures(Ve.point,{layers:kt}):[];Hr.length&&(Ve.features=Hr,T.call(this,Ve),delete Ve.features)};return{layers:new Set(f),listener:T,delegates:{[F]:X}}}}on(F,f,T){if(T===void 0)return super.on(F,f);Array.isArray(f)||(f=[f]);const X=this._createDelegatedListener(F,f,T);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[F]=this._delegatedListeners[F]||[],this._delegatedListeners[F].push(X);for(const Ve in X.delegates)this.on(Ve,X.delegates[Ve]);return this}once(F,f,T){if(T===void 0)return super.once(F,f);Array.isArray(f)||(f=[f]);const X=this._createDelegatedListener(F,f,T);for(const Ve in X.delegates)this.once(Ve,X.delegates[Ve]);return this}off(F,f,T){if(T===void 0)return super.off(F,f);f=new Set(Array.isArray(f)?f:[f]);const X=(kt,Hr)=>{if(kt.size!==Hr.size)return!1;for(const pi of kt)if(!Hr.has(pi))return!1;return!0},Ve=this._delegatedListeners?this._delegatedListeners[F]:void 0;return Ve&&(kt=>{for(let Hr=0;Hr<kt.length;Hr++){const pi=kt[Hr];if(pi.listener===T&&X(pi.layers,f)){for(const Vn in pi.delegates)this.off(Vn,pi.delegates[Vn]);return kt.splice(Hr,1),this}}})(Ve),this}queryRenderedFeatures(F,f){return this.style?(f!==void 0||F===void 0||F instanceof a.Point||Array.isArray(F)||(f=F,F=void 0),this.style.queryRenderedFeatures(F=F||[[0,0],[this.transform.width,this.transform.height]],f=f||{},this.transform)):[]}querySourceFeatures(F,f){return this.style.querySourceFeatures(F,f)}isPointOnSurface(F){const{name:f}=this.transform.projection;return f!=="globe"&&f!=="mercator"&&a.warnOnce(`${f} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(a.Point.convert(F))}setStyle(F,f){return(f=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},f)).diff!==!1&&f.localIdeographFontFamily===this._localIdeographFontFamily&&f.localFontFamily===this._localFontFamily&&this.style&&F?(this._diffStyle(F,f),this):(this._localIdeographFontFamily=f.localIdeographFontFamily,this._localFontFamily=f.localFontFamily,this._updateStyle(F,f))}_getUIString(F){const f=this._locale[F];if(f==null)throw new Error(`Missing UI string '${F}'`);return f}_updateStyle(F,f){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),F&&(this.style=new Ny(this,f||{}),this.style.setEventedParent(this,{style:this.style}),typeof F=="string"?this.style.loadURL(F):this.style.loadJSON(F)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ny(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(F,f){if(typeof F=="string"){const T=this._requestManager.normalizeStyleURL(F),X=this._requestManager.transformRequest(T,a.ResourceType.Style);a.getJSON(X,(Ve,kt)=>{Ve?this.fire(new a.ErrorEvent(Ve)):kt&&this._updateDiff(kt,f)})}else typeof F=="object"&&this._updateDiff(F,f)}_updateDiff(F,f){try{this.style.setState(F)&&this._update(!0)}catch(T){a.warnOnce(`Unable to perform style diff: ${T.message||T.error||T}.  Rebuilding the style from scratch.`),this._updateStyle(F,f)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.warnOnce("There is no style added to the map."),!1)}addSource(F,f){return this._lazyInitEmptyStyle(),this.style.addSource(F,f),this._update(!0)}isSourceLoaded(F){return!!this.style&&this.style._isSourceCacheLoaded(F)}areTilesLoaded(){const F=this.style&&this.style._sourceCaches;for(const f in F){const T=F[f]._tiles;for(const X in T){const Ve=T[X];if(Ve.state!=="loaded"&&Ve.state!=="errored")return!1}}return!0}addSourceType(F,f,T){this._lazyInitEmptyStyle(),this.style.addSourceType(F,f,T)}removeSource(F){return this.style.removeSource(F),this._updateTerrain(),this._update(!0)}getSource(F){return this.style.getSource(F)}addImage(F,f,{pixelRatio:T=1,sdf:X=!1,stretchX:Ve,stretchY:kt,content:Hr}={}){if(this._lazyInitEmptyStyle(),f instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&f instanceof a.window.ImageBitmap){const{width:pi,height:Vn,data:oa}=a.exported.getImageData(f);this.style.addImage(F,{data:new a.RGBAImage({width:pi,height:Vn},oa),pixelRatio:T,stretchX:Ve,stretchY:kt,content:Hr,sdf:X,version:0})}else if(f.width===void 0||f.height===void 0)this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:pi,height:Vn}=f,oa=f;this.style.addImage(F,{data:new a.RGBAImage({width:pi,height:Vn},new Uint8Array(oa.data)),pixelRatio:T,stretchX:Ve,stretchY:kt,content:Hr,sdf:X,version:0,userImage:oa}),oa.onAdd&&oa.onAdd(this,F)}}updateImage(F,f){const T=this.style.getImage(F);if(!T)return void this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const X=f instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&f instanceof a.window.ImageBitmap?a.exported.getImageData(f):f,{width:Ve,height:kt}=X;Ve!==void 0&&kt!==void 0?Ve===T.data.width&&kt===T.data.height?(T.data.replace(X.data,!(f instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&f instanceof a.window.ImageBitmap)),this.style.updateImage(F,T)):this.fire(new a.ErrorEvent(new Error(`The width and height of the updated image (${Ve}, ${kt})
                must be that same as the previous version of the image
                (${T.data.width}, ${T.data.height})`))):this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(F){return F?!!this.style.getImage(F):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(F){this.style.removeImage(F)}loadImage(F,f){a.getImage(this._requestManager.transformRequest(F,a.ResourceType.Image),(T,X)=>{f(T,X instanceof a.window.HTMLImageElement?a.exported.getImageData(X):X)})}listImages(){return this.style.listImages()}addLayer(F,f){return this._lazyInitEmptyStyle(),this.style.addLayer(F,f),this._update(!0)}moveLayer(F,f){return this.style.moveLayer(F,f),this._update(!0)}removeLayer(F){return this.style.removeLayer(F),this._update(!0)}getLayer(F){return this.style.getLayer(F)}setLayerZoomRange(F,f,T){return this.style.setLayerZoomRange(F,f,T),this._update(!0)}setFilter(F,f,T={}){return this.style.setFilter(F,f,T),this._update(!0)}getFilter(F){return this.style.getFilter(F)}setPaintProperty(F,f,T,X={}){return this.style.setPaintProperty(F,f,T,X),this._update(!0)}getPaintProperty(F,f){return this.style.getPaintProperty(F,f)}setLayoutProperty(F,f,T,X={}){return this.style.setLayoutProperty(F,f,T,X),this._update(!0)}getLayoutProperty(F,f){return this.style.getLayoutProperty(F,f)}setLight(F,f={}){return this._lazyInitEmptyStyle(),this.style.setLight(F,f),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(F){return this._lazyInitEmptyStyle(),!F&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(F),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(F){return this._lazyInitEmptyStyle(),this.style.setFog(F),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(F){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.LngLat.convert(F),this.transform):0}setFeatureState(F,f){return this.style.setFeatureState(F,f),this._update()}removeFeatureState(F,f){return this.style.removeFeatureState(F,f),this._update()}getFeatureState(F){return this.style.getFeatureState(F)}_updateContainerDimensions(){if(!this._container)return;const F=this._container.getBoundingClientRect().width||400,f=this._container.getBoundingClientRect().height||300;let T,X,Ve,kt=this._container;for(;kt&&(!X||!Ve);){const Hr=a.window.getComputedStyle(kt).transform;Hr&&Hr!=="none"&&(T=Hr.match(/matrix.*\((.+)\)/)[1].split(", "),T[0]&&T[0]!=="0"&&T[0]!=="1"&&(X=T[0]),T[3]&&T[3]!=="0"&&T[3]!=="1"&&(Ve=T[3])),kt=kt.parentElement}this._containerWidth=X?Math.abs(F/X):F,this._containerHeight=Ve?Math.abs(f/Ve):f}_detectMissingCSS(){a.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const F=this._container;F.classList.add("mapboxgl-map"),(this._missingCSSCanary=Y("div","mapboxgl-canary",F)).style.visibility="hidden",this._detectMissingCSS();const f=this._canvasContainer=Y("div","mapboxgl-canvas-container",F);this._interactive&&f.classList.add("mapboxgl-interactive"),this._canvas=Y("canvas","mapboxgl-canvas",f),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const T=this._controlContainer=Y("div","mapboxgl-control-container",F),X=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(Ve=>{X[Ve]=Y("div",`mapboxgl-ctrl-${Ve}`,T)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(F,f){const T=a.exported.devicePixelRatio||1;this._canvas.width=T*Math.ceil(F),this._canvas.height=T*Math.ceil(f),this._canvas.style.width=`${F}px`,this._canvas.style.height=`${f}px`}_addMarker(F){this._markers.push(F)}_removeMarker(F){const f=this._markers.indexOf(F);f!==-1&&this._markers.splice(f,1)}_addPopup(F){this._popups.push(F)}_removePopup(F){const f=this._popups.indexOf(F);f!==-1&&this._popups.splice(f,1)}_setupPainter(){const F=a.extend({},y.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),f=this._useWebGL2&&this._canvas.getContext("webgl2",F),T=f||this._canvas.getContext("webgl",F)||this._canvas.getContext("experimental-webgl",F);T?(this._useWebGL2&&!f&&a.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),a.storeAuthState(T,!0),this.painter=new t_(T,this.transform,!!f),this.on("data",X=>{X.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.exported$1.testSupport(T)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(F){F.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:F}))}_contextRestored(F){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:F}))}_onMapScroll(F){if(F.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(F){return this.style?(this._styleDirty=this._styleDirty||F,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(F){return this._update(),this._renderTaskQueue.add(F)}_cancelRenderFrame(F){this._renderTaskQueue.remove(F)}_requestDomTask(F){!this.loaded()||this.loaded()&&!this.isMoving()?F():this._domRenderTaskQueue.add(F)}_render(F){let f;const T=this.painter.context.extTimerQuery,X=a.exported.now();if(this.listens("gpu-timing-frame")&&(f=T.createQueryEXT(),T.beginQueryEXT(T.TIME_ELAPSED_EXT,f)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],a.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],a.window.performance.now())),this._renderTaskQueue.run(F),this._domRenderTaskQueue.run(F),this._removed)return;this._updateProjectionTransition();const Ve=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const pi=this.transform.zoom,Vn=this.transform.pitch,oa=a.exported.now(),sa=new a.EvaluationParameters(pi,{now:oa,fadeDuration:Ve,pitch:Vn,transition:this.style.getTransition()});this.style.update(sa)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let kt=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),kt=this._updateAverageElevation(X),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):kt=this._updateAverageElevation(X),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,Ve,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:Ve,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new a.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),f){const pi=a.exported.now()-X;T.endQueryEXT(T.TIME_ELAPSED_EXT,f),setTimeout(()=>{const Vn=T.getQueryObjectEXT(f,T.QUERY_RESULT_EXT)/1e6;T.deleteQueryEXT(f),this.fire(new a.Event("gpu-timing-frame",{cpuTime:pi,gpuTime:Vn})),a.window.performance.mark("frame-gpu",{startTime:X,detail:{gpuTime:Vn}})},50)}if(this.listens("gpu-timing-layer")){const pi=this.painter.collectGpuTimers();setTimeout(()=>{const Vn=this.painter.queryGpuTimers(pi);this.fire(new a.Event("gpu-timing-layer",{layerTimes:Vn}))},50)}if(this.listens("gpu-timing-deferred-render")){const pi=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const Vn=this.painter.queryGpuTimeDeferredRender(pi);this.fire(new a.Event("gpu-timing-deferred-render",{gpuTime:Vn}))},50)}const Hr=this._sourcesDirty||this._styleDirty||this._placementDirty||kt;if(Hr||this._repaint)this.triggerRepaint();else{const pi=!this.isMoving()&&this.loaded();if(pi&&(kt=this._updateAverageElevation(X,!0)),kt)this.triggerRepaint();else if(this._triggerFrame(!1),pi&&(this.fire(new a.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const Vn=this._calculateSpeedIndex();this.fire(new a.Event("speedindexcompleted",{speedIndex:Vn})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||Hr||(this._fullyLoaded=!0,a.LivePerformanceUtils.mark(a.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&a.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(F){for(const f of this._markers)F&&!this.getRenderWorldCopies()&&(f._lngLat=f._lngLat.wrap()),f._update();for(const f of this._popups)!F||this.getRenderWorldCopies()||f._trackPointer||(f._lngLat=f._lngLat.wrap()),f._update()}_updateAverageElevation(F,f=!1){const T=X=>(this.transform.averageElevation=X,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&T(0);if((f||F-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(F)){const X=this.transform.averageElevation;let Ve=this.transform.sampleAverageElevation(),kt=!1;this.transform.elevation&&(kt=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(Ve)?Ve=0:this._averageElevationLastSampledAt=F;const Hr=Math.abs(X-Ve);if(Hr>1){if(this._isInitialLoad||kt)return this._averageElevation.jumpTo(Ve),T(Ve);this._averageElevation.easeTo(Ve,F,300)}else if(Hr>1e-4)return this._averageElevation.jumpTo(Ve),T(Ve)}return!!this._averageElevation.isEasing(F)&&T(this._averageElevation.getValue(F))}_authenticate(){a.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,F=>{if(F&&(F.message===a.AUTH_ERR_MSG||F.status===401)){const f=this.painter.context.gl;a.storeAuthState(f,!1),this._logoControl instanceof fl&&this._logoControl._updateLogo(),f&&f.clear(f.DEPTH_BUFFER_BIT|f.COLOR_BUFFER_BIT|f.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),a.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const F=this._isDragging();this.painter.updateTerrain(this.style,F)}_calculateSpeedIndex(){const F=this.painter.canvasCopy(),f=this.painter.getCanvasCopiesAndTimestamps();f.timeStamps.push(performance.now());const T=this.painter.context.gl,X=T.createFramebuffer();function Ve(kt){T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_2D,kt,0);const Hr=new Uint8Array(T.drawingBufferWidth*T.drawingBufferHeight*4);return T.readPixels(0,0,T.drawingBufferWidth,T.drawingBufferHeight,T.RGBA,T.UNSIGNED_BYTE,Hr),Hr}return T.bindFramebuffer(T.FRAMEBUFFER,X),this._canvasPixelComparison(Ve(F),f.canvasCopies.map(Ve),f.timeStamps)}_canvasPixelComparison(F,f,T){let X=T[1]-T[0];const Ve=F.length/4;for(let kt=0;kt<f.length;kt++){const Hr=f[kt];let pi=0;for(let Vn=0;Vn<Hr.length;Vn+=4)Hr[Vn]===F[Vn]&&Hr[Vn+1]===F[Vn+1]&&Hr[Vn+2]===F[Vn+2]&&Hr[Vn+3]===F[Vn+3]&&(pi+=1);X+=(T[kt+2]-T[kt+1])*(1-pi/Ve)}return X}remove(){this._hash&&this._hash.remove();for(const f of this._controls)f.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),a.window!==void 0&&(a.window.removeEventListener("resize",this._onWindowResize,!1),a.window.removeEventListener("orientationchange",this._onWindowResize,!1),a.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.removeEventListener("online",this._onWindowOnline,!1),a.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const F=this.painter.context.gl.getExtension("WEBGL_lose_context");F&&F.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),a.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(F){this._renderNextFrame=this._renderNextFrame||F,this.style&&!this._frame&&(this._frame=a.exported.frame(f=>{const T=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,T&&this._render(f)}))}_preloadTiles(F){const f=this.style?Object.values(this.style._sourceCaches):[];return a.asyncAll(f,(T,X)=>T._preloadTiles(F,X),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(F){this._trackResize&&this.resize({originalEvent:F})._update()}_onVisibilityChange(){a.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(F){this._showTileBoundaries!==F&&(this._showTileBoundaries=F,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(F){this._showTerrainWireframe!==F&&(this._showTerrainWireframe=F,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(F){this._speedIndexTiming!==F&&(this._speedIndexTiming=F,this._update())}get showPadding(){return!!this._showPadding}set showPadding(F){this._showPadding!==F&&(this._showPadding=F,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(F){this._showCollisionBoxes!==F&&(this._showCollisionBoxes=F,F?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(F){this._showOverdrawInspector!==F&&(this._showOverdrawInspector=F,this._update())}get repaint(){return!!this._repaint}set repaint(F){this._repaint!==F&&(this._repaint=F,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(F){this._vertices=F,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(F){this._showTileAABBs!==F&&(this._showTileAABBs=F,F&&this._update())}_setCacheLimits(F,f){a.setCacheLimits(F,f)}get version(){return a.version}},NavigationControl:class{constructor(F){this.options=a.extend({},yp,F),this._container=Y("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",f=>f.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",f=>{this._map&&this._map.zoomIn({},{originalEvent:f})}),Y("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",f=>{this._map&&this._map.zoomOut({},{originalEvent:f})}),Y("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",f=>{const T=this._map;T&&(this.options.visualizePitch?T.resetNorthPitch({},{originalEvent:f}):T.resetNorth({},{originalEvent:f}))}),this._compassIcon=Y("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const F=this._map;if(!F)return;const f=F.getZoom(),T=f===F.getMaxZoom(),X=f===F.getMinZoom();this._zoomInButton.disabled=T,this._zoomOutButton.disabled=X,this._zoomInButton.setAttribute("aria-disabled",T.toString()),this._zoomOutButton.setAttribute("aria-disabled",X.toString())}_rotateCompassArrow(){const F=this._map;if(!F)return;const f=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(F.transform.pitch*(Math.PI/180)),.5)}) rotateX(${F.transform.pitch}deg) rotateZ(${F.transform.angle*(180/Math.PI)}deg)`:`rotate(${F.transform.angle*(180/Math.PI)}deg)`;F._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=f)})}onAdd(F){return this._map=F,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),F.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&F.on("pitch",this._rotateCompassArrow),F.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Np(F,this._compass,this.options.visualizePitch)),this._container}onRemove(){const F=this._map;F&&(this._container.remove(),this.options.showZoom&&F.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&F.off("pitch",this._rotateCompassArrow),F.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(F,f){const T=Y("button",F,this._container);return T.type="button",T.addEventListener("click",f),T}_setButtonTitle(F,f){if(!this._map)return;const T=this._map._getUIString(`NavigationControl.${f}`);F.setAttribute("aria-label",T),F.firstElementChild&&F.firstElementChild.setAttribute("title",T)}},GeolocateControl:class extends a.Evented{constructor(F){super(),this.options=a.extend({geolocation:a.window.navigator.geolocation},jp,F),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=w_(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(F){return this._map=F,this._container=Y("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(F){const f=(T=!!this.options.geolocation)=>{this._supportsGeolocation=T,F(T)};this._supportsGeolocation!==void 0?F(this._supportsGeolocation):a.window.navigator.permissions!==void 0?a.window.navigator.permissions.query({name:"geolocation"}).then(T=>f(T.state!=="denied")).catch(()=>f()):f()}_isOutOfMapMaxBounds(F){const f=this._map.getMaxBounds(),T=F.coords;return!!f&&(T.longitude<f.getWest()||T.longitude>f.getEast()||T.latitude<f.getSouth()||T.latitude>f.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(F){if(this._map){if(this._isOutOfMapMaxBounds(F))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",F)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=F,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(F),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(F),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",F)),this._finish()}}_updateCamera(F){const f=new a.LngLat(F.coords.longitude,F.coords.latitude),T=F.coords.accuracy,X=this._map.getBearing(),Ve=a.extend({bearing:X},this.options.fitBoundsOptions);this._map.fitBounds(f.toBounds(T),Ve,{geolocateSource:!0})}_updateMarker(F){if(F){const f=new a.LngLat(F.coords.longitude,F.coords.latitude);this._accuracyCircleMarker.setLngLat(f).addTo(this._map),this._userLocationDotMarker.setLngLat(f).addTo(this._map),this._accuracy=F.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const F=this._map.transform,f=a.mercatorZfromAltitude(1,F._center.lat)*F.worldSize,T=Math.ceil(2*this._accuracy*f);this._circleElement.style.width=`${T}px`,this._circleElement.style.height=`${T}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(F){if(this._map){if(this.options.trackUserLocation)if(F.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",f),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",f),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(F.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",F)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(F){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",f=>f.preventDefault()),this._geolocateButton=Y("button","mapboxgl-ctrl-geolocate",this._container),Y("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",F===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",f),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",f)}else{const f=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",f),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",f)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Y("div","mapboxgl-user-location"),this._dotElement.appendChild(Y("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Y("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new hh({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Y("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new hh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",f=>{f.geolocateSource||this._watchState!=="ACTIVE_LOCK"||f.originalEvent&&f.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}}_onDeviceOrientation(F){this._userLocationDotMarker&&(F.webkitCompassHeading?this._heading=F.webkitCompassHeading:F.absolute===!0&&(this._heading=-1*F.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let F;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(F={maximumAge:6e5,timeout:0},this._noTimeout=!0):(F=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,F),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const F=()=>{a.window.addEventListener("ondeviceorientationabsolute"in a.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};a.window.DeviceMotionEvent!==void 0&&typeof a.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(f=>{f==="granted"&&F()}).catch(console.error):F()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),a.window.removeEventListener("deviceorientation",this._onDeviceOrientation),a.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:vs,ScaleControl:class{constructor(F){this.options=a.extend({},td,F),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),a.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const F=this.options.maxWidth||100,f=this._map,T=f._containerHeight/2,X=f._containerWidth/2-F/2,Ve=f.unproject([X,T]),kt=f.unproject([X+F,T]),Hr=Ve.distanceTo(kt);if(this.options.unit==="imperial"){const pi=3.2808*Hr;pi>5280?this._setScale(F,pi/5280,"mile"):this._setScale(F,pi,"foot")}else this.options.unit==="nautical"?this._setScale(F,Hr/1852,"nautical-mile"):Hr>=1e3?this._setScale(F,Hr/1e3,"kilometer"):this._setScale(F,Hr,"meter")}_setScale(F,f,T){this._map._requestDomTask(()=>{const X=function(kt){const Hr=Math.pow(10,`${Math.floor(kt)}`.length-1);let pi=kt/Hr;return pi=pi>=10?10:pi>=5?5:pi>=3?3:pi>=2?2:pi>=1?1:function(Vn){const oa=Math.pow(10,Math.ceil(-Math.log(Vn)/Math.LN10));return Math.round(Vn*oa)/oa}(pi),Hr*pi}(f),Ve=X/f;this._container.innerHTML=this._isNumberFormatSupported&&T!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:T}).format(X):`${X}&nbsp;${Vp[T]}`,this._container.style.width=F*Ve+"px"})}onAdd(F){return this._map=F,this._language=F.getLanguage(),this._container=Y("div","mapboxgl-ctrl mapboxgl-ctrl-scale",F.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(F){this._language=F,this._update()}setUnit(F){this.options.unit=F,this._update()}},FullscreenControl:class{constructor(F){this._fullscreen=!1,F&&F.container&&(F.container instanceof a.window.HTMLElement?this._container=F.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in a.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in a.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(F){return this._map=F,this._container||(this._container=this._map.getContainer()),this._controlContainer=Y("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,a.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!a.window.document.fullscreenEnabled&&!a.window.document.webkitFullscreenEnabled)}_setupUI(){const F=this._fullscreenButton=Y("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Y("span","mapboxgl-ctrl-icon",F).setAttribute("aria-hidden","true"),F.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),a.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const F=this._getTitle();this._fullscreenButton.setAttribute("aria-label",F),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",F)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(a.window.document.fullscreenElement||a.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?a.window.document.exitFullscreen?a.window.document.exitFullscreen():a.window.document.webkitCancelFullScreen&&a.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.Evented{constructor(F){super(),this.options=a.extend(Object.create(Rh),F),a.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(F&&F.className?F.className.trim().split(/\s+/):[])}addTo(F){return this._map&&this.remove(),this._map=F,this.options.closeOnClick&&F.on("preclick",this._onClose),this.options.closeOnMove&&F.on("move",this._onClose),F.on("remove",this.remove),this._update(),F._addPopup(this),this._focusFirstElement(),this._trackPointer?(F.on("mousemove",this._onMouseEvent),F.on("mouseup",this._onMouseEvent),F._canvasContainer.classList.add("mapboxgl-track-pointer")):F.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const F=this._map;return F&&(F.off("move",this._update),F.off("move",this._onClose),F.off("preclick",this._onClose),F.off("click",this._onClose),F.off("remove",this.remove),F.off("mousemove",this._onMouseEvent),F.off("mouseup",this._onMouseEvent),F.off("drag",this._onMouseEvent),F._canvasContainer&&F._canvasContainer.classList.remove("mapboxgl-track-pointer"),F._removePopup(this),this._map=void 0),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(F){this._lngLat=a.LngLat.convert(F),this._pos=null,this._trackPointer=!1,this._update();const f=this._map;return f&&(f.on("move",this._update),f.off("mousemove",this._onMouseEvent),f._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const F=this._map;return F&&(F.off("move",this._update),F.on("mousemove",this._onMouseEvent),F.on("drag",this._onMouseEvent),F._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(F){return this.setDOMContent(a.window.document.createTextNode(F))}setHTML(F){const f=a.window.document.createDocumentFragment(),T=a.window.document.createElement("body");let X;for(T.innerHTML=F;X=T.firstChild,X;)f.appendChild(X);return this.setDOMContent(f)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(F){return this.options.maxWidth=F,this._update(),this}setDOMContent(F){let f=this._content;if(f)for(;f.hasChildNodes();)f.firstChild&&f.removeChild(f.firstChild);else f=this._content=Y("div","mapboxgl-popup-content",this._container||void 0);if(f.appendChild(F),this.options.closeButton){const T=this._closeButton=Y("button","mapboxgl-popup-close-button",f);T.type="button",T.setAttribute("aria-label","Close popup"),T.setAttribute("aria-hidden","true"),T.innerHTML="&#215;",T.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(F){return this._classList.add(F),this._updateClassList(),this}removeClassName(F){return this._classList.delete(F),this._updateClassList(),this}setOffset(F){return this.options.offset=F,this._update(),this}toggleClassName(F){let f;return this._classList.delete(F)?f=!1:(this._classList.add(F),f=!0),this._updateClassList(),f}_onMouseEvent(F){this._update(F.point)}_getAnchor(F){if(this.options.anchor)return this.options.anchor;const f=this._map,T=this._container,X=this._pos;if(!f||!T||!X)return"bottom";const Ve=T.offsetWidth,kt=T.offsetHeight,Hr=X.x<Ve/2,pi=X.x>f.transform.width-Ve/2;if(X.y+F<kt)return Hr?"top-left":pi?"top-right":"top";if(X.y>f.transform.height-kt){if(Hr)return"bottom-left";if(pi)return"bottom-right"}return Hr?"left":pi?"right":"bottom"}_updateClassList(){const F=this._container;if(!F)return;const f=[...this._classList];f.push("mapboxgl-popup"),this._anchor&&f.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&f.push("mapboxgl-popup-track-pointer"),F.className=f.join(" ")}_update(F){const f=this._map,T=this._content;if(!f||!this._lngLat&&!this._trackPointer||!T)return;let X=this._container;if(X||(X=this._container=Y("div","mapboxgl-popup",f.getContainer()),this._tip=Y("div","mapboxgl-popup-tip",X),X.appendChild(T)),this.options.maxWidth&&X.style.maxWidth!==this.options.maxWidth&&(X.style.maxWidth=this.options.maxWidth),f.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ph(this._lngLat,this._pos,f.transform)),!this._trackPointer||F){const Ve=this._pos=this._trackPointer&&F?F:f.project(this._lngLat),kt=Kh(this.options.offset),Hr=this._anchor=this._getAnchor(kt.y),pi=Kh(this.options.offset,Hr),Vn=Ve.add(pi).round();f._requestDomTask(()=>{this._container&&Hr&&(this._container.style.transform=`${Ah[Hr]} translate(${Vn.x}px,${Vn.y}px)`)})}if(!this._marker&&f._showingGlobe()){const Ve=a.isLngLatBehindGlobe(f.transform,this._lngLat)?0:1;this._setOpacity(Ve)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const F=this._container.querySelector(Gh);F&&F.focus()}_onClose(){this.remove()}_setOpacity(F){this._container&&(this._container.style.opacity=`${F}`),this._content&&(this._content.style.pointerEvents=F?"auto":"none")}},Marker:hh,Style:Ny,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.Point,MercatorCoordinate:a.MercatorCoordinate,FreeCameraOptions:Q0,Evented:a.Evented,config:a.config,prewarm:function(){Vf().acquire(wd)},clearPrewarmedResources:function(){const F=Wd;F&&(F.isPreloaded()&&F.numActive()===1?(F.release(wd),Wd=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return a.config.ACCESS_TOKEN},set accessToken(F){a.config.ACCESS_TOKEN=F},get baseApiUrl(){return a.config.API_URL},set baseApiUrl(F){a.config.API_URL=F},get workerCount(){return dd.workerCount},set workerCount(F){dd.workerCount=F},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(F){a.config.MAX_PARALLEL_IMAGE_REQUESTS=F},clearStorage(F){a.clearTileCache(F)},workerUrl:"",workerClass:null,setNow:a.exported.setNow,restoreNow:a.exported.restoreNow};return gd});var l=o;return l})})(mapboxGl$1);var mapboxGlExports=mapboxGl$1.exports;const mapboxgl=getDefaultExportFromCjs(mapboxGlExports),mapboxGl="";var immutable=extend$5,hasOwnProperty=Object.prototype.hasOwnProperty;function extend$5(){for(var n={},t=0;t<arguments.length;t++){var e=arguments[t];for(var r in e)hasOwnProperty.call(e,r)&&(n[r]=e[r])}return n}var fuzzy$1={exports:{}};(function(n,t){(function(){var e={};n.exports=e,e.simpleFilter=function(r,o){return o.filter(function(s){return e.test(r,s)})},e.test=function(r,o){return e.match(r,o)!==null},e.match=function(r,o,s){s=s||{};var l=0,a=[],h=o.length,y=0,C=0,L=s.pre||"",Y=s.post||"",ze=s.caseSensitive&&o||o.toLowerCase(),Bt;r=s.caseSensitive&&r||r.toLowerCase();for(var Ir=0;Ir<h;Ir++)Bt=o[Ir],ze[Ir]===r[l]?(Bt=L+Bt+Y,l+=1,C+=1+C):C=0,y+=C,a[a.length]=Bt;return l===r.length?(y=ze===r?1/0:y,{rendered:a.join(""),score:y}):null},e.filter=function(r,o,s){return!o||o.length===0?[]:typeof r!="string"?o:(s=s||{},o.reduce(function(l,a,h,y){var C=a;s.extract&&(C=s.extract(a));var L=e.match(r,C,s);return L!=null&&(l[l.length]={string:L.rendered,score:L.score,index:h,original:a}),l},[]).sort(function(l,a){var h=a.score-l.score;return h||l.index-a.index}))}})()})(fuzzy$1);var fuzzyExports=fuzzy$1.exports,List$1=function(n){return this.component=n,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,n.el.parentNode.insertBefore(this.wrapper,n.el.nextSibling),this};List$1.prototype.show=function(){this.element.style.display="block"};List$1.prototype.hide=function(){this.element.style.display="none"};List$1.prototype.add=function(n){this.items.push(n)};List$1.prototype.clear=function(){this.items=[],this.active=0};List$1.prototype.isEmpty=function(){return!this.items.length};List$1.prototype.isVisible=function(){return this.element.style.display==="block"};List$1.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var n=0;n<this.items.length;n++)this.drawItem(this.items[n],this.active===n);this.show()};List$1.prototype.drawItem=function(n,t){var e=document.createElement("li"),r=document.createElement("a");t&&(e.className+=" active"),r.innerHTML=n.string,e.appendChild(r),this.element.appendChild(e),e.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),e.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,n)}).bind(this))};List$1.prototype.handleMouseUp=function(n){this.selectingListItem=!1,this.component.value(n.original),this.clear(),this.draw()};List$1.prototype.move=function(n){this.active=n,this.draw()};List$1.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};List$1.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};List$1.prototype.drawError=function(n){var t=document.createElement("li");t.innerHTML=n,this.element.appendChild(t),this.show()};var list=List$1,extend$4=immutable,fuzzy=fuzzyExports,List=list,Suggestions$1=function(n,t,e){return e=e||{},this.options=extend$4({minLength:2,limit:5,filter:!0,hideOnBlur:!0},e),this.el=n,this.data=t||[],this.list=new List(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(r){this.handleKeyUp(r.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(r){this.handleKeyDown(r)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(r){this.handlePaste(r)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Suggestions$1.prototype.handleKeyUp=function(n){n===40||n===38||n===27||n===13||n===9||this.handleInputChange(this.el.value)};Suggestions$1.prototype.handleKeyDown=function(n){switch(n.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&n.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Suggestions$1.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Suggestions$1.prototype.handlePaste=function(n){if(n.clipboardData)this.handleInputChange(n.clipboardData.getData("Text"));else{var t=this;setTimeout(function(){t.handleInputChange(n.target.value)},100)}};Suggestions$1.prototype.handleInputChange=function(n){if(this.query=this.normalize(n),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(t){for(var e=0;e<t.length&&(this.list.add(t[e]),e!==this.options.limit-1);e++);this.list.draw()}).bind(this))};Suggestions$1.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Suggestions$1.prototype.update=function(n){this.data=n,this.handleKeyUp()};Suggestions$1.prototype.clear=function(){this.data=[],this.list.clear()};Suggestions$1.prototype.normalize=function(n){return n=n.toLowerCase(),n};Suggestions$1.prototype.match=function(n,t){return n.indexOf(t)>-1};Suggestions$1.prototype.value=function(n){if(this.selected=n,this.el.value=this.getItemValue(n),document.createEvent){var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!1),this.el.dispatchEvent(t)}else this.el.fireEvent("onchange")};Suggestions$1.prototype.getCandidates=function(n){var t={pre:"<strong>",post:"</strong>",extract:(function(r){return this.getItemValue(r)}).bind(this)},e;this.options.filter?(e=fuzzy.filter(this.query,this.data,t),e=e.map((function(r){return{original:r.original,string:this.render(r.original,r.string)}}).bind(this))):e=this.data.map((function(r){var o=this.render(r);return{original:r,string:o}}).bind(this)),n(e)};Suggestions$1.prototype.getItemValue=function(n){return n};Suggestions$1.prototype.render=function(n,t){if(t)return t;for(var e=n.original?this.getItemValue(n.original):this.getItemValue(n),r=this.normalize(e),o=r.lastIndexOf(this.query);o>-1;){var s=o+this.query.length;e=e.slice(0,o)+"<strong>"+e.slice(o,s)+"</strong>"+e.slice(s),o=r.slice(0,o).lastIndexOf(this.query)}return e};Suggestions$1.prototype.renderError=function(n){this.list.drawError(n)};var suggestions$1=Suggestions$1,Suggestions=suggestions$1,suggestions=Suggestions;typeof window<"u"&&(window.Suggestions=Suggestions);var FUNC_ERROR_TEXT="Expected a function",NAN=0/0,symbolTag="[object Symbol]",reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt,freeGlobal=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,freeSelf=typeof self=="object"&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),objectProto=Object.prototype,objectToString$1=objectProto.toString,nativeMax=Math.max,nativeMin=Math.min,now=function(){return root.Date.now()};function debounce$2(n,t,e){var r,o,s,l,a,h,y=0,C=!1,L=!1,Y=!0;if(typeof n!="function")throw new TypeError(FUNC_ERROR_TEXT);t=toNumber$1(t)||0,isObject$1(e)&&(C=!!e.leading,L="maxWait"in e,s=L?nativeMax(toNumber$1(e.maxWait)||0,t):s,Y="trailing"in e?!!e.trailing:Y);function ze(gl){var ml=r,il=o;return r=o=void 0,y=gl,l=n.apply(il,ml),l}function Bt(gl){return y=gl,a=setTimeout(yi,t),C?ze(gl):l}function Ir(gl){var ml=gl-h,il=gl-y,sl=t-ml;return L?nativeMin(sl,s-il):sl}function Wr(gl){var ml=gl-h,il=gl-y;return h===void 0||ml>=t||ml<0||L&&il>=s}function yi(){var gl=now();if(Wr(gl))return Bn(gl);a=setTimeout(yi,Ir(gl))}function Bn(gl){return a=void 0,Y&&r?ze(gl):(r=o=void 0,l)}function vi(){a!==void 0&&clearTimeout(a),y=0,r=h=o=a=void 0}function wo(){return a===void 0?l:Bn(now())}function ia(){var gl=now(),ml=Wr(gl);if(r=arguments,o=this,h=gl,ml){if(a===void 0)return Bt(h);if(L)return a=setTimeout(yi,t),ze(h)}return a===void 0&&(a=setTimeout(yi,t)),l}return ia.cancel=vi,ia.flush=wo,ia}function isObject$1(n){var t=typeof n;return!!n&&(t=="object"||t=="function")}function isObjectLike(n){return!!n&&typeof n=="object"}function isSymbol(n){return typeof n=="symbol"||isObjectLike(n)&&objectToString$1.call(n)==symbolTag}function toNumber$1(n){if(typeof n=="number")return n;if(isSymbol(n))return NAN;if(isObject$1(n)){var t=typeof n.valueOf=="function"?n.valueOf():n;n=isObject$1(t)?t+"":t}if(typeof n!="string")return n===0?n:+n;n=n.replace(reTrim,"");var e=reIsBinary.test(n);return e||reIsOctal.test(n)?freeParseInt(n.slice(2),e?2:8):reIsBadHex.test(n)?NAN:+n}var lodash_debounce=debounce$2,events$1={exports:{}},R=typeof Reflect=="object"?Reflect:null,ReflectApply=R&&typeof R.apply=="function"?R.apply:function(t,e,r){return Function.prototype.apply.call(t,e,r)},ReflectOwnKeys;R&&typeof R.ownKeys=="function"?ReflectOwnKeys=R.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:ReflectOwnKeys=function(t){return Object.getOwnPropertyNames(t)};function ProcessEmitWarning(n){console&&console.warn&&console.warn(n)}var NumberIsNaN=Number.isNaN||function(t){return t!==t};function EventEmitter$2(){EventEmitter$2.init.call(this)}events$1.exports=EventEmitter$2;events$1.exports.once=once;EventEmitter$2.EventEmitter=EventEmitter$2;EventEmitter$2.prototype._events=void 0;EventEmitter$2.prototype._eventsCount=0;EventEmitter$2.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(EventEmitter$2,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(n){if(typeof n!="number"||n<0||NumberIsNaN(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");defaultMaxListeners=n}});EventEmitter$2.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter$2.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||NumberIsNaN(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function _getMaxListeners(n){return n._maxListeners===void 0?EventEmitter$2.defaultMaxListeners:n._maxListeners}EventEmitter$2.prototype.getMaxListeners=function(){return _getMaxListeners(this)};EventEmitter$2.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var o=t==="error",s=this._events;if(s!==void 0)o=o&&s.error===void 0;else if(!o)return!1;if(o){var l;if(e.length>0&&(l=e[0]),l instanceof Error)throw l;var a=new Error("Unhandled error."+(l?" ("+l.message+")":""));throw a.context=l,a}var h=s[t];if(h===void 0)return!1;if(typeof h=="function")ReflectApply(h,this,e);else for(var y=h.length,C=arrayClone(h,y),r=0;r<y;++r)ReflectApply(C[r],this,e);return!0};function _addListener(n,t,e,r){var o,s,l;if(checkListener(e),s=n._events,s===void 0?(s=n._events=Object.create(null),n._eventsCount=0):(s.newListener!==void 0&&(n.emit("newListener",t,e.listener?e.listener:e),s=n._events),l=s[t]),l===void 0)l=s[t]=e,++n._eventsCount;else if(typeof l=="function"?l=s[t]=r?[e,l]:[l,e]:r?l.unshift(e):l.push(e),o=_getMaxListeners(n),o>0&&l.length>o&&!l.warned){l.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=n,a.type=t,a.count=l.length,ProcessEmitWarning(a)}return n}EventEmitter$2.prototype.addListener=function(t,e){return _addListener(this,t,e,!1)};EventEmitter$2.prototype.on=EventEmitter$2.prototype.addListener;EventEmitter$2.prototype.prependListener=function(t,e){return _addListener(this,t,e,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(n,t,e){var r={fired:!1,wrapFn:void 0,target:n,type:t,listener:e},o=onceWrapper.bind(r);return o.listener=e,r.wrapFn=o,o}EventEmitter$2.prototype.once=function(t,e){return checkListener(e),this.on(t,_onceWrap(this,t,e)),this};EventEmitter$2.prototype.prependOnceListener=function(t,e){return checkListener(e),this.prependListener(t,_onceWrap(this,t,e)),this};EventEmitter$2.prototype.removeListener=function(t,e){var r,o,s,l,a;if(checkListener(e),o=this._events,o===void 0)return this;if(r=o[t],r===void 0)return this;if(r===e||r.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete o[t],o.removeListener&&this.emit("removeListener",t,r.listener||e));else if(typeof r!="function"){for(s=-1,l=r.length-1;l>=0;l--)if(r[l]===e||r[l].listener===e){a=r[l].listener,s=l;break}if(s<0)return this;s===0?r.shift():spliceOne(r,s),r.length===1&&(o[t]=r[0]),o.removeListener!==void 0&&this.emit("removeListener",t,a||e)}return this};EventEmitter$2.prototype.off=EventEmitter$2.prototype.removeListener;EventEmitter$2.prototype.removeAllListeners=function(t){var e,r,o;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[t]),this;if(arguments.length===0){var s=Object.keys(r),l;for(o=0;o<s.length;++o)l=s[o],l!=="removeListener"&&this.removeAllListeners(l);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=r[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(o=e.length-1;o>=0;o--)this.removeListener(t,e[o]);return this};function _listeners(n,t,e){var r=n._events;if(r===void 0)return[];var o=r[t];return o===void 0?[]:typeof o=="function"?e?[o.listener||o]:[o]:e?unwrapListeners(o):arrayClone(o,o.length)}EventEmitter$2.prototype.listeners=function(t){return _listeners(this,t,!0)};EventEmitter$2.prototype.rawListeners=function(t){return _listeners(this,t,!1)};EventEmitter$2.listenerCount=function(n,t){return typeof n.listenerCount=="function"?n.listenerCount(t):listenerCount.call(n,t)};EventEmitter$2.prototype.listenerCount=listenerCount;function listenerCount(n){var t=this._events;if(t!==void 0){var e=t[n];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}EventEmitter$2.prototype.eventNames=function(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(n,t){for(var e=new Array(t),r=0;r<t;++r)e[r]=n[r];return e}function spliceOne(n,t){for(;t+1<n.length;t++)n[t]=n[t+1];n.pop()}function unwrapListeners(n){for(var t=new Array(n.length),e=0;e<t.length;++e)t[e]=n[e].listener||n[e];return t}function once(n,t){return new Promise(function(e,r){function o(l){n.removeListener(t,s),r(l)}function s(){typeof n.removeListener=="function"&&n.removeListener("error",o),e([].slice.call(arguments))}eventTargetAgnosticAddListener(n,t,s,{once:!0}),t!=="error"&&addErrorHandlerIfEventEmitter(n,o,{once:!0})})}function addErrorHandlerIfEventEmitter(n,t,e){typeof n.on=="function"&&eventTargetAgnosticAddListener(n,"error",t,e)}function eventTargetAgnosticAddListener(n,t,e,r){if(typeof n.on=="function")r.once?n.once(t,e):n.on(t,e);else if(typeof n.addEventListener=="function")n.addEventListener(t,function o(s){r.once&&n.removeEventListener(t,o),e(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var eventsExports=events$1.exports;const EventEmitter$3=getDefaultExportFromCjs(eventsExports);var exceptions$1={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function parseParam(n){var t=n.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return t?{key:t[1],value:t[2]}:null}function parseLink(n){var t=n.match(/<?([^>]*)>(.*)/);if(!t)return null;var e=t[1],r=t[2].split(";"),o=null,s=r.reduce(function(l,a){var h=parseParam(a);return h?h.key==="rel"?(o||(o=h.value),l):(l[h.key]=h.value,l):l},{});return o?{url:e,rel:o,params:s}:null}function parseLinkHeader$1(n){return n?n.split(/,\s*</).reduce(function(t,e){var r=parseLink(e);if(!r)return t;var o=r.rel.split(/\s+/);return o.forEach(function(s){t[s]||(t[s]={url:r.url,params:r.params})}),t},{}):{}}var parseLinkHeader_1=parseLinkHeader$1,parseLinkHeader=parseLinkHeader_1;function MapiResponse$1(n,t){this.request=n,this.headers=t.headers,this.rawBody=t.body,this.statusCode=t.statusCode;try{this.body=JSON.parse(t.body||"{}")}catch{this.body=t.body}this.links=parseLinkHeader(this.headers.link)}MapiResponse$1.prototype.hasNextPage=function(){return!!this.links.next};MapiResponse$1.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var mapiResponse=MapiResponse$1,constants$9={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},constants$8=constants$9;function MapiError$1(n){var t=n.type||constants$8.ERROR_HTTP,e;if(n.body)try{e=JSON.parse(n.body)}catch{e=n.body}else e=null;var r=n.message||null;r||(typeof e=="string"?r=e:e&&typeof e.message=="string"?r=e.message:t===constants$8.ERROR_REQUEST_ABORTED&&(r="Request aborted")),this.message=r,this.type=t,this.statusCode=n.statusCode||null,this.request=n.request,this.body=e}var mapiError=MapiError$1;function parseSingleHeader(n){var t=n.indexOf(":"),e=n.substring(0,t).trim().toLowerCase(),r=n.substring(t+1).trim();return{name:e,value:r}}function parseHeaders$1(n){var t={};return n&&n.trim().split(/[\r|\n]+/).forEach(function(e){var r=parseSingleHeader(e);t[r.name]=r.value}),t}var parseHeaders_1=parseHeaders$1,MapiResponse=mapiResponse,MapiError=mapiError,constants$7=constants$9,parseHeaders=parseHeaders_1,requestsUnderway={};function browserAbort(n){var t=requestsUnderway[n.id];t&&(t.abort(),delete requestsUnderway[n.id])}function createResponse(n,t){return new MapiResponse(n,{body:t.response,headers:parseHeaders(t.getAllResponseHeaders()),statusCode:t.status})}function normalizeBrowserProgressEvent(n){var t=n.total,e=n.loaded,r=100*e/t;return{total:t,transferred:e,percent:r}}function sendRequestXhr(n,t){return new Promise(function(e,r){t.onprogress=function(l){n.emitter.emit(constants$7.EVENT_PROGRESS_DOWNLOAD,normalizeBrowserProgressEvent(l))};var o=n.file;o&&(t.upload.onprogress=function(l){n.emitter.emit(constants$7.EVENT_PROGRESS_UPLOAD,normalizeBrowserProgressEvent(l))}),t.onerror=function(l){r(l)},t.onabort=function(){var l=new MapiError({request:n,type:constants$7.ERROR_REQUEST_ABORTED});r(l)},t.onload=function(){if(delete requestsUnderway[n.id],t.status<200||t.status>=400){var l=new MapiError({request:n,body:t.response,statusCode:t.status});r(l);return}e(t)};var s=n.body;typeof s=="string"?t.send(s):s?t.send(JSON.stringify(s)):o?t.send(o):t.send(),requestsUnderway[n.id]=t}).then(function(e){return createResponse(n,e)})}function createRequestXhr(n,t){var e=n.url(t),r=new window.XMLHttpRequest;return r.open(n.method,e),Object.keys(n.headers).forEach(function(o){r.setRequestHeader(o,n.headers[o])}),r}function browserSend(n){return Promise.resolve().then(function(){var t=createRequestXhr(n,n.client.accessToken);return sendRequestXhr(n,t)})}var browserLayer={browserAbort,sendRequestXhr,browserSend,createRequestXhr},base64$1={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */base64$1.exports;(function(n,t){(function(e){var r=t,o=n&&n.exports==r&&n,s=typeof commonjsGlobal=="object"&&commonjsGlobal;(s.global===s||s.window===s)&&(e=s);var l=function(Bt){this.message=Bt};l.prototype=new Error,l.prototype.name="InvalidCharacterError";var a=function(Bt){throw new l(Bt)},h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",y=/[\t\n\f\r ]/g,C=function(Bt){Bt=String(Bt).replace(y,"");var Ir=Bt.length;Ir%4==0&&(Bt=Bt.replace(/==?$/,""),Ir=Bt.length),(Ir%4==1||/[^+a-zA-Z0-9/]/.test(Bt))&&a("Invalid character: the string to be decoded is not correctly encoded.");for(var Wr=0,yi,Bn,vi="",wo=-1;++wo<Ir;)Bn=h.indexOf(Bt.charAt(wo)),yi=Wr%4?yi*64+Bn:Bn,Wr++%4&&(vi+=String.fromCharCode(255&yi>>(-2*Wr&6)));return vi},L=function(Bt){Bt=String(Bt),/[^\0-\xFF]/.test(Bt)&&a("The string to be encoded contains characters outside of the Latin1 range.");for(var Ir=Bt.length%3,Wr="",yi=-1,Bn,vi,wo,ia,gl=Bt.length-Ir;++yi<gl;)Bn=Bt.charCodeAt(yi)<<16,vi=Bt.charCodeAt(++yi)<<8,wo=Bt.charCodeAt(++yi),ia=Bn+vi+wo,Wr+=h.charAt(ia>>18&63)+h.charAt(ia>>12&63)+h.charAt(ia>>6&63)+h.charAt(ia&63);return Ir==2?(Bn=Bt.charCodeAt(yi)<<8,vi=Bt.charCodeAt(++yi),ia=Bn+vi,Wr+=h.charAt(ia>>10)+h.charAt(ia>>4&63)+h.charAt(ia<<2&63)+"="):Ir==1&&(ia=Bt.charCodeAt(yi),Wr+=h.charAt(ia>>2)+h.charAt(ia<<4&63)+"=="),Wr},Y={encode:L,decode:C,version:"0.1.0"};if(r&&!r.nodeType)if(o)o.exports=Y;else for(var ze in Y)Y.hasOwnProperty(ze)&&(r[ze]=Y[ze]);else e.base64=Y})(commonjsGlobal)})(base64$1,base64$1.exports);var base64Exports=base64$1.exports,base64=base64Exports,tokenCache={};function parseToken$2(n){if(tokenCache[n])return tokenCache[n];var t=n.split("."),e=t[0],r=t[1];if(!r)throw new Error("Invalid token");var o=parsePaylod(r),s={usage:e,user:o.u};return has(o,"a")&&(s.authorization=o.a),has(o,"exp")&&(s.expires=o.exp*1e3),has(o,"iat")&&(s.created=o.iat*1e3),has(o,"scopes")&&(s.scopes=o.scopes),has(o,"client")&&(s.client=o.client),has(o,"ll")&&(s.lastLogin=o.ll),has(o,"iu")&&(s.impersonator=o.iu),tokenCache[n]=s,s}function parsePaylod(n){try{return JSON.parse(base64.decode(n))}catch{throw new Error("Invalid token")}}function has(n,t){return Object.prototype.hasOwnProperty.call(n,t)}var parseMapboxToken=parseToken$2,eventemitter3={exports:{}};(function(n){var t=Object.prototype.hasOwnProperty,e="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(e=!1));function o(h,y,C){this.fn=h,this.context=y,this.once=C||!1}function s(h,y,C,L,Y){if(typeof C!="function")throw new TypeError("The listener must be a function");var ze=new o(C,L||h,Y),Bt=e?e+y:y;return h._events[Bt]?h._events[Bt].fn?h._events[Bt]=[h._events[Bt],ze]:h._events[Bt].push(ze):(h._events[Bt]=ze,h._eventsCount++),h}function l(h,y){--h._eventsCount===0?h._events=new r:delete h._events[y]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var y=[],C,L;if(this._eventsCount===0)return y;for(L in C=this._events)t.call(C,L)&&y.push(e?L.slice(1):L);return Object.getOwnPropertySymbols?y.concat(Object.getOwnPropertySymbols(C)):y},a.prototype.listeners=function(y){var C=e?e+y:y,L=this._events[C];if(!L)return[];if(L.fn)return[L.fn];for(var Y=0,ze=L.length,Bt=new Array(ze);Y<ze;Y++)Bt[Y]=L[Y].fn;return Bt},a.prototype.listenerCount=function(y){var C=e?e+y:y,L=this._events[C];return L?L.fn?1:L.length:0},a.prototype.emit=function(y,C,L,Y,ze,Bt){var Ir=e?e+y:y;if(!this._events[Ir])return!1;var Wr=this._events[Ir],yi=arguments.length,Bn,vi;if(Wr.fn){switch(Wr.once&&this.removeListener(y,Wr.fn,void 0,!0),yi){case 1:return Wr.fn.call(Wr.context),!0;case 2:return Wr.fn.call(Wr.context,C),!0;case 3:return Wr.fn.call(Wr.context,C,L),!0;case 4:return Wr.fn.call(Wr.context,C,L,Y),!0;case 5:return Wr.fn.call(Wr.context,C,L,Y,ze),!0;case 6:return Wr.fn.call(Wr.context,C,L,Y,ze,Bt),!0}for(vi=1,Bn=new Array(yi-1);vi<yi;vi++)Bn[vi-1]=arguments[vi];Wr.fn.apply(Wr.context,Bn)}else{var wo=Wr.length,ia;for(vi=0;vi<wo;vi++)switch(Wr[vi].once&&this.removeListener(y,Wr[vi].fn,void 0,!0),yi){case 1:Wr[vi].fn.call(Wr[vi].context);break;case 2:Wr[vi].fn.call(Wr[vi].context,C);break;case 3:Wr[vi].fn.call(Wr[vi].context,C,L);break;case 4:Wr[vi].fn.call(Wr[vi].context,C,L,Y);break;default:if(!Bn)for(ia=1,Bn=new Array(yi-1);ia<yi;ia++)Bn[ia-1]=arguments[ia];Wr[vi].fn.apply(Wr[vi].context,Bn)}}return!0},a.prototype.on=function(y,C,L){return s(this,y,C,L,!1)},a.prototype.once=function(y,C,L){return s(this,y,C,L,!0)},a.prototype.removeListener=function(y,C,L,Y){var ze=e?e+y:y;if(!this._events[ze])return this;if(!C)return l(this,ze),this;var Bt=this._events[ze];if(Bt.fn)Bt.fn===C&&(!Y||Bt.once)&&(!L||Bt.context===L)&&l(this,ze);else{for(var Ir=0,Wr=[],yi=Bt.length;Ir<yi;Ir++)(Bt[Ir].fn!==C||Y&&!Bt[Ir].once||L&&Bt[Ir].context!==L)&&Wr.push(Bt[Ir]);Wr.length?this._events[ze]=Wr.length===1?Wr[0]:Wr:l(this,ze)}return this},a.prototype.removeAllListeners=function(y){var C;return y?(C=e?e+y:y,this._events[C]&&l(this,C)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,n.exports=a})(eventemitter3);var eventemitter3Exports=eventemitter3.exports;function encodeArray(n){return n.map(encodeURIComponent).join(",")}function encodeValue(n){return Array.isArray(n)?encodeArray(n):encodeURIComponent(String(n))}function appendQueryParam(n,t,e){if(e===!1||e===null)return n;var r=/\?/.test(n)?"&":"?",o=encodeURIComponent(t);return e!==void 0&&e!==""&&e!==!0&&(o+="="+encodeValue(e)),""+n+r+o}function appendQueryObject(n,t){if(!t)return n;var e=n;return Object.keys(t).forEach(function(r){var o=t[r];o!==void 0&&(Array.isArray(o)&&(o=o.filter(function(s){return s!=null}).join(",")),e=appendQueryParam(e,r,o))}),e}function prependOrigin(n,t){if(!t||n.slice(0,4)==="http")return n;var e=n[0]==="/"?"":"/";return""+t.replace(/\/$/,"")+e+n}function interpolateRouteParams(n,t){return t?n.replace(/\/:([a-zA-Z0-9]+)/g,function(e,r){var o=t[r];if(o===void 0)throw new Error("Unspecified route parameter "+r);var s=encodeValue(o);return"/"+s}):n}var urlUtils$1={appendQueryObject,appendQueryParam,prependOrigin,interpolateRouteParams},parseToken$1=parseMapboxToken,xtend$3=immutable,EventEmitter$1=eventemitter3Exports,urlUtils=urlUtils$1,constants$6=constants$9,requestId=1;function MapiRequest$1(n,t){if(!n)throw new Error("MapiRequest requires a client");if(!t||!t.path||!t.method)throw new Error("MapiRequest requires an options object with path and method properties");var e={};t.body&&(e["content-type"]="application/json");var r=xtend$3(e,t.headers),o=Object.keys(r).reduce(function(s,l){return s[l.toLowerCase()]=r[l],s},{});this.id=requestId++,this._options=t,this.emitter=new EventEmitter$1,this.client=n,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=t.path,this.method=t.method,this.origin=t.origin||n.origin,this.query=t.query||{},this.params=t.params||{},this.body=t.body||null,this.file=t.file||null,this.encoding=t.encoding||"utf8",this.sendFileAs=t.sendFileAs||null,this.headers=o}MapiRequest$1.prototype.url=function(t){var e=urlUtils.prependOrigin(this.path,this.origin);e=urlUtils.appendQueryObject(e,this.query);var r=this.params,o=t??this.client.accessToken;if(o){e=urlUtils.appendQueryParam(e,"access_token",o);var s=parseToken$1(o).user;r=xtend$3({ownerId:s},r)}return e=urlUtils.interpolateRouteParams(e,r),e};MapiRequest$1.prototype.send=function(){var t=this;if(t.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return t.sent=!0,t.client.sendRequest(t).then(function(e){return t.response=e,t.emitter.emit(constants$6.EVENT_RESPONSE,e),e},function(e){throw t.error=e,t.emitter.emit(constants$6.EVENT_ERROR,e),e})};MapiRequest$1.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};MapiRequest$1.prototype.eachPage=function(t){var e=this;function r(l){function a(){delete e._nextPageRequest;var h=l.nextPage();h&&(e._nextPageRequest=h,s(h))}t(null,l,a)}function o(l){t(l,null,function(){})}function s(l){l.send().then(r,o)}s(this)};MapiRequest$1.prototype.clone=function(){return this._extend()};MapiRequest$1.prototype._extend=function(t){var e=xtend$3(this._options,t);return new MapiRequest$1(this.client,e)};var mapiRequest=MapiRequest$1,parseToken=parseMapboxToken,MapiRequest=mapiRequest,constants$5=constants$9;function MapiClient$2(n){if(!n||!n.accessToken)throw new Error("Cannot create a client without an access token");parseToken(n.accessToken),this.accessToken=n.accessToken,this.origin=n.origin||constants$5.API_ORIGIN}MapiClient$2.prototype.createRequest=function(t){return new MapiRequest(this,t)};var mapiClient=MapiClient$2,browser=browserLayer,MapiClient$1=mapiClient;function BrowserClient(n){MapiClient$1.call(this,n)}BrowserClient.prototype=Object.create(MapiClient$1.prototype);BrowserClient.prototype.constructor=BrowserClient;BrowserClient.prototype.sendRequest=browser.browserSend;BrowserClient.prototype.abortRequest=browser.browserAbort;function createBrowserClient(n){return new BrowserClient(n)}var browserClient=createBrowserClient,client=browserClient,mapboxSdk=client,toString$3=Object.prototype.toString,isPlainObj=function(n){var t;return toString$3.call(n)==="[object Object]"&&(t=Object.getPrototypeOf(n),t===null||t===Object.getPrototypeOf({}))},isPlainObject=isPlainObj,xtend$2=immutable,DEFAULT_ERROR_PATH="value",NEWLINE_INDENT=`
  `,v$2={};v$2.assert=function(n,t){return t=t||{},function(e){var r=validate(n,e);if(r){var o=processMessage(r,t);throw t.apiName&&(o=t.apiName+": "+o),new Error(o)}}};v$2.shape=function(t){var e=objectEntries(t);return function(o){var s=validate(v$2.plainObject,o);if(s)return s;for(var l,a,h=[],y=0;y<e.length;y++)l=e[y].key,a=e[y].value,s=validate(a,o[l]),s&&h.push([l].concat(s));return h.length<2?h[0]:function(C){h=h.map(function(ze){var Bt=ze[0],Ir=processMessage(ze,C).split(`
`).join(NEWLINE_INDENT);return"- "+Bt+": "+Ir});var L=C.path.join("."),Y=L===DEFAULT_ERROR_PATH?"":" of "+L;return"The following properties"+Y+" have invalid values:"+NEWLINE_INDENT+h.join(NEWLINE_INDENT)}}};v$2.strictShape=function(t){var e=v$2.shape(t);return function(o){var s=e(o);if(s)return s;var l=Object.keys(o).reduce(function(a,h){return t[h]===void 0&&a.push(h),a},[]);if(l.length!==0)return function(){return"The following keys are invalid: "+l.join(", ")}}};v$2.arrayOf=function(t){return createArrayValidator(t)};v$2.tuple=function(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return createArrayValidator(t)};function createArrayValidator(n){var t=Array.isArray(n),e=function(r){return t?n[r]:n};return function(o){var s=validate(v$2.plainArray,o);if(s)return s;if(t&&o.length!==n.length)return"an array with "+n.length+" items";for(var l=0;l<o.length;l++)if(s=validate(e(l),o[l]),s)return[l].concat(s)}}v$2.required=function(t){function e(r){return r==null?function(o){return formatErrorMessage(o,isArrayCulprit(o.path)?"cannot be undefined/null.":"is required.")}:t.apply(this,arguments)}return e.__required=!0,e};v$2.oneOfType=function(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(r){var o=t.map(function(s){return validate(s,r)}).filter(Boolean);if(o.length===t.length)return o.every(function(s){return s.length===1&&typeof s[0]=="string"})?orList(o.map(function(s){return s[0]})):o.reduce(function(s,l){return l.length>s.length?l:s})}};v$2.equal=function(t){return function(r){if(r!==t)return JSON.stringify(t)}};v$2.oneOf=function(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),e=t.map(function(r){return v$2.equal(r)});return v$2.oneOfType.apply(this,e)};v$2.range=function(t){var e=t[0],r=t[1];return function(s){var l=validate(v$2.number,s);if(l||s<e||s>r)return"number between "+e+" & "+r+" (inclusive)"}};v$2.any=function(){};v$2.boolean=function(t){if(typeof t!="boolean")return"boolean"};v$2.number=function(t){if(typeof t!="number")return"number"};v$2.plainArray=function(t){if(!Array.isArray(t))return"array"};v$2.plainObject=function(t){if(!isPlainObject(t))return"object"};v$2.string=function(t){if(typeof t!="string")return"string"};v$2.func=function(t){if(typeof t!="function")return"function"};function validate(n,t){if(!(t==null&&!n.hasOwnProperty("__required"))){var e=n(t);if(e)return Array.isArray(e)?e:[e]}}function processMessage(n,t){var e=n.length,r=n[e-1],o=n.slice(0,e-1);return o.length===0&&(o=[DEFAULT_ERROR_PATH]),t=xtend$2(t,{path:o}),typeof r=="function"?r(t):formatErrorMessage(t,prettifyResult(r))}function orList(n){return n.length<2?n[0]:n.length===2?n.join(" or "):n.slice(0,-1).join(", ")+", or "+n.slice(-1)}function prettifyResult(n){return"must be "+addArticle(n)+"."}function addArticle(n){return/^an? /.test(n)?n:/^[aeiou]/i.test(n)?"an "+n:/^[a-z]/i.test(n)?"a "+n:n}function formatErrorMessage(n,t){var e=isArrayCulprit(n.path),r=n.path.join(".")+" "+t,o=e?"Item at position ":"";return o+r}function isArrayCulprit(n){return typeof n[n.length-1]=="number"||typeof n[0]=="number"}function objectEntries(n){return Object.keys(n||{}).map(function(t){return{key:t,value:n[t]}})}v$2.validate=validate;v$2.processMessage=processMessage;var lib$1=v$2,xtend$1=immutable,v$1=lib$1;function file(n){if(typeof window<"u")return n instanceof commonjsGlobal.Blob||n instanceof commonjsGlobal.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof n=="string"||n.pipe!==void 0))return"Filename or Readable stream"}function assertShape(n,t){return v$1.assert(v$1.strictShape(n),t)}function date(n){var t="date";if(typeof n=="boolean")return t;try{var e=new Date(n);if(e.getTime&&isNaN(e.getTime()))return t}catch{return t}}function coordinates$1(n){return v$1.tuple(v$1.number,v$1.number)(n)}var validator=xtend$1(v$1,{file,date,coordinates:coordinates$1,assertShape});function pick$1(n,t){var e=function(r,o){return t.indexOf(r)!==-1&&o!==void 0};return typeof t=="function"&&(e=t),Object.keys(n).filter(function(r){return e(r,n[r])}).reduce(function(r,o){return r[o]=n[o],r},{})}var pick_1=pick$1;function objectMap$1(n,t){return Object.keys(n).reduce(function(e,r){return e[r]=t(r,n[r]),e},{})}var objectMap_1=objectMap$1,objectMap=objectMap_1;function stringifyBoolean(n){return objectMap(n,function(t,e){return typeof e=="boolean"?JSON.stringify(e):e})}var stringifyBooleans$1=stringifyBoolean,MapiClient=mapiClient,createClient=browserClient;function createServiceFactory$1(n){return function(t){var e;MapiClient.prototype.isPrototypeOf(t)?e=t:e=createClient(t);var r=Object.create(n);return r.client=e,r}}var createServiceFactory_1=createServiceFactory$1,xtend=immutable,v=validator,pick=pick_1,stringifyBooleans=stringifyBooleans$1,createServiceFactory=createServiceFactory_1,Geocoding={},featureTypes=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Geocoding.forwardGeocode=function(n){v.assertShape({query:v.required(v.string),mode:v.oneOf("mapbox.places","mapbox.places-permanent"),countries:v.arrayOf(v.string),proximity:v.oneOf(v.coordinates,"ip"),types:v.arrayOf(v.oneOf(featureTypes)),autocomplete:v.boolean,bbox:v.arrayOf(v.number),limit:v.number,language:v.arrayOf(v.string),routing:v.boolean,fuzzyMatch:v.boolean,worldview:v.string})(n),n.mode=n.mode||"mapbox.places";var t=stringifyBooleans(xtend({country:n.countries},pick(n,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pick(n,["mode","query"]),query:t})};Geocoding.reverseGeocode=function(n){v.assertShape({query:v.required(v.coordinates),mode:v.oneOf("mapbox.places","mapbox.places-permanent"),countries:v.arrayOf(v.string),types:v.arrayOf(v.oneOf(featureTypes)),bbox:v.arrayOf(v.number),limit:v.number,language:v.arrayOf(v.string),reverseMode:v.oneOf("distance","score"),routing:v.boolean,worldview:v.string})(n),n.mode=n.mode||"mapbox.places";var t=stringifyBooleans(xtend({country:n.countries},pick(n,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pick(n,["mode","query"]),query:t})};var geocoding$1=createServiceFactory(Geocoding);let urlAlphabet="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",random=n=>crypto.getRandomValues(new Uint8Array(n)),customRandom=(n,t,e)=>{let r=(2<<Math.log(n.length-1)/Math.LN2)-1,o=-~(1.6*r*t/n.length);return(s=t)=>{let l="";for(;;){let a=e(o),h=o;for(;h--;)if(l+=n[a[h]&r]||"",l.length===s)return l}}},customAlphabet=(n,t=21)=>customRandom(n,t,random),nanoid$1=(n=21)=>crypto.getRandomValues(new Uint8Array(n)).reduce((t,e)=>(e&=63,e<36?t+=e.toString(36):e<62?t+=(e-26).toString(36).toUpperCase():e>62?t+="-":t+="_",t),"");const index_browser=Object.freeze(Object.defineProperty({__proto__:null,customAlphabet,customRandom,nanoid:nanoid$1,random,urlAlphabet},Symbol.toStringTag,{value:"Module"})),require$$0$4=getAugmentedNamespace(index_browser);var nanoid=require$$0$4.nanoid;function MapboxEventManager$1(n){this.origin=n.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=n.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=n,this.send=this.send.bind(this),this.countries=n.countries?n.countries.split(","):null,this.types=n.types?n.types.split(","):null,this.bbox=n.bbox?n.bbox:null,this.language=n.language?n.language.split(","):null,this.limit=n.limit?+n.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(n),this.eventQueue=new Array,this.flushInterval=n.flushInterval||1e3,this.maxQueueSize=n.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}MapboxEventManager$1.prototype={select:function(n,t){var e=this.getSelectedIndex(n,t),r=this.getEventPayload("search.select",t);if(r.resultIndex=e,r.resultPlaceName=n.place_name,r.resultId=n.id,!(e===this.lastSentIndex&&r.queryString===this.lastSentInput||e==-1)&&(this.lastSentIndex=e,this.lastSentInput=r.queryString,!!r.queryString))return this.push(r)},start:function(n){var t=this.getEventPayload("search.start",n);if(t.queryString)return this.push(t)},keyevent:function(n,t){if(n.key&&!(n.metaKey||[9,27,37,39,13,38,40].indexOf(n.keyCode)!==-1)){var e=this.getEventPayload("search.keystroke",t);if(e.lastAction=n.key,!!e.queryString)return this.push(e)}},send:function(n,t){if(!this.enableEventLogging)return t?t():void 0;var e=this.getRequestOptions(n);this.request(e,(function(r){if(r)return this.handleError(r,t);if(t)return t()}).bind(this))},getRequestOptions:function(n){Array.isArray(n)||(n=[n]);var t={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(n)};return t},getEventPayload:function(n,t){var e;t.options.proximity?typeof t.options.proximity=="object"?e=[t.options.proximity.longitude,t.options.proximity.latitude]:t.options.proximity==="ip"?e=[999,999]:e=t.options.proximity:e=null;var r=t._map?t._map.getZoom():void 0,o={event:n,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:t.options.autocomplete,fuzzyMatch:t.options.fuzzyMatch,proximity:e,limit:t.options.limit,routing:t.options.routing,worldview:t.options.worldview,mapZoom:r,keyboardLocale:this.locale};return n==="search.select"?o.queryString=t.inputString:n!="search.select"&&t._inputEl?o.queryString=t._inputEl.value:o.queryString=t.inputString,o},request:function(n,t){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(this.readyState==4)return this.status==204?t(null):t(this.statusText)},e.open(n.method,n.host+"/"+n.path,!0);for(var r in n.headers){var o=n.headers[r];e.setRequestHeader(r,o)}e.send(n.body)},handleError:function(n,t){if(t)return t(n)},generateSessionID:function(){return nanoid()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(n,t){if(t._typeahead){var e=t._typeahead.data,r=n.id,o=e.map(function(l){return l.id}),s=o.indexOf(r);return s}},shouldEnableLogging:function(n){return!(n.enableEventLogging===!1||n.origin&&n.origin!=="https://api.mapbox.com"||n.localGeocoder||n.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(n,t){this.eventQueue.push(n),(this.eventQueue.length>=this.maxQueueSize||t)&&this.flush()},remove:function(){this.flush()}};var events=MapboxEventManager$1,placeholder={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},localization$1={placeholder},subtag$1={exports:{}};(function(n){(function(t,e,r){n.exports?n.exports=r():t[e]=r()})(commonjsGlobal,"subtag",function(){var t="",e=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function r(h){return h.match(e)||[]}function o(h){return r(h).filter(function(y,C){return y&&C})}function s(h){return h=r(h),{language:h[1]||t,extlang:h[2]||t,script:h[3]||t,region:h[4]||t}}function l(h,y,C){Object.defineProperty(h,y,{value:C,enumerable:!0})}function a(h,y,C){function L(Y){return r(Y)[h]||t}l(L,"pattern",y),l(s,C,L)}return a(1,/^[a-zA-Z]{2,3}$/,"language"),a(2,/^[a-zA-Z]{3}$/,"extlang"),a(3,/^[a-zA-Z]{4}$/,"script"),a(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),l(s,"split",o),s})})(subtag$1);var subtagExports=subtag$1.exports;function Geolocation$1(){}Geolocation$1.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const n={enableHighAccuracy:!0};return new Promise(function(t,e){window.navigator.geolocation.getCurrentPosition(t,e,n)})}};var geolocation$1=Geolocation$1;function transformFeatureToGeolocationText(n,t){const e=getAddressInfo(n),r=["address","street","place","country"];var o;if(typeof t=="function")return t(e);const s=r.indexOf(t);return s===-1?o=r:o=r.slice(s),o.reduce(function(l,a){return e[a]?(l!==""&&(l=l+", "),l+e[a]):l},"")}function getAddressInfo(n){const t=n.address||"",e=n.text||"",r=n.place_name||"",s={address:r.split(",")[0],houseNumber:t,street:e,placeName:r};return n.context.forEach(function(l){const a=l.id.split(".")[0];s[a]=l.text}),s}const REVERSE_GEOCODE_COORD_RGX=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var utils$2={transformFeatureToGeolocationText,getAddressInfo,REVERSE_GEOCODE_COORD_RGX},Typeahead=suggestions,debounce$1=lodash_debounce,extend$3=immutable,EventEmitter=eventsExports.EventEmitter,exceptions=exceptions$1,MapboxClient=mapboxSdk,mbxGeocoder=geocoding$1,MapboxEventManager=events,localization=localization$1,subtag=subtagExports,Geolocation=geolocation$1,utils$1=utils$2;const GEOCODE_REQUEST_TYPE={FORWARD:0,LOCAL:1,REVERSE:2};function getFooterNode(){var n=document.createElement("div");return n.className="mapboxgl-ctrl-geocoder--powered-by",n.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',n}function MapboxGeocoder(n){this._eventEmitter=new EventEmitter,this.options=extend$3({},this.options,n),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new Geolocation}MapboxGeocoder.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(n){return n.place_name},render:function(n){var t=n.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+t[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+t.splice(1,t.length).join(",")+"</div></div>"}},addTo:function(n){function t(e,r){if(!document.body.contains(r))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const o=e.onAdd();r.appendChild(o)}if(n._controlContainer)n.addControl(this);else if(n instanceof HTMLElement)t(this,n);else if(typeof n=="string"){const e=document.querySelectorAll(n);if(e.length===0)throw new Error("Element ",n,"not found.");if(e.length>1)throw new Error("Geocoder can only be added to a single html element");t(this,e[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(n){if(n&&typeof n!="string"&&(this._map=n),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=mbxGeocoder(MapboxClient({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new MapboxEventManager(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var t=this.container=document.createElement("div");t.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var e=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",debounce$1(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",(function(y){this.eventManager.keyevent(y,this)}).bind(this));var r=document.createElement("div");r.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var o=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(o),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),r.appendChild(this._clearEl),r.appendChild(this._loadingEl),t.appendChild(e),t.appendChild(this._inputEl),t.appendChild(r),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var s=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(s),r.appendChild(this._geolocateEl),this._showGeolocateButton()}var l=this._typeahead=new Typeahead(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),l.getItemValue=this.options.getItemValue;var a=l.list.draw,h=this._footerNode=getFooterNode();return l.list.draw=function(){a.call(this),h.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),h.addEventListener("mouseup",(function(){this.selectingListItem=!1}).bind(this)),this.element.appendChild(h)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),t},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then((function(n){this._hideLoadingIcon();const t={geometry:{type:"Point",coordinates:[n.coords.longitude,n.coords.latitude]}};this._handleMarker(t),this._fly(t),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(t),this._showClearButton(),this.fresh=!1;const e={limit:1,language:[this.options.language],query:t.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const r=t.geometry.coordinates[0]+","+t.geometry.coordinates[1];this._setInputValue(r),this._eventEmitter.emit("result",{result:t})}else this.geocoderService.reverseGeocode(e).send().then((function(r){const o=r.body.features[0];if(o){const s=utils$1.transformFeatureToGeolocationText(o,this.options.addressAccuracy);this._setInputValue(s),o.user_coordinates=t.geometry.coordinates,this._eventEmitter.emit("result",{result:o})}else this._eventEmitter.emit("result",{result:{user_coordinates:t.geometry.coordinates}})}).bind(this))}).bind(this)).catch((function(n){n.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}).bind(this))},createIcon:function(n,t){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");return e.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+n),e.setAttribute("viewBox","0 0 18 18"),e.setAttribute("xml:space","preserve"),e.setAttribute("width",18),e.setAttribute("height",18),e.innerHTML=t,e},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(n){this._inputEl.value=n,setTimeout((function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}).bind(this),1)},_onPaste:function(n){var t=(n.clipboardData||window.clipboardData).getData("text");t.length>=this.options.minLength&&this._geocode(t)},_onKeyDown:function(n){var t=27,e=9;if(n.keyCode===t&&this.options.clearAndBlurOnEsc)return this._clear(n),this._inputEl.blur();var r=n.target&&n.target.shadowRoot?n.target.shadowRoot.activeElement:n.target,o=r?r.value:"";if(!o)return this.fresh=!0,n.keyCode!==e&&this.clear(n),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(n.metaKey||[e,t,37,39,13,38,40].indexOf(n.keyCode)!==-1)&&r.value.length>=this.options.minLength&&this._geocode(r.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(n){this.options.clearOnBlur&&this._clearOnBlur(n),this.options.collapsed&&this._collapse()},_onChange:function(){var n=this._typeahead.selected;n&&JSON.stringify(n)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(n),this.options.marker&&this._mapboxgl&&this._handleMarker(n),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(n),this._eventEmitter.emit("result",{result:n}),this.eventManager.select(n,this))},_fly:function(n){var t;if(n.properties&&exceptions[n.properties.short_code])t=extend$3({},this.options.flyTo),this._map&&this._map.fitBounds(exceptions[n.properties.short_code].bbox,t);else if(n.bbox){var e=n.bbox;t=extend$3({},this.options.flyTo),this._map&&this._map.fitBounds([[e[0],e[1]],[e[2],e[3]]],t)}else{var r={zoom:this.options.zoom};t=extend$3({},r,this.options.flyTo),n.center?t.center=n.center:n.geometry&&n.geometry.type&&n.geometry.type==="Point"&&n.geometry.coordinates&&(t.center=n.geometry.coordinates),this._map&&this._map.flyTo(t)}},_requestType:function(n,t){var e;return n.localGeocoderOnly?e=GEOCODE_REQUEST_TYPE.LOCAL:n.reverseGeocode&&utils$1.REVERSE_GEOCODE_COORD_RGX.test(t)?e=GEOCODE_REQUEST_TYPE.REVERSE:e=GEOCODE_REQUEST_TYPE.FORWARD,e},_setupConfig:function(n,t){const e=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],r=/[\s,]+/;var o=this,s=e.reduce(function(a,h){if(o.options[h]===void 0||o.options[h]===null)return a;["countries","types","language"].indexOf(h)>-1?a[h]=o.options[h].split(r):a[h]=o.options[h];const y=typeof o.options[h].longitude=="number"&&typeof o.options[h].latitude=="number";if(h==="proximity"&&y){const C=o.options[h].longitude,L=o.options[h].latitude;a[h]=[C,L]}return a},{});switch(n){case GEOCODE_REQUEST_TYPE.REVERSE:{var l=t.split(r).map(function(a){return parseFloat(a,10)});o.options.flipCoordinates||l.reverse(),s.types&&s.types[0],s=extend$3(s,{query:l,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(a){a in s&&delete s[a]})}break;case GEOCODE_REQUEST_TYPE.FORWARD:{const a=t.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(a)&&(t=t.replace(/,/g," ")),s=extend$3(s,{query:t})}break}return s},_geocode:function(n){this.inputString=n,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:n});const t=this._requestType(this.options,n),e=this._setupConfig(t,n);var r;switch(t){case GEOCODE_REQUEST_TYPE.LOCAL:r=Promise.resolve();break;case GEOCODE_REQUEST_TYPE.FORWARD:r=this.geocoderService.forwardGeocode(e).send();break;case GEOCODE_REQUEST_TYPE.REVERSE:r=this.geocoderService.reverseGeocode(e).send();break}var o=this.options.localGeocoder?this.options.localGeocoder(n)||[]:[],s=[],l=null;return r.catch((function(a){l=a}).bind(this)).then((function(a){this._hideLoadingIcon();var h={};return a?a.statusCode=="200"&&(h=a.body,h.request=a.request,h.headers=a.headers):h={type:"FeatureCollection",features:[]},h.config=e,this.fresh&&(this.eventManager.start(this),this.fresh=!1),h.features=h.features?o.concat(h.features):o,this.options.externalGeocoder?(s=this.options.externalGeocoder(n,h.features)||Promise.resolve([]),s.then(function(y){return h.features=h.features?y.concat(h.features):y,h},function(){return h})):h}).bind(this)).then((function(a){if(l)throw l;this.options.filter&&a.features.length&&(a.features=a.features.filter(this.options.filter)),a.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",a),this._typeahead.update(a.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",a))}).bind(this)).catch((function(a){this._hideLoadingIcon(),this._hideAttribution(),o.length&&this.options.localGeocoder||s.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(o)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:o}),this._eventEmitter.emit("error",{error:a})}).bind(this)),r},_clear:function(n){n&&n.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(n){this._clear(n),this._inputEl.focus()},_clearOnBlur:function(n){var t=this;n.relatedTarget&&t._clear(n)},_onQueryResult:function(n){var t=n.body;if(t.features.length){var e=t.features[0];this._typeahead.selected=e,this._inputEl.value=e.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var n=this._map.getCenter().wrap();this.setProximity({longitude:n.lng,latitude:n.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(n){return this._geocode(n).then(this._onQueryResult),this},_renderError:function(){var n="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(n)},_renderLocationError:function(){var n="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(n)},_renderNoResults:function(){var n="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(n)},_renderUserDeniedGeolocationError:function(){var n="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(n)},_renderMessage:function(n){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(n)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var n=this.options.language.split(",")[0],t=subtag.language(n),e=localization.placeholder[t];if(e)return e}return"Search"},setInput:function(n){return this._inputEl.value=n,this._typeahead.selected=null,this._typeahead.clear(),n.length>=this.options.minLength&&this._geocode(n),this},setProximity:function(n,t=!0){return this.options.proximity=n,t&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(n){return n&&typeof n=="function"&&(this._typeahead.render=n),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(n){var t=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=n||this.options.language||t,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(n){return this.options.zoom=n,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(n){return this.options.flyTo=n,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(n){return this.placeholder=n||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(n){return this.options.bbox=n,this},getCountries:function(){return this.options.countries},setCountries:function(n){return this.options.countries=n,this},getTypes:function(){return this.options.types},setTypes:function(n){return this.options.types=n,this},getMinLength:function(){return this.options.minLength},setMinLength:function(n){return this.options.minLength=n,this._typeahead&&(this._typeahead.options.minLength=n),this},getLimit:function(){return this.options.limit},setLimit:function(n){return this.options.limit=n,this._typeahead&&(this._typeahead.options.limit=n),this},getFilter:function(){return this.options.filter},setFilter:function(n){return this.options.filter=n,this},setOrigin:function(n){return this.options.origin=n,this.geocoderService=mbxGeocoder(MapboxClient({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(n){return this.options.accessToken=n,this.geocoderService=mbxGeocoder(MapboxClient({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(n){return this.options.autocomplete=n,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(n){return this.options.fuzzyMatch=n,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(n){return this.options.routing=n,this},getRouting:function(){return this.options.routing},setWorldview:function(n){return this.options.worldview=n,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(n){if(this._map){this._removeMarker();var t={color:"#4668F2"},e=extend$3({},t,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(e),n.center?this.mapMarker.setLngLat(n.center).addTo(this._map):n.geometry&&n.geometry.type&&n.geometry.type==="Point"&&n.geometry.coordinates&&this.mapMarker.setLngLat(n.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(n,t){return this._eventEmitter.on(n,t),this},off:function(n,t){return this._eventEmitter.removeListener(n,t),this.eventManager.remove(),this}};var lib=MapboxGeocoder;const MapboxGeocoder$1=getDefaultExportFromCjs(lib),mapboxGlGeocoder="";var maplibreGl={exports:{}};(function(n,t){(function(e,r){n.exports=r()})(commonjsGlobal,function(){var e,r,o;function s(a,h){if(!e)e=h;else if(!r)r=h;else{var y="var sharedChunk = {}; ("+e+")(sharedChunk); ("+r+")(sharedChunk);",C={};e(C),o=h(C),typeof window<"u"&&(o.workerUrl=window.URL.createObjectURL(new Blob([y],{type:"text/javascript"})))}}s(["exports"],function(a){function h(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x.default:x}var y=C;function C(x,g){this.x=x,this.y=g}C.prototype={clone:function(){return new C(this.x,this.y)},add:function(x){return this.clone()._add(x)},sub:function(x){return this.clone()._sub(x)},multByPoint:function(x){return this.clone()._multByPoint(x)},divByPoint:function(x){return this.clone()._divByPoint(x)},mult:function(x){return this.clone()._mult(x)},div:function(x){return this.clone()._div(x)},rotate:function(x){return this.clone()._rotate(x)},rotateAround:function(x,g){return this.clone()._rotateAround(x,g)},matMult:function(x){return this.clone()._matMult(x)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(x){return this.x===x.x&&this.y===x.y},dist:function(x){return Math.sqrt(this.distSqr(x))},distSqr:function(x){var g=x.x-this.x,S=x.y-this.y;return g*g+S*S},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(x){return Math.atan2(this.y-x.y,this.x-x.x)},angleWith:function(x){return this.angleWithSep(x.x,x.y)},angleWithSep:function(x,g){return Math.atan2(this.x*g-this.y*x,this.x*x+this.y*g)},_matMult:function(x){var g=x[2]*this.x+x[3]*this.y;return this.x=x[0]*this.x+x[1]*this.y,this.y=g,this},_add:function(x){return this.x+=x.x,this.y+=x.y,this},_sub:function(x){return this.x-=x.x,this.y-=x.y,this},_mult:function(x){return this.x*=x,this.y*=x,this},_div:function(x){return this.x/=x,this.y/=x,this},_multByPoint:function(x){return this.x*=x.x,this.y*=x.y,this},_divByPoint:function(x){return this.x/=x.x,this.y/=x.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var x=this.y;return this.y=this.x,this.x=-x,this},_rotate:function(x){var g=Math.cos(x),S=Math.sin(x),W=S*this.x+g*this.y;return this.x=g*this.x-S*this.y,this.y=W,this},_rotateAround:function(x,g){var S=Math.cos(x),W=Math.sin(x),ut=g.y+W*(this.x-g.x)+S*(this.y-g.y);return this.x=g.x+S*(this.x-g.x)-W*(this.y-g.y),this.y=ut,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},C.convert=function(x){return x instanceof C?x:Array.isArray(x)?new C(x[0],x[1]):x};var L=h(y),Y=ze;function ze(x,g,S,W){this.cx=3*x,this.bx=3*(S-x)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*g,this.by=3*(W-g)-this.cy,this.ay=1-this.cy-this.by,this.p1x=x,this.p1y=g,this.p2x=S,this.p2y=W}ze.prototype={sampleCurveX:function(x){return((this.ax*x+this.bx)*x+this.cx)*x},sampleCurveY:function(x){return((this.ay*x+this.by)*x+this.cy)*x},sampleCurveDerivativeX:function(x){return(3*this.ax*x+2*this.bx)*x+this.cx},solveCurveX:function(x,g){if(g===void 0&&(g=1e-6),x<0)return 0;if(x>1)return 1;for(var S=x,W=0;W<8;W++){var ut=this.sampleCurveX(S)-x;if(Math.abs(ut)<g)return S;var Ht=this.sampleCurveDerivativeX(S);if(Math.abs(Ht)<1e-6)break;S-=ut/Ht}var Jt=0,In=1;for(S=x,W=0;W<20&&(ut=this.sampleCurveX(S),!(Math.abs(ut-x)<g));W++)x>ut?Jt=S:In=S,S=.5*(In-Jt)+Jt;return S},solve:function(x,g){return this.sampleCurveY(this.solveCurveX(x,g))}};var Bt=h(Y);function Ir(x,g,S,W){const ut=new Bt(x,g,S,W);return function(Ht){return ut.solve(Ht)}}const Wr=Ir(.25,.1,.25,1);function yi(x,g,S){return Math.min(S,Math.max(g,x))}function Bn(x,g,S){const W=S-g,ut=((x-g)%W+W)%W+g;return ut===g?S:ut}function vi(x,...g){for(const S of g)for(const W in S)x[W]=S[W];return x}let wo=1;function ia(x,g){x.forEach(S=>{g[S]&&(g[S]=g[S].bind(g))})}function gl(x,g,S){const W={};for(const ut in x)W[ut]=g.call(S||this,x[ut],ut,x);return W}function ml(x,g,S){const W={};for(const ut in x)g.call(S||this,x[ut],ut,x)&&(W[ut]=x[ut]);return W}function il(x){return Array.isArray(x)?x.map(il):typeof x=="object"&&x?gl(x,il):x}const sl={};function ol(x){sl[x]||(typeof console<"u"&&console.warn(x),sl[x]=!0)}function _l(x,g,S){return(S.y-x.y)*(g.x-x.x)>(g.y-x.y)*(S.x-x.x)}function rh(x){let g=0;for(let S,W,ut=0,Ht=x.length,Jt=Ht-1;ut<Ht;Jt=ut++)S=x[ut],W=x[Jt],g+=(W.x-S.x)*(S.y+W.y);return g}function wh(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let Fh=null;function Mh(x){if(Fh==null){const g=x.navigator?x.navigator.userAgent:null;Fh=!!x.safari||!(!g||!(/\b(iPad|iPhone|iPod)\b/.test(g)||g.match("Safari")&&!g.match("Chrome")))}return Fh}function vp(x){return typeof ImageBitmap<"u"&&x instanceof ImageBitmap}const gp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Jh,Lp;const Ip={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(x){const g=requestAnimationFrame(x);return{cancel:()=>cancelAnimationFrame(g)}},getImageData(x,g=0){return this.getImageCanvasContext(x).getImageData(-g,-g,x.width+2*g,x.height+2*g)},getImageCanvasContext(x){const g=window.document.createElement("canvas"),S=g.getContext("2d",{willReadFrequently:!0});if(!S)throw new Error("failed to create canvas 2d context");return g.width=x.width,g.height=x.height,S.drawImage(x,0,0,x.width,x.height),S},resolveURL:x=>(Jh||(Jh=document.createElement("a")),Jh.href=x,Jh.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Lp==null&&(Lp=matchMedia("(prefers-reduced-motion: reduce)")),Lp.matches)}},$p={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class Xp extends Error{constructor(g,S,W,ut){super(`AJAXError: ${S} (${g}): ${W}`),this.status=g,this.statusText=S,this.url=W,this.body=ut}}const Cp=wh()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Gp=x=>$p.REGISTERED_PROTOCOLS[x.substring(0,x.indexOf("://"))];function Rp(x,g){const S=new AbortController,W=new Request(x.url,{method:x.method||"GET",body:x.body,credentials:x.credentials,headers:x.headers,referrer:Cp(),signal:S.signal});let ut=!1,Ht=!1;return x.type==="json"&&W.headers.set("Accept","application/json"),Ht||fetch(W).then(Jt=>Jt.ok?(In=>{(x.type==="arrayBuffer"||x.type==="image"?In.arrayBuffer():x.type==="json"?In.json():In.text()).then(So=>{Ht||(ut=!0,g(null,So,In.headers.get("Cache-Control"),In.headers.get("Expires")))}).catch(So=>{Ht||g(new Error(So.message))})})(Jt):Jt.blob().then(In=>g(new Xp(Jt.status,Jt.statusText,x.url,In)))).catch(Jt=>{Jt.code!==20&&g(new Error(Jt.message))}),{cancel:()=>{Ht=!0,ut||S.abort()}}}const od=function(x,g){if(/:\/\//.test(x.url)&&!/^https?:|^file:/.test(x.url)){if(wh()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",x,g);if(!wh())return(Gp(x.url)||Rp)(x,g)}if(!(/^file:/.test(S=x.url)||/^file:/.test(Cp())&&!/^\w+:/.test(S))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Rp(x,g);if(wh()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",x,g,void 0,!0)}var S;return function(W,ut){const Ht=new XMLHttpRequest;Ht.open(W.method||"GET",W.url,!0),W.type!=="arrayBuffer"&&W.type!=="image"||(Ht.responseType="arraybuffer");for(const Jt in W.headers)Ht.setRequestHeader(Jt,W.headers[Jt]);return W.type==="json"&&(Ht.responseType="text",Ht.setRequestHeader("Accept","application/json")),Ht.withCredentials=W.credentials==="include",Ht.onerror=()=>{ut(new Error(Ht.statusText))},Ht.onload=()=>{if((Ht.status>=200&&Ht.status<300||Ht.status===0)&&Ht.response!==null){let Jt=Ht.response;if(W.type==="json")try{Jt=JSON.parse(Ht.response)}catch(In){return ut(In)}ut(null,Jt,Ht.getResponseHeader("Cache-Control"),Ht.getResponseHeader("Expires"))}else{const Jt=new Blob([Ht.response],{type:Ht.getResponseHeader("Content-Type")});ut(new Xp(Ht.status,Ht.statusText,W.url,Jt))}},Ht.send(W.body),{cancel:()=>Ht.abort()}}(x,g)},Wp=function(x,g){return od(vi(x,{type:"arrayBuffer"}),g)};function Ld(x){if(!x||x.indexOf("://")<=0||x.indexOf("data:image/")===0||x.indexOf("blob:")===0)return!0;const g=new URL(x),S=window.location;return g.protocol===S.protocol&&g.host===S.host}function ed(x,g,S){S[x]&&S[x].indexOf(g)!==-1||(S[x]=S[x]||[],S[x].push(g))}function Gd(x,g,S){if(S&&S[x]){const W=S[x].indexOf(g);W!==-1&&S[x].splice(W,1)}}class Kp{constructor(g,S={}){vi(this,S),this.type=g}}class Ad extends Kp{constructor(g,S={}){super("error",vi({error:g},S))}}class Id{on(g,S){return this._listeners=this._listeners||{},ed(g,S,this._listeners),this}off(g,S){return Gd(g,S,this._listeners),Gd(g,S,this._oneTimeListeners),this}once(g,S){return S?(this._oneTimeListeners=this._oneTimeListeners||{},ed(g,S,this._oneTimeListeners),this):new Promise(W=>this.once(g,W))}fire(g,S){typeof g=="string"&&(g=new Kp(g,S||{}));const W=g.type;if(this.listens(W)){g.target=this;const ut=this._listeners&&this._listeners[W]?this._listeners[W].slice():[];for(const In of ut)In.call(this,g);const Ht=this._oneTimeListeners&&this._oneTimeListeners[W]?this._oneTimeListeners[W].slice():[];for(const In of Ht)Gd(W,In,this._oneTimeListeners),In.call(this,g);const Jt=this._eventedParent;Jt&&(vi(g,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),Jt.fire(g))}else g instanceof Ad&&console.error(g.error);return this}listens(g){return this._listeners&&this._listeners[g]&&this._listeners[g].length>0||this._oneTimeListeners&&this._oneTimeListeners[g]&&this._oneTimeListeners[g].length>0||this._eventedParent&&this._eventedParent.listens(g)}setEventedParent(g,S){return this._eventedParent=g,this._eventedParentData=S,this}}var Yh={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ap=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function kd(x,g){const S={};for(const W in x)W!=="ref"&&(S[W]=x[W]);return Ap.forEach(W=>{W in g&&(S[W]=g[W])}),S}function cd(x,g){if(Array.isArray(x)){if(!Array.isArray(g)||x.length!==g.length)return!1;for(let S=0;S<x.length;S++)if(!cd(x[S],g[S]))return!1;return!0}if(typeof x=="object"&&x!==null&&g!==null){if(typeof g!="object"||Object.keys(x).length!==Object.keys(g).length)return!1;for(const S in x)if(!cd(x[S],g[S]))return!1;return!0}return x===g}const id={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function fp(x,g,S){S.push({command:id.addSource,args:[x,g[x]]})}function Cd(x,g,S){g.push({command:id.removeSource,args:[x]}),S[x]=!0}function Fd(x,g,S,W){Cd(x,S,W),fp(x,g,S)}function yd(x,g,S){let W;for(W in x[S])if(Object.prototype.hasOwnProperty.call(x[S],W)&&W!=="data"&&!cd(x[S][W],g[S][W]))return!1;for(W in g[S])if(Object.prototype.hasOwnProperty.call(g[S],W)&&W!=="data"&&!cd(x[S][W],g[S][W]))return!1;return!0}function kp(x,g,S,W,ut,Ht){let Jt;for(Jt in g=g||{},x=x||{})Object.prototype.hasOwnProperty.call(x,Jt)&&(cd(x[Jt],g[Jt])||S.push({command:Ht,args:[W,Jt,g[Jt],ut]}));for(Jt in g)Object.prototype.hasOwnProperty.call(g,Jt)&&!Object.prototype.hasOwnProperty.call(x,Jt)&&(cd(x[Jt],g[Jt])||S.push({command:Ht,args:[W,Jt,g[Jt],ut]}))}function Uf(x){return x.id}function $f(x,g){return x[g.id]=g,x}class up{constructor(g,S,W,ut){this.message=(g?`${g}: `:"")+W,ut&&(this.identifier=ut),S!=null&&S.__line__&&(this.line=S.__line__)}}function ud(x,...g){for(const S of g)for(const W in S)x[W]=S[W];return x}class xd extends Error{constructor(g,S){super(S),this.message=S,this.key=g}}class Ed{constructor(g,S=[]){this.parent=g,this.bindings={};for(const[W,ut]of S)this.bindings[W]=ut}concat(g){return new Ed(this,g)}get(g){if(this.bindings[g])return this.bindings[g];if(this.parent)return this.parent.get(g);throw new Error(`${g} not found in scope.`)}has(g){return!!this.bindings[g]||!!this.parent&&this.parent.has(g)}}const Vd={kind:"null"},Ep={kind:"number"},Yp={kind:"string"},nd={kind:"boolean"},$d={kind:"color"},Qd={kind:"object"},Rd={kind:"value"},ng={kind:"collator"},bg={kind:"formatted"},Ih={kind:"padding"},nh={kind:"resolvedImage"};function sh(x,g){return{kind:"array",itemType:x,N:g}}function oh(x){if(x.kind==="array"){const g=oh(x.itemType);return typeof x.N=="number"?`array<${g}, ${x.N}>`:x.itemType.kind==="value"?"array":`array<${g}>`}return x.kind}const Oh=[Vd,Ep,Yp,nd,$d,bg,Qd,sh(Rd),Ih,nh];function Uh(x,g){if(g.kind==="error")return null;if(x.kind==="array"){if(g.kind==="array"&&(g.N===0&&g.itemType.kind==="value"||!Uh(x.itemType,g.itemType))&&(typeof x.N!="number"||x.N===g.N))return null}else{if(x.kind===g.kind)return null;if(x.kind==="value"){for(const S of Oh)if(!Uh(S,g))return null}}return`Expected ${oh(x)} but found ${oh(g)} instead.`}function vl(x,g){return g.some(S=>S.kind===x.kind)}function gs(x,g){return g.some(S=>S==="null"?x===null:S==="array"?Array.isArray(x):S==="object"?x&&!Array.isArray(x)&&typeof x=="object":S===typeof x)}function di(x,g){return x.kind==="array"&&g.kind==="array"?x.itemType.kind===g.itemType.kind&&typeof x.N=="number":x.kind===g.kind}const fs=.96422,cl=.82521,ih=4/29,uh=6/29,vh=3*uh*uh,Th=uh*uh*uh,kh=Math.PI/180,ep=180/Math.PI;function ip(x){return(x%=360)<0&&(x+=360),x}function _p([x,g,S,W]){let ut,Ht;const Jt=Dd((.2225045*(x=rd(x))+.7168786*(g=rd(g))+.0606169*(S=rd(S)))/1);x===g&&g===S?ut=Ht=Jt:(ut=Dd((.4360747*x+.3850649*g+.1430804*S)/fs),Ht=Dd((.0139322*x+.0971045*g+.7141733*S)/cl));const In=116*Jt-16;return[In<0?0:In,500*(ut-Jt),200*(Jt-Ht),W]}function rd(x){return x<=.04045?x/12.92:Math.pow((x+.055)/1.055,2.4)}function Dd(x){return x>Th?Math.pow(x,1/3):x/vh+ih}function qp([x,g,S,W]){let ut=(x+16)/116,Ht=isNaN(g)?ut:ut+g/500,Jt=isNaN(S)?ut:ut-S/200;return ut=1*dd(ut),Ht=fs*dd(Ht),Jt=cl*dd(Jt),[wd(3.1338561*Ht-1.6168667*ut-.4906146*Jt),wd(-.9787684*Ht+1.9161415*ut+.033454*Jt),wd(.0719453*Ht-.2289914*ut+1.4052427*Jt),W]}function wd(x){return(x=x<=.00304?12.92*x:1.055*Math.pow(x,1/2.4)-.055)<0?0:x>1?1:x}function dd(x){return x>uh?x*x*x:vh*(x-ih)}function Wd(x){return parseInt(x.padEnd(2,x),16)/255}function Vf(x,g){return Wf(g?x/100:x,0,1)}function Wf(x,g,S){return Math.min(Math.max(g,x),S)}function pg(x){return!x.some(Number.isNaN)}const Jd={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Yd{constructor(g,S,W,ut=1,Ht=!0){this.r=g,this.g=S,this.b=W,this.a=ut,Ht||(this.r*=ut,this.g*=ut,this.b*=ut,ut||this.overwriteGetter("rgb",[g,S,W,ut]))}static parse(g){if(g instanceof Yd)return g;if(typeof g!="string")return;const S=function(W){if((W=W.toLowerCase())==="transparent")return[0,0,0,0];const ut=Jd[W];if(ut){const[Jt,In,So]=ut;return[Jt/255,In/255,So/255,1]}if(W.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(W)){const Jt=W.length<6?1:2;let In=1;return[Wd(W.slice(In,In+=Jt)),Wd(W.slice(In,In+=Jt)),Wd(W.slice(In,In+=Jt)),Wd(W.slice(In,In+Jt)||"ff")]}if(W.startsWith("rgb")){const Jt=W.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(Jt){const[In,So,al,hl,eh,ah,ch,dh,Dh,Ph,Xh,Qh]=Jt,qh=[hl||" ",ch||" ",Ph].join("");if(qh==="  "||qh==="  /"||qh===",,"||qh===",,,"){const lp=[al,ah,Dh].join(""),dp=lp==="%%%"?100:lp===""?255:0;if(dp){const Mp=[Wf(+So/dp,0,1),Wf(+eh/dp,0,1),Wf(+dh/dp,0,1),Xh?Vf(+Xh,Qh):1];if(pg(Mp))return Mp}}return}}const Ht=W.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(Ht){const[Jt,In,So,al,hl,eh,ah,ch,dh]=Ht,Dh=[So||" ",hl||" ",ah].join("");if(Dh==="  "||Dh==="  /"||Dh===",,"||Dh===",,,"){const Ph=[+In,Wf(+al,0,100),Wf(+eh,0,100),ch?Vf(+ch,dh):1];if(pg(Ph))return function([Xh,Qh,qh,lp]){function dp(Mp){const Md=(Mp+Xh/30)%12,bd=Qh*Math.min(qh,1-qh);return qh-bd*Math.max(-1,Math.min(Md-3,9-Md,1))}return Xh=ip(Xh),Qh/=100,qh/=100,[dp(0),dp(8),dp(4),lp]}(Ph)}}}(g);return S?new Yd(...S,!1):void 0}get rgb(){const{r:g,g:S,b:W,a:ut}=this,Ht=ut||1/0;return this.overwriteGetter("rgb",[g/Ht,S/Ht,W/Ht,ut])}get hcl(){return this.overwriteGetter("hcl",function(g){const[S,W,ut,Ht]=_p(g),Jt=Math.sqrt(W*W+ut*ut);return[Math.round(1e4*Jt)?ip(Math.atan2(ut,W)*ep):NaN,Jt,S,Ht]}(this.rgb))}get lab(){return this.overwriteGetter("lab",_p(this.rgb))}overwriteGetter(g,S){return Object.defineProperty(this,g,{value:S}),S}toString(){const[g,S,W,ut]=this.rgb;return`rgba(${[g,S,W].map(Ht=>Math.round(255*Ht)).join(",")},${ut})`}}Yd.black=new Yd(0,0,0,1),Yd.white=new Yd(1,1,1,1),Yd.transparent=new Yd(0,0,0,0),Yd.red=new Yd(1,0,0,1);class Cg{constructor(g,S,W){this.sensitivity=g?S?"variant":"case":S?"accent":"base",this.locale=W,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(g,S){return this.collator.compare(g,S)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class oy{constructor(g,S,W,ut,Ht){this.text=g,this.image=S,this.scale=W,this.fontStack=ut,this.textColor=Ht}}class Bg{constructor(g){this.sections=g}static fromString(g){return new Bg([new oy(g,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(g=>g.text.length!==0||g.image&&g.image.name.length!==0)}static factory(g){return g instanceof Bg?g:Bg.fromString(g)}toString(){return this.sections.length===0?"":this.sections.map(g=>g.text).join("")}}class Xg{constructor(g){this.values=g.slice()}static parse(g){if(g instanceof Xg)return g;if(typeof g=="number")return new Xg([g,g,g,g]);if(Array.isArray(g)&&!(g.length<1||g.length>4)){for(const S of g)if(typeof S!="number")return;switch(g.length){case 1:g=[g[0],g[0],g[0],g[0]];break;case 2:g=[g[0],g[1],g[0],g[1]];break;case 3:g=[g[0],g[1],g[2],g[1]]}return new Xg(g)}}toString(){return JSON.stringify(this.values)}}class nm{constructor(g){this.name=g.name,this.available=g.available}toString(){return this.name}static fromString(g){return g?new nm({name:g,available:!1}):null}}function u_(x,g,S,W){return typeof x=="number"&&x>=0&&x<=255&&typeof g=="number"&&g>=0&&g<=255&&typeof S=="number"&&S>=0&&S<=255?W===void 0||typeof W=="number"&&W>=0&&W<=1?null:`Invalid rgba value [${[x,g,S,W].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof W=="number"?[x,g,S,W]:[x,g,S]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function xv(x){if(x===null||typeof x=="string"||typeof x=="boolean"||typeof x=="number"||x instanceof Yd||x instanceof Cg||x instanceof Bg||x instanceof Xg||x instanceof nm)return!0;if(Array.isArray(x)){for(const g of x)if(!xv(g))return!1;return!0}if(typeof x=="object"){for(const g in x)if(!xv(x[g]))return!1;return!0}return!1}function Dg(x){if(x===null)return Vd;if(typeof x=="string")return Yp;if(typeof x=="boolean")return nd;if(typeof x=="number")return Ep;if(x instanceof Yd)return $d;if(x instanceof Cg)return ng;if(x instanceof Bg)return bg;if(x instanceof Xg)return Ih;if(x instanceof nm)return nh;if(Array.isArray(x)){const g=x.length;let S;for(const W of x){const ut=Dg(W);if(S){if(S===ut)continue;S=Rd;break}S=ut}return sh(S||Rd,g)}return Qd}function sy(x){const g=typeof x;return x===null?"":g==="string"||g==="number"||g==="boolean"?String(x):x instanceof Yd||x instanceof Bg||x instanceof Xg||x instanceof nm?x.toString():JSON.stringify(x)}class fy{constructor(g,S){this.type=g,this.value=S}static parse(g,S){if(g.length!==2)return S.error(`'literal' expression requires exactly one argument, but found ${g.length-1} instead.`);if(!xv(g[1]))return S.error("invalid value");const W=g[1];let ut=Dg(W);const Ht=S.expectedType;return ut.kind!=="array"||ut.N!==0||!Ht||Ht.kind!=="array"||typeof Ht.N=="number"&&Ht.N!==0||(ut=Ht),new fy(ut,W)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class hp{constructor(g){this.name="ExpressionEvaluationError",this.message=g}toJSON(){return this.message}}const gy={string:Yp,number:Ep,boolean:nd,object:Qd};class xg{constructor(g,S){this.type=g,this.args=S}static parse(g,S){if(g.length<2)return S.error("Expected at least one argument.");let W,ut=1;const Ht=g[0];if(Ht==="array"){let In,So;if(g.length>2){const al=g[1];if(typeof al!="string"||!(al in gy)||al==="object")return S.error('The item type argument of "array" must be one of string, number, boolean',1);In=gy[al],ut++}else In=Rd;if(g.length>3){if(g[2]!==null&&(typeof g[2]!="number"||g[2]<0||g[2]!==Math.floor(g[2])))return S.error('The length argument to "array" must be a positive integer literal',2);So=g[2],ut++}W=sh(In,So)}else{if(!gy[Ht])throw new Error(`Types doesn't contain name = ${Ht}`);W=gy[Ht]}const Jt=[];for(;ut<g.length;ut++){const In=S.parse(g[ut],ut,Rd);if(!In)return null;Jt.push(In)}return new xg(W,Jt)}evaluate(g){for(let S=0;S<this.args.length;S++){const W=this.args[S].evaluate(g);if(!Uh(this.type,Dg(W)))return W;if(S===this.args.length-1)throw new hp(`Expected value to be of type ${oh(this.type)}, but found ${oh(Dg(W))} instead.`)}throw new Error}eachChild(g){this.args.forEach(g)}outputDefined(){return this.args.every(g=>g.outputDefined())}}const hm={"to-boolean":nd,"to-color":$d,"to-number":Ep,"to-string":Yp};class xm{constructor(g,S){this.type=g,this.args=S}static parse(g,S){if(g.length<2)return S.error("Expected at least one argument.");const W=g[0];if(!hm[W])throw new Error(`Can't parse ${W} as it is not part of the known types`);if((W==="to-boolean"||W==="to-string")&&g.length!==2)return S.error("Expected one argument.");const ut=hm[W],Ht=[];for(let Jt=1;Jt<g.length;Jt++){const In=S.parse(g[Jt],Jt,Rd);if(!In)return null;Ht.push(In)}return new xm(ut,Ht)}evaluate(g){if(this.type.kind==="boolean")return!!this.args[0].evaluate(g);if(this.type.kind==="color"){let S,W;for(const ut of this.args){if(S=ut.evaluate(g),W=null,S instanceof Yd)return S;if(typeof S=="string"){const Ht=g.parseColor(S);if(Ht)return Ht}else if(Array.isArray(S)&&(W=S.length<3||S.length>4?`Invalid rbga value ${JSON.stringify(S)}: expected an array containing either three or four numeric values.`:u_(S[0],S[1],S[2],S[3]),!W))return new Yd(S[0]/255,S[1]/255,S[2]/255,S[3])}throw new hp(W||`Could not parse color from value '${typeof S=="string"?S:JSON.stringify(S)}'`)}if(this.type.kind==="padding"){let S;for(const W of this.args){S=W.evaluate(g);const ut=Xg.parse(S);if(ut)return ut}throw new hp(`Could not parse padding from value '${typeof S=="string"?S:JSON.stringify(S)}'`)}if(this.type.kind==="number"){let S=null;for(const W of this.args){if(S=W.evaluate(g),S===null)return 0;const ut=Number(S);if(!isNaN(ut))return ut}throw new hp(`Could not convert ${JSON.stringify(S)} to number.`)}return this.type.kind==="formatted"?Bg.fromString(sy(this.args[0].evaluate(g))):this.type.kind==="resolvedImage"?nm.fromString(sy(this.args[0].evaluate(g))):sy(this.args[0].evaluate(g))}eachChild(g){this.args.forEach(g)}outputDefined(){return this.args.every(g=>g.outputDefined())}}const my=["Unknown","Point","LineString","Polygon"];class wv{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?my[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(g){let S=this._parseColorCache[g];return S||(S=this._parseColorCache[g]=Yd.parse(g)),S}}class qy{constructor(g,S,W=[],ut,Ht=new Ed,Jt=[]){this.registry=g,this.path=W,this.key=W.map(In=>`[${In}]`).join(""),this.scope=Ht,this.errors=Jt,this.expectedType=ut,this._isConstant=S}parse(g,S,W,ut,Ht={}){return S?this.concat(S,W,ut)._parse(g,Ht):this._parse(g,Ht)}_parse(g,S){function W(ut,Ht,Jt){return Jt==="assert"?new xg(Ht,[ut]):Jt==="coerce"?new xm(Ht,[ut]):ut}if(g!==null&&typeof g!="string"&&typeof g!="boolean"&&typeof g!="number"||(g=["literal",g]),Array.isArray(g)){if(g.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const ut=g[0];if(typeof ut!="string")return this.error(`Expression name must be a string, but found ${typeof ut} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const Ht=this.registry[ut];if(Ht){let Jt=Ht.parse(g,this);if(!Jt)return null;if(this.expectedType){const In=this.expectedType,So=Jt.type;if(In.kind!=="string"&&In.kind!=="number"&&In.kind!=="boolean"&&In.kind!=="object"&&In.kind!=="array"||So.kind!=="value")if(In.kind!=="color"&&In.kind!=="formatted"&&In.kind!=="resolvedImage"||So.kind!=="value"&&So.kind!=="string")if(In.kind!=="padding"||So.kind!=="value"&&So.kind!=="number"&&So.kind!=="array"){if(this.checkSubtype(In,So))return null}else Jt=W(Jt,In,S.typeAnnotation||"coerce");else Jt=W(Jt,In,S.typeAnnotation||"coerce");else Jt=W(Jt,In,S.typeAnnotation||"assert")}if(!(Jt instanceof fy)&&Jt.type.kind!=="resolvedImage"&&this._isConstant(Jt)){const In=new wv;try{Jt=new fy(Jt.type,Jt.evaluate(In))}catch(So){return this.error(So.message),null}}return Jt}return this.error(`Unknown expression "${ut}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(g===void 0?"'undefined' value invalid. Use null instead.":typeof g=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof g} instead.`)}concat(g,S,W){const ut=typeof g=="number"?this.path.concat(g):this.path,Ht=W?this.scope.concat(W):this.scope;return new qy(this.registry,this._isConstant,ut,S||null,Ht,this.errors)}error(g,...S){const W=`${this.key}${S.map(ut=>`[${ut}]`).join("")}`;this.errors.push(new xd(W,g))}checkSubtype(g,S){const W=Uh(g,S);return W&&this.error(W),W}}class lg{constructor(g,S,W){this.type=ng,this.locale=W,this.caseSensitive=g,this.diacriticSensitive=S}static parse(g,S){if(g.length!==2)return S.error("Expected one argument.");const W=g[1];if(typeof W!="object"||Array.isArray(W))return S.error("Collator options argument must be an object.");const ut=S.parse(W["case-sensitive"]!==void 0&&W["case-sensitive"],1,nd);if(!ut)return null;const Ht=S.parse(W["diacritic-sensitive"]!==void 0&&W["diacritic-sensitive"],1,nd);if(!Ht)return null;let Jt=null;return W.locale&&(Jt=S.parse(W.locale,1,Yp),!Jt)?null:new lg(ut,Ht,Jt)}evaluate(g){return new Cg(this.caseSensitive.evaluate(g),this.diacriticSensitive.evaluate(g),this.locale?this.locale.evaluate(g):null)}eachChild(g){g(this.caseSensitive),g(this.diacriticSensitive),this.locale&&g(this.locale)}outputDefined(){return!1}}const ad=8192;function qf(x,g){x[0]=Math.min(x[0],g[0]),x[1]=Math.min(x[1],g[1]),x[2]=Math.max(x[2],g[0]),x[3]=Math.max(x[3],g[1])}function Hf(x,g){return!(x[0]<=g[0]||x[2]>=g[2]||x[1]<=g[1]||x[3]>=g[3])}function Wm(x,g){const S=(180+x[0])/360,W=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+x[1]*Math.PI/360)))/360,ut=Math.pow(2,g.z);return[Math.round(S*ut*ad),Math.round(W*ut*ad)]}function yy(x,g,S){const W=x[0]-g[0],ut=x[1]-g[1],Ht=x[0]-S[0],Jt=x[1]-S[1];return W*Jt-Ht*ut==0&&W*Ht<=0&&ut*Jt<=0}function Kf(x,g){let S=!1;for(let Jt=0,In=g.length;Jt<In;Jt++){const So=g[Jt];for(let al=0,hl=So.length;al<hl-1;al++){if(yy(x,So[al],So[al+1]))return!1;(ut=So[al])[1]>(W=x)[1]!=(Ht=So[al+1])[1]>W[1]&&W[0]<(Ht[0]-ut[0])*(W[1]-ut[1])/(Ht[1]-ut[1])+ut[0]&&(S=!S)}}var W,ut,Ht;return S}function qm(x,g){for(let S=0;S<g.length;S++)if(Kf(x,g[S]))return!0;return!1}function k_(x,g,S,W){const ut=W[0]-S[0],Ht=W[1]-S[1],Jt=(x[0]-S[0])*Ht-ut*(x[1]-S[1]),In=(g[0]-S[0])*Ht-ut*(g[1]-S[1]);return Jt>0&&In<0||Jt<0&&In>0}function B_(x,g,S){for(const al of S)for(let hl=0;hl<al.length-1;++hl)if((In=[(Jt=al[hl+1])[0]-(Ht=al[hl])[0],Jt[1]-Ht[1]])[0]*(So=[(ut=g)[0]-(W=x)[0],ut[1]-W[1]])[1]-In[1]*So[0]!=0&&k_(W,ut,Ht,Jt)&&k_(Ht,Jt,W,ut))return!0;var W,ut,Ht,Jt,In,So;return!1}function ay(x,g){for(let S=0;S<x.length;++S)if(!Kf(x[S],g))return!1;for(let S=0;S<x.length-1;++S)if(B_(x[S],x[S+1],g))return!1;return!0}function Og(x,g){for(let S=0;S<g.length;S++)if(ay(x,g[S]))return!0;return!1}function B0(x,g,S){const W=[];for(let ut=0;ut<x.length;ut++){const Ht=[];for(let Jt=0;Jt<x[ut].length;Jt++){const In=Wm(x[ut][Jt],S);qf(g,In),Ht.push(In)}W.push(Ht)}return W}function Ey(x,g,S){const W=[];for(let ut=0;ut<x.length;ut++){const Ht=B0(x[ut],g,S);W.push(Ht)}return W}function z_(x,g,S,W){if(x[0]<S[0]||x[0]>S[2]){const ut=.5*W;let Ht=x[0]-S[0]>ut?-W:S[0]-x[0]>ut?W:0;Ht===0&&(Ht=x[0]-S[2]>ut?-W:S[2]-x[0]>ut?W:0),x[0]+=Ht}qf(g,x)}function bv(x,g,S,W){const ut=Math.pow(2,W.z)*ad,Ht=[W.x*ad,W.y*ad],Jt=[];for(const In of x)for(const So of In){const al=[So.x+Ht[0],So.y+Ht[1]];z_(al,g,S,ut),Jt.push(al)}return Jt}function z0(x,g,S,W){const ut=Math.pow(2,W.z)*ad,Ht=[W.x*ad,W.y*ad],Jt=[];for(const So of x){const al=[];for(const hl of So){const eh=[hl.x+Ht[0],hl.y+Ht[1]];qf(g,eh),al.push(eh)}Jt.push(al)}if(g[2]-g[0]<=ut/2){(In=g)[0]=In[1]=1/0,In[2]=In[3]=-1/0;for(const So of Jt)for(const al of So)z_(al,g,S,ut)}var In;return Jt}class Ly{constructor(g,S){this.type=nd,this.geojson=g,this.geometries=S}static parse(g,S){if(g.length!==2)return S.error(`'within' expression requires exactly one argument, but found ${g.length-1} instead.`);if(xv(g[1])){const W=g[1];if(W.type==="FeatureCollection")for(let ut=0;ut<W.features.length;++ut){const Ht=W.features[ut].geometry.type;if(Ht==="Polygon"||Ht==="MultiPolygon")return new Ly(W,W.features[ut].geometry)}else if(W.type==="Feature"){const ut=W.geometry.type;if(ut==="Polygon"||ut==="MultiPolygon")return new Ly(W,W.geometry)}else if(W.type==="Polygon"||W.type==="MultiPolygon")return new Ly(W,W)}return S.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(g){if(g.geometry()!=null&&g.canonicalID()!=null){if(g.geometryType()==="Point")return function(S,W){const ut=[1/0,1/0,-1/0,-1/0],Ht=[1/0,1/0,-1/0,-1/0],Jt=S.canonicalID();if(W.type==="Polygon"){const In=B0(W.coordinates,Ht,Jt),So=bv(S.geometry(),ut,Ht,Jt);if(!Hf(ut,Ht))return!1;for(const al of So)if(!Kf(al,In))return!1}if(W.type==="MultiPolygon"){const In=Ey(W.coordinates,Ht,Jt),So=bv(S.geometry(),ut,Ht,Jt);if(!Hf(ut,Ht))return!1;for(const al of So)if(!qm(al,In))return!1}return!0}(g,this.geometries);if(g.geometryType()==="LineString")return function(S,W){const ut=[1/0,1/0,-1/0,-1/0],Ht=[1/0,1/0,-1/0,-1/0],Jt=S.canonicalID();if(W.type==="Polygon"){const In=B0(W.coordinates,Ht,Jt),So=z0(S.geometry(),ut,Ht,Jt);if(!Hf(ut,Ht))return!1;for(const al of So)if(!ay(al,In))return!1}if(W.type==="MultiPolygon"){const In=Ey(W.coordinates,Ht,Jt),So=z0(S.geometry(),ut,Ht,Jt);if(!Hf(ut,Ht))return!1;for(const al of So)if(!Og(al,In))return!1}return!0}(g,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class c_{constructor(g,S){this.type=S.type,this.name=g,this.boundExpression=S}static parse(g,S){if(g.length!==2||typeof g[1]!="string")return S.error("'var' expression requires exactly one string literal argument.");const W=g[1];return S.scope.has(W)?new c_(W,S.scope.get(W)):S.error(`Unknown variable "${W}". Make sure "${W}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(g){return this.boundExpression.evaluate(g)}eachChild(){}outputDefined(){return!1}}class Fm{constructor(g,S,W,ut){this.name=g,this.type=S,this._evaluate=W,this.args=ut}evaluate(g){return this._evaluate(g,this.args)}eachChild(g){this.args.forEach(g)}outputDefined(){return!1}static parse(g,S){const W=g[0],ut=Fm.definitions[W];if(!ut)return S.error(`Unknown expression "${W}". If you wanted a literal array, use ["literal", [...]].`,0);const Ht=Array.isArray(ut)?ut[0]:ut.type,Jt=Array.isArray(ut)?[[ut[1],ut[2]]]:ut.overloads,In=Jt.filter(([al])=>!Array.isArray(al)||al.length===g.length-1);let So=null;for(const[al,hl]of In){So=new qy(S.registry,G_,S.path,null,S.scope);const eh=[];let ah=!1;for(let ch=1;ch<g.length;ch++){const dh=g[ch],Dh=Array.isArray(al)?al[ch-1]:al.type,Ph=So.parse(dh,1+eh.length,Dh);if(!Ph){ah=!0;break}eh.push(Ph)}if(!ah)if(Array.isArray(al)&&al.length!==eh.length)So.error(`Expected ${al.length} arguments, but found ${eh.length} instead.`);else{for(let ch=0;ch<eh.length;ch++){const dh=Array.isArray(al)?al[ch]:al.type,Dh=eh[ch];So.concat(ch+1).checkSubtype(dh,Dh.type)}if(So.errors.length===0)return new Fm(W,Ht,hl,eh)}}if(In.length===1)S.errors.push(...So.errors);else{const al=(In.length?In:Jt).map(([eh])=>{return ah=eh,Array.isArray(ah)?`(${ah.map(oh).join(", ")})`:`(${oh(ah.type)}...)`;var ah}).join(" | "),hl=[];for(let eh=1;eh<g.length;eh++){const ah=S.parse(g[eh],1+hl.length);if(!ah)return null;hl.push(oh(ah.type))}S.error(`Expected arguments of type ${al}, but found (${hl.join(", ")}) instead.`)}return null}static register(g,S){Fm.definitions=S;for(const W in S)g[W]=Fm}}function G_(x){if(x instanceof c_)return G_(x.boundExpression);if(x instanceof Fm&&x.name==="error"||x instanceof lg||x instanceof Ly)return!1;const g=x instanceof xm||x instanceof xg;let S=!0;return x.eachChild(W=>{S=g?S&&G_(W):S&&W instanceof fy}),!!S&&Fy(x)&&zg(x,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Fy(x){if(x instanceof Fm&&(x.name==="get"&&x.args.length===1||x.name==="feature-state"||x.name==="has"&&x.args.length===1||x.name==="properties"||x.name==="geometry-type"||x.name==="id"||/^filter-/.test(x.name))||x instanceof Ly)return!1;let g=!0;return x.eachChild(S=>{g&&!Fy(S)&&(g=!1)}),g}function pm(x){if(x instanceof Fm&&x.name==="feature-state")return!1;let g=!0;return x.eachChild(S=>{g&&!pm(S)&&(g=!1)}),g}function zg(x,g){if(x instanceof Fm&&g.indexOf(x.name)>=0)return!1;let S=!0;return x.eachChild(W=>{S&&!zg(W,g)&&(S=!1)}),S}function Cv(x,g){const S=x.length-1;let W,ut,Ht=0,Jt=S,In=0;for(;Ht<=Jt;)if(In=Math.floor((Ht+Jt)/2),W=x[In],ut=x[In+1],W<=g){if(In===S||g<ut)return In;Ht=In+1}else{if(!(W>g))throw new hp("Input is not a number.");Jt=In-1}return 0}class h_{constructor(g,S,W){this.type=g,this.input=S,this.labels=[],this.outputs=[];for(const[ut,Ht]of W)this.labels.push(ut),this.outputs.push(Ht)}static parse(g,S){if(g.length-1<4)return S.error(`Expected at least 4 arguments, but found only ${g.length-1}.`);if((g.length-1)%2!=0)return S.error("Expected an even number of arguments.");const W=S.parse(g[1],1,Ep);if(!W)return null;const ut=[];let Ht=null;S.expectedType&&S.expectedType.kind!=="value"&&(Ht=S.expectedType);for(let Jt=1;Jt<g.length;Jt+=2){const In=Jt===1?-1/0:g[Jt],So=g[Jt+1],al=Jt,hl=Jt+1;if(typeof In!="number")return S.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',al);if(ut.length&&ut[ut.length-1][0]>=In)return S.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',al);const eh=S.parse(So,hl,Ht);if(!eh)return null;Ht=Ht||eh.type,ut.push([In,eh])}return new h_(Ht,W,ut)}evaluate(g){const S=this.labels,W=this.outputs;if(S.length===1)return W[0].evaluate(g);const ut=this.input.evaluate(g);if(ut<=S[0])return W[0].evaluate(g);const Ht=S.length;return ut>=S[Ht-1]?W[Ht-1].evaluate(g):W[Cv(S,ut)].evaluate(g)}eachChild(g){g(this.input);for(const S of this.outputs)g(S)}outputDefined(){return this.outputs.every(g=>g.outputDefined())}}function dm(x,g,S){return x+S*(g-x)}function Vm(x,g,S){return x.map((W,ut)=>dm(W,g[ut],S))}const Km={number:dm,color:function(x,g,S,W="rgb"){switch(W){case"rgb":{const[ut,Ht,Jt,In]=Vm(x.rgb,g.rgb,S);return new Yd(ut,Ht,Jt,In,!1)}case"hcl":{const[ut,Ht,Jt,In]=x.hcl,[So,al,hl,eh]=g.hcl;let ah,ch;if(isNaN(ut)||isNaN(So))isNaN(ut)?isNaN(So)?ah=NaN:(ah=So,Jt!==1&&Jt!==0||(ch=al)):(ah=ut,hl!==1&&hl!==0||(ch=Ht));else{let Qh=So-ut;So>ut&&Qh>180?Qh-=360:So<ut&&ut-So>180&&(Qh+=360),ah=ut+S*Qh}const[dh,Dh,Ph,Xh]=function([Qh,qh,lp,dp]){return Qh=isNaN(Qh)?0:Qh*kh,qp([lp,Math.cos(Qh)*qh,Math.sin(Qh)*qh,dp])}([ah,ch??dm(Ht,al,S),dm(Jt,hl,S),dm(In,eh,S)]);return new Yd(dh,Dh,Ph,Xh,!1)}case"lab":{const[ut,Ht,Jt,In]=qp(Vm(x.lab,g.lab,S));return new Yd(ut,Ht,Jt,In,!1)}}},array:Vm,padding:function(x,g,S){return new Xg(Vm(x.values,g.values,S))}};class Em{constructor(g,S,W,ut,Ht){this.type=g,this.operator=S,this.interpolation=W,this.input=ut,this.labels=[],this.outputs=[];for(const[Jt,In]of Ht)this.labels.push(Jt),this.outputs.push(In)}static interpolationFactor(g,S,W,ut){let Ht=0;if(g.name==="exponential")Ht=Gg(S,g.base,W,ut);else if(g.name==="linear")Ht=Gg(S,1,W,ut);else if(g.name==="cubic-bezier"){const Jt=g.controlPoints;Ht=new Bt(Jt[0],Jt[1],Jt[2],Jt[3]).solve(Gg(S,1,W,ut))}return Ht}static parse(g,S){let[W,ut,Ht,...Jt]=g;if(!Array.isArray(ut)||ut.length===0)return S.error("Expected an interpolation type expression.",1);if(ut[0]==="linear")ut={name:"linear"};else if(ut[0]==="exponential"){const al=ut[1];if(typeof al!="number")return S.error("Exponential interpolation requires a numeric base.",1,1);ut={name:"exponential",base:al}}else{if(ut[0]!=="cubic-bezier")return S.error(`Unknown interpolation type ${String(ut[0])}`,1,0);{const al=ut.slice(1);if(al.length!==4||al.some(hl=>typeof hl!="number"||hl<0||hl>1))return S.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);ut={name:"cubic-bezier",controlPoints:al}}}if(g.length-1<4)return S.error(`Expected at least 4 arguments, but found only ${g.length-1}.`);if((g.length-1)%2!=0)return S.error("Expected an even number of arguments.");if(Ht=S.parse(Ht,2,Ep),!Ht)return null;const In=[];let So=null;W==="interpolate-hcl"||W==="interpolate-lab"?So=$d:S.expectedType&&S.expectedType.kind!=="value"&&(So=S.expectedType);for(let al=0;al<Jt.length;al+=2){const hl=Jt[al],eh=Jt[al+1],ah=al+3,ch=al+4;if(typeof hl!="number")return S.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ah);if(In.length&&In[In.length-1][0]>=hl)return S.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ah);const dh=S.parse(eh,ch,So);if(!dh)return null;So=So||dh.type,In.push([hl,dh])}return di(So,Ep)||di(So,$d)||di(So,Ih)||di(So,sh(Ep))?new Em(So,W,ut,Ht,In):S.error(`Type ${oh(So)} is not interpolatable.`)}evaluate(g){const S=this.labels,W=this.outputs;if(S.length===1)return W[0].evaluate(g);const ut=this.input.evaluate(g);if(ut<=S[0])return W[0].evaluate(g);const Ht=S.length;if(ut>=S[Ht-1])return W[Ht-1].evaluate(g);const Jt=Cv(S,ut),In=Em.interpolationFactor(this.interpolation,ut,S[Jt],S[Jt+1]),So=W[Jt].evaluate(g),al=W[Jt+1].evaluate(g);switch(this.operator){case"interpolate":return Km[this.type.kind](So,al,In);case"interpolate-hcl":return Km.color(So,al,In,"hcl");case"interpolate-lab":return Km.color(So,al,In,"lab")}}eachChild(g){g(this.input);for(const S of this.outputs)g(S)}outputDefined(){return this.outputs.every(g=>g.outputDefined())}}function Gg(x,g,S,W){const ut=W-S,Ht=x-S;return ut===0?0:g===1?Ht/ut:(Math.pow(g,Ht)-1)/(Math.pow(g,ut)-1)}class p_{constructor(g,S){this.type=g,this.args=S}static parse(g,S){if(g.length<2)return S.error("Expectected at least one argument.");let W=null;const ut=S.expectedType;ut&&ut.kind!=="value"&&(W=ut);const Ht=[];for(const In of g.slice(1)){const So=S.parse(In,1+Ht.length,W,void 0,{typeAnnotation:"omit"});if(!So)return null;W=W||So.type,Ht.push(So)}if(!W)throw new Error("No output type");const Jt=ut&&Ht.some(In=>Uh(ut,In.type));return new p_(Jt?Rd:W,Ht)}evaluate(g){let S,W=null,ut=0;for(const Ht of this.args)if(ut++,W=Ht.evaluate(g),W&&W instanceof nm&&!W.available&&(S||(S=W.name),W=null,ut===this.args.length&&(W=S)),W!==null)break;return W}eachChild(g){this.args.forEach(g)}outputDefined(){return this.args.every(g=>g.outputDefined())}}class Ev{constructor(g,S){this.type=S.type,this.bindings=[].concat(g),this.result=S}evaluate(g){return this.result.evaluate(g)}eachChild(g){for(const S of this.bindings)g(S[1]);g(this.result)}static parse(g,S){if(g.length<4)return S.error(`Expected at least 3 arguments, but found ${g.length-1} instead.`);const W=[];for(let Ht=1;Ht<g.length-1;Ht+=2){const Jt=g[Ht];if(typeof Jt!="string")return S.error(`Expected string, but found ${typeof Jt} instead.`,Ht);if(/[^a-zA-Z0-9_]/.test(Jt))return S.error("Variable names must contain only alphanumeric characters or '_'.",Ht);const In=S.parse(g[Ht+1],Ht+1);if(!In)return null;W.push([Jt,In])}const ut=S.parse(g[g.length-1],g.length-1,S.expectedType,W);return ut?new Ev(W,ut):null}outputDefined(){return this.result.outputDefined()}}class Ky{constructor(g,S,W){this.type=g,this.index=S,this.input=W}static parse(g,S){if(g.length!==3)return S.error(`Expected 2 arguments, but found ${g.length-1} instead.`);const W=S.parse(g[1],1,Ep),ut=S.parse(g[2],2,sh(S.expectedType||Rd));return W&&ut?new Ky(ut.type.itemType,W,ut):null}evaluate(g){const S=this.index.evaluate(g),W=this.input.evaluate(g);if(S<0)throw new hp(`Array index out of bounds: ${S} < 0.`);if(S>=W.length)throw new hp(`Array index out of bounds: ${S} > ${W.length-1}.`);if(S!==Math.floor(S))throw new hp(`Array index must be an integer, but found ${S} instead.`);return W[S]}eachChild(g){g(this.index),g(this.input)}outputDefined(){return!1}}class em{constructor(g,S){this.type=nd,this.needle=g,this.haystack=S}static parse(g,S){if(g.length!==3)return S.error(`Expected 2 arguments, but found ${g.length-1} instead.`);const W=S.parse(g[1],1,Rd),ut=S.parse(g[2],2,Rd);return W&&ut?vl(W.type,[nd,Yp,Ep,Vd,Rd])?new em(W,ut):S.error(`Expected first argument to be of type boolean, string, number or null, but found ${oh(W.type)} instead`):null}evaluate(g){const S=this.needle.evaluate(g),W=this.haystack.evaluate(g);if(!W)return!1;if(!gs(S,["boolean","string","number","null"]))throw new hp(`Expected first argument to be of type boolean, string, number or null, but found ${oh(Dg(S))} instead.`);if(!gs(W,["string","array"]))throw new hp(`Expected second argument to be of type array or string, but found ${oh(Dg(W))} instead.`);return W.indexOf(S)>=0}eachChild(g){g(this.needle),g(this.haystack)}outputDefined(){return!0}}class Zy{constructor(g,S,W){this.type=Ep,this.needle=g,this.haystack=S,this.fromIndex=W}static parse(g,S){if(g.length<=2||g.length>=5)return S.error(`Expected 3 or 4 arguments, but found ${g.length-1} instead.`);const W=S.parse(g[1],1,Rd),ut=S.parse(g[2],2,Rd);if(!W||!ut)return null;if(!vl(W.type,[nd,Yp,Ep,Vd,Rd]))return S.error(`Expected first argument to be of type boolean, string, number or null, but found ${oh(W.type)} instead`);if(g.length===4){const Ht=S.parse(g[3],3,Ep);return Ht?new Zy(W,ut,Ht):null}return new Zy(W,ut)}evaluate(g){const S=this.needle.evaluate(g),W=this.haystack.evaluate(g);if(!gs(S,["boolean","string","number","null"]))throw new hp(`Expected first argument to be of type boolean, string, number or null, but found ${oh(Dg(S))} instead.`);if(!gs(W,["string","array"]))throw new hp(`Expected second argument to be of type array or string, but found ${oh(Dg(W))} instead.`);if(this.fromIndex){const ut=this.fromIndex.evaluate(g);return W.indexOf(S,ut)}return W.indexOf(S)}eachChild(g){g(this.needle),g(this.haystack),this.fromIndex&&g(this.fromIndex)}outputDefined(){return!1}}class ug{constructor(g,S,W,ut,Ht,Jt){this.inputType=g,this.type=S,this.input=W,this.cases=ut,this.outputs=Ht,this.otherwise=Jt}static parse(g,S){if(g.length<5)return S.error(`Expected at least 4 arguments, but found only ${g.length-1}.`);if(g.length%2!=1)return S.error("Expected an even number of arguments.");let W,ut;S.expectedType&&S.expectedType.kind!=="value"&&(ut=S.expectedType);const Ht={},Jt=[];for(let al=2;al<g.length-1;al+=2){let hl=g[al];const eh=g[al+1];Array.isArray(hl)||(hl=[hl]);const ah=S.concat(al);if(hl.length===0)return ah.error("Expected at least one branch label.");for(const dh of hl){if(typeof dh!="number"&&typeof dh!="string")return ah.error("Branch labels must be numbers or strings.");if(typeof dh=="number"&&Math.abs(dh)>Number.MAX_SAFE_INTEGER)return ah.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof dh=="number"&&Math.floor(dh)!==dh)return ah.error("Numeric branch labels must be integer values.");if(W){if(ah.checkSubtype(W,Dg(dh)))return null}else W=Dg(dh);if(Ht[String(dh)]!==void 0)return ah.error("Branch labels must be unique.");Ht[String(dh)]=Jt.length}const ch=S.parse(eh,al,ut);if(!ch)return null;ut=ut||ch.type,Jt.push(ch)}const In=S.parse(g[1],1,Rd);if(!In)return null;const So=S.parse(g[g.length-1],g.length-1,ut);return So?In.type.kind!=="value"&&S.concat(1).checkSubtype(W,In.type)?null:new ug(W,ut,In,Ht,Jt,So):null}evaluate(g){const S=this.input.evaluate(g);return(Dg(S)===this.inputType&&this.outputs[this.cases[S]]||this.otherwise).evaluate(g)}eachChild(g){g(this.input),this.outputs.forEach(g),g(this.otherwise)}outputDefined(){return this.outputs.every(g=>g.outputDefined())&&this.otherwise.outputDefined()}}class Sy{constructor(g,S,W){this.type=g,this.branches=S,this.otherwise=W}static parse(g,S){if(g.length<4)return S.error(`Expected at least 3 arguments, but found only ${g.length-1}.`);if(g.length%2!=0)return S.error("Expected an odd number of arguments.");let W;S.expectedType&&S.expectedType.kind!=="value"&&(W=S.expectedType);const ut=[];for(let Jt=1;Jt<g.length-1;Jt+=2){const In=S.parse(g[Jt],Jt,nd);if(!In)return null;const So=S.parse(g[Jt+1],Jt+1,W);if(!So)return null;ut.push([In,So]),W=W||So.type}const Ht=S.parse(g[g.length-1],g.length-1,W);if(!Ht)return null;if(!W)throw new Error("Can't infer output type");return new Sy(W,ut,Ht)}evaluate(g){for(const[S,W]of this.branches)if(S.evaluate(g))return W.evaluate(g);return this.otherwise.evaluate(g)}eachChild(g){for(const[S,W]of this.branches)g(S),g(W);g(this.otherwise)}outputDefined(){return this.branches.every(([g,S])=>S.outputDefined())&&this.otherwise.outputDefined()}}class Ty{constructor(g,S,W,ut){this.type=g,this.input=S,this.beginIndex=W,this.endIndex=ut}static parse(g,S){if(g.length<=2||g.length>=5)return S.error(`Expected 3 or 4 arguments, but found ${g.length-1} instead.`);const W=S.parse(g[1],1,Rd),ut=S.parse(g[2],2,Ep);if(!W||!ut)return null;if(!vl(W.type,[sh(Rd),Yp,Rd]))return S.error(`Expected first argument to be of type array or string, but found ${oh(W.type)} instead`);if(g.length===4){const Ht=S.parse(g[3],3,Ep);return Ht?new Ty(W.type,W,ut,Ht):null}return new Ty(W.type,W,ut)}evaluate(g){const S=this.input.evaluate(g),W=this.beginIndex.evaluate(g);if(!gs(S,["string","array"]))throw new hp(`Expected first argument to be of type array or string, but found ${oh(Dg(S))} instead.`);if(this.endIndex){const ut=this.endIndex.evaluate(g);return S.slice(W,ut)}return S.slice(W)}eachChild(g){g(this.input),g(this.beginIndex),this.endIndex&&g(this.endIndex)}outputDefined(){return!1}}function a0(x,g){return x==="=="||x==="!="?g.kind==="boolean"||g.kind==="string"||g.kind==="number"||g.kind==="null"||g.kind==="value":g.kind==="string"||g.kind==="number"||g.kind==="value"}function zx(x,g,S,W){return W.compare(g,S)===0}function d_(x,g,S){const W=x!=="=="&&x!=="!=";return class YS{constructor(Ht,Jt,In){this.type=nd,this.lhs=Ht,this.rhs=Jt,this.collator=In,this.hasUntypedArgument=Ht.type.kind==="value"||Jt.type.kind==="value"}static parse(Ht,Jt){if(Ht.length!==3&&Ht.length!==4)return Jt.error("Expected two or three arguments.");const In=Ht[0];let So=Jt.parse(Ht[1],1,Rd);if(!So)return null;if(!a0(In,So.type))return Jt.concat(1).error(`"${In}" comparisons are not supported for type '${oh(So.type)}'.`);let al=Jt.parse(Ht[2],2,Rd);if(!al)return null;if(!a0(In,al.type))return Jt.concat(2).error(`"${In}" comparisons are not supported for type '${oh(al.type)}'.`);if(So.type.kind!==al.type.kind&&So.type.kind!=="value"&&al.type.kind!=="value")return Jt.error(`Cannot compare types '${oh(So.type)}' and '${oh(al.type)}'.`);W&&(So.type.kind==="value"&&al.type.kind!=="value"?So=new xg(al.type,[So]):So.type.kind!=="value"&&al.type.kind==="value"&&(al=new xg(So.type,[al])));let hl=null;if(Ht.length===4){if(So.type.kind!=="string"&&al.type.kind!=="string"&&So.type.kind!=="value"&&al.type.kind!=="value")return Jt.error("Cannot use collator to compare non-string types.");if(hl=Jt.parse(Ht[3],3,ng),!hl)return null}return new YS(So,al,hl)}evaluate(Ht){const Jt=this.lhs.evaluate(Ht),In=this.rhs.evaluate(Ht);if(W&&this.hasUntypedArgument){const So=Dg(Jt),al=Dg(In);if(So.kind!==al.kind||So.kind!=="string"&&So.kind!=="number")throw new hp(`Expected arguments for "${x}" to be (string, string) or (number, number), but found (${So.kind}, ${al.kind}) instead.`)}if(this.collator&&!W&&this.hasUntypedArgument){const So=Dg(Jt),al=Dg(In);if(So.kind!=="string"||al.kind!=="string")return g(Ht,Jt,In)}return this.collator?S(Ht,Jt,In,this.collator.evaluate(Ht)):g(Ht,Jt,In)}eachChild(Ht){Ht(this.lhs),Ht(this.rhs),this.collator&&Ht(this.collator)}outputDefined(){return!0}}}const Sv=d_("==",function(x,g,S){return g===S},zx),Ny=d_("!=",function(x,g,S){return g!==S},function(x,g,S,W){return!zx(0,g,S,W)}),xx=d_("<",function(x,g,S){return g<S},function(x,g,S,W){return W.compare(g,S)<0}),V_=d_(">",function(x,g,S){return g>S},function(x,g,S,W){return W.compare(g,S)>0}),Xy=d_("<=",function(x,g,S){return g<=S},function(x,g,S,W){return W.compare(g,S)<=0}),l0=d_(">=",function(x,g,S){return g>=S},function(x,g,S,W){return W.compare(g,S)>=0});class Ay{constructor(g,S,W,ut,Ht){this.type=Yp,this.number=g,this.locale=S,this.currency=W,this.minFractionDigits=ut,this.maxFractionDigits=Ht}static parse(g,S){if(g.length!==3)return S.error("Expected two arguments.");const W=S.parse(g[1],1,Ep);if(!W)return null;const ut=g[2];if(typeof ut!="object"||Array.isArray(ut))return S.error("NumberFormat options argument must be an object.");let Ht=null;if(ut.locale&&(Ht=S.parse(ut.locale,1,Yp),!Ht))return null;let Jt=null;if(ut.currency&&(Jt=S.parse(ut.currency,1,Yp),!Jt))return null;let In=null;if(ut["min-fraction-digits"]&&(In=S.parse(ut["min-fraction-digits"],1,Ep),!In))return null;let So=null;return ut["max-fraction-digits"]&&(So=S.parse(ut["max-fraction-digits"],1,Ep),!So)?null:new Ay(W,Ht,Jt,In,So)}evaluate(g){return new Intl.NumberFormat(this.locale?this.locale.evaluate(g):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(g):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(g):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(g):void 0}).format(this.number.evaluate(g))}eachChild(g){g(this.number),this.locale&&g(this.locale),this.currency&&g(this.currency),this.minFractionDigits&&g(this.minFractionDigits),this.maxFractionDigits&&g(this.maxFractionDigits)}outputDefined(){return!1}}class $_{constructor(g){this.type=bg,this.sections=g}static parse(g,S){if(g.length<2)return S.error("Expected at least one argument.");const W=g[1];if(!Array.isArray(W)&&typeof W=="object")return S.error("First argument must be an image or text section.");const ut=[];let Ht=!1;for(let Jt=1;Jt<=g.length-1;++Jt){const In=g[Jt];if(Ht&&typeof In=="object"&&!Array.isArray(In)){Ht=!1;let So=null;if(In["font-scale"]&&(So=S.parse(In["font-scale"],1,Ep),!So))return null;let al=null;if(In["text-font"]&&(al=S.parse(In["text-font"],1,sh(Yp)),!al))return null;let hl=null;if(In["text-color"]&&(hl=S.parse(In["text-color"],1,$d),!hl))return null;const eh=ut[ut.length-1];eh.scale=So,eh.font=al,eh.textColor=hl}else{const So=S.parse(g[Jt],1,Rd);if(!So)return null;const al=So.type.kind;if(al!=="string"&&al!=="value"&&al!=="null"&&al!=="resolvedImage")return S.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");Ht=!0,ut.push({content:So,scale:null,font:null,textColor:null})}}return new $_(ut)}evaluate(g){return new Bg(this.sections.map(S=>{const W=S.content.evaluate(g);return Dg(W)===nh?new oy("",W,null,null,null):new oy(sy(W),null,S.scale?S.scale.evaluate(g):null,S.font?S.font.evaluate(g).join(","):null,S.textColor?S.textColor.evaluate(g):null)}))}eachChild(g){for(const S of this.sections)g(S.content),S.scale&&g(S.scale),S.font&&g(S.font),S.textColor&&g(S.textColor)}outputDefined(){return!1}}class f_{constructor(g){this.type=nh,this.input=g}static parse(g,S){if(g.length!==2)return S.error("Expected two arguments.");const W=S.parse(g[1],1,Yp);return W?new f_(W):S.error("No image name provided.")}evaluate(g){const S=this.input.evaluate(g),W=nm.fromString(S);return W&&g.availableImages&&(W.available=g.availableImages.indexOf(S)>-1),W}eachChild(g){g(this.input)}outputDefined(){return!1}}class U_{constructor(g){this.type=Ep,this.input=g}static parse(g,S){if(g.length!==2)return S.error(`Expected 1 argument, but found ${g.length-1} instead.`);const W=S.parse(g[1],1);return W?W.type.kind!=="array"&&W.type.kind!=="string"&&W.type.kind!=="value"?S.error(`Expected argument of type string or array, but found ${oh(W.type)} instead.`):new U_(W):null}evaluate(g){const S=this.input.evaluate(g);if(typeof S=="string"||Array.isArray(S))return S.length;throw new hp(`Expected value to be of type string or array, but found ${oh(Dg(S))} instead.`)}eachChild(g){g(this.input)}outputDefined(){return!1}}const j_={"==":Sv,"!=":Ny,">":V_,"<":xx,">=":l0,"<=":Xy,array:xg,at:Ky,boolean:xg,case:Sy,coalesce:p_,collator:lg,format:$_,image:f_,in:em,"index-of":Zy,interpolate:Em,"interpolate-hcl":Em,"interpolate-lab":Em,length:U_,let:Ev,literal:fy,match:ug,number:xg,"number-format":Ay,object:xg,slice:Ty,step:h_,string:xg,"to-boolean":xm,"to-color":xm,"to-number":xm,"to-string":xm,var:c_,within:Ly};function u0(x,[g,S,W,ut]){g=g.evaluate(x),S=S.evaluate(x),W=W.evaluate(x);const Ht=ut?ut.evaluate(x):1,Jt=u_(g,S,W,Ht);if(Jt)throw new hp(Jt);return new Yd(g/255,S/255,W/255,Ht,!1)}function G0(x,g){return x in g}function c0(x,g){const S=g[x];return S===void 0?null:S}function _y(x){return{type:x}}function hg(x){return{result:"success",value:x}}function Tv(x){return{result:"error",value:x}}function g_(x){return x["property-type"]==="data-driven"||x["property-type"]==="cross-faded-data-driven"}function wx(x){return!!x.expression&&x.expression.parameters.indexOf("zoom")>-1}function h0(x){return!!x.expression&&x.expression.interpolated}function yg(x){return x instanceof Number?"number":x instanceof String?"string":x instanceof Boolean?"boolean":Array.isArray(x)?"array":x===null?"null":typeof x}function Av(x){return typeof x=="object"&&x!==null&&!Array.isArray(x)}function Rv(x){return x}function p0(x,g){const S=g.type==="color",W=x.stops&&typeof x.stops[0][0]=="object",ut=W||!(W||x.property!==void 0),Ht=x.type||(h0(g)?"exponential":"interval");if(S||g.type==="padding"){const hl=S?Yd.parse:Xg.parse;(x=ud({},x)).stops&&(x.stops=x.stops.map(eh=>[eh[0],hl(eh[1])])),x.default=hl(x.default?x.default:g.default)}if(x.colorSpace&&(Jt=x.colorSpace)!=="rgb"&&Jt!=="hcl"&&Jt!=="lab")throw new Error(`Unknown color space: "${x.colorSpace}"`);var Jt;let In,So,al;if(Ht==="exponential")In=d0;else if(Ht==="interval")In=Jy;else if(Ht==="categorical"){In=Yy,So=Object.create(null);for(const hl of x.stops)So[hl[0]]=hl[1];al=typeof x.stops[0][0]}else{if(Ht!=="identity")throw new Error(`Unknown function type "${Ht}"`);In=Vx}if(W){const hl={},eh=[];for(let dh=0;dh<x.stops.length;dh++){const Dh=x.stops[dh],Ph=Dh[0].zoom;hl[Ph]===void 0&&(hl[Ph]={zoom:Ph,type:x.type,property:x.property,default:x.default,stops:[]},eh.push(Ph)),hl[Ph].stops.push([Dh[0].value,Dh[1]])}const ah=[];for(const dh of eh)ah.push([hl[dh].zoom,p0(hl[dh],g)]);const ch={name:"linear"};return{kind:"composite",interpolationType:ch,interpolationFactor:Em.interpolationFactor.bind(void 0,ch),zoomStops:ah.map(dh=>dh[0]),evaluate:({zoom:dh},Dh)=>d0({stops:ah,base:x.base},g,dh).evaluate(dh,Dh)}}if(ut){const hl=Ht==="exponential"?{name:"exponential",base:x.base!==void 0?x.base:1}:null;return{kind:"camera",interpolationType:hl,interpolationFactor:Em.interpolationFactor.bind(void 0,hl),zoomStops:x.stops.map(eh=>eh[0]),evaluate:({zoom:eh})=>In(x,g,eh,So,al)}}return{kind:"source",evaluate(hl,eh){const ah=eh&&eh.properties?eh.properties[x.property]:void 0;return ah===void 0?ky(x.default,g.default):In(x,g,ah,So,al)}}}function ky(x,g,S){return x!==void 0?x:g!==void 0?g:S!==void 0?S:void 0}function Yy(x,g,S,W,ut){return ky(typeof S===ut?W[S]:void 0,x.default,g.default)}function Jy(x,g,S){if(yg(S)!=="number")return ky(x.default,g.default);const W=x.stops.length;if(W===1||S<=x.stops[0][0])return x.stops[0][1];if(S>=x.stops[W-1][0])return x.stops[W-1][1];const ut=Cv(x.stops.map(Ht=>Ht[0]),S);return x.stops[ut][1]}function d0(x,g,S){const W=x.base!==void 0?x.base:1;if(yg(S)!=="number")return ky(x.default,g.default);const ut=x.stops.length;if(ut===1||S<=x.stops[0][0])return x.stops[0][1];if(S>=x.stops[ut-1][0])return x.stops[ut-1][1];const Ht=Cv(x.stops.map(hl=>hl[0]),S),Jt=function(hl,eh,ah,ch){const dh=ch-ah,Dh=hl-ah;return dh===0?0:eh===1?Dh/dh:(Math.pow(eh,Dh)-1)/(Math.pow(eh,dh)-1)}(S,W,x.stops[Ht][0],x.stops[Ht+1][0]),In=x.stops[Ht][1],So=x.stops[Ht+1][1],al=Km[g.type]||Rv;return typeof In.evaluate=="function"?{evaluate(...hl){const eh=In.evaluate.apply(void 0,hl),ah=So.evaluate.apply(void 0,hl);if(eh!==void 0&&ah!==void 0)return al(eh,ah,Jt,x.colorSpace)}}:al(In,So,Jt,x.colorSpace)}function Vx(x,g,S){switch(g.type){case"color":S=Yd.parse(S);break;case"formatted":S=Bg.fromString(S.toString());break;case"resolvedImage":S=nm.fromString(S.toString());break;case"padding":S=Xg.parse(S);break;default:yg(S)===g.type||g.type==="enum"&&g.values[S]||(S=void 0)}return ky(S,x.default,g.default)}Fm.register(j_,{error:[{kind:"error"},[Yp],(x,[g])=>{throw new hp(g.evaluate(x))}],typeof:[Yp,[Rd],(x,[g])=>oh(Dg(g.evaluate(x)))],"to-rgba":[sh(Ep,4),[$d],(x,[g])=>{const[S,W,ut,Ht]=g.evaluate(x).rgb;return[255*S,255*W,255*ut,Ht]}],rgb:[$d,[Ep,Ep,Ep],u0],rgba:[$d,[Ep,Ep,Ep,Ep],u0],has:{type:nd,overloads:[[[Yp],(x,[g])=>G0(g.evaluate(x),x.properties())],[[Yp,Qd],(x,[g,S])=>G0(g.evaluate(x),S.evaluate(x))]]},get:{type:Rd,overloads:[[[Yp],(x,[g])=>c0(g.evaluate(x),x.properties())],[[Yp,Qd],(x,[g,S])=>c0(g.evaluate(x),S.evaluate(x))]]},"feature-state":[Rd,[Yp],(x,[g])=>c0(g.evaluate(x),x.featureState||{})],properties:[Qd,[],x=>x.properties()],"geometry-type":[Yp,[],x=>x.geometryType()],id:[Rd,[],x=>x.id()],zoom:[Ep,[],x=>x.globals.zoom],"heatmap-density":[Ep,[],x=>x.globals.heatmapDensity||0],"line-progress":[Ep,[],x=>x.globals.lineProgress||0],accumulated:[Rd,[],x=>x.globals.accumulated===void 0?null:x.globals.accumulated],"+":[Ep,_y(Ep),(x,g)=>{let S=0;for(const W of g)S+=W.evaluate(x);return S}],"*":[Ep,_y(Ep),(x,g)=>{let S=1;for(const W of g)S*=W.evaluate(x);return S}],"-":{type:Ep,overloads:[[[Ep,Ep],(x,[g,S])=>g.evaluate(x)-S.evaluate(x)],[[Ep],(x,[g])=>-g.evaluate(x)]]},"/":[Ep,[Ep,Ep],(x,[g,S])=>g.evaluate(x)/S.evaluate(x)],"%":[Ep,[Ep,Ep],(x,[g,S])=>g.evaluate(x)%S.evaluate(x)],ln2:[Ep,[],()=>Math.LN2],pi:[Ep,[],()=>Math.PI],e:[Ep,[],()=>Math.E],"^":[Ep,[Ep,Ep],(x,[g,S])=>Math.pow(g.evaluate(x),S.evaluate(x))],sqrt:[Ep,[Ep],(x,[g])=>Math.sqrt(g.evaluate(x))],log10:[Ep,[Ep],(x,[g])=>Math.log(g.evaluate(x))/Math.LN10],ln:[Ep,[Ep],(x,[g])=>Math.log(g.evaluate(x))],log2:[Ep,[Ep],(x,[g])=>Math.log(g.evaluate(x))/Math.LN2],sin:[Ep,[Ep],(x,[g])=>Math.sin(g.evaluate(x))],cos:[Ep,[Ep],(x,[g])=>Math.cos(g.evaluate(x))],tan:[Ep,[Ep],(x,[g])=>Math.tan(g.evaluate(x))],asin:[Ep,[Ep],(x,[g])=>Math.asin(g.evaluate(x))],acos:[Ep,[Ep],(x,[g])=>Math.acos(g.evaluate(x))],atan:[Ep,[Ep],(x,[g])=>Math.atan(g.evaluate(x))],min:[Ep,_y(Ep),(x,g)=>Math.min(...g.map(S=>S.evaluate(x)))],max:[Ep,_y(Ep),(x,g)=>Math.max(...g.map(S=>S.evaluate(x)))],abs:[Ep,[Ep],(x,[g])=>Math.abs(g.evaluate(x))],round:[Ep,[Ep],(x,[g])=>{const S=g.evaluate(x);return S<0?-Math.round(-S):Math.round(S)}],floor:[Ep,[Ep],(x,[g])=>Math.floor(g.evaluate(x))],ceil:[Ep,[Ep],(x,[g])=>Math.ceil(g.evaluate(x))],"filter-==":[nd,[Yp,Rd],(x,[g,S])=>x.properties()[g.value]===S.value],"filter-id-==":[nd,[Rd],(x,[g])=>x.id()===g.value],"filter-type-==":[nd,[Yp],(x,[g])=>x.geometryType()===g.value],"filter-<":[nd,[Yp,Rd],(x,[g,S])=>{const W=x.properties()[g.value],ut=S.value;return typeof W==typeof ut&&W<ut}],"filter-id-<":[nd,[Rd],(x,[g])=>{const S=x.id(),W=g.value;return typeof S==typeof W&&S<W}],"filter->":[nd,[Yp,Rd],(x,[g,S])=>{const W=x.properties()[g.value],ut=S.value;return typeof W==typeof ut&&W>ut}],"filter-id->":[nd,[Rd],(x,[g])=>{const S=x.id(),W=g.value;return typeof S==typeof W&&S>W}],"filter-<=":[nd,[Yp,Rd],(x,[g,S])=>{const W=x.properties()[g.value],ut=S.value;return typeof W==typeof ut&&W<=ut}],"filter-id-<=":[nd,[Rd],(x,[g])=>{const S=x.id(),W=g.value;return typeof S==typeof W&&S<=W}],"filter->=":[nd,[Yp,Rd],(x,[g,S])=>{const W=x.properties()[g.value],ut=S.value;return typeof W==typeof ut&&W>=ut}],"filter-id->=":[nd,[Rd],(x,[g])=>{const S=x.id(),W=g.value;return typeof S==typeof W&&S>=W}],"filter-has":[nd,[Rd],(x,[g])=>g.value in x.properties()],"filter-has-id":[nd,[],x=>x.id()!==null&&x.id()!==void 0],"filter-type-in":[nd,[sh(Yp)],(x,[g])=>g.value.indexOf(x.geometryType())>=0],"filter-id-in":[nd,[sh(Rd)],(x,[g])=>g.value.indexOf(x.id())>=0],"filter-in-small":[nd,[Yp,sh(Rd)],(x,[g,S])=>S.value.indexOf(x.properties()[g.value])>=0],"filter-in-large":[nd,[Yp,sh(Rd)],(x,[g,S])=>function(W,ut,Ht,Jt){for(;Ht<=Jt;){const In=Ht+Jt>>1;if(ut[In]===W)return!0;ut[In]>W?Jt=In-1:Ht=In+1}return!1}(x.properties()[g.value],S.value,0,S.value.length-1)],all:{type:nd,overloads:[[[nd,nd],(x,[g,S])=>g.evaluate(x)&&S.evaluate(x)],[_y(nd),(x,g)=>{for(const S of g)if(!S.evaluate(x))return!1;return!0}]]},any:{type:nd,overloads:[[[nd,nd],(x,[g,S])=>g.evaluate(x)||S.evaluate(x)],[_y(nd),(x,g)=>{for(const S of g)if(S.evaluate(x))return!0;return!1}]]},"!":[nd,[nd],(x,[g])=>!g.evaluate(x)],"is-supported-script":[nd,[Yp],(x,[g])=>{const S=x.globals&&x.globals.isSupportedScript;return!S||S(g.evaluate(x))}],upcase:[Yp,[Yp],(x,[g])=>g.evaluate(x).toUpperCase()],downcase:[Yp,[Yp],(x,[g])=>g.evaluate(x).toLowerCase()],concat:[Yp,_y(Rd),(x,g)=>g.map(S=>sy(S.evaluate(x))).join("")],"resolved-locale":[Yp,[ng],(x,[g])=>g.evaluate(x).resolvedLocale()]});class H_{constructor(g,S){var W;this.expression=g,this._warningHistory={},this._evaluator=new wv,this._defaultValue=S?(W=S).type==="color"&&Av(W.default)?new Yd(0,0,0,0):W.type==="color"?Yd.parse(W.default)||null:W.type==="padding"?Xg.parse(W.default)||null:W.default===void 0?null:W.default:null,this._enumValues=S&&S.type==="enum"?S.values:null}evaluateWithoutErrorHandling(g,S,W,ut,Ht,Jt){return this._evaluator.globals=g,this._evaluator.feature=S,this._evaluator.featureState=W,this._evaluator.canonical=ut,this._evaluator.availableImages=Ht||null,this._evaluator.formattedSection=Jt,this.expression.evaluate(this._evaluator)}evaluate(g,S,W,ut,Ht,Jt){this._evaluator.globals=g,this._evaluator.feature=S||null,this._evaluator.featureState=W||null,this._evaluator.canonical=ut,this._evaluator.availableImages=Ht||null,this._evaluator.formattedSection=Jt||null;try{const In=this.expression.evaluate(this._evaluator);if(In==null||typeof In=="number"&&In!=In)return this._defaultValue;if(this._enumValues&&!(In in this._enumValues))throw new hp(`Expected value to be one of ${Object.keys(this._enumValues).map(So=>JSON.stringify(So)).join(", ")}, but found ${JSON.stringify(In)} instead.`);return In}catch(In){return this._warningHistory[In.message]||(this._warningHistory[In.message]=!0,typeof console<"u"&&console.warn(In.message)),this._defaultValue}}}function Iv(x){return Array.isArray(x)&&x.length>0&&typeof x[0]=="string"&&x[0]in j_}function Lg(x,g){const S=new qy(j_,G_,[],g?function(ut){const Ht={color:$d,string:Yp,number:Ep,enum:Yp,boolean:nd,formatted:bg,padding:Ih,resolvedImage:nh};return ut.type==="array"?sh(Ht[ut.value]||Rd,ut.length):Ht[ut.type]}(g):void 0),W=S.parse(x,void 0,void 0,void 0,g&&g.type==="string"?{typeAnnotation:"coerce"}:void 0);return W?hg(new H_(W,g)):Tv(S.errors)}class Pv{constructor(g,S){this.kind=g,this._styleExpression=S,this.isStateDependent=g!=="constant"&&!pm(S.expression)}evaluateWithoutErrorHandling(g,S,W,ut,Ht,Jt){return this._styleExpression.evaluateWithoutErrorHandling(g,S,W,ut,Ht,Jt)}evaluate(g,S,W,ut,Ht,Jt){return this._styleExpression.evaluate(g,S,W,ut,Ht,Jt)}}class rg{constructor(g,S,W,ut){this.kind=g,this.zoomStops=W,this._styleExpression=S,this.isStateDependent=g!=="camera"&&!pm(S.expression),this.interpolationType=ut}evaluateWithoutErrorHandling(g,S,W,ut,Ht,Jt){return this._styleExpression.evaluateWithoutErrorHandling(g,S,W,ut,Ht,Jt)}evaluate(g,S,W,ut,Ht,Jt){return this._styleExpression.evaluate(g,S,W,ut,Ht,Jt)}interpolationFactor(g,S,W){return this.interpolationType?Em.interpolationFactor(this.interpolationType,g,S,W):0}}function Mv(x,g){const S=Lg(x,g);if(S.result==="error")return S;const W=S.value.expression,ut=Fy(W);if(!ut&&!g_(g))return Tv([new xd("","data expressions not supported")]);const Ht=zg(W,["zoom"]);if(!Ht&&!wx(g))return Tv([new xd("","zoom expressions not supported")]);const Jt=_g(W);return Jt||Ht?Jt instanceof xd?Tv([Jt]):Jt instanceof Em&&!h0(g)?Tv([new xd("",'"interpolate" expressions cannot be used with this property')]):hg(Jt?new rg(ut?"camera":"composite",S.value,Jt.labels,Jt instanceof Em?Jt.interpolation:void 0):new Pv(ut?"constant":"source",S.value)):Tv([new xd("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class jd{constructor(g,S){this._parameters=g,this._specification=S,ud(this,p0(this._parameters,this._specification))}static deserialize(g){return new jd(g._parameters,g._specification)}static serialize(g){return{_parameters:g._parameters,_specification:g._specification}}}function _g(x){let g=null;if(x instanceof Ev)g=_g(x.result);else if(x instanceof p_){for(const S of x.args)if(g=_g(S),g)break}else(x instanceof h_||x instanceof Em)&&x.input instanceof Fm&&x.input.name==="zoom"&&(g=x);return g instanceof xd||x.eachChild(S=>{const W=_g(S);W instanceof xd?g=W:!g&&W?g=new xd("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):g&&W&&g!==W&&(g=new xd("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),g}function W_(x){if(x===!0||x===!1)return!0;if(!Array.isArray(x)||x.length===0)return!1;switch(x[0]){case"has":return x.length>=2&&x[1]!=="$id"&&x[1]!=="$type";case"in":return x.length>=3&&(typeof x[1]!="string"||Array.isArray(x[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return x.length!==3||Array.isArray(x[1])||Array.isArray(x[2]);case"any":case"all":for(const g of x.slice(1))if(!W_(g)&&typeof g!="boolean")return!1;return!0;default:return!0}}const V0={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function $0(x){if(x==null)return{filter:()=>!0,needGeometry:!1};W_(x)||(x=j0(x));const g=Lg(x,V0);if(g.result==="error")throw new Error(g.value.map(S=>`${S.key}: ${S.message}`).join(", "));return{filter:(S,W,ut)=>g.value.evaluate(S,W,{},ut),needGeometry:U0(x)}}function q_(x,g){return x<g?-1:x>g?1:0}function U0(x){if(!Array.isArray(x))return!1;if(x[0]==="within")return!0;for(let g=1;g<x.length;g++)if(U0(x[g]))return!0;return!1}function j0(x){if(!x)return!0;const g=x[0];return x.length<=1?g!=="any":g==="=="?H0(x[1],x[2],"=="):g==="!="?K_(H0(x[1],x[2],"==")):g==="<"||g===">"||g==="<="||g===">="?H0(x[1],x[2],g):g==="any"?(S=x.slice(1),["any"].concat(S.map(j0))):g==="all"?["all"].concat(x.slice(1).map(j0)):g==="none"?["all"].concat(x.slice(1).map(j0).map(K_)):g==="in"?bx(x[1],x.slice(2)):g==="!in"?K_(bx(x[1],x.slice(2))):g==="has"?f0(x[1]):g==="!has"?K_(f0(x[1])):g!=="within"||x;var S}function H0(x,g,S){switch(x){case"$type":return[`filter-type-${S}`,g];case"$id":return[`filter-id-${S}`,g];default:return[`filter-${S}`,x,g]}}function bx(x,g){if(g.length===0)return!1;switch(x){case"$type":return["filter-type-in",["literal",g]];case"$id":return["filter-id-in",["literal",g]];default:return g.length>200&&!g.some(S=>typeof S!=typeof g[0])?["filter-in-large",x,["literal",g.sort(q_)]]:["filter-in-small",x,["literal",g]]}}function f0(x){switch(x){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",x]}}function K_(x){return["!",x]}function Z_(x){const g=typeof x;if(g==="number"||g==="boolean"||g==="string"||x==null)return JSON.stringify(x);if(Array.isArray(x)){let ut="[";for(const Ht of x)ut+=`${Z_(Ht)},`;return`${ut}]`}const S=Object.keys(x).sort();let W="{";for(let ut=0;ut<S.length;ut++)W+=`${JSON.stringify(S[ut])}:${Z_(x[S[ut]])},`;return`${W}}`}function W0(x){let g="";for(const S of Ap)g+=`/${Z_(x[S])}`;return g}function Cx(x){const g=x.value;return g?[new up(x.key,g,"constants have been deprecated as of v8")]:[]}function Yg(x){return x instanceof Number||x instanceof String||x instanceof Boolean?x.valueOf():x}function X_(x){if(Array.isArray(x))return x.map(X_);if(x instanceof Object&&!(x instanceof Number||x instanceof String||x instanceof Boolean)){const g={};for(const S in x)g[S]=X_(x[S]);return g}return Yg(x)}function Nm(x){const g=x.key,S=x.value,W=x.valueSpec||{},ut=x.objectElementValidators||{},Ht=x.style,Jt=x.styleSpec,In=x.validateSpec;let So=[];const al=yg(S);if(al!=="object")return[new up(g,S,`object expected, ${al} found`)];for(const hl in S){const eh=hl.split(".")[0],ah=W[eh]||W["*"];let ch;if(ut[eh])ch=ut[eh];else if(W[eh])ch=In;else if(ut["*"])ch=ut["*"];else{if(!W["*"]){So.push(new up(g,S[hl],`unknown property "${hl}"`));continue}ch=In}So=So.concat(ch({key:(g&&`${g}.`)+hl,value:S[hl],valueSpec:ah,style:Ht,styleSpec:Jt,object:S,objectKey:hl,validateSpec:In},S))}for(const hl in W)ut[hl]||W[hl].required&&W[hl].default===void 0&&S[hl]===void 0&&So.push(new up(g,S,`missing required property "${hl}"`));return So}function Y_(x){const g=x.value,S=x.valueSpec,W=x.style,ut=x.styleSpec,Ht=x.key,Jt=x.arrayElementValidator||x.validateSpec;if(yg(g)!=="array")return[new up(Ht,g,`array expected, ${yg(g)} found`)];if(S.length&&g.length!==S.length)return[new up(Ht,g,`array length ${S.length} expected, length ${g.length} found`)];if(S["min-length"]&&g.length<S["min-length"])return[new up(Ht,g,`array length at least ${S["min-length"]} expected, length ${g.length} found`)];let In={type:S.value,values:S.values};ut.$version<7&&(In.function=S.function),yg(S.value)==="object"&&(In=S.value);let So=[];for(let al=0;al<g.length;al++)So=So.concat(Jt({array:g,arrayIndex:al,value:g[al],valueSpec:In,validateSpec:x.validateSpec,style:W,styleSpec:ut,key:`${Ht}[${al}]`}));return So}function g0(x){const g=x.key,S=x.value,W=x.valueSpec;let ut=yg(S);return ut==="number"&&S!=S&&(ut="NaN"),ut!=="number"?[new up(g,S,`number expected, ${ut} found`)]:"minimum"in W&&S<W.minimum?[new up(g,S,`${S} is less than the minimum value ${W.minimum}`)]:"maximum"in W&&S>W.maximum?[new up(g,S,`${S} is greater than the maximum value ${W.maximum}`)]:[]}function Dv(x){const g=x.valueSpec,S=Yg(x.value.type);let W,ut,Ht,Jt={};const In=S!=="categorical"&&x.value.property===void 0,So=!In,al=yg(x.value.stops)==="array"&&yg(x.value.stops[0])==="array"&&yg(x.value.stops[0][0])==="object",hl=Nm({key:x.key,value:x.value,valueSpec:x.styleSpec.function,validateSpec:x.validateSpec,style:x.style,styleSpec:x.styleSpec,objectElementValidators:{stops:function(ch){if(S==="identity")return[new up(ch.key,ch.value,'identity function may not have a "stops" property')];let dh=[];const Dh=ch.value;return dh=dh.concat(Y_({key:ch.key,value:Dh,valueSpec:ch.valueSpec,validateSpec:ch.validateSpec,style:ch.style,styleSpec:ch.styleSpec,arrayElementValidator:eh})),yg(Dh)==="array"&&Dh.length===0&&dh.push(new up(ch.key,Dh,"array must have at least one stop")),dh},default:function(ch){return ch.validateSpec({key:ch.key,value:ch.value,valueSpec:g,validateSpec:ch.validateSpec,style:ch.style,styleSpec:ch.styleSpec})}}});return S==="identity"&&In&&hl.push(new up(x.key,x.value,'missing required property "property"')),S==="identity"||x.value.stops||hl.push(new up(x.key,x.value,'missing required property "stops"')),S==="exponential"&&x.valueSpec.expression&&!h0(x.valueSpec)&&hl.push(new up(x.key,x.value,"exponential functions not supported")),x.styleSpec.$version>=8&&(So&&!g_(x.valueSpec)?hl.push(new up(x.key,x.value,"property functions not supported")):In&&!wx(x.valueSpec)&&hl.push(new up(x.key,x.value,"zoom functions not supported"))),S!=="categorical"&&!al||x.value.property!==void 0||hl.push(new up(x.key,x.value,'"property" property is required')),hl;function eh(ch){let dh=[];const Dh=ch.value,Ph=ch.key;if(yg(Dh)!=="array")return[new up(Ph,Dh,`array expected, ${yg(Dh)} found`)];if(Dh.length!==2)return[new up(Ph,Dh,`array length 2 expected, length ${Dh.length} found`)];if(al){if(yg(Dh[0])!=="object")return[new up(Ph,Dh,`object expected, ${yg(Dh[0])} found`)];if(Dh[0].zoom===void 0)return[new up(Ph,Dh,"object stop key must have zoom")];if(Dh[0].value===void 0)return[new up(Ph,Dh,"object stop key must have value")];if(Ht&&Ht>Yg(Dh[0].zoom))return[new up(Ph,Dh[0].zoom,"stop zoom values must appear in ascending order")];Yg(Dh[0].zoom)!==Ht&&(Ht=Yg(Dh[0].zoom),ut=void 0,Jt={}),dh=dh.concat(Nm({key:`${Ph}[0]`,value:Dh[0],valueSpec:{zoom:{}},validateSpec:ch.validateSpec,style:ch.style,styleSpec:ch.styleSpec,objectElementValidators:{zoom:g0,value:ah}}))}else dh=dh.concat(ah({key:`${Ph}[0]`,value:Dh[0],valueSpec:{},validateSpec:ch.validateSpec,style:ch.style,styleSpec:ch.styleSpec},Dh));return Iv(X_(Dh[1]))?dh.concat([new up(`${Ph}[1]`,Dh[1],"expressions are not allowed in function stops.")]):dh.concat(ch.validateSpec({key:`${Ph}[1]`,value:Dh[1],valueSpec:g,validateSpec:ch.validateSpec,style:ch.style,styleSpec:ch.styleSpec}))}function ah(ch,dh){const Dh=yg(ch.value),Ph=Yg(ch.value),Xh=ch.value!==null?ch.value:dh;if(W){if(Dh!==W)return[new up(ch.key,Xh,`${Dh} stop domain type must match previous stop domain type ${W}`)]}else W=Dh;if(Dh!=="number"&&Dh!=="string"&&Dh!=="boolean")return[new up(ch.key,Xh,"stop domain value must be a number, string, or boolean")];if(Dh!=="number"&&S!=="categorical"){let Qh=`number expected, ${Dh} found`;return g_(g)&&S===void 0&&(Qh+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new up(ch.key,Xh,Qh)]}return S!=="categorical"||Dh!=="number"||isFinite(Ph)&&Math.floor(Ph)===Ph?S!=="categorical"&&Dh==="number"&&ut!==void 0&&Ph<ut?[new up(ch.key,Xh,"stop domain values must appear in ascending order")]:(ut=Ph,S==="categorical"&&Ph in Jt?[new up(ch.key,Xh,"stop domain values must be unique")]:(Jt[Ph]=!0,[])):[new up(ch.key,Xh,`integer expected, found ${Ph}`)]}}function Qy(x){const g=(x.expressionContext==="property"?Mv:Lg)(X_(x.value),x.valueSpec);if(g.result==="error")return g.value.map(W=>new up(`${x.key}${W.key}`,x.value,W.message));const S=g.value.expression||g.value._styleExpression.expression;if(x.expressionContext==="property"&&x.propertyKey==="text-font"&&!S.outputDefined())return[new up(x.key,x.value,`Invalid data expression for "${x.propertyKey}". Output values must be contained as literals within the expression.`)];if(x.expressionContext==="property"&&x.propertyType==="layout"&&!pm(S))return[new up(x.key,x.value,'"feature-state" data expressions are not supported with layout properties.')];if(x.expressionContext==="filter"&&!pm(S))return[new up(x.key,x.value,'"feature-state" data expressions are not supported with filters.')];if(x.expressionContext&&x.expressionContext.indexOf("cluster")===0){if(!zg(S,["zoom","feature-state"]))return[new up(x.key,x.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(x.expressionContext==="cluster-initial"&&!Fy(S))return[new up(x.key,x.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Zm(x){const g=x.key,S=x.value,W=x.valueSpec,ut=[];return Array.isArray(W.values)?W.values.indexOf(Yg(S))===-1&&ut.push(new up(g,S,`expected one of [${W.values.join(", ")}], ${JSON.stringify(S)} found`)):Object.keys(W.values).indexOf(Yg(S))===-1&&ut.push(new up(g,S,`expected one of [${Object.keys(W.values).join(", ")}], ${JSON.stringify(S)} found`)),ut}function e_(x){return W_(X_(x.value))?Qy(ud({},x,{expressionContext:"filter",valueSpec:{value:"boolean"}})):q0(x)}function q0(x){const g=x.value,S=x.key;if(yg(g)!=="array")return[new up(S,g,`array expected, ${yg(g)} found`)];const W=x.styleSpec;let ut,Ht=[];if(g.length<1)return[new up(S,g,"filter array must have at least 1 element")];switch(Ht=Ht.concat(Zm({key:`${S}[0]`,value:g[0],valueSpec:W.filter_operator,style:x.style,styleSpec:x.styleSpec})),Yg(g[0])){case"<":case"<=":case">":case">=":g.length>=2&&Yg(g[1])==="$type"&&Ht.push(new up(S,g,`"$type" cannot be use with operator "${g[0]}"`));case"==":case"!=":g.length!==3&&Ht.push(new up(S,g,`filter array for operator "${g[0]}" must have 3 elements`));case"in":case"!in":g.length>=2&&(ut=yg(g[1]),ut!=="string"&&Ht.push(new up(`${S}[1]`,g[1],`string expected, ${ut} found`)));for(let Jt=2;Jt<g.length;Jt++)ut=yg(g[Jt]),Yg(g[1])==="$type"?Ht=Ht.concat(Zm({key:`${S}[${Jt}]`,value:g[Jt],valueSpec:W.geometry_type,style:x.style,styleSpec:x.styleSpec})):ut!=="string"&&ut!=="number"&&ut!=="boolean"&&Ht.push(new up(`${S}[${Jt}]`,g[Jt],`string, number, or boolean expected, ${ut} found`));break;case"any":case"all":case"none":for(let Jt=1;Jt<g.length;Jt++)Ht=Ht.concat(q0({key:`${S}[${Jt}]`,value:g[Jt],style:x.style,styleSpec:x.styleSpec}));break;case"has":case"!has":ut=yg(g[1]),g.length!==2?Ht.push(new up(S,g,`filter array for "${g[0]}" operator must have 2 elements`)):ut!=="string"&&Ht.push(new up(`${S}[1]`,g[1],`string expected, ${ut} found`));break;case"within":ut=yg(g[1]),g.length!==2?Ht.push(new up(S,g,`filter array for "${g[0]}" operator must have 2 elements`)):ut!=="object"&&Ht.push(new up(`${S}[1]`,g[1],`object expected, ${ut} found`))}return Ht}function Ov(x,g){const S=x.key,W=x.validateSpec,ut=x.style,Ht=x.styleSpec,Jt=x.value,In=x.objectKey,So=Ht[`${g}_${x.layerType}`];if(!So)return[];const al=In.match(/^(.*)-transition$/);if(g==="paint"&&al&&So[al[1]]&&So[al[1]].transition)return W({key:S,value:Jt,valueSpec:Ht.transition,style:ut,styleSpec:Ht});const hl=x.valueSpec||So[In];if(!hl)return[new up(S,Jt,`unknown property "${In}"`)];let eh;if(yg(Jt)==="string"&&g_(hl)&&!hl.tokens&&(eh=/^{([^}]+)}$/.exec(Jt)))return[new up(S,Jt,`"${In}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(eh[1])} }\`.`)];const ah=[];return x.layerType==="symbol"&&(In==="text-field"&&ut&&!ut.glyphs&&ah.push(new up(S,Jt,'use of "text-field" requires a style "glyphs" property')),In==="text-font"&&Av(X_(Jt))&&Yg(Jt.type)==="identity"&&ah.push(new up(S,Jt,'"text-font" does not support identity functions'))),ah.concat(W({key:x.key,value:Jt,valueSpec:hl,style:ut,styleSpec:Ht,expressionContext:"property",propertyType:g,propertyKey:In}))}function K0(x){return Ov(x,"paint")}function Z0(x){return Ov(x,"layout")}function X0(x){let g=[];const S=x.value,W=x.key,ut=x.style,Ht=x.styleSpec;S.type||S.ref||g.push(new up(W,S,'either "type" or "ref" is required'));let Jt=Yg(S.type);const In=Yg(S.ref);if(S.id){const So=Yg(S.id);for(let al=0;al<x.arrayIndex;al++){const hl=ut.layers[al];Yg(hl.id)===So&&g.push(new up(W,S.id,`duplicate layer id "${S.id}", previously used at line ${hl.id.__line__}`))}}if("ref"in S){let So;["type","source","source-layer","filter","layout"].forEach(al=>{al in S&&g.push(new up(W,S[al],`"${al}" is prohibited for ref layers`))}),ut.layers.forEach(al=>{Yg(al.id)===In&&(So=al)}),So?So.ref?g.push(new up(W,S.ref,"ref cannot reference another ref layer")):Jt=Yg(So.type):g.push(new up(W,S.ref,`ref layer "${In}" not found`))}else if(Jt!=="background")if(S.source){const So=ut.sources&&ut.sources[S.source],al=So&&Yg(So.type);So?al==="vector"&&Jt==="raster"?g.push(new up(W,S.source,`layer "${S.id}" requires a raster source`)):al==="raster"&&Jt!=="raster"?g.push(new up(W,S.source,`layer "${S.id}" requires a vector source`)):al!=="vector"||S["source-layer"]?al==="raster-dem"&&Jt!=="hillshade"?g.push(new up(W,S.source,"raster-dem source can only be used with layer type 'hillshade'.")):Jt!=="line"||!S.paint||!S.paint["line-gradient"]||al==="geojson"&&So.lineMetrics||g.push(new up(W,S,`layer "${S.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):g.push(new up(W,S,`layer "${S.id}" must specify a "source-layer"`)):g.push(new up(W,S.source,`source "${S.source}" not found`))}else g.push(new up(W,S,'missing required property "source"'));return g=g.concat(Nm({key:W,value:S,valueSpec:Ht.layer,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":()=>[],type:()=>x.validateSpec({key:`${W}.type`,value:S.type,valueSpec:Ht.layer.type,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,object:S,objectKey:"type"}),filter:e_,layout:So=>Nm({layer:S,key:So.key,value:So.value,style:So.style,styleSpec:So.styleSpec,validateSpec:So.validateSpec,objectElementValidators:{"*":al=>Z0(ud({layerType:Jt},al))}}),paint:So=>Nm({layer:S,key:So.key,value:So.value,style:So.style,styleSpec:So.styleSpec,validateSpec:So.validateSpec,objectElementValidators:{"*":al=>K0(ud({layerType:Jt},al))}})}})),g}function vy(x){const g=x.value,S=x.key,W=yg(g);return W!=="string"?[new up(S,g,`string expected, ${W} found`)]:[]}const J_={promoteId:function({key:x,value:g}){if(yg(g)==="string")return vy({key:x,value:g});{const S=[];for(const W in g)S.push(...vy({key:`${x}.${W}`,value:g[W]}));return S}}};function m_(x){const g=x.value,S=x.key,W=x.styleSpec,ut=x.style,Ht=x.validateSpec;if(!g.type)return[new up(S,g,'"type" is required')];const Jt=Yg(g.type);let In;switch(Jt){case"vector":case"raster":case"raster-dem":return In=Nm({key:S,value:g,valueSpec:W[`source_${Jt.replace("-","_")}`],style:x.style,styleSpec:W,objectElementValidators:J_,validateSpec:Ht}),In;case"geojson":if(In=Nm({key:S,value:g,valueSpec:W.source_geojson,style:ut,styleSpec:W,validateSpec:Ht,objectElementValidators:J_}),g.cluster)for(const So in g.clusterProperties){const[al,hl]=g.clusterProperties[So],eh=typeof al=="string"?[al,["accumulated"],["get",So]]:al;In.push(...Qy({key:`${S}.${So}.map`,value:hl,validateSpec:Ht,expressionContext:"cluster-map"})),In.push(...Qy({key:`${S}.${So}.reduce`,value:eh,validateSpec:Ht,expressionContext:"cluster-reduce"}))}return In;case"video":return Nm({key:S,value:g,valueSpec:W.source_video,style:ut,validateSpec:Ht,styleSpec:W});case"image":return Nm({key:S,value:g,valueSpec:W.source_image,style:ut,validateSpec:Ht,styleSpec:W});case"canvas":return[new up(S,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Zm({key:`${S}.type`,value:g.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:ut,validateSpec:Ht,styleSpec:W})}}function Ex(x){const g=x.value,S=x.styleSpec,W=S.light,ut=x.style;let Ht=[];const Jt=yg(g);if(g===void 0)return Ht;if(Jt!=="object")return Ht=Ht.concat([new up("light",g,`object expected, ${Jt} found`)]),Ht;for(const In in g){const So=In.match(/^(.*)-transition$/);Ht=Ht.concat(So&&W[So[1]]&&W[So[1]].transition?x.validateSpec({key:In,value:g[In],valueSpec:S.transition,validateSpec:x.validateSpec,style:ut,styleSpec:S}):W[In]?x.validateSpec({key:In,value:g[In],valueSpec:W[In],validateSpec:x.validateSpec,style:ut,styleSpec:S}):[new up(In,g[In],`unknown property "${In}"`)])}return Ht}function Q_(x){const g=x.value,S=x.styleSpec,W=S.terrain,ut=x.style;let Ht=[];const Jt=yg(g);if(g===void 0)return Ht;if(Jt!=="object")return Ht=Ht.concat([new up("terrain",g,`object expected, ${Jt} found`)]),Ht;for(const In in g)Ht=Ht.concat(W[In]?x.validateSpec({key:In,value:g[In],valueSpec:W[In],validateSpec:x.validateSpec,style:ut,styleSpec:S}):[new up(In,g[In],`unknown property "${In}"`)]);return Ht}function $x(x){let g=[];const S=x.value,W=x.key;if(Array.isArray(S)){const ut=[],Ht=[];for(const Jt in S)S[Jt].id&&ut.includes(S[Jt].id)&&g.push(new up(W,S,`all the sprites' ids must be unique, but ${S[Jt].id} is duplicated`)),ut.push(S[Jt].id),S[Jt].url&&Ht.includes(S[Jt].url)&&g.push(new up(W,S,`all the sprites' URLs must be unique, but ${S[Jt].url} is duplicated`)),Ht.push(S[Jt].url),g=g.concat(Nm({key:`${W}[${Jt}]`,value:S[Jt],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:x.validateSpec}));return g}return vy({key:W,value:S})}const Y0={"*":()=>[],array:Y_,boolean:function(x){const g=x.value,S=x.key,W=yg(g);return W!=="boolean"?[new up(S,g,`boolean expected, ${W} found`)]:[]},number:g0,color:function(x){const g=x.key,S=x.value,W=yg(S);return W!=="string"?[new up(g,S,`color expected, ${W} found`)]:Yd.parse(String(S))?[]:[new up(g,S,`color expected, "${S}" found`)]},constants:Cx,enum:Zm,filter:e_,function:Dv,layer:X0,object:Nm,source:m_,light:Ex,terrain:Q_,string:vy,formatted:function(x){return vy(x).length===0?[]:Qy(x)},resolvedImage:function(x){return vy(x).length===0?[]:Qy(x)},padding:function(x){const g=x.key,S=x.value;if(yg(S)==="array"){if(S.length<1||S.length>4)return[new up(g,S,`padding requires 1 to 4 values; ${S.length} values found`)];const W={type:"number"};let ut=[];for(let Ht=0;Ht<S.length;Ht++)ut=ut.concat(x.validateSpec({key:`${g}[${Ht}]`,value:S[Ht],validateSpec:x.validateSpec,valueSpec:W}));return ut}return g0({key:g,value:S,valueSpec:{}})},sprite:$x};function Lv(x){const g=x.value,S=x.valueSpec,W=x.styleSpec;return x.validateSpec=Lv,S.expression&&Av(Yg(g))?Dv(x):S.expression&&Iv(X_(g))?Qy(x):S.type&&Y0[S.type]?Y0[S.type](x):Nm(ud({},x,{valueSpec:S.type?W[S.type]:S}))}function Fv(x){const g=x.value,S=x.key,W=vy(x);return W.length||(g.indexOf("{fontstack}")===-1&&W.push(new up(S,g,'"glyphs" url must include a "{fontstack}" token')),g.indexOf("{range}")===-1&&W.push(new up(S,g,'"glyphs" url must include a "{range}" token'))),W}function Ry(x,g=Yh){let S=[];return S=S.concat(Lv({key:"",value:x,valueSpec:g.$root,styleSpec:g,style:x,validateSpec:Lv,objectElementValidators:{glyphs:Fv,"*":()=>[]}})),x.constants&&(S=S.concat(Cx({key:"constants",value:x.constants,style:x,styleSpec:g,validateSpec:Lv}))),Nv(S)}function $m(x){return function(g){return x({...g,validateSpec:Lv})}}function Nv(x){return[].concat(x).sort((g,S)=>g.line-S.line)}function Vg(x){return function(...g){return Nv(x.apply(this,g))}}Ry.source=Vg($m(m_)),Ry.sprite=Vg($m($x)),Ry.glyphs=Vg($m(Fv)),Ry.light=Vg($m(Ex)),Ry.terrain=Vg($m(Q_)),Ry.layer=Vg($m(X0)),Ry.filter=Vg($m(e_)),Ry.paintProperty=Vg($m(K0)),Ry.layoutProperty=Vg($m(Z0));const y_=Ry,xw=y_.light,ww=y_.paintProperty,bw=y_.layoutProperty;function kv(x,g){let S=!1;if(g&&g.length)for(const W of g)x.fire(new Ad(new Error(W.message))),S=!0;return S}class Bv{constructor(g,S,W){const ut=this.cells=[];if(g instanceof ArrayBuffer){this.arrayBuffer=g;const Jt=new Int32Array(this.arrayBuffer);g=Jt[0],this.d=(S=Jt[1])+2*(W=Jt[2]);for(let So=0;So<this.d*this.d;So++){const al=Jt[3+So],hl=Jt[3+So+1];ut.push(al===hl?null:Jt.subarray(al,hl))}const In=Jt[3+ut.length+1];this.keys=Jt.subarray(Jt[3+ut.length],In),this.bboxes=Jt.subarray(In),this.insert=this._insertReadonly}else{this.d=S+2*W;for(let Jt=0;Jt<this.d*this.d;Jt++)ut.push([]);this.keys=[],this.bboxes=[]}this.n=S,this.extent=g,this.padding=W,this.scale=S/g,this.uid=0;const Ht=W/S*g;this.min=-Ht,this.max=g+Ht}insert(g,S,W,ut,Ht){this._forEachCell(S,W,ut,Ht,this._insertCell,this.uid++,void 0,void 0),this.keys.push(g),this.bboxes.push(S),this.bboxes.push(W),this.bboxes.push(ut),this.bboxes.push(Ht)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(g,S,W,ut,Ht,Jt){this.cells[Ht].push(Jt)}query(g,S,W,ut,Ht){const Jt=this.min,In=this.max;if(g<=Jt&&S<=Jt&&In<=W&&In<=ut&&!Ht)return Array.prototype.slice.call(this.keys);{const So=[];return this._forEachCell(g,S,W,ut,this._queryCell,So,{},Ht),So}}_queryCell(g,S,W,ut,Ht,Jt,In,So){const al=this.cells[Ht];if(al!==null){const hl=this.keys,eh=this.bboxes;for(let ah=0;ah<al.length;ah++){const ch=al[ah];if(In[ch]===void 0){const dh=4*ch;(So?So(eh[dh+0],eh[dh+1],eh[dh+2],eh[dh+3]):g<=eh[dh+2]&&S<=eh[dh+3]&&W>=eh[dh+0]&&ut>=eh[dh+1])?(In[ch]=!0,Jt.push(hl[ch])):In[ch]=!1}}}}_forEachCell(g,S,W,ut,Ht,Jt,In,So){const al=this._convertToCellCoord(g),hl=this._convertToCellCoord(S),eh=this._convertToCellCoord(W),ah=this._convertToCellCoord(ut);for(let ch=al;ch<=eh;ch++)for(let dh=hl;dh<=ah;dh++){const Dh=this.d*dh+ch;if((!So||So(this._convertFromCellCoord(ch),this._convertFromCellCoord(dh),this._convertFromCellCoord(ch+1),this._convertFromCellCoord(dh+1)))&&Ht.call(this,g,S,W,ut,Dh,Jt,In,So))return}}_convertFromCellCoord(g){return(g-this.padding)/this.scale}_convertToCellCoord(g){return Math.max(0,Math.min(this.d-1,Math.floor(g*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const g=this.cells,S=3+this.cells.length+1+1;let W=0;for(let Jt=0;Jt<this.cells.length;Jt++)W+=this.cells[Jt].length;const ut=new Int32Array(S+W+this.keys.length+this.bboxes.length);ut[0]=this.extent,ut[1]=this.n,ut[2]=this.padding;let Ht=S;for(let Jt=0;Jt<g.length;Jt++){const In=g[Jt];ut[3+Jt]=Ht,ut.set(In,Ht),Ht+=In.length}return ut[3+g.length]=Ht,ut.set(this.keys,Ht),Ht+=this.keys.length,ut[3+g.length+1]=Ht,ut.set(this.bboxes,Ht),Ht+=this.bboxes.length,ut.buffer}static serialize(g,S){const W=g.toArrayBuffer();return S&&S.push(W),{buffer:W}}static deserialize(g){return new Bv(g.buffer)}}const ly={};function Td(x,g,S={}){if(ly[x])throw new Error(`${x} is already registered.`);Object.defineProperty(g,"_classRegistryKey",{value:x,writeable:!1}),ly[x]={klass:g,omit:S.omit||[],shallow:S.shallow||[]}}Td("Object",Object),Td("TransferableGridIndex",Bv),Td("Color",Yd),Td("Error",Error),Td("AJAXError",Xp),Td("ResolvedImage",nm),Td("StylePropertyFunction",jd),Td("StyleExpression",H_,{omit:["_evaluator"]}),Td("ZoomDependentExpression",rg),Td("ZoomConstantExpression",Pv),Td("CompoundExpression",Fm,{omit:["_evaluate"]});for(const x in j_)j_[x]._classRegistryKey||Td(`Expression_${x}`,j_[x]);function m0(x){return x&&typeof ArrayBuffer<"u"&&(x instanceof ArrayBuffer||x.constructor&&x.constructor.name==="ArrayBuffer")}function zv(x,g){if(x==null||typeof x=="boolean"||typeof x=="number"||typeof x=="string"||x instanceof Boolean||x instanceof Number||x instanceof String||x instanceof Date||x instanceof RegExp||x instanceof Blob)return x;if(m0(x)||vp(x))return g&&g.push(x),x;if(ArrayBuffer.isView(x)){const S=x;return g&&g.push(S.buffer),S}if(x instanceof ImageData)return g&&g.push(x.data.buffer),x;if(Array.isArray(x)){const S=[];for(const W of x)S.push(zv(W,g));return S}if(typeof x=="object"){const S=x.constructor,W=S._classRegistryKey;if(!W)throw new Error("can't serialize object of unregistered class");if(!ly[W])throw new Error(`${W} is not registered.`);const ut=S.serialize?S.serialize(x,g):{};if(S.serialize){if(g&&ut===g[g.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const Ht in x){if(!x.hasOwnProperty(Ht)||ly[W].omit.indexOf(Ht)>=0)continue;const Jt=x[Ht];ut[Ht]=ly[W].shallow.indexOf(Ht)>=0?Jt:zv(Jt,g)}x instanceof Error&&(ut.message=x.message)}if(ut.$name)throw new Error("$name property is reserved for worker serialization logic.");return W!=="Object"&&(ut.$name=W),ut}throw new Error("can't serialize object of type "+typeof x)}function Sm(x){if(x==null||typeof x=="boolean"||typeof x=="number"||typeof x=="string"||x instanceof Boolean||x instanceof Number||x instanceof String||x instanceof Date||x instanceof RegExp||x instanceof Blob||m0(x)||vp(x)||ArrayBuffer.isView(x)||x instanceof ImageData)return x;if(Array.isArray(x))return x.map(Sm);if(typeof x=="object"){const g=x.$name||"Object";if(!ly[g])throw new Error(`can't deserialize unregistered class ${g}`);const{klass:S}=ly[g];if(!S)throw new Error(`can't deserialize unregistered class ${g}`);if(S.deserialize)return S.deserialize(x);const W=Object.create(S.prototype);for(const ut of Object.keys(x)){if(ut==="$name")continue;const Ht=x[ut];W[ut]=ly[g].shallow.indexOf(ut)>=0?Ht:Sm(Ht)}return W}throw new Error("can't deserialize object of type "+typeof x)}class y0{constructor(){this.first=!0}update(g,S){const W=Math.floor(g);return this.first?(this.first=!1,this.lastIntegerZoom=W,this.lastIntegerZoomTime=0,this.lastZoom=g,this.lastFloorZoom=W,!0):(this.lastFloorZoom>W?(this.lastIntegerZoom=W+1,this.lastIntegerZoomTime=S):this.lastFloorZoom<W&&(this.lastIntegerZoom=W,this.lastIntegerZoomTime=S),g!==this.lastZoom&&(this.lastZoom=g,this.lastFloorZoom=W,!0))}}const sd={"Latin-1 Supplement":x=>x>=128&&x<=255,Arabic:x=>x>=1536&&x<=1791,"Arabic Supplement":x=>x>=1872&&x<=1919,"Arabic Extended-A":x=>x>=2208&&x<=2303,"Hangul Jamo":x=>x>=4352&&x<=4607,"Unified Canadian Aboriginal Syllabics":x=>x>=5120&&x<=5759,Khmer:x=>x>=6016&&x<=6143,"Unified Canadian Aboriginal Syllabics Extended":x=>x>=6320&&x<=6399,"General Punctuation":x=>x>=8192&&x<=8303,"Letterlike Symbols":x=>x>=8448&&x<=8527,"Number Forms":x=>x>=8528&&x<=8591,"Miscellaneous Technical":x=>x>=8960&&x<=9215,"Control Pictures":x=>x>=9216&&x<=9279,"Optical Character Recognition":x=>x>=9280&&x<=9311,"Enclosed Alphanumerics":x=>x>=9312&&x<=9471,"Geometric Shapes":x=>x>=9632&&x<=9727,"Miscellaneous Symbols":x=>x>=9728&&x<=9983,"Miscellaneous Symbols and Arrows":x=>x>=11008&&x<=11263,"CJK Radicals Supplement":x=>x>=11904&&x<=12031,"Kangxi Radicals":x=>x>=12032&&x<=12255,"Ideographic Description Characters":x=>x>=12272&&x<=12287,"CJK Symbols and Punctuation":x=>x>=12288&&x<=12351,Hiragana:x=>x>=12352&&x<=12447,Katakana:x=>x>=12448&&x<=12543,Bopomofo:x=>x>=12544&&x<=12591,"Hangul Compatibility Jamo":x=>x>=12592&&x<=12687,Kanbun:x=>x>=12688&&x<=12703,"Bopomofo Extended":x=>x>=12704&&x<=12735,"CJK Strokes":x=>x>=12736&&x<=12783,"Katakana Phonetic Extensions":x=>x>=12784&&x<=12799,"Enclosed CJK Letters and Months":x=>x>=12800&&x<=13055,"CJK Compatibility":x=>x>=13056&&x<=13311,"CJK Unified Ideographs Extension A":x=>x>=13312&&x<=19903,"Yijing Hexagram Symbols":x=>x>=19904&&x<=19967,"CJK Unified Ideographs":x=>x>=19968&&x<=40959,"Yi Syllables":x=>x>=40960&&x<=42127,"Yi Radicals":x=>x>=42128&&x<=42191,"Hangul Jamo Extended-A":x=>x>=43360&&x<=43391,"Hangul Syllables":x=>x>=44032&&x<=55215,"Hangul Jamo Extended-B":x=>x>=55216&&x<=55295,"Private Use Area":x=>x>=57344&&x<=63743,"CJK Compatibility Ideographs":x=>x>=63744&&x<=64255,"Arabic Presentation Forms-A":x=>x>=64336&&x<=65023,"Vertical Forms":x=>x>=65040&&x<=65055,"CJK Compatibility Forms":x=>x>=65072&&x<=65103,"Small Form Variants":x=>x>=65104&&x<=65135,"Arabic Presentation Forms-B":x=>x>=65136&&x<=65279,"Halfwidth and Fullwidth Forms":x=>x>=65280&&x<=65519};function __(x){for(const g of x)if(t_(g.charCodeAt(0)))return!0;return!1}function J0(x){for(const g of x)if(!v_(g.charCodeAt(0)))return!1;return!0}function v_(x){return!(sd.Arabic(x)||sd["Arabic Supplement"](x)||sd["Arabic Extended-A"](x)||sd["Arabic Presentation Forms-A"](x)||sd["Arabic Presentation Forms-B"](x))}function t_(x){return!(x!==746&&x!==747&&(x<4352||!(sd["Bopomofo Extended"](x)||sd.Bopomofo(x)||sd["CJK Compatibility Forms"](x)&&!(x>=65097&&x<=65103)||sd["CJK Compatibility Ideographs"](x)||sd["CJK Compatibility"](x)||sd["CJK Radicals Supplement"](x)||sd["CJK Strokes"](x)||!(!sd["CJK Symbols and Punctuation"](x)||x>=12296&&x<=12305||x>=12308&&x<=12319||x===12336)||sd["CJK Unified Ideographs Extension A"](x)||sd["CJK Unified Ideographs"](x)||sd["Enclosed CJK Letters and Months"](x)||sd["Hangul Compatibility Jamo"](x)||sd["Hangul Jamo Extended-A"](x)||sd["Hangul Jamo Extended-B"](x)||sd["Hangul Jamo"](x)||sd["Hangul Syllables"](x)||sd.Hiragana(x)||sd["Ideographic Description Characters"](x)||sd.Kanbun(x)||sd["Kangxi Radicals"](x)||sd["Katakana Phonetic Extensions"](x)||sd.Katakana(x)&&x!==12540||!(!sd["Halfwidth and Fullwidth Forms"](x)||x===65288||x===65289||x===65293||x>=65306&&x<=65310||x===65339||x===65341||x===65343||x>=65371&&x<=65503||x===65507||x>=65512&&x<=65519)||!(!sd["Small Form Variants"](x)||x>=65112&&x<=65118||x>=65123&&x<=65126)||sd["Unified Canadian Aboriginal Syllabics"](x)||sd["Unified Canadian Aboriginal Syllabics Extended"](x)||sd["Vertical Forms"](x)||sd["Yijing Hexagram Symbols"](x)||sd["Yi Syllables"](x)||sd["Yi Radicals"](x))))}function _0(x){return!(t_(x)||function(g){return!!(sd["Latin-1 Supplement"](g)&&(g===167||g===169||g===174||g===177||g===188||g===189||g===190||g===215||g===247)||sd["General Punctuation"](g)&&(g===8214||g===8224||g===8225||g===8240||g===8241||g===8251||g===8252||g===8258||g===8263||g===8264||g===8265||g===8273)||sd["Letterlike Symbols"](g)||sd["Number Forms"](g)||sd["Miscellaneous Technical"](g)&&(g>=8960&&g<=8967||g>=8972&&g<=8991||g>=8996&&g<=9e3||g===9003||g>=9085&&g<=9114||g>=9150&&g<=9165||g===9167||g>=9169&&g<=9179||g>=9186&&g<=9215)||sd["Control Pictures"](g)&&g!==9251||sd["Optical Character Recognition"](g)||sd["Enclosed Alphanumerics"](g)||sd["Geometric Shapes"](g)||sd["Miscellaneous Symbols"](g)&&!(g>=9754&&g<=9759)||sd["Miscellaneous Symbols and Arrows"](g)&&(g>=11026&&g<=11055||g>=11088&&g<=11097||g>=11192&&g<=11243)||sd["CJK Symbols and Punctuation"](g)||sd.Katakana(g)||sd["Private Use Area"](g)||sd["CJK Compatibility Forms"](g)||sd["Small Form Variants"](g)||sd["Halfwidth and Fullwidth Forms"](g)||g===8734||g===8756||g===8757||g>=9984&&g<=10087||g>=10102&&g<=10131||g===65532||g===65533)}(x))}function ev(x){return x>=1424&&x<=2303||sd["Arabic Presentation Forms-A"](x)||sd["Arabic Presentation Forms-B"](x)}function og(x,g){return!(!g&&ev(x)||x>=2304&&x<=3583||x>=3840&&x<=4255||sd.Khmer(x))}function Gv(x){for(const g of x)if(ev(g.charCodeAt(0)))return!0;return!1}const Q0="deferred",tv="loading",x_="loaded";let Vv=null,Tm="unavailable",km=null;const Sx=function(x){x&&typeof x=="string"&&x.indexOf("NetworkError")>-1&&(Tm="error"),Vv&&Vv(x)};function $v(){r_.fire(new Kp("pluginStateChange",{pluginStatus:Tm,pluginURL:km}))}const r_=new Id,w_=function(){return Tm},ex=function(){if(Tm!==Q0||!km)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Tm=tv,$v(),km&&Wp({url:km},x=>{x?Sx(x):(Tm=x_,$v())})},Bm={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Tm===x_||Bm.applyArabicShaping!=null,isLoading:()=>Tm===tv,setState(x){if(!wh())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Tm=x.pluginStatus,km=x.pluginURL},isParsed(){if(!wh())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Bm.applyArabicShaping!=null&&Bm.processBidirectionalText!=null&&Bm.processStyledBidirectionalText!=null},getPluginURL(){if(!wh())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return km}};class Eg{constructor(g,S){this.zoom=g,S?(this.now=S.now,this.fadeDuration=S.fadeDuration,this.zoomHistory=S.zoomHistory,this.transition=S.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new y0,this.transition={})}isSupportedScript(g){return function(S,W){for(const ut of S)if(!og(ut.charCodeAt(0),W))return!1;return!0}(g,Bm.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const g=this.zoom,S=g-Math.floor(g),W=this.crossFadingFactor();return g>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:S+(1-S)*W}:{fromScale:.5,toScale:1,t:1-(1-W)*S}}}class rv{constructor(g,S){this.property=g,this.value=S,this.expression=function(W,ut){if(Av(W))return new jd(W,ut);if(Iv(W)){const Ht=Mv(W,ut);if(Ht.result==="error")throw new Error(Ht.value.map(Jt=>`${Jt.key}: ${Jt.message}`).join(", "));return Ht.value}{let Ht=W;return ut.type==="color"&&typeof W=="string"?Ht=Yd.parse(W):ut.type!=="padding"||typeof W!="number"&&!Array.isArray(W)||(Ht=Xg.parse(W)),{kind:"constant",evaluate:()=>Ht}}}(S===void 0?g.specification.default:S,g.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(g,S,W){return this.property.possiblyEvaluate(this,g,S,W)}}class Uv{constructor(g){this.property=g,this.value=new rv(g,void 0)}transitioned(g,S){return new Um(this.property,this.value,S,vi({},g.transition,this.transition),g.now)}untransitioned(){return new Um(this.property,this.value,null,{},0)}}class fd{constructor(g){this._properties=g,this._values=Object.create(g.defaultTransitionablePropertyValues)}getValue(g){return il(this._values[g].value.value)}setValue(g,S){Object.prototype.hasOwnProperty.call(this._values,g)||(this._values[g]=new Uv(this._values[g].property)),this._values[g].value=new rv(this._values[g].property,S===null?void 0:il(S))}getTransition(g){return il(this._values[g].transition)}setTransition(g,S){Object.prototype.hasOwnProperty.call(this._values,g)||(this._values[g]=new Uv(this._values[g].property)),this._values[g].transition=il(S)||void 0}serialize(){const g={};for(const S of Object.keys(this._values)){const W=this.getValue(S);W!==void 0&&(g[S]=W);const ut=this.getTransition(S);ut!==void 0&&(g[`${S}-transition`]=ut)}return g}transitioned(g,S){const W=new Tx(this._properties);for(const ut of Object.keys(this._values))W._values[ut]=this._values[ut].transitioned(g,S._values[ut]);return W}untransitioned(){const g=new Tx(this._properties);for(const S of Object.keys(this._values))g._values[S]=this._values[S].untransitioned();return g}}class Um{constructor(g,S,W,ut,Ht){this.property=g,this.value=S,this.begin=Ht+ut.delay||0,this.end=this.begin+ut.duration||0,g.specification.transition&&(ut.delay||ut.duration)&&(this.prior=W)}possiblyEvaluate(g,S,W){const ut=g.now||0,Ht=this.value.possiblyEvaluate(g,S,W),Jt=this.prior;if(Jt){if(ut>this.end)return this.prior=null,Ht;if(this.value.isDataDriven())return this.prior=null,Ht;if(ut<this.begin)return Jt.possiblyEvaluate(g,S,W);{const In=(ut-this.begin)/(this.end-this.begin);return this.property.interpolate(Jt.possiblyEvaluate(g,S,W),Ht,function(So){if(So<=0)return 0;if(So>=1)return 1;const al=So*So,hl=al*So;return 4*(So<.5?hl:3*(So-al)+hl-.75)}(In))}}return Ht}}class Tx{constructor(g){this._properties=g,this._values=Object.create(g.defaultTransitioningPropertyValues)}possiblyEvaluate(g,S,W){const ut=new tm(this._properties);for(const Ht of Object.keys(this._values))ut._values[Ht]=this._values[Ht].possiblyEvaluate(g,S,W);return ut}hasTransition(){for(const g of Object.keys(this._values))if(this._values[g].prior)return!0;return!1}}class iv{constructor(g){this._properties=g,this._values=Object.create(g.defaultPropertyValues)}getValue(g){return il(this._values[g].value)}setValue(g,S){this._values[g]=new rv(this._values[g].property,S===null?void 0:il(S))}serialize(){const g={};for(const S of Object.keys(this._values)){const W=this.getValue(S);W!==void 0&&(g[S]=W)}return g}possiblyEvaluate(g,S,W){const ut=new tm(this._properties);for(const Ht of Object.keys(this._values))ut._values[Ht]=this._values[Ht].possiblyEvaluate(g,S,W);return ut}}class Xm{constructor(g,S,W){this.property=g,this.value=S,this.parameters=W}isConstant(){return this.value.kind==="constant"}constantOr(g){return this.value.kind==="constant"?this.value.value:g}evaluate(g,S,W,ut){return this.property.evaluate(this.value,this.parameters,g,S,W,ut)}}class tm{constructor(g){this._properties=g,this._values=Object.create(g.defaultPossiblyEvaluatedValues)}get(g){return this._values[g]}}class Nd{constructor(g){this.specification=g}possiblyEvaluate(g,S){if(g.isDataDriven())throw new Error("Value should not be data driven");return g.expression.evaluate(S)}interpolate(g,S,W){const ut=Km[this.specification.type];return ut?ut(g,S,W):g}}class Kd{constructor(g,S){this.specification=g,this.overrides=S}possiblyEvaluate(g,S,W,ut){return new Xm(this,g.expression.kind==="constant"||g.expression.kind==="camera"?{kind:"constant",value:g.expression.evaluate(S,null,{},W,ut)}:g.expression,S)}interpolate(g,S,W){if(g.value.kind!=="constant"||S.value.kind!=="constant")return g;if(g.value.value===void 0||S.value.value===void 0)return new Xm(this,{kind:"constant",value:void 0},g.parameters);const ut=Km[this.specification.type];if(ut){const Ht=ut(g.value.value,S.value.value,W);return new Xm(this,{kind:"constant",value:Ht},g.parameters)}return g}evaluate(g,S,W,ut,Ht,Jt){return g.kind==="constant"?g.value:g.evaluate(S,W,ut,Ht,Jt)}}class nv extends Kd{possiblyEvaluate(g,S,W,ut){if(g.value===void 0)return new Xm(this,{kind:"constant",value:void 0},S);if(g.expression.kind==="constant"){const Ht=g.expression.evaluate(S,null,{},W,ut),Jt=g.property.specification.type==="resolvedImage"&&typeof Ht!="string"?Ht.name:Ht,In=this._calculate(Jt,Jt,Jt,S);return new Xm(this,{kind:"constant",value:In},S)}if(g.expression.kind==="camera"){const Ht=this._calculate(g.expression.evaluate({zoom:S.zoom-1}),g.expression.evaluate({zoom:S.zoom}),g.expression.evaluate({zoom:S.zoom+1}),S);return new Xm(this,{kind:"constant",value:Ht},S)}return new Xm(this,g.expression,S)}evaluate(g,S,W,ut,Ht,Jt){if(g.kind==="source"){const In=g.evaluate(S,W,ut,Ht,Jt);return this._calculate(In,In,In,S)}return g.kind==="composite"?this._calculate(g.evaluate({zoom:Math.floor(S.zoom)-1},W,ut),g.evaluate({zoom:Math.floor(S.zoom)},W,ut),g.evaluate({zoom:Math.floor(S.zoom)+1},W,ut),S):g.value}_calculate(g,S,W,ut){return ut.zoom>ut.zoomHistory.lastIntegerZoom?{from:g,to:S}:{from:W,to:S}}interpolate(g){return g}}class jv{constructor(g){this.specification=g}possiblyEvaluate(g,S,W,ut){if(g.value!==void 0){if(g.expression.kind==="constant"){const Ht=g.expression.evaluate(S,null,{},W,ut);return this._calculate(Ht,Ht,Ht,S)}return this._calculate(g.expression.evaluate(new Eg(Math.floor(S.zoom-1),S)),g.expression.evaluate(new Eg(Math.floor(S.zoom),S)),g.expression.evaluate(new Eg(Math.floor(S.zoom+1),S)),S)}}_calculate(g,S,W,ut){return ut.zoom>ut.zoomHistory.lastIntegerZoom?{from:g,to:S}:{from:W,to:S}}interpolate(g){return g}}class tx{constructor(g){this.specification=g}possiblyEvaluate(g,S,W,ut){return!!g.expression.evaluate(S,null,{},W,ut)}interpolate(){return!1}}class Am{constructor(g){this.properties=g,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const S in g){const W=g[S];W.specification.overridable&&this.overridableProperties.push(S);const ut=this.defaultPropertyValues[S]=new rv(W,void 0),Ht=this.defaultTransitionablePropertyValues[S]=new Uv(W);this.defaultTransitioningPropertyValues[S]=Ht.untransitioned(),this.defaultPossiblyEvaluatedValues[S]=ut.possiblyEvaluate({})}}}Td("DataDrivenProperty",Kd),Td("DataConstantProperty",Nd),Td("CrossFadedDataDrivenProperty",nv),Td("CrossFadedProperty",jv),Td("ColorRampProperty",tx);const ov="-transition";class xy extends Id{constructor(g,S){if(super(),this.id=g.id,this.type=g.type,this._featureFilter={filter:()=>!0,needGeometry:!1},g.type!=="custom"&&(this.metadata=g.metadata,this.minzoom=g.minzoom,this.maxzoom=g.maxzoom,g.type!=="background"&&(this.source=g.source,this.sourceLayer=g["source-layer"],this.filter=g.filter),S.layout&&(this._unevaluatedLayout=new iv(S.layout)),S.paint)){this._transitionablePaint=new fd(S.paint);for(const W in g.paint)this.setPaintProperty(W,g.paint[W],{validate:!1});for(const W in g.layout)this.setLayoutProperty(W,g.layout[W],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new tm(S.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(g){return g==="visibility"?this.visibility:this._unevaluatedLayout.getValue(g)}setLayoutProperty(g,S,W={}){S!=null&&this._validate(bw,`layers.${this.id}.layout.${g}`,g,S,W)||(g!=="visibility"?this._unevaluatedLayout.setValue(g,S):this.visibility=S)}getPaintProperty(g){return g.endsWith(ov)?this._transitionablePaint.getTransition(g.slice(0,-11)):this._transitionablePaint.getValue(g)}setPaintProperty(g,S,W={}){if(S!=null&&this._validate(ww,`layers.${this.id}.paint.${g}`,g,S,W))return!1;if(g.endsWith(ov))return this._transitionablePaint.setTransition(g.slice(0,-11),S||void 0),!1;{const ut=this._transitionablePaint._values[g],Ht=ut.property.specification["property-type"]==="cross-faded-data-driven",Jt=ut.value.isDataDriven(),In=ut.value;this._transitionablePaint.setValue(g,S),this._handleSpecialPaintPropertyUpdate(g);const So=this._transitionablePaint._values[g].value;return So.isDataDriven()||Jt||Ht||this._handleOverridablePaintPropertyUpdate(g,In,So)}}_handleSpecialPaintPropertyUpdate(g){}_handleOverridablePaintPropertyUpdate(g,S,W){return!1}isHidden(g){return!!(this.minzoom&&g<this.minzoom)||!!(this.maxzoom&&g>=this.maxzoom)||this.visibility==="none"}updateTransitions(g){this._transitioningPaint=this._transitionablePaint.transitioned(g,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(g,S){g.getCrossfadeParameters&&(this._crossfadeParameters=g.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(g,void 0,S)),this.paint=this._transitioningPaint.possiblyEvaluate(g,void 0,S)}serialize(){const g={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(g.layout=g.layout||{},g.layout.visibility=this.visibility),ml(g,(S,W)=>!(S===void 0||W==="layout"&&!Object.keys(S).length||W==="paint"&&!Object.keys(S).length))}_validate(g,S,W,ut,Ht={}){return(!Ht||Ht.validate!==!1)&&kv(this,g.call(y_,{key:S,layerType:this.type,objectKey:W,value:ut,styleSpec:Yh,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const g in this.paint._values){const S=this.paint.get(g);if(S instanceof Xm&&g_(S.property.specification)&&(S.value.kind==="source"||S.value.kind==="composite")&&S.value.isStateDependent)return!0}return!1}}const Cw={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class By{constructor(g,S){this._structArray=g,this._pos1=S*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Pg{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(g,S){return g._trim(),S&&(g.isTransferred=!0,S.push(g.arrayBuffer)),{length:g.length,arrayBuffer:g.arrayBuffer}}static deserialize(g){const S=Object.create(this.prototype);return S.arrayBuffer=g.arrayBuffer,S.length=g.length,S.capacity=g.arrayBuffer.byteLength/S.bytesPerElement,S._refreshViews(),S}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(g){this.reserve(g),this.length=g}reserve(g){if(g>this.capacity){this.capacity=Math.max(g,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const S=this.uint8;this._refreshViews(),S&&this.uint8.set(S)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Jg(x,g=1){let S=0,W=0;return{members:x.map(ut=>{const Ht=Cw[ut.type].BYTES_PER_ELEMENT,Jt=S=rx(S,Math.max(g,Ht)),In=ut.components||1;return W=Math.max(W,Ht),S+=Ht*In,{name:ut.name,type:ut.type,components:In,offset:Jt}}),size:rx(S,Math.max(W,g)),alignment:g}}function rx(x,g){return Math.ceil(x/g)*g}class b_ extends Pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(g,S){const W=this.length;return this.resize(W+1),this.emplace(W,g,S)}emplace(g,S,W){const ut=2*g;return this.int16[ut+0]=S,this.int16[ut+1]=W,g}}b_.prototype.bytesPerElement=4,Td("StructArrayLayout2i4",b_);class sv extends Pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(g,S,W){const ut=this.length;return this.resize(ut+1),this.emplace(ut,g,S,W)}emplace(g,S,W,ut){const Ht=3*g;return this.int16[Ht+0]=S,this.int16[Ht+1]=W,this.int16[Ht+2]=ut,g}}sv.prototype.bytesPerElement=6,Td("StructArrayLayout3i6",sv);class av extends Pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(g,S,W,ut){const Ht=this.length;return this.resize(Ht+1),this.emplace(Ht,g,S,W,ut)}emplace(g,S,W,ut,Ht){const Jt=4*g;return this.int16[Jt+0]=S,this.int16[Jt+1]=W,this.int16[Jt+2]=ut,this.int16[Jt+3]=Ht,g}}av.prototype.bytesPerElement=8,Td("StructArrayLayout4i8",av);class Ym extends Pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(g,S,W,ut,Ht,Jt){const In=this.length;return this.resize(In+1),this.emplace(In,g,S,W,ut,Ht,Jt)}emplace(g,S,W,ut,Ht,Jt,In){const So=6*g;return this.int16[So+0]=S,this.int16[So+1]=W,this.int16[So+2]=ut,this.int16[So+3]=Ht,this.int16[So+4]=Jt,this.int16[So+5]=In,g}}Ym.prototype.bytesPerElement=12,Td("StructArrayLayout2i4i12",Ym);class Hv extends Pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(g,S,W,ut,Ht,Jt){const In=this.length;return this.resize(In+1),this.emplace(In,g,S,W,ut,Ht,Jt)}emplace(g,S,W,ut,Ht,Jt,In){const So=4*g,al=8*g;return this.int16[So+0]=S,this.int16[So+1]=W,this.uint8[al+4]=ut,this.uint8[al+5]=Ht,this.uint8[al+6]=Jt,this.uint8[al+7]=In,g}}Hv.prototype.bytesPerElement=8,Td("StructArrayLayout2i4ub8",Hv);class C_ extends Pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(g,S){const W=this.length;return this.resize(W+1),this.emplace(W,g,S)}emplace(g,S,W){const ut=2*g;return this.float32[ut+0]=S,this.float32[ut+1]=W,g}}C_.prototype.bytesPerElement=8,Td("StructArrayLayout2f8",C_);class Wv extends Pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(g,S,W,ut,Ht,Jt,In,So,al,hl){const eh=this.length;return this.resize(eh+1),this.emplace(eh,g,S,W,ut,Ht,Jt,In,So,al,hl)}emplace(g,S,W,ut,Ht,Jt,In,So,al,hl,eh){const ah=10*g;return this.uint16[ah+0]=S,this.uint16[ah+1]=W,this.uint16[ah+2]=ut,this.uint16[ah+3]=Ht,this.uint16[ah+4]=Jt,this.uint16[ah+5]=In,this.uint16[ah+6]=So,this.uint16[ah+7]=al,this.uint16[ah+8]=hl,this.uint16[ah+9]=eh,g}}Wv.prototype.bytesPerElement=20,Td("StructArrayLayout10ui20",Wv);class qv extends Pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(g,S,W,ut,Ht,Jt,In,So,al,hl,eh,ah){const ch=this.length;return this.resize(ch+1),this.emplace(ch,g,S,W,ut,Ht,Jt,In,So,al,hl,eh,ah)}emplace(g,S,W,ut,Ht,Jt,In,So,al,hl,eh,ah,ch){const dh=12*g;return this.int16[dh+0]=S,this.int16[dh+1]=W,this.int16[dh+2]=ut,this.int16[dh+3]=Ht,this.uint16[dh+4]=Jt,this.uint16[dh+5]=In,this.uint16[dh+6]=So,this.uint16[dh+7]=al,this.int16[dh+8]=hl,this.int16[dh+9]=eh,this.int16[dh+10]=ah,this.int16[dh+11]=ch,g}}qv.prototype.bytesPerElement=24,Td("StructArrayLayout4i4ui4i24",qv);class zy extends Pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(g,S,W){const ut=this.length;return this.resize(ut+1),this.emplace(ut,g,S,W)}emplace(g,S,W,ut){const Ht=3*g;return this.float32[Ht+0]=S,this.float32[Ht+1]=W,this.float32[Ht+2]=ut,g}}zy.prototype.bytesPerElement=12,Td("StructArrayLayout3f12",zy);class lv extends Pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(g){const S=this.length;return this.resize(S+1),this.emplace(S,g)}emplace(g,S){return this.uint32[1*g+0]=S,g}}lv.prototype.bytesPerElement=4,Td("StructArrayLayout1ul4",lv);class E_ extends Pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(g,S,W,ut,Ht,Jt,In,So,al){const hl=this.length;return this.resize(hl+1),this.emplace(hl,g,S,W,ut,Ht,Jt,In,So,al)}emplace(g,S,W,ut,Ht,Jt,In,So,al,hl){const eh=10*g,ah=5*g;return this.int16[eh+0]=S,this.int16[eh+1]=W,this.int16[eh+2]=ut,this.int16[eh+3]=Ht,this.int16[eh+4]=Jt,this.int16[eh+5]=In,this.uint32[ah+3]=So,this.uint16[eh+8]=al,this.uint16[eh+9]=hl,g}}E_.prototype.bytesPerElement=20,Td("StructArrayLayout6i1ul2ui20",E_);class Ax extends Pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(g,S,W,ut,Ht,Jt){const In=this.length;return this.resize(In+1),this.emplace(In,g,S,W,ut,Ht,Jt)}emplace(g,S,W,ut,Ht,Jt,In){const So=6*g;return this.int16[So+0]=S,this.int16[So+1]=W,this.int16[So+2]=ut,this.int16[So+3]=Ht,this.int16[So+4]=Jt,this.int16[So+5]=In,g}}Ax.prototype.bytesPerElement=12,Td("StructArrayLayout2i2i2i12",Ax);class v0 extends Pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(g,S,W,ut,Ht){const Jt=this.length;return this.resize(Jt+1),this.emplace(Jt,g,S,W,ut,Ht)}emplace(g,S,W,ut,Ht,Jt){const In=4*g,So=8*g;return this.float32[In+0]=S,this.float32[In+1]=W,this.float32[In+2]=ut,this.int16[So+6]=Ht,this.int16[So+7]=Jt,g}}v0.prototype.bytesPerElement=16,Td("StructArrayLayout2f1f2i16",v0);class i_ extends Pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(g,S,W,ut){const Ht=this.length;return this.resize(Ht+1),this.emplace(Ht,g,S,W,ut)}emplace(g,S,W,ut,Ht){const Jt=12*g,In=3*g;return this.uint8[Jt+0]=S,this.uint8[Jt+1]=W,this.float32[In+1]=ut,this.float32[In+2]=Ht,g}}i_.prototype.bytesPerElement=12,Td("StructArrayLayout2ub2f12",i_);class x0 extends Pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(g,S,W){const ut=this.length;return this.resize(ut+1),this.emplace(ut,g,S,W)}emplace(g,S,W,ut){const Ht=3*g;return this.uint16[Ht+0]=S,this.uint16[Ht+1]=W,this.uint16[Ht+2]=ut,g}}x0.prototype.bytesPerElement=6,Td("StructArrayLayout3ui6",x0);class ix extends Pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(g,S,W,ut,Ht,Jt,In,So,al,hl,eh,ah,ch,dh,Dh,Ph,Xh){const Qh=this.length;return this.resize(Qh+1),this.emplace(Qh,g,S,W,ut,Ht,Jt,In,So,al,hl,eh,ah,ch,dh,Dh,Ph,Xh)}emplace(g,S,W,ut,Ht,Jt,In,So,al,hl,eh,ah,ch,dh,Dh,Ph,Xh,Qh){const qh=24*g,lp=12*g,dp=48*g;return this.int16[qh+0]=S,this.int16[qh+1]=W,this.uint16[qh+2]=ut,this.uint16[qh+3]=Ht,this.uint32[lp+2]=Jt,this.uint32[lp+3]=In,this.uint32[lp+4]=So,this.uint16[qh+10]=al,this.uint16[qh+11]=hl,this.uint16[qh+12]=eh,this.float32[lp+7]=ah,this.float32[lp+8]=ch,this.uint8[dp+36]=dh,this.uint8[dp+37]=Dh,this.uint8[dp+38]=Ph,this.uint32[lp+10]=Xh,this.int16[qh+22]=Qh,g}}ix.prototype.bytesPerElement=48,Td("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ix);class fm extends Pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(g,S,W,ut,Ht,Jt,In,So,al,hl,eh,ah,ch,dh,Dh,Ph,Xh,Qh,qh,lp,dp,Mp,Md,bd,_d,hd,ld,Sd){const vd=this.length;return this.resize(vd+1),this.emplace(vd,g,S,W,ut,Ht,Jt,In,So,al,hl,eh,ah,ch,dh,Dh,Ph,Xh,Qh,qh,lp,dp,Mp,Md,bd,_d,hd,ld,Sd)}emplace(g,S,W,ut,Ht,Jt,In,So,al,hl,eh,ah,ch,dh,Dh,Ph,Xh,Qh,qh,lp,dp,Mp,Md,bd,_d,hd,ld,Sd,vd){const Jp=34*g,Xd=17*g;return this.int16[Jp+0]=S,this.int16[Jp+1]=W,this.int16[Jp+2]=ut,this.int16[Jp+3]=Ht,this.int16[Jp+4]=Jt,this.int16[Jp+5]=In,this.int16[Jp+6]=So,this.int16[Jp+7]=al,this.uint16[Jp+8]=hl,this.uint16[Jp+9]=eh,this.uint16[Jp+10]=ah,this.uint16[Jp+11]=ch,this.uint16[Jp+12]=dh,this.uint16[Jp+13]=Dh,this.uint16[Jp+14]=Ph,this.uint16[Jp+15]=Xh,this.uint16[Jp+16]=Qh,this.uint16[Jp+17]=qh,this.uint16[Jp+18]=lp,this.uint16[Jp+19]=dp,this.uint16[Jp+20]=Mp,this.uint16[Jp+21]=Md,this.uint16[Jp+22]=bd,this.uint32[Xd+12]=_d,this.float32[Xd+13]=hd,this.float32[Xd+14]=ld,this.float32[Xd+15]=Sd,this.float32[Xd+16]=vd,g}}fm.prototype.bytesPerElement=68,Td("StructArrayLayout8i15ui1ul4f68",fm);class nx extends Pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(g){const S=this.length;return this.resize(S+1),this.emplace(S,g)}emplace(g,S){return this.float32[1*g+0]=S,g}}nx.prototype.bytesPerElement=4,Td("StructArrayLayout1f4",nx);class w0 extends Pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(g,S,W){const ut=this.length;return this.resize(ut+1),this.emplace(ut,g,S,W)}emplace(g,S,W,ut){const Ht=4*g;return this.uint32[2*g+0]=S,this.uint16[Ht+2]=W,this.uint16[Ht+3]=ut,g}}w0.prototype.bytesPerElement=8,Td("StructArrayLayout1ul2ui8",w0);class ot extends Pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(g,S){const W=this.length;return this.resize(W+1),this.emplace(W,g,S)}emplace(g,S,W){const ut=2*g;return this.uint16[ut+0]=S,this.uint16[ut+1]=W,g}}ot.prototype.bytesPerElement=4,Td("StructArrayLayout2ui4",ot);class m extends Pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(g){const S=this.length;return this.resize(S+1),this.emplace(S,g)}emplace(g,S){return this.uint16[1*g+0]=S,g}}m.prototype.bytesPerElement=2,Td("StructArrayLayout1ui2",m);class D extends Pg{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(g,S,W,ut){const Ht=this.length;return this.resize(Ht+1),this.emplace(Ht,g,S,W,ut)}emplace(g,S,W,ut,Ht){const Jt=4*g;return this.float32[Jt+0]=S,this.float32[Jt+1]=W,this.float32[Jt+2]=ut,this.float32[Jt+3]=Ht,g}}D.prototype.bytesPerElement=16,Td("StructArrayLayout4f16",D);class Ee extends By{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new L(this.anchorPointX,this.anchorPointY)}}Ee.prototype.size=20;class ct extends E_{get(g){return new Ee(this,g)}}Td("CollisionBoxArray",ct);class or extends By{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(g){this._structArray.uint8[this._pos1+37]=g}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(g){this._structArray.uint8[this._pos1+38]=g}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(g){this._structArray.uint32[this._pos4+10]=g}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}or.prototype.size=48;class kn extends ix{get(g){return new or(this,g)}}Td("PlacedSymbolArray",kn);class ds extends By{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(g){this._structArray.uint32[this._pos4+12]=g}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}ds.prototype.size=68;class ps extends fm{get(g){return new ds(this,g)}}Td("SymbolInstanceArray",ps);class vs extends nx{getoffsetX(g){return this.float32[1*g+0]}}Td("GlyphOffsetArray",vs);class fl extends sv{getx(g){return this.int16[3*g+0]}gety(g){return this.int16[3*g+1]}gettileUnitDistanceFromAnchor(g){return this.int16[3*g+2]}}Td("SymbolLineVertexArray",fl);class pl extends By{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}pl.prototype.size=8;class ph extends w0{get(g){return new pl(this,g)}}Td("FeatureIndexArray",ph);class Ah extends b_{}class hh extends b_{}class Rh extends b_{}class Gh extends Ym{}class Kh extends Hv{}class ap extends C_{}class Lh extends Wv{}class op extends qv{}class yp extends zy{}class Np extends lv{}class jp extends Ax{}class td extends i_{}class Vp extends x0{}class gd extends ot{}const F=Jg([{name:"a_pos",components:2,type:"Int16"}],4),{members:f}=F;class T{constructor(g=[]){this.segments=g}prepareSegment(g,S,W,ut){let Ht=this.segments[this.segments.length-1];return g>T.MAX_VERTEX_ARRAY_LENGTH&&ol(`Max vertices per segment is ${T.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${g}`),(!Ht||Ht.vertexLength+g>T.MAX_VERTEX_ARRAY_LENGTH||Ht.sortKey!==ut)&&(Ht={vertexOffset:S.length,primitiveOffset:W.length,vertexLength:0,primitiveLength:0},ut!==void 0&&(Ht.sortKey=ut),this.segments.push(Ht)),Ht}get(){return this.segments}destroy(){for(const g of this.segments)for(const S in g.vaos)g.vaos[S].destroy()}static simpleSegment(g,S,W,ut){return new T([{vertexOffset:g,primitiveOffset:S,vertexLength:W,primitiveLength:ut,vaos:{},sortKey:0}])}}function X(x,g){return 256*(x=yi(Math.floor(x),0,255))+yi(Math.floor(g),0,255)}T.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Td("SegmentVector",T);const Ve=Jg([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var kt={exports:{}},Hr={exports:{}};Hr.exports=function(x,g){var S,W,ut,Ht,Jt,In,So,al;for(W=x.length-(S=3&x.length),ut=g,Jt=3432918353,In=461845907,al=0;al<W;)So=255&x.charCodeAt(al)|(255&x.charCodeAt(++al))<<8|(255&x.charCodeAt(++al))<<16|(255&x.charCodeAt(++al))<<24,++al,ut=27492+(65535&(Ht=5*(65535&(ut=(ut^=So=(65535&(So=(So=(65535&So)*Jt+(((So>>>16)*Jt&65535)<<16)&4294967295)<<15|So>>>17))*In+(((So>>>16)*In&65535)<<16)&4294967295)<<13|ut>>>19))+((5*(ut>>>16)&65535)<<16)&4294967295))+((58964+(Ht>>>16)&65535)<<16);switch(So=0,S){case 3:So^=(255&x.charCodeAt(al+2))<<16;case 2:So^=(255&x.charCodeAt(al+1))<<8;case 1:ut^=So=(65535&(So=(So=(65535&(So^=255&x.charCodeAt(al)))*Jt+(((So>>>16)*Jt&65535)<<16)&4294967295)<<15|So>>>17))*In+(((So>>>16)*In&65535)<<16)&4294967295}return ut^=x.length,ut=2246822507*(65535&(ut^=ut>>>16))+((2246822507*(ut>>>16)&65535)<<16)&4294967295,ut=3266489909*(65535&(ut^=ut>>>13))+((3266489909*(ut>>>16)&65535)<<16)&4294967295,(ut^=ut>>>16)>>>0};var pi=Hr.exports,Vn={exports:{}};Vn.exports=function(x,g){for(var S,W=x.length,ut=g^W,Ht=0;W>=4;)S=1540483477*(65535&(S=255&x.charCodeAt(Ht)|(255&x.charCodeAt(++Ht))<<8|(255&x.charCodeAt(++Ht))<<16|(255&x.charCodeAt(++Ht))<<24))+((1540483477*(S>>>16)&65535)<<16),ut=1540483477*(65535&ut)+((1540483477*(ut>>>16)&65535)<<16)^(S=1540483477*(65535&(S^=S>>>24))+((1540483477*(S>>>16)&65535)<<16)),W-=4,++Ht;switch(W){case 3:ut^=(255&x.charCodeAt(Ht+2))<<16;case 2:ut^=(255&x.charCodeAt(Ht+1))<<8;case 1:ut=1540483477*(65535&(ut^=255&x.charCodeAt(Ht)))+((1540483477*(ut>>>16)&65535)<<16)}return ut=1540483477*(65535&(ut^=ut>>>13))+((1540483477*(ut>>>16)&65535)<<16),(ut^=ut>>>15)>>>0};var oa=pi,sa=Vn.exports;kt.exports=oa,kt.exports.murmur3=oa,kt.exports.murmur2=sa;var dl=h(kt.exports);class lh{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(g,S,W,ut){this.ids.push(gh(g)),this.positions.push(S,W,ut)}getPositions(g){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const S=gh(g);let W=0,ut=this.ids.length-1;for(;W<ut;){const Jt=W+ut>>1;this.ids[Jt]>=S?ut=Jt:W=Jt+1}const Ht=[];for(;this.ids[W]===S;)Ht.push({index:this.positions[3*W],start:this.positions[3*W+1],end:this.positions[3*W+2]}),W++;return Ht}static serialize(g,S){const W=new Float64Array(g.ids),ut=new Uint32Array(g.positions);return _h(W,ut,0,W.length-1),S&&S.push(W.buffer,ut.buffer),{ids:W,positions:ut}}static deserialize(g){const S=new lh;return S.ids=g.ids,S.positions=g.positions,S.indexed=!0,S}}function gh(x){const g=+x;return!isNaN(g)&&g<=Number.MAX_SAFE_INTEGER?g:dl(String(x))}function _h(x,g,S,W){for(;S<W;){const ut=x[S+W>>1];let Ht=S-1,Jt=W+1;for(;;){do Ht++;while(x[Ht]<ut);do Jt--;while(x[Jt]>ut);if(Ht>=Jt)break;yh(x,Ht,Jt),yh(g,3*Ht,3*Jt),yh(g,3*Ht+1,3*Jt+1),yh(g,3*Ht+2,3*Jt+2)}Jt-S<W-Jt?(_h(x,g,S,Jt),S=Jt+1):(_h(x,g,Jt+1,W),W=Jt)}}function yh(x,g,S){const W=x[g];x[g]=x[S],x[S]=W}Td("FeaturePositionMap",lh);class xh{constructor(g,S){this.gl=g.gl,this.location=S}}class yl extends xh{constructor(g,S){super(g,S),this.current=0}set(g){this.current!==g&&(this.current=g,this.gl.uniform1f(this.location,g))}}class mh extends xh{constructor(g,S){super(g,S),this.current=[0,0,0,0]}set(g){g[0]===this.current[0]&&g[1]===this.current[1]&&g[2]===this.current[2]&&g[3]===this.current[3]||(this.current=g,this.gl.uniform4f(this.location,g[0],g[1],g[2],g[3]))}}class bh extends xh{constructor(g,S){super(g,S),this.current=Yd.transparent}set(g){g.r===this.current.r&&g.g===this.current.g&&g.b===this.current.b&&g.a===this.current.a||(this.current=g,this.gl.uniform4f(this.location,g.r,g.g,g.b,g.a))}}const Sh=new Float32Array(16);function Nh(x){return[X(255*x.r,255*x.g),X(255*x.b,255*x.a)]}class $h{constructor(g,S,W){this.value=g,this.uniformNames=S.map(ut=>`u_${ut}`),this.type=W}setUniform(g,S,W){g.set(W.constantOr(this.value))}getBinding(g,S,W){return this.type==="color"?new bh(g,S):new yl(g,S)}}class Vh{constructor(g,S){this.uniformNames=S.map(W=>`u_${W}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(g,S){this.pixelRatioFrom=S.pixelRatio,this.pixelRatioTo=g.pixelRatio,this.patternFrom=S.tlbr,this.patternTo=g.tlbr}setUniform(g,S,W,ut){const Ht=ut==="u_pattern_to"?this.patternTo:ut==="u_pattern_from"?this.patternFrom:ut==="u_pixel_ratio_to"?this.pixelRatioTo:ut==="u_pixel_ratio_from"?this.pixelRatioFrom:null;Ht&&g.set(Ht)}getBinding(g,S,W){return W.substr(0,9)==="u_pattern"?new mh(g,S):new yl(g,S)}}class Wh{constructor(g,S,W,ut){this.expression=g,this.type=W,this.maxValue=0,this.paintVertexAttributes=S.map(Ht=>({name:`a_${Ht}`,type:"Float32",components:W==="color"?2:1,offset:0})),this.paintVertexArray=new ut}populatePaintArray(g,S,W,ut,Ht){const Jt=this.paintVertexArray.length,In=this.expression.evaluate(new Eg(0),S,{},ut,[],Ht);this.paintVertexArray.resize(g),this._setPaintValue(Jt,g,In)}updatePaintArray(g,S,W,ut){const Ht=this.expression.evaluate({zoom:0},W,ut);this._setPaintValue(g,S,Ht)}_setPaintValue(g,S,W){if(this.type==="color"){const ut=Nh(W);for(let Ht=g;Ht<S;Ht++)this.paintVertexArray.emplace(Ht,ut[0],ut[1])}else{for(let ut=g;ut<S;ut++)this.paintVertexArray.emplace(ut,W);this.maxValue=Math.max(this.maxValue,Math.abs(W))}}upload(g){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=g.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Zh{constructor(g,S,W,ut,Ht,Jt){this.expression=g,this.uniformNames=S.map(In=>`u_${In}_t`),this.type=W,this.useIntegerZoom=ut,this.zoom=Ht,this.maxValue=0,this.paintVertexAttributes=S.map(In=>({name:`a_${In}`,type:"Float32",components:W==="color"?4:2,offset:0})),this.paintVertexArray=new Jt}populatePaintArray(g,S,W,ut,Ht){const Jt=this.expression.evaluate(new Eg(this.zoom),S,{},ut,[],Ht),In=this.expression.evaluate(new Eg(this.zoom+1),S,{},ut,[],Ht),So=this.paintVertexArray.length;this.paintVertexArray.resize(g),this._setPaintValue(So,g,Jt,In)}updatePaintArray(g,S,W,ut){const Ht=this.expression.evaluate({zoom:this.zoom},W,ut),Jt=this.expression.evaluate({zoom:this.zoom+1},W,ut);this._setPaintValue(g,S,Ht,Jt)}_setPaintValue(g,S,W,ut){if(this.type==="color"){const Ht=Nh(W),Jt=Nh(ut);for(let In=g;In<S;In++)this.paintVertexArray.emplace(In,Ht[0],Ht[1],Jt[0],Jt[1])}else{for(let Ht=g;Ht<S;Ht++)this.paintVertexArray.emplace(Ht,W,ut);this.maxValue=Math.max(this.maxValue,Math.abs(W),Math.abs(ut))}}upload(g){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=g.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(g,S){const W=this.useIntegerZoom?Math.floor(S.zoom):S.zoom,ut=yi(this.expression.interpolationFactor(W,this.zoom,this.zoom+1),0,1);g.set(ut)}getBinding(g,S,W){return new yl(g,S)}}class rp{constructor(g,S,W,ut,Ht,Jt){this.expression=g,this.type=S,this.useIntegerZoom=W,this.zoom=ut,this.layerId=Jt,this.zoomInPaintVertexArray=new Ht,this.zoomOutPaintVertexArray=new Ht}populatePaintArray(g,S,W){const ut=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(g),this.zoomOutPaintVertexArray.resize(g),this._setPaintValues(ut,g,S.patterns&&S.patterns[this.layerId],W)}updatePaintArray(g,S,W,ut,Ht){this._setPaintValues(g,S,W.patterns&&W.patterns[this.layerId],Ht)}_setPaintValues(g,S,W,ut){if(!ut||!W)return;const{min:Ht,mid:Jt,max:In}=W,So=ut[Ht],al=ut[Jt],hl=ut[In];if(So&&al&&hl)for(let eh=g;eh<S;eh++)this.zoomInPaintVertexArray.emplace(eh,al.tl[0],al.tl[1],al.br[0],al.br[1],So.tl[0],So.tl[1],So.br[0],So.br[1],al.pixelRatio,So.pixelRatio),this.zoomOutPaintVertexArray.emplace(eh,al.tl[0],al.tl[1],al.br[0],al.br[1],hl.tl[0],hl.tl[1],hl.br[0],hl.br[1],al.pixelRatio,hl.pixelRatio)}upload(g){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=g.createVertexBuffer(this.zoomInPaintVertexArray,Ve.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=g.createVertexBuffer(this.zoomOutPaintVertexArray,Ve.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Bp{constructor(g,S,W){this.binders={},this._buffers=[];const ut=[];for(const Ht in g.paint._values){if(!W(Ht))continue;const Jt=g.paint.get(Ht);if(!(Jt instanceof Xm&&g_(Jt.property.specification)))continue;const In=Tp(Ht,g.type),So=Jt.value,al=Jt.property.specification.type,hl=Jt.property.useIntegerZoom,eh=Jt.property.specification["property-type"],ah=eh==="cross-faded"||eh==="cross-faded-data-driven";if(So.kind==="constant")this.binders[Ht]=ah?new Vh(So.value,In):new $h(So.value,In,al),ut.push(`/u_${Ht}`);else if(So.kind==="source"||ah){const ch=pp(Ht,al,"source");this.binders[Ht]=ah?new rp(So,al,hl,S,ch,g.id):new Wh(So,In,al,ch),ut.push(`/a_${Ht}`)}else{const ch=pp(Ht,al,"composite");this.binders[Ht]=new Zh(So,In,al,hl,S,ch),ut.push(`/z_${Ht}`)}}this.cacheKey=ut.sort().join("")}getMaxValue(g){const S=this.binders[g];return S instanceof Wh||S instanceof Zh?S.maxValue:0}populatePaintArrays(g,S,W,ut,Ht){for(const Jt in this.binders){const In=this.binders[Jt];(In instanceof Wh||In instanceof Zh||In instanceof rp)&&In.populatePaintArray(g,S,W,ut,Ht)}}setConstantPatternPositions(g,S){for(const W in this.binders){const ut=this.binders[W];ut instanceof Vh&&ut.setConstantPatternPositions(g,S)}}updatePaintArrays(g,S,W,ut,Ht){let Jt=!1;for(const In in g){const So=S.getPositions(In);for(const al of So){const hl=W.feature(al.index);for(const eh in this.binders){const ah=this.binders[eh];if((ah instanceof Wh||ah instanceof Zh||ah instanceof rp)&&ah.expression.isStateDependent===!0){const ch=ut.paint.get(eh);ah.expression=ch.value,ah.updatePaintArray(al.start,al.end,hl,g[In],Ht),Jt=!0}}}}return Jt}defines(){const g=[];for(const S in this.binders){const W=this.binders[S];(W instanceof $h||W instanceof Vh)&&g.push(...W.uniformNames.map(ut=>`#define HAS_UNIFORM_${ut}`))}return g}getBinderAttributes(){const g=[];for(const S in this.binders){const W=this.binders[S];if(W instanceof Wh||W instanceof Zh)for(let ut=0;ut<W.paintVertexAttributes.length;ut++)g.push(W.paintVertexAttributes[ut].name);else if(W instanceof rp)for(let ut=0;ut<Ve.members.length;ut++)g.push(Ve.members[ut].name)}return g}getBinderUniforms(){const g=[];for(const S in this.binders){const W=this.binders[S];if(W instanceof $h||W instanceof Vh||W instanceof Zh)for(const ut of W.uniformNames)g.push(ut)}return g}getPaintVertexBuffers(){return this._buffers}getUniforms(g,S){const W=[];for(const ut in this.binders){const Ht=this.binders[ut];if(Ht instanceof $h||Ht instanceof Vh||Ht instanceof Zh){for(const Jt of Ht.uniformNames)if(S[Jt]){const In=Ht.getBinding(g,S[Jt],Jt);W.push({name:Jt,property:ut,binding:In})}}}return W}setUniforms(g,S,W,ut){for(const{name:Ht,property:Jt,binding:In}of S)this.binders[Jt].setUniform(In,ut,W.get(Jt),Ht)}updatePaintBuffers(g){this._buffers=[];for(const S in this.binders){const W=this.binders[S];if(g&&W instanceof rp){const ut=g.fromScale===2?W.zoomInPaintVertexBuffer:W.zoomOutPaintVertexBuffer;ut&&this._buffers.push(ut)}else(W instanceof Wh||W instanceof Zh)&&W.paintVertexBuffer&&this._buffers.push(W.paintVertexBuffer)}}upload(g){for(const S in this.binders){const W=this.binders[S];(W instanceof Wh||W instanceof Zh||W instanceof rp)&&W.upload(g)}this.updatePaintBuffers()}destroy(){for(const g in this.binders){const S=this.binders[g];(S instanceof Wh||S instanceof Zh||S instanceof rp)&&S.destroy()}}}class tp{constructor(g,S,W=()=>!0){this.programConfigurations={};for(const ut of g)this.programConfigurations[ut.id]=new Bp(ut,S,W);this.needsUpload=!1,this._featureMap=new lh,this._bufferOffset=0}populatePaintArrays(g,S,W,ut,Ht,Jt){for(const In in this.programConfigurations)this.programConfigurations[In].populatePaintArrays(g,S,ut,Ht,Jt);S.id!==void 0&&this._featureMap.add(S.id,W,this._bufferOffset,g),this._bufferOffset=g,this.needsUpload=!0}updatePaintArrays(g,S,W,ut){for(const Ht of W)this.needsUpload=this.programConfigurations[Ht.id].updatePaintArrays(g,this._featureMap,S,Ht,ut)||this.needsUpload}get(g){return this.programConfigurations[g]}upload(g){if(this.needsUpload){for(const S in this.programConfigurations)this.programConfigurations[S].upload(g);this.needsUpload=!1}}destroy(){for(const g in this.programConfigurations)this.programConfigurations[g].destroy()}}function Tp(x,g){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[x]||[x.replace(`${g}-`,"").replace(/-/g,"_")]}function pp(x,g,S){const W={color:{source:C_,composite:D},number:{source:nx,composite:C_}},ut=function(Ht){return{"line-pattern":{source:Lh,composite:Lh},"fill-pattern":{source:Lh,composite:Lh},"fill-extrusion-pattern":{source:Lh,composite:Lh}}[Ht]}(x);return ut&&ut[S]||W[g][S]}Td("ConstantBinder",$h),Td("CrossFadedConstantBinder",Vh),Td("SourceExpressionBinder",Wh),Td("CrossFadedCompositeBinder",rp),Td("CompositeExpressionBinder",Zh),Td("ProgramConfiguration",Bp,{omit:["_buffers"]}),Td("ProgramConfigurationSet",tp);var bp=8192;const np=Math.pow(2,14)-1,wp=-np-1;function Fp(x){const g=bp/x.extent,S=x.loadGeometry();for(let W=0;W<S.length;W++){const ut=S[W];for(let Ht=0;Ht<ut.length;Ht++){const Jt=ut[Ht],In=Math.round(Jt.x*g),So=Math.round(Jt.y*g);Jt.x=yi(In,wp,np),Jt.y=yi(So,wp,np),(In<Jt.x||In>Jt.x+1||So<Jt.y||So>Jt.y+1)&&ol("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return S}function Pp(x,g){return{type:x.type,id:x.id,properties:x.properties,geometry:g?Fp(x):[]}}function Up(x,g,S,W,ut){x.emplaceBack(2*g+(W+1)/2,2*S+(ut+1)/2)}class zd{constructor(g){this.zoom=g.zoom,this.overscaling=g.overscaling,this.layers=g.layers,this.layerIds=this.layers.map(S=>S.id),this.index=g.index,this.hasPattern=!1,this.layoutVertexArray=new hh,this.indexArray=new Vp,this.segments=new T,this.programConfigurations=new tp(g.layers,g.zoom),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id)}populate(g,S,W){const ut=this.layers[0],Ht=[];let Jt=null,In=!1;ut.type==="circle"&&(Jt=ut.layout.get("circle-sort-key"),In=!Jt.isConstant());for(const{feature:So,id:al,index:hl,sourceLayerIndex:eh}of g){const ah=this.layers[0]._featureFilter.needGeometry,ch=Pp(So,ah);if(!this.layers[0]._featureFilter.filter(new Eg(this.zoom),ch,W))continue;const dh=In?Jt.evaluate(ch,{},W):void 0,Dh={id:al,properties:So.properties,type:So.type,sourceLayerIndex:eh,index:hl,geometry:ah?ch.geometry:Fp(So),patterns:{},sortKey:dh};Ht.push(Dh)}In&&Ht.sort((So,al)=>So.sortKey-al.sortKey);for(const So of Ht){const{geometry:al,index:hl,sourceLayerIndex:eh}=So,ah=g[hl].feature;this.addFeature(So,al,hl,W),S.featureIndex.insert(ah,al,hl,eh,this.index)}}update(g,S,W){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(g,S,this.stateDependentLayers,W)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(g){this.uploaded||(this.layoutVertexBuffer=g.createVertexBuffer(this.layoutVertexArray,f),this.indexBuffer=g.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(g),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(g,S,W,ut){for(const Ht of S)for(const Jt of Ht){const In=Jt.x,So=Jt.y;if(In<0||In>=bp||So<0||So>=bp)continue;const al=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,g.sortKey),hl=al.vertexLength;Up(this.layoutVertexArray,In,So,-1,-1),Up(this.layoutVertexArray,In,So,1,-1),Up(this.layoutVertexArray,In,So,1,1),Up(this.layoutVertexArray,In,So,-1,1),this.indexArray.emplaceBack(hl,hl+1,hl+2),this.indexArray.emplaceBack(hl,hl+3,hl+2),al.vertexLength+=4,al.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,g,W,{},ut)}}function jf(x,g){for(let S=0;S<x.length;S++)if(gg(g,x[S]))return!0;for(let S=0;S<g.length;S++)if(gg(x,g[S]))return!0;return!!Jf(x,g)}function Pd(x,g,S){return!!gg(x,g)||!!fg(g,x,S)}function Zd(x,g){if(x.length===1)return Tg(g,x[0]);for(let S=0;S<g.length;S++){const W=g[S];for(let ut=0;ut<W.length;ut++)if(gg(x,W[ut]))return!0}for(let S=0;S<x.length;S++)if(Tg(g,x[S]))return!0;for(let S=0;S<g.length;S++)if(Jf(x,g[S]))return!0;return!1}function ig(x,g,S){if(x.length>1){if(Jf(x,g))return!0;for(let W=0;W<g.length;W++)if(fg(g[W],x,S))return!0}for(let W=0;W<x.length;W++)if(fg(x[W],g,S))return!0;return!1}function Jf(x,g){if(x.length===0||g.length===0)return!1;for(let S=0;S<x.length-1;S++){const W=x[S],ut=x[S+1];for(let Ht=0;Ht<g.length-1;Ht++)if(Bd(W,ut,g[Ht],g[Ht+1]))return!0}return!1}function Bd(x,g,S,W){return _l(x,S,W)!==_l(g,S,W)&&_l(x,g,S)!==_l(x,g,W)}function fg(x,g,S){const W=S*S;if(g.length===1)return x.distSqr(g[0])<W;for(let ut=1;ut<g.length;ut++)if(Sg(x,g[ut-1],g[ut])<W)return!0;return!1}function Sg(x,g,S){const W=g.distSqr(S);if(W===0)return x.distSqr(g);const ut=((x.x-g.x)*(S.x-g.x)+(x.y-g.y)*(S.y-g.y))/W;return x.distSqr(ut<0?g:ut>1?S:S.sub(g)._mult(ut)._add(g))}function Tg(x,g){let S,W,ut,Ht=!1;for(let Jt=0;Jt<x.length;Jt++){S=x[Jt];for(let In=0,So=S.length-1;In<S.length;So=In++)W=S[In],ut=S[So],W.y>g.y!=ut.y>g.y&&g.x<(ut.x-W.x)*(g.y-W.y)/(ut.y-W.y)+W.x&&(Ht=!Ht)}return Ht}function gg(x,g){let S=!1;for(let W=0,ut=x.length-1;W<x.length;ut=W++){const Ht=x[W],Jt=x[ut];Ht.y>g.y!=Jt.y>g.y&&g.x<(Jt.x-Ht.x)*(g.y-Ht.y)/(Jt.y-Ht.y)+Ht.x&&(S=!S)}return S}function Jm(x,g,S){const W=S[0],ut=S[2];if(x.x<W.x&&g.x<W.x||x.x>ut.x&&g.x>ut.x||x.y<W.y&&g.y<W.y||x.y>ut.y&&g.y>ut.y)return!1;const Ht=_l(x,g,S[0]);return Ht!==_l(x,g,S[1])||Ht!==_l(x,g,S[2])||Ht!==_l(x,g,S[3])}function om(x,g,S){const W=g.paint.get(x).value;return W.kind==="constant"?W.value:S.programConfigurations.get(g.id).getMaxValue(x)}function uy(x){return Math.sqrt(x[0]*x[0]+x[1]*x[1])}function Iy(x,g,S,W,ut){if(!g[0]&&!g[1])return x;const Ht=L.convert(g)._mult(ut);S==="viewport"&&Ht._rotate(-W);const Jt=[];for(let In=0;In<x.length;In++)Jt.push(x[In].sub(Ht));return Jt}let $g,Ag;Td("CircleBucket",zd,{omit:["layers"]});var mg={get paint(){return Ag=Ag||new Am({"circle-radius":new Kd(Yh.paint_circle["circle-radius"]),"circle-color":new Kd(Yh.paint_circle["circle-color"]),"circle-blur":new Kd(Yh.paint_circle["circle-blur"]),"circle-opacity":new Kd(Yh.paint_circle["circle-opacity"]),"circle-translate":new Nd(Yh.paint_circle["circle-translate"]),"circle-translate-anchor":new Nd(Yh.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Nd(Yh.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Nd(Yh.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Kd(Yh.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Kd(Yh.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Kd(Yh.paint_circle["circle-stroke-opacity"])})},get layout(){return $g=$g||new Am({"circle-sort-key":new Kd(Yh.layout_circle["circle-sort-key"])})}},dg=1e-6,wm=typeof Float32Array<"u"?Float32Array:Array;function Mg(x){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x}function cy(x,g,S){var W=g[0],ut=g[1],Ht=g[2],Jt=g[3],In=g[4],So=g[5],al=g[6],hl=g[7],eh=g[8],ah=g[9],ch=g[10],dh=g[11],Dh=g[12],Ph=g[13],Xh=g[14],Qh=g[15],qh=S[0],lp=S[1],dp=S[2],Mp=S[3];return x[0]=qh*W+lp*In+dp*eh+Mp*Dh,x[1]=qh*ut+lp*So+dp*ah+Mp*Ph,x[2]=qh*Ht+lp*al+dp*ch+Mp*Xh,x[3]=qh*Jt+lp*hl+dp*dh+Mp*Qh,x[4]=(qh=S[4])*W+(lp=S[5])*In+(dp=S[6])*eh+(Mp=S[7])*Dh,x[5]=qh*ut+lp*So+dp*ah+Mp*Ph,x[6]=qh*Ht+lp*al+dp*ch+Mp*Xh,x[7]=qh*Jt+lp*hl+dp*dh+Mp*Qh,x[8]=(qh=S[8])*W+(lp=S[9])*In+(dp=S[10])*eh+(Mp=S[11])*Dh,x[9]=qh*ut+lp*So+dp*ah+Mp*Ph,x[10]=qh*Ht+lp*al+dp*ch+Mp*Xh,x[11]=qh*Jt+lp*hl+dp*dh+Mp*Qh,x[12]=(qh=S[12])*W+(lp=S[13])*In+(dp=S[14])*eh+(Mp=S[15])*Dh,x[13]=qh*ut+lp*So+dp*ah+Mp*Ph,x[14]=qh*Ht+lp*al+dp*ch+Mp*Xh,x[15]=qh*Jt+lp*hl+dp*dh+Mp*Qh,x}Math.hypot||(Math.hypot=function(){for(var x=0,g=arguments.length;g--;)x+=arguments[g]*arguments[g];return Math.sqrt(x)});var Kv,b0=cy;function Zv(x,g,S){var W=g[0],ut=g[1],Ht=g[2],Jt=g[3];return x[0]=S[0]*W+S[4]*ut+S[8]*Ht+S[12]*Jt,x[1]=S[1]*W+S[5]*ut+S[9]*Ht+S[13]*Jt,x[2]=S[2]*W+S[6]*ut+S[10]*Ht+S[14]*Jt,x[3]=S[3]*W+S[7]*ut+S[11]*Ht+S[15]*Jt,x}function S_(x,g){const S=Zv([],[x.x,x.y,0,1],g);return new L(S[0]/S[3],S[1]/S[3])}Kv=new wm(4),wm!=Float32Array&&(Kv[0]=0,Kv[1]=0,Kv[2]=0,Kv[3]=0);class uv extends zd{}let Xv;Td("HeatmapBucket",uv,{omit:["layers"]});var Ux={get paint(){return Xv=Xv||new Am({"heatmap-radius":new Kd(Yh.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Kd(Yh.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Nd(Yh.paint_heatmap["heatmap-intensity"]),"heatmap-color":new tx(Yh.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Nd(Yh.paint_heatmap["heatmap-opacity"])})}};function C0(x,{width:g,height:S},W,ut){if(ut){if(ut instanceof Uint8ClampedArray)ut=new Uint8Array(ut.buffer);else if(ut.length!==g*S*W)throw new RangeError(`mismatched image size. expected: ${ut.length} but got: ${g*S*W}`)}else ut=new Uint8Array(g*S*W);return x.width=g,x.height=S,x.data=ut,x}function jx(x,{width:g,height:S},W){if(g===x.width&&S===x.height)return;const ut=C0({},{width:g,height:S},W);n1(x,ut,{x:0,y:0},{x:0,y:0},{width:Math.min(x.width,g),height:Math.min(x.height,S)},W),x.width=g,x.height=S,x.data=ut.data}function n1(x,g,S,W,ut,Ht){if(ut.width===0||ut.height===0)return g;if(ut.width>x.width||ut.height>x.height||S.x>x.width-ut.width||S.y>x.height-ut.height)throw new RangeError("out of range source coordinates for image copy");if(ut.width>g.width||ut.height>g.height||W.x>g.width-ut.width||W.y>g.height-ut.height)throw new RangeError("out of range destination coordinates for image copy");const Jt=x.data,In=g.data;if(Jt===In)throw new Error("srcData equals dstData, so image is already copied");for(let So=0;So<ut.height;So++){const al=((S.y+So)*x.width+S.x)*Ht,hl=((W.y+So)*g.width+W.x)*Ht;for(let eh=0;eh<ut.width*Ht;eh++)In[hl+eh]=Jt[al+eh]}return g}class Hx{constructor(g,S){C0(this,g,1,S)}resize(g){jx(this,g,1)}clone(){return new Hx({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(g,S,W,ut,Ht){n1(g,S,W,ut,Ht,1)}}class n_{constructor(g,S){C0(this,g,4,S)}resize(g){jx(this,g,4)}replace(g,S){S?this.data.set(g):this.data=g instanceof Uint8ClampedArray?new Uint8Array(g.buffer):g}clone(){return new n_({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(g,S,W,ut,Ht){n1(g,S,W,ut,Ht,4)}}function o1(x){const g={},S=x.resolution||256,W=x.clips?x.clips.length:1,ut=x.image||new n_({width:S,height:W});if(Math.log(S)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${S}`);const Ht=(Jt,In,So)=>{g[x.evaluationKey]=So;const al=x.expression.evaluate(g);ut.data[Jt+In+0]=Math.floor(255*al.r/al.a),ut.data[Jt+In+1]=Math.floor(255*al.g/al.a),ut.data[Jt+In+2]=Math.floor(255*al.b/al.a),ut.data[Jt+In+3]=Math.floor(255*al.a)};if(x.clips)for(let Jt=0,In=0;Jt<W;++Jt,In+=4*S)for(let So=0,al=0;So<S;So++,al+=4){const hl=So/(S-1),{start:eh,end:ah}=x.clips[Jt];Ht(In,al,eh*(1-hl)+ah*hl)}else for(let Jt=0,In=0;Jt<S;Jt++,In+=4)Ht(0,In,Jt/(S-1));return ut}let Ew;Td("AlphaImage",Hx),Td("RGBAImage",n_);var jb={get paint(){return Ew=Ew||new Am({"hillshade-illumination-direction":new Nd(Yh.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Nd(Yh.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Nd(Yh.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Nd(Yh.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Nd(Yh.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Nd(Yh.paint_hillshade["hillshade-accent-color"])})}};const W1=Jg([{name:"a_pos",components:2,type:"Int16"}],4),{members:s1}=W1;var cv={exports:{}};function Rx(x,g,S){S=S||2;var W,ut,Ht,Jt,In,So,al,hl=g&&g.length,eh=hl?g[0]*S:x.length,ah=q1(x,0,eh,S,!0),ch=[];if(!ah||ah.next===ah.prev)return ch;if(hl&&(ah=function(Dh,Ph,Xh,Qh){var qh,lp,dp,Mp=[];for(qh=0,lp=Ph.length;qh<lp;qh++)(dp=q1(Dh,Ph[qh]*Qh,qh<lp-1?Ph[qh+1]*Qh:Dh.length,Qh,!1))===dp.next&&(dp.steiner=!0),Mp.push(sx(dp));for(Mp.sort(Wx),qh=0;qh<Mp.length;qh++)Xh=E0(Mp[qh],Xh);return Xh}(x,g,ah,S)),x.length>80*S){W=Ht=x[0],ut=Jt=x[1];for(var dh=S;dh<eh;dh+=S)(In=x[dh])<W&&(W=In),(So=x[dh+1])<ut&&(ut=So),In>Ht&&(Ht=In),So>Jt&&(Jt=So);al=(al=Math.max(Ht-W,Jt-ut))!==0?32767/al:0}return Sw(ah,ch,S,W,ut,al,0),ch}function q1(x,g,S,W,ut){var Ht,Jt;if(ut===Jv(x,g,S,W)>0)for(Ht=g;Ht<S;Ht+=W)Jt=qb(Ht,x[Ht],x[Ht+1],Jt);else for(Ht=S-W;Ht>=g;Ht-=W)Jt=qb(Ht,x[Ht],x[Ht+1],Jt);return Jt&&a1(Jt,Jt.next)&&(Kg(Jt),Jt=Jt.next),Jt}function ox(x,g){if(!x)return x;g||(g=x);var S,W=x;do if(S=!1,W.steiner||!a1(W,W.next)&&gm(W.prev,W,W.next)!==0)W=W.next;else{if(Kg(W),(W=g=W.prev)===W.next)break;S=!0}while(S||W!==g);return g}function Sw(x,g,S,W,ut,Ht,Jt){if(x){!Jt&&Ht&&function(hl,eh,ah,ch){var dh=hl;do dh.z===0&&(dh.z=Yv(dh.x,dh.y,eh,ah,ch)),dh.prevZ=dh.prev,dh.nextZ=dh.next,dh=dh.next;while(dh!==hl);dh.prevZ.nextZ=null,dh.prevZ=null,function(Dh){var Ph,Xh,Qh,qh,lp,dp,Mp,Md,bd=1;do{for(Xh=Dh,Dh=null,lp=null,dp=0;Xh;){for(dp++,Qh=Xh,Mp=0,Ph=0;Ph<bd&&(Mp++,Qh=Qh.nextZ);Ph++);for(Md=bd;Mp>0||Md>0&&Qh;)Mp!==0&&(Md===0||!Qh||Xh.z<=Qh.z)?(qh=Xh,Xh=Xh.nextZ,Mp--):(qh=Qh,Qh=Qh.nextZ,Md--),lp?lp.nextZ=qh:Dh=qh,qh.prevZ=lp,lp=qh;Xh=Qh}lp.nextZ=null,bd*=2}while(dp>1)}(dh)}(x,W,ut,Ht);for(var In,So,al=x;x.prev!==x.next;)if(In=x.prev,So=x.next,Ht?YC(x,W,ut,Ht):XC(x))g.push(In.i/S|0),g.push(x.i/S|0),g.push(So.i/S|0),Kg(x),x=So.next,al=So.next;else if((x=So)===al){Jt?Jt===1?Sw(x=K1(ox(x),g,S),g,S,W,ut,Ht,2):Jt===2&&Tw(x,g,S,W,ut,Ht):Sw(ox(x),g,S,W,ut,Ht,1);break}}}function XC(x){var g=x.prev,S=x,W=x.next;if(gm(g,S,W)>=0)return!1;for(var ut=g.x,Ht=S.x,Jt=W.x,In=g.y,So=S.y,al=W.y,hl=ut<Ht?ut<Jt?ut:Jt:Ht<Jt?Ht:Jt,eh=In<So?In<al?In:al:So<al?So:al,ah=ut>Ht?ut>Jt?ut:Jt:Ht>Jt?Ht:Jt,ch=In>So?In>al?In:al:So>al?So:al,dh=W.next;dh!==g;){if(dh.x>=hl&&dh.x<=ah&&dh.y>=eh&&dh.y<=ch&&T_(ut,In,Ht,So,Jt,al,dh.x,dh.y)&&gm(dh.prev,dh,dh.next)>=0)return!1;dh=dh.next}return!0}function YC(x,g,S,W){var ut=x.prev,Ht=x,Jt=x.next;if(gm(ut,Ht,Jt)>=0)return!1;for(var In=ut.x,So=Ht.x,al=Jt.x,hl=ut.y,eh=Ht.y,ah=Jt.y,ch=In<So?In<al?In:al:So<al?So:al,dh=hl<eh?hl<ah?hl:ah:eh<ah?eh:ah,Dh=In>So?In>al?In:al:So>al?So:al,Ph=hl>eh?hl>ah?hl:ah:eh>ah?eh:ah,Xh=Yv(ch,dh,g,S,W),Qh=Yv(Dh,Ph,g,S,W),qh=x.prevZ,lp=x.nextZ;qh&&qh.z>=Xh&&lp&&lp.z<=Qh;){if(qh.x>=ch&&qh.x<=Dh&&qh.y>=dh&&qh.y<=Ph&&qh!==ut&&qh!==Jt&&T_(In,hl,So,eh,al,ah,qh.x,qh.y)&&gm(qh.prev,qh,qh.next)>=0||(qh=qh.prevZ,lp.x>=ch&&lp.x<=Dh&&lp.y>=dh&&lp.y<=Ph&&lp!==ut&&lp!==Jt&&T_(In,hl,So,eh,al,ah,lp.x,lp.y)&&gm(lp.prev,lp,lp.next)>=0))return!1;lp=lp.nextZ}for(;qh&&qh.z>=Xh;){if(qh.x>=ch&&qh.x<=Dh&&qh.y>=dh&&qh.y<=Ph&&qh!==ut&&qh!==Jt&&T_(In,hl,So,eh,al,ah,qh.x,qh.y)&&gm(qh.prev,qh,qh.next)>=0)return!1;qh=qh.prevZ}for(;lp&&lp.z<=Qh;){if(lp.x>=ch&&lp.x<=Dh&&lp.y>=dh&&lp.y<=Ph&&lp!==ut&&lp!==Jt&&T_(In,hl,So,eh,al,ah,lp.x,lp.y)&&gm(lp.prev,lp,lp.next)>=0)return!1;lp=lp.nextZ}return!0}function K1(x,g,S){var W=x;do{var ut=W.prev,Ht=W.next.next;!a1(ut,Ht)&&Hb(ut,W,W.next,Ht)&&Py(ut,Ht)&&Py(Ht,ut)&&(g.push(ut.i/S|0),g.push(W.i/S|0),g.push(Ht.i/S|0),Kg(W),Kg(W.next),W=x=Ht),W=W.next}while(W!==x);return ox(W)}function Tw(x,g,S,W,ut,Ht){var Jt=x;do{for(var In=Jt.next.next;In!==Jt.prev;){if(Jt.i!==In.i&&JC(Jt,In)){var So=Wb(Jt,In);return Jt=ox(Jt,Jt.next),So=ox(So,So.next),Sw(Jt,g,S,W,ut,Ht,0),void Sw(So,g,S,W,ut,Ht,0)}In=In.next}Jt=Jt.next}while(Jt!==x)}function Wx(x,g){return x.x-g.x}function E0(x,g){var S=function(ut,Ht){var Jt,In=Ht,So=ut.x,al=ut.y,hl=-1/0;do{if(al<=In.y&&al>=In.next.y&&In.next.y!==In.y){var eh=In.x+(al-In.y)*(In.next.x-In.x)/(In.next.y-In.y);if(eh<=So&&eh>hl&&(hl=eh,Jt=In.x<In.next.x?In:In.next,eh===So))return Jt}In=In.next}while(In!==Ht);if(!Jt)return null;var ah,ch=Jt,dh=Jt.x,Dh=Jt.y,Ph=1/0;In=Jt;do So>=In.x&&In.x>=dh&&So!==In.x&&T_(al<Dh?So:hl,al,dh,Dh,al<Dh?hl:So,al,In.x,In.y)&&(ah=Math.abs(al-In.y)/(So-In.x),Py(In,ut)&&(ah<Ph||ah===Ph&&(In.x>Jt.x||In.x===Jt.x&&hv(Jt,In)))&&(Jt=In,Ph=ah)),In=In.next;while(In!==ch);return Jt}(x,g);if(!S)return g;var W=Wb(S,x);return ox(W,W.next),ox(S,S.next)}function hv(x,g){return gm(x.prev,x,g.prev)<0&&gm(g.next,x,x.next)<0}function Yv(x,g,S,W,ut){return(x=1431655765&((x=858993459&((x=252645135&((x=16711935&((x=(x-S)*ut|0)|x<<8))|x<<4))|x<<2))|x<<1))|(g=1431655765&((g=858993459&((g=252645135&((g=16711935&((g=(g-W)*ut|0)|g<<8))|g<<4))|g<<2))|g<<1))<<1}function sx(x){var g=x,S=x;do(g.x<S.x||g.x===S.x&&g.y<S.y)&&(S=g),g=g.next;while(g!==x);return S}function T_(x,g,S,W,ut,Ht,Jt,In){return(ut-Jt)*(g-In)>=(x-Jt)*(Ht-In)&&(x-Jt)*(W-In)>=(S-Jt)*(g-In)&&(S-Jt)*(Ht-In)>=(ut-Jt)*(W-In)}function JC(x,g){return x.next.i!==g.i&&x.prev.i!==g.i&&!function(S,W){var ut=S;do{if(ut.i!==S.i&&ut.next.i!==S.i&&ut.i!==W.i&&ut.next.i!==W.i&&Hb(ut,ut.next,S,W))return!0;ut=ut.next}while(ut!==S);return!1}(x,g)&&(Py(x,g)&&Py(g,x)&&function(S,W){var ut=S,Ht=!1,Jt=(S.x+W.x)/2,In=(S.y+W.y)/2;do ut.y>In!=ut.next.y>In&&ut.next.y!==ut.y&&Jt<(ut.next.x-ut.x)*(In-ut.y)/(ut.next.y-ut.y)+ut.x&&(Ht=!Ht),ut=ut.next;while(ut!==S);return Ht}(x,g)&&(gm(x.prev,x,g.prev)||gm(x,g.prev,g))||a1(x,g)&&gm(x.prev,x,x.next)>0&&gm(g.prev,g,g.next)>0)}function gm(x,g,S){return(g.y-x.y)*(S.x-g.x)-(g.x-x.x)*(S.y-g.y)}function a1(x,g){return x.x===g.x&&x.y===g.y}function Hb(x,g,S,W){var ut=Rw(gm(x,g,S)),Ht=Rw(gm(x,g,W)),Jt=Rw(gm(S,W,x)),In=Rw(gm(S,W,g));return ut!==Ht&&Jt!==In||!(ut!==0||!Aw(x,S,g))||!(Ht!==0||!Aw(x,W,g))||!(Jt!==0||!Aw(S,x,W))||!(In!==0||!Aw(S,g,W))}function Aw(x,g,S){return g.x<=Math.max(x.x,S.x)&&g.x>=Math.min(x.x,S.x)&&g.y<=Math.max(x.y,S.y)&&g.y>=Math.min(x.y,S.y)}function Rw(x){return x>0?1:x<0?-1:0}function Py(x,g){return gm(x.prev,x,x.next)<0?gm(x,g,x.next)>=0&&gm(x,x.prev,g)>=0:gm(x,g,x.prev)<0||gm(x,x.next,g)<0}function Wb(x,g){var S=new Hd(x.i,x.x,x.y),W=new Hd(g.i,g.x,g.y),ut=x.next,Ht=g.prev;return x.next=g,g.prev=x,S.next=ut,ut.prev=S,W.next=S,S.prev=W,Ht.next=W,W.prev=Ht,W}function qb(x,g,S,W){var ut=new Hd(x,g,S);return W?(ut.next=W.next,ut.prev=W,W.next.prev=ut,W.next=ut):(ut.prev=ut,ut.next=ut),ut}function Kg(x){x.next.prev=x.prev,x.prev.next=x.next,x.prevZ&&(x.prevZ.nextZ=x.nextZ),x.nextZ&&(x.nextZ.prevZ=x.prevZ)}function Hd(x,g,S){this.i=x,this.x=g,this.y=S,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Jv(x,g,S,W){for(var ut=0,Ht=g,Jt=S-W;Ht<S;Ht+=W)ut+=(x[Jt]-x[Ht])*(x[Ht+1]+x[Jt+1]),Jt=Ht;return ut}cv.exports=Rx,cv.exports.default=Rx,Rx.deviation=function(x,g,S,W){var ut=g&&g.length,Ht=Math.abs(Jv(x,0,ut?g[0]*S:x.length,S));if(ut)for(var Jt=0,In=g.length;Jt<In;Jt++)Ht-=Math.abs(Jv(x,g[Jt]*S,Jt<In-1?g[Jt+1]*S:x.length,S));var So=0;for(Jt=0;Jt<W.length;Jt+=3){var al=W[Jt]*S,hl=W[Jt+1]*S,eh=W[Jt+2]*S;So+=Math.abs((x[al]-x[eh])*(x[hl+1]-x[al+1])-(x[al]-x[hl])*(x[eh+1]-x[al+1]))}return Ht===0&&So===0?0:Math.abs((So-Ht)/Ht)},Rx.flatten=function(x){for(var g=x[0][0].length,S={vertices:[],holes:[],dimensions:g},W=0,ut=0;ut<x.length;ut++){for(var Ht=0;Ht<x[ut].length;Ht++)for(var Jt=0;Jt<g;Jt++)S.vertices.push(x[ut][Ht][Jt]);ut>0&&S.holes.push(W+=x[ut-1].length)}return S};var Iw=h(cv.exports);function Vy(x,g,S,W,ut){Z1(x,g,S||0,W||x.length-1,ut||pv)}function Z1(x,g,S,W,ut){for(;W>S;){if(W-S>600){var Ht=W-S+1,Jt=g-S+1,In=Math.log(Ht),So=.5*Math.exp(2*In/3),al=.5*Math.sqrt(In*So*(Ht-So)/Ht)*(Jt-Ht/2<0?-1:1);Z1(x,g,Math.max(S,Math.floor(g-Jt*So/Ht+al)),Math.min(W,Math.floor(g+(Ht-Jt)*So/Ht+al)),ut)}var hl=x[g],eh=S,ah=W;for(qx(x,S,g),ut(x[W],hl)>0&&qx(x,S,W);eh<ah;){for(qx(x,eh,ah),eh++,ah--;ut(x[eh],hl)<0;)eh++;for(;ut(x[ah],hl)>0;)ah--}ut(x[S],hl)===0?qx(x,S,ah):qx(x,++ah,W),ah<=g&&(S=ah+1),g<=ah&&(W=ah-1)}}function qx(x,g,S){var W=x[g];x[g]=x[S],x[S]=W}function pv(x,g){return x<g?-1:x>g?1:0}function Pw(x,g){const S=x.length;if(S<=1)return[x];const W=[];let ut,Ht;for(let Jt=0;Jt<S;Jt++){const In=rh(x[Jt]);In!==0&&(x[Jt].area=Math.abs(In),Ht===void 0&&(Ht=In<0),Ht===In<0?(ut&&W.push(ut),ut=[x[Jt]]):ut.push(x[Jt]))}if(ut&&W.push(ut),g>1)for(let Jt=0;Jt<W.length;Jt++)W[Jt].length<=g||(Vy(W[Jt],g,1,W[Jt].length-1,Ix),W[Jt]=W[Jt].slice(0,g));return W}function Ix(x,g){return g.area-x.area}function Px(x,g,S){const W=S.patternDependencies;let ut=!1;for(const Ht of g){const Jt=Ht.paint.get(`${x}-pattern`);Jt.isConstant()||(ut=!0);const In=Jt.constantOr(null);In&&(ut=!0,W[In.to]=!0,W[In.from]=!0)}return ut}function S0(x,g,S,W,ut){const Ht=ut.patternDependencies;for(const Jt of g){const In=Jt.paint.get(`${x}-pattern`).value;if(In.kind!=="constant"){let So=In.evaluate({zoom:W-1},S,{},ut.availableImages),al=In.evaluate({zoom:W},S,{},ut.availableImages),hl=In.evaluate({zoom:W+1},S,{},ut.availableImages);So=So&&So.name?So.name:So,al=al&&al.name?al.name:al,hl=hl&&hl.name?hl.name:hl,Ht[So]=!0,Ht[al]=!0,Ht[hl]=!0,S.patterns[Jt.id]={min:So,mid:al,max:hl}}}return S}class Mw{constructor(g){this.zoom=g.zoom,this.overscaling=g.overscaling,this.layers=g.layers,this.layerIds=this.layers.map(S=>S.id),this.index=g.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Rh,this.indexArray=new Vp,this.indexArray2=new gd,this.programConfigurations=new tp(g.layers,g.zoom),this.segments=new T,this.segments2=new T,this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id)}populate(g,S,W){this.hasPattern=Px("fill",this.layers,S);const ut=this.layers[0].layout.get("fill-sort-key"),Ht=!ut.isConstant(),Jt=[];for(const{feature:In,id:So,index:al,sourceLayerIndex:hl}of g){const eh=this.layers[0]._featureFilter.needGeometry,ah=Pp(In,eh);if(!this.layers[0]._featureFilter.filter(new Eg(this.zoom),ah,W))continue;const ch=Ht?ut.evaluate(ah,{},W,S.availableImages):void 0,dh={id:So,properties:In.properties,type:In.type,sourceLayerIndex:hl,index:al,geometry:eh?ah.geometry:Fp(In),patterns:{},sortKey:ch};Jt.push(dh)}Ht&&Jt.sort((In,So)=>In.sortKey-So.sortKey);for(const In of Jt){const{geometry:So,index:al,sourceLayerIndex:hl}=In;if(this.hasPattern){const eh=S0("fill",this.layers,In,this.zoom,S);this.patternFeatures.push(eh)}else this.addFeature(In,So,al,W,{});S.featureIndex.insert(g[al].feature,So,al,hl,this.index)}}update(g,S,W){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(g,S,this.stateDependentLayers,W)}addFeatures(g,S,W){for(const ut of this.patternFeatures)this.addFeature(ut,ut.geometry,ut.index,S,W)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(g){this.uploaded||(this.layoutVertexBuffer=g.createVertexBuffer(this.layoutVertexArray,s1),this.indexBuffer=g.createIndexBuffer(this.indexArray),this.indexBuffer2=g.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(g),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(g,S,W,ut,Ht){for(const Jt of Pw(S,500)){let In=0;for(const ch of Jt)In+=ch.length;const So=this.segments.prepareSegment(In,this.layoutVertexArray,this.indexArray),al=So.vertexLength,hl=[],eh=[];for(const ch of Jt){if(ch.length===0)continue;ch!==Jt[0]&&eh.push(hl.length/2);const dh=this.segments2.prepareSegment(ch.length,this.layoutVertexArray,this.indexArray2),Dh=dh.vertexLength;this.layoutVertexArray.emplaceBack(ch[0].x,ch[0].y),this.indexArray2.emplaceBack(Dh+ch.length-1,Dh),hl.push(ch[0].x),hl.push(ch[0].y);for(let Ph=1;Ph<ch.length;Ph++)this.layoutVertexArray.emplaceBack(ch[Ph].x,ch[Ph].y),this.indexArray2.emplaceBack(Dh+Ph-1,Dh+Ph),hl.push(ch[Ph].x),hl.push(ch[Ph].y);dh.vertexLength+=ch.length,dh.primitiveLength+=ch.length}const ah=Iw(hl,eh);for(let ch=0;ch<ah.length;ch+=3)this.indexArray.emplaceBack(al+ah[ch],al+ah[ch+1],al+ah[ch+2]);So.vertexLength+=In,So.primitiveLength+=ah.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,g,W,Ht,ut)}}let Dw,X1;Td("FillBucket",Mw,{omit:["layers","patternFeatures"]});var Kb={get paint(){return X1=X1||new Am({"fill-antialias":new Nd(Yh.paint_fill["fill-antialias"]),"fill-opacity":new Kd(Yh.paint_fill["fill-opacity"]),"fill-color":new Kd(Yh.paint_fill["fill-color"]),"fill-outline-color":new Kd(Yh.paint_fill["fill-outline-color"]),"fill-translate":new Nd(Yh.paint_fill["fill-translate"]),"fill-translate-anchor":new Nd(Yh.paint_fill["fill-translate-anchor"]),"fill-pattern":new nv(Yh.paint_fill["fill-pattern"])})},get layout(){return Dw=Dw||new Am({"fill-sort-key":new Kd(Yh.layout_fill["fill-sort-key"])})}};const QC=Jg([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Y1=Jg([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Zb}=QC;var A_={},Kx=y,Qv=ax;function ax(x,g,S,W,ut){this.properties={},this.extent=S,this.type=0,this._pbf=x,this._geometry=-1,this._keys=W,this._values=ut,x.readFields(Xb,this,g)}function Xb(x,g,S){x==1?g.id=S.readVarint():x==2?function(W,ut){for(var Ht=W.readVarint()+W.pos;W.pos<Ht;){var Jt=ut._keys[W.readVarint()],In=ut._values[W.readVarint()];ut.properties[Jt]=In}}(S,g):x==3?g.type=S.readVarint():x==4&&(g._geometry=S.pos)}function Ow(x){for(var g,S,W=0,ut=0,Ht=x.length,Jt=Ht-1;ut<Ht;Jt=ut++)W+=((S=x[Jt]).x-(g=x[ut]).x)*(g.y+S.y);return W}ax.types=["Unknown","Point","LineString","Polygon"],ax.prototype.loadGeometry=function(){var x=this._pbf;x.pos=this._geometry;for(var g,S=x.readVarint()+x.pos,W=1,ut=0,Ht=0,Jt=0,In=[];x.pos<S;){if(ut<=0){var So=x.readVarint();W=7&So,ut=So>>3}if(ut--,W===1||W===2)Ht+=x.readSVarint(),Jt+=x.readSVarint(),W===1&&(g&&In.push(g),g=[]),g.push(new Kx(Ht,Jt));else{if(W!==7)throw new Error("unknown command "+W);g&&g.push(g[0].clone())}}return g&&In.push(g),In},ax.prototype.bbox=function(){var x=this._pbf;x.pos=this._geometry;for(var g=x.readVarint()+x.pos,S=1,W=0,ut=0,Ht=0,Jt=1/0,In=-1/0,So=1/0,al=-1/0;x.pos<g;){if(W<=0){var hl=x.readVarint();S=7&hl,W=hl>>3}if(W--,S===1||S===2)(ut+=x.readSVarint())<Jt&&(Jt=ut),ut>In&&(In=ut),(Ht+=x.readSVarint())<So&&(So=Ht),Ht>al&&(al=Ht);else if(S!==7)throw new Error("unknown command "+S)}return[Jt,So,In,al]},ax.prototype.toGeoJSON=function(x,g,S){var W,ut,Ht=this.extent*Math.pow(2,S),Jt=this.extent*x,In=this.extent*g,So=this.loadGeometry(),al=ax.types[this.type];function hl(ch){for(var dh=0;dh<ch.length;dh++){var Dh=ch[dh];ch[dh]=[360*(Dh.x+Jt)/Ht-180,360/Math.PI*Math.atan(Math.exp((180-360*(Dh.y+In)/Ht)*Math.PI/180))-90]}}switch(this.type){case 1:var eh=[];for(W=0;W<So.length;W++)eh[W]=So[W][0];hl(So=eh);break;case 2:for(W=0;W<So.length;W++)hl(So[W]);break;case 3:for(So=function(ch){var dh=ch.length;if(dh<=1)return[ch];for(var Dh,Ph,Xh=[],Qh=0;Qh<dh;Qh++){var qh=Ow(ch[Qh]);qh!==0&&(Ph===void 0&&(Ph=qh<0),Ph===qh<0?(Dh&&Xh.push(Dh),Dh=[ch[Qh]]):Dh.push(ch[Qh]))}return Dh&&Xh.push(Dh),Xh}(So),W=0;W<So.length;W++)for(ut=0;ut<So[W].length;ut++)hl(So[W][ut])}So.length===1?So=So[0]:al="Multi"+al;var ah={type:"Feature",geometry:{type:al,coordinates:So},properties:this.properties};return"id"in this&&(ah.id=this.id),ah};var Lw=Qv,$y=Zx;function Zx(x,g){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=x,this._keys=[],this._values=[],this._features=[],x.readFields(wy,this,g),this.length=this._features.length}function wy(x,g,S){x===15?g.version=S.readVarint():x===1?g.name=S.readString():x===5?g.extent=S.readVarint():x===2?g._features.push(S.pos):x===3?g._keys.push(S.readString()):x===4&&g._values.push(function(W){for(var ut=null,Ht=W.readVarint()+W.pos;W.pos<Ht;){var Jt=W.readVarint()>>3;ut=Jt===1?W.readString():Jt===2?W.readFloat():Jt===3?W.readDouble():Jt===4?W.readVarint64():Jt===5?W.readVarint():Jt===6?W.readSVarint():Jt===7?W.readBoolean():null}return ut}(S))}Zx.prototype.feature=function(x){if(x<0||x>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[x];var g=this._pbf.readVarint()+this._pbf.pos;return new Lw(this._pbf,g,this.extent,this._keys,this._values)};var R_=$y;function J1(x,g,S){if(x===3){var W=new R_(S,S.readVarint()+S.pos);W.length&&(g[W.name]=W)}}A_.VectorTile=function(x,g){this.layers=x.readFields(J1,{},g)},A_.VectorTileFeature=Qv,A_.VectorTileLayer=$y;const sm=A_.VectorTileFeature.types,l1=Math.pow(2,13);function T0(x,g,S,W,ut,Ht,Jt,In){x.emplaceBack(g,S,2*Math.floor(W*l1)+Jt,ut*l1*2,Ht*l1*2,Math.round(In))}class o_{constructor(g){this.zoom=g.zoom,this.overscaling=g.overscaling,this.layers=g.layers,this.layerIds=this.layers.map(S=>S.id),this.index=g.index,this.hasPattern=!1,this.layoutVertexArray=new Gh,this.centroidVertexArray=new Ah,this.indexArray=new Vp,this.programConfigurations=new tp(g.layers,g.zoom),this.segments=new T,this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id)}populate(g,S,W){this.features=[],this.hasPattern=Px("fill-extrusion",this.layers,S);for(const{feature:ut,id:Ht,index:Jt,sourceLayerIndex:In}of g){const So=this.layers[0]._featureFilter.needGeometry,al=Pp(ut,So);if(!this.layers[0]._featureFilter.filter(new Eg(this.zoom),al,W))continue;const hl={id:Ht,sourceLayerIndex:In,index:Jt,geometry:So?al.geometry:Fp(ut),properties:ut.properties,type:ut.type,patterns:{}};this.hasPattern?this.features.push(S0("fill-extrusion",this.layers,hl,this.zoom,S)):this.addFeature(hl,hl.geometry,Jt,W,{}),S.featureIndex.insert(ut,hl.geometry,Jt,In,this.index,!0)}}addFeatures(g,S,W){for(const ut of this.features){const{geometry:Ht}=ut;this.addFeature(ut,Ht,ut.index,S,W)}}update(g,S,W){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(g,S,this.stateDependentLayers,W)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(g){this.uploaded||(this.layoutVertexBuffer=g.createVertexBuffer(this.layoutVertexArray,Zb),this.centroidVertexBuffer=g.createVertexBuffer(this.centroidVertexArray,Y1.members,!0),this.indexBuffer=g.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(g),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(g,S,W,ut,Ht){const Jt={x:0,y:0,vertexCount:0};for(const In of Pw(S,500)){let So=0;for(const dh of In)So+=dh.length;let al=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const dh of In){if(dh.length===0||tE(dh))continue;let Dh=0;for(let Ph=0;Ph<dh.length;Ph++){const Xh=dh[Ph];if(Ph>=1){const Qh=dh[Ph-1];if(!eE(Xh,Qh)){al.vertexLength+4>T.MAX_VERTEX_ARRAY_LENGTH&&(al=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const qh=Xh.sub(Qh)._perp()._unit(),lp=Qh.dist(Xh);Dh+lp>32768&&(Dh=0),T0(this.layoutVertexArray,Xh.x,Xh.y,qh.x,qh.y,0,0,Dh),T0(this.layoutVertexArray,Xh.x,Xh.y,qh.x,qh.y,0,1,Dh),Jt.x+=2*Xh.x,Jt.y+=2*Xh.y,Jt.vertexCount+=2,Dh+=lp,T0(this.layoutVertexArray,Qh.x,Qh.y,qh.x,qh.y,0,0,Dh),T0(this.layoutVertexArray,Qh.x,Qh.y,qh.x,qh.y,0,1,Dh),Jt.x+=2*Qh.x,Jt.y+=2*Qh.y,Jt.vertexCount+=2;const dp=al.vertexLength;this.indexArray.emplaceBack(dp,dp+2,dp+1),this.indexArray.emplaceBack(dp+1,dp+2,dp+3),al.vertexLength+=4,al.primitiveLength+=2}}}}if(al.vertexLength+So>T.MAX_VERTEX_ARRAY_LENGTH&&(al=this.segments.prepareSegment(So,this.layoutVertexArray,this.indexArray)),sm[g.type]!=="Polygon")continue;const hl=[],eh=[],ah=al.vertexLength;for(const dh of In)if(dh.length!==0){dh!==In[0]&&eh.push(hl.length/2);for(let Dh=0;Dh<dh.length;Dh++){const Ph=dh[Dh];T0(this.layoutVertexArray,Ph.x,Ph.y,0,0,1,1,0),Jt.x+=Ph.x,Jt.y+=Ph.y,Jt.vertexCount+=1,hl.push(Ph.x),hl.push(Ph.y)}}const ch=Iw(hl,eh);for(let dh=0;dh<ch.length;dh+=3)this.indexArray.emplaceBack(ah+ch[dh],ah+ch[dh+2],ah+ch[dh+1]);al.primitiveLength+=ch.length/3,al.vertexLength+=So}for(let In=0;In<Jt.vertexCount;In++)this.centroidVertexArray.emplaceBack(Math.floor(Jt.x/Jt.vertexCount),Math.floor(Jt.y/Jt.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,g,W,Ht,ut)}}function eE(x,g){return x.x===g.x&&(x.x<0||x.x>bp)||x.y===g.y&&(x.y<0||x.y>bp)}function tE(x){return x.every(g=>g.x<0)||x.every(g=>g.x>bp)||x.every(g=>g.y<0)||x.every(g=>g.y>bp)}let Q1;Td("FillExtrusionBucket",o_,{omit:["layers","features"]});var Yb={get paint(){return Q1=Q1||new Am({"fill-extrusion-opacity":new Nd(Yh["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Kd(Yh["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Nd(Yh["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Nd(Yh["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new nv(Yh["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Kd(Yh["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Kd(Yh["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Nd(Yh["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};function dv(x,g){return x.x*g.x+x.y*g.y}function eb(x,g){if(x.length===1){let S=0;const W=g[S++];let ut;for(;!ut||W.equals(ut);)if(ut=g[S++],!ut)return 1/0;for(;S<g.length;S++){const Ht=g[S],Jt=x[0],In=ut.sub(W),So=Ht.sub(W),al=Jt.sub(W),hl=dv(In,In),eh=dv(In,So),ah=dv(So,So),ch=dv(al,In),dh=dv(al,So),Dh=hl*ah-eh*eh,Ph=(ah*ch-eh*dh)/Dh,Xh=(hl*dh-eh*ch)/Dh,Qh=W.z*(1-Ph-Xh)+ut.z*Ph+Ht.z*Xh;if(isFinite(Qh))return Qh}return 1/0}{let S=1/0;for(const W of g)S=Math.min(S,W.z);return S}}const Jb=Jg([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Qb}=Jb,eC=Jg([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:rE}=eC,iE=A_.VectorTileFeature.types,tC=Math.cos(Math.PI/180*37.5),tb=Math.pow(2,14)/.5;class Mx{constructor(g){this.zoom=g.zoom,this.overscaling=g.overscaling,this.layers=g.layers,this.layerIds=this.layers.map(S=>S.id),this.index=g.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(S=>{this.gradients[S.id]={}}),this.layoutVertexArray=new Kh,this.layoutVertexArray2=new ap,this.indexArray=new Vp,this.programConfigurations=new tp(g.layers,g.zoom),this.segments=new T,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id)}populate(g,S,W){this.hasPattern=Px("line",this.layers,S);const ut=this.layers[0].layout.get("line-sort-key"),Ht=!ut.isConstant(),Jt=[];for(const{feature:In,id:So,index:al,sourceLayerIndex:hl}of g){const eh=this.layers[0]._featureFilter.needGeometry,ah=Pp(In,eh);if(!this.layers[0]._featureFilter.filter(new Eg(this.zoom),ah,W))continue;const ch=Ht?ut.evaluate(ah,{},W):void 0,dh={id:So,properties:In.properties,type:In.type,sourceLayerIndex:hl,index:al,geometry:eh?ah.geometry:Fp(In),patterns:{},sortKey:ch};Jt.push(dh)}Ht&&Jt.sort((In,So)=>In.sortKey-So.sortKey);for(const In of Jt){const{geometry:So,index:al,sourceLayerIndex:hl}=In;if(this.hasPattern){const eh=S0("line",this.layers,In,this.zoom,S);this.patternFeatures.push(eh)}else this.addFeature(In,So,al,W,{});S.featureIndex.insert(g[al].feature,So,al,hl,this.index)}}update(g,S,W){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(g,S,this.stateDependentLayers,W)}addFeatures(g,S,W){for(const ut of this.patternFeatures)this.addFeature(ut,ut.geometry,ut.index,S,W)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(g){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=g.createVertexBuffer(this.layoutVertexArray2,rE)),this.layoutVertexBuffer=g.createVertexBuffer(this.layoutVertexArray,Qb),this.indexBuffer=g.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(g),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(g){if(g.properties&&Object.prototype.hasOwnProperty.call(g.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(g.properties,"mapbox_clip_end"))return{start:+g.properties.mapbox_clip_start,end:+g.properties.mapbox_clip_end}}addFeature(g,S,W,ut,Ht){const Jt=this.layers[0].layout,In=Jt.get("line-join").evaluate(g,{}),So=Jt.get("line-cap"),al=Jt.get("line-miter-limit"),hl=Jt.get("line-round-limit");this.lineClips=this.lineFeatureClips(g);for(const eh of S)this.addLine(eh,g,In,So,al,hl);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,g,W,Ht,ut)}addLine(g,S,W,ut,Ht,Jt){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Xh=0;Xh<g.length-1;Xh++)this.totalDistance+=g[Xh].dist(g[Xh+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const In=iE[S.type]==="Polygon";let So=g.length;for(;So>=2&&g[So-1].equals(g[So-2]);)So--;let al=0;for(;al<So-1&&g[al].equals(g[al+1]);)al++;if(So<(In?3:2))return;W==="bevel"&&(Ht=1.05);const hl=this.overscaling<=16?15*bp/(512*this.overscaling):0,eh=this.segments.prepareSegment(10*So,this.layoutVertexArray,this.indexArray);let ah,ch,dh,Dh,Ph;this.e1=this.e2=-1,In&&(ah=g[So-2],Ph=g[al].sub(ah)._unit()._perp());for(let Xh=al;Xh<So;Xh++){if(dh=Xh===So-1?In?g[al+1]:void 0:g[Xh+1],dh&&g[Xh].equals(dh))continue;Ph&&(Dh=Ph),ah&&(ch=ah),ah=g[Xh],Ph=dh?dh.sub(ah)._unit()._perp():Dh,Dh=Dh||Ph;let Qh=Dh.add(Ph);Qh.x===0&&Qh.y===0||Qh._unit();const qh=Dh.x*Ph.x+Dh.y*Ph.y,lp=Qh.x*Ph.x+Qh.y*Ph.y,dp=lp!==0?1/lp:1/0,Mp=2*Math.sqrt(2-2*lp),Md=lp<tC&&ch&&dh,bd=Dh.x*Ph.y-Dh.y*Ph.x>0;if(Md&&Xh>al){const ld=ah.dist(ch);if(ld>2*hl){const Sd=ah.sub(ah.sub(ch)._mult(hl/ld)._round());this.updateDistance(ch,Sd),this.addCurrentVertex(Sd,Dh,0,0,eh),ch=Sd}}const _d=ch&&dh;let hd=_d?W:In?"butt":ut;if(_d&&hd==="round"&&(dp<Jt?hd="miter":dp<=2&&(hd="fakeround")),hd==="miter"&&dp>Ht&&(hd="bevel"),hd==="bevel"&&(dp>2&&(hd="flipbevel"),dp<Ht&&(hd="miter")),ch&&this.updateDistance(ch,ah),hd==="miter")Qh._mult(dp),this.addCurrentVertex(ah,Qh,0,0,eh);else if(hd==="flipbevel"){if(dp>100)Qh=Ph.mult(-1);else{const ld=dp*Dh.add(Ph).mag()/Dh.sub(Ph).mag();Qh._perp()._mult(ld*(bd?-1:1))}this.addCurrentVertex(ah,Qh,0,0,eh),this.addCurrentVertex(ah,Qh.mult(-1),0,0,eh)}else if(hd==="bevel"||hd==="fakeround"){const ld=-Math.sqrt(dp*dp-1),Sd=bd?ld:0,vd=bd?0:ld;if(ch&&this.addCurrentVertex(ah,Dh,Sd,vd,eh),hd==="fakeround"){const Jp=Math.round(180*Mp/Math.PI/20);for(let Xd=1;Xd<Jp;Xd++){let Ud=Xd/Jp;if(Ud!==.5){const Wg=Ud-.5;Ud+=Ud*Wg*(Ud-1)*((1.0904+qh*(qh*(3.55645-1.43519*qh)-3.2452))*Wg*Wg+(.848013+qh*(.215638*qh-1.06021)))}const ag=Ph.sub(Dh)._mult(Ud)._add(Dh)._unit()._mult(bd?-1:1);this.addHalfVertex(ah,ag.x,ag.y,!1,bd,0,eh)}}dh&&this.addCurrentVertex(ah,Ph,-Sd,-vd,eh)}else if(hd==="butt")this.addCurrentVertex(ah,Qh,0,0,eh);else if(hd==="square"){const ld=ch?1:-1;this.addCurrentVertex(ah,Qh,ld,ld,eh)}else hd==="round"&&(ch&&(this.addCurrentVertex(ah,Dh,0,0,eh),this.addCurrentVertex(ah,Dh,1,1,eh,!0)),dh&&(this.addCurrentVertex(ah,Ph,-1,-1,eh,!0),this.addCurrentVertex(ah,Ph,0,0,eh)));if(Md&&Xh<So-1){const ld=ah.dist(dh);if(ld>2*hl){const Sd=ah.add(dh.sub(ah)._mult(hl/ld)._round());this.updateDistance(ah,Sd),this.addCurrentVertex(Sd,Ph,0,0,eh),ah=Sd}}}}addCurrentVertex(g,S,W,ut,Ht,Jt=!1){const In=S.y*ut-S.x,So=-S.y-S.x*ut;this.addHalfVertex(g,S.x+S.y*W,S.y-S.x*W,Jt,!1,W,Ht),this.addHalfVertex(g,In,So,Jt,!0,-ut,Ht),this.distance>tb/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(g,S,W,ut,Ht,Jt))}addHalfVertex({x:g,y:S},W,ut,Ht,Jt,In,So){const al=.5*(this.lineClips?this.scaledDistance*(tb-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((g<<1)+(Ht?1:0),(S<<1)+(Jt?1:0),Math.round(63*W)+128,Math.round(63*ut)+128,1+(In===0?0:In<0?-1:1)|(63&al)<<2,al>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const hl=So.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,hl),So.primitiveLength++),Jt?this.e2=hl:this.e1=hl}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(g,S){this.distance+=g.dist(S),this.updateScaledDistance()}}let u1,c1;Td("LineBucket",Mx,{omit:["layers","patternFeatures"]});var h1={get paint(){return c1=c1||new Am({"line-opacity":new Kd(Yh.paint_line["line-opacity"]),"line-color":new Kd(Yh.paint_line["line-color"]),"line-translate":new Nd(Yh.paint_line["line-translate"]),"line-translate-anchor":new Nd(Yh.paint_line["line-translate-anchor"]),"line-width":new Kd(Yh.paint_line["line-width"]),"line-gap-width":new Kd(Yh.paint_line["line-gap-width"]),"line-offset":new Kd(Yh.paint_line["line-offset"]),"line-blur":new Kd(Yh.paint_line["line-blur"]),"line-dasharray":new jv(Yh.paint_line["line-dasharray"]),"line-pattern":new nv(Yh.paint_line["line-pattern"]),"line-gradient":new tx(Yh.paint_line["line-gradient"])})},get layout(){return u1=u1||new Am({"line-cap":new Nd(Yh.layout_line["line-cap"]),"line-join":new Kd(Yh.layout_line["line-join"]),"line-miter-limit":new Nd(Yh.layout_line["line-miter-limit"]),"line-round-limit":new Nd(Yh.layout_line["line-round-limit"]),"line-sort-key":new Kd(Yh.layout_line["line-sort-key"])})}};class by extends Kd{possiblyEvaluate(g,S){return S=new Eg(Math.floor(S.zoom),{now:S.now,fadeDuration:S.fadeDuration,zoomHistory:S.zoomHistory,transition:S.transition}),super.possiblyEvaluate(g,S)}evaluate(g,S,W,ut){return S=vi({},S,{zoom:Math.floor(S.zoom)}),super.evaluate(g,S,W,ut)}}let Xx;function rb(x,g){return g>0?g+2*x:x}const e0=Jg([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),nE=Jg([{name:"a_projected_pos",components:3,type:"Float32"}],4);Jg([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Dx=Jg([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Jg([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Yx=Jg([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),I_=Jg([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function P_(x,g,S){return x.sections.forEach(W=>{W.text=function(ut,Ht,Jt){const In=Ht.layout.get("text-transform").evaluate(Jt,{});return In==="uppercase"?ut=ut.toLocaleUpperCase():In==="lowercase"&&(ut=ut.toLocaleLowerCase()),Bm.applyArabicShaping&&(ut=Bm.applyArabicShaping(ut)),ut}(W.text,g,S)}),x}Jg([{name:"triangle",components:3,type:"Uint16"}]),Jg([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Jg([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Jg([{type:"Float32",name:"offsetX"}]),Jg([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Fw={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var mm=24,ib=cg,rC=function(x,g,S,W,ut){var Ht,Jt,In=8*ut-W-1,So=(1<<In)-1,al=So>>1,hl=-7,eh=S?ut-1:0,ah=S?-1:1,ch=x[g+eh];for(eh+=ah,Ht=ch&(1<<-hl)-1,ch>>=-hl,hl+=In;hl>0;Ht=256*Ht+x[g+eh],eh+=ah,hl-=8);for(Jt=Ht&(1<<-hl)-1,Ht>>=-hl,hl+=W;hl>0;Jt=256*Jt+x[g+eh],eh+=ah,hl-=8);if(Ht===0)Ht=1-al;else{if(Ht===So)return Jt?NaN:1/0*(ch?-1:1);Jt+=Math.pow(2,W),Ht-=al}return(ch?-1:1)*Jt*Math.pow(2,Ht-W)},p1=function(x,g,S,W,ut,Ht){var Jt,In,So,al=8*Ht-ut-1,hl=(1<<al)-1,eh=hl>>1,ah=ut===23?Math.pow(2,-24)-Math.pow(2,-77):0,ch=W?0:Ht-1,dh=W?1:-1,Dh=g<0||g===0&&1/g<0?1:0;for(g=Math.abs(g),isNaN(g)||g===1/0?(In=isNaN(g)?1:0,Jt=hl):(Jt=Math.floor(Math.log(g)/Math.LN2),g*(So=Math.pow(2,-Jt))<1&&(Jt--,So*=2),(g+=Jt+eh>=1?ah/So:ah*Math.pow(2,1-eh))*So>=2&&(Jt++,So/=2),Jt+eh>=hl?(In=0,Jt=hl):Jt+eh>=1?(In=(g*So-1)*Math.pow(2,ut),Jt+=eh):(In=g*Math.pow(2,eh-1)*Math.pow(2,ut),Jt=0));ut>=8;x[S+ch]=255&In,ch+=dh,In/=256,ut-=8);for(Jt=Jt<<ut|In,al+=ut;al>0;x[S+ch]=255&Jt,ch+=dh,Jt/=256,al-=8);x[S+ch-dh]|=128*Dh};function cg(x){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(x)?x:new Uint8Array(x||0),this.pos=0,this.type=0,this.length=this.buf.length}cg.Varint=0,cg.Fixed64=1,cg.Bytes=2,cg.Fixed32=5;var A0=4294967296,nb=1/A0,ob=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function R0(x){return x.type===cg.Bytes?x.readVarint()+x.pos:x.pos+1}function I0(x,g,S){return S?4294967296*g+(x>>>0):4294967296*(g>>>0)+(x>>>0)}function d1(x,g,S){var W=g<=16383?1:g<=2097151?2:g<=268435455?3:Math.floor(Math.log(g)/(7*Math.LN2));S.realloc(W);for(var ut=S.pos-1;ut>=x;ut--)S.buf[ut+W]=S.buf[ut]}function Jx(x,g){for(var S=0;S<x.length;S++)g.writeVarint(x[S])}function Qx(x,g){for(var S=0;S<x.length;S++)g.writeSVarint(x[S])}function Nw(x,g){for(var S=0;S<x.length;S++)g.writeFloat(x[S])}function f1(x,g){for(var S=0;S<x.length;S++)g.writeDouble(x[S])}function iC(x,g){for(var S=0;S<x.length;S++)g.writeBoolean(x[S])}function kw(x,g){for(var S=0;S<x.length;S++)g.writeFixed32(x[S])}function sb(x,g){for(var S=0;S<x.length;S++)g.writeSFixed32(x[S])}function nC(x,g){for(var S=0;S<x.length;S++)g.writeFixed64(x[S])}function ew(x,g){for(var S=0;S<x.length;S++)g.writeSFixed64(x[S])}function Bw(x,g){return(x[g]|x[g+1]<<8|x[g+2]<<16)+16777216*x[g+3]}function lx(x,g,S){x[S]=g,x[S+1]=g>>>8,x[S+2]=g>>>16,x[S+3]=g>>>24}function ab(x,g){return(x[g]|x[g+1]<<8|x[g+2]<<16)+(x[g+3]<<24)}cg.prototype={destroy:function(){this.buf=null},readFields:function(x,g,S){for(S=S||this.length;this.pos<S;){var W=this.readVarint(),ut=W>>3,Ht=this.pos;this.type=7&W,x(ut,g,this),this.pos===Ht&&this.skip(W)}return g},readMessage:function(x,g){return this.readFields(x,g,this.readVarint()+this.pos)},readFixed32:function(){var x=Bw(this.buf,this.pos);return this.pos+=4,x},readSFixed32:function(){var x=ab(this.buf,this.pos);return this.pos+=4,x},readFixed64:function(){var x=Bw(this.buf,this.pos)+Bw(this.buf,this.pos+4)*A0;return this.pos+=8,x},readSFixed64:function(){var x=Bw(this.buf,this.pos)+ab(this.buf,this.pos+4)*A0;return this.pos+=8,x},readFloat:function(){var x=rC(this.buf,this.pos,!0,23,4);return this.pos+=4,x},readDouble:function(){var x=rC(this.buf,this.pos,!0,52,8);return this.pos+=8,x},readVarint:function(x){var g,S,W=this.buf;return g=127&(S=W[this.pos++]),S<128?g:(g|=(127&(S=W[this.pos++]))<<7,S<128?g:(g|=(127&(S=W[this.pos++]))<<14,S<128?g:(g|=(127&(S=W[this.pos++]))<<21,S<128?g:function(ut,Ht,Jt){var In,So,al=Jt.buf;if(In=(112&(So=al[Jt.pos++]))>>4,So<128||(In|=(127&(So=al[Jt.pos++]))<<3,So<128)||(In|=(127&(So=al[Jt.pos++]))<<10,So<128)||(In|=(127&(So=al[Jt.pos++]))<<17,So<128)||(In|=(127&(So=al[Jt.pos++]))<<24,So<128)||(In|=(1&(So=al[Jt.pos++]))<<31,So<128))return I0(ut,In,Ht);throw new Error("Expected varint not more than 10 bytes")}(g|=(15&(S=W[this.pos]))<<28,x,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var x=this.readVarint();return x%2==1?(x+1)/-2:x/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var x=this.readVarint()+this.pos,g=this.pos;return this.pos=x,x-g>=12&&ob?function(S,W,ut){return ob.decode(S.subarray(W,ut))}(this.buf,g,x):function(S,W,ut){for(var Ht="",Jt=W;Jt<ut;){var In,So,al,hl=S[Jt],eh=null,ah=hl>239?4:hl>223?3:hl>191?2:1;if(Jt+ah>ut)break;ah===1?hl<128&&(eh=hl):ah===2?(192&(In=S[Jt+1]))==128&&(eh=(31&hl)<<6|63&In)<=127&&(eh=null):ah===3?(So=S[Jt+2],(192&(In=S[Jt+1]))==128&&(192&So)==128&&((eh=(15&hl)<<12|(63&In)<<6|63&So)<=2047||eh>=55296&&eh<=57343)&&(eh=null)):ah===4&&(So=S[Jt+2],al=S[Jt+3],(192&(In=S[Jt+1]))==128&&(192&So)==128&&(192&al)==128&&((eh=(15&hl)<<18|(63&In)<<12|(63&So)<<6|63&al)<=65535||eh>=1114112)&&(eh=null)),eh===null?(eh=65533,ah=1):eh>65535&&(eh-=65536,Ht+=String.fromCharCode(eh>>>10&1023|55296),eh=56320|1023&eh),Ht+=String.fromCharCode(eh),Jt+=ah}return Ht}(this.buf,g,x)},readBytes:function(){var x=this.readVarint()+this.pos,g=this.buf.subarray(this.pos,x);return this.pos=x,g},readPackedVarint:function(x,g){if(this.type!==cg.Bytes)return x.push(this.readVarint(g));var S=R0(this);for(x=x||[];this.pos<S;)x.push(this.readVarint(g));return x},readPackedSVarint:function(x){if(this.type!==cg.Bytes)return x.push(this.readSVarint());var g=R0(this);for(x=x||[];this.pos<g;)x.push(this.readSVarint());return x},readPackedBoolean:function(x){if(this.type!==cg.Bytes)return x.push(this.readBoolean());var g=R0(this);for(x=x||[];this.pos<g;)x.push(this.readBoolean());return x},readPackedFloat:function(x){if(this.type!==cg.Bytes)return x.push(this.readFloat());var g=R0(this);for(x=x||[];this.pos<g;)x.push(this.readFloat());return x},readPackedDouble:function(x){if(this.type!==cg.Bytes)return x.push(this.readDouble());var g=R0(this);for(x=x||[];this.pos<g;)x.push(this.readDouble());return x},readPackedFixed32:function(x){if(this.type!==cg.Bytes)return x.push(this.readFixed32());var g=R0(this);for(x=x||[];this.pos<g;)x.push(this.readFixed32());return x},readPackedSFixed32:function(x){if(this.type!==cg.Bytes)return x.push(this.readSFixed32());var g=R0(this);for(x=x||[];this.pos<g;)x.push(this.readSFixed32());return x},readPackedFixed64:function(x){if(this.type!==cg.Bytes)return x.push(this.readFixed64());var g=R0(this);for(x=x||[];this.pos<g;)x.push(this.readFixed64());return x},readPackedSFixed64:function(x){if(this.type!==cg.Bytes)return x.push(this.readSFixed64());var g=R0(this);for(x=x||[];this.pos<g;)x.push(this.readSFixed64());return x},skip:function(x){var g=7&x;if(g===cg.Varint)for(;this.buf[this.pos++]>127;);else if(g===cg.Bytes)this.pos=this.readVarint()+this.pos;else if(g===cg.Fixed32)this.pos+=4;else{if(g!==cg.Fixed64)throw new Error("Unimplemented type: "+g);this.pos+=8}},writeTag:function(x,g){this.writeVarint(x<<3|g)},realloc:function(x){for(var g=this.length||16;g<this.pos+x;)g*=2;if(g!==this.length){var S=new Uint8Array(g);S.set(this.buf),this.buf=S,this.length=g}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(x){this.realloc(4),lx(this.buf,x,this.pos),this.pos+=4},writeSFixed32:function(x){this.realloc(4),lx(this.buf,x,this.pos),this.pos+=4},writeFixed64:function(x){this.realloc(8),lx(this.buf,-1&x,this.pos),lx(this.buf,Math.floor(x*nb),this.pos+4),this.pos+=8},writeSFixed64:function(x){this.realloc(8),lx(this.buf,-1&x,this.pos),lx(this.buf,Math.floor(x*nb),this.pos+4),this.pos+=8},writeVarint:function(x){(x=+x||0)>268435455||x<0?function(g,S){var W,ut;if(g>=0?(W=g%4294967296|0,ut=g/4294967296|0):(ut=~(-g/4294967296),4294967295^(W=~(-g%4294967296))?W=W+1|0:(W=0,ut=ut+1|0)),g>=18446744073709552e3||g<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");S.realloc(10),function(Ht,Jt,In){In.buf[In.pos++]=127&Ht|128,Ht>>>=7,In.buf[In.pos++]=127&Ht|128,Ht>>>=7,In.buf[In.pos++]=127&Ht|128,Ht>>>=7,In.buf[In.pos++]=127&Ht|128,In.buf[In.pos]=127&(Ht>>>=7)}(W,0,S),function(Ht,Jt){var In=(7&Ht)<<4;Jt.buf[Jt.pos++]|=In|((Ht>>>=3)?128:0),Ht&&(Jt.buf[Jt.pos++]=127&Ht|((Ht>>>=7)?128:0),Ht&&(Jt.buf[Jt.pos++]=127&Ht|((Ht>>>=7)?128:0),Ht&&(Jt.buf[Jt.pos++]=127&Ht|((Ht>>>=7)?128:0),Ht&&(Jt.buf[Jt.pos++]=127&Ht|((Ht>>>=7)?128:0),Ht&&(Jt.buf[Jt.pos++]=127&Ht)))))}(ut,S)}(x,this):(this.realloc(4),this.buf[this.pos++]=127&x|(x>127?128:0),x<=127||(this.buf[this.pos++]=127&(x>>>=7)|(x>127?128:0),x<=127||(this.buf[this.pos++]=127&(x>>>=7)|(x>127?128:0),x<=127||(this.buf[this.pos++]=x>>>7&127))))},writeSVarint:function(x){this.writeVarint(x<0?2*-x-1:2*x)},writeBoolean:function(x){this.writeVarint(!!x)},writeString:function(x){x=String(x),this.realloc(4*x.length),this.pos++;var g=this.pos;this.pos=function(W,ut,Ht){for(var Jt,In,So=0;So<ut.length;So++){if((Jt=ut.charCodeAt(So))>55295&&Jt<57344){if(!In){Jt>56319||So+1===ut.length?(W[Ht++]=239,W[Ht++]=191,W[Ht++]=189):In=Jt;continue}if(Jt<56320){W[Ht++]=239,W[Ht++]=191,W[Ht++]=189,In=Jt;continue}Jt=In-55296<<10|Jt-56320|65536,In=null}else In&&(W[Ht++]=239,W[Ht++]=191,W[Ht++]=189,In=null);Jt<128?W[Ht++]=Jt:(Jt<2048?W[Ht++]=Jt>>6|192:(Jt<65536?W[Ht++]=Jt>>12|224:(W[Ht++]=Jt>>18|240,W[Ht++]=Jt>>12&63|128),W[Ht++]=Jt>>6&63|128),W[Ht++]=63&Jt|128)}return Ht}(this.buf,x,this.pos);var S=this.pos-g;S>=128&&d1(g,S,this),this.pos=g-1,this.writeVarint(S),this.pos+=S},writeFloat:function(x){this.realloc(4),p1(this.buf,x,this.pos,!0,23,4),this.pos+=4},writeDouble:function(x){this.realloc(8),p1(this.buf,x,this.pos,!0,52,8),this.pos+=8},writeBytes:function(x){var g=x.length;this.writeVarint(g),this.realloc(g);for(var S=0;S<g;S++)this.buf[this.pos++]=x[S]},writeRawMessage:function(x,g){this.pos++;var S=this.pos;x(g,this);var W=this.pos-S;W>=128&&d1(S,W,this),this.pos=S-1,this.writeVarint(W),this.pos+=W},writeMessage:function(x,g,S){this.writeTag(x,cg.Bytes),this.writeRawMessage(g,S)},writePackedVarint:function(x,g){g.length&&this.writeMessage(x,Jx,g)},writePackedSVarint:function(x,g){g.length&&this.writeMessage(x,Qx,g)},writePackedBoolean:function(x,g){g.length&&this.writeMessage(x,iC,g)},writePackedFloat:function(x,g){g.length&&this.writeMessage(x,Nw,g)},writePackedDouble:function(x,g){g.length&&this.writeMessage(x,f1,g)},writePackedFixed32:function(x,g){g.length&&this.writeMessage(x,kw,g)},writePackedSFixed32:function(x,g){g.length&&this.writeMessage(x,sb,g)},writePackedFixed64:function(x,g){g.length&&this.writeMessage(x,nC,g)},writePackedSFixed64:function(x,g){g.length&&this.writeMessage(x,ew,g)},writeBytesField:function(x,g){this.writeTag(x,cg.Bytes),this.writeBytes(g)},writeFixed32Field:function(x,g){this.writeTag(x,cg.Fixed32),this.writeFixed32(g)},writeSFixed32Field:function(x,g){this.writeTag(x,cg.Fixed32),this.writeSFixed32(g)},writeFixed64Field:function(x,g){this.writeTag(x,cg.Fixed64),this.writeFixed64(g)},writeSFixed64Field:function(x,g){this.writeTag(x,cg.Fixed64),this.writeSFixed64(g)},writeVarintField:function(x,g){this.writeTag(x,cg.Varint),this.writeVarint(g)},writeSVarintField:function(x,g){this.writeTag(x,cg.Varint),this.writeSVarint(g)},writeStringField:function(x,g){this.writeTag(x,cg.Bytes),this.writeString(g)},writeFloatField:function(x,g){this.writeTag(x,cg.Fixed32),this.writeFloat(g)},writeDoubleField:function(x,g){this.writeTag(x,cg.Fixed64),this.writeDouble(g)},writeBooleanField:function(x,g){this.writeVarintField(x,!!g)}};var lb=h(ib);const ub=3;function zw(x,g,S){x===1&&S.readMessage(oC,g)}function oC(x,g,S){if(x===3){const{id:W,bitmap:ut,width:Ht,height:Jt,left:In,top:So,advance:al}=S.readMessage(ux,{});g.push({id:W,bitmap:new Hx({width:Ht+2*ub,height:Jt+2*ub},ut),metrics:{width:Ht,height:Jt,left:In,top:So,advance:al}})}}function ux(x,g,S){x===1?g.id=S.readVarint():x===2?g.bitmap=S.readBytes():x===3?g.width=S.readVarint():x===4?g.height=S.readVarint():x===5?g.left=S.readSVarint():x===6?g.top=S.readSVarint():x===7&&(g.advance=S.readVarint())}const Rg=ub;function g1(x){let g=0,S=0;for(const Jt of x)g+=Jt.w*Jt.h,S=Math.max(S,Jt.w);x.sort((Jt,In)=>In.h-Jt.h);const W=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(g/.95)),S),h:1/0}];let ut=0,Ht=0;for(const Jt of x)for(let In=W.length-1;In>=0;In--){const So=W[In];if(!(Jt.w>So.w||Jt.h>So.h)){if(Jt.x=So.x,Jt.y=So.y,Ht=Math.max(Ht,Jt.y+Jt.h),ut=Math.max(ut,Jt.x+Jt.w),Jt.w===So.w&&Jt.h===So.h){const al=W.pop();In<W.length&&(W[In]=al)}else Jt.h===So.h?(So.x+=Jt.w,So.w-=Jt.w):Jt.w===So.w?(So.y+=Jt.h,So.h-=Jt.h):(W.push({x:So.x+Jt.w,y:So.y,w:So.w-Jt.w,h:Jt.h}),So.y+=Jt.h,So.h-=Jt.h);break}}return{w:ut,h:Ht,fill:g/(ut*Ht)||0}}const am=1;class M_{constructor(g,{pixelRatio:S,version:W,stretchX:ut,stretchY:Ht,content:Jt}){this.paddedRect=g,this.pixelRatio=S,this.stretchX=ut,this.stretchY=Ht,this.content=Jt,this.version=W}get tl(){return[this.paddedRect.x+am,this.paddedRect.y+am]}get br(){return[this.paddedRect.x+this.paddedRect.w-am,this.paddedRect.y+this.paddedRect.h-am]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*am)/this.pixelRatio,(this.paddedRect.h-2*am)/this.pixelRatio]}}class D_{constructor(g,S){const W={},ut={};this.haveRenderCallbacks=[];const Ht=[];this.addImages(g,W,Ht),this.addImages(S,ut,Ht);const{w:Jt,h:In}=g1(Ht),So=new n_({width:Jt||1,height:In||1});for(const al in g){const hl=g[al],eh=W[al].paddedRect;n_.copy(hl.data,So,{x:0,y:0},{x:eh.x+am,y:eh.y+am},hl.data)}for(const al in S){const hl=S[al],eh=ut[al].paddedRect,ah=eh.x+am,ch=eh.y+am,dh=hl.data.width,Dh=hl.data.height;n_.copy(hl.data,So,{x:0,y:0},{x:ah,y:ch},hl.data),n_.copy(hl.data,So,{x:0,y:Dh-1},{x:ah,y:ch-1},{width:dh,height:1}),n_.copy(hl.data,So,{x:0,y:0},{x:ah,y:ch+Dh},{width:dh,height:1}),n_.copy(hl.data,So,{x:dh-1,y:0},{x:ah-1,y:ch},{width:1,height:Dh}),n_.copy(hl.data,So,{x:0,y:0},{x:ah+dh,y:ch},{width:1,height:Dh})}this.image=So,this.iconPositions=W,this.patternPositions=ut}addImages(g,S,W){for(const ut in g){const Ht=g[ut],Jt={x:0,y:0,w:Ht.data.width+2*am,h:Ht.data.height+2*am};W.push(Jt),S[ut]=new M_(Jt,Ht),Ht.hasRenderCallback&&this.haveRenderCallbacks.push(ut)}}patchUpdatedImages(g,S){g.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const W in g.updatedImages)this.patchUpdatedImage(this.iconPositions[W],g.getImage(W),S),this.patchUpdatedImage(this.patternPositions[W],g.getImage(W),S)}patchUpdatedImage(g,S,W){if(!g||!S||g.version===S.version)return;g.version=S.version;const[ut,Ht]=g.tl;W.update(S.data,void 0,{x:ut,y:Ht})}}var zm;Td("ImagePosition",M_),Td("ImageAtlas",D_),a.WritingMode=void 0,(zm=a.WritingMode||(a.WritingMode={}))[zm.none=0]="none",zm[zm.horizontal=1]="horizontal",zm[zm.vertical=2]="vertical",zm[zm.horizontalOnly=3]="horizontalOnly";const bm=-17;class tw{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(g,S){const W=new tw;return W.scale=g||1,W.fontStack=S,W}static forImage(g){const S=new tw;return S.imageName=g,S}}class ym{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(g,S){const W=new ym;for(let ut=0;ut<g.sections.length;ut++){const Ht=g.sections[ut];Ht.image?W.addImageSection(Ht):W.addTextSection(Ht,S)}return W}length(){return this.text.length}getSection(g){return this.sections[this.sectionIndex[g]]}getSectionIndex(g){return this.sectionIndex[g]}getCharCode(g){return this.text.charCodeAt(g)}verticalizePunctuation(){this.text=function(g){let S="";for(let W=0;W<g.length;W++){const ut=g.charCodeAt(W+1)||null,Ht=g.charCodeAt(W-1)||null;S+=ut&&_0(ut)&&!Fw[g[W+1]]||Ht&&_0(Ht)&&!Fw[g[W-1]]||!Fw[g[W]]?g[W]:Fw[g[W]]}return S}(this.text)}trim(){let g=0;for(let W=0;W<this.text.length&&P0[this.text.charCodeAt(W)];W++)g++;let S=this.text.length;for(let W=this.text.length-1;W>=0&&W>=g&&P0[this.text.charCodeAt(W)];W--)S--;this.text=this.text.substring(g,S),this.sectionIndex=this.sectionIndex.slice(g,S)}substring(g,S){const W=new ym;return W.text=this.text.substring(g,S),W.sectionIndex=this.sectionIndex.slice(g,S),W.sections=this.sections,W}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((g,S)=>Math.max(g,this.sections[S].scale),0)}addTextSection(g,S){this.text+=g.text,this.sections.push(tw.forText(g.scale,g.fontStack||S));const W=this.sections.length-1;for(let ut=0;ut<g.text.length;++ut)this.sectionIndex.push(W)}addImageSection(g){const S=g.image?g.image.name:"";if(S.length===0)return void ol("Can't add FormattedSection with an empty image.");const W=this.getNextImageSectionCharCode();W?(this.text+=String.fromCharCode(W),this.sections.push(tw.forImage(S)),this.sectionIndex.push(this.sections.length-1)):ol("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Gw(x,g,S,W,ut,Ht,Jt,In,So,al,hl,eh,ah,ch,dh,Dh){const Ph=ym.fromFeature(x,ut);let Xh;eh===a.WritingMode.vertical&&Ph.verticalizePunctuation();const{processBidirectionalText:Qh,processStyledBidirectionalText:qh}=Bm;if(Qh&&Ph.sections.length===1){Xh=[];const Mp=Qh(Ph.toString(),db(Ph,al,Ht,g,W,ch,dh));for(const Md of Mp){const bd=new ym;bd.text=Md,bd.sections=Ph.sections;for(let _d=0;_d<Md.length;_d++)bd.sectionIndex.push(0);Xh.push(bd)}}else if(qh){Xh=[];const Mp=qh(Ph.text,Ph.sectionIndex,db(Ph,al,Ht,g,W,ch,dh));for(const Md of Mp){const bd=new ym;bd.text=Md[0],bd.sectionIndex=Md[1],bd.sections=Ph.sections,Xh.push(bd)}}else Xh=function(Mp,Md){const bd=[],_d=Mp.text;let hd=0;for(const ld of Md)bd.push(Mp.substring(hd,ld)),hd=ld;return hd<_d.length&&bd.push(Mp.substring(hd,_d.length)),bd}(Ph,db(Ph,al,Ht,g,W,ch,dh));const lp=[],dp={positionedLines:lp,text:Ph.toString(),top:hl[1],bottom:hl[1],left:hl[0],right:hl[0],writingMode:eh,iconsInText:!1,verticalizable:!1};return function(Mp,Md,bd,_d,hd,ld,Sd,vd,Jp,Xd,Ud,ag){let Wg=0,Zg=bm,um=0,s_=0;const jm=vd==="right"?1:vd==="left"?0:.5;let _m=0;for(const Cm of hd){Cm.trim();const ey=Cm.getMaxScale(),ty=(ey-1)*mm,Cy={positionedGlyphs:[],lineOffset:0};Mp.positionedLines[_m]=Cy;const Ig=Cy.positionedGlyphs;let rm=0;if(!Cm.length()){Zg+=ld,++_m;continue}for(let Im=0;Im<Cm.length();Im++){const tg=Cm.getSection(Im),jy=Cm.getSectionIndex(Im),ry=Cm.getCharCode(Im);let Pm=0,O_=null,yv=null,L_=null,i0=mm;const a_=!(Jp===a.WritingMode.horizontal||!Ud&&!t_(ry)||Ud&&(P0[ry]||(Rm=ry,sd.Arabic(Rm)||sd["Arabic Supplement"](Rm)||sd["Arabic Extended-A"](Rm)||sd["Arabic Presentation Forms-A"](Rm)||sd["Arabic Presentation Forms-B"](Rm))));if(tg.imageName){const sg=_d[tg.imageName];if(!sg)continue;L_=tg.imageName,Mp.iconsInText=Mp.iconsInText||!0,yv=sg.paddedRect;const py=sg.displaySize;tg.scale=tg.scale*mm/ag,O_={width:py[0],height:py[1],left:am,top:-Rg,advance:a_?py[1]:py[0]},Pm=ty+(mm-py[1]*tg.scale),i0=O_.advance;const n0=a_?py[0]*tg.scale-mm*ey:py[1]*tg.scale-mm*ey;n0>0&&n0>rm&&(rm=n0)}else{const sg=bd[tg.fontStack],py=sg&&sg[ry];if(py&&py.rect)yv=py.rect,O_=py.metrics;else{const n0=Md[tg.fontStack],uw=n0&&n0[ry];if(!uw)continue;O_=uw.metrics}Pm=(ey-tg.scale)*mm}a_?(Mp.verticalizable=!0,Ig.push({glyph:ry,imageName:L_,x:Wg,y:Zg+Pm,vertical:a_,scale:tg.scale,fontStack:tg.fontStack,sectionIndex:jy,metrics:O_,rect:yv}),Wg+=i0*tg.scale+Xd):(Ig.push({glyph:ry,imageName:L_,x:Wg,y:Zg+Pm,vertical:a_,scale:tg.scale,fontStack:tg.fontStack,sectionIndex:jy,metrics:O_,rect:yv}),Wg+=O_.advance*tg.scale+Xd)}Ig.length!==0&&(um=Math.max(Wg-Xd,um),Ox(Ig,0,Ig.length-1,jm,rm)),Wg=0;const Qg=ld*ey+rm;Cy.lineOffset=Math.max(rm,ty),Zg+=Qg,s_=Math.max(Qg,s_),++_m}var Rm;const Qm=Zg-bm,{horizontalAlign:hy,verticalAlign:Dy}=fv(Sd);(function(Cm,ey,ty,Cy,Ig,rm,Qg,Im,tg){const jy=(ey-ty)*Ig;let ry=0;ry=rm!==Qg?-Im*Cy-bm:(-Cy*tg+.5)*Qg;for(const Pm of Cm)for(const O_ of Pm.positionedGlyphs)O_.x+=jy,O_.y+=ry})(Mp.positionedLines,jm,hy,Dy,um,s_,ld,Qm,hd.length),Mp.top+=-Dy*Qm,Mp.bottom=Mp.top+Qm,Mp.left+=-hy*um,Mp.right=Mp.left+um}(dp,g,S,W,Xh,Jt,In,So,eh,al,ah,Dh),!function(Mp){for(const Md of Mp)if(Md.positionedGlyphs.length!==0)return!1;return!0}(lp)&&dp}const P0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},cb={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function hb(x,g,S,W,ut,Ht){if(g.imageName){const Jt=W[g.imageName];return Jt?Jt.displaySize[0]*g.scale*mm/Ht+ut:0}{const Jt=S[g.fontStack],In=Jt&&Jt[x];return In?In.metrics.advance*g.scale+ut:0}}function m1(x,g,S,W){const ut=Math.pow(x-g,2);return W?x<g?ut/2:2*ut:ut+Math.abs(S)*S}function oE(x,g,S){let W=0;return x===10&&(W-=1e4),S&&(W+=150),x!==40&&x!==65288||(W+=50),g!==41&&g!==65289||(W+=50),W}function y1(x,g,S,W,ut,Ht){let Jt=null,In=m1(g,S,ut,Ht);for(const So of W){const al=m1(g-So.x,S,ut,Ht)+So.badness;al<=In&&(Jt=So,In=al)}return{index:x,x:g,priorBreak:Jt,badness:In}}function pb(x){return x?pb(x.priorBreak).concat(x.index):[]}function db(x,g,S,W,ut,Ht,Jt){if(Ht!=="point")return[];if(!x)return[];const In=[],So=function(ah,ch,dh,Dh,Ph,Xh){let Qh=0;for(let qh=0;qh<ah.length();qh++){const lp=ah.getSection(qh);Qh+=hb(ah.getCharCode(qh),lp,Dh,Ph,ch,Xh)}return Qh/Math.max(1,Math.ceil(Qh/dh))}(x,g,S,W,ut,Jt),al=x.text.indexOf("​")>=0;let hl=0;for(let ah=0;ah<x.length();ah++){const ch=x.getSection(ah),dh=x.getCharCode(ah);if(P0[dh]||(hl+=hb(dh,ch,W,ut,g,Jt)),ah<x.length()-1){const Dh=!((eh=dh)<11904||!(sd["Bopomofo Extended"](eh)||sd.Bopomofo(eh)||sd["CJK Compatibility Forms"](eh)||sd["CJK Compatibility Ideographs"](eh)||sd["CJK Compatibility"](eh)||sd["CJK Radicals Supplement"](eh)||sd["CJK Strokes"](eh)||sd["CJK Symbols and Punctuation"](eh)||sd["CJK Unified Ideographs Extension A"](eh)||sd["CJK Unified Ideographs"](eh)||sd["Enclosed CJK Letters and Months"](eh)||sd["Halfwidth and Fullwidth Forms"](eh)||sd.Hiragana(eh)||sd["Ideographic Description Characters"](eh)||sd["Kangxi Radicals"](eh)||sd["Katakana Phonetic Extensions"](eh)||sd.Katakana(eh)||sd["Vertical Forms"](eh)||sd["Yi Radicals"](eh)||sd["Yi Syllables"](eh)));(cb[dh]||Dh||ch.imageName)&&In.push(y1(ah+1,hl,So,In,oE(dh,x.getCharCode(ah+1),Dh&&al),!1))}}var eh;return pb(y1(x.length(),hl,So,In,0,!0))}function fv(x){let g=.5,S=.5;switch(x){case"right":case"top-right":case"bottom-right":g=1;break;case"left":case"top-left":case"bottom-left":g=0}switch(x){case"bottom":case"bottom-right":case"bottom-left":S=1;break;case"top":case"top-right":case"top-left":S=0}return{horizontalAlign:g,verticalAlign:S}}function Ox(x,g,S,W,ut){if(!W&&!ut)return;const Ht=x[S],Jt=(x[S].x+Ht.metrics.advance*Ht.scale)*W;for(let In=g;In<=S;In++)x[In].x-=Jt,x[In].y+=ut}function _1(x,g,S){const{horizontalAlign:W,verticalAlign:ut}=fv(S),Ht=g[0]-x.displaySize[0]*W,Jt=g[1]-x.displaySize[1]*ut;return{image:x,top:Jt,bottom:Jt+x.displaySize[1],left:Ht,right:Ht+x.displaySize[0]}}function Vw(x,g,S,W,ut,Ht){const Jt=x.image;let In;if(Jt.content){const Ph=Jt.content,Xh=Jt.pixelRatio||1;In=[Ph[0]/Xh,Ph[1]/Xh,Jt.displaySize[0]-Ph[2]/Xh,Jt.displaySize[1]-Ph[3]/Xh]}const So=g.left*Ht,al=g.right*Ht;let hl,eh,ah,ch;S==="width"||S==="both"?(ch=ut[0]+So-W[3],eh=ut[0]+al+W[1]):(ch=ut[0]+(So+al-Jt.displaySize[0])/2,eh=ch+Jt.displaySize[0]);const dh=g.top*Ht,Dh=g.bottom*Ht;return S==="height"||S==="both"?(hl=ut[1]+dh-W[0],ah=ut[1]+Dh+W[2]):(hl=ut[1]+(dh+Dh-Jt.displaySize[1])/2,ah=hl+Jt.displaySize[1]),{image:Jt,top:hl,right:eh,bottom:ah,left:ch,collisionPadding:In}}const Lx=255,gv=128,cx=Lx*gv;function fb(x,g){const{expression:S}=g;if(S.kind==="constant")return{kind:"constant",layoutSize:S.evaluate(new Eg(x+1))};if(S.kind==="source")return{kind:"source"};{const{zoomStops:W,interpolationType:ut}=S;let Ht=0;for(;Ht<W.length&&W[Ht]<=x;)Ht++;Ht=Math.max(0,Ht-1);let Jt=Ht;for(;Jt<W.length&&W[Jt]<x+1;)Jt++;Jt=Math.min(W.length-1,Jt);const In=W[Ht],So=W[Jt];return S.kind==="composite"?{kind:"composite",minZoom:In,maxZoom:So,interpolationType:ut}:{kind:"camera",minZoom:In,maxZoom:So,minSize:S.evaluate(new Eg(In)),maxSize:S.evaluate(new Eg(So)),interpolationType:ut}}}function gb(x,g,S){let W="never";const ut=x.get(g);return ut?W=ut:x.get(S)&&(W="always"),W}const mb=A_.VectorTileFeature.types,sE=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function rw(x,g,S,W,ut,Ht,Jt,In,So,al,hl,eh,ah){const ch=In?Math.min(cx,Math.round(In[0])):0,dh=In?Math.min(cx,Math.round(In[1])):0;x.emplaceBack(g,S,Math.round(32*W),Math.round(32*ut),Ht,Jt,(ch<<1)+(So?1:0),dh,16*al,16*hl,256*eh,256*ah)}function v1(x,g,S){x.emplaceBack(g.x,g.y,S),x.emplaceBack(g.x,g.y,S),x.emplaceBack(g.x,g.y,S),x.emplaceBack(g.x,g.y,S)}function sC(x){for(const g of x.sections)if(Gv(g.text))return!0;return!1}class M0{constructor(g){this.layoutVertexArray=new op,this.indexArray=new Vp,this.programConfigurations=g,this.segments=new T,this.dynamicLayoutVertexArray=new yp,this.opacityVertexArray=new Np,this.hasVisibleVertices=!1,this.placedSymbolArray=new kn}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(g,S,W,ut){this.isEmpty()||(W&&(this.layoutVertexBuffer=g.createVertexBuffer(this.layoutVertexArray,e0.members),this.indexBuffer=g.createIndexBuffer(this.indexArray,S),this.dynamicLayoutVertexBuffer=g.createVertexBuffer(this.dynamicLayoutVertexArray,nE.members,!0),this.opacityVertexBuffer=g.createVertexBuffer(this.opacityVertexArray,sE,!0),this.opacityVertexBuffer.itemSize=1),(W||ut)&&this.programConfigurations.upload(g))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Td("SymbolBuffers",M0);class x1{constructor(g,S,W){this.layoutVertexArray=new g,this.layoutAttributes=S,this.indexArray=new W,this.segments=new T,this.collisionVertexArray=new td}upload(g){this.layoutVertexBuffer=g.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=g.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=g.createVertexBuffer(this.collisionVertexArray,Dx.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Td("CollisionBuffers",x1);class iw{constructor(g){this.collisionBoxArray=g.collisionBoxArray,this.zoom=g.zoom,this.overscaling=g.overscaling,this.layers=g.layers,this.layerIds=this.layers.map(Jt=>Jt.id),this.index=g.index,this.pixelRatio=g.pixelRatio,this.sourceLayerIndex=g.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Mg([]),this.placementViewportMatrix=Mg([]);const S=this.layers[0]._unevaluatedLayout._values;this.textSizeData=fb(this.zoom,S["text-size"]),this.iconSizeData=fb(this.zoom,S["icon-size"]);const W=this.layers[0].layout,ut=W.get("symbol-sort-key"),Ht=W.get("symbol-z-order");this.canOverlap=gb(W,"text-overlap","text-allow-overlap")!=="never"||gb(W,"icon-overlap","icon-allow-overlap")!=="never"||W.get("text-ignore-placement")||W.get("icon-ignore-placement"),this.sortFeaturesByKey=Ht!=="viewport-y"&&!ut.isConstant(),this.sortFeaturesByY=(Ht==="viewport-y"||Ht==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,W.get("symbol-placement")==="point"&&(this.writingModes=W.get("text-writing-mode").map(Jt=>a.WritingMode[Jt])),this.stateDependentLayerIds=this.layers.filter(Jt=>Jt.isStateDependent()).map(Jt=>Jt.id),this.sourceID=g.sourceID}createArrays(){this.text=new M0(new tp(this.layers,this.zoom,g=>/^text/.test(g))),this.icon=new M0(new tp(this.layers,this.zoom,g=>/^icon/.test(g))),this.glyphOffsetArray=new vs,this.lineVertexArray=new fl,this.symbolInstances=new ps}calculateGlyphDependencies(g,S,W,ut,Ht){for(let Jt=0;Jt<g.length;Jt++)if(S[g.charCodeAt(Jt)]=!0,(W||ut)&&Ht){const In=Fw[g.charAt(Jt)];In&&(S[In.charCodeAt(0)]=!0)}}populate(g,S,W){const ut=this.layers[0],Ht=ut.layout,Jt=Ht.get("text-font"),In=Ht.get("text-field"),So=Ht.get("icon-image"),al=(In.value.kind!=="constant"||In.value.value instanceof Bg&&!In.value.value.isEmpty()||In.value.value.toString().length>0)&&(Jt.value.kind!=="constant"||Jt.value.value.length>0),hl=So.value.kind!=="constant"||!!So.value.value||Object.keys(So.parameters).length>0,eh=Ht.get("symbol-sort-key");if(this.features=[],!al&&!hl)return;const ah=S.iconDependencies,ch=S.glyphDependencies,dh=S.availableImages,Dh=new Eg(this.zoom);for(const{feature:Ph,id:Xh,index:Qh,sourceLayerIndex:qh}of g){const lp=ut._featureFilter.needGeometry,dp=Pp(Ph,lp);if(!ut._featureFilter.filter(Dh,dp,W))continue;let Mp,Md;if(lp||(dp.geometry=Fp(Ph)),al){const _d=ut.getValueAndResolveTokens("text-field",dp,W,dh),hd=Bg.factory(_d);sC(hd)&&(this.hasRTLText=!0),(!this.hasRTLText||w_()==="unavailable"||this.hasRTLText&&Bm.isParsed())&&(Mp=P_(hd,ut,dp))}if(hl){const _d=ut.getValueAndResolveTokens("icon-image",dp,W,dh);Md=_d instanceof nm?_d:nm.fromString(_d)}if(!Mp&&!Md)continue;const bd=this.sortFeaturesByKey?eh.evaluate(dp,{},W):void 0;if(this.features.push({id:Xh,text:Mp,icon:Md,index:Qh,sourceLayerIndex:qh,geometry:dp.geometry,properties:Ph.properties,type:mb[Ph.type],sortKey:bd}),Md&&(ah[Md.name]=!0),Mp){const _d=Jt.evaluate(dp,{},W).join(","),hd=Ht.get("text-rotation-alignment")!=="viewport"&&Ht.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a.WritingMode.vertical)>=0;for(const ld of Mp.sections)if(ld.image)ah[ld.image.name]=!0;else{const Sd=__(Mp.toString()),vd=ld.fontStack||_d,Jp=ch[vd]=ch[vd]||{};this.calculateGlyphDependencies(ld.text,Jp,hd,this.allowVerticalPlacement,Sd)}}}Ht.get("symbol-placement")==="line"&&(this.features=function(Ph){const Xh={},Qh={},qh=[];let lp=0;function dp(_d){qh.push(Ph[_d]),lp++}function Mp(_d,hd,ld){const Sd=Qh[_d];return delete Qh[_d],Qh[hd]=Sd,qh[Sd].geometry[0].pop(),qh[Sd].geometry[0]=qh[Sd].geometry[0].concat(ld[0]),Sd}function Md(_d,hd,ld){const Sd=Xh[hd];return delete Xh[hd],Xh[_d]=Sd,qh[Sd].geometry[0].shift(),qh[Sd].geometry[0]=ld[0].concat(qh[Sd].geometry[0]),Sd}function bd(_d,hd,ld){const Sd=ld?hd[0][hd[0].length-1]:hd[0][0];return`${_d}:${Sd.x}:${Sd.y}`}for(let _d=0;_d<Ph.length;_d++){const hd=Ph[_d],ld=hd.geometry,Sd=hd.text?hd.text.toString():null;if(!Sd){dp(_d);continue}const vd=bd(Sd,ld),Jp=bd(Sd,ld,!0);if(vd in Qh&&Jp in Xh&&Qh[vd]!==Xh[Jp]){const Xd=Md(vd,Jp,ld),Ud=Mp(vd,Jp,qh[Xd].geometry);delete Xh[vd],delete Qh[Jp],Qh[bd(Sd,qh[Ud].geometry,!0)]=Ud,qh[Xd].geometry=null}else vd in Qh?Mp(vd,Jp,ld):Jp in Xh?Md(vd,Jp,ld):(dp(_d),Xh[vd]=lp-1,Qh[Jp]=lp-1)}return qh.filter(_d=>_d.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ph,Xh)=>Ph.sortKey-Xh.sortKey)}update(g,S,W){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(g,S,this.layers,W),this.icon.programConfigurations.updatePaintArrays(g,S,this.layers,W))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(g){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(g),this.iconCollisionBox.upload(g)),this.text.upload(g,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(g,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(g,S){const W=this.lineVertexArray.length;if(g.segment!==void 0){let ut=g.dist(S[g.segment+1]),Ht=g.dist(S[g.segment]);const Jt={};for(let In=g.segment+1;In<S.length;In++)Jt[In]={x:S[In].x,y:S[In].y,tileUnitDistanceFromAnchor:ut},In<S.length-1&&(ut+=S[In+1].dist(S[In]));for(let In=g.segment||0;In>=0;In--)Jt[In]={x:S[In].x,y:S[In].y,tileUnitDistanceFromAnchor:Ht},In>0&&(Ht+=S[In-1].dist(S[In]));for(let In=0;In<S.length;In++){const So=Jt[In];this.lineVertexArray.emplaceBack(So.x,So.y,So.tileUnitDistanceFromAnchor)}}return{lineStartIndex:W,lineLength:this.lineVertexArray.length-W}}addSymbols(g,S,W,ut,Ht,Jt,In,So,al,hl,eh,ah){const ch=g.indexArray,dh=g.layoutVertexArray,Dh=g.segments.prepareSegment(4*S.length,dh,ch,this.canOverlap?Jt.sortKey:void 0),Ph=this.glyphOffsetArray.length,Xh=Dh.vertexLength,Qh=this.allowVerticalPlacement&&In===a.WritingMode.vertical?Math.PI/2:0,qh=Jt.text&&Jt.text.sections;for(let lp=0;lp<S.length;lp++){const{tl:dp,tr:Mp,bl:Md,br:bd,tex:_d,pixelOffsetTL:hd,pixelOffsetBR:ld,minFontScaleX:Sd,minFontScaleY:vd,glyphOffset:Jp,isSDF:Xd,sectionIndex:Ud}=S[lp],ag=Dh.vertexLength,Wg=Jp[1];rw(dh,So.x,So.y,dp.x,Wg+dp.y,_d.x,_d.y,W,Xd,hd.x,hd.y,Sd,vd),rw(dh,So.x,So.y,Mp.x,Wg+Mp.y,_d.x+_d.w,_d.y,W,Xd,ld.x,hd.y,Sd,vd),rw(dh,So.x,So.y,Md.x,Wg+Md.y,_d.x,_d.y+_d.h,W,Xd,hd.x,ld.y,Sd,vd),rw(dh,So.x,So.y,bd.x,Wg+bd.y,_d.x+_d.w,_d.y+_d.h,W,Xd,ld.x,ld.y,Sd,vd),v1(g.dynamicLayoutVertexArray,So,Qh),ch.emplaceBack(ag,ag+1,ag+2),ch.emplaceBack(ag+1,ag+2,ag+3),Dh.vertexLength+=4,Dh.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Jp[0]),lp!==S.length-1&&Ud===S[lp+1].sectionIndex||g.programConfigurations.populatePaintArrays(dh.length,Jt,Jt.index,{},ah,qh&&qh[Ud])}g.placedSymbolArray.emplaceBack(So.x,So.y,Ph,this.glyphOffsetArray.length-Ph,Xh,al,hl,So.segment,W?W[0]:0,W?W[1]:0,ut[0],ut[1],In,0,!1,0,eh)}_addCollisionDebugVertex(g,S,W,ut,Ht,Jt){return S.emplaceBack(0,0),g.emplaceBack(W.x,W.y,ut,Ht,Math.round(Jt.x),Math.round(Jt.y))}addCollisionDebugVertices(g,S,W,ut,Ht,Jt,In){const So=Ht.segments.prepareSegment(4,Ht.layoutVertexArray,Ht.indexArray),al=So.vertexLength,hl=Ht.layoutVertexArray,eh=Ht.collisionVertexArray,ah=In.anchorX,ch=In.anchorY;this._addCollisionDebugVertex(hl,eh,Jt,ah,ch,new L(g,S)),this._addCollisionDebugVertex(hl,eh,Jt,ah,ch,new L(W,S)),this._addCollisionDebugVertex(hl,eh,Jt,ah,ch,new L(W,ut)),this._addCollisionDebugVertex(hl,eh,Jt,ah,ch,new L(g,ut)),So.vertexLength+=4;const dh=Ht.indexArray;dh.emplaceBack(al,al+1),dh.emplaceBack(al+1,al+2),dh.emplaceBack(al+2,al+3),dh.emplaceBack(al+3,al),So.primitiveLength+=4}addDebugCollisionBoxes(g,S,W,ut){for(let Ht=g;Ht<S;Ht++){const Jt=this.collisionBoxArray.get(Ht);this.addCollisionDebugVertices(Jt.x1,Jt.y1,Jt.x2,Jt.y2,ut?this.textCollisionBox:this.iconCollisionBox,Jt.anchorPoint,W)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new x1(jp,Yx.members,gd),this.iconCollisionBox=new x1(jp,Yx.members,gd);for(let g=0;g<this.symbolInstances.length;g++){const S=this.symbolInstances.get(g);this.addDebugCollisionBoxes(S.textBoxStartIndex,S.textBoxEndIndex,S,!0),this.addDebugCollisionBoxes(S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S,!0),this.addDebugCollisionBoxes(S.iconBoxStartIndex,S.iconBoxEndIndex,S,!1),this.addDebugCollisionBoxes(S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S,!1)}}_deserializeCollisionBoxesForSymbol(g,S,W,ut,Ht,Jt,In,So,al){const hl={};for(let eh=S;eh<W;eh++){const ah=g.get(eh);hl.textBox={x1:ah.x1,y1:ah.y1,x2:ah.x2,y2:ah.y2,anchorPointX:ah.anchorPointX,anchorPointY:ah.anchorPointY},hl.textFeatureIndex=ah.featureIndex;break}for(let eh=ut;eh<Ht;eh++){const ah=g.get(eh);hl.verticalTextBox={x1:ah.x1,y1:ah.y1,x2:ah.x2,y2:ah.y2,anchorPointX:ah.anchorPointX,anchorPointY:ah.anchorPointY},hl.verticalTextFeatureIndex=ah.featureIndex;break}for(let eh=Jt;eh<In;eh++){const ah=g.get(eh);hl.iconBox={x1:ah.x1,y1:ah.y1,x2:ah.x2,y2:ah.y2,anchorPointX:ah.anchorPointX,anchorPointY:ah.anchorPointY},hl.iconFeatureIndex=ah.featureIndex;break}for(let eh=So;eh<al;eh++){const ah=g.get(eh);hl.verticalIconBox={x1:ah.x1,y1:ah.y1,x2:ah.x2,y2:ah.y2,anchorPointX:ah.anchorPointX,anchorPointY:ah.anchorPointY},hl.verticalIconFeatureIndex=ah.featureIndex;break}return hl}deserializeCollisionBoxes(g){this.collisionArrays=[];for(let S=0;S<this.symbolInstances.length;S++){const W=this.symbolInstances.get(S);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(g,W.textBoxStartIndex,W.textBoxEndIndex,W.verticalTextBoxStartIndex,W.verticalTextBoxEndIndex,W.iconBoxStartIndex,W.iconBoxEndIndex,W.verticalIconBoxStartIndex,W.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(g,S){const W=g.placedSymbolArray.get(S),ut=W.vertexStartIndex+4*W.numGlyphs;for(let Ht=W.vertexStartIndex;Ht<ut;Ht+=4)g.indexArray.emplaceBack(Ht,Ht+1,Ht+2),g.indexArray.emplaceBack(Ht+1,Ht+2,Ht+3)}getSortedSymbolIndexes(g){if(this.sortedAngle===g&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const S=Math.sin(g),W=Math.cos(g),ut=[],Ht=[],Jt=[];for(let In=0;In<this.symbolInstances.length;++In){Jt.push(In);const So=this.symbolInstances.get(In);ut.push(0|Math.round(S*So.anchorX+W*So.anchorY)),Ht.push(So.featureIndex)}return Jt.sort((In,So)=>ut[In]-ut[So]||Ht[So]-Ht[In]),Jt}addToSortKeyRanges(g,S){const W=this.sortKeyRanges[this.sortKeyRanges.length-1];W&&W.sortKey===S?W.symbolInstanceEnd=g+1:this.sortKeyRanges.push({sortKey:S,symbolInstanceStart:g,symbolInstanceEnd:g+1})}sortFeatures(g){if(this.sortFeaturesByY&&this.sortedAngle!==g&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(g),this.sortedAngle=g,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const S of this.symbolInstanceIndexes){const W=this.symbolInstances.get(S);this.featureSortOrder.push(W.featureIndex),[W.rightJustifiedTextSymbolIndex,W.centerJustifiedTextSymbolIndex,W.leftJustifiedTextSymbolIndex].forEach((ut,Ht,Jt)=>{ut>=0&&Jt.indexOf(ut)===Ht&&this.addIndicesForPlacedSymbol(this.text,ut)}),W.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,W.verticalPlacedTextSymbolIndex),W.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,W.placedIconSymbolIndex),W.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,W.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Fx,$w;Td("SymbolBucket",iw,{omit:["layers","collisionBoxArray","features","compareText"]}),iw.MAX_GLYPHS=65535,iw.addDynamicAttributes=v1;var w1={get paint(){return $w=$w||new Am({"icon-opacity":new Kd(Yh.paint_symbol["icon-opacity"]),"icon-color":new Kd(Yh.paint_symbol["icon-color"]),"icon-halo-color":new Kd(Yh.paint_symbol["icon-halo-color"]),"icon-halo-width":new Kd(Yh.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Kd(Yh.paint_symbol["icon-halo-blur"]),"icon-translate":new Nd(Yh.paint_symbol["icon-translate"]),"icon-translate-anchor":new Nd(Yh.paint_symbol["icon-translate-anchor"]),"text-opacity":new Kd(Yh.paint_symbol["text-opacity"]),"text-color":new Kd(Yh.paint_symbol["text-color"],{runtimeType:$d,getOverride:x=>x.textColor,hasOverride:x=>!!x.textColor}),"text-halo-color":new Kd(Yh.paint_symbol["text-halo-color"]),"text-halo-width":new Kd(Yh.paint_symbol["text-halo-width"]),"text-halo-blur":new Kd(Yh.paint_symbol["text-halo-blur"]),"text-translate":new Nd(Yh.paint_symbol["text-translate"]),"text-translate-anchor":new Nd(Yh.paint_symbol["text-translate-anchor"])})},get layout(){return Fx=Fx||new Am({"symbol-placement":new Nd(Yh.layout_symbol["symbol-placement"]),"symbol-spacing":new Nd(Yh.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Nd(Yh.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Kd(Yh.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Nd(Yh.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Nd(Yh.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Nd(Yh.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Nd(Yh.layout_symbol["icon-ignore-placement"]),"icon-optional":new Nd(Yh.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Nd(Yh.layout_symbol["icon-rotation-alignment"]),"icon-size":new Kd(Yh.layout_symbol["icon-size"]),"icon-text-fit":new Nd(Yh.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Nd(Yh.layout_symbol["icon-text-fit-padding"]),"icon-image":new Kd(Yh.layout_symbol["icon-image"]),"icon-rotate":new Kd(Yh.layout_symbol["icon-rotate"]),"icon-padding":new Kd(Yh.layout_symbol["icon-padding"]),"icon-keep-upright":new Nd(Yh.layout_symbol["icon-keep-upright"]),"icon-offset":new Kd(Yh.layout_symbol["icon-offset"]),"icon-anchor":new Kd(Yh.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Nd(Yh.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Nd(Yh.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Nd(Yh.layout_symbol["text-rotation-alignment"]),"text-field":new Kd(Yh.layout_symbol["text-field"]),"text-font":new Kd(Yh.layout_symbol["text-font"]),"text-size":new Kd(Yh.layout_symbol["text-size"]),"text-max-width":new Kd(Yh.layout_symbol["text-max-width"]),"text-line-height":new Nd(Yh.layout_symbol["text-line-height"]),"text-letter-spacing":new Kd(Yh.layout_symbol["text-letter-spacing"]),"text-justify":new Kd(Yh.layout_symbol["text-justify"]),"text-radial-offset":new Kd(Yh.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Nd(Yh.layout_symbol["text-variable-anchor"]),"text-anchor":new Kd(Yh.layout_symbol["text-anchor"]),"text-max-angle":new Nd(Yh.layout_symbol["text-max-angle"]),"text-writing-mode":new Nd(Yh.layout_symbol["text-writing-mode"]),"text-rotate":new Kd(Yh.layout_symbol["text-rotate"]),"text-padding":new Nd(Yh.layout_symbol["text-padding"]),"text-keep-upright":new Nd(Yh.layout_symbol["text-keep-upright"]),"text-transform":new Kd(Yh.layout_symbol["text-transform"]),"text-offset":new Kd(Yh.layout_symbol["text-offset"]),"text-allow-overlap":new Nd(Yh.layout_symbol["text-allow-overlap"]),"text-overlap":new Nd(Yh.layout_symbol["text-overlap"]),"text-ignore-placement":new Nd(Yh.layout_symbol["text-ignore-placement"]),"text-optional":new Nd(Yh.layout_symbol["text-optional"])})}};class yb{constructor(g){if(g.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=g.property.overrides?g.property.overrides.runtimeType:Vd,this.defaultValue=g}evaluate(g){if(g.formattedSection){const S=this.defaultValue.property.overrides;if(S&&S.hasOverride(g.formattedSection))return S.getOverride(g.formattedSection)}return g.feature&&g.featureState?this.defaultValue.evaluate(g.feature,g.featureState):this.defaultValue.property.specification.default}eachChild(g){this.defaultValue.isConstant()||g(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Td("FormatSectionOverride",yb,{omit:["defaultValue"]});class b1 extends xy{constructor(g){super(g,w1)}recalculate(g,S){if(super.recalculate(g,S),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const W=this.layout.get("text-writing-mode");if(W){const ut=[];for(const Ht of W)ut.indexOf(Ht)<0&&ut.push(Ht);this.layout._values["text-writing-mode"]=ut}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(g,S,W,ut){const Ht=this.layout.get(g).evaluate(S,{},W,ut),Jt=this._unevaluatedLayout._values[g];return Jt.isDataDriven()||Iv(Jt.value)||!Ht?Ht:function(In,So){return So.replace(/{([^{}]+)}/g,(al,hl)=>hl in In?String(In[hl]):"")}(S.properties,Ht)}createBucket(g){return new iw(g)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const g of w1.paint.overridableProperties){if(!b1.hasPaintOverride(this.layout,g))continue;const S=this.paint.get(g),W=new yb(S),ut=new H_(W,S.property.specification);let Ht=null;Ht=S.value.kind==="constant"||S.value.kind==="source"?new Pv("source",ut):new rg("composite",ut,S.value.zoomStops),this.paint._values[g]=new Xm(S.property,Ht,S.parameters)}}_handleOverridablePaintPropertyUpdate(g,S,W){return!(!this.layout||S.isDataDriven()||W.isDataDriven())&&b1.hasPaintOverride(this.layout,g)}static hasPaintOverride(g,S){const W=g.get("text-field"),ut=w1.paint.properties[S];let Ht=!1;const Jt=In=>{for(const So of In)if(ut.overrides&&ut.overrides.hasOverride(So))return void(Ht=!0)};if(W.value.kind==="constant"&&W.value.value instanceof Bg)Jt(W.value.value.sections);else if(W.value.kind==="source"){const In=al=>{Ht||(al instanceof fy&&Dg(al.value)===bg?Jt(al.value.sections):al instanceof $_?Jt(al.sections):al.eachChild(In))},So=W.value;So._styleExpression&&In(So._styleExpression.expression)}return Ht}}let aC;var lC={get paint(){return aC=aC||new Am({"background-color":new Nd(Yh.paint_background["background-color"]),"background-pattern":new jv(Yh.paint_background["background-pattern"]),"background-opacity":new Nd(Yh.paint_background["background-opacity"])})}};let uC;var cC={get paint(){return uC=uC||new Am({"raster-opacity":new Nd(Yh.paint_raster["raster-opacity"]),"raster-hue-rotate":new Nd(Yh.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Nd(Yh.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Nd(Yh.paint_raster["raster-brightness-max"]),"raster-saturation":new Nd(Yh.paint_raster["raster-saturation"]),"raster-contrast":new Nd(Yh.paint_raster["raster-contrast"]),"raster-resampling":new Nd(Yh.paint_raster["raster-resampling"]),"raster-fade-duration":new Nd(Yh.paint_raster["raster-fade-duration"])})}};class aE extends xy{constructor(g){super(g,{}),this.onAdd=S=>{this.implementation.onAdd&&this.implementation.onAdd(S,S.painter.context.gl)},this.onRemove=S=>{this.implementation.onRemove&&this.implementation.onRemove(S,S.painter.context.gl)},this.implementation=g}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const lE={circle:class extends xy{constructor(x){super(x,mg)}createBucket(x){return new zd(x)}queryRadius(x){const g=x;return om("circle-radius",this,g)+om("circle-stroke-width",this,g)+uy(this.paint.get("circle-translate"))}queryIntersectsFeature(x,g,S,W,ut,Ht,Jt,In){const So=Iy(x,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),Ht.angle,Jt),al=this.paint.get("circle-radius").evaluate(g,S)+this.paint.get("circle-stroke-width").evaluate(g,S),hl=this.paint.get("circle-pitch-alignment")==="map",eh=hl?So:function(ch,dh){return ch.map(Dh=>S_(Dh,dh))}(So,In),ah=hl?al*Jt:al;for(const ch of W)for(const dh of ch){const Dh=hl?dh:S_(dh,In);let Ph=ah;const Xh=Zv([],[dh.x,dh.y,0,1],In);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Ph*=Xh[3]/Ht.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Ph*=Ht.cameraToCenterDistance/Xh[3]),Pd(eh,Dh,Ph))return!0}return!1}},heatmap:class extends xy{createBucket(x){return new uv(x)}constructor(x){super(x,Ux),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(x){x==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=o1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends xy{constructor(x){super(x,jb)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends xy{constructor(x){super(x,Kb)}recalculate(x,g){super.recalculate(x,g);const S=this.paint._values["fill-outline-color"];S.value.kind==="constant"&&S.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(x){return new Mw(x)}queryRadius(){return uy(this.paint.get("fill-translate"))}queryIntersectsFeature(x,g,S,W,ut,Ht,Jt){return Zd(Iy(x,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),Ht.angle,Jt),W)}isTileClipped(){return!0}},"fill-extrusion":class extends xy{constructor(x){super(x,Yb)}createBucket(x){return new o_(x)}queryRadius(){return uy(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(x,g,S,W,ut,Ht,Jt,In){const So=Iy(x,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),Ht.angle,Jt),al=this.paint.get("fill-extrusion-height").evaluate(g,S),hl=this.paint.get("fill-extrusion-base").evaluate(g,S),eh=function(ch,dh,Dh,Ph){const Xh=[];for(const Qh of ch){const qh=[Qh.x,Qh.y,0,1];Zv(qh,qh,dh),Xh.push(new L(qh[0]/qh[3],qh[1]/qh[3]))}return Xh}(So,In),ah=function(ch,dh,Dh,Ph){const Xh=[],Qh=[],qh=Ph[8]*dh,lp=Ph[9]*dh,dp=Ph[10]*dh,Mp=Ph[11]*dh,Md=Ph[8]*Dh,bd=Ph[9]*Dh,_d=Ph[10]*Dh,hd=Ph[11]*Dh;for(const ld of ch){const Sd=[],vd=[];for(const Jp of ld){const Xd=Jp.x,Ud=Jp.y,ag=Ph[0]*Xd+Ph[4]*Ud+Ph[12],Wg=Ph[1]*Xd+Ph[5]*Ud+Ph[13],Zg=Ph[2]*Xd+Ph[6]*Ud+Ph[14],um=Ph[3]*Xd+Ph[7]*Ud+Ph[15],s_=Zg+dp,jm=um+Mp,_m=ag+Md,Rm=Wg+bd,Qm=Zg+_d,hy=um+hd,Dy=new L((ag+qh)/jm,(Wg+lp)/jm);Dy.z=s_/jm,Sd.push(Dy);const Cm=new L(_m/hy,Rm/hy);Cm.z=Qm/hy,vd.push(Cm)}Xh.push(Sd),Qh.push(vd)}return[Xh,Qh]}(W,hl,al,In);return function(ch,dh,Dh){let Ph=1/0;Zd(Dh,dh)&&(Ph=eb(Dh,dh[0]));for(let Xh=0;Xh<dh.length;Xh++){const Qh=dh[Xh],qh=ch[Xh];for(let lp=0;lp<Qh.length-1;lp++){const dp=Qh[lp],Mp=[dp,Qh[lp+1],qh[lp+1],qh[lp],dp];jf(Dh,Mp)&&(Ph=Math.min(Ph,eb(Dh,Mp)))}}return Ph!==1/0&&Ph}(ah[0],ah[1],eh)}},line:class extends xy{constructor(x){super(x,h1),this.gradientVersion=0,Xx||(Xx=new by(h1.paint.properties["line-width"].specification),Xx.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(x){x==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof h_,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(x,g){super.recalculate(x,g),this.paint._values["line-floorwidth"]=Xx.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,x)}createBucket(x){return new Mx(x)}queryRadius(x){const g=x,S=rb(om("line-width",this,g),om("line-gap-width",this,g)),W=om("line-offset",this,g);return S/2+Math.abs(W)+uy(this.paint.get("line-translate"))}queryIntersectsFeature(x,g,S,W,ut,Ht,Jt){const In=Iy(x,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),Ht.angle,Jt),So=Jt/2*rb(this.paint.get("line-width").evaluate(g,S),this.paint.get("line-gap-width").evaluate(g,S)),al=this.paint.get("line-offset").evaluate(g,S);return al&&(W=function(hl,eh){const ah=[];for(let ch=0;ch<hl.length;ch++){const dh=hl[ch],Dh=[];for(let Ph=0;Ph<dh.length;Ph++){const Xh=dh[Ph-1],Qh=dh[Ph],qh=dh[Ph+1],lp=Ph===0?new L(0,0):Qh.sub(Xh)._unit()._perp(),dp=Ph===dh.length-1?new L(0,0):qh.sub(Qh)._unit()._perp(),Mp=lp._add(dp)._unit(),Md=Mp.x*dp.x+Mp.y*dp.y;Md!==0&&Mp._mult(1/Md),Dh.push(Mp._mult(eh)._add(Qh))}ah.push(Dh)}return ah}(W,al*Jt)),function(hl,eh,ah){for(let ch=0;ch<eh.length;ch++){const dh=eh[ch];if(hl.length>=3){for(let Dh=0;Dh<dh.length;Dh++)if(gg(hl,dh[Dh]))return!0}if(ig(hl,dh,ah))return!0}return!1}(In,W,So)}isTileClipped(){return!0}},symbol:b1,background:class extends xy{constructor(x){super(x,lC)}},raster:class extends xy{constructor(x){super(x,cC)}}};class hC{constructor(g){this._callback=g,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const C1=63710088e-1;class D0{constructor(g,S){if(isNaN(g)||isNaN(S))throw new Error(`Invalid LngLat object: (${g}, ${S})`);if(this.lng=+g,this.lat=+S,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new D0(Bn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(g){const S=Math.PI/180,W=this.lat*S,ut=g.lat*S,Ht=Math.sin(W)*Math.sin(ut)+Math.cos(W)*Math.cos(ut)*Math.cos((g.lng-this.lng)*S);return C1*Math.acos(Math.min(Ht,1))}static convert(g){if(g instanceof D0)return g;if(Array.isArray(g)&&(g.length===2||g.length===3))return new D0(Number(g[0]),Number(g[1]));if(!Array.isArray(g)&&typeof g=="object"&&g!==null)return new D0(Number("lng"in g?g.lng:g.lon),Number(g.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const E1=2*Math.PI*C1;function t0(x){return E1*Math.cos(x*Math.PI/180)}function My(x){return(180+x)/360}function pC(x){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+x*Math.PI/360)))/360}function S1(x,g){return x/t0(g)}function _b(x){return 360/Math.PI*Math.atan(Math.exp((180-360*x)*Math.PI/180))-90}class T1{constructor(g,S,W=0){this.x=+g,this.y=+S,this.z=+W}static fromLngLat(g,S=0){const W=D0.convert(g);return new T1(My(W.lng),pC(W.lat),S1(S,W.lat))}toLngLat(){return new D0(360*this.x-180,_b(this.y))}toAltitude(){return this.z*t0(_b(this.y))}meterInMercatorCoordinateUnits(){return 1/E1*(g=_b(this.y),1/Math.cos(g*Math.PI/180));var g}}function dC(x,g,S){var W=2*Math.PI*6378137/256/Math.pow(2,S);return[x*W-2*Math.PI*6378137/2,g*W-2*Math.PI*6378137/2]}class Uw{constructor(g,S,W){if(g<0||g>25||W<0||W>=Math.pow(2,g)||S<0||S>=Math.pow(2,g))throw new Error(`x=${S}, y=${W}, z=${g} outside of bounds. 0<=x<${Math.pow(2,g)}, 0<=y<${Math.pow(2,g)} 0<=z<=25 `);this.z=g,this.x=S,this.y=W,this.key=mv(0,g,g,S,W)}equals(g){return this.z===g.z&&this.x===g.x&&this.y===g.y}url(g,S,W){const ut=(Jt=this.y,In=this.z,So=dC(256*(Ht=this.x),256*(Jt=Math.pow(2,In)-Jt-1),In),al=dC(256*(Ht+1),256*(Jt+1),In),So[0]+","+So[1]+","+al[0]+","+al[1]);var Ht,Jt,In,So,al;const hl=function(eh,ah,ch){let dh,Dh="";for(let Ph=eh;Ph>0;Ph--)dh=1<<Ph-1,Dh+=(ah&dh?1:0)+(ch&dh?2:0);return Dh}(this.z,this.x,this.y);return g[(this.x+this.y)%g.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(W==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,S>1?"@2x":"").replace(/{quadkey}/g,hl).replace(/{bbox-epsg-3857}/g,ut)}isChildOf(g){const S=this.z-g.z;return S>0&&g.x===this.x>>S&&g.y===this.y>>S}getTilePoint(g){const S=Math.pow(2,this.z);return new L((g.x*S-this.x)*bp,(g.y*S-this.y)*bp)}toString(){return`${this.z}/${this.x}/${this.y}`}}class jw{constructor(g,S){this.wrap=g,this.canonical=S,this.key=mv(g,S.z,S.z,S.x,S.y)}}class Uy{constructor(g,S,W,ut,Ht){if(g<W)throw new Error(`overscaledZ should be >= z; overscaledZ = ${g}; z = ${W}`);this.overscaledZ=g,this.wrap=S,this.canonical=new Uw(W,+ut,+Ht),this.key=mv(S,g,W,ut,Ht)}clone(){return new Uy(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(g){return this.overscaledZ===g.overscaledZ&&this.wrap===g.wrap&&this.canonical.equals(g.canonical)}scaledTo(g){if(g>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${g}; overscaledZ = ${this.overscaledZ}`);const S=this.canonical.z-g;return g>this.canonical.z?new Uy(g,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Uy(g,this.wrap,g,this.canonical.x>>S,this.canonical.y>>S)}calculateScaledKey(g,S){if(g>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${g}; overscaledZ = ${this.overscaledZ}`);const W=this.canonical.z-g;return g>this.canonical.z?mv(this.wrap*+S,g,this.canonical.z,this.canonical.x,this.canonical.y):mv(this.wrap*+S,g,g,this.canonical.x>>W,this.canonical.y>>W)}isChildOf(g){if(g.wrap!==this.wrap)return!1;const S=this.canonical.z-g.canonical.z;return g.overscaledZ===0||g.overscaledZ<this.overscaledZ&&g.canonical.x===this.canonical.x>>S&&g.canonical.y===this.canonical.y>>S}children(g){if(this.overscaledZ>=g)return[new Uy(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const S=this.canonical.z+1,W=2*this.canonical.x,ut=2*this.canonical.y;return[new Uy(S,this.wrap,S,W,ut),new Uy(S,this.wrap,S,W+1,ut),new Uy(S,this.wrap,S,W,ut+1),new Uy(S,this.wrap,S,W+1,ut+1)]}isLessThan(g){return this.wrap<g.wrap||!(this.wrap>g.wrap)&&(this.overscaledZ<g.overscaledZ||!(this.overscaledZ>g.overscaledZ)&&(this.canonical.x<g.canonical.x||!(this.canonical.x>g.canonical.x)&&this.canonical.y<g.canonical.y))}wrapped(){return new Uy(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(g){return new Uy(this.overscaledZ,g,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new jw(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(g){return this.canonical.getTilePoint(new T1(g.x-this.wrap,g.y))}}function mv(x,g,S,W,ut){(x*=2)<0&&(x=-1*x-1);const Ht=1<<S;return(Ht*Ht*x+Ht*ut+W).toString(36)+S.toString(36)+g.toString(36)}Td("CanonicalTileID",Uw),Td("OverscaledTileID",Uy,{omit:["posMatrix"]});class nw{constructor(g,S,W){if(this.uid=g,S.height!==S.width)throw new RangeError("DEM tiles must be square");if(W&&W!=="mapbox"&&W!=="terrarium")return void ol(`"${W}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=S.height;const ut=this.dim=S.height-2;this.data=new Uint32Array(S.data.buffer),this.encoding=W||"mapbox";for(let Ht=0;Ht<ut;Ht++)this.data[this._idx(-1,Ht)]=this.data[this._idx(0,Ht)],this.data[this._idx(ut,Ht)]=this.data[this._idx(ut-1,Ht)],this.data[this._idx(Ht,-1)]=this.data[this._idx(Ht,0)],this.data[this._idx(Ht,ut)]=this.data[this._idx(Ht,ut-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(ut,-1)]=this.data[this._idx(ut-1,0)],this.data[this._idx(-1,ut)]=this.data[this._idx(0,ut-1)],this.data[this._idx(ut,ut)]=this.data[this._idx(ut-1,ut-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let Ht=0;Ht<ut;Ht++)for(let Jt=0;Jt<ut;Jt++){const In=this.get(Ht,Jt);In>this.max&&(this.max=In),In<this.min&&(this.min=In)}}get(g,S){const W=new Uint8Array(this.data.buffer),ut=4*this._idx(g,S);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(W[ut],W[ut+1],W[ut+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(g,S){if(g<-1||g>=this.dim+1||S<-1||S>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(S+1)*this.stride+(g+1)}_unpackMapbox(g,S,W){return(256*g*256+256*S+W)/10-1e4}_unpackTerrarium(g,S,W){return 256*g+S+W/256-32768}getPixels(){return new n_({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(g,S,W){if(this.dim!==g.dim)throw new Error("dem dimension mismatch");let ut=S*this.dim,Ht=S*this.dim+this.dim,Jt=W*this.dim,In=W*this.dim+this.dim;switch(S){case-1:ut=Ht-1;break;case 1:Ht=ut+1}switch(W){case-1:Jt=In-1;break;case 1:In=Jt+1}const So=-S*this.dim,al=-W*this.dim;for(let hl=Jt;hl<In;hl++)for(let eh=ut;eh<Ht;eh++)this.data[this._idx(eh,hl)]=g.data[this._idx(eh+So,hl+al)]}}Td("DEMData",nw);class fC{constructor(g){this._stringToNumber={},this._numberToString=[];for(let S=0;S<g.length;S++){const W=g[S];this._stringToNumber[W]=S,this._numberToString[S]=W}}encode(g){return this._stringToNumber[g]}decode(g){if(g>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${g} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[g]}}class gC{constructor(g,S,W,ut,Ht){this.type="Feature",this._vectorTileFeature=g,g._z=S,g._x=W,g._y=ut,this.properties=g.properties,this.id=Ht}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(g){this._geometry=g}toJSON(){const g={geometry:this.geometry};for(const S in this)S!=="_geometry"&&S!=="_vectorTileFeature"&&(g[S]=this[S]);return g}}class mC{constructor(g,S){this.tileID=g,this.x=g.canonical.x,this.y=g.canonical.y,this.z=g.canonical.z,this.grid=new Bv(bp,16,0),this.grid3D=new Bv(bp,16,0),this.featureIndexArray=new ph,this.promoteId=S}insert(g,S,W,ut,Ht,Jt){const In=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(W,ut,Ht);const So=Jt?this.grid3D:this.grid;for(let al=0;al<S.length;al++){const hl=S[al],eh=[1/0,1/0,-1/0,-1/0];for(let ah=0;ah<hl.length;ah++){const ch=hl[ah];eh[0]=Math.min(eh[0],ch.x),eh[1]=Math.min(eh[1],ch.y),eh[2]=Math.max(eh[2],ch.x),eh[3]=Math.max(eh[3],ch.y)}eh[0]<bp&&eh[1]<bp&&eh[2]>=0&&eh[3]>=0&&So.insert(In,eh[0],eh[1],eh[2],eh[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new A_.VectorTile(new lb(this.rawTileData)).layers,this.sourceLayerCoder=new fC(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(g,S,W,ut){this.loadVTLayers();const Ht=g.params||{},Jt=bp/g.tileSize/g.scale,In=$0(Ht.filter),So=g.queryGeometry,al=g.queryPadding*Jt,hl=_C(So),eh=this.grid.query(hl.minX-al,hl.minY-al,hl.maxX+al,hl.maxY+al),ah=_C(g.cameraQueryGeometry),ch=this.grid3D.query(ah.minX-al,ah.minY-al,ah.maxX+al,ah.maxY+al,(Ph,Xh,Qh,qh)=>function(lp,dp,Mp,Md,bd){for(const hd of lp)if(dp<=hd.x&&Mp<=hd.y&&Md>=hd.x&&bd>=hd.y)return!0;const _d=[new L(dp,Mp),new L(dp,bd),new L(Md,bd),new L(Md,Mp)];if(lp.length>2){for(const hd of _d)if(gg(lp,hd))return!0}for(let hd=0;hd<lp.length-1;hd++)if(Jm(lp[hd],lp[hd+1],_d))return!0;return!1}(g.cameraQueryGeometry,Ph-al,Xh-al,Qh+al,qh+al));for(const Ph of ch)eh.push(Ph);eh.sort(uE);const dh={};let Dh;for(let Ph=0;Ph<eh.length;Ph++){const Xh=eh[Ph];if(Xh===Dh)continue;Dh=Xh;const Qh=this.featureIndexArray.get(Xh);let qh=null;this.loadMatchingFeature(dh,Qh.bucketIndex,Qh.sourceLayerIndex,Qh.featureIndex,In,Ht.layers,Ht.availableImages,S,W,ut,(lp,dp,Mp)=>(qh||(qh=Fp(lp)),dp.queryIntersectsFeature(So,lp,Mp,qh,this.z,g.transform,Jt,g.pixelPosMatrix)))}return dh}loadMatchingFeature(g,S,W,ut,Ht,Jt,In,So,al,hl,eh){const ah=this.bucketLayerIDs[S];if(Jt&&!function(Ph,Xh){for(let Qh=0;Qh<Ph.length;Qh++)if(Xh.indexOf(Ph[Qh])>=0)return!0;return!1}(Jt,ah))return;const ch=this.sourceLayerCoder.decode(W),dh=this.vtLayers[ch].feature(ut);if(Ht.needGeometry){const Ph=Pp(dh,!0);if(!Ht.filter(new Eg(this.tileID.overscaledZ),Ph,this.tileID.canonical))return}else if(!Ht.filter(new Eg(this.tileID.overscaledZ),dh))return;const Dh=this.getId(dh,ch);for(let Ph=0;Ph<ah.length;Ph++){const Xh=ah[Ph];if(Jt&&Jt.indexOf(Xh)<0)continue;const Qh=So[Xh];if(!Qh)continue;let qh={};Dh&&hl&&(qh=hl.getState(Qh.sourceLayer||"_geojsonTileLayer",Dh));const lp=vi({},al[Xh]);lp.paint=yC(lp.paint,Qh.paint,dh,qh,In),lp.layout=yC(lp.layout,Qh.layout,dh,qh,In);const dp=!eh||eh(dh,Qh,qh);if(!dp)continue;const Mp=new gC(dh,this.z,this.x,this.y,Dh);Mp.layer=lp;let Md=g[Xh];Md===void 0&&(Md=g[Xh]=[]),Md.push({featureIndex:ut,feature:Mp,intersectionZ:dp})}}lookupSymbolFeatures(g,S,W,ut,Ht,Jt,In,So){const al={};this.loadVTLayers();const hl=$0(Ht);for(const eh of g)this.loadMatchingFeature(al,W,ut,eh,hl,Jt,In,So,S);return al}hasLayer(g){for(const S of this.bucketLayerIDs)for(const W of S)if(g===W)return!0;return!1}getId(g,S){let W=g.id;return this.promoteId&&(W=g.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[S]],typeof W=="boolean"&&(W=Number(W))),W}}function yC(x,g,S,W,ut){return gl(x,(Ht,Jt)=>{const In=g instanceof tm?g.get(Jt):null;return In&&In.evaluate?In.evaluate(S,W,ut):In})}function _C(x){let g=1/0,S=1/0,W=-1/0,ut=-1/0;for(const Ht of x)g=Math.min(g,Ht.x),S=Math.min(S,Ht.y),W=Math.max(W,Ht.x),ut=Math.max(ut,Ht.y);return{minX:g,minY:S,maxX:W,maxY:ut}}function uE(x,g){return g-x}function vC(x,g,S,W,ut){const Ht=[];for(let Jt=0;Jt<x.length;Jt++){const In=x[Jt];let So;for(let al=0;al<In.length-1;al++){let hl=In[al],eh=In[al+1];hl.x<g&&eh.x<g||(hl.x<g?hl=new L(g,hl.y+(g-hl.x)/(eh.x-hl.x)*(eh.y-hl.y))._round():eh.x<g&&(eh=new L(g,hl.y+(g-hl.x)/(eh.x-hl.x)*(eh.y-hl.y))._round()),hl.y<S&&eh.y<S||(hl.y<S?hl=new L(hl.x+(S-hl.y)/(eh.y-hl.y)*(eh.x-hl.x),S)._round():eh.y<S&&(eh=new L(hl.x+(S-hl.y)/(eh.y-hl.y)*(eh.x-hl.x),S)._round()),hl.x>=W&&eh.x>=W||(hl.x>=W?hl=new L(W,hl.y+(W-hl.x)/(eh.x-hl.x)*(eh.y-hl.y))._round():eh.x>=W&&(eh=new L(W,hl.y+(W-hl.x)/(eh.x-hl.x)*(eh.y-hl.y))._round()),hl.y>=ut&&eh.y>=ut||(hl.y>=ut?hl=new L(hl.x+(ut-hl.y)/(eh.y-hl.y)*(eh.x-hl.x),ut)._round():eh.y>=ut&&(eh=new L(hl.x+(ut-hl.y)/(eh.y-hl.y)*(eh.x-hl.x),ut)._round()),So&&hl.equals(So[So.length-1])||(So=[hl],Ht.push(So)),So.push(eh)))))}}return Ht}Td("FeatureIndex",mC,{omit:["rawTileData","sourceLayerCoder"]});class r0 extends L{constructor(g,S,W,ut){super(g,S),this.angle=W,ut!==void 0&&(this.segment=ut)}clone(){return new r0(this.x,this.y,this.angle,this.segment)}}function xC(x,g,S,W,ut){if(g.segment===void 0)return!0;let Ht=g,Jt=g.segment+1,In=0;for(;In>-S/2;){if(Jt--,Jt<0)return!1;In-=x[Jt].dist(Ht),Ht=x[Jt]}In+=x[Jt].dist(x[Jt+1]),Jt++;const So=[];let al=0;for(;In<S/2;){const hl=x[Jt],eh=x[Jt+1];if(!eh)return!1;let ah=x[Jt-1].angleTo(hl)-hl.angleTo(eh);for(ah=Math.abs((ah+3*Math.PI)%(2*Math.PI)-Math.PI),So.push({distance:In,angleDelta:ah}),al+=ah;In-So[0].distance>W;)al-=So.shift().angleDelta;if(al>ut)return!1;Jt++,In+=hl.dist(eh)}return!0}function Nx(x){let g=0;for(let S=0;S<x.length-1;S++)g+=x[S].dist(x[S+1]);return g}function wC(x,g,S){return x?.6*g*S:0}function lm(x,g){return Math.max(x?x.right-x.left:0,g?g.right-g.left:0)}function A1(x,g,S,W,ut,Ht){const Jt=wC(S,ut,Ht),In=lm(S,W)*Ht;let So=0;const al=Nx(x)/2;for(let hl=0;hl<x.length-1;hl++){const eh=x[hl],ah=x[hl+1],ch=eh.dist(ah);if(So+ch>al){const dh=(al-So)/ch,Dh=Km.number(eh.x,ah.x,dh),Ph=Km.number(eh.y,ah.y,dh),Xh=new r0(Dh,Ph,ah.angleTo(eh),hl);return Xh._round(),!Jt||xC(x,Xh,In,Jt,g)?Xh:void 0}So+=ch}}function bC(x,g,S,W,ut,Ht,Jt,In,So){const al=wC(W,Ht,Jt),hl=lm(W,ut),eh=hl*Jt,ah=x[0].x===0||x[0].x===So||x[0].y===0||x[0].y===So;return g-eh<g/4&&(g=eh+g/4),Hw(x,ah?g/2*In%g:(hl/2+2*Ht)*Jt*In%g,g,al,S,eh,ah,!1,So)}function Hw(x,g,S,W,ut,Ht,Jt,In,So){const al=Ht/2,hl=Nx(x);let eh=0,ah=g-S,ch=[];for(let dh=0;dh<x.length-1;dh++){const Dh=x[dh],Ph=x[dh+1],Xh=Dh.dist(Ph),Qh=Ph.angleTo(Dh);for(;ah+S<eh+Xh;){ah+=S;const qh=(ah-eh)/Xh,lp=Km.number(Dh.x,Ph.x,qh),dp=Km.number(Dh.y,Ph.y,qh);if(lp>=0&&lp<So&&dp>=0&&dp<So&&ah-al>=0&&ah+al<=hl){const Mp=new r0(lp,dp,Qh,dh);Mp._round(),W&&!xC(x,Mp,Ht,W,ut)||ch.push(Mp)}}eh+=Xh}return In||ch.length||Jt||(ch=Hw(x,eh/2,S,W,ut,Ht,Jt,!0,So)),ch}Td("Anchor",r0);const O0=am;function ow(x,g,S,W){const ut=[],Ht=x.image,Jt=Ht.pixelRatio,In=Ht.paddedRect.w-2*O0,So=Ht.paddedRect.h-2*O0,al=x.right-x.left,hl=x.bottom-x.top,eh=Ht.stretchX||[[0,In]],ah=Ht.stretchY||[[0,So]],ch=(ld,Sd)=>ld+Sd[1]-Sd[0],dh=eh.reduce(ch,0),Dh=ah.reduce(ch,0),Ph=In-dh,Xh=So-Dh;let Qh=0,qh=dh,lp=0,dp=Dh,Mp=0,Md=Ph,bd=0,_d=Xh;if(Ht.content&&W){const ld=Ht.content;Qh=Ww(eh,0,ld[0]),lp=Ww(ah,0,ld[1]),qh=Ww(eh,ld[0],ld[2]),dp=Ww(ah,ld[1],ld[3]),Mp=ld[0]-Qh,bd=ld[1]-lp,Md=ld[2]-ld[0]-qh,_d=ld[3]-ld[1]-dp}const hd=(ld,Sd,vd,Jp)=>{const Xd=hx(ld.stretch-Qh,qh,al,x.left),Ud=sw(ld.fixed-Mp,Md,ld.stretch,dh),ag=hx(Sd.stretch-lp,dp,hl,x.top),Wg=sw(Sd.fixed-bd,_d,Sd.stretch,Dh),Zg=hx(vd.stretch-Qh,qh,al,x.left),um=sw(vd.fixed-Mp,Md,vd.stretch,dh),s_=hx(Jp.stretch-lp,dp,hl,x.top),jm=sw(Jp.fixed-bd,_d,Jp.stretch,Dh),_m=new L(Xd,ag),Rm=new L(Zg,ag),Qm=new L(Zg,s_),hy=new L(Xd,s_),Dy=new L(Ud/Jt,Wg/Jt),Cm=new L(um/Jt,jm/Jt),ey=g*Math.PI/180;if(ey){const Ig=Math.sin(ey),rm=Math.cos(ey),Qg=[rm,-Ig,Ig,rm];_m._matMult(Qg),Rm._matMult(Qg),hy._matMult(Qg),Qm._matMult(Qg)}const ty=ld.stretch+ld.fixed,Cy=Sd.stretch+Sd.fixed;return{tl:_m,tr:Rm,bl:hy,br:Qm,tex:{x:Ht.paddedRect.x+O0+ty,y:Ht.paddedRect.y+O0+Cy,w:vd.stretch+vd.fixed-ty,h:Jp.stretch+Jp.fixed-Cy},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Dy,pixelOffsetBR:Cm,minFontScaleX:Md/Jt/al,minFontScaleY:_d/Jt/hl,isSDF:S}};if(W&&(Ht.stretchX||Ht.stretchY)){const ld=vb(eh,Ph,dh),Sd=vb(ah,Xh,Dh);for(let vd=0;vd<ld.length-1;vd++){const Jp=ld[vd],Xd=ld[vd+1];for(let Ud=0;Ud<Sd.length-1;Ud++)ut.push(hd(Jp,Sd[Ud],Xd,Sd[Ud+1]))}}else ut.push(hd({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:In+1},{fixed:0,stretch:So+1}));return ut}function Ww(x,g,S){let W=0;for(const ut of x)W+=Math.max(g,Math.min(S,ut[1]))-Math.max(g,Math.min(S,ut[0]));return W}function vb(x,g,S){const W=[{fixed:-O0,stretch:0}];for(const[ut,Ht]of x){const Jt=W[W.length-1];W.push({fixed:ut-Jt.stretch,stretch:Jt.stretch}),W.push({fixed:ut-Jt.stretch,stretch:Jt.stretch+(Ht-ut)})}return W.push({fixed:g+O0,stretch:S}),W}function hx(x,g,S,W){return x/g*S+W}function sw(x,g,S,W){return x-g*S/W}class aw{constructor(g,S,W,ut,Ht,Jt,In,So,al,hl){if(this.boxStartIndex=g.length,al){let eh=Jt.top,ah=Jt.bottom;const ch=Jt.collisionPadding;ch&&(eh-=ch[1],ah+=ch[3]);let dh=ah-eh;dh>0&&(dh=Math.max(10,dh),this.circleDiameter=dh)}else{let eh=Jt.top*In-So[0],ah=Jt.bottom*In+So[2],ch=Jt.left*In-So[3],dh=Jt.right*In+So[1];const Dh=Jt.collisionPadding;if(Dh&&(ch-=Dh[0]*In,eh-=Dh[1]*In,dh+=Dh[2]*In,ah+=Dh[3]*In),hl){const Ph=new L(ch,eh),Xh=new L(dh,eh),Qh=new L(ch,ah),qh=new L(dh,ah),lp=hl*Math.PI/180;Ph._rotate(lp),Xh._rotate(lp),Qh._rotate(lp),qh._rotate(lp),ch=Math.min(Ph.x,Xh.x,Qh.x,qh.x),dh=Math.max(Ph.x,Xh.x,Qh.x,qh.x),eh=Math.min(Ph.y,Xh.y,Qh.y,qh.y),ah=Math.max(Ph.y,Xh.y,Qh.y,qh.y)}g.emplaceBack(S.x,S.y,ch,eh,dh,ah,W,ut,Ht)}this.boxEndIndex=g.length}}class xb{constructor(g=[],S=cE){if(this.data=g,this.length=this.data.length,this.compare=S,this.length>0)for(let W=(this.length>>1)-1;W>=0;W--)this._down(W)}push(g){this.data.push(g),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const g=this.data[0],S=this.data.pop();return this.length--,this.length>0&&(this.data[0]=S,this._down(0)),g}peek(){return this.data[0]}_up(g){const{data:S,compare:W}=this,ut=S[g];for(;g>0;){const Ht=g-1>>1,Jt=S[Ht];if(W(ut,Jt)>=0)break;S[g]=Jt,g=Ht}S[g]=ut}_down(g){const{data:S,compare:W}=this,ut=this.length>>1,Ht=S[g];for(;g<ut;){let Jt=1+(g<<1),In=S[Jt];const So=Jt+1;if(So<this.length&&W(S[So],In)<0&&(Jt=So,In=S[So]),W(In,Ht)>=0)break;S[g]=In,g=Jt}S[g]=Ht}}function cE(x,g){return x<g?-1:x>g?1:0}function CC(x,g=1,S=!1){let W=1/0,ut=1/0,Ht=-1/0,Jt=-1/0;const In=x[0];for(let ch=0;ch<In.length;ch++){const dh=In[ch];(!ch||dh.x<W)&&(W=dh.x),(!ch||dh.y<ut)&&(ut=dh.y),(!ch||dh.x>Ht)&&(Ht=dh.x),(!ch||dh.y>Jt)&&(Jt=dh.y)}const So=Math.min(Ht-W,Jt-ut);let al=So/2;const hl=new xb([],qw);if(So===0)return new L(W,ut);for(let ch=W;ch<Ht;ch+=So)for(let dh=ut;dh<Jt;dh+=So)hl.push(new lw(ch+al,dh+al,al,x));let eh=function(ch){let dh=0,Dh=0,Ph=0;const Xh=ch[0];for(let Qh=0,qh=Xh.length,lp=qh-1;Qh<qh;lp=Qh++){const dp=Xh[Qh],Mp=Xh[lp],Md=dp.x*Mp.y-Mp.x*dp.y;Dh+=(dp.x+Mp.x)*Md,Ph+=(dp.y+Mp.y)*Md,dh+=3*Md}return new lw(Dh/dh,Ph/dh,0,ch)}(x),ah=hl.length;for(;hl.length;){const ch=hl.pop();(ch.d>eh.d||!eh.d)&&(eh=ch,S&&console.log("found best %d after %d probes",Math.round(1e4*ch.d)/1e4,ah)),ch.max-eh.d<=g||(al=ch.h/2,hl.push(new lw(ch.p.x-al,ch.p.y-al,al,x)),hl.push(new lw(ch.p.x+al,ch.p.y-al,al,x)),hl.push(new lw(ch.p.x-al,ch.p.y+al,al,x)),hl.push(new lw(ch.p.x+al,ch.p.y+al,al,x)),ah+=4)}return S&&(console.log(`num probes: ${ah}`),console.log(`best distance: ${eh.d}`)),eh.p}function qw(x,g){return g.max-x.max}function lw(x,g,S,W){this.p=new L(x,g),this.h=S,this.d=function(ut,Ht){let Jt=!1,In=1/0;for(let So=0;So<Ht.length;So++){const al=Ht[So];for(let hl=0,eh=al.length,ah=eh-1;hl<eh;ah=hl++){const ch=al[hl],dh=al[ah];ch.y>ut.y!=dh.y>ut.y&&ut.x<(dh.x-ch.x)*(ut.y-ch.y)/(dh.y-ch.y)+ch.x&&(Jt=!Jt),In=Math.min(In,Sg(ut,ch,dh))}}return(Jt?1:-1)*Math.sqrt(In)}(this.p,W),this.max=this.d+this.h*Math.SQRT2}const Kw=Number.POSITIVE_INFINITY;function EC(x,g){return g[1]!==Kw?function(S,W,ut){let Ht=0,Jt=0;switch(W=Math.abs(W),ut=Math.abs(ut),S){case"top-right":case"top-left":case"top":Jt=ut-7;break;case"bottom-right":case"bottom-left":case"bottom":Jt=7-ut}switch(S){case"top-right":case"bottom-right":case"right":Ht=-W;break;case"top-left":case"bottom-left":case"left":Ht=W}return[Ht,Jt]}(x,g[0],g[1]):function(S,W){let ut=0,Ht=0;W<0&&(W=0);const Jt=W/Math.sqrt(2);switch(S){case"top-right":case"top-left":Ht=Jt-7;break;case"bottom-right":case"bottom-left":Ht=7-Jt;break;case"bottom":Ht=7-W;break;case"top":Ht=W-7}switch(S){case"top-right":case"bottom-right":ut=-Jt;break;case"top-left":case"bottom-left":ut=Jt;break;case"left":ut=W;break;case"right":ut=-W}return[ut,Ht]}(x,g[0])}function Zw(x){switch(x){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function wb(x,g,S,W,ut,Ht,Jt,In,So,al,hl){let eh=Ht.textMaxSize.evaluate(g,{});eh===void 0&&(eh=Jt);const ah=x.layers[0].layout,ch=ah.get("icon-offset").evaluate(g,{},hl),dh=SC(S.horizontal),Dh=Jt/24,Ph=x.tilePixelRatio*Dh,Xh=x.tilePixelRatio*eh/24,Qh=x.tilePixelRatio*In,qh=x.tilePixelRatio*ah.get("symbol-spacing"),lp=ah.get("text-padding")*x.tilePixelRatio,dp=function(Jp,Xd,Ud,ag=1){const Wg=Jp.get("icon-padding").evaluate(Xd,{},Ud),Zg=Wg&&Wg.values;return[Zg[0]*ag,Zg[1]*ag,Zg[2]*ag,Zg[3]*ag]}(ah,g,hl,x.tilePixelRatio),Mp=ah.get("text-max-angle")/180*Math.PI,Md=ah.get("text-rotation-alignment")!=="viewport"&&ah.get("symbol-placement")!=="point",bd=ah.get("icon-rotation-alignment")==="map"&&ah.get("symbol-placement")!=="point",_d=ah.get("symbol-placement"),hd=qh/2,ld=ah.get("icon-text-fit");let Sd;W&&ld!=="none"&&(x.allowVerticalPlacement&&S.vertical&&(Sd=Vw(W,S.vertical,ld,ah.get("icon-text-fit-padding"),ch,Dh)),dh&&(W=Vw(W,dh,ld,ah.get("icon-text-fit-padding"),ch,Dh)));const vd=(Jp,Xd)=>{Xd.x<0||Xd.x>=bp||Xd.y<0||Xd.y>=bp||function(Ud,ag,Wg,Zg,um,s_,jm,_m,Rm,Qm,hy,Dy,Cm,ey,ty,Cy,Ig,rm,Qg,Im,tg,jy,ry,Pm,O_){const yv=Ud.addToLineVertexArray(ag,Wg);let L_,i0,a_,sg,py=0,n0=0,uw=0,o0=0,fx=-1,M1=-1;const L0={};let RC=dl(""),Ab=0,Rb=0;if(_m._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Ab,Rb]=_m.layout.get("text-offset").evaluate(tg,{},Pm).map(Oy=>Oy*mm):(Ab=_m.layout.get("text-radial-offset").evaluate(tg,{},Pm)*mm,Rb=Kw),Ud.allowVerticalPlacement&&Zg.vertical){const Oy=_m.layout.get("text-rotate").evaluate(tg,{},Pm)+90;a_=new aw(Rm,ag,Qm,hy,Dy,Zg.vertical,Cm,ey,ty,Oy),jm&&(sg=new aw(Rm,ag,Qm,hy,Dy,jm,Ig,rm,ty,Oy))}if(um){const Oy=_m.layout.get("icon-rotate").evaluate(tg,{}),_v=_m.layout.get("icon-text-fit")!=="none",kx=ow(um,Oy,ry,_v),Hm=jm?ow(jm,Oy,ry,_v):void 0;i0=new aw(Rm,ag,Qm,hy,Dy,um,Ig,rm,!1,Oy),py=4*kx.length;const F1=Ud.iconSizeData;let gx=null;F1.kind==="source"?(gx=[gv*_m.layout.get("icon-size").evaluate(tg,{})],gx[0]>cx&&ol(`${Ud.layerIds[0]}: Value for "icon-size" is >= ${Lx}. Reduce your "icon-size".`)):F1.kind==="composite"&&(gx=[gv*jy.compositeIconSizes[0].evaluate(tg,{},Pm),gv*jy.compositeIconSizes[1].evaluate(tg,{},Pm)],(gx[0]>cx||gx[1]>cx)&&ol(`${Ud.layerIds[0]}: Value for "icon-size" is >= ${Lx}. Reduce your "icon-size".`)),Ud.addSymbols(Ud.icon,kx,gx,Im,Qg,tg,a.WritingMode.none,ag,yv.lineStartIndex,yv.lineLength,-1,Pm),fx=Ud.icon.placedSymbolArray.length-1,Hm&&(n0=4*Hm.length,Ud.addSymbols(Ud.icon,Hm,gx,Im,Qg,tg,a.WritingMode.vertical,ag,yv.lineStartIndex,yv.lineLength,-1,Pm),M1=Ud.icon.placedSymbolArray.length-1)}const IC=Object.keys(Zg.horizontal);for(const Oy of IC){const _v=Zg.horizontal[Oy];if(!L_){RC=dl(_v.text);const Hm=_m.layout.get("text-rotate").evaluate(tg,{},Pm);L_=new aw(Rm,ag,Qm,hy,Dy,_v,Cm,ey,ty,Hm)}const kx=_v.positionedLines.length===1;if(uw+=Xw(Ud,ag,_v,s_,_m,ty,tg,Cy,yv,Zg.vertical?a.WritingMode.horizontal:a.WritingMode.horizontalOnly,kx?IC:[Oy],L0,fx,jy,Pm),kx)break}Zg.vertical&&(o0+=Xw(Ud,ag,Zg.vertical,s_,_m,ty,tg,Cy,yv,a.WritingMode.vertical,["vertical"],L0,M1,jy,Pm));const dE=L_?L_.boxStartIndex:Ud.collisionBoxArray.length,fE=L_?L_.boxEndIndex:Ud.collisionBoxArray.length,gE=a_?a_.boxStartIndex:Ud.collisionBoxArray.length,mE=a_?a_.boxEndIndex:Ud.collisionBoxArray.length,D1=i0?i0.boxStartIndex:Ud.collisionBoxArray.length,hw=i0?i0.boxEndIndex:Ud.collisionBoxArray.length,PC=sg?sg.boxStartIndex:Ud.collisionBoxArray.length,O1=sg?sg.boxEndIndex:Ud.collisionBoxArray.length;let l_=-1;const L1=(Oy,_v)=>Oy&&Oy.circleDiameter?Math.max(Oy.circleDiameter,_v):_v;l_=L1(L_,l_),l_=L1(a_,l_),l_=L1(i0,l_),l_=L1(sg,l_);const MC=l_>-1?1:0;MC&&(l_*=O_/mm),Ud.glyphOffsetArray.length>=iw.MAX_GLYPHS&&ol("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),tg.sortKey!==void 0&&Ud.addToSortKeyRanges(Ud.symbolInstances.length,tg.sortKey),Ud.symbolInstances.emplaceBack(ag.x,ag.y,L0.right>=0?L0.right:-1,L0.center>=0?L0.center:-1,L0.left>=0?L0.left:-1,L0.vertical||-1,fx,M1,RC,dE,fE,gE,mE,D1,hw,PC,O1,Qm,uw,o0,py,n0,MC,0,Cm,Ab,Rb,l_)}(x,Xd,Jp,S,W,ut,Sd,x.layers[0],x.collisionBoxArray,g.index,g.sourceLayerIndex,x.index,Ph,[lp,lp,lp,lp],Md,So,Qh,dp,bd,ch,g,Ht,al,hl,Jt)};if(_d==="line")for(const Jp of vC(g.geometry,0,0,bp,bp)){const Xd=bC(Jp,qh,Mp,S.vertical||dh,W,24,Xh,x.overscaling,bp);for(const Ud of Xd)dh&&hE(x,dh.text,hd,Ud)||vd(Jp,Ud)}else if(_d==="line-center"){for(const Jp of g.geometry)if(Jp.length>1){const Xd=A1(Jp,Mp,S.vertical||dh,W,24,Xh);Xd&&vd(Jp,Xd)}}else if(g.type==="Polygon")for(const Jp of Pw(g.geometry,0)){const Xd=CC(Jp,16);vd(Jp[0],new r0(Xd.x,Xd.y,0))}else if(g.type==="LineString")for(const Jp of g.geometry)vd(Jp,new r0(Jp[0].x,Jp[0].y,0));else if(g.type==="Point")for(const Jp of g.geometry)for(const Xd of Jp)vd([Xd],new r0(Xd.x,Xd.y,0))}function Xw(x,g,S,W,ut,Ht,Jt,In,So,al,hl,eh,ah,ch,dh){const Dh=function(Qh,qh,lp,dp,Mp,Md,bd,_d){const hd=dp.layout.get("text-rotate").evaluate(Md,{})*Math.PI/180,ld=[];for(const Sd of qh.positionedLines)for(const vd of Sd.positionedGlyphs){if(!vd.rect)continue;const Jp=vd.rect||{};let Xd=Rg+1,Ud=!0,ag=1,Wg=0;const Zg=(Mp||_d)&&vd.vertical,um=vd.metrics.advance*vd.scale/2;if(_d&&qh.verticalizable&&(Wg=Sd.lineOffset/2-(vd.imageName?-(mm-vd.metrics.width*vd.scale)/2:(vd.scale-1)*mm)),vd.imageName){const Qg=bd[vd.imageName];Ud=Qg.sdf,ag=Qg.pixelRatio,Xd=am/ag}const s_=Mp?[vd.x+um,vd.y]:[0,0];let jm=Mp?[0,0]:[vd.x+um+lp[0],vd.y+lp[1]-Wg],_m=[0,0];Zg&&(_m=jm,jm=[0,0]);const Rm=(vd.metrics.left-Xd)*vd.scale-um+jm[0],Qm=(-vd.metrics.top-Xd)*vd.scale+jm[1],hy=Rm+Jp.w*vd.scale/ag,Dy=Qm+Jp.h*vd.scale/ag,Cm=new L(Rm,Qm),ey=new L(hy,Qm),ty=new L(Rm,Dy),Cy=new L(hy,Dy);if(Zg){const Qg=new L(-um,um-bm),Im=-Math.PI/2,tg=mm/2-um,jy=new L(5-bm-tg,-(vd.imageName?tg:0)),ry=new L(..._m);Cm._rotateAround(Im,Qg)._add(jy)._add(ry),ey._rotateAround(Im,Qg)._add(jy)._add(ry),ty._rotateAround(Im,Qg)._add(jy)._add(ry),Cy._rotateAround(Im,Qg)._add(jy)._add(ry)}if(hd){const Qg=Math.sin(hd),Im=Math.cos(hd),tg=[Im,-Qg,Qg,Im];Cm._matMult(tg),ey._matMult(tg),ty._matMult(tg),Cy._matMult(tg)}const Ig=new L(0,0),rm=new L(0,0);ld.push({tl:Cm,tr:ey,bl:ty,br:Cy,tex:Jp,writingMode:qh.writingMode,glyphOffset:s_,sectionIndex:vd.sectionIndex,isSDF:Ud,pixelOffsetTL:Ig,pixelOffsetBR:rm,minFontScaleX:0,minFontScaleY:0})}return ld}(0,S,In,ut,Ht,Jt,W,x.allowVerticalPlacement),Ph=x.textSizeData;let Xh=null;Ph.kind==="source"?(Xh=[gv*ut.layout.get("text-size").evaluate(Jt,{})],Xh[0]>cx&&ol(`${x.layerIds[0]}: Value for "text-size" is >= ${Lx}. Reduce your "text-size".`)):Ph.kind==="composite"&&(Xh=[gv*ch.compositeTextSizes[0].evaluate(Jt,{},dh),gv*ch.compositeTextSizes[1].evaluate(Jt,{},dh)],(Xh[0]>cx||Xh[1]>cx)&&ol(`${x.layerIds[0]}: Value for "text-size" is >= ${Lx}. Reduce your "text-size".`)),x.addSymbols(x.text,Dh,Xh,In,Ht,Jt,al,g,So.lineStartIndex,So.lineLength,ah,dh);for(const Qh of hl)eh[Qh]=x.text.placedSymbolArray.length-1;return 4*Dh.length}function SC(x){for(const g in x)return x[g];return null}function hE(x,g,S,W){const ut=x.compareText;if(g in ut){const Ht=ut[g];for(let Jt=Ht.length-1;Jt>=0;Jt--)if(W.dist(Ht[Jt])<S)return!0}else ut[g]=[];return ut[g].push(W),!1}const TC=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class bb{static from(g){if(!(g instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[S,W]=new Uint8Array(g,0,2);if(S!==219)throw new Error("Data does not appear to be in a KDBush format.");const ut=W>>4;if(ut!==1)throw new Error(`Got v${ut} data when expected v1.`);const Ht=TC[15&W];if(!Ht)throw new Error("Unrecognized array type.");const[Jt]=new Uint16Array(g,2,1),[In]=new Uint32Array(g,4,1);return new bb(In,Jt,Ht,g)}constructor(g,S=64,W=Float64Array,ut){if(isNaN(g)||g<0)throw new Error(`Unpexpected numItems value: ${g}.`);this.numItems=+g,this.nodeSize=Math.min(Math.max(+S,2),65535),this.ArrayType=W,this.IndexArrayType=g<65536?Uint16Array:Uint32Array;const Ht=TC.indexOf(this.ArrayType),Jt=2*g*this.ArrayType.BYTES_PER_ELEMENT,In=g*this.IndexArrayType.BYTES_PER_ELEMENT,So=(8-In%8)%8;if(Ht<0)throw new Error(`Unexpected typed array class: ${W}.`);ut&&ut instanceof ArrayBuffer?(this.data=ut,this.ids=new this.IndexArrayType(this.data,8,g),this.coords=new this.ArrayType(this.data,8+In+So,2*g),this._pos=2*g,this._finished=!0):(this.data=new ArrayBuffer(8+Jt+In+So),this.ids=new this.IndexArrayType(this.data,8,g),this.coords=new this.ArrayType(this.data,8+In+So,2*g),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+Ht]),new Uint16Array(this.data,2,1)[0]=S,new Uint32Array(this.data,4,1)[0]=g)}add(g,S){const W=this._pos>>1;return this.ids[W]=W,this.coords[this._pos++]=g,this.coords[this._pos++]=S,W}finish(){const g=this._pos>>1;if(g!==this.numItems)throw new Error(`Added ${g} items when expected ${this.numItems}.`);return Cb(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(g,S,W,ut){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:Ht,coords:Jt,nodeSize:In}=this,So=[0,Ht.length-1,0],al=[];for(;So.length;){const hl=So.pop()||0,eh=So.pop()||0,ah=So.pop()||0;if(eh-ah<=In){for(let Ph=ah;Ph<=eh;Ph++){const Xh=Jt[2*Ph],Qh=Jt[2*Ph+1];Xh>=g&&Xh<=W&&Qh>=S&&Qh<=ut&&al.push(Ht[Ph])}continue}const ch=ah+eh>>1,dh=Jt[2*ch],Dh=Jt[2*ch+1];dh>=g&&dh<=W&&Dh>=S&&Dh<=ut&&al.push(Ht[ch]),(hl===0?g<=dh:S<=Dh)&&(So.push(ah),So.push(ch-1),So.push(1-hl)),(hl===0?W>=dh:ut>=Dh)&&(So.push(ch+1),So.push(eh),So.push(1-hl))}return al}within(g,S,W){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:ut,coords:Ht,nodeSize:Jt}=this,In=[0,ut.length-1,0],So=[],al=W*W;for(;In.length;){const hl=In.pop()||0,eh=In.pop()||0,ah=In.pop()||0;if(eh-ah<=Jt){for(let Ph=ah;Ph<=eh;Ph++)Sb(Ht[2*Ph],Ht[2*Ph+1],g,S)<=al&&So.push(ut[Ph]);continue}const ch=ah+eh>>1,dh=Ht[2*ch],Dh=Ht[2*ch+1];Sb(dh,Dh,g,S)<=al&&So.push(ut[ch]),(hl===0?g-W<=dh:S-W<=Dh)&&(In.push(ah),In.push(ch-1),In.push(1-hl)),(hl===0?g+W>=dh:S+W>=Dh)&&(In.push(ch+1),In.push(eh),In.push(1-hl))}return So}}function Cb(x,g,S,W,ut,Ht){if(ut-W<=S)return;const Jt=W+ut>>1;AC(x,g,Jt,W,ut,Ht),Cb(x,g,S,W,Jt-1,1-Ht),Cb(x,g,S,Jt+1,ut,1-Ht)}function AC(x,g,S,W,ut,Ht){for(;ut>W;){if(ut-W>600){const al=ut-W+1,hl=S-W+1,eh=Math.log(al),ah=.5*Math.exp(2*eh/3),ch=.5*Math.sqrt(eh*ah*(al-ah)/al)*(hl-al/2<0?-1:1);AC(x,g,S,Math.max(W,Math.floor(S-hl*ah/al+ch)),Math.min(ut,Math.floor(S+(al-hl)*ah/al+ch)),Ht)}const Jt=g[2*S+Ht];let In=W,So=ut;for(px(x,g,W,S),g[2*ut+Ht]>Jt&&px(x,g,W,ut);In<So;){for(px(x,g,In,So),In++,So--;g[2*In+Ht]<Jt;)In++;for(;g[2*So+Ht]>Jt;)So--}g[2*W+Ht]===Jt?px(x,g,W,So):(So++,px(x,g,So,ut)),So<=S&&(W=So+1),S<=So&&(ut=So-1)}}function px(x,g,S,W){Eb(x,S,W),Eb(g,2*S,2*W),Eb(g,2*S+1,2*W+1)}function Eb(x,g,S){const W=x[g];x[g]=x[S],x[S]=W}function Sb(x,g,S,W){const ut=x-S,Ht=g-W;return ut*ut+Ht*Ht}var dx;a.PerformanceMarkers=void 0,(dx=a.PerformanceMarkers||(a.PerformanceMarkers={})).create="create",dx.load="load",dx.fullLoad="fullLoad";let R1=null,Yw=[];const Tb=1e3/60,I1="loadTime",P1="fullLoadTime",pE={mark(x){performance.mark(x)},frame(x){const g=x;R1!=null&&Yw.push(g-R1),R1=g},clearMetrics(){R1=null,Yw=[],performance.clearMeasures(I1),performance.clearMeasures(P1);for(const x in a.PerformanceMarkers)performance.clearMarks(a.PerformanceMarkers[x])},getPerformanceMetrics(){performance.measure(I1,a.PerformanceMarkers.create,a.PerformanceMarkers.load),performance.measure(P1,a.PerformanceMarkers.create,a.PerformanceMarkers.fullLoad);const x=performance.getEntriesByName(I1)[0].duration,g=performance.getEntriesByName(P1)[0].duration,S=Yw.length,W=1/(Yw.reduce((Ht,Jt)=>Ht+Jt,0)/S/1e3),ut=Yw.filter(Ht=>Ht>Tb).reduce((Ht,Jt)=>Ht+(Jt-Tb)/Tb,0);return{loadTime:x,fullLoadTime:g,fps:W,percentDroppedFrames:ut/(S+ut)*100,totalFrames:S}}};a.AJAXError=Xp,a.ARRAY_TYPE=wm,a.Actor=class{constructor(x,g,S){this.target=x,this.parent=g,this.mapId=S,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},ia(["receive","process"],this),this.invoker=new hC(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=wh()?x:window}send(x,g,S,W,ut=!1){const Ht=Math.round(1e18*Math.random()).toString(36).substring(0,10);S&&(this.callbacks[Ht]=S);const Jt=Mh(this.globalScope)?void 0:[];return this.target.postMessage({id:Ht,type:x,hasCallback:!!S,targetMapId:W,mustQueue:ut,sourceMapId:this.mapId,data:zv(g,Jt)},Jt),{cancel:()=>{S&&delete this.callbacks[Ht],this.target.postMessage({id:Ht,type:"<cancel>",targetMapId:W,sourceMapId:this.mapId})}}}receive(x){const g=x.data,S=g.id;if(S&&(!g.targetMapId||this.mapId===g.targetMapId))if(g.type==="<cancel>"){delete this.tasks[S];const W=this.cancelCallbacks[S];delete this.cancelCallbacks[S],W&&W()}else wh()||g.mustQueue?(this.tasks[S]=g,this.taskQueue.push(S),this.invoker.trigger()):this.processTask(S,g)}process(){if(!this.taskQueue.length)return;const x=this.taskQueue.shift(),g=this.tasks[x];delete this.tasks[x],this.taskQueue.length&&this.invoker.trigger(),g&&this.processTask(x,g)}processTask(x,g){if(g.type==="<response>"){const S=this.callbacks[x];delete this.callbacks[x],S&&(g.error?S(Sm(g.error)):S(null,Sm(g.data)))}else{let S=!1;const W=Mh(this.globalScope)?void 0:[],ut=g.hasCallback?(In,So)=>{S=!0,delete this.cancelCallbacks[x],this.target.postMessage({id:x,type:"<response>",sourceMapId:this.mapId,error:In?zv(In):null,data:zv(So,W)},W)}:In=>{S=!0};let Ht=null;const Jt=Sm(g.data);if(this.parent[g.type])Ht=this.parent[g.type](g.sourceMapId,Jt,ut);else if(this.parent.getWorkerSource){const In=g.type.split(".");Ht=this.parent.getWorkerSource(g.sourceMapId,In[0],Jt.source)[In[1]](Jt,ut)}else ut(new Error(`Could not find function ${g.type}`));!S&&Ht&&Ht.cancel&&(this.cancelCallbacks[x]=Ht.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.AlphaImage=Hx,a.CanonicalTileID=Uw,a.CollisionBoxArray=ct,a.CollisionCircleLayoutArray=class extends v0{},a.Color=Yd,a.DEMData=nw,a.DataConstantProperty=Nd,a.DictionaryCoder=fC,a.EXTENT=bp,a.ErrorEvent=Ad,a.EvaluationParameters=Eg,a.Event=Kp,a.Evented=Id,a.FeatureIndex=mC,a.FillBucket=Mw,a.FillExtrusionBucket=o_,a.GeoJSONFeature=gC,a.ImageAtlas=D_,a.ImagePosition=M_,a.KDBush=bb,a.LineBucket=Mx,a.LineStripIndexArray=class extends m{},a.LngLat=D0,a.MercatorCoordinate=T1,a.ONE_EM=mm,a.OverscaledTileID=Uy,a.PerformanceUtils=pE,a.Point=L,a.Pos3dArray=class extends sv{},a.PosArray=Ah,a.Properties=Am,a.Protobuf=lb,a.QuadTriangleArray=class extends x0{},a.RGBAImage=n_,a.RasterBoundsArray=class extends av{},a.RequestPerformance=class{constructor(x){this._marks={start:[x.url,"start"].join("#"),end:[x.url,"end"].join("#"),measure:x.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let x=performance.getEntriesByName(this._marks.measure);return x.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),x=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),x}},a.SegmentVector=T,a.SymbolBucket=iw,a.Transitionable=fd,a.TriangleIndexArray=Vp,a.Uniform1f=yl,a.Uniform1i=class extends xh{constructor(x,g){super(x,g),this.current=0}set(x){this.current!==x&&(this.current=x,this.gl.uniform1i(this.location,x))}},a.Uniform2f=class extends xh{constructor(x,g){super(x,g),this.current=[0,0]}set(x){x[0]===this.current[0]&&x[1]===this.current[1]||(this.current=x,this.gl.uniform2f(this.location,x[0],x[1]))}},a.Uniform3f=class extends xh{constructor(x,g){super(x,g),this.current=[0,0,0]}set(x){x[0]===this.current[0]&&x[1]===this.current[1]&&x[2]===this.current[2]||(this.current=x,this.gl.uniform3f(this.location,x[0],x[1],x[2]))}},a.Uniform4f=mh,a.UniformColor=bh,a.UniformMatrix4f=class extends xh{constructor(x,g){super(x,g),this.current=Sh}set(x){if(x[12]!==this.current[12]||x[0]!==this.current[0])return this.current=x,void this.gl.uniformMatrix4fv(this.location,!1,x);for(let g=1;g<16;g++)if(x[g]!==this.current[g]){this.current=x,this.gl.uniformMatrix4fv(this.location,!1,x);break}}},a.UnwrappedTileID=jw,a.ValidationError=up,a.ZoomHistory=y0,a.addDynamicAttributes=v1,a.arrayBufferToImage=function(x,g){const S=new Image;S.onload=()=>{g(null,S),URL.revokeObjectURL(S.src),S.onload=null,window.requestAnimationFrame(()=>{S.src=gp})},S.onerror=()=>g(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const W=new Blob([new Uint8Array(x)],{type:"image/png"});S.src=x.byteLength?URL.createObjectURL(W):gp},a.arrayBufferToImageBitmap=function(x,g){const S=new Blob([new Uint8Array(x)],{type:"image/png"});createImageBitmap(S).then(W=>{g(null,W)}).catch(W=>{g(new Error(`Could not load image because of ${W.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},a.asyncAll=function(x,g,S){if(!x.length)return S(null,[]);let W=x.length;const ut=new Array(x.length);let Ht=null;x.forEach((Jt,In)=>{g(Jt,(So,al)=>{So&&(Ht=So),ut[In]=al,--W==0&&S(Ht,ut)})})},a.bezier=Ir,a.bindAll=ia,a.clamp=yi,a.clipLine=vC,a.clone=function(x){var g=new wm(16);return g[0]=x[0],g[1]=x[1],g[2]=x[2],g[3]=x[3],g[4]=x[4],g[5]=x[5],g[6]=x[6],g[7]=x[7],g[8]=x[8],g[9]=x[9],g[10]=x[10],g[11]=x[11],g[12]=x[12],g[13]=x[13],g[14]=x[14],g[15]=x[15],g},a.clone$1=il,a.collisionCircleLayout=I_,a.config=$p,a.copy=function(x,g){return x[0]=g[0],x[1]=g[1],x[2]=g[2],x[3]=g[3],x[4]=g[4],x[5]=g[5],x[6]=g[6],x[7]=g[7],x[8]=g[8],x[9]=g[9],x[10]=g[10],x[11]=g[11],x[12]=g[12],x[13]=g[13],x[14]=g[14],x[15]=g[15],x},a.create=function(){var x=new wm(16);return wm!=Float32Array&&(x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=0,x[12]=0,x[13]=0,x[14]=0),x[0]=1,x[5]=1,x[10]=1,x[15]=1,x},a.createExpression=Lg,a.createFilter=$0,a.createLayout=Jg,a.createStyleLayer=function(x){return x.type==="custom"?new aE(x):new lE[x.type](x)},a.deepEqual=function x(g,S){if(Array.isArray(g)){if(!Array.isArray(S)||g.length!==S.length)return!1;for(let W=0;W<g.length;W++)if(!x(g[W],S[W]))return!1;return!0}if(typeof g=="object"&&g!==null&&S!==null){if(typeof S!="object"||Object.keys(g).length!==Object.keys(S).length)return!1;for(const W in g)if(!x(g[W],S[W]))return!1;return!0}return g===S},a.derefLayers=function(x){x=x.slice();const g=Object.create(null);for(let S=0;S<x.length;S++)g[x[S].id]=x[S];for(let S=0;S<x.length;S++)"ref"in x[S]&&(x[S]=kd(x[S],g[x[S].ref]));return x},a.diffStyles=function(x,g){if(!x)return[{command:id.setStyle,args:[g]}];let S=[];try{if(!cd(x.version,g.version))return[{command:id.setStyle,args:[g]}];cd(x.center,g.center)||S.push({command:id.setCenter,args:[g.center]}),cd(x.zoom,g.zoom)||S.push({command:id.setZoom,args:[g.zoom]}),cd(x.bearing,g.bearing)||S.push({command:id.setBearing,args:[g.bearing]}),cd(x.pitch,g.pitch)||S.push({command:id.setPitch,args:[g.pitch]}),cd(x.sprite,g.sprite)||S.push({command:id.setSprite,args:[g.sprite]}),cd(x.glyphs,g.glyphs)||S.push({command:id.setGlyphs,args:[g.glyphs]}),cd(x.transition,g.transition)||S.push({command:id.setTransition,args:[g.transition]}),cd(x.light,g.light)||S.push({command:id.setLight,args:[g.light]});const W={},ut=[];(function(Jt,In,So,al){let hl;for(hl in In=In||{},Jt=Jt||{})Object.prototype.hasOwnProperty.call(Jt,hl)&&(Object.prototype.hasOwnProperty.call(In,hl)||Cd(hl,So,al));for(hl in In)Object.prototype.hasOwnProperty.call(In,hl)&&(Object.prototype.hasOwnProperty.call(Jt,hl)?cd(Jt[hl],In[hl])||(Jt[hl].type==="geojson"&&In[hl].type==="geojson"&&yd(Jt,In,hl)?So.push({command:id.setGeoJSONSourceData,args:[hl,In[hl].data]}):Fd(hl,In,So,al)):fp(hl,In,So))})(x.sources,g.sources,ut,W);const Ht=[];x.layers&&x.layers.forEach(Jt=>{W[Jt.source]?S.push({command:id.removeLayer,args:[Jt.id]}):Ht.push(Jt)}),S=S.concat(ut),function(Jt,In,So){In=In||[];const al=(Jt=Jt||[]).map(Uf),hl=In.map(Uf),eh=Jt.reduce($f,{}),ah=In.reduce($f,{}),ch=al.slice(),dh=Object.create(null);let Dh,Ph,Xh,Qh,qh,lp,dp;for(Dh=0,Ph=0;Dh<al.length;Dh++)Xh=al[Dh],Object.prototype.hasOwnProperty.call(ah,Xh)?Ph++:(So.push({command:id.removeLayer,args:[Xh]}),ch.splice(ch.indexOf(Xh,Ph),1));for(Dh=0,Ph=0;Dh<hl.length;Dh++)Xh=hl[hl.length-1-Dh],ch[ch.length-1-Dh]!==Xh&&(Object.prototype.hasOwnProperty.call(eh,Xh)?(So.push({command:id.removeLayer,args:[Xh]}),ch.splice(ch.lastIndexOf(Xh,ch.length-Ph),1)):Ph++,lp=ch[ch.length-Dh],So.push({command:id.addLayer,args:[ah[Xh],lp]}),ch.splice(ch.length-Dh,0,Xh),dh[Xh]=!0);for(Dh=0;Dh<hl.length;Dh++)if(Xh=hl[Dh],Qh=eh[Xh],qh=ah[Xh],!dh[Xh]&&!cd(Qh,qh))if(cd(Qh.source,qh.source)&&cd(Qh["source-layer"],qh["source-layer"])&&cd(Qh.type,qh.type)){for(dp in kp(Qh.layout,qh.layout,So,Xh,null,id.setLayoutProperty),kp(Qh.paint,qh.paint,So,Xh,null,id.setPaintProperty),cd(Qh.filter,qh.filter)||So.push({command:id.setFilter,args:[Xh,qh.filter]}),cd(Qh.minzoom,qh.minzoom)&&cd(Qh.maxzoom,qh.maxzoom)||So.push({command:id.setLayerZoomRange,args:[Xh,qh.minzoom,qh.maxzoom]}),Qh)Object.prototype.hasOwnProperty.call(Qh,dp)&&dp!=="layout"&&dp!=="paint"&&dp!=="filter"&&dp!=="metadata"&&dp!=="minzoom"&&dp!=="maxzoom"&&(dp.indexOf("paint.")===0?kp(Qh[dp],qh[dp],So,Xh,dp.slice(6),id.setPaintProperty):cd(Qh[dp],qh[dp])||So.push({command:id.setLayerProperty,args:[Xh,dp,qh[dp]]}));for(dp in qh)Object.prototype.hasOwnProperty.call(qh,dp)&&!Object.prototype.hasOwnProperty.call(Qh,dp)&&dp!=="layout"&&dp!=="paint"&&dp!=="filter"&&dp!=="metadata"&&dp!=="minzoom"&&dp!=="maxzoom"&&(dp.indexOf("paint.")===0?kp(Qh[dp],qh[dp],So,Xh,dp.slice(6),id.setPaintProperty):cd(Qh[dp],qh[dp])||So.push({command:id.setLayerProperty,args:[Xh,dp,qh[dp]]}))}else So.push({command:id.removeLayer,args:[Xh]}),lp=ch[ch.lastIndexOf(Xh)+1],So.push({command:id.addLayer,args:[qh,lp]})}(Ht,g.layers,S)}catch(W){console.warn("Unable to compute style diff:",W),S=[{command:id.setStyle,args:[g]}]}return S},a.dot=function(x,g){return x[0]*g[0]+x[1]*g[1]+x[2]*g[2]+x[3]*g[3]},a.earthRadius=C1,a.ease=Wr,a.emitValidationErrors=kv,a.emptyStyle=function(){const x={},g=Yh.$version;for(const S in Yh.$root){const W=Yh.$root[S];if(W.required){let ut=null;ut=S==="version"?g:W.type==="array"?[]:{},ut!=null&&(x[S]=ut)}}return x},a.equals=function(x,g){var S=x[0],W=x[1],ut=x[2],Ht=x[3],Jt=x[4],In=x[5],So=x[6],al=x[7],hl=x[8],eh=x[9],ah=x[10],ch=x[11],dh=x[12],Dh=x[13],Ph=x[14],Xh=x[15],Qh=g[0],qh=g[1],lp=g[2],dp=g[3],Mp=g[4],Md=g[5],bd=g[6],_d=g[7],hd=g[8],ld=g[9],Sd=g[10],vd=g[11],Jp=g[12],Xd=g[13],Ud=g[14],ag=g[15];return Math.abs(S-Qh)<=dg*Math.max(1,Math.abs(S),Math.abs(Qh))&&Math.abs(W-qh)<=dg*Math.max(1,Math.abs(W),Math.abs(qh))&&Math.abs(ut-lp)<=dg*Math.max(1,Math.abs(ut),Math.abs(lp))&&Math.abs(Ht-dp)<=dg*Math.max(1,Math.abs(Ht),Math.abs(dp))&&Math.abs(Jt-Mp)<=dg*Math.max(1,Math.abs(Jt),Math.abs(Mp))&&Math.abs(In-Md)<=dg*Math.max(1,Math.abs(In),Math.abs(Md))&&Math.abs(So-bd)<=dg*Math.max(1,Math.abs(So),Math.abs(bd))&&Math.abs(al-_d)<=dg*Math.max(1,Math.abs(al),Math.abs(_d))&&Math.abs(hl-hd)<=dg*Math.max(1,Math.abs(hl),Math.abs(hd))&&Math.abs(eh-ld)<=dg*Math.max(1,Math.abs(eh),Math.abs(ld))&&Math.abs(ah-Sd)<=dg*Math.max(1,Math.abs(ah),Math.abs(Sd))&&Math.abs(ch-vd)<=dg*Math.max(1,Math.abs(ch),Math.abs(vd))&&Math.abs(dh-Jp)<=dg*Math.max(1,Math.abs(dh),Math.abs(Jp))&&Math.abs(Dh-Xd)<=dg*Math.max(1,Math.abs(Dh),Math.abs(Xd))&&Math.abs(Ph-Ud)<=dg*Math.max(1,Math.abs(Ph),Math.abs(Ud))&&Math.abs(Xh-ag)<=dg*Math.max(1,Math.abs(Xh),Math.abs(ag))},a.evaluateSizeForFeature=function(x,{uSize:g,uSizeT:S},{lowerSize:W,upperSize:ut}){return x.kind==="source"?W/gv:x.kind==="composite"?Km.number(W/gv,ut/gv,S):g},a.evaluateSizeForZoom=function(x,g){let S=0,W=0;if(x.kind==="constant")W=x.layoutSize;else if(x.kind!=="source"){const{interpolationType:ut,minZoom:Ht,maxZoom:Jt}=x,In=ut?yi(Em.interpolationFactor(ut,g,Ht,Jt),0,1):0;x.kind==="camera"?W=Km.number(x.minSize,x.maxSize,In):S=In}return{uSizeT:S,uSize:W}},a.evaluateVariableOffset=EC,a.evented=r_,a.exported=Ip,a.extend=vi,a.filterObject=ml,a.findLineIntersection=function(x,g,S,W){const ut=g.y-x.y,Ht=g.x-x.x,Jt=W.y-S.y,In=W.x-S.x,So=Jt*Ht-In*ut;if(So===0)return null;const al=(In*(x.y-S.y)-Jt*(x.x-S.x))/So;return new L(x.x+al*Ht,x.y+al*ut)},a.fromScaling=function(x,g){return x[0]=g[0],x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=g[1],x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=g[2],x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},a.getAnchorAlignment=fv,a.getAnchorJustification=Zw,a.getArrayBuffer=Wp,a.getDefaultExportFromCjs=h,a.getJSON=function(x,g){return od(vi(x,{type:"json"}),g)},a.getOverlapMode=gb,a.getProtocolAction=Gp,a.getRTLTextPluginStatus=w_,a.getReferrer=Cp,a.getVideo=function(x,g){const S=window.document.createElement("video");S.muted=!0,S.onloadstart=function(){g(null,S)};for(let W=0;W<x.length;W++){const ut=window.document.createElement("source");Ld(x[W])||(S.crossOrigin="Anonymous"),ut.src=x[W],S.appendChild(ut)}return{cancel:()=>{}}},a.groupByLayout=function(x,g){const S={};for(let ut=0;ut<x.length;ut++){const Ht=g&&g[x[ut].id]||W0(x[ut]);g&&(g[x[ut].id]=Ht);let Jt=S[Ht];Jt||(Jt=S[Ht]=[]),Jt.push(x[ut])}const W=[];for(const ut in S)W.push(S[ut]);return W},a.identity=Mg,a.interpolate=Km,a.invert=function(x,g){var S=g[0],W=g[1],ut=g[2],Ht=g[3],Jt=g[4],In=g[5],So=g[6],al=g[7],hl=g[8],eh=g[9],ah=g[10],ch=g[11],dh=g[12],Dh=g[13],Ph=g[14],Xh=g[15],Qh=S*In-W*Jt,qh=S*So-ut*Jt,lp=S*al-Ht*Jt,dp=W*So-ut*In,Mp=W*al-Ht*In,Md=ut*al-Ht*So,bd=hl*Dh-eh*dh,_d=hl*Ph-ah*dh,hd=hl*Xh-ch*dh,ld=eh*Ph-ah*Dh,Sd=eh*Xh-ch*Dh,vd=ah*Xh-ch*Ph,Jp=Qh*vd-qh*Sd+lp*ld+dp*hd-Mp*_d+Md*bd;return Jp?(x[0]=(In*vd-So*Sd+al*ld)*(Jp=1/Jp),x[1]=(ut*Sd-W*vd-Ht*ld)*Jp,x[2]=(Dh*Md-Ph*Mp+Xh*dp)*Jp,x[3]=(ah*Mp-eh*Md-ch*dp)*Jp,x[4]=(So*hd-Jt*vd-al*_d)*Jp,x[5]=(S*vd-ut*hd+Ht*_d)*Jp,x[6]=(Ph*lp-dh*Md-Xh*qh)*Jp,x[7]=(hl*Md-ah*lp+ch*qh)*Jp,x[8]=(Jt*Sd-In*hd+al*bd)*Jp,x[9]=(W*hd-S*Sd-Ht*bd)*Jp,x[10]=(dh*Mp-Dh*lp+Xh*Qh)*Jp,x[11]=(eh*lp-hl*Mp-ch*Qh)*Jp,x[12]=(In*_d-Jt*ld-So*bd)*Jp,x[13]=(S*ld-W*_d+ut*bd)*Jp,x[14]=(Dh*qh-dh*dp-Ph*Qh)*Jp,x[15]=(hl*dp-eh*qh+ah*Qh)*Jp,x):null},a.isImageBitmap=vp,a.isSafari=Mh,a.isWorker=wh,a.keysDifference=function(x,g){const S=[];for(const W in x)W in g||S.push(W);return S},a.lazyLoadRTLTextPlugin=function(){Bm.isLoading()||Bm.isLoaded()||w_()!=="deferred"||ex()},a.makeRequest=od,a.mapObject=gl,a.mercatorXfromLng=My,a.mercatorYfromLat=pC,a.mercatorZfromAltitude=S1,a.mul=b0,a.mul$1=function(x,g,S){return x[0]=g[0]*S[0],x[1]=g[1]*S[1],x[2]=g[2]*S[2],x[3]=g[3]*S[3],x},a.multiply=cy,a.nextPowerOfTwo=function(x){return x<=1?1:Math.pow(2,Math.ceil(Math.log(x)/Math.LN2))},a.operations=id,a.ortho=function(x,g,S,W,ut,Ht,Jt){var In=1/(g-S),So=1/(W-ut),al=1/(Ht-Jt);return x[0]=-2*In,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=-2*So,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=2*al,x[11]=0,x[12]=(g+S)*In,x[13]=(ut+W)*So,x[14]=(Jt+Ht)*al,x[15]=1,x},a.parseCacheControl=function(x){const g={};if(x.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(S,W,ut,Ht)=>{const Jt=ut||Ht;return g[W]=!Jt||Jt.toLowerCase(),""}),g["max-age"]){const S=parseInt(g["max-age"],10);isNaN(S)?delete g["max-age"]:g["max-age"]=S}return g},a.parseGlyphPbf=function(x){return new lb(x).readFields(zw,[])},a.pbf=ib,a.performSymbolLayout=function(x){x.bucket.createArrays(),x.bucket.tilePixelRatio=bp/(512*x.bucket.overscaling),x.bucket.compareText={},x.bucket.iconsNeedLinear=!1;const g=x.bucket.layers[0].layout,S=x.bucket.layers[0]._unevaluatedLayout._values,W={layoutIconSize:S["icon-size"].possiblyEvaluate(new Eg(x.bucket.zoom+1),x.canonical),layoutTextSize:S["text-size"].possiblyEvaluate(new Eg(x.bucket.zoom+1),x.canonical),textMaxSize:S["text-size"].possiblyEvaluate(new Eg(18))};if(x.bucket.textSizeData.kind==="composite"){const{minZoom:So,maxZoom:al}=x.bucket.textSizeData;W.compositeTextSizes=[S["text-size"].possiblyEvaluate(new Eg(So),x.canonical),S["text-size"].possiblyEvaluate(new Eg(al),x.canonical)]}if(x.bucket.iconSizeData.kind==="composite"){const{minZoom:So,maxZoom:al}=x.bucket.iconSizeData;W.compositeIconSizes=[S["icon-size"].possiblyEvaluate(new Eg(So),x.canonical),S["icon-size"].possiblyEvaluate(new Eg(al),x.canonical)]}const ut=g.get("text-line-height")*mm,Ht=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point",Jt=g.get("text-keep-upright"),In=g.get("text-size");for(const So of x.bucket.features){const al=g.get("text-font").evaluate(So,{},x.canonical).join(","),hl=In.evaluate(So,{},x.canonical),eh=W.layoutTextSize.evaluate(So,{},x.canonical),ah=W.layoutIconSize.evaluate(So,{},x.canonical),ch={horizontal:{},vertical:void 0},dh=So.text;let Dh,Ph=[0,0];if(dh){const qh=dh.toString(),lp=g.get("text-letter-spacing").evaluate(So,{},x.canonical)*mm,dp=J0(qh)?lp:0,Mp=g.get("text-anchor").evaluate(So,{},x.canonical),Md=g.get("text-variable-anchor");if(!Md){const Sd=g.get("text-radial-offset").evaluate(So,{},x.canonical);Ph=Sd?EC(Mp,[Sd*mm,Kw]):g.get("text-offset").evaluate(So,{},x.canonical).map(vd=>vd*mm)}let bd=Ht?"center":g.get("text-justify").evaluate(So,{},x.canonical);const _d=g.get("symbol-placement"),hd=_d==="point"?g.get("text-max-width").evaluate(So,{},x.canonical)*mm:0,ld=()=>{x.bucket.allowVerticalPlacement&&__(qh)&&(ch.vertical=Gw(dh,x.glyphMap,x.glyphPositions,x.imagePositions,al,hd,ut,Mp,"left",dp,Ph,a.WritingMode.vertical,!0,_d,eh,hl))};if(!Ht&&Md){const Sd=bd==="auto"?Md.map(Jp=>Zw(Jp)):[bd];let vd=!1;for(let Jp=0;Jp<Sd.length;Jp++){const Xd=Sd[Jp];if(!ch.horizontal[Xd])if(vd)ch.horizontal[Xd]=ch.horizontal[0];else{const Ud=Gw(dh,x.glyphMap,x.glyphPositions,x.imagePositions,al,hd,ut,"center",Xd,dp,Ph,a.WritingMode.horizontal,!1,_d,eh,hl);Ud&&(ch.horizontal[Xd]=Ud,vd=Ud.positionedLines.length===1)}}ld()}else{bd==="auto"&&(bd=Zw(Mp));const Sd=Gw(dh,x.glyphMap,x.glyphPositions,x.imagePositions,al,hd,ut,Mp,bd,dp,Ph,a.WritingMode.horizontal,!1,_d,eh,hl);Sd&&(ch.horizontal[bd]=Sd),ld(),__(qh)&&Ht&&Jt&&(ch.vertical=Gw(dh,x.glyphMap,x.glyphPositions,x.imagePositions,al,hd,ut,Mp,bd,dp,Ph,a.WritingMode.vertical,!1,_d,eh,hl))}}let Xh=!1;if(So.icon&&So.icon.name){const qh=x.imageMap[So.icon.name];qh&&(Dh=_1(x.imagePositions[So.icon.name],g.get("icon-offset").evaluate(So,{},x.canonical),g.get("icon-anchor").evaluate(So,{},x.canonical)),Xh=!!qh.sdf,x.bucket.sdfIcons===void 0?x.bucket.sdfIcons=Xh:x.bucket.sdfIcons!==Xh&&ol("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(qh.pixelRatio!==x.bucket.pixelRatio||g.get("icon-rotate").constantOr(1)!==0)&&(x.bucket.iconsNeedLinear=!0))}const Qh=SC(ch.horizontal)||ch.vertical;x.bucket.iconsInText=!!Qh&&Qh.iconsInText,(Qh||Dh)&&wb(x.bucket,So,ch,Dh,x.imageMap,W,eh,ah,Ph,Xh,x.canonical)}x.showCollisionBoxes&&x.bucket.generateCollisionDebugBuffers()},a.perspective=function(x,g,S,W,ut){var Ht,Jt=1/Math.tan(g/2);return x[0]=Jt/S,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=Jt,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,ut!=null&&ut!==1/0?(x[10]=(ut+W)*(Ht=1/(W-ut)),x[14]=2*ut*W*Ht):(x[10]=-1,x[14]=-2*W),x},a.pick=function(x,g){const S={};for(let W=0;W<g.length;W++){const ut=g[W];ut in x&&(S[ut]=x[ut])}return S},a.plugin=Bm,a.pointGeometry=y,a.polygonIntersectsPolygon=jf,a.potpack=g1,a.register=Td,a.registerForPluginStateChange=function(x){return x({pluginStatus:Tm,pluginURL:km}),r_.on("pluginStateChange",x),x},a.renderColorRamp=o1,a.rotateX=function(x,g,S){var W=Math.sin(S),ut=Math.cos(S),Ht=g[4],Jt=g[5],In=g[6],So=g[7],al=g[8],hl=g[9],eh=g[10],ah=g[11];return g!==x&&(x[0]=g[0],x[1]=g[1],x[2]=g[2],x[3]=g[3],x[12]=g[12],x[13]=g[13],x[14]=g[14],x[15]=g[15]),x[4]=Ht*ut+al*W,x[5]=Jt*ut+hl*W,x[6]=In*ut+eh*W,x[7]=So*ut+ah*W,x[8]=al*ut-Ht*W,x[9]=hl*ut-Jt*W,x[10]=eh*ut-In*W,x[11]=ah*ut-So*W,x},a.rotateZ=function(x,g,S){var W=Math.sin(S),ut=Math.cos(S),Ht=g[0],Jt=g[1],In=g[2],So=g[3],al=g[4],hl=g[5],eh=g[6],ah=g[7];return g!==x&&(x[8]=g[8],x[9]=g[9],x[10]=g[10],x[11]=g[11],x[12]=g[12],x[13]=g[13],x[14]=g[14],x[15]=g[15]),x[0]=Ht*ut+al*W,x[1]=Jt*ut+hl*W,x[2]=In*ut+eh*W,x[3]=So*ut+ah*W,x[4]=al*ut-Ht*W,x[5]=hl*ut-Jt*W,x[6]=eh*ut-In*W,x[7]=ah*ut-So*W,x},a.sameOrigin=Ld,a.scale=function(x,g,S){var W=S[0],ut=S[1],Ht=S[2];return x[0]=g[0]*W,x[1]=g[1]*W,x[2]=g[2]*W,x[3]=g[3]*W,x[4]=g[4]*ut,x[5]=g[5]*ut,x[6]=g[6]*ut,x[7]=g[7]*ut,x[8]=g[8]*Ht,x[9]=g[9]*Ht,x[10]=g[10]*Ht,x[11]=g[11]*Ht,x[12]=g[12],x[13]=g[13],x[14]=g[14],x[15]=g[15],x},a.setRTLTextPlugin=function(x,g,S=!1){if(Tm===Q0||Tm===tv||Tm===x_)throw new Error("setRTLTextPlugin cannot be called multiple times.");km=Ip.resolveURL(x),Tm=Q0,Vv=g,$v(),S||ex()},a.sphericalToCartesian=function([x,g,S]){return g+=90,g*=Math.PI/180,S*=Math.PI/180,{x:x*Math.cos(g)*Math.sin(S),y:x*Math.sin(g)*Math.sin(S),z:x*Math.cos(S)}},a.toEvaluationFeature=Pp,a.transformMat4=Zv,a.translate=function(x,g,S){var W,ut,Ht,Jt,In,So,al,hl,eh,ah,ch,dh,Dh=S[0],Ph=S[1],Xh=S[2];return g===x?(x[12]=g[0]*Dh+g[4]*Ph+g[8]*Xh+g[12],x[13]=g[1]*Dh+g[5]*Ph+g[9]*Xh+g[13],x[14]=g[2]*Dh+g[6]*Ph+g[10]*Xh+g[14],x[15]=g[3]*Dh+g[7]*Ph+g[11]*Xh+g[15]):(ut=g[1],Ht=g[2],Jt=g[3],In=g[4],So=g[5],al=g[6],hl=g[7],eh=g[8],ah=g[9],ch=g[10],dh=g[11],x[0]=W=g[0],x[1]=ut,x[2]=Ht,x[3]=Jt,x[4]=In,x[5]=So,x[6]=al,x[7]=hl,x[8]=eh,x[9]=ah,x[10]=ch,x[11]=dh,x[12]=W*Dh+In*Ph+eh*Xh+g[12],x[13]=ut*Dh+So*Ph+ah*Xh+g[13],x[14]=Ht*Dh+al*Ph+ch*Xh+g[14],x[15]=Jt*Dh+hl*Ph+dh*Xh+g[15]),x},a.triggerPluginCompletionEvent=Sx,a.unicodeBlockLookup=sd,a.uniqueId=function(){return wo++},a.v8Spec=Yh,a.validateCustomStyleLayer=function(x){const g=[],S=x.id;return S===void 0&&g.push({message:`layers.${S}: missing required property "id"`}),x.render===void 0&&g.push({message:`layers.${S}: missing required method "render"`}),x.renderingMode&&x.renderingMode!=="2d"&&x.renderingMode!=="3d"&&g.push({message:`layers.${S}: property "renderingMode" must be either "2d" or "3d"`}),g},a.validateLight=xw,a.validateStyle=y_,a.vectorTile=A_,a.warnOnce=ol,a.wrap=Bn}),s(["./shared"],function(a){class h{constructor(gs){this.keyCache={},gs&&this.replace(gs)}replace(gs){this._layerConfigs={},this._layers={},this.update(gs,[])}update(gs,di){for(const cl of gs){this._layerConfigs[cl.id]=cl;const ih=this._layers[cl.id]=a.createStyleLayer(cl);ih._featureFilter=a.createFilter(ih.filter),this.keyCache[cl.id]&&delete this.keyCache[cl.id]}for(const cl of di)delete this.keyCache[cl],delete this._layerConfigs[cl],delete this._layers[cl];this.familiesBySource={};const fs=a.groupByLayout(Object.values(this._layerConfigs),this.keyCache);for(const cl of fs){const ih=cl.map(ip=>this._layers[ip.id]),uh=ih[0];if(uh.visibility==="none")continue;const vh=uh.source||"";let Th=this.familiesBySource[vh];Th||(Th=this.familiesBySource[vh]={});const kh=uh.sourceLayer||"_geojsonTileLayer";let ep=Th[kh];ep||(ep=Th[kh]=[]),ep.push(ih)}}}class y{constructor(gs){const di={},fs=[];for(const vh in gs){const Th=gs[vh],kh=di[vh]={};for(const ep in Th){const ip=Th[+ep];if(!ip||ip.bitmap.width===0||ip.bitmap.height===0)continue;const _p={x:0,y:0,w:ip.bitmap.width+2,h:ip.bitmap.height+2};fs.push(_p),kh[ep]={rect:_p,metrics:ip.metrics}}}const{w:cl,h:ih}=a.potpack(fs),uh=new a.AlphaImage({width:cl||1,height:ih||1});for(const vh in gs){const Th=gs[vh];for(const kh in Th){const ep=Th[+kh];if(!ep||ep.bitmap.width===0||ep.bitmap.height===0)continue;const ip=di[vh][kh].rect;a.AlphaImage.copy(ep.bitmap,uh,{x:0,y:0},{x:ip.x+1,y:ip.y+1},ep.bitmap)}}this.image=uh,this.positions=di}}a.register("GlyphAtlas",y);class C{constructor(gs){this.tileID=new a.OverscaledTileID(gs.tileID.overscaledZ,gs.tileID.wrap,gs.tileID.canonical.z,gs.tileID.canonical.x,gs.tileID.canonical.y),this.uid=gs.uid,this.zoom=gs.zoom,this.pixelRatio=gs.pixelRatio,this.tileSize=gs.tileSize,this.source=gs.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=gs.showCollisionBoxes,this.collectResourceTiming=!!gs.collectResourceTiming,this.returnDependencies=!!gs.returnDependencies,this.promoteId=gs.promoteId}parse(gs,di,fs,cl,ih){this.status="parsing",this.data=gs,this.collisionBoxArray=new a.CollisionBoxArray;const uh=new a.DictionaryCoder(Object.keys(gs.layers).sort()),vh=new a.FeatureIndex(this.tileID,this.promoteId);vh.bucketLayerIDs=[];const Th={},kh={featureIndex:vh,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:fs},ep=di.familiesBySource[this.source];for(const Vf in ep){const Wf=gs.layers[Vf];if(!Wf)continue;Wf.version===1&&a.warnOnce(`Vector tile source "${this.source}" layer "${Vf}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const pg=uh.encode(Vf),Jd=[];for(let Yd=0;Yd<Wf.length;Yd++){const Cg=Wf.feature(Yd),oy=vh.getId(Cg,Vf);Jd.push({feature:Cg,id:oy,index:Yd,sourceLayerIndex:pg})}for(const Yd of ep[Vf]){const Cg=Yd[0];Cg.source!==this.source&&a.warnOnce(`layer.source = ${Cg.source} does not equal this.source = ${this.source}`),Cg.minzoom&&this.zoom<Math.floor(Cg.minzoom)||Cg.maxzoom&&this.zoom>=Cg.maxzoom||Cg.visibility!=="none"&&(L(Yd,this.zoom,fs),(Th[Cg.id]=Cg.createBucket({index:vh.bucketLayerIDs.length,layers:Yd,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:pg,sourceID:this.source})).populate(Jd,kh,this.tileID.canonical),vh.bucketLayerIDs.push(Yd.map(oy=>oy.id)))}}let ip,_p,rd,Dd;const qp=a.mapObject(kh.glyphDependencies,Vf=>Object.keys(Vf).map(Number));Object.keys(qp).length?cl.send("getGlyphs",{uid:this.uid,stacks:qp,source:this.source,tileID:this.tileID,type:"glyphs"},(Vf,Wf)=>{ip||(ip=Vf,_p=Wf,Wd.call(this))}):_p={};const wd=Object.keys(kh.iconDependencies);wd.length?cl.send("getImages",{icons:wd,source:this.source,tileID:this.tileID,type:"icons"},(Vf,Wf)=>{ip||(ip=Vf,rd=Wf,Wd.call(this))}):rd={};const dd=Object.keys(kh.patternDependencies);function Wd(){if(ip)return ih(ip);if(_p&&rd&&Dd){const Vf=new y(_p),Wf=new a.ImageAtlas(rd,Dd);for(const pg in Th){const Jd=Th[pg];Jd instanceof a.SymbolBucket?(L(Jd.layers,this.zoom,fs),a.performSymbolLayout({bucket:Jd,glyphMap:_p,glyphPositions:Vf.positions,imageMap:rd,imagePositions:Wf.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Jd.hasPattern&&(Jd instanceof a.LineBucket||Jd instanceof a.FillBucket||Jd instanceof a.FillExtrusionBucket)&&(L(Jd.layers,this.zoom,fs),Jd.addFeatures(kh,this.tileID.canonical,Wf.patternPositions))}this.status="done",ih(null,{buckets:Object.values(Th).filter(pg=>!pg.isEmpty()),featureIndex:vh,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Vf.image,imageAtlas:Wf,glyphMap:this.returnDependencies?_p:null,iconMap:this.returnDependencies?rd:null,glyphPositions:this.returnDependencies?Vf.positions:null})}}dd.length?cl.send("getImages",{icons:dd,source:this.source,tileID:this.tileID,type:"patterns"},(Vf,Wf)=>{ip||(ip=Vf,Dd=Wf,Wd.call(this))}):Dd={},Wd.call(this)}}function L(vl,gs,di){const fs=new a.EvaluationParameters(gs);for(const cl of vl)cl.recalculate(fs,di)}function Y(vl,gs){const di=a.getArrayBuffer(vl.request,(fs,cl,ih,uh)=>{fs?gs(fs):cl&&gs(null,{vectorTile:new a.vectorTile.VectorTile(new a.Protobuf(cl)),rawData:cl,cacheControl:ih,expires:uh})});return()=>{di.cancel(),gs()}}class ze{constructor(gs,di,fs,cl){this.actor=gs,this.layerIndex=di,this.availableImages=fs,this.loadVectorData=cl||Y,this.loading={},this.loaded={}}loadTile(gs,di){const fs=gs.uid;this.loading||(this.loading={});const cl=!!(gs&&gs.request&&gs.request.collectResourceTiming)&&new a.RequestPerformance(gs.request),ih=this.loading[fs]=new C(gs);ih.abort=this.loadVectorData(gs,(uh,vh)=>{if(delete this.loading[fs],uh||!vh)return ih.status="done",this.loaded[fs]=ih,di(uh);const Th=vh.rawData,kh={};vh.expires&&(kh.expires=vh.expires),vh.cacheControl&&(kh.cacheControl=vh.cacheControl);const ep={};if(cl){const ip=cl.finish();ip&&(ep.resourceTiming=JSON.parse(JSON.stringify(ip)))}ih.vectorTile=vh.vectorTile,ih.parse(vh.vectorTile,this.layerIndex,this.availableImages,this.actor,(ip,_p)=>{if(ip||!_p)return di(ip);di(null,a.extend({rawTileData:Th.slice(0)},_p,kh,ep))}),this.loaded=this.loaded||{},this.loaded[fs]=ih})}reloadTile(gs,di){const fs=this.loaded,cl=gs.uid,ih=this;if(fs&&fs[cl]){const uh=fs[cl];uh.showCollisionBoxes=gs.showCollisionBoxes;const vh=(Th,kh)=>{const ep=uh.reloadCallback;ep&&(delete uh.reloadCallback,uh.parse(uh.vectorTile,ih.layerIndex,this.availableImages,ih.actor,ep)),di(Th,kh)};uh.status==="parsing"?uh.reloadCallback=vh:uh.status==="done"&&(uh.vectorTile?uh.parse(uh.vectorTile,this.layerIndex,this.availableImages,this.actor,vh):vh())}}abortTile(gs,di){const fs=this.loading,cl=gs.uid;fs&&fs[cl]&&fs[cl].abort&&(fs[cl].abort(),delete fs[cl]),di()}removeTile(gs,di){const fs=this.loaded,cl=gs.uid;fs&&fs[cl]&&delete fs[cl],di()}}class Bt{constructor(){this.loaded={}}loadTile(gs,di){const{uid:fs,encoding:cl,rawImageData:ih}=gs,uh=a.isImageBitmap(ih)?this.getImageData(ih):ih,vh=new a.DEMData(fs,uh,cl);this.loaded=this.loaded||{},this.loaded[fs]=vh,di(null,vh)}getImageData(gs){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(gs.width,gs.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=gs.width,this.offscreenCanvas.height=gs.height,this.offscreenCanvasContext.drawImage(gs,0,0,gs.width,gs.height);const di=this.offscreenCanvasContext.getImageData(-1,-1,gs.width+2,gs.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new a.RGBAImage({width:di.width,height:di.height},di.data)}removeTile(gs){const di=this.loaded,fs=gs.uid;di&&di[fs]&&delete di[fs]}}function Ir(vl,gs){if(vl.length!==0){Wr(vl[0],gs);for(var di=1;di<vl.length;di++)Wr(vl[di],!gs)}}function Wr(vl,gs){for(var di=0,fs=0,cl=0,ih=vl.length,uh=ih-1;cl<ih;uh=cl++){var vh=(vl[cl][0]-vl[uh][0])*(vl[uh][1]+vl[cl][1]),Th=di+vh;fs+=Math.abs(di)>=Math.abs(vh)?di-Th+vh:vh-Th+di,di=Th}di+fs>=0!=!!gs&&vl.reverse()}var yi=a.getDefaultExportFromCjs(function vl(gs,di){var fs,cl=gs&&gs.type;if(cl==="FeatureCollection")for(fs=0;fs<gs.features.length;fs++)vl(gs.features[fs],di);else if(cl==="GeometryCollection")for(fs=0;fs<gs.geometries.length;fs++)vl(gs.geometries[fs],di);else if(cl==="Feature")vl(gs.geometry,di);else if(cl==="Polygon")Ir(gs.coordinates,di);else if(cl==="MultiPolygon")for(fs=0;fs<gs.coordinates.length;fs++)Ir(gs.coordinates[fs],di);return gs});const Bn=a.vectorTile.VectorTileFeature.prototype.toGeoJSON;var vi={exports:{}},wo=a.pointGeometry,ia=a.vectorTile.VectorTileFeature,gl=ml;function ml(vl,gs){this.options=gs||{},this.features=vl,this.length=vl.length}function il(vl,gs){this.id=typeof vl.id=="number"?vl.id:void 0,this.type=vl.type,this.rawGeometry=vl.type===1?[vl.geometry]:vl.geometry,this.properties=vl.tags,this.extent=gs||4096}ml.prototype.feature=function(vl){return new il(this.features[vl],this.options.extent)},il.prototype.loadGeometry=function(){var vl=this.rawGeometry;this.geometry=[];for(var gs=0;gs<vl.length;gs++){for(var di=vl[gs],fs=[],cl=0;cl<di.length;cl++)fs.push(new wo(di[cl][0],di[cl][1]));this.geometry.push(fs)}return this.geometry},il.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var vl=this.geometry,gs=1/0,di=-1/0,fs=1/0,cl=-1/0,ih=0;ih<vl.length;ih++)for(var uh=vl[ih],vh=0;vh<uh.length;vh++){var Th=uh[vh];gs=Math.min(gs,Th.x),di=Math.max(di,Th.x),fs=Math.min(fs,Th.y),cl=Math.max(cl,Th.y)}return[gs,fs,di,cl]},il.prototype.toGeoJSON=ia.prototype.toGeoJSON;var sl=a.pbf,ol=gl;function _l(vl){var gs=new sl;return function(di,fs){for(var cl in di.layers)fs.writeMessage(3,rh,di.layers[cl])}(vl,gs),gs.finish()}function rh(vl,gs){var di;gs.writeVarintField(15,vl.version||1),gs.writeStringField(1,vl.name||""),gs.writeVarintField(5,vl.extent||4096);var fs={keys:[],values:[],keycache:{},valuecache:{}};for(di=0;di<vl.length;di++)fs.feature=vl.feature(di),gs.writeMessage(2,wh,fs);var cl=fs.keys;for(di=0;di<cl.length;di++)gs.writeStringField(3,cl[di]);var ih=fs.values;for(di=0;di<ih.length;di++)gs.writeMessage(4,Jh,ih[di])}function wh(vl,gs){var di=vl.feature;di.id!==void 0&&gs.writeVarintField(1,di.id),gs.writeMessage(2,Fh,vl),gs.writeVarintField(3,di.type),gs.writeMessage(4,gp,di)}function Fh(vl,gs){var di=vl.feature,fs=vl.keys,cl=vl.values,ih=vl.keycache,uh=vl.valuecache;for(var vh in di.properties){var Th=di.properties[vh],kh=ih[vh];if(Th!==null){kh===void 0&&(fs.push(vh),ih[vh]=kh=fs.length-1),gs.writeVarint(kh);var ep=typeof Th;ep!=="string"&&ep!=="boolean"&&ep!=="number"&&(Th=JSON.stringify(Th));var ip=ep+":"+Th,_p=uh[ip];_p===void 0&&(cl.push(Th),uh[ip]=_p=cl.length-1),gs.writeVarint(_p)}}}function Mh(vl,gs){return(gs<<3)+(7&vl)}function vp(vl){return vl<<1^vl>>31}function gp(vl,gs){for(var di=vl.loadGeometry(),fs=vl.type,cl=0,ih=0,uh=di.length,vh=0;vh<uh;vh++){var Th=di[vh],kh=1;fs===1&&(kh=Th.length),gs.writeVarint(Mh(1,kh));for(var ep=fs===3?Th.length-1:Th.length,ip=0;ip<ep;ip++){ip===1&&fs!==1&&gs.writeVarint(Mh(2,ep-1));var _p=Th[ip].x-cl,rd=Th[ip].y-ih;gs.writeVarint(vp(_p)),gs.writeVarint(vp(rd)),cl+=_p,ih+=rd}fs===3&&gs.writeVarint(Mh(7,1))}}function Jh(vl,gs){var di=typeof vl;di==="string"?gs.writeStringField(1,vl):di==="boolean"?gs.writeBooleanField(7,vl):di==="number"&&(vl%1!=0?gs.writeDoubleField(3,vl):vl<0?gs.writeSVarintField(6,vl):gs.writeVarintField(5,vl))}vi.exports=_l,vi.exports.fromVectorTileJs=_l,vi.exports.fromGeojsonVt=function(vl,gs){gs=gs||{};var di={};for(var fs in vl)di[fs]=new ol(vl[fs].features,gs),di[fs].name=fs,di[fs].version=gs.version,di[fs].extent=gs.extent;return _l({layers:di})},vi.exports.GeoJSONWrapper=ol;var Lp=a.getDefaultExportFromCjs(vi.exports);const Ip={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:vl=>vl},$p=Math.fround||(Xp=new Float32Array(1),vl=>(Xp[0]=+vl,Xp[0]));var Xp;const Cp=3,Gp=5,Rp=6;class od{constructor(gs){this.options=Object.assign(Object.create(Ip),gs),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(gs){const{log:di,minZoom:fs,maxZoom:cl}=this.options;di&&console.time("total time");const ih=`prepare ${gs.length} points`;di&&console.time(ih),this.points=gs;const uh=[];for(let Th=0;Th<gs.length;Th++){const kh=gs[Th];if(!kh.geometry)continue;const[ep,ip]=kh.geometry.coordinates,_p=$p(ed(ep)),rd=$p(Gd(ip));uh.push(_p,rd,1/0,Th,-1,1),this.options.reduce&&uh.push(0)}let vh=this.trees[cl+1]=this._createTree(uh);di&&console.timeEnd(ih);for(let Th=cl;Th>=fs;Th--){const kh=+Date.now();vh=this.trees[Th]=this._createTree(this._cluster(vh,Th)),di&&console.log("z%d: %d clusters in %dms",Th,vh.numItems,+Date.now()-kh)}return di&&console.timeEnd("total time"),this}getClusters(gs,di){let fs=((gs[0]+180)%360+360)%360-180;const cl=Math.max(-90,Math.min(90,gs[1]));let ih=gs[2]===180?180:((gs[2]+180)%360+360)%360-180;const uh=Math.max(-90,Math.min(90,gs[3]));if(gs[2]-gs[0]>=360)fs=-180,ih=180;else if(fs>ih){const ip=this.getClusters([fs,cl,180,uh],di),_p=this.getClusters([-180,cl,ih,uh],di);return ip.concat(_p)}const vh=this.trees[this._limitZoom(di)],Th=vh.range(ed(fs),Gd(uh),ed(ih),Gd(cl)),kh=vh.data,ep=[];for(const ip of Th){const _p=this.stride*ip;ep.push(kh[_p+Gp]>1?Wp(kh,_p,this.clusterProps):this.points[kh[_p+Cp]])}return ep}getChildren(gs){const di=this._getOriginId(gs),fs=this._getOriginZoom(gs),cl="No cluster with the specified id.",ih=this.trees[fs];if(!ih)throw new Error(cl);const uh=ih.data;if(di*this.stride>=uh.length)throw new Error(cl);const vh=this.options.radius/(this.options.extent*Math.pow(2,fs-1)),Th=ih.within(uh[di*this.stride],uh[di*this.stride+1],vh),kh=[];for(const ep of Th){const ip=ep*this.stride;uh[ip+4]===gs&&kh.push(uh[ip+Gp]>1?Wp(uh,ip,this.clusterProps):this.points[uh[ip+Cp]])}if(kh.length===0)throw new Error(cl);return kh}getLeaves(gs,di,fs){const cl=[];return this._appendLeaves(cl,gs,di=di||10,fs=fs||0,0),cl}getTile(gs,di,fs){const cl=this.trees[this._limitZoom(gs)],ih=Math.pow(2,gs),{extent:uh,radius:vh}=this.options,Th=vh/uh,kh=(fs-Th)/ih,ep=(fs+1+Th)/ih,ip={features:[]};return this._addTileFeatures(cl.range((di-Th)/ih,kh,(di+1+Th)/ih,ep),cl.data,di,fs,ih,ip),di===0&&this._addTileFeatures(cl.range(1-Th/ih,kh,1,ep),cl.data,ih,fs,ih,ip),di===ih-1&&this._addTileFeatures(cl.range(0,kh,Th/ih,ep),cl.data,-1,fs,ih,ip),ip.features.length?ip:null}getClusterExpansionZoom(gs){let di=this._getOriginZoom(gs)-1;for(;di<=this.options.maxZoom;){const fs=this.getChildren(gs);if(di++,fs.length!==1)break;gs=fs[0].properties.cluster_id}return di}_appendLeaves(gs,di,fs,cl,ih){const uh=this.getChildren(di);for(const vh of uh){const Th=vh.properties;if(Th&&Th.cluster?ih+Th.point_count<=cl?ih+=Th.point_count:ih=this._appendLeaves(gs,Th.cluster_id,fs,cl,ih):ih<cl?ih++:gs.push(vh),gs.length===fs)break}return ih}_createTree(gs){const di=new a.KDBush(gs.length/this.stride|0,this.options.nodeSize,Float32Array);for(let fs=0;fs<gs.length;fs+=this.stride)di.add(gs[fs],gs[fs+1]);return di.finish(),di.data=gs,di}_addTileFeatures(gs,di,fs,cl,ih,uh){for(const vh of gs){const Th=vh*this.stride,kh=di[Th+Gp]>1;let ep,ip,_p;if(kh)ep=Ld(di,Th,this.clusterProps),ip=di[Th],_p=di[Th+1];else{const qp=this.points[di[Th+Cp]];ep=qp.properties;const[wd,dd]=qp.geometry.coordinates;ip=ed(wd),_p=Gd(dd)}const rd={type:1,geometry:[[Math.round(this.options.extent*(ip*ih-fs)),Math.round(this.options.extent*(_p*ih-cl))]],tags:ep};let Dd;Dd=kh||this.options.generateId?di[Th+Cp]:this.points[di[Th+Cp]].id,Dd!==void 0&&(rd.id=Dd),uh.features.push(rd)}}_limitZoom(gs){return Math.max(this.options.minZoom,Math.min(Math.floor(+gs),this.options.maxZoom+1))}_cluster(gs,di){const{radius:fs,extent:cl,reduce:ih,minPoints:uh}=this.options,vh=fs/(cl*Math.pow(2,di)),Th=gs.data,kh=[],ep=this.stride;for(let ip=0;ip<Th.length;ip+=ep){if(Th[ip+2]<=di)continue;Th[ip+2]=di;const _p=Th[ip],rd=Th[ip+1],Dd=gs.within(Th[ip],Th[ip+1],vh),qp=Th[ip+Gp];let wd=qp;for(const dd of Dd){const Wd=dd*ep;Th[Wd+2]>di&&(wd+=Th[Wd+Gp])}if(wd>qp&&wd>=uh){let dd,Wd=_p*qp,Vf=rd*qp,Wf=-1;const pg=((ip/ep|0)<<5)+(di+1)+this.points.length;for(const Jd of Dd){const Yd=Jd*ep;if(Th[Yd+2]<=di)continue;Th[Yd+2]=di;const Cg=Th[Yd+Gp];Wd+=Th[Yd]*Cg,Vf+=Th[Yd+1]*Cg,Th[Yd+4]=pg,ih&&(dd||(dd=this._map(Th,ip,!0),Wf=this.clusterProps.length,this.clusterProps.push(dd)),ih(dd,this._map(Th,Yd)))}Th[ip+4]=pg,kh.push(Wd/wd,Vf/wd,1/0,pg,-1,wd),ih&&kh.push(Wf)}else{for(let dd=0;dd<ep;dd++)kh.push(Th[ip+dd]);if(wd>1)for(const dd of Dd){const Wd=dd*ep;if(!(Th[Wd+2]<=di)){Th[Wd+2]=di;for(let Vf=0;Vf<ep;Vf++)kh.push(Th[Wd+Vf])}}}}return kh}_getOriginId(gs){return gs-this.points.length>>5}_getOriginZoom(gs){return(gs-this.points.length)%32}_map(gs,di,fs){if(gs[di+Gp]>1){const uh=this.clusterProps[gs[di+Rp]];return fs?Object.assign({},uh):uh}const cl=this.points[gs[di+Cp]].properties,ih=this.options.map(cl);return fs&&ih===cl?Object.assign({},ih):ih}}function Wp(vl,gs,di){return{type:"Feature",id:vl[gs+Cp],properties:Ld(vl,gs,di),geometry:{type:"Point",coordinates:[(fs=vl[gs],360*(fs-.5)),Kp(vl[gs+1])]}};var fs}function Ld(vl,gs,di){const fs=vl[gs+Gp],cl=fs>=1e4?`${Math.round(fs/1e3)}k`:fs>=1e3?Math.round(fs/100)/10+"k":fs,ih=vl[gs+Rp],uh=ih===-1?{}:Object.assign({},di[ih]);return Object.assign(uh,{cluster:!0,cluster_id:vl[gs+Cp],point_count:fs,point_count_abbreviated:cl})}function ed(vl){return vl/360+.5}function Gd(vl){const gs=Math.sin(vl*Math.PI/180),di=.5-.25*Math.log((1+gs)/(1-gs))/Math.PI;return di<0?0:di>1?1:di}function Kp(vl){const gs=(180-360*vl)*Math.PI/180;return 360*Math.atan(Math.exp(gs))/Math.PI-90}function Ad(vl,gs,di,fs){for(var cl,ih=fs,uh=di-gs>>1,vh=di-gs,Th=vl[gs],kh=vl[gs+1],ep=vl[di],ip=vl[di+1],_p=gs+3;_p<di;_p+=3){var rd=Id(vl[_p],vl[_p+1],Th,kh,ep,ip);if(rd>ih)cl=_p,ih=rd;else if(rd===ih){var Dd=Math.abs(_p-uh);Dd<vh&&(cl=_p,vh=Dd)}}ih>fs&&(cl-gs>3&&Ad(vl,gs,cl,fs),vl[cl+2]=ih,di-cl>3&&Ad(vl,cl,di,fs))}function Id(vl,gs,di,fs,cl,ih){var uh=cl-di,vh=ih-fs;if(uh!==0||vh!==0){var Th=((vl-di)*uh+(gs-fs)*vh)/(uh*uh+vh*vh);Th>1?(di=cl,fs=ih):Th>0&&(di+=uh*Th,fs+=vh*Th)}return(uh=vl-di)*uh+(vh=gs-fs)*vh}function Yh(vl,gs,di,fs){var cl={id:vl===void 0?null:vl,type:gs,geometry:di,tags:fs,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ih){var uh=ih.geometry,vh=ih.type;if(vh==="Point"||vh==="MultiPoint"||vh==="LineString")Ap(ih,uh);else if(vh==="Polygon"||vh==="MultiLineString")for(var Th=0;Th<uh.length;Th++)Ap(ih,uh[Th]);else if(vh==="MultiPolygon")for(Th=0;Th<uh.length;Th++)for(var kh=0;kh<uh[Th].length;kh++)Ap(ih,uh[Th][kh])}(cl),cl}function Ap(vl,gs){for(var di=0;di<gs.length;di+=3)vl.minX=Math.min(vl.minX,gs[di]),vl.minY=Math.min(vl.minY,gs[di+1]),vl.maxX=Math.max(vl.maxX,gs[di]),vl.maxY=Math.max(vl.maxY,gs[di+1])}function kd(vl,gs,di,fs){if(gs.geometry){var cl=gs.geometry.coordinates,ih=gs.geometry.type,uh=Math.pow(di.tolerance/((1<<di.maxZoom)*di.extent),2),vh=[],Th=gs.id;if(di.promoteId?Th=gs.properties[di.promoteId]:di.generateId&&(Th=fs||0),ih==="Point")cd(cl,vh);else if(ih==="MultiPoint")for(var kh=0;kh<cl.length;kh++)cd(cl[kh],vh);else if(ih==="LineString")id(cl,vh,uh,!1);else if(ih==="MultiLineString"){if(di.lineMetrics){for(kh=0;kh<cl.length;kh++)id(cl[kh],vh=[],uh,!1),vl.push(Yh(Th,"LineString",vh,gs.properties));return}fp(cl,vh,uh,!1)}else if(ih==="Polygon")fp(cl,vh,uh,!0);else{if(ih!=="MultiPolygon"){if(ih==="GeometryCollection"){for(kh=0;kh<gs.geometry.geometries.length;kh++)kd(vl,{id:Th,geometry:gs.geometry.geometries[kh],properties:gs.properties},di,fs);return}throw new Error("Input data is not a valid GeoJSON object.")}for(kh=0;kh<cl.length;kh++){var ep=[];fp(cl[kh],ep,uh,!0),vh.push(ep)}}vl.push(Yh(Th,ih,vh,gs.properties))}}function cd(vl,gs){gs.push(Cd(vl[0])),gs.push(Fd(vl[1])),gs.push(0)}function id(vl,gs,di,fs){for(var cl,ih,uh=0,vh=0;vh<vl.length;vh++){var Th=Cd(vl[vh][0]),kh=Fd(vl[vh][1]);gs.push(Th),gs.push(kh),gs.push(0),vh>0&&(uh+=fs?(cl*kh-Th*ih)/2:Math.sqrt(Math.pow(Th-cl,2)+Math.pow(kh-ih,2))),cl=Th,ih=kh}var ep=gs.length-3;gs[2]=1,Ad(gs,0,ep,di),gs[ep+2]=1,gs.size=Math.abs(uh),gs.start=0,gs.end=gs.size}function fp(vl,gs,di,fs){for(var cl=0;cl<vl.length;cl++){var ih=[];id(vl[cl],ih,di,fs),gs.push(ih)}}function Cd(vl){return vl/360+.5}function Fd(vl){var gs=Math.sin(vl*Math.PI/180),di=.5-.25*Math.log((1+gs)/(1-gs))/Math.PI;return di<0?0:di>1?1:di}function yd(vl,gs,di,fs,cl,ih,uh,vh){if(fs/=gs,ih>=(di/=gs)&&uh<fs)return vl;if(uh<di||ih>=fs)return null;for(var Th=[],kh=0;kh<vl.length;kh++){var ep=vl[kh],ip=ep.geometry,_p=ep.type,rd=cl===0?ep.minX:ep.minY,Dd=cl===0?ep.maxX:ep.maxY;if(rd>=di&&Dd<fs)Th.push(ep);else if(!(Dd<di||rd>=fs)){var qp=[];if(_p==="Point"||_p==="MultiPoint")kp(ip,qp,di,fs,cl);else if(_p==="LineString")Uf(ip,qp,di,fs,cl,!1,vh.lineMetrics);else if(_p==="MultiLineString")up(ip,qp,di,fs,cl,!1);else if(_p==="Polygon")up(ip,qp,di,fs,cl,!0);else if(_p==="MultiPolygon")for(var wd=0;wd<ip.length;wd++){var dd=[];up(ip[wd],dd,di,fs,cl,!0),dd.length&&qp.push(dd)}if(qp.length){if(vh.lineMetrics&&_p==="LineString"){for(wd=0;wd<qp.length;wd++)Th.push(Yh(ep.id,_p,qp[wd],ep.tags));continue}_p!=="LineString"&&_p!=="MultiLineString"||(qp.length===1?(_p="LineString",qp=qp[0]):_p="MultiLineString"),_p!=="Point"&&_p!=="MultiPoint"||(_p=qp.length===3?"Point":"MultiPoint"),Th.push(Yh(ep.id,_p,qp,ep.tags))}}}return Th.length?Th:null}function kp(vl,gs,di,fs,cl){for(var ih=0;ih<vl.length;ih+=3){var uh=vl[ih+cl];uh>=di&&uh<=fs&&(gs.push(vl[ih]),gs.push(vl[ih+1]),gs.push(vl[ih+2]))}}function Uf(vl,gs,di,fs,cl,ih,uh){for(var vh,Th,kh=$f(vl),ep=cl===0?xd:Ed,ip=vl.start,_p=0;_p<vl.length-3;_p+=3){var rd=vl[_p],Dd=vl[_p+1],qp=vl[_p+2],wd=vl[_p+3],dd=vl[_p+4],Wd=cl===0?rd:Dd,Vf=cl===0?wd:dd,Wf=!1;uh&&(vh=Math.sqrt(Math.pow(rd-wd,2)+Math.pow(Dd-dd,2))),Wd<di?Vf>di&&(Th=ep(kh,rd,Dd,wd,dd,di),uh&&(kh.start=ip+vh*Th)):Wd>fs?Vf<fs&&(Th=ep(kh,rd,Dd,wd,dd,fs),uh&&(kh.start=ip+vh*Th)):ud(kh,rd,Dd,qp),Vf<di&&Wd>=di&&(Th=ep(kh,rd,Dd,wd,dd,di),Wf=!0),Vf>fs&&Wd<=fs&&(Th=ep(kh,rd,Dd,wd,dd,fs),Wf=!0),!ih&&Wf&&(uh&&(kh.end=ip+vh*Th),gs.push(kh),kh=$f(vl)),uh&&(ip+=vh)}var pg=vl.length-3;rd=vl[pg],Dd=vl[pg+1],qp=vl[pg+2],(Wd=cl===0?rd:Dd)>=di&&Wd<=fs&&ud(kh,rd,Dd,qp),pg=kh.length-3,ih&&pg>=3&&(kh[pg]!==kh[0]||kh[pg+1]!==kh[1])&&ud(kh,kh[0],kh[1],kh[2]),kh.length&&gs.push(kh)}function $f(vl){var gs=[];return gs.size=vl.size,gs.start=vl.start,gs.end=vl.end,gs}function up(vl,gs,di,fs,cl,ih){for(var uh=0;uh<vl.length;uh++)Uf(vl[uh],gs,di,fs,cl,ih,!1)}function ud(vl,gs,di,fs){vl.push(gs),vl.push(di),vl.push(fs)}function xd(vl,gs,di,fs,cl,ih){var uh=(ih-gs)/(fs-gs);return vl.push(ih),vl.push(di+(cl-di)*uh),vl.push(1),uh}function Ed(vl,gs,di,fs,cl,ih){var uh=(ih-di)/(cl-di);return vl.push(gs+(fs-gs)*uh),vl.push(ih),vl.push(1),uh}function Vd(vl,gs){for(var di=[],fs=0;fs<vl.length;fs++){var cl,ih=vl[fs],uh=ih.type;if(uh==="Point"||uh==="MultiPoint"||uh==="LineString")cl=Ep(ih.geometry,gs);else if(uh==="MultiLineString"||uh==="Polygon"){cl=[];for(var vh=0;vh<ih.geometry.length;vh++)cl.push(Ep(ih.geometry[vh],gs))}else if(uh==="MultiPolygon")for(cl=[],vh=0;vh<ih.geometry.length;vh++){for(var Th=[],kh=0;kh<ih.geometry[vh].length;kh++)Th.push(Ep(ih.geometry[vh][kh],gs));cl.push(Th)}di.push(Yh(ih.id,uh,cl,ih.tags))}return di}function Ep(vl,gs){var di=[];di.size=vl.size,vl.start!==void 0&&(di.start=vl.start,di.end=vl.end);for(var fs=0;fs<vl.length;fs+=3)di.push(vl[fs]+gs,vl[fs+1],vl[fs+2]);return di}function Yp(vl,gs){if(vl.transformed)return vl;var di,fs,cl,ih=1<<vl.z,uh=vl.x,vh=vl.y;for(di=0;di<vl.features.length;di++){var Th=vl.features[di],kh=Th.geometry,ep=Th.type;if(Th.geometry=[],ep===1)for(fs=0;fs<kh.length;fs+=2)Th.geometry.push(nd(kh[fs],kh[fs+1],gs,ih,uh,vh));else for(fs=0;fs<kh.length;fs++){var ip=[];for(cl=0;cl<kh[fs].length;cl+=2)ip.push(nd(kh[fs][cl],kh[fs][cl+1],gs,ih,uh,vh));Th.geometry.push(ip)}}return vl.transformed=!0,vl}function nd(vl,gs,di,fs,cl,ih){return[Math.round(di*(vl*fs-cl)),Math.round(di*(gs*fs-ih))]}function $d(vl,gs,di,fs,cl){for(var ih=gs===cl.maxZoom?0:cl.tolerance/((1<<gs)*cl.extent),uh={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:di,y:fs,z:gs,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},vh=0;vh<vl.length;vh++){uh.numFeatures++,Qd(uh,vl[vh],ih,cl);var Th=vl[vh].minX,kh=vl[vh].minY,ep=vl[vh].maxX,ip=vl[vh].maxY;Th<uh.minX&&(uh.minX=Th),kh<uh.minY&&(uh.minY=kh),ep>uh.maxX&&(uh.maxX=ep),ip>uh.maxY&&(uh.maxY=ip)}return uh}function Qd(vl,gs,di,fs){var cl=gs.geometry,ih=gs.type,uh=[];if(ih==="Point"||ih==="MultiPoint")for(var vh=0;vh<cl.length;vh+=3)uh.push(cl[vh]),uh.push(cl[vh+1]),vl.numPoints++,vl.numSimplified++;else if(ih==="LineString")Rd(uh,cl,vl,di,!1,!1);else if(ih==="MultiLineString"||ih==="Polygon")for(vh=0;vh<cl.length;vh++)Rd(uh,cl[vh],vl,di,ih==="Polygon",vh===0);else if(ih==="MultiPolygon")for(var Th=0;Th<cl.length;Th++){var kh=cl[Th];for(vh=0;vh<kh.length;vh++)Rd(uh,kh[vh],vl,di,!0,vh===0)}if(uh.length){var ep=gs.tags||null;if(ih==="LineString"&&fs.lineMetrics){for(var ip in ep={},gs.tags)ep[ip]=gs.tags[ip];ep.mapbox_clip_start=cl.start/cl.size,ep.mapbox_clip_end=cl.end/cl.size}var _p={geometry:uh,type:ih==="Polygon"||ih==="MultiPolygon"?3:ih==="LineString"||ih==="MultiLineString"?2:1,tags:ep};gs.id!==null&&(_p.id=gs.id),vl.features.push(_p)}}function Rd(vl,gs,di,fs,cl,ih){var uh=fs*fs;if(fs>0&&gs.size<(cl?uh:fs))di.numPoints+=gs.length/3;else{for(var vh=[],Th=0;Th<gs.length;Th+=3)(fs===0||gs[Th+2]>uh)&&(di.numSimplified++,vh.push(gs[Th]),vh.push(gs[Th+1])),di.numPoints++;cl&&function(kh,ep){for(var ip=0,_p=0,rd=kh.length,Dd=rd-2;_p<rd;Dd=_p,_p+=2)ip+=(kh[_p]-kh[Dd])*(kh[_p+1]+kh[Dd+1]);if(ip>0===ep)for(_p=0,rd=kh.length;_p<rd/2;_p+=2){var qp=kh[_p],wd=kh[_p+1];kh[_p]=kh[rd-2-_p],kh[_p+1]=kh[rd-1-_p],kh[rd-2-_p]=qp,kh[rd-1-_p]=wd}}(vh,ih),vl.push(vh)}}function ng(vl,gs){var di=(gs=this.options=function(cl,ih){for(var uh in ih)cl[uh]=ih[uh];return cl}(Object.create(this.options),gs)).debug;if(di&&console.time("preprocess data"),gs.maxZoom<0||gs.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(gs.promoteId&&gs.generateId)throw new Error("promoteId and generateId cannot be used together.");var fs=function(cl,ih){var uh=[];if(cl.type==="FeatureCollection")for(var vh=0;vh<cl.features.length;vh++)kd(uh,cl.features[vh],ih,vh);else kd(uh,cl.type==="Feature"?cl:{geometry:cl},ih);return uh}(vl,gs);this.tiles={},this.tileCoords=[],di&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",gs.indexMaxZoom,gs.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),fs=function(cl,ih){var uh=ih.buffer/ih.extent,vh=cl,Th=yd(cl,1,-1-uh,uh,0,-1,2,ih),kh=yd(cl,1,1-uh,2+uh,0,-1,2,ih);return(Th||kh)&&(vh=yd(cl,1,-uh,1+uh,0,-1,2,ih)||[],Th&&(vh=Vd(Th,1).concat(vh)),kh&&(vh=vh.concat(Vd(kh,-1)))),vh}(fs,gs),fs.length&&this.splitTile(fs,0,0,0),di&&(fs.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function bg(vl,gs,di){return 32*((1<<vl)*di+gs)+vl}function Ih(vl,gs){return gs?vl.properties[gs]:vl.id}function nh(vl,gs){if(vl==null)return!0;if(vl.type==="Feature")return Ih(vl,gs)!=null;if(vl.type==="FeatureCollection"){const di=new Set;for(const fs of vl.features){const cl=Ih(fs,gs);if(cl==null||di.has(cl))return!1;di.add(cl)}return!0}return!1}function sh(vl,gs){const di=new Map;if(vl!=null)if(vl.type==="Feature")di.set(Ih(vl,gs),vl);else for(const fs of vl.features)di.set(Ih(fs,gs),fs);return di}function oh(vl,gs){const di=vl.tileID.canonical;if(!this._geoJSONIndex)return gs(null,null);const fs=this._geoJSONIndex.getTile(di.z,di.x,di.y);if(!fs)return gs(null,null);const cl=new class{constructor(uh){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=uh.length,this._features=uh}feature(uh){return new class{constructor(vh){this._feature=vh,this.extent=a.EXTENT,this.type=vh.type,this.properties=vh.tags,"id"in vh&&!isNaN(vh.id)&&(this.id=parseInt(vh.id,10))}loadGeometry(){if(this._feature.type===1){const vh=[];for(const Th of this._feature.geometry)vh.push([new a.Point(Th[0],Th[1])]);return vh}{const vh=[];for(const Th of this._feature.geometry){const kh=[];for(const ep of Th)kh.push(new a.Point(ep[0],ep[1]));vh.push(kh)}return vh}}toGeoJSON(vh,Th,kh){return Bn.call(this,vh,Th,kh)}}(this._features[uh])}}(fs.features);let ih=Lp(cl);ih.byteOffset===0&&ih.byteLength===ih.buffer.byteLength||(ih=new Uint8Array(ih)),gs(null,{vectorTile:cl,rawData:ih.buffer})}ng.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ng.prototype.splitTile=function(vl,gs,di,fs,cl,ih,uh){for(var vh=[vl,gs,di,fs],Th=this.options,kh=Th.debug;vh.length;){fs=vh.pop(),di=vh.pop(),gs=vh.pop(),vl=vh.pop();var ep=1<<gs,ip=bg(gs,di,fs),_p=this.tiles[ip];if(!_p&&(kh>1&&console.time("creation"),_p=this.tiles[ip]=$d(vl,gs,di,fs,Th),this.tileCoords.push({z:gs,x:di,y:fs}),kh)){kh>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",gs,di,fs,_p.numFeatures,_p.numPoints,_p.numSimplified),console.timeEnd("creation"));var rd="z"+gs;this.stats[rd]=(this.stats[rd]||0)+1,this.total++}if(_p.source=vl,cl){if(gs===Th.maxZoom||gs===cl)continue;var Dd=1<<cl-gs;if(di!==Math.floor(ih/Dd)||fs!==Math.floor(uh/Dd))continue}else if(gs===Th.indexMaxZoom||_p.numPoints<=Th.indexMaxPoints)continue;if(_p.source=null,vl.length!==0){kh>1&&console.time("clipping");var qp,wd,dd,Wd,Vf,Wf,pg=.5*Th.buffer/Th.extent,Jd=.5-pg,Yd=.5+pg,Cg=1+pg;qp=wd=dd=Wd=null,Vf=yd(vl,ep,di-pg,di+Yd,0,_p.minX,_p.maxX,Th),Wf=yd(vl,ep,di+Jd,di+Cg,0,_p.minX,_p.maxX,Th),vl=null,Vf&&(qp=yd(Vf,ep,fs-pg,fs+Yd,1,_p.minY,_p.maxY,Th),wd=yd(Vf,ep,fs+Jd,fs+Cg,1,_p.minY,_p.maxY,Th),Vf=null),Wf&&(dd=yd(Wf,ep,fs-pg,fs+Yd,1,_p.minY,_p.maxY,Th),Wd=yd(Wf,ep,fs+Jd,fs+Cg,1,_p.minY,_p.maxY,Th),Wf=null),kh>1&&console.timeEnd("clipping"),vh.push(qp||[],gs+1,2*di,2*fs),vh.push(wd||[],gs+1,2*di,2*fs+1),vh.push(dd||[],gs+1,2*di+1,2*fs),vh.push(Wd||[],gs+1,2*di+1,2*fs+1)}}},ng.prototype.getTile=function(vl,gs,di){var fs=this.options,cl=fs.extent,ih=fs.debug;if(vl<0||vl>24)return null;var uh=1<<vl,vh=bg(vl,gs=(gs%uh+uh)%uh,di);if(this.tiles[vh])return Yp(this.tiles[vh],cl);ih>1&&console.log("drilling down to z%d-%d-%d",vl,gs,di);for(var Th,kh=vl,ep=gs,ip=di;!Th&&kh>0;)kh--,ep=Math.floor(ep/2),ip=Math.floor(ip/2),Th=this.tiles[bg(kh,ep,ip)];return Th&&Th.source?(ih>1&&console.log("found parent tile z%d-%d-%d",kh,ep,ip),ih>1&&console.time("drilling down"),this.splitTile(Th.source,kh,ep,ip,vl,gs,di),ih>1&&console.timeEnd("drilling down"),this.tiles[vh]?Yp(this.tiles[vh],cl):null):null};class Oh extends ze{constructor(gs,di,fs,cl){super(gs,di,fs,oh),this._dataUpdateable=new Map,this.loadGeoJSON=(ih,uh)=>{const{promoteId:vh}=ih;if(ih.request)return a.getJSON(ih.request,(Th,kh,ep,ip)=>{this._dataUpdateable=nh(kh,vh)?sh(kh,vh):void 0,uh(Th,kh,ep,ip)});if(typeof ih.data=="string")try{const Th=JSON.parse(ih.data);this._dataUpdateable=nh(Th,vh)?sh(Th,vh):void 0,uh(null,Th)}catch{uh(new Error(`Input data given to '${ih.source}' is not a valid GeoJSON object.`))}else ih.dataDiff?this._dataUpdateable?(function(Th,kh,ep){var ip,_p,rd,Dd;if(kh.removeAll&&Th.clear(),kh.remove)for(const qp of kh.remove)Th.delete(qp);if(kh.add)for(const qp of kh.add){const wd=Ih(qp,ep);wd!=null&&Th.set(wd,qp)}if(kh.update)for(const qp of kh.update){let wd=Th.get(qp.id);if(wd==null)continue;const dd=!qp.removeAllProperties&&(((ip=qp.removeProperties)===null||ip===void 0?void 0:ip.length)>0||((_p=qp.addOrUpdateProperties)===null||_p===void 0?void 0:_p.length)>0);if((qp.newGeometry||qp.removeAllProperties||dd)&&(wd={...wd},Th.set(qp.id,wd),dd&&(wd.properties={...wd.properties})),qp.newGeometry&&(wd.geometry=qp.newGeometry),qp.removeAllProperties)wd.properties={};else if(((rd=qp.removeProperties)===null||rd===void 0?void 0:rd.length)>0)for(const Wd of qp.removeProperties)Object.prototype.hasOwnProperty.call(wd.properties,Wd)&&delete wd.properties[Wd];if(((Dd=qp.addOrUpdateProperties)===null||Dd===void 0?void 0:Dd.length)>0)for(const{key:Wd,value:Vf}of qp.addOrUpdateProperties)wd.properties[Wd]=Vf}}(this._dataUpdateable,ih.dataDiff,vh),uh(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):uh(new Error(`Cannot update existing geojson data in ${ih.source}`)):uh(new Error(`Input data given to '${ih.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},cl&&(this.loadGeoJSON=cl)}loadData(gs,di){var fs;(fs=this._pendingRequest)===null||fs===void 0||fs.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const cl=!!(gs&&gs.request&&gs.request.collectResourceTiming)&&new a.RequestPerformance(gs.request);this._pendingCallback=di,this._pendingRequest=this.loadGeoJSON(gs,(ih,uh)=>{if(delete this._pendingCallback,delete this._pendingRequest,ih||!uh)return di(ih);if(typeof uh!="object")return di(new Error(`Input data given to '${gs.source}' is not a valid GeoJSON object.`));{yi(uh,!0);try{if(gs.filter){const Th=a.createExpression(gs.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Th.result==="error")throw new Error(Th.value.map(ep=>`${ep.key}: ${ep.message}`).join(", "));uh={type:"FeatureCollection",features:uh.features.filter(ep=>Th.value.evaluate({zoom:0},ep))}}this._geoJSONIndex=gs.cluster?new od(function({superclusterOptions:Th,clusterProperties:kh}){if(!kh||!Th)return Th;const ep={},ip={},_p={accumulated:null,zoom:0},rd={properties:null},Dd=Object.keys(kh);for(const qp of Dd){const[wd,dd]=kh[qp],Wd=a.createExpression(dd),Vf=a.createExpression(typeof wd=="string"?[wd,["accumulated"],["get",qp]]:wd);ep[qp]=Wd.value,ip[qp]=Vf.value}return Th.map=qp=>{rd.properties=qp;const wd={};for(const dd of Dd)wd[dd]=ep[dd].evaluate(_p,rd);return wd},Th.reduce=(qp,wd)=>{rd.properties=wd;for(const dd of Dd)_p.accumulated=qp[dd],qp[dd]=ip[dd].evaluate(_p,rd)},Th}(gs)).load(uh.features):function(Th,kh){return new ng(Th,kh)}(uh,gs.geojsonVtOptions)}catch(Th){return di(Th)}this.loaded={};const vh={};if(cl){const Th=cl.finish();Th&&(vh.resourceTiming={},vh.resourceTiming[gs.source]=JSON.parse(JSON.stringify(Th)))}di(null,vh)}})}reloadTile(gs,di){const fs=this.loaded;return fs&&fs[gs.uid]?super.reloadTile(gs,di):this.loadTile(gs,di)}removeSource(gs,di){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),di()}getClusterExpansionZoom(gs,di){try{di(null,this._geoJSONIndex.getClusterExpansionZoom(gs.clusterId))}catch(fs){di(fs)}}getClusterChildren(gs,di){try{di(null,this._geoJSONIndex.getChildren(gs.clusterId))}catch(fs){di(fs)}}getClusterLeaves(gs,di){try{di(null,this._geoJSONIndex.getLeaves(gs.clusterId,gs.limit,gs.offset))}catch(fs){di(fs)}}}class Uh{constructor(gs){this.self=gs,this.actor=new a.Actor(gs,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:ze,geojson:Oh},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(di,fs)=>{if(this.workerSourceTypes[di])throw new Error(`Worker source with name "${di}" already registered.`);this.workerSourceTypes[di]=fs},this.self.registerRTLTextPlugin=di=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=di.applyArabicShaping,a.plugin.processBidirectionalText=di.processBidirectionalText,a.plugin.processStyledBidirectionalText=di.processStyledBidirectionalText}}setReferrer(gs,di){this.referrer=di}setImages(gs,di,fs){this.availableImages[gs]=di;for(const cl in this.workerSources[gs]){const ih=this.workerSources[gs][cl];for(const uh in ih)ih[uh].availableImages=di}fs()}setLayers(gs,di,fs){this.getLayerIndex(gs).replace(di),fs()}updateLayers(gs,di,fs){this.getLayerIndex(gs).update(di.layers,di.removedIds),fs()}loadTile(gs,di,fs){this.getWorkerSource(gs,di.type,di.source).loadTile(di,fs)}loadDEMTile(gs,di,fs){this.getDEMWorkerSource(gs,di.source).loadTile(di,fs)}reloadTile(gs,di,fs){this.getWorkerSource(gs,di.type,di.source).reloadTile(di,fs)}abortTile(gs,di,fs){this.getWorkerSource(gs,di.type,di.source).abortTile(di,fs)}removeTile(gs,di,fs){this.getWorkerSource(gs,di.type,di.source).removeTile(di,fs)}removeDEMTile(gs,di){this.getDEMWorkerSource(gs,di.source).removeTile(di)}removeSource(gs,di,fs){if(!this.workerSources[gs]||!this.workerSources[gs][di.type]||!this.workerSources[gs][di.type][di.source])return;const cl=this.workerSources[gs][di.type][di.source];delete this.workerSources[gs][di.type][di.source],cl.removeSource!==void 0?cl.removeSource(di,fs):fs()}loadWorkerSource(gs,di,fs){try{this.self.importScripts(di.url),fs()}catch(cl){fs(cl.toString())}}syncRTLPluginState(gs,di,fs){try{a.plugin.setState(di);const cl=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&cl!=null){this.self.importScripts(cl);const ih=a.plugin.isParsed();fs(ih?void 0:new Error(`RTL Text Plugin failed to import scripts from ${cl}`),ih)}}catch(cl){fs(cl.toString())}}getAvailableImages(gs){let di=this.availableImages[gs];return di||(di=[]),di}getLayerIndex(gs){let di=this.layerIndexes[gs];return di||(di=this.layerIndexes[gs]=new h),di}getWorkerSource(gs,di,fs){if(this.workerSources[gs]||(this.workerSources[gs]={}),this.workerSources[gs][di]||(this.workerSources[gs][di]={}),!this.workerSources[gs][di][fs]){const cl={send:(ih,uh,vh)=>{this.actor.send(ih,uh,vh,gs)}};this.workerSources[gs][di][fs]=new this.workerSourceTypes[di](cl,this.getLayerIndex(gs),this.getAvailableImages(gs))}return this.workerSources[gs][di][fs]}getDEMWorkerSource(gs,di){return this.demWorkerSources[gs]||(this.demWorkerSources[gs]={}),this.demWorkerSources[gs][di]||(this.demWorkerSources[gs][di]=new Bt),this.demWorkerSources[gs][di]}}return a.isWorker()&&(self.worker=new Uh(self)),Uh}),s(["./shared"],function(a){var h="3.1.0";class y{static testProp(m){if(!y.docStyle)return m[0];for(let D=0;D<m.length;D++)if(m[D]in y.docStyle)return m[D];return m[0]}static create(m,D,Ee){const ct=window.document.createElement(m);return D!==void 0&&(ct.className=D),Ee&&Ee.appendChild(ct),ct}static createNS(m,D){return window.document.createElementNS(m,D)}static disableDrag(){y.docStyle&&y.selectProp&&(y.userSelect=y.docStyle[y.selectProp],y.docStyle[y.selectProp]="none")}static enableDrag(){y.docStyle&&y.selectProp&&(y.docStyle[y.selectProp]=y.userSelect)}static setTransform(m,D){m.style[y.transformProp]=D}static addEventListener(m,D,Ee,ct={}){m.addEventListener(D,Ee,"passive"in ct?ct:ct.capture)}static removeEventListener(m,D,Ee,ct={}){m.removeEventListener(D,Ee,"passive"in ct?ct:ct.capture)}static suppressClickInternal(m){m.preventDefault(),m.stopPropagation(),window.removeEventListener("click",y.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",y.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",y.suppressClickInternal,!0)},0)}static mousePos(m,D){const Ee=m.getBoundingClientRect();return new a.Point(D.clientX-Ee.left-m.clientLeft,D.clientY-Ee.top-m.clientTop)}static touchPos(m,D){const Ee=m.getBoundingClientRect(),ct=[];for(let or=0;or<D.length;or++)ct.push(new a.Point(D[or].clientX-Ee.left-m.clientLeft,D[or].clientY-Ee.top-m.clientTop));return ct}static mouseButton(m){return m.button}static remove(m){m.parentNode&&m.parentNode.removeChild(m)}}y.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,y.selectProp=y.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),y.transformProp=y.testProp(["transform","WebkitTransform"]);const C={supported:!1,testSupport:function(ot){!ze&&Y&&(Bt?Ir(ot):L=ot)}};let L,Y,ze=!1,Bt=!1;function Ir(ot){const m=ot.createTexture();ot.bindTexture(ot.TEXTURE_2D,m);try{if(ot.texImage2D(ot.TEXTURE_2D,0,ot.RGBA,ot.RGBA,ot.UNSIGNED_BYTE,Y),ot.isContextLost())return;C.supported=!0}catch{}ot.deleteTexture(m),ze=!0}var Wr;typeof document<"u"&&(Y=document.createElement("img"),Y.onload=function(){L&&Ir(L),L=null,Bt=!0},Y.onerror=function(){ze=!0,L=null},Y.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(ot){let m,D,Ee,ct;ot.resetRequestQueue=()=>{m=[],D=0,Ee=0,ct={}},ot.addThrottleControl=vs=>{const fl=Ee++;return ct[fl]=vs,fl},ot.removeThrottleControl=vs=>{delete ct[vs],ds()},ot.getImage=(vs,fl,pl=!0)=>{C.supported&&(vs.headers||(vs.headers={}),vs.headers.accept="image/webp,*/*");const ph={requestParameters:vs,supportImageRefresh:pl,callback:fl,cancelled:!1,completed:!1,cancel:()=>{ph.completed||ph.cancelled||(ph.cancelled=!0,ph.innerRequest&&(ph.innerRequest.cancel(),D--),ds())}};return m.push(ph),ds(),ph};const or=vs=>{const{requestParameters:fl,supportImageRefresh:pl,callback:ph}=vs;return a.extend(fl,{type:"image"}),(pl!==!1||a.isWorker()||a.getProtocolAction(fl.url)||fl.headers&&!Object.keys(fl.headers).reduce((Ah,hh)=>Ah&&hh==="accept",!0)?a.makeRequest:ps)(fl,(Ah,hh,Rh,Gh)=>{kn(vs,ph,Ah,hh,Rh,Gh)})},kn=(vs,fl,pl,ph,Ah,hh)=>{pl?fl(pl):ph instanceof HTMLImageElement||ph instanceof ImageBitmap?fl(null,ph):ph&&((Rh,Gh)=>{typeof createImageBitmap=="function"?a.arrayBufferToImageBitmap(Rh,Gh):a.arrayBufferToImage(Rh,Gh)})(ph,(Rh,Gh)=>{Rh!=null?fl(Rh):Gh!=null&&fl(null,Gh,{cacheControl:Ah,expires:hh})}),vs.cancelled||(vs.completed=!0,D--,ds())},ds=()=>{const vs=(()=>{const fl=Object.keys(ct);let pl=!1;if(fl.length>0){for(const ph of fl)if(pl=ct[ph](),pl)break}return pl})()?a.config.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.config.MAX_PARALLEL_IMAGE_REQUESTS;for(let fl=D;fl<vs&&m.length>0;fl++){const pl=m.shift();if(pl.cancelled){fl--;continue}const ph=or(pl);D++,pl.innerRequest=ph}},ps=(vs,fl)=>{const pl=new Image,ph=vs.url;let Ah=!1;const hh=vs.credentials;return hh&&hh==="include"?pl.crossOrigin="use-credentials":(hh&&hh==="same-origin"||!a.sameOrigin(ph))&&(pl.crossOrigin="anonymous"),pl.fetchPriority="high",pl.onload=()=>{fl(null,pl),pl.onerror=pl.onload=null},pl.onerror=()=>{Ah||fl(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),pl.onerror=pl.onload=null},pl.src=ph,{cancel:()=>{Ah=!0,pl.src=""}}}}(Wr||(Wr={})),Wr.resetRequestQueue();var yi,Bn=Wr;(function(ot){ot.Glyphs="Glyphs",ot.Image="Image",ot.Source="Source",ot.SpriteImage="SpriteImage",ot.SpriteJSON="SpriteJSON",ot.Style="Style",ot.Tile="Tile",ot.Unknown="Unknown"})(yi||(yi={}));class vi{constructor(m){this._transformRequestFn=m}transformRequest(m,D){return this._transformRequestFn&&this._transformRequestFn(m,D)||{url:m}}normalizeSpriteURL(m,D,Ee){const ct=function(or){const kn=or.match(wo);if(!kn)throw new Error(`Unable to parse URL "${or}"`);return{protocol:kn[1],authority:kn[2],path:kn[3]||"/",params:kn[4]?kn[4].split("&"):[]}}(m);return ct.path+=`${D}${Ee}`,function(or){const kn=or.params.length?`?${or.params.join("&")}`:"";return`${or.protocol}://${or.authority}${or.path}${kn}`}(ct)}setTransformRequest(m){this._transformRequestFn=m}}const wo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ia(ot){var m=new a.ARRAY_TYPE(3);return m[0]=ot[0],m[1]=ot[1],m[2]=ot[2],m}var gl,ml=function(ot,m,D){return ot[0]=m[0]-D[0],ot[1]=m[1]-D[1],ot[2]=m[2]-D[2],ot};gl=new a.ARRAY_TYPE(3),a.ARRAY_TYPE!=Float32Array&&(gl[0]=0,gl[1]=0,gl[2]=0);var il=function(ot){var m=ot[0],D=ot[1];return m*m+D*D};function sl(ot){const m=[];if(typeof ot=="string")m.push({id:"default",url:ot});else if(ot&&ot.length>0){const D=[];for(const{id:Ee,url:ct}of ot){const or=`${Ee}${ct}`;D.indexOf(or)===-1&&(D.push(or),m.push({id:Ee,url:ct}))}}return m}function ol(ot,m,D,Ee,ct){if(Ee)return void ot(Ee);if(ct!==Object.values(m).length||ct!==Object.values(D).length)return;const or={};for(const kn in m){or[kn]={};const ds=a.exported.getImageCanvasContext(D[kn]),ps=m[kn];for(const vs in ps){const{width:fl,height:pl,x:ph,y:Ah,sdf:hh,pixelRatio:Rh,stretchX:Gh,stretchY:Kh,content:ap}=ps[vs];or[kn][vs]={data:null,pixelRatio:Rh,sdf:hh,stretchX:Gh,stretchY:Kh,content:ap,spriteData:{width:fl,height:pl,x:ph,y:Ah,context:ds}}}}ot(null,or)}(function(){var ot=new a.ARRAY_TYPE(2);a.ARRAY_TYPE!=Float32Array&&(ot[0]=0,ot[1]=0)})();class _l{constructor(m,D,Ee,ct){this.context=m,this.format=Ee,this.texture=m.gl.createTexture(),this.update(D,ct)}update(m,D,Ee){const{width:ct,height:or}=m,kn=!(this.size&&this.size[0]===ct&&this.size[1]===or||Ee),{context:ds}=this,{gl:ps}=ds;if(this.useMipmap=!!(D&&D.useMipmap),ps.bindTexture(ps.TEXTURE_2D,this.texture),ds.pixelStoreUnpackFlipY.set(!1),ds.pixelStoreUnpack.set(1),ds.pixelStoreUnpackPremultiplyAlpha.set(this.format===ps.RGBA&&(!D||D.premultiply!==!1)),kn)this.size=[ct,or],m instanceof HTMLImageElement||m instanceof HTMLCanvasElement||m instanceof HTMLVideoElement||m instanceof ImageData||a.isImageBitmap(m)?ps.texImage2D(ps.TEXTURE_2D,0,this.format,this.format,ps.UNSIGNED_BYTE,m):ps.texImage2D(ps.TEXTURE_2D,0,this.format,ct,or,0,this.format,ps.UNSIGNED_BYTE,m.data);else{const{x:vs,y:fl}=Ee||{x:0,y:0};m instanceof HTMLImageElement||m instanceof HTMLCanvasElement||m instanceof HTMLVideoElement||m instanceof ImageData||a.isImageBitmap(m)?ps.texSubImage2D(ps.TEXTURE_2D,0,vs,fl,ps.RGBA,ps.UNSIGNED_BYTE,m):ps.texSubImage2D(ps.TEXTURE_2D,0,vs,fl,ct,or,ps.RGBA,ps.UNSIGNED_BYTE,m.data)}this.useMipmap&&this.isSizePowerOfTwo()&&ps.generateMipmap(ps.TEXTURE_2D)}bind(m,D,Ee){const{context:ct}=this,{gl:or}=ct;or.bindTexture(or.TEXTURE_2D,this.texture),Ee!==or.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(Ee=or.LINEAR),m!==this.filter&&(or.texParameteri(or.TEXTURE_2D,or.TEXTURE_MAG_FILTER,m),or.texParameteri(or.TEXTURE_2D,or.TEXTURE_MIN_FILTER,Ee||m),this.filter=m),D!==this.wrap&&(or.texParameteri(or.TEXTURE_2D,or.TEXTURE_WRAP_S,D),or.texParameteri(or.TEXTURE_2D,or.TEXTURE_WRAP_T,D),this.wrap=D)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:m}=this.context;m.deleteTexture(this.texture),this.texture=null}}function rh(ot){const{userImage:m}=ot;return!!(m&&m.render&&m.render())&&(ot.data.replace(new Uint8Array(m.data.buffer)),!0)}class wh extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(m){if(this.loaded!==m&&(this.loaded=m,m)){for(const{ids:D,callback:Ee}of this.requestors)this._notify(D,Ee);this.requestors=[]}}getImage(m){const D=this.images[m];if(D&&!D.data&&D.spriteData){const Ee=D.spriteData;D.data=new a.RGBAImage({width:Ee.width,height:Ee.height},Ee.context.getImageData(Ee.x,Ee.y,Ee.width,Ee.height).data),D.spriteData=null}return D}addImage(m,D){if(this.images[m])throw new Error(`Image id ${m} already exist, use updateImage instead`);this._validate(m,D)&&(this.images[m]=D)}_validate(m,D){let Ee=!0;const ct=D.data||D.spriteData;return this._validateStretch(D.stretchX,ct&&ct.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${m}" has invalid "stretchX" value`))),Ee=!1),this._validateStretch(D.stretchY,ct&&ct.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${m}" has invalid "stretchY" value`))),Ee=!1),this._validateContent(D.content,D)||(this.fire(new a.ErrorEvent(new Error(`Image "${m}" has invalid "content" value`))),Ee=!1),Ee}_validateStretch(m,D){if(!m)return!0;let Ee=0;for(const ct of m){if(ct[0]<Ee||ct[1]<ct[0]||D<ct[1])return!1;Ee=ct[1]}return!0}_validateContent(m,D){if(!m)return!0;if(m.length!==4)return!1;const Ee=D.spriteData,ct=Ee&&Ee.width||D.data.width,or=Ee&&Ee.height||D.data.height;return!(m[0]<0||ct<m[0]||m[1]<0||or<m[1]||m[2]<0||ct<m[2]||m[3]<0||or<m[3]||m[2]<m[0]||m[3]<m[1])}updateImage(m,D,Ee=!0){const ct=this.getImage(m);if(Ee&&(ct.data.width!==D.data.width||ct.data.height!==D.data.height))throw new Error(`size mismatch between old image (${ct.data.width}x${ct.data.height}) and new image (${D.data.width}x${D.data.height}).`);D.version=ct.version+1,this.images[m]=D,this.updatedImages[m]=!0}removeImage(m){const D=this.images[m];delete this.images[m],delete this.patterns[m],D.userImage&&D.userImage.onRemove&&D.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(m,D){let Ee=!0;if(!this.isLoaded())for(const ct of m)this.images[ct]||(Ee=!1);this.isLoaded()||Ee?this._notify(m,D):this.requestors.push({ids:m,callback:D})}_notify(m,D){const Ee={};for(const ct of m){let or=this.getImage(ct);or||(this.fire(new a.Event("styleimagemissing",{id:ct})),or=this.getImage(ct)),or?Ee[ct]={data:or.data.clone(),pixelRatio:or.pixelRatio,sdf:or.sdf,version:or.version,stretchX:or.stretchX,stretchY:or.stretchY,content:or.content,hasRenderCallback:!!(or.userImage&&or.userImage.render)}:a.warnOnce(`Image "${ct}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}D(null,Ee)}getPixelSize(){const{width:m,height:D}=this.atlasImage;return{width:m,height:D}}getPattern(m){const D=this.patterns[m],Ee=this.getImage(m);if(!Ee)return null;if(D&&D.position.version===Ee.version)return D.position;if(D)D.position.version=Ee.version;else{const ct={w:Ee.data.width+2,h:Ee.data.height+2,x:0,y:0},or=new a.ImagePosition(ct,Ee);this.patterns[m]={bin:ct,position:or}}return this._updatePatternAtlas(),this.patterns[m].position}bind(m){const D=m.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new _l(m,this.atlasImage,D.RGBA),this.atlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE)}_updatePatternAtlas(){const m=[];for(const or in this.patterns)m.push(this.patterns[or].bin);const{w:D,h:Ee}=a.potpack(m),ct=this.atlasImage;ct.resize({width:D||1,height:Ee||1});for(const or in this.patterns){const{bin:kn}=this.patterns[or],ds=kn.x+1,ps=kn.y+1,vs=this.getImage(or).data,fl=vs.width,pl=vs.height;a.RGBAImage.copy(vs,ct,{x:0,y:0},{x:ds,y:ps},{width:fl,height:pl}),a.RGBAImage.copy(vs,ct,{x:0,y:pl-1},{x:ds,y:ps-1},{width:fl,height:1}),a.RGBAImage.copy(vs,ct,{x:0,y:0},{x:ds,y:ps+pl},{width:fl,height:1}),a.RGBAImage.copy(vs,ct,{x:fl-1,y:0},{x:ds-1,y:ps},{width:1,height:pl}),a.RGBAImage.copy(vs,ct,{x:0,y:0},{x:ds+fl,y:ps},{width:1,height:pl})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(m){for(const D of m){if(this.callbackDispatchedThisFrame[D])continue;this.callbackDispatchedThisFrame[D]=!0;const Ee=this.getImage(D);Ee||a.warnOnce(`Image with ID: "${D}" was not found`),rh(Ee)&&this.updateImage(D,Ee)}}}const Fh=1e20;function Mh(ot,m,D,Ee,ct,or,kn,ds,ps){for(let vs=m;vs<m+Ee;vs++)vp(ot,D*or+vs,or,ct,kn,ds,ps);for(let vs=D;vs<D+ct;vs++)vp(ot,vs*or+m,1,Ee,kn,ds,ps)}function vp(ot,m,D,Ee,ct,or,kn){or[0]=0,kn[0]=-Fh,kn[1]=Fh,ct[0]=ot[m];for(let ds=1,ps=0,vs=0;ds<Ee;ds++){ct[ds]=ot[m+ds*D];const fl=ds*ds;do{const pl=or[ps];vs=(ct[ds]-ct[pl]+fl-pl*pl)/(ds-pl)/2}while(vs<=kn[ps]&&--ps>-1);ps++,or[ps]=ds,kn[ps]=vs,kn[ps+1]=Fh}for(let ds=0,ps=0;ds<Ee;ds++){for(;kn[ps+1]<ds;)ps++;const vs=or[ps],fl=ds-vs;ot[m+ds*D]=ct[vs]+fl*fl}}class gp{constructor(m,D){this.requestManager=m,this.localIdeographFontFamily=D,this.entries={}}setURL(m){this.url=m}getGlyphs(m,D){const Ee=[];for(const ct in m)for(const or of m[ct])Ee.push({stack:ct,id:or});a.asyncAll(Ee,({stack:ct,id:or},kn)=>{let ds=this.entries[ct];ds||(ds=this.entries[ct]={glyphs:{},requests:{},ranges:{}});let ps=ds.glyphs[or];if(ps!==void 0)return void kn(null,{stack:ct,id:or,glyph:ps});if(ps=this._tinySDF(ds,ct,or),ps)return ds.glyphs[or]=ps,void kn(null,{stack:ct,id:or,glyph:ps});const vs=Math.floor(or/256);if(256*vs>65535)return void kn(new Error("glyphs > 65535 not supported"));if(ds.ranges[vs])return void kn(null,{stack:ct,id:or,glyph:ps});if(!this.url)return void kn(new Error("glyphsUrl is not set"));let fl=ds.requests[vs];fl||(fl=ds.requests[vs]=[],gp.loadGlyphRange(ct,vs,this.url,this.requestManager,(pl,ph)=>{if(ph){for(const Ah in ph)this._doesCharSupportLocalGlyph(+Ah)||(ds.glyphs[+Ah]=ph[+Ah]);ds.ranges[vs]=!0}for(const Ah of fl)Ah(pl,ph);delete ds.requests[vs]})),fl.push((pl,ph)=>{pl?kn(pl):ph&&kn(null,{stack:ct,id:or,glyph:ph[or]||null})})},(ct,or)=>{if(ct)D(ct);else if(or){const kn={};for(const{stack:ds,id:ps,glyph:vs}of or)(kn[ds]||(kn[ds]={}))[ps]=vs&&{id:vs.id,bitmap:vs.bitmap.clone(),metrics:vs.metrics};D(null,kn)}})}_doesCharSupportLocalGlyph(m){return!!this.localIdeographFontFamily&&(a.unicodeBlockLookup["CJK Unified Ideographs"](m)||a.unicodeBlockLookup["Hangul Syllables"](m)||a.unicodeBlockLookup.Hiragana(m)||a.unicodeBlockLookup.Katakana(m))}_tinySDF(m,D,Ee){const ct=this.localIdeographFontFamily;if(!ct||!this._doesCharSupportLocalGlyph(Ee))return;let or=m.tinySDF;if(!or){let ds="400";/bold/i.test(D)?ds="900":/medium/i.test(D)?ds="500":/light/i.test(D)&&(ds="200"),or=m.tinySDF=new gp.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:ct,fontWeight:ds})}const kn=or.draw(String.fromCharCode(Ee));return{id:Ee,bitmap:new a.AlphaImage({width:kn.width||30,height:kn.height||30},kn.data),metrics:{width:kn.glyphWidth||24,height:kn.glyphHeight||24,left:kn.glyphLeft||0,top:kn.glyphTop-27||-8,advance:kn.glyphAdvance||24}}}}gp.loadGlyphRange=function(ot,m,D,Ee,ct){const or=256*m,kn=or+255,ds=Ee.transformRequest(D.replace("{fontstack}",ot).replace("{range}",`${or}-${kn}`),yi.Glyphs);a.getArrayBuffer(ds,(ps,vs)=>{if(ps)ct(ps);else if(vs){const fl={};for(const pl of a.parseGlyphPbf(vs))fl[pl.id]=pl;ct(null,fl)}})},gp.TinySDF=class{constructor({fontSize:ot=24,buffer:m=3,radius:D=8,cutoff:Ee=.25,fontFamily:ct="sans-serif",fontWeight:or="normal",fontStyle:kn="normal"}={}){this.buffer=m,this.cutoff=Ee,this.radius=D;const ds=this.size=ot+4*m,ps=this._createCanvas(ds),vs=this.ctx=ps.getContext("2d",{willReadFrequently:!0});vs.font=`${kn} ${or} ${ot}px ${ct}`,vs.textBaseline="alphabetic",vs.textAlign="left",vs.fillStyle="black",this.gridOuter=new Float64Array(ds*ds),this.gridInner=new Float64Array(ds*ds),this.f=new Float64Array(ds),this.z=new Float64Array(ds+1),this.v=new Uint16Array(ds)}_createCanvas(ot){const m=document.createElement("canvas");return m.width=m.height=ot,m}draw(ot){const{width:m,actualBoundingBoxAscent:D,actualBoundingBoxDescent:Ee,actualBoundingBoxLeft:ct,actualBoundingBoxRight:or}=this.ctx.measureText(ot),kn=Math.ceil(D),ds=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(or-ct))),ps=Math.min(this.size-this.buffer,kn+Math.ceil(Ee)),vs=ds+2*this.buffer,fl=ps+2*this.buffer,pl=Math.max(vs*fl,0),ph=new Uint8ClampedArray(pl),Ah={data:ph,width:vs,height:fl,glyphWidth:ds,glyphHeight:ps,glyphTop:kn,glyphLeft:0,glyphAdvance:m};if(ds===0||ps===0)return Ah;const{ctx:hh,buffer:Rh,gridInner:Gh,gridOuter:Kh}=this;hh.clearRect(Rh,Rh,ds,ps),hh.fillText(ot,Rh,Rh+kn);const ap=hh.getImageData(Rh,Rh,ds,ps);Kh.fill(Fh,0,pl),Gh.fill(0,0,pl);for(let Lh=0;Lh<ps;Lh++)for(let op=0;op<ds;op++){const yp=ap.data[4*(Lh*ds+op)+3]/255;if(yp===0)continue;const Np=(Lh+Rh)*vs+op+Rh;if(yp===1)Kh[Np]=0,Gh[Np]=Fh;else{const jp=.5-yp;Kh[Np]=jp>0?jp*jp:0,Gh[Np]=jp<0?jp*jp:0}}Mh(Kh,0,0,vs,fl,vs,this.f,this.v,this.z),Mh(Gh,Rh,Rh,ds,ps,vs,this.f,this.v,this.z);for(let Lh=0;Lh<pl;Lh++){const op=Math.sqrt(Kh[Lh])-Math.sqrt(Gh[Lh]);ph[Lh]=Math.round(255-255*(op/this.radius+this.cutoff))}return Ah}};class Jh{constructor(){this.specification=a.v8Spec.light.position}possiblyEvaluate(m,D){return a.sphericalToCartesian(m.expression.evaluate(D))}interpolate(m,D,Ee){return{x:a.interpolate.number(m.x,D.x,Ee),y:a.interpolate.number(m.y,D.y,Ee),z:a.interpolate.number(m.z,D.z,Ee)}}}let Lp,Ip;class $p extends a.Evented{constructor(m){super(),Lp=Lp||new a.Properties({anchor:new a.DataConstantProperty(a.v8Spec.light.anchor),position:new Jh,color:new a.DataConstantProperty(a.v8Spec.light.color),intensity:new a.DataConstantProperty(a.v8Spec.light.intensity)}),this._transitionable=new a.Transitionable(Lp),this.setLight(m),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(m,D={}){if(!this._validate(a.validateLight,m,D))for(const Ee in m){const ct=m[Ee];Ee.endsWith("-transition")?this._transitionable.setTransition(Ee.slice(0,-11),ct):this._transitionable.setValue(Ee,ct)}}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,D,Ee){return(!Ee||Ee.validate!==!1)&&a.emitValidationErrors(this,m.call(a.validateStyle,a.extend({value:D,style:{glyphs:!0,sprite:!0},styleSpec:a.v8Spec})))}}class Xp{constructor(m,D){this.width=m,this.height=D,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(m,D){const Ee=m.join(",")+String(D);return this.dashEntry[Ee]||(this.dashEntry[Ee]=this.addDash(m,D)),this.dashEntry[Ee]}getDashRanges(m,D,Ee){const ct=[];let or=m.length%2==1?-m[m.length-1]*Ee:0,kn=m[0]*Ee,ds=!0;ct.push({left:or,right:kn,isDash:ds,zeroLength:m[0]===0});let ps=m[0];for(let vs=1;vs<m.length;vs++){ds=!ds;const fl=m[vs];or=ps*Ee,ps+=fl,kn=ps*Ee,ct.push({left:or,right:kn,isDash:ds,zeroLength:fl===0})}return ct}addRoundDash(m,D,Ee){const ct=D/2;for(let or=-Ee;or<=Ee;or++){const kn=this.width*(this.nextRow+Ee+or);let ds=0,ps=m[ds];for(let vs=0;vs<this.width;vs++){vs/ps.right>1&&(ps=m[++ds]);const fl=Math.abs(vs-ps.left),pl=Math.abs(vs-ps.right),ph=Math.min(fl,pl);let Ah;const hh=or/Ee*(ct+1);if(ps.isDash){const Rh=ct-Math.abs(hh);Ah=Math.sqrt(ph*ph+Rh*Rh)}else Ah=ct-Math.sqrt(ph*ph+hh*hh);this.data[kn+vs]=Math.max(0,Math.min(255,Ah+128))}}}addRegularDash(m){for(let ds=m.length-1;ds>=0;--ds){const ps=m[ds],vs=m[ds+1];ps.zeroLength?m.splice(ds,1):vs&&vs.isDash===ps.isDash&&(vs.left=ps.left,m.splice(ds,1))}const D=m[0],Ee=m[m.length-1];D.isDash===Ee.isDash&&(D.left=Ee.left-this.width,Ee.right=D.right+this.width);const ct=this.width*this.nextRow;let or=0,kn=m[or];for(let ds=0;ds<this.width;ds++){ds/kn.right>1&&(kn=m[++or]);const ps=Math.abs(ds-kn.left),vs=Math.abs(ds-kn.right),fl=Math.min(ps,vs);this.data[ct+ds]=Math.max(0,Math.min(255,(kn.isDash?fl:-fl)+128))}}addDash(m,D){const Ee=D?7:0,ct=2*Ee+1;if(this.nextRow+ct>this.height)return a.warnOnce("LineAtlas out of space"),null;let or=0;for(let ds=0;ds<m.length;ds++)or+=m[ds];if(or!==0){const ds=this.width/or,ps=this.getDashRanges(m,this.width,ds);D?this.addRoundDash(ps,ds,Ee):this.addRegularDash(ps)}const kn={y:(this.nextRow+Ee+.5)/this.height,height:2*Ee/this.height,width:or};return this.nextRow+=ct,this.dirty=!0,kn}bind(m){const D=m.gl;this.texture?(D.bindTexture(D.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,D.texSubImage2D(D.TEXTURE_2D,0,0,0,this.width,this.height,D.ALPHA,D.UNSIGNED_BYTE,this.data))):(this.texture=D.createTexture(),D.bindTexture(D.TEXTURE_2D,this.texture),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_S,D.REPEAT),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_T,D.REPEAT),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,D.LINEAR),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,D.LINEAR),D.texImage2D(D.TEXTURE_2D,0,D.ALPHA,this.width,this.height,0,D.ALPHA,D.UNSIGNED_BYTE,this.data))}}class Cp{constructor(m,D,Ee){this.workerPool=m,this.actors=[],this.currentActor=0,this.id=Ee;const ct=this.workerPool.acquire(Ee);for(let or=0;or<ct.length;or++){const kn=new Cp.Actor(ct[or],D,Ee);kn.name=`Worker ${or}`,this.actors.push(kn)}if(!this.actors.length)throw new Error("No actors found")}broadcast(m,D,Ee){a.asyncAll(this.actors,(ct,or)=>{ct.send(m,D,or)},Ee=Ee||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(m=!0){this.actors.forEach(D=>{D.remove()}),this.actors=[],m&&this.workerPool.release(this.id)}}function Gp(ot,m,D){const Ee=function(ct,or){if(ct)return D(ct);if(or){const kn=a.pick(a.extend(or,ot),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);or.vector_layers&&(kn.vectorLayers=or.vector_layers,kn.vectorLayerIds=kn.vectorLayers.map(ds=>ds.id)),D(null,kn)}};return ot.url?a.getJSON(m.transformRequest(ot.url,yi.Source),Ee):a.exported.frame(()=>Ee(null,ot))}Cp.Actor=a.Actor;class Rp{constructor(m,D){m&&(D?this.setSouthWest(m).setNorthEast(D):Array.isArray(m)&&(m.length===4?this.setSouthWest([m[0],m[1]]).setNorthEast([m[2],m[3]]):this.setSouthWest(m[0]).setNorthEast(m[1])))}setNorthEast(m){return this._ne=m instanceof a.LngLat?new a.LngLat(m.lng,m.lat):a.LngLat.convert(m),this}setSouthWest(m){return this._sw=m instanceof a.LngLat?new a.LngLat(m.lng,m.lat):a.LngLat.convert(m),this}extend(m){const D=this._sw,Ee=this._ne;let ct,or;if(m instanceof a.LngLat)ct=m,or=m;else{if(!(m instanceof Rp))return Array.isArray(m)?m.length===4||m.every(Array.isArray)?this.extend(Rp.convert(m)):this.extend(a.LngLat.convert(m)):m&&("lng"in m||"lon"in m)&&"lat"in m?this.extend(a.LngLat.convert(m)):this;if(ct=m._sw,or=m._ne,!ct||!or)return this}return D||Ee?(D.lng=Math.min(ct.lng,D.lng),D.lat=Math.min(ct.lat,D.lat),Ee.lng=Math.max(or.lng,Ee.lng),Ee.lat=Math.max(or.lat,Ee.lat)):(this._sw=new a.LngLat(ct.lng,ct.lat),this._ne=new a.LngLat(or.lng,or.lat)),this}getCenter(){return new a.LngLat((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.LngLat(this.getWest(),this.getNorth())}getSouthEast(){return new a.LngLat(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(m){const{lng:D,lat:Ee}=a.LngLat.convert(m);let ct=this._sw.lng<=D&&D<=this._ne.lng;return this._sw.lng>this._ne.lng&&(ct=this._sw.lng>=D&&D>=this._ne.lng),this._sw.lat<=Ee&&Ee<=this._ne.lat&&ct}static convert(m){return m instanceof Rp?m:m&&new Rp(m)}static fromLngLat(m,D=0){const Ee=360*D/40075017,ct=Ee/Math.cos(Math.PI/180*m.lat);return new Rp(new a.LngLat(m.lng-ct,m.lat-Ee),new a.LngLat(m.lng+ct,m.lat+Ee))}}class od{constructor(m,D,Ee){this.bounds=Rp.convert(this.validateBounds(m)),this.minzoom=D||0,this.maxzoom=Ee||24}validateBounds(m){return Array.isArray(m)&&m.length===4?[Math.max(-180,m[0]),Math.max(-90,m[1]),Math.min(180,m[2]),Math.min(90,m[3])]:[-180,-90,180,90]}contains(m){const D=Math.pow(2,m.z),Ee=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*D),ct=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*D),or=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*D),kn=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*D);return m.x>=Ee&&m.x<or&&m.y>=ct&&m.y<kn}}class Wp extends a.Evented{constructor(m,D,Ee,ct){if(super(),this.id=m,this.dispatcher=Ee,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(D,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},D),this._collectResourceTiming=D.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(ct)}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Gp(this._options,this.map._requestManager,(m,D)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),m?this.fire(new a.ErrorEvent(m)):D&&(a.extend(this,D),D.bounds&&(this.tileBounds=new od(D.bounds,this.minzoom,this.maxzoom)),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}onAdd(m){this.map=m,this.load()}setSourceProperty(m){this._tileJSONRequest&&this._tileJSONRequest.cancel(),m(),this.load()}setTiles(m){return this.setSourceProperty(()=>{this._options.tiles=m}),this}setUrl(m){return this.setSourceProperty(()=>{this.url=m,this._options.url=m}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}loadTile(m,D){const Ee=m.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),ct={request:this.map._requestManager.transformRequest(Ee,yi.Tile),uid:m.uid,tileID:m.tileID,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function or(kn,ds){return delete m.request,m.aborted?D(null):kn&&kn.status!==404?D(kn):(ds&&ds.resourceTiming&&(m.resourceTiming=ds.resourceTiming),this.map._refreshExpiredTiles&&ds&&m.setExpiryData(ds),m.loadVectorData(ds,this.map.painter),D(null),void(m.reloadCallback&&(this.loadTile(m,m.reloadCallback),m.reloadCallback=null)))}ct.request.collectResourceTiming=this._collectResourceTiming,m.actor&&m.state!=="expired"?m.state==="loading"?m.reloadCallback=D:m.request=m.actor.send("reloadTile",ct,or.bind(this)):(m.actor=this.dispatcher.getActor(),m.request=m.actor.send("loadTile",ct,or.bind(this)))}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.actor&&m.actor.send("abortTile",{uid:m.uid,type:this.type,source:this.id},void 0)}unloadTile(m){m.unloadVectorData(),m.actor&&m.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Ld extends a.Evented{constructor(m,D,Ee,ct){super(),this.id=m,this.dispatcher=Ee,this.setEventedParent(ct),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},D),a.extend(this,a.pick(D,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Gp(this._options,this.map._requestManager,(m,D)=>{this._tileJSONRequest=null,this._loaded=!0,m?this.fire(new a.ErrorEvent(m)):D&&(a.extend(this,D),D.bounds&&(this.tileBounds=new od(D.bounds,this.minzoom,this.maxzoom)),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(m){this.map=m,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,D){const Ee=m.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);m.request=Bn.getImage(this.map._requestManager.transformRequest(Ee,yi.Tile),(ct,or,kn)=>{if(delete m.request,m.aborted)m.state="unloaded",D(null);else if(ct)m.state="errored",D(ct);else if(or){this.map._refreshExpiredTiles&&kn&&m.setExpiryData(kn);const ds=this.map.painter.context,ps=ds.gl;m.texture=this.map.painter.getTileTexture(or.width),m.texture?m.texture.update(or,{useMipmap:!0}):(m.texture=new _l(ds,or,ps.RGBA,{useMipmap:!0}),m.texture.bind(ps.LINEAR,ps.CLAMP_TO_EDGE,ps.LINEAR_MIPMAP_NEAREST),ds.extTextureFilterAnisotropic&&ps.texParameterf(ps.TEXTURE_2D,ds.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ds.extTextureFilterAnisotropicMax)),m.state="loaded",D(null)}},this.map._refreshExpiredTiles)}abortTile(m,D){m.request&&(m.request.cancel(),delete m.request),D()}unloadTile(m,D){m.texture&&this.map.painter.saveTileTexture(m.texture),D()}hasTransition(){return!1}}class ed extends Ld{constructor(m,D,Ee,ct){super(m,D,Ee,ct),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},D),this.encoding=D.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(m,D){const Ee=m.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function ct(or,kn){or&&(m.state="errored",D(or)),kn&&(m.dem=kn,m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0,m.state="loaded",D(null))}m.request=Bn.getImage(this.map._requestManager.transformRequest(Ee,yi.Tile),(function(or,kn){if(delete m.request,m.aborted)m.state="unloaded",D(null);else if(or)m.state="errored",D(or);else if(kn){this.map._refreshExpiredTiles&&m.setExpiryData(kn),delete kn.cacheControl,delete kn.expires;const ds=a.isImageBitmap(kn)&&(Ip==null&&(Ip=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ip)?kn:a.exported.getImageData(kn,1),ps={uid:m.uid,coord:m.tileID,source:this.id,rawImageData:ds,encoding:this.encoding};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",ps,ct.bind(this)))}}).bind(this),this.map._refreshExpiredTiles),m.neighboringTiles=this._getNeighboringTiles(m.tileID)}_getNeighboringTiles(m){const D=m.canonical,Ee=Math.pow(2,D.z),ct=(D.x-1+Ee)%Ee,or=D.x===0?m.wrap-1:m.wrap,kn=(D.x+1+Ee)%Ee,ds=D.x+1===Ee?m.wrap+1:m.wrap,ps={};return ps[new a.OverscaledTileID(m.overscaledZ,or,D.z,ct,D.y).key]={backfilled:!1},ps[new a.OverscaledTileID(m.overscaledZ,ds,D.z,kn,D.y).key]={backfilled:!1},D.y>0&&(ps[new a.OverscaledTileID(m.overscaledZ,or,D.z,ct,D.y-1).key]={backfilled:!1},ps[new a.OverscaledTileID(m.overscaledZ,m.wrap,D.z,D.x,D.y-1).key]={backfilled:!1},ps[new a.OverscaledTileID(m.overscaledZ,ds,D.z,kn,D.y-1).key]={backfilled:!1}),D.y+1<Ee&&(ps[new a.OverscaledTileID(m.overscaledZ,or,D.z,ct,D.y+1).key]={backfilled:!1},ps[new a.OverscaledTileID(m.overscaledZ,m.wrap,D.z,D.x,D.y+1).key]={backfilled:!1},ps[new a.OverscaledTileID(m.overscaledZ,ds,D.z,kn,D.y+1).key]={backfilled:!1}),ps}unloadTile(m){m.demTexture&&this.map.painter.saveTileTexture(m.demTexture),m.fbo&&(m.fbo.destroy(),delete m.fbo),m.dem&&delete m.dem,delete m.neighboringTiles,m.state="unloaded",m.actor&&m.actor.send("removeDEMTile",{uid:m.uid,source:this.id})}}class Gd extends a.Evented{constructor(m,D,Ee,ct){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=Ee.getActor(),this.setEventedParent(ct),this._data=D.data,this._options=a.extend({},D),this._collectResourceTiming=D.collectResourceTiming,D.maxzoom!==void 0&&(this.maxzoom=D.maxzoom),D.type&&(this.type=D.type),D.attribution&&(this.attribution=D.attribution),this.promoteId=D.promoteId;const or=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:D.cluster||!1,geojsonVtOptions:{buffer:(D.buffer!==void 0?D.buffer:128)*or,tolerance:(D.tolerance!==void 0?D.tolerance:.375)*or,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:D.lineMetrics||!1,generateId:D.generateId||!1},superclusterOptions:{maxZoom:D.clusterMaxZoom!==void 0?D.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,D.clusterMinPoints||2),extent:a.EXTENT,radius:(D.clusterRadius||50)*or,log:!1,generateId:D.generateId||!1},clusterProperties:D.clusterProperties,filter:D.filter},D.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){this._updateWorkerData()}onAdd(m){this.map=m,this.load()}setData(m){return this._data=m,this._updateWorkerData(),this}updateData(m){return this._updateWorkerData(m),this}setClusterOptions(m){return this.workerOptions.cluster=m.cluster,m&&(m.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=m.clusterRadius),m.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=m.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(m,D){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id},D),this}getClusterChildren(m,D){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id},D),this}getClusterLeaves(m,D,Ee,ct){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:m,limit:D,offset:Ee},ct),this}_updateWorkerData(m){const D=a.extend({},this.workerOptions);m?D.dataDiff=m:typeof this._data=="string"?(D.request=this.map._requestManager.transformRequest(a.exported.resolveURL(this._data),yi.Source),D.request.collectResourceTiming=this._collectResourceTiming):D.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,D,(Ee,ct)=>{if(this._pendingLoads--,this._removed||ct&&ct.abandoned)return void this.fire(new a.Event("dataabort",{dataType:"source"}));let or=null;if(ct&&ct.resourceTiming&&ct.resourceTiming[this.id]&&(or=ct.resourceTiming[this.id].slice(0)),Ee)return void this.fire(new a.ErrorEvent(Ee));const kn={dataType:"source"};this._collectResourceTiming&&or&&or.length>0&&a.extend(kn,{resourceTiming:or}),this.fire(new a.Event("data",{...kn,sourceDataType:"metadata"})),this.fire(new a.Event("data",{...kn,sourceDataType:"content"}))})}loaded(){return this._pendingLoads===0}loadTile(m,D){const Ee=m.actor?"reloadTile":"loadTile";m.actor=this.actor;const ct={type:this.type,uid:m.uid,tileID:m.tileID,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};m.request=this.actor.send(Ee,ct,(or,kn)=>(delete m.request,m.unloadVectorData(),m.aborted?D(null):or?D(or):(m.loadVectorData(kn,this.map.painter,Ee==="reloadTile"),D(null))))}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m){m.unloadVectorData(),this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Kp=a.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ad extends a.Evented{constructor(m,D,Ee,ct){super(),this.id=m,this.dispatcher=Ee,this.coordinates=D.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(ct),this.options=D}load(m,D){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=Bn.getImage(this.map._requestManager.transformRequest(this.url,yi.Image),(Ee,ct)=>{this._request=null,this._loaded=!0,Ee?this.fire(new a.ErrorEvent(Ee)):ct&&(this.image=ct,m&&(this.coordinates=m),D&&D(),this._finishLoading())})}loaded(){return this._loaded}updateImage(m){return m.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=m.url,this.load(m.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(m){this.map=m,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(m){this.coordinates=m;const D=m.map(a.MercatorCoordinate.fromLngLat);this.tileID=function(ct){let or=1/0,kn=1/0,ds=-1/0,ps=-1/0;for(const ph of ct)or=Math.min(or,ph.x),kn=Math.min(kn,ph.y),ds=Math.max(ds,ph.x),ps=Math.max(ps,ph.y);const vs=Math.max(ds-or,ps-kn),fl=Math.max(0,Math.floor(-Math.log(vs)/Math.LN2)),pl=Math.pow(2,fl);return new a.CanonicalTileID(fl,Math.floor((or+ds)/2*pl),Math.floor((kn+ps)/2*pl))}(D),this.minzoom=this.maxzoom=this.tileID.z;const Ee=D.map(ct=>this.tileID.getTilePoint(ct)._round());return this._boundsArray=new a.RasterBoundsArray,this._boundsArray.emplaceBack(Ee[0].x,Ee[0].y,0,0),this._boundsArray.emplaceBack(Ee[1].x,Ee[1].y,a.EXTENT,0),this._boundsArray.emplaceBack(Ee[3].x,Ee[3].y,0,a.EXTENT),this._boundsArray.emplaceBack(Ee[2].x,Ee[2].y,a.EXTENT,a.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const m=this.map.painter.context,D=m.gl;this.boundsBuffer||(this.boundsBuffer=m.createVertexBuffer(this._boundsArray,Kp.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new _l(m,this.image,D.RGBA),this.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE));let Ee=!1;for(const ct in this.tiles){const or=this.tiles[ct];or.state!=="loaded"&&(or.state="loaded",or.texture=this.texture,Ee=!0)}Ee&&this.fire(new a.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(m,D){this.tileID&&this.tileID.equals(m.tileID.canonical)?(this.tiles[String(m.tileID.wrap)]=m,m.buckets={},D(null)):(m.state="errored",D(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Id extends Ad{constructor(m,D,Ee,ct){super(m,D,Ee,ct),this.roundZoom=!0,this.type="video",this.options=D}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const D of m.urls)this.urls.push(this.map._requestManager.transformRequest(D,yi.Source).url);a.getVideo(this.urls,(D,Ee)=>{this._loaded=!0,D?this.fire(new a.ErrorEvent(D)):Ee&&(this.video=Ee,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const D=this.video.seekable;m<D.start(0)||m>D.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${D.start(0)} and ${D.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,D=m.gl;this.boundsBuffer||(this.boundsBuffer=m.createVertexBuffer(this._boundsArray,Kp.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE),D.texSubImage2D(D.TEXTURE_2D,0,0,0,D.RGBA,D.UNSIGNED_BYTE,this.video)):(this.texture=new _l(m,this.video,D.RGBA),this.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE));let Ee=!1;for(const ct in this.tiles){const or=this.tiles[ct];or.state!=="loaded"&&(or.state="loaded",or.texture=this.texture,Ee=!0)}Ee&&this.fire(new a.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Yh extends Ad{constructor(m,D,Ee,ct){super(m,D,Ee,ct),D.coordinates?Array.isArray(D.coordinates)&&D.coordinates.length===4&&!D.coordinates.some(or=>!Array.isArray(or)||or.length!==2||or.some(kn=>typeof kn!="number"))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${m}`,null,'missing required property "coordinates"'))),D.animate&&typeof D.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),D.canvas?typeof D.canvas=="string"||D.canvas instanceof HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${m}`,null,'missing required property "canvas"'))),this.options=D,this.animate=D.animate===void 0||D.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const D=this.map.painter.context,Ee=D.gl;this.boundsBuffer||(this.boundsBuffer=D.createVertexBuffer(this._boundsArray,Kp.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(m||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new _l(D,this.canvas,Ee.RGBA,{premultiply:!0});let ct=!1;for(const or in this.tiles){const kn=this.tiles[or];kn.state!=="loaded"&&(kn.state="loaded",kn.texture=this.texture,ct=!0)}ct&&this.fire(new a.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}}const Ap={vector:Wp,raster:Ld,"raster-dem":ed,geojson:Gd,video:Id,image:Ad,canvas:Yh};function kd(ot,m){const D=a.create();return a.translate(D,D,[1,1,0]),a.scale(D,D,[.5*ot.width,.5*ot.height,1]),a.multiply(D,D,ot.calculatePosMatrix(m.toUnwrapped()))}function cd(ot,m,D,Ee,ct,or){const kn=function(pl,ph,Ah){if(pl)for(const hh of pl){const Rh=ph[hh];if(Rh&&Rh.source===Ah&&Rh.type==="fill-extrusion")return!0}else for(const hh in ph){const Rh=ph[hh];if(Rh.source===Ah&&Rh.type==="fill-extrusion")return!0}return!1}(ct&&ct.layers,m,ot.id),ds=or.maxPitchScaleFactor(),ps=ot.tilesIn(Ee,ds,kn);ps.sort(id);const vs=[];for(const pl of ps)vs.push({wrappedTileID:pl.tileID.wrapped().key,queryResults:pl.tile.queryRenderedFeatures(m,D,ot._state,pl.queryGeometry,pl.cameraQueryGeometry,pl.scale,ct,or,ds,kd(ot.transform,pl.tileID))});const fl=function(pl){const ph={},Ah={};for(const hh of pl){const Rh=hh.queryResults,Gh=hh.wrappedTileID,Kh=Ah[Gh]=Ah[Gh]||{};for(const ap in Rh){const Lh=Rh[ap],op=Kh[ap]=Kh[ap]||{},yp=ph[ap]=ph[ap]||[];for(const Np of Lh)op[Np.featureIndex]||(op[Np.featureIndex]=!0,yp.push(Np))}}return ph}(vs);for(const pl in fl)fl[pl].forEach(ph=>{const Ah=ph.feature,hh=ot.getFeatureState(Ah.layer["source-layer"],Ah.id);Ah.source=Ah.layer.source,Ah.layer["source-layer"]&&(Ah.sourceLayer=Ah.layer["source-layer"]),Ah.state=hh});return fl}function id(ot,m){const D=ot.tileID,Ee=m.tileID;return D.overscaledZ-Ee.overscaledZ||D.canonical.y-Ee.canonical.y||D.wrap-Ee.wrap||D.canonical.x-Ee.canonical.x}class fp{constructor(m,D){this.timeAdded=0,this.fadeEndTime=0,this.tileID=m,this.uid=a.uniqueId(),this.uses=0,this.tileSize=D,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(m){const D=m+this.timeAdded;D<this.fadeEndTime||(this.fadeEndTime=D)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(m){this.demTexture&&m.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(m,D,Ee){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",m){m.featureIndex&&(this.latestFeatureIndex=m.featureIndex,m.rawTileData?(this.latestRawTileData=m.rawTileData,this.latestFeatureIndex.rawTileData=m.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=m.collisionBoxArray,this.buckets=function(ct,or){const kn={};if(!or)return kn;for(const ds of ct){const ps=ds.layerIds.map(vs=>or.getLayer(vs)).filter(Boolean);if(ps.length!==0){ds.layers=ps,ds.stateDependentLayerIds&&(ds.stateDependentLayers=ds.stateDependentLayerIds.map(vs=>ps.filter(fl=>fl.id===vs)[0]));for(const vs of ps)kn[vs.id]=ds}}return kn}(m.buckets,D.style),this.hasSymbolBuckets=!1;for(const ct in this.buckets){const or=this.buckets[ct];if(or instanceof a.SymbolBucket){if(this.hasSymbolBuckets=!0,!Ee)break;or.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const ct in this.buckets){const or=this.buckets[ct];if(or instanceof a.SymbolBucket&&or.hasRTLText){this.hasRTLText=!0,a.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const ct in this.buckets){const or=this.buckets[ct];this.queryPadding=Math.max(this.queryPadding,D.style.getLayer(ct).queryRadius(or))}m.imageAtlas&&(this.imageAtlas=m.imageAtlas),m.glyphAtlasImage&&(this.glyphAtlasImage=m.glyphAtlasImage)}else this.collisionBoxArray=new a.CollisionBoxArray}unloadVectorData(){for(const m in this.buckets)this.buckets[m].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(m){return this.buckets[m.id]}upload(m){for(const Ee in this.buckets){const ct=this.buckets[Ee];ct.uploadPending()&&ct.upload(m)}const D=m.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new _l(m,this.imageAtlas.image,D.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new _l(m,this.glyphAtlasImage,D.ALPHA),this.glyphAtlasImage=null)}prepare(m){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(m,this.imageAtlasTexture)}queryRenderedFeatures(m,D,Ee,ct,or,kn,ds,ps,vs,fl){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:ct,cameraQueryGeometry:or,scale:kn,tileSize:this.tileSize,pixelPosMatrix:fl,transform:ps,params:ds,queryPadding:this.queryPadding*vs},m,D,Ee):{}}querySourceFeatures(m,D){const Ee=this.latestFeatureIndex;if(!Ee||!Ee.rawTileData)return;const ct=Ee.loadVTLayers(),or=D&&D.sourceLayer?D.sourceLayer:"",kn=ct._geojsonTileLayer||ct[or];if(!kn)return;const ds=a.createFilter(D&&D.filter),{z:ps,x:vs,y:fl}=this.tileID.canonical,pl={z:ps,x:vs,y:fl};for(let ph=0;ph<kn.length;ph++){const Ah=kn.feature(ph);if(ds.needGeometry){const Gh=a.toEvaluationFeature(Ah,!0);if(!ds.filter(new a.EvaluationParameters(this.tileID.overscaledZ),Gh,this.tileID.canonical))continue}else if(!ds.filter(new a.EvaluationParameters(this.tileID.overscaledZ),Ah))continue;const hh=Ee.getId(Ah,or),Rh=new a.GeoJSONFeature(Ah,ps,vs,fl,hh);Rh.tile=pl,m.push(Rh)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(m){const D=this.expirationTime;if(m.cacheControl){const Ee=a.parseCacheControl(m.cacheControl);Ee["max-age"]&&(this.expirationTime=Date.now()+1e3*Ee["max-age"])}else m.expires&&(this.expirationTime=new Date(m.expires).getTime());if(this.expirationTime){const Ee=Date.now();let ct=!1;if(this.expirationTime>Ee)ct=!1;else if(D)if(this.expirationTime<D)ct=!0;else{const or=this.expirationTime-D;or?this.expirationTime=Ee+Math.max(or,3e4):ct=!0}else ct=!0;ct?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(m,D){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(m).length===0)return;const Ee=this.latestFeatureIndex.loadVTLayers();for(const ct in this.buckets){if(!D.style.hasLayer(ct))continue;const or=this.buckets[ct],kn=or.layers[0].sourceLayer||"_geojsonTileLayer",ds=Ee[kn],ps=m[kn];if(!ds||!ps||Object.keys(ps).length===0)continue;or.update(ps,ds,this.imageAtlas&&this.imageAtlas.patternPositions||{});const vs=D&&D.style&&D.style.getLayer(ct);vs&&(this.queryPadding=Math.max(this.queryPadding,vs.queryRadius(or)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<a.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(m){this.symbolFadeHoldUntil=a.exported.now()+m}setDependencies(m,D){const Ee={};for(const ct of D)Ee[ct]=!0;this.dependencies[m]=Ee}hasDependency(m,D){for(const Ee of m){const ct=this.dependencies[Ee];if(ct){for(const or of D)if(ct[or])return!0}}return!1}}class Cd{constructor(m,D){this.max=m,this.onRemove=D,this.reset()}reset(){for(const m in this.data)for(const D of this.data[m])D.timeout&&clearTimeout(D.timeout),this.onRemove(D.value);return this.data={},this.order=[],this}add(m,D,Ee){const ct=m.wrapped().key;this.data[ct]===void 0&&(this.data[ct]=[]);const or={value:D,timeout:void 0};if(Ee!==void 0&&(or.timeout=setTimeout(()=>{this.remove(m,or)},Ee)),this.data[ct].push(or),this.order.push(ct),this.order.length>this.max){const kn=this._getAndRemoveByKey(this.order[0]);kn&&this.onRemove(kn)}return this}has(m){return m.wrapped().key in this.data}getAndRemove(m){return this.has(m)?this._getAndRemoveByKey(m.wrapped().key):null}_getAndRemoveByKey(m){const D=this.data[m].shift();return D.timeout&&clearTimeout(D.timeout),this.data[m].length===0&&delete this.data[m],this.order.splice(this.order.indexOf(m),1),D.value}getByKey(m){const D=this.data[m];return D?D[0].value:null}get(m){return this.has(m)?this.data[m.wrapped().key][0].value:null}remove(m,D){if(!this.has(m))return this;const Ee=m.wrapped().key,ct=D===void 0?0:this.data[Ee].indexOf(D),or=this.data[Ee][ct];return this.data[Ee].splice(ct,1),or.timeout&&clearTimeout(or.timeout),this.data[Ee].length===0&&delete this.data[Ee],this.onRemove(or.value),this.order.splice(this.order.indexOf(Ee),1),this}setMaxSize(m){for(this.max=m;this.order.length>this.max;){const D=this._getAndRemoveByKey(this.order[0]);D&&this.onRemove(D)}return this}filter(m){const D=[];for(const Ee in this.data)for(const ct of this.data[Ee])m(ct.value)||D.push(ct);for(const Ee of D)this.remove(Ee.value.tileID,Ee)}}class Fd{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(m,D,Ee){const ct=String(D);if(this.stateChanges[m]=this.stateChanges[m]||{},this.stateChanges[m][ct]=this.stateChanges[m][ct]||{},a.extend(this.stateChanges[m][ct],Ee),this.deletedStates[m]===null){this.deletedStates[m]={};for(const or in this.state[m])or!==ct&&(this.deletedStates[m][or]=null)}else if(this.deletedStates[m]&&this.deletedStates[m][ct]===null){this.deletedStates[m][ct]={};for(const or in this.state[m][ct])Ee[or]||(this.deletedStates[m][ct][or]=null)}else for(const or in Ee)this.deletedStates[m]&&this.deletedStates[m][ct]&&this.deletedStates[m][ct][or]===null&&delete this.deletedStates[m][ct][or]}removeFeatureState(m,D,Ee){if(this.deletedStates[m]===null)return;const ct=String(D);if(this.deletedStates[m]=this.deletedStates[m]||{},Ee&&D!==void 0)this.deletedStates[m][ct]!==null&&(this.deletedStates[m][ct]=this.deletedStates[m][ct]||{},this.deletedStates[m][ct][Ee]=null);else if(D!==void 0)if(this.stateChanges[m]&&this.stateChanges[m][ct])for(Ee in this.deletedStates[m][ct]={},this.stateChanges[m][ct])this.deletedStates[m][ct][Ee]=null;else this.deletedStates[m][ct]=null;else this.deletedStates[m]=null}getState(m,D){const Ee=String(D),ct=a.extend({},(this.state[m]||{})[Ee],(this.stateChanges[m]||{})[Ee]);if(this.deletedStates[m]===null)return{};if(this.deletedStates[m]){const or=this.deletedStates[m][D];if(or===null)return{};for(const kn in or)delete ct[kn]}return ct}initializeTileState(m,D){m.setFeatureState(this.state,D)}coalesceChanges(m,D){const Ee={};for(const ct in this.stateChanges){this.state[ct]=this.state[ct]||{};const or={};for(const kn in this.stateChanges[ct])this.state[ct][kn]||(this.state[ct][kn]={}),a.extend(this.state[ct][kn],this.stateChanges[ct][kn]),or[kn]=this.state[ct][kn];Ee[ct]=or}for(const ct in this.deletedStates){this.state[ct]=this.state[ct]||{};const or={};if(this.deletedStates[ct]===null)for(const kn in this.state[ct])or[kn]={},this.state[ct][kn]={};else for(const kn in this.deletedStates[ct]){if(this.deletedStates[ct][kn]===null)this.state[ct][kn]={};else for(const ds of Object.keys(this.deletedStates[ct][kn]))delete this.state[ct][kn][ds];or[kn]=this.state[ct][kn]}Ee[ct]=Ee[ct]||{},a.extend(Ee[ct],or)}if(this.stateChanges={},this.deletedStates={},Object.keys(Ee).length!==0)for(const ct in m)m[ct].setFeatureState(Ee,D)}}class yd extends a.Evented{constructor(m,D,Ee){super(),this.id=m,this.dispatcher=Ee,this.on("data",ct=>{ct.dataType==="source"&&ct.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&ct.dataType==="source"&&ct.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(ct,or,kn,ds){const ps=new Ap[or.type](ct,or,kn,ds);if(ps.id!==ct)throw new Error(`Expected Source id to be ${ct} instead of ${ps.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],ps),ps}(m,D,Ee,this),this._tiles={},this._cache=new Cd(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Fd,this._didEmitContent=!1,this._updated=!1}onAdd(m){this.map=m,this._maxTileCacheSize=m?m._maxTileCacheSize:null,this._maxTileCacheZoomLevels=m?m._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(m)}onRemove(m){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(m)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const m in this._tiles){const D=this._tiles[m];if(D.state!=="loaded"&&D.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const m=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,m&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(m,D){return this._source.loadTile(m,D)}_unloadTile(m){if(this._source.unloadTile)return this._source.unloadTile(m,()=>{})}_abortTile(m){this._source.abortTile&&this._source.abortTile(m,()=>{}),this._source.fire(new a.Event("dataabort",{tile:m,coord:m.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(m){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const D in this._tiles){const Ee=this._tiles[D];Ee.upload(m),Ee.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(m=>m.tileID).sort(kp).map(m=>m.key)}getRenderableIds(m){const D=[];for(const Ee in this._tiles)this._isIdRenderable(Ee,m)&&D.push(this._tiles[Ee]);return m?D.sort((Ee,ct)=>{const or=Ee.tileID,kn=ct.tileID,ds=new a.Point(or.canonical.x,or.canonical.y)._rotate(this.transform.angle),ps=new a.Point(kn.canonical.x,kn.canonical.y)._rotate(this.transform.angle);return or.overscaledZ-kn.overscaledZ||ps.y-ds.y||ps.x-ds.x}).map(Ee=>Ee.tileID.key):D.map(Ee=>Ee.tileID).sort(kp).map(Ee=>Ee.key)}hasRenderableParent(m){const D=this.findLoadedParent(m,0);return!!D&&this._isIdRenderable(D.tileID.key)}_isIdRenderable(m,D){return this._tiles[m]&&this._tiles[m].hasData()&&!this._coveredTiles[m]&&(D||!this._tiles[m].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const m in this._tiles)this._tiles[m].state!=="errored"&&this._reloadTile(m,"reloading")}}_reloadTile(m,D){const Ee=this._tiles[m];Ee&&(Ee.state!=="loading"&&(Ee.state=D),this._loadTile(Ee,this._tileLoaded.bind(this,Ee,m,D)))}_tileLoaded(m,D,Ee,ct){if(ct)return m.state="errored",void(ct.status!==404?this._source.fire(new a.ErrorEvent(ct,{tile:m})):this.update(this.transform,this.terrain));m.timeAdded=a.exported.now(),Ee==="expired"&&(m.refreshedUponExpiration=!0),this._setTileReloadTimer(D,m),this.getSource().type==="raster-dem"&&m.dem&&this._backfillDEM(m),this._state.initializeTileState(m,this.map?this.map.painter:null),m.aborted||this._source.fire(new a.Event("data",{dataType:"source",tile:m,coord:m.tileID}))}_backfillDEM(m){const D=this.getRenderableIds();for(let ct=0;ct<D.length;ct++){const or=D[ct];if(m.neighboringTiles&&m.neighboringTiles[or]){const kn=this.getTileByID(or);Ee(m,kn),Ee(kn,m)}}function Ee(ct,or){ct.needsHillshadePrepare=!0,ct.needsTerrainPrepare=!0;let kn=or.tileID.canonical.x-ct.tileID.canonical.x;const ds=or.tileID.canonical.y-ct.tileID.canonical.y,ps=Math.pow(2,ct.tileID.canonical.z),vs=or.tileID.key;kn===0&&ds===0||Math.abs(ds)>1||(Math.abs(kn)>1&&(Math.abs(kn+ps)===1?kn+=ps:Math.abs(kn-ps)===1&&(kn-=ps)),or.dem&&ct.dem&&(ct.dem.backfillBorder(or.dem,kn,ds),ct.neighboringTiles&&ct.neighboringTiles[vs]&&(ct.neighboringTiles[vs].backfilled=!0)))}}getTile(m){return this.getTileByID(m.key)}getTileByID(m){return this._tiles[m]}_retainLoadedChildren(m,D,Ee,ct){for(const or in this._tiles){let kn=this._tiles[or];if(ct[or]||!kn.hasData()||kn.tileID.overscaledZ<=D||kn.tileID.overscaledZ>Ee)continue;let ds=kn.tileID;for(;kn&&kn.tileID.overscaledZ>D+1;){const vs=kn.tileID.scaledTo(kn.tileID.overscaledZ-1);kn=this._tiles[vs.key],kn&&kn.hasData()&&(ds=vs)}let ps=ds;for(;ps.overscaledZ>D;)if(ps=ps.scaledTo(ps.overscaledZ-1),m[ps.key]){ct[ds.key]=ds;break}}}findLoadedParent(m,D){if(m.key in this._loadedParentTiles){const Ee=this._loadedParentTiles[m.key];return Ee&&Ee.tileID.overscaledZ>=D?Ee:null}for(let Ee=m.overscaledZ-1;Ee>=D;Ee--){const ct=m.scaledTo(Ee),or=this._getLoadedTile(ct);if(or)return or}}_getLoadedTile(m){const D=this._tiles[m.key];return D&&D.hasData()?D:this._cache.getByKey(m.wrapped().key)}updateCacheSize(m){const D=Math.ceil(m.width/this._source.tileSize)+1,Ee=Math.ceil(m.height/this._source.tileSize)+1,ct=Math.floor(D*Ee*(this._maxTileCacheZoomLevels===null?a.config.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),or=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,ct):ct;this._cache.setMaxSize(or)}handleWrapJump(m){const D=Math.round((m-(this._prevLng===void 0?m:this._prevLng))/360);if(this._prevLng=m,D){const Ee={};for(const ct in this._tiles){const or=this._tiles[ct];or.tileID=or.tileID.unwrapTo(or.tileID.wrap+D),Ee[or.tileID.key]=or}this._tiles=Ee;for(const ct in this._timers)clearTimeout(this._timers[ct]),delete this._timers[ct];for(const ct in this._tiles)this._setTileReloadTimer(ct,this._tiles[ct])}}update(m,D){if(this.transform=m,this.terrain=D,!this._sourceLoaded||this._paused)return;let Ee;this.updateCacheSize(m),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?Ee=m.getVisibleUnwrappedCoordinates(this._source.tileID).map(fl=>new a.OverscaledTileID(fl.canonical.z,fl.wrap,fl.canonical.z,fl.canonical.x,fl.canonical.y)):(Ee=m.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:D}),this._source.hasTile&&(Ee=Ee.filter(fl=>this._source.hasTile(fl)))):Ee=[];const ct=m.coveringZoomLevel(this._source),or=Math.max(ct-yd.maxOverzooming,this._source.minzoom),kn=Math.max(ct+yd.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const fl={};for(const pl of Ee)if(pl.canonical.z>this._source.minzoom){const ph=pl.scaledTo(pl.canonical.z-1);fl[ph.key]=ph;const Ah=pl.scaledTo(Math.max(this._source.minzoom,Math.min(pl.canonical.z,5)));fl[Ah.key]=Ah}Ee=Ee.concat(Object.values(fl))}const ds=Ee.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,ds&&this.fire(new a.Event("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const ps=this._updateRetainedTiles(Ee,ct);if(Uf(this._source.type)){const fl={},pl={},ph=Object.keys(ps),Ah=a.exported.now();for(const hh of ph){const Rh=ps[hh],Gh=this._tiles[hh];if(!Gh||Gh.fadeEndTime!==0&&Gh.fadeEndTime<=Ah)continue;const Kh=this.findLoadedParent(Rh,or);Kh&&(this._addTile(Kh.tileID),fl[Kh.tileID.key]=Kh.tileID),pl[hh]=Rh}this._retainLoadedChildren(pl,ct,kn,ps);for(const hh in fl)ps[hh]||(this._coveredTiles[hh]=!0,ps[hh]=fl[hh]);if(D){const hh={},Rh={};for(const Gh of Ee)this._tiles[Gh.key].hasData()?hh[Gh.key]=Gh:Rh[Gh.key]=Gh;for(const Gh in Rh){const Kh=Rh[Gh].children(this._source.maxzoom);this._tiles[Kh[0].key]&&this._tiles[Kh[1].key]&&this._tiles[Kh[2].key]&&this._tiles[Kh[3].key]&&(hh[Kh[0].key]=ps[Kh[0].key]=Kh[0],hh[Kh[1].key]=ps[Kh[1].key]=Kh[1],hh[Kh[2].key]=ps[Kh[2].key]=Kh[2],hh[Kh[3].key]=ps[Kh[3].key]=Kh[3],delete Rh[Gh])}for(const Gh in Rh){const Kh=this.findLoadedParent(Rh[Gh],this._source.minzoom);if(Kh){hh[Kh.tileID.key]=ps[Kh.tileID.key]=Kh.tileID;for(const ap in hh)hh[ap].isChildOf(Kh.tileID)&&delete hh[ap]}}for(const Gh in this._tiles)hh[Gh]||(this._coveredTiles[Gh]=!0)}}for(const fl in ps)this._tiles[fl].clearFadeHold();const vs=a.keysDifference(this._tiles,ps);for(const fl of vs){const pl=this._tiles[fl];pl.hasSymbolBuckets&&!pl.holdingForFade()?pl.setHoldDuration(this.map._fadeDuration):pl.hasSymbolBuckets&&!pl.symbolFadeFinished()||this._removeTile(fl)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const m in this._tiles)this._tiles[m].holdingForFade()&&this._removeTile(m)}_updateRetainedTiles(m,D){const Ee={},ct={},or=Math.max(D-yd.maxOverzooming,this._source.minzoom),kn=Math.max(D+yd.maxUnderzooming,this._source.minzoom),ds={};for(const ps of m){const vs=this._addTile(ps);Ee[ps.key]=ps,vs.hasData()||D<this._source.maxzoom&&(ds[ps.key]=ps)}this._retainLoadedChildren(ds,D,kn,Ee);for(const ps of m){let vs=this._tiles[ps.key];if(vs.hasData())continue;if(D+1>this._source.maxzoom){const pl=ps.children(this._source.maxzoom)[0],ph=this.getTile(pl);if(ph&&ph.hasData()){Ee[pl.key]=pl;continue}}else{const pl=ps.children(this._source.maxzoom);if(Ee[pl[0].key]&&Ee[pl[1].key]&&Ee[pl[2].key]&&Ee[pl[3].key])continue}let fl=vs.wasRequested();for(let pl=ps.overscaledZ-1;pl>=or;--pl){const ph=ps.scaledTo(pl);if(ct[ph.key])break;if(ct[ph.key]=!0,vs=this.getTile(ph),!vs&&fl&&(vs=this._addTile(ph)),vs){const Ah=vs.hasData();if((fl||Ah)&&(Ee[ph.key]=ph),fl=vs.wasRequested(),Ah)break}}}return Ee}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const m in this._tiles){const D=[];let Ee,ct=this._tiles[m].tileID;for(;ct.overscaledZ>0;){if(ct.key in this._loadedParentTiles){Ee=this._loadedParentTiles[ct.key];break}D.push(ct.key);const or=ct.scaledTo(ct.overscaledZ-1);if(Ee=this._getLoadedTile(or),Ee)break;ct=or}for(const or of D)this._loadedParentTiles[or]=Ee}}_addTile(m){let D=this._tiles[m.key];if(D)return D;D=this._cache.getAndRemove(m),D&&(this._setTileReloadTimer(m.key,D),D.tileID=m,this._state.initializeTileState(D,this.map?this.map.painter:null),this._cacheTimers[m.key]&&(clearTimeout(this._cacheTimers[m.key]),delete this._cacheTimers[m.key],this._setTileReloadTimer(m.key,D)));const Ee=D;return D||(D=new fp(m,this._source.tileSize*m.overscaleFactor()),this._loadTile(D,this._tileLoaded.bind(this,D,m.key,D.state))),D.uses++,this._tiles[m.key]=D,Ee||this._source.fire(new a.Event("dataloading",{tile:D,coord:D.tileID,dataType:"source"})),D}_setTileReloadTimer(m,D){m in this._timers&&(clearTimeout(this._timers[m]),delete this._timers[m]);const Ee=D.getExpiryTimeout();Ee&&(this._timers[m]=setTimeout(()=>{this._reloadTile(m,"expired"),delete this._timers[m]},Ee))}_removeTile(m){const D=this._tiles[m];D&&(D.uses--,delete this._tiles[m],this._timers[m]&&(clearTimeout(this._timers[m]),delete this._timers[m]),D.uses>0||(D.hasData()&&D.state!=="reloading"?this._cache.add(D.tileID,D,D.getExpiryTimeout()):(D.aborted=!0,this._abortTile(D),this._unloadTile(D))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const m in this._tiles)this._removeTile(m);this._cache.reset()}tilesIn(m,D,Ee){const ct=[],or=this.transform;if(!or)return ct;const kn=Ee?or.getCameraQueryGeometry(m):m,ds=m.map(hh=>or.pointCoordinate(hh,this.terrain)),ps=kn.map(hh=>or.pointCoordinate(hh,this.terrain)),vs=this.getIds();let fl=1/0,pl=1/0,ph=-1/0,Ah=-1/0;for(const hh of ps)fl=Math.min(fl,hh.x),pl=Math.min(pl,hh.y),ph=Math.max(ph,hh.x),Ah=Math.max(Ah,hh.y);for(let hh=0;hh<vs.length;hh++){const Rh=this._tiles[vs[hh]];if(Rh.holdingForFade())continue;const Gh=Rh.tileID,Kh=Math.pow(2,or.zoom-Rh.tileID.overscaledZ),ap=D*Rh.queryPadding*a.EXTENT/Rh.tileSize/Kh,Lh=[Gh.getTilePoint(new a.MercatorCoordinate(fl,pl)),Gh.getTilePoint(new a.MercatorCoordinate(ph,Ah))];if(Lh[0].x-ap<a.EXTENT&&Lh[0].y-ap<a.EXTENT&&Lh[1].x+ap>=0&&Lh[1].y+ap>=0){const op=ds.map(Np=>Gh.getTilePoint(Np)),yp=ps.map(Np=>Gh.getTilePoint(Np));ct.push({tile:Rh,tileID:Gh,queryGeometry:op,cameraQueryGeometry:yp,scale:Kh})}}return ct}getVisibleCoordinates(m){const D=this.getRenderableIds(m).map(Ee=>this._tiles[Ee].tileID);for(const Ee of D)Ee.posMatrix=this.transform.calculatePosMatrix(Ee.toUnwrapped());return D}hasTransition(){if(this._source.hasTransition())return!0;if(Uf(this._source.type)){const m=a.exported.now();for(const D in this._tiles)if(this._tiles[D].fadeEndTime>=m)return!0}return!1}setFeatureState(m,D,Ee){this._state.updateState(m=m||"_geojsonTileLayer",D,Ee)}removeFeatureState(m,D,Ee){this._state.removeFeatureState(m=m||"_geojsonTileLayer",D,Ee)}getFeatureState(m,D){return this._state.getState(m=m||"_geojsonTileLayer",D)}setDependencies(m,D,Ee){const ct=this._tiles[m];ct&&ct.setDependencies(D,Ee)}reloadTilesForDependencies(m,D){for(const Ee in this._tiles)this._tiles[Ee].hasDependency(m,D)&&this._reloadTile(Ee,"reloading");this._cache.filter(Ee=>!Ee.hasDependency(m,D))}}function kp(ot,m){const D=Math.abs(2*ot.wrap)-+(ot.wrap<0),Ee=Math.abs(2*m.wrap)-+(m.wrap<0);return ot.overscaledZ-m.overscaledZ||Ee-D||m.canonical.y-ot.canonical.y||m.canonical.x-ot.canonical.x}function Uf(ot){return ot==="raster"||ot==="image"||ot==="video"}yd.maxOverzooming=10,yd.maxUnderzooming=3;const $f="mapboxgl_preloaded_worker_pool";class up{constructor(){this.active={}}acquire(m){if(!this.workers)for(this.workers=[];this.workers.length<up.workerCount;)this.workers.push(new Worker(a.config.WORKER_URL));return this.active[m]=!0,this.workers.slice()}release(m){delete this.active[m],this.numActive()===0&&(this.workers.forEach(D=>{D.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[$f]}numActive(){return Object.keys(this.active).length}}const ud=Math.floor(a.exported.hardwareConcurrency/2);let xd;function Ed(){return xd||(xd=new up),xd}up.workerCount=a.isSafari(globalThis)?Math.max(Math.min(ud,3),1):1;class Vd{constructor(m,D){this.reset(m,D)}reset(m,D){this.points=m||[],this._distances=[0];for(let Ee=1;Ee<this.points.length;Ee++)this._distances[Ee]=this._distances[Ee-1]+this.points[Ee].dist(this.points[Ee-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(D||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(m){if(this.points.length===1)return this.points[0];m=a.clamp(m,0,1);let D=1,Ee=this._distances[D];const ct=m*this.paddedLength+this.padding;for(;Ee<ct&&D<this._distances.length;)Ee=this._distances[++D];const or=D-1,kn=this._distances[or],ds=Ee-kn,ps=ds>0?(ct-kn)/ds:0;return this.points[or].mult(1-ps).add(this.points[D].mult(ps))}}function Ep(ot,m){let D=!0;return ot==="always"||ot!=="never"&&m!=="never"||(D=!1),D}class Yp{constructor(m,D,Ee){const ct=this.boxCells=[],or=this.circleCells=[];this.xCellCount=Math.ceil(m/Ee),this.yCellCount=Math.ceil(D/Ee);for(let kn=0;kn<this.xCellCount*this.yCellCount;kn++)ct.push([]),or.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=m,this.height=D,this.xScale=this.xCellCount/m,this.yScale=this.yCellCount/D,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(m,D,Ee,ct,or){this._forEachCell(D,Ee,ct,or,this._insertBoxCell,this.boxUid++),this.boxKeys.push(m),this.bboxes.push(D),this.bboxes.push(Ee),this.bboxes.push(ct),this.bboxes.push(or)}insertCircle(m,D,Ee,ct){this._forEachCell(D-ct,Ee-ct,D+ct,Ee+ct,this._insertCircleCell,this.circleUid++),this.circleKeys.push(m),this.circles.push(D),this.circles.push(Ee),this.circles.push(ct)}_insertBoxCell(m,D,Ee,ct,or,kn){this.boxCells[or].push(kn)}_insertCircleCell(m,D,Ee,ct,or,kn){this.circleCells[or].push(kn)}_query(m,D,Ee,ct,or,kn,ds){if(Ee<0||m>this.width||ct<0||D>this.height)return[];const ps=[];if(m<=0&&D<=0&&this.width<=Ee&&this.height<=ct){if(or)return[{key:null,x1:m,y1:D,x2:Ee,y2:ct}];for(let vs=0;vs<this.boxKeys.length;vs++)ps.push({key:this.boxKeys[vs],x1:this.bboxes[4*vs],y1:this.bboxes[4*vs+1],x2:this.bboxes[4*vs+2],y2:this.bboxes[4*vs+3]});for(let vs=0;vs<this.circleKeys.length;vs++){const fl=this.circles[3*vs],pl=this.circles[3*vs+1],ph=this.circles[3*vs+2];ps.push({key:this.circleKeys[vs],x1:fl-ph,y1:pl-ph,x2:fl+ph,y2:pl+ph})}}else this._forEachCell(m,D,Ee,ct,this._queryCell,ps,{hitTest:or,overlapMode:kn,seenUids:{box:{},circle:{}}},ds);return ps}query(m,D,Ee,ct){return this._query(m,D,Ee,ct,!1,null)}hitTest(m,D,Ee,ct,or,kn){return this._query(m,D,Ee,ct,!0,or,kn).length>0}hitTestCircle(m,D,Ee,ct,or){const kn=m-Ee,ds=m+Ee,ps=D-Ee,vs=D+Ee;if(ds<0||kn>this.width||vs<0||ps>this.height)return!1;const fl=[];return this._forEachCell(kn,ps,ds,vs,this._queryCellCircle,fl,{hitTest:!0,overlapMode:ct,circle:{x:m,y:D,radius:Ee},seenUids:{box:{},circle:{}}},or),fl.length>0}_queryCell(m,D,Ee,ct,or,kn,ds,ps){const{seenUids:vs,hitTest:fl,overlapMode:pl}=ds,ph=this.boxCells[or];if(ph!==null){const hh=this.bboxes;for(const Rh of ph)if(!vs.box[Rh]){vs.box[Rh]=!0;const Gh=4*Rh,Kh=this.boxKeys[Rh];if(m<=hh[Gh+2]&&D<=hh[Gh+3]&&Ee>=hh[Gh+0]&&ct>=hh[Gh+1]&&(!ps||ps(Kh))&&(!fl||!Ep(pl,Kh.overlapMode))&&(kn.push({key:Kh,x1:hh[Gh],y1:hh[Gh+1],x2:hh[Gh+2],y2:hh[Gh+3]}),fl))return!0}}const Ah=this.circleCells[or];if(Ah!==null){const hh=this.circles;for(const Rh of Ah)if(!vs.circle[Rh]){vs.circle[Rh]=!0;const Gh=3*Rh,Kh=this.circleKeys[Rh];if(this._circleAndRectCollide(hh[Gh],hh[Gh+1],hh[Gh+2],m,D,Ee,ct)&&(!ps||ps(Kh))&&(!fl||!Ep(pl,Kh.overlapMode))){const ap=hh[Gh],Lh=hh[Gh+1],op=hh[Gh+2];if(kn.push({key:Kh,x1:ap-op,y1:Lh-op,x2:ap+op,y2:Lh+op}),fl)return!0}}}return!1}_queryCellCircle(m,D,Ee,ct,or,kn,ds,ps){const{circle:vs,seenUids:fl,overlapMode:pl}=ds,ph=this.boxCells[or];if(ph!==null){const hh=this.bboxes;for(const Rh of ph)if(!fl.box[Rh]){fl.box[Rh]=!0;const Gh=4*Rh,Kh=this.boxKeys[Rh];if(this._circleAndRectCollide(vs.x,vs.y,vs.radius,hh[Gh+0],hh[Gh+1],hh[Gh+2],hh[Gh+3])&&(!ps||ps(Kh))&&!Ep(pl,Kh.overlapMode))return kn.push(!0),!0}}const Ah=this.circleCells[or];if(Ah!==null){const hh=this.circles;for(const Rh of Ah)if(!fl.circle[Rh]){fl.circle[Rh]=!0;const Gh=3*Rh,Kh=this.circleKeys[Rh];if(this._circlesCollide(hh[Gh],hh[Gh+1],hh[Gh+2],vs.x,vs.y,vs.radius)&&(!ps||ps(Kh))&&!Ep(pl,Kh.overlapMode))return kn.push(!0),!0}}}_forEachCell(m,D,Ee,ct,or,kn,ds,ps){const vs=this._convertToXCellCoord(m),fl=this._convertToYCellCoord(D),pl=this._convertToXCellCoord(Ee),ph=this._convertToYCellCoord(ct);for(let Ah=vs;Ah<=pl;Ah++)for(let hh=fl;hh<=ph;hh++)if(or.call(this,m,D,Ee,ct,this.xCellCount*hh+Ah,kn,ds,ps))return}_convertToXCellCoord(m){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(m*this.xScale)))}_convertToYCellCoord(m){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(m*this.yScale)))}_circlesCollide(m,D,Ee,ct,or,kn){const ds=ct-m,ps=or-D,vs=Ee+kn;return vs*vs>ds*ds+ps*ps}_circleAndRectCollide(m,D,Ee,ct,or,kn,ds){const ps=(kn-ct)/2,vs=Math.abs(m-(ct+ps));if(vs>ps+Ee)return!1;const fl=(ds-or)/2,pl=Math.abs(D-(or+fl));if(pl>fl+Ee)return!1;if(vs<=ps||pl<=fl)return!0;const ph=vs-ps,Ah=pl-fl;return ph*ph+Ah*Ah<=Ee*Ee}}function nd(ot,m,D,Ee,ct){const or=a.create();return m?(a.scale(or,or,[1/ct,1/ct,1]),D||a.rotateZ(or,or,Ee.angle)):a.multiply(or,Ee.labelPlaneMatrix,ot),or}function $d(ot,m,D,Ee,ct){if(m){const or=a.clone(ot);return a.scale(or,or,[ct,ct,1]),D||a.rotateZ(or,or,-Ee.angle),or}return Ee.glCoordMatrix}function Qd(ot,m,D){let Ee;D?(Ee=[ot.x,ot.y,D(ot.x,ot.y),1],a.transformMat4(Ee,Ee,m)):(Ee=[ot.x,ot.y,0,1],cl(Ee,Ee,m));const ct=Ee[3];return{point:new a.Point(Ee[0]/ct,Ee[1]/ct),signedDistanceFromCamera:ct}}function Rd(ot,m){return .5+ot/m*.5}function ng(ot,m){const D=ot[0]/ot[3],Ee=ot[1]/ot[3];return D>=-m[0]&&D<=m[0]&&Ee>=-m[1]&&Ee<=m[1]}function bg(ot,m,D,Ee,ct,or,kn,ds,ps,vs){const fl=Ee?ot.textSizeData:ot.iconSizeData,pl=a.evaluateSizeForZoom(fl,D.transform.zoom),ph=[256/D.width*2+1,256/D.height*2+1],Ah=Ee?ot.text.dynamicLayoutVertexArray:ot.icon.dynamicLayoutVertexArray;Ah.clear();const hh=ot.lineVertexArray,Rh=Ee?ot.text.placedSymbolArray:ot.icon.placedSymbolArray,Gh=D.transform.width/D.transform.height;let Kh=!1;for(let ap=0;ap<Rh.length;ap++){const Lh=Rh.get(ap);if(Lh.hidden||Lh.writingMode===a.WritingMode.vertical&&!Kh){fs(Lh.numGlyphs,Ah);continue}let op;if(Kh=!1,vs?(op=[Lh.anchorX,Lh.anchorY,vs(Lh.anchorX,Lh.anchorY),1],a.transformMat4(op,op,m)):(op=[Lh.anchorX,Lh.anchorY,0,1],cl(op,op,m)),!ng(op,ph)){fs(Lh.numGlyphs,Ah);continue}const yp=Rd(D.transform.cameraToCenterDistance,op[3]),Np=a.evaluateSizeForFeature(fl,pl,Lh),jp=kn?Np/yp:Np*yp,td=new a.Point(Lh.anchorX,Lh.anchorY),Vp=Qd(td,ct,vs).point,gd={projections:{},offsets:{}},F=sh(Lh,jp,!1,ds,m,ct,or,ot.glyphOffsetArray,hh,Ah,Vp,td,gd,Gh,ps,vs);Kh=F.useVertical,(F.notEnoughRoom||Kh||F.needsFlipping&&sh(Lh,jp,!0,ds,m,ct,or,ot.glyphOffsetArray,hh,Ah,Vp,td,gd,Gh,ps,vs).notEnoughRoom)&&fs(Lh.numGlyphs,Ah)}Ee?ot.text.dynamicLayoutVertexBuffer.updateData(Ah):ot.icon.dynamicLayoutVertexBuffer.updateData(Ah)}function Ih(ot,m,D,Ee,ct,or,kn,ds,ps,vs,fl,pl,ph){const Ah=ds.glyphStartIndex+ds.numGlyphs,hh=ds.lineStartIndex,Rh=ds.lineStartIndex+ds.lineLength,Gh=m.getoffsetX(ds.glyphStartIndex),Kh=m.getoffsetX(Ah-1),ap=gs(ot*Gh,D,Ee,ct,or,kn,ds.segment,hh,Rh,ps,vs,fl,pl,ph);if(!ap)return null;const Lh=gs(ot*Kh,D,Ee,ct,or,kn,ds.segment,hh,Rh,ps,vs,fl,pl,ph);return Lh?{first:ap,last:Lh}:null}function nh(ot,m,D,Ee){return ot===a.WritingMode.horizontal&&Math.abs(D.y-m.y)>Math.abs(D.x-m.x)*Ee?{useVertical:!0}:(ot===a.WritingMode.vertical?m.y<D.y:m.x>D.x)?{needsFlipping:!0}:null}function sh(ot,m,D,Ee,ct,or,kn,ds,ps,vs,fl,pl,ph,Ah,hh,Rh){const Gh=m/24,Kh=ot.lineOffsetX*Gh,ap=ot.lineOffsetY*Gh;let Lh;if(ot.numGlyphs>1){const op=ot.glyphStartIndex+ot.numGlyphs,yp=ot.lineStartIndex,Np=ot.lineStartIndex+ot.lineLength,jp=Ih(Gh,ds,Kh,ap,D,fl,pl,ot,ps,or,ph,hh,Rh);if(!jp)return{notEnoughRoom:!0};const td=Qd(jp.first.point,kn,Rh).point,Vp=Qd(jp.last.point,kn,Rh).point;if(Ee&&!D){const gd=nh(ot.writingMode,td,Vp,Ah);if(gd)return gd}Lh=[jp.first];for(let gd=ot.glyphStartIndex+1;gd<op-1;gd++)Lh.push(gs(Gh*ds.getoffsetX(gd),Kh,ap,D,fl,pl,ot.segment,yp,Np,ps,or,ph,hh,Rh));Lh.push(jp.last)}else{if(Ee&&!D){const yp=Qd(pl,ct,Rh).point,Np=ot.lineStartIndex+ot.segment+1,jp=new a.Point(ps.getx(Np),ps.gety(Np)),td=Qd(jp,ct,Rh),Vp=td.signedDistanceFromCamera>0?td.point:oh(pl,jp,yp,1,ct,Rh),gd=nh(ot.writingMode,yp,Vp,Ah);if(gd)return gd}const op=gs(Gh*ds.getoffsetX(ot.glyphStartIndex),Kh,ap,D,fl,pl,ot.segment,ot.lineStartIndex,ot.lineStartIndex+ot.lineLength,ps,or,ph,hh,Rh);if(!op)return{notEnoughRoom:!0};Lh=[op]}for(const op of Lh)a.addDynamicAttributes(vs,op.point,op.angle);return{}}function oh(ot,m,D,Ee,ct,or){const kn=Qd(ot.add(ot.sub(m)._unit()),ct,or).point,ds=D.sub(kn);return D.add(ds._mult(Ee/ds.mag()))}function Oh(ot,m){const{projectionCache:D,lineVertexArray:Ee,labelPlaneMatrix:ct,tileAnchorPoint:or,distanceFromAnchor:kn,getElevation:ds,previousVertex:ps,direction:vs,absOffsetX:fl}=m;if(D.projections[ot])return D.projections[ot];const pl=new a.Point(Ee.getx(ot),Ee.gety(ot)),ph=Qd(pl,ct,ds);if(ph.signedDistanceFromCamera>0)return D.projections[ot]=ph.point,ph.point;const Ah=ot-vs;return oh(kn===0?or:new a.Point(Ee.getx(Ah),Ee.gety(Ah)),pl,ps,fl-kn+1,ct,ds)}function Uh(ot,m,D){return ot._unit()._perp()._mult(m*D)}function vl(ot,m,D,Ee,ct,or,kn,ds){const{projectionCache:ps,direction:vs}=ds;if(ps.offsets[ot])return ps.offsets[ot];const fl=D.add(m);if(ot+vs<Ee||ot+vs>=ct)return ps.offsets[ot]=fl,fl;const pl=Oh(ot+vs,ds),ph=Uh(pl.sub(D),kn,vs),Ah=D.add(ph),hh=pl.add(ph);return ps.offsets[ot]=a.findLineIntersection(or,fl,Ah,hh)||fl,ps.offsets[ot]}function gs(ot,m,D,Ee,ct,or,kn,ds,ps,vs,fl,pl,ph,Ah){const hh=Ee?ot-m:ot+m;let Rh=hh>0?1:-1,Gh=0;Ee&&(Rh*=-1,Gh=Math.PI),Rh<0&&(Gh+=Math.PI);let Kh,ap,Lh=Rh>0?ds+kn:ds+kn+1,op=ct,yp=ct,Np=0,jp=0;const td=Math.abs(hh),Vp=[];let gd;for(;Np+jp<=td;){if(Lh+=Rh,Lh<ds||Lh>=ps)return null;Np+=jp,yp=op,ap=Kh;const T={projectionCache:pl,lineVertexArray:vs,labelPlaneMatrix:fl,tileAnchorPoint:or,distanceFromAnchor:Np,getElevation:Ah,previousVertex:yp,direction:Rh,absOffsetX:td};if(op=Oh(Lh,T),D===0)Vp.push(yp),gd=op.sub(yp);else{let X;const Ve=op.sub(yp);X=Ve.mag()===0?Uh(Oh(Lh+Rh,T).sub(op),D,Rh):Uh(Ve,D,Rh),ap||(ap=yp.add(X)),Kh=vl(Lh,X,op,ds,ps,ap,D,T),Vp.push(ap),gd=Kh.sub(ap)}jp=gd.mag()}const F=gd._mult((td-Np)/jp)._add(ap||yp),f=Gh+Math.atan2(op.y-yp.y,op.x-yp.x);return Vp.push(F),{point:F,angle:ph?f:0,path:Vp}}const di=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function fs(ot,m){for(let D=0;D<ot;D++){const Ee=m.length;m.resize(Ee+4),m.float32.set(di,3*Ee)}}function cl(ot,m,D){const Ee=m[0],ct=m[1];return ot[0]=D[0]*Ee+D[4]*ct+D[12],ot[1]=D[1]*Ee+D[5]*ct+D[13],ot[3]=D[3]*Ee+D[7]*ct+D[15],ot}const ih=100;class uh{constructor(m,D=new Yp(m.width+200,m.height+200,25),Ee=new Yp(m.width+200,m.height+200,25)){this.transform=m,this.grid=D,this.ignoredGrid=Ee,this.pitchfactor=Math.cos(m._pitch)*m.cameraToCenterDistance,this.screenRightBoundary=m.width+ih,this.screenBottomBoundary=m.height+ih,this.gridRightBoundary=m.width+200,this.gridBottomBoundary=m.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(m,D,Ee,ct,or,kn){const ds=this.projectAndGetPerspectiveRatio(ct,m.anchorPointX,m.anchorPointY,kn),ps=Ee*ds.perspectiveRatio,vs=m.x1*ps+ds.point.x,fl=m.y1*ps+ds.point.y,pl=m.x2*ps+ds.point.x,ph=m.y2*ps+ds.point.y;return!this.isInsideGrid(vs,fl,pl,ph)||D!=="always"&&this.grid.hitTest(vs,fl,pl,ph,D,or)||ds.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[vs,fl,pl,ph],offscreen:this.isOffscreen(vs,fl,pl,ph)}}placeCollisionCircles(m,D,Ee,ct,or,kn,ds,ps,vs,fl,pl,ph,Ah,hh){const Rh=[],Gh=new a.Point(D.anchorX,D.anchorY),Kh=Qd(Gh,kn,hh),ap=Rd(this.transform.cameraToCenterDistance,Kh.signedDistanceFromCamera),Lh=(fl?or/ap:or*ap)/a.ONE_EM,op=Qd(Gh,ds,hh).point,yp=Ih(Lh,ct,D.lineOffsetX*Lh,D.lineOffsetY*Lh,!1,op,Gh,D,Ee,ds,{projections:{},offsets:{}},!1,hh);let Np=!1,jp=!1,td=!0;if(yp){const Vp=.5*ph*ap+Ah,gd=new a.Point(-100,-100),F=new a.Point(this.screenRightBoundary,this.screenBottomBoundary),f=new Vd,T=yp.first,X=yp.last;let Ve=[];for(let pi=T.path.length-1;pi>=1;pi--)Ve.push(T.path[pi]);for(let pi=1;pi<X.path.length;pi++)Ve.push(X.path[pi]);const kt=2.5*Vp;if(ps){const pi=Ve.map(Vn=>Qd(Vn,ps,hh));Ve=pi.some(Vn=>Vn.signedDistanceFromCamera<=0)?[]:pi.map(Vn=>Vn.point)}let Hr=[];if(Ve.length>0){const pi=Ve[0].clone(),Vn=Ve[0].clone();for(let oa=1;oa<Ve.length;oa++)pi.x=Math.min(pi.x,Ve[oa].x),pi.y=Math.min(pi.y,Ve[oa].y),Vn.x=Math.max(Vn.x,Ve[oa].x),Vn.y=Math.max(Vn.y,Ve[oa].y);Hr=pi.x>=gd.x&&Vn.x<=F.x&&pi.y>=gd.y&&Vn.y<=F.y?[Ve]:Vn.x<gd.x||pi.x>F.x||Vn.y<gd.y||pi.y>F.y?[]:a.clipLine([Ve],gd.x,gd.y,F.x,F.y)}for(const pi of Hr){f.reset(pi,.25*Vp);let Vn=0;Vn=f.length<=.5*Vp?1:Math.ceil(f.paddedLength/kt)+1;for(let oa=0;oa<Vn;oa++){const sa=oa/Math.max(Vn-1,1),dl=f.lerp(sa),lh=dl.x+ih,gh=dl.y+ih;Rh.push(lh,gh,Vp,0);const _h=lh-Vp,yh=gh-Vp,xh=lh+Vp,yl=gh+Vp;if(td=td&&this.isOffscreen(_h,yh,xh,yl),jp=jp||this.isInsideGrid(_h,yh,xh,yl),m!=="always"&&this.grid.hitTestCircle(lh,gh,Vp,m,pl)&&(Np=!0,!vs))return{circles:[],offscreen:!1,collisionDetected:Np}}}}return{circles:!vs&&Np||!jp||ap<this.perspectiveRatioCutoff?[]:Rh,offscreen:td,collisionDetected:Np}}queryRenderedSymbols(m){if(m.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const D=[];let Ee=1/0,ct=1/0,or=-1/0,kn=-1/0;for(const fl of m){const pl=new a.Point(fl.x+ih,fl.y+ih);Ee=Math.min(Ee,pl.x),ct=Math.min(ct,pl.y),or=Math.max(or,pl.x),kn=Math.max(kn,pl.y),D.push(pl)}const ds=this.grid.query(Ee,ct,or,kn).concat(this.ignoredGrid.query(Ee,ct,or,kn)),ps={},vs={};for(const fl of ds){const pl=fl.key;if(ps[pl.bucketInstanceId]===void 0&&(ps[pl.bucketInstanceId]={}),ps[pl.bucketInstanceId][pl.featureIndex])continue;const ph=[new a.Point(fl.x1,fl.y1),new a.Point(fl.x2,fl.y1),new a.Point(fl.x2,fl.y2),new a.Point(fl.x1,fl.y2)];a.polygonIntersectsPolygon(D,ph)&&(ps[pl.bucketInstanceId][pl.featureIndex]=!0,vs[pl.bucketInstanceId]===void 0&&(vs[pl.bucketInstanceId]=[]),vs[pl.bucketInstanceId].push(pl.featureIndex))}return vs}insertCollisionBox(m,D,Ee,ct,or,kn){(Ee?this.ignoredGrid:this.grid).insert({bucketInstanceId:ct,featureIndex:or,collisionGroupID:kn,overlapMode:D},m[0],m[1],m[2],m[3])}insertCollisionCircles(m,D,Ee,ct,or,kn){const ds=Ee?this.ignoredGrid:this.grid,ps={bucketInstanceId:ct,featureIndex:or,collisionGroupID:kn,overlapMode:D};for(let vs=0;vs<m.length;vs+=4)ds.insertCircle(ps,m[vs],m[vs+1],m[vs+2])}projectAndGetPerspectiveRatio(m,D,Ee,ct){let or;return ct?(or=[D,Ee,ct(D,Ee),1],a.transformMat4(or,or,m)):(or=[D,Ee,0,1],cl(or,or,m)),{point:new a.Point((or[0]/or[3]+1)/2*this.transform.width+ih,(-or[1]/or[3]+1)/2*this.transform.height+ih),perspectiveRatio:.5+this.transform.cameraToCenterDistance/or[3]*.5}}isOffscreen(m,D,Ee,ct){return Ee<ih||m>=this.screenRightBoundary||ct<ih||D>this.screenBottomBoundary}isInsideGrid(m,D,Ee,ct){return Ee>=0&&m<this.gridRightBoundary&&ct>=0&&D<this.gridBottomBoundary}getViewportMatrix(){const m=a.identity([]);return a.translate(m,m,[-100,-100,0]),m}}function vh(ot,m,D){return m*(a.EXTENT/(ot.tileSize*Math.pow(2,D-ot.tileID.overscaledZ)))}class Th{constructor(m,D,Ee,ct){this.opacity=m?Math.max(0,Math.min(1,m.opacity+(m.placed?D:-D))):ct&&Ee?1:0,this.placed=Ee}isHidden(){return this.opacity===0&&!this.placed}}class kh{constructor(m,D,Ee,ct,or){this.text=new Th(m?m.text:null,D,Ee,or),this.icon=new Th(m?m.icon:null,D,ct,or)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ep{constructor(m,D,Ee){this.text=m,this.icon=D,this.skipFade=Ee}}class ip{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class _p{constructor(m,D,Ee,ct,or){this.bucketInstanceId=m,this.featureIndex=D,this.sourceLayerIndex=Ee,this.bucketIndex=ct,this.tileID=or}}class rd{constructor(m){this.crossSourceCollisions=m,this.maxGroupID=0,this.collisionGroups={}}get(m){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[m]){const D=++this.maxGroupID;this.collisionGroups[m]={ID:D,predicate:Ee=>Ee.collisionGroupID===D}}return this.collisionGroups[m]}}function Dd(ot,m,D,Ee,ct){const{horizontalAlign:or,verticalAlign:kn}=a.getAnchorAlignment(ot),ds=-(or-.5)*m,ps=-(kn-.5)*D,vs=a.evaluateVariableOffset(ot,Ee);return new a.Point(ds+vs[0]*ct,ps+vs[1]*ct)}function qp(ot,m,D,Ee,ct,or){const{x1:kn,x2:ds,y1:ps,y2:vs,anchorPointX:fl,anchorPointY:pl}=ot,ph=new a.Point(m,D);return Ee&&ph._rotate(ct?or:-or),{x1:kn+ph.x,y1:ps+ph.y,x2:ds+ph.x,y2:vs+ph.y,anchorPointX:fl,anchorPointY:pl}}class wd{constructor(m,D,Ee,ct,or){this.transform=m.clone(),this.terrain=D,this.collisionIndex=new uh(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=Ee,this.retainedQueryData={},this.collisionGroups=new rd(ct),this.collisionCircleArrays={},this.prevPlacement=or,or&&(or.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(m,D,Ee,ct){const or=Ee.getBucket(D),kn=Ee.latestFeatureIndex;if(!or||!kn||D.id!==or.layerIds[0])return;const ds=Ee.collisionBoxArray,ps=or.layers[0].layout,vs=Math.pow(2,this.transform.zoom-Ee.tileID.overscaledZ),fl=Ee.tileSize/a.EXTENT,pl=this.transform.calculatePosMatrix(Ee.tileID.toUnwrapped()),ph=ps.get("text-pitch-alignment")==="map",Ah=ps.get("text-rotation-alignment")==="map",hh=vh(Ee,1,this.transform.zoom),Rh=nd(pl,ph,Ah,this.transform,hh);let Gh=null;if(ph){const ap=$d(pl,ph,Ah,this.transform,hh);Gh=a.multiply([],this.transform.labelPlaneMatrix,ap)}this.retainedQueryData[or.bucketInstanceId]=new _p(or.bucketInstanceId,kn,or.sourceLayerIndex,or.index,Ee.tileID);const Kh={bucket:or,layout:ps,posMatrix:pl,textLabelPlaneMatrix:Rh,labelToScreenMatrix:Gh,scale:vs,textPixelRatio:fl,holdingForFade:Ee.holdingForFade(),collisionBoxArray:ds,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(or.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(or.sourceID)};if(ct)for(const ap of or.sortKeyRanges){const{sortKey:Lh,symbolInstanceStart:op,symbolInstanceEnd:yp}=ap;m.push({sortKey:Lh,symbolInstanceStart:op,symbolInstanceEnd:yp,parameters:Kh})}else m.push({symbolInstanceStart:0,symbolInstanceEnd:or.symbolInstances.length,parameters:Kh})}attemptAnchorPlacement(m,D,Ee,ct,or,kn,ds,ps,vs,fl,pl,ph,Ah,hh,Rh,Gh){const Kh=[ph.textOffset0,ph.textOffset1],ap=Dd(m,Ee,ct,Kh,or),Lh=this.collisionIndex.placeCollisionBox(qp(D,ap.x,ap.y,kn,ds,this.transform.angle),pl,ps,vs,fl.predicate,Gh);if((!Rh||this.collisionIndex.placeCollisionBox(qp(Rh,ap.x,ap.y,kn,ds,this.transform.angle),pl,ps,vs,fl.predicate,Gh).box.length!==0)&&Lh.box.length>0){let op;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ph.crossTileID]&&this.prevPlacement.placements[ph.crossTileID]&&this.prevPlacement.placements[ph.crossTileID].text&&(op=this.prevPlacement.variableOffsets[ph.crossTileID].anchor),ph.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ph.crossTileID]={textOffset:Kh,width:Ee,height:ct,anchor:m,textBoxScale:or,prevAnchor:op},this.markUsedJustification(Ah,m,ph,hh),Ah.allowVerticalPlacement&&(this.markUsedOrientation(Ah,hh,ph),this.placedOrientations[ph.crossTileID]=hh),{shift:ap,placedGlyphBoxes:Lh}}}placeLayerBucketPart(m,D,Ee){const{bucket:ct,layout:or,posMatrix:kn,textLabelPlaneMatrix:ds,labelToScreenMatrix:ps,textPixelRatio:vs,holdingForFade:fl,collisionBoxArray:pl,partiallyEvaluatedTextSize:ph,collisionGroup:Ah}=m.parameters,hh=or.get("text-optional"),Rh=or.get("icon-optional"),Gh=a.getOverlapMode(or,"text-overlap","text-allow-overlap"),Kh=Gh==="always",ap=a.getOverlapMode(or,"icon-overlap","icon-allow-overlap"),Lh=ap==="always",op=or.get("text-rotation-alignment")==="map",yp=or.get("text-pitch-alignment")==="map",Np=or.get("icon-text-fit")!=="none",jp=or.get("symbol-z-order")==="viewport-y",td=Kh&&(Lh||!ct.hasIconData()||Rh),Vp=Lh&&(Kh||!ct.hasTextData()||hh);!ct.collisionArrays&&pl&&ct.deserializeCollisionBoxes(pl);const gd=this.retainedQueryData[ct.bucketInstanceId].tileID,F=this.terrain?(T,X)=>this.terrain.getElevation(gd,T,X):null,f=(T,X)=>{if(D[T.crossTileID])return;if(fl)return void(this.placements[T.crossTileID]=new ep(!1,!1,!1));let Ve=!1,kt=!1,Hr=!0,pi=null,Vn={box:null,offscreen:null},oa={box:null,offscreen:null},sa=null,dl=null,lh=null,gh=0,_h=0,yh=0;X.textFeatureIndex?gh=X.textFeatureIndex:T.useRuntimeCollisionCircles&&(gh=T.featureIndex),X.verticalTextFeatureIndex&&(_h=X.verticalTextFeatureIndex);const xh=X.textBox;if(xh){const bh=Nh=>{let $h=a.WritingMode.horizontal;if(ct.allowVerticalPlacement&&!Nh&&this.prevPlacement){const Vh=this.prevPlacement.placedOrientations[T.crossTileID];Vh&&(this.placedOrientations[T.crossTileID]=Vh,$h=Vh,this.markUsedOrientation(ct,$h,T))}return $h},Sh=(Nh,$h)=>{if(ct.allowVerticalPlacement&&T.numVerticalGlyphVertices>0&&X.verticalTextBox){for(const Vh of ct.writingModes)if(Vh===a.WritingMode.vertical?(Vn=$h(),oa=Vn):Vn=Nh(),Vn&&Vn.box&&Vn.box.length)break}else Vn=Nh()};if(or.get("text-variable-anchor")){let Nh=or.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[T.crossTileID]){const Wh=this.prevPlacement.variableOffsets[T.crossTileID];Nh.indexOf(Wh.anchor)>0&&(Nh=Nh.filter(Zh=>Zh!==Wh.anchor),Nh.unshift(Wh.anchor))}const $h=(Wh,Zh,rp)=>{const Bp=Wh.x2-Wh.x1,tp=Wh.y2-Wh.y1,Tp=T.textBoxScale,pp=Np&&ap==="never"?Zh:null;let bp={box:[],offscreen:!1};const np=Gh!=="never"?2*Nh.length:Nh.length;for(let wp=0;wp<np;++wp){const Fp=this.attemptAnchorPlacement(Nh[wp%Nh.length],Wh,Bp,tp,Tp,op,yp,vs,kn,Ah,wp>=Nh.length?Gh:"never",T,ct,rp,pp,F);if(Fp&&(bp=Fp.placedGlyphBoxes,bp&&bp.box&&bp.box.length)){Ve=!0,pi=Fp.shift;break}}return bp};Sh(()=>$h(xh,X.iconBox,a.WritingMode.horizontal),()=>{const Wh=X.verticalTextBox;return ct.allowVerticalPlacement&&!(Vn&&Vn.box&&Vn.box.length)&&T.numVerticalGlyphVertices>0&&Wh?$h(Wh,X.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null}}),Vn&&(Ve=Vn.box,Hr=Vn.offscreen);const Vh=bh(Vn&&Vn.box);if(!Ve&&this.prevPlacement){const Wh=this.prevPlacement.variableOffsets[T.crossTileID];Wh&&(this.variableOffsets[T.crossTileID]=Wh,this.markUsedJustification(ct,Wh.anchor,T,Vh))}}else{const Nh=($h,Vh)=>{const Wh=this.collisionIndex.placeCollisionBox($h,Gh,vs,kn,Ah.predicate,F);return Wh&&Wh.box&&Wh.box.length&&(this.markUsedOrientation(ct,Vh,T),this.placedOrientations[T.crossTileID]=Vh),Wh};Sh(()=>Nh(xh,a.WritingMode.horizontal),()=>{const $h=X.verticalTextBox;return ct.allowVerticalPlacement&&T.numVerticalGlyphVertices>0&&$h?Nh($h,a.WritingMode.vertical):{box:null,offscreen:null}}),bh(Vn&&Vn.box&&Vn.box.length)}}if(sa=Vn,Ve=sa&&sa.box&&sa.box.length>0,Hr=sa&&sa.offscreen,T.useRuntimeCollisionCircles){const bh=ct.text.placedSymbolArray.get(T.centerJustifiedTextSymbolIndex),Sh=a.evaluateSizeForFeature(ct.textSizeData,ph,bh),Nh=or.get("text-padding");dl=this.collisionIndex.placeCollisionCircles(Gh,bh,ct.lineVertexArray,ct.glyphOffsetArray,Sh,kn,ds,ps,Ee,yp,Ah.predicate,T.collisionCircleDiameter,Nh,F),dl.circles.length&&dl.collisionDetected&&!Ee&&a.warnOnce("Collisions detected, but collision boxes are not shown"),Ve=Kh||dl.circles.length>0&&!dl.collisionDetected,Hr=Hr&&dl.offscreen}if(X.iconFeatureIndex&&(yh=X.iconFeatureIndex),X.iconBox){const bh=Sh=>{const Nh=Np&&pi?qp(Sh,pi.x,pi.y,op,yp,this.transform.angle):Sh;return this.collisionIndex.placeCollisionBox(Nh,ap,vs,kn,Ah.predicate,F)};oa&&oa.box&&oa.box.length&&X.verticalIconBox?(lh=bh(X.verticalIconBox),kt=lh.box.length>0):(lh=bh(X.iconBox),kt=lh.box.length>0),Hr=Hr&&lh.offscreen}const yl=hh||T.numHorizontalGlyphVertices===0&&T.numVerticalGlyphVertices===0,mh=Rh||T.numIconVertices===0;if(yl||mh?mh?yl||(kt=kt&&Ve):Ve=kt&&Ve:kt=Ve=kt&&Ve,Ve&&sa&&sa.box&&this.collisionIndex.insertCollisionBox(sa.box,Gh,or.get("text-ignore-placement"),ct.bucketInstanceId,oa&&oa.box&&_h?_h:gh,Ah.ID),kt&&lh&&this.collisionIndex.insertCollisionBox(lh.box,ap,or.get("icon-ignore-placement"),ct.bucketInstanceId,yh,Ah.ID),dl&&(Ve&&this.collisionIndex.insertCollisionCircles(dl.circles,Gh,or.get("text-ignore-placement"),ct.bucketInstanceId,gh,Ah.ID),Ee)){const bh=ct.bucketInstanceId;let Sh=this.collisionCircleArrays[bh];Sh===void 0&&(Sh=this.collisionCircleArrays[bh]=new ip);for(let Nh=0;Nh<dl.circles.length;Nh+=4)Sh.circles.push(dl.circles[Nh+0]),Sh.circles.push(dl.circles[Nh+1]),Sh.circles.push(dl.circles[Nh+2]),Sh.circles.push(dl.collisionDetected?1:0)}if(T.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(ct.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[T.crossTileID]=new ep(Ve||td,kt||Vp,Hr||ct.justReloaded),D[T.crossTileID]=!0};if(jp){if(m.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const T=ct.getSortedSymbolIndexes(this.transform.angle);for(let X=T.length-1;X>=0;--X){const Ve=T[X];f(ct.symbolInstances.get(Ve),ct.collisionArrays[Ve])}}else for(let T=m.symbolInstanceStart;T<m.symbolInstanceEnd;T++)f(ct.symbolInstances.get(T),ct.collisionArrays[T]);if(Ee&&ct.bucketInstanceId in this.collisionCircleArrays){const T=this.collisionCircleArrays[ct.bucketInstanceId];a.invert(T.invProjMatrix,kn),T.viewportMatrix=this.collisionIndex.getViewportMatrix()}ct.justReloaded=!1}markUsedJustification(m,D,Ee,ct){let or;or=ct===a.WritingMode.vertical?Ee.verticalPlacedTextSymbolIndex:{left:Ee.leftJustifiedTextSymbolIndex,center:Ee.centerJustifiedTextSymbolIndex,right:Ee.rightJustifiedTextSymbolIndex}[a.getAnchorJustification(D)];const kn=[Ee.leftJustifiedTextSymbolIndex,Ee.centerJustifiedTextSymbolIndex,Ee.rightJustifiedTextSymbolIndex,Ee.verticalPlacedTextSymbolIndex];for(const ds of kn)ds>=0&&(m.text.placedSymbolArray.get(ds).crossTileID=or>=0&&ds!==or?0:Ee.crossTileID)}markUsedOrientation(m,D,Ee){const ct=D===a.WritingMode.horizontal||D===a.WritingMode.horizontalOnly?D:0,or=D===a.WritingMode.vertical?D:0,kn=[Ee.leftJustifiedTextSymbolIndex,Ee.centerJustifiedTextSymbolIndex,Ee.rightJustifiedTextSymbolIndex];for(const ds of kn)m.text.placedSymbolArray.get(ds).placedOrientation=ct;Ee.verticalPlacedTextSymbolIndex&&(m.text.placedSymbolArray.get(Ee.verticalPlacedTextSymbolIndex).placedOrientation=or)}commit(m){this.commitTime=m,this.zoomAtLastRecencyCheck=this.transform.zoom;const D=this.prevPlacement;let Ee=!1;this.prevZoomAdjustment=D?D.zoomAdjustment(this.transform.zoom):0;const ct=D?D.symbolFadeChange(m):1,or=D?D.opacities:{},kn=D?D.variableOffsets:{},ds=D?D.placedOrientations:{};for(const ps in this.placements){const vs=this.placements[ps],fl=or[ps];fl?(this.opacities[ps]=new kh(fl,ct,vs.text,vs.icon),Ee=Ee||vs.text!==fl.text.placed||vs.icon!==fl.icon.placed):(this.opacities[ps]=new kh(null,ct,vs.text,vs.icon,vs.skipFade),Ee=Ee||vs.text||vs.icon)}for(const ps in or){const vs=or[ps];if(!this.opacities[ps]){const fl=new kh(vs,ct,!1,!1);fl.isHidden()||(this.opacities[ps]=fl,Ee=Ee||vs.text.placed||vs.icon.placed)}}for(const ps in kn)this.variableOffsets[ps]||!this.opacities[ps]||this.opacities[ps].isHidden()||(this.variableOffsets[ps]=kn[ps]);for(const ps in ds)this.placedOrientations[ps]||!this.opacities[ps]||this.opacities[ps].isHidden()||(this.placedOrientations[ps]=ds[ps]);if(D&&D.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");Ee?this.lastPlacementChangeTime=m:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=D?D.lastPlacementChangeTime:m)}updateLayerOpacities(m,D){const Ee={};for(const ct of D){const or=ct.getBucket(m);or&&ct.latestFeatureIndex&&m.id===or.layerIds[0]&&this.updateBucketOpacities(or,Ee,ct.collisionBoxArray)}}updateBucketOpacities(m,D,Ee){m.hasTextData()&&(m.text.opacityVertexArray.clear(),m.text.hasVisibleVertices=!1),m.hasIconData()&&(m.icon.opacityVertexArray.clear(),m.icon.hasVisibleVertices=!1),m.hasIconCollisionBoxData()&&m.iconCollisionBox.collisionVertexArray.clear(),m.hasTextCollisionBoxData()&&m.textCollisionBox.collisionVertexArray.clear();const ct=m.layers[0].layout,or=new kh(null,0,!1,!1,!0),kn=ct.get("text-allow-overlap"),ds=ct.get("icon-allow-overlap"),ps=ct.get("text-variable-anchor"),vs=ct.get("text-rotation-alignment")==="map",fl=ct.get("text-pitch-alignment")==="map",pl=ct.get("icon-text-fit")!=="none",ph=new kh(null,0,kn&&(ds||!m.hasIconData()||ct.get("icon-optional")),ds&&(kn||!m.hasTextData()||ct.get("text-optional")),!0);!m.collisionArrays&&Ee&&(m.hasIconCollisionBoxData()||m.hasTextCollisionBoxData())&&m.deserializeCollisionBoxes(Ee);const Ah=(hh,Rh,Gh)=>{for(let Kh=0;Kh<Rh/4;Kh++)hh.opacityVertexArray.emplaceBack(Gh);hh.hasVisibleVertices=hh.hasVisibleVertices||Gh!==Bg};for(let hh=0;hh<m.symbolInstances.length;hh++){const Rh=m.symbolInstances.get(hh),{numHorizontalGlyphVertices:Gh,numVerticalGlyphVertices:Kh,crossTileID:ap}=Rh;let Lh=this.opacities[ap];D[ap]?Lh=or:Lh||(Lh=ph,this.opacities[ap]=Lh),D[ap]=!0;const op=Rh.numIconVertices>0,yp=this.placedOrientations[Rh.crossTileID],Np=yp===a.WritingMode.vertical,jp=yp===a.WritingMode.horizontal||yp===a.WritingMode.horizontalOnly;if(Gh>0||Kh>0){const td=oy(Lh.text);Ah(m.text,Gh,Np?Bg:td),Ah(m.text,Kh,jp?Bg:td);const Vp=Lh.text.isHidden();[Rh.rightJustifiedTextSymbolIndex,Rh.centerJustifiedTextSymbolIndex,Rh.leftJustifiedTextSymbolIndex].forEach(f=>{f>=0&&(m.text.placedSymbolArray.get(f).hidden=Vp||Np?1:0)}),Rh.verticalPlacedTextSymbolIndex>=0&&(m.text.placedSymbolArray.get(Rh.verticalPlacedTextSymbolIndex).hidden=Vp||jp?1:0);const gd=this.variableOffsets[Rh.crossTileID];gd&&this.markUsedJustification(m,gd.anchor,Rh,yp);const F=this.placedOrientations[Rh.crossTileID];F&&(this.markUsedJustification(m,"left",Rh,F),this.markUsedOrientation(m,F,Rh))}if(op){const td=oy(Lh.icon),Vp=!(pl&&Rh.verticalPlacedIconSymbolIndex&&Np);Rh.placedIconSymbolIndex>=0&&(Ah(m.icon,Rh.numIconVertices,Vp?td:Bg),m.icon.placedSymbolArray.get(Rh.placedIconSymbolIndex).hidden=Lh.icon.isHidden()),Rh.verticalPlacedIconSymbolIndex>=0&&(Ah(m.icon,Rh.numVerticalIconVertices,Vp?Bg:td),m.icon.placedSymbolArray.get(Rh.verticalPlacedIconSymbolIndex).hidden=Lh.icon.isHidden())}if(m.hasIconCollisionBoxData()||m.hasTextCollisionBoxData()){const td=m.collisionArrays[hh];if(td){let Vp=new a.Point(0,0);if(td.textBox||td.verticalTextBox){let F=!0;if(ps){const f=this.variableOffsets[ap];f?(Vp=Dd(f.anchor,f.width,f.height,f.textOffset,f.textBoxScale),vs&&Vp._rotate(fl?this.transform.angle:-this.transform.angle)):F=!1}td.textBox&&dd(m.textCollisionBox.collisionVertexArray,Lh.text.placed,!F||Np,Vp.x,Vp.y),td.verticalTextBox&&dd(m.textCollisionBox.collisionVertexArray,Lh.text.placed,!F||jp,Vp.x,Vp.y)}const gd=!!(!jp&&td.verticalIconBox);td.iconBox&&dd(m.iconCollisionBox.collisionVertexArray,Lh.icon.placed,gd,pl?Vp.x:0,pl?Vp.y:0),td.verticalIconBox&&dd(m.iconCollisionBox.collisionVertexArray,Lh.icon.placed,!gd,pl?Vp.x:0,pl?Vp.y:0)}}}if(m.sortFeatures(this.transform.angle),this.retainedQueryData[m.bucketInstanceId]&&(this.retainedQueryData[m.bucketInstanceId].featureSortOrder=m.featureSortOrder),m.hasTextData()&&m.text.opacityVertexBuffer&&m.text.opacityVertexBuffer.updateData(m.text.opacityVertexArray),m.hasIconData()&&m.icon.opacityVertexBuffer&&m.icon.opacityVertexBuffer.updateData(m.icon.opacityVertexArray),m.hasIconCollisionBoxData()&&m.iconCollisionBox.collisionVertexBuffer&&m.iconCollisionBox.collisionVertexBuffer.updateData(m.iconCollisionBox.collisionVertexArray),m.hasTextCollisionBoxData()&&m.textCollisionBox.collisionVertexBuffer&&m.textCollisionBox.collisionVertexBuffer.updateData(m.textCollisionBox.collisionVertexArray),m.text.opacityVertexArray.length!==m.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${m.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${m.text.layoutVertexArray.length}) / 4`);if(m.icon.opacityVertexArray.length!==m.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${m.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${m.icon.layoutVertexArray.length}) / 4`);if(m.bucketInstanceId in this.collisionCircleArrays){const hh=this.collisionCircleArrays[m.bucketInstanceId];m.placementInvProjMatrix=hh.invProjMatrix,m.placementViewportMatrix=hh.viewportMatrix,m.collisionCircleArray=hh.circles,delete this.collisionCircleArrays[m.bucketInstanceId]}}symbolFadeChange(m){return this.fadeDuration===0?1:(m-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(m){return Math.max(0,(this.transform.zoom-m)/1.5)}hasTransitions(m){return this.stale||m-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(m,D){const Ee=this.zoomAtLastRecencyCheck===D?1-this.zoomAdjustment(D):1;return this.zoomAtLastRecencyCheck=D,this.commitTime+this.fadeDuration*Ee>m}setStale(){this.stale=!0}}function dd(ot,m,D,Ee,ct){ot.emplaceBack(m?1:0,D?1:0,Ee||0,ct||0),ot.emplaceBack(m?1:0,D?1:0,Ee||0,ct||0),ot.emplaceBack(m?1:0,D?1:0,Ee||0,ct||0),ot.emplaceBack(m?1:0,D?1:0,Ee||0,ct||0)}const Wd=Math.pow(2,25),Vf=Math.pow(2,24),Wf=Math.pow(2,17),pg=Math.pow(2,16),Jd=Math.pow(2,9),Yd=Math.pow(2,8),Cg=Math.pow(2,1);function oy(ot){if(ot.opacity===0&&!ot.placed)return 0;if(ot.opacity===1&&ot.placed)return 4294967295;const m=ot.placed?1:0,D=Math.floor(127*ot.opacity);return D*Wd+m*Vf+D*Wf+m*pg+D*Jd+m*Yd+D*Cg+m}const Bg=0;class Xg{constructor(m){this._sortAcrossTiles=m.layout.get("symbol-z-order")!=="viewport-y"&&!m.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(m,D,Ee,ct,or){const kn=this._bucketParts;for(;this._currentTileIndex<m.length;)if(D.getBucketParts(kn,ct,m[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,or())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,kn.sort((ds,ps)=>ds.sortKey-ps.sortKey));this._currentPartIndex<kn.length;)if(D.placeLayerBucketPart(kn[this._currentPartIndex],this._seenCrossTileIDs,Ee),this._currentPartIndex++,or())return!0;return!1}}class nm{constructor(m,D,Ee,ct,or,kn,ds,ps){this.placement=new wd(m,D,kn,ds,ps),this._currentPlacementIndex=Ee.length-1,this._forceFullPlacement=ct,this._showCollisionBoxes=or,this._done=!1}isDone(){return this._done}continuePlacement(m,D,Ee){const ct=a.exported.now(),or=()=>!this._forceFullPlacement&&a.exported.now()-ct>2;for(;this._currentPlacementIndex>=0;){const kn=D[m[this._currentPlacementIndex]],ds=this.placement.collisionIndex.transform.zoom;if(kn.type==="symbol"&&(!kn.minzoom||kn.minzoom<=ds)&&(!kn.maxzoom||kn.maxzoom>ds)){if(this._inProgressLayer||(this._inProgressLayer=new Xg(kn)),this._inProgressLayer.continuePlacement(Ee[kn.source],this.placement,this._showCollisionBoxes,kn,or))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(m){return this.placement.commit(m),this.placement}}const u_=512/a.EXTENT/2;class xv{constructor(m,D,Ee){this.tileID=m,this.bucketInstanceId=Ee,this._symbolsByKey={};const ct=new Map;for(let or=0;or<D.length;or++){const kn=D.get(or),ds=kn.key,ps=ct.get(ds);ps?ps.push(kn):ct.set(ds,[kn])}for(const[or,kn]of ct){const ds={positions:kn.map(ps=>({x:Math.floor(ps.anchorX*u_),y:Math.floor(ps.anchorY*u_)})),crossTileIDs:kn.map(ps=>ps.crossTileID)};if(ds.positions.length>128){const ps=new a.KDBush(ds.positions.length,16,Uint16Array);for(const{x:vs,y:fl}of ds.positions)ps.add(vs,fl);ps.finish(),delete ds.positions,ds.index=ps}this._symbolsByKey[or]=ds}}getScaledCoordinates(m,D){const{x:Ee,y:ct,z:or}=this.tileID.canonical,{x:kn,y:ds,z:ps}=D.canonical,vs=u_/Math.pow(2,ps-or),fl=(ds*a.EXTENT+m.anchorY)*vs,pl=ct*a.EXTENT*u_;return{x:Math.floor((kn*a.EXTENT+m.anchorX)*vs-Ee*a.EXTENT*u_),y:Math.floor(fl-pl)}}findMatches(m,D,Ee){const ct=this.tileID.canonical.z<D.canonical.z?1:Math.pow(2,this.tileID.canonical.z-D.canonical.z);for(let or=0;or<m.length;or++){const kn=m.get(or);if(kn.crossTileID)continue;const ds=this._symbolsByKey[kn.key];if(!ds)continue;const ps=this.getScaledCoordinates(kn,D);if(ds.index){const vs=ds.index.range(ps.x-ct,ps.y-ct,ps.x+ct,ps.y+ct).sort();for(const fl of vs){const pl=ds.crossTileIDs[fl];if(!Ee[pl]){Ee[pl]=!0,kn.crossTileID=pl;break}}}else if(ds.positions)for(let vs=0;vs<ds.positions.length;vs++){const fl=ds.positions[vs],pl=ds.crossTileIDs[vs];if(Math.abs(fl.x-ps.x)<=ct&&Math.abs(fl.y-ps.y)<=ct&&!Ee[pl]){Ee[pl]=!0,kn.crossTileID=pl;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:m})=>m)}}class Dg{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class sy{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(m){const D=Math.round((m-this.lng)/360);if(D!==0)for(const Ee in this.indexes){const ct=this.indexes[Ee],or={};for(const kn in ct){const ds=ct[kn];ds.tileID=ds.tileID.unwrapTo(ds.tileID.wrap+D),or[ds.tileID.key]=ds}this.indexes[Ee]=or}this.lng=m}addBucket(m,D,Ee){if(this.indexes[m.overscaledZ]&&this.indexes[m.overscaledZ][m.key]){if(this.indexes[m.overscaledZ][m.key].bucketInstanceId===D.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(m.overscaledZ,this.indexes[m.overscaledZ][m.key])}for(let or=0;or<D.symbolInstances.length;or++)D.symbolInstances.get(or).crossTileID=0;this.usedCrossTileIDs[m.overscaledZ]||(this.usedCrossTileIDs[m.overscaledZ]={});const ct=this.usedCrossTileIDs[m.overscaledZ];for(const or in this.indexes){const kn=this.indexes[or];if(Number(or)>m.overscaledZ)for(const ds in kn){const ps=kn[ds];ps.tileID.isChildOf(m)&&ps.findMatches(D.symbolInstances,m,ct)}else{const ds=kn[m.scaledTo(Number(or)).key];ds&&ds.findMatches(D.symbolInstances,m,ct)}}for(let or=0;or<D.symbolInstances.length;or++){const kn=D.symbolInstances.get(or);kn.crossTileID||(kn.crossTileID=Ee.generate(),ct[kn.crossTileID]=!0)}return this.indexes[m.overscaledZ]===void 0&&(this.indexes[m.overscaledZ]={}),this.indexes[m.overscaledZ][m.key]=new xv(m,D.symbolInstances,D.bucketInstanceId),!0}removeBucketCrossTileIDs(m,D){for(const Ee of D.getCrossTileIDsLists())for(const ct of Ee)delete this.usedCrossTileIDs[m][ct]}removeStaleBuckets(m){let D=!1;for(const Ee in this.indexes){const ct=this.indexes[Ee];for(const or in ct)m[ct[or].bucketInstanceId]||(this.removeBucketCrossTileIDs(Ee,ct[or]),delete ct[or],D=!0)}return D}}class fy{constructor(){this.layerIndexes={},this.crossTileIDs=new Dg,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(m,D,Ee){let ct=this.layerIndexes[m.id];ct===void 0&&(ct=this.layerIndexes[m.id]=new sy);let or=!1;const kn={};ct.handleWrapJump(Ee);for(const ds of D){const ps=ds.getBucket(m);ps&&m.id===ps.layerIds[0]&&(ps.bucketInstanceId||(ps.bucketInstanceId=++this.maxBucketInstanceId),ct.addBucket(ds.tileID,ps,this.crossTileIDs)&&(or=!0),kn[ps.bucketInstanceId]=!0)}return ct.removeStaleBuckets(kn)&&(or=!0),or}pruneUnusedLayers(m){const D={};m.forEach(Ee=>{D[Ee]=!0});for(const Ee in this.layerIndexes)D[Ee]||delete this.layerIndexes[Ee]}}const hp=(ot,m)=>a.emitValidationErrors(ot,m&&m.filter(D=>D.identifier!=="source.canvas")),gy=a.pick(a.operations,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),xg=a.pick(a.operations,["setCenter","setZoom","setBearing","setPitch"]),hm=a.emptyStyle();class xm extends a.Evented{constructor(m,D={}){super(),this.map=m,this.dispatcher=new Cp(Ed(),this,m._getMapId()),this.imageManager=new wh,this.imageManager.setEventedParent(this),this.glyphManager=new gp(m._requestManager,D.localIdeographFontFamily),this.lineAtlas=new Xp(256,512),this.crossTileSymbolIndex=new fy,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const Ee=this;this._rtlTextPluginCallback=xm.registerForPluginStateChange(ct=>{Ee.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:ct.pluginStatus,pluginURL:ct.pluginURL},(or,kn)=>{if(a.triggerPluginCompletionEvent(or),kn&&kn.every(ds=>ds))for(const ds in Ee.sourceCaches){const ps=Ee.sourceCaches[ds].getSource().type;ps!=="vector"&&ps!=="geojson"||Ee.sourceCaches[ds].reload()}})}),this.on("data",ct=>{if(ct.dataType!=="source"||ct.sourceDataType!=="metadata")return;const or=this.sourceCaches[ct.sourceId];if(!or)return;const kn=or.getSource();if(kn&&kn.vectorLayerIds)for(const ds in this._layers){const ps=this._layers[ds];ps.source===kn.id&&this._validateLayer(ps)}})}loadURL(m,D={},Ee){this.fire(new a.Event("dataloading",{dataType:"style"})),D.validate=typeof D.validate!="boolean"||D.validate;const ct=this.map._requestManager.transformRequest(m,yi.Style);this._request=a.getJSON(ct,(or,kn)=>{this._request=null,or?this.fire(new a.ErrorEvent(or)):kn&&this._load(kn,D,Ee)})}loadJSON(m,D={},Ee){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,D.validate=D.validate!==!1,this._load(m,D,Ee)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(hm,{validate:!1})}_load(m,D,Ee){const ct=D.transformStyle?D.transformStyle(Ee,m):m;if(!D.validate||!hp(this,a.validateStyle(ct))){this._loaded=!0,this.stylesheet=ct;for(const or in ct.sources)this.addSource(or,ct.sources[or],{validate:!1});ct.sprite?this._loadSprite(ct.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(ct.glyphs),this._createLayers(),this.light=new $p(this.stylesheet.light),this.map.setTerrain(this.stylesheet.terrain),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}}_createLayers(){const m=a.derefLayers(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",m),this._order=m.map(D=>D.id),this._layers={},this._serializedLayers=null;for(const D of m){const Ee=a.createStyleLayer(D);Ee.setEventedParent(this,{layer:{id:D.id}}),this._layers[D.id]=Ee}}_loadSprite(m,D=!1,Ee=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(ct,or,kn,ds){const ps=sl(ct),vs=ps.length,fl=kn>1?"@2x":"",pl={},ph={},Ah={};for(const{id:hh,url:Rh}of ps){const Gh=or.transformRequest(or.normalizeSpriteURL(Rh,fl,".json"),yi.SpriteJSON),Kh=`${hh}_${Gh.url}`;pl[Kh]=a.getJSON(Gh,(op,yp)=>{delete pl[Kh],ph[hh]=yp,ol(ds,ph,Ah,op,vs)});const ap=or.transformRequest(or.normalizeSpriteURL(Rh,fl,".png"),yi.SpriteImage),Lh=`${hh}_${ap.url}`;pl[Lh]=Bn.getImage(ap,(op,yp)=>{delete pl[Lh],Ah[hh]=yp,ol(ds,ph,Ah,op,vs)})}return{cancel(){for(const hh of Object.values(pl))hh.cancel()}}}(m,this.map._requestManager,this.map.getPixelRatio(),(ct,or)=>{if(this._spriteRequest=null,ct)this.fire(new a.ErrorEvent(ct));else if(or)for(const kn in or){this._spritesImagesIds[kn]=[];const ds=this._spritesImagesIds[kn]?this._spritesImagesIds[kn].filter(ps=>!(ps in or)):[];for(const ps of ds)this.imageManager.removeImage(ps),this._changedImages[ps]=!0;for(const ps in or[kn]){const vs=kn==="default"?ps:`${kn}:${ps}`;this._spritesImagesIds[kn].push(vs),vs in this.imageManager.images?this.imageManager.updateImage(vs,or[kn][ps],!1):this.imageManager.addImage(vs,or[kn][ps]),D&&(this._changedImages[vs]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),D&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"})),Ee&&Ee(ct)})}_unloadSprite(){for(const m of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(m),this._changedImages[m]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}_validateLayer(m){const D=this.sourceCaches[m.source];if(!D)return;const Ee=m.sourceLayer;if(!Ee)return;const ct=D.getSource();(ct.type==="geojson"||ct.vectorLayerIds&&ct.vectorLayerIds.indexOf(Ee)===-1)&&this.fire(new a.ErrorEvent(new Error(`Source layer "${Ee}" does not exist on source "${ct.id}" as specified by style layer "${m.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const m in this.sourceCaches)if(!this.sourceCaches[m].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(m){const D=this._serializedAllLayers();if(!m||m.length===0)return Object.values(D);const Ee=[];for(const ct of m)D[ct]&&Ee.push(D[ct]);return Ee}_serializedAllLayers(){let m=this._serializedLayers;if(m)return m;m=this._serializedLayers={};const D=Object.keys(this._layers);for(const Ee of D){const ct=this._layers[Ee];ct.type!=="custom"&&(m[Ee]=ct.serialize())}return m}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const m in this.sourceCaches)if(this.sourceCaches[m].hasTransition())return!0;for(const m in this._layers)if(this._layers[m].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(m){if(!this._loaded)return;const D=this._changed;if(this._changed){const ct=Object.keys(this._updatedLayers),or=Object.keys(this._removedLayers);(ct.length||or.length)&&this._updateWorkerLayers(ct,or);for(const kn in this._updatedSources){const ds=this._updatedSources[kn];if(ds==="reload")this._reloadSource(kn);else{if(ds!=="clear")throw new Error(`Invalid action ${ds}`);this._clearSource(kn)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const kn in this._updatedPaintProps)this._layers[kn].updateTransitions(m);this.light.updateTransitions(m),this._resetUpdates()}const Ee={};for(const ct in this.sourceCaches){const or=this.sourceCaches[ct];Ee[ct]=or.used,or.used=!1}for(const ct of this._order){const or=this._layers[ct];or.recalculate(m,this._availableImages),!or.isHidden(m.zoom)&&or.source&&(this.sourceCaches[or.source].used=!0)}for(const ct in Ee){const or=this.sourceCaches[ct];Ee[ct]!==or.used&&or.fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:ct}))}this.light.recalculate(m),this.z=m.zoom,D&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const m=Object.keys(this._changedImages);if(m.length){for(const D in this.sourceCaches)this.sourceCaches[D].reloadTilesForDependencies(["icons","patterns"],m);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const m in this.sourceCaches)this.sourceCaches[m].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(m,D){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(m),removedIds:D})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(m,D={}){this._checkLoaded();const Ee=this.serialize();if(m=D.transformStyle?D.transformStyle(Ee,m):m,hp(this,a.validateStyle(m)))return!1;(m=a.clone$1(m)).layers=a.derefLayers(m.layers);const ct=a.diffStyles(Ee,m).filter(kn=>!(kn.command in xg));if(ct.length===0)return!1;const or=ct.filter(kn=>!(kn.command in gy));if(or.length>0)throw new Error(`Unimplemented: ${or.map(kn=>kn.command).join(", ")}.`);for(const kn of ct)kn.command!=="setTransition"&&this[kn.command].apply(this,kn.args);return this.stylesheet=m,!0}addImage(m,D){if(this.getImage(m))return this.fire(new a.ErrorEvent(new Error(`An image named "${m}" already exists.`)));this.imageManager.addImage(m,D),this._afterImageUpdated(m)}updateImage(m,D){this.imageManager.updateImage(m,D)}getImage(m){return this.imageManager.getImage(m)}removeImage(m){if(!this.getImage(m))return this.fire(new a.ErrorEvent(new Error(`An image named "${m}" does not exist.`)));this.imageManager.removeImage(m),this._afterImageUpdated(m)}_afterImageUpdated(m){this._availableImages=this.imageManager.listImages(),this._changedImages[m]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(m,D,Ee={}){if(this._checkLoaded(),this.sourceCaches[m]!==void 0)throw new Error(`Source "${m}" already exists.`);if(!D.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(D).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(D.type)>=0&&this._validate(a.validateStyle.source,`sources.${m}`,D,null,Ee))return;this.map&&this.map._collectResourceTiming&&(D.collectResourceTiming=!0);const ct=this.sourceCaches[m]=new yd(m,D,this.dispatcher);ct.style=this,ct.setEventedParent(this,()=>({isSourceLoaded:ct.loaded(),source:ct.serialize(),sourceId:m})),ct.onAdd(this.map),this._changed=!0}removeSource(m){if(this._checkLoaded(),this.sourceCaches[m]===void 0)throw new Error("There is no source with this ID");for(const Ee in this._layers)if(this._layers[Ee].source===m)return this.fire(new a.ErrorEvent(new Error(`Source "${m}" cannot be removed while layer "${Ee}" is using it.`)));const D=this.sourceCaches[m];delete this.sourceCaches[m],delete this._updatedSources[m],D.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:m})),D.setEventedParent(null),D.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(m,D){if(this._checkLoaded(),this.sourceCaches[m]===void 0)throw new Error(`There is no source with this ID=${m}`);const Ee=this.sourceCaches[m].getSource();if(Ee.type!=="geojson")throw new Error(`geojsonSource.type is ${Ee.type}, which is !== 'geojson`);Ee.setData(D),this._changed=!0}getSource(m){return this.sourceCaches[m]&&this.sourceCaches[m].getSource()}addLayer(m,D,Ee={}){this._checkLoaded();const ct=m.id;if(this.getLayer(ct))return void this.fire(new a.ErrorEvent(new Error(`Layer "${ct}" already exists on this map.`)));let or;if(m.type==="custom"){if(hp(this,a.validateCustomStyleLayer(m)))return;or=a.createStyleLayer(m)}else{if(typeof m.source=="object"&&(this.addSource(ct,m.source),m=a.clone$1(m),m=a.extend(m,{source:ct})),this._validate(a.validateStyle.layer,`layers.${ct}`,m,{arrayIndex:-1},Ee))return;or=a.createStyleLayer(m),this._validateLayer(or),or.setEventedParent(this,{layer:{id:ct}})}const kn=D?this._order.indexOf(D):this._order.length;if(D&&kn===-1)this.fire(new a.ErrorEvent(new Error(`Cannot add layer "${ct}" before non-existing layer "${D}".`)));else{if(this._order.splice(kn,0,ct),this._layerOrderChanged=!0,this._layers[ct]=or,this._removedLayers[ct]&&or.source&&or.type!=="custom"){const ds=this._removedLayers[ct];delete this._removedLayers[ct],ds.type!==or.type?this._updatedSources[or.source]="clear":(this._updatedSources[or.source]="reload",this.sourceCaches[or.source].pause())}this._updateLayer(or),or.onAdd&&or.onAdd(this.map)}}moveLayer(m,D){if(this._checkLoaded(),this._changed=!0,!this._layers[m])return void this.fire(new a.ErrorEvent(new Error(`The layer '${m}' does not exist in the map's style and cannot be moved.`)));if(m===D)return;const Ee=this._order.indexOf(m);this._order.splice(Ee,1);const ct=D?this._order.indexOf(D):this._order.length;D&&ct===-1?this.fire(new a.ErrorEvent(new Error(`Cannot move layer "${m}" before non-existing layer "${D}".`))):(this._order.splice(ct,0,m),this._layerOrderChanged=!0)}removeLayer(m){this._checkLoaded();const D=this._layers[m];if(!D)return void this.fire(new a.ErrorEvent(new Error(`Cannot remove non-existing layer "${m}".`)));D.setEventedParent(null);const Ee=this._order.indexOf(m);this._order.splice(Ee,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[m]=D,delete this._layers[m],this._serializedLayers&&delete this._serializedLayers[m],delete this._updatedLayers[m],delete this._updatedPaintProps[m],D.onRemove&&D.onRemove(this.map)}getLayer(m){return this._layers[m]}hasLayer(m){return m in this._layers}setLayerZoomRange(m,D,Ee){this._checkLoaded();const ct=this.getLayer(m);ct?ct.minzoom===D&&ct.maxzoom===Ee||(D!=null&&(ct.minzoom=D),Ee!=null&&(ct.maxzoom=Ee),this._updateLayer(ct)):this.fire(new a.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${m}".`)))}setFilter(m,D,Ee={}){this._checkLoaded();const ct=this.getLayer(m);if(ct){if(!a.deepEqual(ct.filter,D))return D==null?(ct.filter=void 0,void this._updateLayer(ct)):void(this._validate(a.validateStyle.filter,`layers.${ct.id}.filter`,D,null,Ee)||(ct.filter=a.clone$1(D),this._updateLayer(ct)))}else this.fire(new a.ErrorEvent(new Error(`Cannot filter non-existing layer "${m}".`)))}getFilter(m){return a.clone$1(this.getLayer(m).filter)}setLayoutProperty(m,D,Ee,ct={}){this._checkLoaded();const or=this.getLayer(m);or?a.deepEqual(or.getLayoutProperty(D),Ee)||(or.setLayoutProperty(D,Ee,ct),this._updateLayer(or)):this.fire(new a.ErrorEvent(new Error(`Cannot style non-existing layer "${m}".`)))}getLayoutProperty(m,D){const Ee=this.getLayer(m);if(Ee)return Ee.getLayoutProperty(D);this.fire(new a.ErrorEvent(new Error(`Cannot get style of non-existing layer "${m}".`)))}setPaintProperty(m,D,Ee,ct={}){this._checkLoaded();const or=this.getLayer(m);or?a.deepEqual(or.getPaintProperty(D),Ee)||(or.setPaintProperty(D,Ee,ct)&&this._updateLayer(or),this._changed=!0,this._updatedPaintProps[m]=!0):this.fire(new a.ErrorEvent(new Error(`Cannot style non-existing layer "${m}".`)))}getPaintProperty(m,D){return this.getLayer(m).getPaintProperty(D)}setFeatureState(m,D){this._checkLoaded();const Ee=m.source,ct=m.sourceLayer,or=this.sourceCaches[Ee];if(or===void 0)return void this.fire(new a.ErrorEvent(new Error(`The source '${Ee}' does not exist in the map's style.`)));const kn=or.getSource().type;kn==="geojson"&&ct?this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):kn!=="vector"||ct?(m.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),or.setFeatureState(ct,m.id,D)):this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(m,D){this._checkLoaded();const Ee=m.source,ct=this.sourceCaches[Ee];if(ct===void 0)return void this.fire(new a.ErrorEvent(new Error(`The source '${Ee}' does not exist in the map's style.`)));const or=ct.getSource().type,kn=or==="vector"?m.sourceLayer:void 0;or!=="vector"||kn?D&&typeof m.id!="string"&&typeof m.id!="number"?this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):ct.removeFeatureState(kn,m.id,D):this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(m){this._checkLoaded();const D=m.source,Ee=m.sourceLayer,ct=this.sourceCaches[D];if(ct!==void 0)return ct.getSource().type!=="vector"||Ee?(m.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),ct.getFeatureState(Ee,m.id)):void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.ErrorEvent(new Error(`The source '${D}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const m=a.mapObject(this.sourceCaches,ct=>ct.serialize()),D=this._serializeByIds(this._order),Ee=this.stylesheet;return a.filterObject({version:Ee.version,name:Ee.name,metadata:Ee.metadata,light:Ee.light,center:Ee.center,zoom:Ee.zoom,bearing:Ee.bearing,pitch:Ee.pitch,sprite:Ee.sprite,glyphs:Ee.glyphs,transition:Ee.transition,sources:m,layers:D},ct=>ct!==void 0)}_updateLayer(m){this._updatedLayers[m.id]=!0,m.source&&!this._updatedSources[m.source]&&this.sourceCaches[m.source].getSource().type!=="raster"&&(this._updatedSources[m.source]="reload",this.sourceCaches[m.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(m){const D=kn=>this._layers[kn].type==="fill-extrusion",Ee={},ct=[];for(let kn=this._order.length-1;kn>=0;kn--){const ds=this._order[kn];if(D(ds)){Ee[ds]=kn;for(const ps of m){const vs=ps[ds];if(vs)for(const fl of vs)ct.push(fl)}}}ct.sort((kn,ds)=>ds.intersectionZ-kn.intersectionZ);const or=[];for(let kn=this._order.length-1;kn>=0;kn--){const ds=this._order[kn];if(D(ds))for(let ps=ct.length-1;ps>=0;ps--){const vs=ct[ps].feature;if(Ee[vs.layer.id]<kn)break;or.push(vs),ct.pop()}else for(const ps of m){const vs=ps[ds];if(vs)for(const fl of vs)or.push(fl.feature)}}return or}queryRenderedFeatures(m,D,Ee){D&&D.filter&&this._validate(a.validateStyle.filter,"queryRenderedFeatures.filter",D.filter,null,D);const ct={};if(D&&D.layers){if(!Array.isArray(D.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const ds of D.layers){const ps=this._layers[ds];if(!ps)return this.fire(new a.ErrorEvent(new Error(`The layer '${ds}' does not exist in the map's style and cannot be queried for features.`))),[];ct[ps.source]=!0}}const or=[];D.availableImages=this._availableImages;const kn=this._serializedAllLayers();for(const ds in this.sourceCaches)D.layers&&!ct[ds]||or.push(cd(this.sourceCaches[ds],this._layers,kn,m,D,Ee));return this.placement&&or.push(function(ds,ps,vs,fl,pl,ph,Ah){const hh={},Rh=ph.queryRenderedSymbols(fl),Gh=[];for(const Kh of Object.keys(Rh).map(Number))Gh.push(Ah[Kh]);Gh.sort(id);for(const Kh of Gh){const ap=Kh.featureIndex.lookupSymbolFeatures(Rh[Kh.bucketInstanceId],ps,Kh.bucketIndex,Kh.sourceLayerIndex,pl.filter,pl.layers,pl.availableImages,ds);for(const Lh in ap){const op=hh[Lh]=hh[Lh]||[],yp=ap[Lh];yp.sort((Np,jp)=>{const td=Kh.featureSortOrder;if(td){const Vp=td.indexOf(Np.featureIndex);return td.indexOf(jp.featureIndex)-Vp}return jp.featureIndex-Np.featureIndex});for(const Np of yp)op.push(Np)}}for(const Kh in hh)hh[Kh].forEach(ap=>{const Lh=ap.feature,op=vs[ds[Kh].source].getFeatureState(Lh.layer["source-layer"],Lh.id);Lh.source=Lh.layer.source,Lh.layer["source-layer"]&&(Lh.sourceLayer=Lh.layer["source-layer"]),Lh.state=op});return hh}(this._layers,kn,this.sourceCaches,m,D,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(or)}querySourceFeatures(m,D){D&&D.filter&&this._validate(a.validateStyle.filter,"querySourceFeatures.filter",D.filter,null,D);const Ee=this.sourceCaches[m];return Ee?function(ct,or){const kn=ct.getRenderableIds().map(vs=>ct.getTileByID(vs)),ds=[],ps={};for(let vs=0;vs<kn.length;vs++){const fl=kn[vs],pl=fl.tileID.canonical.key;ps[pl]||(ps[pl]=!0,fl.querySourceFeatures(ds,or))}return ds}(Ee,D):[]}addSourceType(m,D,Ee){return xm.getSourceType(m)?Ee(new Error(`A source type called "${m}" already exists.`)):(xm.setSourceType(m,D),D.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:m,url:D.workerSourceURL},Ee):Ee(null,null))}getLight(){return this.light.getLight()}setLight(m,D={}){this._checkLoaded();const Ee=this.light.getLight();let ct=!1;for(const kn in m)if(!a.deepEqual(m[kn],Ee[kn])){ct=!0;break}if(!ct)return;const or={now:a.exported.now(),transition:a.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(m,D),this.light.updateTransitions(or)}_validate(m,D,Ee,ct,or={}){return(!or||or.validate!==!1)&&hp(this,m.call(a.validateStyle,a.extend({key:D,style:this.serialize(),value:Ee,styleSpec:a.v8Spec},ct)))}_remove(m=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const D in this._layers)this._layers[D].setEventedParent(null);for(const D in this.sourceCaches){const Ee=this.sourceCaches[D];Ee.setEventedParent(null),Ee.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(m)}_clearSource(m){this.sourceCaches[m].clearTiles()}_reloadSource(m){this.sourceCaches[m].resume(),this.sourceCaches[m].reload()}_updateSources(m){for(const D in this.sourceCaches)this.sourceCaches[D].update(m,this.map.terrain)}_generateCollisionBoxes(){for(const m in this.sourceCaches)this._reloadSource(m)}_updatePlacement(m,D,Ee,ct,or=!1){let kn=!1,ds=!1;const ps={};for(const vs of this._order){const fl=this._layers[vs];if(fl.type!=="symbol")continue;if(!ps[fl.source]){const ph=this.sourceCaches[fl.source];ps[fl.source]=ph.getRenderableIds(!0).map(Ah=>ph.getTileByID(Ah)).sort((Ah,hh)=>hh.tileID.overscaledZ-Ah.tileID.overscaledZ||(Ah.tileID.isLessThan(hh.tileID)?-1:1))}const pl=this.crossTileSymbolIndex.addLayer(fl,ps[fl.source],m.center.lng);kn=kn||pl}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((or=or||this._layerOrderChanged||Ee===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),m.zoom))&&(this.pauseablePlacement=new nm(m,this.map.terrain,this._order,or,D,Ee,ct,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,ps),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),ds=!0),kn&&this.pauseablePlacement.placement.setStale()),ds||kn)for(const vs of this._order){const fl=this._layers[vs];fl.type==="symbol"&&this.placement.updateLayerOpacities(fl,ps[fl.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const m in this.sourceCaches)this.sourceCaches[m].releaseSymbolFadeTiles()}getImages(m,D,Ee){this.imageManager.getImages(D.icons,Ee),this._updateTilesForChangedImages();const ct=this.sourceCaches[D.source];ct&&ct.setDependencies(D.tileID.key,D.type,D.icons)}getGlyphs(m,D,Ee){this.glyphManager.getGlyphs(D.stacks,Ee);const ct=this.sourceCaches[D.source];ct&&ct.setDependencies(D.tileID.key,D.type,[""])}getResource(m,D,Ee){return a.makeRequest(D,Ee)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(m,D={}){this._checkLoaded(),m&&this._validate(a.validateStyle.glyphs,"glyphs",m,null,D)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=m,this.glyphManager.entries={},this.glyphManager.setURL(m))}addSprite(m,D,Ee={},ct){this._checkLoaded();const or=[{id:m,url:D}],kn=[...sl(this.stylesheet.sprite),...or];this._validate(a.validateStyle.sprite,"sprite",kn,null,Ee)||(this.stylesheet.sprite=kn,this._loadSprite(or,!0,ct))}removeSprite(m){this._checkLoaded();const D=sl(this.stylesheet.sprite);if(D.find(Ee=>Ee.id===m)){if(this._spritesImagesIds[m])for(const Ee of this._spritesImagesIds[m])this.imageManager.removeImage(Ee),this._changedImages[Ee]=!0;D.splice(D.findIndex(Ee=>Ee.id===m),1),this.stylesheet.sprite=D.length>0?D:void 0,delete this._spritesImagesIds[m],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}else this.fire(new a.ErrorEvent(new Error(`Sprite "${m}" doesn't exists on this map.`)))}getSprite(){return sl(this.stylesheet.sprite)}setSprite(m,D={},Ee){this._checkLoaded(),m&&this._validate(a.validateStyle.sprite,"sprite",m,null,D)||(this.stylesheet.sprite=m,m?this._loadSprite(m,!0,Ee):(this._unloadSprite(),Ee&&Ee(null)))}}xm.getSourceType=function(ot){return Ap[ot]},xm.setSourceType=function(ot,m){Ap[ot]=m},xm.registerForPluginStateChange=a.registerForPluginStateChange;var my=a.createLayout([{name:"a_pos",type:"Int16",components:2}]),wv="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const qy={prelude:lg(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:lg(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:lg(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:lg(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:lg("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:lg(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:lg(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:lg("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:lg("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:lg("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:lg(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:lg(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:lg(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:lg(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:lg(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:lg(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:lg(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:lg(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:lg(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:lg(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:lg(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:lg(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:lg(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:lg(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:lg(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:lg(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:lg("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",wv),terrainDepth:lg("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",wv),terrainCoords:lg("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",wv)};function lg(ot,m){const D=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,Ee=m.match(/attribute ([\w]+) ([\w]+)/g),ct=ot.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),or=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),kn=or?or.concat(ct):ct,ds={};return{fragmentSource:ot=ot.replace(D,(ps,vs,fl,pl,ph)=>(ds[ph]=!0,vs==="define"?`
#ifndef HAS_UNIFORM_u_${ph}
varying ${fl} ${pl} ${ph};
#else
uniform ${fl} ${pl} u_${ph};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ph}
    ${fl} ${pl} ${ph} = u_${ph};
#endif
`)),vertexSource:m=m.replace(D,(ps,vs,fl,pl,ph)=>{const Ah=pl==="float"?"vec2":"vec4",hh=ph.match(/color/)?"color":Ah;return ds[ph]?vs==="define"?`
#ifndef HAS_UNIFORM_u_${ph}
uniform lowp float u_${ph}_t;
attribute ${fl} ${Ah} a_${ph};
varying ${fl} ${pl} ${ph};
#else
uniform ${fl} ${pl} u_${ph};
#endif
`:hh==="vec4"?`
#ifndef HAS_UNIFORM_u_${ph}
    ${ph} = a_${ph};
#else
    ${fl} ${pl} ${ph} = u_${ph};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ph}
    ${ph} = unpack_mix_${hh}(a_${ph}, u_${ph}_t);
#else
    ${fl} ${pl} ${ph} = u_${ph};
#endif
`:vs==="define"?`
#ifndef HAS_UNIFORM_u_${ph}
uniform lowp float u_${ph}_t;
attribute ${fl} ${Ah} a_${ph};
#else
uniform ${fl} ${pl} u_${ph};
#endif
`:hh==="vec4"?`
#ifndef HAS_UNIFORM_u_${ph}
    ${fl} ${pl} ${ph} = a_${ph};
#else
    ${fl} ${pl} ${ph} = u_${ph};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ph}
    ${fl} ${pl} ${ph} = unpack_mix_${hh}(a_${ph}, u_${ph}_t);
#else
    ${fl} ${pl} ${ph} = u_${ph};
#endif
`}),staticAttributes:Ee,staticUniforms:kn}}class ad{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(m,D,Ee,ct,or,kn,ds,ps,vs){this.context=m;let fl=this.boundPaintVertexBuffers.length!==ct.length;for(let pl=0;!fl&&pl<ct.length;pl++)this.boundPaintVertexBuffers[pl]!==ct[pl]&&(fl=!0);!this.vao||this.boundProgram!==D||this.boundLayoutVertexBuffer!==Ee||fl||this.boundIndexBuffer!==or||this.boundVertexOffset!==kn||this.boundDynamicVertexBuffer!==ds||this.boundDynamicVertexBuffer2!==ps||this.boundDynamicVertexBuffer3!==vs?this.freshBind(D,Ee,ct,or,kn,ds,ps,vs):(m.bindVertexArray.set(this.vao),ds&&ds.bind(),or&&or.dynamicDraw&&or.bind(),ps&&ps.bind(),vs&&vs.bind())}freshBind(m,D,Ee,ct,or,kn,ds,ps){const vs=m.numAttributes,fl=this.context,pl=fl.gl;this.vao&&this.destroy(),this.vao=fl.createVertexArray(),fl.bindVertexArray.set(this.vao),this.boundProgram=m,this.boundLayoutVertexBuffer=D,this.boundPaintVertexBuffers=Ee,this.boundIndexBuffer=ct,this.boundVertexOffset=or,this.boundDynamicVertexBuffer=kn,this.boundDynamicVertexBuffer2=ds,this.boundDynamicVertexBuffer3=ps,D.enableAttributes(pl,m);for(const ph of Ee)ph.enableAttributes(pl,m);kn&&kn.enableAttributes(pl,m),ds&&ds.enableAttributes(pl,m),ps&&ps.enableAttributes(pl,m),D.bind(),D.setVertexAttribPointers(pl,m,or);for(const ph of Ee)ph.bind(),ph.setVertexAttribPointers(pl,m,or);kn&&(kn.bind(),kn.setVertexAttribPointers(pl,m,or)),ct&&ct.bind(),ds&&(ds.bind(),ds.setVertexAttribPointers(pl,m,or)),ps&&(ps.bind(),ps.setVertexAttribPointers(pl,m,or)),fl.currentNumAttributes=vs}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function qf(ot){const m=[];for(let D=0;D<ot.length;D++){if(ot[D]===null)continue;const Ee=ot[D].split(" ");m.push(Ee.pop())}return m}class Hf{constructor(m,D,Ee,ct,or,kn,ds){const ps=m.gl;this.program=ps.createProgram();const vs=qf(Ee.staticAttributes),fl=ct?ct.getBinderAttributes():[],pl=vs.concat(fl),ph=qy.prelude.staticUniforms?qf(qy.prelude.staticUniforms):[],Ah=Ee.staticUniforms?qf(Ee.staticUniforms):[],hh=ct?ct.getBinderUniforms():[],Rh=ph.concat(Ah).concat(hh),Gh=[];for(const jp of Rh)Gh.indexOf(jp)<0&&Gh.push(jp);const Kh=ct?ct.defines():[];kn&&Kh.push("#define OVERDRAW_INSPECTOR;"),ds&&Kh.push("#define TERRAIN3D;");const ap=Kh.concat(qy.prelude.fragmentSource,Ee.fragmentSource).join(`
`),Lh=Kh.concat(qy.prelude.vertexSource,Ee.vertexSource).join(`
`),op=ps.createShader(ps.FRAGMENT_SHADER);if(ps.isContextLost())return void(this.failedToCreate=!0);ps.shaderSource(op,ap),ps.compileShader(op),ps.attachShader(this.program,op);const yp=ps.createShader(ps.VERTEX_SHADER);if(ps.isContextLost())return void(this.failedToCreate=!0);ps.shaderSource(yp,Lh),ps.compileShader(yp),ps.attachShader(this.program,yp),this.attributes={};const Np={};this.numAttributes=pl.length;for(let jp=0;jp<this.numAttributes;jp++)pl[jp]&&(ps.bindAttribLocation(this.program,jp,pl[jp]),this.attributes[pl[jp]]=jp);ps.linkProgram(this.program),ps.deleteShader(yp),ps.deleteShader(op);for(let jp=0;jp<Gh.length;jp++){const td=Gh[jp];if(td&&!Np[td]){const Vp=ps.getUniformLocation(this.program,td);Vp&&(Np[td]=Vp)}}this.fixedUniforms=or(m,Np),this.terrainUniforms=((jp,td)=>({u_depth:new a.Uniform1i(jp,td.u_depth),u_terrain:new a.Uniform1i(jp,td.u_terrain),u_terrain_dim:new a.Uniform1f(jp,td.u_terrain_dim),u_terrain_matrix:new a.UniformMatrix4f(jp,td.u_terrain_matrix),u_terrain_unpack:new a.Uniform4f(jp,td.u_terrain_unpack),u_terrain_exaggeration:new a.Uniform1f(jp,td.u_terrain_exaggeration)}))(m,Np),this.binderUniforms=ct?ct.getUniforms(m,Np):[]}draw(m,D,Ee,ct,or,kn,ds,ps,vs,fl,pl,ph,Ah,hh,Rh,Gh,Kh,ap){const Lh=m.gl;if(this.failedToCreate)return;if(m.program.set(this.program),m.setDepthMode(Ee),m.setStencilMode(ct),m.setColorMode(or),m.setCullFace(kn),ps){m.activeTexture.set(Lh.TEXTURE2),Lh.bindTexture(Lh.TEXTURE_2D,ps.depthTexture),m.activeTexture.set(Lh.TEXTURE3),Lh.bindTexture(Lh.TEXTURE_2D,ps.texture);for(const yp in this.terrainUniforms)this.terrainUniforms[yp].set(ps[yp])}for(const yp in this.fixedUniforms)this.fixedUniforms[yp].set(ds[yp]);Rh&&Rh.setUniforms(m,this.binderUniforms,Ah,{zoom:hh});let op=0;switch(D){case Lh.LINES:op=2;break;case Lh.TRIANGLES:op=3;break;case Lh.LINE_STRIP:op=1}for(const yp of ph.get()){const Np=yp.vaos||(yp.vaos={});(Np[vs]||(Np[vs]=new ad)).bind(m,this,fl,Rh?Rh.getPaintVertexBuffers():[],pl,yp.vertexOffset,Gh,Kh,ap),Lh.drawElements(D,yp.primitiveLength*op,Lh.UNSIGNED_SHORT,yp.primitiveOffset*op*2)}}}function Wm(ot,m,D){const Ee=1/vh(D,1,m.transform.tileZoom),ct=Math.pow(2,D.tileID.overscaledZ),or=D.tileSize*Math.pow(2,m.transform.tileZoom)/ct,kn=or*(D.tileID.canonical.x+D.tileID.wrap*ct),ds=or*D.tileID.canonical.y;return{u_image:0,u_texsize:D.imageAtlasTexture.size,u_scale:[Ee,ot.fromScale,ot.toScale],u_fade:ot.t,u_pixel_coord_upper:[kn>>16,ds>>16],u_pixel_coord_lower:[65535&kn,65535&ds]}}const yy=(ot,m,D,Ee)=>{const ct=m.style.light,or=ct.properties.get("position"),kn=[or.x,or.y,or.z],ds=function(){var vs=new a.ARRAY_TYPE(9);return a.ARRAY_TYPE!=Float32Array&&(vs[1]=0,vs[2]=0,vs[3]=0,vs[5]=0,vs[6]=0,vs[7]=0),vs[0]=1,vs[4]=1,vs[8]=1,vs}();ct.properties.get("anchor")==="viewport"&&function(vs,fl){var pl=Math.sin(fl),ph=Math.cos(fl);vs[0]=ph,vs[1]=pl,vs[2]=0,vs[3]=-pl,vs[4]=ph,vs[5]=0,vs[6]=0,vs[7]=0,vs[8]=1}(ds,-m.transform.angle),function(vs,fl,pl){var ph=fl[0],Ah=fl[1],hh=fl[2];vs[0]=ph*pl[0]+Ah*pl[3]+hh*pl[6],vs[1]=ph*pl[1]+Ah*pl[4]+hh*pl[7],vs[2]=ph*pl[2]+Ah*pl[5]+hh*pl[8]}(kn,kn,ds);const ps=ct.properties.get("color");return{u_matrix:ot,u_lightpos:kn,u_lightintensity:ct.properties.get("intensity"),u_lightcolor:[ps.r,ps.g,ps.b],u_vertical_gradient:+D,u_opacity:Ee}},Kf=(ot,m,D,Ee,ct,or,kn)=>a.extend(yy(ot,m,D,Ee),Wm(or,m,kn),{u_height_factor:-Math.pow(2,ct.overscaledZ)/kn.tileSize/8}),qm=ot=>({u_matrix:ot}),k_=(ot,m,D,Ee)=>a.extend(qm(ot),Wm(D,m,Ee)),B_=(ot,m)=>({u_matrix:ot,u_world:m}),ay=(ot,m,D,Ee,ct)=>a.extend(k_(ot,m,D,Ee),{u_world:ct}),Og=(ot,m,D,Ee)=>{const ct=ot.transform;let or,kn;if(Ee.paint.get("circle-pitch-alignment")==="map"){const ds=vh(D,1,ct.zoom);or=!0,kn=[ds,ds]}else or=!1,kn=ct.pixelsToGLUnits;return{u_camera_to_center_distance:ct.cameraToCenterDistance,u_scale_with_map:+(Ee.paint.get("circle-pitch-scale")==="map"),u_matrix:ot.translatePosMatrix(m.posMatrix,D,Ee.paint.get("circle-translate"),Ee.paint.get("circle-translate-anchor")),u_pitch_with_map:+or,u_device_pixel_ratio:ot.pixelRatio,u_extrude_scale:kn}},B0=(ot,m,D)=>{const Ee=vh(D,1,m.zoom),ct=Math.pow(2,m.zoom-D.tileID.overscaledZ),or=D.tileID.overscaleFactor();return{u_matrix:ot,u_camera_to_center_distance:m.cameraToCenterDistance,u_pixels_to_tile_units:Ee,u_extrude_scale:[m.pixelsToGLUnits[0]/(Ee*ct),m.pixelsToGLUnits[1]/(Ee*ct)],u_overscale_factor:or}},Ey=(ot,m,D=1)=>({u_matrix:ot,u_color:m,u_overlay:0,u_overlay_scale:D}),z_=ot=>({u_matrix:ot}),bv=(ot,m,D,Ee)=>({u_matrix:ot,u_extrude_scale:vh(m,1,D),u_intensity:Ee});function z0(ot,m){const D=Math.pow(2,m.canonical.z),Ee=m.canonical.y;return[new a.MercatorCoordinate(0,Ee/D).toLngLat().lat,new a.MercatorCoordinate(0,(Ee+1)/D).toLngLat().lat]}const Ly=(ot,m,D,Ee)=>{const ct=ot.transform;return{u_matrix:pm(ot,m,D,Ee),u_ratio:1/vh(m,1,ct.zoom),u_device_pixel_ratio:ot.pixelRatio,u_units_to_pixels:[1/ct.pixelsToGLUnits[0],1/ct.pixelsToGLUnits[1]]}},c_=(ot,m,D,Ee,ct)=>a.extend(Ly(ot,m,D,ct),{u_image:0,u_image_height:Ee}),Fm=(ot,m,D,Ee,ct)=>{const or=ot.transform,kn=Fy(m,or);return{u_matrix:pm(ot,m,D,ct),u_texsize:m.imageAtlasTexture.size,u_ratio:1/vh(m,1,or.zoom),u_device_pixel_ratio:ot.pixelRatio,u_image:0,u_scale:[kn,Ee.fromScale,Ee.toScale],u_fade:Ee.t,u_units_to_pixels:[1/or.pixelsToGLUnits[0],1/or.pixelsToGLUnits[1]]}},G_=(ot,m,D,Ee,ct,or)=>{const kn=ot.lineAtlas,ds=Fy(m,ot.transform),ps=D.layout.get("line-cap")==="round",vs=kn.getDash(Ee.from,ps),fl=kn.getDash(Ee.to,ps),pl=vs.width*ct.fromScale,ph=fl.width*ct.toScale;return a.extend(Ly(ot,m,D,or),{u_patternscale_a:[ds/pl,-vs.height/2],u_patternscale_b:[ds/ph,-fl.height/2],u_sdfgamma:kn.width/(256*Math.min(pl,ph)*ot.pixelRatio)/2,u_image:0,u_tex_y_a:vs.y,u_tex_y_b:fl.y,u_mix:ct.t})};function Fy(ot,m){return 1/vh(ot,1,m.tileZoom)}function pm(ot,m,D,Ee){return ot.translatePosMatrix(Ee?Ee.posMatrix:m.tileID.posMatrix,m,D.paint.get("line-translate"),D.paint.get("line-translate-anchor"))}const zg=(ot,m,D,Ee,ct)=>{return{u_matrix:ot,u_tl_parent:m,u_scale_parent:D,u_buffer_scale:1,u_fade_t:Ee.mix,u_opacity:Ee.opacity*ct.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:ct.paint.get("raster-brightness-min"),u_brightness_high:ct.paint.get("raster-brightness-max"),u_saturation_factor:(kn=ct.paint.get("raster-saturation"),kn>0?1-1/(1.001-kn):-kn),u_contrast_factor:(or=ct.paint.get("raster-contrast"),or>0?1/(1-or):1+or),u_spin_weights:Cv(ct.paint.get("raster-hue-rotate"))};var or,kn};function Cv(ot){ot*=Math.PI/180;const m=Math.sin(ot),D=Math.cos(ot);return[(2*D+1)/3,(-Math.sqrt(3)*m-D+1)/3,(Math.sqrt(3)*m-D+1)/3]}const h_=(ot,m,D,Ee,ct,or,kn,ds,ps,vs)=>{const fl=ct.transform;return{u_is_size_zoom_constant:+(ot==="constant"||ot==="source"),u_is_size_feature_constant:+(ot==="constant"||ot==="camera"),u_size_t:m?m.uSizeT:0,u_size:m?m.uSize:0,u_camera_to_center_distance:fl.cameraToCenterDistance,u_pitch:fl.pitch/360*2*Math.PI,u_rotate_symbol:+D,u_aspect_ratio:fl.width/fl.height,u_fade_change:ct.options.fadeDuration?ct.symbolFadeChange:1,u_matrix:or,u_label_plane_matrix:kn,u_coord_matrix:ds,u_is_text:+ps,u_pitch_with_map:+Ee,u_texsize:vs,u_texture:0}},dm=(ot,m,D,Ee,ct,or,kn,ds,ps,vs,fl)=>{const pl=ct.transform;return a.extend(h_(ot,m,D,Ee,ct,or,kn,ds,ps,vs),{u_gamma_scale:Ee?Math.cos(pl._pitch)*pl.cameraToCenterDistance:1,u_device_pixel_ratio:ct.pixelRatio,u_is_halo:+fl})},Vm=(ot,m,D,Ee,ct,or,kn,ds,ps,vs)=>a.extend(dm(ot,m,D,Ee,ct,or,kn,ds,!0,ps,!0),{u_texsize_icon:vs,u_texture_icon:1}),Km=(ot,m,D)=>({u_matrix:ot,u_opacity:m,u_color:D}),Em=(ot,m,D,Ee,ct,or)=>a.extend(function(kn,ds,ps,vs){const fl=ps.imageManager.getPattern(kn.from.toString()),pl=ps.imageManager.getPattern(kn.to.toString()),{width:ph,height:Ah}=ps.imageManager.getPixelSize(),hh=Math.pow(2,vs.tileID.overscaledZ),Rh=vs.tileSize*Math.pow(2,ps.transform.tileZoom)/hh,Gh=Rh*(vs.tileID.canonical.x+vs.tileID.wrap*hh),Kh=Rh*vs.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:fl.tl,u_pattern_br_a:fl.br,u_pattern_tl_b:pl.tl,u_pattern_br_b:pl.br,u_texsize:[ph,Ah],u_mix:ds.t,u_pattern_size_a:fl.displaySize,u_pattern_size_b:pl.displaySize,u_scale_a:ds.fromScale,u_scale_b:ds.toScale,u_tile_units_to_pixels:1/vh(vs,1,ps.transform.tileZoom),u_pixel_coord_upper:[Gh>>16,Kh>>16],u_pixel_coord_lower:[65535&Gh,65535&Kh]}}(Ee,or,D,ct),{u_matrix:ot,u_opacity:m}),Gg={fillExtrusion:(ot,m)=>({u_matrix:new a.UniformMatrix4f(ot,m.u_matrix),u_lightpos:new a.Uniform3f(ot,m.u_lightpos),u_lightintensity:new a.Uniform1f(ot,m.u_lightintensity),u_lightcolor:new a.Uniform3f(ot,m.u_lightcolor),u_vertical_gradient:new a.Uniform1f(ot,m.u_vertical_gradient),u_opacity:new a.Uniform1f(ot,m.u_opacity)}),fillExtrusionPattern:(ot,m)=>({u_matrix:new a.UniformMatrix4f(ot,m.u_matrix),u_lightpos:new a.Uniform3f(ot,m.u_lightpos),u_lightintensity:new a.Uniform1f(ot,m.u_lightintensity),u_lightcolor:new a.Uniform3f(ot,m.u_lightcolor),u_vertical_gradient:new a.Uniform1f(ot,m.u_vertical_gradient),u_height_factor:new a.Uniform1f(ot,m.u_height_factor),u_image:new a.Uniform1i(ot,m.u_image),u_texsize:new a.Uniform2f(ot,m.u_texsize),u_pixel_coord_upper:new a.Uniform2f(ot,m.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(ot,m.u_pixel_coord_lower),u_scale:new a.Uniform3f(ot,m.u_scale),u_fade:new a.Uniform1f(ot,m.u_fade),u_opacity:new a.Uniform1f(ot,m.u_opacity)}),fill:(ot,m)=>({u_matrix:new a.UniformMatrix4f(ot,m.u_matrix)}),fillPattern:(ot,m)=>({u_matrix:new a.UniformMatrix4f(ot,m.u_matrix),u_image:new a.Uniform1i(ot,m.u_image),u_texsize:new a.Uniform2f(ot,m.u_texsize),u_pixel_coord_upper:new a.Uniform2f(ot,m.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(ot,m.u_pixel_coord_lower),u_scale:new a.Uniform3f(ot,m.u_scale),u_fade:new a.Uniform1f(ot,m.u_fade)}),fillOutline:(ot,m)=>({u_matrix:new a.UniformMatrix4f(ot,m.u_matrix),u_world:new a.Uniform2f(ot,m.u_world)}),fillOutlinePattern:(ot,m)=>({u_matrix:new a.UniformMatrix4f(ot,m.u_matrix),u_world:new a.Uniform2f(ot,m.u_world),u_image:new a.Uniform1i(ot,m.u_image),u_texsize:new a.Uniform2f(ot,m.u_texsize),u_pixel_coord_upper:new a.Uniform2f(ot,m.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(ot,m.u_pixel_coord_lower),u_scale:new a.Uniform3f(ot,m.u_scale),u_fade:new a.Uniform1f(ot,m.u_fade)}),circle:(ot,m)=>({u_camera_to_center_distance:new a.Uniform1f(ot,m.u_camera_to_center_distance),u_scale_with_map:new a.Uniform1i(ot,m.u_scale_with_map),u_pitch_with_map:new a.Uniform1i(ot,m.u_pitch_with_map),u_extrude_scale:new a.Uniform2f(ot,m.u_extrude_scale),u_device_pixel_ratio:new a.Uniform1f(ot,m.u_device_pixel_ratio),u_matrix:new a.UniformMatrix4f(ot,m.u_matrix)}),collisionBox:(ot,m)=>({u_matrix:new a.UniformMatrix4f(ot,m.u_matrix),u_camera_to_center_distance:new a.Uniform1f(ot,m.u_camera_to_center_distance),u_pixels_to_tile_units:new a.Uniform1f(ot,m.u_pixels_to_tile_units),u_extrude_scale:new a.Uniform2f(ot,m.u_extrude_scale),u_overscale_factor:new a.Uniform1f(ot,m.u_overscale_factor)}),collisionCircle:(ot,m)=>({u_matrix:new a.UniformMatrix4f(ot,m.u_matrix),u_inv_matrix:new a.UniformMatrix4f(ot,m.u_inv_matrix),u_camera_to_center_distance:new a.Uniform1f(ot,m.u_camera_to_center_distance),u_viewport_size:new a.Uniform2f(ot,m.u_viewport_size)}),debug:(ot,m)=>({u_color:new a.UniformColor(ot,m.u_color),u_matrix:new a.UniformMatrix4f(ot,m.u_matrix),u_overlay:new a.Uniform1i(ot,m.u_overlay),u_overlay_scale:new a.Uniform1f(ot,m.u_overlay_scale)}),clippingMask:(ot,m)=>({u_matrix:new a.UniformMatrix4f(ot,m.u_matrix)}),heatmap:(ot,m)=>({u_extrude_scale:new a.Uniform1f(ot,m.u_extrude_scale),u_intensity:new a.Uniform1f(ot,m.u_intensity),u_matrix:new a.UniformMatrix4f(ot,m.u_matrix)}),heatmapTexture:(ot,m)=>({u_matrix:new a.UniformMatrix4f(ot,m.u_matrix),u_world:new a.Uniform2f(ot,m.u_world),u_image:new a.Uniform1i(ot,m.u_image),u_color_ramp:new a.Uniform1i(ot,m.u_color_ramp),u_opacity:new a.Uniform1f(ot,m.u_opacity)}),hillshade:(ot,m)=>({u_matrix:new a.UniformMatrix4f(ot,m.u_matrix),u_image:new a.Uniform1i(ot,m.u_image),u_latrange:new a.Uniform2f(ot,m.u_latrange),u_light:new a.Uniform2f(ot,m.u_light),u_shadow:new a.UniformColor(ot,m.u_shadow),u_highlight:new a.UniformColor(ot,m.u_highlight),u_accent:new a.UniformColor(ot,m.u_accent)}),hillshadePrepare:(ot,m)=>({u_matrix:new a.UniformMatrix4f(ot,m.u_matrix),u_image:new a.Uniform1i(ot,m.u_image),u_dimension:new a.Uniform2f(ot,m.u_dimension),u_zoom:new a.Uniform1f(ot,m.u_zoom),u_unpack:new a.Uniform4f(ot,m.u_unpack)}),line:(ot,m)=>({u_matrix:new a.UniformMatrix4f(ot,m.u_matrix),u_ratio:new a.Uniform1f(ot,m.u_ratio),u_device_pixel_ratio:new a.Uniform1f(ot,m.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(ot,m.u_units_to_pixels)}),lineGradient:(ot,m)=>({u_matrix:new a.UniformMatrix4f(ot,m.u_matrix),u_ratio:new a.Uniform1f(ot,m.u_ratio),u_device_pixel_ratio:new a.Uniform1f(ot,m.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(ot,m.u_units_to_pixels),u_image:new a.Uniform1i(ot,m.u_image),u_image_height:new a.Uniform1f(ot,m.u_image_height)}),linePattern:(ot,m)=>({u_matrix:new a.UniformMatrix4f(ot,m.u_matrix),u_texsize:new a.Uniform2f(ot,m.u_texsize),u_ratio:new a.Uniform1f(ot,m.u_ratio),u_device_pixel_ratio:new a.Uniform1f(ot,m.u_device_pixel_ratio),u_image:new a.Uniform1i(ot,m.u_image),u_units_to_pixels:new a.Uniform2f(ot,m.u_units_to_pixels),u_scale:new a.Uniform3f(ot,m.u_scale),u_fade:new a.Uniform1f(ot,m.u_fade)}),lineSDF:(ot,m)=>({u_matrix:new a.UniformMatrix4f(ot,m.u_matrix),u_ratio:new a.Uniform1f(ot,m.u_ratio),u_device_pixel_ratio:new a.Uniform1f(ot,m.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(ot,m.u_units_to_pixels),u_patternscale_a:new a.Uniform2f(ot,m.u_patternscale_a),u_patternscale_b:new a.Uniform2f(ot,m.u_patternscale_b),u_sdfgamma:new a.Uniform1f(ot,m.u_sdfgamma),u_image:new a.Uniform1i(ot,m.u_image),u_tex_y_a:new a.Uniform1f(ot,m.u_tex_y_a),u_tex_y_b:new a.Uniform1f(ot,m.u_tex_y_b),u_mix:new a.Uniform1f(ot,m.u_mix)}),raster:(ot,m)=>({u_matrix:new a.UniformMatrix4f(ot,m.u_matrix),u_tl_parent:new a.Uniform2f(ot,m.u_tl_parent),u_scale_parent:new a.Uniform1f(ot,m.u_scale_parent),u_buffer_scale:new a.Uniform1f(ot,m.u_buffer_scale),u_fade_t:new a.Uniform1f(ot,m.u_fade_t),u_opacity:new a.Uniform1f(ot,m.u_opacity),u_image0:new a.Uniform1i(ot,m.u_image0),u_image1:new a.Uniform1i(ot,m.u_image1),u_brightness_low:new a.Uniform1f(ot,m.u_brightness_low),u_brightness_high:new a.Uniform1f(ot,m.u_brightness_high),u_saturation_factor:new a.Uniform1f(ot,m.u_saturation_factor),u_contrast_factor:new a.Uniform1f(ot,m.u_contrast_factor),u_spin_weights:new a.Uniform3f(ot,m.u_spin_weights)}),symbolIcon:(ot,m)=>({u_is_size_zoom_constant:new a.Uniform1i(ot,m.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(ot,m.u_is_size_feature_constant),u_size_t:new a.Uniform1f(ot,m.u_size_t),u_size:new a.Uniform1f(ot,m.u_size),u_camera_to_center_distance:new a.Uniform1f(ot,m.u_camera_to_center_distance),u_pitch:new a.Uniform1f(ot,m.u_pitch),u_rotate_symbol:new a.Uniform1i(ot,m.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(ot,m.u_aspect_ratio),u_fade_change:new a.Uniform1f(ot,m.u_fade_change),u_matrix:new a.UniformMatrix4f(ot,m.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(ot,m.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(ot,m.u_coord_matrix),u_is_text:new a.Uniform1i(ot,m.u_is_text),u_pitch_with_map:new a.Uniform1i(ot,m.u_pitch_with_map),u_texsize:new a.Uniform2f(ot,m.u_texsize),u_texture:new a.Uniform1i(ot,m.u_texture)}),symbolSDF:(ot,m)=>({u_is_size_zoom_constant:new a.Uniform1i(ot,m.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(ot,m.u_is_size_feature_constant),u_size_t:new a.Uniform1f(ot,m.u_size_t),u_size:new a.Uniform1f(ot,m.u_size),u_camera_to_center_distance:new a.Uniform1f(ot,m.u_camera_to_center_distance),u_pitch:new a.Uniform1f(ot,m.u_pitch),u_rotate_symbol:new a.Uniform1i(ot,m.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(ot,m.u_aspect_ratio),u_fade_change:new a.Uniform1f(ot,m.u_fade_change),u_matrix:new a.UniformMatrix4f(ot,m.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(ot,m.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(ot,m.u_coord_matrix),u_is_text:new a.Uniform1i(ot,m.u_is_text),u_pitch_with_map:new a.Uniform1i(ot,m.u_pitch_with_map),u_texsize:new a.Uniform2f(ot,m.u_texsize),u_texture:new a.Uniform1i(ot,m.u_texture),u_gamma_scale:new a.Uniform1f(ot,m.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(ot,m.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(ot,m.u_is_halo)}),symbolTextAndIcon:(ot,m)=>({u_is_size_zoom_constant:new a.Uniform1i(ot,m.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(ot,m.u_is_size_feature_constant),u_size_t:new a.Uniform1f(ot,m.u_size_t),u_size:new a.Uniform1f(ot,m.u_size),u_camera_to_center_distance:new a.Uniform1f(ot,m.u_camera_to_center_distance),u_pitch:new a.Uniform1f(ot,m.u_pitch),u_rotate_symbol:new a.Uniform1i(ot,m.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(ot,m.u_aspect_ratio),u_fade_change:new a.Uniform1f(ot,m.u_fade_change),u_matrix:new a.UniformMatrix4f(ot,m.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(ot,m.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(ot,m.u_coord_matrix),u_is_text:new a.Uniform1i(ot,m.u_is_text),u_pitch_with_map:new a.Uniform1i(ot,m.u_pitch_with_map),u_texsize:new a.Uniform2f(ot,m.u_texsize),u_texsize_icon:new a.Uniform2f(ot,m.u_texsize_icon),u_texture:new a.Uniform1i(ot,m.u_texture),u_texture_icon:new a.Uniform1i(ot,m.u_texture_icon),u_gamma_scale:new a.Uniform1f(ot,m.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(ot,m.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(ot,m.u_is_halo)}),background:(ot,m)=>({u_matrix:new a.UniformMatrix4f(ot,m.u_matrix),u_opacity:new a.Uniform1f(ot,m.u_opacity),u_color:new a.UniformColor(ot,m.u_color)}),backgroundPattern:(ot,m)=>({u_matrix:new a.UniformMatrix4f(ot,m.u_matrix),u_opacity:new a.Uniform1f(ot,m.u_opacity),u_image:new a.Uniform1i(ot,m.u_image),u_pattern_tl_a:new a.Uniform2f(ot,m.u_pattern_tl_a),u_pattern_br_a:new a.Uniform2f(ot,m.u_pattern_br_a),u_pattern_tl_b:new a.Uniform2f(ot,m.u_pattern_tl_b),u_pattern_br_b:new a.Uniform2f(ot,m.u_pattern_br_b),u_texsize:new a.Uniform2f(ot,m.u_texsize),u_mix:new a.Uniform1f(ot,m.u_mix),u_pattern_size_a:new a.Uniform2f(ot,m.u_pattern_size_a),u_pattern_size_b:new a.Uniform2f(ot,m.u_pattern_size_b),u_scale_a:new a.Uniform1f(ot,m.u_scale_a),u_scale_b:new a.Uniform1f(ot,m.u_scale_b),u_pixel_coord_upper:new a.Uniform2f(ot,m.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(ot,m.u_pixel_coord_lower),u_tile_units_to_pixels:new a.Uniform1f(ot,m.u_tile_units_to_pixels)}),terrain:(ot,m)=>({u_matrix:new a.UniformMatrix4f(ot,m.u_matrix),u_texture:new a.Uniform1i(ot,m.u_texture),u_ele_delta:new a.Uniform1f(ot,m.u_ele_delta)}),terrainDepth:(ot,m)=>({u_matrix:new a.UniformMatrix4f(ot,m.u_matrix),u_ele_delta:new a.Uniform1f(ot,m.u_ele_delta)}),terrainCoords:(ot,m)=>({u_matrix:new a.UniformMatrix4f(ot,m.u_matrix),u_texture:new a.Uniform1i(ot,m.u_texture),u_terrain_coords_id:new a.Uniform1f(ot,m.u_terrain_coords_id),u_ele_delta:new a.Uniform1f(ot,m.u_ele_delta)})};class p_{constructor(m,D,Ee){this.context=m;const ct=m.gl;this.buffer=ct.createBuffer(),this.dynamicDraw=!!Ee,this.context.unbindVAO(),m.bindElementBuffer.set(this.buffer),ct.bufferData(ct.ELEMENT_ARRAY_BUFFER,D.arrayBuffer,this.dynamicDraw?ct.DYNAMIC_DRAW:ct.STATIC_DRAW),this.dynamicDraw||delete D.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(m){const D=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),D.bufferSubData(D.ELEMENT_ARRAY_BUFFER,0,m.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ev={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ky{constructor(m,D,Ee,ct){this.length=D.length,this.attributes=Ee,this.itemSize=D.bytesPerElement,this.dynamicDraw=ct,this.context=m;const or=m.gl;this.buffer=or.createBuffer(),m.bindVertexBuffer.set(this.buffer),or.bufferData(or.ARRAY_BUFFER,D.arrayBuffer,this.dynamicDraw?or.DYNAMIC_DRAW:or.STATIC_DRAW),this.dynamicDraw||delete D.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(m){if(m.length!==this.length)throw new Error(`Length of new data is ${m.length}, which doesn't match current length of ${this.length}`);const D=this.context.gl;this.bind(),D.bufferSubData(D.ARRAY_BUFFER,0,m.arrayBuffer)}enableAttributes(m,D){for(let Ee=0;Ee<this.attributes.length;Ee++){const ct=D.attributes[this.attributes[Ee].name];ct!==void 0&&m.enableVertexAttribArray(ct)}}setVertexAttribPointers(m,D,Ee){for(let ct=0;ct<this.attributes.length;ct++){const or=this.attributes[ct],kn=D.attributes[or.name];kn!==void 0&&m.vertexAttribPointer(kn,or.components,m[Ev[or.type]],!1,this.itemSize,or.offset+this.itemSize*(Ee||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const em=new WeakMap;function Zy(ot){if(em.has(ot))return em.get(ot);{const m=ot.getParameter(ot.VERSION).startsWith("WebGL 2.0");return em.set(ot,m),m}}class ug{constructor(m){this.gl=m.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(m){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Sy extends ug{getDefault(){return a.Color.transparent}set(m){const D=this.current;(m.r!==D.r||m.g!==D.g||m.b!==D.b||m.a!==D.a||this.dirty)&&(this.gl.clearColor(m.r,m.g,m.b,m.a),this.current=m,this.dirty=!1)}}class Ty extends ug{getDefault(){return 1}set(m){(m!==this.current||this.dirty)&&(this.gl.clearDepth(m),this.current=m,this.dirty=!1)}}class a0 extends ug{getDefault(){return 0}set(m){(m!==this.current||this.dirty)&&(this.gl.clearStencil(m),this.current=m,this.dirty=!1)}}class zx extends ug{getDefault(){return[!0,!0,!0,!0]}set(m){const D=this.current;(m[0]!==D[0]||m[1]!==D[1]||m[2]!==D[2]||m[3]!==D[3]||this.dirty)&&(this.gl.colorMask(m[0],m[1],m[2],m[3]),this.current=m,this.dirty=!1)}}class d_ extends ug{getDefault(){return!0}set(m){(m!==this.current||this.dirty)&&(this.gl.depthMask(m),this.current=m,this.dirty=!1)}}class Sv extends ug{getDefault(){return 255}set(m){(m!==this.current||this.dirty)&&(this.gl.stencilMask(m),this.current=m,this.dirty=!1)}}class Ny extends ug{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(m){const D=this.current;(m.func!==D.func||m.ref!==D.ref||m.mask!==D.mask||this.dirty)&&(this.gl.stencilFunc(m.func,m.ref,m.mask),this.current=m,this.dirty=!1)}}class xx extends ug{getDefault(){const m=this.gl;return[m.KEEP,m.KEEP,m.KEEP]}set(m){const D=this.current;(m[0]!==D[0]||m[1]!==D[1]||m[2]!==D[2]||this.dirty)&&(this.gl.stencilOp(m[0],m[1],m[2]),this.current=m,this.dirty=!1)}}class V_ extends ug{getDefault(){return!1}set(m){if(m===this.current&&!this.dirty)return;const D=this.gl;m?D.enable(D.STENCIL_TEST):D.disable(D.STENCIL_TEST),this.current=m,this.dirty=!1}}class Xy extends ug{getDefault(){return[0,1]}set(m){const D=this.current;(m[0]!==D[0]||m[1]!==D[1]||this.dirty)&&(this.gl.depthRange(m[0],m[1]),this.current=m,this.dirty=!1)}}class l0 extends ug{getDefault(){return!1}set(m){if(m===this.current&&!this.dirty)return;const D=this.gl;m?D.enable(D.DEPTH_TEST):D.disable(D.DEPTH_TEST),this.current=m,this.dirty=!1}}class Ay extends ug{getDefault(){return this.gl.LESS}set(m){(m!==this.current||this.dirty)&&(this.gl.depthFunc(m),this.current=m,this.dirty=!1)}}class $_ extends ug{getDefault(){return!1}set(m){if(m===this.current&&!this.dirty)return;const D=this.gl;m?D.enable(D.BLEND):D.disable(D.BLEND),this.current=m,this.dirty=!1}}class f_ extends ug{getDefault(){const m=this.gl;return[m.ONE,m.ZERO]}set(m){const D=this.current;(m[0]!==D[0]||m[1]!==D[1]||this.dirty)&&(this.gl.blendFunc(m[0],m[1]),this.current=m,this.dirty=!1)}}class U_ extends ug{getDefault(){return a.Color.transparent}set(m){const D=this.current;(m.r!==D.r||m.g!==D.g||m.b!==D.b||m.a!==D.a||this.dirty)&&(this.gl.blendColor(m.r,m.g,m.b,m.a),this.current=m,this.dirty=!1)}}class j_ extends ug{getDefault(){return this.gl.FUNC_ADD}set(m){(m!==this.current||this.dirty)&&(this.gl.blendEquation(m),this.current=m,this.dirty=!1)}}class u0 extends ug{getDefault(){return!1}set(m){if(m===this.current&&!this.dirty)return;const D=this.gl;m?D.enable(D.CULL_FACE):D.disable(D.CULL_FACE),this.current=m,this.dirty=!1}}class G0 extends ug{getDefault(){return this.gl.BACK}set(m){(m!==this.current||this.dirty)&&(this.gl.cullFace(m),this.current=m,this.dirty=!1)}}class c0 extends ug{getDefault(){return this.gl.CCW}set(m){(m!==this.current||this.dirty)&&(this.gl.frontFace(m),this.current=m,this.dirty=!1)}}class _y extends ug{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}}class hg extends ug{getDefault(){return this.gl.TEXTURE0}set(m){(m!==this.current||this.dirty)&&(this.gl.activeTexture(m),this.current=m,this.dirty=!1)}}class Tv extends ug{getDefault(){const m=this.gl;return[0,0,m.drawingBufferWidth,m.drawingBufferHeight]}set(m){const D=this.current;(m[0]!==D[0]||m[1]!==D[1]||m[2]!==D[2]||m[3]!==D[3]||this.dirty)&&(this.gl.viewport(m[0],m[1],m[2],m[3]),this.current=m,this.dirty=!1)}}class g_ extends ug{getDefault(){return null}set(m){if(m===this.current&&!this.dirty)return;const D=this.gl;D.bindFramebuffer(D.FRAMEBUFFER,m),this.current=m,this.dirty=!1}}class wx extends ug{getDefault(){return null}set(m){if(m===this.current&&!this.dirty)return;const D=this.gl;D.bindRenderbuffer(D.RENDERBUFFER,m),this.current=m,this.dirty=!1}}class h0 extends ug{getDefault(){return null}set(m){if(m===this.current&&!this.dirty)return;const D=this.gl;D.bindTexture(D.TEXTURE_2D,m),this.current=m,this.dirty=!1}}class yg extends ug{getDefault(){return null}set(m){if(m===this.current&&!this.dirty)return;const D=this.gl;D.bindBuffer(D.ARRAY_BUFFER,m),this.current=m,this.dirty=!1}}class Av extends ug{getDefault(){return null}set(m){const D=this.gl;D.bindBuffer(D.ELEMENT_ARRAY_BUFFER,m),this.current=m,this.dirty=!1}}class Rv extends ug{getDefault(){return null}set(m){var D;if(m===this.current&&!this.dirty)return;const Ee=this.gl;Zy(Ee)?Ee.bindVertexArray(m):(D=Ee.getExtension("OES_vertex_array_object"))===null||D===void 0||D.bindVertexArrayOES(m),this.current=m,this.dirty=!1}}class p0 extends ug{getDefault(){return 4}set(m){if(m===this.current&&!this.dirty)return;const D=this.gl;D.pixelStorei(D.UNPACK_ALIGNMENT,m),this.current=m,this.dirty=!1}}class ky extends ug{getDefault(){return!1}set(m){if(m===this.current&&!this.dirty)return;const D=this.gl;D.pixelStorei(D.UNPACK_PREMULTIPLY_ALPHA_WEBGL,m),this.current=m,this.dirty=!1}}class Yy extends ug{getDefault(){return!1}set(m){if(m===this.current&&!this.dirty)return;const D=this.gl;D.pixelStorei(D.UNPACK_FLIP_Y_WEBGL,m),this.current=m,this.dirty=!1}}class Jy extends ug{constructor(m,D){super(m),this.context=m,this.parent=D}getDefault(){return null}}class d0 extends Jy{setDirty(){this.dirty=!0}set(m){if(m===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const D=this.gl;D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_2D,m,0),this.current=m,this.dirty=!1}}class Vx extends Jy{set(m){if(m===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const D=this.gl;D.framebufferRenderbuffer(D.FRAMEBUFFER,D.DEPTH_ATTACHMENT,D.RENDERBUFFER,m),this.current=m,this.dirty=!1}}class H_ extends Jy{set(m){if(m===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const D=this.gl;D.framebufferRenderbuffer(D.FRAMEBUFFER,D.DEPTH_STENCIL_ATTACHMENT,D.RENDERBUFFER,m),this.current=m,this.dirty=!1}}class Iv{constructor(m,D,Ee,ct,or){this.context=m,this.width=D,this.height=Ee;const kn=m.gl,ds=this.framebuffer=kn.createFramebuffer();if(this.colorAttachment=new d0(m,ds),ct)this.depthAttachment=or?new H_(m,ds):new Vx(m,ds);else if(or)throw new Error("Stencil cannot be setted without depth");if(kn.checkFramebufferStatus(kn.FRAMEBUFFER)!==kn.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const m=this.context.gl,D=this.colorAttachment.get();if(D&&m.deleteTexture(D),this.depthAttachment){const Ee=this.depthAttachment.get();Ee&&m.deleteRenderbuffer(Ee)}m.deleteFramebuffer(this.framebuffer)}}class Lg{constructor(m,D,Ee){this.blendFunction=m,this.blendColor=D,this.mask=Ee}}Lg.Replace=[1,0],Lg.disabled=new Lg(Lg.Replace,a.Color.transparent,[!1,!1,!1,!1]),Lg.unblended=new Lg(Lg.Replace,a.Color.transparent,[!0,!0,!0,!0]),Lg.alphaBlended=new Lg([1,771],a.Color.transparent,[!0,!0,!0,!0]);class Pv{constructor(m){var D,Ee;if(this.gl=m,this.clearColor=new Sy(this),this.clearDepth=new Ty(this),this.clearStencil=new a0(this),this.colorMask=new zx(this),this.depthMask=new d_(this),this.stencilMask=new Sv(this),this.stencilFunc=new Ny(this),this.stencilOp=new xx(this),this.stencilTest=new V_(this),this.depthRange=new Xy(this),this.depthTest=new l0(this),this.depthFunc=new Ay(this),this.blend=new $_(this),this.blendFunc=new f_(this),this.blendColor=new U_(this),this.blendEquation=new j_(this),this.cullFace=new u0(this),this.cullFaceSide=new G0(this),this.frontFace=new c0(this),this.program=new _y(this),this.activeTexture=new hg(this),this.viewport=new Tv(this),this.bindFramebuffer=new g_(this),this.bindRenderbuffer=new wx(this),this.bindTexture=new h0(this),this.bindVertexBuffer=new yg(this),this.bindElementBuffer=new Av(this),this.bindVertexArray=new Rv(this),this.pixelStoreUnpack=new p0(this),this.pixelStoreUnpackPremultiplyAlpha=new ky(this),this.pixelStoreUnpackFlipY=new Yy(this),this.extTextureFilterAnisotropic=m.getExtension("EXT_texture_filter_anisotropic")||m.getExtension("MOZ_EXT_texture_filter_anisotropic")||m.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=m.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=m.getParameter(m.MAX_TEXTURE_SIZE),Zy(m)){this.HALF_FLOAT=m.HALF_FLOAT;const ct=m.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(D=m.RGBA16F)!==null&&D!==void 0?D:ct==null?void 0:ct.RGBA16F_EXT,this.RGB16F=(Ee=m.RGB16F)!==null&&Ee!==void 0?Ee:ct==null?void 0:ct.RGB16F_EXT,m.getExtension("EXT_color_buffer_float")}else{m.getExtension("EXT_color_buffer_half_float"),m.getExtension("OES_texture_half_float_linear");const ct=m.getExtension("OES_texture_half_float");this.HALF_FLOAT=ct==null?void 0:ct.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(m,D){return new p_(this,m,D)}createVertexBuffer(m,D,Ee){return new Ky(this,m,D,Ee)}createRenderbuffer(m,D,Ee){const ct=this.gl,or=ct.createRenderbuffer();return this.bindRenderbuffer.set(or),ct.renderbufferStorage(ct.RENDERBUFFER,m,D,Ee),this.bindRenderbuffer.set(null),or}createFramebuffer(m,D,Ee,ct){return new Iv(this,m,D,Ee,ct)}clear({color:m,depth:D,stencil:Ee}){const ct=this.gl;let or=0;m&&(or|=ct.COLOR_BUFFER_BIT,this.clearColor.set(m),this.colorMask.set([!0,!0,!0,!0])),D!==void 0&&(or|=ct.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(D),this.depthMask.set(!0)),Ee!==void 0&&(or|=ct.STENCIL_BUFFER_BIT,this.clearStencil.set(Ee),this.stencilMask.set(255)),ct.clear(or)}setCullFace(m){m.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(m.mode),this.frontFace.set(m.frontFace))}setDepthMode(m){m.func!==this.gl.ALWAYS||m.mask?(this.depthTest.set(!0),this.depthFunc.set(m.func),this.depthMask.set(m.mask),this.depthRange.set(m.range)):this.depthTest.set(!1)}setStencilMode(m){m.test.func!==this.gl.ALWAYS||m.mask?(this.stencilTest.set(!0),this.stencilMask.set(m.mask),this.stencilOp.set([m.fail,m.depthFail,m.pass]),this.stencilFunc.set({func:m.test.func,ref:m.ref,mask:m.test.mask})):this.stencilTest.set(!1)}setColorMode(m){a.deepEqual(m.blendFunction,Lg.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(m.blendFunction),this.blendColor.set(m.blendColor)),this.colorMask.set(m.mask)}createVertexArray(){var m;return Zy(this.gl)?this.gl.createVertexArray():(m=this.gl.getExtension("OES_vertex_array_object"))===null||m===void 0?void 0:m.createVertexArrayOES()}deleteVertexArray(m){var D;return Zy(this.gl)?this.gl.deleteVertexArray(m):(D=this.gl.getExtension("OES_vertex_array_object"))===null||D===void 0?void 0:D.deleteVertexArrayOES(m)}unbindVAO(){this.bindVertexArray.set(null)}}class rg{constructor(m,D,Ee){this.func=m,this.mask=D,this.range=Ee}}rg.ReadOnly=!1,rg.ReadWrite=!0,rg.disabled=new rg(519,rg.ReadOnly,[0,1]);const Mv=7680;class jd{constructor(m,D,Ee,ct,or,kn){this.test=m,this.ref=D,this.mask=Ee,this.fail=ct,this.depthFail=or,this.pass=kn}}jd.disabled=new jd({func:519,mask:0},0,0,Mv,Mv,Mv);class _g{constructor(m,D,Ee){this.enable=m,this.mode=D,this.frontFace=Ee}}let W_;function V0(ot,m,D,Ee,ct,or,kn){const ds=ot.context,ps=ds.gl,vs=ot.useProgram("collisionBox"),fl=[];let pl=0,ph=0;for(let Lh=0;Lh<Ee.length;Lh++){const op=Ee[Lh],yp=m.getTile(op),Np=yp.getBucket(D);if(!Np)continue;let jp=op.posMatrix;ct[0]===0&&ct[1]===0||(jp=ot.translatePosMatrix(op.posMatrix,yp,ct,or));const td=kn?Np.textCollisionBox:Np.iconCollisionBox,Vp=Np.collisionCircleArray;if(Vp.length>0){const gd=a.create(),F=jp;a.mul(gd,Np.placementInvProjMatrix,ot.transform.glCoordMatrix),a.mul(gd,gd,Np.placementViewportMatrix),fl.push({circleArray:Vp,circleOffset:ph,transform:F,invTransform:gd,coord:op}),pl+=Vp.length/4,ph=pl}td&&vs.draw(ds,ps.LINES,rg.disabled,jd.disabled,ot.colorModeForRenderPass(),_g.disabled,B0(jp,ot.transform,yp),ot.style.map.terrain&&ot.style.map.terrain.getTerrainData(op),D.id,td.layoutVertexBuffer,td.indexBuffer,td.segments,null,ot.transform.zoom,null,null,td.collisionVertexBuffer)}if(!kn||!fl.length)return;const Ah=ot.useProgram("collisionCircle"),hh=new a.CollisionCircleLayoutArray;hh.resize(4*pl),hh._trim();let Rh=0;for(const Lh of fl)for(let op=0;op<Lh.circleArray.length/4;op++){const yp=4*op,Np=Lh.circleArray[yp+0],jp=Lh.circleArray[yp+1],td=Lh.circleArray[yp+2],Vp=Lh.circleArray[yp+3];hh.emplace(Rh++,Np,jp,td,Vp,0),hh.emplace(Rh++,Np,jp,td,Vp,1),hh.emplace(Rh++,Np,jp,td,Vp,2),hh.emplace(Rh++,Np,jp,td,Vp,3)}(!W_||W_.length<2*pl)&&(W_=function(Lh){const op=2*Lh,yp=new a.QuadTriangleArray;yp.resize(op),yp._trim();for(let Np=0;Np<op;Np++){const jp=6*Np;yp.uint16[jp+0]=4*Np+0,yp.uint16[jp+1]=4*Np+1,yp.uint16[jp+2]=4*Np+2,yp.uint16[jp+3]=4*Np+2,yp.uint16[jp+4]=4*Np+3,yp.uint16[jp+5]=4*Np+0}return yp}(pl));const Gh=ds.createIndexBuffer(W_,!0),Kh=ds.createVertexBuffer(hh,a.collisionCircleLayout.members,!0);for(const Lh of fl){const op={u_matrix:Lh.transform,u_inv_matrix:Lh.invTransform,u_camera_to_center_distance:(ap=ot.transform).cameraToCenterDistance,u_viewport_size:[ap.width,ap.height]};Ah.draw(ds,ps.TRIANGLES,rg.disabled,jd.disabled,ot.colorModeForRenderPass(),_g.disabled,op,ot.style.map.terrain&&ot.style.map.terrain.getTerrainData(Lh.coord),D.id,Kh,Gh,a.SegmentVector.simpleSegment(0,2*Lh.circleOffset,Lh.circleArray.length,Lh.circleArray.length/2),null,ot.transform.zoom,null,null,null)}var ap;Kh.destroy(),Gh.destroy()}_g.disabled=new _g(!1,1029,2305),_g.backCCW=new _g(!0,1029,2305);const $0=a.identity(new Float32Array(16));function q_(ot,m,D,Ee,ct,or){const{horizontalAlign:kn,verticalAlign:ds}=a.getAnchorAlignment(ot),ps=-(kn-.5)*m,vs=-(ds-.5)*D,fl=a.evaluateVariableOffset(ot,Ee);return new a.Point((ps/ct+fl[0])*or,(vs/ct+fl[1])*or)}function U0(ot,m,D,Ee,ct,or,kn,ds,ps,vs,fl){const pl=ot.text.placedSymbolArray,ph=ot.text.dynamicLayoutVertexArray,Ah=ot.icon.dynamicLayoutVertexArray,hh={};ph.clear();for(let Rh=0;Rh<pl.length;Rh++){const Gh=pl.get(Rh),Kh=Gh.hidden||!Gh.crossTileID||ot.allowVerticalPlacement&&!Gh.placedOrientation?null:Ee[Gh.crossTileID];if(Kh){const ap=new a.Point(Gh.anchorX,Gh.anchorY),Lh=Qd(ap,D?kn:or,fl),op=Rd(ct.cameraToCenterDistance,Lh.signedDistanceFromCamera);let yp=a.evaluateSizeForFeature(ot.textSizeData,ps,Gh)*op/a.ONE_EM;D&&(yp*=ot.tilePixelRatio/ds);const{width:Np,height:jp,anchor:td,textOffset:Vp,textBoxScale:gd}=Kh,F=q_(td,Np,jp,Vp,gd,yp),f=D?Qd(ap.add(F),or,fl).point:Lh.point.add(m?F.rotate(-ct.angle):F),T=ot.allowVerticalPlacement&&Gh.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let X=0;X<Gh.numGlyphs;X++)a.addDynamicAttributes(ph,f,T);vs&&Gh.associatedIconIndex>=0&&(hh[Gh.associatedIconIndex]={shiftedAnchor:f,angle:T})}else fs(Gh.numGlyphs,ph)}if(vs){Ah.clear();const Rh=ot.icon.placedSymbolArray;for(let Gh=0;Gh<Rh.length;Gh++){const Kh=Rh.get(Gh);if(Kh.hidden)fs(Kh.numGlyphs,Ah);else{const ap=hh[Gh];if(ap)for(let Lh=0;Lh<Kh.numGlyphs;Lh++)a.addDynamicAttributes(Ah,ap.shiftedAnchor,ap.angle);else fs(Kh.numGlyphs,Ah)}}ot.icon.dynamicLayoutVertexBuffer.updateData(Ah)}ot.text.dynamicLayoutVertexBuffer.updateData(ph)}function j0(ot,m,D){return D.iconsInText&&m?"symbolTextAndIcon":ot?"symbolSDF":"symbolIcon"}function H0(ot,m,D,Ee,ct,or,kn,ds,ps,vs,fl,pl){const ph=ot.context,Ah=ph.gl,hh=ot.transform,Rh=ds==="map",Gh=ps==="map",Kh=ds!=="viewport"&&D.layout.get("symbol-placement")!=="point",ap=Rh&&!Gh&&!Kh,Lh=!D.layout.get("symbol-sort-key").isConstant();let op=!1;const yp=ot.depthModeForSublayer(0,rg.ReadOnly),Np=D.layout.get("text-variable-anchor"),jp=[];for(const td of Ee){const Vp=m.getTile(td),gd=Vp.getBucket(D);if(!gd)continue;const F=ct?gd.text:gd.icon;if(!F||!F.segments.get().length||!F.hasVisibleVertices)continue;const f=F.programConfigurations.get(D.id),T=ct||gd.sdfIcons,X=ct?gd.textSizeData:gd.iconSizeData,Ve=Gh||hh.pitch!==0,kt=ot.useProgram(j0(T,ct,gd),f),Hr=a.evaluateSizeForZoom(X,hh.zoom),pi=ot.style.map.terrain&&ot.style.map.terrain.getTerrainData(td);let Vn,oa,sa,dl,lh=[0,0],gh=null;if(ct)oa=Vp.glyphAtlasTexture,sa=Ah.LINEAR,Vn=Vp.glyphAtlasTexture.size,gd.iconsInText&&(lh=Vp.imageAtlasTexture.size,gh=Vp.imageAtlasTexture,dl=Ve||ot.options.rotating||ot.options.zooming||X.kind==="composite"||X.kind==="camera"?Ah.LINEAR:Ah.NEAREST);else{const Zh=D.layout.get("icon-size").constantOr(0)!==1||gd.iconsNeedLinear;oa=Vp.imageAtlasTexture,sa=T||ot.options.rotating||ot.options.zooming||Zh||Ve?Ah.LINEAR:Ah.NEAREST,Vn=Vp.imageAtlasTexture.size}const _h=vh(Vp,1,ot.transform.zoom),yh=nd(td.posMatrix,Gh,Rh,ot.transform,_h),xh=$d(td.posMatrix,Gh,Rh,ot.transform,_h),yl=Np&&gd.hasTextData(),mh=D.layout.get("icon-text-fit")!=="none"&&yl&&gd.hasIconData();if(Kh){const Zh=ot.style.map.terrain?(Bp,tp)=>ot.style.map.terrain.getElevation(td,Bp,tp):null,rp=D.layout.get("text-rotation-alignment")==="map";bg(gd,td.posMatrix,ot,ct,yh,xh,Gh,vs,rp,Zh)}const bh=ot.translatePosMatrix(td.posMatrix,Vp,or,kn),Sh=Kh||ct&&Np||mh?$0:yh,Nh=ot.translatePosMatrix(xh,Vp,or,kn,!0),$h=T&&D.paint.get(ct?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Vh;Vh=T?gd.iconsInText?Vm(X.kind,Hr,ap,Gh,ot,bh,Sh,Nh,Vn,lh):dm(X.kind,Hr,ap,Gh,ot,bh,Sh,Nh,ct,Vn,!0):h_(X.kind,Hr,ap,Gh,ot,bh,Sh,Nh,ct,Vn);const Wh={program:kt,buffers:F,uniformValues:Vh,atlasTexture:oa,atlasTextureIcon:gh,atlasInterpolation:sa,atlasInterpolationIcon:dl,isSDF:T,hasHalo:$h};if(Lh&&gd.canOverlap){op=!0;const Zh=F.segments.get();for(const rp of Zh)jp.push({segments:new a.SegmentVector([rp]),sortKey:rp.sortKey,state:Wh,terrainData:pi})}else jp.push({segments:F.segments,sortKey:0,state:Wh,terrainData:pi})}op&&jp.sort((td,Vp)=>td.sortKey-Vp.sortKey);for(const td of jp){const Vp=td.state;if(ph.activeTexture.set(Ah.TEXTURE0),Vp.atlasTexture.bind(Vp.atlasInterpolation,Ah.CLAMP_TO_EDGE),Vp.atlasTextureIcon&&(ph.activeTexture.set(Ah.TEXTURE1),Vp.atlasTextureIcon&&Vp.atlasTextureIcon.bind(Vp.atlasInterpolationIcon,Ah.CLAMP_TO_EDGE)),Vp.isSDF){const gd=Vp.uniformValues;Vp.hasHalo&&(gd.u_is_halo=1,bx(Vp.buffers,td.segments,D,ot,Vp.program,yp,fl,pl,gd,td.terrainData)),gd.u_is_halo=0}bx(Vp.buffers,td.segments,D,ot,Vp.program,yp,fl,pl,Vp.uniformValues,td.terrainData)}}function bx(ot,m,D,Ee,ct,or,kn,ds,ps,vs){const fl=Ee.context;ct.draw(fl,fl.gl.TRIANGLES,or,kn,ds,_g.disabled,ps,vs,D.id,ot.layoutVertexBuffer,ot.indexBuffer,m,D.paint,Ee.transform.zoom,ot.programConfigurations.get(D.id),ot.dynamicLayoutVertexBuffer,ot.opacityVertexBuffer)}function f0(ot,m,D,Ee,ct){if(!D||!Ee||!Ee.imageAtlas)return;const or=Ee.imageAtlas.patternPositions;let kn=or[D.to.toString()],ds=or[D.from.toString()];if(!kn||!ds){const ps=ct.getPaintProperty(m);kn=or[ps],ds=or[ps]}kn&&ds&&ot.setConstantPatternPositions(kn,ds)}function K_(ot,m,D,Ee,ct,or,kn){const ds=ot.context.gl,ps="fill-pattern",vs=D.paint.get(ps),fl=vs&&vs.constantOr(1),pl=D.getCrossfadeParameters();let ph,Ah,hh,Rh,Gh;kn?(Ah=fl&&!D.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ph=ds.LINES):(Ah=fl?"fillPattern":"fill",ph=ds.TRIANGLES);const Kh=vs.constantOr(null);for(const ap of Ee){const Lh=m.getTile(ap);if(fl&&!Lh.patternsLoaded())continue;const op=Lh.getBucket(D);if(!op)continue;const yp=op.programConfigurations.get(D.id),Np=ot.useProgram(Ah,yp),jp=ot.style.map.terrain&&ot.style.map.terrain.getTerrainData(ap);fl&&(ot.context.activeTexture.set(ds.TEXTURE0),Lh.imageAtlasTexture.bind(ds.LINEAR,ds.CLAMP_TO_EDGE),yp.updatePaintBuffers(pl)),f0(yp,ps,Kh,Lh,D);const td=jp?ap:null,Vp=ot.translatePosMatrix(td?td.posMatrix:ap.posMatrix,Lh,D.paint.get("fill-translate"),D.paint.get("fill-translate-anchor"));if(kn){Rh=op.indexBuffer2,Gh=op.segments2;const gd=[ds.drawingBufferWidth,ds.drawingBufferHeight];hh=Ah==="fillOutlinePattern"&&fl?ay(Vp,ot,pl,Lh,gd):B_(Vp,gd)}else Rh=op.indexBuffer,Gh=op.segments,hh=fl?k_(Vp,ot,pl,Lh):qm(Vp);Np.draw(ot.context,ph,ct,ot.stencilModeForClipping(ap),or,_g.disabled,hh,jp,D.id,op.layoutVertexBuffer,Rh,Gh,D.paint,ot.transform.zoom,yp)}}function Z_(ot,m,D,Ee,ct,or,kn){const ds=ot.context,ps=ds.gl,vs="fill-extrusion-pattern",fl=D.paint.get(vs),pl=fl.constantOr(1),ph=D.getCrossfadeParameters(),Ah=D.paint.get("fill-extrusion-opacity"),hh=fl.constantOr(null);for(const Rh of Ee){const Gh=m.getTile(Rh),Kh=Gh.getBucket(D);if(!Kh)continue;const ap=ot.style.map.terrain&&ot.style.map.terrain.getTerrainData(Rh),Lh=Kh.programConfigurations.get(D.id),op=ot.useProgram(pl?"fillExtrusionPattern":"fillExtrusion",Lh);pl&&(ot.context.activeTexture.set(ps.TEXTURE0),Gh.imageAtlasTexture.bind(ps.LINEAR,ps.CLAMP_TO_EDGE),Lh.updatePaintBuffers(ph)),f0(Lh,vs,hh,Gh,D);const yp=ot.translatePosMatrix(Rh.posMatrix,Gh,D.paint.get("fill-extrusion-translate"),D.paint.get("fill-extrusion-translate-anchor")),Np=D.paint.get("fill-extrusion-vertical-gradient"),jp=pl?Kf(yp,ot,Np,Ah,Rh,ph,Gh):yy(yp,ot,Np,Ah);op.draw(ds,ds.gl.TRIANGLES,ct,or,kn,_g.backCCW,jp,ap,D.id,Kh.layoutVertexBuffer,Kh.indexBuffer,Kh.segments,D.paint,ot.transform.zoom,Lh,ot.style.map.terrain&&Kh.centroidVertexBuffer)}}function W0(ot,m,D,Ee,ct,or,kn){const ds=ot.context,ps=ds.gl,vs=D.fbo;if(!vs)return;const fl=ot.useProgram("hillshade"),pl=ot.style.map.terrain&&ot.style.map.terrain.getTerrainData(m);ds.activeTexture.set(ps.TEXTURE0),ps.bindTexture(ps.TEXTURE_2D,vs.colorAttachment.get()),fl.draw(ds,ps.TRIANGLES,ct,or,kn,_g.disabled,((ph,Ah,hh,Rh)=>{const Gh=hh.paint.get("hillshade-shadow-color"),Kh=hh.paint.get("hillshade-highlight-color"),ap=hh.paint.get("hillshade-accent-color");let Lh=hh.paint.get("hillshade-illumination-direction")*(Math.PI/180);hh.paint.get("hillshade-illumination-anchor")==="viewport"&&(Lh-=ph.transform.angle);const op=!ph.options.moving;return{u_matrix:Rh?Rh.posMatrix:ph.transform.calculatePosMatrix(Ah.tileID.toUnwrapped(),op),u_image:0,u_latrange:z0(0,Ah.tileID),u_light:[hh.paint.get("hillshade-exaggeration"),Lh],u_shadow:Gh,u_highlight:Kh,u_accent:ap}})(ot,D,Ee,pl?m:null),pl,Ee.id,ot.rasterBoundsBuffer,ot.quadTriangleIndexBuffer,ot.rasterBoundsSegments)}function Cx(ot,m,D,Ee,ct,or){const kn=ot.context,ds=kn.gl,ps=m.dem;if(ps&&ps.data){const vs=ps.dim,fl=ps.stride,pl=ps.getPixels();if(kn.activeTexture.set(ds.TEXTURE1),kn.pixelStoreUnpackPremultiplyAlpha.set(!1),m.demTexture=m.demTexture||ot.getTileTexture(fl),m.demTexture){const Ah=m.demTexture;Ah.update(pl,{premultiply:!1}),Ah.bind(ds.NEAREST,ds.CLAMP_TO_EDGE)}else m.demTexture=new _l(kn,pl,ds.RGBA,{premultiply:!1}),m.demTexture.bind(ds.NEAREST,ds.CLAMP_TO_EDGE);kn.activeTexture.set(ds.TEXTURE0);let ph=m.fbo;if(!ph){const Ah=new _l(kn,{width:vs,height:vs,data:null},ds.RGBA);Ah.bind(ds.LINEAR,ds.CLAMP_TO_EDGE),ph=m.fbo=kn.createFramebuffer(vs,vs,!0,!1),ph.colorAttachment.set(Ah.texture)}kn.bindFramebuffer.set(ph.framebuffer),kn.viewport.set([0,0,vs,vs]),ot.useProgram("hillshadePrepare").draw(kn,ds.TRIANGLES,Ee,ct,or,_g.disabled,((Ah,hh)=>{const Rh=hh.stride,Gh=a.create();return a.ortho(Gh,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(Gh,Gh,[0,-a.EXTENT,0]),{u_matrix:Gh,u_image:1,u_dimension:[Rh,Rh],u_zoom:Ah.overscaledZ,u_unpack:hh.getUnpackVector()}})(m.tileID,ps),null,D.id,ot.rasterBoundsBuffer,ot.quadTriangleIndexBuffer,ot.rasterBoundsSegments),m.needsHillshadePrepare=!1}}function Yg(ot,m,D,Ee,ct,or){const kn=Ee.paint.get("raster-fade-duration");if(!or&&kn>0){const ds=a.exported.now(),ps=(ds-ot.timeAdded)/kn,vs=m?(ds-m.timeAdded)/kn:-1,fl=D.getSource(),pl=ct.coveringZoomLevel({tileSize:fl.tileSize,roundZoom:fl.roundZoom}),ph=!m||Math.abs(m.tileID.overscaledZ-pl)>Math.abs(ot.tileID.overscaledZ-pl),Ah=ph&&ot.refreshedUponExpiration?1:a.clamp(ph?ps:1-vs,0,1);return ot.refreshedUponExpiration&&ps>=1&&(ot.refreshedUponExpiration=!1),m?{opacity:1,mix:1-Ah}:{opacity:Ah,mix:0}}return{opacity:1,mix:0}}const X_=new a.Color(1,0,0,1),Nm=new a.Color(0,1,0,1),Y_=new a.Color(0,0,1,1),g0=new a.Color(1,0,1,1),Dv=new a.Color(0,1,1,1);function Qy(ot,m,D,Ee){e_(ot,0,m+D/2,ot.transform.width,D,Ee)}function Zm(ot,m,D,Ee){e_(ot,m-D/2,0,D,ot.transform.height,Ee)}function e_(ot,m,D,Ee,ct,or){const kn=ot.context,ds=kn.gl;ds.enable(ds.SCISSOR_TEST),ds.scissor(m*ot.pixelRatio,D*ot.pixelRatio,Ee*ot.pixelRatio,ct*ot.pixelRatio),kn.clear({color:or}),ds.disable(ds.SCISSOR_TEST)}function q0(ot,m,D){const Ee=ot.context,ct=Ee.gl,or=D.posMatrix,kn=ot.useProgram("debug"),ds=rg.disabled,ps=jd.disabled,vs=ot.colorModeForRenderPass(),fl="$debug",pl=ot.style.map.terrain&&ot.style.map.terrain.getTerrainData(D);Ee.activeTexture.set(ct.TEXTURE0);const ph=m.getTileByID(D.key).latestRawTileData,Ah=Math.floor((ph&&ph.byteLength||0)/1024),hh=m.getTile(D).tileSize,Rh=512/Math.min(hh,512)*(D.overscaledZ/ot.transform.zoom)*.5;let Gh=D.canonical.toString();D.overscaledZ!==D.canonical.z&&(Gh+=` => ${D.overscaledZ}`),function(Kh,ap){Kh.initDebugOverlayCanvas();const Lh=Kh.debugOverlayCanvas,op=Kh.context.gl,yp=Kh.debugOverlayCanvas.getContext("2d");yp.clearRect(0,0,Lh.width,Lh.height),yp.shadowColor="white",yp.shadowBlur=2,yp.lineWidth=1.5,yp.strokeStyle="white",yp.textBaseline="top",yp.font="bold 36px Open Sans, sans-serif",yp.fillText(ap,5,5),yp.strokeText(ap,5,5),Kh.debugOverlayTexture.update(Lh),Kh.debugOverlayTexture.bind(op.LINEAR,op.CLAMP_TO_EDGE)}(ot,`${Gh} ${Ah}kB`),kn.draw(Ee,ct.TRIANGLES,ds,ps,Lg.alphaBlended,_g.disabled,Ey(or,a.Color.transparent,Rh),null,fl,ot.debugBuffer,ot.quadTriangleIndexBuffer,ot.debugSegments),kn.draw(Ee,ct.LINE_STRIP,ds,ps,vs,_g.disabled,Ey(or,a.Color.red),pl,fl,ot.debugBuffer,ot.tileBorderIndexBuffer,ot.debugSegments)}function Ov(ot,m,D){const Ee=ot.context,ct=Ee.gl,or=ot.colorModeForRenderPass(),kn=new rg(ct.LEQUAL,rg.ReadWrite,ot.depthRangeFor3D),ds=ot.useProgram("terrain"),ps=m.getTerrainMesh();Ee.bindFramebuffer.set(null),Ee.viewport.set([0,0,ot.width,ot.height]);for(const vs of D){const fl=ot.renderToTexture.getTexture(vs),pl=m.getTerrainData(vs.tileID);Ee.activeTexture.set(ct.TEXTURE0),ct.bindTexture(ct.TEXTURE_2D,fl.texture);const ph={u_matrix:ot.transform.calculatePosMatrix(vs.tileID.toUnwrapped()),u_texture:0,u_ele_delta:m.getMeshFrameDelta(ot.transform.zoom)};ds.draw(Ee,ct.TRIANGLES,kn,jd.disabled,or,_g.backCCW,ph,pl,"terrain",ps.vertexBuffer,ps.indexBuffer,ps.segments)}}const K0={symbol:function(ot,m,D,Ee,ct){if(ot.renderPass!=="translucent")return;const or=jd.disabled,kn=ot.colorModeForRenderPass();D.layout.get("text-variable-anchor")&&function(ds,ps,vs,fl,pl,ph,Ah){const hh=ps.transform,Rh=pl==="map",Gh=ph==="map";for(const Kh of ds){const ap=fl.getTile(Kh),Lh=ap.getBucket(vs);if(!Lh||!Lh.text||!Lh.text.segments.get().length)continue;const op=a.evaluateSizeForZoom(Lh.textSizeData,hh.zoom),yp=vh(ap,1,ps.transform.zoom),Np=nd(Kh.posMatrix,Gh,Rh,ps.transform,yp),jp=vs.layout.get("icon-text-fit")!=="none"&&Lh.hasIconData();if(op){const td=Math.pow(2,hh.zoom-ap.tileID.overscaledZ);U0(Lh,Rh,Gh,Ah,hh,Np,Kh.posMatrix,td,op,jp,ps.style.map.terrain?(Vp,gd)=>ps.style.map.terrain.getElevation(Kh,Vp,gd):null)}}}(Ee,ot,D,m,D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),ct),D.paint.get("icon-opacity").constantOr(1)!==0&&H0(ot,m,D,Ee,!1,D.paint.get("icon-translate"),D.paint.get("icon-translate-anchor"),D.layout.get("icon-rotation-alignment"),D.layout.get("icon-pitch-alignment"),D.layout.get("icon-keep-upright"),or,kn),D.paint.get("text-opacity").constantOr(1)!==0&&H0(ot,m,D,Ee,!0,D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),D.layout.get("text-keep-upright"),or,kn),m.map.showCollisionBoxes&&(V0(ot,m,D,Ee,D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),!0),V0(ot,m,D,Ee,D.paint.get("icon-translate"),D.paint.get("icon-translate-anchor"),!1))},circle:function(ot,m,D,Ee){if(ot.renderPass!=="translucent")return;const ct=D.paint.get("circle-opacity"),or=D.paint.get("circle-stroke-width"),kn=D.paint.get("circle-stroke-opacity"),ds=!D.layout.get("circle-sort-key").isConstant();if(ct.constantOr(1)===0&&(or.constantOr(1)===0||kn.constantOr(1)===0))return;const ps=ot.context,vs=ps.gl,fl=ot.depthModeForSublayer(0,rg.ReadOnly),pl=jd.disabled,ph=ot.colorModeForRenderPass(),Ah=[];for(let hh=0;hh<Ee.length;hh++){const Rh=Ee[hh],Gh=m.getTile(Rh),Kh=Gh.getBucket(D);if(!Kh)continue;const ap=Kh.programConfigurations.get(D.id),Lh=ot.useProgram("circle",ap),op=Kh.layoutVertexBuffer,yp=Kh.indexBuffer,Np=ot.style.map.terrain&&ot.style.map.terrain.getTerrainData(Rh),jp={programConfiguration:ap,program:Lh,layoutVertexBuffer:op,indexBuffer:yp,uniformValues:Og(ot,Rh,Gh,D),terrainData:Np};if(ds){const td=Kh.segments.get();for(const Vp of td)Ah.push({segments:new a.SegmentVector([Vp]),sortKey:Vp.sortKey,state:jp})}else Ah.push({segments:Kh.segments,sortKey:0,state:jp})}ds&&Ah.sort((hh,Rh)=>hh.sortKey-Rh.sortKey);for(const hh of Ah){const{programConfiguration:Rh,program:Gh,layoutVertexBuffer:Kh,indexBuffer:ap,uniformValues:Lh,terrainData:op}=hh.state;Gh.draw(ps,vs.TRIANGLES,fl,pl,ph,_g.disabled,Lh,op,D.id,Kh,ap,hh.segments,D.paint,ot.transform.zoom,Rh)}},heatmap:function(ot,m,D,Ee){if(D.paint.get("heatmap-opacity")!==0)if(ot.renderPass==="offscreen"){const ct=ot.context,or=ct.gl,kn=jd.disabled,ds=new Lg([or.ONE,or.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(ps,vs,fl){const pl=ps.gl;ps.activeTexture.set(pl.TEXTURE1),ps.viewport.set([0,0,vs.width/4,vs.height/4]);let ph=fl.heatmapFbo;if(ph)pl.bindTexture(pl.TEXTURE_2D,ph.colorAttachment.get()),ps.bindFramebuffer.set(ph.framebuffer);else{const Ah=pl.createTexture();pl.bindTexture(pl.TEXTURE_2D,Ah),pl.texParameteri(pl.TEXTURE_2D,pl.TEXTURE_WRAP_S,pl.CLAMP_TO_EDGE),pl.texParameteri(pl.TEXTURE_2D,pl.TEXTURE_WRAP_T,pl.CLAMP_TO_EDGE),pl.texParameteri(pl.TEXTURE_2D,pl.TEXTURE_MIN_FILTER,pl.LINEAR),pl.texParameteri(pl.TEXTURE_2D,pl.TEXTURE_MAG_FILTER,pl.LINEAR),ph=fl.heatmapFbo=ps.createFramebuffer(vs.width/4,vs.height/4,!1,!1),function(hh,Rh,Gh,Kh){var ap,Lh;const op=hh.gl,yp=(ap=hh.HALF_FLOAT)!==null&&ap!==void 0?ap:op.UNSIGNED_BYTE,Np=(Lh=hh.RGBA16F)!==null&&Lh!==void 0?Lh:op.RGBA;op.texImage2D(op.TEXTURE_2D,0,Np,Rh.width/4,Rh.height/4,0,op.RGBA,yp,null),Kh.colorAttachment.set(Gh)}(ps,vs,Ah,ph)}})(ct,ot,D),ct.clear({color:a.Color.transparent});for(let ps=0;ps<Ee.length;ps++){const vs=Ee[ps];if(m.hasRenderableParent(vs))continue;const fl=m.getTile(vs),pl=fl.getBucket(D);if(!pl)continue;const ph=pl.programConfigurations.get(D.id),Ah=ot.useProgram("heatmap",ph),{zoom:hh}=ot.transform;Ah.draw(ct,or.TRIANGLES,rg.disabled,kn,ds,_g.disabled,bv(vs.posMatrix,fl,hh,D.paint.get("heatmap-intensity")),null,D.id,pl.layoutVertexBuffer,pl.indexBuffer,pl.segments,D.paint,ot.transform.zoom,ph)}ct.viewport.set([0,0,ot.width,ot.height])}else ot.renderPass==="translucent"&&(ot.context.setColorMode(ot.colorModeForRenderPass()),function(ct,or){const kn=ct.context,ds=kn.gl,ps=or.heatmapFbo;if(!ps)return;kn.activeTexture.set(ds.TEXTURE0),ds.bindTexture(ds.TEXTURE_2D,ps.colorAttachment.get()),kn.activeTexture.set(ds.TEXTURE1);let vs=or.colorRampTexture;vs||(vs=or.colorRampTexture=new _l(kn,or.colorRamp,ds.RGBA)),vs.bind(ds.LINEAR,ds.CLAMP_TO_EDGE),ct.useProgram("heatmapTexture").draw(kn,ds.TRIANGLES,rg.disabled,jd.disabled,ct.colorModeForRenderPass(),_g.disabled,((fl,pl,ph,Ah)=>{const hh=a.create();a.ortho(hh,0,fl.width,fl.height,0,0,1);const Rh=fl.context.gl;return{u_matrix:hh,u_world:[Rh.drawingBufferWidth,Rh.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:pl.paint.get("heatmap-opacity")}})(ct,or),null,or.id,ct.viewportBuffer,ct.quadTriangleIndexBuffer,ct.viewportSegments,or.paint,ct.transform.zoom)}(ot,D))},line:function(ot,m,D,Ee){if(ot.renderPass!=="translucent")return;const ct=D.paint.get("line-opacity"),or=D.paint.get("line-width");if(ct.constantOr(1)===0||or.constantOr(1)===0)return;const kn=ot.depthModeForSublayer(0,rg.ReadOnly),ds=ot.colorModeForRenderPass(),ps=D.paint.get("line-dasharray"),vs=D.paint.get("line-pattern"),fl=vs.constantOr(1),pl=D.paint.get("line-gradient"),ph=D.getCrossfadeParameters(),Ah=fl?"linePattern":ps?"lineSDF":pl?"lineGradient":"line",hh=ot.context,Rh=hh.gl;let Gh=!0;for(const Kh of Ee){const ap=m.getTile(Kh);if(fl&&!ap.patternsLoaded())continue;const Lh=ap.getBucket(D);if(!Lh)continue;const op=Lh.programConfigurations.get(D.id),yp=ot.context.program.get(),Np=ot.useProgram(Ah,op),jp=Gh||Np.program!==yp,td=ot.style.map.terrain&&ot.style.map.terrain.getTerrainData(Kh),Vp=vs.constantOr(null);if(Vp&&ap.imageAtlas){const f=ap.imageAtlas,T=f.patternPositions[Vp.to.toString()],X=f.patternPositions[Vp.from.toString()];T&&X&&op.setConstantPatternPositions(T,X)}const gd=td?Kh:null,F=fl?Fm(ot,ap,D,ph,gd):ps?G_(ot,ap,D,ps,ph,gd):pl?c_(ot,ap,D,Lh.lineClipsArray.length,gd):Ly(ot,ap,D,gd);if(fl)hh.activeTexture.set(Rh.TEXTURE0),ap.imageAtlasTexture.bind(Rh.LINEAR,Rh.CLAMP_TO_EDGE),op.updatePaintBuffers(ph);else if(ps&&(jp||ot.lineAtlas.dirty))hh.activeTexture.set(Rh.TEXTURE0),ot.lineAtlas.bind(hh);else if(pl){const f=Lh.gradients[D.id];let T=f.texture;if(D.gradientVersion!==f.version){let X=256;if(D.stepInterpolant){const Ve=m.getSource().maxzoom,kt=Kh.canonical.z===Ve?Math.ceil(1<<ot.transform.maxZoom-Kh.canonical.z):1;X=a.clamp(a.nextPowerOfTwo(Lh.maxLineLength/a.EXTENT*1024*kt),256,hh.maxTextureSize)}f.gradient=a.renderColorRamp({expression:D.gradientExpression(),evaluationKey:"lineProgress",resolution:X,image:f.gradient||void 0,clips:Lh.lineClipsArray}),f.texture?f.texture.update(f.gradient):f.texture=new _l(hh,f.gradient,Rh.RGBA),f.version=D.gradientVersion,T=f.texture}hh.activeTexture.set(Rh.TEXTURE0),T.bind(D.stepInterpolant?Rh.NEAREST:Rh.LINEAR,Rh.CLAMP_TO_EDGE)}Np.draw(hh,Rh.TRIANGLES,kn,ot.stencilModeForClipping(Kh),ds,_g.disabled,F,td,D.id,Lh.layoutVertexBuffer,Lh.indexBuffer,Lh.segments,D.paint,ot.transform.zoom,op,Lh.layoutVertexBuffer2),Gh=!1}},fill:function(ot,m,D,Ee){const ct=D.paint.get("fill-color"),or=D.paint.get("fill-opacity");if(or.constantOr(1)===0)return;const kn=ot.colorModeForRenderPass(),ds=D.paint.get("fill-pattern"),ps=ot.opaquePassEnabledForLayer()&&!ds.constantOr(1)&&ct.constantOr(a.Color.transparent).a===1&&or.constantOr(0)===1?"opaque":"translucent";if(ot.renderPass===ps){const vs=ot.depthModeForSublayer(1,ot.renderPass==="opaque"?rg.ReadWrite:rg.ReadOnly);K_(ot,m,D,Ee,vs,kn,!1)}if(ot.renderPass==="translucent"&&D.paint.get("fill-antialias")){const vs=ot.depthModeForSublayer(D.getPaintProperty("fill-outline-color")?2:0,rg.ReadOnly);K_(ot,m,D,Ee,vs,kn,!0)}},"fill-extrusion":function(ot,m,D,Ee){const ct=D.paint.get("fill-extrusion-opacity");if(ct!==0&&ot.renderPass==="translucent"){const or=new rg(ot.context.gl.LEQUAL,rg.ReadWrite,ot.depthRangeFor3D);if(ct!==1||D.paint.get("fill-extrusion-pattern").constantOr(1))Z_(ot,m,D,Ee,or,jd.disabled,Lg.disabled),Z_(ot,m,D,Ee,or,ot.stencilModeFor3D(),ot.colorModeForRenderPass());else{const kn=ot.colorModeForRenderPass();Z_(ot,m,D,Ee,or,jd.disabled,kn)}}},hillshade:function(ot,m,D,Ee){if(ot.renderPass!=="offscreen"&&ot.renderPass!=="translucent")return;const ct=ot.context,or=ot.depthModeForSublayer(0,rg.ReadOnly),kn=ot.colorModeForRenderPass(),[ds,ps]=ot.renderPass==="translucent"?ot.stencilConfigForOverlap(Ee):[{},Ee];for(const vs of ps){const fl=m.getTile(vs);fl.needsHillshadePrepare!==void 0&&fl.needsHillshadePrepare&&ot.renderPass==="offscreen"?Cx(ot,fl,D,or,jd.disabled,kn):ot.renderPass==="translucent"&&W0(ot,vs,fl,D,or,ds[vs.overscaledZ],kn)}ct.viewport.set([0,0,ot.width,ot.height])},raster:function(ot,m,D,Ee){if(ot.renderPass!=="translucent"||D.paint.get("raster-opacity")===0||!Ee.length)return;const ct=ot.context,or=ct.gl,kn=m.getSource(),ds=ot.useProgram("raster"),ps=ot.colorModeForRenderPass(),[vs,fl]=kn instanceof Ad?[{},Ee]:ot.stencilConfigForOverlap(Ee),pl=fl[fl.length-1].overscaledZ,ph=!ot.options.moving;for(const Ah of fl){const hh=ot.depthModeForSublayer(Ah.overscaledZ-pl,D.paint.get("raster-opacity")===1?rg.ReadWrite:rg.ReadOnly,or.LESS),Rh=m.getTile(Ah);Rh.registerFadeDuration(D.paint.get("raster-fade-duration"));const Gh=m.findLoadedParent(Ah,0),Kh=Yg(Rh,Gh,m,D,ot.transform,ot.style.map.terrain);let ap,Lh;const op=D.paint.get("raster-resampling")==="nearest"?or.NEAREST:or.LINEAR;ct.activeTexture.set(or.TEXTURE0),Rh.texture.bind(op,or.CLAMP_TO_EDGE,or.LINEAR_MIPMAP_NEAREST),ct.activeTexture.set(or.TEXTURE1),Gh?(Gh.texture.bind(op,or.CLAMP_TO_EDGE,or.LINEAR_MIPMAP_NEAREST),ap=Math.pow(2,Gh.tileID.overscaledZ-Rh.tileID.overscaledZ),Lh=[Rh.tileID.canonical.x*ap%1,Rh.tileID.canonical.y*ap%1]):Rh.texture.bind(op,or.CLAMP_TO_EDGE,or.LINEAR_MIPMAP_NEAREST);const yp=ot.style.map.terrain&&ot.style.map.terrain.getTerrainData(Ah),Np=yp?Ah:null,jp=Np?Np.posMatrix:ot.transform.calculatePosMatrix(Ah.toUnwrapped(),ph),td=zg(jp,Lh||[0,0],ap||1,Kh,D);kn instanceof Ad?ds.draw(ct,or.TRIANGLES,hh,jd.disabled,ps,_g.disabled,td,yp,D.id,kn.boundsBuffer,ot.quadTriangleIndexBuffer,kn.boundsSegments):ds.draw(ct,or.TRIANGLES,hh,vs[Ah.overscaledZ],ps,_g.disabled,td,yp,D.id,ot.rasterBoundsBuffer,ot.quadTriangleIndexBuffer,ot.rasterBoundsSegments)}},background:function(ot,m,D,Ee){const ct=D.paint.get("background-color"),or=D.paint.get("background-opacity");if(or===0)return;const kn=ot.context,ds=kn.gl,ps=ot.transform,vs=ps.tileSize,fl=D.paint.get("background-pattern");if(ot.isPatternMissing(fl))return;const pl=!fl&&ct.a===1&&or===1&&ot.opaquePassEnabledForLayer()?"opaque":"translucent";if(ot.renderPass!==pl)return;const ph=jd.disabled,Ah=ot.depthModeForSublayer(0,pl==="opaque"?rg.ReadWrite:rg.ReadOnly),hh=ot.colorModeForRenderPass(),Rh=ot.useProgram(fl?"backgroundPattern":"background"),Gh=Ee||ps.coveringTiles({tileSize:vs,terrain:ot.style.map.terrain});fl&&(kn.activeTexture.set(ds.TEXTURE0),ot.imageManager.bind(ot.context));const Kh=D.getCrossfadeParameters();for(const ap of Gh){const Lh=Ee?ap.posMatrix:ot.transform.calculatePosMatrix(ap.toUnwrapped()),op=fl?Em(Lh,or,ot,fl,{tileID:ap,tileSize:vs},Kh):Km(Lh,or,ct),yp=ot.style.map.terrain&&ot.style.map.terrain.getTerrainData(ap);Rh.draw(kn,ds.TRIANGLES,Ah,ph,hh,_g.disabled,op,yp,D.id,ot.tileExtentBuffer,ot.quadTriangleIndexBuffer,ot.tileExtentSegments)}},debug:function(ot,m,D){for(let Ee=0;Ee<D.length;Ee++)q0(ot,m,D[Ee])},custom:function(ot,m,D){const Ee=ot.context,ct=D.implementation;if(ot.renderPass==="offscreen"){const or=ct.prerender;or&&(ot.setCustomLayerDefaults(),Ee.setColorMode(ot.colorModeForRenderPass()),or.call(ct,Ee.gl,ot.transform.customLayerMatrix()),Ee.setDirty(),ot.setBaseState())}else if(ot.renderPass==="translucent"){ot.setCustomLayerDefaults(),Ee.setColorMode(ot.colorModeForRenderPass()),Ee.setStencilMode(jd.disabled);const or=ct.renderingMode==="3d"?new rg(ot.context.gl.LEQUAL,rg.ReadWrite,ot.depthRangeFor3D):ot.depthModeForSublayer(0,rg.ReadOnly);Ee.setDepthMode(or),ct.render(Ee.gl,ot.transform.customLayerMatrix()),Ee.setDirty(),ot.setBaseState(),Ee.bindFramebuffer.set(null)}}};class Z0{constructor(m,D){this.context=new Pv(m),this.transform=D,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.create(),renderTime:0},this.setup(),this.numSublayers=yd.maxUnderzooming+yd.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new fy}resize(m,D,Ee){if(this.width=m*Ee,this.height=D*Ee,this.pixelRatio=Ee,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const ct of this.style._order)this.style._layers[ct].resize()}setup(){const m=this.context,D=new a.PosArray;D.emplaceBack(0,0),D.emplaceBack(a.EXTENT,0),D.emplaceBack(0,a.EXTENT),D.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=m.createVertexBuffer(D,my.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const Ee=new a.PosArray;Ee.emplaceBack(0,0),Ee.emplaceBack(a.EXTENT,0),Ee.emplaceBack(0,a.EXTENT),Ee.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=m.createVertexBuffer(Ee,my.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const ct=new a.RasterBoundsArray;ct.emplaceBack(0,0,0,0),ct.emplaceBack(a.EXTENT,0,a.EXTENT,0),ct.emplaceBack(0,a.EXTENT,0,a.EXTENT),ct.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.rasterBoundsBuffer=m.createVertexBuffer(ct,Kp.members),this.rasterBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const or=new a.PosArray;or.emplaceBack(0,0),or.emplaceBack(1,0),or.emplaceBack(0,1),or.emplaceBack(1,1),this.viewportBuffer=m.createVertexBuffer(or,my.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const kn=new a.LineStripIndexArray;kn.emplaceBack(0),kn.emplaceBack(1),kn.emplaceBack(3),kn.emplaceBack(2),kn.emplaceBack(0),this.tileBorderIndexBuffer=m.createIndexBuffer(kn);const ds=new a.TriangleIndexArray;ds.emplaceBack(0,1,2),ds.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=m.createIndexBuffer(ds);const ps=this.context.gl;this.stencilClearMode=new jd({func:ps.ALWAYS,mask:0},0,255,ps.ZERO,ps.ZERO,ps.ZERO)}clearStencil(){const m=this.context,D=m.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const Ee=a.create();a.ortho(Ee,0,this.width,this.height,0,0,1),a.scale(Ee,Ee,[D.drawingBufferWidth,D.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(m,D.TRIANGLES,rg.disabled,this.stencilClearMode,Lg.disabled,_g.disabled,z_(Ee),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(m,D){if(this.currentStencilSource===m.source||!m.isTileClipped()||!D||!D.length)return;this.currentStencilSource=m.source;const Ee=this.context,ct=Ee.gl;this.nextStencilID+D.length>256&&this.clearStencil(),Ee.setColorMode(Lg.disabled),Ee.setDepthMode(rg.disabled);const or=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const kn of D){const ds=this._tileClippingMaskIDs[kn.key]=this.nextStencilID++,ps=this.style.map.terrain&&this.style.map.terrain.getTerrainData(kn);or.draw(Ee,ct.TRIANGLES,rg.disabled,new jd({func:ct.ALWAYS,mask:0},ds,255,ct.KEEP,ct.KEEP,ct.REPLACE),Lg.disabled,_g.disabled,z_(kn.posMatrix),ps,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const m=this.nextStencilID++,D=this.context.gl;return new jd({func:D.NOTEQUAL,mask:255},m,255,D.KEEP,D.KEEP,D.REPLACE)}stencilModeForClipping(m){const D=this.context.gl;return new jd({func:D.EQUAL,mask:255},this._tileClippingMaskIDs[m.key],0,D.KEEP,D.KEEP,D.REPLACE)}stencilConfigForOverlap(m){const D=this.context.gl,Ee=m.sort((kn,ds)=>ds.overscaledZ-kn.overscaledZ),ct=Ee[Ee.length-1].overscaledZ,or=Ee[0].overscaledZ-ct+1;if(or>1){this.currentStencilSource=void 0,this.nextStencilID+or>256&&this.clearStencil();const kn={};for(let ds=0;ds<or;ds++)kn[ds+ct]=new jd({func:D.GEQUAL,mask:255},ds+this.nextStencilID,255,D.KEEP,D.KEEP,D.REPLACE);return this.nextStencilID+=or,[kn,Ee]}return[{[ct]:jd.disabled},Ee]}colorModeForRenderPass(){const m=this.context.gl;return this._showOverdrawInspector?new Lg([m.CONSTANT_COLOR,m.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Lg.unblended:Lg.alphaBlended}depthModeForSublayer(m,D,Ee){if(!this.opaquePassEnabledForLayer())return rg.disabled;const ct=1-((1+this.currentLayer)*this.numSublayers+m)*this.depthEpsilon;return new rg(Ee||this.context.gl.LEQUAL,D,[ct,ct])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(m,D){this.style=m,this.options=D,this.lineAtlas=m.lineAtlas,this.imageManager=m.imageManager,this.glyphManager=m.glyphManager,this.symbolFadeChange=m.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const Ee=this.style._order,ct=this.style.sourceCaches,or={},kn={},ds={};for(const ps in ct){const vs=ct[ps];vs.used&&vs.prepare(this.context),or[ps]=vs.getVisibleCoordinates(),kn[ps]=or[ps].slice().reverse(),ds[ps]=vs.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let ps=0;ps<Ee.length;ps++)if(this.style._layers[Ee[ps]].is3D()){this.opaquePassCutoff=ps;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const ps=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!a.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||ps.length)&&(a.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(vs,fl){const pl=vs.context,ph=pl.gl,Ah=Lg.unblended,hh=new rg(ph.LEQUAL,rg.ReadWrite,[0,1]),Rh=fl.getTerrainMesh(),Gh=fl.sourceCache.getRenderableTiles(),Kh=vs.useProgram("terrainDepth");pl.bindFramebuffer.set(fl.getFramebuffer("depth").framebuffer),pl.viewport.set([0,0,vs.width/devicePixelRatio,vs.height/devicePixelRatio]),pl.clear({color:a.Color.transparent,depth:1});for(const ap of Gh){const Lh=fl.getTerrainData(ap.tileID),op={u_matrix:vs.transform.calculatePosMatrix(ap.tileID.toUnwrapped()),u_ele_delta:fl.getMeshFrameDelta(vs.transform.zoom)};Kh.draw(pl,ph.TRIANGLES,hh,jd.disabled,Ah,_g.backCCW,op,Lh,"terrain",Rh.vertexBuffer,Rh.indexBuffer,Rh.segments)}pl.bindFramebuffer.set(null),pl.viewport.set([0,0,vs.width,vs.height])}(this,this.style.map.terrain),function(vs,fl){const pl=vs.context,ph=pl.gl,Ah=Lg.unblended,hh=new rg(ph.LEQUAL,rg.ReadWrite,[0,1]),Rh=fl.getTerrainMesh(),Gh=fl.getCoordsTexture(),Kh=fl.sourceCache.getRenderableTiles(),ap=vs.useProgram("terrainCoords");pl.bindFramebuffer.set(fl.getFramebuffer("coords").framebuffer),pl.viewport.set([0,0,vs.width/devicePixelRatio,vs.height/devicePixelRatio]),pl.clear({color:a.Color.transparent,depth:1}),fl.coordsIndex=[];for(const Lh of Kh){const op=fl.getTerrainData(Lh.tileID);pl.activeTexture.set(ph.TEXTURE0),ph.bindTexture(ph.TEXTURE_2D,Gh.texture);const yp={u_matrix:vs.transform.calculatePosMatrix(Lh.tileID.toUnwrapped()),u_terrain_coords_id:(255-fl.coordsIndex.length)/255,u_texture:0,u_ele_delta:fl.getMeshFrameDelta(vs.transform.zoom)};ap.draw(pl,ph.TRIANGLES,hh,jd.disabled,Ah,_g.backCCW,yp,op,"terrain",Rh.vertexBuffer,Rh.indexBuffer,Rh.segments),fl.coordsIndex.push(Lh.tileID.key)}pl.bindFramebuffer.set(null),pl.viewport.set([0,0,vs.width,vs.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const ps of Ee){const vs=this.style._layers[ps];if(!vs.hasOffscreenPass()||vs.isHidden(this.transform.zoom))continue;const fl=kn[vs.source];(vs.type==="custom"||fl.length)&&this.renderLayer(this,ct[vs.source],vs,fl)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:D.showOverdrawInspector?a.Color.black:a.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=D.showOverdrawInspector,this.depthRangeFor3D=[0,1-(m._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=Ee.length-1;this.currentLayer>=0;this.currentLayer--){const ps=this.style._layers[Ee[this.currentLayer]],vs=ct[ps.source],fl=or[ps.source];this._renderTileClippingMasks(ps,fl),this.renderLayer(this,vs,ps,fl)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<Ee.length;this.currentLayer++){const ps=this.style._layers[Ee[this.currentLayer]],vs=ct[ps.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(ps))continue;const fl=(ps.type==="symbol"?ds:kn)[ps.source];this._renderTileClippingMasks(ps,or[ps.source]),this.renderLayer(this,vs,ps,fl)}if(this.options.showTileBoundaries){const ps=function(vs,fl){let pl=null;const ph=Object.values(vs._layers).flatMap(Gh=>Gh.source&&!Gh.isHidden(fl)?[vs.sourceCaches[Gh.source]]:[]),Ah=ph.filter(Gh=>Gh.getSource().type==="vector"),hh=ph.filter(Gh=>Gh.getSource().type!=="vector"),Rh=Gh=>{(!pl||pl.getSource().maxzoom<Gh.getSource().maxzoom)&&(pl=Gh)};return Ah.forEach(Gh=>Rh(Gh)),pl||hh.forEach(Gh=>Rh(Gh)),pl}(this.style,this.transform.zoom);ps&&K0.debug(this,ps,ps.getVisibleCoordinates())}this.options.showPadding&&function(ps){const vs=ps.transform.padding;Qy(ps,ps.transform.height-(vs.top||0),3,X_),Qy(ps,vs.bottom||0,3,Nm),Zm(ps,vs.left||0,3,Y_),Zm(ps,ps.transform.width-(vs.right||0),3,g0);const fl=ps.transform.centerPoint;(function(pl,ph,Ah,hh){e_(pl,ph-1,Ah-10,2,20,hh),e_(pl,ph-10,Ah-1,20,2,hh)})(ps,fl.x,ps.transform.height-fl.y,Dv)}(this),this.context.setDefault()}renderLayer(m,D,Ee,ct){Ee.isHidden(this.transform.zoom)||(Ee.type==="background"||Ee.type==="custom"||(ct||[]).length)&&(this.id=Ee.id,K0[Ee.type](m,D,Ee,ct,this.style.placement.variableOffsets))}translatePosMatrix(m,D,Ee,ct,or){if(!Ee[0]&&!Ee[1])return m;const kn=or?ct==="map"?this.transform.angle:0:ct==="viewport"?-this.transform.angle:0;if(kn){const vs=Math.sin(kn),fl=Math.cos(kn);Ee=[Ee[0]*fl-Ee[1]*vs,Ee[0]*vs+Ee[1]*fl]}const ds=[or?Ee[0]:vh(D,Ee[0],this.transform.zoom),or?Ee[1]:vh(D,Ee[1],this.transform.zoom),0],ps=new Float32Array(16);return a.translate(ps,m,ds),ps}saveTileTexture(m){const D=this._tileTextures[m.size[0]];D?D.push(m):this._tileTextures[m.size[0]]=[m]}getTileTexture(m){const D=this._tileTextures[m];return D&&D.length>0?D.pop():null}isPatternMissing(m){if(!m)return!1;if(!m.from||!m.to)return!0;const D=this.imageManager.getPattern(m.from.toString()),Ee=this.imageManager.getPattern(m.to.toString());return!D||!Ee}useProgram(m,D){this.cache=this.cache||{};const Ee=m+(D?D.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[Ee]||(this.cache[Ee]=new Hf(this.context,m,qy[m],D,Gg[m],this._showOverdrawInspector,this.style.map.terrain)),this.cache[Ee]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const m=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(m.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new _l(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class X0{constructor(m,D){this.points=m,this.planes=D}static fromInvProjectionMatrix(m,D,Ee){const ct=Math.pow(2,Ee),or=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(ds=>{const ps=1/(ds=a.transformMat4([],ds,m))[3]/D*ct;return a.mul$1(ds,ds,[ps,ps,1/ds[3],ps])}),kn=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(ds=>{const ps=function(ph,Ah){var hh=Ah[0],Rh=Ah[1],Gh=Ah[2],Kh=hh*hh+Rh*Rh+Gh*Gh;return Kh>0&&(Kh=1/Math.sqrt(Kh)),ph[0]=Ah[0]*Kh,ph[1]=Ah[1]*Kh,ph[2]=Ah[2]*Kh,ph}([],function(ph,Ah,hh){var Rh=Ah[0],Gh=Ah[1],Kh=Ah[2],ap=hh[0],Lh=hh[1],op=hh[2];return ph[0]=Gh*op-Kh*Lh,ph[1]=Kh*ap-Rh*op,ph[2]=Rh*Lh-Gh*ap,ph}([],ml([],or[ds[0]],or[ds[1]]),ml([],or[ds[2]],or[ds[1]]))),vs=-((fl=ps)[0]*(pl=or[ds[1]])[0]+fl[1]*pl[1]+fl[2]*pl[2]);var fl,pl;return ps.concat(vs)});return new X0(or,kn)}}class vy{constructor(m,D){this.min=m,this.max=D,this.center=function(Ee,ct,or){return Ee[0]=.5*ct[0],Ee[1]=.5*ct[1],Ee[2]=.5*ct[2],Ee}([],function(Ee,ct,or){return Ee[0]=ct[0]+or[0],Ee[1]=ct[1]+or[1],Ee[2]=ct[2]+or[2],Ee}([],this.min,this.max))}quadrant(m){const D=[m%2==0,m<2],Ee=ia(this.min),ct=ia(this.max);for(let or=0;or<D.length;or++)Ee[or]=D[or]?this.min[or]:this.center[or],ct[or]=D[or]?this.center[or]:this.max[or];return ct[2]=this.max[2],new vy(Ee,ct)}distanceX(m){return Math.max(Math.min(this.max[0],m[0]),this.min[0])-m[0]}distanceY(m){return Math.max(Math.min(this.max[1],m[1]),this.min[1])-m[1]}intersects(m){const D=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let Ee=!0;for(let ct=0;ct<m.planes.length;ct++){const or=m.planes[ct];let kn=0;for(let ds=0;ds<D.length;ds++)a.dot(or,D[ds])>=0&&kn++;if(kn===0)return 0;kn!==D.length&&(Ee=!1)}if(Ee)return 2;for(let ct=0;ct<3;ct++){let or=Number.MAX_VALUE,kn=-Number.MAX_VALUE;for(let ds=0;ds<m.points.length;ds++){const ps=m.points[ds][ct]-this.min[ct];or=Math.min(or,ps),kn=Math.max(kn,ps)}if(kn<0||or>this.max[ct]-this.min[ct])return 0}return 1}}class J_{constructor(m=0,D=0,Ee=0,ct=0){if(isNaN(m)||m<0||isNaN(D)||D<0||isNaN(Ee)||Ee<0||isNaN(ct)||ct<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=m,this.bottom=D,this.left=Ee,this.right=ct}interpolate(m,D,Ee){return D.top!=null&&m.top!=null&&(this.top=a.interpolate.number(m.top,D.top,Ee)),D.bottom!=null&&m.bottom!=null&&(this.bottom=a.interpolate.number(m.bottom,D.bottom,Ee)),D.left!=null&&m.left!=null&&(this.left=a.interpolate.number(m.left,D.left,Ee)),D.right!=null&&m.right!=null&&(this.right=a.interpolate.number(m.right,D.right,Ee)),this}getCenter(m,D){const Ee=a.clamp((this.left+m-this.right)/2,0,m),ct=a.clamp((this.top+D-this.bottom)/2,0,D);return new a.Point(Ee,ct)}equals(m){return this.top===m.top&&this.bottom===m.bottom&&this.left===m.left&&this.right===m.right}clone(){return new J_(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class m_{constructor(m,D,Ee,ct,or){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=or===void 0||!!or,this._minZoom=m||0,this._maxZoom=D||22,this._minPitch=Ee??0,this._maxPitch=ct??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new J_,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const m=new m_(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return m.apply(this),m}apply(m){this.tileSize=m.tileSize,this.latRange=m.latRange,this.width=m.width,this.height=m.height,this._center=m._center,this._elevation=m._elevation,this.zoom=m.zoom,this.angle=m.angle,this._fov=m._fov,this._pitch=m._pitch,this._unmodified=m._unmodified,this._edgeInsets=m._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(m){this._minZoom!==m&&(this._minZoom=m,this.zoom=Math.max(this.zoom,m))}get maxZoom(){return this._maxZoom}set maxZoom(m){this._maxZoom!==m&&(this._maxZoom=m,this.zoom=Math.min(this.zoom,m))}get minPitch(){return this._minPitch}set minPitch(m){this._minPitch!==m&&(this._minPitch=m,this.pitch=Math.max(this.pitch,m))}get maxPitch(){return this._maxPitch}set maxPitch(m){this._maxPitch!==m&&(this._maxPitch=m,this.pitch=Math.min(this.pitch,m))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(m){m===void 0?m=!0:m===null&&(m=!1),this._renderWorldCopies=m}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.Point(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(m){const D=-a.wrap(m,-180,180)*Math.PI/180;this.angle!==D&&(this._unmodified=!1,this.angle=D,this._calcMatrices(),this.rotationMatrix=function(){var Ee=new a.ARRAY_TYPE(4);return a.ARRAY_TYPE!=Float32Array&&(Ee[1]=0,Ee[2]=0),Ee[0]=1,Ee[3]=1,Ee}(),function(Ee,ct,or){var kn=ct[0],ds=ct[1],ps=ct[2],vs=ct[3],fl=Math.sin(or),pl=Math.cos(or);Ee[0]=kn*pl+ps*fl,Ee[1]=ds*pl+vs*fl,Ee[2]=kn*-fl+ps*pl,Ee[3]=ds*-fl+vs*pl}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(m){const D=a.clamp(m,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==D&&(this._unmodified=!1,this._pitch=D,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(m){m=Math.max(.01,Math.min(60,m)),this._fov!==m&&(this._unmodified=!1,this._fov=m/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(m){const D=Math.min(Math.max(m,this.minZoom),this.maxZoom);this._zoom!==D&&(this._unmodified=!1,this._zoom=D,this.tileZoom=Math.max(0,Math.floor(D)),this.scale=this.zoomScale(D),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(m){m.lat===this._center.lat&&m.lng===this._center.lng||(this._unmodified=!1,this._center=m,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(m){m!==this._elevation&&(this._elevation=m,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(m){this._edgeInsets.equals(m)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,m,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(m){return this._edgeInsets.equals(m)}interpolatePadding(m,D,Ee){this._unmodified=!1,this._edgeInsets.interpolate(m,D,Ee),this._constrain(),this._calcMatrices()}coveringZoomLevel(m){const D=(m.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/m.tileSize));return Math.max(0,D)}getVisibleUnwrappedCoordinates(m){const D=[new a.UnwrappedTileID(0,m)];if(this._renderWorldCopies){const Ee=this.pointCoordinate(new a.Point(0,0)),ct=this.pointCoordinate(new a.Point(this.width,0)),or=this.pointCoordinate(new a.Point(this.width,this.height)),kn=this.pointCoordinate(new a.Point(0,this.height)),ds=Math.floor(Math.min(Ee.x,ct.x,or.x,kn.x)),ps=Math.floor(Math.max(Ee.x,ct.x,or.x,kn.x)),vs=1;for(let fl=ds-vs;fl<=ps+vs;fl++)fl!==0&&D.push(new a.UnwrappedTileID(fl,m))}return D}coveringTiles(m){var D,Ee;let ct=this.coveringZoomLevel(m);const or=ct;if(m.minzoom!==void 0&&ct<m.minzoom)return[];m.maxzoom!==void 0&&ct>m.maxzoom&&(ct=m.maxzoom);const kn=this.pointCoordinate(this.getCameraPoint()),ds=a.MercatorCoordinate.fromLngLat(this.center),ps=Math.pow(2,ct),vs=[ps*kn.x,ps*kn.y,0],fl=[ps*ds.x,ps*ds.y,0],pl=X0.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,ct);let ph=m.minzoom||0;!m.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(ph=ct);const Ah=m.terrain?2/Math.min(this.tileSize,m.tileSize)*this.tileSize:3,hh=Lh=>({aabb:new vy([Lh*ps,0,0],[(Lh+1)*ps,ps,0]),zoom:0,x:0,y:0,wrap:Lh,fullyVisible:!1}),Rh=[],Gh=[],Kh=ct,ap=m.reparseOverscaled?or:ct;if(this._renderWorldCopies)for(let Lh=1;Lh<=3;Lh++)Rh.push(hh(-Lh)),Rh.push(hh(Lh));for(Rh.push(hh(0));Rh.length>0;){const Lh=Rh.pop(),op=Lh.x,yp=Lh.y;let Np=Lh.fullyVisible;if(!Np){const F=Lh.aabb.intersects(pl);if(F===0)continue;Np=F===2}const jp=m.terrain?vs:fl,td=Lh.aabb.distanceX(jp),Vp=Lh.aabb.distanceY(jp),gd=Math.max(Math.abs(td),Math.abs(Vp));if(Lh.zoom===Kh||gd>Ah+(1<<Kh-Lh.zoom)-2&&Lh.zoom>=ph){const F=Kh-Lh.zoom,f=vs[0]-.5-(op<<F),T=vs[1]-.5-(yp<<F);Gh.push({tileID:new a.OverscaledTileID(Lh.zoom===Kh?ap:Lh.zoom,Lh.wrap,Lh.zoom,op,yp),distanceSq:il([fl[0]-.5-op,fl[1]-.5-yp]),tileDistanceToCamera:Math.sqrt(f*f+T*T)})}else for(let F=0;F<4;F++){const f=(op<<1)+F%2,T=(yp<<1)+(F>>1),X=Lh.zoom+1;let Ve=Lh.aabb.quadrant(F);if(m.terrain){const kt=new a.OverscaledTileID(X,Lh.wrap,X,f,T),Hr=m.terrain.getMinMaxElevation(kt),pi=(D=Hr.minElevation)!==null&&D!==void 0?D:this.elevation,Vn=(Ee=Hr.maxElevation)!==null&&Ee!==void 0?Ee:this.elevation;Ve=new vy([Ve.min[0],Ve.min[1],pi],[Ve.max[0],Ve.max[1],Vn])}Rh.push({aabb:Ve,zoom:X,x:f,y:T,wrap:Lh.wrap,fullyVisible:Np})}}return Gh.sort((Lh,op)=>Lh.distanceSq-op.distanceSq).map(Lh=>Lh.tileID)}resize(m,D){this.width=m,this.height=D,this.pixelsToGLUnits=[2/m,-2/D],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(m){return Math.pow(2,m)}scaleZoom(m){return Math.log(m)/Math.LN2}project(m){const D=a.clamp(m.lat,-this.maxValidLatitude,this.maxValidLatitude);return new a.Point(a.mercatorXfromLng(m.lng)*this.worldSize,a.mercatorYfromLat(D)*this.worldSize)}unproject(m){return new a.MercatorCoordinate(m.x/this.worldSize,m.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(m){this.freezeElevation||(this.elevation=m?this.getElevation(this._center,m):0)}getElevation(m,D){const Ee=a.MercatorCoordinate.fromLngLat(m.wrap()),ct=(1<<this.tileZoom)*a.EXTENT,or=Ee.x*ct,kn=Ee.y*ct,ds=Math.floor(or/a.EXTENT),ps=Math.floor(kn/a.EXTENT),vs=new a.OverscaledTileID(this.tileZoom,0,this.tileZoom,ds,ps);return D.getElevation(vs,or%a.EXTENT,kn%a.EXTENT,a.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(m){const D=this.pointLocation(this.centerPoint,m),Ee=this.getElevation(D,m);if(!(this.elevation-Ee))return;const ct=this.getCameraPosition(),or=a.MercatorCoordinate.fromLngLat(ct.lngLat,ct.altitude),kn=a.MercatorCoordinate.fromLngLat(D,Ee),ds=or.x-kn.x,ps=or.y-kn.y,vs=or.z-kn.z,fl=Math.sqrt(ds*ds+ps*ps+vs*vs),pl=this.scaleZoom(this.cameraToCenterDistance/fl/this.tileSize);this._elevation=Ee,this._center=D,this.zoom=pl}setLocationAtPoint(m,D){const Ee=this.pointCoordinate(D),ct=this.pointCoordinate(this.centerPoint),or=this.locationCoordinate(m),kn=new a.MercatorCoordinate(or.x-(Ee.x-ct.x),or.y-(Ee.y-ct.y));this.center=this.coordinateLocation(kn),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(m,D){return D?this.coordinatePoint(this.locationCoordinate(m),this.getElevation(m,D),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(m))}pointLocation(m,D){return this.coordinateLocation(this.pointCoordinate(m,D))}locationCoordinate(m){return a.MercatorCoordinate.fromLngLat(m)}coordinateLocation(m){return m&&m.toLngLat()}pointCoordinate(m,D){if(D){const ph=D.pointCoordinate(m);if(ph!=null)return ph}const Ee=[m.x,m.y,0,1],ct=[m.x,m.y,1,1];a.transformMat4(Ee,Ee,this.pixelMatrixInverse),a.transformMat4(ct,ct,this.pixelMatrixInverse);const or=Ee[3],kn=ct[3],ds=Ee[1]/or,ps=ct[1]/kn,vs=Ee[2]/or,fl=ct[2]/kn,pl=vs===fl?0:(0-vs)/(fl-vs);return new a.MercatorCoordinate(a.interpolate.number(Ee[0]/or,ct[0]/kn,pl)/this.worldSize,a.interpolate.number(ds,ps,pl)/this.worldSize)}coordinatePoint(m,D=0,Ee=this.pixelMatrix){const ct=[m.x*this.worldSize,m.y*this.worldSize,D,1];return a.transformMat4(ct,ct,Ee),new a.Point(ct[0]/ct[3],ct[1]/ct[3])}getBounds(){const m=Math.max(0,this.height/2-this.getHorizon());return new Rp().extend(this.pointLocation(new a.Point(0,m))).extend(this.pointLocation(new a.Point(this.width,m))).extend(this.pointLocation(new a.Point(this.width,this.height))).extend(this.pointLocation(new a.Point(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Rp([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(m){m?(this.lngRange=[m.getWest(),m.getEast()],this.latRange=[m.getSouth(),m.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(m,D=!1){const Ee=m.key,ct=D?this._alignedPosMatrixCache:this._posMatrixCache;if(ct[Ee])return ct[Ee];const or=m.canonical,kn=this.worldSize/this.zoomScale(or.z),ds=or.x+Math.pow(2,or.z)*m.wrap,ps=a.identity(new Float64Array(16));return a.translate(ps,ps,[ds*kn,or.y*kn,0]),a.scale(ps,ps,[kn/a.EXTENT,kn/a.EXTENT,1]),a.multiply(ps,D?this.alignedProjMatrix:this.projMatrix,ps),ct[Ee]=new Float32Array(ps),ct[Ee]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let m,D,Ee,ct,or=-90,kn=90,ds=-180,ps=180;const vs=this.size,fl=this._unmodified;if(this.latRange){const Ah=this.latRange;or=a.mercatorYfromLat(Ah[1])*this.worldSize,kn=a.mercatorYfromLat(Ah[0])*this.worldSize,m=kn-or<vs.y?vs.y/(kn-or):0}if(this.lngRange){const Ah=this.lngRange;ds=a.wrap(a.mercatorXfromLng(Ah[0])*this.worldSize,0,this.worldSize),ps=a.wrap(a.mercatorXfromLng(Ah[1])*this.worldSize,0,this.worldSize),ps<ds&&(ps+=this.worldSize),D=ps-ds<vs.x?vs.x/(ps-ds):0}const pl=this.point,ph=Math.max(D||0,m||0);if(ph)return this.center=this.unproject(new a.Point(D?(ps+ds)/2:pl.x,m?(kn+or)/2:pl.y)),this.zoom+=this.scaleZoom(ph),this._unmodified=fl,void(this._constraining=!1);if(this.latRange){const Ah=pl.y,hh=vs.y/2;Ah-hh<or&&(ct=or+hh),Ah+hh>kn&&(ct=kn-hh)}if(this.lngRange){const Ah=(ds+ps)/2,hh=a.wrap(pl.x,Ah-this.worldSize/2,Ah+this.worldSize/2),Rh=vs.x/2;hh-Rh<ds&&(Ee=ds+Rh),hh+Rh>ps&&(Ee=ps-Rh)}Ee===void 0&&ct===void 0||(this.center=this.unproject(new a.Point(Ee!==void 0?Ee:pl.x,ct!==void 0?ct:pl.y)).wrap()),this._unmodified=fl,this._constraining=!1}_calcMatrices(){if(!this.height)return;const m=this.centerOffset,D=this.point.x,Ee=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let ct=a.identity(new Float64Array(16));a.scale(ct,ct,[this.width/2,-this.height/2,1]),a.translate(ct,ct,[1,-1,0]),this.labelPlaneMatrix=ct,ct=a.identity(new Float64Array(16)),a.scale(ct,ct,[1,-1,1]),a.translate(ct,ct,[-1,-1,0]),a.scale(ct,ct,[2/this.width,2/this.height,1]),this.glCoordMatrix=ct,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const or=this._elevation<0?this.cameraToCenterDistance:this.cameraToSeaLevelDistance,kn=Math.PI/2+this._pitch,ds=this._fov*(.5+m.y/this.height),ps=Math.sin(ds)*or/Math.sin(a.clamp(Math.PI-kn-ds,.01,Math.PI-.01)),vs=this.getHorizon(),fl=2*Math.atan(vs/this.cameraToCenterDistance)*(.5+m.y/(2*vs)),pl=Math.sin(fl)*or/Math.sin(a.clamp(Math.PI-kn-fl,.01,Math.PI-.01)),ph=Math.min(ps,pl),Ah=1.01*(Math.cos(Math.PI/2-this._pitch)*ph+or),hh=this.height/50;ct=new Float64Array(16),a.perspective(ct,this._fov,this.width/this.height,hh,Ah),ct[8]=2*-m.x/this.width,ct[9]=2*m.y/this.height,a.scale(ct,ct,[1,-1,1]),a.translate(ct,ct,[0,0,-this.cameraToCenterDistance]),a.rotateX(ct,ct,this._pitch),a.rotateZ(ct,ct,this.angle),a.translate(ct,ct,[-D,-Ee,0]),this.mercatorMatrix=a.scale([],ct,[this.worldSize,this.worldSize,this.worldSize]),a.scale(ct,ct,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,ct),a.translate(ct,ct,[0,0,-this.elevation]),this.projMatrix=ct,this.invProjMatrix=a.invert([],ct),this.pixelMatrix3D=a.multiply(new Float64Array(16),this.labelPlaneMatrix,ct);const Rh=this.width%2/2,Gh=this.height%2/2,Kh=Math.cos(this.angle),ap=Math.sin(this.angle),Lh=D-Math.round(D)+Kh*Rh+ap*Gh,op=Ee-Math.round(Ee)+Kh*Gh+ap*Rh,yp=new Float64Array(ct);if(a.translate(yp,yp,[Lh>.5?Lh-1:Lh,op>.5?op-1:op,0]),this.alignedProjMatrix=yp,ct=a.invert(new Float64Array(16),this.pixelMatrix),!ct)throw new Error("failed to invert matrix");this.pixelMatrixInverse=ct,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const m=this.pointCoordinate(new a.Point(0,0)),D=[m.x*this.worldSize,m.y*this.worldSize,0,1];return a.transformMat4(D,D,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const m=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.Point(0,m))}getCameraQueryGeometry(m){const D=this.getCameraPoint();if(m.length===1)return[m[0],D];{let Ee=D.x,ct=D.y,or=D.x,kn=D.y;for(const ds of m)Ee=Math.min(Ee,ds.x),ct=Math.min(ct,ds.y),or=Math.max(or,ds.x),kn=Math.max(kn,ds.y);return[new a.Point(Ee,ct),new a.Point(or,ct),new a.Point(or,kn),new a.Point(Ee,kn),new a.Point(Ee,ct)]}}}class Ex{constructor(m){this._hashName=m&&encodeURIComponent(m),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(D,Ee){let ct=!1,or=null;const kn=()=>{or=null,ct&&(D(),or=setTimeout(kn,300),ct=!1)};return()=>(ct=!0,or||kn(),or)}(this._updateHashUnthrottled.bind(this))}addTo(m){return this._map=m,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(m){const D=this._map.getCenter(),Ee=Math.round(100*this._map.getZoom())/100,ct=Math.ceil((Ee*Math.LN2+Math.log(512/360/.5))/Math.LN10),or=Math.pow(10,ct),kn=Math.round(D.lng*or)/or,ds=Math.round(D.lat*or)/or,ps=this._map.getBearing(),vs=this._map.getPitch();let fl="";if(fl+=m?`/${kn}/${ds}/${Ee}`:`${Ee}/${ds}/${kn}`,(ps||vs)&&(fl+="/"+Math.round(10*ps)/10),vs&&(fl+=`/${Math.round(vs)}`),this._hashName){const pl=this._hashName;let ph=!1;const Ah=window.location.hash.slice(1).split("&").map(hh=>{const Rh=hh.split("=")[0];return Rh===pl?(ph=!0,`${Rh}=${fl}`):hh}).filter(hh=>hh);return ph||Ah.push(`${pl}=${fl}`),`#${Ah.join("&")}`}return`#${fl}`}_getCurrentHash(){const m=window.location.hash.replace("#","");if(this._hashName){let D;return m.split("&").map(Ee=>Ee.split("=")).forEach(Ee=>{Ee[0]===this._hashName&&(D=Ee)}),(D&&D[1]||"").split("/")}return m.split("/")}_onHashChange(){const m=this._getCurrentHash();if(m.length>=3&&!m.some(D=>isNaN(D))){const D=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(m[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+m[2],+m[1]],zoom:+m[0],bearing:D,pitch:+(m[4]||0)}),!0}return!1}_updateHashUnthrottled(){const m=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,m)}catch{}}}const Q_={linearity:.3,easing:a.bezier(0,0,.3,1)},$x=a.extend({deceleration:2500,maxSpeed:1400},Q_),Y0=a.extend({deceleration:20,maxSpeed:1400},Q_),Lv=a.extend({deceleration:1e3,maxSpeed:360},Q_),Fv=a.extend({deceleration:1e3,maxSpeed:90},Q_);class Ry{constructor(m){this._map=m,this.clear()}clear(){this._inertiaBuffer=[]}record(m){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:m})}_drainInertiaBuffer(){const m=this._inertiaBuffer,D=a.exported.now();for(;m.length>0&&D-m[0].time>160;)m.shift()}_onMoveEnd(m){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const D={zoom:0,bearing:0,pitch:0,pan:new a.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:or}of this._inertiaBuffer)D.zoom+=or.zoomDelta||0,D.bearing+=or.bearingDelta||0,D.pitch+=or.pitchDelta||0,or.panDelta&&D.pan._add(or.panDelta),or.around&&(D.around=or.around),or.pinchAround&&(D.pinchAround=or.pinchAround);const Ee=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,ct={};if(D.pan.mag()){const or=Nv(D.pan.mag(),Ee,a.extend({},$x,m||{}));ct.offset=D.pan.mult(or.amount/D.pan.mag()),ct.center=this._map.transform.center,$m(ct,or)}if(D.zoom){const or=Nv(D.zoom,Ee,Y0);ct.zoom=this._map.transform.zoom+or.amount,$m(ct,or)}if(D.bearing){const or=Nv(D.bearing,Ee,Lv);ct.bearing=this._map.transform.bearing+a.clamp(or.amount,-179,179),$m(ct,or)}if(D.pitch){const or=Nv(D.pitch,Ee,Fv);ct.pitch=this._map.transform.pitch+or.amount,$m(ct,or)}if(ct.zoom||ct.bearing){const or=D.pinchAround===void 0?D.around:D.pinchAround;ct.around=or?this._map.unproject(or):this._map.getCenter()}return this.clear(),a.extend(ct,{noMoveStart:!0})}}function $m(ot,m){(!ot.duration||ot.duration<m.duration)&&(ot.duration=m.duration,ot.easing=m.easing)}function Nv(ot,m,D){const{maxSpeed:Ee,linearity:ct,deceleration:or}=D,kn=a.clamp(ot*ct/(m/1e3),-Ee,Ee),ds=Math.abs(kn)/(or*ct);return{easing:D.easing,duration:1e3*ds,amount:kn*(ds/2)}}class Vg extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(m,D,Ee,ct={}){const or=y.mousePos(D.getCanvasContainer(),Ee),kn=D.unproject(or);super(m,a.extend({point:or,lngLat:kn,originalEvent:Ee},ct)),this._defaultPrevented=!1,this.target=D}}class y_ extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(m,D,Ee){const ct=m==="touchend"?Ee.changedTouches:Ee.touches,or=y.touchPos(D.getCanvasContainer(),ct),kn=or.map(ps=>D.unproject(ps)),ds=or.reduce((ps,vs,fl,pl)=>ps.add(vs.div(pl.length)),new a.Point(0,0));super(m,{points:or,point:ds,lngLats:kn,lngLat:D.unproject(ds),originalEvent:Ee}),this._defaultPrevented=!1}}class xw extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(m,D,Ee){super(m,{originalEvent:Ee}),this._defaultPrevented=!1}}class ww{constructor(m,D){this._map=m,this._clickTolerance=D.clickTolerance}reset(){delete this._mousedownPos}wheel(m){return this._firePreventable(new xw(m.type,this._map,m))}mousedown(m,D){return this._mousedownPos=D,this._firePreventable(new Vg(m.type,this._map,m))}mouseup(m){this._map.fire(new Vg(m.type,this._map,m))}click(m,D){this._mousedownPos&&this._mousedownPos.dist(D)>=this._clickTolerance||this._map.fire(new Vg(m.type,this._map,m))}dblclick(m){return this._firePreventable(new Vg(m.type,this._map,m))}mouseover(m){this._map.fire(new Vg(m.type,this._map,m))}mouseout(m){this._map.fire(new Vg(m.type,this._map,m))}touchstart(m){return this._firePreventable(new y_(m.type,this._map,m))}touchmove(m){this._map.fire(new y_(m.type,this._map,m))}touchend(m){this._map.fire(new y_(m.type,this._map,m))}touchcancel(m){this._map.fire(new y_(m.type,this._map,m))}_firePreventable(m){if(this._map.fire(m),m.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bw{constructor(m){this._map=m}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(m){this._map.fire(new Vg(m.type,this._map,m))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Vg("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(m){this._delayContextMenu?this._contextMenuEvent=m:this._ignoreContextMenu||this._map.fire(new Vg(m.type,this._map,m)),this._map.listens("contextmenu")&&m.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class kv{constructor(m){this._map=m}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(m){return this.transform.pointLocation(a.Point.convert(m),this._map.terrain)}}class Bv{constructor(m,D){this._map=m,this._tr=new kv(m),this._el=m.getCanvasContainer(),this._container=m.getContainer(),this._clickTolerance=D.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(m,D){this.isEnabled()&&m.shiftKey&&m.button===0&&(y.disableDrag(),this._startPos=this._lastPos=D,this._active=!0)}mousemoveWindow(m,D){if(!this._active)return;const Ee=D;if(this._lastPos.equals(Ee)||!this._box&&Ee.dist(this._startPos)<this._clickTolerance)return;const ct=this._startPos;this._lastPos=Ee,this._box||(this._box=y.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",m));const or=Math.min(ct.x,Ee.x),kn=Math.max(ct.x,Ee.x),ds=Math.min(ct.y,Ee.y),ps=Math.max(ct.y,Ee.y);y.setTransform(this._box,`translate(${or}px,${ds}px)`),this._box.style.width=kn-or+"px",this._box.style.height=ps-ds+"px"}mouseupWindow(m,D){if(!this._active||m.button!==0)return;const Ee=this._startPos,ct=D;if(this.reset(),y.suppressClick(),Ee.x!==ct.x||Ee.y!==ct.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:m})),{cameraAnimation:or=>or.fitScreenCoordinates(Ee,ct,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",m)}keydown(m){this._active&&m.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",m))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(y.remove(this._box),this._box=null),y.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(m,D){return this._map.fire(new a.Event(m,{originalEvent:D}))}}function ly(ot,m){if(ot.length!==m.length)throw new Error(`The number of touches and points are not equal - touches ${ot.length}, points ${m.length}`);const D={};for(let Ee=0;Ee<ot.length;Ee++)D[ot[Ee].identifier]=m[Ee];return D}class Td{constructor(m){this.reset(),this.numTouches=m.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(m,D,Ee){(this.centroid||Ee.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=m.timeStamp),Ee.length===this.numTouches&&(this.centroid=function(ct){const or=new a.Point(0,0);for(const kn of ct)or._add(kn);return or.div(ct.length)}(D),this.touches=ly(Ee,D)))}touchmove(m,D,Ee){if(this.aborted||!this.centroid)return;const ct=ly(Ee,D);for(const or in this.touches){const kn=ct[or];(!kn||kn.dist(this.touches[or])>30)&&(this.aborted=!0)}}touchend(m,D,Ee){if((!this.centroid||m.timeStamp-this.startTime>500)&&(this.aborted=!0),Ee.length===0){const ct=!this.aborted&&this.centroid;if(this.reset(),ct)return ct}}}class m0{constructor(m){this.singleTap=new Td(m),this.numTaps=m.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(m,D,Ee){this.singleTap.touchstart(m,D,Ee)}touchmove(m,D,Ee){this.singleTap.touchmove(m,D,Ee)}touchend(m,D,Ee){const ct=this.singleTap.touchend(m,D,Ee);if(ct){const or=m.timeStamp-this.lastTime<500,kn=!this.lastTap||this.lastTap.dist(ct)<30;if(or&&kn||this.reset(),this.count++,this.lastTime=m.timeStamp,this.lastTap=ct,this.count===this.numTaps)return this.reset(),ct}}}class zv{constructor(m){this._tr=new kv(m),this._zoomIn=new m0({numTouches:1,numTaps:2}),this._zoomOut=new m0({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(m,D,Ee){this._zoomIn.touchstart(m,D,Ee),this._zoomOut.touchstart(m,D,Ee)}touchmove(m,D,Ee){this._zoomIn.touchmove(m,D,Ee),this._zoomOut.touchmove(m,D,Ee)}touchend(m,D,Ee){const ct=this._zoomIn.touchend(m,D,Ee),or=this._zoomOut.touchend(m,D,Ee),kn=this._tr;return ct?(this._active=!0,m.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:ds=>ds.easeTo({duration:300,zoom:kn.zoom+1,around:kn.unproject(ct)},{originalEvent:m})}):or?(this._active=!0,m.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:ds=>ds.easeTo({duration:300,zoom:kn.zoom-1,around:kn.unproject(or)},{originalEvent:m})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sm{constructor(m){this._enabled=!!m.enable,this._moveStateManager=m.moveStateManager,this._clickTolerance=m.clickTolerance||1,this._moveFunction=m.move,this._activateOnStart=!!m.activateOnStart,m.assignEvents(this),this.reset()}reset(m){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(m)}_move(...m){const D=this._moveFunction(...m);if(D.bearingDelta||D.pitchDelta||D.around||D.panDelta)return this._active=!0,D}dragStart(m,D){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(m)&&(this._moveStateManager.startMove(m),this._lastPoint=D.length?D[0]:D,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(m,D){if(!this.isEnabled())return;const Ee=this._lastPoint;if(!Ee)return;if(m.preventDefault(),!this._moveStateManager.isValidMoveEvent(m))return void this.reset(m);const ct=D.length?D[0]:D;return!this._moved&&ct.dist(Ee)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=ct,this._move(Ee,ct))}dragEnd(m){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(m)&&(this._moved&&y.suppressClick(),this.reset(m))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const y0={0:1,2:2};class sd{constructor(m){this._correctEvent=m.checkCorrectEvent}startMove(m){const D=y.mouseButton(m);this._eventButton=D}endMove(m){delete this._eventButton}isValidStartEvent(m){return this._correctEvent(m)}isValidMoveEvent(m){return!function(D,Ee){const ct=y0[Ee];return D.buttons===void 0||(D.buttons&ct)!==ct}(m,this._eventButton)}isValidEndEvent(m){return y.mouseButton(m)===this._eventButton}}class __{constructor(){this._firstTouch=void 0}_isOneFingerTouch(m){return m.targetTouches.length===1}_isSameTouchEvent(m){return m.targetTouches[0].identifier===this._firstTouch}startMove(m){this._firstTouch=m.targetTouches[0].identifier}endMove(m){delete this._firstTouch}isValidStartEvent(m){return this._isOneFingerTouch(m)}isValidMoveEvent(m){return this._isOneFingerTouch(m)&&this._isSameTouchEvent(m)}isValidEndEvent(m){return this._isOneFingerTouch(m)&&this._isSameTouchEvent(m)}}const J0=ot=>{ot.mousedown=ot.dragStart,ot.mousemoveWindow=ot.dragMove,ot.mouseup=ot.dragEnd,ot.contextmenu=function(m){m.preventDefault()}},v_=({enable:ot,clickTolerance:m,bearingDegreesPerPixelMoved:D=.8})=>{const Ee=new sd({checkCorrectEvent:ct=>y.mouseButton(ct)===0&&ct.ctrlKey||y.mouseButton(ct)===2});return new Sm({clickTolerance:m,move:(ct,or)=>({bearingDelta:(or.x-ct.x)*D}),moveStateManager:Ee,enable:ot,assignEvents:J0})},t_=({enable:ot,clickTolerance:m,pitchDegreesPerPixelMoved:D=-.5})=>{const Ee=new sd({checkCorrectEvent:ct=>y.mouseButton(ct)===0&&ct.ctrlKey||y.mouseButton(ct)===2});return new Sm({clickTolerance:m,move:(ct,or)=>({pitchDelta:(or.y-ct.y)*D}),moveStateManager:Ee,enable:ot,assignEvents:J0})};class _0{constructor(m,D){this._minTouches=m.cooperativeGestures?2:1,this._clickTolerance=m.clickTolerance||1,this._map=D,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.Point(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(m,D,Ee){return this._calculateTransform(m,D,Ee)}touchmove(m,D,Ee){if(this._map._cooperativeGestures&&(this._minTouches===2&&Ee.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(m,!1,Ee.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(Ee.length<this._minTouches))return m.preventDefault(),this._calculateTransform(m,D,Ee)}touchend(m,D,Ee){this._calculateTransform(m,D,Ee),this._active&&Ee.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(m,D,Ee){Ee.length>0&&(this._active=!0);const ct=ly(Ee,D),or=new a.Point(0,0),kn=new a.Point(0,0);let ds=0;for(const vs in ct){const fl=ct[vs],pl=this._touches[vs];pl&&(or._add(fl),kn._add(fl.sub(pl)),ds++,ct[vs]=fl)}if(this._touches=ct,ds<this._minTouches||!kn.mag())return;const ps=kn.div(ds);return this._sum._add(ps),this._sum.mag()<this._clickTolerance?void 0:{around:or.div(ds),panDelta:ps}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ev{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(m){}_move(m,D,Ee){return{}}touchstart(m,D,Ee){this._firstTwoTouches||Ee.length<2||(this._firstTwoTouches=[Ee[0].identifier,Ee[1].identifier],this._start([D[0],D[1]]))}touchmove(m,D,Ee){if(!this._firstTwoTouches)return;m.preventDefault();const[ct,or]=this._firstTwoTouches,kn=og(Ee,D,ct),ds=og(Ee,D,or);if(!kn||!ds)return;const ps=this._aroundCenter?null:kn.add(ds).div(2);return this._move([kn,ds],ps,m)}touchend(m,D,Ee){if(!this._firstTwoTouches)return;const[ct,or]=this._firstTwoTouches,kn=og(Ee,D,ct),ds=og(Ee,D,or);kn&&ds||(this._active&&y.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(m){this._enabled=!0,this._aroundCenter=!!m&&m.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function og(ot,m,D){for(let Ee=0;Ee<ot.length;Ee++)if(ot[Ee].identifier===D)return m[Ee]}function Gv(ot,m){return Math.log(ot/m)/Math.LN2}class Q0 extends ev{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(m){this._startDistance=this._distance=m[0].dist(m[1])}_move(m,D){const Ee=this._distance;if(this._distance=m[0].dist(m[1]),this._active||!(Math.abs(Gv(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Gv(this._distance,Ee),pinchAround:D}}}function tv(ot,m){return 180*ot.angleWith(m)/Math.PI}class x_ extends ev{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(m){this._startVector=this._vector=m[0].sub(m[1]),this._minDiameter=m[0].dist(m[1])}_move(m,D){const Ee=this._vector;if(this._vector=m[0].sub(m[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:tv(this._vector,Ee),pinchAround:D}}_isBelowThreshold(m){this._minDiameter=Math.min(this._minDiameter,m.mag());const D=25/(Math.PI*this._minDiameter)*360,Ee=tv(m,this._startVector);return Math.abs(Ee)<D}}function Vv(ot){return Math.abs(ot.y)>Math.abs(ot.x)}class Tm extends ev{constructor(m){super(),this._map=m}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(m,D,Ee){super.touchstart(m,D,Ee),this._currentTouchCount=Ee.length}_start(m){this._lastPoints=m,Vv(m[0].sub(m[1]))&&(this._valid=!1)}_move(m,D,Ee){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const ct=m[0].sub(this._lastPoints[0]),or=m[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(ct,or,Ee.timeStamp),this._valid?(this._lastPoints=m,this._active=!0,{pitchDelta:(ct.y+or.y)/2*-.5}):void 0}gestureBeginsVertically(m,D,Ee){if(this._valid!==void 0)return this._valid;const ct=m.mag()>=2,or=D.mag()>=2;if(!ct&&!or)return;if(!ct||!or)return this._firstMove===void 0&&(this._firstMove=Ee),Ee-this._firstMove<100&&void 0;const kn=m.y>0==D.y>0;return Vv(m)&&Vv(D)&&kn}}const km={panStep:100,bearingStep:15,pitchStep:10};class Sx{constructor(m){this._tr=new kv(m);const D=km;this._panStep=D.panStep,this._bearingStep=D.bearingStep,this._pitchStep=D.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(m){if(m.altKey||m.ctrlKey||m.metaKey)return;let D=0,Ee=0,ct=0,or=0,kn=0;switch(m.keyCode){case 61:case 107:case 171:case 187:D=1;break;case 189:case 109:case 173:D=-1;break;case 37:m.shiftKey?Ee=-1:(m.preventDefault(),or=-1);break;case 39:m.shiftKey?Ee=1:(m.preventDefault(),or=1);break;case 38:m.shiftKey?ct=1:(m.preventDefault(),kn=-1);break;case 40:m.shiftKey?ct=-1:(m.preventDefault(),kn=1);break;default:return}return this._rotationDisabled&&(Ee=0,ct=0),{cameraAnimation:ds=>{const ps=this._tr;ds.easeTo({duration:300,easeId:"keyboardHandler",easing:$v,zoom:D?Math.round(ps.zoom)+D*(m.shiftKey?2:1):ps.zoom,bearing:ps.bearing+Ee*this._bearingStep,pitch:ps.pitch+ct*this._pitchStep,offset:[-or*this._panStep,-kn*this._panStep],center:ps.center},{originalEvent:m})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function $v(ot){return ot*(2-ot)}const r_=4.000244140625;class w_{constructor(m,D){this._map=m,this._tr=new kv(m),this._el=m.getCanvasContainer(),this._handler=D,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout"],this)}setZoomRate(m){this._defaultZoomRate=m}setWheelZoomRate(m){this._wheelZoomRate=m}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(m){this.isEnabled()||(this._enabled=!0,this._aroundCenter=m&&m.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(m){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!m[this._map._metaKey])return;m.preventDefault()}let D=m.deltaMode===WheelEvent.DOM_DELTA_LINE?40*m.deltaY:m.deltaY;const Ee=a.exported.now(),ct=Ee-(this._lastWheelEventTime||0);this._lastWheelEventTime=Ee,D!==0&&D%r_==0?this._type="wheel":D!==0&&Math.abs(D)<4?this._type="trackpad":ct>400?(this._type=null,this._lastValue=D,this._timeout=setTimeout(this._onTimeout,40,m)):this._type||(this._type=Math.abs(ct*D)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,D+=this._lastValue)),m.shiftKey&&D&&(D/=4),this._type&&(this._lastWheelEvent=m,this._delta-=D,this._active||this._start(m)),m.preventDefault()}_onTimeout(m){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(m)}_start(m){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const D=y.mousePos(this._el,m),Ee=this._tr;this._around=a.LngLat.convert(this._aroundCenter?Ee.center:Ee.unproject(D)),this._aroundPoint=Ee.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const m=this._tr.transform;if(this._delta!==0){const ds=this._type==="wheel"&&Math.abs(this._delta)>r_?this._wheelZoomRate:this._defaultZoomRate;let ps=2/(1+Math.exp(-Math.abs(this._delta*ds)));this._delta<0&&ps!==0&&(ps=1/ps);const vs=typeof this._targetZoom=="number"?m.zoomScale(this._targetZoom):m.scale;this._targetZoom=Math.min(m.maxZoom,Math.max(m.minZoom,m.scaleZoom(vs*ps))),this._type==="wheel"&&(this._startZoom=m.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const D=typeof this._targetZoom=="number"?this._targetZoom:m.zoom,Ee=this._startZoom,ct=this._easing;let or,kn=!1;if(this._type==="wheel"&&Ee&&ct){const ds=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),ps=ct(ds);or=a.interpolate.number(Ee,D,ps),ds<1?this._frameId||(this._frameId=!0):kn=!0}else or=D,kn=!0;return this._active=!0,kn&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!kn,zoomDelta:or-m.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(m){let D=a.ease;if(this._prevEase){const Ee=this._prevEase,ct=(a.exported.now()-Ee.start)/Ee.duration,or=Ee.easing(ct+.01)-Ee.easing(ct),kn=.27/Math.sqrt(or*or+1e-4)*.01,ds=Math.sqrt(.0729-kn*kn);D=a.bezier(kn,ds,.25,1)}return this._prevEase={start:a.exported.now(),duration:m,easing:D},D}reset(){this._active=!1}}class ex{constructor(m,D){this._clickZoom=m,this._tapZoom=D}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Bm{constructor(m){this._tr=new kv(m),this.reset()}reset(){this._active=!1}dblclick(m,D){return m.preventDefault(),{cameraAnimation:Ee=>{Ee.easeTo({duration:300,zoom:this._tr.zoom+(m.shiftKey?-1:1),around:this._tr.unproject(D)},{originalEvent:m})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Eg{constructor(){this._tap=new m0({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(m,D,Ee){this._swipePoint||(this._tapTime&&m.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?Ee.length>0&&(this._swipePoint=D[0],this._swipeTouch=Ee[0].identifier):this._tap.touchstart(m,D,Ee))}touchmove(m,D,Ee){if(this._tapTime){if(this._swipePoint){if(Ee[0].identifier!==this._swipeTouch)return;const ct=D[0],or=ct.y-this._swipePoint.y;return this._swipePoint=ct,m.preventDefault(),this._active=!0,{zoomDelta:or/128}}}else this._tap.touchmove(m,D,Ee)}touchend(m,D,Ee){this._tapTime?this._swipePoint&&Ee.length===0&&this.reset():this._tap.touchend(m,D,Ee)&&(this._tapTime=m.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rv{constructor(m,D,Ee){this._el=m,this._mousePan=D,this._touchPan=Ee}enable(m){this._inertiaOptions=m||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Uv{constructor(m,D,Ee){this._pitchWithRotate=m.pitchWithRotate,this._mouseRotate=D,this._mousePitch=Ee}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class fd{constructor(m,D,Ee,ct){this._el=m,this._touchZoom=D,this._touchRotate=Ee,this._tapDragZoom=ct,this._rotationDisabled=!1,this._enabled=!0}enable(m){this._touchZoom.enable(m),this._rotationDisabled||this._touchRotate.enable(m),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Um=ot=>ot.zoom||ot.drag||ot.pitch||ot.rotate;class Tx extends a.Event{}function iv(ot){return ot.panDelta&&ot.panDelta.mag()||ot.zoomDelta||ot.bearingDelta||ot.pitchDelta}class Xm{constructor(m,D){this._map=m,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ry(m),this._bearingSnap=D.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(D),a.bindAll(["handleEvent","handleWindowEvent"],this);const Ee=this._el;this._listeners=[[Ee,"touchstart",{passive:!0}],[Ee,"touchmove",{passive:!1}],[Ee,"touchend",void 0],[Ee,"touchcancel",void 0],[Ee,"mousedown",void 0],[Ee,"mousemove",void 0],[Ee,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[Ee,"mouseover",void 0],[Ee,"mouseout",void 0],[Ee,"dblclick",void 0],[Ee,"click",void 0],[Ee,"keydown",{capture:!1}],[Ee,"keyup",void 0],[Ee,"wheel",{passive:!1}],[Ee,"contextmenu",void 0],[window,"blur",void 0]];for(const[ct,or,kn]of this._listeners)y.addEventListener(ct,or,ct===document?this.handleWindowEvent:this.handleEvent,kn)}destroy(){for(const[m,D,Ee]of this._listeners)y.removeEventListener(m,D,m===document?this.handleWindowEvent:this.handleEvent,Ee)}_addDefaultHandlers(m){const D=this._map,Ee=D.getCanvasContainer();this._add("mapEvent",new ww(D,m));const ct=D.boxZoom=new Bv(D,m);this._add("boxZoom",ct);const or=new zv(D),kn=new Bm(D);D.doubleClickZoom=new ex(kn,or),this._add("tapZoom",or),this._add("clickZoom",kn);const ds=new Eg;this._add("tapDragZoom",ds);const ps=D.touchPitch=new Tm(D);this._add("touchPitch",ps);const vs=v_(m),fl=t_(m);D.dragRotate=new Uv(m,vs,fl),this._add("mouseRotate",vs,["mousePitch"]),this._add("mousePitch",fl,["mouseRotate"]);const pl=(({enable:Kh,clickTolerance:ap})=>{const Lh=new sd({checkCorrectEvent:op=>y.mouseButton(op)===0&&!op.ctrlKey});return new Sm({clickTolerance:ap,move:(op,yp)=>({around:yp,panDelta:yp.sub(op)}),activateOnStart:!0,moveStateManager:Lh,enable:Kh,assignEvents:J0})})(m),ph=new _0(m,D);D.dragPan=new rv(Ee,pl,ph),this._add("mousePan",pl),this._add("touchPan",ph,["touchZoom","touchRotate"]);const Ah=new x_,hh=new Q0;D.touchZoomRotate=new fd(Ee,hh,Ah,ds),this._add("touchRotate",Ah,["touchPan","touchZoom"]),this._add("touchZoom",hh,["touchPan","touchRotate"]);const Rh=D.scrollZoom=new w_(D,this);this._add("scrollZoom",Rh,["mousePan"]);const Gh=D.keyboard=new Sx(D);this._add("keyboard",Gh),this._add("blockableMapEvent",new bw(D));for(const Kh of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])m.interactive&&m[Kh]&&D[Kh].enable(m[Kh])}_add(m,D,Ee){this._handlers.push({handlerName:m,handler:D,allowed:Ee}),this._handlersById[m]=D}stop(m){if(!this._updatingCamera){for(const{handler:D}of this._handlers)D.reset();this._inertia.clear(),this._fireEvents({},{},m),this._changes=[]}}isActive(){for(const{handler:m}of this._handlers)if(m.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Um(this._eventsInProgress)||this.isZooming()}_blockedByActive(m,D,Ee){for(const ct in m)if(ct!==Ee&&(!D||D.indexOf(ct)<0))return!0;return!1}handleWindowEvent(m){this.handleEvent(m,`${m.type}Window`)}_getMapTouches(m){const D=[];for(const Ee of m)this._el.contains(Ee.target)&&D.push(Ee);return D}handleEvent(m,D){if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const Ee=m.type==="renderFrame"?void 0:m,ct={needsRenderFrame:!1},or={},kn={},ds=m.touches,ps=ds?this._getMapTouches(ds):void 0,vs=ps?y.touchPos(this._el,ps):y.mousePos(this._el,m);for(const{handlerName:ph,handler:Ah,allowed:hh}of this._handlers){if(!Ah.isEnabled())continue;let Rh;this._blockedByActive(kn,hh,ph)?Ah.reset():Ah[D||m.type]&&(Rh=Ah[D||m.type](m,vs,ps),this.mergeHandlerResult(ct,or,Rh,ph,Ee),Rh&&Rh.needsRenderFrame&&this._triggerRenderFrame()),(Rh||Ah.isActive())&&(kn[ph]=Ah)}const fl={};for(const ph in this._previousActiveHandlers)kn[ph]||(fl[ph]=Ee);this._previousActiveHandlers=kn,(Object.keys(fl).length||iv(ct))&&(this._changes.push([ct,or,fl]),this._triggerRenderFrame()),(Object.keys(kn).length||iv(ct))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:pl}=ct;pl&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],pl(this._map))}mergeHandlerResult(m,D,Ee,ct,or){if(!Ee)return;a.extend(m,Ee);const kn={handlerName:ct,originalEvent:Ee.originalEvent||or};Ee.zoomDelta!==void 0&&(D.zoom=kn),Ee.panDelta!==void 0&&(D.drag=kn),Ee.pitchDelta!==void 0&&(D.pitch=kn),Ee.bearingDelta!==void 0&&(D.rotate=kn)}_applyChanges(){const m={},D={},Ee={};for(const[ct,or,kn]of this._changes)ct.panDelta&&(m.panDelta=(m.panDelta||new a.Point(0,0))._add(ct.panDelta)),ct.zoomDelta&&(m.zoomDelta=(m.zoomDelta||0)+ct.zoomDelta),ct.bearingDelta&&(m.bearingDelta=(m.bearingDelta||0)+ct.bearingDelta),ct.pitchDelta&&(m.pitchDelta=(m.pitchDelta||0)+ct.pitchDelta),ct.around!==void 0&&(m.around=ct.around),ct.pinchAround!==void 0&&(m.pinchAround=ct.pinchAround),ct.noInertia&&(m.noInertia=ct.noInertia),a.extend(D,or),a.extend(Ee,kn);this._updateMapTransform(m,D,Ee),this._changes=[]}_updateMapTransform(m,D,Ee){const ct=this._map,or=ct._getTransformForUpdate(),kn=ct.terrain;if(!(iv(m)||kn&&this._terrainMovement))return this._fireEvents(D,Ee,!0);let{panDelta:ds,zoomDelta:ps,bearingDelta:vs,pitchDelta:fl,around:pl,pinchAround:ph}=m;ph!==void 0&&(pl=ph),ct._stop(!0),pl=pl||ct.transform.centerPoint;const Ah=or.pointLocation(ds?pl.sub(ds):pl);vs&&(or.bearing+=vs),fl&&(or.pitch+=fl),ps&&(or.zoom+=ps),kn?this._terrainMovement||!D.drag&&!D.zoom?D.drag&&this._terrainMovement?or.center=or.pointLocation(or.centerPoint.sub(ds)):or.setLocationAtPoint(Ah,pl):(this._terrainMovement=!0,or.freezeElevation=!0,or.setLocationAtPoint(Ah,pl),this._map.once("moveend",()=>{or.freezeElevation=!1,this._terrainMovement=!1,or.recalculateZoom(ct.terrain)})):or.setLocationAtPoint(Ah,pl),ct._applyUpdatedTransform(or),this._map._update(),m.noInertia||this._inertia.record(m),this._fireEvents(D,Ee,!0)}_fireEvents(m,D,Ee){const ct=Um(this._eventsInProgress),or=Um(m),kn={};for(const fl in m){const{originalEvent:pl}=m[fl];this._eventsInProgress[fl]||(kn[`${fl}start`]=pl),this._eventsInProgress[fl]=m[fl]}!ct&&or&&this._fireEvent("movestart",or.originalEvent);for(const fl in kn)this._fireEvent(fl,kn[fl]);or&&this._fireEvent("move",or.originalEvent);for(const fl in m){const{originalEvent:pl}=m[fl];this._fireEvent(fl,pl)}const ds={};let ps;for(const fl in this._eventsInProgress){const{handlerName:pl,originalEvent:ph}=this._eventsInProgress[fl];this._handlersById[pl].isActive()||(delete this._eventsInProgress[fl],ps=D[pl]||ph,ds[`${fl}end`]=ps)}for(const fl in ds)this._fireEvent(fl,ds[fl]);const vs=Um(this._eventsInProgress);if(Ee&&(ct||or)&&!vs){this._updatingCamera=!0;const fl=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),pl=ph=>ph!==0&&-this._bearingSnap<ph&&ph<this._bearingSnap;fl?(pl(fl.bearing||this._map.getBearing())&&(fl.bearing=0),fl.freezeElevation=!0,this._map.easeTo(fl,{originalEvent:ps})):(this._map.fire(new a.Event("moveend",{originalEvent:ps})),pl(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(m,D){this._map.fire(new a.Event(m,D?{originalEvent:D}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(m=>{delete this._frameId,this.handleEvent(new Tx("renderFrame",{timeStamp:m})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const tm={extend:(ot,...m)=>a.extend(ot,...m),run(ot){ot()},logToElement(ot,m=!1,D="log"){const Ee=window.document.getElementById(D);Ee&&(m&&(Ee.innerHTML=""),Ee.innerHTML+=`<br>${ot}`)}};class Nd extends a.Evented{constructor(m,D){super(),this._moving=!1,this._zooming=!1,this.transform=m,this._bearingSnap=D.bearingSnap,a.bindAll(["_renderFrameCallback"],this),this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(m,D){return this.jumpTo({center:m},D)}panBy(m,D,Ee){return m=a.Point.convert(m).mult(-1),this.panTo(this.transform.center,a.extend({offset:m},D),Ee)}panTo(m,D,Ee){return this.easeTo(a.extend({center:m},D),Ee)}getZoom(){return this.transform.zoom}setZoom(m,D){return this.jumpTo({zoom:m},D),this}zoomTo(m,D,Ee){return this.easeTo(a.extend({zoom:m},D),Ee)}zoomIn(m,D){return this.zoomTo(this.getZoom()+1,m,D),this}zoomOut(m,D){return this.zoomTo(this.getZoom()-1,m,D),this}getBearing(){return this.transform.bearing}setBearing(m,D){return this.jumpTo({bearing:m},D),this}getPadding(){return this.transform.padding}setPadding(m,D){return this.jumpTo({padding:m},D),this}rotateTo(m,D,Ee){return this.easeTo(a.extend({bearing:m},D),Ee)}resetNorth(m,D){return this.rotateTo(0,a.extend({duration:1e3},m),D),this}resetNorthPitch(m,D){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},m),D),this}snapToNorth(m,D){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(m,D):this}getPitch(){return this.transform.pitch}setPitch(m,D){return this.jumpTo({pitch:m},D),this}cameraForBounds(m,D){m=Rp.convert(m);const Ee=D&&D.bearing||0;return this._cameraForBoxAndBearing(m.getNorthWest(),m.getSouthEast(),Ee,D)}_cameraForBoxAndBearing(m,D,Ee,ct){const or={top:0,bottom:0,right:0,left:0};if(typeof(ct=a.extend({padding:or,offset:[0,0],maxZoom:this.transform.maxZoom},ct)).padding=="number"){const yp=ct.padding;ct.padding={top:yp,bottom:yp,right:yp,left:yp}}ct.padding=a.extend(or,ct.padding);const kn=this.transform,ds=kn.padding,ps=kn.project(a.LngLat.convert(m)),vs=kn.project(a.LngLat.convert(D)),fl=ps.rotate(-Ee*Math.PI/180),pl=vs.rotate(-Ee*Math.PI/180),ph=new a.Point(Math.max(fl.x,pl.x),Math.max(fl.y,pl.y)),Ah=new a.Point(Math.min(fl.x,pl.x),Math.min(fl.y,pl.y)),hh=ph.sub(Ah),Rh=(kn.width-(ds.left+ds.right+ct.padding.left+ct.padding.right))/hh.x,Gh=(kn.height-(ds.top+ds.bottom+ct.padding.top+ct.padding.bottom))/hh.y;if(Gh<0||Rh<0)return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Kh=Math.min(kn.scaleZoom(kn.scale*Math.min(Rh,Gh)),ct.maxZoom),ap=a.Point.convert(ct.offset),Lh=new a.Point((ct.padding.left-ct.padding.right)/2,(ct.padding.top-ct.padding.bottom)/2).rotate(Ee*Math.PI/180),op=ap.add(Lh).mult(kn.scale/kn.zoomScale(Kh));return{center:kn.unproject(ps.add(vs).div(2).sub(op)),zoom:Kh,bearing:Ee}}fitBounds(m,D,Ee){return this._fitInternal(this.cameraForBounds(m,D),D,Ee)}fitScreenCoordinates(m,D,Ee,ct,or){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.Point.convert(m)),this.transform.pointLocation(a.Point.convert(D)),Ee,ct),ct,or)}_fitInternal(m,D,Ee){return m?(delete(D=a.extend(m,D)).padding,D.linear?this.easeTo(D,Ee):this.flyTo(D,Ee)):this}jumpTo(m,D){this.stop();const Ee=this._getTransformForUpdate();let ct=!1,or=!1,kn=!1;return"zoom"in m&&Ee.zoom!==+m.zoom&&(ct=!0,Ee.zoom=+m.zoom),m.center!==void 0&&(Ee.center=a.LngLat.convert(m.center)),"bearing"in m&&Ee.bearing!==+m.bearing&&(or=!0,Ee.bearing=+m.bearing),"pitch"in m&&Ee.pitch!==+m.pitch&&(kn=!0,Ee.pitch=+m.pitch),m.padding==null||Ee.isPaddingEqual(m.padding)||(Ee.padding=m.padding),this._applyUpdatedTransform(Ee),this.fire(new a.Event("movestart",D)).fire(new a.Event("move",D)),ct&&this.fire(new a.Event("zoomstart",D)).fire(new a.Event("zoom",D)).fire(new a.Event("zoomend",D)),or&&this.fire(new a.Event("rotatestart",D)).fire(new a.Event("rotate",D)).fire(new a.Event("rotateend",D)),kn&&this.fire(new a.Event("pitchstart",D)).fire(new a.Event("pitch",D)).fire(new a.Event("pitchend",D)),this.fire(new a.Event("moveend",D))}calculateCameraOptionsFromTo(m,D,Ee,ct=0){const or=a.MercatorCoordinate.fromLngLat(m,D),kn=a.MercatorCoordinate.fromLngLat(Ee,ct),ds=kn.x-or.x,ps=kn.y-or.y,vs=kn.z-or.z,fl=Math.hypot(ds,ps,vs);if(fl===0)throw new Error("Can't calculate camera options with same From and To");const pl=Math.hypot(ds,ps),ph=this.transform.scaleZoom(this.transform.cameraToCenterDistance/fl/this.transform.tileSize),Ah=180*Math.atan2(ds,-ps)/Math.PI;let hh=180*Math.acos(pl/fl)/Math.PI;return hh=vs<0?90-hh:90+hh,{center:kn.toLngLat(),zoom:ph,pitch:hh,bearing:Ah}}easeTo(m,D){this._stop(!1,m.easeId),((m=a.extend({offset:[0,0],duration:500,easing:a.ease},m)).animate===!1||!m.essential&&a.exported.prefersReducedMotion)&&(m.duration=0);const Ee=this._getTransformForUpdate(),ct=this.getZoom(),or=this.getBearing(),kn=this.getPitch(),ds=this.getPadding(),ps="zoom"in m?+m.zoom:ct,vs="bearing"in m?this._normalizeBearing(m.bearing,or):or,fl="pitch"in m?+m.pitch:kn,pl="padding"in m?m.padding:Ee.padding,ph=a.Point.convert(m.offset);let Ah=Ee.centerPoint.add(ph);const hh=Ee.pointLocation(Ah),Rh=a.LngLat.convert(m.center||hh);this._normalizeCenter(Rh);const Gh=Ee.project(hh),Kh=Ee.project(Rh).sub(Gh),ap=Ee.zoomScale(ps-ct);let Lh,op;m.around&&(Lh=a.LngLat.convert(m.around),op=Ee.locationPoint(Lh));const yp={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ps!==ct,this._rotating=this._rotating||or!==vs,this._pitching=this._pitching||fl!==kn,this._padding=!Ee.isPaddingEqual(pl),this._easeId=m.easeId,this._prepareEase(D,m.noMoveStart,yp),this.terrain&&this._prepareElevation(Rh),this._ease(Np=>{if(this._zooming&&(Ee.zoom=a.interpolate.number(ct,ps,Np)),this._rotating&&(Ee.bearing=a.interpolate.number(or,vs,Np)),this._pitching&&(Ee.pitch=a.interpolate.number(kn,fl,Np)),this._padding&&(Ee.interpolatePadding(ds,pl,Np),Ah=Ee.centerPoint.add(ph)),this.terrain&&!m.freezeElevation&&this._updateElevation(Np),Lh)Ee.setLocationAtPoint(Lh,op);else{const jp=Ee.zoomScale(Ee.zoom-ct),td=ps>ct?Math.min(2,ap):Math.max(.5,ap),Vp=Math.pow(td,1-Np),gd=Ee.unproject(Gh.add(Kh.mult(Np*Vp)).mult(jp));Ee.setLocationAtPoint(Ee.renderWorldCopies?gd.wrap():gd,Ah)}this._applyUpdatedTransform(Ee),this._fireMoveEvents(D)},Np=>{this.terrain&&this._finalizeElevation(),this._afterEase(D,Np)},m),this}_prepareEase(m,D,Ee={}){this._moving=!0,D||Ee.moving||this.fire(new a.Event("movestart",m)),this._zooming&&!Ee.zooming&&this.fire(new a.Event("zoomstart",m)),this._rotating&&!Ee.rotating&&this.fire(new a.Event("rotatestart",m)),this._pitching&&!Ee.pitching&&this.fire(new a.Event("pitchstart",m))}_prepareElevation(m){this._elevationCenter=m,this._elevationStart=this.transform.elevation,this._elevationTarget=this.transform.getElevation(m,this.terrain),this.transform.freezeElevation=!0}_updateElevation(m){const D=this.transform.getElevation(this._elevationCenter,this.terrain);if(m<1&&D!==this._elevationTarget){const Ee=this._elevationTarget-this._elevationStart;this._elevationStart+=m*(Ee-(D-(Ee*m+this._elevationStart))/(1-m)),this._elevationTarget=D}this.transform.elevation=a.interpolate.number(this._elevationStart,this._elevationTarget,m)}_finalizeElevation(){this.transform.freezeElevation=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(m){if(!this.transformCameraUpdate)return;const D=m.clone(),{center:Ee,zoom:ct,pitch:or,bearing:kn,elevation:ds}=this.transformCameraUpdate(D);Ee&&(D.center=Ee),ct!==void 0&&(D.zoom=ct),or!==void 0&&(D.pitch=or),kn!==void 0&&(D.bearing=kn),ds!==void 0&&(D.elevation=ds),this.transform.apply(D)}_fireMoveEvents(m){this.fire(new a.Event("move",m)),this._zooming&&this.fire(new a.Event("zoom",m)),this._rotating&&this.fire(new a.Event("rotate",m)),this._pitching&&this.fire(new a.Event("pitch",m))}_afterEase(m,D){if(this._easeId&&D&&this._easeId===D)return;delete this._easeId;const Ee=this._zooming,ct=this._rotating,or=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,Ee&&this.fire(new a.Event("zoomend",m)),ct&&this.fire(new a.Event("rotateend",m)),or&&this.fire(new a.Event("pitchend",m)),this.fire(new a.Event("moveend",m))}flyTo(m,D){if(!m.essential&&a.exported.prefersReducedMotion){const Ve=a.pick(m,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ve,D)}this.stop(),m=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},m);const Ee=this._getTransformForUpdate(),ct=this.getZoom(),or=this.getBearing(),kn=this.getPitch(),ds=this.getPadding(),ps="zoom"in m?a.clamp(+m.zoom,Ee.minZoom,Ee.maxZoom):ct,vs="bearing"in m?this._normalizeBearing(m.bearing,or):or,fl="pitch"in m?+m.pitch:kn,pl="padding"in m?m.padding:Ee.padding,ph=Ee.zoomScale(ps-ct),Ah=a.Point.convert(m.offset);let hh=Ee.centerPoint.add(Ah);const Rh=Ee.pointLocation(hh),Gh=a.LngLat.convert(m.center||Rh);this._normalizeCenter(Gh);const Kh=Ee.project(Rh),ap=Ee.project(Gh).sub(Kh);let Lh=m.curve;const op=Math.max(Ee.width,Ee.height),yp=op/ph,Np=ap.mag();if("minZoom"in m){const Ve=a.clamp(Math.min(m.minZoom,ct,ps),Ee.minZoom,Ee.maxZoom),kt=op/Ee.zoomScale(Ve-ct);Lh=Math.sqrt(kt/Np*2)}const jp=Lh*Lh;function td(Ve){const kt=(yp*yp-op*op+(Ve?-1:1)*jp*jp*Np*Np)/(2*(Ve?yp:op)*jp*Np);return Math.log(Math.sqrt(kt*kt+1)-kt)}function Vp(Ve){return(Math.exp(Ve)-Math.exp(-Ve))/2}function gd(Ve){return(Math.exp(Ve)+Math.exp(-Ve))/2}const F=td(0);let f=function(Ve){return gd(F)/gd(F+Lh*Ve)},T=function(Ve){return op*((gd(F)*(Vp(kt=F+Lh*Ve)/gd(kt))-Vp(F))/jp)/Np;var kt},X=(td(1)-F)/Lh;if(Math.abs(Np)<1e-6||!isFinite(X)){if(Math.abs(op-yp)<1e-6)return this.easeTo(m,D);const Ve=yp<op?-1:1;X=Math.abs(Math.log(yp/op))/Lh,T=function(){return 0},f=function(kt){return Math.exp(Ve*Lh*kt)}}return m.duration="duration"in m?+m.duration:1e3*X/("screenSpeed"in m?+m.screenSpeed/Lh:+m.speed),m.maxDuration&&m.duration>m.maxDuration&&(m.duration=0),this._zooming=!0,this._rotating=or!==vs,this._pitching=fl!==kn,this._padding=!Ee.isPaddingEqual(pl),this._prepareEase(D,!1),this.terrain&&this._prepareElevation(Gh),this._ease(Ve=>{const kt=Ve*X,Hr=1/f(kt);Ee.zoom=Ve===1?ps:ct+Ee.scaleZoom(Hr),this._rotating&&(Ee.bearing=a.interpolate.number(or,vs,Ve)),this._pitching&&(Ee.pitch=a.interpolate.number(kn,fl,Ve)),this._padding&&(Ee.interpolatePadding(ds,pl,Ve),hh=Ee.centerPoint.add(Ah)),this.terrain&&!m.freezeElevation&&this._updateElevation(Ve);const pi=Ve===1?Gh:Ee.unproject(Kh.add(ap.mult(T(kt))).mult(Hr));Ee.setLocationAtPoint(Ee.renderWorldCopies?pi.wrap():pi,hh),this._applyUpdatedTransform(Ee),this._fireMoveEvents(D)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(D)},m),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(m,D){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const Ee=this._onEaseEnd;delete this._onEaseEnd,Ee.call(this,D)}if(!m){const Ee=this.handlers;Ee&&Ee.stop(!1)}return this}_ease(m,D,Ee){Ee.animate===!1||Ee.duration===0?(m(1),D()):(this._easeStart=a.exported.now(),this._easeOptions=Ee,this._onEaseFrame=m,this._onEaseEnd=D,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const m=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(m)),m<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(m,D){m=a.wrap(m,-180,180);const Ee=Math.abs(m-D);return Math.abs(m-360-D)<Ee&&(m-=360),Math.abs(m+360-D)<Ee&&(m+=360),m}_normalizeCenter(m){const D=this.transform;if(!D.renderWorldCopies||D.lngRange)return;const Ee=m.lng-D.center.lng;m.lng+=Ee>180?-360:Ee<-180?360:0}queryTerrainElevation(m){return this.terrain?this.transform.getElevation(a.LngLat.convert(m),this.terrain)-this.transform.elevation:null}}class Kd{constructor(m={}){this.options=m,a.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(m){return this._map=m,this._compact=this.options&&this.options.compact,this._container=y.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=y.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=y.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){y.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(m,D){const Ee=this._map._getUIString(`AttributionControl.${D}`);m.title=Ee,m.setAttribute("aria-label",Ee)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))}_updateData(m){!m||m.sourceDataType!=="metadata"&&m.sourceDataType!=="visibility"&&m.dataType!=="style"&&m.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let m=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?m=m.concat(this.options.customAttribution.map(ct=>typeof ct!="string"?"":ct)):typeof this.options.customAttribution=="string"&&m.push(this.options.customAttribution)),this._map.style.stylesheet){const ct=this._map.style.stylesheet;this.styleOwner=ct.owner,this.styleId=ct.id}const D=this._map.style.sourceCaches;for(const ct in D){const or=D[ct];if(or.used||or.usedForTerrain){const kn=or.getSource();kn.attribution&&m.indexOf(kn.attribution)<0&&m.push(kn.attribution)}}m=m.filter(ct=>String(ct).trim()),m.sort((ct,or)=>ct.length-or.length),m=m.filter((ct,or)=>{for(let kn=or+1;kn<m.length;kn++)if(m[kn].indexOf(ct)>=0)return!1;return!0});const Ee=m.join(" | ");Ee!==this._attribHTML&&(this._attribHTML=Ee,m.length?(this._innerContainer.innerHTML=Ee,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")}}class nv{constructor(m={}){this.options=m,a.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(m){this._map=m,this._compact=this.options&&this.options.compact,this._container=y.create("div","maplibregl-ctrl");const D=y.create("a","maplibregl-ctrl-logo");return D.target="_blank",D.rel="noopener nofollow",D.href="https://maplibre.org/",D.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),D.setAttribute("rel","noopener nofollow"),this._container.appendChild(D),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){y.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const m=this._container.children;if(m.length){const D=m[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&D.classList.add("maplibregl-compact"):D.classList.remove("maplibregl-compact")}}}class jv{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(m){const D=++this._id;return this._queue.push({callback:m,id:D,cancelled:!1}),D}remove(m){const D=this._currentlyRunning,Ee=D?this._queue.concat(D):this._queue;for(const ct of Ee)if(ct.id===m)return void(ct.cancelled=!0)}run(m=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const D=this._currentlyRunning=this._queue;this._queue=[];for(const Ee of D)if(!Ee.cancelled&&(Ee.callback(m),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const tx={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Am=a.createLayout([{name:"a_pos3d",type:"Int16",components:3}]);class ov extends a.Evented{constructor(m){super(),this.sourceCache=m,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,m.usedForTerrain=!0,m.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(m,D){this.sourceCache.update(m,D),this._renderableTilesKeys=[];const Ee={};for(const ct of m.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:D}))Ee[ct.key]=!0,this._renderableTilesKeys.push(ct.key),this._tiles[ct.key]||(ct.posMatrix=new Float64Array(16),a.ortho(ct.posMatrix,0,a.EXTENT,0,a.EXTENT,0,1),this._tiles[ct.key]=new fp(ct,this.tileSize));for(const ct in this._tiles)Ee[ct]||delete this._tiles[ct]}freeRtt(m){for(const D in this._tiles){const Ee=this._tiles[D];(!m||Ee.tileID.equals(m)||Ee.tileID.isChildOf(m)||m.isChildOf(Ee.tileID))&&(Ee.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(m=>this.getTileByID(m))}getTileByID(m){return this._tiles[m]}getTerrainCoords(m){const D={};for(const Ee of this._renderableTilesKeys){const ct=this._tiles[Ee].tileID;if(ct.canonical.equals(m.canonical)){const or=m.clone();or.posMatrix=new Float64Array(16),a.ortho(or.posMatrix,0,a.EXTENT,0,a.EXTENT,0,1),D[Ee]=or}else if(ct.canonical.isChildOf(m.canonical)){const or=m.clone();or.posMatrix=new Float64Array(16);const kn=ct.canonical.z-m.canonical.z,ds=ct.canonical.x-(ct.canonical.x>>kn<<kn),ps=ct.canonical.y-(ct.canonical.y>>kn<<kn),vs=a.EXTENT>>kn;a.ortho(or.posMatrix,0,vs,0,vs,0,1),a.translate(or.posMatrix,or.posMatrix,[-ds*vs,-ps*vs,0]),D[Ee]=or}else if(m.canonical.isChildOf(ct.canonical)){const or=m.clone();or.posMatrix=new Float64Array(16);const kn=m.canonical.z-ct.canonical.z,ds=m.canonical.x-(m.canonical.x>>kn<<kn),ps=m.canonical.y-(m.canonical.y>>kn<<kn),vs=a.EXTENT>>kn;a.ortho(or.posMatrix,0,a.EXTENT,0,a.EXTENT,0,1),a.translate(or.posMatrix,or.posMatrix,[ds*vs,ps*vs,0]),a.scale(or.posMatrix,or.posMatrix,[1/2**kn,1/2**kn,0]),D[Ee]=or}}return D}getSourceTile(m,D){const Ee=this.sourceCache._source;let ct=m.overscaledZ-this.deltaZoom;if(ct>Ee.maxzoom&&(ct=Ee.maxzoom),ct<Ee.minzoom)return null;this._sourceTileCache[m.key]||(this._sourceTileCache[m.key]=m.scaledTo(ct).key);let or=this.sourceCache.getTileByID(this._sourceTileCache[m.key]);if((!or||!or.dem)&&D)for(;ct>=Ee.minzoom&&(!or||!or.dem);)or=this.sourceCache.getTileByID(m.scaledTo(ct--).key);return or}tilesAfterTime(m=Date.now()){return Object.values(this._tiles).filter(D=>D.timeAdded>=m)}}class xy{constructor(m,D,Ee){this.painter=m,this.sourceCache=new ov(D),this.options=Ee,this.exaggeration=typeof Ee.exaggeration=="number"?Ee.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(m,D,Ee,ct=a.EXTENT){if(!(D>=0&&D<ct&&Ee>=0&&Ee<ct))return 0;let or=0;const kn=this.getTerrainData(m);if(kn.tile&&kn.tile.dem){const ds=function(hh,Rh,Gh){var Kh=Rh[0],ap=Rh[1];return hh[0]=Gh[0]*Kh+Gh[4]*ap+Gh[12],hh[1]=Gh[1]*Kh+Gh[5]*ap+Gh[13],hh}([],[D/ct*a.EXTENT,Ee/ct*a.EXTENT],kn.u_terrain_matrix),ps=[ds[0]*kn.tile.dem.dim,ds[1]*kn.tile.dem.dim],vs=[Math.floor(ps[0]),Math.floor(ps[1])],fl=kn.tile.dem.get(vs[0],vs[1]),pl=kn.tile.dem.get(vs[0],vs[1]+1),ph=kn.tile.dem.get(vs[0]+1,vs[1]),Ah=kn.tile.dem.get(vs[0]+1,vs[1]+1);or=a.interpolate.number(a.interpolate.number(fl,pl,ps[0]-vs[0]),a.interpolate.number(ph,Ah,ps[0]-vs[0]),ps[1]-vs[1])}return or}getElevation(m,D,Ee,ct=a.EXTENT){return this.getDEMElevation(m,D,Ee,ct)*this.exaggeration}getTerrainData(m){if(!this._emptyDemTexture){const ct=this.painter.context,or=new a.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new _l(ct,or,ct.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new _l(ct,new a.RGBAImage({width:1,height:1}),ct.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(ct.gl.NEAREST,ct.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.identity([])}const D=this.sourceCache.getSourceTile(m,!0);if(D&&D.dem&&(!D.demTexture||D.needsTerrainPrepare)){const ct=this.painter.context;D.demTexture=this.painter.getTileTexture(D.dem.stride),D.demTexture?D.demTexture.update(D.dem.getPixels(),{premultiply:!1}):D.demTexture=new _l(ct,D.dem.getPixels(),ct.gl.RGBA,{premultiply:!1}),D.demTexture.bind(ct.gl.NEAREST,ct.gl.CLAMP_TO_EDGE),D.needsTerrainPrepare=!1}const Ee=D&&D+D.tileID.key+m.key;if(Ee&&!this._demMatrixCache[Ee]){const ct=this.sourceCache.sourceCache._source.maxzoom;let or=m.canonical.z-D.tileID.canonical.z;m.overscaledZ>m.canonical.z&&(m.canonical.z>=ct?or=m.canonical.z-ct:a.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const kn=m.canonical.x-(m.canonical.x>>or<<or),ds=m.canonical.y-(m.canonical.y>>or<<or),ps=a.fromScaling(new Float64Array(16),[1/(a.EXTENT<<or),1/(a.EXTENT<<or),0]);a.translate(ps,ps,[kn*a.EXTENT,ds*a.EXTENT,0]),this._demMatrixCache[m.key]={matrix:ps,coord:m}}return{u_depth:2,u_terrain:3,u_terrain_dim:D&&D.dem&&D.dem.dim||1,u_terrain_matrix:Ee?this._demMatrixCache[m.key].matrix:this._emptyDemMatrix,u_terrain_unpack:D&&D.dem&&D.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(D&&D.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:D}}getFramebuffer(m){const D=this.painter,Ee=D.width/devicePixelRatio,ct=D.height/devicePixelRatio;return!this._fbo||this._fbo.width===Ee&&this._fbo.height===ct||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new _l(D.context,{width:Ee,height:ct,data:null},D.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(D.context.gl.NEAREST,D.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new _l(D.context,{width:Ee,height:ct,data:null},D.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(D.context.gl.NEAREST,D.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=D.context.createFramebuffer(Ee,ct,!0,!1),this._fbo.depthAttachment.set(D.context.createRenderbuffer(D.context.gl.DEPTH_COMPONENT16,Ee,ct))),this._fbo.colorAttachment.set(m==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const m=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const D=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let or=0,kn=0;or<this._coordsTextureSize;or++)for(let ds=0;ds<this._coordsTextureSize;ds++,kn+=4)D[kn+0]=255&ds,D[kn+1]=255&or,D[kn+2]=ds>>8<<4|or>>8,D[kn+3]=0;const Ee=new a.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(D.buffer)),ct=new _l(m,Ee,m.gl.RGBA,{premultiply:!1});return ct.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._coordsTexture=ct,ct}pointCoordinate(m){const D=new Uint8Array(4),Ee=this.painter.context,ct=Ee.gl;Ee.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),ct.readPixels(m.x,this.painter.height/devicePixelRatio-m.y-1,1,1,ct.RGBA,ct.UNSIGNED_BYTE,D),Ee.bindFramebuffer.set(null);const or=D[0]+(D[2]>>4<<8),kn=D[1]+((15&D[2])<<8),ds=this.coordsIndex[255-D[3]],ps=ds&&this.sourceCache.getTileByID(ds);if(!ps)return null;const vs=this._coordsTextureSize,fl=(1<<ps.tileID.canonical.z)*vs;return new a.MercatorCoordinate((ps.tileID.canonical.x*vs+or)/fl,(ps.tileID.canonical.y*vs+kn)/fl,this.getElevation(ps.tileID,or,kn,vs))}getTerrainMesh(){if(this._mesh)return this._mesh;const m=this.painter.context,D=new a.Pos3dArray,Ee=new a.TriangleIndexArray,ct=this.meshSize,or=a.EXTENT/ct,kn=ct*ct;for(let pl=0;pl<=ct;pl++)for(let ph=0;ph<=ct;ph++)D.emplaceBack(ph*or,pl*or,0);for(let pl=0;pl<kn;pl+=ct+1)for(let ph=0;ph<ct;ph++)Ee.emplaceBack(ph+pl,ct+ph+pl+1,ct+ph+pl+2),Ee.emplaceBack(ph+pl,ct+ph+pl+2,ph+pl+1);const ds=D.length,ps=ds+2*(ct+1);for(const pl of[0,1])for(let ph=0;ph<=ct;ph++)for(const Ah of[0,1])D.emplaceBack(ph*or,pl*a.EXTENT,Ah);for(let pl=0;pl<2*ct;pl+=2)Ee.emplaceBack(ps+pl,ps+pl+1,ps+pl+3),Ee.emplaceBack(ps+pl,ps+pl+3,ps+pl+2),Ee.emplaceBack(ds+pl,ds+pl+3,ds+pl+1),Ee.emplaceBack(ds+pl,ds+pl+2,ds+pl+3);const vs=D.length,fl=vs+2*(ct+1);for(const pl of[0,1])for(let ph=0;ph<=ct;ph++)for(const Ah of[0,1])D.emplaceBack(pl*a.EXTENT,ph*or,Ah);for(let pl=0;pl<2*ct;pl+=2)Ee.emplaceBack(vs+pl,vs+pl+1,vs+pl+3),Ee.emplaceBack(vs+pl,vs+pl+3,vs+pl+2),Ee.emplaceBack(fl+pl,fl+pl+3,fl+pl+1),Ee.emplaceBack(fl+pl,fl+pl+2,fl+pl+3);return this._mesh={indexBuffer:m.createIndexBuffer(Ee),vertexBuffer:m.createVertexBuffer(D,Am.members),segments:a.SegmentVector.simpleSegment(0,0,D.length,Ee.length)},this._mesh}getMeshFrameDelta(m){return 2*Math.PI*a.earthRadius/Math.pow(2,m)/5}getMinMaxElevation(m){const D=this.getTerrainData(m).tile,Ee={minElevation:null,maxElevation:null};return D&&D.dem&&(Ee.minElevation=D.dem.min*this.exaggeration,Ee.maxElevation=D.dem.max*this.exaggeration),Ee}}class Cw{constructor(m,D,Ee){this._context=m,this._size=D,this._tileSize=Ee,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const m of this._objects)m.texture.destroy(),m.fbo.destroy()}_createObject(m){const D=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),Ee=new _l(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return Ee.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),D.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),D.colorAttachment.set(Ee.texture),{id:m,fbo:D,texture:Ee,stamp:-1,inUse:!1}}getObjectForId(m){return this._objects[m]}useObject(m){m.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(D=>m.id!==D),this._recentlyUsed.push(m.id)}stampObject(m){m.stamp=++this._stamp}getOrCreateFreeObject(){for(const D of this._recentlyUsed)if(!this._objects[D].inUse)return this._objects[D];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const m=this._createObject(this._objects.length);return this._objects.push(m),m}freeObject(m){m.inUse=!1}freeAllObjects(){for(const m of this._objects)this.freeObject(m)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(m=>!m.inUse)===!1}}const By={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Pg{constructor(m,D){this.painter=m,this.terrain=D,this.pool=new Cw(m.context,30,D.sourceCache.tileSize*D.qualityFactor)}destruct(){this.pool.destruct()}getTexture(m){return this.pool.getObjectForId(m.rtt[this._stacks.length-1].id).texture}prepareForRender(m,D){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=m._order.filter(Ee=>!m._layers[Ee].isHidden(D)),this._coordsDescendingInv={};for(const Ee in m.sourceCaches){this._coordsDescendingInv[Ee]={};const ct=m.sourceCaches[Ee].getVisibleCoordinates();for(const or of ct){const kn=this.terrain.sourceCache.getTerrainCoords(or);for(const ds in kn)this._coordsDescendingInv[Ee][ds]||(this._coordsDescendingInv[Ee][ds]=[]),this._coordsDescendingInv[Ee][ds].push(kn[ds])}}this._coordsDescendingInvStr={};for(const Ee of m._order){const ct=m._layers[Ee],or=ct.source;if(By[ct.type]&&!this._coordsDescendingInvStr[or]){this._coordsDescendingInvStr[or]={};for(const kn in this._coordsDescendingInv[or])this._coordsDescendingInvStr[or][kn]=this._coordsDescendingInv[or][kn].map(ds=>ds.key).sort().join()}}for(const Ee of this._renderableTiles)for(const ct in this._coordsDescendingInvStr){const or=this._coordsDescendingInvStr[ct][Ee.tileID.key];or&&or!==Ee.rttCoords[ct]&&(Ee.rtt=[])}}renderLayer(m){if(m.isHidden(this.painter.transform.zoom))return!1;const D=m.type,Ee=this.painter,ct=this._renderableLayerIds[this._renderableLayerIds.length-1]===m.id;if(By[D]&&(this._prevType&&By[this._prevType]||this._stacks.push([]),this._prevType=D,this._stacks[this._stacks.length-1].push(m.id),!ct))return!0;if(By[this._prevType]||By[D]&&ct){this._prevType=D;const or=this._stacks.length-1,kn=this._stacks[or]||[];for(const ds of this._renderableTiles){if(this.pool.isFull()&&(Ov(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(ds),ds.rtt[or]){const vs=this.pool.getObjectForId(ds.rtt[or].id);if(vs.stamp===ds.rtt[or].stamp){this.pool.useObject(vs);continue}}const ps=this.pool.getOrCreateFreeObject();this.pool.useObject(ps),this.pool.stampObject(ps),ds.rtt[or]={id:ps.id,stamp:ps.stamp},Ee.context.bindFramebuffer.set(ps.fbo.framebuffer),Ee.context.clear({color:a.Color.transparent,stencil:0}),Ee.currentStencilSource=void 0;for(let vs=0;vs<kn.length;vs++){const fl=Ee.style._layers[kn[vs]],pl=fl.source?this._coordsDescendingInv[fl.source][ds.tileID.key]:[ds.tileID];Ee.context.viewport.set([0,0,ps.fbo.width,ps.fbo.height]),Ee._renderTileClippingMasks(fl,pl),Ee.renderLayer(Ee,Ee.style.sourceCaches[fl.source],fl,pl),fl.source&&(ds.rttCoords[fl.source]=this._coordsDescendingInvStr[fl.source][ds.tileID.key])}}return Ov(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),By[D]}return!1}}const Jg=h,rx={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.config.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0},b_=ot=>{ot.touchstart=ot.dragStart,ot.touchmoveWindow=ot.dragMove,ot.touchend=ot.dragEnd},sv={showCompass:!0,showZoom:!0,visualizePitch:!1};class av{constructor(m,D,Ee=!1){this._clickTolerance=10;const ct=m.dragRotate._mouseRotate.getClickTolerance(),or=m.dragRotate._mousePitch.getClickTolerance();this.element=D,this.mouseRotate=v_({clickTolerance:ct,enable:!0}),this.touchRotate=(({enable:kn,clickTolerance:ds,bearingDegreesPerPixelMoved:ps=.8})=>{const vs=new __;return new Sm({clickTolerance:ds,move:(fl,pl)=>({bearingDelta:(pl.x-fl.x)*ps}),moveStateManager:vs,enable:kn,assignEvents:b_})})({clickTolerance:ct,enable:!0}),this.map=m,Ee&&(this.mousePitch=t_({clickTolerance:or,enable:!0}),this.touchPitch=(({enable:kn,clickTolerance:ds,pitchDegreesPerPixelMoved:ps=-.5})=>{const vs=new __;return new Sm({clickTolerance:ds,move:(fl,pl)=>({pitchDelta:(pl.y-fl.y)*ps}),moveStateManager:vs,enable:kn,assignEvents:b_})})({clickTolerance:or,enable:!0})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),y.addEventListener(D,"mousedown",this.mousedown),y.addEventListener(D,"touchstart",this.touchstart,{passive:!1}),y.addEventListener(D,"touchcancel",this.reset)}startMouse(m,D){this.mouseRotate.dragStart(m,D),this.mousePitch&&this.mousePitch.dragStart(m,D),y.disableDrag()}startTouch(m,D){this.touchRotate.dragStart(m,D),this.touchPitch&&this.touchPitch.dragStart(m,D),y.disableDrag()}moveMouse(m,D){const Ee=this.map,{bearingDelta:ct}=this.mouseRotate.dragMove(m,D)||{};if(ct&&Ee.setBearing(Ee.getBearing()+ct),this.mousePitch){const{pitchDelta:or}=this.mousePitch.dragMove(m,D)||{};or&&Ee.setPitch(Ee.getPitch()+or)}}moveTouch(m,D){const Ee=this.map,{bearingDelta:ct}=this.touchRotate.dragMove(m,D)||{};if(ct&&Ee.setBearing(Ee.getBearing()+ct),this.touchPitch){const{pitchDelta:or}=this.touchPitch.dragMove(m,D)||{};or&&Ee.setPitch(Ee.getPitch()+or)}}off(){const m=this.element;y.removeEventListener(m,"mousedown",this.mousedown),y.removeEventListener(m,"touchstart",this.touchstart,{passive:!1}),y.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),y.removeEventListener(window,"touchend",this.touchend),y.removeEventListener(m,"touchcancel",this.reset),this.offTemp()}offTemp(){y.enableDrag(),y.removeEventListener(window,"mousemove",this.mousemove),y.removeEventListener(window,"mouseup",this.mouseup),y.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),y.removeEventListener(window,"touchend",this.touchend)}mousedown(m){this.startMouse(a.extend({},m,{ctrlKey:!0,preventDefault:()=>m.preventDefault()}),y.mousePos(this.element,m)),y.addEventListener(window,"mousemove",this.mousemove),y.addEventListener(window,"mouseup",this.mouseup)}mousemove(m){this.moveMouse(m,y.mousePos(this.element,m))}mouseup(m){this.mouseRotate.dragEnd(m),this.mousePitch&&this.mousePitch.dragEnd(m),this.offTemp()}touchstart(m){m.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=y.touchPos(this.element,m.targetTouches)[0],this.startTouch(m,this._startPos),y.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),y.addEventListener(window,"touchend",this.touchend))}touchmove(m){m.targetTouches.length!==1?this.reset():(this._lastPos=y.touchPos(this.element,m.targetTouches)[0],this.moveTouch(m,this._lastPos))}touchend(m){m.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let Ym;function Hv(ot,m,D){if(ot=new a.LngLat(ot.lng,ot.lat),m){const Ee=new a.LngLat(ot.lng-360,ot.lat),ct=new a.LngLat(ot.lng+360,ot.lat),or=D.locationPoint(ot).distSqr(m);D.locationPoint(Ee).distSqr(m)<or?ot=Ee:D.locationPoint(ct).distSqr(m)<or&&(ot=ct)}for(;Math.abs(ot.lng-D.center.lng)>180;){const Ee=D.locationPoint(ot);if(Ee.x>=0&&Ee.y>=0&&Ee.x<=D.width&&Ee.y<=D.height)break;ot.lng>D.center.lng?ot.lng-=360:ot.lng+=360}return ot}const C_={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Wv(ot,m,D){const Ee=ot.classList;for(const ct in C_)Ee.remove(`maplibregl-${D}-anchor-${ct}`);Ee.add(`maplibregl-${D}-anchor-${m}`)}class qv extends a.Evented{constructor(m,D){if(super(),(m instanceof HTMLElement||D)&&(m=a.extend({element:m},D)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=m&&m.anchor||"center",this._color=m&&m.color||"#3FB1CE",this._scale=m&&m.scale||1,this._draggable=m&&m.draggable||!1,this._clickTolerance=m&&m.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=m&&m.rotation||0,this._rotationAlignment=m&&m.rotationAlignment||"auto",this._pitchAlignment=m&&m.pitchAlignment&&m.pitchAlignment!=="auto"?m.pitchAlignment:this._rotationAlignment,m&&m.element)this._element=m.element,this._offset=a.Point.convert(m&&m.offset||[0,0]);else{this._defaultMarker=!0,this._element=y.create("div"),this._element.setAttribute("aria-label","Map marker");const Ee=y.createNS("http://www.w3.org/2000/svg","svg"),ct=41,or=27;Ee.setAttributeNS(null,"display","block"),Ee.setAttributeNS(null,"height",`${ct}px`),Ee.setAttributeNS(null,"width",`${or}px`),Ee.setAttributeNS(null,"viewBox",`0 0 ${or} ${ct}`);const kn=y.createNS("http://www.w3.org/2000/svg","g");kn.setAttributeNS(null,"stroke","none"),kn.setAttributeNS(null,"stroke-width","1"),kn.setAttributeNS(null,"fill","none"),kn.setAttributeNS(null,"fill-rule","evenodd");const ds=y.createNS("http://www.w3.org/2000/svg","g");ds.setAttributeNS(null,"fill-rule","nonzero");const ps=y.createNS("http://www.w3.org/2000/svg","g");ps.setAttributeNS(null,"transform","translate(3.0, 29.0)"),ps.setAttributeNS(null,"fill","#000000");const vs=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ap of vs){const Lh=y.createNS("http://www.w3.org/2000/svg","ellipse");Lh.setAttributeNS(null,"opacity","0.04"),Lh.setAttributeNS(null,"cx","10.5"),Lh.setAttributeNS(null,"cy","5.80029008"),Lh.setAttributeNS(null,"rx",ap.rx),Lh.setAttributeNS(null,"ry",ap.ry),ps.appendChild(Lh)}const fl=y.createNS("http://www.w3.org/2000/svg","g");fl.setAttributeNS(null,"fill",this._color);const pl=y.createNS("http://www.w3.org/2000/svg","path");pl.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),fl.appendChild(pl);const ph=y.createNS("http://www.w3.org/2000/svg","g");ph.setAttributeNS(null,"opacity","0.25"),ph.setAttributeNS(null,"fill","#000000");const Ah=y.createNS("http://www.w3.org/2000/svg","path");Ah.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),ph.appendChild(Ah);const hh=y.createNS("http://www.w3.org/2000/svg","g");hh.setAttributeNS(null,"transform","translate(6.0, 7.0)"),hh.setAttributeNS(null,"fill","#FFFFFF");const Rh=y.createNS("http://www.w3.org/2000/svg","g");Rh.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Gh=y.createNS("http://www.w3.org/2000/svg","circle");Gh.setAttributeNS(null,"fill","#000000"),Gh.setAttributeNS(null,"opacity","0.25"),Gh.setAttributeNS(null,"cx","5.5"),Gh.setAttributeNS(null,"cy","5.5"),Gh.setAttributeNS(null,"r","5.4999962");const Kh=y.createNS("http://www.w3.org/2000/svg","circle");Kh.setAttributeNS(null,"fill","#FFFFFF"),Kh.setAttributeNS(null,"cx","5.5"),Kh.setAttributeNS(null,"cy","5.5"),Kh.setAttributeNS(null,"r","5.4999962"),Rh.appendChild(Gh),Rh.appendChild(Kh),ds.appendChild(ps),ds.appendChild(fl),ds.appendChild(ph),ds.appendChild(hh),ds.appendChild(Rh),Ee.appendChild(ds),Ee.setAttributeNS(null,"height",ct*this._scale+"px"),Ee.setAttributeNS(null,"width",or*this._scale+"px"),this._element.appendChild(Ee),this._offset=a.Point.convert(m&&m.offset||[0,-14])}this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",Ee=>{Ee.preventDefault()}),this._element.addEventListener("mousedown",Ee=>{Ee.preventDefault()}),Wv(this._element,this._anchor,"marker"),this._popup=null}addTo(m){return this.remove(),this._map=m,m.getCanvasContainer().appendChild(this._element),m.on("move",this._update),m.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),y.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=a.LngLat.convert(m),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(m){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),m){if(!("offset"in m.options)){const ct=Math.sqrt(Math.pow(13.5,2)/2);m.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[ct,-1*(38.1-13.5+ct)],"bottom-right":[-ct,-1*(38.1-13.5+ct)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=m,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(m){const D=m.code,Ee=m.charCode||m.keyCode;D!=="Space"&&D!=="Enter"&&Ee!==32&&Ee!==13||this.togglePopup()}_onMapClick(m){const D=m.originalEvent.target,Ee=this._element;this._popup&&(D===Ee||Ee.contains(D))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const m=this._popup;return m?(m.isOpen()?m.remove():m.addTo(this._map),this):this}_update(m){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Hv(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let D="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?D=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(D=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let Ee="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?Ee="rotateX(0deg)":this._pitchAlignment==="map"&&(Ee=`rotateX(${this._map.getPitch()}deg)`),m&&m.type!=="moveend"||(this._pos=this._pos.round()),y.setTransform(this._element,`${C_[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${Ee} ${D}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const ct=this._map.unproject(this._pos),or=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=ct.distanceTo(this._lngLat)>20*or?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(m){return this._offset=a.Point.convert(m),this._update(),this}_onMove(m){if(!this._isDragging){const D=this._clickTolerance||this._map._clickTolerance;this._isDragging=m.point.dist(this._pointerdownPos)>=D}this._isDragging&&(this._pos=m.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(m){this._element.contains(m.originalEvent.target)&&(m.preventDefault(),this._positionDelta=m.point.sub(this._pos).add(this._offset),this._pointerdownPos=m.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(m){return this._draggable=!!m,this._map&&(m?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(m){return this._rotation=m||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(m){return this._rotationAlignment=m||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(m){return this._pitchAlignment=m&&m!=="auto"?m:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const zy={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let lv=0,E_=!1;const Ax={maxWidth:100,unit:"metric"};function v0(ot,m,D){const Ee=D&&D.maxWidth||100,ct=ot._container.clientHeight/2,or=ot.unproject([0,ct]),kn=ot.unproject([Ee,ct]),ds=or.distanceTo(kn);if(D&&D.unit==="imperial"){const ps=3.2808*ds;ps>5280?i_(m,Ee,ps/5280,ot._getUIString("ScaleControl.Miles")):i_(m,Ee,ps,ot._getUIString("ScaleControl.Feet"))}else D&&D.unit==="nautical"?i_(m,Ee,ds/1852,ot._getUIString("ScaleControl.NauticalMiles")):ds>=1e3?i_(m,Ee,ds/1e3,ot._getUIString("ScaleControl.Kilometers")):i_(m,Ee,ds,ot._getUIString("ScaleControl.Meters"))}function i_(ot,m,D,Ee){const ct=function(or){const kn=Math.pow(10,`${Math.floor(or)}`.length-1);let ds=or/kn;return ds=ds>=10?10:ds>=5?5:ds>=3?3:ds>=2?2:ds>=1?1:function(ps){const vs=Math.pow(10,Math.ceil(-Math.log(ps)/Math.LN10));return Math.round(ps*vs)/vs}(ds),kn*ds}(D);ot.style.width=m*(ct/D)+"px",ot.innerHTML=`${ct}&nbsp;${Ee}`}const x0={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ix=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function fm(ot){if(ot){if(typeof ot=="number"){const m=Math.round(Math.sqrt(.5*Math.pow(ot,2)));return{center:new a.Point(0,0),top:new a.Point(0,ot),"top-left":new a.Point(m,m),"top-right":new a.Point(-m,m),bottom:new a.Point(0,-ot),"bottom-left":new a.Point(m,-m),"bottom-right":new a.Point(-m,-m),left:new a.Point(ot,0),right:new a.Point(-ot,0)}}if(ot instanceof a.Point||Array.isArray(ot)){const m=a.Point.convert(ot);return{center:m,top:m,"top-left":m,"top-right":m,bottom:m,"bottom-left":m,"bottom-right":m,left:m,right:m}}return{center:a.Point.convert(ot.center||[0,0]),top:a.Point.convert(ot.top||[0,0]),"top-left":a.Point.convert(ot["top-left"]||[0,0]),"top-right":a.Point.convert(ot["top-right"]||[0,0]),bottom:a.Point.convert(ot.bottom||[0,0]),"bottom-left":a.Point.convert(ot["bottom-left"]||[0,0]),"bottom-right":a.Point.convert(ot["bottom-right"]||[0,0]),left:a.Point.convert(ot.left||[0,0]),right:a.Point.convert(ot.right||[0,0])}}return fm(new a.Point(0,0))}const nx=h,w0={setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends Nd{constructor(ot){var m;if(a.PerformanceUtils.mark(a.PerformanceMarkers.create),(ot=a.extend({},rx,ot)).minZoom!=null&&ot.maxZoom!=null&&ot.minZoom>ot.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(ot.minPitch!=null&&ot.maxPitch!=null&&ot.minPitch>ot.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(ot.minPitch!=null&&ot.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(ot.maxPitch!=null&&ot.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new m_(ot.minZoom,ot.maxZoom,ot.minPitch,ot.maxPitch,ot.renderWorldCopies),{bearingSnap:ot.bearingSnap}),this._interactive=ot.interactive,this._cooperativeGestures=ot.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=ot.maxTileCacheSize,this._maxTileCacheZoomLevels=ot.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=ot.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=ot.preserveDrawingBuffer,this._antialias=ot.antialias,this._trackResize=ot.trackResize,this._bearingSnap=ot.bearingSnap,this._refreshExpiredTiles=ot.refreshExpiredTiles,this._fadeDuration=ot.fadeDuration,this._crossSourceCollisions=ot.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=ot.collectResourceTiming,this._renderTaskQueue=new jv,this._controls=[],this._mapId=a.uniqueId(),this._locale=a.extend({},tx,ot.locale),this._clickTolerance=ot.clickTolerance,this._pixelRatio=(m=ot.pixelRatio)!==null&&m!==void 0?m:devicePixelRatio,this.transformCameraUpdate=ot.transformCameraUpdate,this._imageQueueHandle=Bn.addThrottleControl(()=>this.isMoving()),this._requestManager=new vi(ot.transformRequest),typeof ot.container=="string"){if(this._container=document.getElementById(ot.container),!this._container)throw new Error(`Container '${ot.container}' not found.`)}else{if(!(ot.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=ot.container}if(ot.maxBounds&&this.setMaxBounds(ot.maxBounds),a.bindAll(["_onWindowOnline","_onMapScroll","_cooperativeGesturesOnWheel","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let D=!1;this._resizeObserver=new ResizeObserver(Ee=>{D?this._trackResize&&this.resize(Ee)._update():D=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Xm(this,ot),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=ot.hash&&new Ex(typeof ot.hash=="string"&&ot.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:ot.center,zoom:ot.zoom,bearing:ot.bearing,pitch:ot.pitch}),ot.bounds&&(this.resize(),this.fitBounds(ot.bounds,a.extend({},ot.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=ot.localIdeographFontFamily,this._validateStyle=ot.validateStyle,ot.style&&this.setStyle(ot.style,{localIdeographFontFamily:ot.localIdeographFontFamily}),ot.attributionControl&&this.addControl(new Kd({customAttribution:ot.customAttribution})),ot.maplibreLogo&&this.addControl(new nv,ot.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",D=>{this._update(D.dataType==="style"),this.fire(new a.Event(`${D.dataType}data`,D))}),this.on("dataloading",D=>{this.fire(new a.Event(`${D.dataType}dataloading`,D))}),this.on("dataabort",D=>{this.fire(new a.Event("sourcedataabort",D))})}_getMapId(){return this._mapId}addControl(ot,m){if(m===void 0&&(m=ot.getDefaultPosition?ot.getDefaultPosition():"top-right"),!ot||!ot.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const D=ot.onAdd(this);this._controls.push(ot);const Ee=this._controlPositions[m];return m.indexOf("bottom")!==-1?Ee.insertBefore(D,Ee.firstChild):Ee.appendChild(D),this}removeControl(ot){if(!ot||!ot.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const m=this._controls.indexOf(ot);return m>-1&&this._controls.splice(m,1),ot.onRemove(this),this}hasControl(ot){return this._controls.indexOf(ot)>-1}calculateCameraOptionsFromTo(ot,m,D,Ee){return Ee==null&&this.terrain&&(Ee=this.transform.getElevation(D,this.terrain)),super.calculateCameraOptionsFromTo(ot,m,D,Ee)}resize(ot){var m;const D=this._containerDimensions(),Ee=D[0],ct=D[1];this._resizeCanvas(Ee,ct,this.getPixelRatio()),this.transform.resize(Ee,ct),(m=this._requestedCameraState)===null||m===void 0||m.resize(Ee,ct),this.painter.resize(Ee,ct,this.getPixelRatio());const or=!this._moving;return or&&(this.stop(),this.fire(new a.Event("movestart",ot)).fire(new a.Event("move",ot))),this.fire(new a.Event("resize",ot)),or&&this.fire(new a.Event("moveend",ot)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(ot){const[m,D]=this._containerDimensions();this._pixelRatio=ot,this._resizeCanvas(m,D,ot),this.painter.resize(m,D,ot)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(ot){return this.transform.setMaxBounds(Rp.convert(ot)),this._update()}setMinZoom(ot){if((ot=ot??-2)>=-2&&ot<=this.transform.maxZoom)return this.transform.minZoom=ot,this._update(),this.getZoom()<ot&&this.setZoom(ot),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(ot){if((ot=ot??22)>=this.transform.minZoom)return this.transform.maxZoom=ot,this._update(),this.getZoom()>ot&&this.setZoom(ot),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(ot){if((ot=ot??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(ot>=0&&ot<=this.transform.maxPitch)return this.transform.minPitch=ot,this._update(),this.getPitch()<ot&&this.setPitch(ot),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(ot){if((ot=ot??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(ot>=this.transform.minPitch)return this.transform.maxPitch=ot,this._update(),this.getPitch()>ot&&this.setPitch(ot),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(ot){return this.transform.renderWorldCopies=ot,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(ot){return this._cooperativeGestures=ot,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(ot){return this.transform.locationPoint(a.LngLat.convert(ot),this.style&&this.terrain)}unproject(ot){return this.transform.pointLocation(a.Point.convert(ot),this.terrain)}isMoving(){var ot;return this._moving||((ot=this.handlers)===null||ot===void 0?void 0:ot.isMoving())}isZooming(){var ot;return this._zooming||((ot=this.handlers)===null||ot===void 0?void 0:ot.isZooming())}isRotating(){var ot;return this._rotating||((ot=this.handlers)===null||ot===void 0?void 0:ot.isRotating())}_createDelegatedListener(ot,m,D){if(ot==="mouseenter"||ot==="mouseover"){let Ee=!1;return{layer:m,listener:D,delegates:{mousemove:or=>{const kn=this.getLayer(m)?this.queryRenderedFeatures(or.point,{layers:[m]}):[];kn.length?Ee||(Ee=!0,D.call(this,new Vg(ot,this,or.originalEvent,{features:kn}))):Ee=!1},mouseout:()=>{Ee=!1}}}}if(ot==="mouseleave"||ot==="mouseout"){let Ee=!1;return{layer:m,listener:D,delegates:{mousemove:kn=>{(this.getLayer(m)?this.queryRenderedFeatures(kn.point,{layers:[m]}):[]).length?Ee=!0:Ee&&(Ee=!1,D.call(this,new Vg(ot,this,kn.originalEvent)))},mouseout:kn=>{Ee&&(Ee=!1,D.call(this,new Vg(ot,this,kn.originalEvent)))}}}}{const Ee=ct=>{const or=this.getLayer(m)?this.queryRenderedFeatures(ct.point,{layers:[m]}):[];or.length&&(ct.features=or,D.call(this,ct),delete ct.features)};return{layer:m,listener:D,delegates:{[ot]:Ee}}}}on(ot,m,D){if(D===void 0)return super.on(ot,m);const Ee=this._createDelegatedListener(ot,m,D);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[ot]=this._delegatedListeners[ot]||[],this._delegatedListeners[ot].push(Ee);for(const ct in Ee.delegates)this.on(ct,Ee.delegates[ct]);return this}once(ot,m,D){if(D===void 0)return super.once(ot,m);const Ee=this._createDelegatedListener(ot,m,D);for(const ct in Ee.delegates)this.once(ct,Ee.delegates[ct]);return this}off(ot,m,D){return D===void 0?super.off(ot,m):(this._delegatedListeners&&this._delegatedListeners[ot]&&(Ee=>{const ct=this._delegatedListeners[ot];for(let or=0;or<ct.length;or++){const kn=ct[or];if(kn.layer===m&&kn.listener===D){for(const ds in kn.delegates)this.off(ds,kn.delegates[ds]);return ct.splice(or,1),this}}})(),this)}queryRenderedFeatures(ot,m){if(!this.style)return[];let D;const Ee=ot instanceof a.Point||Array.isArray(ot),ct=Ee?ot:[[0,0],[this.transform.width,this.transform.height]];if(m=m||(Ee?{}:ot)||{},ct instanceof a.Point||typeof ct[0]=="number")D=[a.Point.convert(ct)];else{const or=a.Point.convert(ct[0]),kn=a.Point.convert(ct[1]);D=[or,new a.Point(kn.x,or.y),kn,new a.Point(or.x,kn.y),or]}return this.style.queryRenderedFeatures(D,m,this.transform)}querySourceFeatures(ot,m){return this.style.querySourceFeatures(ot,m)}setStyle(ot,m){return(m=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},m)).diff!==!1&&m.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&ot?(this._diffStyle(ot,m),this):(this._localIdeographFontFamily=m.localIdeographFontFamily,this._updateStyle(ot,m))}setTransformRequest(ot){return this._requestManager.setTransformRequest(ot),this}_getUIString(ot){const m=this._locale[ot];if(m==null)throw new Error(`Missing UI string '${ot}'`);return m}_updateStyle(ot,m){if(m.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(ot,m));const D=this.style&&m.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!ot)),ot?(this.style=new xm(this,m||{}),this.style.setEventedParent(this,{style:this.style}),typeof ot=="string"?this.style.loadURL(ot,m,D):this.style.loadJSON(ot,m,D),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new xm(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(ot,m){if(typeof ot=="string"){const D=this._requestManager.transformRequest(ot,yi.Style);a.getJSON(D,(Ee,ct)=>{Ee?this.fire(new a.ErrorEvent(Ee)):ct&&this._updateDiff(ct,m)})}else typeof ot=="object"&&this._updateDiff(ot,m)}_updateDiff(ot,m){try{this.style.setState(ot,m)&&this._update(!0)}catch(D){a.warnOnce(`Unable to perform style diff: ${D.message||D.error||D}.  Rebuilding the style from scratch.`),this._updateStyle(ot,m)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.warnOnce("There is no style added to the map.")}addSource(ot,m){return this._lazyInitEmptyStyle(),this.style.addSource(ot,m),this._update(!0)}isSourceLoaded(ot){const m=this.style&&this.style.sourceCaches[ot];if(m!==void 0)return m.loaded();this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${ot}'`)))}setTerrain(ot){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),ot){const m=this.style.sourceCaches[ot.source];if(!m)throw new Error(`cannot load terrain, because there exists no source with ID: ${ot.source}`);for(const D in this.style._layers){const Ee=this.style._layers[D];Ee.type==="hillshade"&&Ee.source===ot.source&&a.warnOnce("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new xy(this.painter,m,ot),this.painter.renderToTexture=new Pg(this.painter,this.terrain),this.transform.updateElevation(this.terrain),this._terrainDataCallback=D=>{D.dataType==="style"?this.terrain.sourceCache.freeRtt():D.dataType==="source"&&D.tile&&(D.sourceId===ot.source&&this.transform.updateElevation(this.terrain),this.terrain.sourceCache.freeRtt(D.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.updateElevation(this.terrain);return this.fire(new a.Event("terrain",{terrain:ot})),this}getTerrain(){return this.terrain&&this.terrain.options}areTilesLoaded(){const ot=this.style&&this.style.sourceCaches;for(const m in ot){const D=ot[m]._tiles;for(const Ee in D){const ct=D[Ee];if(ct.state!=="loaded"&&ct.state!=="errored")return!1}}return!0}addSourceType(ot,m,D){return this._lazyInitEmptyStyle(),this.style.addSourceType(ot,m,D)}removeSource(ot){return this.style.removeSource(ot),this._update(!0)}getSource(ot){return this.style.getSource(ot)}addImage(ot,m,{pixelRatio:D=1,sdf:Ee=!1,stretchX:ct,stretchY:or,content:kn}={}){if(this._lazyInitEmptyStyle(),m instanceof HTMLImageElement||a.isImageBitmap(m)){const{width:ds,height:ps,data:vs}=a.exported.getImageData(m);this.style.addImage(ot,{data:new a.RGBAImage({width:ds,height:ps},vs),pixelRatio:D,stretchX:ct,stretchY:or,content:kn,sdf:Ee,version:0})}else{if(m.width===void 0||m.height===void 0)return this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:ds,height:ps,data:vs}=m,fl=m;this.style.addImage(ot,{data:new a.RGBAImage({width:ds,height:ps},new Uint8Array(vs)),pixelRatio:D,stretchX:ct,stretchY:or,content:kn,sdf:Ee,version:0,userImage:fl}),fl.onAdd&&fl.onAdd(this,ot)}}}updateImage(ot,m){const D=this.style.getImage(ot);if(!D)return this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const Ee=m instanceof HTMLImageElement||a.isImageBitmap(m)?a.exported.getImageData(m):m,{width:ct,height:or,data:kn}=Ee;if(ct===void 0||or===void 0)return this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(ct!==D.data.width||or!==D.data.height)return this.fire(new a.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const ds=!(m instanceof HTMLImageElement||a.isImageBitmap(m));D.data.replace(kn,ds),this.style.updateImage(ot,D)}getImage(ot){return this.style.getImage(ot)}hasImage(ot){return ot?!!this.style.getImage(ot):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(ot){this.style.removeImage(ot)}loadImage(ot,m){Bn.getImage(this._requestManager.transformRequest(ot,yi.Image),m)}listImages(){return this.style.listImages()}addLayer(ot,m){return this._lazyInitEmptyStyle(),this.style.addLayer(ot,m),this._update(!0)}moveLayer(ot,m){return this.style.moveLayer(ot,m),this._update(!0)}removeLayer(ot){return this.style.removeLayer(ot),this._update(!0)}getLayer(ot){return this.style.getLayer(ot)}setLayerZoomRange(ot,m,D){return this.style.setLayerZoomRange(ot,m,D),this._update(!0)}setFilter(ot,m,D={}){return this.style.setFilter(ot,m,D),this._update(!0)}getFilter(ot){return this.style.getFilter(ot)}setPaintProperty(ot,m,D,Ee={}){return this.style.setPaintProperty(ot,m,D,Ee),this._update(!0)}getPaintProperty(ot,m){return this.style.getPaintProperty(ot,m)}setLayoutProperty(ot,m,D,Ee={}){return this.style.setLayoutProperty(ot,m,D,Ee),this._update(!0)}getLayoutProperty(ot,m){return this.style.getLayoutProperty(ot,m)}setGlyphs(ot,m={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(ot,m),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(ot,m,D={}){return this._lazyInitEmptyStyle(),this.style.addSprite(ot,m,D,Ee=>{Ee||this._update(!0)}),this}removeSprite(ot){return this._lazyInitEmptyStyle(),this.style.removeSprite(ot),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(ot,m={}){return this._lazyInitEmptyStyle(),this.style.setSprite(ot,m,D=>{D||this._update(!0)}),this}setLight(ot,m={}){return this._lazyInitEmptyStyle(),this.style.setLight(ot,m),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(ot,m){return this.style.setFeatureState(ot,m),this._update()}removeFeatureState(ot,m){return this.style.removeFeatureState(ot,m),this._update()}getFeatureState(ot){return this.style.getFeatureState(ot)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let ot=0,m=0;return this._container&&(ot=this._container.clientWidth||400,m=this._container.clientHeight||300),[ot,m]}_setupContainer(){const ot=this._container;ot.classList.add("maplibregl-map");const m=this._canvasContainer=y.create("div","maplibregl-canvas-container",ot);this._interactive&&m.classList.add("maplibregl-interactive"),this._canvas=y.create("canvas","maplibregl-canvas",m),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const D=this._containerDimensions();this._resizeCanvas(D[0],D[1],this.getPixelRatio());const Ee=this._controlContainer=y.create("div","maplibregl-control-container",ot),ct=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(or=>{ct[or]=y.create("div",`maplibregl-ctrl-${or} `,Ee)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_cooperativeGesturesOnWheel(ot){this._onCooperativeGesture(ot,ot[this._metaKey],1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=y.create("div","maplibregl-cooperative-gesture-screen",this._container);let ot=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(ot=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${ot}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){y.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(ot,m,D){this._canvas.width=D*ot,this._canvas.height=D*m,this._canvas.style.width=`${ot}px`,this._canvas.style.height=`${m}px`}_setupPainter(){const ot={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let m=null;this._canvas.addEventListener("webglcontextcreationerror",Ee=>{m={requestedAttributes:ot},Ee&&(m.statusMessage=Ee.statusMessage,m.type=Ee.type)},{once:!0});const D=this._canvas.getContext("webgl2",ot)||this._canvas.getContext("webgl",ot);if(!D){const Ee="Failed to initialize WebGL";throw m?(m.message=Ee,new Error(JSON.stringify(m))):new Error(Ee)}this.painter=new Z0(D,this.transform),C.testSupport(D)}_contextLost(ot){ot.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:ot}))}_contextRestored(ot){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:ot}))}_onMapScroll(ot){if(ot.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(ot,m,D){return!m&&D<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(ot){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||ot,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(ot){return this._update(),this._renderTaskQueue.add(ot)}_cancelRenderFrame(ot){this._renderTaskQueue.remove(ot)}_render(ot){const m=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(ot),this._removed)return;let D=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const ct=this.transform.zoom,or=a.exported.now();this.style.zoomHistory.update(ct,or);const kn=new a.EvaluationParameters(ct,{now:or,fadeDuration:m,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ds=kn.crossFadingFactor();ds===1&&ds===this._crossFadingFactor||(D=!0,this._crossFadingFactor=ds),this.style.update(kn)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain&&this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.updateElevation(this.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,m,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:m,showPadding:this.showPadding}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.PerformanceUtils.mark(a.PerformanceMarkers.load),this.fire(new a.Event("load"))),this.style&&(this.style.hasTransitions()||D)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const Ee=this._sourcesDirty||this._styleDirty||this._placementDirty;return Ee||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.Event("idle")),!this._loaded||this._fullyLoaded||Ee||(this._fullyLoaded=!0,a.PerformanceUtils.mark(a.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var ot;this._hash&&this._hash.remove();for(const D of this._controls)D.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Bn.removeThrottleControl(this._imageQueueHandle),(ot=this._resizeObserver)===null||ot===void 0||ot.disconnect();const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),y.remove(this._canvasContainer),y.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),a.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=a.exported.frame(ot=>{a.PerformanceUtils.frame(ot),this._frame=null,this._render(ot)}))}_onWindowOnline(){this._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(ot){this._showTileBoundaries!==ot&&(this._showTileBoundaries=ot,this._update())}get showPadding(){return!!this._showPadding}set showPadding(ot){this._showPadding!==ot&&(this._showPadding=ot,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(ot){this._showCollisionBoxes!==ot&&(this._showCollisionBoxes=ot,ot?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(ot){this._showOverdrawInspector!==ot&&(this._showOverdrawInspector=ot,this._update())}get repaint(){return!!this._repaint}set repaint(ot){this._repaint!==ot&&(this._repaint=ot,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(ot){this._vertices=ot,this._update()}get version(){return Jg}getCameraTargetElevation(){return this.transform.elevation}},NavigationControl:class{constructor(ot){this.options=a.extend({},sv,ot),this._container=y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",m=>m.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",m=>this._map.zoomIn({},{originalEvent:m})),y.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",m=>this._map.zoomOut({},{originalEvent:m})),y.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass",m=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:m}):this._map.resetNorth({},{originalEvent:m})}),this._compassIcon=y.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const ot=this._map.getZoom(),m=ot===this._map.getMaxZoom(),D=ot===this._map.getMinZoom();this._zoomInButton.disabled=m,this._zoomOutButton.disabled=D,this._zoomInButton.setAttribute("aria-disabled",m.toString()),this._zoomOutButton.setAttribute("aria-disabled",D.toString())}_rotateCompassArrow(){const ot=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=ot}onAdd(ot){return this._map=ot,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new av(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){y.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(ot,m){const D=y.create("button",ot,this._container);return D.type="button",D.addEventListener("click",m),D}_setButtonTitle(ot,m){const D=this._map._getUIString(`NavigationControl.${m}`);ot.title=D,ot.setAttribute("aria-label",D)}},GeolocateControl:class extends a.Evented{constructor(ot){super(),this.options=a.extend({},zy,ot),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(ot){return this._map=ot,this._container=y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(m,D=!1){Ym===void 0||D?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(Ee=>{Ym=Ee.state!=="denied",m(Ym)}).catch(()=>{Ym=!!window.navigator.geolocation,m(Ym)}):(Ym=!!window.navigator.geolocation,m(Ym)):m(Ym)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),y.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,lv=0,E_=!1}_isOutOfMapMaxBounds(ot){const m=this._map.getMaxBounds(),D=ot.coords;return m&&(D.longitude<m.getWest()||D.longitude>m.getEast()||D.latitude<m.getSouth()||D.latitude>m.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(ot){if(this._map){if(this._isOutOfMapMaxBounds(ot))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",ot)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=ot,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(ot),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(ot),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.Event("geolocate",ot)),this._finish()}}_updateCamera(ot){const m=new a.LngLat(ot.coords.longitude,ot.coords.latitude),D=ot.coords.accuracy,Ee=this._map.getBearing(),ct=a.extend({bearing:Ee},this.options.fitBoundsOptions),or=Rp.fromLngLat(m,D);this._map.fitBounds(or,ct,{geolocateSource:!0})}_updateMarker(ot){if(ot){const m=new a.LngLat(ot.coords.longitude,ot.coords.latitude);this._accuracyCircleMarker.setLngLat(m).addTo(this._map),this._userLocationDotMarker.setLngLat(m).addTo(this._map),this._accuracy=ot.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const ot=this._map.getBounds(),m=ot.getSouthEast(),D=ot.getNorthEast(),Ee=m.distanceTo(D),ct=Math.ceil(this._accuracy/(Ee/this._map._container.clientHeight)*2);this._circleElement.style.width=`${ct}px`,this._circleElement.style.height=`${ct}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(ot){if(this._map){if(this.options.trackUserLocation)if(ot.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const m=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=m,this._geolocateButton.setAttribute("aria-label",m),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(ot.code===3&&E_)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.Event("error",ot)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(ot){if(this._map){if(this._container.addEventListener("contextmenu",m=>m.preventDefault()),this._geolocateButton=y.create("button","maplibregl-ctrl-geolocate",this._container),y.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",ot===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const m=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=m,this._geolocateButton.setAttribute("aria-label",m)}else{const m=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=m,this._geolocateButton.setAttribute("aria-label",m)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=y.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new qv(this._dotElement),this._circleElement=y.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new qv({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",m=>{m.geolocateSource||this._watchState!=="ACTIVE_LOCK"||m.originalEvent&&m.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":lv--,E_=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let ot;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),lv++,lv>1?(ot={maximumAge:6e5,timeout:0},E_=!0):(ot=this.options.positionOptions,E_=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,ot)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Kd,LogoControl:nv,ScaleControl:class{constructor(ot){this.options=a.extend({},Ax,ot),a.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){v0(this._map,this._container,this.options)}onAdd(ot){return this._map=ot,this._container=y.create("div","maplibregl-ctrl maplibregl-ctrl-scale",ot.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){y.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(ot){this.options.unit=ot,v0(this._map,this._container,this.options)}},FullscreenControl:class extends a.Evented{constructor(ot={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,ot&&ot.container&&(ot.container instanceof HTMLElement?this._container=ot.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(ot){return this._map=ot,this._container||(this._container=this._map.getContainer()),this._controlContainer=y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){y.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const ot=this._fullscreenButton=y.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);y.create("span","maplibregl-ctrl-icon",ot).setAttribute("aria-hidden","true"),ot.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const ot=this._getTitle();this._fullscreenButton.setAttribute("aria-label",ot),this._fullscreenButton.title=ot}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.Event("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new a.Event("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},TerrainControl:class{constructor(ot){this.options=ot,a.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(ot){return this._map=ot,this._container=y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=y.create("button","maplibregl-ctrl-terrain",this._container),y.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){y.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends a.Evented{constructor(ot){super(),this.options=a.extend(Object.create(x0),ot),a.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(ot){return this._map&&this.remove(),this._map=ot,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&y.remove(this._content),this._container&&(y.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(ot){return this._lngLat=a.LngLat.convert(ot),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(ot){return this.setDOMContent(document.createTextNode(ot))}setHTML(ot){const m=document.createDocumentFragment(),D=document.createElement("body");let Ee;for(D.innerHTML=ot;Ee=D.firstChild,Ee;)m.appendChild(Ee);return this.setDOMContent(m)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(ot){return this.options.maxWidth=ot,this._update(),this}setDOMContent(ot){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=y.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(ot),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(ot){this._container&&this._container.classList.add(ot)}removeClassName(ot){this._container&&this._container.classList.remove(ot)}setOffset(ot){return this.options.offset=ot,this._update(),this}toggleClassName(ot){if(this._container)return this._container.classList.toggle(ot)}_createCloseButton(){this.options.closeButton&&(this._closeButton=y.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(ot){this._update(ot.point)}_onMouseMove(ot){this._update(ot.point)}_onDrag(ot){this._update(ot.point)}_update(ot){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=y.create("div","maplibregl-popup",this._map.getContainer()),this._tip=y.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(or=>this._container.classList.add(or)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Hv(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!ot))return;const m=this._pos=this._trackPointer&&ot?ot:this._map.project(this._lngLat);let D=this.options.anchor;const Ee=fm(this.options.offset);if(!D){const or=this._container.offsetWidth,kn=this._container.offsetHeight;let ds;ds=m.y+Ee.bottom.y<kn?["top"]:m.y>this._map.transform.height-kn?["bottom"]:[],m.x<or/2?ds.push("left"):m.x>this._map.transform.width-or/2&&ds.push("right"),D=ds.length===0?"bottom":ds.join("-")}const ct=m.add(Ee[D]).round();y.setTransform(this._container,`${C_[D]} translate(${ct.x}px,${ct.y}px)`),Wv(this._container,D,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const ot=this._container.querySelector(ix);ot&&ot.focus()}_onClose(){this.remove()}},Marker:qv,Style:xm,LngLat:a.LngLat,LngLatBounds:Rp,Point:a.Point,MercatorCoordinate:a.MercatorCoordinate,Evented:a.Evented,AJAXError:a.AJAXError,config:a.config,CanvasSource:Yh,GeoJSONSource:Gd,ImageSource:Ad,RasterDEMTileSource:ed,RasterTileSource:Ld,VectorTileSource:Wp,VideoSource:Id,prewarm:function(){Ed().acquire($f)},clearPrewarmedResources:function(){const ot=xd;ot&&(ot.isPreloaded()&&ot.numActive()===1?(ot.release($f),xd=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return nx},get workerCount(){return up.workerCount},set workerCount(ot){up.workerCount=ot},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(ot){a.config.MAX_PARALLEL_IMAGE_REQUESTS=ot},get workerUrl(){return a.config.WORKER_URL},set workerUrl(ot){a.config.WORKER_URL=ot},addProtocol(ot,m){a.config.REGISTERED_PROTOCOLS[ot]=m},removeProtocol(ot){delete a.config.REGISTERED_PROTOCOLS[ot]}};return tm.extend(w0,{isSafari:a.isSafari,getPerformanceMetrics:a.PerformanceUtils.getPerformanceMetrics}),w0});var l=o;return l})})(maplibreGl);var maplibreGlExports=maplibreGl.exports;const maplibregl__default=getDefaultExportFromCjs(maplibreGlExports),version$2="3.7.5",VERSION$3=version$2,_hasatob=typeof atob=="function",_hasbtoa=typeof btoa=="function",_hasBuffer=typeof Buffer=="function",_TD=typeof TextDecoder=="function"?new TextDecoder:void 0,_TE=typeof TextEncoder=="function"?new TextEncoder:void 0,b64ch="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",b64chs=Array.prototype.slice.call(b64ch),b64tab=(n=>{let t={};return n.forEach((e,r)=>t[e]=r),t})(b64chs),b64re=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,_fromCC=String.fromCharCode.bind(String),_U8Afrom=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):n=>new Uint8Array(Array.prototype.slice.call(n,0)),_mkUriSafe=n=>n.replace(/=/g,"").replace(/[+\/]/g,t=>t=="+"?"-":"_"),_tidyB64=n=>n.replace(/[^A-Za-z0-9\+\/]/g,""),btoaPolyfill=n=>{let t,e,r,o,s="";const l=n.length%3;for(let a=0;a<n.length;){if((e=n.charCodeAt(a++))>255||(r=n.charCodeAt(a++))>255||(o=n.charCodeAt(a++))>255)throw new TypeError("invalid character found");t=e<<16|r<<8|o,s+=b64chs[t>>18&63]+b64chs[t>>12&63]+b64chs[t>>6&63]+b64chs[t&63]}return l?s.slice(0,l-3)+"===".substring(l):s},_btoa=_hasbtoa?n=>btoa(n):_hasBuffer?n=>Buffer.from(n,"binary").toString("base64"):btoaPolyfill,_fromUint8Array=_hasBuffer?n=>Buffer.from(n).toString("base64"):n=>{let e=[];for(let r=0,o=n.length;r<o;r+=4096)e.push(_fromCC.apply(null,n.subarray(r,r+4096)));return _btoa(e.join(""))},fromUint8Array=(n,t=!1)=>t?_mkUriSafe(_fromUint8Array(n)):_fromUint8Array(n),cb_utob=n=>{if(n.length<2){var t=n.charCodeAt(0);return t<128?n:t<2048?_fromCC(192|t>>>6)+_fromCC(128|t&63):_fromCC(224|t>>>12&15)+_fromCC(128|t>>>6&63)+_fromCC(128|t&63)}else{var t=65536+(n.charCodeAt(0)-55296)*1024+(n.charCodeAt(1)-56320);return _fromCC(240|t>>>18&7)+_fromCC(128|t>>>12&63)+_fromCC(128|t>>>6&63)+_fromCC(128|t&63)}},re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,utob=n=>n.replace(re_utob,cb_utob),_encode=_hasBuffer?n=>Buffer.from(n,"utf8").toString("base64"):_TE?n=>_fromUint8Array(_TE.encode(n)):n=>_btoa(utob(n)),encode$4=(n,t=!1)=>t?_mkUriSafe(_encode(n)):_encode(n),encodeURI=n=>encode$4(n,!0),re_btou=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,cb_btou=n=>{switch(n.length){case 4:var t=(7&n.charCodeAt(0))<<18|(63&n.charCodeAt(1))<<12|(63&n.charCodeAt(2))<<6|63&n.charCodeAt(3),e=t-65536;return _fromCC((e>>>10)+55296)+_fromCC((e&1023)+56320);case 3:return _fromCC((15&n.charCodeAt(0))<<12|(63&n.charCodeAt(1))<<6|63&n.charCodeAt(2));default:return _fromCC((31&n.charCodeAt(0))<<6|63&n.charCodeAt(1))}},btou=n=>n.replace(re_btou,cb_btou),atobPolyfill=n=>{if(n=n.replace(/\s+/g,""),!b64re.test(n))throw new TypeError("malformed base64.");n+="==".slice(2-(n.length&3));let t,e="",r,o;for(let s=0;s<n.length;)t=b64tab[n.charAt(s++)]<<18|b64tab[n.charAt(s++)]<<12|(r=b64tab[n.charAt(s++)])<<6|(o=b64tab[n.charAt(s++)]),e+=r===64?_fromCC(t>>16&255):o===64?_fromCC(t>>16&255,t>>8&255):_fromCC(t>>16&255,t>>8&255,t&255);return e},_atob=_hasatob?n=>atob(_tidyB64(n)):_hasBuffer?n=>Buffer.from(n,"base64").toString("binary"):atobPolyfill,_toUint8Array=_hasBuffer?n=>_U8Afrom(Buffer.from(n,"base64")):n=>_U8Afrom(_atob(n).split("").map(t=>t.charCodeAt(0))),toUint8Array=n=>_toUint8Array(_unURI(n)),_decode=_hasBuffer?n=>Buffer.from(n,"base64").toString("utf8"):_TD?n=>_TD.decode(_toUint8Array(n)):n=>btou(_atob(n)),_unURI=n=>_tidyB64(n.replace(/[-_]/g,t=>t=="-"?"+":"/")),decode$6=n=>_decode(_unURI(n)),isValid=n=>{if(typeof n!="string")return!1;const t=n.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(t)||!/[^\s0-9a-zA-Z\-_]/.test(t)},_noEnum=n=>({value:n,enumerable:!1,writable:!0,configurable:!0}),extendString=function(){const n=(t,e)=>Object.defineProperty(String.prototype,t,_noEnum(e));n("fromBase64",function(){return decode$6(this)}),n("toBase64",function(t){return encode$4(this,t)}),n("toBase64URI",function(){return encode$4(this,!0)}),n("toBase64URL",function(){return encode$4(this,!0)}),n("toUint8Array",function(){return toUint8Array(this)})},extendUint8Array=function(){const n=(t,e)=>Object.defineProperty(Uint8Array.prototype,t,_noEnum(e));n("toBase64",function(t){return fromUint8Array(this,t)}),n("toBase64URI",function(){return fromUint8Array(this,!0)}),n("toBase64URL",function(){return fromUint8Array(this,!0)})},extendBuiltins=()=>{extendString(),extendUint8Array()},gBase64={version:version$2,VERSION:VERSION$3,atob:_atob,atobPolyfill,btoa:_btoa,btoaPolyfill,fromBase64:decode$6,toBase64:encode$4,encode:encode$4,encodeURI,encodeURL:encodeURI,utob,btou,decode:decode$6,isValid,fromUint8Array,toUint8Array,extendString,extendUint8Array,extendBuiltins};function tryGettingFetch(){return typeof self<"u"?fetch.bind(self):typeof global<"u"&&global.fetch?global.fetch:null}class ClientConfig{constructor(){this._apiKey="",this._fetch=tryGettingFetch()}set apiKey(t){this._apiKey=t}get apiKey(){return this._apiKey}set fetch(t){this._fetch=t}get fetch(){return this._fetch}}const config$1=new ClientConfig,LanguageGeocoding={AUTO:"auto",ALBANIAN:"sq",ARABIC:"ar",ARMENIAN:"hy",AZERBAIJANI:"az",BELORUSSIAN:"be",BOSNIAN:"bs",BRETON:"br",BULGARIAN:"bg",CATALAN:"ca",CHINESE:"zh",CROATIAN:"hr",CZECH:"cs",DANISH:"da",DUTCH:"nl",ENGLISH:"en",ESPERANTO:"eo",ESTONIAN:"et",FINNISH:"fi",FRENCH:"fr",FRISIAN:"fy",GEORGIAN:"ka",GERMAN:"de",GREEK:"el",HEBREW:"he",HUNGARIAN:"hu",ICELANDIC:"is",IRISH:"ga",ITALIAN:"it",JAPANESE:"ja",KANNADA:"kn",KAZAKH:"kk",KOREAN:"ko",ROMAN_LATIN:"la",LATVIAN:"lv",LITHUANIAN:"lt",LUXEMBOURGISH:"lb",MACEDONIAN:"mk",MALTESE:"mt",NORWEGIAN:"no",POLISH:"pl",PORTUGUESE:"pt",ROMANIAN:"ro",ROMANSH:"rm",RUSSIAN:"ru",SCOTTISH_GAELIC:"gd",SERBIAN_CYRILLIC:"sr",SLOVAK:"sk",SLOVENE:"sl",SPANISH:"es",SWEDISH:"sv",THAI:"th",TURKISH:"tr",UKRAINIAN:"uk",WELSH:"cy"},languageCodeSet$1=new Set(Object.values(LanguageGeocoding));function getAutoLanguageGeocoding(){if(typeof navigator>"u")return Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];const n=Array.from(new Set(navigator.languages.map(t=>t.split("-")[0]))).filter(t=>languageCodeSet$1.has(t));return n.length?n[0]:LanguageGeocoding.ENGLISH}var __async$4=(n,t,e)=>new Promise((r,o)=>{var s=h=>{try{a(e.next(h))}catch(y){o(y)}},l=h=>{try{a(e.throw(h))}catch(y){o(y)}},a=h=>h.done?r(h.value):Promise.resolve(h.value).then(s,l);a((e=e.apply(n,t)).next())});function callFetch(n){return __async$4(this,arguments,function*(t,e={}){if(config$1.fetch===null)throw new Error("The fetch function was not found. If on NodeJS < 18 please specify the fetch function with config.fetch");if(new URL(t).searchParams.get("key").trim()==="")throw new Error("The MapTiler Cloud API key is missing. Set it in `config.apiKey` or get one for free at https://maptiler.com");return config$1.fetch(t,e)})}const defaults$1={maptilerApiURL:"https://api.maptiler.com/",mapStyle:"streets-v2"};Object.freeze(defaults$1);class ServiceError extends Error{constructor(t,e=""){super(`Call to enpoint ${t.url} failed with the status code ${t.status}. ${e}`),this.res=t}}var __async$3=(n,t,e)=>new Promise((r,o)=>{var s=h=>{try{a(e.next(h))}catch(y){o(y)}},l=h=>{try{a(e.throw(h))}catch(y){o(y)}},a=h=>h.done?r(h.value):Promise.resolve(h.value).then(s,l);a((e=e.apply(n,t)).next())});const customMessages$3={400:"Query too long / Invalid parameters",403:"Key is missing, invalid or restricted"};function addLanguageGeocodingOptions(n,t){if(t.language==null)return;const e=Array.from(new Set((Array.isArray(t.language)?t.language:[t.language]).map(r=>r===LanguageGeocoding.AUTO?getAutoLanguageGeocoding():r))).join(",");n.set("language",e)}function addCommonForwardAndReverseGeocodingOptions(n,t){var e;n.set("key",(e=t.apiKey)!=null?e:config$1.apiKey),t.limit!=null&&n.set("limit",String(t.limit)),t.types!=null&&n.set("types",t.types.join(",")),addLanguageGeocodingOptions(n,t)}function addForwardGeocodingOptions(n,t){addCommonForwardAndReverseGeocodingOptions(n,t),t.bbox!=null&&n.set("bbox",t.bbox.join(",")),t.proximity!=null&&n.set("proximity",t.proximity.join(",")),t.country!=null&&n.set("country",t.country.join(",")),t.fuzzyMatch!=null&&n.set("fuzzyMatch",t.fuzzyMatch?"true":"false"),t.autocomplete!=null&&n.set("autocomplete",t.autocomplete?"true":"false")}function forward(n){return __async$3(this,arguments,function*(t,e={}){var r;if(typeof t!="string"||t.trim().length===0)throw new Error("The query must be a non-empty string");const o=new URL(`geocoding/${encodeURIComponent(t)}.json`,defaults$1.maptilerApiURL),{searchParams:s}=o;addForwardGeocodingOptions(s,e);const l=o.toString(),a=yield callFetch(l);if(!a.ok)throw new ServiceError(a,(r=customMessages$3[a.status])!=null?r:"");return yield a.json()})}function reverse(n){return __async$3(this,arguments,function*(t,e={}){var r;if(!Array.isArray(t)||t.length<2)throw new Error("The position must be an array of form [lng, lat].");const o=new URL(`geocoding/${t[0]},${t[1]}.json`,defaults$1.maptilerApiURL);addCommonForwardAndReverseGeocodingOptions(o.searchParams,e);const s=o.toString(),l=yield callFetch(s);if(!l.ok)throw new ServiceError(l,(r=customMessages$3[l.status])!=null?r:"");return yield l.json()})}function byId(n){return __async$3(this,arguments,function*(t,e={}){var r;const o=new URL(`geocoding/${t}.json`,defaults$1.maptilerApiURL);addLanguageGeocodingOptions(o.searchParams,e);const s=o.toString(),l=yield callFetch(s);if(!l.ok)throw new ServiceError(l,(r=customMessages$3[l.status])!=null?r:"");return yield l.json()})}function batch(n){return __async$3(this,arguments,function*(t,e={}){var r;if(!t.length)return[];const o=t.map(C=>encodeURIComponent(C)).join(";"),s=new URL(`geocoding/${o}.json`,defaults$1.maptilerApiURL),{searchParams:l}=s;addForwardGeocodingOptions(l,e);const a=s.toString(),h=yield callFetch(a);if(!h.ok)throw new ServiceError(h,(r=customMessages$3[h.status])!=null?r:"");const y=yield h.json();return t.length===1?[y]:y})}const geocoding={forward,reverse,byId,batch,language:LanguageGeocoding};var __async$2=(n,t,e)=>new Promise((r,o)=>{var s=h=>{try{a(e.next(h))}catch(y){o(y)}},l=h=>{try{a(e.throw(h))}catch(y){o(y)}},a=h=>h.done?r(h.value):Promise.resolve(h.value).then(s,l);a((e=e.apply(n,t)).next())});const customMessages$2={403:"Key is missing, invalid or restricted"};function info(){return __async$2(this,arguments,function*(n={}){var t;const e=new URL("geolocation/ip.json",defaults$1.maptilerApiURL);e.searchParams.set("key",(t=n.apiKey)!=null?t:config$1.apiKey);const r=e.toString(),o=yield callFetch(r);if(!o.ok)throw new ServiceError(o,o.status in customMessages$2?customMessages$2[o.status]:"");return yield o.json()})}const geolocation={info};var __async$1=(n,t,e)=>new Promise((r,o)=>{var s=h=>{try{a(e.next(h))}catch(y){o(y)}},l=h=>{try{a(e.throw(h))}catch(y){o(y)}},a=h=>h.done?r(h.value):Promise.resolve(h.value).then(s,l);a((e=e.apply(n,t)).next())});const customMessages$1={403:"Key is missing, invalid or restricted"};function search(n){return __async$1(this,arguments,function*(t,e={}){var r;if(typeof t!="string"||t.trim().length===0)throw new Error("The query must be a non-empty string");const o=new URL(`coordinates/search/${t}.json`,defaults$1.maptilerApiURL);o.searchParams.set("key",(r=e.apiKey)!=null?r:config$1.apiKey),"limit"in e&&o.searchParams.set("limit",e.limit.toString()),"transformations"in e&&o.searchParams.set("transformations",e.transformations.toString()),"exports"in e&&o.searchParams.set("exports",e.exports.toString());const s=o.toString(),l=yield callFetch(s);if(!l.ok)throw new ServiceError(l,l.status in customMessages$1?customMessages$1[l.status]:"");return yield l.json()})}function transform(n){return __async$1(this,arguments,function*(t,e={}){var r;const o=(Array.isArray(t[0])?t:[t]).map(y=>`${y[0]},${y[1]}`).join(";"),s=new URL(`coordinates/transform/${o}.json`,defaults$1.maptilerApiURL);s.searchParams.set("key",(r=e.apiKey)!=null?r:config$1.apiKey),"sourceCrs"in e&&s.searchParams.set("s_srs",e.sourceCrs.toString()),"targetCrs"in e&&s.searchParams.set("t_srs",e.targetCrs.toString()),"operations"in e&&s.searchParams.set("ops",(Array.isArray(e.operations)?e.operations:[e.operations]).join("|"));const l=s.toString(),a=yield callFetch(l);if(!a.ok)throw new ServiceError(a,a.status in customMessages$1?customMessages$1[a.status]:"");return yield a.json()})}const coordinates={search,transform};var __async$5=(n,t,e)=>new Promise((r,o)=>{var s=h=>{try{a(e.next(h))}catch(y){o(y)}},l=h=>{try{a(e.throw(h))}catch(y){o(y)}},a=h=>h.done?r(h.value):Promise.resolve(h.value).then(s,l);a((e=e.apply(n,t)).next())});const customMessages={403:"Key is missing, invalid or restricted"};function get$2(n){return __async$5(this,arguments,function*(t,e={}){var r;if(typeof t!="string"||t.trim().length===0)throw new Error("The data ID must be a non-empty string");const o=new URL(`data/${encodeURIComponent(t)}/features.json`,defaults$1.maptilerApiURL);o.searchParams.set("key",(r=e.apiKey)!=null?r:config$1.apiKey);const s=o.toString(),l=yield callFetch(s);if(!l.ok)throw new ServiceError(l,l.status in customMessages?customMessages[l.status]:"");return yield l.json()})}const data={get:get$2};function expandMapStyle(n){const t=/^maptiler:\/\/(.*)/;let e;const r=n.trim();let o;return r.startsWith("http://")||r.startsWith("https://")?o=r:(e=t.exec(r))!==null?o=`https://api.maptiler.com/maps/${e[1]}/style.json`:o=`https://api.maptiler.com/maps/${r}/style.json`,o}class MapStyleVariant{constructor(t,e,r,o,s,l){this.name=t,this.variantType=e,this.id=r,this.referenceStyle=o,this.description=s,this.imageURL=l}getName(){return this.name}getFullName(){return`${this.referenceStyle.getName()} ${this.name}`}getType(){return this.variantType}getId(){return this.id}getDescription(){return this.description}getReferenceStyle(){return this.referenceStyle}hasVariant(t){return this.referenceStyle.hasVariant(t)}getVariant(t){return this.referenceStyle.getVariant(t)}getVariants(){return this.referenceStyle.getVariants().filter(t=>t!==this)}getImageURL(){return this.imageURL}getExpandedStyleURL(){return expandMapStyle(this.getId())}}class ReferenceMapStyle{constructor(t,e){this.name=t,this.id=e,this.variants={},this.orderedVariants=[]}getName(){return this.name}getId(){return this.id}addVariant(t){this.variants[t.getType()]=t,this.orderedVariants.push(t)}hasVariant(t){return t in this.variants}getVariant(t){return t in this.variants?this.variants[t]:this.orderedVariants[0]}getVariants(){return Object.values(this.variants)}getDefaultVariant(){return this.orderedVariants[0]}}const mapStylePresetList=[{referenceStyleID:"STREETS",name:"Streets",description:"",variants:[{id:"streets-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"streets-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"streets-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"streets-v2-night",name:"Night",variantType:"NIGHT",description:"",imageURL:""},{id:"streets-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OUTDOOR",name:"Outdoor",description:"",variants:[{id:"outdoor-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"outdoor-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"WINTER",name:"Winter",description:"",variants:[{id:"winter-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"winter-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"SATELLITE",name:"Satellite",description:"",variants:[{id:"satellite",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"HYBRID",name:"Hybrid",description:"",variants:[{id:"hybrid",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"BASIC",name:"Basic",description:"",variants:[{id:"basic-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"basic-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"basic-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BRIGHT",name:"Bright",description:"",variants:[{id:"bright-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"bright-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"bright-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"bright-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OPENSTREETMAP",name:"OpenStreetMap",description:"",variants:[{id:"openstreetmap",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"TOPO",name:"Topo",description:"",variants:[{id:"topo-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"topo-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"topo-v2-shiny",name:"Shiny",variantType:"SHINY",description:"",imageURL:""},{id:"topo-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""},{id:"topo-v2-topographique",name:"Topographique",variantType:"TOPOGRAPHIQUE",description:"",imageURL:""}]},{referenceStyleID:"VOYAGER",name:"Voyager",description:"",variants:[{id:"voyager-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"voyager-v2-darkmatter",name:"Darkmatter",variantType:"DARK",description:"",imageURL:""},{id:"voyager-v2-positron",name:"Positron",variantType:"LIGHT",description:"",imageURL:""},{id:"voyager-v2-vintage",name:"Vintage",variantType:"VINTAGE",description:"",imageURL:""}]},{referenceStyleID:"TONER",name:"Toner",description:"",variants:[{id:"toner-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"toner-v2-background",name:"Background",variantType:"BACKGROUND",description:"",imageURL:""},{id:"toner-v2-lite",name:"Lite",variantType:"LITE",description:"",imageURL:""},{id:"toner-v2-lines",name:"Lines",variantType:"LINES",description:"",imageURL:""}]},{referenceStyleID:"DATAVIZ",name:"Dataviz",description:"",variants:[{id:"dataviz",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"dataviz-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"dataviz-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BACKDROP",name:"Backdrop",description:"",variants:[{id:"backdrop",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"backdrop-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"backdrop-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"OCEAN",name:"Ocean",description:"",variants:[{id:"ocean",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]}];function makeReferenceStyleProxy(n){return new Proxy(n,{get(t,e,r){return t.hasVariant(e)?t.getVariant(e):e.toString().toUpperCase()===e?n.getDefaultVariant():Reflect.get(t,e,r)}})}function buildMapStyles(){const n={};for(let t=0;t<mapStylePresetList.length;t+=1){const e=mapStylePresetList[t],r=makeReferenceStyleProxy(new ReferenceMapStyle(e.name,e.referenceStyleID));for(let o=0;o<e.variants.length;o+=1){const s=e.variants[o],l=new MapStyleVariant(s.name,s.variantType,s.id,r,s.description,s.imageURL);r.addVariant(l)}n[e.referenceStyleID]=r}return n}function styleToStyle$1(n){if(!n)return MapStyle[mapStylePresetList[0].referenceStyleID].getDefaultVariant().getId();if(typeof n=="string"||n instanceof String)return n.trim().toLowerCase();if(n instanceof MapStyleVariant)return n.getId();if(n instanceof ReferenceMapStyle)return n.getDefaultVariant().getId()}const MapStyle=buildMapStyles();function getSqSegDist(n,t,e){let r=t[0],o=t[1],s=e[0]-r,l=e[1]-o;if(s!==0||l!==0){const a=((n[0]-r)*s+(n[1]-o)*l)/(s*s+l*l);a>1?(r=e[0],o=e[1]):a>0&&(r+=s*a,o+=l*a)}return s=n[0]-r,l=n[1]-o,s*s+l*l}function simplifyDPStep(n,t,e,r,o){let s=r,l;for(let a=t+1;a<e;a++){const h=getSqSegDist(n[a],n[t],n[e]);h>s&&(l=a,s=h)}s>r&&(l-t>1&&simplifyDPStep(n,t,l,r,o),o.push(n[l]),e-l>1&&simplifyDPStep(n,l,e,r,o))}function simplifyDouglasPeucker(n,t){const e=n.length-1,r=[n[0]];return simplifyDPStep(n,0,e,t,r),r.push(n[e]),r}function simplify(n,t){if(n.length<=2)return n;const e=t!==void 0?t*t:1;return simplifyDouglasPeucker(n,e)}function staticMapMarkerToString(n,t=!0){let e=`${n[0]},${n[1]}`;return n.length===3&&t&&(e+=`,${n[2]}`),e}function simplifyAndStringify(n,t=3e3){let e=n.map(s=>s.join(",")).join("|"),r=5e-6;const o=1e-5;for(;e.length>t;)e=simplify(n,r).map(l=>`${l[0]},${l[1]}`).join("|"),r+=o;return e}function centered(n,t,e={}){var r,o,s,l,a;const h=styleToStyle$1(e.style),y=e.hiDPI?"@2x":"",C=(r=e.format)!=null?r:"png";let L=~~((o=e.width)!=null?o:1024),Y=~~((s=e.height)!=null?s:1024);e.hiDPI&&(L=~~(L/2),Y=~~(Y/2));const ze=new URL(`maps/${encodeURIComponent(h)}/static/${n[0]},${n[1]},${t}/${L}x${Y}${y}.${C}`,defaults$1.maptilerApiURL);if("attribution"in e&&ze.searchParams.set("attribution",e.attribution.toString()),"markers"in e){let Bt="";const Ir="markerIcon"in e;Ir&&(Bt+=`icon:${e.markerIcon}|`),Ir&&"markerAnchor"in e&&(Bt+=`anchor:${e.markerAnchor}|`),Ir&&e.hiDPI&&(Bt+="scale:2|");const Wr=Array.isArray(e.markers[0])?e.markers:[e.markers];Bt+=Wr.map(yi=>staticMapMarkerToString(yi,!Ir)).join("|"),ze.searchParams.set("markers",Bt)}if("path"in e){let Bt="";if(Bt+=`fill:${(l=e.pathFillColor)!=null?l:"none"}|`,"pathStrokeColor"in e&&(Bt+=`stroke:${e.pathStrokeColor}|`),"pathWidth"in e){const Ir=e.pathWidth/(e.hiDPI?2:1);Bt+=`width:${Ir.toString()}|`}Bt+=simplifyAndStringify(e.path),ze.searchParams.set("path",Bt)}return ze.searchParams.set("key",(a=e.apiKey)!=null?a:config$1.apiKey),ze.toString()}function bounded(n,t={}){var e,r,o,s,l;const a=styleToStyle$1(t.style),h=t.hiDPI?"@2x":"",y=(e=t.format)!=null?e:"png";let C=~~((r=t.width)!=null?r:1024),L=~~((o=t.height)!=null?o:1024);t.hiDPI&&(C=~~(C/2),L=~~(L/2));const Y=new URL(`maps/${encodeURIComponent(a)}/static/${n[0]},${n[1]},${n[2]},${n[3]}/${C}x${L}${h}.${y}`,defaults$1.maptilerApiURL);if("attribution"in t&&Y.searchParams.set("attribution",t.attribution.toString()),"padding"in t&&Y.searchParams.set("padding",t.padding.toString()),"markers"in t){let ze="";const Bt="markerIcon"in t;Bt&&(ze+=`icon:${t.markerIcon}|`),Bt&&"markerAnchor"in t&&(ze+=`anchor:${t.markerAnchor}|`),Bt&&t.hiDPI&&(ze+="scale:2|");const Ir=Array.isArray(t.markers[0])?t.markers:[t.markers];ze+=Ir.map(Wr=>staticMapMarkerToString(Wr,!Bt)).join("|"),Y.searchParams.set("markers",ze)}if("path"in t){let ze="";if(ze+=`fill:${(s=t.pathFillColor)!=null?s:"none"}|`,"pathStrokeColor"in t&&(ze+=`stroke:${t.pathStrokeColor}|`),"pathWidth"in t){const Bt=t.pathWidth/(t.hiDPI?2:1);ze+=`width:${Bt.toString()}|`}ze+=simplifyAndStringify(t.path),Y.searchParams.set("path",ze)}return Y.searchParams.set("key",(l=t.apiKey)!=null?l:config$1.apiKey),Y.toString()}function automatic(n={}){var t,e,r,o,s;if(!("markers"in n)&&!("path"in n))throw new Error("Automatic static maps require markers and/or path to be created.");const l=styleToStyle$1(n.style),a=n.hiDPI?"@2x":"",h=(t=n.format)!=null?t:"png";let y=~~((e=n.width)!=null?e:1024),C=~~((r=n.height)!=null?r:1024);n.hiDPI&&(y=~~(y/2),C=~~(C/2));const L=new URL(`maps/${encodeURIComponent(l)}/static/auto/${y}x${C}${a}.${h}`,defaults$1.maptilerApiURL);if("attribution"in n&&L.searchParams.set("attribution",n.attribution.toString()),"padding"in n&&L.searchParams.set("padding",n.padding.toString()),"markers"in n){let Y="";const ze="markerIcon"in n;ze&&(Y+=`icon:${n.markerIcon}|`),ze&&"markerAnchor"in n&&(Y+=`anchor:${n.markerAnchor}|`),ze&&n.hiDPI&&(Y+="scale:2|");const Bt=Array.isArray(n.markers[0])?n.markers:[n.markers];Y+=Bt.map(Ir=>staticMapMarkerToString(Ir,!ze)).join("|"),L.searchParams.set("markers",Y)}if("path"in n){let Y="";if(Y+=`fill:${(o=n.pathFillColor)!=null?o:"none"}|`,"pathStrokeColor"in n&&(Y+=`stroke:${n.pathStrokeColor}|`),"pathWidth"in n){const ze=n.pathWidth/(n.hiDPI?2:1);Y+=`width:${ze.toString()}|`}Y+=simplifyAndStringify(n.path),L.searchParams.set("path",Y)}return L.searchParams.set("key",(s=n.apiKey)!=null?s:config$1.apiKey),L.toString()}const staticMaps={centered,bounded,automatic};let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let n=0;n<256;++n)byteToHex.push((n+256).toString(16).slice(1));function unsafeStringify(n,t=0){return(byteToHex[n[t+0]]+byteToHex[n[t+1]]+byteToHex[n[t+2]]+byteToHex[n[t+3]]+"-"+byteToHex[n[t+4]]+byteToHex[n[t+5]]+"-"+byteToHex[n[t+6]]+byteToHex[n[t+7]]+"-"+byteToHex[n[t+8]]+byteToHex[n[t+9]]+"-"+byteToHex[n[t+10]]+byteToHex[n[t+11]]+byteToHex[n[t+12]]+byteToHex[n[t+13]]+byteToHex[n[t+14]]+byteToHex[n[t+15]]).toLowerCase()}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID};function v4(n,t,e){if(native.randomUUID&&!t&&!n)return native.randomUUID();n=n||{};const r=n.random||(n.rng||rng)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){e=e||0;for(let o=0;o<16;++o)t[e+o]=r[o];return t}return unsafeStringify(r)}const Language={AUTO:"auto",STYLE_LOCK:"style_lock",LATIN:"latin",NON_LATIN:"nonlatin",LOCAL:"",ALBANIAN:"sq",AMHARIC:"am",ARABIC:"ar",ARMENIAN:"hy",AZERBAIJANI:"az",BASQUE:"eu",BELORUSSIAN:"be",BOSNIAN:"bs",BRETON:"br",BULGARIAN:"bg",CATALAN:"ca",CHINESE:"zh",CORSICAN:"co",CROATIAN:"hr",CZECH:"cs",DANISH:"da",DUTCH:"nl",ENGLISH:"en",ESPERANTO:"eo",ESTONIAN:"et",FINNISH:"fi",FRENCH:"fr",FRISIAN:"fy",GEORGIAN:"ka",GERMAN:"de",GREEK:"el",HEBREW:"he",HINDI:"hi",HUNGARIAN:"hu",ICELANDIC:"is",INDONESIAN:"id",IRISH:"ga",ITALIAN:"it",JAPANESE:"ja",JAPANESE_HIRAGANA:"ja-Hira",JAPANESE_KANA:"ja_kana",JAPANESE_LATIN:"ja_rm",JAPANESE_2018:"ja-Latn",KANNADA:"kn",KAZAKH:"kk",KOREAN:"ko",KOREAN_LATIN:"ko-Latn",KURDISH:"ku",ROMAN_LATIN:"la",LATVIAN:"lv",LITHUANIAN:"lt",LUXEMBOURGISH:"lb",MACEDONIAN:"mk",MALAYALAM:"ml",MALTESE:"mt",NORWEGIAN:"no",OCCITAN:"oc",POLISH:"pl",PORTUGUESE:"pt",ROMANIAN:"ro",ROMANSH:"rm",RUSSIAN:"ru",SCOTTISH_GAELIC:"gd",SERBIAN_CYRILLIC:"sr",SERBIAN_LATIN:"sr-Latn",SLOVAK:"sk",SLOVENE:"sl",SPANISH:"es",SWEDISH:"sv",TAMIL:"ta",TELUGU:"te",THAI:"th",TURKISH:"tr",UKRAINIAN:"uk",WELSH:"cy"},languagesIsoSet=new Set(Object.values(Language));function isLanguageSupported(n){return languagesIsoSet.has(n)}const languageCodeSet=new Set(Object.values(Language));function getBrowserLanguage(){if(typeof navigator>"u")return Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];const n=Array.from(new Set(navigator.languages.map(t=>t.split("-")[0]))).filter(t=>languageCodeSet.has(t));return n.length?n[0]:Language.LATIN}const MAPTILER_SESSION_ID=v4();class SdkConfig extends EventEmitter$3{constructor(){super(),this.primaryLanguage=Language.AUTO,this.secondaryLanguage=null,this.session=!0,this._unit="metric",this._apiKey=""}set unit(t){this._unit=t,this.emit("unit",t)}get unit(){return this._unit}set apiKey(t){this._apiKey=t,config$1.apiKey=t,this.emit("apiKey",t)}get apiKey(){return this._apiKey}set fetch(t){config$1.fetch=t}get fetch(){return config$1.fetch}}const config=new SdkConfig,defaults={maptilerLogoURL:"https://api.maptiler.com/resources/logo.svg",maptilerURL:"https://www.maptiler.com/",maptilerApiHost:"api.maptiler.com",rtlPluginURL:"https://cdn.maptiler.com/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.min.js",primaryLanguage:Language.AUTO,secondaryLanguage:Language.LOCAL,terrainSourceURL:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json",terrainSourceId:"maptiler-terrain"};Object.freeze(defaults);class LogoControl extends maplibregl__default.LogoControl{onAdd(t){return super.onAdd(t)}}class MaptilerLogoControl extends LogoControl{constructor(t={}){var e,r;super(t),this.logoURL="",this.linkURL="",this.logoURL=(e=t.logoURL)!=null?e:defaults.maptilerLogoURL,this.linkURL=(r=t.linkURL)!=null?r:defaults.maptilerURL}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=window.document.createElement("div"),this._container.className="maplibregl-ctrl";const e=window.document.createElement("a");return e.style.backgroundRepeat="no-repeat",e.style.cursor="pointer",e.style.display="block",e.style.height="23px",e.style.margin="0 0 -4px -4px",e.style.overflow="hidden",e.style.width="88px",e.style.backgroundImage=`url(${this.logoURL})`,e.style.backgroundSize="100px 30px",e.style.width="100px",e.style.height="30px",e.target="_blank",e.rel="noopener",e.href=this.linkURL,e.setAttribute("aria-label","MapTiler logo"),e.setAttribute("rel","noopener"),this._container.appendChild(e),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}}var __defProp$2=Object.defineProperty,__getOwnPropSymbols$2=Object.getOwnPropertySymbols,__hasOwnProp$2=Object.prototype.hasOwnProperty,__propIsEnum$2=Object.prototype.propertyIsEnumerable,__defNormalProp$2=(n,t,e)=>t in n?__defProp$2(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,__spreadValues$2=(n,t)=>{for(var e in t||(t={}))__hasOwnProp$2.call(t,e)&&__defNormalProp$2(n,e,t[e]);if(__getOwnPropSymbols$2)for(var e of __getOwnPropSymbols$2(t))__propIsEnum$2.call(t,e)&&__defNormalProp$2(n,e,t[e]);return n};function enableRTL(){maplibregl__default.getRTLTextPluginStatus()==="unavailable"&&maplibregl__default.setRTLTextPlugin(defaults.rtlPluginURL,null,!0)}function bindAll(n,t){n.forEach(e=>{t[e]&&(t[e]=t[e].bind(t))})}function DOMcreate(n,t,e){const r=window.document.createElement(n);return t!==void 0&&(r.className=t),e&&e.appendChild(r),r}function DOMremove(n){n.parentNode&&n.parentNode.removeChild(n)}function maptilerCloudTransformRequest(n,t){let e=null;try{e=new URL(n)}catch{return{url:n}}return e.host===defaults.maptilerApiHost&&(e.searchParams.has("key")||e.searchParams.append("key",config.apiKey),config.session&&e.searchParams.append("mtsid",MAPTILER_SESSION_ID)),{url:e.href}}function combineTransformRequest(n=null){return function(t,e){if(n){const r=n(t,e),o=maptilerCloudTransformRequest(r.url);return __spreadValues$2(__spreadValues$2({},r),o)}else return maptilerCloudTransformRequest(t)}}function styleToStyle(n){return n?typeof n=="string"||n instanceof String?!n.startsWith("http")&&n.toLowerCase().includes(".json")?n:expandMapStyle(n):n instanceof MapStyleVariant?n.getExpandedStyleURL():n instanceof ReferenceMapStyle?n.getDefaultVariant().getExpandedStyleURL():n:MapStyle[mapStylePresetList[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL()}class MaptilerTerrainControl{constructor(){bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(t){return this._map=t,this._container=DOMcreate("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=DOMcreate("button","maplibregl-ctrl-terrain",this._container),DOMcreate("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){DOMremove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.hasTerrain()?this._map.disableTerrain():this._map.enableTerrain(),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.hasTerrain()?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}}class NavigationControl extends maplibregl__default.NavigationControl{onAdd(t){return super.onAdd(t)}}class MaptilerNavigationControl extends NavigationControl{constructor(){super({showCompass:!0,showZoom:!0,visualizePitch:!0}),this._compass.removeEventListener("click",this._compass.clickFunction),this._compass.addEventListener("click",t=>{this._map.getPitch()===0?this._map.easeTo({pitch:Math.min(this._map.getMaxPitch(),80)}):this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})}_createButton(t,e){const r=super._createButton(t,e);return r.clickFunction=e,r}_rotateCompassArrow(){const t=this.options.visualizePitch?`scale(${Math.min(1.5,1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5))}) rotateX(${Math.min(70,this._map.transform.pitch)}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t}}class GeolocateControl extends maplibregl__default.GeolocateControl{onAdd(t){return super.onAdd(t)}}var __defProp$1=Object.defineProperty,__defProps$1=Object.defineProperties,__getOwnPropDescs$1=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1=Object.getOwnPropertySymbols,__hasOwnProp$1=Object.prototype.hasOwnProperty,__propIsEnum$1=Object.prototype.propertyIsEnumerable,__defNormalProp$1=(n,t,e)=>t in n?__defProp$1(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,__spreadValues$1=(n,t)=>{for(var e in t||(t={}))__hasOwnProp$1.call(t,e)&&__defNormalProp$1(n,e,t[e]);if(__getOwnPropSymbols$1)for(var e of __getOwnPropSymbols$1(t))__propIsEnum$1.call(t,e)&&__defNormalProp$1(n,e,t[e]);return n},__spreadProps$1=(n,t)=>__defProps$1(n,__getOwnPropDescs$1(t));const Marker$1=maplibregl__default.Marker,LngLat$1=maplibregl__default.LngLat,LngLatBounds$1=maplibregl__default.LngLatBounds;class MaptilerGeolocateControl extends GeolocateControl{constructor(){super(...arguments),this.lastUpdatedCenter=new LngLat$1(0,0)}_updateCamera(t){const e=new LngLat$1(t.coords.longitude,t.coords.latitude),r=t.coords.accuracy,o=this._map.getBearing(),s=__spreadProps$1(__spreadValues$1({bearing:o},this.options.fitBoundsOptions),{linear:!0}),l=this._map.getZoom();l>this.options.fitBoundsOptions.maxZoom&&(s.zoom=l),this._map.fitBounds(LngLatBounds$1.fromLngLat(e,r),s,{geolocateSource:!0});let a=!1;const h=()=>{a=!0};this._map.once("click",h),this._map.once("dblclick",h),this._map.once("dragstart",h),this._map.once("mousedown",h),this._map.once("touchstart",h),this._map.once("wheel",h),this._map.once("moveend",()=>{this._map.off("click",h),this._map.off("dblclick",h),this._map.off("dragstart",h),this._map.off("mousedown",h),this._map.off("touchstart",h),this._map.off("wheel",h),!a&&(this.lastUpdatedCenter=this._map.getCenter())})}_setupUI(t){if(this.lastUpdatedCenter=this._map.getCenter(),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=DOMcreate("button","maplibregl-ctrl-geolocate",this._container),DOMcreate("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=DOMcreate("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Marker$1(this._dotElement),this._circleElement=DOMcreate("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Marker$1({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("move",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("moveend",e=>{const r=e.originalEvent&&e.originalEvent.type==="resize",o=this.lastUpdatedCenter.distanceTo(this._map.getCenter());!e.geolocateSource&&this._watchState==="ACTIVE_LOCK"&&!r&&o>1&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Event("trackuserlocationend")))})}_updateCircleRadius(){if(this._watchState!=="BACKGROUND"&&this._watchState!=="ACTIVE_LOCK")return;const t=[this._lastKnownPosition.coords.longitude,this._lastKnownPosition.coords.latitude],e=this._map.project(t),r=this._map.unproject([e.x,e.y]),o=this._map.unproject([e.x+20,e.y]),s=r.distanceTo(o)/20,l=Math.ceil(2*this._accuracy/s);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}}class AttributionControl extends maplibregl__default.AttributionControl{onAdd(t){return super.onAdd(t)}}class ScaleControl extends maplibregl__default.ScaleControl{onAdd(t){return super.onAdd(t)}}class FullscreenControl extends maplibregl__default.FullscreenControl{onAdd(t){return super.onAdd(t)}}var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(n,t,e)=>t in n?__defProp(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,__spreadValues=(n,t)=>{for(var e in t||(t={}))__hasOwnProp.call(t,e)&&__defNormalProp(n,e,t[e]);if(__getOwnPropSymbols)for(var e of __getOwnPropSymbols(t))__propIsEnum.call(t,e)&&__defNormalProp(n,e,t[e]);return n},__spreadProps=(n,t)=>__defProps(n,__getOwnPropDescs(t)),__async=(n,t,e)=>new Promise((r,o)=>{var s=h=>{try{a(e.next(h))}catch(y){o(y)}},l=h=>{try{a(e.throw(h))}catch(y){o(y)}},a=h=>h.done?r(h.value):Promise.resolve(h.value).then(s,l);a((e=e.apply(n,t)).next())});const GeolocationType={POINT:"POINT",COUNTRY:"COUNTRY"};let Map$1=class extends maplibregl__default.Map{constructor(t){var e,r,o;t.apiKey&&(config.apiKey=t.apiKey);const s=styleToStyle(t.style),l=location.hash;config.apiKey||console.warn("MapTiler Cloud API key is not set. Visit https://maptiler.com and try Cloud for free!"),super(__spreadProps(__spreadValues({},t),{style:s,maplibreLogo:!1,transformRequest:combineTransformRequest(t.transformRequest)})),this.isTerrainEnabled=!1,this.terrainExaggeration=1,this.primaryLanguage=null,this.secondaryLanguage=null,this.terrainGrowing=!1,this.terrainFlattening=!1,this.primaryLanguage=(e=t.language)!=null?e:config.primaryLanguage,this.secondaryLanguage=config.secondaryLanguage,this.terrainExaggeration=(r=t.terrainExaggeration)!=null?r:this.terrainExaggeration,this.once("styledata",()=>__async(this,null,function*(){if(!t.geolocate||t.center||t.hash&&l)return;try{if(t.geolocate===GeolocationType.COUNTRY){yield this.fitToIpBounds();return}}catch(ze){console.warn(ze.message)}let L=null;try{yield this.centerOnIpPoint(t.zoom),L=this.getCameraHash()}catch(ze){console.warn(ze.message)}(yield navigator.permissions.query({name:"geolocation"})).state==="granted"&&navigator.geolocation.getCurrentPosition(ze=>{L===this.getCameraHash()&&(this.terrain?this.easeTo({center:[ze.coords.longitude,ze.coords.latitude],zoom:t.zoom||12,duration:2e3}):this.once("terrain",()=>{this.easeTo({center:[ze.coords.longitude,ze.coords.latitude],zoom:t.zoom||12,duration:2e3})}))},null,{maximumAge:24*3600*1e3,timeout:5e3,enableHighAccuracy:!1})})),this.on("styledata",()=>{this.setPrimaryLanguage(this.primaryLanguage),this.setSecondaryLanguage(this.secondaryLanguage)}),this.on("styledata",()=>{this.getTerrain()===null&&this.isTerrainEnabled&&this.enableTerrain(this.terrainExaggeration)}),this.once("load",()=>__async(this,null,function*(){enableRTL()})),this.once("load",()=>__async(this,null,function*(){let L={logo:null};try{const Y=Object.keys(this.style.sourceCaches).map(Ir=>this.getSource(Ir)).filter(Ir=>typeof Ir.url=="string"&&Ir.url.includes("tiles.json")),ze=new URL(Y[0].url);ze.searchParams.has("key")||ze.searchParams.append("key",config.apiKey),L=yield(yield fetch(ze.href)).json()}catch{}if("logo"in L&&L.logo){const Y=L.logo;this.addControl(new MaptilerLogoControl({logoURL:Y}),t.logoPosition),t.attributionControl===!1&&this.addControl(new AttributionControl({customAttribution:t.customAttribution}))}else t.maptilerLogo&&this.addControl(new MaptilerLogoControl,t.logoPosition);if(t.scaleControl){const Y=t.scaleControl===!0||t.scaleControl===void 0?"bottom-right":t.scaleControl,ze=new ScaleControl({unit:config.unit});this.addControl(ze,Y),config.on("unit",Bt=>{ze.setUnit(Bt)})}if(t.navigationControl!==!1){const Y=t.navigationControl===!0||t.navigationControl===void 0?"top-right":t.navigationControl;this.addControl(new MaptilerNavigationControl,Y)}if(t.geolocateControl!==!1){const Y=t.geolocateControl===!0||t.geolocateControl===void 0?"top-right":t.geolocateControl;this.addControl(new MaptilerGeolocateControl({positionOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!0,showAccuracyCircle:!0,showUserLocation:!0}),Y)}if(t.terrainControl){const Y=t.terrainControl===!0||t.terrainControl===void 0?"top-right":t.terrainControl;this.addControl(new MaptilerTerrainControl,Y)}if(t.fullscreenControl){const Y=t.fullscreenControl===!0||t.fullscreenControl===void 0?"top-right":t.fullscreenControl;this.addControl(new FullscreenControl({}),Y)}}));let a=!1,h=!1,y=null;this.once("load",L=>{a=!0,h&&this.fire("loadWithTerrain",y)});const C=L=>{L.terrain&&(h=!0,y={type:"loadWithTerrain",target:this,terrain:L.terrain},this.off("terrain",C),a&&this.fire("loadWithTerrain",y))};this.on("terrain",C),t.terrain&&this.enableTerrain((o=t.terrainExaggeration)!=null?o:this.terrainExaggeration)}onLoadAsync(){return __async(this,null,function*(){return new Promise((t,e)=>{if(this.loaded())return t(this);this.once("load",r=>{t(this)})})})}onLoadWithTerrainAsync(){return __async(this,null,function*(){return new Promise((t,e)=>{if(this.loaded()&&this.terrain)return t(this);this.once("loadWithTerrain",r=>{t(this)})})})}setStyle(t,e){return super.setStyle(styleToStyle(t),e)}setLanguage(t=defaults.primaryLanguage){if(t===Language.AUTO)return this.setLanguage(getBrowserLanguage());this.setPrimaryLanguage(t)}setPrimaryLanguage(t=defaults.primaryLanguage){if(this.primaryLanguage===Language.STYLE_LOCK){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}isLanguageSupported(t)&&(this.primaryLanguage=t,this.onStyleReady(()=>{if(t===Language.AUTO)return this.setPrimaryLanguage(getBrowserLanguage());const e=this.getStyle().layers,r=/^\s*{\s*name\s*(:\s*(\S*))?\s*}$/,o=/^\s*name\s*(:\s*(\S*))?\s*$/,s=/^\s*{\s*name\s*(:\s*(\S*))?\s*}(\s*){\s*name\s*(:\s*(\S*))?\s*}$/,l=/^(.*)({\s*name\s*(:\s*(\S*))?\s*})(.*)$/,a=t?`name:${t}`:"name",h=["case",["has",a],["get",a],["get","name"]];for(let y=0;y<e.length;y+=1){const C=e[y],L=C.layout;if(!L||!L["text-field"])continue;const Y=this.getLayoutProperty(C.id,"text-field");let ze;if(Array.isArray(Y)&&Y.length>=2&&Y[0].trim().toLowerCase()==="concat"){const Bt=Y.slice();for(let Ir=0;Ir<Y.length;Ir+=1){const Wr=Y[Ir];if((typeof Wr=="string"||Wr instanceof String)&&r.exec(Wr.toString())){Bt[Ir]=h;break}else if(Array.isArray(Wr)&&Wr.length>=2&&Wr[0].trim().toLowerCase()==="get"&&o.exec(Wr[1].toString())){Bt[Ir]=h;break}else if(Array.isArray(Wr)&&Wr.length===4&&Wr[0].trim().toLowerCase()==="case"){Bt[Ir]=h;break}}this.setLayoutProperty(C.id,"text-field",Bt)}else if(Array.isArray(Y)&&Y.length>=2&&Y[0].trim().toLowerCase()==="get"&&o.exec(Y[1].toString())){const Bt=h;this.setLayoutProperty(C.id,"text-field",Bt)}else if((typeof Y=="string"||Y instanceof String)&&r.exec(Y.toString())){const Bt=h;this.setLayoutProperty(C.id,"text-field",Bt)}else if(Array.isArray(Y)&&Y.length===4&&Y[0].trim().toLowerCase()==="case"){const Bt=h;this.setLayoutProperty(C.id,"text-field",Bt)}else if((typeof Y=="string"||Y instanceof String)&&(ze=s.exec(Y.toString()))!==null){const Bt=`{${a}}${ze[3]}{name${ze[4]||""}}`;this.setLayoutProperty(C.id,"text-field",Bt)}else if((typeof Y=="string"||Y instanceof String)&&(ze=l.exec(Y.toString()))!==null){const Bt=`${ze[1]}{${a}}${ze[5]}`;this.setLayoutProperty(C.id,"text-field",Bt)}}}))}setSecondaryLanguage(t=defaults.secondaryLanguage){if(this.primaryLanguage===Language.STYLE_LOCK){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}isLanguageSupported(t)&&(this.secondaryLanguage=t,this.onStyleReady(()=>{if(t===Language.AUTO)return this.setSecondaryLanguage(getBrowserLanguage());const e=this.getStyle().layers,r=/^\s*{\s*name\s*(:\s*(\S*))?\s*}$/,o=/^\s*name\s*(:\s*(\S*))?\s*$/,s=/^\s*{\s*name\s*(:\s*(\S*))?\s*}(\s*){\s*name\s*(:\s*(\S*))?\s*}$/;let l;for(let a=0;a<e.length;a+=1){const h=e[a],y=h.layout;if(!y||!y["text-field"])continue;const C=this.getLayoutProperty(h.id,"text-field");let L;if(Array.isArray(C)&&C.length>=2&&C[0].trim().toLowerCase()==="concat"){L=C.slice();let Y=0;for(let ze=0;ze<C.length;ze+=1){const Bt=C[ze];if((typeof Bt=="string"||Bt instanceof String)&&r.exec(Bt.toString())){if(Y===1){L[ze]=`{name:${t}}`;break}Y+=1}else if(Array.isArray(Bt)&&Bt.length>=2&&Bt[0].trim().toLowerCase()==="get"&&o.exec(Bt[1].toString())){if(Y===1){L[ze][1]=`name:${t}`;break}Y+=1}else if(Array.isArray(Bt)&&Bt.length===4&&Bt[0].trim().toLowerCase()==="case"){if(Y===1){L[ze]=["get",`name:${t}`];break}Y+=1}}this.setLayoutProperty(h.id,"text-field",L)}else if((typeof C=="string"||C instanceof String)&&(l=s.exec(C.toString()))!==null){const Y=t?`name:${t}`:"name";L=`{name${l[1]||""}}${l[3]}{${Y}}`,this.setLayoutProperty(h.id,"text-field",L)}}}))}getPrimaryLanguage(){return this.primaryLanguage}getSecondaryLanguage(){return this.secondaryLanguage}getTerrainExaggeration(){return this.terrainExaggeration}hasTerrain(){return this.isTerrainEnabled}growTerrain(t,e=1e3){if(!this.terrain)return;const r=performance.now(),o=this.terrain.exaggeration,s=t-o,l=()=>{if(!this.terrain||this.terrainFlattening)return;const a=(performance.now()-r)/e;if(a<.99){const h=1-Math.pow(1-a,4),y=o+h*s;this.terrain.exaggeration=y,requestAnimationFrame(l)}else this.terrainGrowing=!1,this.terrainFlattening=!1,this.terrain.exaggeration=t;this.triggerRepaint()};this.terrainGrowing=!0,this.terrainFlattening=!1,requestAnimationFrame(l)}enableTerrain(t=this.terrainExaggeration){if(t<0){console.warn("Terrain exaggeration cannot be negative.");return}const e=o=>__async(this,null,function*(){!this.terrain||o.type!=="data"||o.dataType!=="source"||!("source"in o)||o.sourceId!=="maptiler-terrain"||o.source.type!=="raster-dem"||o.isSourceLoaded&&(this.off("data",e),this.growTerrain(t))}),r=()=>{this.isTerrainEnabled=!0,this.terrainExaggeration=t,this.on("data",e),this.addSource(defaults.terrainSourceId,{type:"raster-dem",url:defaults.terrainSourceURL}),this.setTerrain({source:defaults.terrainSourceId,exaggeration:0})};if(this.getTerrain()){this.isTerrainEnabled=!0,this.growTerrain(t);return}this.loaded()||this.isTerrainEnabled?r():this.once("load",()=>{this.getTerrain()&&this.getSource(defaults.terrainSourceId)||r()})}disableTerrain(){if(!this.terrain)return;this.isTerrainEnabled=!1;const t=1*1e3,e=performance.now(),r=this.terrain.exaggeration,o=()=>{if(!this.terrain||this.terrainGrowing)return;const s=(performance.now()-e)/t;if(s<.99){const l=Math.pow(1-s,4),a=r*l;this.terrain.exaggeration=a,requestAnimationFrame(o)}else this.terrain.exaggeration=0,this.terrainGrowing=!1,this.terrainFlattening=!1,this.setTerrain(null),this.getSource(defaults.terrainSourceId)&&this.removeSource(defaults.terrainSourceId);this.triggerRepaint()};this.terrainGrowing=!1,this.terrainFlattening=!0,requestAnimationFrame(o)}setTerrainExaggeration(t,e=!0){!e&&this.terrain?(this.terrainExaggeration=t,this.terrain.exaggeration=t,this.triggerRepaint()):this.enableTerrain(t)}onStyleReady(t){this.isStyleLoaded()?t():this.once("styledata",()=>{t()})}fitToIpBounds(){return __async(this,null,function*(){const t=yield geolocation.info();this.fitBounds(t.country_bounds,{duration:0,padding:100})})}centerOnIpPoint(t){return __async(this,null,function*(){const e=yield geolocation.info();this.jumpTo({center:[e.longitude,e.latitude],zoom:t||11})})}getCameraHash(){const t=new Float32Array(5),e=this.getCenter();return t[0]=e.lng,t[1]=e.lat,t[2]=this.getZoom(),t[3]=this.getPitch(),t[4]=this.getBearing(),gBase64.fromUint8Array(new Uint8Array(t.buffer))}getSdkConfig(){return config}getMaptilerSessionId(){return MAPTILER_SESSION_ID}setTransformRequest(t){return super.setTransformRequest(combineTransformRequest(t)),this}};class Marker extends maplibregl__default.Marker{addTo(t){return super.addTo(t)}}class Popup extends maplibregl__default.Popup{addTo(t){return super.addTo(t)}}class Style extends maplibregl__default.Style{constructor(t,e={}){super(t,e)}}class CanvasSource extends maplibregl__default.CanvasSource{onAdd(t){super.onAdd(t)}}class GeoJSONSource extends maplibregl__default.GeoJSONSource{onAdd(t){super.onAdd(t)}}class ImageSource extends maplibregl__default.ImageSource{onAdd(t){super.onAdd(t)}}class RasterTileSource extends maplibregl__default.RasterTileSource{onAdd(t){super.onAdd(t)}}class RasterDEMTileSource extends maplibregl__default.RasterDEMTileSource{onAdd(t){super.onAdd(t)}}class VectorTileSource extends maplibregl__default.VectorTileSource{onAdd(t){super.onAdd(t)}}class VideoSource extends maplibregl__default.VideoSource{onAdd(t){super.onAdd(t)}}class TerrainControl extends maplibregl__default.TerrainControl{onAdd(t){return super.onAdd(t)}}let Point$2=class qC{constructor(t,e){this.x=t,this.y=e}_matMult(t){const e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this}_add(t){return this.x+=t.x,this.y+=t.y,this}_sub(t){return this.x-=t.x,this.y-=t.y,this}_mult(t){return this.x*=t,this.y*=t,this}_div(t){return this.x/=t,this.y/=t,this}_multByPoint(t){return this.x*=t.x,this.y*=t.y,this}_divByPoint(t){return this.x/=t.x,this.y/=t.y,this}_unit(){return this._div(this.mag()),this}_perp(){const t=this.y;return this.y=this.x,this.x=-t,this}_rotate(t){const e=Math.cos(t),r=Math.sin(t),o=e*this.x-r*this.y,s=r*this.x+e*this.y;return this.x=o,this.y=s,this}_rotateAround(t,e){const r=Math.cos(t),o=Math.sin(t),s=e.x+r*(this.x-e.x)-o*(this.y-e.y),l=e.y+o*(this.x-e.x)+r*(this.y-e.y);return this.x=s,this.y=l,this}_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}clone(){return new qC(this.x,this.y)}add(t){return this.clone()._add(t)}sub(t){return this.clone()._sub(t)}multByPoint(t){return this.clone()._multByPoint(t)}divByPoint(t){return this.clone()._divByPoint(t)}mult(t){return this.clone()._mult(t)}div(t){return this.clone()._div(t)}rotate(t){return this.clone()._rotate(t)}rotateAround(t,e){return this.clone()._rotateAround(t,e)}matMult(t){return this.clone()._matMult(t)}unit(){return this.clone()._unit()}perp(){return this.clone()._perp()}round(){return this.clone()._round()}mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}equals(t){return this.x===t.x&&this.y===t.y}dist(t){return Math.sqrt(this.distSqr(t))}distSqr(t){const e=t.x-this.x,r=t.y-this.y;return e*e+r*r}angle(){return Math.atan2(this.y,this.x)}angleTo(t){return Math.atan2(this.y-t.y,this.x-t.x)}angleWith(t){return this.angleWithSep(t.x,t.y)}angleWithSep(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)}static convert(t){return t instanceof qC?t:Array.isArray(t)?new qC(t[0],t[1]):t}};const{setRTLTextPlugin,getRTLTextPluginStatus,LngLat,LngLatBounds,MercatorCoordinate,Evented,AJAXError,prewarm,clearPrewarmedResources,version:version$1,workerCount,maxParallelImageRequests,workerUrl,addProtocol,removeProtocol}=maplibregl__default,MapMLGL=maplibregl__default.Map,MarkerMLGL=maplibregl__default.Marker,PopupMLGL=maplibregl__default.Popup,StyleMLGL=maplibregl__default.Style,CanvasSourceMLGL=maplibregl__default.CanvasSource,GeoJSONSourceMLGL=maplibregl__default.GeoJSONSource,ImageSourceMLGL=maplibregl__default.ImageSource,RasterTileSourceMLGL=maplibregl__default.RasterTileSource,RasterDEMTileSourceMLGL=maplibregl__default.RasterDEMTileSource,VectorTileSourceMLGL=maplibregl__default.VectorTileSource,VideoSourceMLGL=maplibregl__default.VideoSource;maplibregl__default.NavigationControl;maplibregl__default.GeolocateControl;maplibregl__default.AttributionControl;maplibregl__default.LogoControl;maplibregl__default.ScaleControl;maplibregl__default.FullscreenControl;maplibregl__default.TerrainControl;const Cl=_mergeNamespaces({__proto__:null,AJAXError,AttributionControl,CanvasSource,CanvasSourceMLGL,Evented,FullscreenControl,GeoJSONSource,GeoJSONSourceMLGL,GeolocateControl,GeolocationType,ImageSource,ImageSourceMLGL,Language,LanguageGeocoding,LngLat,LngLatBounds,LogoControl,Map:Map$1,MapMLGL,MapStyle,MapStyleVariant,MaptilerGeolocateControl,MaptilerLogoControl,MaptilerNavigationControl,MaptilerTerrainControl,Marker,MarkerMLGL,MercatorCoordinate,NavigationControl,Point:Point$2,Popup,PopupMLGL,RasterDEMTileSource,RasterDEMTileSourceMLGL,RasterTileSource,RasterTileSourceMLGL,ReferenceMapStyle,ScaleControl,SdkConfig,ServiceError,Style,StyleMLGL,TerrainControl,VectorTileSource,VectorTileSourceMLGL,VideoSource,VideoSourceMLGL,addProtocol,clearPrewarmedResources,config,coordinates,data,geocoding,geolocation,getRTLTextPluginStatus,maxParallelImageRequests,prewarm,removeProtocol,setRTLTextPlugin,staticMaps,version:version$1,workerCount,workerUrl},[maplibreGlExports]);var El=Object.defineProperty,Il=(n,t,e)=>t in n?El(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,ys=(n,t,e)=>(Il(n,typeof t!="symbol"?t+"":t,e),e),aa=(n,t,e)=>{if(!t.has(n))throw TypeError("Cannot "+e)},zn=(n,t,e)=>(aa(n,t,"read from private field"),e?e.call(n):t.get(n)),ms=(n,t,e)=>{if(t.has(n))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(n):t.set(n,e)},Lo=(n,t,e,r)=>(aa(n,t,"write to private field"),r?r.call(n,e):t.set(n,e),e);function It(){}function Nl(n,t){for(const e in t)n[e]=t[e];return n}function eu(n){return n()}function ua(){return Object.create(null)}function Er(n){n.forEach(eu)}function nu(n){return typeof n=="function"}function zr(n,t){return n!=n?t==t:n!==t||n&&typeof n=="object"||typeof n=="function"}let bo;function Me(n,t){return n===t?!0:(bo||(bo=document.createElement("a")),bo.href=t,n===bo.href)}function xl(n){return Object.keys(n).length===0}function Sl(n,t,e,r){if(n){const o=ru(n,t,e,r);return n[0](o)}}function ru(n,t,e,r){return n[1]&&r?Nl(e.ctx.slice(),n[1](r(t))):e.ctx}function wl(n,t,e,r){if(n[2]&&r){const o=n[2](r(e));if(t.dirty===void 0)return o;if(typeof o=="object"){const s=[],l=Math.max(t.dirty.length,o.length);for(let a=0;a<l;a+=1)s[a]=t.dirty[a]|o[a];return s}return t.dirty|o}return t.dirty}function Ll(n,t,e,r,o,s){if(o){const l=ru(t,e,r,s);n.p(l,o)}}function bl(n){if(n.ctx.length>32){const t=[],e=n.ctx.length/32;for(let r=0;r<e;r++)t[r]=-1;return t}return-1}function la(n){return n??""}function nt(n,t){n.appendChild(t)}function Dt(n,t,e){n.insertBefore(t,e||null)}function Tt(n){n.parentNode&&n.parentNode.removeChild(n)}function ht(n){return document.createElement(n)}function Kn(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function Pr(n){return document.createTextNode(n)}function nn(){return Pr(" ")}function Pl(){return Pr("")}function Ce(n,t,e,r){return n.addEventListener(t,e,r),()=>n.removeEventListener(t,e,r)}function Rl(n){return function(t){return t.preventDefault(),n.call(this,t)}}function P(n,t,e){e==null?n.removeAttribute(t):n.getAttribute(t)!==e&&n.setAttribute(t,e)}function Ol(n){return Array.from(n.childNodes)}function to(n,t){t=""+t,n.data!==t&&(n.data=t)}function ca(n,t){n.value=t??""}function on(n,t,e){n.classList.toggle(t,!!e)}function Tl(n,t,{bubbles:e=!1,cancelable:r=!1}={}){return new CustomEvent(n,{detail:t,bubbles:e,cancelable:r})}let eo;function Ji(n){eo=n}function iu(){if(!eo)throw new Error("Function called outside component initialization");return eo}function Dl(n){iu().$$.on_destroy.push(n)}function Ml(){const n=iu();return(t,e,{cancelable:r=!1}={})=>{const o=n.$$.callbacks[t];if(o){const s=Tl(t,e,{cancelable:r});return o.slice().forEach(l=>{l.call(n,s)}),!s.defaultPrevented}return!0}}function fa(n,t){const e=n.$$.callbacks[t.type];e&&e.slice().forEach(r=>r.call(this,t))}const _i=[],xs=[];let Ii=[];const ha=[],Al=Promise.resolve();let Ss=!1;function Fl(){Ss||(Ss=!0,Al.then(ou))}function ws(n){Ii.push(n)}const _s=new Set;let mi=0;function ou(){if(mi!==0)return;const n=eo;do{try{for(;mi<_i.length;){const t=_i[mi];mi++,Ji(t),Bl(t.$$)}}catch(t){throw _i.length=0,mi=0,t}for(Ji(null),_i.length=0,mi=0;xs.length;)xs.pop()();for(let t=0;t<Ii.length;t+=1){const e=Ii[t];_s.has(e)||(_s.add(e),e())}Ii.length=0}while(_i.length);for(;ha.length;)ha.pop()();Ss=!1,_s.clear(),Ji(n)}function Bl(n){if(n.fragment!==null){n.update(),Er(n.before_update);const t=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,t),n.after_update.forEach(ws)}}function kl(n){const t=[],e=[];Ii.forEach(r=>n.indexOf(r)===-1?t.push(r):e.push(r)),e.forEach(r=>r()),Ii=t}const Mo=new Set;let jr;function Ao(){jr={r:0,c:[],p:jr}}function Fo(){jr.r||Er(jr.c),jr=jr.p}function Gt(n,t){n&&n.i&&(Mo.delete(n),n.i(t))}function le(n,t,e,r){if(n&&n.o){if(Mo.has(n))return;Mo.add(n),jr.c.push(()=>{Mo.delete(n),r&&(e&&n.d(1),r())}),n.o(t)}else r&&r()}function ga(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}function Gl(n,t){le(n,1,1,()=>{t.delete(n.key)})}function Vl(n,t,e,r,o,s,l,a,h,y,C,L){let Y=n.length,ze=s.length,Bt=Y;const Ir={};for(;Bt--;)Ir[n[Bt].key]=Bt;const Wr=[],yi=new Map,Bn=new Map,vi=[];for(Bt=ze;Bt--;){const ml=L(o,s,Bt),il=e(ml);let sl=l.get(il);sl?r&&vi.push(()=>sl.p(ml,t)):(sl=y(il,ml),sl.c()),yi.set(il,Wr[Bt]=sl),il in Ir&&Bn.set(il,Math.abs(Bt-Ir[il]))}const wo=new Set,ia=new Set;function gl(ml){Gt(ml,1),ml.m(a,C),l.set(ml.key,ml),C=ml.first,ze--}for(;Y&&ze;){const ml=Wr[ze-1],il=n[Y-1],sl=ml.key,ol=il.key;ml===il?(C=ml.first,Y--,ze--):yi.has(ol)?!l.has(sl)||wo.has(sl)?gl(ml):ia.has(ol)?Y--:Bn.get(sl)>Bn.get(ol)?(ia.add(sl),gl(ml)):(wo.add(ol),Y--):(h(il,l),Y--)}for(;Y--;){const ml=n[Y];yi.has(ml.key)||h(ml,l)}for(;ze;)gl(Wr[ze-1]);return Er(vi),Wr}function Rr(n){n&&n.c()}function lr(n,t,e){const{fragment:r,after_update:o}=n.$$;r&&r.m(t,e),ws(()=>{const s=n.$$.on_mount.map(eu).filter(nu);n.$$.on_destroy?n.$$.on_destroy.push(...s):Er(s),n.$$.on_mount=[]}),o.forEach(ws)}function cr(n,t){const e=n.$$;e.fragment!==null&&(kl(e.after_update),Er(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[])}function zl(n,t){n.$$.dirty[0]===-1&&(_i.push(n),Fl(),n.$$.dirty.fill(0)),n.$$.dirty[t/31|0]|=1<<t%31}function Ur(n,t,e,r,o,s,l,a=[-1]){const h=eo;Ji(n);const y=n.$$={fragment:null,ctx:[],props:s,update:It,not_equal:o,bound:ua(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(h?h.$$.context:[])),callbacks:ua(),dirty:a,skip_bound:!1,root:t.target||h.$$.root};l&&l(y.root);let C=!1;if(y.ctx=e?e(n,t.props||{},(L,Y,...ze)=>{const Bt=ze.length?ze[0]:Y;return y.ctx&&o(y.ctx[L],y.ctx[L]=Bt)&&(!y.skip_bound&&y.bound[L]&&y.bound[L](Bt),C&&zl(n,L)),Y}):[],y.update(),C=!0,Er(y.before_update),y.fragment=r?r(y.ctx):!1,t.target){if(t.hydrate){const L=Ol(t.target);y.fragment&&y.fragment.l(L),L.forEach(Tt)}else y.fragment&&y.fragment.c();t.intro&&Gt(n.$$.fragment),lr(n,t.target,t.anchor),ou()}Ji(h)}class qr{constructor(){ys(this,"$$"),ys(this,"$$set")}$destroy(){cr(this,1),this.$destroy=It}$on(t,e){if(!nu(e))return It;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(e),()=>{const o=r.indexOf(e);o!==-1&&r.splice(o,1)}}$set(t){this.$$set&&!xl(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Ul="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ul);function ql(n){let t,e;return{c(){t=Kn("svg"),e=Kn("path"),P(e,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),P(t,"viewBox","0 0 14 14"),P(t,"width","13"),P(t,"height","13"),P(t,"class","svelte-en2qvf")},m(r,o){Dt(r,t,o),nt(t,e)},p:It,i:It,o:It,d(r){r&&Tt(t)}}}class su extends qr{constructor(t){super(),Ur(this,t,null,ql,zr,{})}}function Xl(n){let t,e;return{c(){t=Kn("svg"),e=Kn("path"),P(e,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),P(t,"viewBox","0 0 30 30"),P(t,"fill","none"),P(t,"xmlns","http://www.w3.org/2000/svg"),P(t,"class","svelte-d2loi5")},m(r,o){Dt(r,t,o),nt(t,e)},p:It,i:It,o:It,d(r){r&&Tt(t)}}}class au extends qr{constructor(t){super(),Ur(this,t,null,Xl,zr,{})}}function Yl(n){let t,e;return{c(){t=ht("img"),Me(t.src,e=n[3]+"area.svg")||P(t,"src",e),P(t,"alt",n[6]),P(t,"class","svelte-ltkwvy")},m(r,o){Dt(r,t,o)},p(r,o){o&8&&!Me(t.src,e=r[3]+"area.svg")&&P(t,"src",e),o&64&&P(t,"alt",r[6])},d(r){r&&Tt(t)}}}function Wl(n){let t,e;return{c(){t=ht("img"),Me(t.src,e=n[3]+"poi.svg")||P(t,"src",e),P(t,"alt",n[6]),P(t,"class","svelte-ltkwvy")},m(r,o){Dt(r,t,o)},p(r,o){o&8&&!Me(t.src,e=r[3]+"poi.svg")&&P(t,"src",e),o&64&&P(t,"alt",r[6])},d(r){r&&Tt(t)}}}function Hl(n){let t,e;return{c(){t=ht("img"),Me(t.src,e=n[3]+"postal_code.svg")||P(t,"src",e),P(t,"alt",n[6]),P(t,"class","svelte-ltkwvy")},m(r,o){Dt(r,t,o)},p(r,o){o&8&&!Me(t.src,e=r[3]+"postal_code.svg")&&P(t,"src",e),o&64&&P(t,"alt",r[6])},d(r){r&&Tt(t)}}}function jl(n){let t,e;return{c(){t=ht("img"),Me(t.src,e=n[3]+"street.svg")||P(t,"src",e),P(t,"alt",n[6]),P(t,"class","svelte-ltkwvy")},m(r,o){Dt(r,t,o)},p(r,o){o&8&&!Me(t.src,e=r[3]+"street.svg")&&P(t,"src",e),o&64&&P(t,"alt",r[6])},d(r){r&&Tt(t)}}}function Kl(n){let t,e;return{c(){t=ht("img"),Me(t.src,e=n[3]+"road.svg")||P(t,"src",e),P(t,"alt",n[6]),P(t,"class","svelte-ltkwvy")},m(r,o){Dt(r,t,o)},p(r,o){o&8&&!Me(t.src,e=r[3]+"road.svg")&&P(t,"src",e),o&64&&P(t,"alt",r[6])},d(r){r&&Tt(t)}}}function Ql(n){let t,e;return{c(){t=ht("img"),Me(t.src,e=n[3]+"housenumber.svg")||P(t,"src",e),P(t,"alt",n[6]),P(t,"class","svelte-ltkwvy")},m(r,o){Dt(r,t,o)},p(r,o){o&8&&!Me(t.src,e=r[3]+"housenumber.svg")&&P(t,"src",e),o&64&&P(t,"alt",r[6])},d(r){r&&Tt(t)}}}function Zl(n){let t,e,r,o;return{c(){t=ht("img"),Me(t.src,e=n[5])||P(t,"src",e),P(t,"alt",n[4]),P(t,"class","svelte-ltkwvy")},m(s,l){Dt(s,t,l),r||(o=Ce(t,"error",n[12]),r=!0)},p(s,l){l&32&&!Me(t.src,e=s[5])&&P(t,"src",e),l&16&&P(t,"alt",s[4])},d(s){s&&Tt(t),r=!1,o()}}}function pa(n){let t,e;return{c(){t=ht("span"),e=Pr(n[6]),P(t,"class","secondary svelte-ltkwvy")},m(r,o){Dt(r,t,o),nt(t,e)},p(r,o){o&64&&to(e,r[6])},d(r){r&&Tt(t)}}}function Jl(n){var t,e;let r,o,s,l,a,h,y,C,L=n[0].place_name.replace(/,.*/,"")+"",Y,ze,Bt=n[2]==="always"||n[2]&&!n[0].address&&((t=n[0].properties)==null?void 0:t.kind)!=="road"&&((e=n[0].properties)==null?void 0:e.kind)!=="road_relation"&&!n[0].id.startsWith("address.")&&!n[0].id.startsWith("postal_code.")&&(!n[0].id.startsWith("poi.")||!n[5]),Ir,Wr,yi=n[0].place_name.replace(/[^,]*,?\s*/,"")+"",Bn,vi,wo;function ia(sl,ol){var _l,rh;return ol&1&&(o=null),ol&1&&(s=null),ol&1&&(l=null),sl[5]?Zl:sl[0].address?Ql:((_l=sl[0].properties)==null?void 0:_l.kind)==="road"||((rh=sl[0].properties)==null?void 0:rh.kind)==="road_relation"?Kl:(o==null&&(o=!!sl[0].id.startsWith("address.")),o?jl:(s==null&&(s=!!sl[0].id.startsWith("postal_code.")),s?Hl:(l==null&&(l=!!sl[0].id.startsWith("poi.")),l?Wl:Yl)))}let gl=ia(n,-1),ml=gl(n),il=Bt&&pa(n);return{c(){r=ht("li"),ml.c(),a=nn(),h=ht("span"),y=ht("span"),C=ht("span"),Y=Pr(L),ze=nn(),il&&il.c(),Ir=nn(),Wr=ht("span"),Bn=Pr(yi),P(C,"class","primary svelte-ltkwvy"),P(y,"class","svelte-ltkwvy"),P(Wr,"class","line2 svelte-ltkwvy"),P(h,"class","texts svelte-ltkwvy"),P(r,"tabindex","0"),P(r,"data-selected",n[1]),P(r,"class","svelte-ltkwvy"),on(r,"selected",n[1])},m(sl,ol){Dt(sl,r,ol),ml.m(r,null),nt(r,a),nt(r,h),nt(h,y),nt(y,C),nt(C,Y),nt(y,ze),il&&il.m(y,null),nt(h,Ir),nt(h,Wr),nt(Wr,Bn),vi||(wo=[Ce(r,"mouseenter",n[10]),Ce(r,"focus",n[11])],vi=!0)},p(sl,[ol]){var _l,rh;gl===(gl=ia(sl,ol))&&ml?ml.p(sl,ol):(ml.d(1),ml=gl(sl),ml&&(ml.c(),ml.m(r,a))),ol&1&&L!==(L=sl[0].place_name.replace(/,.*/,"")+"")&&to(Y,L),ol&37&&(Bt=sl[2]==="always"||sl[2]&&!sl[0].address&&((_l=sl[0].properties)==null?void 0:_l.kind)!=="road"&&((rh=sl[0].properties)==null?void 0:rh.kind)!=="road_relation"&&!sl[0].id.startsWith("address.")&&!sl[0].id.startsWith("postal_code.")&&(!sl[0].id.startsWith("poi.")||!sl[5])),Bt?il?il.p(sl,ol):(il=pa(sl),il.c(),il.m(y,null)):il&&(il.d(1),il=null),ol&1&&yi!==(yi=sl[0].place_name.replace(/[^,]*,?\s*/,"")+"")&&to(Bn,yi),ol&2&&P(r,"data-selected",sl[1]),ol&2&&on(r,"selected",sl[1])},i:It,o:It,d(sl){sl&&Tt(r),ml.d(),il&&il.d(),vi=!1,Er(wo)}}}function $l(n,t,e){var r;let o,s,{feature:l}=t,{selected:a=!1}=t,{showPlaceType:h}=t,{missingIconsCache:y}=t,{iconsBaseUrl:C}=t;const L=(r=l.properties)==null?void 0:r.categories;let Y,ze;function Bt(Bn){ze&&y.add(ze),e(9,o--,o)}function Ir(Bn){fa.call(this,n,Bn)}function Wr(Bn){fa.call(this,n,Bn)}const yi=Bn=>Bt(Bn.currentTarget);return n.$$set=Bn=>{"feature"in Bn&&e(0,l=Bn.feature),"selected"in Bn&&e(1,a=Bn.selected),"showPlaceType"in Bn&&e(2,h=Bn.showPlaceType),"missingIconsCache"in Bn&&e(8,y=Bn.missingIconsCache),"iconsBaseUrl"in Bn&&e(3,C=Bn.iconsBaseUrl)},n.$$.update=()=>{var Bn,vi,wo,ia;if(n.$$.dirty&824)do e(9,o--,o),e(4,Y=L==null?void 0:L[o]),e(5,ze=Y?C+Y.replace(/ /g,"_")+".svg":void 0);while(o>-1&&(!ze||y.has(ze)));n.$$.dirty&1&&e(6,s=l.id.startsWith("poi.")?(vi=(Bn=l.properties)==null?void 0:Bn.categories)==null?void 0:vi.join(", "):((ia=(wo=l.properties)==null?void 0:wo.place_type_name)==null?void 0:ia[0])??l.place_type[0])},e(9,o=(L==null?void 0:L.length)??0),[l,a,h,C,Y,ze,s,Bt,y,o,Ir,Wr,yi]}class tc extends qr{constructor(t){super(),Ur(this,t,$l,Jl,zr,{feature:0,selected:1,showPlaceType:2,missingIconsCache:8,iconsBaseUrl:3})}}function ec(n){let t;return{c(){t=ht("div"),t.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',P(t,"class","svelte-7cmwmc")},m(e,r){Dt(e,t,r)},p:It,i:It,o:It,d(e){e&&Tt(t)}}}class nc extends qr{constructor(t){super(),Ur(this,t,null,ec,zr,{})}}function rc(n){let t,e;return{c(){t=Kn("svg"),e=Kn("path"),P(e,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),P(t,"viewBox","0 0 60.006 21.412"),P(t,"width","14"),P(t,"height","20"),P(t,"class","svelte-en2qvf")},m(r,o){Dt(r,t,o),nt(t,e)},p:It,i:It,o:It,d(r){r&&Tt(t)}}}class ic extends qr{constructor(t){super(),Ur(this,t,null,rc,zr,{})}}function oc(n){let t,e;return{c(){t=Kn("svg"),e=Kn("path"),P(e,"d","M13.101 14.261 8.74 9.899a4.797 4.797 0 0 1-1.425.748 5.165 5.165 0 0 1-1.603.248c-1.446 0-2.677-.5-3.693-1.503S.495 7.164.495 5.717c0-1.446.508-2.678 1.524-3.693C3.035 1.008 4.266.5 5.712.5c1.448 0 2.672.508 3.675 1.524 1.002 1.015 1.503 2.247 1.503 3.693 0 .558-.08 1.092-.239 1.603-.159.512-.411.98-.757 1.405l4.382 4.4a.74.74 0 0 1 .229.568.81.81 0 0 1-.249.568.787.787 0 0 1-.577.239.787.787 0 0 1-.578-.239ZM5.712 9.223c.97 0 1.796-.342 2.48-1.026a3.378 3.378 0 0 0 1.026-2.48c0-.982-.34-1.818-1.016-2.509-.677-.69-1.507-1.035-2.49-1.035a3.42 3.42 0 0 0-2.509 1.035 3.42 3.42 0 0 0-1.035 2.51c0 .982.345 1.812 1.035 2.488.691.678 1.527 1.017 2.51 1.017Z"),P(t,"width","14"),P(t,"height","14"),P(t,"viewBox","0 0 15 15"),P(t,"class","svelte-en2qvf")},m(r,o){Dt(r,t,o),nt(t,e)},p:It,i:It,o:It,d(r){r&&Tt(t)}}}class sc extends qr{constructor(t){super(),Ur(this,t,null,oc,zr,{})}}function da(n,t,e){const r=n.slice();return r[75]=t[e],r[77]=e,r}function va(n){let t,e;return t=new nc({}),{c(){Rr(t.$$.fragment)},m(r,o){lr(t,r,o),e=!0},i(r){e||(Gt(t.$$.fragment,r),e=!0)},o(r){le(t.$$.fragment,r),e=!1},d(r){cr(t,r)}}}function ya(n){let t,e,r,o,s;return e=new ic({}),{c(){t=ht("button"),Rr(e.$$.fragment),P(t,"type","button"),P(t,"title",n[9]),P(t,"class","svelte-1r7dvt7"),on(t,"active",n[0])},m(l,a){Dt(l,t,a),lr(e,t,null),r=!0,o||(s=Ce(t,"click",n[61]),o=!0)},p(l,a){(!r||a[0]&512)&&P(t,"title",l[9]),(!r||a[0]&1)&&on(t,"active",l[0])},i(l){r||(Gt(e.$$.fragment,l),r=!0)},o(l){le(e.$$.fragment,l),r=!1},d(l){l&&Tt(t),cr(e),o=!1,s()}}}function ac(n){let t,e=[],r=new Map,o,s,l,a=ga(n[13]);const h=y=>y[75].id+(y[75].address?","+y[75].address:"");for(let y=0;y<a.length;y+=1){let C=da(n,a,y),L=h(C);r.set(L,e[y]=ma(L,C))}return{c(){t=ht("ul");for(let y=0;y<e.length;y+=1)e[y].c();P(t,"class","svelte-1r7dvt7")},m(y,C){Dt(y,t,C);for(let L=0;L<e.length;L+=1)e[L]&&e[L].m(t,null);o=!0,s||(l=[Ce(t,"mouseleave",n[65]),Ce(t,"blur",n[66])],s=!0)},p(y,C){C[0]&8940544&&(a=ga(y[13]),Ao(),e=Vl(e,C,h,1,y,a,r,t,Gl,ma,null,da),Fo())},i(y){if(!o){for(let C=0;C<a.length;C+=1)Gt(e[C]);o=!0}},o(y){for(let C=0;C<e.length;C+=1)le(e[C]);o=!1},d(y){y&&Tt(t);for(let C=0;C<e.length;C+=1)e[C].d();s=!1,Er(l)}}}function uc(n){let t,e,r,o,s,l;return e=new au({}),{c(){t=ht("div"),Rr(e.$$.fragment),r=nn(),o=ht("div"),s=Pr(n[7]),P(o,"class","svelte-1r7dvt7"),P(t,"class","no-results svelte-1r7dvt7")},m(a,h){Dt(a,t,h),lr(e,t,null),nt(t,r),nt(t,o),nt(o,s),l=!0},p(a,h){(!l||h[0]&128)&&to(s,a[7])},i(a){l||(Gt(e.$$.fragment,a),l=!0)},o(a){le(e.$$.fragment,a),l=!1},d(a){a&&Tt(t),cr(e)}}}function lc(n){let t="",e;return{c(){e=Pr(t)},m(r,o){Dt(r,e,o)},p:It,i:It,o:It,d(r){r&&Tt(e)}}}function cc(n){let t,e,r,o,s,l,a,h,y,C,L;return e=new au({}),h=new su({}),{c(){t=ht("div"),Rr(e.$$.fragment),r=nn(),o=ht("div"),s=Pr(n[6]),l=nn(),a=ht("button"),Rr(h.$$.fragment),P(o,"class","svelte-1r7dvt7"),P(a,"class","svelte-1r7dvt7"),P(t,"class","error svelte-1r7dvt7")},m(Y,ze){Dt(Y,t,ze),lr(e,t,null),nt(t,r),nt(t,o),nt(o,s),nt(t,l),nt(t,a),lr(h,a,null),y=!0,C||(L=Ce(a,"click",n[62]),C=!0)},p(Y,ze){(!y||ze[0]&64)&&to(s,Y[6])},i(Y){y||(Gt(e.$$.fragment,Y),Gt(h.$$.fragment,Y),y=!0)},o(Y){le(e.$$.fragment,Y),le(h.$$.fragment,Y),y=!1},d(Y){Y&&Tt(t),cr(e),cr(h),C=!1,L()}}}function ma(n,t){let e,r,o;function s(){return t[63](t[77])}function l(){return t[64](t[75])}return r=new tc({props:{feature:t[75],showPlaceType:t[10],selected:t[14]===t[77],missingIconsCache:t[19],iconsBaseUrl:t[11]}}),r.$on("mouseenter",s),r.$on("focus",l),{key:n,first:null,c(){e=Pl(),Rr(r.$$.fragment),this.first=e},m(a,h){Dt(a,e,h),lr(r,a,h),o=!0},p(a,h){t=a;const y={};h[0]&8192&&(y.feature=t[75]),h[0]&1024&&(y.showPlaceType=t[10]),h[0]&24576&&(y.selected=t[14]===t[77]),h[0]&2048&&(y.iconsBaseUrl=t[11]),r.$set(y)},i(a){o||(Gt(r.$$.fragment,a),o=!0)},o(a){le(r.$$.fragment,a),o=!1},d(a){a&&Tt(e),cr(r,a)}}}function fc(n){let t,e,r,o,s,l,a,h,y,C,L,Y,ze,Bt,Ir,Wr,yi,Bn,vi,wo;o=new sc({}),C=new su({});let ia=n[18]&&va(),gl=n[5]===!0&&ya(n);const ml=n[53].default,il=Sl(ml,n,n[52],null),sl=[cc,lc,uc,ac],ol=[];function _l(rh,wh){var Fh,Mh;return rh[17]?0:rh[15]?((Fh=rh[13])==null?void 0:Fh.length)===0?2:rh[15]&&(Mh=rh[13])!=null&&Mh.length?3:-1:1}return~(Ir=_l(n))&&(Wr=ol[Ir]=sl[Ir](n)),{c(){t=ht("form"),e=ht("div"),r=ht("button"),Rr(o.$$.fragment),s=nn(),l=ht("input"),a=nn(),h=ht("div"),y=ht("button"),Rr(C.$$.fragment),L=nn(),ia&&ia.c(),Y=nn(),gl&&gl.c(),ze=nn(),il&&il.c(),Bt=nn(),Wr&&Wr.c(),P(r,"class","search-button svelte-1r7dvt7"),P(r,"type","button"),P(l,"placeholder",n[8]),P(l,"aria-label",n[8]),P(l,"class","svelte-1r7dvt7"),P(y,"type","button"),P(y,"title",n[3]),P(y,"class","svelte-1r7dvt7"),P(h,"class","clear-button-container svelte-1r7dvt7"),on(h,"displayable",n[1]!==""),P(e,"class","input-group svelte-1r7dvt7"),P(t,"tabindex","0"),P(t,"class",yi=la(n[2])+" svelte-1r7dvt7"),on(t,"can-collapse",n[4]&&n[1]==="")},m(rh,wh){Dt(rh,t,wh),nt(t,e),nt(e,r),lr(o,r,null),nt(e,s),nt(e,l),n[55](l),ca(l,n[1]),nt(e,a),nt(e,h),nt(h,y),lr(C,y,null),nt(h,L),ia&&ia.m(h,null),nt(e,Y),gl&&gl.m(e,null),nt(e,ze),il&&il.m(e,null),nt(t,Bt),~Ir&&ol[Ir].m(t,null),Bn=!0,vi||(wo=[Ce(r,"click",n[54]),Ce(l,"input",n[56]),Ce(l,"focus",n[57]),Ce(l,"blur",n[58]),Ce(l,"keydown",n[21]),Ce(l,"input",n[59]),Ce(y,"click",n[60]),Ce(t,"submit",Rl(n[20]))],vi=!0)},p(rh,wh){(!Bn||wh[0]&256)&&P(l,"placeholder",rh[8]),(!Bn||wh[0]&256)&&P(l,"aria-label",rh[8]),wh[0]&2&&l.value!==rh[1]&&ca(l,rh[1]),(!Bn||wh[0]&8)&&P(y,"title",rh[3]),rh[18]?ia?wh[0]&262144&&Gt(ia,1):(ia=va(),ia.c(),Gt(ia,1),ia.m(h,null)):ia&&(Ao(),le(ia,1,1,()=>{ia=null}),Fo()),(!Bn||wh[0]&2)&&on(h,"displayable",rh[1]!==""),rh[5]===!0?gl?(gl.p(rh,wh),wh[0]&32&&Gt(gl,1)):(gl=ya(rh),gl.c(),Gt(gl,1),gl.m(e,ze)):gl&&(Ao(),le(gl,1,1,()=>{gl=null}),Fo()),il&&il.p&&(!Bn||wh[1]&2097152)&&Ll(il,ml,rh,rh[52],Bn?wl(ml,rh[52],wh,null):bl(rh[52]),null);let Fh=Ir;Ir=_l(rh),Ir===Fh?~Ir&&ol[Ir].p(rh,wh):(Wr&&(Ao(),le(ol[Fh],1,1,()=>{ol[Fh]=null}),Fo()),~Ir?(Wr=ol[Ir],Wr?Wr.p(rh,wh):(Wr=ol[Ir]=sl[Ir](rh),Wr.c()),Gt(Wr,1),Wr.m(t,null)):Wr=null),(!Bn||wh[0]&4&&yi!==(yi=la(rh[2])+" svelte-1r7dvt7"))&&P(t,"class",yi),(!Bn||wh[0]&22)&&on(t,"can-collapse",rh[4]&&rh[1]==="")},i(rh){Bn||(Gt(o.$$.fragment,rh),Gt(C.$$.fragment,rh),Gt(ia),Gt(gl),Gt(il,rh),Gt(Wr),Bn=!0)},o(rh){le(o.$$.fragment,rh),le(C.$$.fragment,rh),le(ia),le(gl),le(il,rh),le(Wr),Bn=!1},d(rh){rh&&Tt(t),cr(o),n[55](null),cr(C),ia&&ia.d(),gl&&gl.d(),il&&il.d(rh),~Ir&&ol[Ir].d(),vi=!1,Er(wo)}}}function hc(n,t,e){const r=t[1],o=t[0],s=r-o;return n===r&&e?n:((n-o)%s+s)%s+o}function _a(n){let t=[...n];return t[2]<t[0]&&(t[2]+=360),t}function gc(n,t,e){let r,{$$slots:o={},$$scope:s}=t,{class:l=void 0}=t,{apiKey:a}=t,{bbox:h=void 0}=t,{clearButtonTitle:y="clear"}=t,{clearOnBlur:C=!1}=t,{collapsed:L=!1}=t,{country:Y=void 0}=t,{debounceSearch:ze=200}=t,{enableReverse:Bt=!1}=t,{errorMessage:Ir="Something went wrong…"}=t,{filter:Wr=()=>!0}=t,{flyTo:yi=!0}=t,{fuzzyMatch:Bn=!0}=t,{language:vi=void 0}=t,{limit:wo=void 0}=t,{mapController:ia=void 0}=t,{minLength:gl=2}=t,{noResultsMessage:ml="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=t,{placeholder:il="Search"}=t,{proximity:sl=void 0}=t,{reverseActive:ol=Bt==="always"}=t,{reverseButtonTitle:_l="toggle reverse geocoding"}=t,{searchValue:rh=""}=t,{showFullGeometry:wh=!0}=t,{showPlaceType:Fh="ifNeeded"}=t,{showResultsWhileTyping:Mh=!0}=t,{trackProximity:vp=!0}=t,{types:gp=void 0}=t,{zoom:Jh=16}=t,{maxZoom:Lp=18}=t,{apiUrl:Ip="https://api.maptiler.com/geocoding"}=t,{fetchParameters:$p={}}=t,{iconsBaseUrl:Xp="https://cdn.maptiler.com/maptiler-geocoding-control/v0.0.97/icons/"}=t;function Cp(){Kp.focus()}function Gp(){Kp.blur()}function Rp(oh,Oh=!0){e(1,rh=oh),Oh?(e(14,Ad=-1),Fd()):(ud(),setTimeout(()=>{Kp.focus(),Kp.select()}))}let od=!1,Wp,Ld,ed,Gd="",Kp,Ad=-1,Id,Yh=[],Ap,kd,cd,id;const fp=new Set,Cd=Ml();Dl(()=>{ia&&(ia.setEventHandler(void 0),ia.indicateReverse(!1),ia.setSelectedMarker(-1),ia.setMarkers(void 0,void 0))});function Fd(oh){if(kd&&(clearTimeout(kd),kd=void 0),Ad>-1&&Wp)e(49,ed=Wp[Ad]),e(1,rh=ed.place_name.replace(/,.*/,"")),e(17,Id=void 0),e(48,Ld=void 0),e(14,Ad=-1);else if(rh){const Oh=oh||!yd();kp(rh,{exact:!0}).then(()=>{e(48,Ld=Wp),e(49,ed=void 0),Oh&&Uf()}).catch(Uh=>e(17,Id=Uh))}}function yd(){return/^-?\d+(\.\d+)?,-?\d+(\.\d+)?$/.test(rh)}async function kp(oh,{byId:Oh=!1,exact:Uh=!1}={}){e(17,Id=void 0);const vl=yd(),gs=new URLSearchParams;vi!=null&&gs.set("language",Array.isArray(vi)?vi.join(","):vi),gp&&gs.set("types",gp.join(",")),vl||(h&&gs.set("bbox",h.map(uh=>uh.toFixed(6)).join(",")),Y&&gs.set("country",Array.isArray(Y)?Y.join(","):Y)),Oh||(sl&&gs.set("proximity",sl.map(uh=>uh.toFixed(6)).join(",")),(Uh||!Mh)&&gs.set("autocomplete","false"),gs.set("fuzzyMatch",String(Bn))),wo!==void 0&&(!vl||(gp==null?void 0:gp.length)===1)&&gs.set("limit",String(wo)),gs.set("key",a);const di=Ip+"/"+encodeURIComponent(oh)+".json?"+gs.toString();if(di===Gd){Oh?(e(13,Wp=void 0),e(49,ed=Yh[0])):e(13,Wp=Yh);return}Gd=di,Ap==null||Ap.abort();const fs=new AbortController;e(18,Ap=fs);let cl;try{cl=await fetch(di,{signal:fs.signal,...$p}).finally(()=>{fs===Ap&&e(18,Ap=void 0)})}catch(uh){if(uh&&typeof uh=="object"&&"name"in uh&&uh.name==="AbortError")return;throw new Error}if(!cl.ok)throw new Error;const ih=await cl.json();Cd("response",{url:di,featureCollection:ih}),Oh?(e(13,Wp=void 0),e(49,ed=ih.features[0]),Yh=[ed]):(e(13,Wp=ih.features.filter(Wr)),Yh=Wp,vl&&Kp.focus())}function Uf(){var oh,Oh,Uh,vl;if(!(Ld!=null&&Ld.length)||!yi)return;const gs=[180,90,-180,-90],di=!Ld.some(fs=>!fs.matching_text);for(const fs of Ld)(di||!fs.matching_text)&&(gs[0]=Math.min(gs[0],((oh=fs.bbox)==null?void 0:oh[0])??fs.center[0]),gs[1]=Math.min(gs[1],((Oh=fs.bbox)==null?void 0:Oh[1])??fs.center[1]),gs[2]=Math.max(gs[2],((Uh=fs.bbox)==null?void 0:Uh[2])??fs.center[0]),gs[3]=Math.max(gs[3],((vl=fs.bbox)==null?void 0:vl[3])??fs.center[1]));ia&&Ld.length>0&&(ed&&gs[0]===gs[2]&&gs[1]===gs[3]?ia.flyTo(ed.center,Jh):ia.fitBounds(_a(gs),50,Lp))}function $f(oh){e(0,ol=Bt==="always"),Rp(hc(oh[0],[-180,180],!0).toFixed(6)+","+oh[1].toFixed(6))}function up(oh){if(!Wp)return;let Oh=oh.key==="ArrowDown"?1:oh.key==="ArrowUp"?-1:0;Oh?(Ad===-1&&Oh===-1&&e(14,Ad=Wp.length),e(14,Ad+=Oh),Ad>=Wp.length&&e(14,Ad=-1),oh.preventDefault()):["ArrowLeft","ArrowRight","Home","End"].includes(oh.key)&&e(14,Ad=-1)}function ud(oh=!0){if(e(17,Id=void 0),Mh){if(kd&&clearTimeout(kd),rh.length<gl)return;const Oh=rh;kd=window.setTimeout(()=>{kp(Oh).catch(Uh=>e(17,Id=Uh))},oh?ze:0)}else e(13,Wp=void 0),e(17,Id=void 0)}function xd(oh){e(49,ed=oh),e(1,rh=oh.place_name),e(14,Ad=-1)}const Ed=()=>Kp.focus();function Vd(oh){xs[oh?"unshift":"push"](()=>{Kp=oh,e(16,Kp)})}function Ep(){rh=this.value,e(1,rh),e(12,od),e(27,C)}const Yp=()=>e(12,od=!0),nd=()=>e(12,od=!1),$d=()=>ud(),Qd=()=>{e(1,rh=""),Kp.focus()},Rd=()=>e(0,ol=!ol),ng=()=>e(17,Id=void 0),bg=oh=>e(14,Ad=oh),Ih=oh=>xd(oh),nh=()=>e(14,Ad=-1),sh=()=>{};return n.$$set=oh=>{"class"in oh&&e(2,l=oh.class),"apiKey"in oh&&e(25,a=oh.apiKey),"bbox"in oh&&e(26,h=oh.bbox),"clearButtonTitle"in oh&&e(3,y=oh.clearButtonTitle),"clearOnBlur"in oh&&e(27,C=oh.clearOnBlur),"collapsed"in oh&&e(4,L=oh.collapsed),"country"in oh&&e(28,Y=oh.country),"debounceSearch"in oh&&e(29,ze=oh.debounceSearch),"enableReverse"in oh&&e(5,Bt=oh.enableReverse),"errorMessage"in oh&&e(6,Ir=oh.errorMessage),"filter"in oh&&e(30,Wr=oh.filter),"flyTo"in oh&&e(31,yi=oh.flyTo),"fuzzyMatch"in oh&&e(32,Bn=oh.fuzzyMatch),"language"in oh&&e(33,vi=oh.language),"limit"in oh&&e(34,wo=oh.limit),"mapController"in oh&&e(35,ia=oh.mapController),"minLength"in oh&&e(36,gl=oh.minLength),"noResultsMessage"in oh&&e(7,ml=oh.noResultsMessage),"placeholder"in oh&&e(8,il=oh.placeholder),"proximity"in oh&&e(24,sl=oh.proximity),"reverseActive"in oh&&e(0,ol=oh.reverseActive),"reverseButtonTitle"in oh&&e(9,_l=oh.reverseButtonTitle),"searchValue"in oh&&e(1,rh=oh.searchValue),"showFullGeometry"in oh&&e(37,wh=oh.showFullGeometry),"showPlaceType"in oh&&e(10,Fh=oh.showPlaceType),"showResultsWhileTyping"in oh&&e(38,Mh=oh.showResultsWhileTyping),"trackProximity"in oh&&e(39,vp=oh.trackProximity),"types"in oh&&e(40,gp=oh.types),"zoom"in oh&&e(41,Jh=oh.zoom),"maxZoom"in oh&&e(42,Lp=oh.maxZoom),"apiUrl"in oh&&e(43,Ip=oh.apiUrl),"fetchParameters"in oh&&e(44,$p=oh.fetchParameters),"iconsBaseUrl"in oh&&e(11,Xp=oh.iconsBaseUrl),"$$scope"in oh&&e(52,s=oh.$$scope)},n.$$.update=()=>{if(n.$$.dirty[1]&256&&(vp||e(24,sl=void 0)),n.$$.dirty[0]&134221824&&setTimeout(()=>{e(15,cd=od),C&&!od&&e(1,rh="")}),n.$$.dirty[0]&8194|n.$$.dirty[1]&32&&rh.length<gl&&(e(49,ed=void 0),e(13,Wp=void 0),e(17,Id=void 0),e(48,Ld=Wp)),n.$$.dirty[1]&262208&&wh&&ed&&!ed.address&&ed.geometry.type==="Point"&&kp(ed.id,{byId:!0}).catch(oh=>e(17,Id=oh)),n.$$.dirty[1]&789521&&(ia&&ed&&ed.id!==id&&yi&&(!ed.bbox||ed.bbox[0]===ed.bbox[2]&&ed.bbox[1]===ed.bbox[3]?ia.flyTo(ed.center,ed.id.startsWith("poi.")||ed.id.startsWith("address.")?Lp:Jh):ia.fitBounds(_a(ed.bbox),50,Lp),e(13,Wp=void 0),e(48,Ld=void 0),e(14,Ad=-1)),e(50,id=ed==null?void 0:ed.id)),n.$$.dirty[0]&8192|n.$$.dirty[1]&131072&&Ld!==Wp&&e(48,Ld=void 0),n.$$.dirty[1]&393232&&ia&&ia.setMarkers(Ld,ed),n.$$.dirty[0]&2&&e(14,Ad=-1),n.$$.dirty[0]&40961|n.$$.dirty[1]&272&&ia&&ia.setEventHandler(oh=>{switch(oh.type){case"mapClick":ol&&$f(oh.coordinates);break;case"proximityChange":e(24,sl=vp?oh.proximity:void 0);break;case"markerClick":{const Oh=Wp==null?void 0:Wp.find(Uh=>Uh.id===oh.id);Oh&&xd(Oh)}break;case"markerMouseEnter":e(14,Ad=cd?(Wp==null?void 0:Wp.findIndex(Oh=>Oh.id===oh.id))??-1:-1);break;case"markerMouseLeave":e(14,Ad=-1);break}}),n.$$.dirty[0]&16384|n.$$.dirty[1]&16&&(ia==null||ia.setSelectedMarker(Ad)),n.$$.dirty[0]&24576&&e(51,r=Wp==null?void 0:Wp[Ad]),n.$$.dirty[0]&2|n.$$.dirty[1]&16){const oh=/^(-?\d+(?:\.\d*)?),(-?\d+(?:\.\d*)?)$/.exec(rh);ia==null||ia.setReverseMarker(oh?[Number(oh[1]),Number(oh[2])]:void 0)}n.$$.dirty[1]&1048576&&Cd("select",r),n.$$.dirty[1]&262144&&Cd("pick",ed),n.$$.dirty[0]&40960&&Cd("optionsVisibilityChange",cd&&!!Wp),n.$$.dirty[0]&8192&&Cd("featuresListed",Wp),n.$$.dirty[1]&131072&&Cd("featuresMarked",Ld),n.$$.dirty[0]&1&&Cd("reverseToggle",ol),n.$$.dirty[0]&2&&Cd("queryChange",rh),n.$$.dirty[0]&1|n.$$.dirty[1]&16&&ia&&ia.indicateReverse(ol)},[ol,rh,l,y,L,Bt,Ir,ml,il,_l,Fh,Xp,od,Wp,Ad,cd,Kp,Id,Ap,fp,Fd,up,ud,xd,sl,a,h,C,Y,ze,Wr,yi,Bn,vi,wo,ia,gl,wh,Mh,vp,gp,Jh,Lp,Ip,$p,Cp,Gp,Rp,Ld,ed,id,r,s,o,Ed,Vd,Ep,Yp,nd,$d,Qd,Rd,ng,bg,Ih,nh,sh]}let pc=class extends qr{constructor(n){super(),Ur(this,n,gc,fc,zr,{class:2,apiKey:25,bbox:26,clearButtonTitle:3,clearOnBlur:27,collapsed:4,country:28,debounceSearch:29,enableReverse:5,errorMessage:6,filter:30,flyTo:31,fuzzyMatch:32,language:33,limit:34,mapController:35,minLength:36,noResultsMessage:7,placeholder:8,proximity:24,reverseActive:0,reverseButtonTitle:9,searchValue:1,showFullGeometry:37,showPlaceType:10,showResultsWhileTyping:38,trackProximity:39,types:40,zoom:41,maxZoom:42,apiUrl:43,fetchParameters:44,iconsBaseUrl:11,focus:45,blur:46,setQuery:47},null,[-1,-1,-1])}get focus(){return this.$$.ctx[45]}get blur(){return this.$$.ctx[46]}get setQuery(){return this.$$.ctx[47]}};/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function dc(n,t){var e={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,o,s,l;return l={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function a(y){return function(C){return h([y,C])}}function h(y){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,o&&(s=y[0]&2?o.return:y[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,y[1])).done)return s;switch(o=0,s&&(y=[y[0]&2,s.value]),y[0]){case 0:case 1:s=y;break;case 4:return e.label++,{value:y[1],done:!1};case 5:e.label++,o=y[1],y=[0];continue;case 7:y=e.ops.pop(),e.trys.pop();continue;default:if(s=e.trys,!(s=s.length>0&&s[s.length-1])&&(y[0]===6||y[0]===2)){e=0;continue}if(y[0]===3&&(!s||y[1]>s[0]&&y[1]<s[3])){e.label=y[1];break}if(y[0]===6&&e.label<s[1]){e.label=s[1],s=y;break}if(s&&e.label<s[2]){e.label=s[2],e.ops.push(y);break}s[2]&&e.ops.pop(),e.trys.pop();continue}y=t.call(n,e)}catch(C){y=[6,C],o=0}finally{r=s=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}var Or=function(){function n(t,e){this.next=null,this.key=t,this.data=e,this.left=null,this.right=null}return n}();function vc(n,t){return n>t?1:n<t?-1:0}function Sr(n,t,e){for(var r=new Or(null,null),o=r,s=r;;){var l=e(n,t.key);if(l<0){if(t.left===null)break;if(e(n,t.left.key)<0){var a=t.left;if(t.left=a.right,a.right=t,t=a,t.left===null)break}s.left=t,s=t,t=t.left}else if(l>0){if(t.right===null)break;if(e(n,t.right.key)>0){var a=t.right;if(t.right=a.left,a.left=t,t=a,t.right===null)break}o.right=t,o=t,t=t.right}else break}return o.right=t.left,s.left=t.right,t.left=r.right,t.right=r.left,t}function Es(n,t,e,r){var o=new Or(n,t);if(e===null)return o.left=o.right=null,o;e=Sr(n,e,r);var s=r(n,e.key);return s<0?(o.left=e.left,o.right=e,e.left=null):s>=0&&(o.right=e.right,o.left=e,e.right=null),o}function Ea(n,t,e){var r=null,o=null;if(t){t=Sr(n,t,e);var s=e(t.key,n);s===0?(r=t.left,o=t.right):s<0?(o=t.right,t.right=null,r=t):(r=t.left,t.left=null,o=t)}return{left:r,right:o}}function yc(n,t,e){return t===null?n:(n===null||(t=Sr(n.key,t,e),t.left=n),t)}function Ls(n,t,e,r,o){if(n){r(""+t+(e?"└── ":"├── ")+o(n)+`
`);var s=t+(e?"    ":"│   ");n.left&&Ls(n.left,s,!1,r,o),n.right&&Ls(n.right,s,!0,r,o)}}var zs=function(){function n(t){t===void 0&&(t=vc),this._root=null,this._size=0,this._comparator=t}return n.prototype.insert=function(t,e){return this._size++,this._root=Es(t,e,this._root,this._comparator)},n.prototype.add=function(t,e){var r=new Or(t,e);this._root===null&&(r.left=r.right=null,this._size++,this._root=r);var o=this._comparator,s=Sr(t,this._root,o),l=o(t,s.key);return l===0?this._root=s:(l<0?(r.left=s.left,r.right=s,s.left=null):l>0&&(r.right=s.right,r.left=s,s.right=null),this._size++,this._root=r),this._root},n.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},n.prototype._remove=function(t,e,r){var o;if(e===null)return null;e=Sr(t,e,r);var s=r(t,e.key);return s===0?(e.left===null?o=e.right:(o=Sr(t,e.left,r),o.right=e.right),this._size--,o):e},n.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=Sr(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},n.prototype.findStatic=function(t){for(var e=this._root,r=this._comparator;e;){var o=r(t,e.key);if(o===0)return e;o<0?e=e.left:e=e.right}return null},n.prototype.find=function(t){return this._root&&(this._root=Sr(t,this._root,this._comparator),this._comparator(t,this._root.key)!==0)?null:this._root},n.prototype.contains=function(t){for(var e=this._root,r=this._comparator;e;){var o=r(t,e.key);if(o===0)return!0;o<0?e=e.left:e=e.right}return!1},n.prototype.forEach=function(t,e){for(var r=this._root,o=[],s=!1;!s;)r!==null?(o.push(r),r=r.left):o.length!==0?(r=o.pop(),t.call(e,r),r=r.right):s=!0;return this},n.prototype.range=function(t,e,r,o){for(var s=[],l=this._comparator,a=this._root,h;s.length!==0||a;)if(a)s.push(a),a=a.left;else{if(a=s.pop(),h=l(a.key,e),h>0)break;if(l(a.key,t)>=0&&r.call(o,a))return this;a=a.right}return this},n.prototype.keys=function(){var t=[];return this.forEach(function(e){var r=e.key;return t.push(r)}),t},n.prototype.values=function(){var t=[];return this.forEach(function(e){var r=e.data;return t.push(r)}),t},n.prototype.min=function(){return this._root?this.minNode(this._root).key:null},n.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},n.prototype.minNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.left;)t=t.left;return t},n.prototype.maxNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.right;)t=t.right;return t},n.prototype.at=function(t){for(var e=this._root,r=!1,o=0,s=[];!r;)if(e)s.push(e),e=e.left;else if(s.length>0){if(e=s.pop(),o===t)return e;o++,e=e.right}else r=!0;return null},n.prototype.next=function(t){var e=this._root,r=null;if(t.right){for(r=t.right;r.left;)r=r.left;return r}for(var o=this._comparator;e;){var s=o(t.key,e.key);if(s===0)break;s<0?(r=e,e=e.left):e=e.right}return r},n.prototype.prev=function(t){var e=this._root,r=null;if(t.left!==null){for(r=t.left;r.right;)r=r.right;return r}for(var o=this._comparator;e;){var s=o(t.key,e.key);if(s===0)break;s<0?e=e.left:(r=e,e=e.right)}return r},n.prototype.clear=function(){return this._root=null,this._size=0,this},n.prototype.toList=function(){return _c(this._root)},n.prototype.load=function(t,e,r){e===void 0&&(e=[]),r===void 0&&(r=!1);var o=t.length,s=this._comparator;if(r&&Rs(t,e,0,o-1,s),this._root===null)this._root=bs(t,e,0,o),this._size=o;else{var l=Ec(this.toList(),mc(t,e),s);o=this._size+o,this._root=Ps({head:l},0,o)}return this},n.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(n.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),n.prototype.toString=function(t){t===void 0&&(t=function(r){return String(r.key)});var e=[];return Ls(this._root,"",!0,function(r){return e.push(r)},t),e.join("")},n.prototype.update=function(t,e,r){var o=this._comparator,s=Ea(t,this._root,o),l=s.left,a=s.right;o(t,e)<0?a=Es(e,r,a,o):l=Es(e,r,l,o),this._root=yc(l,a,o)},n.prototype.split=function(t){return Ea(t,this._root,this._comparator)},n.prototype[Symbol.iterator]=function(){var t;return dc(this,function(e){switch(e.label){case 0:t=this.minNode(),e.label=1;case 1:return t?[4,t]:[3,3];case 2:return e.sent(),t=this.next(t),[3,1];case 3:return[2]}})},n}();function bs(n,t,e,r){var o=r-e;if(o>0){var s=e+Math.floor(o/2),l=n[s],a=t[s],h=new Or(l,a);return h.left=bs(n,t,e,s),h.right=bs(n,t,s+1,r),h}return null}function mc(n,t){for(var e=new Or(null,null),r=e,o=0;o<n.length;o++)r=r.next=new Or(n[o],t[o]);return r.next=null,e.next}function _c(n){for(var t=n,e=[],r=!1,o=new Or(null,null),s=o;!r;)t?(e.push(t),t=t.left):e.length>0?(t=s=s.next=e.pop(),t=t.right):r=!0;return s.next=null,o.next}function Ps(n,t,e){var r=e-t;if(r>0){var o=t+Math.floor(r/2),s=Ps(n,t,o),l=n.head;return l.left=s,n.head=n.head.next,l.right=Ps(n,o+1,e),l}return null}function Ec(n,t,e){for(var r=new Or(null,null),o=r,s=n,l=t;s!==null&&l!==null;)e(s.key,l.key)<0?(o.next=s,s=s.next):(o.next=l,l=l.next),o=o.next;return s!==null?o.next=s:l!==null&&(o.next=l),r.next}function Rs(n,t,e,r,o){if(!(e>=r)){for(var s=n[e+r>>1],l=e-1,a=r+1;;){do l++;while(o(n[l],s)<0);do a--;while(o(n[a],s)>0);if(l>=a)break;var h=n[l];n[l]=n[a],n[a]=h,h=t[l],t[l]=t[a],t[a]=h}Rs(n,t,e,a,o),Rs(n,t,a+1,r,o)}}function mn(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function Ia(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function Se(n,t,e){return t&&Ia(n.prototype,t),e&&Ia(n,e),n}var ji=function(n,t){return n.ll.x<=t.x&&t.x<=n.ur.x&&n.ll.y<=t.y&&t.y<=n.ur.y},Os=function(n,t){if(t.ur.x<n.ll.x||n.ur.x<t.ll.x||t.ur.y<n.ll.y||n.ur.y<t.ll.y)return null;var e=n.ll.x<t.ll.x?t.ll.x:n.ll.x,r=n.ur.x<t.ur.x?n.ur.x:t.ur.x,o=n.ll.y<t.ll.y?t.ll.y:n.ll.y,s=n.ur.y<t.ur.y?n.ur.y:t.ur.y;return{ll:{x:e,y:o},ur:{x:r,y:s}}},wr=Number.EPSILON;wr===void 0&&(wr=Math.pow(2,-52));var Ic=wr*wr,Ts=function(n,t){if(-wr<n&&n<wr&&-wr<t&&t<wr)return 0;var e=n-t;return e*e<Ic*n*t?0:n<t?-1:1},Cc=function(){function n(){mn(this,n),this.reset()}return Se(n,[{key:"reset",value:function(){this.xRounder=new Ca,this.yRounder=new Ca}},{key:"round",value:function(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}}]),n}(),Ca=function(){function n(){mn(this,n),this.tree=new zs,this.round(0)}return Se(n,[{key:"round",value:function(t){var e=this.tree.add(t),r=this.tree.prev(e);if(r!==null&&Ts(e.key,r.key)===0)return this.tree.remove(t),r.key;var o=this.tree.next(e);return o!==null&&Ts(e.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),n}(),no=new Cc,$i=function(n,t){return n.x*t.y-n.y*t.x},uu=function(n,t){return n.x*t.x+n.y*t.y},Na=function(n,t,e){var r={x:t.x-n.x,y:t.y-n.y},o={x:e.x-n.x,y:e.y-n.y},s=$i(r,o);return Ts(s,0)},Go=function(n){return Math.sqrt(uu(n,n))},Nc=function(n,t,e){var r={x:t.x-n.x,y:t.y-n.y},o={x:e.x-n.x,y:e.y-n.y};return $i(o,r)/Go(o)/Go(r)},xc=function(n,t,e){var r={x:t.x-n.x,y:t.y-n.y},o={x:e.x-n.x,y:e.y-n.y};return uu(o,r)/Go(o)/Go(r)},xa=function(n,t,e){return t.y===0?null:{x:n.x+t.x/t.y*(e-n.y),y:e}},Sa=function(n,t,e){return t.x===0?null:{x:e,y:n.y+t.y/t.x*(e-n.x)}},Sc=function(n,t,e,r){if(t.x===0)return Sa(e,r,n.x);if(r.x===0)return Sa(n,t,e.x);if(t.y===0)return xa(e,r,n.y);if(r.y===0)return xa(n,t,e.y);var o=$i(t,r);if(o==0)return null;var s={x:e.x-n.x,y:e.y-n.y},l=$i(s,t)/o,a=$i(s,r)/o,h=n.x+a*t.x,y=e.x+l*r.x,C=n.y+a*t.y,L=e.y+l*r.y,Y=(h+y)/2,ze=(C+L)/2;return{x:Y,y:ze}},Yn=function(){Se(n,null,[{key:"compare",value:function(t,e){var r=n.comparePoints(t.point,e.point);return r!==0?r:(t.point!==e.point&&t.link(e),t.isLeft!==e.isLeft?t.isLeft?1:-1:Vo.compare(t.segment,e.segment))}},{key:"comparePoints",value:function(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}}]);function n(t,e){mn(this,n),t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=e}return Se(n,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var e=t.point.events,r=0,o=e.length;r<o;r++){var s=e[r];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,e=0;e<t;e++){var r=this.point.events[e];if(r.segment.consumedBy===void 0)for(var o=e+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&r.otherSE.point.events===s.otherSE.point.events&&r.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],e=0,r=this.point.events.length;e<r;e++){var o=this.point.events[e];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var e=this,r=new Map,o=function(s){var l=s.otherSE;r.set(s,{sine:Nc(e.point,t.point,l.point),cosine:xc(e.point,t.point,l.point)})};return function(s,l){r.has(s)||o(s),r.has(l)||o(l);var a=r.get(s),h=a.sine,y=a.cosine,C=r.get(l),L=C.sine,Y=C.cosine;return h>=0&&L>=0?y<Y?1:y>Y?-1:0:h<0&&L<0?y<Y?-1:y>Y?1:0:L<h?-1:L>h?1:0}}}]),n}(),wc=0,Vo=function(){Se(n,null,[{key:"compare",value:function(t,e){var r=t.leftSE.point.x,o=e.leftSE.point.x,s=t.rightSE.point.x,l=e.rightSE.point.x;if(l<r)return 1;if(s<o)return-1;var a=t.leftSE.point.y,h=e.leftSE.point.y,y=t.rightSE.point.y,C=e.rightSE.point.y;if(r<o){if(h<a&&h<y)return 1;if(h>a&&h>y)return-1;var L=t.comparePoint(e.leftSE.point);if(L<0)return 1;if(L>0)return-1;var Y=e.comparePoint(t.rightSE.point);return Y!==0?Y:-1}if(r>o){if(a<h&&a<C)return-1;if(a>h&&a>C)return 1;var ze=e.comparePoint(t.leftSE.point);if(ze!==0)return ze;var Bt=t.comparePoint(e.rightSE.point);return Bt<0?1:Bt>0?-1:1}if(a<h)return-1;if(a>h)return 1;if(s<l){var Ir=e.comparePoint(t.rightSE.point);if(Ir!==0)return Ir}if(s>l){var Wr=t.comparePoint(e.rightSE.point);if(Wr<0)return 1;if(Wr>0)return-1}if(s!==l){var yi=y-a,Bn=s-r,vi=C-h,wo=l-o;if(yi>Bn&&vi<wo)return 1;if(yi<Bn&&vi>wo)return-1}return s>l?1:s<l||y<C?-1:y>C?1:t.id<e.id?-1:t.id>e.id?1:0}}]);function n(t,e,r,o){mn(this,n),this.id=++wc,this.leftSE=t,t.segment=this,t.otherSE=e,this.rightSE=e,e.segment=this,e.otherSE=t,this.rings=r,this.windings=o}return Se(n,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var e=this.leftSE.point,r=this.rightSE.point,o=this.vector();if(e.x===r.x)return t.x===e.x?0:t.x<e.x?1:-1;var s=(t.y-e.y)/o.y,l=e.x+s*o.x;if(t.x===l)return 0;var a=(t.x-e.x)/o.x,h=e.y+a*o.y;return t.y===h?0:t.y<h?-1:1}},{key:"getIntersection",value:function(t){var e=this.bbox(),r=t.bbox(),o=Os(e,r);if(o===null)return null;var s=this.leftSE.point,l=this.rightSE.point,a=t.leftSE.point,h=t.rightSE.point,y=ji(e,a)&&this.comparePoint(a)===0,C=ji(r,s)&&t.comparePoint(s)===0,L=ji(e,h)&&this.comparePoint(h)===0,Y=ji(r,l)&&t.comparePoint(l)===0;if(C&&y)return Y&&!L?l:!Y&&L?h:null;if(C)return L&&s.x===h.x&&s.y===h.y?null:s;if(y)return Y&&l.x===a.x&&l.y===a.y?null:a;if(Y&&L)return null;if(Y)return l;if(L)return h;var ze=Sc(s,this.vector(),a,t.vector());return ze===null||!ji(o,ze)?null:no.round(ze.x,ze.y)}},{key:"split",value:function(t){var e=[],r=t.events!==void 0,o=new Yn(t,!0),s=new Yn(t,!1),l=this.rightSE;this.replaceRightSE(s),e.push(s),e.push(o);var a=new n(o,l,this.rings.slice(),this.windings.slice());return Yn.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),Yn.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(o.checkForConsuming(),s.checkForConsuming()),e}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var e=0,r=this.windings.length;e<r;e++)this.windings[e]*=-1}},{key:"consume",value:function(t){for(var e=this,r=t;e.consumedBy;)e=e.consumedBy;for(;r.consumedBy;)r=r.consumedBy;var o=n.compare(e,r);if(o!==0){if(o>0){var s=e;e=r,r=s}if(e.prev===r){var l=e;e=r,r=l}for(var a=0,h=r.rings.length;a<h;a++){var y=r.rings[a],C=r.windings[a],L=e.rings.indexOf(y);L===-1?(e.rings.push(y),e.windings.push(C)):e.windings[L]+=C}r.rings=null,r.windings=null,r.consumedBy=e,r.leftSE.consumedBy=e.leftSE,r.rightSE.consumedBy=e.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var e=this._afterState.rings,r=this._afterState.windings,o=this._afterState.multiPolys,s=0,l=this.rings.length;s<l;s++){var a=this.rings[s],h=this.windings[s],y=e.indexOf(a);y===-1?(e.push(a),r.push(h)):r[y]+=h}for(var C=[],L=[],Y=0,ze=e.length;Y<ze;Y++)if(r[Y]!==0){var Bt=e[Y],Ir=Bt.poly;if(L.indexOf(Ir)===-1)if(Bt.isExterior)C.push(Ir);else{L.indexOf(Ir)===-1&&L.push(Ir);var Wr=C.indexOf(Bt.poly);Wr!==-1&&C.splice(Wr,1)}}for(var yi=0,Bn=C.length;yi<Bn;yi++){var vi=C[yi].multiPoly;o.indexOf(vi)===-1&&o.push(vi)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(xn.type){case"union":{var r=t.length===0,o=e.length===0;this._isInResult=r!==o;break}case"intersection":{var s,l;t.length<e.length?(s=t.length,l=e.length):(s=e.length,l=t.length),this._isInResult=l===xn.numMultiPolys&&s<l;break}case"xor":{var a=Math.abs(t.length-e.length);this._isInResult=a%2===1;break}case"difference":{var h=function(y){return y.length===1&&y[0].isSubject};this._isInResult=h(t)!==h(e);break}default:throw new Error("Unrecognized operation type found ".concat(xn.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,e,r){var o,s,l,a=Yn.comparePoints(t,e);if(a<0)o=t,s=e,l=1;else if(a>0)o=e,s=t,l=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var h=new Yn(o,!0),y=new Yn(s,!1);return new n(h,y,[r],[l])}}]),n}(),wa=function(){function n(t,e,r){if(mn(this,n),!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=r,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var o=no.round(t[0][0],t[0][1]);this.bbox={ll:{x:o.x,y:o.y},ur:{x:o.x,y:o.y}};for(var s=o,l=1,a=t.length;l<a;l++){if(typeof t[l][0]!="number"||typeof t[l][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var h=no.round(t[l][0],t[l][1]);h.x===s.x&&h.y===s.y||(this.segments.push(Vo.fromRing(s,h,this)),h.x<this.bbox.ll.x&&(this.bbox.ll.x=h.x),h.y<this.bbox.ll.y&&(this.bbox.ll.y=h.y),h.x>this.bbox.ur.x&&(this.bbox.ur.x=h.x),h.y>this.bbox.ur.y&&(this.bbox.ur.y=h.y),s=h)}(o.x!==s.x||o.y!==s.y)&&this.segments.push(Vo.fromRing(s,o,this))}return Se(n,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,r=this.segments.length;e<r;e++){var o=this.segments[e];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),n}(),Lc=function(){function n(t,e){if(mn(this,n),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new wa(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var r=1,o=t.length;r<o;r++){var s=new wa(t[r],this,!1);s.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=s.bbox.ll.x),s.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=s.bbox.ll.y),s.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=s.bbox.ur.x),s.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=s.bbox.ur.y),this.interiorRings.push(s)}this.multiPoly=e}return Se(n,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),e=0,r=this.interiorRings.length;e<r;e++)for(var o=this.interiorRings[e].getSweepEvents(),s=0,l=o.length;s<l;s++)t.push(o[s]);return t}}]),n}(),La=function(){function n(t,e){if(mn(this,n),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var r=0,o=t.length;r<o;r++){var s=new Lc(t[r],this);s.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=s.bbox.ll.x),s.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=s.bbox.ll.y),s.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=s.bbox.ur.x),s.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=s.bbox.ur.y),this.polys.push(s)}this.isSubject=e}return Se(n,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,r=this.polys.length;e<r;e++)for(var o=this.polys[e].getSweepEvents(),s=0,l=o.length;s<l;s++)t.push(o[s]);return t}}]),n}(),bc=function(){Se(n,null,[{key:"factory",value:function(t){for(var e=[],r=0,o=t.length;r<o;r++){var s=t[r];if(!(!s.isInResult()||s.ringOut)){for(var l=null,a=s.leftSE,h=s.rightSE,y=[a],C=a.point,L=[];l=a,a=h,y.push(a),a.point!==C;)for(;;){var Y=a.getAvailableLinkedEvents();if(Y.length===0){var ze=y[0].point,Bt=y[y.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(ze.x,",")+" ".concat(ze.y,"]. Last matching segment found ends at")+" [".concat(Bt.x,", ").concat(Bt.y,"]."))}if(Y.length===1){h=Y[0].otherSE;break}for(var Ir=null,Wr=0,yi=L.length;Wr<yi;Wr++)if(L[Wr].point===a.point){Ir=Wr;break}if(Ir!==null){var Bn=L.splice(Ir)[0],vi=y.splice(Bn.index);vi.unshift(vi[0].otherSE),e.push(new n(vi.reverse()));continue}L.push({index:y.length,point:a.point});var wo=a.getLeftmostComparator(l);h=Y.sort(wo)[0].otherSE;break}e.push(new n(y))}}return e}}]);function n(t){mn(this,n),this.events=t;for(var e=0,r=t.length;e<r;e++)t[e].segment.ringOut=this;this.poly=null}return Se(n,[{key:"getGeom",value:function(){for(var t=this.events[0].point,e=[t],r=1,o=this.events.length-1;r<o;r++){var s=this.events[r].point,l=this.events[r+1].point;Na(s,t,l)!==0&&(e.push(s),t=s)}if(e.length===1)return null;var a=e[0],h=e[1];Na(a,t,h)===0&&e.shift(),e.push(e[0]);for(var y=this.isExteriorRing()?1:-1,C=this.isExteriorRing()?0:e.length-1,L=this.isExteriorRing()?e.length:-1,Y=[],ze=C;ze!=L;ze+=y)Y.push([e[ze].x,e[ze].y]);return Y}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],e=1,r=this.events.length;e<r;e++){var o=this.events[e];Yn.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),l=s?s.prevInResult():null;;){if(!s)return null;if(!l)return s.ringOut;if(l.ringOut!==s.ringOut)return l.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=l.prevInResult(),l=s?s.prevInResult():null}}}]),n}(),ba=function(){function n(t){mn(this,n),this.exteriorRing=t,t.poly=this,this.interiorRings=[]}return Se(n,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var e=0,r=this.interiorRings.length;e<r;e++){var o=this.interiorRings[e].getGeom();o!==null&&t.push(o)}return t}}]),n}(),Pc=function(){function n(t){mn(this,n),this.rings=t,this.polys=this._composePolys(t)}return Se(n,[{key:"getGeom",value:function(){for(var t=[],e=0,r=this.polys.length;e<r;e++){var o=this.polys[e].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var e=[],r=0,o=t.length;r<o;r++){var s=t[r];if(!s.poly)if(s.isExteriorRing())e.push(new ba(s));else{var l=s.enclosingRing();l.poly||e.push(new ba(l)),l.poly.addInterior(s)}}return e}}]),n}(),Rc=function(){function n(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Vo.compare;mn(this,n),this.queue=t,this.tree=new zs(e),this.segments=[]}return Se(n,[{key:"process",value:function(t){var e=t.segment,r=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),r;var o=t.isLeft?this.tree.insert(e):this.tree.find(e);if(!o)throw new Error("Unable to find segment #".concat(e.id," ")+"[".concat(e.leftSE.point.x,", ").concat(e.leftSE.point.y,"] -> ")+"[".concat(e.rightSE.point.x,", ").concat(e.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,l=o,a=void 0,h=void 0;a===void 0;)s=this.tree.prev(s),s===null?a=null:s.key.consumedBy===void 0&&(a=s.key);for(;h===void 0;)l=this.tree.next(l),l===null?h=null:l.key.consumedBy===void 0&&(h=l.key);if(t.isLeft){var y=null;if(a){var C=a.getIntersection(e);if(C!==null&&(e.isAnEndpoint(C)||(y=C),!a.isAnEndpoint(C)))for(var L=this._splitSafely(a,C),Y=0,ze=L.length;Y<ze;Y++)r.push(L[Y])}var Bt=null;if(h){var Ir=h.getIntersection(e);if(Ir!==null&&(e.isAnEndpoint(Ir)||(Bt=Ir),!h.isAnEndpoint(Ir)))for(var Wr=this._splitSafely(h,Ir),yi=0,Bn=Wr.length;yi<Bn;yi++)r.push(Wr[yi])}if(y!==null||Bt!==null){var vi=null;if(y===null)vi=Bt;else if(Bt===null)vi=y;else{var wo=Yn.comparePoints(y,Bt);vi=wo<=0?y:Bt}this.queue.remove(e.rightSE),r.push(e.rightSE);for(var ia=e.split(vi),gl=0,ml=ia.length;gl<ml;gl++)r.push(ia[gl])}r.length>0?(this.tree.remove(e),r.push(t)):(this.segments.push(e),e.prev=a)}else{if(a&&h){var il=a.getIntersection(h);if(il!==null){if(!a.isAnEndpoint(il))for(var sl=this._splitSafely(a,il),ol=0,_l=sl.length;ol<_l;ol++)r.push(sl[ol]);if(!h.isAnEndpoint(il))for(var rh=this._splitSafely(h,il),wh=0,Fh=rh.length;wh<Fh;wh++)r.push(rh[wh])}}this.tree.remove(e)}return r}},{key:"_splitSafely",value:function(t,e){this.tree.remove(t);var r=t.rightSE;this.queue.remove(r);var o=t.split(e);return o.push(r),t.consumedBy===void 0&&this.tree.insert(t),o}}]),n}(),Pa=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Oc=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Tc=function(){function n(){mn(this,n)}return Se(n,[{key:"run",value:function(t,e,r){xn.type=t,no.reset();for(var o=[new La(e,!0)],s=0,l=r.length;s<l;s++)o.push(new La(r[s],!1));if(xn.numMultiPolys=o.length,xn.type==="difference")for(var a=o[0],h=1;h<o.length;)Os(o[h].bbox,a.bbox)!==null?h++:o.splice(h,1);if(xn.type==="intersection"){for(var y=0,C=o.length;y<C;y++)for(var L=o[y],Y=y+1,ze=o.length;Y<ze;Y++)if(Os(L.bbox,o[Y].bbox)===null)return[]}for(var Bt=new zs(Yn.compare),Ir=0,Wr=o.length;Ir<Wr;Ir++)for(var yi=o[Ir].getSweepEvents(),Bn=0,vi=yi.length;Bn<vi;Bn++)if(Bt.insert(yi[Bn]),Bt.size>Pa)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var wo=new Rc(Bt),ia=Bt.size,gl=Bt.pop();gl;){var ml=gl.key;if(Bt.size===ia){var il=ml.segment;throw new Error("Unable to pop() ".concat(ml.isLeft?"left":"right"," SweepEvent ")+"[".concat(ml.point.x,", ").concat(ml.point.y,"] from segment #").concat(il.id," ")+"[".concat(il.leftSE.point.x,", ").concat(il.leftSE.point.y,"] -> ")+"[".concat(il.rightSE.point.x,", ").concat(il.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(Bt.size>Pa)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(wo.segments.length>Oc)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var sl=wo.process(ml),ol=0,_l=sl.length;ol<_l;ol++){var rh=sl[ol];rh.consumedBy===void 0&&Bt.insert(rh)}ia=Bt.size,gl=Bt.pop()}no.reset();var wh=bc.factory(wo.segments),Fh=new Pc(wh);return Fh.getGeom()}}]),n}(),xn=new Tc,Dc=function(n){for(var t=arguments.length,e=new Array(t>1?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];return xn.run("union",n,e)},Mc=function(n){for(var t=arguments.length,e=new Array(t>1?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];return xn.run("intersection",n,e)},Ac=function(n){for(var t=arguments.length,e=new Array(t>1?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];return xn.run("xor",n,e)},Fc=function(n){for(var t=arguments.length,e=new Array(t>1?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];return xn.run("difference",n,e)},lu={union:Dc,intersection:Mc,xor:Ac,difference:Fc},Ie=63710088e-1,cu={centimeters:Ie*100,centimetres:Ie*100,degrees:Ie/111325,feet:Ie*3.28084,inches:Ie*39.37,kilometers:Ie/1e3,kilometres:Ie/1e3,meters:Ie,metres:Ie,miles:Ie/1609.344,millimeters:Ie*1e3,millimetres:Ie*1e3,nauticalmiles:Ie/1852,radians:1,yards:Ie*1.0936};function Jo(n,t,e){e===void 0&&(e={});var r={type:"Feature"};return(e.id===0||e.id)&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.properties=t||{},r.geometry=n,r}function Bc(n,t,e){if(e===void 0&&(e={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ra(n[0])||!Ra(n[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:n};return Jo(r,t,e)}function fu(n,t,e){e===void 0&&(e={});for(var r=0,o=n;r<o.length;r++){var s=o[r];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var l=0;l<s[s.length-1].length;l++)if(s[s.length-1][l]!==s[0][l])throw new Error("First and last Position are not equivalent.")}var a={type:"Polygon",coordinates:n};return Jo(a,t,e)}function Ds(n,t){t===void 0&&(t={});var e={type:"FeatureCollection"};return t.id&&(e.id=t.id),t.bbox&&(e.bbox=t.bbox),e.features=n,e}function hu(n,t,e){e===void 0&&(e={});var r={type:"MultiPolygon",coordinates:n};return Jo(r,t,e)}function kc(n,t){t===void 0&&(t="kilometers");var e=cu[t];if(!e)throw new Error(t+" units is invalid");return n*e}function Gc(n,t){t===void 0&&(t="kilometers");var e=cu[t];if(!e)throw new Error(t+" units is invalid");return n/e}function Ra(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function zo(n){return n.type==="Feature"?n.geometry:n}function Vc(n,t,e){e===void 0&&(e={});var r=zo(n),o=zo(t),s=lu.union(r.coordinates,o.coordinates);return s.length===0?null:s.length===1?fu(s[0],e.properties):hu(s,e.properties)}function zc(n){let t,e,r;return{c(){t=Kn("svg"),e=Kn("path"),P(e,"stroke-width","4"),P(e,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),P(e,"class","svelte-gzo3ar"),P(t,"width",r=n[0]==="list"?20:void 0),P(t,"viewBox","0 0 70 85"),P(t,"fill","none"),P(t,"class","svelte-gzo3ar"),on(t,"in-map",n[0]!=="list"),on(t,"list-icon",n[0]==="list")},m(o,s){Dt(o,t,s),nt(t,e)},p(o,[s]){s&1&&r!==(r=o[0]==="list"?20:void 0)&&P(t,"width",r),s&1&&on(t,"in-map",o[0]!=="list"),s&1&&on(t,"list-icon",o[0]==="list")},i:It,o:It,d(o){o&&Tt(t)}}}function Uc(n,t,e){let{displayIn:r}=t;return n.$$set=o=>{"displayIn"in o&&e(0,r=o.displayIn)},[r]}class qc extends qr{constructor(t){super(),Ur(this,t,Uc,zc,zr,{displayIn:0})}}function gu(n,t,e){if(n!==null)for(var r,o,s,l,a,h,y,C=0,L=0,Y,ze=n.type,Bt=ze==="FeatureCollection",Ir=ze==="Feature",Wr=Bt?n.features.length:1,yi=0;yi<Wr;yi++){y=Bt?n.features[yi].geometry:Ir?n.geometry:n,Y=y?y.type==="GeometryCollection":!1,a=Y?y.geometries.length:1;for(var Bn=0;Bn<a;Bn++){var vi=0,wo=0;if(l=Y?y.geometries[Bn]:y,l!==null){h=l.coordinates;var ia=l.type;switch(C=e&&(ia==="Polygon"||ia==="MultiPolygon")?1:0,ia){case null:break;case"Point":if(t(h,L,yi,vi,wo)===!1)return!1;L++,vi++;break;case"LineString":case"MultiPoint":for(r=0;r<h.length;r++){if(t(h[r],L,yi,vi,wo)===!1)return!1;L++,ia==="MultiPoint"&&vi++}ia==="LineString"&&vi++;break;case"Polygon":case"MultiLineString":for(r=0;r<h.length;r++){for(o=0;o<h[r].length-C;o++){if(t(h[r][o],L,yi,vi,wo)===!1)return!1;L++}ia==="MultiLineString"&&vi++,ia==="Polygon"&&wo++}ia==="Polygon"&&vi++;break;case"MultiPolygon":for(r=0;r<h.length;r++){for(wo=0,o=0;o<h[r].length;o++){for(s=0;s<h[r][o].length-C;s++){if(t(h[r][o][s],L,yi,vi,wo)===!1)return!1;L++}wo++}vi++}break;case"GeometryCollection":for(r=0;r<l.geometries.length;r++)if(gu(l.geometries[r],t,e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Oa(n,t){if(n.type==="Feature")t(n,0);else if(n.type==="FeatureCollection")for(var e=0;e<n.features.length&&t(n.features[e],e)!==!1;e++);}function pu(n,t){var e,r,o,s,l,a,h,y,C,L,Y=0,ze=n.type==="FeatureCollection",Bt=n.type==="Feature",Ir=ze?n.features.length:1;for(e=0;e<Ir;e++){for(a=ze?n.features[e].geometry:Bt?n.geometry:n,y=ze?n.features[e].properties:Bt?n.properties:{},C=ze?n.features[e].bbox:Bt?n.bbox:void 0,L=ze?n.features[e].id:Bt?n.id:void 0,h=a?a.type==="GeometryCollection":!1,l=h?a.geometries.length:1,o=0;o<l;o++){if(s=h?a.geometries[o]:a,s===null){if(t(null,Y,y,C,L)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(s,Y,y,C,L)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<s.geometries.length;r++)if(t(s.geometries[r],Y,y,C,L)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}Y++}}function Ms(n){var t=[1/0,1/0,-1/0,-1/0];return gu(n,function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])}),t}Ms.default=Ms;function Xc(n,t){t===void 0&&(t={});var e=Ms(n),r=(e[0]+e[2])/2,o=(e[1]+e[3])/2;return Bc([r,o],t.properties,t)}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(n){if(this===void 0||this===null)throw new TypeError(this+" is not an object");var t=Object(this),e=Math.max(Math.min(t.length,9007199254740991),0)||0,r=1 in arguments&&parseInt(Number(arguments[1]),10)||0;r=r<0?Math.max(e+r,0):Math.min(r,e);var o=2 in arguments&&arguments[2]!==void 0?parseInt(Number(arguments[2]),10)||0:e;for(o=o<0?Math.max(e+arguments[2],0):Math.min(o,e);r<o;)t[r]=n,++r;return t},writable:!0});Number.isFinite=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)};Number.isInteger=Number.isInteger||function(n){return typeof n=="number"&&isFinite(n)&&Math.floor(n)===n};Number.parseFloat=Number.parseFloat||parseFloat;Number.isNaN=Number.isNaN||function(n){return n!==n};Math.trunc=Math.trunc||function(n){return n<0?Math.ceil(n):Math.floor(n)};var Qr=function(){};Qr.prototype.interfaces_=function(){return[]};Qr.prototype.getClass=function(){return Qr};Qr.prototype.equalsWithTolerance=function(n,t,e){return Math.abs(n-t)<=e};var ft=function(n){function t(e){n.call(this,e),this.name="IllegalArgumentException",this.message=e,this.stack=new n().stack}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t}(Error),z=function(){},du={MAX_VALUE:{configurable:!0}};z.isNaN=function(n){return Number.isNaN(n)};z.doubleToLongBits=function(n){return n};z.longBitsToDouble=function(n){return n};z.isInfinite=function(n){return!Number.isFinite(n)};du.MAX_VALUE.get=function(){return Number.MAX_VALUE};Object.defineProperties(z,du);var ke=function(){},$o=function(){},Ci=function(){};function Ge(){}var d=function n(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)this.x=0,this.y=0,this.z=n.NULL_ORDINATE;else if(arguments.length===1){var t=arguments[0];this.x=t.x,this.y=t.y,this.z=t.z}else arguments.length===2?(this.x=arguments[0],this.y=arguments[1],this.z=n.NULL_ORDINATE):arguments.length===3&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},li$1={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};d.prototype.setOrdinate=function(n,t){switch(n){case d.X:this.x=t;break;case d.Y:this.y=t;break;case d.Z:this.z=t;break;default:throw new ft("Invalid ordinate index: "+n)}};d.prototype.equals2D=function(){if(arguments.length===1){var n=arguments[0];return!(this.x!==n.x||this.y!==n.y)}else if(arguments.length===2){var t=arguments[0],e=arguments[1];return!(!Qr.equalsWithTolerance(this.x,t.x,e)||!Qr.equalsWithTolerance(this.y,t.y,e))}};d.prototype.getOrdinate=function(n){switch(n){case d.X:return this.x;case d.Y:return this.y;case d.Z:return this.z}throw new ft("Invalid ordinate index: "+n)};d.prototype.equals3D=function(n){return this.x===n.x&&this.y===n.y&&(this.z===n.z||z.isNaN(this.z))&&z.isNaN(n.z)};d.prototype.equals=function(n){return n instanceof d?this.equals2D(n):!1};d.prototype.equalInZ=function(n,t){return Qr.equalsWithTolerance(this.z,n.z,t)};d.prototype.compareTo=function(n){var t=n;return this.x<t.x?-1:this.x>t.x?1:this.y<t.y?-1:this.y>t.y?1:0};d.prototype.clone=function(){};d.prototype.copy=function(){return new d(this)};d.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};d.prototype.distance3D=function(n){var t=this.x-n.x,e=this.y-n.y,r=this.z-n.z;return Math.sqrt(t*t+e*e+r*r)};d.prototype.distance=function(n){var t=this.x-n.x,e=this.y-n.y;return Math.sqrt(t*t+e*e)};d.prototype.hashCode=function(){var n=17;return n=37*n+d.hashCode(this.x),n=37*n+d.hashCode(this.y),n};d.prototype.setCoordinate=function(n){this.x=n.x,this.y=n.y,this.z=n.z};d.prototype.interfaces_=function(){return[ke,$o,Ge]};d.prototype.getClass=function(){return d};d.hashCode=function(){if(arguments.length===1){var n=arguments[0],t=z.doubleToLongBits(n);return Math.trunc((t^t)>>>32)}};li$1.DimensionalComparator.get=function(){return sr};li$1.serialVersionUID.get=function(){return 6683108902428367e3};li$1.NULL_ORDINATE.get=function(){return z.NaN};li$1.X.get=function(){return 0};li$1.Y.get=function(){return 1};li$1.Z.get=function(){return 2};Object.defineProperties(d,li$1);var sr=function(n){if(this._dimensionsToTest=2,arguments.length!==0&&arguments.length===1){var t=arguments[0];if(t!==2&&t!==3)throw new ft("only 2 or 3 dimensions may be specified");this._dimensionsToTest=t}};sr.prototype.compare=function(n,t){var e=n,r=t,o=sr.compare(e.x,r.x);if(o!==0)return o;var s=sr.compare(e.y,r.y);if(s!==0)return s;if(this._dimensionsToTest<=2)return 0;var l=sr.compare(e.z,r.z);return l};sr.prototype.interfaces_=function(){return[Ci]};sr.prototype.getClass=function(){return sr};sr.compare=function(n,t){return n<t?-1:n>t?1:z.isNaN(n)?z.isNaN(t)?0:-1:z.isNaN(t)?1:0};var Ni=function(){};Ni.prototype.create=function(){};Ni.prototype.interfaces_=function(){return[]};Ni.prototype.getClass=function(){return Ni};var E=function(){},mo={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};E.prototype.interfaces_=function(){return[]};E.prototype.getClass=function(){return E};E.toLocationSymbol=function(n){switch(n){case E.EXTERIOR:return"e";case E.BOUNDARY:return"b";case E.INTERIOR:return"i";case E.NONE:return"-"}throw new ft("Unknown location value: "+n)};mo.INTERIOR.get=function(){return 0};mo.BOUNDARY.get=function(){return 1};mo.EXTERIOR.get=function(){return 2};mo.NONE.get=function(){return-1};Object.defineProperties(E,mo);var V=function(n,t){return n.interfaces_&&n.interfaces_().indexOf(t)>-1},we=function(){},vu={LOG_10:{configurable:!0}};we.prototype.interfaces_=function(){return[]};we.prototype.getClass=function(){return we};we.log10=function(n){var t=Math.log(n);return z.isInfinite(t)||z.isNaN(t)?t:t/we.LOG_10};we.min=function(n,t,e,r){var o=n;return t<o&&(o=t),e<o&&(o=e),r<o&&(o=r),o};we.clamp=function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],t=arguments[1],e=arguments[2];return n<t?t:n>e?e:n}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var r=arguments[0],o=arguments[1],s=arguments[2];return r<o?o:r>s?s:r}};we.wrap=function(n,t){return n<0?t- -n%t:n%t};we.max=function(){if(arguments.length===3){var n=arguments[0],t=arguments[1],e=arguments[2],r=n;return t>r&&(r=t),e>r&&(r=e),r}else if(arguments.length===4){var o=arguments[0],s=arguments[1],l=arguments[2],a=arguments[3],h=o;return s>h&&(h=s),l>h&&(h=l),a>h&&(h=a),h}};we.average=function(n,t){return(n+t)/2};vu.LOG_10.get=function(){return Math.log(10)};Object.defineProperties(we,vu);var _n=function(n){this.str=n};_n.prototype.append=function(n){this.str+=n};_n.prototype.setCharAt=function(n,t){this.str=this.str.substr(0,n)+t+this.str.substr(n+1)};_n.prototype.toString=function(n){return this.str};var un=function(n){this.value=n};un.prototype.intValue=function(){return this.value};un.prototype.compareTo=function(n){return this.value<n?-1:this.value>n?1:0};un.isNaN=function(n){return Number.isNaN(n)};var ro=function(){};ro.isWhitespace=function(n){return n<=32&&n>=0||n===127};ro.toUpperCase=function(n){return n.toUpperCase()};var I=function n(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof n){var e=arguments[0];this.init(e)}else if(typeof arguments[0]=="string"){var r=arguments[0];n.call(this,n.parse(r))}}else if(arguments.length===2){var o=arguments[0],s=arguments[1];this.init(o,s)}},Ze={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};I.prototype.le=function(n){return(this._hi<n._hi||this._hi===n._hi)&&this._lo<=n._lo};I.prototype.extractSignificantDigits=function(n,t){var e=this.abs(),r=I.magnitude(e._hi),o=I.TEN.pow(r);e=e.divide(o),e.gt(I.TEN)?(e=e.divide(I.TEN),r+=1):e.lt(I.ONE)&&(e=e.multiply(I.TEN),r-=1);for(var s=r+1,l=new _n,a=I.MAX_PRINT_DIGITS-1,h=0;h<=a;h++){n&&h===s&&l.append(".");var y=Math.trunc(e._hi);if(y<0)break;var C=!1,L=0;y>9?(C=!0,L="9"):L="0"+y,l.append(L),e=e.subtract(I.valueOf(y)).multiply(I.TEN),C&&e.selfAdd(I.TEN);var Y=!0,ze=I.magnitude(e._hi);if(ze<0&&Math.abs(ze)>=a-h&&(Y=!1),!Y)break}return t[0]=r,l.toString()};I.prototype.sqr=function(){return this.multiply(this)};I.prototype.doubleValue=function(){return this._hi+this._lo};I.prototype.subtract=function(){if(arguments[0]instanceof I){var n=arguments[0];return this.add(n.negate())}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.add(-t)}};I.prototype.equals=function(){if(arguments.length===1){var n=arguments[0];return this._hi===n._hi&&this._lo===n._lo}};I.prototype.isZero=function(){return this._hi===0&&this._lo===0};I.prototype.selfSubtract=function(){if(arguments[0]instanceof I){var n=arguments[0];return this.isNaN()?this:this.selfAdd(-n._hi,-n._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t,0)}};I.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null};I.prototype.min=function(n){return this.le(n)?this:n};I.prototype.selfDivide=function(){if(arguments.length===1){if(arguments[0]instanceof I){var n=arguments[0];return this.selfDivide(n._hi,n._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.selfDivide(t,0)}}else if(arguments.length===2){var e=arguments[0],r=arguments[1],o=null,s=null,l=null,a=null,h=null,y=null,C=null,L=null;return h=this._hi/e,y=I.SPLIT*h,o=y-h,L=I.SPLIT*e,o=y-o,s=h-o,l=L-e,C=h*e,l=L-l,a=e-l,L=o*l-C+o*a+s*l+s*a,y=(this._hi-C-L+this._lo-h*r)/e,L=h+y,this._hi=L,this._lo=h-L+y,this}};I.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"};I.prototype.divide=function(){if(arguments[0]instanceof I){var n=arguments[0],t=null,e=null,r=null,o=null,s=null,l=null,a=null,h=null;s=this._hi/n._hi,l=I.SPLIT*s,t=l-s,h=I.SPLIT*n._hi,t=l-t,e=s-t,r=h-n._hi,a=s*n._hi,r=h-r,o=n._hi-r,h=t*r-a+t*o+e*r+e*o,l=(this._hi-a-h+this._lo-s*n._lo)/n._hi,h=s+l;var y=h,C=s-h+l;return new I(y,C)}else if(typeof arguments[0]=="number"){var L=arguments[0];return z.isNaN(L)?I.createNaN():I.copy(this).selfDivide(L,0)}};I.prototype.ge=function(n){return(this._hi>n._hi||this._hi===n._hi)&&this._lo>=n._lo};I.prototype.pow=function(n){if(n===0)return I.valueOf(1);var t=new I(this),e=I.valueOf(1),r=Math.abs(n);if(r>1)for(;r>0;)r%2===1&&e.selfMultiply(t),r/=2,r>0&&(t=t.sqr());else e=t;return n<0?e.reciprocal():e};I.prototype.ceil=function(){if(this.isNaN())return I.NaN;var n=Math.ceil(this._hi),t=0;return n===this._hi&&(t=Math.ceil(this._lo)),new I(n,t)};I.prototype.compareTo=function(n){var t=n;return this._hi<t._hi?-1:this._hi>t._hi?1:this._lo<t._lo?-1:this._lo>t._lo?1:0};I.prototype.rint=function(){if(this.isNaN())return this;var n=this.add(.5);return n.floor()};I.prototype.setValue=function(){if(arguments[0]instanceof I){var n=arguments[0];return this.init(n),this}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.init(t),this}};I.prototype.max=function(n){return this.ge(n)?this:n};I.prototype.sqrt=function(){if(this.isZero())return I.valueOf(0);if(this.isNegative())return I.NaN;var n=1/Math.sqrt(this._hi),t=this._hi*n,e=I.valueOf(t),r=this.subtract(e.sqr()),o=r._hi*(n*.5);return e.add(o)};I.prototype.selfAdd=function(){if(arguments.length===1){if(arguments[0]instanceof I){var n=arguments[0];return this.selfAdd(n._hi,n._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0],e=null,r=null,o=null,s=null,l=null,a=null;return o=this._hi+t,l=o-this._hi,s=o-l,s=t-l+(this._hi-s),a=s+this._lo,e=o+a,r=a+(o-e),this._hi=e+r,this._lo=r+(e-this._hi),this}}else if(arguments.length===2){var h=arguments[0],y=arguments[1],C=null,L=null,Y=null,ze=null,Bt=null,Ir=null,Wr=null,yi=null;Bt=this._hi+h,Y=this._lo+y,Wr=Bt-this._hi,yi=Y-this._lo,Ir=Bt-Wr,ze=Y-yi,Ir=h-Wr+(this._hi-Ir),ze=y-yi+(this._lo-ze),Wr=Ir+Y,C=Bt+Wr,L=Wr+(Bt-C),Wr=ze+L;var Bn=C+Wr,vi=Wr+(C-Bn);return this._hi=Bn,this._lo=vi,this}};I.prototype.selfMultiply=function(){if(arguments.length===1){if(arguments[0]instanceof I){var n=arguments[0];return this.selfMultiply(n._hi,n._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.selfMultiply(t,0)}}else if(arguments.length===2){var e=arguments[0],r=arguments[1],o=null,s=null,l=null,a=null,h=null,y=null;h=I.SPLIT*this._hi,o=h-this._hi,y=I.SPLIT*e,o=h-o,s=this._hi-o,l=y-e,h=this._hi*e,l=y-l,a=e-l,y=o*l-h+o*a+s*l+s*a+(this._hi*r+this._lo*e);var C=h+y;o=h-C;var L=y+o;return this._hi=C,this._lo=L,this}};I.prototype.selfSqr=function(){return this.selfMultiply(this)};I.prototype.floor=function(){if(this.isNaN())return I.NaN;var n=Math.floor(this._hi),t=0;return n===this._hi&&(t=Math.floor(this._lo)),new I(n,t)};I.prototype.negate=function(){return this.isNaN()?this:new I(-this._hi,-this._lo)};I.prototype.clone=function(){};I.prototype.multiply=function(){if(arguments[0]instanceof I){var n=arguments[0];return n.isNaN()?I.createNaN():I.copy(this).selfMultiply(n)}else if(typeof arguments[0]=="number"){var t=arguments[0];return z.isNaN(t)?I.createNaN():I.copy(this).selfMultiply(t,0)}};I.prototype.isNaN=function(){return z.isNaN(this._hi)};I.prototype.intValue=function(){return Math.trunc(this._hi)};I.prototype.toString=function(){var n=I.magnitude(this._hi);return n>=-3&&n<=20?this.toStandardNotation():this.toSciNotation()};I.prototype.toStandardNotation=function(){var n=this.getSpecialNumberString();if(n!==null)return n;var t=new Array(1).fill(null),e=this.extractSignificantDigits(!0,t),r=t[0]+1,o=e;if(e.charAt(0)===".")o="0"+e;else if(r<0)o="0."+I.stringOfChar("0",-r)+e;else if(e.indexOf(".")===-1){var s=r-e.length,l=I.stringOfChar("0",s);o=e+l+".0"}return this.isNegative()?"-"+o:o};I.prototype.reciprocal=function(){var n=null,t=null,e=null,r=null,o=null,s=null,l=null,a=null;o=1/this._hi,s=I.SPLIT*o,n=s-o,a=I.SPLIT*this._hi,n=s-n,t=o-n,e=a-this._hi,l=o*this._hi,e=a-e,r=this._hi-e,a=n*e-l+n*r+t*e+t*r,s=(1-l-a-o*this._lo)/this._hi;var h=o+s,y=o-h+s;return new I(h,y)};I.prototype.toSciNotation=function(){if(this.isZero())return I.SCI_NOT_ZERO;var n=this.getSpecialNumberString();if(n!==null)return n;var t=new Array(1).fill(null),e=this.extractSignificantDigits(!1,t),r=I.SCI_NOT_EXPONENT_CHAR+t[0];if(e.charAt(0)==="0")throw new Error("Found leading zero: "+e);var o="";e.length>1&&(o=e.substring(1));var s=e.charAt(0)+"."+o;return this.isNegative()?"-"+s+r:s+r};I.prototype.abs=function(){return this.isNaN()?I.NaN:this.isNegative()?this.negate():new I(this)};I.prototype.isPositive=function(){return(this._hi>0||this._hi===0)&&this._lo>0};I.prototype.lt=function(n){return(this._hi<n._hi||this._hi===n._hi)&&this._lo<n._lo};I.prototype.add=function(){if(arguments[0]instanceof I){var n=arguments[0];return I.copy(this).selfAdd(n)}else if(typeof arguments[0]=="number"){var t=arguments[0];return I.copy(this).selfAdd(t)}};I.prototype.init=function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var n=arguments[0];this._hi=n,this._lo=0}else if(arguments[0]instanceof I){var t=arguments[0];this._hi=t._hi,this._lo=t._lo}}else if(arguments.length===2){var e=arguments[0],r=arguments[1];this._hi=e,this._lo=r}};I.prototype.gt=function(n){return(this._hi>n._hi||this._hi===n._hi)&&this._lo>n._lo};I.prototype.isNegative=function(){return(this._hi<0||this._hi===0)&&this._lo<0};I.prototype.trunc=function(){return this.isNaN()?I.NaN:this.isPositive()?this.floor():this.ceil()};I.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0};I.prototype.interfaces_=function(){return[Ge,ke,$o]};I.prototype.getClass=function(){return I};I.sqr=function(n){return I.valueOf(n).selfMultiply(n)};I.valueOf=function(){if(typeof arguments[0]=="string"){var n=arguments[0];return I.parse(n)}else if(typeof arguments[0]=="number"){var t=arguments[0];return new I(t)}};I.sqrt=function(n){return I.valueOf(n).sqrt()};I.parse=function(n){for(var t=0,e=n.length;ro.isWhitespace(n.charAt(t));)t++;var r=!1;if(t<e){var o=n.charAt(t);(o==="-"||o==="+")&&(t++,o==="-"&&(r=!0))}for(var s=new I,l=0,a=0,h=0;!(t>=e);){var y=n.charAt(t);if(t++,ro.isDigit(y)){var C=y-"0";s.selfMultiply(I.TEN),s.selfAdd(C),l++;continue}if(y==="."){a=l;continue}if(y==="e"||y==="E"){var L=n.substring(t);try{h=un.parseInt(L)}catch(Wr){throw Wr instanceof Error?new Error("Invalid exponent "+L+" in string "+n):Wr}finally{}break}throw new Error("Unexpected character '"+y+"' at position "+t+" in string "+n)}var Y=s,ze=l-a-h;if(ze===0)Y=s;else if(ze>0){var Bt=I.TEN.pow(ze);Y=s.divide(Bt)}else if(ze<0){var Ir=I.TEN.pow(-ze);Y=s.multiply(Ir)}return r?Y.negate():Y};I.createNaN=function(){return new I(z.NaN,z.NaN)};I.copy=function(n){return new I(n)};I.magnitude=function(n){var t=Math.abs(n),e=Math.log(t)/Math.log(10),r=Math.trunc(Math.floor(e)),o=Math.pow(10,r);return o*10<=t&&(r+=1),r};I.stringOfChar=function(n,t){for(var e=new _n,r=0;r<t;r++)e.append(n);return e.toString()};Ze.PI.get=function(){return new I(3.141592653589793,12246467991473532e-32)};Ze.TWO_PI.get=function(){return new I(6.283185307179586,24492935982947064e-32)};Ze.PI_2.get=function(){return new I(1.5707963267948966,6123233995736766e-32)};Ze.E.get=function(){return new I(2.718281828459045,14456468917292502e-32)};Ze.NaN.get=function(){return new I(z.NaN,z.NaN)};Ze.EPS.get=function(){return 123259516440783e-46};Ze.SPLIT.get=function(){return 134217729};Ze.MAX_PRINT_DIGITS.get=function(){return 32};Ze.TEN.get=function(){return I.valueOf(10)};Ze.ONE.get=function(){return I.valueOf(1)};Ze.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"};Ze.SCI_NOT_ZERO.get=function(){return"0.0E0"};Object.defineProperties(I,Ze);var ce=function(){},yu={DP_SAFE_EPSILON:{configurable:!0}};ce.prototype.interfaces_=function(){return[]};ce.prototype.getClass=function(){return ce};ce.orientationIndex=function(n,t,e){var r=ce.orientationIndexFilter(n,t,e);if(r<=1)return r;var o=I.valueOf(t.x).selfAdd(-n.x),s=I.valueOf(t.y).selfAdd(-n.y),l=I.valueOf(e.x).selfAdd(-t.x),a=I.valueOf(e.y).selfAdd(-t.y);return o.selfMultiply(a).selfSubtract(s.selfMultiply(l)).signum()};ce.signOfDet2x2=function(n,t,e,r){var o=n.multiply(r).selfSubtract(t.multiply(e));return o.signum()};ce.intersection=function(n,t,e,r){var o=I.valueOf(r.y).selfSubtract(e.y).selfMultiply(I.valueOf(t.x).selfSubtract(n.x)),s=I.valueOf(r.x).selfSubtract(e.x).selfMultiply(I.valueOf(t.y).selfSubtract(n.y)),l=o.subtract(s),a=I.valueOf(r.x).selfSubtract(e.x).selfMultiply(I.valueOf(n.y).selfSubtract(e.y)),h=I.valueOf(r.y).selfSubtract(e.y).selfMultiply(I.valueOf(n.x).selfSubtract(e.x)),y=a.subtract(h),C=y.selfDivide(l).doubleValue(),L=I.valueOf(n.x).selfAdd(I.valueOf(t.x).selfSubtract(n.x).selfMultiply(C)).doubleValue(),Y=I.valueOf(t.x).selfSubtract(n.x).selfMultiply(I.valueOf(n.y).selfSubtract(e.y)),ze=I.valueOf(t.y).selfSubtract(n.y).selfMultiply(I.valueOf(n.x).selfSubtract(e.x)),Bt=Y.subtract(ze),Ir=Bt.selfDivide(l).doubleValue(),Wr=I.valueOf(e.y).selfAdd(I.valueOf(r.y).selfSubtract(e.y).selfMultiply(Ir)).doubleValue();return new d(L,Wr)};ce.orientationIndexFilter=function(n,t,e){var r=null,o=(n.x-e.x)*(t.y-e.y),s=(n.y-e.y)*(t.x-e.x),l=o-s;if(o>0){if(s<=0)return ce.signum(l);r=o+s}else if(o<0){if(s>=0)return ce.signum(l);r=-o-s}else return ce.signum(l);var a=ce.DP_SAFE_EPSILON*r;return l>=a||-l>=a?ce.signum(l):2};ce.signum=function(n){return n>0?1:n<0?-1:0};yu.DP_SAFE_EPSILON.get=function(){return 1e-15};Object.defineProperties(ce,yu);var Q=function(){},_o={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};_o.X.get=function(){return 0};_o.Y.get=function(){return 1};_o.Z.get=function(){return 2};_o.M.get=function(){return 3};Q.prototype.setOrdinate=function(n,t,e){};Q.prototype.size=function(){};Q.prototype.getOrdinate=function(n,t){};Q.prototype.getCoordinate=function(){};Q.prototype.getCoordinateCopy=function(n){};Q.prototype.getDimension=function(){};Q.prototype.getX=function(n){};Q.prototype.clone=function(){};Q.prototype.expandEnvelope=function(n){};Q.prototype.copy=function(){};Q.prototype.getY=function(n){};Q.prototype.toCoordinateArray=function(){};Q.prototype.interfaces_=function(){return[$o]};Q.prototype.getClass=function(){return Q};Object.defineProperties(Q,_o);var mu=function(){},qi=function(n){function t(){n.call(this,"Projective point not representable on the Cartesian plane.")}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(mu),qt=function(){};qt.arraycopy=function(n,t,e,r,o){for(var s=0,l=t;l<t+o;l++)e[r+s]=n[l],s++};qt.getProperty=function(n){return{"line.separator":`
`}[n]};var Ue=function n(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],r=arguments[1];this.x=e,this.y=r,this.w=1}else if(arguments[0]instanceof n&&arguments[1]instanceof n){var o=arguments[0],s=arguments[1];this.x=o.y*s.w-s.y*o.w,this.y=s.x*o.w-o.x*s.w,this.w=o.x*s.y-s.x*o.y}else if(arguments[0]instanceof d&&arguments[1]instanceof d){var l=arguments[0],a=arguments[1];this.x=l.y-a.y,this.y=a.x-l.x,this.w=l.x*a.y-a.x*l.y}}else if(arguments.length===3){var h=arguments[0],y=arguments[1],C=arguments[2];this.x=h,this.y=y,this.w=C}else if(arguments.length===4){var L=arguments[0],Y=arguments[1],ze=arguments[2],Bt=arguments[3],Ir=L.y-Y.y,Wr=Y.x-L.x,yi=L.x*Y.y-Y.x*L.y,Bn=ze.y-Bt.y,vi=Bt.x-ze.x,wo=ze.x*Bt.y-Bt.x*ze.y;this.x=Wr*wo-vi*yi,this.y=Bn*yi-Ir*wo,this.w=Ir*vi-Bn*Wr}};Ue.prototype.getY=function(){var n=this.y/this.w;if(z.isNaN(n)||z.isInfinite(n))throw new qi;return n};Ue.prototype.getX=function(){var n=this.x/this.w;if(z.isNaN(n)||z.isInfinite(n))throw new qi;return n};Ue.prototype.getCoordinate=function(){var n=new d;return n.x=this.getX(),n.y=this.getY(),n};Ue.prototype.interfaces_=function(){return[]};Ue.prototype.getClass=function(){return Ue};Ue.intersection=function(n,t,e,r){var o=n.y-t.y,s=t.x-n.x,l=n.x*t.y-t.x*n.y,a=e.y-r.y,h=r.x-e.x,y=e.x*r.y-r.x*e.y,C=s*y-h*l,L=a*l-o*y,Y=o*h-a*s,ze=C/Y,Bt=L/Y;if(z.isNaN(ze)||z.isInfinite(ze)||z.isNaN(Bt)||z.isInfinite(Bt))throw new qi;return new d(ze,Bt)};var B=function n(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof d){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof n){var e=arguments[0];this.init(e)}}else if(arguments.length===2){var r=arguments[0],o=arguments[1];this.init(r.x,o.x,r.y,o.y)}else if(arguments.length===4){var s=arguments[0],l=arguments[1],a=arguments[2],h=arguments[3];this.init(s,l,a,h)}},_u={serialVersionUID:{configurable:!0}};B.prototype.getArea=function(){return this.getWidth()*this.getHeight()};B.prototype.equals=function(n){if(!(n instanceof B))return!1;var t=n;return this.isNull()?t.isNull():this._maxx===t.getMaxX()&&this._maxy===t.getMaxY()&&this._minx===t.getMinX()&&this._miny===t.getMinY()};B.prototype.intersection=function(n){if(this.isNull()||n.isNull()||!this.intersects(n))return new B;var t=this._minx>n._minx?this._minx:n._minx,e=this._miny>n._miny?this._miny:n._miny,r=this._maxx<n._maxx?this._maxx:n._maxx,o=this._maxy<n._maxy?this._maxy:n._maxy;return new B(t,r,e,o)};B.prototype.isNull=function(){return this._maxx<this._minx};B.prototype.getMaxX=function(){return this._maxx};B.prototype.covers=function(){if(arguments.length===1){if(arguments[0]instanceof d){var n=arguments[0];return this.covers(n.x,n.y)}else if(arguments[0]instanceof B){var t=arguments[0];return this.isNull()||t.isNull()?!1:t.getMinX()>=this._minx&&t.getMaxX()<=this._maxx&&t.getMinY()>=this._miny&&t.getMaxY()<=this._maxy}}else if(arguments.length===2){var e=arguments[0],r=arguments[1];return this.isNull()?!1:e>=this._minx&&e<=this._maxx&&r>=this._miny&&r<=this._maxy}};B.prototype.intersects=function(){if(arguments.length===1){if(arguments[0]instanceof B){var n=arguments[0];return this.isNull()||n.isNull()?!1:!(n._minx>this._maxx||n._maxx<this._minx||n._miny>this._maxy||n._maxy<this._miny)}else if(arguments[0]instanceof d){var t=arguments[0];return this.intersects(t.x,t.y)}}else if(arguments.length===2){var e=arguments[0],r=arguments[1];return this.isNull()?!1:!(e>this._maxx||e<this._minx||r>this._maxy||r<this._miny)}};B.prototype.getMinY=function(){return this._miny};B.prototype.getMinX=function(){return this._minx};B.prototype.expandToInclude=function(){if(arguments.length===1){if(arguments[0]instanceof d){var n=arguments[0];this.expandToInclude(n.x,n.y)}else if(arguments[0]instanceof B){var t=arguments[0];if(t.isNull())return null;this.isNull()?(this._minx=t.getMinX(),this._maxx=t.getMaxX(),this._miny=t.getMinY(),this._maxy=t.getMaxY()):(t._minx<this._minx&&(this._minx=t._minx),t._maxx>this._maxx&&(this._maxx=t._maxx),t._miny<this._miny&&(this._miny=t._miny),t._maxy>this._maxy&&(this._maxy=t._maxy))}}else if(arguments.length===2){var e=arguments[0],r=arguments[1];this.isNull()?(this._minx=e,this._maxx=e,this._miny=r,this._maxy=r):(e<this._minx&&(this._minx=e),e>this._maxx&&(this._maxx=e),r<this._miny&&(this._miny=r),r>this._maxy&&(this._maxy=r))}};B.prototype.minExtent=function(){if(this.isNull())return 0;var n=this.getWidth(),t=this.getHeight();return n<t?n:t};B.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx};B.prototype.compareTo=function(n){var t=n;return this.isNull()?t.isNull()?0:-1:t.isNull()?1:this._minx<t._minx?-1:this._minx>t._minx?1:this._miny<t._miny?-1:this._miny>t._miny?1:this._maxx<t._maxx?-1:this._maxx>t._maxx?1:this._maxy<t._maxy?-1:this._maxy>t._maxy?1:0};B.prototype.translate=function(n,t){if(this.isNull())return null;this.init(this.getMinX()+n,this.getMaxX()+n,this.getMinY()+t,this.getMaxY()+t)};B.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"};B.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1};B.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny};B.prototype.maxExtent=function(){if(this.isNull())return 0;var n=this.getWidth(),t=this.getHeight();return n>t?n:t};B.prototype.expandBy=function(){if(arguments.length===1){var n=arguments[0];this.expandBy(n,n)}else if(arguments.length===2){var t=arguments[0],e=arguments[1];if(this.isNull())return null;this._minx-=t,this._maxx+=t,this._miny-=e,this._maxy+=e,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}};B.prototype.contains=function(){if(arguments.length===1){if(arguments[0]instanceof B){var n=arguments[0];return this.covers(n)}else if(arguments[0]instanceof d){var t=arguments[0];return this.covers(t)}}else if(arguments.length===2){var e=arguments[0],r=arguments[1];return this.covers(e,r)}};B.prototype.centre=function(){return this.isNull()?null:new d((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)};B.prototype.init=function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof d){var n=arguments[0];this.init(n.x,n.x,n.y,n.y)}else if(arguments[0]instanceof B){var t=arguments[0];this._minx=t._minx,this._maxx=t._maxx,this._miny=t._miny,this._maxy=t._maxy}}else if(arguments.length===2){var e=arguments[0],r=arguments[1];this.init(e.x,r.x,e.y,r.y)}else if(arguments.length===4){var o=arguments[0],s=arguments[1],l=arguments[2],a=arguments[3];o<s?(this._minx=o,this._maxx=s):(this._minx=s,this._maxx=o),l<a?(this._miny=l,this._maxy=a):(this._miny=a,this._maxy=l)}};B.prototype.getMaxY=function(){return this._maxy};B.prototype.distance=function(n){if(this.intersects(n))return 0;var t=0;this._maxx<n._minx?t=n._minx-this._maxx:this._minx>n._maxx&&(t=this._minx-n._maxx);var e=0;return this._maxy<n._miny?e=n._miny-this._maxy:this._miny>n._maxy&&(e=this._miny-n._maxy),t===0?e:e===0?t:Math.sqrt(t*t+e*e)};B.prototype.hashCode=function(){var n=17;return n=37*n+d.hashCode(this._minx),n=37*n+d.hashCode(this._maxx),n=37*n+d.hashCode(this._miny),n=37*n+d.hashCode(this._maxy),n};B.prototype.interfaces_=function(){return[ke,Ge]};B.prototype.getClass=function(){return B};B.intersects=function(){if(arguments.length===3){var n=arguments[0],t=arguments[1],e=arguments[2];return e.x>=(n.x<t.x?n.x:t.x)&&e.x<=(n.x>t.x?n.x:t.x)&&e.y>=(n.y<t.y?n.y:t.y)&&e.y<=(n.y>t.y?n.y:t.y)}else if(arguments.length===4){var r=arguments[0],o=arguments[1],s=arguments[2],l=arguments[3],a=Math.min(s.x,l.x),h=Math.max(s.x,l.x),y=Math.min(r.x,o.x),C=Math.max(r.x,o.x);return!(y>h||C<a||(a=Math.min(s.y,l.y),h=Math.max(s.y,l.y),y=Math.min(r.y,o.y),C=Math.max(r.y,o.y),y>h)||C<a)}};_u.serialVersionUID.get=function(){return 5873921885273102e3};Object.defineProperties(B,_u);var $e={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},ts=function(n){this.geometryFactory=n||new H};ts.prototype.read=function(n){var t,e,r;n=n.replace(/[\n\r]/g," ");var o=$e.typeStr.exec(n);if(n.search("EMPTY")!==-1&&(o=$e.emptyTypeStr.exec(n),o[2]=void 0),o&&(e=o[1].toLowerCase(),r=o[2],Ei[e]&&(t=Ei[e].apply(this,[r]))),t===void 0)throw new Error("Could not parse WKT "+n);return t};ts.prototype.write=function(n){return this.extractGeometry(n)};ts.prototype.extractGeometry=function(n){var t=n.getGeometryType().toLowerCase();if(!qn[t])return null;var e=t.toUpperCase(),r;return n.isEmpty()?r=e+" EMPTY":r=e+"("+qn[t].apply(this,[n])+")",r};var qn={coordinate:function(n){return n.x+" "+n.y},point:function(n){return qn.coordinate.call(this,n._coordinates._coordinates[0])},multipoint:function(n){for(var t=this,e=[],r=0,o=n._geometries.length;r<o;++r)e.push("("+qn.point.apply(t,[n._geometries[r]])+")");return e.join(",")},linestring:function(n){for(var t=this,e=[],r=0,o=n._points._coordinates.length;r<o;++r)e.push(qn.coordinate.apply(t,[n._points._coordinates[r]]));return e.join(",")},linearring:function(n){for(var t=this,e=[],r=0,o=n._points._coordinates.length;r<o;++r)e.push(qn.coordinate.apply(t,[n._points._coordinates[r]]));return e.join(",")},multilinestring:function(n){for(var t=this,e=[],r=0,o=n._geometries.length;r<o;++r)e.push("("+qn.linestring.apply(t,[n._geometries[r]])+")");return e.join(",")},polygon:function(n){var t=this,e=[];e.push("("+qn.linestring.apply(this,[n._shell])+")");for(var r=0,o=n._holes.length;r<o;++r)e.push("("+qn.linestring.apply(t,[n._holes[r]])+")");return e.join(",")},multipolygon:function(n){for(var t=this,e=[],r=0,o=n._geometries.length;r<o;++r)e.push("("+qn.polygon.apply(t,[n._geometries[r]])+")");return e.join(",")},geometrycollection:function(n){for(var t=this,e=[],r=0,o=n._geometries.length;r<o;++r)e.push(t.extractGeometry(n._geometries[r]));return e.join(",")}},Ei={point:function(n){if(n===void 0)return this.geometryFactory.createPoint();var t=n.trim().split($e.spaces);return this.geometryFactory.createPoint(new d(Number.parseFloat(t[0]),Number.parseFloat(t[1])))},multipoint:function(n){var t=this;if(n===void 0)return this.geometryFactory.createMultiPoint();for(var e,r=n.trim().split(","),o=[],s=0,l=r.length;s<l;++s)e=r[s].replace($e.trimParens,"$1"),o.push(Ei.point.apply(t,[e]));return this.geometryFactory.createMultiPoint(o)},linestring:function(n){if(n===void 0)return this.geometryFactory.createLineString();for(var t=n.trim().split(","),e=[],r,o=0,s=t.length;o<s;++o)r=t[o].trim().split($e.spaces),e.push(new d(Number.parseFloat(r[0]),Number.parseFloat(r[1])));return this.geometryFactory.createLineString(e)},linearring:function(n){if(n===void 0)return this.geometryFactory.createLinearRing();for(var t=n.trim().split(","),e=[],r,o=0,s=t.length;o<s;++o)r=t[o].trim().split($e.spaces),e.push(new d(Number.parseFloat(r[0]),Number.parseFloat(r[1])));return this.geometryFactory.createLinearRing(e)},multilinestring:function(n){var t=this;if(n===void 0)return this.geometryFactory.createMultiLineString();for(var e,r=n.trim().split($e.parenComma),o=[],s=0,l=r.length;s<l;++s)e=r[s].replace($e.trimParens,"$1"),o.push(Ei.linestring.apply(t,[e]));return this.geometryFactory.createMultiLineString(o)},polygon:function(n){var t=this;if(n===void 0)return this.geometryFactory.createPolygon();for(var e,r,o,s=n.trim().split($e.parenComma),l,a=[],h=0,y=s.length;h<y;++h)e=s[h].replace($e.trimParens,"$1"),r=Ei.linestring.apply(t,[e]),o=t.geometryFactory.createLinearRing(r._points),h===0?l=o:a.push(o);return this.geometryFactory.createPolygon(l,a)},multipolygon:function(n){var t=this;if(n===void 0)return this.geometryFactory.createMultiPolygon();for(var e,r=n.trim().split($e.doubleParenComma),o=[],s=0,l=r.length;s<l;++s)e=r[s].replace($e.trimParens,"$1"),o.push(Ei.polygon.apply(t,[e]));return this.geometryFactory.createMultiPolygon(o)},geometrycollection:function(n){var t=this;if(n===void 0)return this.geometryFactory.createGeometryCollection();n=n.replace(/,\s*([A-Za-z])/g,"|$1");for(var e=n.trim().split("|"),r=[],o=0,s=e.length;o<s;++o)r.push(t.read(e[o]));return this.geometryFactory.createGeometryCollection(r)}},Xe=function(n){this.parser=new ts(n)};Xe.prototype.write=function(n){return this.parser.write(n)};Xe.toLineString=function(n,t){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+n.x+" "+n.y+", "+t.x+" "+t.y+" )"};var Qn=function(n){function t(e){n.call(this,e),this.name="RuntimeException",this.message=e,this.stack=new n().stack}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t}(Error),Uo=function(n){function t(){if(n.call(this),arguments.length===0)n.call(this);else if(arguments.length===1){var e=arguments[0];n.call(this,e)}}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Qn),q=function(){};q.prototype.interfaces_=function(){return[]};q.prototype.getClass=function(){return q};q.shouldNeverReachHere=function(){if(arguments.length===0)q.shouldNeverReachHere(null);else if(arguments.length===1){var n=arguments[0];throw new Uo("Should never reach here"+(n!==null?": "+n:""))}};q.isTrue=function(){var n,t;if(arguments.length===1)n=arguments[0],q.isTrue(n,null);else if(arguments.length===2&&(n=arguments[0],t=arguments[1],!n))throw t===null?new Uo:new Uo(t)};q.equals=function(){var n,t,e;if(arguments.length===2)n=arguments[0],t=arguments[1],q.equals(n,t,null);else if(arguments.length===3&&(n=arguments[0],t=arguments[1],e=arguments[2],!t.equals(n)))throw new Uo("Expected "+n+" but encountered "+t+(e!==null?": "+e:""))};var gt=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new d,this._intPt[1]=new d,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},ci={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};gt.prototype.getIndexAlongSegment=function(n,t){return this.computeIntLineIndex(),this._intLineIndex[n][t]};gt.prototype.getTopologySummary=function(){var n=new _n;return this.isEndPoint()&&n.append(" endpoint"),this._isProper&&n.append(" proper"),this.isCollinear()&&n.append(" collinear"),n.toString()};gt.prototype.computeIntersection=function(n,t,e,r){this._inputLines[0][0]=n,this._inputLines[0][1]=t,this._inputLines[1][0]=e,this._inputLines[1][1]=r,this._result=this.computeIntersect(n,t,e,r)};gt.prototype.getIntersectionNum=function(){return this._result};gt.prototype.computeIntLineIndex=function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var n=arguments[0],t=this.getEdgeDistance(n,0),e=this.getEdgeDistance(n,1);t>e?(this._intLineIndex[n][0]=0,this._intLineIndex[n][1]=1):(this._intLineIndex[n][0]=1,this._intLineIndex[n][1]=0)}};gt.prototype.isProper=function(){return this.hasIntersection()&&this._isProper};gt.prototype.setPrecisionModel=function(n){this._precisionModel=n};gt.prototype.isInteriorIntersection=function(){var n=this;if(arguments.length===0)return!!(this.isInteriorIntersection(0)||this.isInteriorIntersection(1));if(arguments.length===1){for(var t=arguments[0],e=0;e<this._result;e++)if(!(n._intPt[e].equals2D(n._inputLines[t][0])||n._intPt[e].equals2D(n._inputLines[t][1])))return!0;return!1}};gt.prototype.getIntersection=function(n){return this._intPt[n]};gt.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper};gt.prototype.hasIntersection=function(){return this._result!==gt.NO_INTERSECTION};gt.prototype.getEdgeDistance=function(n,t){var e=gt.computeEdgeDistance(this._intPt[t],this._inputLines[n][0],this._inputLines[n][1]);return e};gt.prototype.isCollinear=function(){return this._result===gt.COLLINEAR_INTERSECTION};gt.prototype.toString=function(){return Xe.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Xe.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()};gt.prototype.getEndpoint=function(n,t){return this._inputLines[n][t]};gt.prototype.isIntersection=function(n){for(var t=this,e=0;e<this._result;e++)if(t._intPt[e].equals2D(n))return!0;return!1};gt.prototype.getIntersectionAlongSegment=function(n,t){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[n][t]]};gt.prototype.interfaces_=function(){return[]};gt.prototype.getClass=function(){return gt};gt.computeEdgeDistance=function(n,t,e){var r=Math.abs(e.x-t.x),o=Math.abs(e.y-t.y),s=-1;if(n.equals(t))s=0;else if(n.equals(e))r>o?s=r:s=o;else{var l=Math.abs(n.x-t.x),a=Math.abs(n.y-t.y);r>o?s=l:s=a,s===0&&!n.equals(t)&&(s=Math.max(l,a))}return q.isTrue(!(s===0&&!n.equals(t)),"Bad distance calculation"),s};gt.nonRobustComputeEdgeDistance=function(n,t,e){var r=n.x-t.x,o=n.y-t.y,s=Math.sqrt(r*r+o*o);return q.isTrue(!(s===0&&!n.equals(t)),"Invalid distance calculation"),s};ci.DONT_INTERSECT.get=function(){return 0};ci.DO_INTERSECT.get=function(){return 1};ci.COLLINEAR.get=function(){return 2};ci.NO_INTERSECTION.get=function(){return 0};ci.POINT_INTERSECTION.get=function(){return 1};ci.COLLINEAR_INTERSECTION.get=function(){return 2};Object.defineProperties(gt,ci);var Xr=function(n){function t(){n.apply(this,arguments)}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.isInSegmentEnvelopes=function(e){var r=new B(this._inputLines[0][0],this._inputLines[0][1]),o=new B(this._inputLines[1][0],this._inputLines[1][1]);return r.contains(e)&&o.contains(e)},t.prototype.computeIntersection=function(){if(arguments.length===3){var e=arguments[0],r=arguments[1],o=arguments[2];if(this._isProper=!1,B.intersects(r,o,e)&&M.orientationIndex(r,o,e)===0&&M.orientationIndex(o,r,e)===0)return this._isProper=!0,(e.equals(r)||e.equals(o))&&(this._isProper=!1),this._result=n.POINT_INTERSECTION,null;this._result=n.NO_INTERSECTION}else return n.prototype.computeIntersection.apply(this,arguments)},t.prototype.normalizeToMinimum=function(e,r,o,s,l){l.x=this.smallestInAbsValue(e.x,r.x,o.x,s.x),l.y=this.smallestInAbsValue(e.y,r.y,o.y,s.y),e.x-=l.x,e.y-=l.y,r.x-=l.x,r.y-=l.y,o.x-=l.x,o.y-=l.y,s.x-=l.x,s.y-=l.y},t.prototype.safeHCoordinateIntersection=function(e,r,o,s){var l=null;try{l=Ue.intersection(e,r,o,s)}catch(a){if(a instanceof qi)l=t.nearestEndpoint(e,r,o,s);else throw a}finally{}return l},t.prototype.intersection=function(e,r,o,s){var l=this.intersectionWithNormalization(e,r,o,s);return this.isInSegmentEnvelopes(l)||(l=new d(t.nearestEndpoint(e,r,o,s))),this._precisionModel!==null&&this._precisionModel.makePrecise(l),l},t.prototype.smallestInAbsValue=function(e,r,o,s){var l=e,a=Math.abs(l);return Math.abs(r)<a&&(l=r,a=Math.abs(r)),Math.abs(o)<a&&(l=o,a=Math.abs(o)),Math.abs(s)<a&&(l=s),l},t.prototype.checkDD=function(e,r,o,s,l){var a=ce.intersection(e,r,o,s),h=this.isInSegmentEnvelopes(a);qt.out.println("DD in env = "+h+"  --------------------- "+a),l.distance(a)>1e-4&&qt.out.println("Distance = "+l.distance(a))},t.prototype.intersectionWithNormalization=function(e,r,o,s){var l=new d(e),a=new d(r),h=new d(o),y=new d(s),C=new d;this.normalizeToEnvCentre(l,a,h,y,C);var L=this.safeHCoordinateIntersection(l,a,h,y);return L.x+=C.x,L.y+=C.y,L},t.prototype.computeCollinearIntersection=function(e,r,o,s){var l=B.intersects(e,r,o),a=B.intersects(e,r,s),h=B.intersects(o,s,e),y=B.intersects(o,s,r);return l&&a?(this._intPt[0]=o,this._intPt[1]=s,n.COLLINEAR_INTERSECTION):h&&y?(this._intPt[0]=e,this._intPt[1]=r,n.COLLINEAR_INTERSECTION):l&&h?(this._intPt[0]=o,this._intPt[1]=e,o.equals(e)&&!a&&!y?n.POINT_INTERSECTION:n.COLLINEAR_INTERSECTION):l&&y?(this._intPt[0]=o,this._intPt[1]=r,o.equals(r)&&!a&&!h?n.POINT_INTERSECTION:n.COLLINEAR_INTERSECTION):a&&h?(this._intPt[0]=s,this._intPt[1]=e,s.equals(e)&&!l&&!y?n.POINT_INTERSECTION:n.COLLINEAR_INTERSECTION):a&&y?(this._intPt[0]=s,this._intPt[1]=r,s.equals(r)&&!l&&!h?n.POINT_INTERSECTION:n.COLLINEAR_INTERSECTION):n.NO_INTERSECTION},t.prototype.normalizeToEnvCentre=function(e,r,o,s,l){var a=e.x<r.x?e.x:r.x,h=e.y<r.y?e.y:r.y,y=e.x>r.x?e.x:r.x,C=e.y>r.y?e.y:r.y,L=o.x<s.x?o.x:s.x,Y=o.y<s.y?o.y:s.y,ze=o.x>s.x?o.x:s.x,Bt=o.y>s.y?o.y:s.y,Ir=a>L?a:L,Wr=y<ze?y:ze,yi=h>Y?h:Y,Bn=C<Bt?C:Bt,vi=(Ir+Wr)/2,wo=(yi+Bn)/2;l.x=vi,l.y=wo,e.x-=l.x,e.y-=l.y,r.x-=l.x,r.y-=l.y,o.x-=l.x,o.y-=l.y,s.x-=l.x,s.y-=l.y},t.prototype.computeIntersect=function(e,r,o,s){if(this._isProper=!1,!B.intersects(e,r,o,s))return n.NO_INTERSECTION;var l=M.orientationIndex(e,r,o),a=M.orientationIndex(e,r,s);if(l>0&&a>0||l<0&&a<0)return n.NO_INTERSECTION;var h=M.orientationIndex(o,s,e),y=M.orientationIndex(o,s,r);if(h>0&&y>0||h<0&&y<0)return n.NO_INTERSECTION;var C=l===0&&a===0&&h===0&&y===0;return C?this.computeCollinearIntersection(e,r,o,s):(l===0||a===0||h===0||y===0?(this._isProper=!1,e.equals2D(o)||e.equals2D(s)?this._intPt[0]=e:r.equals2D(o)||r.equals2D(s)?this._intPt[0]=r:l===0?this._intPt[0]=new d(o):a===0?this._intPt[0]=new d(s):h===0?this._intPt[0]=new d(e):y===0&&(this._intPt[0]=new d(r))):(this._isProper=!0,this._intPt[0]=this.intersection(e,r,o,s)),n.POINT_INTERSECTION)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.nearestEndpoint=function(e,r,o,s){var l=e,a=M.distancePointLine(e,o,s),h=M.distancePointLine(r,o,s);return h<a&&(a=h,l=r),h=M.distancePointLine(o,e,r),h<a&&(a=h,l=o),h=M.distancePointLine(s,e,r),h<a&&(a=h,l=s),l},t}(gt),Zr=function(){};Zr.prototype.interfaces_=function(){return[]};Zr.prototype.getClass=function(){return Zr};Zr.orientationIndex=function(n,t,e){var r=t.x-n.x,o=t.y-n.y,s=e.x-t.x,l=e.y-t.y;return Zr.signOfDet2x2(r,o,s,l)};Zr.signOfDet2x2=function(n,t,e,r){var o=null,s=null,l=null;if(o=1,n===0||r===0)return t===0||e===0?0:t>0?e>0?-o:o:e>0?o:-o;if(t===0||e===0)return r>0?n>0?o:-o:n>0?-o:o;if(t>0?r>0?t<=r||(o=-o,s=n,n=e,e=s,s=t,t=r,r=s):t<=-r?(o=-o,e=-e,r=-r):(s=n,n=-e,e=s,s=t,t=-r,r=s):r>0?-t<=r?(o=-o,n=-n,t=-t):(s=-n,n=e,e=s,s=-t,t=r,r=s):t>=r?(n=-n,t=-t,e=-e,r=-r):(o=-o,s=-n,n=-e,e=s,s=-t,t=-r,r=s),n>0)if(e>0){if(!(n<=e))return o}else return o;else{if(e>0)return-o;if(n>=e)o=-o,n=-n,e=-e;else return-o}for(;;){if(l=Math.floor(e/n),e=e-l*n,r=r-l*t,r<0)return-o;if(r>t)return o;if(n>e+e){if(t<r+r)return o}else{if(t>r+r)return-o;e=n-e,r=t-r,o=-o}if(r===0)return e===0?0:-o;if(e===0||(l=Math.floor(n/e),n=n-l*e,t=t-l*r,t<0))return o;if(t>r)return-o;if(e>n+n){if(r<t+t)return-o}else{if(r>t+t)return o;n=e-n,t=r-t,o=-o}if(t===0)return n===0?0:o;if(n===0)return-o}};var sn=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var n=arguments[0];this._p=n};sn.prototype.countSegment=function(n,t){if(n.x<this._p.x&&t.x<this._p.x)return null;if(this._p.x===t.x&&this._p.y===t.y)return this._isPointOnSegment=!0,null;if(n.y===this._p.y&&t.y===this._p.y){var e=n.x,r=t.x;return e>r&&(e=t.x,r=n.x),this._p.x>=e&&this._p.x<=r&&(this._isPointOnSegment=!0),null}if(n.y>this._p.y&&t.y<=this._p.y||t.y>this._p.y&&n.y<=this._p.y){var o=n.x-this._p.x,s=n.y-this._p.y,l=t.x-this._p.x,a=t.y-this._p.y,h=Zr.signOfDet2x2(o,s,l,a);if(h===0)return this._isPointOnSegment=!0,null;a<s&&(h=-h),h>0&&this._crossingCount++}};sn.prototype.isPointInPolygon=function(){return this.getLocation()!==E.EXTERIOR};sn.prototype.getLocation=function(){return this._isPointOnSegment?E.BOUNDARY:this._crossingCount%2===1?E.INTERIOR:E.EXTERIOR};sn.prototype.isOnSegment=function(){return this._isPointOnSegment};sn.prototype.interfaces_=function(){return[]};sn.prototype.getClass=function(){return sn};sn.locatePointInRing=function(){if(arguments[0]instanceof d&&V(arguments[1],Q)){for(var n=arguments[0],t=arguments[1],e=new sn(n),r=new d,o=new d,s=1;s<t.size();s++)if(t.getCoordinate(s,r),t.getCoordinate(s-1,o),e.countSegment(r,o),e.isOnSegment())return e.getLocation();return e.getLocation()}else if(arguments[0]instanceof d&&arguments[1]instanceof Array){for(var l=arguments[0],a=arguments[1],h=new sn(l),y=1;y<a.length;y++){var C=a[y],L=a[y-1];if(h.countSegment(C,L),h.isOnSegment())return h.getLocation()}return h.getLocation()}};var M=function(){},fi={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};M.prototype.interfaces_=function(){return[]};M.prototype.getClass=function(){return M};M.orientationIndex=function(n,t,e){return ce.orientationIndex(n,t,e)};M.signedArea=function(){if(arguments[0]instanceof Array){var n=arguments[0];if(n.length<3)return 0;for(var t=0,e=n[0].x,r=1;r<n.length-1;r++){var o=n[r].x-e,s=n[r+1].y,l=n[r-1].y;t+=o*(l-s)}return t/2}else if(V(arguments[0],Q)){var a=arguments[0],h=a.size();if(h<3)return 0;var y=new d,C=new d,L=new d;a.getCoordinate(0,C),a.getCoordinate(1,L);var Y=C.x;L.x-=Y;for(var ze=0,Bt=1;Bt<h-1;Bt++)y.y=C.y,C.x=L.x,C.y=L.y,a.getCoordinate(Bt+1,L),L.x-=Y,ze+=C.x*(y.y-L.y);return ze/2}};M.distanceLineLine=function(n,t,e,r){if(n.equals(t))return M.distancePointLine(n,e,r);if(e.equals(r))return M.distancePointLine(r,n,t);var o=!1;if(!B.intersects(n,t,e,r))o=!0;else{var s=(t.x-n.x)*(r.y-e.y)-(t.y-n.y)*(r.x-e.x);if(s===0)o=!0;else{var l=(n.y-e.y)*(r.x-e.x)-(n.x-e.x)*(r.y-e.y),a=(n.y-e.y)*(t.x-n.x)-(n.x-e.x)*(t.y-n.y),h=a/s,y=l/s;(y<0||y>1||h<0||h>1)&&(o=!0)}}return o?we.min(M.distancePointLine(n,e,r),M.distancePointLine(t,e,r),M.distancePointLine(e,n,t),M.distancePointLine(r,n,t)):0};M.isPointInRing=function(n,t){return M.locatePointInRing(n,t)!==E.EXTERIOR};M.computeLength=function(n){var t=n.size();if(t<=1)return 0;var e=0,r=new d;n.getCoordinate(0,r);for(var o=r.x,s=r.y,l=1;l<t;l++){n.getCoordinate(l,r);var a=r.x,h=r.y,y=a-o,C=h-s;e+=Math.sqrt(y*y+C*C),o=a,s=h}return e};M.isCCW=function(n){var t=n.length-1;if(t<3)throw new ft("Ring has fewer than 4 points, so orientation cannot be determined");for(var e=n[0],r=0,o=1;o<=t;o++){var s=n[o];s.y>e.y&&(e=s,r=o)}var l=r;do l=l-1,l<0&&(l=t);while(n[l].equals2D(e)&&l!==r);var a=r;do a=(a+1)%t;while(n[a].equals2D(e)&&a!==r);var h=n[l],y=n[a];if(h.equals2D(e)||y.equals2D(e)||h.equals2D(y))return!1;var C=M.computeOrientation(h,e,y),L=!1;return C===0?L=h.x>y.x:L=C>0,L};M.locatePointInRing=function(n,t){return sn.locatePointInRing(n,t)};M.distancePointLinePerpendicular=function(n,t,e){var r=(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y),o=((t.y-n.y)*(e.x-t.x)-(t.x-n.x)*(e.y-t.y))/r;return Math.abs(o)*Math.sqrt(r)};M.computeOrientation=function(n,t,e){return M.orientationIndex(n,t,e)};M.distancePointLine=function(){if(arguments.length===2){var n=arguments[0],t=arguments[1];if(t.length===0)throw new ft("Line array must contain at least one vertex");for(var e=n.distance(t[0]),r=0;r<t.length-1;r++){var o=M.distancePointLine(n,t[r],t[r+1]);o<e&&(e=o)}return e}else if(arguments.length===3){var s=arguments[0],l=arguments[1],a=arguments[2];if(l.x===a.x&&l.y===a.y)return s.distance(l);var h=(a.x-l.x)*(a.x-l.x)+(a.y-l.y)*(a.y-l.y),y=((s.x-l.x)*(a.x-l.x)+(s.y-l.y)*(a.y-l.y))/h;if(y<=0)return s.distance(l);if(y>=1)return s.distance(a);var C=((l.y-s.y)*(a.x-l.x)-(l.x-s.x)*(a.y-l.y))/h;return Math.abs(C)*Math.sqrt(h)}};M.isOnLine=function(n,t){for(var e=new Xr,r=1;r<t.length;r++){var o=t[r-1],s=t[r];if(e.computeIntersection(n,o,s),e.hasIntersection())return!0}return!1};fi.CLOCKWISE.get=function(){return-1};fi.RIGHT.get=function(){return M.CLOCKWISE};fi.COUNTERCLOCKWISE.get=function(){return 1};fi.LEFT.get=function(){return M.COUNTERCLOCKWISE};fi.COLLINEAR.get=function(){return 0};fi.STRAIGHT.get=function(){return M.COLLINEAR};Object.defineProperties(M,fi);var Zn=function(){};Zn.prototype.filter=function(n){};Zn.prototype.interfaces_=function(){return[]};Zn.prototype.getClass=function(){return Zn};var G=function(){var n=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=n,this._SRID=n.getSRID()},Fn={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};G.prototype.isGeometryCollection=function(){return this.getSortIndex()===G.SORTINDEX_GEOMETRYCOLLECTION};G.prototype.getFactory=function(){return this._factory};G.prototype.getGeometryN=function(n){return this};G.prototype.getArea=function(){return 0};G.prototype.isRectangle=function(){return!1};G.prototype.equals=function(){if(arguments[0]instanceof G){var n=arguments[0];return n===null?!1:this.equalsTopo(n)}else if(arguments[0]instanceof Object){var t=arguments[0];if(!(t instanceof G))return!1;var e=t;return this.equalsExact(e)}};G.prototype.equalsExact=function(n){return this===n||this.equalsExact(n,0)};G.prototype.geometryChanged=function(){this.apply(G.geometryChangedFilter)};G.prototype.geometryChangedAction=function(){this._envelope=null};G.prototype.equalsNorm=function(n){return n===null?!1:this.norm().equalsExact(n.norm())};G.prototype.getLength=function(){return 0};G.prototype.getNumGeometries=function(){return 1};G.prototype.compareTo=function(){if(arguments.length===1){var n=arguments[0],t=n;return this.getSortIndex()!==t.getSortIndex()?this.getSortIndex()-t.getSortIndex():this.isEmpty()&&t.isEmpty()?0:this.isEmpty()?-1:t.isEmpty()?1:this.compareToSameClass(n)}else if(arguments.length===2){var e=arguments[0],r=arguments[1];return this.getSortIndex()!==e.getSortIndex()?this.getSortIndex()-e.getSortIndex():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(e,r)}};G.prototype.getUserData=function(){return this._userData};G.prototype.getSRID=function(){return this._SRID};G.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())};G.prototype.checkNotGeometryCollection=function(n){if(n.getSortIndex()===G.SORTINDEX_GEOMETRYCOLLECTION)throw new ft("This method does not support GeometryCollection arguments")};G.prototype.equal=function(n,t,e){return e===0?n.equals(t):n.distance(t)<=e};G.prototype.norm=function(){var n=this.copy();return n.normalize(),n};G.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()};G.prototype.getEnvelopeInternal=function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new B(this._envelope)};G.prototype.setSRID=function(n){this._SRID=n};G.prototype.setUserData=function(n){this._userData=n};G.prototype.compare=function(n,t){for(var e=n.iterator(),r=t.iterator();e.hasNext()&&r.hasNext();){var o=e.next(),s=r.next(),l=o.compareTo(s);if(l!==0)return l}return e.hasNext()?1:r.hasNext()?-1:0};G.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()};G.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===G.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===G.SORTINDEX_MULTIPOINT||this.getSortIndex()===G.SORTINDEX_MULTILINESTRING||this.getSortIndex()===G.SORTINDEX_MULTIPOLYGON};G.prototype.interfaces_=function(){return[$o,ke,Ge]};G.prototype.getClass=function(){return G};G.hasNonEmptyElements=function(n){for(var t=0;t<n.length;t++)if(!n[t].isEmpty())return!0;return!1};G.hasNullElements=function(n){for(var t=0;t<n.length;t++)if(n[t]===null)return!0;return!1};Fn.serialVersionUID.get=function(){return 8763622679187377e3};Fn.SORTINDEX_POINT.get=function(){return 0};Fn.SORTINDEX_MULTIPOINT.get=function(){return 1};Fn.SORTINDEX_LINESTRING.get=function(){return 2};Fn.SORTINDEX_LINEARRING.get=function(){return 3};Fn.SORTINDEX_MULTILINESTRING.get=function(){return 4};Fn.SORTINDEX_POLYGON.get=function(){return 5};Fn.SORTINDEX_MULTIPOLYGON.get=function(){return 6};Fn.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7};Fn.geometryChangedFilter.get=function(){return Us};Object.defineProperties(G,Fn);var Us=function(){};Us.interfaces_=function(){return[Zn]};Us.filter=function(n){n.geometryChangedAction()};var Ln=function(){};Ln.prototype.filter=function(n){};Ln.prototype.interfaces_=function(){return[]};Ln.prototype.getClass=function(){return Ln};var Ae=function(){},nr={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};Ae.prototype.isInBoundary=function(n){};Ae.prototype.interfaces_=function(){return[]};Ae.prototype.getClass=function(){return Ae};nr.Mod2BoundaryNodeRule.get=function(){return xi};nr.EndPointBoundaryNodeRule.get=function(){return Si};nr.MultiValentEndPointBoundaryNodeRule.get=function(){return wi};nr.MonoValentEndPointBoundaryNodeRule.get=function(){return Li};nr.MOD2_BOUNDARY_RULE.get=function(){return new xi};nr.ENDPOINT_BOUNDARY_RULE.get=function(){return new Si};nr.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new wi};nr.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Li};nr.OGC_SFS_BOUNDARY_RULE.get=function(){return Ae.MOD2_BOUNDARY_RULE};Object.defineProperties(Ae,nr);var xi=function(){};xi.prototype.isInBoundary=function(n){return n%2===1};xi.prototype.interfaces_=function(){return[Ae]};xi.prototype.getClass=function(){return xi};var Si=function(){};Si.prototype.isInBoundary=function(n){return n>0};Si.prototype.interfaces_=function(){return[Ae]};Si.prototype.getClass=function(){return Si};var wi=function(){};wi.prototype.isInBoundary=function(n){return n>1};wi.prototype.interfaces_=function(){return[Ae]};wi.prototype.getClass=function(){return wi};var Li=function(){};Li.prototype.isInBoundary=function(n){return n===1};Li.prototype.interfaces_=function(){return[Ae]};Li.prototype.getClass=function(){return Li};var Lt=function(){};Lt.prototype.add=function(){};Lt.prototype.addAll=function(){};Lt.prototype.isEmpty=function(){};Lt.prototype.iterator=function(){};Lt.prototype.size=function(){};Lt.prototype.toArray=function(){};Lt.prototype.remove=function(){};function qs(n){this.message=n||""}qs.prototype=new Error;qs.prototype.name="IndexOutOfBoundsException";var Xi=function(){};Xi.prototype.hasNext=function(){};Xi.prototype.next=function(){};Xi.prototype.remove=function(){};var qe=function(n){function t(){n.apply(this,arguments)}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.get=function(){},t.prototype.set=function(){},t.prototype.isEmpty=function(){},t}(Lt);function Yi(n){this.message=n||""}Yi.prototype=new Error;Yi.prototype.name="NoSuchElementException";var O=function(n){function t(){n.call(this),this.array_=[],arguments[0]instanceof Lt&&this.addAll(arguments[0])}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.ensureCapacity=function(){},t.prototype.interfaces_=function(){return[n,Lt]},t.prototype.add=function(e){return arguments.length===1?this.array_.push(e):this.array_.splice(arguments[0],arguments[1]),!0},t.prototype.clear=function(){this.array_=[]},t.prototype.addAll=function(e){for(var r=this,o=e.iterator();o.hasNext();)r.add(o.next());return!0},t.prototype.set=function(e,r){var o=this.array_[e];return this.array_[e]=r,o},t.prototype.iterator=function(){return new Yc(this)},t.prototype.get=function(e){if(e<0||e>=this.size())throw new qs;return this.array_[e]},t.prototype.isEmpty=function(){return this.array_.length===0},t.prototype.size=function(){return this.array_.length},t.prototype.toArray=function(){for(var e=this,r=[],o=0,s=this.array_.length;o<s;o++)r.push(e.array_[o]);return r},t.prototype.remove=function(e){for(var r=this,o=!1,s=0,l=this.array_.length;s<l;s++)if(r.array_[s]===e){r.array_.splice(s,1),o=!0;break}return o},t}(qe),Yc=function(n){function t(e){n.call(this),this.arrayList_=e,this.position_=0}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new Yi;return this.arrayList_.get(this.position_++)},t.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},t.prototype.set=function(e){return this.arrayList_.set(this.position_-1,e)},t.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},t}(Xi),Eo=function(n){function t(){if(n.call(this),arguments.length!==0){if(arguments.length===1){var r=arguments[0];this.ensureCapacity(r.length),this.add(r,!0)}else if(arguments.length===2){var o=arguments[0],s=arguments[1];this.ensureCapacity(o.length),this.add(o,s)}}}n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t;var e={coordArrayType:{configurable:!0}};return e.coordArrayType.get=function(){return new Array(0).fill(null)},t.prototype.getCoordinate=function(r){return this.get(r)},t.prototype.addAll=function(){var r=this;if(arguments.length===2){for(var o=arguments[0],s=arguments[1],l=!1,a=o.iterator();a.hasNext();)r.add(a.next(),s),l=!0;return l}else return n.prototype.addAll.apply(this,arguments)},t.prototype.clone=function(){for(var r=this,o=n.prototype.clone.call(this),s=0;s<this.size();s++)o.add(s,r.get(s).copy());return o},t.prototype.toCoordinateArray=function(){return this.toArray(t.coordArrayType)},t.prototype.add=function(){var r=this;if(arguments.length===1){var o=arguments[0];n.prototype.add.call(this,o)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var s=arguments[0],l=arguments[1];return this.add(s,l,!0),!0}else if(arguments[0]instanceof d&&typeof arguments[1]=="boolean"){var a=arguments[0],h=arguments[1];if(!h&&this.size()>=1){var y=this.get(this.size()-1);if(y.equals2D(a))return null}n.prototype.add.call(this,a)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var C=arguments[0],L=arguments[1];return this.add(C,L),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var Y=arguments[0],ze=arguments[1],Bt=arguments[2];if(Bt)for(var Ir=0;Ir<Y.length;Ir++)r.add(Y[Ir],ze);else for(var Wr=Y.length-1;Wr>=0;Wr--)r.add(Y[Wr],ze);return!0}else if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof d){var yi=arguments[0],Bn=arguments[1],vi=arguments[2];if(!vi){var wo=this.size();if(wo>0){if(yi>0){var ia=this.get(yi-1);if(ia.equals2D(Bn))return null}if(yi<wo){var gl=this.get(yi);if(gl.equals2D(Bn))return null}}}n.prototype.add.call(this,yi,Bn)}}else if(arguments.length===4){var ml=arguments[0],il=arguments[1],sl=arguments[2],ol=arguments[3],_l=1;sl>ol&&(_l=-1);for(var rh=sl;rh!==ol;rh+=_l)r.add(ml[rh],il);return!0}},t.prototype.closeRing=function(){this.size()>0&&this.add(new d(this.get(0)),!1)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},Object.defineProperties(t,e),t}(O),j=function(){},es$3={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};es$3.ForwardComparator.get=function(){return io};es$3.BidirectionalComparator.get=function(){return bi};es$3.coordArrayType.get=function(){return new Array(0).fill(null)};j.prototype.interfaces_=function(){return[]};j.prototype.getClass=function(){return j};j.isRing=function(n){return!(n.length<4||!n[0].equals2D(n[n.length-1]))};j.ptNotInList=function(n,t){for(var e=0;e<n.length;e++){var r=n[e];if(j.indexOf(r,t)<0)return r}return null};j.scroll=function(n,t){var e=j.indexOf(t,n);if(e<0)return null;var r=new Array(n.length).fill(null);qt.arraycopy(n,e,r,0,n.length-e),qt.arraycopy(n,0,r,n.length-e,e),qt.arraycopy(r,0,n,0,n.length)};j.equals=function(){if(arguments.length===2){var n=arguments[0],t=arguments[1];if(n===t)return!0;if(n===null||t===null||n.length!==t.length)return!1;for(var e=0;e<n.length;e++)if(!n[e].equals(t[e]))return!1;return!0}else if(arguments.length===3){var r=arguments[0],o=arguments[1],s=arguments[2];if(r===o)return!0;if(r===null||o===null||r.length!==o.length)return!1;for(var l=0;l<r.length;l++)if(s.compare(r[l],o[l])!==0)return!1;return!0}};j.intersection=function(n,t){for(var e=new Eo,r=0;r<n.length;r++)t.intersects(n[r])&&e.add(n[r],!0);return e.toCoordinateArray()};j.hasRepeatedPoints=function(n){for(var t=1;t<n.length;t++)if(n[t-1].equals(n[t]))return!0;return!1};j.removeRepeatedPoints=function(n){if(!j.hasRepeatedPoints(n))return n;var t=new Eo(n,!1);return t.toCoordinateArray()};j.reverse=function(n){for(var t=n.length-1,e=Math.trunc(t/2),r=0;r<=e;r++){var o=n[r];n[r]=n[t-r],n[t-r]=o}};j.removeNull=function(n){for(var t=0,e=0;e<n.length;e++)n[e]!==null&&t++;var r=new Array(t).fill(null);if(t===0)return r;for(var o=0,s=0;s<n.length;s++)n[s]!==null&&(r[o++]=n[s]);return r};j.copyDeep=function(){if(arguments.length===1){for(var n=arguments[0],t=new Array(n.length).fill(null),e=0;e<n.length;e++)t[e]=new d(n[e]);return t}else if(arguments.length===5)for(var r=arguments[0],o=arguments[1],s=arguments[2],l=arguments[3],a=arguments[4],h=0;h<a;h++)s[l+h]=new d(r[o+h])};j.isEqualReversed=function(n,t){for(var e=0;e<n.length;e++){var r=n[e],o=t[n.length-e-1];if(r.compareTo(o)!==0)return!1}return!0};j.envelope=function(n){for(var t=new B,e=0;e<n.length;e++)t.expandToInclude(n[e]);return t};j.toCoordinateArray=function(n){return n.toArray(j.coordArrayType)};j.atLeastNCoordinatesOrNothing=function(n,t){return t.length>=n?t:[]};j.indexOf=function(n,t){for(var e=0;e<t.length;e++)if(n.equals(t[e]))return e;return-1};j.increasingDirection=function(n){for(var t=0;t<Math.trunc(n.length/2);t++){var e=n.length-1-t,r=n[t].compareTo(n[e]);if(r!==0)return r}return 1};j.compare=function(n,t){for(var e=0;e<n.length&&e<t.length;){var r=n[e].compareTo(t[e]);if(r!==0)return r;e++}return e<t.length?-1:e<n.length?1:0};j.minCoordinate=function(n){for(var t=null,e=0;e<n.length;e++)(t===null||t.compareTo(n[e])>0)&&(t=n[e]);return t};j.extract=function(n,t,e){t=we.clamp(t,0,n.length),e=we.clamp(e,-1,n.length);var r=e-t+1;e<0&&(r=0),t>=n.length&&(r=0),e<t&&(r=0);var o=new Array(r).fill(null);if(r===0)return o;for(var s=0,l=t;l<=e;l++)o[s++]=n[l];return o};Object.defineProperties(j,es$3);var io=function(){};io.prototype.compare=function(n,t){var e=n,r=t;return j.compare(e,r)};io.prototype.interfaces_=function(){return[Ci]};io.prototype.getClass=function(){return io};var bi=function(){};bi.prototype.compare=function(n,t){var e=n,r=t;if(e.length<r.length)return-1;if(e.length>r.length)return 1;if(e.length===0)return 0;var o=j.compare(e,r),s=j.isEqualReversed(e,r);return s?0:o};bi.prototype.OLDcompare=function(n,t){var e=n,r=t;if(e.length<r.length)return-1;if(e.length>r.length)return 1;if(e.length===0)return 0;for(var o=j.increasingDirection(e),s=j.increasingDirection(r),l=o>0?0:e.length-1,a=s>0?0:e.length-1,h=0;h<e.length;h++){var y=e[l].compareTo(r[a]);if(y!==0)return y;l+=o,a+=s}return 0};bi.prototype.interfaces_=function(){return[Ci]};bi.prototype.getClass=function(){return bi};var hi=function(){};hi.prototype.get=function(){};hi.prototype.put=function(){};hi.prototype.size=function(){};hi.prototype.values=function(){};hi.prototype.entrySet=function(){};var Wc=function(n){function t(){n.apply(this,arguments)}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t}(hi);function Io(n){this.message=n||""}Io.prototype=new Error;Io.prototype.name="OperationNotSupported";function ns(){}ns.prototype=new Lt;ns.prototype.contains=function(){};var Xs=function(n){function t(){n.call(this),this.array_=[],arguments[0]instanceof Lt&&this.addAll(arguments[0])}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.contains=function(e){for(var r=this,o=0,s=this.array_.length;o<s;o++){var l=r.array_[o];if(l===e)return!0}return!1},t.prototype.add=function(e){return this.contains(e)?!1:(this.array_.push(e),!0)},t.prototype.addAll=function(e){for(var r=this,o=e.iterator();o.hasNext();)r.add(o.next());return!0},t.prototype.remove=function(e){throw new Error},t.prototype.size=function(){return this.array_.length},t.prototype.isEmpty=function(){return this.array_.length===0},t.prototype.toArray=function(){for(var e=this,r=[],o=0,s=this.array_.length;o<s;o++)r.push(e.array_[o]);return r},t.prototype.iterator=function(){return new Hc(this)},t}(ns),Hc=function(n){function t(e){n.call(this),this.hashSet_=e,this.position_=0}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new Yi;return this.hashSet_.array_[this.position_++]},t.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},t.prototype.remove=function(){throw new Io},t}(Xi),Wn=0,Nr=1;function Ta(n){return n===null?Wn:n.color}function st(n){return n===null?null:n.parent}function Un(n,t){n!==null&&(n.color=t)}function Is(n){return n===null?null:n.left}function Da(n){return n===null?null:n.right}function Kt(){this.root_=null,this.size_=0}Kt.prototype=new Wc;Kt.prototype.get=function(n){for(var t=this.root_;t!==null;){var e=n.compareTo(t.key);if(e<0)t=t.left;else if(e>0)t=t.right;else return t.value}return null};Kt.prototype.put=function(n,t){if(this.root_===null)return this.root_={key:n,value:t,left:null,right:null,parent:null,color:Wn,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var e=this.root_,r,o;do if(r=e,o=n.compareTo(e.key),o<0)e=e.left;else if(o>0)e=e.right;else{var s=e.value;return e.value=t,s}while(e!==null);var l={key:n,left:null,right:null,value:t,parent:r,color:Wn,getValue:function(){return this.value},getKey:function(){return this.key}};return o<0?r.left=l:r.right=l,this.fixAfterInsertion(l),this.size_++,null};Kt.prototype.fixAfterInsertion=function(n){var t=this;for(n.color=Nr;n!=null&&n!==this.root_&&n.parent.color===Nr;)if(st(n)===Is(st(st(n)))){var e=Da(st(st(n)));Ta(e)===Nr?(Un(st(n),Wn),Un(e,Wn),Un(st(st(n)),Nr),n=st(st(n))):(n===Da(st(n))&&(n=st(n),t.rotateLeft(n)),Un(st(n),Wn),Un(st(st(n)),Nr),t.rotateRight(st(st(n))))}else{var r=Is(st(st(n)));Ta(r)===Nr?(Un(st(n),Wn),Un(r,Wn),Un(st(st(n)),Nr),n=st(st(n))):(n===Is(st(n))&&(n=st(n),t.rotateRight(n)),Un(st(n),Wn),Un(st(st(n)),Nr),t.rotateLeft(st(st(n))))}this.root_.color=Wn};Kt.prototype.values=function(){var n=new O,t=this.getFirstEntry();if(t!==null)for(n.add(t.value);(t=Kt.successor(t))!==null;)n.add(t.value);return n};Kt.prototype.entrySet=function(){var n=new Xs,t=this.getFirstEntry();if(t!==null)for(n.add(t);(t=Kt.successor(t))!==null;)n.add(t);return n};Kt.prototype.rotateLeft=function(n){if(n!=null){var t=n.right;n.right=t.left,t.left!=null&&(t.left.parent=n),t.parent=n.parent,n.parent===null?this.root_=t:n.parent.left===n?n.parent.left=t:n.parent.right=t,t.left=n,n.parent=t}};Kt.prototype.rotateRight=function(n){if(n!=null){var t=n.left;n.left=t.right,t.right!=null&&(t.right.parent=n),t.parent=n.parent,n.parent===null?this.root_=t:n.parent.right===n?n.parent.right=t:n.parent.left=t,t.right=n,n.parent=t}};Kt.prototype.getFirstEntry=function(){var n=this.root_;if(n!=null)for(;n.left!=null;)n=n.left;return n};Kt.successor=function(n){if(n===null)return null;if(n.right!==null){for(var t=n.right;t.left!==null;)t=t.left;return t}else{for(var e=n.parent,r=n;e!==null&&r===e.right;)r=e,e=e.parent;return e}};Kt.prototype.size=function(){return this.size_};var oo=function(){};oo.prototype.interfaces_=function(){return[]};oo.prototype.getClass=function(){return oo};function Eu(){}Eu.prototype=new ns;function ln(){this.array_=[],arguments[0]instanceof Lt&&this.addAll(arguments[0])}ln.prototype=new Eu;ln.prototype.contains=function(n){for(var t=this,e=0,r=this.array_.length;e<r;e++){var o=t.array_[e];if(o.compareTo(n)===0)return!0}return!1};ln.prototype.add=function(n){var t=this;if(this.contains(n))return!1;for(var e=0,r=this.array_.length;e<r;e++){var o=t.array_[e];if(o.compareTo(n)===1)return t.array_.splice(e,0,n),!0}return this.array_.push(n),!0};ln.prototype.addAll=function(n){for(var t=this,e=n.iterator();e.hasNext();)t.add(e.next());return!0};ln.prototype.remove=function(n){throw new Io};ln.prototype.size=function(){return this.array_.length};ln.prototype.isEmpty=function(){return this.array_.length===0};ln.prototype.toArray=function(){for(var n=this,t=[],e=0,r=this.array_.length;e<r;e++)t.push(n.array_[e]);return t};ln.prototype.iterator=function(){return new rs(this)};var rs=function(n){this.treeSet_=n,this.position_=0};rs.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new Yi;return this.treeSet_.array_[this.position_++]};rs.prototype.hasNext=function(){return this.position_<this.treeSet_.size()};rs.prototype.remove=function(){throw new Io};var Lr=function(){};Lr.sort=function(){var n=arguments[0],t,e,r,o;if(arguments.length===1)o=function(l,a){return l.compareTo(a)},n.sort(o);else if(arguments.length===2)r=arguments[1],o=function(l,a){return r.compare(l,a)},n.sort(o);else if(arguments.length===3){e=n.slice(arguments[1],arguments[2]),e.sort();var s=n.slice(0,arguments[1]).concat(e,n.slice(arguments[2],n.length));for(n.splice(0,n.length),t=0;t<s.length;t++)n.push(s[t])}else if(arguments.length===4)for(e=n.slice(arguments[1],arguments[2]),r=arguments[3],o=function(l,a){return r.compare(l,a)},e.sort(o),s=n.slice(0,arguments[1]).concat(e,n.slice(arguments[2],n.length)),n.splice(0,n.length),t=0;t<s.length;t++)n.push(s[t])};Lr.asList=function(n){for(var t=new O,e=0,r=n.length;e<r;e++)t.add(n[e]);return t};var Z=function(){},Je={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Je.P.get=function(){return 0};Je.L.get=function(){return 1};Je.A.get=function(){return 2};Je.FALSE.get=function(){return-1};Je.TRUE.get=function(){return-2};Je.DONTCARE.get=function(){return-3};Je.SYM_FALSE.get=function(){return"F"};Je.SYM_TRUE.get=function(){return"T"};Je.SYM_DONTCARE.get=function(){return"*"};Je.SYM_P.get=function(){return"0"};Je.SYM_L.get=function(){return"1"};Je.SYM_A.get=function(){return"2"};Z.prototype.interfaces_=function(){return[]};Z.prototype.getClass=function(){return Z};Z.toDimensionSymbol=function(n){switch(n){case Z.FALSE:return Z.SYM_FALSE;case Z.TRUE:return Z.SYM_TRUE;case Z.DONTCARE:return Z.SYM_DONTCARE;case Z.P:return Z.SYM_P;case Z.L:return Z.SYM_L;case Z.A:return Z.SYM_A}throw new ft("Unknown dimension value: "+n)};Z.toDimensionValue=function(n){switch(ro.toUpperCase(n)){case Z.SYM_FALSE:return Z.FALSE;case Z.SYM_TRUE:return Z.TRUE;case Z.SYM_DONTCARE:return Z.DONTCARE;case Z.SYM_P:return Z.P;case Z.SYM_L:return Z.L;case Z.SYM_A:return Z.A}throw new ft("Unknown dimension symbol: "+n)};Object.defineProperties(Z,Je);var cn=function(){};cn.prototype.filter=function(n){};cn.prototype.interfaces_=function(){return[]};cn.prototype.getClass=function(){return cn};var Ye=function(){};Ye.prototype.filter=function(n,t){};Ye.prototype.isDone=function(){};Ye.prototype.isGeometryChanged=function(){};Ye.prototype.interfaces_=function(){return[]};Ye.prototype.getClass=function(){return Ye};var ie=function(n){function t(r,o){if(n.call(this,o),this._geometries=r||[],n.hasNullElements(this._geometries))throw new ft("geometries must not contain null elements")}n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t;var e={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){for(var r=this,o=new B,s=0;s<this._geometries.length;s++)o.expandToInclude(r._geometries[s].getEnvelopeInternal());return o},t.prototype.getGeometryN=function(r){return this._geometries[r]},t.prototype.getSortIndex=function(){return n.SORTINDEX_GEOMETRYCOLLECTION},t.prototype.getCoordinates=function(){for(var r=this,o=new Array(this.getNumPoints()).fill(null),s=-1,l=0;l<this._geometries.length;l++)for(var a=r._geometries[l].getCoordinates(),h=0;h<a.length;h++)s++,o[s]=a[h];return o},t.prototype.getArea=function(){for(var r=this,o=0,s=0;s<this._geometries.length;s++)o+=r._geometries[s].getArea();return o},t.prototype.equalsExact=function(){var r=this;if(arguments.length===2){var o=arguments[0],s=arguments[1];if(!this.isEquivalentClass(o))return!1;var l=o;if(this._geometries.length!==l._geometries.length)return!1;for(var a=0;a<this._geometries.length;a++)if(!r._geometries[a].equalsExact(l._geometries[a],s))return!1;return!0}else return n.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var r=this,o=0;o<this._geometries.length;o++)r._geometries[o].normalize();Lr.sort(this._geometries)},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},t.prototype.getBoundaryDimension=function(){for(var r=this,o=Z.FALSE,s=0;s<this._geometries.length;s++)o=Math.max(o,r._geometries[s].getBoundaryDimension());return o},t.prototype.getDimension=function(){for(var r=this,o=Z.FALSE,s=0;s<this._geometries.length;s++)o=Math.max(o,r._geometries[s].getDimension());return o},t.prototype.getLength=function(){for(var r=this,o=0,s=0;s<this._geometries.length;s++)o+=r._geometries[s].getLength();return o},t.prototype.getNumPoints=function(){for(var r=this,o=0,s=0;s<this._geometries.length;s++)o+=r._geometries[s].getNumPoints();return o},t.prototype.getNumGeometries=function(){return this._geometries.length},t.prototype.reverse=function(){for(var r=this,o=this._geometries.length,s=new Array(o).fill(null),l=0;l<this._geometries.length;l++)s[l]=r._geometries[l].reverse();return this.getFactory().createGeometryCollection(s)},t.prototype.compareToSameClass=function(){var r=this;if(arguments.length===1){var o=arguments[0],s=new ln(Lr.asList(this._geometries)),l=new ln(Lr.asList(o._geometries));return this.compare(s,l)}else if(arguments.length===2){for(var a=arguments[0],h=arguments[1],y=a,C=this.getNumGeometries(),L=y.getNumGeometries(),Y=0;Y<C&&Y<L;){var ze=r.getGeometryN(Y),Bt=y.getGeometryN(Y),Ir=ze.compareToSameClass(Bt,h);if(Ir!==0)return Ir;Y++}return Y<C?1:Y<L?-1:0}},t.prototype.apply=function(){var r=this;if(V(arguments[0],Ln))for(var o=arguments[0],s=0;s<this._geometries.length;s++)r._geometries[s].apply(o);else if(V(arguments[0],Ye)){var l=arguments[0];if(this._geometries.length===0)return null;for(var a=0;a<this._geometries.length&&(r._geometries[a].apply(l),!l.isDone());a++);l.isGeometryChanged()&&this.geometryChanged()}else if(V(arguments[0],cn)){var h=arguments[0];h.filter(this);for(var y=0;y<this._geometries.length;y++)r._geometries[y].apply(h)}else if(V(arguments[0],Zn)){var C=arguments[0];C.filter(this);for(var L=0;L<this._geometries.length;L++)r._geometries[L].apply(C)}},t.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),q.shouldNeverReachHere(),null},t.prototype.clone=function(){var r=this,o=n.prototype.clone.call(this);o._geometries=new Array(this._geometries.length).fill(null);for(var s=0;s<this._geometries.length;s++)o._geometries[s]=r._geometries[s].clone();return o},t.prototype.getGeometryType=function(){return"GeometryCollection"},t.prototype.copy=function(){for(var r=this,o=new Array(this._geometries.length).fill(null),s=0;s<o.length;s++)o[s]=r._geometries[s].copy();return new t(o,this._factory)},t.prototype.isEmpty=function(){for(var r=this,o=0;o<this._geometries.length;o++)if(!r._geometries[o].isEmpty())return!1;return!0},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},e.serialVersionUID.get=function(){return-5694727726395021e3},Object.defineProperties(t,e),t}(G),Tr=function(n){function t(){n.apply(this,arguments)}n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t;var e={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return G.SORTINDEX_MULTILINESTRING},t.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],o=arguments[1];return this.isEquivalentClass(r)?n.prototype.equalsExact.call(this,r,o):!1}else return n.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?Z.FALSE:0},t.prototype.isClosed=function(){var r=this;if(this.isEmpty())return!1;for(var o=0;o<this._geometries.length;o++)if(!r._geometries[o].isClosed())return!1;return!0},t.prototype.getDimension=function(){return 1},t.prototype.reverse=function(){for(var r=this,o=this._geometries.length,s=new Array(o).fill(null),l=0;l<this._geometries.length;l++)s[o-1-l]=r._geometries[l].reverse();return this.getFactory().createMultiLineString(s)},t.prototype.getBoundary=function(){return new Oe(this).getBoundary()},t.prototype.getGeometryType=function(){return"MultiLineString"},t.prototype.copy=function(){for(var r=this,o=new Array(this._geometries.length).fill(null),s=0;s<o.length;s++)o[s]=r._geometries[s].copy();return new t(o,this._factory)},t.prototype.interfaces_=function(){return[oo]},t.prototype.getClass=function(){return t},e.serialVersionUID.get=function(){return 8166665132445434e3},Object.defineProperties(t,e),t}(ie),Oe=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,arguments.length===1){var n=arguments[0],t=Ae.MOD2_BOUNDARY_RULE;this._geom=n,this._geomFact=n.getFactory(),this._bnRule=t}else if(arguments.length===2){var e=arguments[0],r=arguments[1];this._geom=e,this._geomFact=e.getFactory(),this._bnRule=r}};Oe.prototype.boundaryMultiLineString=function(n){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var t=this.computeBoundaryCoordinates(n);return t.length===1?this._geomFact.createPoint(t[0]):this._geomFact.createMultiPointFromCoords(t)};Oe.prototype.getBoundary=function(){return this._geom instanceof yt?this.boundaryLineString(this._geom):this._geom instanceof Tr?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()};Oe.prototype.boundaryLineString=function(n){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(n.isClosed()){var t=this._bnRule.isInBoundary(2);return t?n.getStartPoint():this._geomFact.createMultiPoint()}return this._geomFact.createMultiPoint([n.getStartPoint(),n.getEndPoint()])};Oe.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()};Oe.prototype.computeBoundaryCoordinates=function(n){var t=this,e=new O;this._endpointMap=new Kt;for(var r=0;r<n.getNumGeometries();r++){var o=n.getGeometryN(r);o.getNumPoints()!==0&&(t.addEndpoint(o.getCoordinateN(0)),t.addEndpoint(o.getCoordinateN(o.getNumPoints()-1)))}for(var s=this._endpointMap.entrySet().iterator();s.hasNext();){var l=s.next(),a=l.getValue(),h=a.count;t._bnRule.isInBoundary(h)&&e.add(l.getKey())}return j.toCoordinateArray(e)};Oe.prototype.addEndpoint=function(n){var t=this._endpointMap.get(n);t===null&&(t=new qo,this._endpointMap.put(n,t)),t.count++};Oe.prototype.interfaces_=function(){return[]};Oe.prototype.getClass=function(){return Oe};Oe.getBoundary=function(){if(arguments.length===1){var n=arguments[0],t=new Oe(n);return t.getBoundary()}else if(arguments.length===2){var e=arguments[0],r=arguments[1],o=new Oe(e,r);return o.getBoundary()}};var qo=function(){this.count=null};qo.prototype.interfaces_=function(){return[]};qo.prototype.getClass=function(){return qo};function jc(){}function Kc(){}var Qc=function(){};function Zc(){}function Jc(){}function $c(){}var Te=function(){},Ys={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};Te.prototype.interfaces_=function(){return[]};Te.prototype.getClass=function(){return Te};Te.chars=function(n,t){for(var e=new Array(t).fill(null),r=0;r<t;r++)e[r]=n;return String(e)};Te.getStackTrace=function(){if(arguments.length===1){var n=arguments[0],t=new Zc,e=new jc;return n.printStackTrace(e),t.toString()}else if(arguments.length===2){var r=arguments[0],o=arguments[1],s="";new Kc(Te.getStackTrace(r));for(var l=new $c,a=0;a<o;a++)try{s+=l.readLine()+Te.NEWLINE}catch(h){if(h instanceof Jc)q.shouldNeverReachHere();else throw h}finally{}return s}};Te.split=function(n,t){for(var e=t.length,r=new O,o=""+n,s=o.indexOf(t);s>=0;){var l=o.substring(0,s);r.add(l),o=o.substring(s+e),s=o.indexOf(t)}o.length>0&&r.add(o);for(var a=new Array(r.size()).fill(null),h=0;h<a.length;h++)a[h]=r.get(h);return a};Te.toString=function(){if(arguments.length===1){var n=arguments[0];return Te.SIMPLE_ORDINATE_FORMAT.format(n)}};Te.spaces=function(n){return Te.chars(" ",n)};Ys.NEWLINE.get=function(){return qt.getProperty("line.separator")};Ys.SIMPLE_ORDINATE_FORMAT.get=function(){return new Qc};Object.defineProperties(Te,Ys);var Ct=function(){};Ct.prototype.interfaces_=function(){return[]};Ct.prototype.getClass=function(){return Ct};Ct.copyCoord=function(n,t,e,r){for(var o=Math.min(n.getDimension(),e.getDimension()),s=0;s<o;s++)e.setOrdinate(r,s,n.getOrdinate(t,s))};Ct.isRing=function(n){var t=n.size();return t===0?!0:t<=3?!1:n.getOrdinate(0,Q.X)===n.getOrdinate(t-1,Q.X)&&n.getOrdinate(0,Q.Y)===n.getOrdinate(t-1,Q.Y)};Ct.isEqual=function(n,t){var e=n.size(),r=t.size();if(e!==r)return!1;for(var o=Math.min(n.getDimension(),t.getDimension()),s=0;s<e;s++)for(var l=0;l<o;l++){var a=n.getOrdinate(s,l),h=t.getOrdinate(s,l);if(n.getOrdinate(s,l)!==t.getOrdinate(s,l)&&!(z.isNaN(a)&&z.isNaN(h)))return!1}return!0};Ct.extend=function(n,t,e){var r=n.create(e,t.getDimension()),o=t.size();if(Ct.copy(t,0,r,0,o),o>0)for(var s=o;s<e;s++)Ct.copy(t,o-1,r,s,1);return r};Ct.reverse=function(n){for(var t=n.size()-1,e=Math.trunc(t/2),r=0;r<=e;r++)Ct.swap(n,r,t-r)};Ct.swap=function(n,t,e){if(t===e)return null;for(var r=0;r<n.getDimension();r++){var o=n.getOrdinate(t,r);n.setOrdinate(t,r,n.getOrdinate(e,r)),n.setOrdinate(e,r,o)}};Ct.copy=function(n,t,e,r,o){for(var s=0;s<o;s++)Ct.copyCoord(n,t+s,e,r+s)};Ct.toString=function(){if(arguments.length===1){var n=arguments[0],t=n.size();if(t===0)return"()";var e=n.getDimension(),r=new _n;r.append("(");for(var o=0;o<t;o++){o>0&&r.append(" ");for(var s=0;s<e;s++)s>0&&r.append(","),r.append(Te.toString(n.getOrdinate(o,s)))}return r.append(")"),r.toString()}};Ct.ensureValidRing=function(n,t){var e=t.size();if(e===0)return t;if(e<=3)return Ct.createClosedRing(n,t,4);var r=t.getOrdinate(0,Q.X)===t.getOrdinate(e-1,Q.X)&&t.getOrdinate(0,Q.Y)===t.getOrdinate(e-1,Q.Y);return r?t:Ct.createClosedRing(n,t,e+1)};Ct.createClosedRing=function(n,t,e){var r=n.create(e,t.getDimension()),o=t.size();Ct.copy(t,0,r,0,o);for(var s=o;s<e;s++)Ct.copy(t,0,r,s,1);return r};var yt=function(n){function t(r,o){n.call(this,o),this._points=null,this.init(r)}n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t;var e={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new B:this._points.expandEnvelope(new B)},t.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},t.prototype.getSortIndex=function(){return n.SORTINDEX_LINESTRING},t.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},t.prototype.equalsExact=function(){var r=this;if(arguments.length===2){var o=arguments[0],s=arguments[1];if(!this.isEquivalentClass(o))return!1;var l=o;if(this._points.size()!==l._points.size())return!1;for(var a=0;a<this._points.size();a++)if(!r.equal(r._points.getCoordinate(a),l._points.getCoordinate(a),s))return!1;return!0}else return n.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var r=this,o=0;o<Math.trunc(this._points.size()/2);o++){var s=r._points.size()-1-o;if(!r._points.getCoordinate(o).equals(r._points.getCoordinate(s)))return r._points.getCoordinate(o).compareTo(r._points.getCoordinate(s))>0&&Ct.reverse(r._points),null}},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?Z.FALSE:0},t.prototype.isClosed=function(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},t.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},t.prototype.getDimension=function(){return 1},t.prototype.getLength=function(){return M.computeLength(this._points)},t.prototype.getNumPoints=function(){return this._points.size()},t.prototype.reverse=function(){var r=this._points.copy();Ct.reverse(r);var o=this.getFactory().createLineString(r);return o},t.prototype.compareToSameClass=function(){var r=this;if(arguments.length===1){for(var o=arguments[0],s=o,l=0,a=0;l<this._points.size()&&a<s._points.size();){var h=r._points.getCoordinate(l).compareTo(s._points.getCoordinate(a));if(h!==0)return h;l++,a++}return l<this._points.size()?1:a<s._points.size()?-1:0}else if(arguments.length===2){var y=arguments[0],C=arguments[1],L=y;return C.compare(this._points,L._points)}},t.prototype.apply=function(){var r=this;if(V(arguments[0],Ln))for(var o=arguments[0],s=0;s<this._points.size();s++)o.filter(r._points.getCoordinate(s));else if(V(arguments[0],Ye)){var l=arguments[0];if(this._points.size()===0)return null;for(var a=0;a<this._points.size()&&(l.filter(r._points,a),!l.isDone());a++);l.isGeometryChanged()&&this.geometryChanged()}else if(V(arguments[0],cn)){var h=arguments[0];h.filter(this)}else if(V(arguments[0],Zn)){var y=arguments[0];y.filter(this)}},t.prototype.getBoundary=function(){return new Oe(this).getBoundary()},t.prototype.isEquivalentClass=function(r){return r instanceof t},t.prototype.clone=function(){var r=n.prototype.clone.call(this);return r._points=this._points.clone(),r},t.prototype.getCoordinateN=function(r){return this._points.getCoordinate(r)},t.prototype.getGeometryType=function(){return"LineString"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._points},t.prototype.isEmpty=function(){return this._points.size()===0},t.prototype.init=function(r){if(r===null&&(r=this.getFactory().getCoordinateSequenceFactory().create([])),r.size()===1)throw new ft("Invalid number of points in LineString (found "+r.size()+" - must be 0 or >= 2)");this._points=r},t.prototype.isCoordinate=function(r){for(var o=this,s=0;s<this._points.size();s++)if(o._points.getCoordinate(s).equals(r))return!0;return!1},t.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},t.prototype.getPointN=function(r){return this.getFactory().createPoint(this._points.getCoordinate(r))},t.prototype.interfaces_=function(){return[oo]},t.prototype.getClass=function(){return t},e.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(t,e),t}(G),so=function(){};so.prototype.interfaces_=function(){return[]};so.prototype.getClass=function(){return so};var de=function(n){function t(r,o){n.call(this,o),this._coordinates=r||null,this.init(this._coordinates)}n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t;var e={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new B;var r=new B;return r.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),r},t.prototype.getSortIndex=function(){return n.SORTINDEX_POINT},t.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},t.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],o=arguments[1];return this.isEquivalentClass(r)?this.isEmpty()&&r.isEmpty()?!0:this.isEmpty()!==r.isEmpty()?!1:this.equal(r.getCoordinate(),this.getCoordinate(),o):!1}else return n.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){},t.prototype.getCoordinate=function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null},t.prototype.getBoundaryDimension=function(){return Z.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getNumPoints=function(){return this.isEmpty()?0:1},t.prototype.reverse=function(){return this.copy()},t.prototype.getX=function(){if(this.getCoordinate()===null)throw new Error("getX called on empty Point");return this.getCoordinate().x},t.prototype.compareToSameClass=function(){if(arguments.length===1){var r=arguments[0],o=r;return this.getCoordinate().compareTo(o.getCoordinate())}else if(arguments.length===2){var s=arguments[0],l=arguments[1],a=s;return l.compare(this._coordinates,a._coordinates)}},t.prototype.apply=function(){if(V(arguments[0],Ln)){var r=arguments[0];if(this.isEmpty())return null;r.filter(this.getCoordinate())}else if(V(arguments[0],Ye)){var o=arguments[0];if(this.isEmpty())return null;o.filter(this._coordinates,0),o.isGeometryChanged()&&this.geometryChanged()}else if(V(arguments[0],cn)){var s=arguments[0];s.filter(this)}else if(V(arguments[0],Zn)){var l=arguments[0];l.filter(this)}},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.clone=function(){var r=n.prototype.clone.call(this);return r._coordinates=this._coordinates.clone(),r},t.prototype.getGeometryType=function(){return"Point"},t.prototype.copy=function(){return new t(this._coordinates.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._coordinates},t.prototype.getY=function(){if(this.getCoordinate()===null)throw new Error("getY called on empty Point");return this.getCoordinate().y},t.prototype.isEmpty=function(){return this._coordinates.size()===0},t.prototype.init=function(r){r===null&&(r=this.getFactory().getCoordinateSequenceFactory().create([])),q.isTrue(r.size()<=1),this._coordinates=r},t.prototype.isSimple=function(){return!0},t.prototype.interfaces_=function(){return[so]},t.prototype.getClass=function(){return t},e.serialVersionUID.get=function(){return 4902022702746615e3},Object.defineProperties(t,e),t}(G),fr=function(){};fr.prototype.interfaces_=function(){return[]};fr.prototype.getClass=function(){return fr};var Ot=function(n){function t(r,o,s){if(n.call(this,s),this._shell=null,this._holes=null,r===null&&(r=this.getFactory().createLinearRing()),o===null&&(o=[]),n.hasNullElements(o))throw new ft("holes must not contain null elements");if(r.isEmpty()&&n.hasNonEmptyElements(o))throw new ft("shell is empty but holes are not");this._shell=r,this._holes=o}n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t;var e={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},t.prototype.getSortIndex=function(){return n.SORTINDEX_POLYGON},t.prototype.getCoordinates=function(){var r=this;if(this.isEmpty())return[];for(var o=new Array(this.getNumPoints()).fill(null),s=-1,l=this._shell.getCoordinates(),a=0;a<l.length;a++)s++,o[s]=l[a];for(var h=0;h<this._holes.length;h++)for(var y=r._holes[h].getCoordinates(),C=0;C<y.length;C++)s++,o[s]=y[C];return o},t.prototype.getArea=function(){var r=this,o=0;o+=Math.abs(M.signedArea(this._shell.getCoordinateSequence()));for(var s=0;s<this._holes.length;s++)o-=Math.abs(M.signedArea(r._holes[s].getCoordinateSequence()));return o},t.prototype.isRectangle=function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var r=this._shell.getCoordinateSequence(),o=this.getEnvelopeInternal(),s=0;s<5;s++){var l=r.getX(s);if(!(l===o.getMinX()||l===o.getMaxX()))return!1;var a=r.getY(s);if(!(a===o.getMinY()||a===o.getMaxY()))return!1}for(var h=r.getX(0),y=r.getY(0),C=1;C<=4;C++){var L=r.getX(C),Y=r.getY(C),ze=L!==h,Bt=Y!==y;if(ze===Bt)return!1;h=L,y=Y}return!0},t.prototype.equalsExact=function(){var r=this;if(arguments.length===2){var o=arguments[0],s=arguments[1];if(!this.isEquivalentClass(o))return!1;var l=o,a=this._shell,h=l._shell;if(!a.equalsExact(h,s)||this._holes.length!==l._holes.length)return!1;for(var y=0;y<this._holes.length;y++)if(!r._holes[y].equalsExact(l._holes[y],s))return!1;return!0}else return n.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){var r=this;if(arguments.length===0){this.normalize(this._shell,!0);for(var o=0;o<this._holes.length;o++)r.normalize(r._holes[o],!1);Lr.sort(this._holes)}else if(arguments.length===2){var s=arguments[0],l=arguments[1];if(s.isEmpty())return null;var a=new Array(s.getCoordinates().length-1).fill(null);qt.arraycopy(s.getCoordinates(),0,a,0,a.length);var h=j.minCoordinate(s.getCoordinates());j.scroll(a,h),qt.arraycopy(a,0,s.getCoordinates(),0,a.length),s.getCoordinates()[a.length]=a[0],M.isCCW(s.getCoordinates())===l&&j.reverse(s.getCoordinates())}},t.prototype.getCoordinate=function(){return this._shell.getCoordinate()},t.prototype.getNumInteriorRing=function(){return this._holes.length},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.getLength=function(){var r=this,o=0;o+=this._shell.getLength();for(var s=0;s<this._holes.length;s++)o+=r._holes[s].getLength();return o},t.prototype.getNumPoints=function(){for(var r=this,o=this._shell.getNumPoints(),s=0;s<this._holes.length;s++)o+=r._holes[s].getNumPoints();return o},t.prototype.reverse=function(){var r=this,o=this.copy();o._shell=this._shell.copy().reverse(),o._holes=new Array(this._holes.length).fill(null);for(var s=0;s<this._holes.length;s++)o._holes[s]=r._holes[s].copy().reverse();return o},t.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},t.prototype.compareToSameClass=function(){var r=this;if(arguments.length===1){var o=arguments[0],s=this._shell,l=o._shell;return s.compareToSameClass(l)}else if(arguments.length===2){var a=arguments[0],h=arguments[1],y=a,C=this._shell,L=y._shell,Y=C.compareToSameClass(L,h);if(Y!==0)return Y;for(var ze=this.getNumInteriorRing(),Bt=y.getNumInteriorRing(),Ir=0;Ir<ze&&Ir<Bt;){var Wr=r.getInteriorRingN(Ir),yi=y.getInteriorRingN(Ir),Bn=Wr.compareToSameClass(yi,h);if(Bn!==0)return Bn;Ir++}return Ir<ze?1:Ir<Bt?-1:0}},t.prototype.apply=function(r){var o=this;if(V(r,Ln)){this._shell.apply(r);for(var s=0;s<this._holes.length;s++)o._holes[s].apply(r)}else if(V(r,Ye)){if(this._shell.apply(r),!r.isDone())for(var l=0;l<this._holes.length&&(o._holes[l].apply(r),!r.isDone());l++);r.isGeometryChanged()&&this.geometryChanged()}else if(V(r,cn))r.filter(this);else if(V(r,Zn)){r.filter(this),this._shell.apply(r);for(var a=0;a<this._holes.length;a++)o._holes[a].apply(r)}},t.prototype.getBoundary=function(){var r=this;if(this.isEmpty())return this.getFactory().createMultiLineString();var o=new Array(this._holes.length+1).fill(null);o[0]=this._shell;for(var s=0;s<this._holes.length;s++)o[s+1]=r._holes[s];return o.length<=1?this.getFactory().createLinearRing(o[0].getCoordinateSequence()):this.getFactory().createMultiLineString(o)},t.prototype.clone=function(){var r=this,o=n.prototype.clone.call(this);o._shell=this._shell.clone(),o._holes=new Array(this._holes.length).fill(null);for(var s=0;s<this._holes.length;s++)o._holes[s]=r._holes[s].clone();return o},t.prototype.getGeometryType=function(){return"Polygon"},t.prototype.copy=function(){for(var r=this,o=this._shell.copy(),s=new Array(this._holes.length).fill(null),l=0;l<s.length;l++)s[l]=r._holes[l].copy();return new t(o,s,this._factory)},t.prototype.getExteriorRing=function(){return this._shell},t.prototype.isEmpty=function(){return this._shell.isEmpty()},t.prototype.getInteriorRingN=function(r){return this._holes[r]},t.prototype.interfaces_=function(){return[fr]},t.prototype.getClass=function(){return t},e.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(t,e),t}(G),Pi=function(n){function t(){n.apply(this,arguments)}n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t;var e={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return G.SORTINDEX_MULTIPOINT},t.prototype.isValid=function(){return!0},t.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],o=arguments[1];return this.isEquivalentClass(r)?n.prototype.equalsExact.call(this,r,o):!1}else return n.prototype.equalsExact.apply(this,arguments)},t.prototype.getCoordinate=function(){if(arguments.length===1){var r=arguments[0];return this._geometries[r].getCoordinate()}else return n.prototype.getCoordinate.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return Z.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.getGeometryType=function(){return"MultiPoint"},t.prototype.copy=function(){for(var r=this,o=new Array(this._geometries.length).fill(null),s=0;s<o.length;s++)o[s]=r._geometries[s].copy();return new t(o,this._factory)},t.prototype.interfaces_=function(){return[so]},t.prototype.getClass=function(){return t},e.serialVersionUID.get=function(){return-8048474874175356e3},Object.defineProperties(t,e),t}(ie),bn=function(n){function t(r,o){r instanceof d&&o instanceof H&&(r=o.getCoordinateSequenceFactory().create(r)),n.call(this,r,o),this.validateConstruction()}n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t;var e={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return G.SORTINDEX_LINEARRING},t.prototype.getBoundaryDimension=function(){return Z.FALSE},t.prototype.isClosed=function(){return this.isEmpty()?!0:n.prototype.isClosed.call(this)},t.prototype.reverse=function(){var r=this._points.copy();Ct.reverse(r);var o=this.getFactory().createLinearRing(r);return o},t.prototype.validateConstruction=function(){if(!this.isEmpty()&&!n.prototype.isClosed.call(this))throw new ft("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<t.MINIMUM_VALID_SIZE)throw new ft("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},t.prototype.getGeometryType=function(){return"LinearRing"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},e.MINIMUM_VALID_SIZE.get=function(){return 4},e.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(t,e),t}(yt),Sn=function(n){function t(){n.apply(this,arguments)}n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t;var e={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return G.SORTINDEX_MULTIPOLYGON},t.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],o=arguments[1];return this.isEquivalentClass(r)?n.prototype.equalsExact.call(this,r,o):!1}else return n.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.reverse=function(){for(var r=this,o=this._geometries.length,s=new Array(o).fill(null),l=0;l<this._geometries.length;l++)s[l]=r._geometries[l].reverse();return this.getFactory().createMultiPolygon(s)},t.prototype.getBoundary=function(){var r=this;if(this.isEmpty())return this.getFactory().createMultiLineString();for(var o=new O,s=0;s<this._geometries.length;s++)for(var l=r._geometries[s],a=l.getBoundary(),h=0;h<a.getNumGeometries();h++)o.add(a.getGeometryN(h));var y=new Array(o.size()).fill(null);return this.getFactory().createMultiLineString(o.toArray(y))},t.prototype.getGeometryType=function(){return"MultiPolygon"},t.prototype.copy=function(){for(var r=this,o=new Array(this._geometries.length).fill(null),s=0;s<o.length;s++)o[s]=r._geometries[s].copy();return new t(o,this._factory)},t.prototype.interfaces_=function(){return[fr]},t.prototype.getClass=function(){return t},e.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(t,e),t}(ie),Fe=function(n){this._factory=n||null,this._isUserDataCopied=!1},is={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};Fe.prototype.setCopyUserData=function(n){this._isUserDataCopied=n};Fe.prototype.edit=function(n,t){if(n===null)return null;var e=this.editInternal(n,t);return this._isUserDataCopied&&e.setUserData(n.getUserData()),e};Fe.prototype.editInternal=function(n,t){return this._factory===null&&(this._factory=n.getFactory()),n instanceof ie?this.editGeometryCollection(n,t):n instanceof Ot?this.editPolygon(n,t):n instanceof de?t.edit(n,this._factory):n instanceof yt?t.edit(n,this._factory):(q.shouldNeverReachHere("Unsupported Geometry class: "+n.getClass().getName()),null)};Fe.prototype.editGeometryCollection=function(n,t){for(var e=this,r=t.edit(n,this._factory),o=new O,s=0;s<r.getNumGeometries();s++){var l=e.edit(r.getGeometryN(s),t);l===null||l.isEmpty()||o.add(l)}return r.getClass()===Pi?this._factory.createMultiPoint(o.toArray([])):r.getClass()===Tr?this._factory.createMultiLineString(o.toArray([])):r.getClass()===Sn?this._factory.createMultiPolygon(o.toArray([])):this._factory.createGeometryCollection(o.toArray([]))};Fe.prototype.editPolygon=function(n,t){var e=this,r=t.edit(n,this._factory);if(r===null&&(r=this._factory.createPolygon(null)),r.isEmpty())return r;var o=this.edit(r.getExteriorRing(),t);if(o===null||o.isEmpty())return this._factory.createPolygon();for(var s=new O,l=0;l<r.getNumInteriorRing();l++){var a=e.edit(r.getInteriorRingN(l),t);a===null||a.isEmpty()||s.add(a)}return this._factory.createPolygon(o,s.toArray([]))};Fe.prototype.interfaces_=function(){return[]};Fe.prototype.getClass=function(){return Fe};Fe.GeometryEditorOperation=function(){};is.NoOpGeometryOperation.get=function(){return ao};is.CoordinateOperation.get=function(){return uo};is.CoordinateSequenceOperation.get=function(){return lo};Object.defineProperties(Fe,is);var ao=function(){};ao.prototype.edit=function(n,t){return n};ao.prototype.interfaces_=function(){return[Fe.GeometryEditorOperation]};ao.prototype.getClass=function(){return ao};var uo=function(){};uo.prototype.edit=function(n,t){var e=this.editCoordinates(n.getCoordinates(),n);return e===null?n:n instanceof bn?t.createLinearRing(e):n instanceof yt?t.createLineString(e):n instanceof de?e.length>0?t.createPoint(e[0]):t.createPoint():n};uo.prototype.interfaces_=function(){return[Fe.GeometryEditorOperation]};uo.prototype.getClass=function(){return uo};var lo=function(){};lo.prototype.edit=function(n,t){return n instanceof bn?t.createLinearRing(this.edit(n.getCoordinateSequence(),n)):n instanceof yt?t.createLineString(this.edit(n.getCoordinateSequence(),n)):n instanceof de?t.createPoint(this.edit(n.getCoordinateSequence(),n)):n};lo.prototype.interfaces_=function(){return[Fe.GeometryEditorOperation]};lo.prototype.getClass=function(){return lo};var _t=function(){var n=this;if(this._dimension=3,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var t=arguments[0];this._coordinates=new Array(t).fill(null);for(var e=0;e<t;e++)n._coordinates[e]=new d}else if(V(arguments[0],Q)){var r=arguments[0];if(r===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=r.getDimension(),this._coordinates=new Array(r.size()).fill(null);for(var o=0;o<this._coordinates.length;o++)n._coordinates[o]=r.getCoordinateCopy(o)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var s=arguments[0],l=arguments[1];this._coordinates=s,this._dimension=l,s===null&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var a=arguments[0],h=arguments[1];this._coordinates=new Array(a).fill(null),this._dimension=h;for(var y=0;y<a;y++)n._coordinates[y]=new d}}},Iu={serialVersionUID:{configurable:!0}};_t.prototype.setOrdinate=function(n,t,e){switch(t){case Q.X:this._coordinates[n].x=e;break;case Q.Y:this._coordinates[n].y=e;break;case Q.Z:this._coordinates[n].z=e;break;default:throw new ft("invalid ordinateIndex")}};_t.prototype.size=function(){return this._coordinates.length};_t.prototype.getOrdinate=function(n,t){switch(t){case Q.X:return this._coordinates[n].x;case Q.Y:return this._coordinates[n].y;case Q.Z:return this._coordinates[n].z}return z.NaN};_t.prototype.getCoordinate=function(){if(arguments.length===1){var n=arguments[0];return this._coordinates[n]}else if(arguments.length===2){var t=arguments[0],e=arguments[1];e.x=this._coordinates[t].x,e.y=this._coordinates[t].y,e.z=this._coordinates[t].z}};_t.prototype.getCoordinateCopy=function(n){return new d(this._coordinates[n])};_t.prototype.getDimension=function(){return this._dimension};_t.prototype.getX=function(n){return this._coordinates[n].x};_t.prototype.clone=function(){for(var n=this,t=new Array(this.size()).fill(null),e=0;e<this._coordinates.length;e++)t[e]=n._coordinates[e].clone();return new _t(t,this._dimension)};_t.prototype.expandEnvelope=function(n){for(var t=this,e=0;e<this._coordinates.length;e++)n.expandToInclude(t._coordinates[e]);return n};_t.prototype.copy=function(){for(var n=this,t=new Array(this.size()).fill(null),e=0;e<this._coordinates.length;e++)t[e]=n._coordinates[e].copy();return new _t(t,this._dimension)};_t.prototype.toString=function(){var n=this;if(this._coordinates.length>0){var t=new _n(17*this._coordinates.length);t.append("("),t.append(this._coordinates[0]);for(var e=1;e<this._coordinates.length;e++)t.append(", "),t.append(n._coordinates[e]);return t.append(")"),t.toString()}else return"()"};_t.prototype.getY=function(n){return this._coordinates[n].y};_t.prototype.toCoordinateArray=function(){return this._coordinates};_t.prototype.interfaces_=function(){return[Q,Ge]};_t.prototype.getClass=function(){return _t};Iu.serialVersionUID.get=function(){return-0xcb44a778db18e00};Object.defineProperties(_t,Iu);var Pn=function(){},Ws={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};Pn.prototype.readResolve=function(){return Pn.instance()};Pn.prototype.create=function(){if(arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];return new _t(n)}else if(V(arguments[0],Q)){var t=arguments[0];return new _t(t)}}else if(arguments.length===2){var e=arguments[0],r=arguments[1];return r>3&&(r=3),r<2?new _t(e):new _t(e,r)}};Pn.prototype.interfaces_=function(){return[Ni,Ge]};Pn.prototype.getClass=function(){return Pn};Pn.instance=function(){return Pn.instanceObject};Ws.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00};Ws.instanceObject.get=function(){return new Pn};Object.defineProperties(Pn,Ws);var Cu=function(n){function t(){n.call(this),this.map_=new Map}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.get=function(e){return this.map_.get(e)||null},t.prototype.put=function(e,r){return this.map_.set(e,r),r},t.prototype.values=function(){for(var e=new O,r=this.map_.values(),o=r.next();!o.done;)e.add(o.value),o=r.next();return e},t.prototype.entrySet=function(){var e=new Xs;return this.map_.entries().forEach(function(r){return e.add(r)}),e},t.prototype.size=function(){return this.map_.size()},t}(hi),$=function n(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=n.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof fn){var t=arguments[0];this._modelType=t,t===n.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var e=arguments[0];this._modelType=n.FIXED,this.setScale(e)}else if(arguments[0]instanceof n){var r=arguments[0];this._modelType=r._modelType,this._scale=r._scale}}},Hs={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};$.prototype.equals=function(n){if(!(n instanceof $))return!1;var t=n;return this._modelType===t._modelType&&this._scale===t._scale};$.prototype.compareTo=function(n){var t=n,e=this.getMaximumSignificantDigits(),r=t.getMaximumSignificantDigits();return new un(e).compareTo(new un(r))};$.prototype.getScale=function(){return this._scale};$.prototype.isFloating=function(){return this._modelType===$.FLOATING||this._modelType===$.FLOATING_SINGLE};$.prototype.getType=function(){return this._modelType};$.prototype.toString=function(){var n="UNKNOWN";return this._modelType===$.FLOATING?n="Floating":this._modelType===$.FLOATING_SINGLE?n="Floating-Single":this._modelType===$.FIXED&&(n="Fixed (Scale="+this.getScale()+")"),n};$.prototype.makePrecise=function(){if(typeof arguments[0]=="number"){var n=arguments[0];if(z.isNaN(n))return n;if(this._modelType===$.FLOATING_SINGLE){var t=n;return t}return this._modelType===$.FIXED?Math.round(n*this._scale)/this._scale:n}else if(arguments[0]instanceof d){var e=arguments[0];if(this._modelType===$.FLOATING)return null;e.x=this.makePrecise(e.x),e.y=this.makePrecise(e.y)}};$.prototype.getMaximumSignificantDigits=function(){var n=16;return this._modelType===$.FLOATING?n=16:this._modelType===$.FLOATING_SINGLE?n=6:this._modelType===$.FIXED&&(n=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),n};$.prototype.setScale=function(n){this._scale=Math.abs(n)};$.prototype.interfaces_=function(){return[Ge,ke]};$.prototype.getClass=function(){return $};$.mostPrecise=function(n,t){return n.compareTo(t)>=0?n:t};Hs.serialVersionUID.get=function(){return 7777263578777804e3};Hs.maximumPreciseValue.get=function(){return 9007199254740992};Object.defineProperties($,Hs);var fn=function n(t){this._name=t||null,n.nameToTypeMap.put(t,this)},js={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};fn.prototype.readResolve=function(){return fn.nameToTypeMap.get(this._name)};fn.prototype.toString=function(){return this._name};fn.prototype.interfaces_=function(){return[Ge]};fn.prototype.getClass=function(){return fn};js.serialVersionUID.get=function(){return-552860263173159e4};js.nameToTypeMap.get=function(){return new Cu};Object.defineProperties(fn,js);$.Type=fn;$.FIXED=new fn("FIXED");$.FLOATING=new fn("FLOATING");$.FLOATING_SINGLE=new fn("FLOATING SINGLE");var H=function n(){this._precisionModel=new $,this._SRID=0,this._coordinateSequenceFactory=n.getDefaultCoordinateSequenceFactory(),arguments.length===0||(arguments.length===1?V(arguments[0],Ni)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof $&&(this._precisionModel=arguments[0]):arguments.length===2?(this._precisionModel=arguments[0],this._SRID=arguments[1]):arguments.length===3&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},Nu={serialVersionUID:{configurable:!0}};H.prototype.toGeometry=function(n){return n.isNull()?this.createPoint(null):n.getMinX()===n.getMaxX()&&n.getMinY()===n.getMaxY()?this.createPoint(new d(n.getMinX(),n.getMinY())):n.getMinX()===n.getMaxX()||n.getMinY()===n.getMaxY()?this.createLineString([new d(n.getMinX(),n.getMinY()),new d(n.getMaxX(),n.getMaxY())]):this.createPolygon(this.createLinearRing([new d(n.getMinX(),n.getMinY()),new d(n.getMinX(),n.getMaxY()),new d(n.getMaxX(),n.getMaxY()),new d(n.getMaxX(),n.getMinY()),new d(n.getMinX(),n.getMinY())]),null)};H.prototype.createLineString=function(n){if(n){if(n instanceof Array)return new yt(this.getCoordinateSequenceFactory().create(n),this);if(V(n,Q))return new yt(n,this)}else return new yt(this.getCoordinateSequenceFactory().create([]),this)};H.prototype.createMultiLineString=function(){if(arguments.length===0)return new Tr(null,this);if(arguments.length===1){var n=arguments[0];return new Tr(n,this)}};H.prototype.buildGeometry=function(n){for(var t=null,e=!1,r=!1,o=n.iterator();o.hasNext();){var s=o.next(),l=s.getClass();t===null&&(t=l),l!==t&&(e=!0),s.isGeometryCollectionOrDerived()&&(r=!0)}if(t===null)return this.createGeometryCollection();if(e||r)return this.createGeometryCollection(H.toGeometryArray(n));var a=n.iterator().next(),h=n.size()>1;if(h){if(a instanceof Ot)return this.createMultiPolygon(H.toPolygonArray(n));if(a instanceof yt)return this.createMultiLineString(H.toLineStringArray(n));if(a instanceof de)return this.createMultiPoint(H.toPointArray(n));q.shouldNeverReachHere("Unhandled class: "+a.getClass().getName())}return a};H.prototype.createMultiPointFromCoords=function(n){return this.createMultiPoint(n!==null?this.getCoordinateSequenceFactory().create(n):null)};H.prototype.createPoint=function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof d){var n=arguments[0];return this.createPoint(n!==null?this.getCoordinateSequenceFactory().create([n]):null)}else if(V(arguments[0],Q)){var t=arguments[0];return new de(t,this)}}};H.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory};H.prototype.createPolygon=function(){if(arguments.length===0)return new Ot(null,null,this);if(arguments.length===1){if(V(arguments[0],Q)){var n=arguments[0];return this.createPolygon(this.createLinearRing(n))}else if(arguments[0]instanceof Array){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}else if(arguments[0]instanceof bn){var e=arguments[0];return this.createPolygon(e,null)}}else if(arguments.length===2){var r=arguments[0],o=arguments[1];return new Ot(r,o,this)}};H.prototype.getSRID=function(){return this._SRID};H.prototype.createGeometryCollection=function(){if(arguments.length===0)return new ie(null,this);if(arguments.length===1){var n=arguments[0];return new ie(n,this)}};H.prototype.createGeometry=function(n){var t=new Fe(this);return t.edit(n,{edit:function(){if(arguments.length===2){var e=arguments[0];return this._coordinateSequenceFactory.create(e)}}})};H.prototype.getPrecisionModel=function(){return this._precisionModel};H.prototype.createLinearRing=function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];return this.createLinearRing(n!==null?this.getCoordinateSequenceFactory().create(n):null)}else if(V(arguments[0],Q)){var t=arguments[0];return new bn(t,this)}}};H.prototype.createMultiPolygon=function(){if(arguments.length===0)return new Sn(null,this);if(arguments.length===1){var n=arguments[0];return new Sn(n,this)}};H.prototype.createMultiPoint=function(){var n=this;if(arguments.length===0)return new Pi(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return new Pi(t,this)}else if(arguments[0]instanceof Array){var e=arguments[0];return this.createMultiPoint(e!==null?this.getCoordinateSequenceFactory().create(e):null)}else if(V(arguments[0],Q)){var r=arguments[0];if(r===null)return this.createMultiPoint(new Array(0).fill(null));for(var o=new Array(r.size()).fill(null),s=0;s<r.size();s++){var l=n.getCoordinateSequenceFactory().create(1,r.getDimension());Ct.copy(r,s,l,0,1),o[s]=n.createPoint(l)}return this.createMultiPoint(o)}}};H.prototype.interfaces_=function(){return[Ge]};H.prototype.getClass=function(){return H};H.toMultiPolygonArray=function(n){var t=new Array(n.size()).fill(null);return n.toArray(t)};H.toGeometryArray=function(n){if(n===null)return null;var t=new Array(n.size()).fill(null);return n.toArray(t)};H.getDefaultCoordinateSequenceFactory=function(){return Pn.instance()};H.toMultiLineStringArray=function(n){var t=new Array(n.size()).fill(null);return n.toArray(t)};H.toLineStringArray=function(n){var t=new Array(n.size()).fill(null);return n.toArray(t)};H.toMultiPointArray=function(n){var t=new Array(n.size()).fill(null);return n.toArray(t)};H.toLinearRingArray=function(n){var t=new Array(n.size()).fill(null);return n.toArray(t)};H.toPointArray=function(n){var t=new Array(n.size()).fill(null);return n.toArray(t)};H.toPolygonArray=function(n){var t=new Array(n.size()).fill(null);return n.toArray(t)};H.createPointFromInternalCoord=function(n,t){return t.getPrecisionModel().makePrecise(n),t.getFactory().createPoint(n)};Nu.serialVersionUID.get=function(){return-6820524753094096e3};Object.defineProperties(H,Nu);var tf=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],os=function(n){this.geometryFactory=n||new H};os.prototype.read=function(n){var t;typeof n=="string"?t=JSON.parse(n):t=n;var e=t.type;if(!en[e])throw new Error("Unknown GeoJSON type: "+t.type);return tf.indexOf(e)!==-1?en[e].apply(this,[t.coordinates]):e==="GeometryCollection"?en[e].apply(this,[t.geometries]):en[e].apply(this,[t])};os.prototype.write=function(n){var t=n.getGeometryType();if(!Xn[t])throw new Error("Geometry is not supported");return Xn[t].apply(this,[n])};var en={Feature:function(n){var t={};for(var e in n)t[e]=n[e];if(n.geometry){var r=n.geometry.type;if(!en[r])throw new Error("Unknown GeoJSON type: "+n.type);t.geometry=this.read(n.geometry)}return n.bbox&&(t.bbox=en.bbox.apply(this,[n.bbox])),t},FeatureCollection:function(n){var t=this,e={};if(n.features){e.features=[];for(var r=0;r<n.features.length;++r)e.features.push(t.read(n.features[r]))}return n.bbox&&(e.bbox=this.parse.bbox.apply(this,[n.bbox])),e},coordinates:function(n){for(var t=[],e=0;e<n.length;++e){var r=n[e];t.push(new d(r[0],r[1]))}return t},bbox:function(n){return this.geometryFactory.createLinearRing([new d(n[0],n[1]),new d(n[2],n[1]),new d(n[2],n[3]),new d(n[0],n[3]),new d(n[0],n[1])])},Point:function(n){var t=new d(n[0],n[1]);return this.geometryFactory.createPoint(t)},MultiPoint:function(n){for(var t=this,e=[],r=0;r<n.length;++r)e.push(en.Point.apply(t,[n[r]]));return this.geometryFactory.createMultiPoint(e)},LineString:function(n){var t=en.coordinates.apply(this,[n]);return this.geometryFactory.createLineString(t)},MultiLineString:function(n){for(var t=this,e=[],r=0;r<n.length;++r)e.push(en.LineString.apply(t,[n[r]]));return this.geometryFactory.createMultiLineString(e)},Polygon:function(n){for(var t=this,e=en.coordinates.apply(this,[n[0]]),r=this.geometryFactory.createLinearRing(e),o=[],s=1;s<n.length;++s){var l=n[s],a=en.coordinates.apply(t,[l]),h=t.geometryFactory.createLinearRing(a);o.push(h)}return this.geometryFactory.createPolygon(r,o)},MultiPolygon:function(n){for(var t=this,e=[],r=0;r<n.length;++r){var o=n[r];e.push(en.Polygon.apply(t,[o]))}return this.geometryFactory.createMultiPolygon(e)},GeometryCollection:function(n){for(var t=this,e=[],r=0;r<n.length;++r){var o=n[r];e.push(t.read(o))}return this.geometryFactory.createGeometryCollection(e)}},Xn={coordinate:function(n){return[n.x,n.y]},Point:function(n){var t=Xn.coordinate.apply(this,[n.getCoordinate()]);return{type:"Point",coordinates:t}},MultiPoint:function(n){for(var t=this,e=[],r=0;r<n._geometries.length;++r){var o=n._geometries[r],s=Xn.Point.apply(t,[o]);e.push(s.coordinates)}return{type:"MultiPoint",coordinates:e}},LineString:function(n){for(var t=this,e=[],r=n.getCoordinates(),o=0;o<r.length;++o){var s=r[o];e.push(Xn.coordinate.apply(t,[s]))}return{type:"LineString",coordinates:e}},MultiLineString:function(n){for(var t=this,e=[],r=0;r<n._geometries.length;++r){var o=n._geometries[r],s=Xn.LineString.apply(t,[o]);e.push(s.coordinates)}return{type:"MultiLineString",coordinates:e}},Polygon:function(n){var t=this,e=[],r=Xn.LineString.apply(this,[n._shell]);e.push(r.coordinates);for(var o=0;o<n._holes.length;++o){var s=n._holes[o],l=Xn.LineString.apply(t,[s]);e.push(l.coordinates)}return{type:"Polygon",coordinates:e}},MultiPolygon:function(n){for(var t=this,e=[],r=0;r<n._geometries.length;++r){var o=n._geometries[r],s=Xn.Polygon.apply(t,[o]);e.push(s.coordinates)}return{type:"MultiPolygon",coordinates:e}},GeometryCollection:function(n){for(var t=this,e=[],r=0;r<n._geometries.length;++r){var o=n._geometries[r],s=o.getGeometryType();e.push(Xn[s].apply(t,[o]))}return{type:"GeometryCollection",geometries:e}}},Ks=function(n){this.geometryFactory=n||new H,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new os(this.geometryFactory)};Ks.prototype.read=function(n){var t=this.parser.read(n);return this.precisionModel.getType()===$.FIXED&&this.reducePrecision(t),t};Ks.prototype.reducePrecision=function(n){var t=this,e,r;if(n.coordinate)this.precisionModel.makePrecise(n.coordinate);else if(n.points)for(e=0,r=n.points.length;e<r;e++)t.precisionModel.makePrecise(n.points[e]);else if(n.geometries)for(e=0,r=n.geometries.length;e<r;e++)t.reducePrecision(n.geometries[e])};var xu=function(){this.parser=new os(this.geometryFactory)};xu.prototype.write=function(n){return this.parser.write(n)};var b=function(){},ss={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};b.prototype.interfaces_=function(){return[]};b.prototype.getClass=function(){return b};b.opposite=function(n){return n===b.LEFT?b.RIGHT:n===b.RIGHT?b.LEFT:n};ss.ON.get=function(){return 0};ss.LEFT.get=function(){return 1};ss.RIGHT.get=function(){return 2};Object.defineProperties(b,ss);function as(n){this.message=n||""}as.prototype=new Error;as.prototype.name="EmptyStackException";function En(){this.array_=[]}En.prototype=new qe;En.prototype.add=function(n){return this.array_.push(n),!0};En.prototype.get=function(n){if(n<0||n>=this.size())throw new Error;return this.array_[n]};En.prototype.push=function(n){return this.array_.push(n),n};En.prototype.pop=function(n){if(this.array_.length===0)throw new as;return this.array_.pop()};En.prototype.peek=function(){if(this.array_.length===0)throw new as;return this.array_[this.array_.length-1]};En.prototype.empty=function(){return this.array_.length===0};En.prototype.isEmpty=function(){return this.empty()};En.prototype.search=function(n){return this.array_.indexOf(n)};En.prototype.size=function(){return this.array_.length};En.prototype.toArray=function(){for(var n=this,t=[],e=0,r=this.array_.length;e<r;e++)t.push(n.array_[e]);return t};var hn=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};hn.prototype.getCoordinate=function(){return this._minCoord};hn.prototype.getRightmostSide=function(n,t){var e=this.getRightmostSideOfSegment(n,t);return e<0&&(e=this.getRightmostSideOfSegment(n,t-1)),e<0&&(this._minCoord=null,this.checkForRightmostCoordinate(n)),e};hn.prototype.findRightmostEdgeAtVertex=function(){var n=this._minDe.getEdge().getCoordinates();q.isTrue(this._minIndex>0&&this._minIndex<n.length,"rightmost point expected to be interior vertex of edge");var t=n[this._minIndex-1],e=n[this._minIndex+1],r=M.computeOrientation(this._minCoord,e,t),o=!1;(t.y<this._minCoord.y&&e.y<this._minCoord.y&&r===M.COUNTERCLOCKWISE||t.y>this._minCoord.y&&e.y>this._minCoord.y&&r===M.CLOCKWISE)&&(o=!0),o&&(this._minIndex=this._minIndex-1)};hn.prototype.getRightmostSideOfSegment=function(n,t){var e=n.getEdge(),r=e.getCoordinates();if(t<0||t+1>=r.length||r[t].y===r[t+1].y)return-1;var o=b.LEFT;return r[t].y<r[t+1].y&&(o=b.RIGHT),o};hn.prototype.getEdge=function(){return this._orientedDe};hn.prototype.checkForRightmostCoordinate=function(n){for(var t=this,e=n.getEdge().getCoordinates(),r=0;r<e.length-1;r++)(t._minCoord===null||e[r].x>t._minCoord.x)&&(t._minDe=n,t._minIndex=r,t._minCoord=e[r])};hn.prototype.findRightmostEdgeAtNode=function(){var n=this._minDe.getNode(),t=n.getEdges();this._minDe=t.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)};hn.prototype.findEdge=function(n){for(var t=this,e=n.iterator();e.hasNext();){var r=e.next();r.isForward()&&t.checkForRightmostCoordinate(r)}q.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;var o=this.getRightmostSide(this._minDe,this._minIndex);o===b.LEFT&&(this._orientedDe=this._minDe.getSym())};hn.prototype.interfaces_=function(){return[]};hn.prototype.getClass=function(){return hn};var Jn=function(n){function t(e,r){n.call(this,t.msgWithCoord(e,r)),this.pt=r?new d(r):null,this.name="TopologyException"}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.getCoordinate=function(){return this.pt},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.msgWithCoord=function(e,r){return r?e:e+" [ "+r+" ]"},t}(Qn),us=function(){this.array_=[]};us.prototype.addLast=function(n){this.array_.push(n)};us.prototype.removeFirst=function(){return this.array_.shift()};us.prototype.isEmpty=function(){return this.array_.length===0};var oe=function(){this._finder=null,this._dirEdgeList=new O,this._nodes=new O,this._rightMostCoord=null,this._env=null,this._finder=new hn};oe.prototype.clearVisitedEdges=function(){for(var n=this._dirEdgeList.iterator();n.hasNext();){var t=n.next();t.setVisited(!1)}};oe.prototype.getRightmostCoordinate=function(){return this._rightMostCoord};oe.prototype.computeNodeDepth=function(n){for(var t=this,e=null,r=n.getEdges().iterator();r.hasNext();){var o=r.next();if(o.isVisited()||o.getSym().isVisited()){e=o;break}}if(e===null)throw new Jn("unable to find edge to compute depths at "+n.getCoordinate());n.getEdges().computeDepths(e);for(var s=n.getEdges().iterator();s.hasNext();){var l=s.next();l.setVisited(!0),t.copySymDepths(l)}};oe.prototype.computeDepth=function(n){this.clearVisitedEdges();var t=this._finder.getEdge();t.setEdgeDepths(b.RIGHT,n),this.copySymDepths(t),this.computeDepths(t)};oe.prototype.create=function(n){this.addReachable(n),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()};oe.prototype.findResultEdges=function(){for(var n=this._dirEdgeList.iterator();n.hasNext();){var t=n.next();t.getDepth(b.RIGHT)>=1&&t.getDepth(b.LEFT)<=0&&!t.isInteriorAreaEdge()&&t.setInResult(!0)}};oe.prototype.computeDepths=function(n){var t=this,e=new Xs,r=new us,o=n.getNode();for(r.addLast(o),e.add(o),n.setVisited(!0);!r.isEmpty();){var s=r.removeFirst();e.add(s),t.computeNodeDepth(s);for(var l=s.getEdges().iterator();l.hasNext();){var a=l.next(),h=a.getSym();if(!h.isVisited()){var y=h.getNode();e.contains(y)||(r.addLast(y),e.add(y))}}}};oe.prototype.compareTo=function(n){var t=n;return this._rightMostCoord.x<t._rightMostCoord.x?-1:this._rightMostCoord.x>t._rightMostCoord.x?1:0};oe.prototype.getEnvelope=function(){if(this._env===null){for(var n=new B,t=this._dirEdgeList.iterator();t.hasNext();)for(var e=t.next(),r=e.getEdge().getCoordinates(),o=0;o<r.length-1;o++)n.expandToInclude(r[o]);this._env=n}return this._env};oe.prototype.addReachable=function(n){var t=this,e=new En;for(e.add(n);!e.empty();){var r=e.pop();t.add(r,e)}};oe.prototype.copySymDepths=function(n){var t=n.getSym();t.setDepth(b.LEFT,n.getDepth(b.RIGHT)),t.setDepth(b.RIGHT,n.getDepth(b.LEFT))};oe.prototype.add=function(n,t){var e=this;n.setVisited(!0),this._nodes.add(n);for(var r=n.getEdges().iterator();r.hasNext();){var o=r.next();e._dirEdgeList.add(o);var s=o.getSym(),l=s.getNode();l.isVisited()||t.push(l)}};oe.prototype.getNodes=function(){return this._nodes};oe.prototype.getDirectedEdges=function(){return this._dirEdgeList};oe.prototype.interfaces_=function(){return[ke]};oe.prototype.getClass=function(){return oe};var at=function n(){var t=this;if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];this.init(e.length)}else if(Number.isInteger(arguments[0])){var r=arguments[0];this.init(1),this.location[b.ON]=r}else if(arguments[0]instanceof n){var o=arguments[0];if(this.init(o.location.length),o!==null)for(var s=0;s<this.location.length;s++)t.location[s]=o.location[s]}}else if(arguments.length===3){var l=arguments[0],a=arguments[1],h=arguments[2];this.init(3),this.location[b.ON]=l,this.location[b.LEFT]=a,this.location[b.RIGHT]=h}};at.prototype.setAllLocations=function(n){for(var t=this,e=0;e<this.location.length;e++)t.location[e]=n};at.prototype.isNull=function(){for(var n=this,t=0;t<this.location.length;t++)if(n.location[t]!==E.NONE)return!1;return!0};at.prototype.setAllLocationsIfNull=function(n){for(var t=this,e=0;e<this.location.length;e++)t.location[e]===E.NONE&&(t.location[e]=n)};at.prototype.isLine=function(){return this.location.length===1};at.prototype.merge=function(n){var t=this;if(n.location.length>this.location.length){var e=new Array(3).fill(null);e[b.ON]=this.location[b.ON],e[b.LEFT]=E.NONE,e[b.RIGHT]=E.NONE,this.location=e}for(var r=0;r<this.location.length;r++)t.location[r]===E.NONE&&r<n.location.length&&(t.location[r]=n.location[r])};at.prototype.getLocations=function(){return this.location};at.prototype.flip=function(){if(this.location.length<=1)return null;var n=this.location[b.LEFT];this.location[b.LEFT]=this.location[b.RIGHT],this.location[b.RIGHT]=n};at.prototype.toString=function(){var n=new _n;return this.location.length>1&&n.append(E.toLocationSymbol(this.location[b.LEFT])),n.append(E.toLocationSymbol(this.location[b.ON])),this.location.length>1&&n.append(E.toLocationSymbol(this.location[b.RIGHT])),n.toString()};at.prototype.setLocations=function(n,t,e){this.location[b.ON]=n,this.location[b.LEFT]=t,this.location[b.RIGHT]=e};at.prototype.get=function(n){return n<this.location.length?this.location[n]:E.NONE};at.prototype.isArea=function(){return this.location.length>1};at.prototype.isAnyNull=function(){for(var n=this,t=0;t<this.location.length;t++)if(n.location[t]===E.NONE)return!0;return!1};at.prototype.setLocation=function(){if(arguments.length===1){var n=arguments[0];this.setLocation(b.ON,n)}else if(arguments.length===2){var t=arguments[0],e=arguments[1];this.location[t]=e}};at.prototype.init=function(n){this.location=new Array(n).fill(null),this.setAllLocations(E.NONE)};at.prototype.isEqualOnSide=function(n,t){return this.location[t]===n.location[t]};at.prototype.allPositionsEqual=function(n){for(var t=this,e=0;e<this.location.length;e++)if(t.location[e]!==n)return!1;return!0};at.prototype.interfaces_=function(){return[]};at.prototype.getClass=function(){return at};var et=function n(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new at(t),this.elt[1]=new at(t)}else if(arguments[0]instanceof n){var e=arguments[0];this.elt[0]=new at(e.elt[0]),this.elt[1]=new at(e.elt[1])}}else if(arguments.length===2){var r=arguments[0],o=arguments[1];this.elt[0]=new at(E.NONE),this.elt[1]=new at(E.NONE),this.elt[r].setLocation(o)}else if(arguments.length===3){var s=arguments[0],l=arguments[1],a=arguments[2];this.elt[0]=new at(s,l,a),this.elt[1]=new at(s,l,a)}else if(arguments.length===4){var h=arguments[0],y=arguments[1],C=arguments[2],L=arguments[3];this.elt[0]=new at(E.NONE,E.NONE,E.NONE),this.elt[1]=new at(E.NONE,E.NONE,E.NONE),this.elt[h].setLocations(y,C,L)}};et.prototype.getGeometryCount=function(){var n=0;return this.elt[0].isNull()||n++,this.elt[1].isNull()||n++,n};et.prototype.setAllLocations=function(n,t){this.elt[n].setAllLocations(t)};et.prototype.isNull=function(n){return this.elt[n].isNull()};et.prototype.setAllLocationsIfNull=function(){if(arguments.length===1){var n=arguments[0];this.setAllLocationsIfNull(0,n),this.setAllLocationsIfNull(1,n)}else if(arguments.length===2){var t=arguments[0],e=arguments[1];this.elt[t].setAllLocationsIfNull(e)}};et.prototype.isLine=function(n){return this.elt[n].isLine()};et.prototype.merge=function(n){for(var t=this,e=0;e<2;e++)t.elt[e]===null&&n.elt[e]!==null?t.elt[e]=new at(n.elt[e]):t.elt[e].merge(n.elt[e])};et.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()};et.prototype.getLocation=function(){if(arguments.length===1){var n=arguments[0];return this.elt[n].get(b.ON)}else if(arguments.length===2){var t=arguments[0],e=arguments[1];return this.elt[t].get(e)}};et.prototype.toString=function(){var n=new _n;return this.elt[0]!==null&&(n.append("A:"),n.append(this.elt[0].toString())),this.elt[1]!==null&&(n.append(" B:"),n.append(this.elt[1].toString())),n.toString()};et.prototype.isArea=function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var n=arguments[0];return this.elt[n].isArea()}};et.prototype.isAnyNull=function(n){return this.elt[n].isAnyNull()};et.prototype.setLocation=function(){if(arguments.length===2){var n=arguments[0],t=arguments[1];this.elt[n].setLocation(b.ON,t)}else if(arguments.length===3){var e=arguments[0],r=arguments[1],o=arguments[2];this.elt[e].setLocation(r,o)}};et.prototype.isEqualOnSide=function(n,t){return this.elt[0].isEqualOnSide(n.elt[0],t)&&this.elt[1].isEqualOnSide(n.elt[1],t)};et.prototype.allPositionsEqual=function(n,t){return this.elt[n].allPositionsEqual(t)};et.prototype.toLine=function(n){this.elt[n].isArea()&&(this.elt[n]=new at(this.elt[n].location[0]))};et.prototype.interfaces_=function(){return[]};et.prototype.getClass=function(){return et};et.toLineLabel=function(n){for(var t=new et(E.NONE),e=0;e<2;e++)t.setLocation(e,n.getLocation(e));return t};var wt=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new O,this._pts=new O,this._label=new et(E.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new O,this._geometryFactory=null;var n=arguments[0],t=arguments[1];this._geometryFactory=t,this.computePoints(n),this.computeRing()};wt.prototype.computeRing=function(){var n=this;if(this._ring!==null)return null;for(var t=new Array(this._pts.size()).fill(null),e=0;e<this._pts.size();e++)t[e]=n._pts.get(e);this._ring=this._geometryFactory.createLinearRing(t),this._isHole=M.isCCW(this._ring.getCoordinates())};wt.prototype.isIsolated=function(){return this._label.getGeometryCount()===1};wt.prototype.computePoints=function(n){var t=this;this._startDe=n;var e=n,r=!0;do{if(e===null)throw new Jn("Found null DirectedEdge");if(e.getEdgeRing()===t)throw new Jn("Directed Edge visited twice during ring-building at "+e.getCoordinate());t._edges.add(e);var o=e.getLabel();q.isTrue(o.isArea()),t.mergeLabel(o),t.addPoints(e.getEdge(),e.isForward(),r),r=!1,t.setEdgeRing(e,t),e=t.getNext(e)}while(e!==this._startDe)};wt.prototype.getLinearRing=function(){return this._ring};wt.prototype.getCoordinate=function(n){return this._pts.get(n)};wt.prototype.computeMaxNodeDegree=function(){var n=this;this._maxNodeDegree=0;var t=this._startDe;do{var e=t.getNode(),r=e.getEdges().getOutgoingDegree(n);r>n._maxNodeDegree&&(n._maxNodeDegree=r),t=n.getNext(t)}while(t!==this._startDe);this._maxNodeDegree*=2};wt.prototype.addPoints=function(n,t,e){var r=this,o=n.getCoordinates();if(t){var s=1;e&&(s=0);for(var l=s;l<o.length;l++)r._pts.add(o[l])}else{var a=o.length-2;e&&(a=o.length-1);for(var h=a;h>=0;h--)r._pts.add(o[h])}};wt.prototype.isHole=function(){return this._isHole};wt.prototype.setInResult=function(){var n=this._startDe;do n.getEdge().setInResult(!0),n=n.getNext();while(n!==this._startDe)};wt.prototype.containsPoint=function(n){var t=this.getLinearRing(),e=t.getEnvelopeInternal();if(!e.contains(n)||!M.isPointInRing(n,t.getCoordinates()))return!1;for(var r=this._holes.iterator();r.hasNext();){var o=r.next();if(o.containsPoint(n))return!1}return!0};wt.prototype.addHole=function(n){this._holes.add(n)};wt.prototype.isShell=function(){return this._shell===null};wt.prototype.getLabel=function(){return this._label};wt.prototype.getEdges=function(){return this._edges};wt.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree};wt.prototype.getShell=function(){return this._shell};wt.prototype.mergeLabel=function(){if(arguments.length===1){var n=arguments[0];this.mergeLabel(n,0),this.mergeLabel(n,1)}else if(arguments.length===2){var t=arguments[0],e=arguments[1],r=t.getLocation(e,b.RIGHT);if(r===E.NONE)return null;if(this._label.getLocation(e)===E.NONE)return this._label.setLocation(e,r),null}};wt.prototype.setShell=function(n){this._shell=n,n!==null&&n.addHole(this)};wt.prototype.toPolygon=function(n){for(var t=this,e=new Array(this._holes.size()).fill(null),r=0;r<this._holes.size();r++)e[r]=t._holes.get(r).getLinearRing();var o=n.createPolygon(this.getLinearRing(),e);return o};wt.prototype.interfaces_=function(){return[]};wt.prototype.getClass=function(){return wt};var ef=function(n){function t(){var e=arguments[0],r=arguments[1];n.call(this,e,r)}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.setEdgeRing=function(e,r){e.setMinEdgeRing(r)},t.prototype.getNext=function(e){return e.getNextMin()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(wt),nf=function(n){function t(){var e=arguments[0],r=arguments[1];n.call(this,e,r)}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.buildMinimalRings=function(){var e=this,r=new O,o=this._startDe;do{if(o.getMinEdgeRing()===null){var s=new ef(o,e._geometryFactory);r.add(s)}o=o.getNext()}while(o!==this._startDe);return r},t.prototype.setEdgeRing=function(e,r){e.setEdgeRing(r)},t.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var e=this,r=this._startDe;do{var o=r.getNode();o.getEdges().linkMinimalDirectedEdges(e),r=r.getNext()}while(r!==this._startDe)},t.prototype.getNext=function(e){return e.getNext()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(wt),Le=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0&&arguments.length===1){var n=arguments[0];this._label=n}};Le.prototype.setVisited=function(n){this._isVisited=n};Le.prototype.setInResult=function(n){this._isInResult=n};Le.prototype.isCovered=function(){return this._isCovered};Le.prototype.isCoveredSet=function(){return this._isCoveredSet};Le.prototype.setLabel=function(n){this._label=n};Le.prototype.getLabel=function(){return this._label};Le.prototype.setCovered=function(n){this._isCovered=n,this._isCoveredSet=!0};Le.prototype.updateIM=function(n){q.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(n)};Le.prototype.isInResult=function(){return this._isInResult};Le.prototype.isVisited=function(){return this._isVisited};Le.prototype.interfaces_=function(){return[]};Le.prototype.getClass=function(){return Le};var ls=function(n){function t(){n.call(this),this._coord=null,this._edges=null;var e=arguments[0],r=arguments[1];this._coord=e,this._edges=r,this._label=new et(0,E.NONE)}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.isIncidentEdgeInResult=function(){for(var e=this.getEdges().getEdges().iterator();e.hasNext();){var r=e.next();if(r.getEdge().isInResult())return!0}return!1},t.prototype.isIsolated=function(){return this._label.getGeometryCount()===1},t.prototype.getCoordinate=function(){return this._coord},t.prototype.print=function(e){e.println("node "+this._coord+" lbl: "+this._label)},t.prototype.computeIM=function(e){},t.prototype.computeMergedLocation=function(e,r){var o=E.NONE;if(o=this._label.getLocation(r),!e.isNull(r)){var s=e.getLocation(r);o!==E.BOUNDARY&&(o=s)}return o},t.prototype.setLabel=function(){if(arguments.length===2){var e=arguments[0],r=arguments[1];this._label===null?this._label=new et(e,r):this._label.setLocation(e,r)}else return n.prototype.setLabel.apply(this,arguments)},t.prototype.getEdges=function(){return this._edges},t.prototype.mergeLabel=function(){var e=this;if(arguments[0]instanceof t){var r=arguments[0];this.mergeLabel(r._label)}else if(arguments[0]instanceof et)for(var o=arguments[0],s=0;s<2;s++){var l=e.computeMergedLocation(o,s),a=e._label.getLocation(s);a===E.NONE&&e._label.setLocation(s,l)}},t.prototype.add=function(e){this._edges.insert(e),e.setNode(this)},t.prototype.setLabelBoundary=function(e){if(this._label===null)return null;var r=E.NONE;this._label!==null&&(r=this._label.getLocation(e));var o=null;switch(r){case E.BOUNDARY:o=E.INTERIOR;break;case E.INTERIOR:o=E.BOUNDARY;break;default:o=E.BOUNDARY;break}this._label.setLocation(e,o)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Le),gn=function(){this.nodeMap=new Kt,this.nodeFact=null;var n=arguments[0];this.nodeFact=n};gn.prototype.find=function(n){return this.nodeMap.get(n)};gn.prototype.addNode=function(){if(arguments[0]instanceof d){var n=arguments[0],t=this.nodeMap.get(n);return t===null&&(t=this.nodeFact.createNode(n),this.nodeMap.put(n,t)),t}else if(arguments[0]instanceof ls){var e=arguments[0],r=this.nodeMap.get(e.getCoordinate());return r===null?(this.nodeMap.put(e.getCoordinate(),e),e):(r.mergeLabel(e),r)}};gn.prototype.print=function(n){for(var t=this.iterator();t.hasNext();){var e=t.next();e.print(n)}};gn.prototype.iterator=function(){return this.nodeMap.values().iterator()};gn.prototype.values=function(){return this.nodeMap.values()};gn.prototype.getBoundaryNodes=function(n){for(var t=new O,e=this.iterator();e.hasNext();){var r=e.next();r.getLabel().getLocation(n)===E.BOUNDARY&&t.add(r)}return t};gn.prototype.add=function(n){var t=n.getCoordinate(),e=this.addNode(t);e.add(n)};gn.prototype.interfaces_=function(){return[]};gn.prototype.getClass=function(){return gn};var rt=function(){},Co={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};rt.prototype.interfaces_=function(){return[]};rt.prototype.getClass=function(){return rt};rt.isNorthern=function(n){return n===rt.NE||n===rt.NW};rt.isOpposite=function(n,t){if(n===t)return!1;var e=(n-t+4)%4;return e===2};rt.commonHalfPlane=function(n,t){if(n===t)return n;var e=(n-t+4)%4;if(e===2)return-1;var r=n<t?n:t,o=n>t?n:t;return r===0&&o===3?3:r};rt.isInHalfPlane=function(n,t){return t===rt.SE?n===rt.SE||n===rt.SW:n===t||n===t+1};rt.quadrant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],t=arguments[1];if(n===0&&t===0)throw new ft("Cannot compute the quadrant for point ( "+n+", "+t+" )");return n>=0?t>=0?rt.NE:rt.SE:t>=0?rt.NW:rt.SW}else if(arguments[0]instanceof d&&arguments[1]instanceof d){var e=arguments[0],r=arguments[1];if(r.x===e.x&&r.y===e.y)throw new ft("Cannot compute the quadrant for two identical points "+e);return r.x>=e.x?r.y>=e.y?rt.NE:rt.SE:r.y>=e.y?rt.NW:rt.SW}};Co.NE.get=function(){return 0};Co.NW.get=function(){return 1};Co.SW.get=function(){return 2};Co.SE.get=function(){return 3};Object.defineProperties(rt,Co);var Qt=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var n=arguments[0];this._edge=n}else if(arguments.length===3){var t=arguments[0],e=arguments[1],r=arguments[2],o=null;this._edge=t,this.init(e,r),this._label=o}else if(arguments.length===4){var s=arguments[0],l=arguments[1],a=arguments[2],h=arguments[3];this._edge=s,this.init(l,a),this._label=h}};Qt.prototype.compareDirection=function(n){return this._dx===n._dx&&this._dy===n._dy?0:this._quadrant>n._quadrant?1:this._quadrant<n._quadrant?-1:M.computeOrientation(n._p0,n._p1,this._p1)};Qt.prototype.getDy=function(){return this._dy};Qt.prototype.getCoordinate=function(){return this._p0};Qt.prototype.setNode=function(n){this._node=n};Qt.prototype.print=function(n){var t=Math.atan2(this._dy,this._dx),e=this.getClass().getName(),r=e.lastIndexOf("."),o=e.substring(r+1);n.print("  "+o+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label)};Qt.prototype.compareTo=function(n){var t=n;return this.compareDirection(t)};Qt.prototype.getDirectedCoordinate=function(){return this._p1};Qt.prototype.getDx=function(){return this._dx};Qt.prototype.getLabel=function(){return this._label};Qt.prototype.getEdge=function(){return this._edge};Qt.prototype.getQuadrant=function(){return this._quadrant};Qt.prototype.getNode=function(){return this._node};Qt.prototype.toString=function(){var n=Math.atan2(this._dy,this._dx),t=this.getClass().getName(),e=t.lastIndexOf("."),r=t.substring(e+1);return"  "+r+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+n+"   "+this._label};Qt.prototype.computeLabel=function(n){};Qt.prototype.init=function(n,t){this._p0=n,this._p1=t,this._dx=t.x-n.x,this._dy=t.y-n.y,this._quadrant=rt.quadrant(this._dx,this._dy),q.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")};Qt.prototype.interfaces_=function(){return[ke]};Qt.prototype.getClass=function(){return Qt};var As=function(n){function t(){var e=arguments[0],r=arguments[1];if(n.call(this,e),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=r,r)this.init(e.getCoordinate(0),e.getCoordinate(1));else{var o=e.getNumPoints()-1;this.init(e.getCoordinate(o),e.getCoordinate(o-1))}this.computeDirectedLabel()}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.getNextMin=function(){return this._nextMin},t.prototype.getDepth=function(e){return this._depth[e]},t.prototype.setVisited=function(e){this._isVisited=e},t.prototype.computeDirectedLabel=function(){this._label=new et(this._edge.getLabel()),this._isForward||this._label.flip()},t.prototype.getNext=function(){return this._next},t.prototype.setDepth=function(e,r){if(this._depth[e]!==-999&&this._depth[e]!==r)throw new Jn("assigned depths do not match",this.getCoordinate());this._depth[e]=r},t.prototype.isInteriorAreaEdge=function(){for(var e=this,r=!0,o=0;o<2;o++)e._label.isArea(o)&&e._label.getLocation(o,b.LEFT)===E.INTERIOR&&e._label.getLocation(o,b.RIGHT)===E.INTERIOR||(r=!1);return r},t.prototype.setNextMin=function(e){this._nextMin=e},t.prototype.print=function(e){n.prototype.print.call(this,e),e.print(" "+this._depth[b.LEFT]+"/"+this._depth[b.RIGHT]),e.print(" ("+this.getDepthDelta()+")"),this._isInResult&&e.print(" inResult")},t.prototype.setMinEdgeRing=function(e){this._minEdgeRing=e},t.prototype.isLineEdge=function(){var e=this._label.isLine(0)||this._label.isLine(1),r=!this._label.isArea(0)||this._label.allPositionsEqual(0,E.EXTERIOR),o=!this._label.isArea(1)||this._label.allPositionsEqual(1,E.EXTERIOR);return e&&r&&o},t.prototype.setEdgeRing=function(e){this._edgeRing=e},t.prototype.getMinEdgeRing=function(){return this._minEdgeRing},t.prototype.getDepthDelta=function(){var e=this._edge.getDepthDelta();return this._isForward||(e=-e),e},t.prototype.setInResult=function(e){this._isInResult=e},t.prototype.getSym=function(){return this._sym},t.prototype.isForward=function(){return this._isForward},t.prototype.getEdge=function(){return this._edge},t.prototype.printEdge=function(e){this.print(e),e.print(" "),this._isForward?this._edge.print(e):this._edge.printReverse(e)},t.prototype.setSym=function(e){this._sym=e},t.prototype.setVisitedEdge=function(e){this.setVisited(e),this._sym.setVisited(e)},t.prototype.setEdgeDepths=function(e,r){var o=this.getEdge().getDepthDelta();this._isForward||(o=-o);var s=1;e===b.LEFT&&(s=-1);var l=b.opposite(e),a=o*s,h=r+a;this.setDepth(e,r),this.setDepth(l,h)},t.prototype.getEdgeRing=function(){return this._edgeRing},t.prototype.isInResult=function(){return this._isInResult},t.prototype.setNext=function(e){this._next=e},t.prototype.isVisited=function(){return this._isVisited},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.depthFactor=function(e,r){return e===E.EXTERIOR&&r===E.INTERIOR?1:e===E.INTERIOR&&r===E.EXTERIOR?-1:0},t}(Qt),Ri=function(){};Ri.prototype.createNode=function(n){return new ls(n,null)};Ri.prototype.interfaces_=function(){return[]};Ri.prototype.getClass=function(){return Ri};var pt=function(){if(this._edges=new O,this._nodes=null,this._edgeEndList=new O,arguments.length===0)this._nodes=new gn(new Ri);else if(arguments.length===1){var n=arguments[0];this._nodes=new gn(n)}};pt.prototype.printEdges=function(n){var t=this;n.println("Edges:");for(var e=0;e<this._edges.size();e++){n.println("edge "+e+":");var r=t._edges.get(e);r.print(n),r.eiList.print(n)}};pt.prototype.find=function(n){return this._nodes.find(n)};pt.prototype.addNode=function(){if(arguments[0]instanceof ls){var n=arguments[0];return this._nodes.addNode(n)}else if(arguments[0]instanceof d){var t=arguments[0];return this._nodes.addNode(t)}};pt.prototype.getNodeIterator=function(){return this._nodes.iterator()};pt.prototype.linkResultDirectedEdges=function(){for(var n=this._nodes.iterator();n.hasNext();){var t=n.next();t.getEdges().linkResultDirectedEdges()}};pt.prototype.debugPrintln=function(n){qt.out.println(n)};pt.prototype.isBoundaryNode=function(n,t){var e=this._nodes.find(t);if(e===null)return!1;var r=e.getLabel();return r!==null&&r.getLocation(n)===E.BOUNDARY};pt.prototype.linkAllDirectedEdges=function(){for(var n=this._nodes.iterator();n.hasNext();){var t=n.next();t.getEdges().linkAllDirectedEdges()}};pt.prototype.matchInSameDirection=function(n,t,e,r){return n.equals(e)?M.computeOrientation(n,t,r)===M.COLLINEAR&&rt.quadrant(n,t)===rt.quadrant(e,r):!1};pt.prototype.getEdgeEnds=function(){return this._edgeEndList};pt.prototype.debugPrint=function(n){qt.out.print(n)};pt.prototype.getEdgeIterator=function(){return this._edges.iterator()};pt.prototype.findEdgeInSameDirection=function(n,t){for(var e=this,r=0;r<this._edges.size();r++){var o=e._edges.get(r),s=o.getCoordinates();if(e.matchInSameDirection(n,t,s[0],s[1])||e.matchInSameDirection(n,t,s[s.length-1],s[s.length-2]))return o}return null};pt.prototype.insertEdge=function(n){this._edges.add(n)};pt.prototype.findEdgeEnd=function(n){for(var t=this.getEdgeEnds().iterator();t.hasNext();){var e=t.next();if(e.getEdge()===n)return e}return null};pt.prototype.addEdges=function(n){for(var t=this,e=n.iterator();e.hasNext();){var r=e.next();t._edges.add(r);var o=new As(r,!0),s=new As(r,!1);o.setSym(s),s.setSym(o),t.add(o),t.add(s)}};pt.prototype.add=function(n){this._nodes.add(n),this._edgeEndList.add(n)};pt.prototype.getNodes=function(){return this._nodes.values()};pt.prototype.findEdge=function(n,t){for(var e=this,r=0;r<this._edges.size();r++){var o=e._edges.get(r),s=o.getCoordinates();if(n.equals(s[0])&&t.equals(s[1]))return o}return null};pt.prototype.interfaces_=function(){return[]};pt.prototype.getClass=function(){return pt};pt.linkResultDirectedEdges=function(n){for(var t=n.iterator();t.hasNext();){var e=t.next();e.getEdges().linkResultDirectedEdges()}};var ve=function(){this._geometryFactory=null,this._shellList=new O;var n=arguments[0];this._geometryFactory=n};ve.prototype.sortShellsAndHoles=function(n,t,e){for(var r=n.iterator();r.hasNext();){var o=r.next();o.isHole()?e.add(o):t.add(o)}};ve.prototype.computePolygons=function(n){for(var t=this,e=new O,r=n.iterator();r.hasNext();){var o=r.next(),s=o.toPolygon(t._geometryFactory);e.add(s)}return e};ve.prototype.placeFreeHoles=function(n,t){for(var e=this,r=t.iterator();r.hasNext();){var o=r.next();if(o.getShell()===null){var s=e.findEdgeRingContaining(o,n);if(s===null)throw new Jn("unable to assign hole to a shell",o.getCoordinate(0));o.setShell(s)}}};ve.prototype.buildMinimalEdgeRings=function(n,t,e){for(var r=this,o=new O,s=n.iterator();s.hasNext();){var l=s.next();if(l.getMaxNodeDegree()>2){l.linkDirectedEdgesForMinimalEdgeRings();var a=l.buildMinimalRings(),h=r.findShell(a);h!==null?(r.placePolygonHoles(h,a),t.add(h)):e.addAll(a)}else o.add(l)}return o};ve.prototype.containsPoint=function(n){for(var t=this._shellList.iterator();t.hasNext();){var e=t.next();if(e.containsPoint(n))return!0}return!1};ve.prototype.buildMaximalEdgeRings=function(n){for(var t=this,e=new O,r=n.iterator();r.hasNext();){var o=r.next();if(o.isInResult()&&o.getLabel().isArea()&&o.getEdgeRing()===null){var s=new nf(o,t._geometryFactory);e.add(s),s.setInResult()}}return e};ve.prototype.placePolygonHoles=function(n,t){for(var e=t.iterator();e.hasNext();){var r=e.next();r.isHole()&&r.setShell(n)}};ve.prototype.getPolygons=function(){var n=this.computePolygons(this._shellList);return n};ve.prototype.findEdgeRingContaining=function(n,t){for(var e=n.getLinearRing(),r=e.getEnvelopeInternal(),o=e.getCoordinateN(0),s=null,l=null,a=t.iterator();a.hasNext();){var h=a.next(),y=h.getLinearRing(),C=y.getEnvelopeInternal();s!==null&&(l=s.getLinearRing().getEnvelopeInternal());var L=!1;C.contains(r)&&M.isPointInRing(o,y.getCoordinates())&&(L=!0),L&&(s===null||l.contains(C))&&(s=h)}return s};ve.prototype.findShell=function(n){for(var t=0,e=null,r=n.iterator();r.hasNext();){var o=r.next();o.isHole()||(e=o,t++)}return q.isTrue(t<=1,"found two shells in MinimalEdgeRing list"),e};ve.prototype.add=function(){if(arguments.length===1){var n=arguments[0];this.add(n.getEdgeEnds(),n.getNodes())}else if(arguments.length===2){var t=arguments[0],e=arguments[1];pt.linkResultDirectedEdges(e);var r=this.buildMaximalEdgeRings(t),o=new O,s=this.buildMinimalEdgeRings(r,this._shellList,o);this.sortShellsAndHoles(s,this._shellList,o),this.placeFreeHoles(this._shellList,o)}};ve.prototype.interfaces_=function(){return[]};ve.prototype.getClass=function(){return ve};var Oi=function(){};Oi.prototype.getBounds=function(){};Oi.prototype.interfaces_=function(){return[]};Oi.prototype.getClass=function(){return Oi};var We=function(){this._bounds=null,this._item=null;var n=arguments[0],t=arguments[1];this._bounds=n,this._item=t};We.prototype.getItem=function(){return this._item};We.prototype.getBounds=function(){return this._bounds};We.prototype.interfaces_=function(){return[Oi,Ge]};We.prototype.getClass=function(){return We};var $n=function(){this._size=null,this._items=null,this._size=0,this._items=new O,this._items.add(null)};$n.prototype.poll=function(){if(this.isEmpty())return null;var n=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),n};$n.prototype.size=function(){return this._size};$n.prototype.reorder=function(n){for(var t=this,e=null,r=this._items.get(n);n*2<=this._size&&(e=n*2,e!==t._size&&t._items.get(e+1).compareTo(t._items.get(e))<0&&e++,t._items.get(e).compareTo(r)<0);n=e)t._items.set(n,t._items.get(e));this._items.set(n,r)};$n.prototype.clear=function(){this._size=0,this._items.clear()};$n.prototype.isEmpty=function(){return this._size===0};$n.prototype.add=function(n){var t=this;this._items.add(null),this._size+=1;var e=this._size;for(this._items.set(0,n);n.compareTo(this._items.get(Math.trunc(e/2)))<0;e/=2)t._items.set(e,t._items.get(Math.trunc(e/2)));this._items.set(e,n)};$n.prototype.interfaces_=function(){return[]};$n.prototype.getClass=function(){return $n};var hr=function(){};hr.prototype.visitItem=function(n){};hr.prototype.interfaces_=function(){return[]};hr.prototype.getClass=function(){return hr};var Jr=function(){};Jr.prototype.insert=function(n,t){};Jr.prototype.remove=function(n,t){};Jr.prototype.query=function(){};Jr.prototype.interfaces_=function(){return[]};Jr.prototype.getClass=function(){return Jr};var Rt=function(){if(this._childBoundables=new O,this._bounds=null,this._level=null,arguments.length!==0&&arguments.length===1){var n=arguments[0];this._level=n}},Su={serialVersionUID:{configurable:!0}};Rt.prototype.getLevel=function(){return this._level};Rt.prototype.size=function(){return this._childBoundables.size()};Rt.prototype.getChildBoundables=function(){return this._childBoundables};Rt.prototype.addChildBoundable=function(n){q.isTrue(this._bounds===null),this._childBoundables.add(n)};Rt.prototype.isEmpty=function(){return this._childBoundables.isEmpty()};Rt.prototype.getBounds=function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds};Rt.prototype.interfaces_=function(){return[Oi,Ge]};Rt.prototype.getClass=function(){return Rt};Su.serialVersionUID.get=function(){return 6493722185909574e3};Object.defineProperties(Rt,Su);var He=function(){};He.reverseOrder=function(){return{compare:function(n,t){return t.compareTo(n)}}};He.min=function(n){return He.sort(n),n.get(0)};He.sort=function(n,t){var e=n.toArray();t?Lr.sort(e,t):Lr.sort(e);for(var r=n.iterator(),o=0,s=e.length;o<s;o++)r.next(),r.set(e[o])};He.singletonList=function(n){var t=new O;return t.add(n),t};var xt=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var n=arguments[0],t=arguments[1],e=arguments[2];this._boundable1=n,this._boundable2=t,this._itemDistance=e,this._distance=this.distance()};xt.prototype.expandToQueue=function(n,t){var e=xt.isComposite(this._boundable1),r=xt.isComposite(this._boundable2);if(e&&r)return xt.area(this._boundable1)>xt.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,n,t),null):(this.expand(this._boundable2,this._boundable1,n,t),null);if(e)return this.expand(this._boundable1,this._boundable2,n,t),null;if(r)return this.expand(this._boundable2,this._boundable1,n,t),null;throw new ft("neither boundable is composite")};xt.prototype.isLeaves=function(){return!(xt.isComposite(this._boundable1)||xt.isComposite(this._boundable2))};xt.prototype.compareTo=function(n){var t=n;return this._distance<t._distance?-1:this._distance>t._distance?1:0};xt.prototype.expand=function(n,t,e,r){for(var o=this,s=n.getChildBoundables(),l=s.iterator();l.hasNext();){var a=l.next(),h=new xt(a,t,o._itemDistance);h.getDistance()<r&&e.add(h)}};xt.prototype.getBoundable=function(n){return n===0?this._boundable1:this._boundable2};xt.prototype.getDistance=function(){return this._distance};xt.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())};xt.prototype.interfaces_=function(){return[ke]};xt.prototype.getClass=function(){return xt};xt.area=function(n){return n.getBounds().getArea()};xt.isComposite=function(n){return n instanceof Rt};var Mt=function n(){if(this._root=null,this._built=!1,this._itemBoundables=new O,this._nodeCapacity=null,arguments.length===0){var t=n.DEFAULT_NODE_CAPACITY;this._nodeCapacity=t}else if(arguments.length===1){var e=arguments[0];q.isTrue(e>1,"Node capacity must be greater than 1"),this._nodeCapacity=e}},cs={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};Mt.prototype.getNodeCapacity=function(){return this._nodeCapacity};Mt.prototype.lastNode=function(n){return n.get(n.size()-1)};Mt.prototype.size=function(){var n=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var t=arguments[0],e=0,r=t.getChildBoundables().iterator();r.hasNext();){var o=r.next();o instanceof Rt?e+=n.size(o):o instanceof We&&(e+=1)}return e}};Mt.prototype.removeItem=function(n,t){for(var e=null,r=n.getChildBoundables().iterator();r.hasNext();){var o=r.next();o instanceof We&&o.getItem()===t&&(e=o)}return e!==null?(n.getChildBoundables().remove(e),!0):!1};Mt.prototype.itemsTree=function(){var n=this;if(arguments.length===0){this.build();var t=this.itemsTree(this._root);return t===null?new O:t}else if(arguments.length===1){for(var e=arguments[0],r=new O,o=e.getChildBoundables().iterator();o.hasNext();){var s=o.next();if(s instanceof Rt){var l=n.itemsTree(s);l!==null&&r.add(l)}else s instanceof We?r.add(s.getItem()):q.shouldNeverReachHere()}return r.size()<=0?null:r}};Mt.prototype.insert=function(n,t){q.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new We(n,t))};Mt.prototype.boundablesAtLevel=function(){var n=this;if(arguments.length===1){var t=arguments[0],e=new O;return this.boundablesAtLevel(t,this._root,e),e}else if(arguments.length===3){var r=arguments[0],o=arguments[1],s=arguments[2];if(q.isTrue(r>-2),o.getLevel()===r)return s.add(o),null;for(var l=o.getChildBoundables().iterator();l.hasNext();){var a=l.next();a instanceof Rt?n.boundablesAtLevel(r,a,s):(q.isTrue(a instanceof We),r===-1&&s.add(a))}return null}};Mt.prototype.query=function(){var n=this;if(arguments.length===1){var t=arguments[0];this.build();var e=new O;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.query(t,this._root,e),e}else if(arguments.length===2){var r=arguments[0],o=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),r)&&this.query(r,this._root,o)}else if(arguments.length===3){if(V(arguments[2],hr)&&arguments[0]instanceof Object&&arguments[1]instanceof Rt)for(var s=arguments[0],l=arguments[1],a=arguments[2],h=l.getChildBoundables(),y=0;y<h.size();y++){var C=h.get(y);n.getIntersectsOp().intersects(C.getBounds(),s)&&(C instanceof Rt?n.query(s,C,a):C instanceof We?a.visitItem(C.getItem()):q.shouldNeverReachHere())}else if(V(arguments[2],qe)&&arguments[0]instanceof Object&&arguments[1]instanceof Rt)for(var L=arguments[0],Y=arguments[1],ze=arguments[2],Bt=Y.getChildBoundables(),Ir=0;Ir<Bt.size();Ir++){var Wr=Bt.get(Ir);n.getIntersectsOp().intersects(Wr.getBounds(),L)&&(Wr instanceof Rt?n.query(L,Wr,ze):Wr instanceof We?ze.add(Wr.getItem()):q.shouldNeverReachHere())}}};Mt.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0};Mt.prototype.getRoot=function(){return this.build(),this._root};Mt.prototype.remove=function(){var n=this;if(arguments.length===2){var t=arguments[0],e=arguments[1];return this.build(),this.getIntersectsOp().intersects(this._root.getBounds(),t)?this.remove(t,this._root,e):!1}else if(arguments.length===3){var r=arguments[0],o=arguments[1],s=arguments[2],l=this.removeItem(o,s);if(l)return!0;for(var a=null,h=o.getChildBoundables().iterator();h.hasNext();){var y=h.next();if(n.getIntersectsOp().intersects(y.getBounds(),r)&&y instanceof Rt&&(l=n.remove(r,y,s),l)){a=y;break}}return a!==null&&a.getChildBoundables().isEmpty()&&o.getChildBoundables().remove(a),l}};Mt.prototype.createHigherLevels=function(n,t){q.isTrue(!n.isEmpty());var e=this.createParentBoundables(n,t+1);return e.size()===1?e.get(0):this.createHigherLevels(e,t+1)};Mt.prototype.depth=function(){var n=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var t=arguments[0],e=0,r=t.getChildBoundables().iterator();r.hasNext();){var o=r.next();if(o instanceof Rt){var s=n.depth(o);s>e&&(e=s)}}return e+1}};Mt.prototype.createParentBoundables=function(n,t){var e=this;q.isTrue(!n.isEmpty());var r=new O;r.add(this.createNode(t));var o=new O(n);He.sort(o,this.getComparator());for(var s=o.iterator();s.hasNext();){var l=s.next();e.lastNode(r).getChildBoundables().size()===e.getNodeCapacity()&&r.add(e.createNode(t)),e.lastNode(r).addChildBoundable(l)}return r};Mt.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()};Mt.prototype.interfaces_=function(){return[Ge]};Mt.prototype.getClass=function(){return Mt};Mt.compareDoubles=function(n,t){return n>t?1:n<t?-1:0};cs.IntersectsOp.get=function(){return rf};cs.serialVersionUID.get=function(){return-3886435814360241e3};cs.DEFAULT_NODE_CAPACITY.get=function(){return 10};Object.defineProperties(Mt,cs);var rf=function(){},Ti=function(){};Ti.prototype.distance=function(n,t){};Ti.prototype.interfaces_=function(){return[]};Ti.prototype.getClass=function(){return Ti};var wu=function(n){function t(r){r=r||t.DEFAULT_NODE_CAPACITY,n.call(this,r)}n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t;var e={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return t.prototype.createParentBoundablesFromVerticalSlices=function(r,o){var s=this;q.isTrue(r.length>0);for(var l=new O,a=0;a<r.length;a++)l.addAll(s.createParentBoundablesFromVerticalSlice(r[a],o));return l},t.prototype.createNode=function(r){return new Ma(r)},t.prototype.size=function(){return arguments.length===0?n.prototype.size.call(this):n.prototype.size.apply(this,arguments)},t.prototype.insert=function(){if(arguments.length===2){var r=arguments[0],o=arguments[1];if(r.isNull())return null;n.prototype.insert.call(this,r,o)}else return n.prototype.insert.apply(this,arguments)},t.prototype.getIntersectsOp=function(){return t.intersectsOp},t.prototype.verticalSlices=function(r,o){for(var s=Math.trunc(Math.ceil(r.size()/o)),l=new Array(o).fill(null),a=r.iterator(),h=0;h<o;h++){l[h]=new O;for(var y=0;a.hasNext()&&y<s;){var C=a.next();l[h].add(C),y++}}return l},t.prototype.query=function(){if(arguments.length===1){var r=arguments[0];return n.prototype.query.call(this,r)}else if(arguments.length===2){var o=arguments[0],s=arguments[1];n.prototype.query.call(this,o,s)}else if(arguments.length===3){if(V(arguments[2],hr)&&arguments[0]instanceof Object&&arguments[1]instanceof Rt){var l=arguments[0],a=arguments[1],h=arguments[2];n.prototype.query.call(this,l,a,h)}else if(V(arguments[2],qe)&&arguments[0]instanceof Object&&arguments[1]instanceof Rt){var y=arguments[0],C=arguments[1],L=arguments[2];n.prototype.query.call(this,y,C,L)}}},t.prototype.getComparator=function(){return t.yComparator},t.prototype.createParentBoundablesFromVerticalSlice=function(r,o){return n.prototype.createParentBoundables.call(this,r,o)},t.prototype.remove=function(){if(arguments.length===2){var r=arguments[0],o=arguments[1];return n.prototype.remove.call(this,r,o)}else return n.prototype.remove.apply(this,arguments)},t.prototype.depth=function(){return arguments.length===0?n.prototype.depth.call(this):n.prototype.depth.apply(this,arguments)},t.prototype.createParentBoundables=function(r,o){q.isTrue(!r.isEmpty());var s=Math.trunc(Math.ceil(r.size()/this.getNodeCapacity())),l=new O(r);He.sort(l,t.xComparator);var a=this.verticalSlices(l,Math.trunc(Math.ceil(Math.sqrt(s))));return this.createParentBoundablesFromVerticalSlices(a,o)},t.prototype.nearestNeighbour=function(){if(arguments.length===1){if(V(arguments[0],Ti)){var r=arguments[0],o=new xt(this.getRoot(),this.getRoot(),r);return this.nearestNeighbour(o)}else if(arguments[0]instanceof xt){var s=arguments[0];return this.nearestNeighbour(s,z.POSITIVE_INFINITY)}}else if(arguments.length===2){if(arguments[0]instanceof t&&V(arguments[1],Ti)){var l=arguments[0],a=arguments[1],h=new xt(this.getRoot(),l.getRoot(),a);return this.nearestNeighbour(h)}else if(arguments[0]instanceof xt&&typeof arguments[1]=="number"){var y=arguments[0],C=arguments[1],L=C,Y=null,ze=new $n;for(ze.add(y);!ze.isEmpty()&&L>0;){var Bt=ze.poll(),Ir=Bt.getDistance();if(Ir>=L)break;Bt.isLeaves()?(L=Ir,Y=Bt):Bt.expandToQueue(ze,L)}return[Y.getBoundable(0).getItem(),Y.getBoundable(1).getItem()]}}else if(arguments.length===3){var Wr=arguments[0],yi=arguments[1],Bn=arguments[2],vi=new We(Wr,yi),wo=new xt(this.getRoot(),vi,Bn);return this.nearestNeighbour(wo)[0]}},t.prototype.interfaces_=function(){return[Jr,Ge]},t.prototype.getClass=function(){return t},t.centreX=function(r){return t.avg(r.getMinX(),r.getMaxX())},t.avg=function(r,o){return(r+o)/2},t.centreY=function(r){return t.avg(r.getMinY(),r.getMaxY())},e.STRtreeNode.get=function(){return Ma},e.serialVersionUID.get=function(){return 0x39920f7d5f261e0},e.xComparator.get=function(){return{interfaces_:function(){return[Ci]},compare:function(r,o){return n.compareDoubles(t.centreX(r.getBounds()),t.centreX(o.getBounds()))}}},e.yComparator.get=function(){return{interfaces_:function(){return[Ci]},compare:function(r,o){return n.compareDoubles(t.centreY(r.getBounds()),t.centreY(o.getBounds()))}}},e.intersectsOp.get=function(){return{interfaces_:function(){return[n.IntersectsOp]},intersects:function(r,o){return r.intersects(o)}}},e.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(t,e),t}(Mt),Ma=function(n){function t(){var e=arguments[0];n.call(this,e)}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.computeBounds=function(){for(var e=null,r=this.getChildBoundables().iterator();r.hasNext();){var o=r.next();e===null?e=new B(o.getBounds()):e.expandToInclude(o.getBounds())}return e},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Rt),ue=function(){};ue.prototype.interfaces_=function(){return[]};ue.prototype.getClass=function(){return ue};ue.relativeSign=function(n,t){return n<t?-1:n>t?1:0};ue.compare=function(n,t,e){if(t.equals2D(e))return 0;var r=ue.relativeSign(t.x,e.x),o=ue.relativeSign(t.y,e.y);switch(n){case 0:return ue.compareValue(r,o);case 1:return ue.compareValue(o,r);case 2:return ue.compareValue(o,-r);case 3:return ue.compareValue(-r,o);case 4:return ue.compareValue(-r,-o);case 5:return ue.compareValue(-o,-r);case 6:return ue.compareValue(-o,r);case 7:return ue.compareValue(r,-o)}return q.shouldNeverReachHere("invalid octant value"),0};ue.compareValue=function(n,t){return n<0?-1:n>0?1:t<0?-1:t>0?1:0};var gr=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var n=arguments[0],t=arguments[1],e=arguments[2],r=arguments[3];this._segString=n,this.coord=new d(t),this.segmentIndex=e,this._segmentOctant=r,this._isInterior=!t.equals2D(n.getCoordinate(e))};gr.prototype.getCoordinate=function(){return this.coord};gr.prototype.print=function(n){n.print(this.coord),n.print(" seg # = "+this.segmentIndex)};gr.prototype.compareTo=function(n){var t=n;return this.segmentIndex<t.segmentIndex?-1:this.segmentIndex>t.segmentIndex?1:this.coord.equals2D(t.coord)?0:ue.compare(this._segmentOctant,this.coord,t.coord)};gr.prototype.isEndPoint=function(n){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===n};gr.prototype.isInterior=function(){return this._isInterior};gr.prototype.interfaces_=function(){return[ke]};gr.prototype.getClass=function(){return gr};var se=function(){this._nodeMap=new Kt,this._edge=null;var n=arguments[0];this._edge=n};se.prototype.getSplitCoordinates=function(){var n=this,t=new Eo;this.addEndpoints();for(var e=this.iterator(),r=e.next();e.hasNext();){var o=e.next();n.addEdgeCoordinates(r,o,t),r=o}return t.toCoordinateArray()};se.prototype.addCollapsedNodes=function(){var n=this,t=new O;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(var e=t.iterator();e.hasNext();){var r=e.next().intValue();n.add(n._edge.getCoordinate(r),r)}};se.prototype.print=function(n){n.println("Intersections:");for(var t=this.iterator();t.hasNext();){var e=t.next();e.print(n)}};se.prototype.findCollapsesFromExistingVertices=function(n){for(var t=this,e=0;e<this._edge.size()-2;e++){var r=t._edge.getCoordinate(e),o=t._edge.getCoordinate(e+2);r.equals2D(o)&&n.add(new un(e+1))}};se.prototype.addEdgeCoordinates=function(n,t,e){var r=this,o=this._edge.getCoordinate(t.segmentIndex),s=t.isInterior()||!t.coord.equals2D(o);e.add(new d(n.coord),!1);for(var l=n.segmentIndex+1;l<=t.segmentIndex;l++)e.add(r._edge.getCoordinate(l));s&&e.add(new d(t.coord))};se.prototype.iterator=function(){return this._nodeMap.values().iterator()};se.prototype.addSplitEdges=function(n){var t=this;this.addEndpoints(),this.addCollapsedNodes();for(var e=this.iterator(),r=e.next();e.hasNext();){var o=e.next(),s=t.createSplitEdge(r,o);n.add(s),r=o}};se.prototype.findCollapseIndex=function(n,t,e){if(!n.coord.equals2D(t.coord))return!1;var r=t.segmentIndex-n.segmentIndex;return t.isInterior()||r--,r===1?(e[0]=n.segmentIndex+1,!0):!1};se.prototype.findCollapsesFromInsertedNodes=function(n){for(var t=this,e=new Array(1).fill(null),r=this.iterator(),o=r.next();r.hasNext();){var s=r.next(),l=t.findCollapseIndex(o,s,e);l&&n.add(new un(e[0])),o=s}};se.prototype.getEdge=function(){return this._edge};se.prototype.addEndpoints=function(){var n=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(n),n)};se.prototype.createSplitEdge=function(n,t){var e=this,r=t.segmentIndex-n.segmentIndex+2,o=this._edge.getCoordinate(t.segmentIndex),s=t.isInterior()||!t.coord.equals2D(o);s||r--;var l=new Array(r).fill(null),a=0;l[a++]=new d(n.coord);for(var h=n.segmentIndex+1;h<=t.segmentIndex;h++)l[a++]=e._edge.getCoordinate(h);return s&&(l[a]=new d(t.coord)),new Nt(l,this._edge.getData())};se.prototype.add=function(n,t){var e=new gr(this._edge,n,t,this._edge.getSegmentOctant(t)),r=this._nodeMap.get(e);return r!==null?(q.isTrue(r.coord.equals2D(n),"Found equal nodes with different coordinates"),r):(this._nodeMap.put(e,e),e)};se.prototype.checkSplitEdgesCorrectness=function(n){var t=this._edge.getCoordinates(),e=n.get(0),r=e.getCoordinate(0);if(!r.equals2D(t[0]))throw new Qn("bad split edge start point at "+r);var o=n.get(n.size()-1),s=o.getCoordinates(),l=s[s.length-1];if(!l.equals2D(t[t.length-1]))throw new Qn("bad split edge end point at "+l)};se.prototype.interfaces_=function(){return[]};se.prototype.getClass=function(){return se};var $r=function(){};$r.prototype.interfaces_=function(){return[]};$r.prototype.getClass=function(){return $r};$r.octant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],t=arguments[1];if(n===0&&t===0)throw new ft("Cannot compute the octant for point ( "+n+", "+t+" )");var e=Math.abs(n),r=Math.abs(t);return n>=0?t>=0?e>=r?0:1:e>=r?7:6:t>=0?e>=r?3:2:e>=r?4:5}else if(arguments[0]instanceof d&&arguments[1]instanceof d){var o=arguments[0],s=arguments[1],l=s.x-o.x,a=s.y-o.y;if(l===0&&a===0)throw new ft("Cannot compute the octant for two identical points "+o);return $r.octant(l,a)}};var Rn=function(){};Rn.prototype.getCoordinates=function(){};Rn.prototype.size=function(){};Rn.prototype.getCoordinate=function(n){};Rn.prototype.isClosed=function(){};Rn.prototype.setData=function(n){};Rn.prototype.getData=function(){};Rn.prototype.interfaces_=function(){return[]};Rn.prototype.getClass=function(){return Rn};var co=function(){};co.prototype.addIntersection=function(n,t){};co.prototype.interfaces_=function(){return[Rn]};co.prototype.getClass=function(){return co};var Nt=function(){this._nodeList=new se(this),this._pts=null,this._data=null;var n=arguments[0],t=arguments[1];this._pts=n,this._data=t};Nt.prototype.getCoordinates=function(){return this._pts};Nt.prototype.size=function(){return this._pts.length};Nt.prototype.getCoordinate=function(n){return this._pts[n]};Nt.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};Nt.prototype.getSegmentOctant=function(n){return n===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(n),this.getCoordinate(n+1))};Nt.prototype.setData=function(n){this._data=n};Nt.prototype.safeOctant=function(n,t){return n.equals2D(t)?0:$r.octant(n,t)};Nt.prototype.getData=function(){return this._data};Nt.prototype.addIntersection=function(){if(arguments.length===2){var n=arguments[0],t=arguments[1];this.addIntersectionNode(n,t)}else if(arguments.length===4){var e=arguments[0],r=arguments[1],o=arguments[3],s=new d(e.getIntersection(o));this.addIntersection(s,r)}};Nt.prototype.toString=function(){return Xe.toLineString(new _t(this._pts))};Nt.prototype.getNodeList=function(){return this._nodeList};Nt.prototype.addIntersectionNode=function(n,t){var e=t,r=e+1;if(r<this._pts.length){var o=this._pts[r];n.equals2D(o)&&(e=r)}var s=this._nodeList.add(n,e);return s};Nt.prototype.addIntersections=function(n,t,e){for(var r=this,o=0;o<n.getIntersectionNum();o++)r.addIntersection(n,t,e,o)};Nt.prototype.interfaces_=function(){return[co]};Nt.prototype.getClass=function(){return Nt};Nt.getNodedSubstrings=function(){if(arguments.length===1){var n=arguments[0],t=new O;return Nt.getNodedSubstrings(n,t),t}else if(arguments.length===2)for(var e=arguments[0],r=arguments[1],o=e.iterator();o.hasNext();){var s=o.next();s.getNodeList().addSplitEdges(r)}};var k=function(){if(this.p0=null,this.p1=null,arguments.length===0)this.p0=new d,this.p1=new d;else if(arguments.length===1){var n=arguments[0];this.p0=new d(n.p0),this.p1=new d(n.p1)}else if(arguments.length===2)this.p0=arguments[0],this.p1=arguments[1];else if(arguments.length===4){var t=arguments[0],e=arguments[1],r=arguments[2],o=arguments[3];this.p0=new d(t,e),this.p1=new d(r,o)}},Lu={serialVersionUID:{configurable:!0}};k.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)};k.prototype.orientationIndex=function(){if(arguments[0]instanceof k){var n=arguments[0],t=M.orientationIndex(this.p0,this.p1,n.p0),e=M.orientationIndex(this.p0,this.p1,n.p1);return t>=0&&e>=0||t<=0&&e<=0?Math.max(t,e):0}else if(arguments[0]instanceof d){var r=arguments[0];return M.orientationIndex(this.p0,this.p1,r)}};k.prototype.toGeometry=function(n){return n.createLineString([this.p0,this.p1])};k.prototype.isVertical=function(){return this.p0.x===this.p1.x};k.prototype.equals=function(n){if(!(n instanceof k))return!1;var t=n;return this.p0.equals(t.p0)&&this.p1.equals(t.p1)};k.prototype.intersection=function(n){var t=new Xr;return t.computeIntersection(this.p0,this.p1,n.p0,n.p1),t.hasIntersection()?t.getIntersection(0):null};k.prototype.project=function(){if(arguments[0]instanceof d){var n=arguments[0];if(n.equals(this.p0)||n.equals(this.p1))return new d(n);var t=this.projectionFactor(n),e=new d;return e.x=this.p0.x+t*(this.p1.x-this.p0.x),e.y=this.p0.y+t*(this.p1.y-this.p0.y),e}else if(arguments[0]instanceof k){var r=arguments[0],o=this.projectionFactor(r.p0),s=this.projectionFactor(r.p1);if(o>=1&&s>=1||o<=0&&s<=0)return null;var l=this.project(r.p0);o<0&&(l=this.p0),o>1&&(l=this.p1);var a=this.project(r.p1);return s<0&&(a=this.p0),s>1&&(a=this.p1),new k(l,a)}};k.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()};k.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)};k.prototype.getCoordinate=function(n){return n===0?this.p0:this.p1};k.prototype.distancePerpendicular=function(n){return M.distancePointLinePerpendicular(n,this.p0,this.p1)};k.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)};k.prototype.midPoint=function(){return k.midPoint(this.p0,this.p1)};k.prototype.projectionFactor=function(n){if(n.equals(this.p0))return 0;if(n.equals(this.p1))return 1;var t=this.p1.x-this.p0.x,e=this.p1.y-this.p0.y,r=t*t+e*e;if(r<=0)return z.NaN;var o=((n.x-this.p0.x)*t+(n.y-this.p0.y)*e)/r;return o};k.prototype.closestPoints=function(n){var t=this.intersection(n);if(t!==null)return[t,t];var e=new Array(2).fill(null),r=z.MAX_VALUE,o=null,s=this.closestPoint(n.p0);r=s.distance(n.p0),e[0]=s,e[1]=n.p0;var l=this.closestPoint(n.p1);o=l.distance(n.p1),o<r&&(r=o,e[0]=l,e[1]=n.p1);var a=n.closestPoint(this.p0);o=a.distance(this.p0),o<r&&(r=o,e[0]=this.p0,e[1]=a);var h=n.closestPoint(this.p1);return o=h.distance(this.p1),o<r&&(r=o,e[0]=this.p1,e[1]=h),e};k.prototype.closestPoint=function(n){var t=this.projectionFactor(n);if(t>0&&t<1)return this.project(n);var e=this.p0.distance(n),r=this.p1.distance(n);return e<r?this.p0:this.p1};k.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)};k.prototype.getLength=function(){return this.p0.distance(this.p1)};k.prototype.compareTo=function(n){var t=n,e=this.p0.compareTo(t.p0);return e!==0?e:this.p1.compareTo(t.p1)};k.prototype.reverse=function(){var n=this.p0;this.p0=this.p1,this.p1=n};k.prototype.equalsTopo=function(n){return this.p0.equals(n.p0)&&(this.p1.equals(n.p1)||this.p0.equals(n.p1))&&this.p1.equals(n.p0)};k.prototype.lineIntersection=function(n){try{var t=Ue.intersection(this.p0,this.p1,n.p0,n.p1);return t}catch(e){if(!(e instanceof qi))throw e}finally{}return null};k.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)};k.prototype.pointAlongOffset=function(n,t){var e=this.p0.x+n*(this.p1.x-this.p0.x),r=this.p0.y+n*(this.p1.y-this.p0.y),o=this.p1.x-this.p0.x,s=this.p1.y-this.p0.y,l=Math.sqrt(o*o+s*s),a=0,h=0;if(t!==0){if(l<=0)throw new Error("Cannot compute offset from zero-length line segment");a=t*o/l,h=t*s/l}var y=e-h,C=r+a,L=new d(y,C);return L};k.prototype.setCoordinates=function(){if(arguments.length===1){var n=arguments[0];this.setCoordinates(n.p0,n.p1)}else if(arguments.length===2){var t=arguments[0],e=arguments[1];this.p0.x=t.x,this.p0.y=t.y,this.p1.x=e.x,this.p1.y=e.y}};k.prototype.segmentFraction=function(n){var t=this.projectionFactor(n);return t<0?t=0:(t>1||z.isNaN(t))&&(t=1),t};k.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"};k.prototype.isHorizontal=function(){return this.p0.y===this.p1.y};k.prototype.distance=function(){if(arguments[0]instanceof k){var n=arguments[0];return M.distanceLineLine(this.p0,this.p1,n.p0,n.p1)}else if(arguments[0]instanceof d){var t=arguments[0];return M.distancePointLine(t,this.p0,this.p1)}};k.prototype.pointAlong=function(n){var t=new d;return t.x=this.p0.x+n*(this.p1.x-this.p0.x),t.y=this.p0.y+n*(this.p1.y-this.p0.y),t};k.prototype.hashCode=function(){var n=z.doubleToLongBits(this.p0.x);n^=z.doubleToLongBits(this.p0.y)*31;var t=Math.trunc(n)^Math.trunc(n>>32),e=z.doubleToLongBits(this.p1.x);e^=z.doubleToLongBits(this.p1.y)*31;var r=Math.trunc(e)^Math.trunc(e>>32);return t^r};k.prototype.interfaces_=function(){return[ke,Ge]};k.prototype.getClass=function(){return k};k.midPoint=function(n,t){return new d((n.x+t.x)/2,(n.y+t.y)/2)};Lu.serialVersionUID.get=function(){return 0x2d2172135f411c00};Object.defineProperties(k,Lu);var fo=function(){this.tempEnv1=new B,this.tempEnv2=new B,this._overlapSeg1=new k,this._overlapSeg2=new k};fo.prototype.overlap=function(){if(arguments.length!==2&&arguments.length===4){var n=arguments[0],t=arguments[1],e=arguments[2],r=arguments[3];n.getLineSegment(t,this._overlapSeg1),e.getLineSegment(r,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}};fo.prototype.interfaces_=function(){return[]};fo.prototype.getClass=function(){return fo};var ye=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var n=arguments[0],t=arguments[1],e=arguments[2],r=arguments[3];this._pts=n,this._start=t,this._end=e,this._context=r};ye.prototype.getLineSegment=function(n,t){t.p0=this._pts[n],t.p1=this._pts[n+1]};ye.prototype.computeSelect=function(n,t,e,r){var o=this._pts[t],s=this._pts[e];if(r.tempEnv1.init(o,s),e-t===1)return r.select(this,t),null;if(!n.intersects(r.tempEnv1))return null;var l=Math.trunc((t+e)/2);t<l&&this.computeSelect(n,t,l,r),l<e&&this.computeSelect(n,l,e,r)};ye.prototype.getCoordinates=function(){for(var n=this,t=new Array(this._end-this._start+1).fill(null),e=0,r=this._start;r<=this._end;r++)t[e++]=n._pts[r];return t};ye.prototype.computeOverlaps=function(n,t){this.computeOverlapsInternal(this._start,this._end,n,n._start,n._end,t)};ye.prototype.setId=function(n){this._id=n};ye.prototype.select=function(n,t){this.computeSelect(n,this._start,this._end,t)};ye.prototype.getEnvelope=function(){if(this._env===null){var n=this._pts[this._start],t=this._pts[this._end];this._env=new B(n,t)}return this._env};ye.prototype.getEndIndex=function(){return this._end};ye.prototype.getStartIndex=function(){return this._start};ye.prototype.getContext=function(){return this._context};ye.prototype.getId=function(){return this._id};ye.prototype.computeOverlapsInternal=function(n,t,e,r,o,s){var l=this._pts[n],a=this._pts[t],h=e._pts[r],y=e._pts[o];if(t-n===1&&o-r===1)return s.overlap(this,n,e,r),null;if(s.tempEnv1.init(l,a),s.tempEnv2.init(h,y),!s.tempEnv1.intersects(s.tempEnv2))return null;var C=Math.trunc((n+t)/2),L=Math.trunc((r+o)/2);n<C&&(r<L&&this.computeOverlapsInternal(n,C,e,r,L,s),L<o&&this.computeOverlapsInternal(n,C,e,L,o,s)),C<t&&(r<L&&this.computeOverlapsInternal(C,t,e,r,L,s),L<o&&this.computeOverlapsInternal(C,t,e,L,o,s))};ye.prototype.interfaces_=function(){return[]};ye.prototype.getClass=function(){return ye};var an=function(){};an.prototype.interfaces_=function(){return[]};an.prototype.getClass=function(){return an};an.getChainStartIndices=function(n){var t=0,e=new O;e.add(new un(t));do{var r=an.findChainEnd(n,t);e.add(new un(r)),t=r}while(t<n.length-1);var o=an.toIntArray(e);return o};an.findChainEnd=function(n,t){for(var e=t;e<n.length-1&&n[e].equals2D(n[e+1]);)e++;if(e>=n.length-1)return n.length-1;for(var r=rt.quadrant(n[e],n[e+1]),o=t+1;o<n.length;){if(!n[o-1].equals2D(n[o])){var s=rt.quadrant(n[o-1],n[o]);if(s!==r)break}o++}return o-1};an.getChains=function(){if(arguments.length===1){var n=arguments[0];return an.getChains(n,null)}else if(arguments.length===2){for(var t=arguments[0],e=arguments[1],r=new O,o=an.getChainStartIndices(t),s=0;s<o.length-1;s++){var l=new ye(t,o[s],o[s+1],e);r.add(l)}return r}};an.toIntArray=function(n){for(var t=new Array(n.size()).fill(null),e=0;e<t.length;e++)t[e]=n.get(e).intValue();return t};var Dr=function(){};Dr.prototype.computeNodes=function(n){};Dr.prototype.getNodedSubstrings=function(){};Dr.prototype.interfaces_=function(){return[]};Dr.prototype.getClass=function(){return Dr};var ho=function(){if(this._segInt=null,arguments.length!==0&&arguments.length===1){var n=arguments[0];this.setSegmentIntersector(n)}};ho.prototype.setSegmentIntersector=function(n){this._segInt=n};ho.prototype.interfaces_=function(){return[Dr]};ho.prototype.getClass=function(){return ho};var Qs=function(n){function t(r){r?n.call(this,r):n.call(this),this._monoChains=new O,this._index=new wu,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t;var e={SegmentOverlapAction:{configurable:!0}};return t.prototype.getMonotoneChains=function(){return this._monoChains},t.prototype.getNodedSubstrings=function(){return Nt.getNodedSubstrings(this._nodedSegStrings)},t.prototype.getIndex=function(){return this._index},t.prototype.add=function(r){for(var o=this,s=an.getChains(r.getCoordinates(),r),l=s.iterator();l.hasNext();){var a=l.next();a.setId(o._idCounter++),o._index.insert(a.getEnvelope(),a),o._monoChains.add(a)}},t.prototype.computeNodes=function(r){var o=this;this._nodedSegStrings=r;for(var s=r.iterator();s.hasNext();)o.add(s.next());this.intersectChains()},t.prototype.intersectChains=function(){for(var r=this,o=new Aa(this._segInt),s=this._monoChains.iterator();s.hasNext();)for(var l=s.next(),a=r._index.query(l.getEnvelope()),h=a.iterator();h.hasNext();){var y=h.next();if(y.getId()>l.getId()&&(l.computeOverlaps(y,o),r._nOverlaps++),r._segInt.isDone())return null}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},e.SegmentOverlapAction.get=function(){return Aa},Object.defineProperties(t,e),t}(ho),Aa=function(n){function t(){n.call(this),this._si=null;var e=arguments[0];this._si=e}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.overlap=function(){if(arguments.length===4){var e=arguments[0],r=arguments[1],o=arguments[2],s=arguments[3],l=e.getContext(),a=o.getContext();this._si.processIntersections(l,r,a,s)}else return n.prototype.overlap.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(fo),J=function n(){if(this._quadrantSegments=n.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=n.CAP_ROUND,this._joinStyle=n.JOIN_ROUND,this._mitreLimit=n.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=n.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var t=arguments[0];this.setQuadrantSegments(t)}else if(arguments.length===2){var e=arguments[0],r=arguments[1];this.setQuadrantSegments(e),this.setEndCapStyle(r)}else if(arguments.length===4){var o=arguments[0],s=arguments[1],l=arguments[2],a=arguments[3];this.setQuadrantSegments(o),this.setEndCapStyle(s),this.setJoinStyle(l),this.setMitreLimit(a)}}},rr={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};J.prototype.getEndCapStyle=function(){return this._endCapStyle};J.prototype.isSingleSided=function(){return this._isSingleSided};J.prototype.setQuadrantSegments=function(n){this._quadrantSegments=n,this._quadrantSegments===0&&(this._joinStyle=J.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=J.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),n<=0&&(this._quadrantSegments=1),this._joinStyle!==J.JOIN_ROUND&&(this._quadrantSegments=J.DEFAULT_QUADRANT_SEGMENTS)};J.prototype.getJoinStyle=function(){return this._joinStyle};J.prototype.setJoinStyle=function(n){this._joinStyle=n};J.prototype.setSimplifyFactor=function(n){this._simplifyFactor=n<0?0:n};J.prototype.getSimplifyFactor=function(){return this._simplifyFactor};J.prototype.getQuadrantSegments=function(){return this._quadrantSegments};J.prototype.setEndCapStyle=function(n){this._endCapStyle=n};J.prototype.getMitreLimit=function(){return this._mitreLimit};J.prototype.setMitreLimit=function(n){this._mitreLimit=n};J.prototype.setSingleSided=function(n){this._isSingleSided=n};J.prototype.interfaces_=function(){return[]};J.prototype.getClass=function(){return J};J.bufferDistanceError=function(n){var t=Math.PI/2/n;return 1-Math.cos(t/2)};rr.CAP_ROUND.get=function(){return 1};rr.CAP_FLAT.get=function(){return 2};rr.CAP_SQUARE.get=function(){return 3};rr.JOIN_ROUND.get=function(){return 1};rr.JOIN_MITRE.get=function(){return 2};rr.JOIN_BEVEL.get=function(){return 3};rr.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8};rr.DEFAULT_MITRE_LIMIT.get=function(){return 5};rr.DEFAULT_SIMPLIFY_FACTOR.get=function(){return .01};Object.defineProperties(J,rr);var mt=function(n){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=M.COUNTERCLOCKWISE,this._inputLine=n||null},No={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};mt.prototype.isDeletable=function(n,t,e,r){var o=this._inputLine[n],s=this._inputLine[t],l=this._inputLine[e];return!this.isConcave(o,s,l)||!this.isShallow(o,s,l,r)?!1:this.isShallowSampled(o,s,n,e,r)};mt.prototype.deleteShallowConcavities=function(){for(var n=this,t=1,e=this.findNextNonDeletedIndex(t),r=this.findNextNonDeletedIndex(e),o=!1;r<this._inputLine.length;){var s=!1;n.isDeletable(t,e,r,n._distanceTol)&&(n._isDeleted[e]=mt.DELETE,s=!0,o=!0),s?t=r:t=e,e=n.findNextNonDeletedIndex(t),r=n.findNextNonDeletedIndex(e)}return o};mt.prototype.isShallowConcavity=function(n,t,e,r){var o=M.computeOrientation(n,t,e),s=o===this._angleOrientation;if(!s)return!1;var l=M.distancePointLine(t,n,e);return l<r};mt.prototype.isShallowSampled=function(n,t,e,r,o){var s=this,l=Math.trunc((r-e)/mt.NUM_PTS_TO_CHECK);l<=0&&(l=1);for(var a=e;a<r;a+=l)if(!s.isShallow(n,t,s._inputLine[a],o))return!1;return!0};mt.prototype.isConcave=function(n,t,e){var r=M.computeOrientation(n,t,e),o=r===this._angleOrientation;return o};mt.prototype.simplify=function(n){var t=this;this._distanceTol=Math.abs(n),n<0&&(this._angleOrientation=M.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var e=!1;do e=t.deleteShallowConcavities();while(e);return this.collapseLine()};mt.prototype.findNextNonDeletedIndex=function(n){for(var t=n+1;t<this._inputLine.length&&this._isDeleted[t]===mt.DELETE;)t++;return t};mt.prototype.isShallow=function(n,t,e,r){var o=M.distancePointLine(t,n,e);return o<r};mt.prototype.collapseLine=function(){for(var n=this,t=new Eo,e=0;e<this._inputLine.length;e++)n._isDeleted[e]!==mt.DELETE&&t.add(n._inputLine[e]);return t.toCoordinateArray()};mt.prototype.interfaces_=function(){return[]};mt.prototype.getClass=function(){return mt};mt.simplify=function(n,t){var e=new mt(n);return e.simplify(t)};No.INIT.get=function(){return 0};No.DELETE.get=function(){return 1};No.KEEP.get=function(){return 1};No.NUM_PTS_TO_CHECK.get=function(){return 10};Object.defineProperties(mt,No);var be=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new O},bu={COORDINATE_ARRAY_TYPE:{configurable:!0}};be.prototype.getCoordinates=function(){var n=this._ptList.toArray(be.COORDINATE_ARRAY_TYPE);return n};be.prototype.setPrecisionModel=function(n){this._precisionModel=n};be.prototype.addPt=function(n){var t=new d(n);if(this._precisionModel.makePrecise(t),this.isRedundant(t))return null;this._ptList.add(t)};be.prototype.revere=function(){};be.prototype.addPts=function(n,t){var e=this;if(t)for(var r=0;r<n.length;r++)e.addPt(n[r]);else for(var o=n.length-1;o>=0;o--)e.addPt(n[o])};be.prototype.isRedundant=function(n){if(this._ptList.size()<1)return!1;var t=this._ptList.get(this._ptList.size()-1),e=n.distance(t);return e<this._minimimVertexDistance};be.prototype.toString=function(){var n=new H,t=n.createLineString(this.getCoordinates());return t.toString()};be.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var n=new d(this._ptList.get(0)),t=this._ptList.get(this._ptList.size()-1);if(n.equals(t))return null;this._ptList.add(n)};be.prototype.setMinimumVertexDistance=function(n){this._minimimVertexDistance=n};be.prototype.interfaces_=function(){return[]};be.prototype.getClass=function(){return be};bu.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)};Object.defineProperties(be,bu);var K=function(){},gi={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};K.prototype.interfaces_=function(){return[]};K.prototype.getClass=function(){return K};K.toDegrees=function(n){return n*180/Math.PI};K.normalize=function(n){for(;n>Math.PI;)n-=K.PI_TIMES_2;for(;n<=-Math.PI;)n+=K.PI_TIMES_2;return n};K.angle=function(){if(arguments.length===1){var n=arguments[0];return Math.atan2(n.y,n.x)}else if(arguments.length===2){var t=arguments[0],e=arguments[1],r=e.x-t.x,o=e.y-t.y;return Math.atan2(o,r)}};K.isAcute=function(n,t,e){var r=n.x-t.x,o=n.y-t.y,s=e.x-t.x,l=e.y-t.y,a=r*s+o*l;return a>0};K.isObtuse=function(n,t,e){var r=n.x-t.x,o=n.y-t.y,s=e.x-t.x,l=e.y-t.y,a=r*s+o*l;return a<0};K.interiorAngle=function(n,t,e){var r=K.angle(t,n),o=K.angle(t,e);return Math.abs(o-r)};K.normalizePositive=function(n){if(n<0){for(;n<0;)n+=K.PI_TIMES_2;n>=K.PI_TIMES_2&&(n=0)}else{for(;n>=K.PI_TIMES_2;)n-=K.PI_TIMES_2;n<0&&(n=0)}return n};K.angleBetween=function(n,t,e){var r=K.angle(t,n),o=K.angle(t,e);return K.diff(r,o)};K.diff=function(n,t){var e=null;return n<t?e=t-n:e=n-t,e>Math.PI&&(e=2*Math.PI-e),e};K.toRadians=function(n){return n*Math.PI/180};K.getTurn=function(n,t){var e=Math.sin(t-n);return e>0?K.COUNTERCLOCKWISE:e<0?K.CLOCKWISE:K.NONE};K.angleBetweenOriented=function(n,t,e){var r=K.angle(t,n),o=K.angle(t,e),s=o-r;return s<=-Math.PI?s+K.PI_TIMES_2:s>Math.PI?s-K.PI_TIMES_2:s};gi.PI_TIMES_2.get=function(){return 2*Math.PI};gi.PI_OVER_2.get=function(){return Math.PI/2};gi.PI_OVER_4.get=function(){return Math.PI/4};gi.COUNTERCLOCKWISE.get=function(){return M.COUNTERCLOCKWISE};gi.CLOCKWISE.get=function(){return M.CLOCKWISE};gi.NONE.get=function(){return M.COLLINEAR};Object.defineProperties(K,gi);var lt=function n(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new k,this._seg1=new k,this._offset0=new k,this._offset1=new k,this._side=0,this._hasNarrowConcaveAngle=!1;var t=arguments[0],e=arguments[1],r=arguments[2];this._precisionModel=t,this._bufParams=e,this._li=new Xr,this._filletAngleQuantum=Math.PI/2/e.getQuadrantSegments(),e.getQuadrantSegments()>=8&&e.getJoinStyle()===J.JOIN_ROUND&&(this._closingSegLengthFactor=n.MAX_CLOSING_SEG_LEN_FACTOR),this.init(r)},xo={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};lt.prototype.addNextSegment=function(n,t){if(this._s0=this._s1,this._s1=this._s2,this._s2=n,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var e=M.computeOrientation(this._s0,this._s1,this._s2),r=e===M.CLOCKWISE&&this._side===b.LEFT||e===M.COUNTERCLOCKWISE&&this._side===b.RIGHT;e===0?this.addCollinear(t):r?this.addOutsideTurn(e,t):this.addInsideTurn(e,t)};lt.prototype.addLineEndCap=function(n,t){var e=new k(n,t),r=new k;this.computeOffsetSegment(e,b.LEFT,this._distance,r);var o=new k;this.computeOffsetSegment(e,b.RIGHT,this._distance,o);var s=t.x-n.x,l=t.y-n.y,a=Math.atan2(l,s);switch(this._bufParams.getEndCapStyle()){case J.CAP_ROUND:this._segList.addPt(r.p1),this.addFilletArc(t,a+Math.PI/2,a-Math.PI/2,M.CLOCKWISE,this._distance),this._segList.addPt(o.p1);break;case J.CAP_FLAT:this._segList.addPt(r.p1),this._segList.addPt(o.p1);break;case J.CAP_SQUARE:var h=new d;h.x=Math.abs(this._distance)*Math.cos(a),h.y=Math.abs(this._distance)*Math.sin(a);var y=new d(r.p1.x+h.x,r.p1.y+h.y),C=new d(o.p1.x+h.x,o.p1.y+h.y);this._segList.addPt(y),this._segList.addPt(C);break}};lt.prototype.getCoordinates=function(){var n=this._segList.getCoordinates();return n};lt.prototype.addMitreJoin=function(n,t,e,r){var o=!0,s=null;try{s=Ue.intersection(t.p0,t.p1,e.p0,e.p1);var l=r<=0?1:s.distance(n)/Math.abs(r);l>this._bufParams.getMitreLimit()&&(o=!1)}catch(a){if(a instanceof qi)s=new d(0,0),o=!1;else throw a}finally{}o?this._segList.addPt(s):this.addLimitedMitreJoin(t,e,r,this._bufParams.getMitreLimit())};lt.prototype.addFilletCorner=function(n,t,e,r,o){var s=t.x-n.x,l=t.y-n.y,a=Math.atan2(l,s),h=e.x-n.x,y=e.y-n.y,C=Math.atan2(y,h);r===M.CLOCKWISE?a<=C&&(a+=2*Math.PI):a>=C&&(a-=2*Math.PI),this._segList.addPt(t),this.addFilletArc(n,a,C,r,o),this._segList.addPt(e)};lt.prototype.addOutsideTurn=function(n,t){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*lt.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===J.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===J.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(t&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,n,this._distance),this._segList.addPt(this._offset1.p0))};lt.prototype.createSquare=function(n){this._segList.addPt(new d(n.x+this._distance,n.y+this._distance)),this._segList.addPt(new d(n.x+this._distance,n.y-this._distance)),this._segList.addPt(new d(n.x-this._distance,n.y-this._distance)),this._segList.addPt(new d(n.x-this._distance,n.y+this._distance)),this._segList.closeRing()};lt.prototype.addSegments=function(n,t){this._segList.addPts(n,t)};lt.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)};lt.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)};lt.prototype.initSideSegments=function(n,t,e){this._s1=n,this._s2=t,this._side=e,this._seg1.setCoordinates(n,t),this.computeOffsetSegment(this._seg1,e,this._distance,this._offset1)};lt.prototype.addLimitedMitreJoin=function(n,t,e,r){var o=this._seg0.p1,s=K.angle(o,this._seg0.p0),l=K.angleBetweenOriented(this._seg0.p0,o,this._seg1.p1),a=l/2,h=K.normalize(s+a),y=K.normalize(h+Math.PI),C=r*e,L=C*Math.abs(Math.sin(a)),Y=e-L,ze=o.x+C*Math.cos(y),Bt=o.y+C*Math.sin(y),Ir=new d(ze,Bt),Wr=new k(o,Ir),yi=Wr.pointAlongOffset(1,Y),Bn=Wr.pointAlongOffset(1,-Y);this._side===b.LEFT?(this._segList.addPt(yi),this._segList.addPt(Bn)):(this._segList.addPt(Bn),this._segList.addPt(yi))};lt.prototype.computeOffsetSegment=function(n,t,e,r){var o=t===b.LEFT?1:-1,s=n.p1.x-n.p0.x,l=n.p1.y-n.p0.y,a=Math.sqrt(s*s+l*l),h=o*e*s/a,y=o*e*l/a;r.p0.x=n.p0.x-y,r.p0.y=n.p0.y+h,r.p1.x=n.p1.x-y,r.p1.y=n.p1.y+h};lt.prototype.addFilletArc=function(n,t,e,r,o){var s=this,l=r===M.CLOCKWISE?-1:1,a=Math.abs(t-e),h=Math.trunc(a/this._filletAngleQuantum+.5);if(h<1)return null;for(var y=0,C=a/h,L=y,Y=new d;L<a;){var ze=t+l*L;Y.x=n.x+o*Math.cos(ze),Y.y=n.y+o*Math.sin(ze),s._segList.addPt(Y),L+=C}};lt.prototype.addInsideTurn=function(n,t){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*lt.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var e=new d((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(e);var r=new d((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}};lt.prototype.createCircle=function(n){var t=new d(n.x+this._distance,n.y);this._segList.addPt(t),this.addFilletArc(n,0,2*Math.PI,-1,this._distance),this._segList.closeRing()};lt.prototype.addBevelJoin=function(n,t){this._segList.addPt(n.p1),this._segList.addPt(t.p0)};lt.prototype.init=function(n){this._distance=n,this._maxCurveSegmentError=n*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new be,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(n*lt.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)};lt.prototype.addCollinear=function(n){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);var t=this._li.getIntersectionNum();t>=2&&(this._bufParams.getJoinStyle()===J.JOIN_BEVEL||this._bufParams.getJoinStyle()===J.JOIN_MITRE?(n&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,M.CLOCKWISE,this._distance))};lt.prototype.closeRing=function(){this._segList.closeRing()};lt.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle};lt.prototype.interfaces_=function(){return[]};lt.prototype.getClass=function(){return lt};xo.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return .001};xo.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return .001};xo.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6};xo.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80};Object.defineProperties(lt,xo);var fe=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var n=arguments[0],t=arguments[1];this._precisionModel=n,this._bufParams=t};fe.prototype.getOffsetCurve=function(n,t){if(this._distance=t,t===0)return null;var e=t<0,r=Math.abs(t),o=this.getSegGen(r);n.length<=1?this.computePointCurve(n[0],o):this.computeOffsetCurve(n,e,o);var s=o.getCoordinates();return e&&j.reverse(s),s};fe.prototype.computeSingleSidedBufferCurve=function(n,t,e){var r=this.simplifyTolerance(this._distance);if(t){e.addSegments(n,!0);var o=mt.simplify(n,-r),s=o.length-1;e.initSideSegments(o[s],o[s-1],b.LEFT),e.addFirstSegment();for(var l=s-2;l>=0;l--)e.addNextSegment(o[l],!0)}else{e.addSegments(n,!1);var a=mt.simplify(n,r),h=a.length-1;e.initSideSegments(a[0],a[1],b.LEFT),e.addFirstSegment();for(var y=2;y<=h;y++)e.addNextSegment(a[y],!0)}e.addLastSegment(),e.closeRing()};fe.prototype.computeRingBufferCurve=function(n,t,e){var r=this.simplifyTolerance(this._distance);t===b.RIGHT&&(r=-r);var o=mt.simplify(n,r),s=o.length-1;e.initSideSegments(o[s-1],o[0],t);for(var l=1;l<=s;l++){var a=l!==1;e.addNextSegment(o[l],a)}e.closeRing()};fe.prototype.computeLineBufferCurve=function(n,t){var e=this.simplifyTolerance(this._distance),r=mt.simplify(n,e),o=r.length-1;t.initSideSegments(r[0],r[1],b.LEFT);for(var s=2;s<=o;s++)t.addNextSegment(r[s],!0);t.addLastSegment(),t.addLineEndCap(r[o-1],r[o]);var l=mt.simplify(n,-e),a=l.length-1;t.initSideSegments(l[a],l[a-1],b.LEFT);for(var h=a-2;h>=0;h--)t.addNextSegment(l[h],!0);t.addLastSegment(),t.addLineEndCap(l[1],l[0]),t.closeRing()};fe.prototype.computePointCurve=function(n,t){switch(this._bufParams.getEndCapStyle()){case J.CAP_ROUND:t.createCircle(n);break;case J.CAP_SQUARE:t.createSquare(n);break}};fe.prototype.getLineCurve=function(n,t){if(this._distance=t,t<0&&!this._bufParams.isSingleSided()||t===0)return null;var e=Math.abs(t),r=this.getSegGen(e);if(n.length<=1)this.computePointCurve(n[0],r);else if(this._bufParams.isSingleSided()){var o=t<0;this.computeSingleSidedBufferCurve(n,o,r)}else this.computeLineBufferCurve(n,r);var s=r.getCoordinates();return s};fe.prototype.getBufferParameters=function(){return this._bufParams};fe.prototype.simplifyTolerance=function(n){return n*this._bufParams.getSimplifyFactor()};fe.prototype.getRingCurve=function(n,t,e){if(this._distance=e,n.length<=2)return this.getLineCurve(n,e);if(e===0)return fe.copyCoordinates(n);var r=this.getSegGen(e);return this.computeRingBufferCurve(n,t,r),r.getCoordinates()};fe.prototype.computeOffsetCurve=function(n,t,e){var r=this.simplifyTolerance(this._distance);if(t){var o=mt.simplify(n,-r),s=o.length-1;e.initSideSegments(o[s],o[s-1],b.LEFT),e.addFirstSegment();for(var l=s-2;l>=0;l--)e.addNextSegment(o[l],!0)}else{var a=mt.simplify(n,r),h=a.length-1;e.initSideSegments(a[0],a[1],b.LEFT),e.addFirstSegment();for(var y=2;y<=h;y++)e.addNextSegment(a[y],!0)}e.addLastSegment()};fe.prototype.getSegGen=function(n){return new lt(this._precisionModel,this._bufParams,n)};fe.prototype.interfaces_=function(){return[]};fe.prototype.getClass=function(){return fe};fe.copyCoordinates=function(n){for(var t=new Array(n.length).fill(null),e=0;e<t.length;e++)t[e]=new d(n[e]);return t};var ti=function(){this._subgraphs=null,this._seg=new k,this._cga=new M;var n=arguments[0];this._subgraphs=n},Pu={DepthSegment:{configurable:!0}};ti.prototype.findStabbedSegments=function(){var n=this;if(arguments.length===1){for(var t=arguments[0],e=new O,r=this._subgraphs.iterator();r.hasNext();){var o=r.next(),s=o.getEnvelope();t.y<s.getMinY()||t.y>s.getMaxY()||n.findStabbedSegments(t,o.getDirectedEdges(),e)}return e}else if(arguments.length===3){if(V(arguments[2],qe)&&arguments[0]instanceof d&&arguments[1]instanceof As)for(var l=arguments[0],a=arguments[1],h=arguments[2],y=a.getEdge().getCoordinates(),C=0;C<y.length-1;C++){n._seg.p0=y[C],n._seg.p1=y[C+1],n._seg.p0.y>n._seg.p1.y&&n._seg.reverse();var L=Math.max(n._seg.p0.x,n._seg.p1.x);if(!(L<l.x)&&!n._seg.isHorizontal()&&!(l.y<n._seg.p0.y||l.y>n._seg.p1.y)&&M.computeOrientation(n._seg.p0,n._seg.p1,l)!==M.RIGHT){var Y=a.getDepth(b.LEFT);n._seg.p0.equals(y[C])||(Y=a.getDepth(b.RIGHT));var ze=new Mr(n._seg,Y);h.add(ze)}}else if(V(arguments[2],qe)&&arguments[0]instanceof d&&V(arguments[1],qe))for(var Bt=arguments[0],Ir=arguments[1],Wr=arguments[2],yi=Ir.iterator();yi.hasNext();){var Bn=yi.next();Bn.isForward()&&n.findStabbedSegments(Bt,Bn,Wr)}}};ti.prototype.getDepth=function(n){var t=this.findStabbedSegments(n);if(t.size()===0)return 0;var e=He.min(t);return e._leftDepth};ti.prototype.interfaces_=function(){return[]};ti.prototype.getClass=function(){return ti};Pu.DepthSegment.get=function(){return Mr};Object.defineProperties(ti,Pu);var Mr=function(){this._upwardSeg=null,this._leftDepth=null;var n=arguments[0],t=arguments[1];this._upwardSeg=new k(n),this._leftDepth=t};Mr.prototype.compareTo=function(n){var t=n;if(this._upwardSeg.minX()>=t._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=t._upwardSeg.minX())return-1;var e=this._upwardSeg.orientationIndex(t._upwardSeg);return e!==0||(e=-1*t._upwardSeg.orientationIndex(this._upwardSeg),e!==0)?e:this._upwardSeg.compareTo(t._upwardSeg)};Mr.prototype.compareX=function(n,t){var e=n.p0.compareTo(t.p0);return e!==0?e:n.p1.compareTo(t.p1)};Mr.prototype.toString=function(){return this._upwardSeg.toString()};Mr.prototype.interfaces_=function(){return[ke]};Mr.prototype.getClass=function(){return Mr};var tt=function(n,t,e){this.p0=n||null,this.p1=t||null,this.p2=e||null};tt.prototype.area=function(){return tt.area(this.p0,this.p1,this.p2)};tt.prototype.signedArea=function(){return tt.signedArea(this.p0,this.p1,this.p2)};tt.prototype.interpolateZ=function(n){if(n===null)throw new ft("Supplied point is null.");return tt.interpolateZ(n,this.p0,this.p1,this.p2)};tt.prototype.longestSideLength=function(){return tt.longestSideLength(this.p0,this.p1,this.p2)};tt.prototype.isAcute=function(){return tt.isAcute(this.p0,this.p1,this.p2)};tt.prototype.circumcentre=function(){return tt.circumcentre(this.p0,this.p1,this.p2)};tt.prototype.area3D=function(){return tt.area3D(this.p0,this.p1,this.p2)};tt.prototype.centroid=function(){return tt.centroid(this.p0,this.p1,this.p2)};tt.prototype.inCentre=function(){return tt.inCentre(this.p0,this.p1,this.p2)};tt.prototype.interfaces_=function(){return[]};tt.prototype.getClass=function(){return tt};tt.area=function(n,t,e){return Math.abs(((e.x-n.x)*(t.y-n.y)-(t.x-n.x)*(e.y-n.y))/2)};tt.signedArea=function(n,t,e){return((e.x-n.x)*(t.y-n.y)-(t.x-n.x)*(e.y-n.y))/2};tt.det=function(n,t,e,r){return n*r-t*e};tt.interpolateZ=function(n,t,e,r){var o=t.x,s=t.y,l=e.x-o,a=r.x-o,h=e.y-s,y=r.y-s,C=l*y-a*h,L=n.x-o,Y=n.y-s,ze=(y*L-a*Y)/C,Bt=(-h*L+l*Y)/C,Ir=t.z+ze*(e.z-t.z)+Bt*(r.z-t.z);return Ir};tt.longestSideLength=function(n,t,e){var r=n.distance(t),o=t.distance(e),s=e.distance(n),l=r;return o>l&&(l=o),s>l&&(l=s),l};tt.isAcute=function(n,t,e){return!(!K.isAcute(n,t,e)||!K.isAcute(t,e,n)||!K.isAcute(e,n,t))};tt.circumcentre=function(n,t,e){var r=e.x,o=e.y,s=n.x-r,l=n.y-o,a=t.x-r,h=t.y-o,y=2*tt.det(s,l,a,h),C=tt.det(l,s*s+l*l,h,a*a+h*h),L=tt.det(s,s*s+l*l,a,a*a+h*h),Y=r-C/y,ze=o+L/y;return new d(Y,ze)};tt.perpendicularBisector=function(n,t){var e=t.x-n.x,r=t.y-n.y,o=new Ue(n.x+e/2,n.y+r/2,1),s=new Ue(n.x-r+e/2,n.y+e+r/2,1);return new Ue(o,s)};tt.angleBisector=function(n,t,e){var r=t.distance(n),o=t.distance(e),s=r/(r+o),l=e.x-n.x,a=e.y-n.y,h=new d(n.x+s*l,n.y+s*a);return h};tt.area3D=function(n,t,e){var r=t.x-n.x,o=t.y-n.y,s=t.z-n.z,l=e.x-n.x,a=e.y-n.y,h=e.z-n.z,y=o*h-s*a,C=s*l-r*h,L=r*a-o*l,Y=y*y+C*C+L*L,ze=Math.sqrt(Y)/2;return ze};tt.centroid=function(n,t,e){var r=(n.x+t.x+e.x)/3,o=(n.y+t.y+e.y)/3;return new d(r,o)};tt.inCentre=function(n,t,e){var r=t.distance(e),o=n.distance(e),s=n.distance(t),l=r+o+s,a=(r*n.x+o*t.x+s*e.x)/l,h=(r*n.y+o*t.y+s*e.y)/l;return new d(a,h)};var Be=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new O;var n=arguments[0],t=arguments[1],e=arguments[2];this._inputGeom=n,this._distance=t,this._curveBuilder=e};Be.prototype.addPoint=function(n){if(this._distance<=0)return null;var t=n.getCoordinates(),e=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(e,E.EXTERIOR,E.INTERIOR)};Be.prototype.addPolygon=function(n){var t=this,e=this._distance,r=b.LEFT;this._distance<0&&(e=-this._distance,r=b.RIGHT);var o=n.getExteriorRing(),s=j.removeRepeatedPoints(o.getCoordinates());if(this._distance<0&&this.isErodedCompletely(o,this._distance)||this._distance<=0&&s.length<3)return null;this.addPolygonRing(s,e,r,E.EXTERIOR,E.INTERIOR);for(var l=0;l<n.getNumInteriorRing();l++){var a=n.getInteriorRingN(l),h=j.removeRepeatedPoints(a.getCoordinates());t._distance>0&&t.isErodedCompletely(a,-t._distance)||t.addPolygonRing(h,e,b.opposite(r),E.INTERIOR,E.EXTERIOR)}};Be.prototype.isTriangleErodedCompletely=function(n,t){var e=new tt(n[0],n[1],n[2]),r=e.inCentre(),o=M.distancePointLine(r,e.p0,e.p1);return o<Math.abs(t)};Be.prototype.addLineString=function(n){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var t=j.removeRepeatedPoints(n.getCoordinates()),e=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(e,E.EXTERIOR,E.INTERIOR)};Be.prototype.addCurve=function(n,t,e){if(n===null||n.length<2)return null;var r=new Nt(n,new et(0,E.BOUNDARY,t,e));this._curveList.add(r)};Be.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList};Be.prototype.addPolygonRing=function(n,t,e,r,o){if(t===0&&n.length<bn.MINIMUM_VALID_SIZE)return null;var s=r,l=o;n.length>=bn.MINIMUM_VALID_SIZE&&M.isCCW(n)&&(s=o,l=r,e=b.opposite(e));var a=this._curveBuilder.getRingCurve(n,e,t);this.addCurve(a,s,l)};Be.prototype.add=function(n){if(n.isEmpty())return null;n instanceof Ot?this.addPolygon(n):n instanceof yt?this.addLineString(n):n instanceof de?this.addPoint(n):n instanceof Pi?this.addCollection(n):n instanceof Tr?this.addCollection(n):n instanceof Sn?this.addCollection(n):n instanceof ie&&this.addCollection(n)};Be.prototype.isErodedCompletely=function(n,t){var e=n.getCoordinates();if(e.length<4)return t<0;if(e.length===4)return this.isTriangleErodedCompletely(e,t);var r=n.getEnvelopeInternal(),o=Math.min(r.getHeight(),r.getWidth());return t<0&&2*Math.abs(t)>o};Be.prototype.addCollection=function(n){for(var t=this,e=0;e<n.getNumGeometries();e++){var r=n.getGeometryN(e);t.add(r)}};Be.prototype.interfaces_=function(){return[]};Be.prototype.getClass=function(){return Be};var Di=function(){};Di.prototype.locate=function(n){};Di.prototype.interfaces_=function(){return[]};Di.prototype.getClass=function(){return Di};var wn=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var n=arguments[0];this._parent=n,this._atStart=!0,this._index=0,this._max=n.getNumGeometries()};wn.prototype.next=function(){if(this._atStart)return this._atStart=!1,wn.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Yi;var n=this._parent.getGeometryN(this._index++);return n instanceof ie?(this._subcollectionIterator=new wn(n),this._subcollectionIterator.next()):n};wn.prototype.remove=function(){throw new Error(this.getClass().getName())};wn.prototype.hasNext=function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)};wn.prototype.interfaces_=function(){return[Xi]};wn.prototype.getClass=function(){return wn};wn.isAtomic=function(n){return!(n instanceof ie)};var xe=function(){this._geom=null;var n=arguments[0];this._geom=n};xe.prototype.locate=function(n){return xe.locate(n,this._geom)};xe.prototype.interfaces_=function(){return[Di]};xe.prototype.getClass=function(){return xe};xe.isPointInRing=function(n,t){return t.getEnvelopeInternal().intersects(n)?M.isPointInRing(n,t.getCoordinates()):!1};xe.containsPointInPolygon=function(n,t){if(t.isEmpty())return!1;var e=t.getExteriorRing();if(!xe.isPointInRing(n,e))return!1;for(var r=0;r<t.getNumInteriorRing();r++){var o=t.getInteriorRingN(r);if(xe.isPointInRing(n,o))return!1}return!0};xe.containsPoint=function(n,t){if(t instanceof Ot)return xe.containsPointInPolygon(n,t);if(t instanceof ie)for(var e=new wn(t);e.hasNext();){var r=e.next();if(r!==t&&xe.containsPoint(n,r))return!0}return!1};xe.locate=function(n,t){return t.isEmpty()?E.EXTERIOR:xe.containsPoint(n,t)?E.INTERIOR:E.EXTERIOR};var Zt=function(){this._edgeMap=new Kt,this._edgeList=null,this._ptInAreaLocation=[E.NONE,E.NONE]};Zt.prototype.getNextCW=function(n){this.getEdges();var t=this._edgeList.indexOf(n),e=t-1;return t===0&&(e=this._edgeList.size()-1),this._edgeList.get(e)};Zt.prototype.propagateSideLabels=function(n){for(var t=E.NONE,e=this.iterator();e.hasNext();){var r=e.next(),o=r.getLabel();o.isArea(n)&&o.getLocation(n,b.LEFT)!==E.NONE&&(t=o.getLocation(n,b.LEFT))}if(t===E.NONE)return null;for(var s=t,l=this.iterator();l.hasNext();){var a=l.next(),h=a.getLabel();if(h.getLocation(n,b.ON)===E.NONE&&h.setLocation(n,b.ON,s),h.isArea(n)){var y=h.getLocation(n,b.LEFT),C=h.getLocation(n,b.RIGHT);if(C!==E.NONE){if(C!==s)throw new Jn("side location conflict",a.getCoordinate());y===E.NONE&&q.shouldNeverReachHere("found single null side (at "+a.getCoordinate()+")"),s=y}else q.isTrue(h.getLocation(n,b.LEFT)===E.NONE,"found single null side"),h.setLocation(n,b.RIGHT,s),h.setLocation(n,b.LEFT,s)}}};Zt.prototype.getCoordinate=function(){var n=this.iterator();if(!n.hasNext())return null;var t=n.next();return t.getCoordinate()};Zt.prototype.print=function(n){qt.out.println("EdgeEndStar:   "+this.getCoordinate());for(var t=this.iterator();t.hasNext();){var e=t.next();e.print(n)}};Zt.prototype.isAreaLabelsConsistent=function(n){return this.computeEdgeEndLabels(n.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)};Zt.prototype.checkAreaLabelsConsistent=function(n){var t=this.getEdges();if(t.size()<=0)return!0;var e=t.size()-1,r=t.get(e).getLabel(),o=r.getLocation(n,b.LEFT);q.isTrue(o!==E.NONE,"Found unlabelled area edge");for(var s=o,l=this.iterator();l.hasNext();){var a=l.next(),h=a.getLabel();q.isTrue(h.isArea(n),"Found non-area edge");var y=h.getLocation(n,b.LEFT),C=h.getLocation(n,b.RIGHT);if(y===C||C!==s)return!1;s=y}return!0};Zt.prototype.findIndex=function(n){var t=this;this.iterator();for(var e=0;e<this._edgeList.size();e++){var r=t._edgeList.get(e);if(r===n)return e}return-1};Zt.prototype.iterator=function(){return this.getEdges().iterator()};Zt.prototype.getEdges=function(){return this._edgeList===null&&(this._edgeList=new O(this._edgeMap.values())),this._edgeList};Zt.prototype.getLocation=function(n,t,e){return this._ptInAreaLocation[n]===E.NONE&&(this._ptInAreaLocation[n]=xe.locate(t,e[n].getGeometry())),this._ptInAreaLocation[n]};Zt.prototype.toString=function(){var n=new _n;n.append("EdgeEndStar:   "+this.getCoordinate()),n.append(`
`);for(var t=this.iterator();t.hasNext();){var e=t.next();n.append(e),n.append(`
`)}return n.toString()};Zt.prototype.computeEdgeEndLabels=function(n){for(var t=this.iterator();t.hasNext();){var e=t.next();e.computeLabel(n)}};Zt.prototype.computeLabelling=function(n){var t=this;this.computeEdgeEndLabels(n[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var e=[!1,!1],r=this.iterator();r.hasNext();)for(var o=r.next(),s=o.getLabel(),l=0;l<2;l++)s.isLine(l)&&s.getLocation(l)===E.BOUNDARY&&(e[l]=!0);for(var a=this.iterator();a.hasNext();)for(var h=a.next(),y=h.getLabel(),C=0;C<2;C++)if(y.isAnyNull(C)){var L=E.NONE;if(e[C])L=E.EXTERIOR;else{var Y=h.getCoordinate();L=t.getLocation(C,Y,n)}y.setAllLocationsIfNull(C,L)}};Zt.prototype.getDegree=function(){return this._edgeMap.size()};Zt.prototype.insertEdgeEnd=function(n,t){this._edgeMap.put(n,t),this._edgeList=null};Zt.prototype.interfaces_=function(){return[]};Zt.prototype.getClass=function(){return Zt};var of=function(n){function t(){n.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.linkResultDirectedEdges=function(){var e=this;this.getResultAreaEdges();for(var r=null,o=null,s=this._SCANNING_FOR_INCOMING,l=0;l<this._resultAreaEdgeList.size();l++){var a=e._resultAreaEdgeList.get(l),h=a.getSym();if(a.getLabel().isArea())switch(r===null&&a.isInResult()&&(r=a),s){case e._SCANNING_FOR_INCOMING:if(!h.isInResult())continue;o=h,s=e._LINKING_TO_OUTGOING;break;case e._LINKING_TO_OUTGOING:if(!a.isInResult())continue;o.setNext(a),s=e._SCANNING_FOR_INCOMING;break}}if(s===this._LINKING_TO_OUTGOING){if(r===null)throw new Jn("no outgoing dirEdge found",this.getCoordinate());q.isTrue(r.isInResult(),"unable to link last incoming dirEdge"),o.setNext(r)}},t.prototype.insert=function(e){var r=e;this.insertEdgeEnd(r,r)},t.prototype.getRightmostEdge=function(){var e=this.getEdges(),r=e.size();if(r<1)return null;var o=e.get(0);if(r===1)return o;var s=e.get(r-1),l=o.getQuadrant(),a=s.getQuadrant();return rt.isNorthern(l)&&rt.isNorthern(a)?o:!rt.isNorthern(l)&&!rt.isNorthern(a)?s:o.getDy()!==0?o:s.getDy()!==0?s:(q.shouldNeverReachHere("found two horizontal edges incident on node"),null)},t.prototype.print=function(e){qt.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var r=this.iterator();r.hasNext();){var o=r.next();e.print("out "),o.print(e),e.println(),e.print("in "),o.getSym().print(e),e.println()}},t.prototype.getResultAreaEdges=function(){var e=this;if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new O;for(var r=this.iterator();r.hasNext();){var o=r.next();(o.isInResult()||o.getSym().isInResult())&&e._resultAreaEdgeList.add(o)}return this._resultAreaEdgeList},t.prototype.updateLabelling=function(e){for(var r=this.iterator();r.hasNext();){var o=r.next(),s=o.getLabel();s.setAllLocationsIfNull(0,e.getLocation(0)),s.setAllLocationsIfNull(1,e.getLocation(1))}},t.prototype.linkAllDirectedEdges=function(){var e=this;this.getEdges();for(var r=null,o=null,s=this._edgeList.size()-1;s>=0;s--){var l=e._edgeList.get(s),a=l.getSym();o===null&&(o=a),r!==null&&a.setNext(r),r=l}o.setNext(r)},t.prototype.computeDepths=function(){var e=this;if(arguments.length===1){var r=arguments[0],o=this.findIndex(r),s=r.getDepth(b.LEFT),l=r.getDepth(b.RIGHT),a=this.computeDepths(o+1,this._edgeList.size(),s),h=this.computeDepths(0,o,a);if(h!==l)throw new Jn("depth mismatch at "+r.getCoordinate())}else if(arguments.length===3){for(var y=arguments[0],C=arguments[1],L=arguments[2],Y=L,ze=y;ze<C;ze++){var Bt=e._edgeList.get(ze);Bt.setEdgeDepths(b.RIGHT,Y),Y=Bt.getDepth(b.LEFT)}return Y}},t.prototype.mergeSymLabels=function(){for(var e=this.iterator();e.hasNext();){var r=e.next(),o=r.getLabel();o.merge(r.getSym().getLabel())}},t.prototype.linkMinimalDirectedEdges=function(e){for(var r=this,o=null,s=null,l=this._SCANNING_FOR_INCOMING,a=this._resultAreaEdgeList.size()-1;a>=0;a--){var h=r._resultAreaEdgeList.get(a),y=h.getSym();switch(o===null&&h.getEdgeRing()===e&&(o=h),l){case r._SCANNING_FOR_INCOMING:if(y.getEdgeRing()!==e)continue;s=y,l=r._LINKING_TO_OUTGOING;break;case r._LINKING_TO_OUTGOING:if(h.getEdgeRing()!==e)continue;s.setNextMin(h),l=r._SCANNING_FOR_INCOMING;break}}l===this._LINKING_TO_OUTGOING&&(q.isTrue(o!==null,"found null for first outgoing dirEdge"),q.isTrue(o.getEdgeRing()===e,"unable to link last incoming dirEdge"),s.setNextMin(o))},t.prototype.getOutgoingDegree=function(){if(arguments.length===0){for(var e=0,r=this.iterator();r.hasNext();){var o=r.next();o.isInResult()&&e++}return e}else if(arguments.length===1){for(var s=arguments[0],l=0,a=this.iterator();a.hasNext();){var h=a.next();h.getEdgeRing()===s&&l++}return l}},t.prototype.getLabel=function(){return this._label},t.prototype.findCoveredLineEdges=function(){for(var e=E.NONE,r=this.iterator();r.hasNext();){var o=r.next(),s=o.getSym();if(!o.isLineEdge()){if(o.isInResult()){e=E.INTERIOR;break}if(s.isInResult()){e=E.EXTERIOR;break}}}if(e===E.NONE)return null;for(var l=e,a=this.iterator();a.hasNext();){var h=a.next(),y=h.getSym();h.isLineEdge()?h.getEdge().setCovered(l===E.INTERIOR):(h.isInResult()&&(l=E.EXTERIOR),y.isInResult()&&(l=E.INTERIOR))}},t.prototype.computeLabelling=function(e){var r=this;n.prototype.computeLabelling.call(this,e),this._label=new et(E.NONE);for(var o=this.iterator();o.hasNext();)for(var s=o.next(),l=s.getEdge(),a=l.getLabel(),h=0;h<2;h++){var y=a.getLocation(h);(y===E.INTERIOR||y===E.BOUNDARY)&&r._label.setLocation(h,E.INTERIOR)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Zt),Ru=function(n){function t(){n.apply(this,arguments)}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.createNode=function(e){return new ls(e,new of)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Ri),pr=function n(){this._pts=null,this._orientation=null;var t=arguments[0];this._pts=t,this._orientation=n.orientation(t)};pr.prototype.compareTo=function(n){var t=n,e=pr.compareOriented(this._pts,this._orientation,t._pts,t._orientation);return e};pr.prototype.interfaces_=function(){return[ke]};pr.prototype.getClass=function(){return pr};pr.orientation=function(n){return j.increasingDirection(n)===1};pr.compareOriented=function(n,t,e,r){for(var o=t?1:-1,s=r?1:-1,l=t?n.length:-1,a=r?e.length:-1,h=t?0:n.length-1,y=r?0:e.length-1;;){var C=n[h].compareTo(e[y]);if(C!==0)return C;h+=o,y+=s;var L=h===l,Y=y===a;if(L&&!Y)return-1;if(!L&&Y)return 1;if(L&&Y)return 0}};var je=function(){this._edges=new O,this._ocaMap=new Kt};je.prototype.print=function(n){var t=this;n.print("MULTILINESTRING ( ");for(var e=0;e<this._edges.size();e++){var r=t._edges.get(e);e>0&&n.print(","),n.print("(");for(var o=r.getCoordinates(),s=0;s<o.length;s++)s>0&&n.print(","),n.print(o[s].x+" "+o[s].y);n.println(")")}n.print(")  ")};je.prototype.addAll=function(n){for(var t=this,e=n.iterator();e.hasNext();)t.add(e.next())};je.prototype.findEdgeIndex=function(n){for(var t=this,e=0;e<this._edges.size();e++)if(t._edges.get(e).equals(n))return e;return-1};je.prototype.iterator=function(){return this._edges.iterator()};je.prototype.getEdges=function(){return this._edges};je.prototype.get=function(n){return this._edges.get(n)};je.prototype.findEqualEdge=function(n){var t=new pr(n.getCoordinates()),e=this._ocaMap.get(t);return e};je.prototype.add=function(n){this._edges.add(n);var t=new pr(n.getCoordinates());this._ocaMap.put(t,n)};je.prototype.interfaces_=function(){return[]};je.prototype.getClass=function(){return je};var Ar=function(){};Ar.prototype.processIntersections=function(n,t,e,r){};Ar.prototype.isDone=function(){};Ar.prototype.interfaces_=function(){return[]};Ar.prototype.getClass=function(){return Ar};var Pe=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var n=arguments[0];this._li=n};Pe.prototype.isTrivialIntersection=function(n,t,e,r){if(n===e&&this._li.getIntersectionNum()===1){if(Pe.isAdjacentSegments(t,r))return!0;if(n.isClosed()){var o=n.size()-1;if(t===0&&r===o||r===0&&t===o)return!0}}return!1};Pe.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Pe.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Pe.prototype.getLineIntersector=function(){return this._li};Pe.prototype.hasProperIntersection=function(){return this._hasProper};Pe.prototype.processIntersections=function(n,t,e,r){if(n===e&&t===r)return null;this.numTests++;var o=n.getCoordinates()[t],s=n.getCoordinates()[t+1],l=e.getCoordinates()[r],a=e.getCoordinates()[r+1];this._li.computeIntersection(o,s,l,a),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(n,t,e,r)||(this._hasIntersection=!0,n.addIntersections(this._li,t,0),e.addIntersections(this._li,r,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))};Pe.prototype.hasIntersection=function(){return this._hasIntersection};Pe.prototype.isDone=function(){return!1};Pe.prototype.hasInteriorIntersection=function(){return this._hasInterior};Pe.prototype.interfaces_=function(){return[Ar]};Pe.prototype.getClass=function(){return Pe};Pe.isAdjacentSegments=function(n,t){return Math.abs(n-t)===1};var pn=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var n=arguments[0],t=arguments[1],e=arguments[2];this.coord=new d(n),this.segmentIndex=t,this.dist=e};pn.prototype.getSegmentIndex=function(){return this.segmentIndex};pn.prototype.getCoordinate=function(){return this.coord};pn.prototype.print=function(n){n.print(this.coord),n.print(" seg # = "+this.segmentIndex),n.println(" dist = "+this.dist)};pn.prototype.compareTo=function(n){var t=n;return this.compare(t.segmentIndex,t.dist)};pn.prototype.isEndPoint=function(n){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===n};pn.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist};pn.prototype.getDistance=function(){return this.dist};pn.prototype.compare=function(n,t){return this.segmentIndex<n?-1:this.segmentIndex>n?1:this.dist<t?-1:this.dist>t?1:0};pn.prototype.interfaces_=function(){return[ke]};pn.prototype.getClass=function(){return pn};var On=function(){this._nodeMap=new Kt,this.edge=null;var n=arguments[0];this.edge=n};On.prototype.print=function(n){n.println("Intersections:");for(var t=this.iterator();t.hasNext();){var e=t.next();e.print(n)}};On.prototype.iterator=function(){return this._nodeMap.values().iterator()};On.prototype.addSplitEdges=function(n){var t=this;this.addEndpoints();for(var e=this.iterator(),r=e.next();e.hasNext();){var o=e.next(),s=t.createSplitEdge(r,o);n.add(s),r=o}};On.prototype.addEndpoints=function(){var n=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[n],n,0)};On.prototype.createSplitEdge=function(n,t){var e=this,r=t.segmentIndex-n.segmentIndex+2,o=this.edge.pts[t.segmentIndex],s=t.dist>0||!t.coord.equals2D(o);s||r--;var l=new Array(r).fill(null),a=0;l[a++]=new d(n.coord);for(var h=n.segmentIndex+1;h<=t.segmentIndex;h++)l[a++]=e.edge.pts[h];return s&&(l[a]=t.coord),new Xo(l,new et(this.edge._label))};On.prototype.add=function(n,t,e){var r=new pn(n,t,e),o=this._nodeMap.get(r);return o!==null?o:(this._nodeMap.put(r,r),r)};On.prototype.isIntersection=function(n){for(var t=this.iterator();t.hasNext();){var e=t.next();if(e.coord.equals(n))return!0}return!1};On.prototype.interfaces_=function(){return[]};On.prototype.getClass=function(){return On};var Fr=function(){};Fr.prototype.getChainStartIndices=function(n){var t=this,e=0,r=new O;r.add(new un(e));do{var o=t.findChainEnd(n,e);r.add(new un(o)),e=o}while(e<n.length-1);var s=Fr.toIntArray(r);return s};Fr.prototype.findChainEnd=function(n,t){for(var e=rt.quadrant(n[t],n[t+1]),r=t+1;r<n.length;){var o=rt.quadrant(n[r-1],n[r]);if(o!==e)break;r++}return r-1};Fr.prototype.interfaces_=function(){return[]};Fr.prototype.getClass=function(){return Fr};Fr.toIntArray=function(n){for(var t=new Array(n.size()).fill(null),e=0;e<t.length;e++)t[e]=n.get(e).intValue();return t};var tr=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new B,this.env2=new B;var n=arguments[0];this.e=n,this.pts=n.getCoordinates();var t=new Fr;this.startIndex=t.getChainStartIndices(this.pts)};tr.prototype.getCoordinates=function(){return this.pts};tr.prototype.getMaxX=function(n){var t=this.pts[this.startIndex[n]].x,e=this.pts[this.startIndex[n+1]].x;return t>e?t:e};tr.prototype.getMinX=function(n){var t=this.pts[this.startIndex[n]].x,e=this.pts[this.startIndex[n+1]].x;return t<e?t:e};tr.prototype.computeIntersectsForChain=function(){if(arguments.length===4){var n=arguments[0],t=arguments[1],e=arguments[2],r=arguments[3];this.computeIntersectsForChain(this.startIndex[n],this.startIndex[n+1],t,t.startIndex[e],t.startIndex[e+1],r)}else if(arguments.length===6){var o=arguments[0],s=arguments[1],l=arguments[2],a=arguments[3],h=arguments[4],y=arguments[5],C=this.pts[o],L=this.pts[s],Y=l.pts[a],ze=l.pts[h];if(s-o===1&&h-a===1)return y.addIntersections(this.e,o,l.e,a),null;if(this.env1.init(C,L),this.env2.init(Y,ze),!this.env1.intersects(this.env2))return null;var Bt=Math.trunc((o+s)/2),Ir=Math.trunc((a+h)/2);o<Bt&&(a<Ir&&this.computeIntersectsForChain(o,Bt,l,a,Ir,y),Ir<h&&this.computeIntersectsForChain(o,Bt,l,Ir,h,y)),Bt<s&&(a<Ir&&this.computeIntersectsForChain(Bt,s,l,a,Ir,y),Ir<h&&this.computeIntersectsForChain(Bt,s,l,Ir,h,y))}};tr.prototype.getStartIndexes=function(){return this.startIndex};tr.prototype.computeIntersects=function(n,t){for(var e=this,r=0;r<this.startIndex.length-1;r++)for(var o=0;o<n.startIndex.length-1;o++)e.computeIntersectsForChain(r,n,o,t)};tr.prototype.interfaces_=function(){return[]};tr.prototype.getClass=function(){return tr};var Ut=function n(){var t=this;this._depth=Array(2).fill().map(function(){return Array(3)});for(var e=0;e<2;e++)for(var r=0;r<3;r++)t._depth[e][r]=n.NULL_VALUE},Ou={NULL_VALUE:{configurable:!0}};Ut.prototype.getDepth=function(n,t){return this._depth[n][t]};Ut.prototype.setDepth=function(n,t,e){this._depth[n][t]=e};Ut.prototype.isNull=function(){var n=this;if(arguments.length===0){for(var t=0;t<2;t++)for(var e=0;e<3;e++)if(n._depth[t][e]!==Ut.NULL_VALUE)return!1;return!0}else if(arguments.length===1){var r=arguments[0];return this._depth[r][1]===Ut.NULL_VALUE}else if(arguments.length===2){var o=arguments[0],s=arguments[1];return this._depth[o][s]===Ut.NULL_VALUE}};Ut.prototype.normalize=function(){for(var n=this,t=0;t<2;t++)if(!n.isNull(t)){var e=n._depth[t][1];n._depth[t][2]<e&&(e=n._depth[t][2]),e<0&&(e=0);for(var r=1;r<3;r++){var o=0;n._depth[t][r]>e&&(o=1),n._depth[t][r]=o}}};Ut.prototype.getDelta=function(n){return this._depth[n][b.RIGHT]-this._depth[n][b.LEFT]};Ut.prototype.getLocation=function(n,t){return this._depth[n][t]<=0?E.EXTERIOR:E.INTERIOR};Ut.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]};Ut.prototype.add=function(){var n=this;if(arguments.length===1)for(var t=arguments[0],e=0;e<2;e++)for(var r=1;r<3;r++){var o=t.getLocation(e,r);(o===E.EXTERIOR||o===E.INTERIOR)&&(n.isNull(e,r)?n._depth[e][r]=Ut.depthAtLocation(o):n._depth[e][r]+=Ut.depthAtLocation(o))}else if(arguments.length===3){var s=arguments[0],l=arguments[1],a=arguments[2];a===E.INTERIOR&&this._depth[s][l]++}};Ut.prototype.interfaces_=function(){return[]};Ut.prototype.getClass=function(){return Ut};Ut.depthAtLocation=function(n){return n===E.EXTERIOR?0:n===E.INTERIOR?1:Ut.NULL_VALUE};Ou.NULL_VALUE.get=function(){return-1};Object.defineProperties(Ut,Ou);var Xo=function(n){function t(){if(n.call(this),this.pts=null,this._env=null,this.eiList=new On(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Ut,this._depthDelta=0,arguments.length===1){var e=arguments[0];t.call(this,e,null)}else if(arguments.length===2){var r=arguments[0],o=arguments[1];this.pts=r,this._label=o}}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.getDepth=function(){return this._depth},t.prototype.getCollapsedEdge=function(){var e=new Array(2).fill(null);e[0]=this.pts[0],e[1]=this.pts[1];var r=new t(e,et.toLineLabel(this._label));return r},t.prototype.isIsolated=function(){return this._isIsolated},t.prototype.getCoordinates=function(){return this.pts},t.prototype.setIsolated=function(e){this._isIsolated=e},t.prototype.setName=function(e){this._name=e},t.prototype.equals=function(e){var r=this;if(!(e instanceof t))return!1;var o=e;if(this.pts.length!==o.pts.length)return!1;for(var s=!0,l=!0,a=this.pts.length,h=0;h<this.pts.length;h++)if(r.pts[h].equals2D(o.pts[h])||(s=!1),r.pts[h].equals2D(o.pts[--a])||(l=!1),!s&&!l)return!1;return!0},t.prototype.getCoordinate=function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var e=arguments[0];return this.pts[e]}},t.prototype.print=function(e){var r=this;e.print("edge "+this._name+": "),e.print("LINESTRING (");for(var o=0;o<this.pts.length;o++)o>0&&e.print(","),e.print(r.pts[o].x+" "+r.pts[o].y);e.print(")  "+this._label+" "+this._depthDelta)},t.prototype.computeIM=function(e){t.updateIM(this._label,e)},t.prototype.isCollapsed=function(){return!this._label.isArea()||this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2])},t.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},t.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},t.prototype.getDepthDelta=function(){return this._depthDelta},t.prototype.getNumPoints=function(){return this.pts.length},t.prototype.printReverse=function(e){var r=this;e.print("edge "+this._name+": ");for(var o=this.pts.length-1;o>=0;o--)e.print(r.pts[o]+" ");e.println("")},t.prototype.getMonotoneChainEdge=function(){return this._mce===null&&(this._mce=new tr(this)),this._mce},t.prototype.getEnvelope=function(){var e=this;if(this._env===null){this._env=new B;for(var r=0;r<this.pts.length;r++)e._env.expandToInclude(e.pts[r])}return this._env},t.prototype.addIntersection=function(e,r,o,s){var l=new d(e.getIntersection(s)),a=r,h=e.getEdgeDistance(o,s),y=a+1;if(y<this.pts.length){var C=this.pts[y];l.equals2D(C)&&(a=y,h=0)}this.eiList.add(l,a,h)},t.prototype.toString=function(){var e=this,r=new _n;r.append("edge "+this._name+": "),r.append("LINESTRING (");for(var o=0;o<this.pts.length;o++)o>0&&r.append(","),r.append(e.pts[o].x+" "+e.pts[o].y);return r.append(")  "+this._label+" "+this._depthDelta),r.toString()},t.prototype.isPointwiseEqual=function(e){var r=this;if(this.pts.length!==e.pts.length)return!1;for(var o=0;o<this.pts.length;o++)if(!r.pts[o].equals2D(e.pts[o]))return!1;return!0},t.prototype.setDepthDelta=function(e){this._depthDelta=e},t.prototype.getEdgeIntersectionList=function(){return this.eiList},t.prototype.addIntersections=function(e,r,o){for(var s=this,l=0;l<e.getIntersectionNum();l++)s.addIntersection(e,r,o,l)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.updateIM=function(){if(arguments.length===2){var e=arguments[0],r=arguments[1];r.setAtLeastIfValid(e.getLocation(0,b.ON),e.getLocation(1,b.ON),1),e.isArea()&&(r.setAtLeastIfValid(e.getLocation(0,b.LEFT),e.getLocation(1,b.LEFT),2),r.setAtLeastIfValid(e.getLocation(0,b.RIGHT),e.getLocation(1,b.RIGHT),2))}else return n.prototype.updateIM.apply(this,arguments)},t}(Le),re=function(n){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new je,this._bufParams=n||null};re.prototype.setWorkingPrecisionModel=function(n){this._workingPrecisionModel=n};re.prototype.insertUniqueEdge=function(n){var t=this._edgeList.findEqualEdge(n);if(t!==null){var e=t.getLabel(),r=n.getLabel();t.isPointwiseEqual(n)||(r=new et(n.getLabel()),r.flip()),e.merge(r);var o=re.depthDelta(r),s=t.getDepthDelta(),l=s+o;t.setDepthDelta(l)}else this._edgeList.add(n),n.setDepthDelta(re.depthDelta(n.getLabel()))};re.prototype.buildSubgraphs=function(n,t){for(var e=new O,r=n.iterator();r.hasNext();){var o=r.next(),s=o.getRightmostCoordinate(),l=new ti(e),a=l.getDepth(s);o.computeDepth(a),o.findResultEdges(),e.add(o),t.add(o.getDirectedEdges(),o.getNodes())}};re.prototype.createSubgraphs=function(n){for(var t=new O,e=n.getNodes().iterator();e.hasNext();){var r=e.next();if(!r.isVisited()){var o=new oe;o.create(r),t.add(o)}}return He.sort(t,He.reverseOrder()),t};re.prototype.createEmptyResultGeometry=function(){var n=this._geomFact.createPolygon();return n};re.prototype.getNoder=function(n){if(this._workingNoder!==null)return this._workingNoder;var t=new Qs,e=new Xr;return e.setPrecisionModel(n),t.setSegmentIntersector(new Pe(e)),t};re.prototype.buffer=function(n,t){var e=this._workingPrecisionModel;e===null&&(e=n.getPrecisionModel()),this._geomFact=n.getFactory();var r=new fe(e,this._bufParams),o=new Be(n,t,r),s=o.getCurves();if(s.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(s,e),this._graph=new pt(new Ru),this._graph.addEdges(this._edgeList.getEdges());var l=this.createSubgraphs(this._graph),a=new ve(this._geomFact);this.buildSubgraphs(l,a);var h=a.getPolygons();if(h.size()<=0)return this.createEmptyResultGeometry();var y=this._geomFact.buildGeometry(h);return y};re.prototype.computeNodedEdges=function(n,t){var e=this,r=this.getNoder(t);r.computeNodes(n);for(var o=r.getNodedSubstrings(),s=o.iterator();s.hasNext();){var l=s.next(),a=l.getCoordinates();if(!(a.length===2&&a[0].equals2D(a[1]))){var h=l.getData(),y=new Xo(l.getCoordinates(),new et(h));e.insertUniqueEdge(y)}}};re.prototype.setNoder=function(n){this._workingNoder=n};re.prototype.interfaces_=function(){return[]};re.prototype.getClass=function(){return re};re.depthDelta=function(n){var t=n.getLocation(0,b.LEFT),e=n.getLocation(0,b.RIGHT);return t===E.INTERIOR&&e===E.EXTERIOR?1:t===E.EXTERIOR&&e===E.INTERIOR?-1:0};re.convertSegStrings=function(n){for(var t=new H,e=new O;n.hasNext();){var r=n.next(),o=t.createLineString(r.getCoordinates());e.add(o)}return t.buildGeometry(e)};var dr=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var n=arguments[0],t=arguments[1];this._noder=n,this._scaleFactor=t,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(arguments.length===4){var e=arguments[0],r=arguments[1],o=arguments[2],s=arguments[3];this._noder=e,this._scaleFactor=r,this._offsetX=o,this._offsetY=s,this._isScaled=!this.isIntegerPrecision()}};dr.prototype.rescale=function(){var n=this;if(V(arguments[0],Lt))for(var t=arguments[0],e=t.iterator();e.hasNext();){var r=e.next();n.rescale(r.getCoordinates())}else if(arguments[0]instanceof Array){for(var o=arguments[0],s=0;s<o.length;s++)o[s].x=o[s].x/n._scaleFactor+n._offsetX,o[s].y=o[s].y/n._scaleFactor+n._offsetY;o.length===2&&o[0].equals2D(o[1])&&qt.out.println(o)}};dr.prototype.scale=function(){var n=this;if(V(arguments[0],Lt)){for(var t=arguments[0],e=new O,r=t.iterator();r.hasNext();){var o=r.next();e.add(new Nt(n.scale(o.getCoordinates()),o.getData()))}return e}else if(arguments[0]instanceof Array){for(var s=arguments[0],l=new Array(s.length).fill(null),a=0;a<s.length;a++)l[a]=new d(Math.round((s[a].x-n._offsetX)*n._scaleFactor),Math.round((s[a].y-n._offsetY)*n._scaleFactor),s[a].z);var h=j.removeRepeatedPoints(l);return h}};dr.prototype.isIntegerPrecision=function(){return this._scaleFactor===1};dr.prototype.getNodedSubstrings=function(){var n=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(n),n};dr.prototype.computeNodes=function(n){var t=n;this._isScaled&&(t=this.scale(n)),this._noder.computeNodes(t)};dr.prototype.interfaces_=function(){return[Dr]};dr.prototype.getClass=function(){return dr};var dn=function(){this._li=new Xr,this._segStrings=null;var n=arguments[0];this._segStrings=n},Tu={fact:{configurable:!0}};dn.prototype.checkEndPtVertexIntersections=function(){var n=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();){var e=t.next(),r=e.getCoordinates();n.checkEndPtVertexIntersections(r[0],n._segStrings),n.checkEndPtVertexIntersections(r[r.length-1],n._segStrings)}else if(arguments.length===2){for(var o=arguments[0],s=arguments[1],l=s.iterator();l.hasNext();)for(var a=l.next(),h=a.getCoordinates(),y=1;y<h.length-1;y++)if(h[y].equals(o))throw new Qn("found endpt/interior pt intersection at index "+y+" :pt "+o)}};dn.prototype.checkInteriorIntersections=function(){var n=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();)for(var e=t.next(),r=this._segStrings.iterator();r.hasNext();){var o=r.next();n.checkInteriorIntersections(e,o)}else if(arguments.length===2)for(var s=arguments[0],l=arguments[1],a=s.getCoordinates(),h=l.getCoordinates(),y=0;y<a.length-1;y++)for(var C=0;C<h.length-1;C++)n.checkInteriorIntersections(s,y,l,C);else if(arguments.length===4){var L=arguments[0],Y=arguments[1],ze=arguments[2],Bt=arguments[3];if(L===ze&&Y===Bt)return null;var Ir=L.getCoordinates()[Y],Wr=L.getCoordinates()[Y+1],yi=ze.getCoordinates()[Bt],Bn=ze.getCoordinates()[Bt+1];if(this._li.computeIntersection(Ir,Wr,yi,Bn),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,Ir,Wr)||this.hasInteriorIntersection(this._li,yi,Bn)))throw new Qn("found non-noded intersection at "+Ir+"-"+Wr+" and "+yi+"-"+Bn)}};dn.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()};dn.prototype.checkCollapses=function(){var n=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();){var e=t.next();n.checkCollapses(e)}else if(arguments.length===1)for(var r=arguments[0],o=r.getCoordinates(),s=0;s<o.length-2;s++)n.checkCollapse(o[s],o[s+1],o[s+2])};dn.prototype.hasInteriorIntersection=function(n,t,e){for(var r=0;r<n.getIntersectionNum();r++){var o=n.getIntersection(r);if(!(o.equals(t)||o.equals(e)))return!0}return!1};dn.prototype.checkCollapse=function(n,t,e){if(n.equals(e))throw new Qn("found non-noded collapse at "+dn.fact.createLineString([n,t,e]))};dn.prototype.interfaces_=function(){return[]};dn.prototype.getClass=function(){return dn};Tu.fact.get=function(){return new H};Object.defineProperties(dn,Tu);var he=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var n=arguments[0],t=arguments[1],e=arguments[2];if(this._originalPt=n,this._pt=n,this._scaleFactor=t,this._li=e,t<=0)throw new ft("Scale factor must be non-zero");t!==1&&(this._pt=new d(this.scale(n.x),this.scale(n.y)),this._p0Scaled=new d,this._p1Scaled=new d),this.initCorners(this._pt)},Du={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};he.prototype.intersectsScaled=function(n,t){var e=Math.min(n.x,t.x),r=Math.max(n.x,t.x),o=Math.min(n.y,t.y),s=Math.max(n.y,t.y),l=this._maxx<e||this._minx>r||this._maxy<o||this._miny>s;if(l)return!1;var a=this.intersectsToleranceSquare(n,t);return q.isTrue(!(l&&a),"Found bad envelope test"),a};he.prototype.initCorners=function(n){var t=.5;this._minx=n.x-t,this._maxx=n.x+t,this._miny=n.y-t,this._maxy=n.y+t,this._corner[0]=new d(this._maxx,this._maxy),this._corner[1]=new d(this._minx,this._maxy),this._corner[2]=new d(this._minx,this._miny),this._corner[3]=new d(this._maxx,this._miny)};he.prototype.intersects=function(n,t){return this._scaleFactor===1?this.intersectsScaled(n,t):(this.copyScaled(n,this._p0Scaled),this.copyScaled(t,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))};he.prototype.scale=function(n){return Math.round(n*this._scaleFactor)};he.prototype.getCoordinate=function(){return this._originalPt};he.prototype.copyScaled=function(n,t){t.x=this.scale(n.x),t.y=this.scale(n.y)};he.prototype.getSafeEnvelope=function(){if(this._safeEnv===null){var n=he.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new B(this._originalPt.x-n,this._originalPt.x+n,this._originalPt.y-n,this._originalPt.y+n)}return this._safeEnv};he.prototype.intersectsPixelClosure=function(n,t){return this._li.computeIntersection(n,t,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(n,t,this._corner[1],this._corner[2]),this._li.hasIntersection())||(this._li.computeIntersection(n,t,this._corner[2],this._corner[3]),this._li.hasIntersection())||(this._li.computeIntersection(n,t,this._corner[3],this._corner[0]),this._li.hasIntersection()))};he.prototype.intersectsToleranceSquare=function(n,t){var e=!1,r=!1;return this._li.computeIntersection(n,t,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(n,t,this._corner[1],this._corner[2]),this._li.isProper())||(this._li.hasIntersection()&&(e=!0),this._li.computeIntersection(n,t,this._corner[2],this._corner[3]),this._li.isProper())||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(n,t,this._corner[3],this._corner[0]),this._li.isProper())||e&&r||n.equals(this._pt)||t.equals(this._pt))};he.prototype.addSnappedNode=function(n,t){var e=n.getCoordinate(t),r=n.getCoordinate(t+1);return this.intersects(e,r)?(n.addIntersection(this.getCoordinate(),t),!0):!1};he.prototype.interfaces_=function(){return[]};he.prototype.getClass=function(){return he};Du.SAFE_ENV_EXPANSION_FACTOR.get=function(){return .75};Object.defineProperties(he,Du);var go=function(){this.tempEnv1=new B,this.selectedSegment=new k};go.prototype.select=function(){if(arguments.length!==1&&arguments.length===2){var n=arguments[0],t=arguments[1];n.getLineSegment(t,this.selectedSegment),this.select(this.selectedSegment)}};go.prototype.interfaces_=function(){return[]};go.prototype.getClass=function(){return go};var Mi=function(){this._index=null;var n=arguments[0];this._index=n},Mu={HotPixelSnapAction:{configurable:!0}};Mi.prototype.snap=function(){if(arguments.length===1){var n=arguments[0];return this.snap(n,null,-1)}else if(arguments.length===3){var t=arguments[0],e=arguments[1],r=arguments[2],o=t.getSafeEnvelope(),s=new Au(t,e,r);return this._index.query(o,{interfaces_:function(){return[hr]},visitItem:function(l){var a=l;a.select(o,s)}}),s.isNodeAdded()}};Mi.prototype.interfaces_=function(){return[]};Mi.prototype.getClass=function(){return Mi};Mu.HotPixelSnapAction.get=function(){return Au};Object.defineProperties(Mi,Mu);var Au=function(n){function t(){n.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var e=arguments[0],r=arguments[1],o=arguments[2];this._hotPixel=e,this._parentEdge=r,this._hotPixelVertexIndex=o}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.isNodeAdded=function(){return this._isNodeAdded},t.prototype.select=function(){if(arguments.length===2){var e=arguments[0],r=arguments[1],o=e.getContext();if(this._parentEdge!==null&&o===this._parentEdge&&r===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(o,r)}else return n.prototype.select.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(go),ei=function(){this._li=null,this._interiorIntersections=null;var n=arguments[0];this._li=n,this._interiorIntersections=new O};ei.prototype.processIntersections=function(n,t,e,r){var o=this;if(n===e&&t===r)return null;var s=n.getCoordinates()[t],l=n.getCoordinates()[t+1],a=e.getCoordinates()[r],h=e.getCoordinates()[r+1];if(this._li.computeIntersection(s,l,a,h),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var y=0;y<this._li.getIntersectionNum();y++)o._interiorIntersections.add(o._li.getIntersection(y));n.addIntersections(this._li,t,0),e.addIntersections(this._li,r,1)}};ei.prototype.isDone=function(){return!1};ei.prototype.getInteriorIntersections=function(){return this._interiorIntersections};ei.prototype.interfaces_=function(){return[Ar]};ei.prototype.getClass=function(){return ei};var Tn=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var n=arguments[0];this._pm=n,this._li=new Xr,this._li.setPrecisionModel(n),this._scaleFactor=n.getScale()};Tn.prototype.checkCorrectness=function(n){var t=Nt.getNodedSubstrings(n),e=new dn(t);try{e.checkValid()}catch(r){if(r instanceof mu)r.printStackTrace();else throw r}finally{}};Tn.prototype.getNodedSubstrings=function(){return Nt.getNodedSubstrings(this._nodedSegStrings)};Tn.prototype.snapRound=function(n,t){var e=this.findInteriorIntersections(n,t);this.computeIntersectionSnaps(e),this.computeVertexSnaps(n)};Tn.prototype.findInteriorIntersections=function(n,t){var e=new ei(t);return this._noder.setSegmentIntersector(e),this._noder.computeNodes(n),e.getInteriorIntersections()};Tn.prototype.computeVertexSnaps=function(){var n=this;if(V(arguments[0],Lt))for(var t=arguments[0],e=t.iterator();e.hasNext();){var r=e.next();n.computeVertexSnaps(r)}else if(arguments[0]instanceof Nt)for(var o=arguments[0],s=o.getCoordinates(),l=0;l<s.length;l++){var a=new he(s[l],n._scaleFactor,n._li),h=n._pointSnapper.snap(a,o,l);h&&o.addIntersection(s[l],l)}};Tn.prototype.computeNodes=function(n){this._nodedSegStrings=n,this._noder=new Qs,this._pointSnapper=new Mi(this._noder.getIndex()),this.snapRound(n,this._li)};Tn.prototype.computeIntersectionSnaps=function(n){for(var t=this,e=n.iterator();e.hasNext();){var r=e.next(),o=new he(r,t._scaleFactor,t._li);t._pointSnapper.snap(o)}};Tn.prototype.interfaces_=function(){return[Dr]};Tn.prototype.getClass=function(){return Tn};var zt=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new J,this._resultGeometry=null,this._saveException=null,arguments.length===1){var n=arguments[0];this._argGeom=n}else if(arguments.length===2){var t=arguments[0],e=arguments[1];this._argGeom=t,this._bufParams=e}},Wi={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};zt.prototype.bufferFixedPrecision=function(n){var t=new dr(new Tn(new $(1)),n.getScale()),e=new re(this._bufParams);e.setWorkingPrecisionModel(n),e.setNoder(t),this._resultGeometry=e.buffer(this._argGeom,this._distance)};zt.prototype.bufferReducedPrecision=function(){var n=this;if(arguments.length===0){for(var t=zt.MAX_PRECISION_DIGITS;t>=0;t--){try{n.bufferReducedPrecision(t)}catch(s){if(s instanceof Jn)n._saveException=s;else throw s}finally{}if(n._resultGeometry!==null)return null}throw this._saveException}else if(arguments.length===1){var e=arguments[0],r=zt.precisionScaleFactor(this._argGeom,this._distance,e),o=new $(r);this.bufferFixedPrecision(o)}};zt.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var n=this._argGeom.getFactory().getPrecisionModel();n.getType()===$.FIXED?this.bufferFixedPrecision(n):this.bufferReducedPrecision()};zt.prototype.setQuadrantSegments=function(n){this._bufParams.setQuadrantSegments(n)};zt.prototype.bufferOriginalPrecision=function(){try{var n=new re(this._bufParams);this._resultGeometry=n.buffer(this._argGeom,this._distance)}catch(t){if(t instanceof Qn)this._saveException=t;else throw t}finally{}};zt.prototype.getResultGeometry=function(n){return this._distance=n,this.computeGeometry(),this._resultGeometry};zt.prototype.setEndCapStyle=function(n){this._bufParams.setEndCapStyle(n)};zt.prototype.interfaces_=function(){return[]};zt.prototype.getClass=function(){return zt};zt.bufferOp=function(){if(arguments.length===2){var n=arguments[0],t=arguments[1],e=new zt(n),r=e.getResultGeometry(t);return r}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof G&&typeof arguments[1]=="number"){var o=arguments[0],s=arguments[1],l=arguments[2],a=new zt(o);a.setQuadrantSegments(l);var h=a.getResultGeometry(s);return h}else if(arguments[2]instanceof J&&arguments[0]instanceof G&&typeof arguments[1]=="number"){var y=arguments[0],C=arguments[1],L=arguments[2],Y=new zt(y,L),ze=Y.getResultGeometry(C);return ze}}else if(arguments.length===4){var Bt=arguments[0],Ir=arguments[1],Wr=arguments[2],yi=arguments[3],Bn=new zt(Bt);Bn.setQuadrantSegments(Wr),Bn.setEndCapStyle(yi);var vi=Bn.getResultGeometry(Ir);return vi}};zt.precisionScaleFactor=function(n,t,e){var r=n.getEnvelopeInternal(),o=we.max(Math.abs(r.getMaxX()),Math.abs(r.getMaxY()),Math.abs(r.getMinX()),Math.abs(r.getMinY())),s=t>0?t:0,l=o+2*s,a=Math.trunc(Math.log(l)/Math.log(10)+1),h=e-a,y=Math.pow(10,h);return y};Wi.CAP_ROUND.get=function(){return J.CAP_ROUND};Wi.CAP_BUTT.get=function(){return J.CAP_FLAT};Wi.CAP_FLAT.get=function(){return J.CAP_FLAT};Wi.CAP_SQUARE.get=function(){return J.CAP_SQUARE};Wi.MAX_PRECISION_DIGITS.get=function(){return 12};Object.defineProperties(zt,Wi);var te=function(){this._pt=[new d,new d],this._distance=z.NaN,this._isNull=!0};te.prototype.getCoordinates=function(){return this._pt};te.prototype.getCoordinate=function(n){return this._pt[n]};te.prototype.setMinimum=function(){if(arguments.length===1){var n=arguments[0];this.setMinimum(n._pt[0],n._pt[1])}else if(arguments.length===2){var t=arguments[0],e=arguments[1];if(this._isNull)return this.initialize(t,e),null;var r=t.distance(e);r<this._distance&&this.initialize(t,e,r)}};te.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var n=arguments[0],t=arguments[1];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(t),this._distance=n.distance(t),this._isNull=!1}else if(arguments.length===3){var e=arguments[0],r=arguments[1],o=arguments[2];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(r),this._distance=o,this._isNull=!1}};te.prototype.getDistance=function(){return this._distance};te.prototype.setMaximum=function(){if(arguments.length===1){var n=arguments[0];this.setMaximum(n._pt[0],n._pt[1])}else if(arguments.length===2){var t=arguments[0],e=arguments[1];if(this._isNull)return this.initialize(t,e),null;var r=t.distance(e);r>this._distance&&this.initialize(t,e,r)}};te.prototype.interfaces_=function(){return[]};te.prototype.getClass=function(){return te};var Nn=function(){};Nn.prototype.interfaces_=function(){return[]};Nn.prototype.getClass=function(){return Nn};Nn.computeDistance=function(){if(arguments[2]instanceof te&&arguments[0]instanceof yt&&arguments[1]instanceof d)for(var n=arguments[0],t=arguments[1],e=arguments[2],r=n.getCoordinates(),o=new k,s=0;s<r.length-1;s++){o.setCoordinates(r[s],r[s+1]);var l=o.closestPoint(t);e.setMinimum(l,t)}else if(arguments[2]instanceof te&&arguments[0]instanceof Ot&&arguments[1]instanceof d){var a=arguments[0],h=arguments[1],y=arguments[2];Nn.computeDistance(a.getExteriorRing(),h,y);for(var C=0;C<a.getNumInteriorRing();C++)Nn.computeDistance(a.getInteriorRingN(C),h,y)}else if(arguments[2]instanceof te&&arguments[0]instanceof G&&arguments[1]instanceof d){var L=arguments[0],Y=arguments[1],ze=arguments[2];if(L instanceof yt)Nn.computeDistance(L,Y,ze);else if(L instanceof Ot)Nn.computeDistance(L,Y,ze);else if(L instanceof ie)for(var Bt=L,Ir=0;Ir<Bt.getNumGeometries();Ir++){var Wr=Bt.getGeometryN(Ir);Nn.computeDistance(Wr,Y,ze)}else ze.setMinimum(L.getCoordinate(),Y)}else if(arguments[2]instanceof te&&arguments[0]instanceof k&&arguments[1]instanceof d){var yi=arguments[0],Bn=arguments[1],vi=arguments[2],wo=yi.closestPoint(Bn);vi.setMinimum(wo,Bn)}};var Br=function(n){this._maxPtDist=new te,this._inputGeom=n||null},Zs={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};Br.prototype.computeMaxMidpointDistance=function(n){var t=new vr(this._inputGeom);n.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())};Br.prototype.computeMaxVertexDistance=function(n){var t=new ni(this._inputGeom);n.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())};Br.prototype.findDistance=function(n){return this.computeMaxVertexDistance(n),this.computeMaxMidpointDistance(n),this._maxPtDist.getDistance()};Br.prototype.getDistancePoints=function(){return this._maxPtDist};Br.prototype.interfaces_=function(){return[]};Br.prototype.getClass=function(){return Br};Zs.MaxPointDistanceFilter.get=function(){return ni};Zs.MaxMidpointDistanceFilter.get=function(){return vr};Object.defineProperties(Br,Zs);var ni=function(n){this._maxPtDist=new te,this._minPtDist=new te,this._geom=n||null};ni.prototype.filter=function(n){this._minPtDist.initialize(),Nn.computeDistance(this._geom,n,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};ni.prototype.getMaxPointDistance=function(){return this._maxPtDist};ni.prototype.interfaces_=function(){return[Ln]};ni.prototype.getClass=function(){return ni};var vr=function(n){this._maxPtDist=new te,this._minPtDist=new te,this._geom=n||null};vr.prototype.filter=function(n,t){if(t===0)return null;var e=n.getCoordinate(t-1),r=n.getCoordinate(t),o=new d((e.x+r.x)/2,(e.y+r.y)/2);this._minPtDist.initialize(),Nn.computeDistance(this._geom,o,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};vr.prototype.isDone=function(){return!1};vr.prototype.isGeometryChanged=function(){return!1};vr.prototype.getMaxPointDistance=function(){return this._maxPtDist};vr.prototype.interfaces_=function(){return[Ye]};vr.prototype.getClass=function(){return vr};var jn=function(n){this._comps=n||null};jn.prototype.filter=function(n){n instanceof Ot&&this._comps.add(n)};jn.prototype.interfaces_=function(){return[cn]};jn.prototype.getClass=function(){return jn};jn.getPolygons=function(){if(arguments.length===1){var n=arguments[0];return jn.getPolygons(n,new O)}else if(arguments.length===2){var t=arguments[0],e=arguments[1];return t instanceof Ot?e.add(t):t instanceof ie&&t.apply(new jn(e)),e}};var Vt=function(){if(this._lines=null,this._isForcedToLineString=!1,arguments.length===1){var n=arguments[0];this._lines=n}else if(arguments.length===2){var t=arguments[0],e=arguments[1];this._lines=t,this._isForcedToLineString=e}};Vt.prototype.filter=function(n){if(this._isForcedToLineString&&n instanceof bn){var t=n.getFactory().createLineString(n.getCoordinateSequence());return this._lines.add(t),null}n instanceof yt&&this._lines.add(n)};Vt.prototype.setForceToLineString=function(n){this._isForcedToLineString=n};Vt.prototype.interfaces_=function(){return[Zn]};Vt.prototype.getClass=function(){return Vt};Vt.getGeometry=function(){if(arguments.length===1){var n=arguments[0];return n.getFactory().buildGeometry(Vt.getLines(n))}else if(arguments.length===2){var t=arguments[0],e=arguments[1];return t.getFactory().buildGeometry(Vt.getLines(t,e))}};Vt.getLines=function(){if(arguments.length===1){var n=arguments[0];return Vt.getLines(n,!1)}else if(arguments.length===2){if(V(arguments[0],Lt)&&V(arguments[1],Lt)){for(var t=arguments[0],e=arguments[1],r=t.iterator();r.hasNext();){var o=r.next();Vt.getLines(o,e)}return e}else if(arguments[0]instanceof G&&typeof arguments[1]=="boolean"){var s=arguments[0],l=arguments[1],a=new O;return s.apply(new Vt(a,l)),a}else if(arguments[0]instanceof G&&V(arguments[1],Lt)){var h=arguments[0],y=arguments[1];return h instanceof yt?y.add(h):h.apply(new Vt(y)),y}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&V(arguments[0],Lt)&&V(arguments[1],Lt)){for(var C=arguments[0],L=arguments[1],Y=arguments[2],ze=C.iterator();ze.hasNext();){var Bt=ze.next();Vt.getLines(Bt,L,Y)}return L}else if(typeof arguments[2]=="boolean"&&arguments[0]instanceof G&&V(arguments[1],Lt)){var Ir=arguments[0],Wr=arguments[1],yi=arguments[2];return Ir.apply(new Vt(Wr,yi)),Wr}}};var Ke=function(){if(this._boundaryRule=Ae.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,arguments.length!==0&&arguments.length===1){var n=arguments[0];if(n===null)throw new ft("Rule must be non-null");this._boundaryRule=n}};Ke.prototype.locateInternal=function(){var n=this;if(arguments[0]instanceof d&&arguments[1]instanceof Ot){var t=arguments[0],e=arguments[1];if(e.isEmpty())return E.EXTERIOR;var r=e.getExteriorRing(),o=this.locateInPolygonRing(t,r);if(o===E.EXTERIOR)return E.EXTERIOR;if(o===E.BOUNDARY)return E.BOUNDARY;for(var s=0;s<e.getNumInteriorRing();s++){var l=e.getInteriorRingN(s),a=n.locateInPolygonRing(t,l);if(a===E.INTERIOR)return E.EXTERIOR;if(a===E.BOUNDARY)return E.BOUNDARY}return E.INTERIOR}else if(arguments[0]instanceof d&&arguments[1]instanceof yt){var h=arguments[0],y=arguments[1];if(!y.getEnvelopeInternal().intersects(h))return E.EXTERIOR;var C=y.getCoordinates();return!y.isClosed()&&(h.equals(C[0])||h.equals(C[C.length-1]))?E.BOUNDARY:M.isOnLine(h,C)?E.INTERIOR:E.EXTERIOR}else if(arguments[0]instanceof d&&arguments[1]instanceof de){var L=arguments[0],Y=arguments[1],ze=Y.getCoordinate();return ze.equals2D(L)?E.INTERIOR:E.EXTERIOR}};Ke.prototype.locateInPolygonRing=function(n,t){return t.getEnvelopeInternal().intersects(n)?M.locatePointInRing(n,t.getCoordinates()):E.EXTERIOR};Ke.prototype.intersects=function(n,t){return this.locate(n,t)!==E.EXTERIOR};Ke.prototype.updateLocationInfo=function(n){n===E.INTERIOR&&(this._isIn=!0),n===E.BOUNDARY&&this._numBoundaries++};Ke.prototype.computeLocation=function(n,t){var e=this;if(t instanceof de&&this.updateLocationInfo(this.locateInternal(n,t)),t instanceof yt)this.updateLocationInfo(this.locateInternal(n,t));else if(t instanceof Ot)this.updateLocationInfo(this.locateInternal(n,t));else if(t instanceof Tr)for(var r=t,o=0;o<r.getNumGeometries();o++){var s=r.getGeometryN(o);e.updateLocationInfo(e.locateInternal(n,s))}else if(t instanceof Sn)for(var l=t,a=0;a<l.getNumGeometries();a++){var h=l.getGeometryN(a);e.updateLocationInfo(e.locateInternal(n,h))}else if(t instanceof ie)for(var y=new wn(t);y.hasNext();){var C=y.next();C!==t&&e.computeLocation(n,C)}};Ke.prototype.locate=function(n,t){return t.isEmpty()?E.EXTERIOR:t instanceof yt?this.locateInternal(n,t):t instanceof Ot?this.locateInternal(n,t):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(n,t),this._boundaryRule.isInBoundary(this._numBoundaries)?E.BOUNDARY:this._numBoundaries>0||this._isIn?E.INTERIOR:E.EXTERIOR)};Ke.prototype.interfaces_=function(){return[]};Ke.prototype.getClass=function(){return Ke};var ee=function n(){if(this._component=null,this._segIndex=null,this._pt=null,arguments.length===2){var t=arguments[0],e=arguments[1];n.call(this,t,n.INSIDE_AREA,e)}else if(arguments.length===3){var r=arguments[0],o=arguments[1],s=arguments[2];this._component=r,this._segIndex=o,this._pt=s}},Fu={INSIDE_AREA:{configurable:!0}};ee.prototype.isInsideArea=function(){return this._segIndex===ee.INSIDE_AREA};ee.prototype.getCoordinate=function(){return this._pt};ee.prototype.getGeometryComponent=function(){return this._component};ee.prototype.getSegmentIndex=function(){return this._segIndex};ee.prototype.interfaces_=function(){return[]};ee.prototype.getClass=function(){return ee};Fu.INSIDE_AREA.get=function(){return-1};Object.defineProperties(ee,Fu);var ar=function(n){this._pts=n||null};ar.prototype.filter=function(n){n instanceof de&&this._pts.add(n)};ar.prototype.interfaces_=function(){return[cn]};ar.prototype.getClass=function(){return ar};ar.getPoints=function(){if(arguments.length===1){var n=arguments[0];return n instanceof de?He.singletonList(n):ar.getPoints(n,new O)}else if(arguments.length===2){var t=arguments[0],e=arguments[1];return t instanceof de?e.add(t):t instanceof ie&&t.apply(new ar(e)),e}};var ri=function(){this._locations=null;var n=arguments[0];this._locations=n};ri.prototype.filter=function(n){(n instanceof de||n instanceof yt||n instanceof Ot)&&this._locations.add(new ee(n,0,n.getCoordinate()))};ri.prototype.interfaces_=function(){return[cn]};ri.prototype.getClass=function(){return ri};ri.getLocations=function(n){var t=new O;return n.apply(new ri(t)),t};var Xt=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Ke,this._minDistanceLocation=null,this._minDistance=z.MAX_VALUE,arguments.length===2){var n=arguments[0],t=arguments[1];this._geom=[n,t],this._terminateDistance=0}else if(arguments.length===3){var e=arguments[0],r=arguments[1],o=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=e,this._geom[1]=r,this._terminateDistance=o}};Xt.prototype.computeContainmentDistance=function(){var n=this;if(arguments.length===0){var t=new Array(2).fill(null);if(this.computeContainmentDistance(0,t),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,t)}else if(arguments.length===2){var e=arguments[0],r=arguments[1],o=1-e,s=jn.getPolygons(this._geom[e]);if(s.size()>0){var l=ri.getLocations(this._geom[o]);if(this.computeContainmentDistance(l,s,r),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[o]=r[0],this._minDistanceLocation[e]=r[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&V(arguments[0],qe)&&V(arguments[1],qe)){for(var a=arguments[0],h=arguments[1],y=arguments[2],C=0;C<a.size();C++)for(var L=a.get(C),Y=0;Y<h.size();Y++)if(n.computeContainmentDistance(L,h.get(Y),y),n._minDistance<=n._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof ee&&arguments[1]instanceof Ot){var ze=arguments[0],Bt=arguments[1],Ir=arguments[2],Wr=ze.getCoordinate();if(E.EXTERIOR!==this._ptLocator.locate(Wr,Bt))return this._minDistance=0,Ir[0]=ze,Ir[1]=new ee(Bt,Wr),null}}};Xt.prototype.computeMinDistanceLinesPoints=function(n,t,e){for(var r=this,o=0;o<n.size();o++)for(var s=n.get(o),l=0;l<t.size();l++){var a=t.get(l);if(r.computeMinDistance(s,a,e),r._minDistance<=r._terminateDistance)return null}};Xt.prototype.computeFacetDistance=function(){var n=new Array(2).fill(null),t=Vt.getLines(this._geom[0]),e=Vt.getLines(this._geom[1]),r=ar.getPoints(this._geom[0]),o=ar.getPoints(this._geom[1]);if(this.computeMinDistanceLines(t,e,n),this.updateMinDistance(n,!1),this._minDistance<=this._terminateDistance||(n[0]=null,n[1]=null,this.computeMinDistanceLinesPoints(t,o,n),this.updateMinDistance(n,!1),this._minDistance<=this._terminateDistance)||(n[0]=null,n[1]=null,this.computeMinDistanceLinesPoints(e,r,n),this.updateMinDistance(n,!0),this._minDistance<=this._terminateDistance))return null;n[0]=null,n[1]=null,this.computeMinDistancePoints(r,o,n),this.updateMinDistance(n,!1)};Xt.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation};Xt.prototype.updateMinDistance=function(n,t){if(n[0]===null)return null;t?(this._minDistanceLocation[0]=n[1],this._minDistanceLocation[1]=n[0]):(this._minDistanceLocation[0]=n[0],this._minDistanceLocation[1]=n[1])};Xt.prototype.nearestPoints=function(){this.computeMinDistance();var n=[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()];return n};Xt.prototype.computeMinDistance=function(){var n=this;if(arguments.length===0){if(this._minDistanceLocation!==null||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof yt&&arguments[1]instanceof de){var t=arguments[0],e=arguments[1],r=arguments[2];if(t.getEnvelopeInternal().distance(e.getEnvelopeInternal())>this._minDistance)return null;for(var o=t.getCoordinates(),s=e.getCoordinate(),l=0;l<o.length-1;l++){var a=M.distancePointLine(s,o[l],o[l+1]);if(a<n._minDistance){n._minDistance=a;var h=new k(o[l],o[l+1]),y=h.closestPoint(s);r[0]=new ee(t,l,y),r[1]=new ee(e,0,s)}if(n._minDistance<=n._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof yt&&arguments[1]instanceof yt){var C=arguments[0],L=arguments[1],Y=arguments[2];if(C.getEnvelopeInternal().distance(L.getEnvelopeInternal())>this._minDistance)return null;for(var ze=C.getCoordinates(),Bt=L.getCoordinates(),Ir=0;Ir<ze.length-1;Ir++)for(var Wr=0;Wr<Bt.length-1;Wr++){var yi=M.distanceLineLine(ze[Ir],ze[Ir+1],Bt[Wr],Bt[Wr+1]);if(yi<n._minDistance){n._minDistance=yi;var Bn=new k(ze[Ir],ze[Ir+1]),vi=new k(Bt[Wr],Bt[Wr+1]),wo=Bn.closestPoints(vi);Y[0]=new ee(C,Ir,wo[0]),Y[1]=new ee(L,Wr,wo[1])}if(n._minDistance<=n._terminateDistance)return null}}}};Xt.prototype.computeMinDistancePoints=function(n,t,e){for(var r=this,o=0;o<n.size();o++)for(var s=n.get(o),l=0;l<t.size();l++){var a=t.get(l),h=s.getCoordinate().distance(a.getCoordinate());if(h<r._minDistance&&(r._minDistance=h,e[0]=new ee(s,0,s.getCoordinate()),e[1]=new ee(a,0,a.getCoordinate())),r._minDistance<=r._terminateDistance)return null}};Xt.prototype.distance=function(){if(this._geom[0]===null||this._geom[1]===null)throw new ft("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)};Xt.prototype.computeMinDistanceLines=function(n,t,e){for(var r=this,o=0;o<n.size();o++)for(var s=n.get(o),l=0;l<t.size();l++){var a=t.get(l);if(r.computeMinDistance(s,a,e),r._minDistance<=r._terminateDistance)return null}};Xt.prototype.interfaces_=function(){return[]};Xt.prototype.getClass=function(){return Xt};Xt.distance=function(n,t){var e=new Xt(n,t);return e.distance()};Xt.isWithinDistance=function(n,t,e){var r=new Xt(n,t,e);return r.distance()<=e};Xt.nearestPoints=function(n,t){var e=new Xt(n,t);return e.nearestPoints()};var jt=function(){this._pt=[new d,new d],this._distance=z.NaN,this._isNull=!0};jt.prototype.getCoordinates=function(){return this._pt};jt.prototype.getCoordinate=function(n){return this._pt[n]};jt.prototype.setMinimum=function(){if(arguments.length===1){var n=arguments[0];this.setMinimum(n._pt[0],n._pt[1])}else if(arguments.length===2){var t=arguments[0],e=arguments[1];if(this._isNull)return this.initialize(t,e),null;var r=t.distance(e);r<this._distance&&this.initialize(t,e,r)}};jt.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var n=arguments[0],t=arguments[1];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(t),this._distance=n.distance(t),this._isNull=!1}else if(arguments.length===3){var e=arguments[0],r=arguments[1],o=arguments[2];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(r),this._distance=o,this._isNull=!1}};jt.prototype.toString=function(){return Xe.toLineString(this._pt[0],this._pt[1])};jt.prototype.getDistance=function(){return this._distance};jt.prototype.setMaximum=function(){if(arguments.length===1){var n=arguments[0];this.setMaximum(n._pt[0],n._pt[1])}else if(arguments.length===2){var t=arguments[0],e=arguments[1];if(this._isNull)return this.initialize(t,e),null;var r=t.distance(e);r>this._distance&&this.initialize(t,e,r)}};jt.prototype.interfaces_=function(){return[]};jt.prototype.getClass=function(){return jt};var rn=function(){};rn.prototype.interfaces_=function(){return[]};rn.prototype.getClass=function(){return rn};rn.computeDistance=function(){if(arguments[2]instanceof jt&&arguments[0]instanceof yt&&arguments[1]instanceof d)for(var n=arguments[0],t=arguments[1],e=arguments[2],r=new k,o=n.getCoordinates(),s=0;s<o.length-1;s++){r.setCoordinates(o[s],o[s+1]);var l=r.closestPoint(t);e.setMinimum(l,t)}else if(arguments[2]instanceof jt&&arguments[0]instanceof Ot&&arguments[1]instanceof d){var a=arguments[0],h=arguments[1],y=arguments[2];rn.computeDistance(a.getExteriorRing(),h,y);for(var C=0;C<a.getNumInteriorRing();C++)rn.computeDistance(a.getInteriorRingN(C),h,y)}else if(arguments[2]instanceof jt&&arguments[0]instanceof G&&arguments[1]instanceof d){var L=arguments[0],Y=arguments[1],ze=arguments[2];if(L instanceof yt)rn.computeDistance(L,Y,ze);else if(L instanceof Ot)rn.computeDistance(L,Y,ze);else if(L instanceof ie)for(var Bt=L,Ir=0;Ir<Bt.getNumGeometries();Ir++){var Wr=Bt.getGeometryN(Ir);rn.computeDistance(Wr,Y,ze)}else ze.setMinimum(L.getCoordinate(),Y)}else if(arguments[2]instanceof jt&&arguments[0]instanceof k&&arguments[1]instanceof d){var yi=arguments[0],Bn=arguments[1],vi=arguments[2],wo=yi.closestPoint(Bn);vi.setMinimum(wo,Bn)}};var De=function(){this._g0=null,this._g1=null,this._ptDist=new jt,this._densifyFrac=0;var n=arguments[0],t=arguments[1];this._g0=n,this._g1=t},Js={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};De.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()};De.prototype.setDensifyFraction=function(n){if(n>1||n<=0)throw new ft("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=n};De.prototype.compute=function(n,t){this.computeOrientedDistance(n,t,this._ptDist),this.computeOrientedDistance(t,n,this._ptDist)};De.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()};De.prototype.computeOrientedDistance=function(n,t,e){var r=new ii(t);if(n.apply(r),e.setMaximum(r.getMaxPointDistance()),this._densifyFrac>0){var o=new yr(t,this._densifyFrac);n.apply(o),e.setMaximum(o.getMaxPointDistance())}};De.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()};De.prototype.interfaces_=function(){return[]};De.prototype.getClass=function(){return De};De.distance=function(){if(arguments.length===2){var n=arguments[0],t=arguments[1],e=new De(n,t);return e.distance()}else if(arguments.length===3){var r=arguments[0],o=arguments[1],s=arguments[2],l=new De(r,o);return l.setDensifyFraction(s),l.distance()}};Js.MaxPointDistanceFilter.get=function(){return ii};Js.MaxDensifiedByFractionDistanceFilter.get=function(){return yr};Object.defineProperties(De,Js);var ii=function(){this._maxPtDist=new jt,this._minPtDist=new jt,this._euclideanDist=new rn,this._geom=null;var n=arguments[0];this._geom=n};ii.prototype.filter=function(n){this._minPtDist.initialize(),rn.computeDistance(this._geom,n,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};ii.prototype.getMaxPointDistance=function(){return this._maxPtDist};ii.prototype.interfaces_=function(){return[Ln]};ii.prototype.getClass=function(){return ii};var yr=function(){this._maxPtDist=new jt,this._minPtDist=new jt,this._geom=null,this._numSubSegs=0;var n=arguments[0],t=arguments[1];this._geom=n,this._numSubSegs=Math.trunc(Math.round(1/t))};yr.prototype.filter=function(n,t){var e=this;if(t===0)return null;for(var r=n.getCoordinate(t-1),o=n.getCoordinate(t),s=(o.x-r.x)/this._numSubSegs,l=(o.y-r.y)/this._numSubSegs,a=0;a<this._numSubSegs;a++){var h=r.x+a*s,y=r.y+a*l,C=new d(h,y);e._minPtDist.initialize(),rn.computeDistance(e._geom,C,e._minPtDist),e._maxPtDist.setMaximum(e._minPtDist)}};yr.prototype.isDone=function(){return!1};yr.prototype.isGeometryChanged=function(){return!1};yr.prototype.getMaxPointDistance=function(){return this._maxPtDist};yr.prototype.interfaces_=function(){return[Ye]};yr.prototype.getClass=function(){return yr};var pe=function(n,t,e){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=n||null,this._bufDistance=t||null,this._result=e||null},$s={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};pe.prototype.checkMaximumDistance=function(n,t,e){var r=new De(t,n);if(r.setDensifyFraction(.25),this._maxDistanceFound=r.orientedDistance(),this._maxDistanceFound>e){this._isValid=!1;var o=r.getCoordinates();this._errorLocation=o[1],this._errorIndicator=n.getFactory().createLineString(o),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+Xe.toLineString(o[0],o[1])+")"}};pe.prototype.isValid=function(){var n=Math.abs(this._bufDistance),t=pe.MAX_DISTANCE_DIFF_FRAC*n;return this._minValidDistance=n-t,this._maxValidDistance=n+t,this._input.isEmpty()||this._result.isEmpty()?!0:(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),pe.VERBOSE&&qt.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)};pe.prototype.checkNegativeValid=function(){if(!(this._input instanceof Ot||this._input instanceof Sn||this._input instanceof ie))return null;var n=this.getPolygonLines(this._input);if(this.checkMinimumDistance(n,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(n,this._result,this._maxValidDistance)};pe.prototype.getErrorIndicator=function(){return this._errorIndicator};pe.prototype.checkMinimumDistance=function(n,t,e){var r=new Xt(n,t,e);if(this._minDistanceFound=r.distance(),this._minDistanceFound<e){this._isValid=!1;var o=r.nearestPoints();this._errorLocation=r.nearestPoints()[1],this._errorIndicator=n.getFactory().createLineString(o),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+Xe.toLineString(o[0],o[1])+" )"}};pe.prototype.checkPositiveValid=function(){var n=this._result.getBoundary();if(this.checkMinimumDistance(this._input,n,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,n,this._maxValidDistance)};pe.prototype.getErrorLocation=function(){return this._errorLocation};pe.prototype.getPolygonLines=function(n){for(var t=new O,e=new Vt(t),r=jn.getPolygons(n),o=r.iterator();o.hasNext();){var s=o.next();s.apply(e)}return n.getFactory().buildGeometry(t)};pe.prototype.getErrorMessage=function(){return this._errMsg};pe.prototype.interfaces_=function(){return[]};pe.prototype.getClass=function(){return pe};$s.VERBOSE.get=function(){return!1};$s.MAX_DISTANCE_DIFF_FRAC.get=function(){return .012};Object.defineProperties(pe,$s);var Yt=function(n,t,e){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=n||null,this._distance=t||null,this._result=e||null},ta={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};Yt.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid};Yt.prototype.checkEnvelope=function(){if(this._distance<0)return null;var n=this._distance*Yt.MAX_ENV_DIFF_FRAC;n===0&&(n=.001);var t=new B(this._input.getEnvelopeInternal());t.expandBy(this._distance);var e=new B(this._result.getEnvelopeInternal());e.expandBy(n),e.contains(t)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(e)),this.report("Envelope")};Yt.prototype.checkDistance=function(){var n=new pe(this._input,this._distance,this._result);n.isValid()||(this._isValid=!1,this._errorMsg=n.getErrorMessage(),this._errorLocation=n.getErrorLocation(),this._errorIndicator=n.getErrorIndicator()),this.report("Distance")};Yt.prototype.checkArea=function(){var n=this._input.getArea(),t=this._result.getArea();this._distance>0&&n>t&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&n<t&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")};Yt.prototype.checkPolygonal=function(){this._result instanceof Ot||this._result instanceof Sn||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")};Yt.prototype.getErrorIndicator=function(){return this._errorIndicator};Yt.prototype.getErrorLocation=function(){return this._errorLocation};Yt.prototype.checkExpectedEmpty=function(){if(this._input.getDimension()>=2||this._distance>0)return null;this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),this.report("ExpectedEmpty")};Yt.prototype.report=function(n){if(!Yt.VERBOSE)return null;qt.out.println("Check "+n+": "+(this._isValid?"passed":"FAILED"))};Yt.prototype.getErrorMessage=function(){return this._errorMsg};Yt.prototype.interfaces_=function(){return[]};Yt.prototype.getClass=function(){return Yt};Yt.isValidMsg=function(n,t,e){var r=new Yt(n,t,e);return r.isValid()?null:r.getErrorMessage()};Yt.isValid=function(n,t,e){var r=new Yt(n,t,e);return!!r.isValid()};ta.VERBOSE.get=function(){return!1};ta.MAX_ENV_DIFF_FRAC.get=function(){return .012};Object.defineProperties(Yt,ta);var vn=function(){this._pts=null,this._data=null;var n=arguments[0],t=arguments[1];this._pts=n,this._data=t};vn.prototype.getCoordinates=function(){return this._pts};vn.prototype.size=function(){return this._pts.length};vn.prototype.getCoordinate=function(n){return this._pts[n]};vn.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};vn.prototype.getSegmentOctant=function(n){return n===this._pts.length-1?-1:$r.octant(this.getCoordinate(n),this.getCoordinate(n+1))};vn.prototype.setData=function(n){this._data=n};vn.prototype.getData=function(){return this._data};vn.prototype.toString=function(){return Xe.toLineString(new _t(this._pts))};vn.prototype.interfaces_=function(){return[Rn]};vn.prototype.getClass=function(){return vn};var At=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new O,this._intersectionCount=0,this._keepIntersections=!0;var n=arguments[0];this._li=n,this._interiorIntersection=null};At.prototype.getInteriorIntersection=function(){return this._interiorIntersection};At.prototype.setCheckEndSegmentsOnly=function(n){this._isCheckEndSegmentsOnly=n};At.prototype.getIntersectionSegments=function(){return this._intSegments};At.prototype.count=function(){return this._intersectionCount};At.prototype.getIntersections=function(){return this._intersections};At.prototype.setFindAllIntersections=function(n){this._findAllIntersections=n};At.prototype.setKeepIntersections=function(n){this._keepIntersections=n};At.prototype.processIntersections=function(n,t,e,r){if(!this._findAllIntersections&&this.hasIntersection()||n===e&&t===r)return null;if(this._isCheckEndSegmentsOnly){var o=this.isEndSegment(n,t)||this.isEndSegment(e,r);if(!o)return null}var s=n.getCoordinates()[t],l=n.getCoordinates()[t+1],a=e.getCoordinates()[r],h=e.getCoordinates()[r+1];this._li.computeIntersection(s,l,a,h),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=s,this._intSegments[1]=l,this._intSegments[2]=a,this._intSegments[3]=h,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)};At.prototype.isEndSegment=function(n,t){return t===0||t>=n.size()-2};At.prototype.hasIntersection=function(){return this._interiorIntersection!==null};At.prototype.isDone=function(){return this._findAllIntersections?!1:this._interiorIntersection!==null};At.prototype.interfaces_=function(){return[Ar]};At.prototype.getClass=function(){return At};At.createAllIntersectionsFinder=function(n){var t=new At(n);return t.setFindAllIntersections(!0),t};At.createAnyIntersectionFinder=function(n){return new At(n)};At.createIntersectionCounter=function(n){var t=new At(n);return t.setFindAllIntersections(!0),t.setKeepIntersections(!1),t};var Qe=function(){this._li=new Xr,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var n=arguments[0];this._segStrings=n};Qe.prototype.execute=function(){if(this._segInt!==null)return null;this.checkInteriorIntersections()};Qe.prototype.getIntersections=function(){return this._segInt.getIntersections()};Qe.prototype.isValid=function(){return this.execute(),this._isValid};Qe.prototype.setFindAllIntersections=function(n){this._findAllIntersections=n};Qe.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new At(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var n=new Qs;if(n.setSegmentIntersector(this._segInt),n.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null};Qe.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Jn(this.getErrorMessage(),this._segInt.getInteriorIntersection())};Qe.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var n=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+Xe.toLineString(n[0],n[1])+" and "+Xe.toLineString(n[2],n[3])};Qe.prototype.interfaces_=function(){return[]};Qe.prototype.getClass=function(){return Qe};Qe.computeIntersections=function(n){var t=new Qe(n);return t.setFindAllIntersections(!0),t.isValid(),t.getIntersections()};var kr=function n(){this._nv=null;var t=arguments[0];this._nv=new Qe(n.toSegmentStrings(t))};kr.prototype.checkValid=function(){this._nv.checkValid()};kr.prototype.interfaces_=function(){return[]};kr.prototype.getClass=function(){return kr};kr.toSegmentStrings=function(n){for(var t=new O,e=n.iterator();e.hasNext();){var r=e.next();t.add(new vn(r.getCoordinates(),r))}return t};kr.checkValid=function(n){var t=new kr(n);t.checkValid()};var oi=function(n){this._mapOp=n};oi.prototype.map=function(n){for(var t=this,e=new O,r=0;r<n.getNumGeometries();r++){var o=t._mapOp.map(n.getGeometryN(r));o.isEmpty()||e.add(o)}return n.getFactory().createGeometryCollection(H.toGeometryArray(e))};oi.prototype.interfaces_=function(){return[]};oi.prototype.getClass=function(){return oi};oi.map=function(n,t){var e=new oi(t);return e.map(n)};var yn=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new O,this._resultLineList=new O;var n=arguments[0],t=arguments[1],e=arguments[2];this._op=n,this._geometryFactory=t,this._ptLocator=e};yn.prototype.collectLines=function(n){for(var t=this,e=this._op.getGraph().getEdgeEnds().iterator();e.hasNext();){var r=e.next();t.collectLineEdge(r,n,t._lineEdgesList),t.collectBoundaryTouchEdge(r,n,t._lineEdgesList)}};yn.prototype.labelIsolatedLine=function(n,t){var e=this._ptLocator.locate(n.getCoordinate(),this._op.getArgGeometry(t));n.getLabel().setLocation(t,e)};yn.prototype.build=function(n){return this.findCoveredLineEdges(),this.collectLines(n),this.buildLines(n),this._resultLineList};yn.prototype.collectLineEdge=function(n,t,e){var r=n.getLabel(),o=n.getEdge();n.isLineEdge()&&!n.isVisited()&&U.isResultOfOp(r,t)&&!o.isCovered()&&(e.add(o),n.setVisitedEdge(!0))};yn.prototype.findCoveredLineEdges=function(){for(var n=this,t=this._op.getGraph().getNodes().iterator();t.hasNext();){var e=t.next();e.getEdges().findCoveredLineEdges()}for(var r=this._op.getGraph().getEdgeEnds().iterator();r.hasNext();){var o=r.next(),s=o.getEdge();if(o.isLineEdge()&&!s.isCoveredSet()){var l=n._op.isCoveredByA(o.getCoordinate());s.setCovered(l)}}};yn.prototype.labelIsolatedLines=function(n){for(var t=this,e=n.iterator();e.hasNext();){var r=e.next(),o=r.getLabel();r.isIsolated()&&(o.isNull(0)?t.labelIsolatedLine(r,0):t.labelIsolatedLine(r,1))}};yn.prototype.buildLines=function(n){for(var t=this,e=this._lineEdgesList.iterator();e.hasNext();){var r=e.next(),o=t._geometryFactory.createLineString(r.getCoordinates());t._resultLineList.add(o),r.setInResult(!0)}};yn.prototype.collectBoundaryTouchEdge=function(n,t,e){var r=n.getLabel();if(n.isLineEdge()||n.isVisited()||n.isInteriorAreaEdge()||n.getEdge().isInResult())return null;q.isTrue(!(n.isInResult()||n.getSym().isInResult())||!n.getEdge().isInResult()),U.isResultOfOp(r,t)&&t===U.INTERSECTION&&(e.add(n.getEdge()),n.setVisitedEdge(!0))};yn.prototype.interfaces_=function(){return[]};yn.prototype.getClass=function(){return yn};var si=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new O;var n=arguments[0],t=arguments[1];this._op=n,this._geometryFactory=t};si.prototype.filterCoveredNodeToPoint=function(n){var t=n.getCoordinate();if(!this._op.isCoveredByLA(t)){var e=this._geometryFactory.createPoint(t);this._resultPointList.add(e)}};si.prototype.extractNonCoveredResultNodes=function(n){for(var t=this,e=this._op.getGraph().getNodes().iterator();e.hasNext();){var r=e.next();if(!r.isInResult()&&!r.isIncidentEdgeInResult()&&(r.getEdges().getDegree()===0||n===U.INTERSECTION)){var o=r.getLabel();U.isResultOfOp(o,n)&&t.filterCoveredNodeToPoint(r)}}};si.prototype.build=function(n){return this.extractNonCoveredResultNodes(n),this._resultPointList};si.prototype.interfaces_=function(){return[]};si.prototype.getClass=function(){return si};var ge=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};ge.prototype.transformPoint=function(n,t){return this._factory.createPoint(this.transformCoordinates(n.getCoordinateSequence(),n))};ge.prototype.transformPolygon=function(n,t){var e=this,r=!0,o=this.transformLinearRing(n.getExteriorRing(),n);(o===null||!(o instanceof bn)||o.isEmpty())&&(r=!1);for(var s=new O,l=0;l<n.getNumInteriorRing();l++){var a=e.transformLinearRing(n.getInteriorRingN(l),n);a===null||a.isEmpty()||(a instanceof bn||(r=!1),s.add(a))}if(r)return this._factory.createPolygon(o,s.toArray([]));var h=new O;return o!==null&&h.add(o),h.addAll(s),this._factory.buildGeometry(h)};ge.prototype.createCoordinateSequence=function(n){return this._factory.getCoordinateSequenceFactory().create(n)};ge.prototype.getInputGeometry=function(){return this._inputGeom};ge.prototype.transformMultiLineString=function(n,t){for(var e=this,r=new O,o=0;o<n.getNumGeometries();o++){var s=e.transformLineString(n.getGeometryN(o),n);s!==null&&(s.isEmpty()||r.add(s))}return this._factory.buildGeometry(r)};ge.prototype.transformCoordinates=function(n,t){return this.copy(n)};ge.prototype.transformLineString=function(n,t){return this._factory.createLineString(this.transformCoordinates(n.getCoordinateSequence(),n))};ge.prototype.transformMultiPoint=function(n,t){for(var e=this,r=new O,o=0;o<n.getNumGeometries();o++){var s=e.transformPoint(n.getGeometryN(o),n);s!==null&&(s.isEmpty()||r.add(s))}return this._factory.buildGeometry(r)};ge.prototype.transformMultiPolygon=function(n,t){for(var e=this,r=new O,o=0;o<n.getNumGeometries();o++){var s=e.transformPolygon(n.getGeometryN(o),n);s!==null&&(s.isEmpty()||r.add(s))}return this._factory.buildGeometry(r)};ge.prototype.copy=function(n){return n.copy()};ge.prototype.transformGeometryCollection=function(n,t){for(var e=this,r=new O,o=0;o<n.getNumGeometries();o++){var s=e.transform(n.getGeometryN(o));s!==null&&(e._pruneEmptyGeometry&&s.isEmpty()||r.add(s))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(H.toGeometryArray(r)):this._factory.buildGeometry(r)};ge.prototype.transform=function(n){if(this._inputGeom=n,this._factory=n.getFactory(),n instanceof de)return this.transformPoint(n,null);if(n instanceof Pi)return this.transformMultiPoint(n,null);if(n instanceof bn)return this.transformLinearRing(n,null);if(n instanceof yt)return this.transformLineString(n,null);if(n instanceof Tr)return this.transformMultiLineString(n,null);if(n instanceof Ot)return this.transformPolygon(n,null);if(n instanceof Sn)return this.transformMultiPolygon(n,null);if(n instanceof ie)return this.transformGeometryCollection(n,null);throw new ft("Unknown Geometry subtype: "+n.getClass().getName())};ge.prototype.transformLinearRing=function(n,t){var e=this.transformCoordinates(n.getCoordinateSequence(),n);if(e===null)return this._factory.createLinearRing(null);var r=e.size();return r>0&&r<4&&!this._preserveType?this._factory.createLineString(e):this._factory.createLinearRing(e)};ge.prototype.interfaces_=function(){return[]};ge.prototype.getClass=function(){return ge};var Dn=function n(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new k,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof yt&&typeof arguments[1]=="number"){var t=arguments[0],e=arguments[1];n.call(this,t.getCoordinates(),e)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){var r=arguments[0],o=arguments[1];this._srcPts=r,this._isClosed=n.isClosed(r),this._snapTolerance=o}};Dn.prototype.snapVertices=function(n,t){for(var e=this,r=this._isClosed?n.size()-1:n.size(),o=0;o<r;o++){var s=n.get(o),l=e.findSnapForVertex(s,t);l!==null&&(n.set(o,new d(l)),o===0&&e._isClosed&&n.set(n.size()-1,new d(l)))}};Dn.prototype.findSnapForVertex=function(n,t){for(var e=this,r=0;r<t.length;r++){if(n.equals2D(t[r]))return null;if(n.distance(t[r])<e._snapTolerance)return t[r]}return null};Dn.prototype.snapTo=function(n){var t=new Eo(this._srcPts);this.snapVertices(t,n),this.snapSegments(t,n);var e=t.toCoordinateArray();return e};Dn.prototype.snapSegments=function(n,t){var e=this;if(t.length===0)return null;var r=t.length;t[0].equals2D(t[t.length-1])&&(r=t.length-1);for(var o=0;o<r;o++){var s=t[o],l=e.findSegmentIndexToSnap(s,n);l>=0&&n.add(l+1,new d(s),!1)}};Dn.prototype.findSegmentIndexToSnap=function(n,t){for(var e=this,r=z.MAX_VALUE,o=-1,s=0;s<t.size()-1;s++){if(e._seg.p0=t.get(s),e._seg.p1=t.get(s+1),e._seg.p0.equals2D(n)||e._seg.p1.equals2D(n)){if(e._allowSnappingToSourceVertices)continue;return-1}var l=e._seg.distance(n);l<e._snapTolerance&&l<r&&(r=l,o=s)}return o};Dn.prototype.setAllowSnappingToSourceVertices=function(n){this._allowSnappingToSourceVertices=n};Dn.prototype.interfaces_=function(){return[]};Dn.prototype.getClass=function(){return Dn};Dn.isClosed=function(n){return n.length<=1?!1:n[0].equals2D(n[n.length-1])};var Et=function(n){this._srcGeom=n||null},Bu={SNAP_PRECISION_FACTOR:{configurable:!0}};Et.prototype.snapTo=function(n,t){var e=this.extractTargetCoordinates(n),r=new ku(t,e);return r.transform(this._srcGeom)};Et.prototype.snapToSelf=function(n,t){var e=this.extractTargetCoordinates(this._srcGeom),r=new ku(n,e,!0),o=r.transform(this._srcGeom),s=o;return t&&V(s,fr)&&(s=o.buffer(0)),s};Et.prototype.computeSnapTolerance=function(n){var t=this.computeMinimumSegmentLength(n),e=t/10;return e};Et.prototype.extractTargetCoordinates=function(n){for(var t=new ln,e=n.getCoordinates(),r=0;r<e.length;r++)t.add(e[r]);return t.toArray(new Array(0).fill(null))};Et.prototype.computeMinimumSegmentLength=function(n){for(var t=z.MAX_VALUE,e=0;e<n.length-1;e++){var r=n[e].distance(n[e+1]);r<t&&(t=r)}return t};Et.prototype.interfaces_=function(){return[]};Et.prototype.getClass=function(){return Et};Et.snap=function(n,t,e){var r=new Array(2).fill(null),o=new Et(n);r[0]=o.snapTo(t,e);var s=new Et(t);return r[1]=s.snapTo(r[0],e),r};Et.computeOverlaySnapTolerance=function(){if(arguments.length===1){var n=arguments[0],t=Et.computeSizeBasedSnapTolerance(n),e=n.getPrecisionModel();if(e.getType()===$.FIXED){var r=1/e.getScale()*2/1.415;r>t&&(t=r)}return t}else if(arguments.length===2){var o=arguments[0],s=arguments[1];return Math.min(Et.computeOverlaySnapTolerance(o),Et.computeOverlaySnapTolerance(s))}};Et.computeSizeBasedSnapTolerance=function(n){var t=n.getEnvelopeInternal(),e=Math.min(t.getHeight(),t.getWidth()),r=e*Et.SNAP_PRECISION_FACTOR;return r};Et.snapToSelf=function(n,t,e){var r=new Et(n);return r.snapToSelf(t,e)};Bu.SNAP_PRECISION_FACTOR.get=function(){return 1e-9};Object.defineProperties(Et,Bu);var ku=function(n){function t(e,r,o){n.call(this),this._snapTolerance=e||null,this._snapPts=r||null,this._isSelfSnap=o!==void 0?o:!1}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.snapLine=function(e,r){var o=new Dn(e,this._snapTolerance);return o.setAllowSnappingToSourceVertices(this._isSelfSnap),o.snapTo(r)},t.prototype.transformCoordinates=function(e,r){var o=e.toCoordinateArray(),s=this.snapLine(o,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(s)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(ge),$t=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};$t.prototype.getCommon=function(){return z.longBitsToDouble(this._commonBits)};$t.prototype.add=function(n){var t=z.doubleToLongBits(n);if(this._isFirst)return this._commonBits=t,this._commonSignExp=$t.signExpBits(this._commonBits),this._isFirst=!1,null;var e=$t.signExpBits(t);if(e!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=$t.numCommonMostSigMantissaBits(this._commonBits,t),this._commonBits=$t.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))};$t.prototype.toString=function(){if(arguments.length===1){var n=arguments[0],t=z.longBitsToDouble(n),e=z.toBinaryString(n),r="0000000000000000000000000000000000000000000000000000000000000000"+e,o=r.substring(r.length-64),s=o.substring(0,1)+"  "+o.substring(1,12)+"(exp) "+o.substring(12)+" [ "+t+" ]";return s}};$t.prototype.interfaces_=function(){return[]};$t.prototype.getClass=function(){return $t};$t.getBit=function(n,t){var e=1<<t;return n&e?1:0};$t.signExpBits=function(n){return n>>52};$t.zeroLowerBits=function(n,t){var e=(1<<t)-1,r=~e,o=n&r;return o};$t.numCommonMostSigMantissaBits=function(n,t){for(var e=0,r=52;r>=0;r--){if($t.getBit(n,r)!==$t.getBit(t,r))return e;e++}return 52};var mr=function(){this._commonCoord=null,this._ccFilter=new ai},ea={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};mr.prototype.addCommonBits=function(n){var t=new _r(this._commonCoord);n.apply(t),n.geometryChanged()};mr.prototype.removeCommonBits=function(n){if(this._commonCoord.x===0&&this._commonCoord.y===0)return n;var t=new d(this._commonCoord);t.x=-t.x,t.y=-t.y;var e=new _r(t);return n.apply(e),n.geometryChanged(),n};mr.prototype.getCommonCoordinate=function(){return this._commonCoord};mr.prototype.add=function(n){n.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()};mr.prototype.interfaces_=function(){return[]};mr.prototype.getClass=function(){return mr};ea.CommonCoordinateFilter.get=function(){return ai};ea.Translater.get=function(){return _r};Object.defineProperties(mr,ea);var ai=function(){this._commonBitsX=new $t,this._commonBitsY=new $t};ai.prototype.filter=function(n){this._commonBitsX.add(n.x),this._commonBitsY.add(n.y)};ai.prototype.getCommonCoordinate=function(){return new d(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())};ai.prototype.interfaces_=function(){return[Ln]};ai.prototype.getClass=function(){return ai};var _r=function(){this.trans=null;var n=arguments[0];this.trans=n};_r.prototype.filter=function(n,t){var e=n.getOrdinate(t,0)+this.trans.x,r=n.getOrdinate(t,1)+this.trans.y;n.setOrdinate(t,0,e),n.setOrdinate(t,1,r)};_r.prototype.isDone=function(){return!1};_r.prototype.isGeometryChanged=function(){return!0};_r.prototype.interfaces_=function(){return[Ye]};_r.prototype.getClass=function(){return _r};var Ft=function(n,t){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=n,this._geom[1]=t,this.computeSnapTolerance()};Ft.prototype.selfSnap=function(n){var t=new Et(n),e=t.snapTo(n,this._snapTolerance);return e};Ft.prototype.removeCommonBits=function(n){this._cbr=new mr,this._cbr.add(n[0]),this._cbr.add(n[1]);var t=new Array(2).fill(null);return t[0]=this._cbr.removeCommonBits(n[0].copy()),t[1]=this._cbr.removeCommonBits(n[1].copy()),t};Ft.prototype.prepareResult=function(n){return this._cbr.addCommonBits(n),n};Ft.prototype.getResultGeometry=function(n){var t=this.snap(this._geom),e=U.overlayOp(t[0],t[1],n);return this.prepareResult(e)};Ft.prototype.checkValid=function(n){n.isValid()||qt.out.println("Snapped geometry is invalid")};Ft.prototype.computeSnapTolerance=function(){this._snapTolerance=Et.computeOverlaySnapTolerance(this._geom[0],this._geom[1])};Ft.prototype.snap=function(n){var t=this.removeCommonBits(n),e=Et.snap(t[0],t[1],this._snapTolerance);return e};Ft.prototype.interfaces_=function(){return[]};Ft.prototype.getClass=function(){return Ft};Ft.overlayOp=function(n,t,e){var r=new Ft(n,t);return r.getResultGeometry(e)};Ft.union=function(n,t){return Ft.overlayOp(n,t,U.UNION)};Ft.intersection=function(n,t){return Ft.overlayOp(n,t,U.INTERSECTION)};Ft.symDifference=function(n,t){return Ft.overlayOp(n,t,U.SYMDIFFERENCE)};Ft.difference=function(n,t){return Ft.overlayOp(n,t,U.DIFFERENCE)};var ae=function(n,t){this._geom=new Array(2).fill(null),this._geom[0]=n,this._geom[1]=t};ae.prototype.getResultGeometry=function(n){var t=null,e=!1,r=null;try{t=U.overlayOp(this._geom[0],this._geom[1],n);var o=!0;o&&(e=!0)}catch(s){if(s instanceof Qn)r=s;else throw s}finally{}if(!e)try{t=Ft.overlayOp(this._geom[0],this._geom[1],n)}catch(s){throw s instanceof Qn?r:s}finally{}return t};ae.prototype.interfaces_=function(){return[]};ae.prototype.getClass=function(){return ae};ae.overlayOp=function(n,t,e){var r=new ae(n,t);return r.getResultGeometry(e)};ae.union=function(n,t){return ae.overlayOp(n,t,U.UNION)};ae.intersection=function(n,t){return ae.overlayOp(n,t,U.INTERSECTION)};ae.symDifference=function(n,t){return ae.overlayOp(n,t,U.SYMDIFFERENCE)};ae.difference=function(n,t){return ae.overlayOp(n,t,U.DIFFERENCE)};var po=function(){this.mce=null,this.chainIndex=null;var n=arguments[0],t=arguments[1];this.mce=n,this.chainIndex=t};po.prototype.computeIntersections=function(n,t){this.mce.computeIntersectsForChain(this.chainIndex,n.mce,n.chainIndex,t)};po.prototype.interfaces_=function(){return[]};po.prototype.getClass=function(){return po};var me=function n(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,arguments.length===2){var t=arguments[0],e=arguments[1];this._eventType=n.DELETE,this._xValue=t,this._insertEvent=e}else if(arguments.length===3){var r=arguments[0],o=arguments[1],s=arguments[2];this._eventType=n.INSERT,this._label=r,this._xValue=o,this._obj=s}},na={INSERT:{configurable:!0},DELETE:{configurable:!0}};me.prototype.isDelete=function(){return this._eventType===me.DELETE};me.prototype.setDeleteEventIndex=function(n){this._deleteEventIndex=n};me.prototype.getObject=function(){return this._obj};me.prototype.compareTo=function(n){var t=n;return this._xValue<t._xValue?-1:this._xValue>t._xValue?1:this._eventType<t._eventType?-1:this._eventType>t._eventType?1:0};me.prototype.getInsertEvent=function(){return this._insertEvent};me.prototype.isInsert=function(){return this._eventType===me.INSERT};me.prototype.isSameLabel=function(n){return this._label===null?!1:this._label===n._label};me.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex};me.prototype.interfaces_=function(){return[ke]};me.prototype.getClass=function(){return me};na.INSERT.get=function(){return 1};na.DELETE.get=function(){return 2};Object.defineProperties(me,na);var Yo=function(){};Yo.prototype.interfaces_=function(){return[]};Yo.prototype.getClass=function(){return Yo};var Wt=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var n=arguments[0],t=arguments[1],e=arguments[2];this._li=n,this._includeProper=t,this._recordIsolated=e};Wt.prototype.isTrivialIntersection=function(n,t,e,r){if(n===e&&this._li.getIntersectionNum()===1){if(Wt.isAdjacentSegments(t,r))return!0;if(n.isClosed()){var o=n.getNumPoints()-1;if(t===0&&r===o||r===0&&t===o)return!0}}return!1};Wt.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Wt.prototype.setIsDoneIfProperInt=function(n){this._isDoneWhenProperInt=n};Wt.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Wt.prototype.isBoundaryPointInternal=function(n,t){for(var e=t.iterator();e.hasNext();){var r=e.next(),o=r.getCoordinate();if(n.isIntersection(o))return!0}return!1};Wt.prototype.hasProperIntersection=function(){return this._hasProper};Wt.prototype.hasIntersection=function(){return this._hasIntersection};Wt.prototype.isDone=function(){return this._isDone};Wt.prototype.isBoundaryPoint=function(n,t){return t===null?!1:!!(this.isBoundaryPointInternal(n,t[0])||this.isBoundaryPointInternal(n,t[1]))};Wt.prototype.setBoundaryNodes=function(n,t){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=n,this._bdyNodes[1]=t};Wt.prototype.addIntersections=function(n,t,e,r){if(n===e&&t===r)return null;this.numTests++;var o=n.getCoordinates()[t],s=n.getCoordinates()[t+1],l=e.getCoordinates()[r],a=e.getCoordinates()[r+1];this._li.computeIntersection(o,s,l,a),this._li.hasIntersection()&&(this._recordIsolated&&(n.setIsolated(!1),e.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(n,t,e,r)||(this._hasIntersection=!0,(this._includeProper||!this._li.isProper())&&(n.addIntersections(this._li,t,0),e.addIntersections(this._li,r,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))};Wt.prototype.interfaces_=function(){return[]};Wt.prototype.getClass=function(){return Wt};Wt.isAdjacentSegments=function(n,t){return Math.abs(n-t)===1};var sf=function(n){function t(){n.call(this),this.events=new O,this.nOverlaps=null}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.prepareEvents=function(){var e=this;He.sort(this.events);for(var r=0;r<this.events.size();r++){var o=e.events.get(r);o.isDelete()&&o.getInsertEvent().setDeleteEventIndex(r)}},t.prototype.computeIntersections=function(){var e=this;if(arguments.length===1){var r=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var o=0;o<this.events.size();o++){var s=e.events.get(o);if(s.isInsert()&&e.processOverlaps(o,s.getDeleteEventIndex(),s,r),r.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof Wt&&V(arguments[0],qe)&&V(arguments[1],qe)){var l=arguments[0],a=arguments[1],h=arguments[2];this.addEdges(l,l),this.addEdges(a,a),this.computeIntersections(h)}else if(typeof arguments[2]=="boolean"&&V(arguments[0],qe)&&arguments[1]instanceof Wt){var y=arguments[0],C=arguments[1],L=arguments[2];L?this.addEdges(y,null):this.addEdges(y),this.computeIntersections(C)}}},t.prototype.addEdge=function(e,r){for(var o=this,s=e.getMonotoneChainEdge(),l=s.getStartIndexes(),a=0;a<l.length-1;a++){var h=new po(s,a),y=new me(r,s.getMinX(a),h);o.events.add(y),o.events.add(new me(s.getMaxX(a),y))}},t.prototype.processOverlaps=function(e,r,o,s){for(var l=this,a=o.getObject(),h=e;h<r;h++){var y=l.events.get(h);if(y.isInsert()){var C=y.getObject();o.isSameLabel(y)||(a.computeIntersections(C,s),l.nOverlaps++)}}},t.prototype.addEdges=function(){var e=this;if(arguments.length===1)for(var r=arguments[0],o=r.iterator();o.hasNext();){var s=o.next();e.addEdge(s,s)}else if(arguments.length===2)for(var l=arguments[0],a=arguments[1],h=l.iterator();h.hasNext();){var y=h.next();e.addEdge(y,a)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Yo),Mn=function(){this._min=z.POSITIVE_INFINITY,this._max=z.NEGATIVE_INFINITY},Gu={NodeComparator:{configurable:!0}};Mn.prototype.getMin=function(){return this._min};Mn.prototype.intersects=function(n,t){return!(this._min>t||this._max<n)};Mn.prototype.getMax=function(){return this._max};Mn.prototype.toString=function(){return Xe.toLineString(new d(this._min,0),new d(this._max,0))};Mn.prototype.interfaces_=function(){return[]};Mn.prototype.getClass=function(){return Mn};Gu.NodeComparator.get=function(){return vo};Object.defineProperties(Mn,Gu);var vo=function(){};vo.prototype.compare=function(n,t){var e=n,r=t,o=(e._min+e._max)/2,s=(r._min+r._max)/2;return o<s?-1:o>s?1:0};vo.prototype.interfaces_=function(){return[Ci]};vo.prototype.getClass=function(){return vo};var af=function(n){function t(){n.call(this),this._item=null;var e=arguments[0],r=arguments[1],o=arguments[2];this._min=e,this._max=r,this._item=o}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.query=function(e,r,o){if(!this.intersects(e,r))return null;o.visitItem(this._item)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Mn),uf=function(n){function t(){n.call(this),this._node1=null,this._node2=null;var e=arguments[0],r=arguments[1];this._node1=e,this._node2=r,this.buildExtent(this._node1,this._node2)}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.buildExtent=function(e,r){this._min=Math.min(e._min,r._min),this._max=Math.max(e._max,r._max)},t.prototype.query=function(e,r,o){if(!this.intersects(e,r))return null;this._node1!==null&&this._node1.query(e,r,o),this._node2!==null&&this._node2.query(e,r,o)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Mn),An=function(){this._leaves=new O,this._root=null,this._level=0};An.prototype.buildTree=function(){var n=this;He.sort(this._leaves,new Mn.NodeComparator);for(var t=this._leaves,e=null,r=new O;;){if(n.buildLevel(t,r),r.size()===1)return r.get(0);e=t,t=r,r=e}};An.prototype.insert=function(n,t,e){if(this._root!==null)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new af(n,t,e))};An.prototype.query=function(n,t,e){this.init(),this._root.query(n,t,e)};An.prototype.buildRoot=function(){if(this._root!==null)return null;this._root=this.buildTree()};An.prototype.printNode=function(n){qt.out.println(Xe.toLineString(new d(n._min,this._level),new d(n._max,this._level)))};An.prototype.init=function(){if(this._root!==null)return null;this.buildRoot()};An.prototype.buildLevel=function(n,t){this._level++,t.clear();for(var e=0;e<n.size();e+=2){var r=n.get(e),o=e+1<n.size()?n.get(e):null;if(o===null)t.add(r);else{var s=new uf(n.get(e),n.get(e+1));t.add(s)}}};An.prototype.interfaces_=function(){return[]};An.prototype.getClass=function(){return An};var Ai=function(){this._items=new O};Ai.prototype.visitItem=function(n){this._items.add(n)};Ai.prototype.getItems=function(){return this._items};Ai.prototype.interfaces_=function(){return[hr]};Ai.prototype.getClass=function(){return Ai};var Fi=function(){this._index=null;var n=arguments[0];if(!V(n,fr))throw new ft("Argument must be Polygonal");this._index=new Gr(n)},ra={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};Fi.prototype.locate=function(n){var t=new sn(n),e=new Bi(t);return this._index.query(n.y,n.y,e),t.getLocation()};Fi.prototype.interfaces_=function(){return[Di]};Fi.prototype.getClass=function(){return Fi};ra.SegmentVisitor.get=function(){return Bi};ra.IntervalIndexedGeometry.get=function(){return Gr};Object.defineProperties(Fi,ra);var Bi=function(){this._counter=null;var n=arguments[0];this._counter=n};Bi.prototype.visitItem=function(n){var t=n;this._counter.countSegment(t.getCoordinate(0),t.getCoordinate(1))};Bi.prototype.interfaces_=function(){return[hr]};Bi.prototype.getClass=function(){return Bi};var Gr=function(){this._index=new An;var n=arguments[0];this.init(n)};Gr.prototype.init=function(n){for(var t=this,e=Vt.getLines(n),r=e.iterator();r.hasNext();){var o=r.next(),s=o.getCoordinates();t.addLine(s)}};Gr.prototype.addLine=function(n){for(var t=this,e=1;e<n.length;e++){var r=new k(n[e-1],n[e]),o=Math.min(r.p0.y,r.p1.y),s=Math.max(r.p0.y,r.p1.y);t._index.insert(o,s,r)}};Gr.prototype.query=function(){if(arguments.length===2){var n=arguments[0],t=arguments[1],e=new Ai;return this._index.query(n,t,e),e.getItems()}else if(arguments.length===3){var r=arguments[0],o=arguments[1],s=arguments[2];this._index.query(r,o,s)}};Gr.prototype.interfaces_=function(){return[]};Gr.prototype.getClass=function(){return Gr};var Ki=function(n){function t(){if(n.call(this),this._parentGeom=null,this._lineEdgeMap=new Cu,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Ke,arguments.length===2){var e=arguments[0],r=arguments[1],o=Ae.OGC_SFS_BOUNDARY_RULE;this._argIndex=e,this._parentGeom=r,this._boundaryNodeRule=o,r!==null&&this.add(r)}else if(arguments.length===3){var s=arguments[0],l=arguments[1],a=arguments[2];this._argIndex=s,this._parentGeom=l,this._boundaryNodeRule=a,l!==null&&this.add(l)}}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.insertBoundaryPoint=function(e,r){var o=this._nodes.addNode(r),s=o.getLabel(),l=1,a=E.NONE;a=s.getLocation(e,b.ON),a===E.BOUNDARY&&l++;var h=t.determineBoundary(this._boundaryNodeRule,l);s.setLocation(e,h)},t.prototype.computeSelfNodes=function(){if(arguments.length===2){var e=arguments[0],r=arguments[1];return this.computeSelfNodes(e,r,!1)}else if(arguments.length===3){var o=arguments[0],s=arguments[1],l=arguments[2],a=new Wt(o,!0,!1);a.setIsDoneIfProperInt(l);var h=this.createEdgeSetIntersector(),y=this._parentGeom instanceof bn||this._parentGeom instanceof Ot||this._parentGeom instanceof Sn,C=s||!y;return h.computeIntersections(this._edges,a,C),this.addSelfIntersectionNodes(this._argIndex),a}},t.prototype.computeSplitEdges=function(e){for(var r=this._edges.iterator();r.hasNext();){var o=r.next();o.eiList.addSplitEdges(e)}},t.prototype.computeEdgeIntersections=function(e,r,o){var s=new Wt(r,o,!0);s.setBoundaryNodes(this.getBoundaryNodes(),e.getBoundaryNodes());var l=this.createEdgeSetIntersector();return l.computeIntersections(this._edges,e._edges,s),s},t.prototype.getGeometry=function(){return this._parentGeom},t.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},t.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},t.prototype.addPoint=function(){if(arguments[0]instanceof de){var e=arguments[0],r=e.getCoordinate();this.insertPoint(this._argIndex,r,E.INTERIOR)}else if(arguments[0]instanceof d){var o=arguments[0];this.insertPoint(this._argIndex,o,E.INTERIOR)}},t.prototype.addPolygon=function(e){var r=this;this.addPolygonRing(e.getExteriorRing(),E.EXTERIOR,E.INTERIOR);for(var o=0;o<e.getNumInteriorRing();o++){var s=e.getInteriorRingN(o);r.addPolygonRing(s,E.INTERIOR,E.EXTERIOR)}},t.prototype.addEdge=function(e){this.insertEdge(e);var r=e.getCoordinates();this.insertPoint(this._argIndex,r[0],E.BOUNDARY),this.insertPoint(this._argIndex,r[r.length-1],E.BOUNDARY)},t.prototype.addLineString=function(e){var r=j.removeRepeatedPoints(e.getCoordinates());if(r.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=r[0],null;var o=new Xo(r,new et(this._argIndex,E.INTERIOR));this._lineEdgeMap.put(e,o),this.insertEdge(o),q.isTrue(r.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,r[0]),this.insertBoundaryPoint(this._argIndex,r[r.length-1])},t.prototype.getInvalidPoint=function(){return this._invalidPoint},t.prototype.getBoundaryPoints=function(){for(var e=this.getBoundaryNodes(),r=new Array(e.size()).fill(null),o=0,s=e.iterator();s.hasNext();){var l=s.next();r[o++]=l.getCoordinate().copy()}return r},t.prototype.getBoundaryNodes=function(){return this._boundaryNodes===null&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},t.prototype.addSelfIntersectionNode=function(e,r,o){if(this.isBoundaryNode(e,r))return null;o===E.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(e,r):this.insertPoint(e,r,o)},t.prototype.addPolygonRing=function(e,r,o){if(e.isEmpty())return null;var s=j.removeRepeatedPoints(e.getCoordinates());if(s.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=s[0],null;var l=r,a=o;M.isCCW(s)&&(l=o,a=r);var h=new Xo(s,new et(this._argIndex,E.BOUNDARY,l,a));this._lineEdgeMap.put(e,h),this.insertEdge(h),this.insertPoint(this._argIndex,s[0],E.BOUNDARY)},t.prototype.insertPoint=function(e,r,o){var s=this._nodes.addNode(r),l=s.getLabel();l===null?s._label=new et(e,o):l.setLocation(e,o)},t.prototype.createEdgeSetIntersector=function(){return new sf},t.prototype.addSelfIntersectionNodes=function(e){for(var r=this,o=this._edges.iterator();o.hasNext();)for(var s=o.next(),l=s.getLabel().getLocation(e),a=s.eiList.iterator();a.hasNext();){var h=a.next();r.addSelfIntersectionNode(e,h.coord,l)}},t.prototype.add=function(){if(arguments.length===1){var e=arguments[0];if(e.isEmpty())return null;if(e instanceof Sn&&(this._useBoundaryDeterminationRule=!1),e instanceof Ot)this.addPolygon(e);else if(e instanceof yt)this.addLineString(e);else if(e instanceof de)this.addPoint(e);else if(e instanceof Pi)this.addCollection(e);else if(e instanceof Tr)this.addCollection(e);else if(e instanceof Sn)this.addCollection(e);else if(e instanceof ie)this.addCollection(e);else throw new Error(e.getClass().getName())}else return n.prototype.add.apply(this,arguments)},t.prototype.addCollection=function(e){for(var r=this,o=0;o<e.getNumGeometries();o++){var s=e.getGeometryN(o);r.add(s)}},t.prototype.locate=function(e){return V(this._parentGeom,fr)&&this._parentGeom.getNumGeometries()>50?(this._areaPtLocator===null&&(this._areaPtLocator=new Fi(this._parentGeom)),this._areaPtLocator.locate(e)):this._ptLocator.locate(e,this._parentGeom)},t.prototype.findEdge=function(){if(arguments.length===1){var e=arguments[0];return this._lineEdgeMap.get(e)}else return n.prototype.findEdge.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.determineBoundary=function(e,r){return e.isInBoundary(r)?E.BOUNDARY:E.INTERIOR},t}(pt),ki=function(){if(this._li=new Xr,this._resultPrecisionModel=null,this._arg=null,arguments.length===1){var n=arguments[0];this.setComputationPrecision(n.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new Ki(0,n)}else if(arguments.length===2){var t=arguments[0],e=arguments[1],r=Ae.OGC_SFS_BOUNDARY_RULE;t.getPrecisionModel().compareTo(e.getPrecisionModel())>=0?this.setComputationPrecision(t.getPrecisionModel()):this.setComputationPrecision(e.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Ki(0,t,r),this._arg[1]=new Ki(1,e,r)}else if(arguments.length===3){var o=arguments[0],s=arguments[1],l=arguments[2];o.getPrecisionModel().compareTo(s.getPrecisionModel())>=0?this.setComputationPrecision(o.getPrecisionModel()):this.setComputationPrecision(s.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Ki(0,o,l),this._arg[1]=new Ki(1,s,l)}};ki.prototype.getArgGeometry=function(n){return this._arg[n].getGeometry()};ki.prototype.setComputationPrecision=function(n){this._resultPrecisionModel=n,this._li.setPrecisionModel(this._resultPrecisionModel)};ki.prototype.interfaces_=function(){return[]};ki.prototype.getClass=function(){return ki};var br=function(){};br.prototype.interfaces_=function(){return[]};br.prototype.getClass=function(){return br};br.map=function(){if(arguments[0]instanceof G&&V(arguments[1],br.MapOp)){for(var n=arguments[0],t=arguments[1],e=new O,r=0;r<n.getNumGeometries();r++){var o=t.map(n.getGeometryN(r));o!==null&&e.add(o)}return n.getFactory().buildGeometry(e)}else if(V(arguments[0],Lt)&&V(arguments[1],br.MapOp)){for(var s=arguments[0],l=arguments[1],a=new O,h=s.iterator();h.hasNext();){var y=h.next(),C=l.map(y);C!==null&&a.add(C)}return a}};br.MapOp=function(){};var U=function(n){function t(){var e=arguments[0],r=arguments[1];n.call(this,e,r),this._ptLocator=new Ke,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new je,this._resultPolyList=new O,this._resultLineList=new O,this._resultPointList=new O,this._graph=new pt(new Ru),this._geomFact=e.getFactory()}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.insertUniqueEdge=function(e){var r=this._edgeList.findEqualEdge(e);if(r!==null){var o=r.getLabel(),s=e.getLabel();r.isPointwiseEqual(e)||(s=new et(e.getLabel()),s.flip());var l=r.getDepth();l.isNull()&&l.add(o),l.add(s),o.merge(s)}else this._edgeList.add(e)},t.prototype.getGraph=function(){return this._graph},t.prototype.cancelDuplicateResultEdges=function(){for(var e=this._graph.getEdgeEnds().iterator();e.hasNext();){var r=e.next(),o=r.getSym();r.isInResult()&&o.isInResult()&&(r.setInResult(!1),o.setInResult(!1))}},t.prototype.isCoveredByLA=function(e){return!!(this.isCovered(e,this._resultLineList)||this.isCovered(e,this._resultPolyList))},t.prototype.computeGeometry=function(e,r,o,s){var l=new O;return l.addAll(e),l.addAll(r),l.addAll(o),l.isEmpty()?t.createEmptyResult(s,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(l)},t.prototype.mergeSymLabels=function(){for(var e=this._graph.getNodes().iterator();e.hasNext();){var r=e.next();r.getEdges().mergeSymLabels()}},t.prototype.isCovered=function(e,r){for(var o=this,s=r.iterator();s.hasNext();){var l=s.next(),a=o._ptLocator.locate(e,l);if(a!==E.EXTERIOR)return!0}return!1},t.prototype.replaceCollapsedEdges=function(){for(var e=new O,r=this._edgeList.iterator();r.hasNext();){var o=r.next();o.isCollapsed()&&(r.remove(),e.add(o.getCollapsedEdge()))}this._edgeList.addAll(e)},t.prototype.updateNodeLabelling=function(){for(var e=this._graph.getNodes().iterator();e.hasNext();){var r=e.next(),o=r.getEdges().getLabel();r.getLabel().merge(o)}},t.prototype.getResultGeometry=function(e){return this.computeOverlay(e),this._resultGeom},t.prototype.insertUniqueEdges=function(e){for(var r=this,o=e.iterator();o.hasNext();){var s=o.next();r.insertUniqueEdge(s)}},t.prototype.computeOverlay=function(e){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var r=new O;this._arg[0].computeSplitEdges(r),this._arg[1].computeSplitEdges(r),this.insertUniqueEdges(r),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),kr.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(e),this.cancelDuplicateResultEdges();var o=new ve(this._geomFact);o.add(this._graph),this._resultPolyList=o.getPolygons();var s=new yn(this,this._geomFact,this._ptLocator);this._resultLineList=s.build(e);var l=new si(this,this._geomFact,this._ptLocator);this._resultPointList=l.build(e),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,e)},t.prototype.labelIncompleteNode=function(e,r){var o=this._ptLocator.locate(e.getCoordinate(),this._arg[r].getGeometry());e.getLabel().setLocation(r,o)},t.prototype.copyPoints=function(e){for(var r=this,o=this._arg[e].getNodeIterator();o.hasNext();){var s=o.next(),l=r._graph.addNode(s.getCoordinate());l.setLabel(e,s.getLabel().getLocation(e))}},t.prototype.findResultAreaEdges=function(e){for(var r=this._graph.getEdgeEnds().iterator();r.hasNext();){var o=r.next(),s=o.getLabel();s.isArea()&&!o.isInteriorAreaEdge()&&t.isResultOfOp(s.getLocation(0,b.RIGHT),s.getLocation(1,b.RIGHT),e)&&o.setInResult(!0)}},t.prototype.computeLabelsFromDepths=function(){for(var e=this._edgeList.iterator();e.hasNext();){var r=e.next(),o=r.getLabel(),s=r.getDepth();if(!s.isNull()){s.normalize();for(var l=0;l<2;l++)!o.isNull(l)&&o.isArea()&&!s.isNull(l)&&(s.getDelta(l)===0?o.toLine(l):(q.isTrue(!s.isNull(l,b.LEFT),"depth of LEFT side has not been initialized"),o.setLocation(l,b.LEFT,s.getLocation(l,b.LEFT)),q.isTrue(!s.isNull(l,b.RIGHT),"depth of RIGHT side has not been initialized"),o.setLocation(l,b.RIGHT,s.getLocation(l,b.RIGHT))))}}},t.prototype.computeLabelling=function(){for(var e=this,r=this._graph.getNodes().iterator();r.hasNext();){var o=r.next();o.getEdges().computeLabelling(e._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},t.prototype.labelIncompleteNodes=function(){for(var e=this,r=this._graph.getNodes().iterator();r.hasNext();){var o=r.next(),s=o.getLabel();o.isIsolated()&&(s.isNull(0)?e.labelIncompleteNode(o,0):e.labelIncompleteNode(o,1)),o.getEdges().updateLabelling(s)}},t.prototype.isCoveredByA=function(e){return!!this.isCovered(e,this._resultPolyList)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(ki);U.overlayOp=function(n,t,e){var r=new U(n,t),o=r.getResultGeometry(e);return o};U.intersection=function(n,t){if(n.isEmpty()||t.isEmpty())return U.createEmptyResult(U.INTERSECTION,n,t,n.getFactory());if(n.isGeometryCollection()){var e=t;return oi.map(n,{interfaces_:function(){return[br.MapOp]},map:function(r){return r.intersection(e)}})}return n.checkNotGeometryCollection(n),n.checkNotGeometryCollection(t),ae.overlayOp(n,t,U.INTERSECTION)};U.symDifference=function(n,t){if(n.isEmpty()||t.isEmpty()){if(n.isEmpty()&&t.isEmpty())return U.createEmptyResult(U.SYMDIFFERENCE,n,t,n.getFactory());if(n.isEmpty())return t.copy();if(t.isEmpty())return n.copy()}return n.checkNotGeometryCollection(n),n.checkNotGeometryCollection(t),ae.overlayOp(n,t,U.SYMDIFFERENCE)};U.resultDimension=function(n,t,e){var r=t.getDimension(),o=e.getDimension(),s=-1;switch(n){case U.INTERSECTION:s=Math.min(r,o);break;case U.UNION:s=Math.max(r,o);break;case U.DIFFERENCE:s=r;break;case U.SYMDIFFERENCE:s=Math.max(r,o);break}return s};U.createEmptyResult=function(n,t,e,r){var o=null;switch(U.resultDimension(n,t,e)){case-1:o=r.createGeometryCollection(new Array(0).fill(null));break;case 0:o=r.createPoint();break;case 1:o=r.createLineString();break;case 2:o=r.createPolygon();break}return o};U.difference=function(n,t){return n.isEmpty()?U.createEmptyResult(U.DIFFERENCE,n,t,n.getFactory()):t.isEmpty()?n.copy():(n.checkNotGeometryCollection(n),n.checkNotGeometryCollection(t),ae.overlayOp(n,t,U.DIFFERENCE))};U.isResultOfOp=function(){if(arguments.length===2){var n=arguments[0],t=arguments[1],e=n.getLocation(0),r=n.getLocation(1);return U.isResultOfOp(e,r,t)}else if(arguments.length===3){var o=arguments[0],s=arguments[1],l=arguments[2];switch(o===E.BOUNDARY&&(o=E.INTERIOR),s===E.BOUNDARY&&(s=E.INTERIOR),l){case U.INTERSECTION:return o===E.INTERIOR&&s===E.INTERIOR;case U.UNION:return o===E.INTERIOR||s===E.INTERIOR;case U.DIFFERENCE:return o===E.INTERIOR&&s!==E.INTERIOR;case U.SYMDIFFERENCE:return o===E.INTERIOR&&s!==E.INTERIOR||o!==E.INTERIOR&&s===E.INTERIOR}return!1}};U.INTERSECTION=1;U.UNION=2;U.DIFFERENCE=3;U.SYMDIFFERENCE=4;var ur=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new Ke,this._seg=new k;var n=arguments[0],t=arguments[1];this._g=n,this._boundaryDistanceTolerance=t,this._linework=this.extractLinework(n)};ur.prototype.isWithinToleranceOfBoundary=function(n){for(var t=this,e=0;e<this._linework.getNumGeometries();e++)for(var r=t._linework.getGeometryN(e),o=r.getCoordinateSequence(),s=0;s<o.size()-1;s++){o.getCoordinate(s,t._seg.p0),o.getCoordinate(s+1,t._seg.p1);var l=t._seg.distance(n);if(l<=t._boundaryDistanceTolerance)return!0}return!1};ur.prototype.getLocation=function(n){return this.isWithinToleranceOfBoundary(n)?E.BOUNDARY:this._ptLocator.locate(n,this._g)};ur.prototype.extractLinework=function(n){var t=new Gi;n.apply(t);var e=t.getLinework(),r=H.toLineStringArray(e);return n.getFactory().createMultiLineString(r)};ur.prototype.interfaces_=function(){return[]};ur.prototype.getClass=function(){return ur};var Gi=function(){this._linework=null,this._linework=new O};Gi.prototype.getLinework=function(){return this._linework};Gi.prototype.filter=function(n){var t=this;if(n instanceof Ot){var e=n;this._linework.add(e.getExteriorRing());for(var r=0;r<e.getNumInteriorRing();r++)t._linework.add(e.getInteriorRingN(r))}};Gi.prototype.interfaces_=function(){return[cn]};Gi.prototype.getClass=function(){return Gi};var Vr=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var n=arguments[0];this._g=n};Vr.prototype.extractPoints=function(n,t,e){for(var r=this,o=n.getCoordinates(),s=0;s<o.length-1;s++)r.computeOffsetPoints(o[s],o[s+1],t,e)};Vr.prototype.setSidesToGenerate=function(n,t){this._doLeft=n,this._doRight=t};Vr.prototype.getPoints=function(n){for(var t=this,e=new O,r=Vt.getLines(this._g),o=r.iterator();o.hasNext();){var s=o.next();t.extractPoints(s,n,e)}return e};Vr.prototype.computeOffsetPoints=function(n,t,e,r){var o=t.x-n.x,s=t.y-n.y,l=Math.sqrt(o*o+s*s),a=e*o/l,h=e*s/l,y=(t.x+n.x)/2,C=(t.y+n.y)/2;if(this._doLeft){var L=new d(y-h,C+a);r.add(L)}if(this._doRight){var Y=new d(y+h,C-a);r.add(Y)}};Vr.prototype.interfaces_=function(){return[]};Vr.prototype.getClass=function(){return Vr};var Re=function n(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=n.TOLERANCE,this._testCoords=new O;var t=arguments[0],e=arguments[1],r=arguments[2];this._boundaryDistanceTolerance=n.computeBoundaryDistanceTolerance(t,e),this._geom=[t,e,r],this._locFinder=[new ur(this._geom[0],this._boundaryDistanceTolerance),new ur(this._geom[1],this._boundaryDistanceTolerance),new ur(this._geom[2],this._boundaryDistanceTolerance)]},Vu={TOLERANCE:{configurable:!0}};Re.prototype.reportResult=function(n,t,e){qt.out.println("Overlay result invalid - A:"+E.toLocationSymbol(t[0])+" B:"+E.toLocationSymbol(t[1])+" expected:"+(e?"i":"e")+" actual:"+E.toLocationSymbol(t[2]))};Re.prototype.isValid=function(n){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var t=this.checkValid(n);return t};Re.prototype.checkValid=function(){var n=this;if(arguments.length===1){for(var t=arguments[0],e=0;e<this._testCoords.size();e++){var r=n._testCoords.get(e);if(!n.checkValid(t,r))return n._invalidLocation=r,!1}return!0}else if(arguments.length===2){var o=arguments[0],s=arguments[1];return this._location[0]=this._locFinder[0].getLocation(s),this._location[1]=this._locFinder[1].getLocation(s),this._location[2]=this._locFinder[2].getLocation(s),Re.hasLocation(this._location,E.BOUNDARY)?!0:this.isValidResult(o,this._location)}};Re.prototype.addTestPts=function(n){var t=new Vr(n);this._testCoords.addAll(t.getPoints(5*this._boundaryDistanceTolerance))};Re.prototype.isValidResult=function(n,t){var e=U.isResultOfOp(t[0],t[1],n),r=t[2]===E.INTERIOR,o=!(e^r);return o||this.reportResult(n,t,e),o};Re.prototype.getInvalidLocation=function(){return this._invalidLocation};Re.prototype.interfaces_=function(){return[]};Re.prototype.getClass=function(){return Re};Re.hasLocation=function(n,t){for(var e=0;e<3;e++)if(n[e]===t)return!0;return!1};Re.computeBoundaryDistanceTolerance=function(n,t){return Math.min(Et.computeSizeBasedSnapTolerance(n),Et.computeSizeBasedSnapTolerance(t))};Re.isValid=function(n,t,e,r){var o=new Re(n,t,r);return o.isValid(e)};Vu.TOLERANCE.get=function(){return 1e-6};Object.defineProperties(Re,Vu);var Ne=function n(t){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=n.extractFactory(t),this._inputGeoms=t};Ne.prototype.extractElements=function(n,t){var e=this;if(n===null)return null;for(var r=0;r<n.getNumGeometries();r++){var o=n.getGeometryN(r);e._skipEmpty&&o.isEmpty()||t.add(o)}};Ne.prototype.combine=function(){for(var n=this,t=new O,e=this._inputGeoms.iterator();e.hasNext();){var r=e.next();n.extractElements(r,t)}return t.size()===0?this._geomFactory!==null?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(t)};Ne.prototype.interfaces_=function(){return[]};Ne.prototype.getClass=function(){return Ne};Ne.combine=function(){if(arguments.length===1){var n=arguments[0],t=new Ne(n);return t.combine()}else if(arguments.length===2){var e=arguments[0],r=arguments[1],o=new Ne(Ne.createList(e,r));return o.combine()}else if(arguments.length===3){var s=arguments[0],l=arguments[1],a=arguments[2],h=new Ne(Ne.createList(s,l,a));return h.combine()}};Ne.extractFactory=function(n){return n.isEmpty()?null:n.iterator().next().getFactory()};Ne.createList=function(){if(arguments.length===2){var n=arguments[0],t=arguments[1],e=new O;return e.add(n),e.add(t),e}else if(arguments.length===3){var r=arguments[0],o=arguments[1],s=arguments[2],l=new O;return l.add(r),l.add(o),l.add(s),l}};var St=function(){this._inputPolys=null,this._geomFactory=null;var n=arguments[0];this._inputPolys=n,this._inputPolys===null&&(this._inputPolys=new O)},zu={STRTREE_NODE_CAPACITY:{configurable:!0}};St.prototype.reduceToGeometries=function(n){for(var t=this,e=new O,r=n.iterator();r.hasNext();){var o=r.next(),s=null;V(o,qe)?s=t.unionTree(o):o instanceof G&&(s=o),e.add(s)}return e};St.prototype.extractByEnvelope=function(n,t,e){for(var r=new O,o=0;o<t.getNumGeometries();o++){var s=t.getGeometryN(o);s.getEnvelopeInternal().intersects(n)?r.add(s):e.add(s)}return this._geomFactory.buildGeometry(r)};St.prototype.unionOptimized=function(n,t){var e=n.getEnvelopeInternal(),r=t.getEnvelopeInternal();if(!e.intersects(r)){var o=Ne.combine(n,t);return o}if(n.getNumGeometries()<=1&&t.getNumGeometries()<=1)return this.unionActual(n,t);var s=e.intersection(r);return this.unionUsingEnvelopeIntersection(n,t,s)};St.prototype.union=function(){if(this._inputPolys===null)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var n=new wu(St.STRTREE_NODE_CAPACITY),t=this._inputPolys.iterator();t.hasNext();){var e=t.next();n.insert(e.getEnvelopeInternal(),e)}this._inputPolys=null;var r=n.itemsTree(),o=this.unionTree(r);return o};St.prototype.binaryUnion=function(){if(arguments.length===1){var n=arguments[0];return this.binaryUnion(n,0,n.size())}else if(arguments.length===3){var t=arguments[0],e=arguments[1],r=arguments[2];if(r-e<=1){var o=St.getGeometry(t,e);return this.unionSafe(o,null)}else{if(r-e===2)return this.unionSafe(St.getGeometry(t,e),St.getGeometry(t,e+1));var s=Math.trunc((r+e)/2),l=this.binaryUnion(t,e,s),a=this.binaryUnion(t,s,r);return this.unionSafe(l,a)}}};St.prototype.repeatedUnion=function(n){for(var t=null,e=n.iterator();e.hasNext();){var r=e.next();t===null?t=r.copy():t=t.union(r)}return t};St.prototype.unionSafe=function(n,t){return n===null&&t===null?null:n===null?t.copy():t===null?n.copy():this.unionOptimized(n,t)};St.prototype.unionActual=function(n,t){return St.restrictToPolygons(n.union(t))};St.prototype.unionTree=function(n){var t=this.reduceToGeometries(n),e=this.binaryUnion(t);return e};St.prototype.unionUsingEnvelopeIntersection=function(n,t,e){var r=new O,o=this.extractByEnvelope(e,n,r),s=this.extractByEnvelope(e,t,r),l=this.unionActual(o,s);r.add(l);var a=Ne.combine(r);return a};St.prototype.bufferUnion=function(){if(arguments.length===1){var n=arguments[0],t=n.get(0).getFactory(),e=t.buildGeometry(n),r=e.buffer(0);return r}else if(arguments.length===2){var o=arguments[0],s=arguments[1],l=o.getFactory(),a=l.createGeometryCollection([o,s]),h=a.buffer(0);return h}};St.prototype.interfaces_=function(){return[]};St.prototype.getClass=function(){return St};St.restrictToPolygons=function(n){if(V(n,fr))return n;var t=jn.getPolygons(n);return t.size()===1?t.get(0):n.getFactory().createMultiPolygon(H.toPolygonArray(t))};St.getGeometry=function(n,t){return t>=n.size()?null:n.get(t)};St.union=function(n){var t=new St(n);return t.union()};zu.STRTREE_NODE_CAPACITY.get=function(){return 4};Object.defineProperties(St,zu);var Wo=function(){};Wo.prototype.interfaces_=function(){return[]};Wo.prototype.getClass=function(){return Wo};Wo.union=function(n,t){if(n.isEmpty()||t.isEmpty()){if(n.isEmpty()&&t.isEmpty())return U.createEmptyResult(U.UNION,n,t,n.getFactory());if(n.isEmpty())return t.copy();if(t.isEmpty())return n.copy()}return n.checkNotGeometryCollection(n),n.checkNotGeometryCollection(t),ae.overlayOp(n,t,U.UNION)};function Yr(){return new Ho}function Ho(){this.reset()}Ho.prototype={constructor:Ho,reset:function(){this.s=this.t=0},add:function(n){Fa(Po,n,this.t),Fa(this,Po.s,this.s),this.s?this.t+=Po.t:this.s=Po.t},valueOf:function(){return this.s}};var Po=new Ho;function Fa(n,t,e){var r=n.s=t+e,o=r-t,s=r-o;n.t=t-s+(e-o)}var vt=1e-6,it=Math.PI,Hn=it/2,Ba=it/4,er=it*2,xr=180/it,tn=it/180,ne=Math.abs,lf=Math.atan,Vi=Math.atan2,bt=Math.cos,Pt=Math.sin,Hi=Math.sqrt;function Uu(n){return n>1?0:n<-1?it:Math.acos(n)}function ui(n){return n>1?Hn:n<-1?-Hn:Math.asin(n)}function Qi(){}function jo(n,t){n&&Ga.hasOwnProperty(n.type)&&Ga[n.type](n,t)}var ka={Feature:function(n,t){jo(n.geometry,t)},FeatureCollection:function(n,t){for(var e=n.features,r=-1,o=e.length;++r<o;)jo(e[r].geometry,t)}},Ga={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var e=n.coordinates,r=-1,o=e.length;++r<o;)n=e[r],t.point(n[0],n[1],n[2])},LineString:function(n,t){Fs(n.coordinates,t,0)},MultiLineString:function(n,t){for(var e=n.coordinates,r=-1,o=e.length;++r<o;)Fs(e[r],t,0)},Polygon:function(n,t){Va(n.coordinates,t)},MultiPolygon:function(n,t){for(var e=n.coordinates,r=-1,o=e.length;++r<o;)Va(e[r],t)},GeometryCollection:function(n,t){for(var e=n.geometries,r=-1,o=e.length;++r<o;)jo(e[r],t)}};function Fs(n,t,e){var r=-1,o=n.length-e,s;for(t.lineStart();++r<o;)s=n[r],t.point(s[0],s[1],s[2]);t.lineEnd()}function Va(n,t){var e=-1,r=n.length;for(t.polygonStart();++e<r;)Fs(n[e],t,1);t.polygonEnd()}function cf(n,t){n&&ka.hasOwnProperty(n.type)?ka[n.type](n,t):jo(n,t)}Yr();Yr();function Bs(n){return[Vi(n[1],n[0]),ui(n[2])]}function zi(n){var t=n[0],e=n[1],r=bt(e);return[r*bt(t),r*Pt(t),Pt(e)]}function Ro(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function Ko(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function Cs(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function Oo(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function ks(n){var t=Hi(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}Yr();function qu(n,t){function e(r,o){return r=n(r,o),t(r[0],r[1])}return n.invert&&t.invert&&(e.invert=function(r,o){return r=t.invert(r,o),r&&n.invert(r[0],r[1])}),e}function Gs(n,t){return[n>it?n-er:n<-it?n+er:n,t]}Gs.invert=Gs;function ff(n,t,e){return(n%=er)?t||e?qu(Ua(n),qa(t,e)):Ua(n):t||e?qa(t,e):Gs}function za(n){return function(t,e){return t+=n,[t>it?t-er:t<-it?t+er:t,e]}}function Ua(n){var t=za(n);return t.invert=za(-n),t}function qa(n,t){var e=bt(n),r=Pt(n),o=bt(t),s=Pt(t);function l(a,h){var y=bt(h),C=bt(a)*y,L=Pt(a)*y,Y=Pt(h),ze=Y*e+C*r;return[Vi(L*o-ze*s,C*e-Y*r),ui(ze*o+L*s)]}return l.invert=function(a,h){var y=bt(h),C=bt(a)*y,L=Pt(a)*y,Y=Pt(h),ze=Y*o-L*s;return[Vi(L*o+Y*s,C*e+ze*r),ui(ze*e-C*r)]},l}function hf(n,t,e,r,o,s){if(e){var l=bt(t),a=Pt(t),h=r*e;o==null?(o=t+r*er,s=t-h/2):(o=Xa(l,o),s=Xa(l,s),(r>0?o<s:o>s)&&(o+=r*er));for(var y,C=o;r>0?C>s:C<s;C-=h)y=Bs([l,-a*bt(C),-a*Pt(C)]),n.point(y[0],y[1])}}function Xa(n,t){t=zi(t),t[0]-=n,ks(t);var e=Uu(-t[1]);return((-t[2]<0?-e:e)+er-vt)%er}function Xu(){var n=[],t;return{point:function(e,r){t.push([e,r])},lineStart:function(){n.push(t=[])},lineEnd:Qi,rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))},result:function(){var e=n;return n=[],t=null,e}}}function gf(n,t,e,r,o,s){var l=n[0],a=n[1],h=t[0],y=t[1],C=0,L=1,Y=h-l,ze=y-a,Bt;if(Bt=e-l,!(!Y&&Bt>0)){if(Bt/=Y,Y<0){if(Bt<C)return;Bt<L&&(L=Bt)}else if(Y>0){if(Bt>L)return;Bt>C&&(C=Bt)}if(Bt=o-l,!(!Y&&Bt<0)){if(Bt/=Y,Y<0){if(Bt>L)return;Bt>C&&(C=Bt)}else if(Y>0){if(Bt<C)return;Bt<L&&(L=Bt)}if(Bt=r-a,!(!ze&&Bt>0)){if(Bt/=ze,ze<0){if(Bt<C)return;Bt<L&&(L=Bt)}else if(ze>0){if(Bt>L)return;Bt>C&&(C=Bt)}if(Bt=s-a,!(!ze&&Bt<0)){if(Bt/=ze,ze<0){if(Bt>L)return;Bt>C&&(C=Bt)}else if(ze>0){if(Bt<C)return;Bt<L&&(L=Bt)}return C>0&&(n[0]=l+C*Y,n[1]=a+C*ze),L<1&&(t[0]=l+L*Y,t[1]=a+L*ze),!0}}}}}function Bo(n,t){return ne(n[0]-t[0])<vt&&ne(n[1]-t[1])<vt}function To(n,t,e,r){this.x=n,this.z=t,this.o=e,this.e=r,this.v=!1,this.n=this.p=null}function Yu(n,t,e,r,o){var s=[],l=[],a,h;if(n.forEach(function(Bt){if(!((Ir=Bt.length-1)<=0)){var Ir,Wr=Bt[0],yi=Bt[Ir],Bn;if(Bo(Wr,yi)){for(o.lineStart(),a=0;a<Ir;++a)o.point((Wr=Bt[a])[0],Wr[1]);o.lineEnd();return}s.push(Bn=new To(Wr,Bt,null,!0)),l.push(Bn.o=new To(Wr,null,Bn,!1)),s.push(Bn=new To(yi,Bt,null,!1)),l.push(Bn.o=new To(yi,null,Bn,!0))}}),!!s.length){for(l.sort(t),Ya(s),Ya(l),a=0,h=l.length;a<h;++a)l[a].e=e=!e;for(var y=s[0],C,L;;){for(var Y=y,ze=!0;Y.v;)if((Y=Y.n)===y)return;C=Y.z,o.lineStart();do{if(Y.v=Y.o.v=!0,Y.e){if(ze)for(a=0,h=C.length;a<h;++a)o.point((L=C[a])[0],L[1]);else r(Y.x,Y.n.x,1,o);Y=Y.n}else{if(ze)for(C=Y.p.z,a=C.length-1;a>=0;--a)o.point((L=C[a])[0],L[1]);else r(Y.x,Y.p.x,-1,o);Y=Y.p}Y=Y.o,C=Y.z,ze=!ze}while(!Y.v);o.lineEnd()}}}function Ya(n){if(t=n.length){for(var t,e=0,r=n[0],o;++e<t;)r.n=o=n[e],o.p=r,r=o;r.n=o=n[0],o.p=r}}function Wu(n,t){return n<t?-1:n>t?1:n>=t?0:NaN}function pf(n){return n.length===1&&(n=df(n)),{left:function(t,e,r,o){for(r==null&&(r=0),o==null&&(o=t.length);r<o;){var s=r+o>>>1;n(t[s],e)<0?r=s+1:o=s}return r},right:function(t,e,r,o){for(r==null&&(r=0),o==null&&(o=t.length);r<o;){var s=r+o>>>1;n(t[s],e)>0?o=s:r=s+1}return r}}}function df(n){return function(t,e){return Wu(n(t),e)}}pf(Wu);function Hu(n){for(var t=n.length,e,r=-1,o=0,s,l;++r<t;)o+=n[r].length;for(s=new Array(o);--t>=0;)for(l=n[t],e=l.length;--e>=0;)s[--o]=l[e];return s}var Zi=1e9,Do=-Zi;function vf(n,t,e,r){function o(y,C){return n<=y&&y<=e&&t<=C&&C<=r}function s(y,C,L,Y){var ze=0,Bt=0;if(y==null||(ze=l(y,L))!==(Bt=l(C,L))||h(y,C)<0^L>0)do Y.point(ze===0||ze===3?n:e,ze>1?r:t);while((ze=(ze+L+4)%4)!==Bt);else Y.point(C[0],C[1])}function l(y,C){return ne(y[0]-n)<vt?C>0?0:3:ne(y[0]-e)<vt?C>0?2:1:ne(y[1]-t)<vt?C>0?1:0:C>0?3:2}function a(y,C){return h(y.x,C.x)}function h(y,C){var L=l(y,1),Y=l(C,1);return L!==Y?L-Y:L===0?C[1]-y[1]:L===1?y[0]-C[0]:L===2?y[1]-C[1]:C[0]-y[0]}return function(y){var C=y,L=Xu(),Y,ze,Bt,Ir,Wr,yi,Bn,vi,wo,ia,gl,ml={point:il,lineStart:rh,lineEnd:wh,polygonStart:ol,polygonEnd:_l};function il(Mh,vp){o(Mh,vp)&&C.point(Mh,vp)}function sl(){for(var Mh=0,vp=0,gp=ze.length;vp<gp;++vp)for(var Jh=ze[vp],Lp=1,Ip=Jh.length,$p=Jh[0],Xp,Cp,Gp=$p[0],Rp=$p[1];Lp<Ip;++Lp)Xp=Gp,Cp=Rp,$p=Jh[Lp],Gp=$p[0],Rp=$p[1],Cp<=r?Rp>r&&(Gp-Xp)*(r-Cp)>(Rp-Cp)*(n-Xp)&&++Mh:Rp<=r&&(Gp-Xp)*(r-Cp)<(Rp-Cp)*(n-Xp)&&--Mh;return Mh}function ol(){C=L,Y=[],ze=[],gl=!0}function _l(){var Mh=sl(),vp=gl&&Mh,gp=(Y=Hu(Y)).length;(vp||gp)&&(y.polygonStart(),vp&&(y.lineStart(),s(null,null,1,y),y.lineEnd()),gp&&Yu(Y,a,Mh,s,y),y.polygonEnd()),C=y,Y=ze=Bt=null}function rh(){ml.point=Fh,ze&&ze.push(Bt=[]),ia=!0,wo=!1,Bn=vi=NaN}function wh(){Y&&(Fh(Ir,Wr),yi&&wo&&L.rejoin(),Y.push(L.result())),ml.point=il,wo&&C.lineEnd()}function Fh(Mh,vp){var gp=o(Mh,vp);if(ze&&Bt.push([Mh,vp]),ia)Ir=Mh,Wr=vp,yi=gp,ia=!1,gp&&(C.lineStart(),C.point(Mh,vp));else if(gp&&wo)C.point(Mh,vp);else{var Jh=[Bn=Math.max(Do,Math.min(Zi,Bn)),vi=Math.max(Do,Math.min(Zi,vi))],Lp=[Mh=Math.max(Do,Math.min(Zi,Mh)),vp=Math.max(Do,Math.min(Zi,vp))];gf(Jh,Lp,n,t,e,r)?(wo||(C.lineStart(),C.point(Jh[0],Jh[1])),C.point(Lp[0],Lp[1]),gp||C.lineEnd(),gl=!1):gp&&(C.lineStart(),C.point(Mh,vp),gl=!1)}Bn=Mh,vi=vp,wo=gp}return ml}}var Ns=Yr();function yf(n,t){var e=t[0],r=t[1],o=[Pt(e),-bt(e),0],s=0,l=0;Ns.reset();for(var a=0,h=n.length;a<h;++a)if(C=(y=n[a]).length)for(var y,C,L=y[C-1],Y=L[0],ze=L[1]/2+Ba,Bt=Pt(ze),Ir=bt(ze),Wr=0;Wr<C;++Wr,Y=Bn,Bt=wo,Ir=ia,L=yi){var yi=y[Wr],Bn=yi[0],vi=yi[1]/2+Ba,wo=Pt(vi),ia=bt(vi),gl=Bn-Y,ml=gl>=0?1:-1,il=ml*gl,sl=il>it,ol=Bt*wo;if(Ns.add(Vi(ol*ml*Pt(il),Ir*ia+ol*bt(il))),s+=sl?gl+ml*er:gl,sl^Y>=e^Bn>=e){var _l=Ko(zi(L),zi(yi));ks(_l);var rh=Ko(o,_l);ks(rh);var wh=(sl^gl>=0?-1:1)*ui(rh[2]);(r>wh||r===wh&&(_l[0]||_l[1]))&&(l+=sl^gl>=0?1:-1)}}return(s<-vt||s<vt&&Ns<-vt)^l&1}Yr();function Wa(n){return n}Yr();Yr();var Ui=1/0,Qo=Ui,yo=-Ui,Zo=yo,Ha={point:mf,lineStart:Qi,lineEnd:Qi,polygonStart:Qi,polygonEnd:Qi,result:function(){var n=[[Ui,Qo],[yo,Zo]];return yo=Zo=-(Qo=Ui=1/0),n}};function mf(n,t){n<Ui&&(Ui=n),n>yo&&(yo=n),t<Qo&&(Qo=t),t>Zo&&(Zo=t)}Yr();function ju(n,t,e,r){return function(o,s){var l=t(s),a=o.invert(r[0],r[1]),h=Xu(),y=t(h),C=!1,L,Y,ze,Bt={point:Ir,lineStart:yi,lineEnd:Bn,polygonStart:function(){Bt.point=vi,Bt.lineStart=wo,Bt.lineEnd=ia,Y=[],L=[]},polygonEnd:function(){Bt.point=Ir,Bt.lineStart=yi,Bt.lineEnd=Bn,Y=Hu(Y);var gl=yf(L,a);Y.length?(C||(s.polygonStart(),C=!0),Yu(Y,Ef,gl,e,s)):gl&&(C||(s.polygonStart(),C=!0),s.lineStart(),e(null,null,1,s),s.lineEnd()),C&&(s.polygonEnd(),C=!1),Y=L=null},sphere:function(){s.polygonStart(),s.lineStart(),e(null,null,1,s),s.lineEnd(),s.polygonEnd()}};function Ir(gl,ml){var il=o(gl,ml);n(gl=il[0],ml=il[1])&&s.point(gl,ml)}function Wr(gl,ml){var il=o(gl,ml);l.point(il[0],il[1])}function yi(){Bt.point=Wr,l.lineStart()}function Bn(){Bt.point=Ir,l.lineEnd()}function vi(gl,ml){ze.push([gl,ml]);var il=o(gl,ml);y.point(il[0],il[1])}function wo(){y.lineStart(),ze=[]}function ia(){vi(ze[0][0],ze[0][1]),y.lineEnd();var gl=y.clean(),ml=h.result(),il,sl=ml.length,ol,_l,rh;if(ze.pop(),L.push(ze),ze=null,!!sl){if(gl&1){if(_l=ml[0],(ol=_l.length-1)>0){for(C||(s.polygonStart(),C=!0),s.lineStart(),il=0;il<ol;++il)s.point((rh=_l[il])[0],rh[1]);s.lineEnd()}return}sl>1&&gl&2&&ml.push(ml.pop().concat(ml.shift())),Y.push(ml.filter(_f))}}return Bt}}function _f(n){return n.length>1}function Ef(n,t){return((n=n.x)[0]<0?n[1]-Hn-vt:Hn-n[1])-((t=t.x)[0]<0?t[1]-Hn-vt:Hn-t[1])}const ja=ju(function(){return!0},If,Nf,[-it,-Hn]);function If(n){var t=NaN,e=NaN,r=NaN,o;return{lineStart:function(){n.lineStart(),o=1},point:function(s,l){var a=s>0?it:-it,h=ne(s-t);ne(h-it)<vt?(n.point(t,e=(e+l)/2>0?Hn:-Hn),n.point(r,e),n.lineEnd(),n.lineStart(),n.point(a,e),n.point(s,e),o=0):r!==a&&h>=it&&(ne(t-r)<vt&&(t-=r*vt),ne(s-a)<vt&&(s-=a*vt),e=Cf(t,e,s,l),n.point(r,e),n.lineEnd(),n.lineStart(),n.point(a,e),o=0),n.point(t=s,e=l),r=a},lineEnd:function(){n.lineEnd(),t=e=NaN},clean:function(){return 2-o}}}function Cf(n,t,e,r){var o,s,l=Pt(n-e);return ne(l)>vt?lf((Pt(t)*(s=bt(r))*Pt(e)-Pt(r)*(o=bt(t))*Pt(n))/(o*s*l)):(t+r)/2}function Nf(n,t,e,r){var o;if(n==null)o=e*Hn,r.point(-it,o),r.point(0,o),r.point(it,o),r.point(it,0),r.point(it,-o),r.point(0,-o),r.point(-it,-o),r.point(-it,0),r.point(-it,o);else if(ne(n[0]-t[0])>vt){var s=n[0]<t[0]?it:-it;o=e*s/2,r.point(-s,o),r.point(0,o),r.point(s,o)}else r.point(t[0],t[1])}function xf(n,t){var e=bt(n),r=e>0,o=ne(e)>vt;function s(C,L,Y,ze){hf(ze,n,t,Y,C,L)}function l(C,L){return bt(C)*bt(L)>e}function a(C){var L,Y,ze,Bt,Ir;return{lineStart:function(){Bt=ze=!1,Ir=1},point:function(Wr,yi){var Bn=[Wr,yi],vi,wo=l(Wr,yi),ia=r?wo?0:y(Wr,yi):wo?y(Wr+(Wr<0?it:-it),yi):0;if(!L&&(Bt=ze=wo)&&C.lineStart(),wo!==ze&&(vi=h(L,Bn),(!vi||Bo(L,vi)||Bo(Bn,vi))&&(Bn[0]+=vt,Bn[1]+=vt,wo=l(Bn[0],Bn[1]))),wo!==ze)Ir=0,wo?(C.lineStart(),vi=h(Bn,L),C.point(vi[0],vi[1])):(vi=h(L,Bn),C.point(vi[0],vi[1]),C.lineEnd()),L=vi;else if(o&&L&&r^wo){var gl;!(ia&Y)&&(gl=h(Bn,L,!0))&&(Ir=0,r?(C.lineStart(),C.point(gl[0][0],gl[0][1]),C.point(gl[1][0],gl[1][1]),C.lineEnd()):(C.point(gl[1][0],gl[1][1]),C.lineEnd(),C.lineStart(),C.point(gl[0][0],gl[0][1])))}wo&&(!L||!Bo(L,Bn))&&C.point(Bn[0],Bn[1]),L=Bn,ze=wo,Y=ia},lineEnd:function(){ze&&C.lineEnd(),L=null},clean:function(){return Ir|(Bt&&ze)<<1}}}function h(C,L,Y){var ze=zi(C),Bt=zi(L),Ir=[1,0,0],Wr=Ko(ze,Bt),yi=Ro(Wr,Wr),Bn=Wr[0],vi=yi-Bn*Bn;if(!vi)return!Y&&C;var wo=e*yi/vi,ia=-e*Bn/vi,gl=Ko(Ir,Wr),ml=Oo(Ir,wo),il=Oo(Wr,ia);Cs(ml,il);var sl=gl,ol=Ro(ml,sl),_l=Ro(sl,sl),rh=ol*ol-_l*(Ro(ml,ml)-1);if(!(rh<0)){var wh=Hi(rh),Fh=Oo(sl,(-ol-wh)/_l);if(Cs(Fh,ml),Fh=Bs(Fh),!Y)return Fh;var Mh=C[0],vp=L[0],gp=C[1],Jh=L[1],Lp;vp<Mh&&(Lp=Mh,Mh=vp,vp=Lp);var Ip=vp-Mh,$p=ne(Ip-it)<vt,Xp=$p||Ip<vt;if(!$p&&Jh<gp&&(Lp=gp,gp=Jh,Jh=Lp),Xp?$p?gp+Jh>0^Fh[1]<(ne(Fh[0]-Mh)<vt?gp:Jh):gp<=Fh[1]&&Fh[1]<=Jh:Ip>it^(Mh<=Fh[0]&&Fh[0]<=vp)){var Cp=Oo(sl,(-ol+wh)/_l);return Cs(Cp,ml),[Fh,Bs(Cp)]}}}function y(C,L){var Y=r?n:it-n,ze=0;return C<-Y?ze|=1:C>Y&&(ze|=2),L<-Y?ze|=4:L>Y&&(ze|=8),ze}return ju(l,a,s,r?[0,-n]:[-it,n-it])}function Ku(n){return function(t){var e=new Vs;for(var r in n)e[r]=n[r];return e.stream=t,e}}function Vs(){}Vs.prototype={constructor:Vs,point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Qu(n,t,e){var r=t[1][0]-t[0][0],o=t[1][1]-t[0][1],s=n.clipExtent&&n.clipExtent();n.scale(150).translate([0,0]),s!=null&&n.clipExtent(null),cf(e,n.stream(Ha));var l=Ha.result(),a=Math.min(r/(l[1][0]-l[0][0]),o/(l[1][1]-l[0][1])),h=+t[0][0]+(r-a*(l[1][0]+l[0][0]))/2,y=+t[0][1]+(o-a*(l[1][1]+l[0][1]))/2;return s!=null&&n.clipExtent(s),n.scale(a*150).translate([h,y])}function Sf(n,t,e){return Qu(n,[[0,0],t],e)}var Ka=16,wf=bt(30*tn);function Qa(n,t){return+t?bf(n,t):Lf(n)}function Lf(n){return Ku({point:function(t,e){t=n(t,e),this.stream.point(t[0],t[1])}})}function bf(n,t){function e(r,o,s,l,a,h,y,C,L,Y,ze,Bt,Ir,Wr){var yi=y-r,Bn=C-o,vi=yi*yi+Bn*Bn;if(vi>4*t&&Ir--){var wo=l+Y,ia=a+ze,gl=h+Bt,ml=Hi(wo*wo+ia*ia+gl*gl),il=ui(gl/=ml),sl=ne(ne(gl)-1)<vt||ne(s-L)<vt?(s+L)/2:Vi(ia,wo),ol=n(sl,il),_l=ol[0],rh=ol[1],wh=_l-r,Fh=rh-o,Mh=Bn*wh-yi*Fh;(Mh*Mh/vi>t||ne((yi*wh+Bn*Fh)/vi-.5)>.3||l*Y+a*ze+h*Bt<wf)&&(e(r,o,s,l,a,h,_l,rh,sl,wo/=ml,ia/=ml,gl,Ir,Wr),Wr.point(_l,rh),e(_l,rh,sl,wo,ia,gl,y,C,L,Y,ze,Bt,Ir,Wr))}}return function(r){var o,s,l,a,h,y,C,L,Y,ze,Bt,Ir,Wr={point:yi,lineStart:Bn,lineEnd:wo,polygonStart:function(){r.polygonStart(),Wr.lineStart=ia},polygonEnd:function(){r.polygonEnd(),Wr.lineStart=Bn}};function yi(il,sl){il=n(il,sl),r.point(il[0],il[1])}function Bn(){L=NaN,Wr.point=vi,r.lineStart()}function vi(il,sl){var ol=zi([il,sl]),_l=n(il,sl);e(L,Y,C,ze,Bt,Ir,L=_l[0],Y=_l[1],C=il,ze=ol[0],Bt=ol[1],Ir=ol[2],Ka,r),r.point(L,Y)}function wo(){Wr.point=yi,r.lineEnd()}function ia(){Bn(),Wr.point=gl,Wr.lineEnd=ml}function gl(il,sl){vi(o=il,sl),s=L,l=Y,a=ze,h=Bt,y=Ir,Wr.point=vi}function ml(){e(L,Y,C,ze,Bt,Ir,s,l,o,a,h,y,Ka,r),Wr.lineEnd=wo,wo()}return Wr}}var Pf=Ku({point:function(n,t){this.stream.point(n*tn,t*tn)}});function Rf(n){return Of(function(){return n})()}function Of(n){var t,e=150,r=480,o=250,s,l,a=0,h=0,y=0,C=0,L=0,Y,ze,Bt=null,Ir=ja,Wr=null,yi,Bn,vi,wo=Wa,ia=.5,gl=Qa(_l,ia),ml,il;function sl(Fh){return Fh=ze(Fh[0]*tn,Fh[1]*tn),[Fh[0]*e+s,l-Fh[1]*e]}function ol(Fh){return Fh=ze.invert((Fh[0]-s)/e,(l-Fh[1])/e),Fh&&[Fh[0]*xr,Fh[1]*xr]}function _l(Fh,Mh){return Fh=t(Fh,Mh),[Fh[0]*e+s,l-Fh[1]*e]}sl.stream=function(Fh){return ml&&il===Fh?ml:ml=Pf(Ir(Y,gl(wo(il=Fh))))},sl.clipAngle=function(Fh){return arguments.length?(Ir=+Fh?xf(Bt=Fh*tn,6*tn):(Bt=null,ja),wh()):Bt*xr},sl.clipExtent=function(Fh){return arguments.length?(wo=Fh==null?(Wr=yi=Bn=vi=null,Wa):vf(Wr=+Fh[0][0],yi=+Fh[0][1],Bn=+Fh[1][0],vi=+Fh[1][1]),wh()):Wr==null?null:[[Wr,yi],[Bn,vi]]},sl.scale=function(Fh){return arguments.length?(e=+Fh,rh()):e},sl.translate=function(Fh){return arguments.length?(r=+Fh[0],o=+Fh[1],rh()):[r,o]},sl.center=function(Fh){return arguments.length?(a=Fh[0]%360*tn,h=Fh[1]%360*tn,rh()):[a*xr,h*xr]},sl.rotate=function(Fh){return arguments.length?(y=Fh[0]%360*tn,C=Fh[1]%360*tn,L=Fh.length>2?Fh[2]%360*tn:0,rh()):[y*xr,C*xr,L*xr]},sl.precision=function(Fh){return arguments.length?(gl=Qa(_l,ia=Fh*Fh),wh()):Hi(ia)},sl.fitExtent=function(Fh,Mh){return Qu(sl,Fh,Mh)},sl.fitSize=function(Fh,Mh){return Sf(sl,Fh,Mh)};function rh(){ze=qu(Y=ff(y,C,L),t);var Fh=t(a,h);return s=r-Fh[0]*e,l=o+Fh[1]*e,wh()}function wh(){return ml=il=null,sl}return function(){return t=n.apply(this,arguments),sl.invert=t.invert&&ol,rh()}}function Zu(n){return function(t,e){var r=bt(t),o=bt(e),s=n(r*o);return[s*o*Pt(t),s*Pt(e)]}}function Ju(n){return function(t,e){var r=Hi(t*t+e*e),o=n(r),s=Pt(o),l=bt(o);return[Vi(t*s,r*l),ui(r&&e*s/r)]}}var Tf=Zu(function(n){return Hi(2/(1+n))});Tf.invert=Ju(function(n){return 2*ui(n/2)});var $u=Zu(function(n){return(n=Uu(n))&&n/Pt(n)});$u.invert=Ju(function(n){return n});function Df(){return Rf($u).scale(79.4188).clipAngle(180-.001)}function Za(n,t){return[n,t]}Za.invert=Za;function Mf(n,t,e){e=e||{};var r=e.units||"kilometers",o=e.steps||8;if(!n)throw new Error("geojson is required");if(typeof e!="object")throw new Error("options must be an object");if(typeof o!="number")throw new Error("steps must be an number");if(t===void 0)throw new Error("radius is required");if(o<=0)throw new Error("steps must be greater than 0");var s=[];switch(n.type){case"GeometryCollection":return pu(n,function(l){var a=ko(l,t,r,o);a&&s.push(a)}),Ds(s);case"FeatureCollection":return Oa(n,function(l){var a=ko(l,t,r,o);a&&Oa(a,function(h){h&&s.push(h)})}),Ds(s)}return ko(n,t,r,o)}function ko(n,t,e,r){var o=n.properties||{},s=n.type==="Feature"?n.geometry:n;if(s.type==="GeometryCollection"){var l=[];return pu(n,function(Ir){var Wr=ko(Ir,t,e,r);Wr&&l.push(Wr)}),Ds(l)}var a=Af(s),h={type:s.type,coordinates:el(s.coordinates,a)},y=new Ks,C=y.read(h),L=kc(Gc(t,e),"meters"),Y=zt.bufferOp(C,L,r),ze=new xu;if(Y=ze.write(Y),!tl(Y.coordinates)){var Bt={type:Y.type,coordinates:nl(Y.coordinates,a)};return Jo(Bt,o)}}function tl(n){return Array.isArray(n[0])?tl(n[0]):isNaN(n[0])}function el(n,t){return typeof n[0]!="object"?t(n):n.map(function(e){return el(e,t)})}function nl(n,t){return typeof n[0]!="object"?t.invert(n):n.map(function(e){return nl(e,t)})}function Af(n){var t=Xc(n).geometry.coordinates,e=[-t[0],-t[1]];return Df().rotate(e).scale(Ie)}function Ff(n,t){var e=zo(n),r=zo(t),o=n.properties||{},s=lu.difference(e.coordinates,r.coordinates);return s.length===0?null:s.length===1?fu(s[0],o):hu(s,o)}function Ja(n){let t;for(const e of n)t&&e[0]-t[0]>=180?e[0]-=360:t&&e[0]-t[0]<-180&&(e[0]+=360),t=e}function $a(n,t){const e=Ff({type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]},n);if(!e)return;e.properties={isMask:"y"};const r=Mf(n,0);if(r.geometry.type==="Polygon")for(const o of r.geometry.coordinates)Ja(o);else for(const o of r.geometry.coordinates)for(const s of o)Ja(s);t({type:"FeatureCollection",features:[r,e]})}let tu={type:"FeatureCollection",features:[]};function Bf(n,t,e=!0,r=!0,o={},s={},l={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}}){let a,h,y=[],C,L;function Y(){(l!=null&&l.fill||l!=null&&l.line)&&n.addSource("full-geom",{type:"geojson",data:tu}),l!=null&&l.fill&&n.addLayer({...l==null?void 0:l.fill,id:"full-geom-fill",type:"fill",source:"full-geom"}),l!=null&&l.line&&n.addLayer({...l==null?void 0:l.line,id:"full-geom-line",type:"line",source:"full-geom"})}n.loaded()?Y():n.once("load",()=>{Y()});const ze=Wr=>{a==null||a({type:"mapClick",coordinates:[Wr.lngLat.lng,Wr.lngLat.lat]})},Bt=()=>{let Wr;const yi=n.getZoom()>9?[(Wr=n.getCenter().wrap()).lng,Wr.lat]:void 0;h!==yi&&(h=yi,a==null||a({type:"proximityChange",proximity:yi}))};function Ir(Wr=!1){if(!t)throw new Error;const yi=document.createElement("div");return Wr&&yi.classList.add("marker-interactive"),new qc({props:{displayIn:"maplibre"},target:yi}),new t.Marker({element:yi,offset:[1,-13]})}return{setEventHandler(Wr){Wr?(a=Wr,n.on("moveend",Bt),Bt(),n.on("click",ze)):(n.off("moveend",Bt),a==null||a({type:"proximityChange",proximity:void 0}),a=void 0,n.off("click",ze))},flyTo(Wr,yi){n.flyTo({center:Wr,zoom:yi,...o})},fitBounds(Wr,yi,Bn){n.fitBounds([[Wr[0],Wr[1]],[Wr[2],Wr[3]]],{padding:yi,maxZoom:Bn,...s})},indicateReverse(Wr){n.getCanvasContainer().style.cursor=Wr?"crosshair":""},setReverseMarker(Wr){!t||!e||(L?Wr?L.setLngLat(Wr):(L.remove(),L=void 0):Wr&&(L=(typeof e=="object"?new t.Marker(e):Ir()).setLngLat(Wr).addTo(n),L.getElement().classList.add("marker-reverse")))},setMarkers(Wr,yi){if(!e)return;function Bn(vi){var wo;(wo=n.getSource("full-geom"))==null||wo.setData(vi)}for(const vi of y)vi.remove();if(y.length=0,Bn(tu),!!t){if(yi){let vi=!1;if(yi.geometry.type==="GeometryCollection"){const wo=yi.geometry.geometries.filter(ia=>ia.type==="Polygon"||ia.type==="MultiPolygon");if(wo.length>0){let ia=wo.pop();for(const gl of wo)ia=Vc(ia,gl);$a({...yi,geometry:ia},Bn),vi=!0}else{const ia=yi.geometry.geometries.filter(gl=>gl.type==="LineString"||gl.type==="MultiLineString");ia.length>0&&(Bn({...yi,geometry:{type:"GeometryCollection",geometries:ia}}),vi=!0)}}if(!vi){if(yi.geometry.type==="Polygon"||yi.geometry.type==="MultiPolygon")$a(yi,Bn);else if(yi.geometry.type==="LineString"||yi.geometry.type==="MultiLineString"){Bn(yi);return}}e&&y.push((typeof e=="object"?new t.Marker(e):Ir()).setLngLat(yi.center).addTo(n))}if(r)for(const vi of Wr??[]){if(vi===yi)continue;const wo=(typeof r=="object"?new t.Marker(r):Ir(!0)).setLngLat(vi.center).setPopup(new t.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(vi.place_name.replace(/,.*/,""))).addTo(n),ia=wo.getElement();ia.addEventListener("click",gl=>{gl.stopPropagation(),a==null||a({type:"markerClick",id:vi.id})}),ia.addEventListener("mouseenter",()=>{a==null||a({type:"markerMouseEnter",id:vi.id}),wo.togglePopup()}),ia.addEventListener("mouseleave",()=>{a==null||a({type:"markerMouseLeave",id:vi.id}),wo.togglePopup()}),y.push(wo)}}},setSelectedMarker(Wr){C&&C.getElement().classList.toggle("marker-selected",!1),C=Wr>-1?y[Wr]:void 0,C==null||C.getElement().classList.toggle("marker-selected",!0)}}}var Cn,Kr;class kf extends EventTarget{constructor(t={}){super(),ms(this,Cn,void 0),ms(this,Kr,void 0),Lo(this,Kr,t)}onAdd(t){const e=document.createElement("div");e.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:r,showResultMarkers:o,flyTo:s,fullGeometryStyle:l,...a}=zn(this,Kr),h=typeof s=="boolean"?{}:s,y=this.getExtraProps(t,e),C={mapController:Bf(t,this.getMapLibreGl(),r,o,h,h,l),flyTo:s===void 0?!0:!!s,apiKey:"",...y,...a};if(!C.apiKey)throw new Error("no apiKey provided");Lo(this,Cn,new pc({target:e,props:C}));for(const L of["select","pick","featuresListed","featuresMarked","response","optionsVisibilityChange","reverseToggle","queryChange"])zn(this,Cn).$on(L,Y=>this.dispatchEvent(Y));return e}setOptions(t){var e;Lo(this,Kr,t);const{marker:r,showResultMarkers:o,flyTo:s,fullGeometryStyle:l,...a}=zn(this,Kr);(e=zn(this,Cn))==null||e.$set(a)}setQuery(t,e=!0){var r;(r=zn(this,Cn))==null||r.setQuery(t,e)}setReverseMode(t){var e;(e=zn(this,Cn))==null||e.$set({reverseActive:t})}focus(){var t;(t=zn(this,Cn))==null||t.focus()}blur(){var t;(t=zn(this,Cn))==null||t.blur()}onRemove(){var t;(t=zn(this,Cn))==null||t.$destroy()}}Cn=new WeakMap,Kr=new WeakMap;class zf extends kf{getMapLibreGl(){return Cl}getExtraProps(t,e){const r={};if(!("getSdkConfig"in t&&typeof t.getSdkConfig=="function"))throw new Error("MapTiler SDK not detected");const{primaryLanguage:o,apiKey:s}=t.getSdkConfig();r.apiKey=s;const l=/^([a-z]{2})($|_|-)/.exec(o);return l&&(r.language=l[1]),e.className+=" maptiler-ctrl",r}}const maptilerSdk="",style="";/**
          * @ag-grid-community/all-modules - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue * @version v30.0.6
          * @link https://www.ag-grid.com/
          * @license MIT
          */function makeNull(n){return n==null||n===""?null:n}function exists(n,t){return t===void 0&&(t=!1),n!=null&&(n!==""||t)}function missing(n){return!exists(n)}function missingOrEmpty(n){return n==null||n.length===0}function toStringOrNull(n){return n!=null&&typeof n.toString=="function"?n.toString():null}function attrToNumber(n){if(n!==void 0){if(n===null||n==="")return null;if(typeof n=="number")return isNaN(n)?void 0:n;var t=parseInt(n,10);return isNaN(t)?void 0:t}}function attrToBoolean(n){if(n!==void 0)return n===null||n===""?!1:typeof n=="boolean"?n:/true/i.test(n)}function attrToString(n){if(!(n==null||n===""))return n}function referenceCompare(n,t){return n==null&&t==null?!0:n==null&&t!=null||n!=null&&t==null?!1:n===t}function jsonEquals(n,t){var e=n?JSON.stringify(n):null,r=t?JSON.stringify(t):null;return e===r}function defaultComparator(n,t,e){e===void 0&&(e=!1);var r=n==null,o=t==null;if(n&&n.toNumber&&(n=n.toNumber()),t&&t.toNumber&&(t=t.toNumber()),r&&o)return 0;if(r)return-1;if(o)return 1;function s(l,a){return l>a?1:l<a?-1:0}if(typeof n!="string"||!e)return s(n,t);try{return n.localeCompare(t)}catch{return s(n,t)}}function values(n){if(n instanceof Set||n instanceof Map){var t=[];return n.forEach(function(e){return t.push(e)}),t}return Object.values(n)}var GenericUtils=Object.freeze({__proto__:null,makeNull,exists,missing,missingOrEmpty,toStringOrNull,attrToNumber,attrToBoolean,attrToString,referenceCompare,jsonEquals,defaultComparator,values}),ColumnKeyCreator=function(){function n(){this.existingKeys={}}return n.prototype.addExistingKeys=function(t){for(var e=0;e<t.length;e++)this.existingKeys[t[e]]=!0},n.prototype.getUniqueKey=function(t,e){t=toStringOrNull(t);for(var r=0;;){var o=void 0;if(t?(o=t,r!==0&&(o+="_"+r)):e?(o=e,r!==0&&(o+="_"+r)):o=""+r,!this.existingKeys[o])return this.existingKeys[o]=!0,o;r++}},n}();function iterateObject(n,t){n!=null&&(Array.isArray(n)?n.forEach(function(e,r){return t(""+r,e)}):Object.keys(n).forEach(function(e){return t(e,n[e])}))}function cloneObject(n){for(var t={},e=Object.keys(n),r=0;r<e.length;r++){var o=e[r],s=n[o];t[o]=s}return t}function deepCloneObject(n){return JSON.parse(JSON.stringify(n))}function deepCloneDefinition(n,t){if(n){var e=n,r={};return Object.keys(e).forEach(function(o){if(!(t&&t.indexOf(o)>=0)){var s=e[o],l=isNonNullObject(s)&&s.constructor===Object;l?r[o]=deepCloneDefinition(s):r[o]=s}}),r}}function getProperty(n,t){return n[t]}function setProperty(n,t,e){n[t]=e}function copyPropertiesIfPresent(n,t){for(var e=[],r=2;r<arguments.length;r++)e[r-2]=arguments[r];e.forEach(function(o){return copyPropertyIfPresent(n,t,o)})}function copyPropertyIfPresent(n,t,e,r){var o=getProperty(n,e);o!==void 0&&setProperty(t,e,r?r(o):o)}function getAllKeysInObjects(n){var t={};return n.filter(function(e){return e!=null}).forEach(function(e){Object.keys(e).forEach(function(r){return t[r]=null})}),Object.keys(t)}function getAllValuesInObject(n){if(!n)return[];var t=Object;if(typeof t.values=="function")return t.values(n);var e=[];for(var r in n)n.hasOwnProperty(r)&&n.propertyIsEnumerable(r)&&e.push(n[r]);return e}function mergeDeep(n,t,e,r){e===void 0&&(e=!0),r===void 0&&(r=!1),exists(t)&&iterateObject(t,function(o,s){var l=n[o];if(l!==s){if(r){var a=l==null&&s!=null;if(a){var h=typeof s=="object"&&s.constructor===Object,y=h;y&&(l={},n[o]=l)}}isNonNullObject(s)&&isNonNullObject(l)&&!Array.isArray(l)?mergeDeep(l,s,e,r):(e||s!==void 0)&&(n[o]=s)}})}function missingOrEmptyObject(n){return missing(n)||Object.keys(n).length===0}function get$1(n,t,e){if(n==null)return e;for(var r=t.split("."),o=n;r.length>1;)if(o=o[r.shift()],o==null)return e;var s=o[r[0]];return s??e}function set$1(n,t,e){if(n!=null){var r=t.split("."),o=n;r.forEach(function(s,l){o[s]||(o[s]={}),l<r.length-1&&(o=o[s])}),o[r[r.length-1]]=e}}function getValueUsingField(n,t,e){if(!(!t||!n)){if(!e)return n[t];for(var r=t.split("."),o=n,s=0;s<r.length;s++){if(o==null)return;o=o[r[s]]}return o}}function removeAllReferences(n,t){Object.keys(n).forEach(function(o){var s=n[o];typeof s=="object"&&(n[o]=void 0)});var e=Object.getPrototypeOf(n),r={};Object.keys(e).forEach(function(o){var s=e[o];if(typeof s=="function"){var l=function(){console.warn("AG Grid: "+t+" function "+o+`() cannot be called as the grid has been destroyed.
                     Please don't call grid API functions on destroyed grids - as a matter of fact you shouldn't
                     be keeping the API reference, your application has a memory leak! Remove the API reference
                     when the grid is destroyed.`)};r[o]={value:l,writable:!0}}}),Object.defineProperties(n,r)}function isNonNullObject(n){return typeof n=="object"&&n!==null}var ObjectUtils=Object.freeze({__proto__:null,iterateObject,cloneObject,deepCloneObject,deepCloneDefinition,getProperty,setProperty,copyPropertiesIfPresent,copyPropertyIfPresent,getAllKeysInObjects,getAllValuesInObject,mergeDeep,missingOrEmptyObject,get:get$1,set:set$1,getValueUsingField,removeAllReferences,isNonNullObject}),doOnceFlags={};function doOnce(n,t){doOnceFlags[t]||(n(),doOnceFlags[t]=!0)}function getFunctionName(n){if(n.name)return n.name;var t=/function\s+([^\(]+)/.exec(n.toString());return t&&t.length===2?t[1].trim():null}function isFunction(n){return!!(n&&n.constructor&&n.call&&n.apply)}function executeInAWhile(n){executeAfter(n,400)}var executeNextVMTurnFuncs=[],executeNextVMTurnPending=!1;function executeNextVMTurn(n){executeNextVMTurnFuncs.push(n),!executeNextVMTurnPending&&(executeNextVMTurnPending=!0,window.setTimeout(function(){var t=executeNextVMTurnFuncs.slice();executeNextVMTurnFuncs.length=0,executeNextVMTurnPending=!1,t.forEach(function(e){return e()})},0))}function executeAfter(n,t){t===void 0&&(t=0),n.length>0&&window.setTimeout(function(){return n.forEach(function(e){return e()})},t)}function debounce(n,t){var e;return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];var s=this;window.clearTimeout(e),e=window.setTimeout(function(){n.apply(s,r)},t)}}function throttle(n,t){var e=0;return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];var s=this,l=new Date().getTime();l-e<t||(e=l,n.apply(s,r))}}function waitUntil(n,t,e,r){e===void 0&&(e=100);var o=new Date().getTime(),s=null,l=!1,a=function(){var h=new Date().getTime()-o>e;(n()||h)&&(t(),l=!0,s!=null&&(window.clearInterval(s),s=null),h&&r&&console.warn(r))};a(),l||(s=window.setInterval(a,10))}function compose(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return function(e){return n.reduce(function(r,o){return o(r)},e)}}function callIfPresent(n){n&&n()}var noop=function(){},FunctionUtils=Object.freeze({__proto__:null,doOnce,getFunctionName,isFunction,executeInAWhile,executeNextVMTurn,executeAfter,debounce,throttle,waitUntil,compose,callIfPresent,noop}),ModuleNames;(function(n){n.CommunityCoreModule="@ag-grid-community/core",n.InfiniteRowModelModule="@ag-grid-community/infinite-row-model",n.ClientSideRowModelModule="@ag-grid-community/client-side-row-model",n.CsvExportModule="@ag-grid-community/csv-export",n.EnterpriseCoreModule="@ag-grid-enterprise/core",n.RowGroupingModule="@ag-grid-enterprise/row-grouping",n.ColumnsToolPanelModule="@ag-grid-enterprise/column-tool-panel",n.FiltersToolPanelModule="@ag-grid-enterprise/filter-tool-panel",n.MenuModule="@ag-grid-enterprise/menu",n.SetFilterModule="@ag-grid-enterprise/set-filter",n.MultiFilterModule="@ag-grid-enterprise/multi-filter",n.StatusBarModule="@ag-grid-enterprise/status-bar",n.SideBarModule="@ag-grid-enterprise/side-bar",n.RangeSelectionModule="@ag-grid-enterprise/range-selection",n.MasterDetailModule="@ag-grid-enterprise/master-detail",n.RichSelectModule="@ag-grid-enterprise/rich-select",n.GridChartsModule="@ag-grid-enterprise/charts",n.ViewportRowModelModule="@ag-grid-enterprise/viewport-row-model",n.ServerSideRowModelModule="@ag-grid-enterprise/server-side-row-model",n.ExcelExportModule="@ag-grid-enterprise/excel-export",n.ClipboardModule="@ag-grid-enterprise/clipboard",n.SparklinesModule="@ag-grid-enterprise/sparklines",n.AngularModule="@ag-grid-community/angular",n.ReactModule="@ag-grid-community/react",n.VueModule="@ag-grid-community/vue"})(ModuleNames||(ModuleNames={}));var __read$x=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray$r=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n},ModuleRegistry=function(){function n(){}return n.register=function(t){n.__register(t,!0,void 0)},n.registerModules=function(t){n.__registerModules(t,!0,void 0)},n.__register=function(t,e,r){n.runVersionChecks(t),r!==void 0?(n.areGridScopedModules=!0,n.gridModulesMap[r]===void 0&&(n.gridModulesMap[r]={}),n.gridModulesMap[r][t.moduleName]=t):n.globalModulesMap[t.moduleName]=t,n.setModuleBased(e)},n.__unRegisterGridModules=function(t){delete n.gridModulesMap[t]},n.__registerModules=function(t,e,r){n.setModuleBased(e),t&&t.forEach(function(o){return n.__register(o,e,r)})},n.isValidModuleVersion=function(t){var e=__read$x(t.version.split(".")||[],2),r=e[0],o=e[1],s=__read$x(n.currentModuleVersion.split(".")||[],2),l=s[0],a=s[1];return r===l&&o===a},n.runVersionChecks=function(t){if(n.currentModuleVersion||(n.currentModuleVersion=t.version),t.version?n.isValidModuleVersion(t)||console.error("AG Grid: You are using incompatible versions of AG Grid modules. Major and minor versions should always match across modules. '"+t.moduleName+"' is version "+t.version+" but the other modules are version "+this.currentModuleVersion+". Please update all modules to the same version."):console.error("AG Grid: You are using incompatible versions of AG Grid modules. Major and minor versions should always match across modules. '"+t.moduleName+"' is incompatible. Please update all modules to the same version."),t.validate){var e=t.validate();if(!e.isValid){var r=e;console.error("AG Grid: "+r.message)}}},n.setModuleBased=function(t){n.moduleBased===void 0?n.moduleBased=t:n.moduleBased!==t&&doOnce(function(){console.warn("AG Grid: You are mixing modules (i.e. @ag-grid-community/core) and packages (ag-grid-community) - you can only use one or the other of these mechanisms."),console.warn("Please see https://www.ag-grid.com/javascript-grid/packages-modules/ for more information.")},"ModulePackageCheck")},n.__setIsBundled=function(){n.isBundled=!0},n.__assertRegistered=function(t,e,r){var o;if(this.__isRegistered(t,r))return!0;var s=e+t,l;if(n.isBundled)l="AG Grid: unable to use "+e+` as 'ag-grid-enterprise' has not been loaded. Check you are using the Enterprise bundle:
        
        <script src="https://cdn.jsdelivr.net/npm/ag-grid-enterprise@AG_GRID_VERSION/dist/ag-grid-enterprise.min.js"><\/script>
        
For more info see: https://ag-grid.com/javascript-data-grid/getting-started/#getting-started-with-ag-grid-enterprise`;else if(n.moduleBased||n.moduleBased===void 0){var a=(o=Object.entries(ModuleNames).find(function(h){var y=__read$x(h,2);y[0];var C=y[1];return C===t}))===null||o===void 0?void 0:o[0];l="AG Grid: unable to use "+e+" as the "+a+" is not registered"+(n.areGridScopedModules?" for gridId: "+r:"")+`. Check if you have registered the module:
           
    import { ModuleRegistry } from '@ag-grid-community/core';
    import { `+a+" } from '"+t+`';
    
    ModuleRegistry.registerModules([ `+a+` ]);

For more info see: https://www.ag-grid.com/javascript-grid/modules/`}else l="AG Grid: unable to use "+e+` as package 'ag-grid-enterprise' has not been imported. Check that you have imported the package:
            
    import 'ag-grid-enterprise';
            
For more info see: https://www.ag-grid.com/javascript-grid/packages/`;return doOnce(function(){console.warn(l)},s),!1},n.__isRegistered=function(t,e){var r;return!!n.globalModulesMap[t]||!!(!((r=n.gridModulesMap[e])===null||r===void 0)&&r[t])},n.__getRegisteredModules=function(t){return __spreadArray$r(__spreadArray$r([],__read$x(values(n.globalModulesMap))),__read$x(values(n.gridModulesMap[t]||{})))},n.__getGridRegisteredModules=function(t){var e;return values((e=n.gridModulesMap[t])!==null&&e!==void 0?e:{})||[]},n.__isPackageBased=function(){return!n.moduleBased},n.globalModulesMap={},n.gridModulesMap={},n.areGridScopedModules=!1,n}(),__read$w=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray$q=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n},Context=function(){function n(t,e){if(this.beanWrappers={},this.destroyed=!1,!(!t||!t.beanClasses)){this.contextParams=t,this.logger=e,this.logger.log(">> creating ag-Application Context"),this.createBeans();var r=this.getBeanInstances();this.wireBeans(r),this.logger.log(">> ag-Application Context ready - component is alive")}}return n.prototype.getBeanInstances=function(){return values(this.beanWrappers).map(function(t){return t.beanInstance})},n.prototype.createBean=function(t,e){if(!t)throw Error("Can't wire to bean since it is null");return this.wireBeans([t],e),t},n.prototype.wireBeans=function(t,e){this.autoWireBeans(t),this.methodWireBeans(t),this.callLifeCycleMethods(t,"preConstructMethods"),exists(e)&&t.forEach(e),this.callLifeCycleMethods(t,"postConstructMethods")},n.prototype.createBeans=function(){var t=this;this.contextParams.beanClasses.forEach(this.createBeanWrapper.bind(this)),iterateObject(this.beanWrappers,function(r,o){var s;o.bean.__agBeanMetaData&&o.bean.__agBeanMetaData.autowireMethods&&o.bean.__agBeanMetaData.autowireMethods.agConstructor&&(s=o.bean.__agBeanMetaData.autowireMethods.agConstructor);var l=t.getBeansForParameters(s,o.bean.name),a=new(o.bean.bind.apply(o.bean,__spreadArray$q([null],__read$w(l))));o.beanInstance=a});var e=Object.keys(this.beanWrappers).join(", ");this.logger.log("created beans: "+e)},n.prototype.createBeanWrapper=function(t){var e=t.__agBeanMetaData;if(!e){var r=void 0;t.prototype.constructor?r=getFunctionName(t.prototype.constructor):r=""+t,console.error("Context item "+r+" is not a bean");return}var o={bean:t,beanInstance:null,beanName:e.beanName};this.beanWrappers[e.beanName]=o},n.prototype.autoWireBeans=function(t){var e=this;t.forEach(function(r){e.forEachMetaDataInHierarchy(r,function(o,s){var l=o.agClassAttributes;l&&l.forEach(function(a){var h=e.lookupBeanInstance(s,a.beanName,a.optional);r[a.attributeName]=h})})})},n.prototype.methodWireBeans=function(t){var e=this;t.forEach(function(r){e.forEachMetaDataInHierarchy(r,function(o,s){iterateObject(o.autowireMethods,function(l,a){if(l!=="agConstructor"){var h=e.getBeansForParameters(a,s);r[l].apply(r,h)}})})})},n.prototype.forEachMetaDataInHierarchy=function(t,e){for(var r=Object.getPrototypeOf(t);r!=null;){var o=r.constructor;if(o.hasOwnProperty("__agBeanMetaData")){var s=o.__agBeanMetaData,l=this.getBeanName(o);e(s,l)}r=Object.getPrototypeOf(r)}},n.prototype.getBeanName=function(t){if(t.__agBeanMetaData&&t.__agBeanMetaData.beanName)return t.__agBeanMetaData.beanName;var e=t.toString(),r=e.substring(9,e.indexOf("("));return r},n.prototype.getBeansForParameters=function(t,e){var r=this,o=[];return t&&iterateObject(t,function(s,l){var a=r.lookupBeanInstance(e,l);o[Number(s)]=a}),o},n.prototype.lookupBeanInstance=function(t,e,r){if(r===void 0&&(r=!1),this.destroyed)return this.logger.log("AG Grid: bean reference "+e+" is used after the grid is destroyed!"),null;if(e==="context")return this;if(this.contextParams.providedBeanInstances&&this.contextParams.providedBeanInstances.hasOwnProperty(e))return this.contextParams.providedBeanInstances[e];var o=this.beanWrappers[e];return o?o.beanInstance:(r||console.error("AG Grid: unable to find bean reference "+e+" while initialising "+t),null)},n.prototype.callLifeCycleMethods=function(t,e){var r=this;t.forEach(function(o){return r.callLifeCycleMethodsOnBean(o,e)})},n.prototype.callLifeCycleMethodsOnBean=function(t,e,r){var o={};this.forEachMetaDataInHierarchy(t,function(l){var a=l[e];a&&a.forEach(function(h){h!=r&&(o[h]=!0)})});var s=Object.keys(o);s.forEach(function(l){return t[l]()})},n.prototype.getBean=function(t){return this.lookupBeanInstance("getBean",t,!0)},n.prototype.destroy=function(){if(!this.destroyed){this.logger.log(">> Shutting down ag-Application Context");var t=this.getBeanInstances();this.destroyBeans(t),this.contextParams.providedBeanInstances=null,ModuleRegistry.__unRegisterGridModules(this.contextParams.gridId),this.destroyed=!0,this.logger.log(">> ag-Application Context shut down - component is dead")}},n.prototype.destroyBean=function(t){t&&this.destroyBeans([t])},n.prototype.destroyBeans=function(t){var e=this;return t?(t.forEach(function(r){e.callLifeCycleMethodsOnBean(r,"preDestroyMethods","destroy");var o=r;typeof o.destroy=="function"&&o.destroy()}),[]):[]},n.prototype.isDestroyed=function(){return this.destroyed},n.prototype.getGridId=function(){return this.contextParams.gridId},n}();function PreConstruct(n,t,e){var r=getOrCreateProps$1(n.constructor);r.preConstructMethods||(r.preConstructMethods=[]),r.preConstructMethods.push(t)}function PostConstruct(n,t,e){var r=getOrCreateProps$1(n.constructor);r.postConstructMethods||(r.postConstructMethods=[]),r.postConstructMethods.push(t)}function PreDestroy(n,t,e){var r=getOrCreateProps$1(n.constructor);r.preDestroyMethods||(r.preDestroyMethods=[]),r.preDestroyMethods.push(t)}function Bean(n){return function(t){var e=getOrCreateProps$1(t);e.beanName=n}}function Autowired(n){return function(t,e,r){autowiredFunc(t,n,!1,t,e,null)}}function Optional(n){return function(t,e,r){autowiredFunc(t,n,!0,t,e,null)}}function autowiredFunc(n,t,e,r,o,s){if(t===null){console.error("AG Grid: Autowired name should not be null");return}if(typeof s=="number"){console.error("AG Grid: Autowired should be on an attribute");return}var l=getOrCreateProps$1(n.constructor);l.agClassAttributes||(l.agClassAttributes=[]),l.agClassAttributes.push({attributeName:o,beanName:t,optional:e})}function Qualifier(n){return function(t,e,r){var o=typeof t=="function"?t:t.constructor,s;if(typeof r=="number"){var l=void 0;e?(s=getOrCreateProps$1(o),l=e):(s=getOrCreateProps$1(o),l="agConstructor"),s.autowireMethods||(s.autowireMethods={}),s.autowireMethods[l]||(s.autowireMethods[l]={}),s.autowireMethods[l][r]=n}}}function getOrCreateProps$1(n){return n.hasOwnProperty("__agBeanMetaData")||(n.__agBeanMetaData={}),n.__agBeanMetaData}var __decorate$2E=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__param$a=function(n,t){return function(e,r){t(e,r,n)}},EventService=function(){function n(){this.allSyncListeners=new Map,this.allAsyncListeners=new Map,this.globalSyncListeners=new Set,this.globalAsyncListeners=new Set,this.asyncFunctionsQueue=[],this.scheduled=!1,this.firedEvents={}}return n.prototype.setBeans=function(t,e,r,o){if(o===void 0&&(o=null),this.frameworkOverrides=r,this.gridOptionsService=e,o){var s=e.useAsyncEvents();this.addGlobalListener(o,s)}},n.prototype.getListeners=function(t,e,r){var o=e?this.allAsyncListeners:this.allSyncListeners,s=o.get(t);return!s&&r&&(s=new Set,o.set(t,s)),s},n.prototype.noRegisteredListenersExist=function(){return this.allSyncListeners.size===0&&this.allAsyncListeners.size===0&&this.globalSyncListeners.size===0&&this.globalAsyncListeners.size===0},n.prototype.addEventListener=function(t,e,r){r===void 0&&(r=!1),this.getListeners(t,r,!0).add(e)},n.prototype.removeEventListener=function(t,e,r){r===void 0&&(r=!1);var o=this.getListeners(t,r,!1);if(o&&(o.delete(e),o.size===0)){var s=r?this.allAsyncListeners:this.allSyncListeners;s.delete(t)}},n.prototype.addGlobalListener=function(t,e){e===void 0&&(e=!1),(e?this.globalAsyncListeners:this.globalSyncListeners).add(t)},n.prototype.removeGlobalListener=function(t,e){e===void 0&&(e=!1),(e?this.globalAsyncListeners:this.globalSyncListeners).delete(t)},n.prototype.dispatchEvent=function(t){var e=t;if(this.gridOptionsService){var r=this.gridOptionsService,o=r.api,s=r.columnApi,l=r.context;e.api=o,e.columnApi=s,e.context=l}this.dispatchToListeners(e,!0),this.dispatchToListeners(e,!1),this.firedEvents[e.type]=!0},n.prototype.dispatchEventOnce=function(t){this.firedEvents[t.type]||this.dispatchEvent(t)},n.prototype.dispatchToListeners=function(t,e){var r=this,o=t.type;if(e&&"event"in t){var s=t.event;s instanceof Event&&(t.eventPath=s.composedPath())}var l=function(y){return y.forEach(function(C){e?r.dispatchAsync(function(){return C(t)}):C(t)})},a=new Set(this.getListeners(o,e,!1));a&&l(a);var h=new Set(e?this.globalAsyncListeners:this.globalSyncListeners);h.forEach(function(y){e?r.dispatchAsync(function(){return r.frameworkOverrides.dispatchEvent(o,function(){return y(o,t)},!0)}):r.frameworkOverrides.dispatchEvent(o,function(){return y(o,t)},!0)})},n.prototype.dispatchAsync=function(t){this.asyncFunctionsQueue.push(t),this.scheduled||(window.setTimeout(this.flushAsyncQueue.bind(this),0),this.scheduled=!0)},n.prototype.flushAsyncQueue=function(){this.scheduled=!1;var t=this.asyncFunctionsQueue.slice();this.asyncFunctionsQueue=[],t.forEach(function(e){return e()})},__decorate$2E([__param$a(0,Qualifier("loggerFactory")),__param$a(1,Qualifier("gridOptionsService")),__param$a(2,Qualifier("frameworkOverrides")),__param$a(3,Qualifier("globalEventListener"))],n.prototype,"setBeans",null),n=__decorate$2E([Bean("eventService")],n),n}(),__decorate$2D=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__read$v=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray$p=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n},instanceIdSequence$4=0;function getNextColInstanceId(){return instanceIdSequence$4++}var Column=function(){function n(t,e,r,o){this.instanceId=getNextColInstanceId(),this.autoHeaderHeight=null,this.moving=!1,this.menuVisible=!1,this.filterActive=!1,this.eventService=new EventService,this.tooltipEnabled=!1,this.rowGroupActive=!1,this.pivotActive=!1,this.aggregationActive=!1,this.colDef=t,this.userProvidedColDef=e,this.colId=r,this.primary=o,this.setState(t)}return n.prototype.getInstanceId=function(){return this.instanceId},n.prototype.setState=function(t){t.sort!==void 0?(t.sort==="asc"||t.sort==="desc")&&(this.sort=t.sort):(t.initialSort==="asc"||t.initialSort==="desc")&&(this.sort=t.initialSort);var e=attrToNumber(t.sortIndex),r=attrToNumber(t.initialSortIndex);e!==void 0?e!==null&&(this.sortIndex=e):r!==null&&(this.sortIndex=r);var o=attrToBoolean(t.hide),s=attrToBoolean(t.initialHide);o!==void 0?this.visible=!o:this.visible=!s,t.pinned!==void 0?this.setPinned(t.pinned):this.setPinned(t.initialPinned);var l=attrToNumber(t.flex),a=attrToNumber(t.initialFlex);l!==void 0?this.flex=l:a!==void 0&&(this.flex=a)},n.prototype.setColDef=function(t,e){this.colDef=t,this.userProvidedColDef=e,this.initMinAndMaxWidths(),this.initDotNotation(),this.eventService.dispatchEvent(this.createColumnEvent("colDefChanged","api"))},n.prototype.getUserProvidedColDef=function(){return this.userProvidedColDef},n.prototype.setParent=function(t){this.parent=t},n.prototype.getParent=function(){return this.parent},n.prototype.setOriginalParent=function(t){this.originalParent=t},n.prototype.getOriginalParent=function(){return this.originalParent},n.prototype.initialise=function(){this.initMinAndMaxWidths(),this.resetActualWidth("gridInitializing"),this.initDotNotation(),this.initTooltip(),this.validate()},n.prototype.initDotNotation=function(){var t=this.gridOptionsService.is("suppressFieldDotNotation");this.fieldContainsDots=exists(this.colDef.field)&&this.colDef.field.indexOf(".")>=0&&!t,this.tooltipFieldContainsDots=exists(this.colDef.tooltipField)&&this.colDef.tooltipField.indexOf(".")>=0&&!t},n.prototype.initMinAndMaxWidths=function(){var t=this.colDef;this.minWidth=this.columnUtils.calculateColMinWidth(t),this.maxWidth=this.columnUtils.calculateColMaxWidth(t)},n.prototype.initTooltip=function(){this.tooltipEnabled=exists(this.colDef.tooltipField)||exists(this.colDef.tooltipValueGetter)||exists(this.colDef.tooltipComponent)},n.prototype.resetActualWidth=function(t){t===void 0&&(t="api");var e=this.columnUtils.calculateColInitialWidth(this.colDef);this.setActualWidth(e,t,!0)},n.prototype.isEmptyGroup=function(){return!1},n.prototype.isRowGroupDisplayed=function(t){if(missing(this.colDef)||missing(this.colDef.showRowGroup))return!1;var e=this.colDef.showRowGroup===!0,r=this.colDef.showRowGroup===t;return e||r},n.prototype.isPrimary=function(){return this.primary},n.prototype.isFilterAllowed=function(){var t=!!this.colDef.filter;return t},n.prototype.isFieldContainsDots=function(){return this.fieldContainsDots},n.prototype.isTooltipEnabled=function(){return this.tooltipEnabled},n.prototype.isTooltipFieldContainsDots=function(){return this.tooltipFieldContainsDots},n.prototype.validate=function(){var t=this.colDef;function e(y,C,L){doOnce(function(){L?console.warn(y,L):doOnce(function(){return console.warn(y)},C)},C)}var r=this.gridOptionsService.isRowModelType("clientSide");if(r&&!ModuleRegistry.__isRegistered(ModuleNames.RowGroupingModule,this.gridOptionsService.getGridId())){var o=["enableRowGroup","rowGroup","rowGroupIndex","enablePivot","enableValue","pivot","pivotIndex","aggFunc"],s=o.filter(function(y){return exists(t[y])});s.length>0&&ModuleRegistry.__assertRegistered(ModuleNames.RowGroupingModule,s.map(function(y){return"colDef."+y}).join(", "),this.gridOptionsService.getGridId())}if((this.colDef.cellEditor==="agRichSelect"||this.colDef.cellEditor==="agRichSelectCellEditor")&&ModuleRegistry.__assertRegistered(ModuleNames.RichSelectModule,this.colDef.cellEditor,this.gridOptionsService.getGridId()),this.gridOptionsService.isTreeData()){var l=["rowGroup","rowGroupIndex","pivot","pivotIndex"],s=l.filter(function(C){return exists(t[C])});s.length>0&&e("AG Grid: "+s.join()+" is not possible when doing tree data, your column definition should not have "+s.join(),"TreeDataCannotRowGroup")}if(exists(t.menuTabs))if(Array.isArray(t.menuTabs)){var a=["filterMenuTab"],h=["columnsMenuTab","generalMenuTab"],s=h.filter(function(C){return t.menuTabs.includes(C)});s.length>0&&ModuleRegistry.__assertRegistered(ModuleNames.MenuModule,"menuTab(s): "+s.map(function(C){return"'"+C+"'"}).join(),this.gridOptionsService.getGridId()),t.menuTabs.forEach(function(C){!h.includes(C)&&!a.includes(C)&&e("AG Grid: '"+C+"' is not valid for 'colDef.menuTabs'. Valid values are: "+__spreadArray$p(__spreadArray$p([],__read$v(a)),__read$v(h)).map(function(L){return"'"+L+"'"}).join()+".","wrongValue_menuTabs_"+C)})}else e("AG Grid: The typeof 'colDef.menuTabs' should be an array not:"+typeof t.menuTabs,"wrongType_menuTabs");exists(t.columnsMenuParams)&&ModuleRegistry.__assertRegistered(ModuleNames.MenuModule,"columnsMenuParams",this.gridOptionsService.getGridId()),exists(t.columnsMenuParams)&&ModuleRegistry.__assertRegistered(ModuleNames.ColumnsToolPanelModule,"columnsMenuParams",this.gridOptionsService.getGridId()),exists(this.colDef.width)&&typeof this.colDef.width!="number"&&e("AG Grid: colDef.width should be a number, not "+typeof this.colDef.width,"ColumnCheck"),exists(t.columnGroupShow)&&t.columnGroupShow!=="closed"&&t.columnGroupShow!=="open"&&e("AG Grid: '"+t.columnGroupShow+"' is not valid for columnGroupShow. Valid values are 'open', 'closed', undefined, null","columnGroupShow_invalid")},n.prototype.addEventListener=function(t,e){this.eventService.addEventListener(t,e)},n.prototype.removeEventListener=function(t,e){this.eventService.removeEventListener(t,e)},n.prototype.createColumnFunctionCallbackParams=function(t){return{node:t,data:t.data,column:this,colDef:this.colDef,context:this.gridOptionsService.context,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi}},n.prototype.isSuppressNavigable=function(t){if(typeof this.colDef.suppressNavigable=="boolean")return this.colDef.suppressNavigable;if(typeof this.colDef.suppressNavigable=="function"){var e=this.createColumnFunctionCallbackParams(t),r=this.colDef.suppressNavigable;return r(e)}return!1},n.prototype.isCellEditable=function(t){return t.group&&!this.gridOptionsService.is("enableGroupEdit")?!1:this.isColumnFunc(t,this.colDef.editable)},n.prototype.isSuppressFillHandle=function(){return!!attrToBoolean(this.colDef.suppressFillHandle)},n.prototype.isAutoHeight=function(){return!!attrToBoolean(this.colDef.autoHeight)},n.prototype.isAutoHeaderHeight=function(){return!!attrToBoolean(this.colDef.autoHeaderHeight)},n.prototype.isRowDrag=function(t){return this.isColumnFunc(t,this.colDef.rowDrag)},n.prototype.isDndSource=function(t){return this.isColumnFunc(t,this.colDef.dndSource)},n.prototype.isCellCheckboxSelection=function(t){return this.isColumnFunc(t,this.colDef.checkboxSelection)},n.prototype.isSuppressPaste=function(t){return this.isColumnFunc(t,this.colDef?this.colDef.suppressPaste:null)},n.prototype.isResizable=function(){return!!attrToBoolean(this.colDef.resizable)},n.prototype.isColumnFunc=function(t,e){if(typeof e=="boolean")return e;if(typeof e=="function"){var r=this.createColumnFunctionCallbackParams(t),o=e;return o(r)}return!1},n.prototype.setMoving=function(t,e){e===void 0&&(e="api"),this.moving=t,this.eventService.dispatchEvent(this.createColumnEvent("movingChanged",e))},n.prototype.createColumnEvent=function(t,e){return{type:t,column:this,columns:[this],source:e,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context}},n.prototype.isMoving=function(){return this.moving},n.prototype.getSort=function(){return this.sort},n.prototype.setSort=function(t,e){e===void 0&&(e="api"),this.sort!==t&&(this.sort=t,this.eventService.dispatchEvent(this.createColumnEvent("sortChanged",e))),this.dispatchStateUpdatedEvent("sort")},n.prototype.setMenuVisible=function(t,e){e===void 0&&(e="api"),this.menuVisible!==t&&(this.menuVisible=t,this.eventService.dispatchEvent(this.createColumnEvent("menuVisibleChanged",e)))},n.prototype.isMenuVisible=function(){return this.menuVisible},n.prototype.isSortAscending=function(){return this.sort==="asc"},n.prototype.isSortDescending=function(){return this.sort==="desc"},n.prototype.isSortNone=function(){return missing(this.sort)},n.prototype.isSorting=function(){return exists(this.sort)},n.prototype.getSortIndex=function(){return this.sortIndex},n.prototype.setSortIndex=function(t){this.sortIndex=t,this.dispatchStateUpdatedEvent("sortIndex")},n.prototype.setAggFunc=function(t){this.aggFunc=t,this.dispatchStateUpdatedEvent("aggFunc")},n.prototype.getAggFunc=function(){return this.aggFunc},n.prototype.getLeft=function(){return this.left},n.prototype.getOldLeft=function(){return this.oldLeft},n.prototype.getRight=function(){return this.left+this.actualWidth},n.prototype.setLeft=function(t,e){e===void 0&&(e="api"),this.oldLeft=this.left,this.left!==t&&(this.left=t,this.eventService.dispatchEvent(this.createColumnEvent("leftChanged",e)))},n.prototype.isFilterActive=function(){return this.filterActive},n.prototype.setFilterActive=function(t,e,r){e===void 0&&(e="api"),this.filterActive!==t&&(this.filterActive=t,this.eventService.dispatchEvent(this.createColumnEvent("filterActiveChanged",e)));var o=this.createColumnEvent("filterChanged",e);r&&mergeDeep(o,r),this.eventService.dispatchEvent(o)},n.prototype.isHovered=function(){return this.columnHoverService.isHovered(this)},n.prototype.setPinned=function(t){t===!0||t==="left"?this.pinned="left":t==="right"?this.pinned="right":this.pinned=null,this.dispatchStateUpdatedEvent("pinned")},n.prototype.setFirstRightPinned=function(t,e){e===void 0&&(e="api"),this.firstRightPinned!==t&&(this.firstRightPinned=t,this.eventService.dispatchEvent(this.createColumnEvent("firstRightPinnedChanged",e)))},n.prototype.setLastLeftPinned=function(t,e){e===void 0&&(e="api"),this.lastLeftPinned!==t&&(this.lastLeftPinned=t,this.eventService.dispatchEvent(this.createColumnEvent("lastLeftPinnedChanged",e)))},n.prototype.isFirstRightPinned=function(){return this.firstRightPinned},n.prototype.isLastLeftPinned=function(){return this.lastLeftPinned},n.prototype.isPinned=function(){return this.pinned==="left"||this.pinned==="right"},n.prototype.isPinnedLeft=function(){return this.pinned==="left"},n.prototype.isPinnedRight=function(){return this.pinned==="right"},n.prototype.getPinned=function(){return this.pinned},n.prototype.setVisible=function(t,e){e===void 0&&(e="api");var r=t===!0;this.visible!==r&&(this.visible=r,this.eventService.dispatchEvent(this.createColumnEvent("visibleChanged",e))),this.dispatchStateUpdatedEvent("hide")},n.prototype.isVisible=function(){return this.visible},n.prototype.isSpanHeaderHeight=function(){var t=this.getColDef();return!t.suppressSpanHeaderHeight&&!t.autoHeaderHeight},n.prototype.getColDef=function(){return this.colDef},n.prototype.getColumnGroupShow=function(){return this.colDef.columnGroupShow},n.prototype.getColId=function(){return this.colId},n.prototype.getId=function(){return this.colId},n.prototype.getUniqueId=function(){return this.colId},n.prototype.getDefinition=function(){return this.colDef},n.prototype.getActualWidth=function(){return this.actualWidth},n.prototype.getAutoHeaderHeight=function(){return this.autoHeaderHeight},n.prototype.setAutoHeaderHeight=function(t){var e=t!==this.autoHeaderHeight;return this.autoHeaderHeight=t,e},n.prototype.createBaseColDefParams=function(t){var e={node:t,data:t.data,colDef:this.colDef,column:this,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context};return e},n.prototype.getColSpan=function(t){if(missing(this.colDef.colSpan))return 1;var e=this.createBaseColDefParams(t),r=this.colDef.colSpan(e);return Math.max(r,1)},n.prototype.getRowSpan=function(t){if(missing(this.colDef.rowSpan))return 1;var e=this.createBaseColDefParams(t),r=this.colDef.rowSpan(e);return Math.max(r,1)},n.prototype.setActualWidth=function(t,e,r){e===void 0&&(e="api"),r===void 0&&(r=!1),this.minWidth!=null&&(t=Math.max(t,this.minWidth)),this.maxWidth!=null&&(t=Math.min(t,this.maxWidth)),this.actualWidth!==t&&(this.actualWidth=t,this.flex&&e!=="flex"&&e!=="gridInitializing"&&(this.flex=null),r||this.fireColumnWidthChangedEvent(e)),this.dispatchStateUpdatedEvent("width")},n.prototype.fireColumnWidthChangedEvent=function(t){this.eventService.dispatchEvent(this.createColumnEvent("widthChanged",t))},n.prototype.isGreaterThanMax=function(t){return this.maxWidth!=null?t>this.maxWidth:!1},n.prototype.getMinWidth=function(){return this.minWidth},n.prototype.getMaxWidth=function(){return this.maxWidth},n.prototype.getFlex=function(){return this.flex||0},n.prototype.setFlex=function(t){this.flex!==t&&(this.flex=t),this.dispatchStateUpdatedEvent("flex")},n.prototype.setMinimum=function(t){t===void 0&&(t="api"),exists(this.minWidth)&&this.setActualWidth(this.minWidth,t)},n.prototype.setRowGroupActive=function(t,e){e===void 0&&(e="api"),this.rowGroupActive!==t&&(this.rowGroupActive=t,this.eventService.dispatchEvent(this.createColumnEvent("columnRowGroupChanged",e))),this.dispatchStateUpdatedEvent("rowGroup")},n.prototype.isRowGroupActive=function(){return this.rowGroupActive},n.prototype.setPivotActive=function(t,e){e===void 0&&(e="api"),this.pivotActive!==t&&(this.pivotActive=t,this.eventService.dispatchEvent(this.createColumnEvent("columnPivotChanged",e))),this.dispatchStateUpdatedEvent("pivot")},n.prototype.isPivotActive=function(){return this.pivotActive},n.prototype.isAnyFunctionActive=function(){return this.isPivotActive()||this.isRowGroupActive()||this.isValueActive()},n.prototype.isAnyFunctionAllowed=function(){return this.isAllowPivot()||this.isAllowRowGroup()||this.isAllowValue()},n.prototype.setValueActive=function(t,e){e===void 0&&(e="api"),this.aggregationActive!==t&&(this.aggregationActive=t,this.eventService.dispatchEvent(this.createColumnEvent("columnValueChanged",e)))},n.prototype.isValueActive=function(){return this.aggregationActive},n.prototype.isAllowPivot=function(){return this.colDef.enablePivot===!0},n.prototype.isAllowValue=function(){return this.colDef.enableValue===!0},n.prototype.isAllowRowGroup=function(){return this.colDef.enableRowGroup===!0},n.prototype.getMenuTabs=function(t){var e=this.getColDef().menuTabs;return e==null&&(e=t),e},n.prototype.dispatchStateUpdatedEvent=function(t){this.eventService.dispatchEvent({type:n.EVENT_STATE_UPDATED,key:t})},n.EVENT_MOVING_CHANGED="movingChanged",n.EVENT_LEFT_CHANGED="leftChanged",n.EVENT_WIDTH_CHANGED="widthChanged",n.EVENT_LAST_LEFT_PINNED_CHANGED="lastLeftPinnedChanged",n.EVENT_FIRST_RIGHT_PINNED_CHANGED="firstRightPinnedChanged",n.EVENT_VISIBLE_CHANGED="visibleChanged",n.EVENT_FILTER_CHANGED="filterChanged",n.EVENT_FILTER_ACTIVE_CHANGED="filterActiveChanged",n.EVENT_SORT_CHANGED="sortChanged",n.EVENT_COL_DEF_CHANGED="colDefChanged",n.EVENT_MENU_VISIBLE_CHANGED="menuVisibleChanged",n.EVENT_ROW_GROUP_CHANGED="columnRowGroupChanged",n.EVENT_PIVOT_CHANGED="columnPivotChanged",n.EVENT_VALUE_CHANGED="columnValueChanged",n.EVENT_STATE_UPDATED="columnStateUpdated",__decorate$2D([Autowired("gridOptionsService")],n.prototype,"gridOptionsService",void 0),__decorate$2D([Autowired("columnUtils")],n.prototype,"columnUtils",void 0),__decorate$2D([Autowired("columnHoverService")],n.prototype,"columnHoverService",void 0),__decorate$2D([PostConstruct],n.prototype,"initialise",null),n}(),__decorate$2C=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},ProvidedColumnGroup=function(){function n(t,e,r,o){this.localEventService=new EventService,this.expandable=!1,this.instanceId=getNextColInstanceId(),this.expandableListenerRemoveCallback=null,this.colGroupDef=t,this.groupId=e,this.expanded=!!t&&!!t.openByDefault,this.padding=r,this.level=o}return n.prototype.destroy=function(){this.expandableListenerRemoveCallback&&this.reset(null,void 0)},n.prototype.reset=function(t,e){this.colGroupDef=t,this.level=e,this.originalParent=null,this.expandableListenerRemoveCallback&&this.expandableListenerRemoveCallback(),this.children=void 0,this.expandable=void 0},n.prototype.getInstanceId=function(){return this.instanceId},n.prototype.setOriginalParent=function(t){this.originalParent=t},n.prototype.getOriginalParent=function(){return this.originalParent},n.prototype.getLevel=function(){return this.level},n.prototype.isVisible=function(){return this.children?this.children.some(function(t){return t.isVisible()}):!1},n.prototype.isPadding=function(){return this.padding},n.prototype.setExpanded=function(t){this.expanded=t===void 0?!1:t;var e={type:n.EVENT_EXPANDED_CHANGED};this.localEventService.dispatchEvent(e)},n.prototype.isExpandable=function(){return this.expandable},n.prototype.isExpanded=function(){return this.expanded},n.prototype.getGroupId=function(){return this.groupId},n.prototype.getId=function(){return this.getGroupId()},n.prototype.setChildren=function(t){this.children=t},n.prototype.getChildren=function(){return this.children},n.prototype.getColGroupDef=function(){return this.colGroupDef},n.prototype.getLeafColumns=function(){var t=[];return this.addLeafColumns(t),t},n.prototype.addLeafColumns=function(t){this.children&&this.children.forEach(function(e){e instanceof Column?t.push(e):e instanceof n&&e.addLeafColumns(t)})},n.prototype.getColumnGroupShow=function(){var t=this.colGroupDef;if(t)return t.columnGroupShow},n.prototype.setupExpandable=function(){var t=this;this.setExpandable(),this.expandableListenerRemoveCallback&&this.expandableListenerRemoveCallback();var e=this.onColumnVisibilityChanged.bind(this);this.getLeafColumns().forEach(function(r){return r.addEventListener("visibleChanged",e)}),this.expandableListenerRemoveCallback=function(){t.getLeafColumns().forEach(function(r){return r.removeEventListener("visibleChanged",e)}),t.expandableListenerRemoveCallback=null}},n.prototype.setExpandable=function(){if(!this.isPadding()){for(var t=!1,e=!1,r=!1,o=this.findChildrenRemovingPadding(),s=0,l=o.length;s<l;s++){var a=o[s];if(a.isVisible()){var h=a.getColumnGroupShow();h==="open"?(t=!0,r=!0):h==="closed"?(e=!0,r=!0):(t=!0,e=!0)}}var y=t&&e&&r;if(this.expandable!==y){this.expandable=y;var C={type:n.EVENT_EXPANDABLE_CHANGED};this.localEventService.dispatchEvent(C)}}},n.prototype.findChildrenRemovingPadding=function(){var t=[],e=function(r){r.forEach(function(o){var s=o instanceof n&&o.isPadding();s?e(o.children):t.push(o)})};return e(this.children),t},n.prototype.onColumnVisibilityChanged=function(){this.setExpandable()},n.prototype.addEventListener=function(t,e){this.localEventService.addEventListener(t,e)},n.prototype.removeEventListener=function(t,e){this.localEventService.removeEventListener(t,e)},n.EVENT_EXPANDED_CHANGED="expandedChanged",n.EVENT_EXPANDABLE_CHANGED="expandableChanged",__decorate$2C([PreDestroy],n.prototype,"destroy",null),n}(),DefaultColumnTypes={numericColumn:{headerClass:"ag-right-aligned-header",cellClass:"ag-right-aligned-cell"},rightAligned:{headerClass:"ag-right-aligned-header",cellClass:"ag-right-aligned-cell"}};function firstExistingValue(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];for(var e=0;e<n.length;e++){var r=n[e];if(exists(r))return r}return null}function existsAndNotEmpty(n){return n!=null&&n.length>0}function last(n){if(!(!n||!n.length))return n[n.length-1]}function areEqual(n,t,e){return n==null&&t==null?!0:n!=null&&t!=null&&n.length===t.length&&n.every(function(r,o){return e?e(r,t[o]):t[o]===r})}function shallowCompare(n,t){return areEqual(n,t)}function sortNumerically(n){return n.sort(function(t,e){return t-e})}function removeRepeatsFromArray(n,t){if(n)for(var e=n.length-2;e>=0;e--){var r=n[e]===t,o=n[e+1]===t;r&&o&&n.splice(e+1,1)}}function removeFromArray(n,t){var e=n.indexOf(t);e>=0&&n.splice(e,1)}function removeAllFromArray(n,t){t.forEach(function(e){return removeFromArray(n,e)})}function insertIntoArray(n,t,e){n.splice(e,0,t)}function insertArrayIntoArray(n,t,e){if(!(n==null||t==null))for(var r=t.length-1;r>=0;r--){var o=t[r];insertIntoArray(n,o,e)}}function moveInArray(n,t,e){removeAllFromArray(n,t),t.slice().reverse().forEach(function(r){return insertIntoArray(n,r,e)})}function includes(n,t){return n.indexOf(t)>-1}function flatten(n){return[].concat.apply([],n)}function pushAll(n,t){t==null||n==null||t.forEach(function(e){return n.push(e)})}function toStrings(n){return n.map(toStringOrNull)}function forEachReverse(n,t){if(n!=null)for(var e=n.length-1;e>=0;e--)t(n[e],e)}var ArrayUtils=Object.freeze({__proto__:null,firstExistingValue,existsAndNotEmpty,last,areEqual,shallowCompare,sortNumerically,removeRepeatsFromArray,removeFromArray,removeAllFromArray,insertIntoArray,insertArrayIntoArray,moveInArray,includes,flatten,pushAll,toStrings,forEachReverse}),AG_GRID_STOP_PROPAGATION="__ag_Grid_Stop_Propagation",PASSIVE_EVENTS$1=["touchstart","touchend","touchmove","touchcancel","scroll"],supports={};function stopPropagationForAgGrid(n){n[AG_GRID_STOP_PROPAGATION]=!0}function isStopPropagationForAgGrid(n){return n[AG_GRID_STOP_PROPAGATION]===!0}var isEventSupported=function(){var n={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"},t=function(e){if(typeof supports[e]=="boolean")return supports[e];var r=document.createElement(n[e]||"div");return e="on"+e,supports[e]=e in r};return t}();function getCtrlForEventTarget(n,t,e){for(var r=t;r;){var o=n.getDomData(r,e);if(o)return o;r=r.parentElement}return null}function isElementInEventPath(n,t){return!t||!n?!1:getEventPath(t).indexOf(n)>=0}function createEventPath(n){for(var t=[],e=n.target;e;)t.push(e),e=e.parentElement;return t}function getEventPath(n){var t=n;return t.path?t.path:t.composedPath?t.composedPath():createEventPath(t)}function addSafePassiveEventListener(n,t,e,r){var o=includes(PASSIVE_EVENTS$1,e),s=o?{passive:!0}:void 0;n&&n.addEventListener&&n.addEventListener(t,e,r,s)}var EventUtils=Object.freeze({__proto__:null,stopPropagationForAgGrid,isStopPropagationForAgGrid,isEventSupported,getCtrlForEventTarget,isElementInEventPath,createEventPath,getEventPath,addSafePassiveEventListener}),__decorate$2B=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},BeanStub=function(){function n(){var t=this;this.destroyFunctions=[],this.destroyed=!1,this.__v_skip=!0,this.isAlive=function(){return!t.destroyed}}return n.prototype.getFrameworkOverrides=function(){return this.frameworkOverrides},n.prototype.getContext=function(){return this.context},n.prototype.destroy=function(){this.destroyFunctions.forEach(function(t){return t()}),this.destroyFunctions.length=0,this.destroyed=!0,this.dispatchEvent({type:n.EVENT_DESTROYED})},n.prototype.addEventListener=function(t,e){this.localEventService||(this.localEventService=new EventService),this.localEventService.addEventListener(t,e)},n.prototype.removeEventListener=function(t,e){this.localEventService&&this.localEventService.removeEventListener(t,e)},n.prototype.dispatchEventAsync=function(t){var e=this;window.setTimeout(function(){return e.dispatchEvent(t)},0)},n.prototype.dispatchEvent=function(t){this.localEventService&&this.localEventService.dispatchEvent(t)},n.prototype.addManagedListener=function(t,e,r){var o=this;if(!this.destroyed){t instanceof HTMLElement?addSafePassiveEventListener(this.getFrameworkOverrides(),t,e,r):t.addEventListener(e,r);var s=function(){return t.removeEventListener(e,r),o.destroyFunctions=o.destroyFunctions.filter(function(l){return l!==s}),null};return this.destroyFunctions.push(s),s}},n.prototype.addManagedPropertyListener=function(t,e){var r=this;if(!this.destroyed){this.gridOptionsService.addEventListener(t,e);var o=function(){return r.gridOptionsService.removeEventListener(t,e),r.destroyFunctions=r.destroyFunctions.filter(function(s){return s!==o}),null};return this.destroyFunctions.push(o),o}},n.prototype.addDestroyFunc=function(t){this.isAlive()?this.destroyFunctions.push(t):t()},n.prototype.createManagedBean=function(t,e){var r=this.createBean(t,e);return this.addDestroyFunc(this.destroyBean.bind(this,t,e)),r},n.prototype.createBean=function(t,e,r){return(e||this.getContext()).createBean(t,r)},n.prototype.destroyBean=function(t,e){return(e||this.getContext()).destroyBean(t)},n.prototype.destroyBeans=function(t,e){var r=this;return t&&t.forEach(function(o){return r.destroyBean(o,e)}),[]},n.EVENT_DESTROYED="destroyed",__decorate$2B([Autowired("frameworkOverrides")],n.prototype,"frameworkOverrides",void 0),__decorate$2B([Autowired("context")],n.prototype,"context",void 0),__decorate$2B([Autowired("eventService")],n.prototype,"eventService",void 0),__decorate$2B([Autowired("gridOptionsService")],n.prototype,"gridOptionsService",void 0),__decorate$2B([Autowired("localeService")],n.prototype,"localeService",void 0),__decorate$2B([Autowired("environment")],n.prototype,"environment",void 0),__decorate$2B([PreDestroy],n.prototype,"destroy",null),n}(),__extends$2$=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$2A=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__param$9=function(n,t){return function(e,r){t(e,r,n)}},ColumnFactory=function(n){__extends$2$(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.setBeans=function(e){this.logger=e.create("ColumnFactory")},t.prototype.createColumnTree=function(e,r,o){var s=new ColumnKeyCreator,l=this.extractExistingTreeData(o),a=l.existingCols,h=l.existingGroups,y=l.existingColKeys;s.addExistingKeys(y);var C=this.recursivelyCreateColumns(e,0,r,a,s,h),L=this.findMaxDept(C,0);this.logger.log("Number of levels for grouped columns is "+L);var Y=this.balanceColumnTree(C,0,L,s),ze=function(Bt,Ir){Bt instanceof ProvidedColumnGroup&&Bt.setupExpandable(),Bt.setOriginalParent(Ir)};return this.columnUtils.depthFirstOriginalTreeSearch(null,Y,ze),{columnTree:Y,treeDept:L}},t.prototype.extractExistingTreeData=function(e){var r=[],o=[],s=[];return e&&this.columnUtils.depthFirstOriginalTreeSearch(null,e,function(l){if(l instanceof ProvidedColumnGroup){var a=l;o.push(a)}else{var h=l;s.push(h.getId()),r.push(h)}}),{existingCols:r,existingGroups:o,existingColKeys:s}},t.prototype.createForAutoGroups=function(e,r){var o=this;return e.map(function(s){return o.createAutoGroupTreeItem(r,s)})},t.prototype.createAutoGroupTreeItem=function(e,r){for(var o=this.findDepth(e),s=r,l=o-1;l>=0;l--){var a=new ProvidedColumnGroup(null,"FAKE_PATH_"+r.getId()+"}_"+l,!0,l);this.createBean(a),a.setChildren([s]),s.setOriginalParent(a),s=a}return s},t.prototype.findDepth=function(e){for(var r=0,o=e;o&&o[0]&&o[0]instanceof ProvidedColumnGroup;)r++,o=o[0].getChildren();return r},t.prototype.balanceColumnTree=function(e,r,o,s){for(var l=[],a=0;a<e.length;a++){var h=e[a];if(h instanceof ProvidedColumnGroup){var y=h,C=this.balanceColumnTree(y.getChildren(),r+1,o,s);y.setChildren(C),l.push(y)}else{for(var L=void 0,Y=void 0,ze=o-1;ze>=r;ze--){var Bt=s.getUniqueKey(null,null),Ir=this.createMergedColGroupDef(null),Wr=new ProvidedColumnGroup(Ir,Bt,!0,r);this.createBean(Wr),Y&&Y.setChildren([Wr]),Y=Wr,L||(L=Y)}if(L&&Y){l.push(L);var yi=e.some(function(Bn){return Bn instanceof ProvidedColumnGroup});if(yi){Y.setChildren([h]);continue}else{Y.setChildren(e);break}}l.push(h)}}return l},t.prototype.findMaxDept=function(e,r){for(var o=r,s=0;s<e.length;s++){var l=e[s];if(l instanceof ProvidedColumnGroup){var a=l,h=this.findMaxDept(a.getChildren(),r+1);o<h&&(o=h)}}return o},t.prototype.recursivelyCreateColumns=function(e,r,o,s,l,a){var h=this;return(e||[]).map(function(y){return h.isColumnGroup(y)?h.createColumnGroup(o,y,r,s,l,a):h.createColumn(o,y,s,l)})},t.prototype.createColumnGroup=function(e,r,o,s,l,a){var h=this.createMergedColGroupDef(r),y=l.getUniqueKey(h.groupId||null,null),C=new ProvidedColumnGroup(h,y,!1,o);this.createBean(C);var L=this.findExistingGroup(r,a);L&&removeFromArray(a,L),L&&L.isExpanded()&&C.setExpanded(!0);var Y=this.recursivelyCreateColumns(h.children,o+1,e,s,l,a);return C.setChildren(Y),C},t.prototype.createMergedColGroupDef=function(e){var r={};return Object.assign(r,this.gridOptionsService.get("defaultColGroupDef")),Object.assign(r,e),r},t.prototype.createColumn=function(e,r,o,s){var l=this.findExistingColumn(r,o);if(o&&l&&removeFromArray(o,l),l){var h=this.mergeColDefs(r,l.getColId());l.setColDef(h,r),this.applyColumnState(l,h)}else{var a=s.getUniqueKey(r.colId,r.field),h=this.mergeColDefs(r,a);l=new Column(h,r,a,e),this.context.createBean(l)}return this.dataTypeService.addColumnListeners(l),l},t.prototype.applyColumnState=function(e,r){var o=attrToNumber(r.flex);o!==void 0&&e.setFlex(o);var s=e.getFlex()<=0;if(s){var l=attrToNumber(r.width);if(l!=null)e.setActualWidth(l);else{var a=e.getActualWidth();e.setActualWidth(a)}}r.sort!==void 0&&(r.sort=="asc"||r.sort=="desc"?e.setSort(r.sort):e.setSort(void 0));var h=attrToNumber(r.sortIndex);h!==void 0&&e.setSortIndex(h);var y=attrToBoolean(r.hide);y!==void 0&&e.setVisible(!y),r.pinned!==void 0&&e.setPinned(r.pinned)},t.prototype.findExistingColumn=function(e,r){return(r||[]).find(function(o){var s=o.getUserProvidedColDef();if(!s)return!1;var l=e.colId!=null,a=e.field!=null;return l?o.getId()===e.colId:a?s.field===e.field:s===e})},t.prototype.findExistingGroup=function(e,r){return r.find(function(o){var s=o.getColGroupDef();if(!s)return!1;var l=e.groupId!=null;return l?o.getId()===e.groupId:!1})},t.prototype.mergeColDefs=function(e,r){var o={},s=this.gridOptionsService.get("defaultColDef");mergeDeep(o,s,!1,!0);var l=this.dataTypeService.updateColDefAndGetColumnType(o,e,r);l&&this.assignColumnTypes(l,o),mergeDeep(o,e,!1,!0);var a=this.gridOptionsService.get("autoGroupColumnDef"),h=this.gridOptionsService.isColumnsSortingCoupledToGroup();return e.rowGroup&&a&&h&&mergeDeep(o,{sort:a.sort,initialSort:a.initialSort},!1,!0),this.dataTypeService.validateColDef(o),o},t.prototype.assignColumnTypes=function(e,r){if(e.length){var o=Object.assign({},DefaultColumnTypes),s=this.gridOptionsService.get("columnTypes")||{};iterateObject(s,function(l,a){l in o?console.warn("AG Grid: the column type '"+l+"' is a default column type and cannot be overridden."):o[l]=a}),e.forEach(function(l){var a=o[l.trim()];a?mergeDeep(r,a,!1,!0):console.warn("AG Grid: colDef.type '"+l+"' does not correspond to defined gridOptions.columnTypes")})}},t.prototype.isColumnGroup=function(e){return e.children!==void 0},__decorate$2A([Autowired("columnUtils")],t.prototype,"columnUtils",void 0),__decorate$2A([Autowired("dataTypeService")],t.prototype,"dataTypeService",void 0),__decorate$2A([__param$9(0,Qualifier("loggerFactory"))],t.prototype,"setBeans",null),t=__decorate$2A([Bean("columnFactory")],t),t}(BeanStub),__decorate$2z=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},ColumnGroup=function(){function n(t,e,r,o){this.displayedChildren=[],this.localEventService=new EventService,this.groupId=e,this.partId=r,this.providedColumnGroup=t,this.pinned=o}return n.createUniqueId=function(t,e){return t+"_"+e},n.prototype.reset=function(){this.parent=null,this.children=null,this.displayedChildren=null},n.prototype.getParent=function(){return this.parent},n.prototype.setParent=function(t){this.parent=t},n.prototype.getUniqueId=function(){return n.createUniqueId(this.groupId,this.partId)},n.prototype.isEmptyGroup=function(){return this.displayedChildren.length===0},n.prototype.isMoving=function(){var t=this.getProvidedColumnGroup().getLeafColumns();return!t||t.length===0?!1:t.every(function(e){return e.isMoving()})},n.prototype.checkLeft=function(){if(this.displayedChildren.forEach(function(o){o instanceof n&&o.checkLeft()}),this.displayedChildren.length>0)if(this.gridOptionsService.is("enableRtl")){var t=last(this.displayedChildren),e=t.getLeft();this.setLeft(e)}else{var r=this.displayedChildren[0].getLeft();this.setLeft(r)}else this.setLeft(null)},n.prototype.getLeft=function(){return this.left},n.prototype.getOldLeft=function(){return this.oldLeft},n.prototype.setLeft=function(t){this.oldLeft=t,this.left!==t&&(this.left=t,this.localEventService.dispatchEvent(this.createAgEvent(n.EVENT_LEFT_CHANGED)))},n.prototype.getPinned=function(){return this.pinned},n.prototype.createAgEvent=function(t){return{type:t}},n.prototype.addEventListener=function(t,e){this.localEventService.addEventListener(t,e)},n.prototype.removeEventListener=function(t,e){this.localEventService.removeEventListener(t,e)},n.prototype.getGroupId=function(){return this.groupId},n.prototype.getPartId=function(){return this.partId},n.prototype.isChildInThisGroupDeepSearch=function(t){var e=!1;return this.children.forEach(function(r){t===r&&(e=!0),r instanceof n&&r.isChildInThisGroupDeepSearch(t)&&(e=!0)}),e},n.prototype.getActualWidth=function(){var t=0;return this.displayedChildren&&this.displayedChildren.forEach(function(e){t+=e.getActualWidth()}),t},n.prototype.isResizable=function(){if(!this.displayedChildren)return!1;var t=!1;return this.displayedChildren.forEach(function(e){e.isResizable()&&(t=!0)}),t},n.prototype.getMinWidth=function(){var t=0;return this.displayedChildren.forEach(function(e){t+=e.getMinWidth()||0}),t},n.prototype.addChild=function(t){this.children||(this.children=[]),this.children.push(t)},n.prototype.getDisplayedChildren=function(){return this.displayedChildren},n.prototype.getLeafColumns=function(){var t=[];return this.addLeafColumns(t),t},n.prototype.getDisplayedLeafColumns=function(){var t=[];return this.addDisplayedLeafColumns(t),t},n.prototype.getDefinition=function(){return this.providedColumnGroup.getColGroupDef()},n.prototype.getColGroupDef=function(){return this.providedColumnGroup.getColGroupDef()},n.prototype.isPadding=function(){return this.providedColumnGroup.isPadding()},n.prototype.isExpandable=function(){return this.providedColumnGroup.isExpandable()},n.prototype.isExpanded=function(){return this.providedColumnGroup.isExpanded()},n.prototype.setExpanded=function(t){this.providedColumnGroup.setExpanded(t)},n.prototype.addDisplayedLeafColumns=function(t){this.displayedChildren.forEach(function(e){e instanceof Column?t.push(e):e instanceof n&&e.addDisplayedLeafColumns(t)})},n.prototype.addLeafColumns=function(t){this.children.forEach(function(e){e instanceof Column?t.push(e):e instanceof n&&e.addLeafColumns(t)})},n.prototype.getChildren=function(){return this.children},n.prototype.getColumnGroupShow=function(){return this.providedColumnGroup.getColumnGroupShow()},n.prototype.getProvidedColumnGroup=function(){return this.providedColumnGroup},n.prototype.getPaddingLevel=function(){var t=this.getParent();return!this.isPadding()||!t||!t.isPadding()?0:1+t.getPaddingLevel()},n.prototype.calculateDisplayedColumns=function(){var t=this;this.displayedChildren=[];for(var e=this;e!=null&&e.isPadding();)e=e.getParent();var r=e?e.providedColumnGroup.isExpandable():!1;if(!r){this.displayedChildren=this.children,this.localEventService.dispatchEvent(this.createAgEvent(n.EVENT_DISPLAYED_CHILDREN_CHANGED));return}this.children.forEach(function(o){var s=o instanceof n&&(!o.displayedChildren||!o.displayedChildren.length);if(!s){var l=o.getColumnGroupShow();switch(l){case"open":e.providedColumnGroup.isExpanded()&&t.displayedChildren.push(o);break;case"closed":e.providedColumnGroup.isExpanded()||t.displayedChildren.push(o);break;default:t.displayedChildren.push(o);break}}}),this.localEventService.dispatchEvent(this.createAgEvent(n.EVENT_DISPLAYED_CHILDREN_CHANGED))},n.EVENT_LEFT_CHANGED="leftChanged",n.EVENT_DISPLAYED_CHILDREN_CHANGED="displayedChildrenChanged",__decorate$2z([Autowired("gridOptionsService")],n.prototype,"gridOptionsService",void 0),n}(),Events=function(){function n(){}return n.EVENT_COLUMN_EVERYTHING_CHANGED="columnEverythingChanged",n.EVENT_NEW_COLUMNS_LOADED="newColumnsLoaded",n.EVENT_COLUMN_PIVOT_MODE_CHANGED="columnPivotModeChanged",n.EVENT_COLUMN_ROW_GROUP_CHANGED="columnRowGroupChanged",n.EVENT_EXPAND_COLLAPSE_ALL="expandOrCollapseAll",n.EVENT_COLUMN_PIVOT_CHANGED="columnPivotChanged",n.EVENT_GRID_COLUMNS_CHANGED="gridColumnsChanged",n.EVENT_COLUMN_VALUE_CHANGED="columnValueChanged",n.EVENT_COLUMN_MOVED="columnMoved",n.EVENT_COLUMN_VISIBLE="columnVisible",n.EVENT_COLUMN_PINNED="columnPinned",n.EVENT_COLUMN_GROUP_OPENED="columnGroupOpened",n.EVENT_COLUMN_RESIZED="columnResized",n.EVENT_DISPLAYED_COLUMNS_CHANGED="displayedColumnsChanged",n.EVENT_VIRTUAL_COLUMNS_CHANGED="virtualColumnsChanged",n.EVENT_ASYNC_TRANSACTIONS_FLUSHED="asyncTransactionsFlushed",n.EVENT_ROW_GROUP_OPENED="rowGroupOpened",n.EVENT_ROW_DATA_CHANGED="rowDataChanged",n.EVENT_ROW_DATA_UPDATED="rowDataUpdated",n.EVENT_PINNED_ROW_DATA_CHANGED="pinnedRowDataChanged",n.EVENT_RANGE_SELECTION_CHANGED="rangeSelectionChanged",n.EVENT_CHART_CREATED="chartCreated",n.EVENT_CHART_RANGE_SELECTION_CHANGED="chartRangeSelectionChanged",n.EVENT_CHART_OPTIONS_CHANGED="chartOptionsChanged",n.EVENT_CHART_DESTROYED="chartDestroyed",n.EVENT_TOOL_PANEL_VISIBLE_CHANGED="toolPanelVisibleChanged",n.EVENT_TOOL_PANEL_SIZE_CHANGED="toolPanelSizeChanged",n.EVENT_COLUMN_PANEL_ITEM_DRAG_START="columnPanelItemDragStart",n.EVENT_COLUMN_PANEL_ITEM_DRAG_END="columnPanelItemDragEnd",n.EVENT_MODEL_UPDATED="modelUpdated",n.EVENT_CUT_START="cutStart",n.EVENT_CUT_END="cutEnd",n.EVENT_PASTE_START="pasteStart",n.EVENT_PASTE_END="pasteEnd",n.EVENT_FILL_START="fillStart",n.EVENT_FILL_END="fillEnd",n.EVENT_RANGE_DELETE_START="rangeDeleteStart",n.EVENT_RANGE_DELETE_END="rangeDeleteEnd",n.EVENT_UNDO_STARTED="undoStarted",n.EVENT_UNDO_ENDED="undoEnded",n.EVENT_REDO_STARTED="redoStarted",n.EVENT_REDO_ENDED="redoEnded",n.EVENT_KEY_SHORTCUT_CHANGED_CELL_START="keyShortcutChangedCellStart",n.EVENT_KEY_SHORTCUT_CHANGED_CELL_END="keyShortcutChangedCellEnd",n.EVENT_CELL_CLICKED="cellClicked",n.EVENT_CELL_DOUBLE_CLICKED="cellDoubleClicked",n.EVENT_CELL_MOUSE_DOWN="cellMouseDown",n.EVENT_CELL_CONTEXT_MENU="cellContextMenu",n.EVENT_CELL_VALUE_CHANGED="cellValueChanged",n.EVENT_CELL_EDIT_REQUEST="cellEditRequest",n.EVENT_ROW_VALUE_CHANGED="rowValueChanged",n.EVENT_CELL_FOCUSED="cellFocused",n.EVENT_CELL_FOCUS_CLEARED="cellFocusCleared",n.EVENT_FULL_WIDTH_ROW_FOCUSED="fullWidthRowFocused",n.EVENT_ROW_SELECTED="rowSelected",n.EVENT_SELECTION_CHANGED="selectionChanged",n.EVENT_CELL_KEY_DOWN="cellKeyDown",n.EVENT_CELL_MOUSE_OVER="cellMouseOver",n.EVENT_CELL_MOUSE_OUT="cellMouseOut",n.EVENT_FILTER_CHANGED="filterChanged",n.EVENT_FILTER_MODIFIED="filterModified",n.EVENT_FILTER_OPENED="filterOpened",n.EVENT_SORT_CHANGED="sortChanged",n.EVENT_VIRTUAL_ROW_REMOVED="virtualRowRemoved",n.EVENT_ROW_CLICKED="rowClicked",n.EVENT_ROW_DOUBLE_CLICKED="rowDoubleClicked",n.EVENT_GRID_READY="gridReady",n.EVENT_GRID_SIZE_CHANGED="gridSizeChanged",n.EVENT_VIEWPORT_CHANGED="viewportChanged",n.EVENT_SCROLLBAR_WIDTH_CHANGED="scrollbarWidthChanged",n.EVENT_FIRST_DATA_RENDERED="firstDataRendered",n.EVENT_DRAG_STARTED="dragStarted",n.EVENT_DRAG_STOPPED="dragStopped",n.EVENT_CHECKBOX_CHANGED="checkboxChanged",n.EVENT_ROW_EDITING_STARTED="rowEditingStarted",n.EVENT_ROW_EDITING_STOPPED="rowEditingStopped",n.EVENT_CELL_EDITING_STARTED="cellEditingStarted",n.EVENT_CELL_EDITING_STOPPED="cellEditingStopped",n.EVENT_BODY_SCROLL="bodyScroll",n.EVENT_BODY_SCROLL_END="bodyScrollEnd",n.EVENT_HEIGHT_SCALE_CHANGED="heightScaleChanged",n.EVENT_PAGINATION_CHANGED="paginationChanged",n.EVENT_COMPONENT_STATE_CHANGED="componentStateChanged",n.EVENT_STORE_REFRESHED="storeRefreshed",n.EVENT_BODY_HEIGHT_CHANGED="bodyHeightChanged",n.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED="displayedColumnsWidthChanged",n.EVENT_SCROLL_VISIBILITY_CHANGED="scrollVisibilityChanged",n.EVENT_COLUMN_HOVER_CHANGED="columnHoverChanged",n.EVENT_FLASH_CELLS="flashCells",n.EVENT_PAGINATION_PIXEL_OFFSET_CHANGED="paginationPixelOffsetChanged",n.EVENT_DISPLAYED_ROWS_CHANGED="displayedRowsChanged",n.EVENT_LEFT_PINNED_WIDTH_CHANGED="leftPinnedWidthChanged",n.EVENT_RIGHT_PINNED_WIDTH_CHANGED="rightPinnedWidthChanged",n.EVENT_ROW_CONTAINER_HEIGHT_CHANGED="rowContainerHeightChanged",n.EVENT_HEADER_HEIGHT_CHANGED="headerHeightChanged",n.EVENT_COLUMN_HEADER_HEIGHT_CHANGED="columnHeaderHeightChanged",n.EVENT_ROW_DRAG_ENTER="rowDragEnter",n.EVENT_ROW_DRAG_MOVE="rowDragMove",n.EVENT_ROW_DRAG_LEAVE="rowDragLeave",n.EVENT_ROW_DRAG_END="rowDragEnd",n.EVENT_GRID_STYLES_CHANGED="gridStylesChanged",n.EVENT_POPUP_TO_FRONT="popupToFront",n.EVENT_COLUMN_ROW_GROUP_CHANGE_REQUEST="columnRowGroupChangeRequest",n.EVENT_COLUMN_PIVOT_CHANGE_REQUEST="columnPivotChangeRequest",n.EVENT_COLUMN_VALUE_CHANGE_REQUEST="columnValueChangeRequest",n.EVENT_COLUMN_AGG_FUNC_CHANGE_REQUEST="columnAggFuncChangeRequest",n.EVENT_KEYBOARD_FOCUS="keyboardFocus",n.EVENT_MOUSE_FOCUS="mouseFocus",n.EVENT_STORE_UPDATED="storeUpdated",n.EVENT_FILTER_DESTROYED="filterDestroyed",n.EVENT_ROW_DATA_UPDATE_STARTED="rowDataUpdateStarted",n}(),GroupInstanceIdCreator=function(){function n(){this.existingIds={}}return n.prototype.getInstanceIdForKey=function(t){var e=this.existingIds[t],r;return typeof e!="number"?r=0:r=e+1,this.existingIds[t]=r,r},n}(),__extends$2_=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$2y=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},GROUP_AUTO_COLUMN_ID="ag-Grid-AutoColumn",AutoGroupColService=function(n){__extends$2_(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.createAutoGroupColumns=function(e,r){var o=this,s=[],l=this.gridOptionsService.isTreeData(),a=this.gridOptionsService.isGroupMultiAutoColumn();return l&&a&&(console.warn('AG Grid: you cannot mix groupDisplayType = "multipleColumns" with treeData, only one column can be used to display groups when doing tree data'),a=!1),a?r.forEach(function(h,y){s.push(o.createOneAutoGroupColumn(e,h,y))}):s.push(this.createOneAutoGroupColumn(e)),s},t.prototype.createOneAutoGroupColumn=function(e,r,o){var s=this.generateDefaultColDef(r),l;r?l=GROUP_AUTO_COLUMN_ID+"-"+r.getId():l=GROUP_AUTO_COLUMN_ID;var a=this.gridOptionsService.get("autoGroupColumnDef");if(mergeDeep(s,a),s=this.columnFactory.mergeColDefs(s,l),s.colId=l,!this.gridOptionsService.isTreeData()){var h=missing(s.field)&&missing(s.valueGetter)&&missing(s.filterValueGetter)&&s.filter!=="agGroupColumnFilter";h&&(s.filter=!1)}o&&o>0&&(s.headerCheckboxSelection=!1);var y=e.find(function(Y){return Y.getId()==l}),C=this.gridOptionsService.isColumnsSortingCoupledToGroup();if(y)return C&&(s.sort=void 0,s.sortIndex=void 0),y.setColDef(s,null),this.columnFactory.applyColumnState(y,s),y;C&&(s.sort||s.initialSort||"sortIndex"in s)&&!s.field&&(s.sort=null,s.sortIndex=null,s.initialSort=null);var L=new Column(s,null,l,!0);return this.context.createBean(L),L},t.prototype.generateDefaultColDef=function(e){var r=this.gridOptionsService.get("autoGroupColumnDef"),o=this.localeService.getLocaleTextFunc(),s={headerName:o("group","Group")},l=r&&(r.cellRenderer||r.cellRendererSelector);if(l||(s.cellRenderer="agGroupCellRenderer"),e){var a=e.getColDef();Object.assign(s,{headerName:this.columnModel.getDisplayNameForColumn(e,"header"),headerValueGetter:a.headerValueGetter}),a.cellRenderer&&Object.assign(s,{cellRendererParams:{innerRenderer:a.cellRenderer,innerRendererParams:a.cellRendererParams}}),s.showRowGroup=e.getColId()}else s.showRowGroup=!0;return s},__decorate$2y([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$2y([Autowired("columnFactory")],t.prototype,"columnFactory",void 0),t=__decorate$2y([Bean("autoGroupColService")],t),t}(BeanStub),reUnescapedHtml=/[&<>"']/g,HTML_ESCAPES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function utf8_encode(n){var t=String.fromCharCode;function e(L){var Y=[];if(!L)return[];for(var ze=L.length,Bt=0,Ir,Wr;Bt<ze;)Ir=L.charCodeAt(Bt++),Ir>=55296&&Ir<=56319&&Bt<ze?(Wr=L.charCodeAt(Bt++),(Wr&64512)==56320?Y.push(((Ir&1023)<<10)+(Wr&1023)+65536):(Y.push(Ir),Bt--)):Y.push(Ir);return Y}function r(L){if(L>=55296&&L<=57343)throw Error("Lone surrogate U+"+L.toString(16).toUpperCase()+" is not a scalar value")}function o(L,Y){return t(L>>Y&63|128)}function s(L){if(L>=0&&L<=31&&L!==10){var Y=L.toString(16).toUpperCase(),ze=Y.padStart(4,"0");return"_x"+ze+"_"}if(!(L&4294967168))return t(L);var Bt="";return L&4294965248?L&4294901760?L&4292870144||(Bt=t(L>>18&7|240),Bt+=o(L,12),Bt+=o(L,6)):(r(L),Bt=t(L>>12&15|224),Bt+=o(L,6)):Bt=t(L>>6&31|192),Bt+=t(L&63|128),Bt}for(var l=e(n),a=l.length,h=-1,y,C="";++h<a;)y=l[h],C+=s(y);return C}function capitalise(n){return n[0].toUpperCase()+n.substr(1).toLowerCase()}function escapeString(n,t){if(n==null)return null;var e=n.toString().toString();return t?e:e.replace(reUnescapedHtml,function(r){return HTML_ESCAPES[r]})}function camelCaseToHumanText(n){if(!n||n==null)return null;var t=/([a-z])([A-Z])/g,e=/([A-Z]+)([A-Z])([a-z])/g,r=n.replace(t,"$1 $2").replace(e,"$1 $2$3").replace(/\./g," ").split(" ");return r.map(function(o){return o.substring(0,1).toUpperCase()+(o.length>1?o.substring(1,o.length):"")}).join(" ")}function camelCaseToHyphenated(n){return n.replace(/[A-Z]/g,function(t){return"-"+t.toLocaleLowerCase()})}var StringUtils=Object.freeze({__proto__:null,utf8_encode,capitalise,escapeString,camelCaseToHumanText,camelCaseToHyphenated});function convertToMap(n){var t=new Map;return n.forEach(function(e){return t.set(e[0],e[1])}),t}function mapById(n,t){var e=new Map;return n.forEach(function(r){return e.set(t(r),r)}),e}function keys$1(n){var t=[];return n.forEach(function(e,r){return t.push(r)}),t}var MapUtils=Object.freeze({__proto__:null,convertToMap,mapById,keys:keys$1}),ColDefUtil=function(){function n(){}return n.ColDefPropertyMap={headerName:void 0,columnGroupShow:void 0,headerClass:void 0,toolPanelClass:void 0,headerValueGetter:void 0,pivotKeys:void 0,groupId:void 0,colId:void 0,sort:void 0,initialSort:void 0,field:void 0,type:void 0,cellDataType:void 0,tooltipComponent:void 0,tooltipField:void 0,headerTooltip:void 0,cellClass:void 0,showRowGroup:void 0,filter:void 0,initialAggFunc:void 0,defaultAggFunc:void 0,aggFunc:void 0,pinned:void 0,initialPinned:void 0,chartDataType:void 0,cellEditorPopupPosition:void 0,headerGroupComponent:void 0,headerGroupComponentParams:void 0,cellStyle:void 0,cellRenderer:void 0,cellRendererParams:void 0,cellEditor:void 0,cellEditorParams:void 0,filterParams:void 0,pivotValueColumn:void 0,headerComponent:void 0,headerComponentParams:void 0,floatingFilterComponent:void 0,floatingFilterComponentParams:void 0,tooltipComponentParams:void 0,refData:void 0,columnsMenuParams:void 0,children:void 0,sortingOrder:void 0,allowedAggFuncs:void 0,menuTabs:void 0,pivotTotalColumnIds:void 0,cellClassRules:void 0,icons:void 0,sortIndex:void 0,initialSortIndex:void 0,flex:void 0,initialFlex:void 0,width:void 0,initialWidth:void 0,minWidth:void 0,maxWidth:void 0,rowGroupIndex:void 0,initialRowGroupIndex:void 0,pivotIndex:void 0,initialPivotIndex:void 0,suppressCellFlash:void 0,suppressColumnsToolPanel:void 0,suppressFiltersToolPanel:void 0,openByDefault:void 0,marryChildren:void 0,suppressStickyLabel:void 0,hide:void 0,initialHide:void 0,rowGroup:void 0,initialRowGroup:void 0,pivot:void 0,initialPivot:void 0,checkboxSelection:void 0,showDisabledCheckboxes:void 0,headerCheckboxSelection:void 0,headerCheckboxSelectionFilteredOnly:void 0,headerCheckboxSelectionCurrentPageOnly:void 0,suppressMenu:void 0,suppressMovable:void 0,lockPosition:void 0,lockVisible:void 0,lockPinned:void 0,unSortIcon:void 0,suppressSizeToFit:void 0,suppressAutoSize:void 0,enableRowGroup:void 0,enablePivot:void 0,enableValue:void 0,editable:void 0,suppressPaste:void 0,suppressNavigable:void 0,enableCellChangeFlash:void 0,rowDrag:void 0,dndSource:void 0,autoHeight:void 0,wrapText:void 0,sortable:void 0,resizable:void 0,singleClickEdit:void 0,floatingFilter:void 0,cellEditorPopup:void 0,suppressFillHandle:void 0,wrapHeaderText:void 0,autoHeaderHeight:void 0,dndSourceOnRowDrag:void 0,valueGetter:void 0,valueSetter:void 0,filterValueGetter:void 0,keyCreator:void 0,valueFormatter:void 0,valueParser:void 0,comparator:void 0,equals:void 0,pivotComparator:void 0,suppressKeyboardEvent:void 0,suppressHeaderKeyboardEvent:void 0,colSpan:void 0,rowSpan:void 0,getQuickFilterText:void 0,onCellValueChanged:void 0,onCellClicked:void 0,onCellDoubleClicked:void 0,onCellContextMenu:void 0,rowDragText:void 0,tooltipValueGetter:void 0,cellRendererSelector:void 0,cellEditorSelector:void 0,suppressSpanHeaderHeight:void 0,useValueFormatterForExport:void 0,useValueParserForImport:void 0},n.ALL_PROPERTIES=Object.keys(n.ColDefPropertyMap),n}(),__read$u=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray$o=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n},PropertyKeys=function(){function n(){}return n.STRING_PROPERTIES=["rowSelection","overlayLoadingTemplate","overlayNoRowsTemplate","gridId","quickFilterText","rowModelType","editType","domLayout","clipboardDelimiter","rowGroupPanelShow","multiSortKey","pivotColumnGroupTotals","pivotRowTotals","pivotPanelShow","fillHandleDirection","serverSideStoreType","groupDisplayType","treeDataDisplayType","colResizeDefault"],n.OBJECT_PROPERTIES=["components","rowStyle","context","autoGroupColumnDef","localeText","icons","datasource","serverSideDatasource","viewportDatasource","groupRowRendererParams","aggFuncs","fullWidthCellRendererParams","defaultColGroupDef","defaultColDef","defaultCsvExportParams","defaultExcelExportParams","columnTypes","rowClassRules","detailCellRendererParams","loadingCellRendererParams","loadingOverlayComponentParams","noRowsOverlayComponentParams","popupParent","statusBar","sideBar","chartThemeOverrides","customChartThemes","chartToolPanelsDef","dataTypeDefinitions"],n.ARRAY_PROPERTIES=["sortingOrder","alignedGrids","rowData","columnDefs","excelStyles","pinnedTopRowData","pinnedBottomRowData","chartThemes","rowClass"],n.NUMBER_PROPERTIES=["rowHeight","detailRowHeight","rowBuffer","headerHeight","groupHeaderHeight","floatingFiltersHeight","pivotHeaderHeight","pivotGroupHeaderHeight","groupDefaultExpanded","viewportRowModelPageSize","viewportRowModelBufferSize","autoSizePadding","maxBlocksInCache","maxConcurrentDatasourceRequests","tooltipShowDelay","tooltipHideDelay","cacheOverflowSize","paginationPageSize","cacheBlockSize","infiniteInitialRowCount","serverSideInitialRowCount","scrollbarWidth","asyncTransactionWaitMillis","blockLoadDebounceMillis","keepDetailRowsCount","undoRedoCellEditingLimit","cellFlashDelay","cellFadeDelay","tabIndex"],n.BOOLEAN_PROPERTIES=["suppressMakeColumnVisibleAfterUnGroup","suppressRowClickSelection","suppressCellFocus","suppressHorizontalScroll","alwaysShowHorizontalScroll","alwaysShowVerticalScroll","debug","enableBrowserTooltips","enableCellExpressions","groupSelectsChildren","groupIncludeFooter","groupIncludeTotalFooter","groupSuppressBlankHeader","suppressMenuHide","suppressRowDeselection","unSortIcon","suppressMultiSort","alwaysMultiSort","singleClickEdit","suppressLoadingOverlay","suppressNoRowsOverlay","suppressAutoSize","skipHeaderOnAutoSize","suppressParentsInRowNodes","suppressColumnMoveAnimation","suppressMovableColumns","suppressFieldDotNotation","enableRangeSelection","enableRangeHandle","enableFillHandle","suppressClearOnFillReduction","deltaSort","suppressTouch","suppressAsyncEvents","allowContextMenuWithControlKey","suppressContextMenu","rememberGroupStateWhenNewData","enableCellChangeFlash","suppressDragLeaveHidesColumns","suppressRowGroupHidesColumns","suppressMiddleClickScrolls","suppressPreventDefaultOnMouseWheel","suppressCopyRowsToClipboard","copyHeadersToClipboard","copyGroupHeadersToClipboard","pivotMode","suppressAggFuncInHeader","suppressColumnVirtualisation","alwaysAggregateAtRootLevel","suppressAggAtRootLevel","suppressFocusAfterRefresh","functionsPassive","functionsReadOnly","animateRows","groupSelectsFiltered","groupRemoveSingleChildren","groupRemoveLowestSingleChildren","enableRtl","suppressClickEdit","rowDragEntireRow","rowDragManaged","suppressRowDrag","suppressMoveWhenRowDragging","rowDragMultiRow","enableGroupEdit","embedFullWidthRows","suppressPaginationPanel","groupHideOpenParents","groupAllowUnbalanced","pagination","paginationAutoPageSize","suppressScrollOnNewData","suppressScrollWhenPopupsAreOpen","purgeClosedRowNodes","cacheQuickFilter","includeHiddenColumnsInQuickFilter","excludeHiddenColumnsFromQuickFilter","ensureDomOrder","accentedSort","suppressChangeDetection","valueCache","valueCacheNeverExpires","aggregateOnlyChangedColumns","suppressAnimationFrame","suppressExcelExport","suppressCsvExport","treeData","masterDetail","suppressMultiRangeSelection","enterMovesDown","enterMovesDownAfterEdit","enterNavigatesVerticallyAfterEdit","enterNavigatesVertically","suppressPropertyNamesCheck","rowMultiSelectWithClick","suppressRowHoverHighlight","suppressRowTransform","suppressClipboardPaste","suppressLastEmptyLineOnPaste","enableCharts","enableChartToolPanelsButton","suppressChartToolPanelsButton","suppressMaintainUnsortedOrder","enableCellTextSelection","suppressBrowserResizeObserver","suppressMaxRenderedRowRestriction","excludeChildrenWhenTreeDataFiltering","tooltipMouseTrack","keepDetailRows","paginateChildRows","preventDefaultOnContextMenu","undoRedoCellEditing","allowDragFromColumnsToolPanel","pivotSuppressAutoColumn","suppressExpandablePivotGroups","debounceVerticalScrollbar","detailRowAutoHeight","serverSideFilteringAlwaysResets","serverSideFilterAllLevels","serverSideSortingAlwaysResets","serverSideSortAllLevels","serverSideOnlyRefreshFilteredGroups","serverSideSortOnServer","serverSideFilterOnServer","suppressAggFilteredOnly","showOpenedGroup","suppressClipboardApi","suppressModelUpdateAfterUpdateTransaction","stopEditingWhenCellsLoseFocus","maintainColumnOrder","groupMaintainOrder","columnHoverHighlight","suppressReactUi","readOnlyEdit","suppressRowVirtualisation","enableCellEditingOnBackspace","resetRowDataOnUpdate","removePivotHeaderRowWhenSingleValueColumn","suppressCopySingleCellRanges","suppressGroupRowsSticky","suppressServerSideInfiniteScroll","rowGroupPanelSuppressSort","allowShowChangeAfterFilter","suppressCutToClipboard"],n.FUNCTIONAL_PROPERTIES=["doesExternalFilterPass","processSecondaryColDef","processSecondaryColGroupDef","processPivotResultColDef","processPivotResultColGroupDef","getBusinessKeyForNode","isRowSelectable","rowDragText","groupRowRenderer","fullWidthCellRenderer","loadingCellRenderer","loadingOverlayComponent","noRowsOverlayComponent","detailCellRenderer"],n.CALLBACK_PROPERTIES=["getLocaleText","isExternalFilterPresent","getRowHeight","getRowClass","getRowStyle","getContextMenuItems","getMainMenuItems","processRowPostCreate","processCellForClipboard","getGroupRowAgg","isFullWidthRow","sendToClipboard","navigateToNextHeader","tabToNextHeader","navigateToNextCell","tabToNextCell","processCellFromClipboard","getDocument","postProcessPopup","getChildCount","getDataPath","isRowMaster","postSortRows","processHeaderForClipboard","processGroupHeaderForClipboard","paginationNumberFormatter","processDataFromClipboard","getServerSideGroupKey","isServerSideGroup","createChartContainer","getChartToolbarItems","fillOperation","isApplyServerSideTransaction","getServerSideStoreParams","getServerSideGroupLevelParams","isServerSideGroupOpenByDefault","isGroupOpenByDefault","initialGroupOrderComparator","loadingCellRendererSelector","getRowId","groupAggFiltering"],n.FUNCTION_PROPERTIES=__spreadArray$o(__spreadArray$o([],__read$u(n.FUNCTIONAL_PROPERTIES)),__read$u(n.CALLBACK_PROPERTIES)),n.ALL_PROPERTIES=__spreadArray$o(__spreadArray$o(__spreadArray$o(__spreadArray$o(__spreadArray$o(__spreadArray$o([],__read$u(n.ARRAY_PROPERTIES)),__read$u(n.OBJECT_PROPERTIES)),__read$u(n.STRING_PROPERTIES)),__read$u(n.NUMBER_PROPERTIES)),__read$u(n.FUNCTION_PROPERTIES)),__read$u(n.BOOLEAN_PROPERTIES)),n}(),__assign$l=function(){return __assign$l=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},__assign$l.apply(this,arguments)},__read$t=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray$n=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n},ComponentUtil=function(){function n(){}return n.getCallbackForEvent=function(t){return!t||t.length<2?t:"on"+t[0].toUpperCase()+t.substr(1)},n.getCoercionLookup=function(){var t={};return __spreadArray$n(__spreadArray$n(__spreadArray$n(__spreadArray$n(__spreadArray$n([],__read$t(n.ARRAY_PROPERTIES)),__read$t(n.OBJECT_PROPERTIES)),__read$t(n.STRING_PROPERTIES)),__read$t(n.FUNCTION_PROPERTIES)),__read$t(n.EVENT_CALLBACKS)).forEach(function(e){return t[e]="none"}),n.BOOLEAN_PROPERTIES.forEach(function(e){return t[e]="boolean"}),n.NUMBER_PROPERTIES.forEach(function(e){return t[e]="number"}),t},n.getValue=function(t,e){var r=n.coercionLookup[t];if(r){var o=e;switch(r){case"number":{o=n.toNumber(e);break}case"boolean":{o=n.toBoolean(e);break}case"none":{t==="groupAggFiltering"&&typeof e!="function"&&(o=n.toBoolean(e));break}}return o}},n.getGridOptionKeys=function(t,e){return Object.keys(e?n.coercionLookup:t)},n.copyAttributesToGridOptions=function(t,e,r){r===void 0&&(r=!1),typeof t!="object"&&(t={});var o=t,s=n.getGridOptionKeys(e,r);return s.forEach(function(l){var a=e[l];if(typeof a<"u"){var h=n.getValue(l,a);h!==void 0&&(o[l]=h)}}),t},n.processOnChange=function(t,e){if(!(!t||Object.keys(t).length===0)){var r=__assign$l({},t);r.columnTypes&&(e.setColumnTypes(r.columnTypes.currentValue,"gridOptionsChanged"),delete r.columnTypes),r.autoGroupColumnDef&&(e.setAutoGroupColumnDef(r.autoGroupColumnDef.currentValue,"gridOptionsChanged"),delete r.autoGroupColumnDef),r.defaultColDef&&(e.setDefaultColDef(r.defaultColDef.currentValue,"gridOptionsChanged"),delete r.defaultColDef),r.columnDefs&&(e.setColumnDefs(r.columnDefs.currentValue,"gridOptionsChanged"),delete r.columnDefs),Object.keys(r).forEach(function(s){var l=s,a=n.getValue(l,r[l].currentValue);e.__setProperty(l,a)});var o={type:Events.EVENT_COMPONENT_STATE_CHANGED};iterateObject(t,function(s,l){o[s]=l}),e.dispatchEvent(o)}},n.toBoolean=function(t){return typeof t=="boolean"?t:typeof t=="string"?t.toUpperCase()==="TRUE"||t=="":!1},n.toNumber=function(t){if(typeof t=="number")return t;if(typeof t=="string")return Number(t)},n.EVENTS=values(Events),n.EXCLUDED_INTERNAL_EVENTS=[Events.EVENT_SCROLLBAR_WIDTH_CHANGED,Events.EVENT_CHECKBOX_CHANGED,Events.EVENT_HEIGHT_SCALE_CHANGED,Events.EVENT_BODY_HEIGHT_CHANGED,Events.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED,Events.EVENT_SCROLL_VISIBILITY_CHANGED,Events.EVENT_COLUMN_HOVER_CHANGED,Events.EVENT_FLASH_CELLS,Events.EVENT_PAGINATION_PIXEL_OFFSET_CHANGED,Events.EVENT_DISPLAYED_ROWS_CHANGED,Events.EVENT_LEFT_PINNED_WIDTH_CHANGED,Events.EVENT_RIGHT_PINNED_WIDTH_CHANGED,Events.EVENT_ROW_CONTAINER_HEIGHT_CHANGED,Events.EVENT_POPUP_TO_FRONT,Events.EVENT_KEYBOARD_FOCUS,Events.EVENT_MOUSE_FOCUS,Events.EVENT_STORE_UPDATED,Events.EVENT_COLUMN_PANEL_ITEM_DRAG_START,Events.EVENT_COLUMN_PANEL_ITEM_DRAG_END,Events.EVENT_FILL_START,Events.EVENT_FILL_END,Events.EVENT_KEY_SHORTCUT_CHANGED_CELL_START,Events.EVENT_KEY_SHORTCUT_CHANGED_CELL_END,Events.EVENT_FULL_WIDTH_ROW_FOCUSED,Events.EVENT_HEADER_HEIGHT_CHANGED,Events.EVENT_COLUMN_HEADER_HEIGHT_CHANGED,Events.EVENT_CELL_FOCUS_CLEARED,Events.EVENT_GRID_STYLES_CHANGED,Events.EVENT_FILTER_DESTROYED,Events.EVENT_ROW_DATA_UPDATE_STARTED],n.PUBLIC_EVENTS=n.EVENTS.filter(function(t){return!includes(n.EXCLUDED_INTERNAL_EVENTS,t)}),n.EVENT_CALLBACKS=n.EVENTS.map(function(t){return n.getCallbackForEvent(t)}),n.STRING_PROPERTIES=PropertyKeys.STRING_PROPERTIES,n.OBJECT_PROPERTIES=PropertyKeys.OBJECT_PROPERTIES,n.ARRAY_PROPERTIES=PropertyKeys.ARRAY_PROPERTIES,n.NUMBER_PROPERTIES=PropertyKeys.NUMBER_PROPERTIES,n.BOOLEAN_PROPERTIES=PropertyKeys.BOOLEAN_PROPERTIES,n.FUNCTION_PROPERTIES=PropertyKeys.FUNCTION_PROPERTIES,n.ALL_PROPERTIES=PropertyKeys.ALL_PROPERTIES,n.ALL_PROPERTIES_SET=new Set(PropertyKeys.ALL_PROPERTIES),n.coercionLookup=n.getCoercionLookup(),n}();function fuzzyCheckStrings(n,t,e){var r={},o=n.filter(function(s){return!t.some(function(l){return l===s})});return o.length>0&&o.forEach(function(s){return r[s]=fuzzySuggestions(s,e)}),r}function fuzzySuggestions(n,t,e,r){var o=t.map(function(a){return{value:a,relevance:stringWeightedDistances(n.toLowerCase(),a.toLocaleLowerCase())}});if(o.sort(function(a,h){return h.relevance-a.relevance}),e&&(o=o.filter(function(a){return a.relevance!==0})),r&&r>0){var s=o[0].relevance,l=s*r;o=o.filter(function(a){return l-a.relevance<0})}return o.map(function(a){return a.value})}function stringWeightedDistances(n,t){for(var e=n.replace(/\s/g,""),r=t.replace(/\s/g,""),o=0,s=-1,l=0;l<e.length;l++){var a=r.indexOf(e[l],s+1);a!==-1&&(s=a,o+=100-s*100/1e4*100)}return o}var FuzzyMatchUtils=Object.freeze({__proto__:null,fuzzyCheckStrings,fuzzySuggestions}),__decorate$2x=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__read$s=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray$m=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n};function logDeprecation(n,t,e,r){var o=e?"Please use '"+e+"' instead. ":"";doOnce(function(){return console.warn("AG Grid: since v"+n+", '"+t+"' is deprecated. "+o+(r??""))},"Deprecated_"+t)}var VUE_FRAMEWORK_PROPS=["__ob__","__v_skip","__metadata__"],GridOptionsValidator=function(){function n(){this.deprecatedProperties={rememberGroupStateWhenNewData:{version:"24",message:"Now that transaction updates are possible and they keep group state, this feature is no longer needed."},serverSideFilteringAlwaysResets:{version:"28.0",newProp:"serverSideOnlyRefreshFilteredGroups",copyToNewProp:!0},serverSideSortingAlwaysResets:{version:"28.0",newProp:"serverSideSortAllLevels",copyToNewProp:!0},suppressReactUi:{version:"28",message:"The legacy React rendering engine is deprecated and will be removed in the next major version of the grid."},processSecondaryColDef:{version:"28",newProp:"processPivotResultColDef",copyToNewProp:!0},processSecondaryColGroupDef:{version:"28",newProp:"processPivotResultColGroupDef",copyToNewProp:!0},getServerSideStoreParams:{version:"28",newProp:"getServerSideGroupLevelParams",copyToNewProp:!0},serverSideInfiniteScroll:{version:"29",message:"Infinite Scrolling is now the default behaviour. This can be suppressed with `suppressServerSideInfiniteScroll`."},enableChartToolPanelsButton:{version:"29",message:"The Chart Tool Panels button is now enabled by default. To hide the Chart Tool Panels button and display the hamburger button instead, set suppressChartToolPanelsButton=true."},functionsPassive:{version:"29.2"},onColumnRowGroupChangeRequest:{version:"29.2"},onColumnPivotChangeRequest:{version:"29.2"},onColumnValueChangeRequest:{version:"29.2"},onColumnAggFuncChangeRequest:{version:"29.2"},serverSideFilterAllLevels:{version:"30",message:"All server-side group levels are now filtered by default. This can be toggled using `serverSideOnlyRefreshFilteredGroups`."},suppressAggAtRootLevel:{version:"30",message:"The root level aggregation is now suppressed by default. This can be toggled using  `alwaysAggregateAtRootLevel`."},excludeHiddenColumnsFromQuickFilter:{version:"30",message:"Hidden columns are now excluded from the Quick Filter by default. This can be toggled using `includeHiddenColumnsInQuickFilter`."},enterMovesDown:{version:"30",newProp:"enterNavigatesVertically",copyToNewProp:!0},enterMovesDownAfterEdit:{version:"30",newProp:"enterNavigatesVerticallyAfterEdit",copyToNewProp:!0}}}return n.prototype.pickOneWarning=function(t,e){console.warn("AG Grid: "+t+" and "+e+" do not work with each other, you need to pick one.")},n.prototype.init=function(){var t=this;if(this.checkForDeprecated(),this.checkForViolations(),this.gridOptions.suppressPropertyNamesCheck!==!0&&(this.checkGridOptionsProperties(),this.checkColumnDefProperties()),this.checkColumnDefViolations(),this.gridOptionsService.is("groupSelectsChildren")&&this.gridOptionsService.is("suppressParentsInRowNodes")&&console.warn("AG Grid: 'groupSelectsChildren' does not work with 'suppressParentsInRowNodes', this selection method needs the part in rowNode to work"),this.gridOptionsService.is("groupSelectsChildren")&&this.gridOptionsService.get("rowSelection")!=="multiple"&&console.warn("AG Grid: rowSelection must be 'multiple' for groupSelectsChildren to make sense"),this.gridOptionsService.is("groupRemoveSingleChildren")&&this.gridOptionsService.is("groupHideOpenParents")&&this.pickOneWarning("groupRemoveSingleChildren","groupHideOpenParents"),this.gridOptionsService.isRowModelType("serverSide")){var e=function(o,s){return"AG Grid: '"+o+"' is not supported on the Server-Side Row Model."+(s?" Please use "+s+" instead.":"")};this.gridOptionsService.exists("groupDefaultExpanded")&&console.warn(e("groupDefaultExpanded","isServerSideGroupOpenByDefault callback")),this.gridOptionsService.exists("groupIncludeFooter")&&this.gridOptionsService.is("suppressServerSideInfiniteScroll")&&console.warn(e("groupIncludeFooter")),this.gridOptionsService.exists("groupIncludeTotalFooter")&&console.warn(e("groupIncludeTotalFooter"))}this.gridOptionsService.is("enableRangeSelection")?ModuleRegistry.__assertRegistered(ModuleNames.RangeSelectionModule,"enableRangeSelection",this.gridOptionsService.getGridId()):(this.gridOptionsService.is("enableRangeHandle")||this.gridOptionsService.is("enableFillHandle"))&&console.warn("AG Grid: 'enableRangeHandle' or 'enableFillHandle' will not work unless 'enableRangeSelection' is set to true");var r=function(o,s){return t.gridOptionsService.exists(o)&&ModuleRegistry.__assertRegistered(s,o,t.gridOptionsService.getGridId())};r("sideBar",ModuleNames.SideBarModule),r("statusBar",ModuleNames.StatusBarModule),r("enableCharts",ModuleNames.GridChartsModule),r("getMainMenuItems",ModuleNames.MenuModule),r("getContextMenuItems",ModuleNames.MenuModule),r("allowContextMenuWithControlKey",ModuleNames.MenuModule)},n.prototype.checkColumnDefProperties=function(){var t=this;if(this.gridOptions.columnDefs!=null){var e=ColDefUtil.ALL_PROPERTIES,r=function(o,s){var l=Object.getOwnPropertyNames(o);t.checkProperties(l,__spreadArray$m(__spreadArray$m([],__read$s(e)),__read$s(VUE_FRAMEWORK_PROPS)),e,s,"https://www.ag-grid.com/javascript-data-grid/column-properties/"),o.children&&o.children.forEach(function(a){return r(a,"columnDefs.children")})};this.gridOptions.columnDefs.forEach(function(o){return r(o,"columnDefs")}),this.gridOptions.defaultColDef&&r(this.gridOptions.defaultColDef,"defaultColDef")}},n.prototype.checkColumnDefViolations=function(){var t,e=(t=this.gridOptionsService.get("rowModelType"))!==null&&t!==void 0?t:"clientSide",r={infinite:["headerCheckboxSelection","headerCheckboxSelectionFilteredOnly","headerCheckboxSelectionCurrentPageOnly"],viewport:["headerCheckboxSelection","headerCheckboxSelectionFilteredOnly","headerCheckboxSelectionCurrentPageOnly"],serverSide:["headerCheckboxSelectionFilteredOnly","headerCheckboxSelectionCurrentPageOnly"],clientSide:[]},o=r[e];if(o!=null&&o.length){var s=function(l){o.forEach(function(a){a in l&&l[a]&&console.warn("AG Grid: Column property "+a+" is not supported with the row model type "+e+".")})};this.gridOptions.columnDefs!=null&&this.gridOptions.columnDefs.forEach(function(l){return s(l)}),this.gridOptions.autoGroupColumnDef!=null&&s(this.gridOptions.autoGroupColumnDef),this.gridOptions.defaultColDef!=null&&s(this.gridOptions.defaultColDef)}},n.prototype.checkGridOptionsProperties=function(){var t=Object.getOwnPropertyNames(this.gridOptions),e=__spreadArray$m(__spreadArray$m([],__read$s(PropertyKeys.ALL_PROPERTIES)),__read$s(ComponentUtil.EVENT_CALLBACKS)),r=__spreadArray$m(__spreadArray$m(__spreadArray$m(__spreadArray$m([],__read$s(e)),["api","columnApi"]),__read$s(VUE_FRAMEWORK_PROPS)),__read$s(Object.keys(this.deprecatedProperties)));this.checkProperties(t,r,e,"gridOptions","https://www.ag-grid.com/javascript-data-grid/grid-options/")},n.prototype.checkProperties=function(t,e,r,o,s){var l=fuzzyCheckStrings(t,e,r);iterateObject(l,function(a,h){doOnce(function(){return console.warn("AG Grid: invalid "+o+" property '"+a+"' did you mean any of these: "+h.slice(0,8).join(", "))},"invalidProperty"+o+a)}),Object.keys(l).length>0&&doOnce(function(){return console.warn("AG Grid: to see all the valid "+o+" properties please check: "+s)},"invalidProperties"+o+s)},n.prototype.checkForDeprecated=function(){var t=this.gridOptions;Object.entries(this.deprecatedProperties).forEach(function(e){var r,o=__read$s(e,2),s=o[0],l=o[1],a=t[s];a&&(logDeprecation(l.version,s,l.newProp,l.message),l.copyToNewProp&&l.newProp&&t[l.newProp]==null&&(t[l.newProp]=(r=l.newPropValue)!==null&&r!==void 0?r:a))}),t.serverSideStoreType&&(console.warn("AG Grid: since v29.0, `serverSideStoreType` has been replaced by `suppressServerSideInfiniteScroll`. Set to false to use Partial Store, and true to use Full Store."),t.suppressServerSideInfiniteScroll=t.serverSideStoreType!=="partial")},n.prototype.checkForViolations=function(){this.gridOptionsService.is("treeData")&&this.treeDataViolations()},n.prototype.treeDataViolations=function(){this.gridOptionsService.isRowModelType("clientSide")&&(this.gridOptionsService.exists("getDataPath")||console.warn("AG Grid: property usingTreeData=true with rowModel=clientSide, but you did not provide getDataPath function, please provide getDataPath function if using tree data.")),this.gridOptionsService.isRowModelType("serverSide")&&(this.gridOptionsService.exists("isServerSideGroup")||console.warn("AG Grid: property usingTreeData=true with rowModel=serverSide, but you did not provide isServerSideGroup function, please provide isServerSideGroup function if using tree data."),this.gridOptionsService.exists("getServerSideGroupKey")||console.warn("AG Grid: property usingTreeData=true with rowModel=serverSide, but you did not provide getServerSideGroupKey function, please provide getServerSideGroupKey function if using tree data."))},__decorate$2x([Autowired("gridOptions")],n.prototype,"gridOptions",void 0),__decorate$2x([Autowired("gridOptionsService")],n.prototype,"gridOptionsService",void 0),__decorate$2x([PostConstruct],n.prototype,"init",null),n=__decorate$2x([Bean("gridOptionsValidator")],n),n}();function matchesGroupDisplayType(n,t){var e=["groupRows","multipleColumns","custom","singleColumn"];return e.indexOf(t)<0?(console.warn("AG Grid: '"+t+"' is not a valid groupDisplayType value - possible values are: '"+e.join("', '")+"'"),!1):t===n}function matchesTreeDataDisplayType(n,t){var e=["auto","custom"];return e.indexOf(t)<0?(console.warn("AG Grid: '"+t+"' is not a valid treeDataDisplayType value - possible values are: '"+e.join("', '")+"'"),!1):t===n}var __extends$2Z=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$2w=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__param$8=function(n,t){return function(e,r){t(e,r,n)}},__rest=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(n);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(n,r[o])&&(e[r[o]]=n[r[o]]);return e},__values$6=function(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],r=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},__read$r=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray$l=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n},ColumnModel=function(n){__extends$2Z(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.primaryHeaderRowCount=0,e.secondaryHeaderRowCount=0,e.gridHeaderRowCount=0,e.displayedColumnsLeft=[],e.displayedColumnsRight=[],e.displayedColumnsCenter=[],e.displayedColumns=[],e.displayedColumnsAndGroupsMap={},e.viewportColumns=[],e.viewportColumnsHash="",e.headerViewportColumns=[],e.viewportColumnsCenter=[],e.headerViewportColumnsCenter=[],e.autoHeightActiveAtLeastOnce=!1,e.rowGroupColumns=[],e.valueColumns=[],e.pivotColumns=[],e.ready=!1,e.autoGroupsNeedBuilding=!1,e.forceRecreateAutoGroups=!1,e.pivotMode=!1,e.bodyWidth=0,e.leftWidth=0,e.rightWidth=0,e.bodyWidthDirty=!0,e.shouldQueueResizeOperations=!1,e.resizeOperationQueue=[],e}return t.prototype.init=function(){var e=this;this.suppressColumnVirtualisation=this.gridOptionsService.is("suppressColumnVirtualisation");var r=this.gridOptionsService.is("pivotMode");this.isPivotSettingAllowed(r)&&(this.pivotMode=r),this.usingTreeData=this.gridOptionsService.isTreeData(),this.addManagedPropertyListener("groupDisplayType",function(){return e.onAutoGroupColumnDefChanged()}),this.addManagedPropertyListener("autoGroupColumnDef",function(){return e.onAutoGroupColumnDefChanged()}),this.addManagedPropertyListener("defaultColDef",function(o){return e.onSharedColDefChanged(o.source)}),this.addManagedPropertyListener("columnTypes",function(o){return e.onSharedColDefChanged(o.source)})},t.prototype.onAutoGroupColumnDefChanged=function(){this.columnDefs&&(this.autoGroupsNeedBuilding=!0,this.forceRecreateAutoGroups=!0,this.updateGridColumns(),this.updateDisplayedColumns("gridOptionsChanged"))},t.prototype.onSharedColDefChanged=function(e){e===void 0&&(e="api"),this.forceRecreateAutoGroups=!0,this.createColumnsFromColumnDefs(!0,e)},t.prototype.setColumnDefs=function(e,r){r===void 0&&(r="api");var o=!!this.columnDefs;this.columnDefs=e,this.createColumnsFromColumnDefs(o,r)},t.prototype.recreateColumnDefs=function(e){e===void 0&&(e="api"),this.onSharedColDefChanged(e)},t.prototype.destroyOldColumns=function(e,r){var o={};if(e){this.columnUtils.depthFirstOriginalTreeSearch(null,e,function(l){o[l.getInstanceId()]=l}),r&&this.columnUtils.depthFirstOriginalTreeSearch(null,r,function(l){o[l.getInstanceId()]=null});var s=Object.values(o).filter(function(l){return l!=null});this.destroyBeans(s)}},t.prototype.destroyColumns=function(){this.destroyOldColumns(this.primaryColumnTree),this.destroyOldColumns(this.secondaryBalancedTree),this.destroyOldColumns(this.groupAutoColsBalancedTree)},t.prototype.createColumnsFromColumnDefs=function(e,r){var o=this;r===void 0&&(r="api");var s=e?this.compareColumnStatesAndDispatchEvents(r):void 0;this.valueCache.expire(),this.autoGroupsNeedBuilding=!0;var l=this.primaryColumns,a=this.primaryColumnTree,h=this.columnFactory.createColumnTree(this.columnDefs,!0,a);this.destroyOldColumns(this.primaryColumnTree,h.columnTree),this.primaryColumnTree=h.columnTree,this.primaryHeaderRowCount=h.treeDept+1,this.primaryColumns=this.getColumnsFromTree(this.primaryColumnTree),this.primaryColumnsMap={},this.primaryColumns.forEach(function(L){return o.primaryColumnsMap[L.getId()]=L}),this.extractRowGroupColumns(r,l),this.extractPivotColumns(r,l),this.extractValueColumns(r,l),this.ready=!0;var y=this.gridColsArePrimary===void 0,C=this.gridColsArePrimary||y;C&&(this.updateGridColumns(),e&&!this.gridOptionsService.is("maintainColumnOrder")&&this.orderGridColumnsLikePrimary(),this.updateDisplayedColumns(r),this.checkViewportColumns()),this.dispatchEverythingChanged(r),s&&s(),this.dispatchNewColumnsLoaded()},t.prototype.dispatchNewColumnsLoaded=function(){var e={type:Events.EVENT_NEW_COLUMNS_LOADED};this.eventService.dispatchEvent(e)},t.prototype.dispatchEverythingChanged=function(e){e===void 0&&(e="api");var r={type:Events.EVENT_COLUMN_EVERYTHING_CHANGED,source:e};this.eventService.dispatchEvent(r)},t.prototype.orderGridColumnsLikePrimary=function(){var e=this,r=this.primaryColumns;r&&(this.gridColumns.sort(function(o,s){var l=r.indexOf(o),a=r.indexOf(s),h=l>=0,y=a>=0;if(h&&y)return l-a;if(h)return 1;if(y)return-1;var C=e.gridColumns.indexOf(o),L=e.gridColumns.indexOf(s);return C-L}),this.gridColumns=this.placeLockedColumns(this.gridColumns))},t.prototype.getAllDisplayedAutoHeightCols=function(){return this.displayedAutoHeightCols},t.prototype.setViewport=function(){this.gridOptionsService.is("enableRtl")?(this.viewportLeft=this.bodyWidth-this.scrollPosition-this.scrollWidth,this.viewportRight=this.bodyWidth-this.scrollPosition):(this.viewportLeft=this.scrollPosition,this.viewportRight=this.scrollWidth+this.scrollPosition)},t.prototype.getDisplayedColumnsStartingAt=function(e){for(var r=e,o=[];r!=null;)o.push(r),r=this.getDisplayedColAfter(r);return o},t.prototype.checkViewportColumns=function(){if(this.displayedColumnsCenter!=null){var e=this.extractViewport();if(e){var r={type:Events.EVENT_VIRTUAL_COLUMNS_CHANGED};this.eventService.dispatchEvent(r)}}},t.prototype.setViewportPosition=function(e,r){(e!==this.scrollWidth||r!==this.scrollPosition||this.bodyWidthDirty)&&(this.scrollWidth=e,this.scrollPosition=r,this.bodyWidthDirty=!0,this.setViewport(),this.ready&&this.checkViewportColumns())},t.prototype.isPivotMode=function(){return this.pivotMode},t.prototype.isPivotSettingAllowed=function(e){return e&&this.gridOptionsService.isTreeData()?(console.warn("AG Grid: Pivot mode not available in conjunction Tree Data i.e. 'gridOptions.treeData: true'"),!1):!0},t.prototype.setPivotMode=function(e,r){if(r===void 0&&(r="api"),!(e===this.pivotMode||!this.isPivotSettingAllowed(this.pivotMode))){this.pivotMode=e,this.autoGroupsNeedBuilding=!0,this.updateGridColumns(),this.updateDisplayedColumns(r);var o={type:Events.EVENT_COLUMN_PIVOT_MODE_CHANGED};this.eventService.dispatchEvent(o)}},t.prototype.getSecondaryPivotColumn=function(e,r){if(missing(this.secondaryColumns))return null;var o=this.getPrimaryColumn(r),s=null;return this.secondaryColumns.forEach(function(l){var a=l.getColDef().pivotKeys,h=l.getColDef().pivotValueColumn,y=areEqual(a,e),C=h===o;y&&C&&(s=l)}),s},t.prototype.setBeans=function(e){this.logger=e.create("columnModel")},t.prototype.setFirstRightAndLastLeftPinned=function(e){var r,o;this.gridOptionsService.is("enableRtl")?(r=this.displayedColumnsLeft?this.displayedColumnsLeft[0]:null,o=this.displayedColumnsRight?last(this.displayedColumnsRight):null):(r=this.displayedColumnsLeft?last(this.displayedColumnsLeft):null,o=this.displayedColumnsRight?this.displayedColumnsRight[0]:null),this.gridColumns.forEach(function(s){s.setLastLeftPinned(s===r,e),s.setFirstRightPinned(s===o,e)})},t.prototype.autoSizeColumns=function(e){var r=this;if(this.shouldQueueResizeOperations){this.resizeOperationQueue.push(function(){return r.autoSizeColumns(e)});return}var o=e.columns,s=e.skipHeader,l=e.skipHeaderGroups,a=e.stopAtGroup,h=e.source,y=h===void 0?"api":h;this.animationFrameService.flushAllFrames();for(var C=[],L=-1,Y=s??this.gridOptionsService.is("skipHeaderOnAutoSize"),ze=l??Y;L!==0;)L=0,this.actionOnGridColumns(o,function(Bt){if(C.indexOf(Bt)>=0)return!1;var Ir=r.autoWidthCalculator.getPreferredWidthForColumn(Bt,Y);if(Ir>0){var Wr=r.normaliseColumnWidth(Bt,Ir);Bt.setActualWidth(Wr,y),C.push(Bt),L++}return!0},y);ze||this.autoSizeColumnGroupsByColumns(o,y,a),this.dispatchColumnResizedEvent(C,!0,"autosizeColumns")},t.prototype.dispatchColumnResizedEvent=function(e,r,o,s){if(s===void 0&&(s=null),e&&e.length){var l={type:Events.EVENT_COLUMN_RESIZED,columns:e,column:e.length===1?e[0]:null,flexColumns:s,finished:r,source:o};this.eventService.dispatchEvent(l)}},t.prototype.dispatchColumnChangedEvent=function(e,r,o){var s={type:e,columns:r,column:r&&r.length==1?r[0]:null,source:o};this.eventService.dispatchEvent(s)},t.prototype.dispatchColumnMovedEvent=function(e){var r=e.movedColumns,o=e.source,s=e.toIndex,l=e.finished,a={type:Events.EVENT_COLUMN_MOVED,columns:r,column:r&&r.length===1?r[0]:null,toIndex:s,finished:l,source:o};this.eventService.dispatchEvent(a)},t.prototype.dispatchColumnPinnedEvent=function(e,r){if(e.length){var o=e.length===1?e[0]:null,s=this.getCommonValue(e,function(a){return a.getPinned()}),l={type:Events.EVENT_COLUMN_PINNED,pinned:s??null,columns:e,column:o,source:r};this.eventService.dispatchEvent(l)}},t.prototype.dispatchColumnVisibleEvent=function(e,r){if(e.length){var o=e.length===1?e[0]:null,s=this.getCommonValue(e,function(a){return a.isVisible()}),l={type:Events.EVENT_COLUMN_VISIBLE,visible:s,columns:e,column:o,source:r};this.eventService.dispatchEvent(l)}},t.prototype.autoSizeColumn=function(e,r,o){o===void 0&&(o="api"),e&&this.autoSizeColumns({columns:[e],skipHeader:r,skipHeaderGroups:!0,source:o})},t.prototype.autoSizeColumnGroupsByColumns=function(e,r,o){var s,l,a,h,y=new Set,C=this.getGridColumns(e);C.forEach(function(vi){for(var wo=vi.getParent();wo&&wo!=o;)wo.isPadding()||y.add(wo),wo=wo.getParent()});var L,Y=[];try{for(var ze=__values$6(y),Bt=ze.next();!Bt.done;Bt=ze.next()){var Ir=Bt.value;try{for(var Wr=(a=void 0,__values$6(this.ctrlsService.getHeaderRowContainerCtrls())),yi=Wr.next();!yi.done;yi=Wr.next()){var Bn=yi.value;if(L=Bn.getHeaderCtrlForColumn(Ir),L)break}}catch(vi){a={error:vi}}finally{try{yi&&!yi.done&&(h=Wr.return)&&h.call(Wr)}finally{if(a)throw a.error}}L&&L.resizeLeafColumnsToFit(r)}}catch(vi){s={error:vi}}finally{try{Bt&&!Bt.done&&(l=ze.return)&&l.call(ze)}finally{if(s)throw s.error}}return Y},t.prototype.autoSizeAllColumns=function(e,r){var o=this;if(r===void 0&&(r="api"),this.shouldQueueResizeOperations){this.resizeOperationQueue.push(function(){return o.autoSizeAllColumns(e,r)});return}var s=this.getAllDisplayedColumns();this.autoSizeColumns({columns:s,skipHeader:e,source:r})},t.prototype.getColumnsFromTree=function(e){var r=[],o=function(s){for(var l=0;l<s.length;l++){var a=s[l];a instanceof Column?r.push(a):a instanceof ProvidedColumnGroup&&o(a.getChildren())}};return o(e),r},t.prototype.getAllDisplayedTrees=function(){return this.displayedTreeLeft&&this.displayedTreeRight&&this.displayedTreeCentre?this.displayedTreeLeft.concat(this.displayedTreeCentre).concat(this.displayedTreeRight):null},t.prototype.getPrimaryColumnTree=function(){return this.primaryColumnTree},t.prototype.getHeaderRowCount=function(){return this.gridHeaderRowCount},t.prototype.getDisplayedTreeLeft=function(){return this.displayedTreeLeft},t.prototype.getDisplayedTreeRight=function(){return this.displayedTreeRight},t.prototype.getDisplayedTreeCentre=function(){return this.displayedTreeCentre},t.prototype.isColumnDisplayed=function(e){return this.getAllDisplayedColumns().indexOf(e)>=0},t.prototype.getAllDisplayedColumns=function(){return this.displayedColumns},t.prototype.getViewportColumns=function(){return this.viewportColumns},t.prototype.getDisplayedLeftColumnsForRow=function(e){return this.colSpanActive?this.getDisplayedColumnsForRow(e,this.displayedColumnsLeft):this.displayedColumnsLeft},t.prototype.getDisplayedRightColumnsForRow=function(e){return this.colSpanActive?this.getDisplayedColumnsForRow(e,this.displayedColumnsRight):this.displayedColumnsRight},t.prototype.isColSpanActive=function(){return this.colSpanActive},t.prototype.getDisplayedColumnsForRow=function(e,r,o,s){for(var l=[],a=null,h=function(L){var Y=r[L],ze=r.length-L,Bt=Math.min(Y.getColSpan(e),ze),Ir=[Y];if(Bt>1){for(var Wr=Bt-1,yi=1;yi<=Wr;yi++)Ir.push(r[L+yi]);L+=Wr}var Bn;if(o?(Bn=!1,Ir.forEach(function(wo){o(wo)&&(Bn=!0)})):Bn=!0,Bn){if(l.length===0&&a){var vi=s?s(Y):!1;vi&&l.push(a)}l.push(Y)}a=Y,y=L},y,C=0;C<r.length;C++)h(C),C=y;return l},t.prototype.getViewportCenterColumnsForRow=function(e){var r=this;if(!this.colSpanActive)return this.viewportColumnsCenter;var o=function(l){var a=l.getLeft();return exists(a)&&a>r.viewportLeft},s=this.suppressColumnVirtualisation?null:this.isColumnInRowViewport.bind(this);return this.getDisplayedColumnsForRow(e,this.displayedColumnsCenter,s,o)},t.prototype.getAriaColumnIndex=function(e){return this.getAllGridColumns().indexOf(e)+1},t.prototype.isColumnInHeaderViewport=function(e){return e.isAutoHeaderHeight()?!0:this.isColumnInRowViewport(e)},t.prototype.isColumnInRowViewport=function(e){if(e.isAutoHeight())return!0;var r=e.getLeft()||0,o=r+e.getActualWidth(),s=this.viewportLeft-200,l=this.viewportRight+200,a=r<s&&o<s,h=r>l&&o>l;return!a&&!h},t.prototype.getDisplayedColumnsLeftWidth=function(){return this.getWidthOfColsInList(this.displayedColumnsLeft)},t.prototype.getDisplayedColumnsRightWidth=function(){return this.getWidthOfColsInList(this.displayedColumnsRight)},t.prototype.updatePrimaryColumnList=function(e,r,o,s,l,a){var h=this;if(a===void 0&&(a="api"),!(!e||missingOrEmpty(e))){var y=!1;if(e.forEach(function(L){var Y=h.getPrimaryColumn(L);if(Y){if(o){if(r.indexOf(Y)>=0)return;r.push(Y)}else{if(r.indexOf(Y)<0)return;removeFromArray(r,Y)}s(Y),y=!0}}),!!y){this.autoGroupsNeedBuilding&&this.updateGridColumns(),this.updateDisplayedColumns(a);var C={type:l,columns:r,column:r.length===1?r[0]:null,source:a};this.eventService.dispatchEvent(C)}}},t.prototype.setRowGroupColumns=function(e,r){r===void 0&&(r="api"),this.autoGroupsNeedBuilding=!0,this.setPrimaryColumnList(e,this.rowGroupColumns,Events.EVENT_COLUMN_ROW_GROUP_CHANGED,this.setRowGroupActive.bind(this),r)},t.prototype.setRowGroupActive=function(e,r,o){e!==r.isRowGroupActive()&&(r.setRowGroupActive(e,o),e&&!this.gridOptionsService.is("suppressRowGroupHidesColumns")&&this.setColumnVisible(r,!1,o),!e&&!this.gridOptionsService.is("suppressMakeColumnVisibleAfterUnGroup")&&this.setColumnVisible(r,!0,o))},t.prototype.addRowGroupColumn=function(e,r){r===void 0&&(r="api"),e&&this.addRowGroupColumns([e],r)},t.prototype.addRowGroupColumns=function(e,r){r===void 0&&(r="api"),this.autoGroupsNeedBuilding=!0,this.updatePrimaryColumnList(e,this.rowGroupColumns,!0,this.setRowGroupActive.bind(this,!0),Events.EVENT_COLUMN_ROW_GROUP_CHANGED,r)},t.prototype.removeRowGroupColumns=function(e,r){r===void 0&&(r="api"),this.autoGroupsNeedBuilding=!0,this.updatePrimaryColumnList(e,this.rowGroupColumns,!1,this.setRowGroupActive.bind(this,!1),Events.EVENT_COLUMN_ROW_GROUP_CHANGED,r)},t.prototype.removeRowGroupColumn=function(e,r){r===void 0&&(r="api"),e&&this.removeRowGroupColumns([e],r)},t.prototype.addPivotColumns=function(e,r){r===void 0&&(r="api"),this.updatePrimaryColumnList(e,this.pivotColumns,!0,function(o){return o.setPivotActive(!0,r)},Events.EVENT_COLUMN_PIVOT_CHANGED,r)},t.prototype.setPivotColumns=function(e,r){r===void 0&&(r="api"),this.setPrimaryColumnList(e,this.pivotColumns,Events.EVENT_COLUMN_PIVOT_CHANGED,function(o,s){s.setPivotActive(o,r)},r)},t.prototype.addPivotColumn=function(e,r){r===void 0&&(r="api"),this.addPivotColumns([e],r)},t.prototype.removePivotColumns=function(e,r){r===void 0&&(r="api"),this.updatePrimaryColumnList(e,this.pivotColumns,!1,function(o){return o.setPivotActive(!1,r)},Events.EVENT_COLUMN_PIVOT_CHANGED,r)},t.prototype.removePivotColumn=function(e,r){r===void 0&&(r="api"),this.removePivotColumns([e],r)},t.prototype.setPrimaryColumnList=function(e,r,o,s,l){var a=this;r.length=0,exists(e)&&e.forEach(function(h){var y=a.getPrimaryColumn(h);y&&r.push(y)}),(this.primaryColumns||[]).forEach(function(h){var y=r.indexOf(h)>=0;s(y,h)}),this.autoGroupsNeedBuilding&&this.updateGridColumns(),this.updateDisplayedColumns(l),this.dispatchColumnChangedEvent(o,r,l)},t.prototype.setValueColumns=function(e,r){r===void 0&&(r="api"),this.setPrimaryColumnList(e,this.valueColumns,Events.EVENT_COLUMN_VALUE_CHANGED,this.setValueActive.bind(this),r)},t.prototype.setValueActive=function(e,r,o){if(e!==r.isValueActive()&&(r.setValueActive(e,o),e&&!r.getAggFunc())){var s=this.aggFuncService.getDefaultAggFunc(r);r.setAggFunc(s)}},t.prototype.addValueColumns=function(e,r){r===void 0&&(r="api"),this.updatePrimaryColumnList(e,this.valueColumns,!0,this.setValueActive.bind(this,!0),Events.EVENT_COLUMN_VALUE_CHANGED,r)},t.prototype.addValueColumn=function(e,r){r===void 0&&(r="api"),e&&this.addValueColumns([e],r)},t.prototype.removeValueColumn=function(e,r){r===void 0&&(r="api"),this.removeValueColumns([e],r)},t.prototype.removeValueColumns=function(e,r){r===void 0&&(r="api"),this.updatePrimaryColumnList(e,this.valueColumns,!1,this.setValueActive.bind(this,!1),Events.EVENT_COLUMN_VALUE_CHANGED,r)},t.prototype.normaliseColumnWidth=function(e,r){var o=e.getMinWidth();exists(o)&&r<o&&(r=o);var s=e.getMaxWidth();return exists(s)&&e.isGreaterThanMax(r)&&(r=s),r},t.prototype.getPrimaryOrGridColumn=function(e){var r=this.getPrimaryColumn(e);return r||this.getGridColumn(e)},t.prototype.setColumnWidths=function(e,r,o,s){var l=this;s===void 0&&(s="api");var a=[];e.forEach(function(h){var y=l.getPrimaryOrGridColumn(h.key);if(y){a.push({width:h.newWidth,ratios:[1],columns:[y]});var C=l.gridOptionsService.get("colResizeDefault")==="shift";if(C&&(r=!r),r){var L=l.getDisplayedColAfter(y);if(!L)return;var Y=y.getActualWidth()-h.newWidth,ze=L.getActualWidth()+Y;a.push({width:ze,ratios:[1],columns:[L]})}}}),a.length!==0&&this.resizeColumnSets({resizeSets:a,finished:o,source:s})},t.prototype.checkMinAndMaxWidthsForSet=function(e){var r=e.columns,o=e.width,s=0,l=0,a=!0;r.forEach(function(C){var L=C.getMinWidth();s+=L||0;var Y=C.getMaxWidth();exists(Y)&&Y>0?l+=Y:a=!1});var h=o>=s,y=!a||o<=l;return h&&y},t.prototype.resizeColumnSets=function(e){var r=this,o=e.resizeSets,s=e.finished,l=e.source,a=!o||o.every(function(Bt){return r.checkMinAndMaxWidthsForSet(Bt)});if(!a){if(s){var h=o&&o.length>0?o[0].columns:null;this.dispatchColumnResizedEvent(h,s,l)}return}var y=[],C=[];o.forEach(function(Bt){var Ir=Bt.width,Wr=Bt.columns,yi=Bt.ratios,Bn={},vi={};Wr.forEach(function(il){return C.push(il)});for(var wo=!0,ia=0,gl=function(){if(ia++,ia>1e3)return console.error("AG Grid: infinite loop in resizeColumnSets"),"break";wo=!1;var il=[],sl=0,ol=Ir;Wr.forEach(function(rh,wh){var Fh=vi[rh.getId()];if(Fh)ol-=Bn[rh.getId()];else{il.push(rh);var Mh=yi[wh];sl+=Mh}});var _l=1/sl;il.forEach(function(rh,wh){var Fh=wh===il.length-1,Mh;Fh?Mh=ol:(Mh=Math.round(yi[wh]*Ir*_l),ol-=Mh);var vp=rh.getMinWidth(),gp=rh.getMaxWidth();exists(vp)&&Mh<vp?(Mh=vp,vi[rh.getId()]=!0,wo=!0):exists(gp)&&gp>0&&Mh>gp&&(Mh=gp,vi[rh.getId()]=!0,wo=!0),Bn[rh.getId()]=Mh})};wo;){var ml=gl();if(ml==="break")break}Wr.forEach(function(il){var sl=Bn[il.getId()],ol=il.getActualWidth();ol!==sl&&(il.setActualWidth(sl,l),y.push(il))})});var L=y.length>0,Y=[];L&&(Y=this.refreshFlexedColumns({resizingCols:C,skipSetLeft:!0}),this.setLeftValues(l),this.updateBodyWidths(),this.checkViewportColumns());var ze=C.concat(Y);(L||s)&&this.dispatchColumnResizedEvent(ze,s,l,Y)},t.prototype.setColumnAggFunc=function(e,r,o){if(o===void 0&&(o="api"),!!e){var s=this.getPrimaryColumn(e);s&&(s.setAggFunc(r),this.dispatchColumnChangedEvent(Events.EVENT_COLUMN_VALUE_CHANGED,[s],o))}},t.prototype.moveRowGroupColumn=function(e,r,o){o===void 0&&(o="api");var s=this.rowGroupColumns[e];this.rowGroupColumns.splice(e,1),this.rowGroupColumns.splice(r,0,s);var l={type:Events.EVENT_COLUMN_ROW_GROUP_CHANGED,columns:this.rowGroupColumns,column:this.rowGroupColumns.length===1?this.rowGroupColumns[0]:null,source:o};this.eventService.dispatchEvent(l)},t.prototype.moveColumns=function(e,r,o,s){if(o===void 0&&(o="api"),s===void 0&&(s=!0),this.columnAnimationService.start(),r>this.gridColumns.length-e.length){console.warn("AG Grid: tried to insert columns in invalid location, toIndex = "+r),console.warn("AG Grid: remember that you should not count the moving columns when calculating the new index");return}var l=this.getGridColumns(e),a=!this.doesMovePassRules(l,r);a||(moveInArray(this.gridColumns,l,r),this.updateDisplayedColumns(o),this.dispatchColumnMovedEvent({movedColumns:l,source:o,toIndex:r,finished:s}),this.columnAnimationService.finish())},t.prototype.doesMovePassRules=function(e,r){var o=this.getProposedColumnOrder(e,r);return this.doesOrderPassRules(o)},t.prototype.doesOrderPassRules=function(e){return!(!this.doesMovePassMarryChildren(e)||!this.doesMovePassLockedPositions(e))},t.prototype.getProposedColumnOrder=function(e,r){var o=this.gridColumns.slice();return moveInArray(o,e,r),o},t.prototype.sortColumnsLikeGridColumns=function(e){var r=this;if(!(!e||e.length<=1)){var o=e.filter(function(s){return r.gridColumns.indexOf(s)<0}).length>0;o||e.sort(function(s,l){var a=r.gridColumns.indexOf(s),h=r.gridColumns.indexOf(l);return a-h})}},t.prototype.doesMovePassLockedPositions=function(e){var r=0,o=!0,s=function(l){return l?l===!0||l==="left"?0:2:1};return e.forEach(function(l){var a=s(l.getColDef().lockPosition);a<r&&(o=!1),r=a}),o},t.prototype.doesMovePassMarryChildren=function(e){var r=!0;return this.columnUtils.depthFirstOriginalTreeSearch(null,this.gridBalancedTree,function(o){if(o instanceof ProvidedColumnGroup){var s=o,l=s.getColGroupDef(),a=l&&l.marryChildren;if(a){var h=[];s.getLeafColumns().forEach(function(ze){var Bt=e.indexOf(ze);h.push(Bt)});var y=Math.max.apply(Math,h),C=Math.min.apply(Math,h),L=y-C,Y=s.getLeafColumns().length-1;L>Y&&(r=!1)}}}),r},t.prototype.moveColumn=function(e,r,o){o===void 0&&(o="api"),this.moveColumns([e],r,o)},t.prototype.moveColumnByIndex=function(e,r,o){o===void 0&&(o="api");var s=this.gridColumns[e];this.moveColumn(s,r,o)},t.prototype.getColumnDefs=function(){var e=this;if(this.primaryColumns){var r=this.primaryColumns.slice();return this.gridColsArePrimary?r.sort(function(o,s){return e.gridColumns.indexOf(o)-e.gridColumns.indexOf(s)}):this.lastPrimaryOrder&&r.sort(function(o,s){return e.lastPrimaryOrder.indexOf(o)-e.lastPrimaryOrder.indexOf(s)}),this.columnDefFactory.buildColumnDefs(r,this.rowGroupColumns,this.pivotColumns)}},t.prototype.getBodyContainerWidth=function(){return this.bodyWidth},t.prototype.getContainerWidth=function(e){switch(e){case"left":return this.leftWidth;case"right":return this.rightWidth;default:return this.bodyWidth}},t.prototype.updateBodyWidths=function(){var e=this.getWidthOfColsInList(this.displayedColumnsCenter),r=this.getWidthOfColsInList(this.displayedColumnsLeft),o=this.getWidthOfColsInList(this.displayedColumnsRight);this.bodyWidthDirty=this.bodyWidth!==e;var s=this.bodyWidth!==e||this.leftWidth!==r||this.rightWidth!==o;if(s){this.bodyWidth=e,this.leftWidth=r,this.rightWidth=o;var l={type:Events.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED};this.eventService.dispatchEvent(l)}},t.prototype.getValueColumns=function(){return this.valueColumns?this.valueColumns:[]},t.prototype.getPivotColumns=function(){return this.pivotColumns?this.pivotColumns:[]},t.prototype.isPivotActive=function(){return this.pivotColumns&&this.pivotColumns.length>0&&this.pivotMode},t.prototype.getRowGroupColumns=function(){return this.rowGroupColumns?this.rowGroupColumns:[]},t.prototype.getDisplayedCenterColumns=function(){return this.displayedColumnsCenter},t.prototype.getDisplayedLeftColumns=function(){return this.displayedColumnsLeft},t.prototype.getDisplayedRightColumns=function(){return this.displayedColumnsRight},t.prototype.getDisplayedColumns=function(e){switch(e){case"left":return this.getDisplayedLeftColumns();case"right":return this.getDisplayedRightColumns();default:return this.getDisplayedCenterColumns()}},t.prototype.getAllPrimaryColumns=function(){return this.primaryColumns?this.primaryColumns.slice():null},t.prototype.getSecondaryColumns=function(){return this.secondaryColumns?this.secondaryColumns.slice():null},t.prototype.getAllColumnsForQuickFilter=function(){return this.columnsForQuickFilter},t.prototype.getAllGridColumns=function(){return this.gridColumns},t.prototype.isEmpty=function(){return missingOrEmpty(this.gridColumns)},t.prototype.isRowGroupEmpty=function(){return missingOrEmpty(this.rowGroupColumns)},t.prototype.setColumnVisible=function(e,r,o){o===void 0&&(o="api"),this.setColumnsVisible([e],r,o)},t.prototype.setColumnsVisible=function(e,r,o){r===void 0&&(r=!1),o===void 0&&(o="api"),this.applyColumnState({state:e.map(function(s){return{colId:typeof s=="string"?s:s.getColId(),hide:!r}})},o)},t.prototype.setColumnPinned=function(e,r,o){o===void 0&&(o="api"),e&&this.setColumnsPinned([e],r,o)},t.prototype.setColumnsPinned=function(e,r,o){if(o===void 0&&(o="api"),this.gridOptionsService.isDomLayout("print")){console.warn("AG Grid: Changing the column pinning status is not allowed with domLayout='print'");return}this.columnAnimationService.start();var s;r===!0||r==="left"?s="left":r==="right"?s="right":s=null,this.actionOnGridColumns(e,function(l){return l.getPinned()!==s?(l.setPinned(s),!0):!1},o,function(){var l={type:Events.EVENT_COLUMN_PINNED,pinned:s,column:null,columns:null,source:o};return l}),this.columnAnimationService.finish()},t.prototype.actionOnGridColumns=function(e,r,o,s){var l=this;if(!missingOrEmpty(e)){var a=[];if(e.forEach(function(y){var C=l.getGridColumn(y);if(C){var L=r(C);L!==!1&&a.push(C)}}),!!a.length&&(this.updateDisplayedColumns(o),exists(s)&&s)){var h=s();h.columns=a,h.column=a.length===1?a[0]:null,this.eventService.dispatchEvent(h)}}},t.prototype.getDisplayedColBefore=function(e){var r=this.getAllDisplayedColumns(),o=r.indexOf(e);return o>0?r[o-1]:null},t.prototype.getDisplayedColAfter=function(e){var r=this.getAllDisplayedColumns(),o=r.indexOf(e);return o<r.length-1?r[o+1]:null},t.prototype.getDisplayedGroupAfter=function(e){return this.getDisplayedGroupAtDirection(e,"After")},t.prototype.getDisplayedGroupBefore=function(e){return this.getDisplayedGroupAtDirection(e,"Before")},t.prototype.getDisplayedGroupAtDirection=function(e,r){for(var o=e.getProvidedColumnGroup().getLevel()+e.getPaddingLevel(),s=e.getDisplayedLeafColumns(),l=r==="After"?last(s):s[0],a="getDisplayedCol"+r;;){var h=this[a](l);if(!h)return null;var y=this.getColumnGroupAtLevel(h,o);if(y!==e)return y}},t.prototype.getColumnGroupAtLevel=function(e,r){for(var o=e.getParent(),s,l;;){var a=o.getProvidedColumnGroup();if(s=a.getLevel(),l=o.getPaddingLevel(),s+l<=r)break;o=o.getParent()}return o},t.prototype.isPinningLeft=function(){return this.displayedColumnsLeft.length>0},t.prototype.isPinningRight=function(){return this.displayedColumnsRight.length>0},t.prototype.getPrimaryAndSecondaryAndAutoColumns=function(){var e;return(e=[]).concat.apply(e,[this.primaryColumns||[],this.groupAutoColumns||[],this.secondaryColumns||[]])},t.prototype.createStateItemFromColumn=function(e){var r=e.isRowGroupActive()?this.rowGroupColumns.indexOf(e):null,o=e.isPivotActive()?this.pivotColumns.indexOf(e):null,s=e.isValueActive()?e.getAggFunc():null,l=e.getSort()!=null?e.getSort():null,a=e.getSortIndex()!=null?e.getSortIndex():null,h=e.getFlex()!=null&&e.getFlex()>0?e.getFlex():null,y={colId:e.getColId(),width:e.getActualWidth(),hide:!e.isVisible(),pinned:e.getPinned(),sort:l,sortIndex:a,aggFunc:s,rowGroup:e.isRowGroupActive(),rowGroupIndex:r,pivot:e.isPivotActive(),pivotIndex:o,flex:h};return y},t.prototype.getColumnState=function(){if(missing(this.primaryColumns)||!this.isAlive())return[];var e=this.getPrimaryAndSecondaryAndAutoColumns(),r=e.map(this.createStateItemFromColumn.bind(this));return this.orderColumnStateList(r),r},t.prototype.orderColumnStateList=function(e){var r=convertToMap(this.gridColumns.map(function(o,s){return[o.getColId(),s]}));e.sort(function(o,s){var l=r.has(o.colId)?r.get(o.colId):-1,a=r.has(s.colId)?r.get(s.colId):-1;return l-a})},t.prototype.resetColumnState=function(e){var r=this;e===void 0&&(e="api");var o=this.getColumnsFromTree(this.primaryColumnTree),s=[],l=1e3,a=1e3,h=[];this.groupAutoColumns&&(h=h.concat(this.groupAutoColumns)),o&&(h=h.concat(o)),h.forEach(function(y){var C=r.getColumnStateFromColDef(y);missing(C.rowGroupIndex)&&C.rowGroup&&(C.rowGroupIndex=l++),missing(C.pivotIndex)&&C.pivot&&(C.pivotIndex=a++),s.push(C)}),this.applyColumnState({state:s,applyOrder:!0},e)},t.prototype.getColumnStateFromColDef=function(e){var r=function(Wr,yi){return Wr??yi??null},o=e.getColDef(),s=r(o.sort,o.initialSort),l=r(o.sortIndex,o.initialSortIndex),a=r(o.hide,o.initialHide),h=r(o.pinned,o.initialPinned),y=r(o.width,o.initialWidth),C=r(o.flex,o.initialFlex),L=r(o.rowGroupIndex,o.initialRowGroupIndex),Y=r(o.rowGroup,o.initialRowGroup);L==null&&(Y==null||Y==!1)&&(L=null,Y=null);var ze=r(o.pivotIndex,o.initialPivotIndex),Bt=r(o.pivot,o.initialPivot);ze==null&&(Bt==null||Bt==!1)&&(ze=null,Bt=null);var Ir=r(o.aggFunc,o.initialAggFunc);return{colId:e.getColId(),sort:s,sortIndex:l,hide:a,pinned:h,width:y,flex:C,rowGroup:Y,rowGroupIndex:L,pivot:Bt,pivotIndex:ze,aggFunc:Ir}},t.prototype.applyColumnState=function(e,r){var o=this;if(missingOrEmpty(this.primaryColumns))return!1;if(e&&e.state&&!e.state.forEach)return console.warn("AG Grid: applyColumnState() - the state attribute should be an array, however an array was not found. Please provide an array of items (one for each col you want to change) for state."),!1;var s=function(y,C,L){var Y=o.compareColumnStatesAndDispatchEvents(r);o.autoGroupsNeedBuilding=!0;var ze=C.slice(),Bt={},Ir={},Wr=[],yi=[],Bn=0,vi=o.rowGroupColumns.slice(),wo=o.pivotColumns.slice();y.forEach(function(il){var sl=il.colId||"",ol=sl.startsWith(GROUP_AUTO_COLUMN_ID);if(ol){Wr.push(il),yi.push(il);return}var _l=L(sl);_l?(o.syncColumnWithStateItem(_l,il,e.defaultState,Bt,Ir,!1,r),removeFromArray(ze,_l)):(yi.push(il),Bn+=1)});var ia=function(il){return o.syncColumnWithStateItem(il,null,e.defaultState,Bt,Ir,!1,r)};ze.forEach(ia);var gl=function(il,sl,ol,_l){var rh=il[ol.getId()],wh=il[_l.getId()],Fh=rh!=null,Mh=wh!=null;if(Fh&&Mh)return rh-wh;if(Fh)return-1;if(Mh)return 1;var vp=sl.indexOf(ol),gp=sl.indexOf(_l),Jh=vp>=0,Lp=gp>=0;return Jh&&Lp?vp-gp:Jh?-1:1};o.rowGroupColumns.sort(gl.bind(o,Bt,vi)),o.pivotColumns.sort(gl.bind(o,Ir,wo)),o.updateGridColumns();var ml=o.groupAutoColumns?o.groupAutoColumns.slice():[];return Wr.forEach(function(il){var sl=o.getAutoColumn(il.colId);removeFromArray(ml,sl),o.syncColumnWithStateItem(sl,il,e.defaultState,null,null,!0,r)}),ml.forEach(ia),o.applyOrderAfterApplyState(e),o.updateDisplayedColumns(r),o.dispatchEverythingChanged(r),Y(),{unmatchedAndAutoStates:yi,unmatchedCount:Bn}};this.columnAnimationService.start();var l=s(e.state||[],this.primaryColumns||[],function(y){return o.getPrimaryColumn(y)}),a=l.unmatchedAndAutoStates,h=l.unmatchedCount;return(a.length>0||exists(e.defaultState))&&(h=s(a,this.secondaryColumns||[],function(y){return o.getSecondaryColumn(y)}).unmatchedCount),this.columnAnimationService.finish(),h===0},t.prototype.applyOrderAfterApplyState=function(e){var r=this;if(!(!e.applyOrder||!e.state)){var o=[],s={};e.state.forEach(function(a){if(!(!a.colId||s[a.colId])){var h=r.gridColumnsMap[a.colId];h&&(o.push(h),s[a.colId]=!0)}});var l=0;if(this.gridColumns.forEach(function(a){var h=a.getColId(),y=s[h]!=null;if(!y){var C=h.startsWith(GROUP_AUTO_COLUMN_ID);C?insertIntoArray(o,a,l++):o.push(a)}}),o=this.placeLockedColumns(o),!this.doesMovePassMarryChildren(o)){console.warn("AG Grid: Applying column order broke a group where columns should be married together. Applying new order has been discarded.");return}this.gridColumns=o}},t.prototype.compareColumnStatesAndDispatchEvents=function(e){var r=this,o={rowGroupColumns:this.rowGroupColumns.slice(),pivotColumns:this.pivotColumns.slice(),valueColumns:this.valueColumns.slice()},s=this.getColumnState(),l={};return s.forEach(function(a){l[a.colId]=a}),function(){var a=r.getPrimaryAndSecondaryAndAutoColumns(),h=function(yi,Bn,vi,wo){var ia=Bn.map(wo),gl=vi.map(wo),ml=areEqual(ia,gl);if(!ml){var il={type:yi,columns:vi,column:vi.length===1?vi[0]:null,source:e};r.eventService.dispatchEvent(il)}},y=function(yi){var Bn=[];return a.forEach(function(vi){var wo=l[vi.getColId()];wo&&yi(wo,vi)&&Bn.push(vi)}),Bn},C=function(yi){return yi.getColId()};h(Events.EVENT_COLUMN_ROW_GROUP_CHANGED,o.rowGroupColumns,r.rowGroupColumns,C),h(Events.EVENT_COLUMN_PIVOT_CHANGED,o.pivotColumns,r.pivotColumns,C);var L=function(yi,Bn){var vi=yi.aggFunc!=null,wo=vi!=Bn.isValueActive(),ia=vi&&yi.aggFunc!=Bn.getAggFunc();return wo||ia},Y=y(L);Y.length>0&&r.dispatchColumnChangedEvent(Events.EVENT_COLUMN_VALUE_CHANGED,r.valueColumns,e);var ze=function(yi,Bn){return yi.width!=Bn.getActualWidth()};r.dispatchColumnResizedEvent(y(ze),!0,e);var Bt=function(yi,Bn){return yi.pinned!=Bn.getPinned()};r.dispatchColumnPinnedEvent(y(Bt),e);var Ir=function(yi,Bn){return yi.hide==Bn.isVisible()};r.dispatchColumnVisibleEvent(y(Ir),e);var Wr=function(yi,Bn){return yi.sort!=Bn.getSort()||yi.sortIndex!=Bn.getSortIndex()};y(Wr).length>0&&r.sortController.dispatchSortChangedEvents(e),r.normaliseColumnMovedEventForColumnState(s,e)}},t.prototype.getCommonValue=function(e,r){if(!(!e||e.length==0)){for(var o=r(e[0]),s=1;s<e.length;s++)if(o!==r(e[s]))return;return o}},t.prototype.normaliseColumnMovedEventForColumnState=function(e,r){var o=this,s=this.getColumnState(),l={};s.forEach(function(L){return l[L.colId]=L});var a={};e.forEach(function(L){l[L.colId]&&(a[L.colId]=!0)});var h=e.filter(function(L){return a[L.colId]}),y=s.filter(function(L){return a[L.colId]}),C=[];y.forEach(function(L,Y){var ze=h&&h[Y];if(ze&&ze.colId!==L.colId){var Bt=o.getGridColumn(ze.colId);Bt&&C.push(Bt)}}),C.length&&this.dispatchColumnMovedEvent({movedColumns:C,source:r,finished:!0})},t.prototype.syncColumnWithStateItem=function(e,r,o,s,l,a,h){if(e){var y=function(sl,ol){var _l={value1:void 0,value2:void 0},rh=!1;return r&&(r[sl]!==void 0&&(_l.value1=r[sl],rh=!0),exists(ol)&&r[ol]!==void 0&&(_l.value2=r[ol],rh=!0)),!rh&&o&&(o[sl]!==void 0&&(_l.value1=o[sl]),exists(ol)&&o[ol]!==void 0&&(_l.value2=o[ol])),_l},C=y("hide").value1;C!==void 0&&e.setVisible(!C,h);var L=y("pinned").value1;L!==void 0&&e.setPinned(L);var Y=this.columnUtils.calculateColMinWidth(e.getColDef()),ze=y("flex").value1;ze!==void 0&&e.setFlex(ze);var Bt=e.getFlex()<=0;if(Bt){var Ir=y("width").value1;Ir!=null&&Y!=null&&Ir>=Y&&e.setActualWidth(Ir,h)}var Wr=y("sort").value1;Wr!==void 0&&(Wr==="desc"||Wr==="asc"?e.setSort(Wr,h):e.setSort(void 0,h));var yi=y("sortIndex").value1;if(yi!==void 0&&e.setSortIndex(yi),!(a||!e.isPrimary())){var Bn=y("aggFunc").value1;Bn!==void 0&&(typeof Bn=="string"?(e.setAggFunc(Bn),e.isValueActive()||(e.setValueActive(!0,h),this.valueColumns.push(e))):(exists(Bn)&&console.warn("AG Grid: stateItem.aggFunc must be a string. if using your own aggregation functions, register the functions first before using them in get/set state. This is because it is intended for the column state to be stored and retrieved as simple JSON."),e.isValueActive()&&(e.setValueActive(!1,h),removeFromArray(this.valueColumns,e))));var vi=y("rowGroup","rowGroupIndex"),wo=vi.value1,ia=vi.value2;(wo!==void 0||ia!==void 0)&&(typeof ia=="number"||wo?(e.isRowGroupActive()||(e.setRowGroupActive(!0,h),this.rowGroupColumns.push(e)),s&&typeof ia=="number"&&(s[e.getId()]=ia)):e.isRowGroupActive()&&(e.setRowGroupActive(!1,h),removeFromArray(this.rowGroupColumns,e)));var gl=y("pivot","pivotIndex"),ml=gl.value1,il=gl.value2;(ml!==void 0||il!==void 0)&&(typeof il=="number"||ml?(e.isPivotActive()||(e.setPivotActive(!0,h),this.pivotColumns.push(e)),l&&typeof il=="number"&&(l[e.getId()]=il)):e.isPivotActive()&&(e.setPivotActive(!1,h),removeFromArray(this.pivotColumns,e)))}}},t.prototype.getGridColumns=function(e){return this.getColumns(e,this.getGridColumn.bind(this))},t.prototype.getColumns=function(e,r){var o=[];return e&&e.forEach(function(s){var l=r(s);l&&o.push(l)}),o},t.prototype.getColumnWithValidation=function(e){if(e==null)return null;var r=this.getGridColumn(e);return r||console.warn("AG Grid: could not find column "+e),r},t.prototype.getPrimaryColumn=function(e){return this.primaryColumns?this.getColumn(e,this.primaryColumns,this.primaryColumnsMap):null},t.prototype.getGridColumn=function(e){return this.getColumn(e,this.gridColumns,this.gridColumnsMap)},t.prototype.getSecondaryColumn=function(e){return this.secondaryColumns?this.getColumn(e,this.secondaryColumns,this.secondaryColumnsMap):null},t.prototype.getColumn=function(e,r,o){if(!e)return null;if(typeof e=="string"&&o[e])return o[e];for(var s=0;s<r.length;s++)if(this.columnsMatch(r[s],e))return r[s];return this.getAutoColumn(e)},t.prototype.getSourceColumnsForGroupColumn=function(e){var r=e.getColDef().showRowGroup;if(!r)return null;if(r===!0)return this.rowGroupColumns.slice(0);var o=this.getPrimaryColumn(r);return o?[o]:null},t.prototype.getAutoColumn=function(e){var r=this;return!this.groupAutoColumns||!exists(this.groupAutoColumns)||missing(this.groupAutoColumns)?null:this.groupAutoColumns.find(function(o){return r.columnsMatch(o,e)})||null},t.prototype.columnsMatch=function(e,r){var o=e===r,s=e.getColDef()===r,l=e.getColId()==r;return o||s||l},t.prototype.getDisplayNameForColumn=function(e,r,o){if(o===void 0&&(o=!1),!e)return null;var s=this.getHeaderName(e.getColDef(),e,null,null,r);return o?this.wrapHeaderNameWithAggFunc(e,s):s},t.prototype.getDisplayNameForProvidedColumnGroup=function(e,r,o){var s=r?r.getColGroupDef():null;return s?this.getHeaderName(s,null,e,r,o):null},t.prototype.getDisplayNameForColumnGroup=function(e,r){return this.getDisplayNameForProvidedColumnGroup(e,e.getProvidedColumnGroup(),r)},t.prototype.getHeaderName=function(e,r,o,s,l){var a=e.headerValueGetter;if(a){var h={colDef:e,column:r,columnGroup:o,providedColumnGroup:s,location:l,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context};return typeof a=="function"?a(h):typeof a=="string"?this.expressionService.evaluate(a,h):(console.warn("AG Grid: headerValueGetter must be a function or a string"),"")}else{if(e.headerName!=null)return e.headerName;if(e.field)return camelCaseToHumanText(e.field)}return""},t.prototype.wrapHeaderNameWithAggFunc=function(e,r){if(this.gridOptionsService.is("suppressAggFuncInHeader"))return r;var o=e.getColDef().pivotValueColumn,s=exists(o),l=null,a;if(s){var h=this.gridOptionsService.is("removePivotHeaderRowWhenSingleValueColumn")&&this.valueColumns.length===1,y=e.getColDef().pivotTotalColumnIds!==void 0;if(h&&!y)return r;l=o?o.getAggFunc():null,a=!0}else{var C=e.isValueActive(),L=this.pivotMode||!this.isRowGroupEmpty();C&&L?(l=e.getAggFunc(),a=!0):a=!1}if(a){var Y=typeof l=="string"?l:"func",ze=this.localeService.getLocaleTextFunc(),Bt=ze(Y,Y);return Bt+"("+r+")"}return r},t.prototype.getColumnGroup=function(e,r){if(!e)return null;if(e instanceof ColumnGroup)return e;var o=this.getAllDisplayedTrees(),s=typeof r=="number",l=null;return this.columnUtils.depthFirstAllColumnTreeSearch(o,function(a){if(a instanceof ColumnGroup){var h=a,y=void 0;s?y=e===h.getGroupId()&&r===h.getPartId():y=e===h.getGroupId(),y&&(l=h)}}),l},t.prototype.isReady=function(){return this.ready},t.prototype.extractValueColumns=function(e,r){this.valueColumns=this.extractColumns(r,this.valueColumns,function(o,s){return o.setValueActive(s,e)},function(){},function(){},function(o){var s=o.aggFunc;if(s===null||s==="")return null;if(s!==void 0)return!!s},function(o){return o.initialAggFunc!=null&&o.initialAggFunc!=""}),this.valueColumns.forEach(function(o){var s=o.getColDef();s.aggFunc!=null&&s.aggFunc!=""?o.setAggFunc(s.aggFunc):o.getAggFunc()||o.setAggFunc(s.initialAggFunc)})},t.prototype.extractRowGroupColumns=function(e,r){this.rowGroupColumns=this.extractColumns(r,this.rowGroupColumns,function(o,s){return o.setRowGroupActive(s,e)},function(o){return o.rowGroupIndex},function(o){return o.initialRowGroupIndex},function(o){return o.rowGroup},function(o){return o.initialRowGroup})},t.prototype.extractColumns=function(e,r,o,s,l,a,h){e===void 0&&(e=[]),r===void 0&&(r=[]);var y=[],C=[];(this.primaryColumns||[]).forEach(function(ze){var Bt=e.indexOf(ze)<0,Ir=ze.getColDef(),Wr=attrToBoolean(a(Ir)),yi=attrToBoolean(h(Ir)),Bn=attrToNumber(s(Ir)),vi=attrToNumber(l(Ir)),wo,ia=Wr!==void 0,gl=Bn!==void 0,ml=yi!==void 0,il=vi!==void 0;if(ia?wo=Wr:gl?Bn===null?wo=!1:wo=Bn>=0:Bt?ml?wo=yi:il?wo=vi!=null&&vi>=0:wo=!1:wo=r.indexOf(ze)>=0,wo){var sl=Bt?Bn!=null||vi!=null:Bn!=null;sl?y.push(ze):C.push(ze)}});var L=function(ze){var Bt=s(ze.getColDef()),Ir=l(ze.getColDef());return Bt??Ir};y.sort(function(ze,Bt){var Ir=L(ze),Wr=L(Bt);return Ir===Wr?0:Ir<Wr?-1:1});var Y=[].concat(y);return r.forEach(function(ze){C.indexOf(ze)>=0&&Y.push(ze)}),C.forEach(function(ze){Y.indexOf(ze)<0&&Y.push(ze)}),r.forEach(function(ze){Y.indexOf(ze)<0&&o(ze,!1)}),Y.forEach(function(ze){r.indexOf(ze)<0&&o(ze,!0)}),Y},t.prototype.extractPivotColumns=function(e,r){this.pivotColumns=this.extractColumns(r,this.pivotColumns,function(o,s){return o.setPivotActive(s,e)},function(o){return o.pivotIndex},function(o){return o.initialPivotIndex},function(o){return o.pivot},function(o){return o.initialPivot})},t.prototype.resetColumnGroupState=function(e){e===void 0&&(e="api");var r=[];this.columnUtils.depthFirstOriginalTreeSearch(null,this.primaryColumnTree,function(o){if(o instanceof ProvidedColumnGroup){var s=o.getColGroupDef(),l={groupId:o.getGroupId(),open:s?s.openByDefault:void 0};r.push(l)}}),this.setColumnGroupState(r,e)},t.prototype.getColumnGroupState=function(){var e=[];return this.columnUtils.depthFirstOriginalTreeSearch(null,this.gridBalancedTree,function(r){r instanceof ProvidedColumnGroup&&e.push({groupId:r.getGroupId(),open:r.isExpanded()})}),e},t.prototype.setColumnGroupState=function(e,r){var o=this;r===void 0&&(r="api"),this.columnAnimationService.start();var s=[];e.forEach(function(l){var a=l.groupId,h=l.open,y=o.getProvidedColumnGroup(a);y&&y.isExpanded()!==h&&(o.logger.log("columnGroupOpened("+y.getGroupId()+","+h+")"),y.setExpanded(h),s.push(y))}),this.updateGroupsAndDisplayedColumns(r),this.setFirstRightAndLastLeftPinned(r),s.forEach(function(l){var a={type:Events.EVENT_COLUMN_GROUP_OPENED,columnGroup:l};o.eventService.dispatchEvent(a)}),this.columnAnimationService.finish()},t.prototype.setColumnGroupOpened=function(e,r,o){o===void 0&&(o="api");var s;e instanceof ProvidedColumnGroup?s=e.getId():s=e||"",this.setColumnGroupState([{groupId:s,open:r}],o)},t.prototype.getProvidedColumnGroup=function(e){typeof e!="string"&&console.error("AG Grid: group key must be a string");var r=null;return this.columnUtils.depthFirstOriginalTreeSearch(null,this.gridBalancedTree,function(o){o instanceof ProvidedColumnGroup&&o.getId()===e&&(r=o)}),r},t.prototype.calculateColumnsForDisplay=function(){var e=this,r;return this.pivotMode&&missing(this.secondaryColumns)?r=this.gridColumns.filter(function(o){var s=e.groupAutoColumns&&includes(e.groupAutoColumns,o),l=e.valueColumns&&includes(e.valueColumns,o);return s||l}):r=this.gridColumns.filter(function(o){var s=e.groupAutoColumns&&includes(e.groupAutoColumns,o);return s||o.isVisible()}),r},t.prototype.checkColSpanActiveInCols=function(e){var r=!1;return e.forEach(function(o){exists(o.getColDef().colSpan)&&(r=!0)}),r},t.prototype.calculateColumnsForGroupDisplay=function(){var e=this;this.groupDisplayColumns=[],this.groupDisplayColumnsMap={};var r=function(o){var s=o.getColDef(),l=s.showRowGroup;s&&exists(l)&&(e.groupDisplayColumns.push(o),typeof l=="string"?e.groupDisplayColumnsMap[l]=o:l===!0&&e.getRowGroupColumns().forEach(function(a){e.groupDisplayColumnsMap[a.getId()]=o}))};this.gridColumns.forEach(r)},t.prototype.getGroupDisplayColumns=function(){return this.groupDisplayColumns},t.prototype.getGroupDisplayColumnForGroup=function(e){return this.groupDisplayColumnsMap[e]},t.prototype.updateDisplayedColumns=function(e){var r=this.calculateColumnsForDisplay();this.buildDisplayedTrees(r),this.updateGroupsAndDisplayedColumns(e),this.setFirstRightAndLastLeftPinned(e)},t.prototype.isSecondaryColumnsPresent=function(){return exists(this.secondaryColumns)},t.prototype.setSecondaryColumns=function(e,r){var o=this;r===void 0&&(r="api");var s=e&&e.length>0;if(!(!s&&missing(this.secondaryColumns))){if(s){this.processSecondaryColumnDefinitions(e);var l=this.columnFactory.createColumnTree(e,!1,this.secondaryBalancedTree||this.previousSecondaryColumns||void 0);this.destroyOldColumns(this.secondaryBalancedTree,l.columnTree),this.secondaryBalancedTree=l.columnTree,this.secondaryHeaderRowCount=l.treeDept+1,this.secondaryColumns=this.getColumnsFromTree(this.secondaryBalancedTree),this.secondaryColumnsMap={},this.secondaryColumns.forEach(function(a){return o.secondaryColumnsMap[a.getId()]=a}),this.previousSecondaryColumns=null}else this.previousSecondaryColumns=this.secondaryBalancedTree,this.secondaryBalancedTree=null,this.secondaryHeaderRowCount=-1,this.secondaryColumns=null,this.secondaryColumnsMap={};this.updateGridColumns(),this.updateDisplayedColumns(r)}},t.prototype.processSecondaryColumnDefinitions=function(e){var r=this.gridOptionsService.get("processPivotResultColDef")||this.gridOptionsService.get("processSecondaryColDef"),o=this.gridOptionsService.get("processPivotResultColGroupDef")||this.gridOptionsService.get("processSecondaryColGroupDef");if(!(!r&&!o)){var s=function(l){l.forEach(function(a){var h=exists(a.children);if(h){var y=a;o&&o(y),s(y.children)}else{var C=a;r&&r(C)}})};e&&s(e)}},t.prototype.updateGridColumns=function(){var e=this,r=this.gridBalancedTree;this.gridColsArePrimary?this.lastPrimaryOrder=this.gridColumns:this.lastSecondaryOrder=this.gridColumns;var o;if(this.secondaryColumns&&this.secondaryBalancedTree){var s=this.secondaryColumns.every(function(y){return e.gridColumnsMap[y.getColId()]!==void 0});this.gridBalancedTree=this.secondaryBalancedTree.slice(),this.gridHeaderRowCount=this.secondaryHeaderRowCount,this.gridColumns=this.secondaryColumns.slice(),this.gridColsArePrimary=!1,s&&(o=this.lastSecondaryOrder)}else this.primaryColumns&&(this.gridBalancedTree=this.primaryColumnTree.slice(),this.gridHeaderRowCount=this.primaryHeaderRowCount,this.gridColumns=this.primaryColumns.slice(),this.gridColsArePrimary=!0,o=this.lastPrimaryOrder);var l=this.createGroupAutoColumnsIfNeeded();if(l&&o){var a=convertToMap(this.groupAutoColumns.map(function(y){return[y,!0]}));o=o.filter(function(y){return!a.has(y)}),o=__spreadArray$l(__spreadArray$l([],__read$r(this.groupAutoColumns)),__read$r(o))}if(this.addAutoGroupToGridColumns(),this.orderGridColsLike(o),this.gridColumns=this.placeLockedColumns(this.gridColumns),this.calculateColumnsForGroupDisplay(),this.refreshQuickFilterColumns(),this.clearDisplayedAndViewportColumns(),this.colSpanActive=this.checkColSpanActiveInCols(this.gridColumns),this.gridColumnsMap={},this.gridColumns.forEach(function(y){return e.gridColumnsMap[y.getId()]=y}),this.setAutoHeightActive(),!areEqual(r,this.gridBalancedTree)){var h={type:Events.EVENT_GRID_COLUMNS_CHANGED};this.eventService.dispatchEvent(h)}},t.prototype.setAutoHeightActive=function(){if(this.autoHeightActive=this.gridColumns.filter(function(o){return o.isAutoHeight()}).length>0,this.autoHeightActive){this.autoHeightActiveAtLeastOnce=!0;var e=this.gridOptionsService.isRowModelType("clientSide")||this.gridOptionsService.isRowModelType("serverSide");if(!e){var r="AG Grid - autoHeight columns only work with Client Side Row Model and Server Side Row Model.";doOnce(function(){return console.warn(r)},"autoHeightActive.wrongRowModel")}}},t.prototype.orderGridColsLike=function(e){if(!missing(e)){var r=convertToMap(e.map(function(C,L){return[C,L]})),o=!0;if(this.gridColumns.forEach(function(C){r.has(C)&&(o=!1)}),!o){var s=convertToMap(this.gridColumns.map(function(C){return[C,!0]})),l=e.filter(function(C){return s.has(C)}),a=convertToMap(l.map(function(C){return[C,!0]})),h=this.gridColumns.filter(function(C){return!a.has(C)}),y=l.slice();h.forEach(function(C){var L=C.getOriginalParent();if(!L){y.push(C);return}for(var Y=[];!Y.length&&L;){var ze=L.getLeafColumns();ze.forEach(function(Wr){var yi=y.indexOf(Wr)>=0,Bn=Y.indexOf(Wr)<0;yi&&Bn&&Y.push(Wr)}),L=L.getOriginalParent()}if(!Y.length){y.push(C);return}var Bt=Y.map(function(Wr){return y.indexOf(Wr)}),Ir=Math.max.apply(Math,__spreadArray$l([],__read$r(Bt)));insertIntoArray(y,C,Ir+1)}),this.gridColumns=y}}},t.prototype.isPrimaryColumnGroupsPresent=function(){return this.primaryHeaderRowCount>1},t.prototype.refreshQuickFilterColumns=function(){var e,r=(e=this.isPivotMode()?this.secondaryColumns:this.primaryColumns)!==null&&e!==void 0?e:[];this.groupAutoColumns&&(r=r.concat(this.groupAutoColumns)),this.columnsForQuickFilter=this.gridOptionsService.is("includeHiddenColumnsInQuickFilter")?r:r.filter(function(o){return o.isVisible()||o.isRowGroupActive()})},t.prototype.placeLockedColumns=function(e){var r=[],o=[],s=[];return e.forEach(function(l){var a=l.getColDef().lockPosition;a==="right"?s.push(l):a==="left"||a===!0?r.push(l):o.push(l)}),__spreadArray$l(__spreadArray$l(__spreadArray$l([],__read$r(r)),__read$r(o)),__read$r(s))},t.prototype.addAutoGroupToGridColumns=function(){if(missing(this.groupAutoColumns)){this.destroyOldColumns(this.groupAutoColsBalancedTree),this.groupAutoColsBalancedTree=null;return}this.gridColumns=this.groupAutoColumns?this.groupAutoColumns.concat(this.gridColumns):this.gridColumns;var e=this.columnFactory.createForAutoGroups(this.groupAutoColumns,this.gridBalancedTree);this.destroyOldColumns(this.groupAutoColsBalancedTree,e),this.groupAutoColsBalancedTree=e,this.gridBalancedTree=e.concat(this.gridBalancedTree)},t.prototype.clearDisplayedAndViewportColumns=function(){this.viewportRowLeft={},this.viewportRowRight={},this.viewportRowCenter={},this.displayedColumnsLeft=[],this.displayedColumnsRight=[],this.displayedColumnsCenter=[],this.displayedColumns=[],this.viewportColumns=[],this.headerViewportColumns=[],this.viewportColumnsHash=""},t.prototype.updateGroupsAndDisplayedColumns=function(e){this.updateOpenClosedVisibilityInColumnGroups(),this.deriveDisplayedColumns(e),this.refreshFlexedColumns(),this.extractViewport(),this.updateBodyWidths();var r={type:Events.EVENT_DISPLAYED_COLUMNS_CHANGED};this.eventService.dispatchEvent(r)},t.prototype.deriveDisplayedColumns=function(e){this.derivedDisplayedColumnsFromDisplayedTree(this.displayedTreeLeft,this.displayedColumnsLeft),this.derivedDisplayedColumnsFromDisplayedTree(this.displayedTreeCentre,this.displayedColumnsCenter),this.derivedDisplayedColumnsFromDisplayedTree(this.displayedTreeRight,this.displayedColumnsRight),this.joinDisplayedColumns(),this.setLeftValues(e),this.displayedAutoHeightCols=this.displayedColumns.filter(function(r){return r.isAutoHeight()})},t.prototype.isAutoRowHeightActive=function(){return this.autoHeightActive},t.prototype.wasAutoRowHeightEverActive=function(){return this.autoHeightActiveAtLeastOnce},t.prototype.joinDisplayedColumns=function(){this.gridOptionsService.is("enableRtl")?this.displayedColumns=this.displayedColumnsRight.concat(this.displayedColumnsCenter).concat(this.displayedColumnsLeft):this.displayedColumns=this.displayedColumnsLeft.concat(this.displayedColumnsCenter).concat(this.displayedColumnsRight)},t.prototype.setLeftValues=function(e){this.setLeftValuesOfColumns(e),this.setLeftValuesOfGroups()},t.prototype.setLeftValuesOfColumns=function(e){var r=this;if(this.primaryColumns){var o=this.primaryColumns.slice(0),s=this.gridOptionsService.is("enableRtl");[this.displayedColumnsLeft,this.displayedColumnsRight,this.displayedColumnsCenter].forEach(function(l){if(s){var a=r.getWidthOfColsInList(l);l.forEach(function(y){a-=y.getActualWidth(),y.setLeft(a,e)})}else{var h=0;l.forEach(function(y){y.setLeft(h,e),h+=y.getActualWidth()})}removeAllFromArray(o,l)}),o.forEach(function(l){l.setLeft(null,e)})}},t.prototype.setLeftValuesOfGroups=function(){[this.displayedTreeLeft,this.displayedTreeRight,this.displayedTreeCentre].forEach(function(e){e.forEach(function(r){if(r instanceof ColumnGroup){var o=r;o.checkLeft()}})})},t.prototype.derivedDisplayedColumnsFromDisplayedTree=function(e,r){r.length=0,this.columnUtils.depthFirstDisplayedColumnTreeSearch(e,function(o){o instanceof Column&&r.push(o)})},t.prototype.extractViewportColumns=function(){this.suppressColumnVirtualisation?(this.viewportColumnsCenter=this.displayedColumnsCenter,this.headerViewportColumnsCenter=this.displayedColumnsCenter):(this.viewportColumnsCenter=this.displayedColumnsCenter.filter(this.isColumnInRowViewport.bind(this)),this.headerViewportColumnsCenter=this.displayedColumnsCenter.filter(this.isColumnInHeaderViewport.bind(this))),this.viewportColumns=this.viewportColumnsCenter.concat(this.displayedColumnsLeft).concat(this.displayedColumnsRight),this.headerViewportColumns=this.headerViewportColumnsCenter.concat(this.displayedColumnsLeft).concat(this.displayedColumnsRight)},t.prototype.getVirtualHeaderGroupRow=function(e,r){var o;switch(e){case"left":o=this.viewportRowLeft[r];break;case"right":o=this.viewportRowRight[r];break;default:o=this.viewportRowCenter[r];break}return missing(o)&&(o=[]),o},t.prototype.calculateHeaderRows=function(){this.viewportRowLeft={},this.viewportRowRight={},this.viewportRowCenter={};var e={};this.headerViewportColumns.forEach(function(o){return e[o.getId()]=!0});var r=function(o,s,l){for(var a=!1,h=0;h<o.length;h++){var y=o[h],C=!1;if(y instanceof Column)C=e[y.getId()]===!0;else{var L=y,Y=L.getDisplayedChildren();Y&&(C=r(Y,s,l+1))}C&&(a=!0,s[l]||(s[l]=[]),s[l].push(y))}return a};r(this.displayedTreeLeft,this.viewportRowLeft,0),r(this.displayedTreeRight,this.viewportRowRight,0),r(this.displayedTreeCentre,this.viewportRowCenter,0)},t.prototype.extractViewport=function(){var e=function(s){return s.getId()+"-"+(s.getPinned()||"normal")};this.extractViewportColumns();var r=this.viewportColumns.map(e).join("#"),o=this.viewportColumnsHash!==r;return o&&(this.viewportColumnsHash=r,this.calculateHeaderRows()),o},t.prototype.refreshFlexedColumns=function(e){var r=this;e===void 0&&(e={});var o=e.source?e.source:"flex";if(e.viewportWidth!=null&&(this.flexViewportWidth=e.viewportWidth),!this.flexViewportWidth)return[];var s=-1;e.resizingCols&&e.resizingCols.forEach(function(wo){var ia=r.displayedColumnsCenter.indexOf(wo);s<ia&&(s=ia)});var l=function(wo){var ia=r.displayedColumnsCenter.indexOf(wo)>s;return wo.getFlex()&&ia},a=this.displayedColumnsCenter.filter(function(wo){return!l(wo)}),h=this.displayedColumnsCenter.filter(function(wo){return l(wo)}),y=[];if(!h.length)return[];var C=[],L;e:for(;;){var Y=h.reduce(function(wo,ia){return wo+ia.getFlex()},0);L=this.flexViewportWidth-this.getWidthOfColsInList(a);for(var ze=0;ze<h.length;ze++){var Bt=h[ze],Ir=L*Bt.getFlex()/Y,Wr=0,yi=Bt.getMinWidth(),Bn=Bt.getMaxWidth();if(exists(yi)&&Ir<yi?Wr=yi:exists(Bn)&&Ir>Bn&&(Wr=Bn),Wr){Bt.setActualWidth(Wr,o),removeFromArray(h,Bt),y.push(Bt),a.push(Bt);continue e}C[ze]=Math.round(Ir)}break}var vi=L;return h.forEach(function(wo,ia){wo.setActualWidth(Math.min(C[ia],vi),o),y.push(wo),vi-=C[ia]}),e.skipSetLeft||this.setLeftValues(o),e.updateBodyWidths&&this.updateBodyWidths(),e.fireResizedEvent&&this.dispatchColumnResizedEvent(y,!0,o,h),h},t.prototype.sizeColumnsToFit=function(e,r,o,s){var l=this,a,h,y,C,L;if(r===void 0&&(r="sizeColumnsToFit"),this.shouldQueueResizeOperations){this.resizeOperationQueue.push(function(){return l.sizeColumnsToFit(e,r,o,s)});return}var Y={};s&&((a=s==null?void 0:s.columnLimits)===null||a===void 0||a.forEach(function(gp){var Jh=gp.key,Lp=__rest(gp,["key"]);Y[typeof Jh=="string"?Jh:Jh.getColId()]=Lp}));var ze=this.getAllDisplayedColumns(),Bt=e===this.getWidthOfColsInList(ze);if(!(e<=0||!ze.length||Bt)){var Ir=[],Wr=[];ze.forEach(function(gp){gp.getColDef().suppressSizeToFit===!0?Wr.push(gp):Ir.push(gp)});var yi=Ir.slice(0),Bn=!1,vi=function(gp){removeFromArray(Ir,gp),Wr.push(gp)};for(Ir.forEach(function(gp){return gp.resetActualWidth(r)});!Bn;){Bn=!0;var wo=e-this.getWidthOfColsInList(Wr);if(wo<=0)Ir.forEach(function(gp){var Jh,Lp,Ip=(Lp=(Jh=Y==null?void 0:Y[gp.getId()])===null||Jh===void 0?void 0:Jh.minWidth)!==null&&Lp!==void 0?Lp:s==null?void 0:s.defaultMinWidth;if(typeof Ip=="number"){gp.setActualWidth(Ip);return}gp.setMinimum(r)});else for(var ia=wo/this.getWidthOfColsInList(Ir),gl=wo,ml=Ir.length-1;ml>=0;ml--){var il=Ir[ml],sl=Y==null?void 0:Y[il.getId()],ol=(h=sl==null?void 0:sl.minWidth)!==null&&h!==void 0?h:s==null?void 0:s.defaultMinWidth,_l=(y=sl==null?void 0:sl.maxWidth)!==null&&y!==void 0?y:s==null?void 0:s.defaultMaxWidth,rh=(C=il.getMinWidth())!==null&&C!==void 0?C:0,wh=(L=il.getMaxWidth())!==null&&L!==void 0?L:Number.MAX_VALUE,Fh=typeof ol=="number"&&ol>rh?ol:il.getMinWidth(),Mh=typeof _l=="number"&&_l<wh?_l:il.getMaxWidth(),vp=Math.round(il.getActualWidth()*ia);exists(Fh)&&vp<Fh?(vp=Fh,vi(il),Bn=!1):exists(Mh)&&vp>Mh?(vp=Mh,vi(il),Bn=!1):ml===0&&(vp=gl),il.setActualWidth(vp,r,!0),gl-=vp}}yi.forEach(function(gp){gp.fireColumnWidthChangedEvent(r)}),this.setLeftValues(r),this.updateBodyWidths(),!o&&this.dispatchColumnResizedEvent(yi,!0,r)}},t.prototype.buildDisplayedTrees=function(e){var r=[],o=[],s=[];e.forEach(function(a){switch(a.getPinned()){case"left":r.push(a);break;case"right":o.push(a);break;default:s.push(a);break}});var l=new GroupInstanceIdCreator;this.displayedTreeLeft=this.displayedGroupCreator.createDisplayedGroups(r,this.gridBalancedTree,l,"left",this.displayedTreeLeft),this.displayedTreeRight=this.displayedGroupCreator.createDisplayedGroups(o,this.gridBalancedTree,l,"right",this.displayedTreeRight),this.displayedTreeCentre=this.displayedGroupCreator.createDisplayedGroups(s,this.gridBalancedTree,l,null,this.displayedTreeCentre),this.updateDisplayedMap()},t.prototype.updateDisplayedMap=function(){var e=this;this.displayedColumnsAndGroupsMap={};var r=function(o){e.displayedColumnsAndGroupsMap[o.getUniqueId()]=o};this.columnUtils.depthFirstAllColumnTreeSearch(this.displayedTreeCentre,r),this.columnUtils.depthFirstAllColumnTreeSearch(this.displayedTreeLeft,r),this.columnUtils.depthFirstAllColumnTreeSearch(this.displayedTreeRight,r)},t.prototype.isDisplayed=function(e){var r=this.displayedColumnsAndGroupsMap[e.getUniqueId()];return r===e},t.prototype.updateOpenClosedVisibilityInColumnGroups=function(){var e=this.getAllDisplayedTrees();this.columnUtils.depthFirstAllColumnTreeSearch(e,function(r){if(r instanceof ColumnGroup){var o=r;o.calculateDisplayedColumns()}})},t.prototype.getGroupAutoColumns=function(){return this.groupAutoColumns},t.prototype.createGroupAutoColumnsIfNeeded=function(){var e=this.forceRecreateAutoGroups;if(this.forceRecreateAutoGroups=!1,!this.autoGroupsNeedBuilding)return!1;this.autoGroupsNeedBuilding=!1;var r=this.gridOptionsService.isGroupUseEntireRow(this.pivotMode),o=this.pivotMode?this.gridOptionsService.is("pivotSuppressAutoColumn"):this.isGroupSuppressAutoColumn(),s=this.rowGroupColumns.length>0||this.usingTreeData,l=s&&!o&&!r;if(l){var a=this.groupAutoColumns||[],h=this.autoGroupColService.createAutoGroupColumns(a,this.rowGroupColumns),y=!this.autoColsEqual(h,this.groupAutoColumns);if(y||e)return this.groupAutoColumns=h,!0}else this.groupAutoColumns=null;return!1},t.prototype.isGroupSuppressAutoColumn=function(){var e=this.gridOptionsService.get("groupDisplayType"),r=e?matchesGroupDisplayType("custom",e):!1;if(r)return!0;var o=this.gridOptionsService.get("treeDataDisplayType");return o?matchesTreeDataDisplayType("custom",o):!1},t.prototype.autoColsEqual=function(e,r){return areEqual(e,r,function(o,s){return o.getColId()===s.getColId()})},t.prototype.getWidthOfColsInList=function(e){return e.reduce(function(r,o){return r+o.getActualWidth()},0)},t.prototype.getGridBalancedTree=function(){return this.gridBalancedTree},t.prototype.hasFloatingFilters=function(){if(!this.gridColumns)return!1;var e=this.gridColumns.some(function(r){return r.getColDef().floatingFilter});return e},t.prototype.getFirstDisplayedColumn=function(){var e=this.gridOptionsService.is("enableRtl"),r=["getDisplayedLeftColumns","getDisplayedCenterColumns","getDisplayedRightColumns"];e&&r.reverse();for(var o=0;o<r.length;o++){var s=this[r[o]]();if(s.length)return e?last(s):s[0]}return null},t.prototype.setColumnHeaderHeight=function(e,r){var o=e.setAutoHeaderHeight(r);if(o){var s={type:Events.EVENT_COLUMN_HEADER_HEIGHT_CHANGED,column:e,columns:[e],source:"autosizeColumnHeaderHeight"};this.eventService.dispatchEvent(s)}},t.prototype.getColumnGroupHeaderRowHeight=function(){return this.isPivotMode()?this.getPivotGroupHeaderHeight():this.getGroupHeaderHeight()},t.prototype.getColumnHeaderRowHeight=function(){var e=this.isPivotMode()?this.getPivotHeaderHeight():this.getHeaderHeight(),r=this.getAllDisplayedColumns().filter(function(o){return o.isAutoHeaderHeight()}).map(function(o){return o.getAutoHeaderHeight()||0});return Math.max.apply(Math,__spreadArray$l([e],__read$r(r)))},t.prototype.getHeaderHeight=function(){var e;return(e=this.gridOptionsService.getNum("headerHeight"))!==null&&e!==void 0?e:this.environment.getFromTheme(25,"headerHeight")},t.prototype.getFloatingFiltersHeight=function(){var e;return(e=this.gridOptionsService.getNum("floatingFiltersHeight"))!==null&&e!==void 0?e:this.getHeaderHeight()},t.prototype.getGroupHeaderHeight=function(){var e;return(e=this.gridOptionsService.getNum("groupHeaderHeight"))!==null&&e!==void 0?e:this.getHeaderHeight()},t.prototype.getPivotHeaderHeight=function(){var e;return(e=this.gridOptionsService.getNum("pivotHeaderHeight"))!==null&&e!==void 0?e:this.getHeaderHeight()},t.prototype.getPivotGroupHeaderHeight=function(){var e;return(e=this.gridOptionsService.getNum("pivotGroupHeaderHeight"))!==null&&e!==void 0?e:this.getGroupHeaderHeight()},t.prototype.queueResizeOperations=function(){this.shouldQueueResizeOperations=!0},t.prototype.processResizeOperations=function(){this.shouldQueueResizeOperations=!1,this.resizeOperationQueue.forEach(function(e){return e()}),this.resizeOperationQueue=[]},t.prototype.resetColumnDefIntoColumn=function(e){var r=e.getUserProvidedColDef();if(!r)return!1;var o=this.columnFactory.mergeColDefs(r,e.getColId());return e.setColDef(o,r),!0},t.prototype.generateColumnStateForRowGroupAndPivotIndexes=function(e,r){var o=this,s={},l=function(a,h,y,C,L,Y){if(!h.length||!o.primaryColumns)return[];for(var ze=Object.keys(a),Bt=new Set(ze),Ir=new Set(ze),Wr=new Set(h.map(function(ol){var _l=ol.getColId();return Ir.delete(_l),_l}).concat(ze)),yi=[],Bn={},vi=0,wo=0;wo<o.primaryColumns.length;wo++){var ia=o.primaryColumns[wo].getColId();Wr.has(ia)&&(yi.push(ia),Bn[ia]=vi++)}var gl=1e3,ml=!1,il=0,sl=function(ol){for(var _l=Bn[ol],rh=il;rh<_l;rh++){var wh=yi[rh];Ir.has(wh)&&(a[wh][L]=gl++,Ir.delete(wh))}il=_l};h.forEach(function(ol){var _l=ol.getColId();if(Bt.has(_l))sl(_l),a[_l][L]=gl++;else{var rh=ol.getColDef(),wh=rh[L]===null||rh[L]===void 0&&rh[Y]==null;if(wh){if(!ml){var Fh=rh[y]||rh[y]===void 0&&rh[C];Fh?sl(_l):(Ir.forEach(function(Mh){a[Mh][L]=gl+Bn[Mh]}),gl+=yi.length,ml=!0)}s[_l]||(s[_l]={colId:_l}),s[_l][L]=gl++}}})};return l(e,this.rowGroupColumns,"rowGroup","initialRowGroup","rowGroupIndex","initialRowGroupIndex"),l(r,this.pivotColumns,"pivot","initialPivot","pivotIndex","initialPivotIndex"),Object.values(s)},__decorate$2w([Autowired("expressionService")],t.prototype,"expressionService",void 0),__decorate$2w([Autowired("columnFactory")],t.prototype,"columnFactory",void 0),__decorate$2w([Autowired("displayedGroupCreator")],t.prototype,"displayedGroupCreator",void 0),__decorate$2w([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),__decorate$2w([Autowired("autoWidthCalculator")],t.prototype,"autoWidthCalculator",void 0),__decorate$2w([Autowired("columnUtils")],t.prototype,"columnUtils",void 0),__decorate$2w([Autowired("columnAnimationService")],t.prototype,"columnAnimationService",void 0),__decorate$2w([Autowired("autoGroupColService")],t.prototype,"autoGroupColService",void 0),__decorate$2w([Optional("aggFuncService")],t.prototype,"aggFuncService",void 0),__decorate$2w([Optional("valueCache")],t.prototype,"valueCache",void 0),__decorate$2w([Optional("animationFrameService")],t.prototype,"animationFrameService",void 0),__decorate$2w([Autowired("sortController")],t.prototype,"sortController",void 0),__decorate$2w([Autowired("columnDefFactory")],t.prototype,"columnDefFactory",void 0),__decorate$2w([PostConstruct],t.prototype,"init",null),__decorate$2w([PreDestroy],t.prototype,"destroyColumns",null),__decorate$2w([__param$8(0,Qualifier("loggerFactory"))],t.prototype,"setBeans",null),t=__decorate$2w([Bean("columnModel")],t),t}(BeanStub),__extends$2Y=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$2v=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},ColumnUtils=function(n){__extends$2Y(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.calculateColMinWidth=function(e){return e.minWidth!=null?e.minWidth:this.environment.getMinColWidth()},t.prototype.calculateColMaxWidth=function(e){return e.maxWidth!=null?e.maxWidth:Number.MAX_SAFE_INTEGER},t.prototype.calculateColInitialWidth=function(e){var r=this.calculateColMinWidth(e),o=this.calculateColMaxWidth(e),s,l=attrToNumber(e.width),a=attrToNumber(e.initialWidth);return l!=null?s=l:a!=null?s=a:s=200,Math.max(Math.min(s,o),r)},t.prototype.getOriginalPathForColumn=function(e,r){var o=[],s=!1,l=function(a,h){for(var y=0;y<a.length;y++){if(s)return;var C=a[y];if(C instanceof ProvidedColumnGroup){var L=C;l(L.getChildren(),h+1),o[h]=C}else C===e&&(s=!0)}};return l(r,0),s?o:null},t.prototype.depthFirstOriginalTreeSearch=function(e,r,o){var s=this;r&&r.forEach(function(l){l instanceof ProvidedColumnGroup&&s.depthFirstOriginalTreeSearch(l,l.getChildren(),o),o(l,e)})},t.prototype.depthFirstAllColumnTreeSearch=function(e,r){var o=this;e&&e.forEach(function(s){s instanceof ColumnGroup&&o.depthFirstAllColumnTreeSearch(s.getChildren(),r),r(s)})},t.prototype.depthFirstDisplayedColumnTreeSearch=function(e,r){var o=this;e&&e.forEach(function(s){s instanceof ColumnGroup&&o.depthFirstDisplayedColumnTreeSearch(s.getDisplayedChildren(),r),r(s)})},t=__decorate$2v([Bean("columnUtils")],t),t}(BeanStub),__extends$2X=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$2u=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},DisplayedGroupCreator=function(n){__extends$2X(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.createDisplayedGroups=function(e,r,o,s,l){var a=this,h=[],y,C,L=this.mapOldGroupsById(l);return e.forEach(function(Y){for(var ze=a.getOriginalPathForColumn(r,Y),Bt=[],Ir=!C,Wr=0;Wr<ze.length;Wr++)if(Ir||ze[Wr]!==C[Wr]){var yi=a.createColumnGroup(ze[Wr],o,L,s);Bt[Wr]=yi,Wr==0?h.push(yi):Bt[Wr-1].addChild(yi)}else Bt[Wr]=y[Wr];var Bn=Bt.length===0;if(Bn)h.push(Y);else{var vi=last(Bt);vi.addChild(Y)}y=Bt,C=ze}),this.setupParentsIntoColumns(h,null),h},t.prototype.createColumnGroup=function(e,r,o,s){var l=e.getGroupId(),a=r.getInstanceIdForKey(l),h=ColumnGroup.createUniqueId(l,a),y=o[h];return y&&y.getProvidedColumnGroup()!==e&&(y=null),exists(y)?y.reset():(y=new ColumnGroup(e,l,a,s),this.context.createBean(y)),y},t.prototype.mapOldGroupsById=function(e){var r={},o=function(s){s.forEach(function(l){if(l instanceof ColumnGroup){var a=l;r[l.getUniqueId()]=a,o(a.getChildren())}})};return e&&o(e),r},t.prototype.setupParentsIntoColumns=function(e,r){var o=this;e.forEach(function(s){if(s.setParent(r),s instanceof ColumnGroup){var l=s;o.setupParentsIntoColumns(l.getChildren(),l)}})},t.prototype.getOriginalPathForColumn=function(e,r){var o=[],s=!1,l=function(a,h){for(var y=0;y<a.length;y++){if(s)return;var C=a[y];C instanceof ProvidedColumnGroup?(l(C.getChildren(),h+1),o[h]=C):C===r&&(s=!0)}};return l(e,0),s?o:(console.warn("AG Grid: could not get path"),null)},t=__decorate$2u([Bean("displayedGroupCreator")],t),t}(BeanStub),__extends$2W=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$2t=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},AgStackComponentsRegistry=function(n){__extends$2W(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.componentsMappedByName={},e}return t.prototype.setupComponents=function(e){var r=this;e&&e.forEach(function(o){return r.addComponent(o)})},t.prototype.addComponent=function(e){var r=e.componentName.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),o=r.toUpperCase();this.componentsMappedByName[o]=e.componentClass},t.prototype.getComponentClass=function(e){return this.componentsMappedByName[e]},t=__decorate$2t([Bean("agStackComponentsRegistry")],t),t}(BeanStub);function toggleAriaAttribute(n,t,e){e==null||e==""?removeAriaAttribute(n,t):setAriaAttribute(n,t,e)}function setAriaAttribute(n,t,e){n.setAttribute(ariaAttributeName(t),e.toString())}function removeAriaAttribute(n,t){n.removeAttribute(ariaAttributeName(t))}function ariaAttributeName(n){return"aria-"+n}function setAriaRole(n,t){t?n.setAttribute("role",t):n.removeAttribute("role")}function getAriaSortState(n){var t;return n==="asc"?t="ascending":n==="desc"?t="descending":n==="mixed"?t="other":t="none",t}function getAriaLevel(n){return parseInt(n.getAttribute("aria-level"),10)}function getAriaPosInSet(n){return parseInt(n.getAttribute("aria-posinset"),10)}function getAriaDescribedBy(n){return n.getAttribute("aria-describedby")||""}function setAriaLabel(n,t){toggleAriaAttribute(n,"label",t)}function setAriaLabelledBy(n,t){toggleAriaAttribute(n,"labelledby",t)}function setAriaDescription(n,t){toggleAriaAttribute(n,"description",t)}function setAriaDescribedBy(n,t){toggleAriaAttribute(n,"describedby",t)}function setAriaLive(n,t){toggleAriaAttribute(n,"live",t)}function setAriaLevel(n,t){toggleAriaAttribute(n,"level",t)}function setAriaDisabled(n,t){toggleAriaAttribute(n,"disabled",t)}function setAriaHidden(n,t){toggleAriaAttribute(n,"hidden",t)}function setAriaExpanded(n,t){setAriaAttribute(n,"expanded",t)}function removeAriaExpanded(n){removeAriaAttribute(n,"expanded")}function setAriaSetSize(n,t){setAriaAttribute(n,"setsize",t)}function setAriaPosInSet(n,t){setAriaAttribute(n,"posinset",t)}function setAriaMultiSelectable(n,t){setAriaAttribute(n,"multiselectable",t)}function setAriaRowCount(n,t){setAriaAttribute(n,"rowcount",t)}function setAriaRowIndex(n,t){setAriaAttribute(n,"rowindex",t)}function setAriaColCount(n,t){setAriaAttribute(n,"colcount",t)}function setAriaColIndex(n,t){setAriaAttribute(n,"colindex",t)}function setAriaColSpan(n,t){setAriaAttribute(n,"colspan",t)}function setAriaSort(n,t){setAriaAttribute(n,"sort",t)}function removeAriaSort(n){removeAriaAttribute(n,"sort")}function setAriaSelected(n,t){toggleAriaAttribute(n,"selected",t)}function setAriaChecked(n,t){setAriaAttribute(n,"checked",t===void 0?"mixed":t)}function setAriaControls(n,t){toggleAriaAttribute(n,"controls",t.id),setAriaLabelledBy(t,n.id)}function getAriaCheckboxStateName(n,t){return t===void 0?n("ariaIndeterminate","indeterminate"):t===!0?n("ariaChecked","checked"):n("ariaUnchecked","unchecked")}var AriaUtils=Object.freeze({__proto__:null,setAriaRole,getAriaSortState,getAriaLevel,getAriaPosInSet,getAriaDescribedBy,setAriaLabel,setAriaLabelledBy,setAriaDescription,setAriaDescribedBy,setAriaLive,setAriaLevel,setAriaDisabled,setAriaHidden,setAriaExpanded,removeAriaExpanded,setAriaSetSize,setAriaPosInSet,setAriaMultiSelectable,setAriaRowCount,setAriaRowIndex,setAriaColCount,setAriaColIndex,setAriaColSpan,setAriaSort,removeAriaSort,setAriaSelected,setAriaChecked,setAriaControls,getAriaCheckboxStateName}),isSafari,safariVersion,isChrome,isFirefox,isMacOs,isIOS,invisibleScrollbar,browserScrollbarWidth;function isBrowserSafari(){return isSafari===void 0&&(isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),isSafari}function getSafariVersion(){if(safariVersion===void 0)if(isBrowserSafari()){var n=navigator.userAgent.match(/version\/(\d+)/i);n&&(safariVersion=n[1]!=null?parseFloat(n[1]):0)}else safariVersion=0;return safariVersion}function isBrowserChrome(){if(isChrome===void 0){var n=window;isChrome=!!n.chrome&&(!!n.chrome.webstore||!!n.chrome.runtime)||/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}return isChrome}function isBrowserFirefox(){return isFirefox===void 0&&(isFirefox=/(firefox)/i.test(navigator.userAgent)),isFirefox}function isMacOsUserAgent(){return isMacOs===void 0&&(isMacOs=/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)),isMacOs}function isIOSUserAgent(){return isIOS===void 0&&(isIOS=/iPad|iPhone|iPod/.test(navigator.platform)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1),isIOS}function browserSupportsPreventScroll(){return!isBrowserSafari()||getSafariVersion()>=15}function getTabIndex(n){if(!n)return null;var t=n.tabIndex,e=n.getAttribute("tabIndex");return t===-1&&(e===null||e===""&&!isBrowserFirefox())?null:t.toString()}function getMaxDivHeight(){if(!document.body)return-1;var n=1e6,t=navigator.userAgent.toLowerCase().match(/firefox/)?6e6:1e9,e=document.createElement("div");for(document.body.appendChild(e);;){var r=n*2;if(e.style.height=r+"px",r>t||e.clientHeight!==r)break;n=r}return document.body.removeChild(e),n}function getBodyWidth(){var n,t,e;return(t=(n=document.body)===null||n===void 0?void 0:n.clientWidth)!==null&&t!==void 0?t:window.innerHeight||((e=document.documentElement)===null||e===void 0?void 0:e.clientWidth)||-1}function getBodyHeight(){var n,t,e;return(t=(n=document.body)===null||n===void 0?void 0:n.clientHeight)!==null&&t!==void 0?t:window.innerHeight||((e=document.documentElement)===null||e===void 0?void 0:e.clientHeight)||-1}function getScrollbarWidth(){return browserScrollbarWidth==null&&initScrollbarWidthAndVisibility(),browserScrollbarWidth}function initScrollbarWidthAndVisibility(){var n=document.body,t=document.createElement("div");t.style.width=t.style.height="100px",t.style.opacity="0",t.style.overflow="scroll",t.style.msOverflowStyle="scrollbar",t.style.position="absolute",n.appendChild(t);var e=t.offsetWidth-t.clientWidth;e===0&&t.clientWidth===0&&(e=null),t.parentNode&&t.parentNode.removeChild(t),e!=null&&(browserScrollbarWidth=e,invisibleScrollbar=e===0)}function isInvisibleScrollbar(){return invisibleScrollbar==null&&initScrollbarWidthAndVisibility(),invisibleScrollbar}var BrowserUtils=Object.freeze({__proto__:null,isBrowserSafari,getSafariVersion,isBrowserChrome,isBrowserFirefox,isMacOsUserAgent,isIOSUserAgent,browserSupportsPreventScroll,getTabIndex,getMaxDivHeight,getBodyWidth,getBodyHeight,getScrollbarWidth,isInvisibleScrollbar});function padStartWidthZeros(n,t){return n.toString().padStart(t,"0")}function createArrayOfNumbers(n,t){for(var e=[],r=n;r<=t;r++)e.push(r);return e}function cleanNumber(n){return typeof n=="string"&&(n=parseInt(n,10)),typeof n=="number"?Math.floor(n):null}function decToHex(n,t){for(var e="",r=0;r<t;r++)e+=String.fromCharCode(n&255),n>>>=8;return e}function formatNumberTwoDecimalPlacesAndCommas(n,t,e){return typeof n!="number"?"":formatNumberCommas(Math.round(n*100)/100,t,e)}function formatNumberCommas(n,t,e){return typeof n!="number"?"":n.toString().replace(".",e).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+t)}function sum$1(n){return n==null?null:n.reduce(function(t,e){return t+e},0)}function zeroOrGreater(n,t){return n>=0?n:t}function oneOrGreater(n,t){var e=parseInt(n,10);return!isNaN(e)&&isFinite(e)&&e>0?e:t}var NumberUtils=Object.freeze({__proto__:null,padStartWidthZeros,createArrayOfNumbers,cleanNumber,decToHex,formatNumberTwoDecimalPlacesAndCommas,formatNumberCommas,sum:sum$1,zeroOrGreater,oneOrGreater}),__read$q=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s};function serialiseDate(n,t,e){if(t===void 0&&(t=!0),e===void 0&&(e="-"),!n)return null;var r=[n.getFullYear(),n.getMonth()+1,n.getDate()].map(function(o){return padStartWidthZeros(o,2)}).join(e);return t&&(r+=" "+[n.getHours(),n.getMinutes(),n.getSeconds()].map(function(o){return padStartWidthZeros(o,2)}).join(":")),r}var calculateOrdinal=function(n){if(n>3&&n<21)return"th";var t=n%10;switch(t){case 1:return"st";case 2:return"nd";case 3:return"rd"}return"th"};function dateToFormattedString(n,t){t===void 0&&(t="YYYY-MM-DD");var e=padStartWidthZeros(n.getFullYear(),4),r=["January","February","March","April","May","June","July","August","September","October","November","December"],o=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],s={YYYY:function(){return e.slice(e.length-4,e.length)},YY:function(){return e.slice(e.length-2,e.length)},Y:function(){return""+n.getFullYear()},MMMM:function(){return r[n.getMonth()]},MMM:function(){return r[n.getMonth()].slice(0,3)},MM:function(){return padStartWidthZeros(n.getMonth()+1,2)},Mo:function(){return""+(n.getMonth()+1)+calculateOrdinal(n.getMonth()+1)},M:function(){return""+(n.getMonth()+1)},Do:function(){return""+n.getDate()+calculateOrdinal(n.getDate())},DD:function(){return padStartWidthZeros(n.getDate(),2)},D:function(){return""+n.getDate()},dddd:function(){return o[n.getDay()]},ddd:function(){return o[n.getDay()].slice(0,3)},dd:function(){return o[n.getDay()].slice(0,2)},do:function(){return""+n.getDay()+calculateOrdinal(n.getDay())},d:function(){return""+n.getDay()}},l=new RegExp(Object.keys(s).join("|"),"g");return t.replace(l,function(a){return a in s?s[a]():a})}function parseDateTimeFromString(n){if(!n)return null;var t=__read$q(n.split(" "),2),e=t[0],r=t[1];if(!e)return null;var o=e.split("-").map(function(Bt){return parseInt(Bt,10)});if(o.filter(function(Bt){return!isNaN(Bt)}).length!==3)return null;var s=__read$q(o,3),l=s[0],a=s[1],h=s[2],y=new Date(l,a-1,h);if(y.getFullYear()!==l||y.getMonth()!==a-1||y.getDate()!==h)return null;if(!r||r==="00:00:00")return y;var C=__read$q(r.split(":").map(function(Bt){return parseInt(Bt,10)}),3),L=C[0],Y=C[1],ze=C[2];return L>=0&&L<24&&y.setHours(L),Y>=0&&Y<60&&y.setMinutes(Y),ze>=0&&ze<60&&y.setSeconds(ze),y}var DateUtils=Object.freeze({__proto__:null,serialiseDate,dateToFormattedString,parseDateTimeFromString}),__values$5=function(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],r=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},__read$p=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},rtlNegativeScroll;function radioCssClass(n,t,e){for(var r=n.parentElement,o=r&&r.firstChild;o;)t&&o.classList.toggle(t,o===n),e&&o.classList.toggle(e,o!==n),o=o.nextSibling}var FOCUSABLE_SELECTOR="[tabindex], input, select, button, textarea, [href]",FOCUSABLE_EXCLUDE=".ag-hidden, .ag-hidden *, [disabled], .ag-disabled:not(.ag-button), .ag-disabled *";function isFocusableFormField(n){var t=Element.prototype.matches||Element.prototype.msMatchesSelector,e="input, select, button, textarea",r=t.call(n,e),o=t.call(n,FOCUSABLE_EXCLUDE),s=isVisible(n),l=r&&!o&&s;return l}function setDisplayed(n,t,e){e===void 0&&(e={});var r=e.skipAriaHidden;n.classList.toggle("ag-hidden",!t),r||setAriaHidden(n,!t)}function setVisible(n,t,e){e===void 0&&(e={});var r=e.skipAriaHidden;n.classList.toggle("ag-invisible",!t),r||setAriaHidden(n,!t)}function setDisabled(n,t){var e="disabled",r=t?function(o){return o.setAttribute(e,"")}:function(o){return o.removeAttribute(e)};r(n),nodeListForEach(n.querySelectorAll("input"),function(o){return r(o)})}function isElementChildOfClass(n,t,e){for(var r=0;n;){if(n.classList.contains(t))return!0;if(n=n.parentElement,typeof e=="number"){if(++r>e)break}else if(n===e)break}return!1}function getElementSize(n){var t=window.getComputedStyle(n),e=t.height,r=t.width,o=t.borderTopWidth,s=t.borderRightWidth,l=t.borderBottomWidth,a=t.borderLeftWidth,h=t.paddingTop,y=t.paddingRight,C=t.paddingBottom,L=t.paddingLeft,Y=t.marginTop,ze=t.marginRight,Bt=t.marginBottom,Ir=t.marginLeft,Wr=t.boxSizing;return{height:parseFloat(e),width:parseFloat(r),borderTopWidth:parseFloat(o),borderRightWidth:parseFloat(s),borderBottomWidth:parseFloat(l),borderLeftWidth:parseFloat(a),paddingTop:parseFloat(h),paddingRight:parseFloat(y),paddingBottom:parseFloat(C),paddingLeft:parseFloat(L),marginTop:parseFloat(Y),marginRight:parseFloat(ze),marginBottom:parseFloat(Bt),marginLeft:parseFloat(Ir),boxSizing:Wr}}function getInnerHeight(n){var t=getElementSize(n);return t.boxSizing==="border-box"?t.height-t.paddingTop-t.paddingBottom:t.height}function getInnerWidth(n){var t=getElementSize(n);return t.boxSizing==="border-box"?t.width-t.paddingLeft-t.paddingRight:t.width}function getAbsoluteHeight(n){var t=getElementSize(n),e=t.marginBottom+t.marginTop;return Math.ceil(n.offsetHeight+e)}function getAbsoluteWidth(n){var t=getElementSize(n),e=t.marginLeft+t.marginRight;return Math.ceil(n.offsetWidth+e)}function getElementRectWithOffset(n){var t=n.getBoundingClientRect(),e=getElementSize(n),r=e.borderTopWidth,o=e.borderLeftWidth,s=e.borderRightWidth,l=e.borderBottomWidth;return{top:t.top+(r||0),left:t.left+(o||0),right:t.right+(s||0),bottom:t.bottom+(l||0)}}function isRtlNegativeScroll(){if(typeof rtlNegativeScroll=="boolean")return rtlNegativeScroll;var n=document.createElement("div");return n.style.direction="rtl",n.style.width="1px",n.style.height="1px",n.style.position="fixed",n.style.top="0px",n.style.overflow="hidden",n.dir="rtl",n.innerHTML=`<div style="width: 2px">
            <span style="display: inline-block; width: 1px"></span>
            <span style="display: inline-block; width: 1px"></span>
        </div>`,document.body.appendChild(n),n.scrollLeft=1,rtlNegativeScroll=Math.floor(n.scrollLeft)===0,document.body.removeChild(n),rtlNegativeScroll}function getScrollLeft(n,t){var e=n.scrollLeft;return t&&(e=Math.abs(e),isBrowserChrome()&&!isRtlNegativeScroll()&&(e=n.scrollWidth-n.clientWidth-e)),e}function setScrollLeft(n,t,e){e&&(isRtlNegativeScroll()?t*=-1:(isBrowserSafari()||isBrowserChrome())&&(t=n.scrollWidth-n.clientWidth-t)),n.scrollLeft=t}function clearElement(n){for(;n&&n.firstChild;)n.removeChild(n.firstChild)}function removeElement(n,t){removeFromParent(n.querySelector(t))}function removeFromParent(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function isVisible(n){return n.offsetParent!==null}function loadTemplate(n){var t=document.createElement("div");return t.innerHTML=(n||"").trim(),t.firstChild}function appendHtml(n,t){n.lastChild?n.insertAdjacentHTML("afterbegin",t):n.innerHTML=t}function getElementAttribute(n,t){if(n.attributes&&n.attributes[t]){var e=n.attributes[t];return e.value}return null}function offsetHeight(n){return n&&n.clientHeight?n.clientHeight:0}function offsetWidth(n){return n&&n.clientWidth?n.clientWidth:0}function ensureDomOrder(n,t,e){if(!(e&&e.nextSibling===t)){var r=document.activeElement,o=t.contains(r);e?e.nextSibling?n.insertBefore(t,e.nextSibling):n.appendChild(t):n.firstChild&&n.firstChild!==t&&n.insertAdjacentElement("afterbegin",t),o&&r&&browserSupportsPreventScroll()&&r.focus({preventScroll:!0})}}function setDomChildOrder(n,t){for(var e=0;e<t.length;e++){var r=t[e],o=n.children[e];o!==r&&n.insertBefore(r,o)}}function insertWithDomOrder(n,t,e){e?e.insertAdjacentElement("afterend",t):n.firstChild?n.insertAdjacentElement("afterbegin",t):n.appendChild(t)}function prependDC(n,t){exists(n.firstChild)?n.insertBefore(t,n.firstChild):n.appendChild(t)}function addStylesToElement(n,t){var e,r;if(t)try{for(var o=__values$5(Object.entries(t)),s=o.next();!s.done;s=o.next()){var l=__read$p(s.value,2),a=l[0],h=l[1];if(!(!a||!a.length||h==null)){var y=camelCaseToHyphenated(a),C=h.toString(),L=C.replace(/\s*!important/g,""),Y=L.length!=C.length?"important":void 0;n.style.setProperty(y,L,Y)}}}catch(ze){e={error:ze}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}}function isHorizontalScrollShowing(n){return n.clientWidth<n.scrollWidth}function isVerticalScrollShowing(n){return n.clientHeight<n.scrollHeight}function setElementWidth(n,t){t==="flex"?(n.style.removeProperty("width"),n.style.removeProperty("minWidth"),n.style.removeProperty("maxWidth"),n.style.flex="1 1 auto"):setFixedWidth(n,t)}function setFixedWidth(n,t){t=formatSize(t),n.style.width=t.toString(),n.style.maxWidth=t.toString(),n.style.minWidth=t.toString()}function setElementHeight(n,t){t==="flex"?(n.style.removeProperty("height"),n.style.removeProperty("minHeight"),n.style.removeProperty("maxHeight"),n.style.flex="1 1 auto"):setFixedHeight(n,t)}function setFixedHeight(n,t){t=formatSize(t),n.style.height=t.toString(),n.style.maxHeight=t.toString(),n.style.minHeight=t.toString()}function formatSize(n){return typeof n=="number"?n+"px":n}function isNodeOrElement(n){return n instanceof Node||n instanceof HTMLElement}function copyNodeList(n){if(n==null)return[];var t=[];return nodeListForEach(n,function(e){return t.push(e)}),t}function iterateNamedNodeMap(n,t){if(n)for(var e=0;e<n.length;e++){var r=n[e];t(r.name,r.value)}}function addOrRemoveAttribute(n,t,e){e==null?n.removeAttribute(t):n.setAttribute(t,e.toString())}function nodeListForEach(n,t){if(n!=null)for(var e=0;e<n.length;e++)t(n[e])}var DomUtils=Object.freeze({__proto__:null,radioCssClass,FOCUSABLE_SELECTOR,FOCUSABLE_EXCLUDE,isFocusableFormField,setDisplayed,setVisible,setDisabled,isElementChildOfClass,getElementSize,getInnerHeight,getInnerWidth,getAbsoluteHeight,getAbsoluteWidth,getElementRectWithOffset,isRtlNegativeScroll,getScrollLeft,setScrollLeft,clearElement,removeElement,removeFromParent,isVisible,loadTemplate,appendHtml,getElementAttribute,offsetHeight,offsetWidth,ensureDomOrder,setDomChildOrder,insertWithDomOrder,prependDC,addStylesToElement,isHorizontalScrollShowing,isVerticalScrollShowing,setElementWidth,setFixedWidth,setElementHeight,setFixedHeight,formatSize,isNodeOrElement,copyNodeList,iterateNamedNodeMap,addOrRemoveAttribute,nodeListForEach}),iconNameClassMap={columnGroupOpened:"expanded",columnGroupClosed:"contracted",columnSelectClosed:"tree-closed",columnSelectOpen:"tree-open",columnSelectIndeterminate:"tree-indeterminate",columnMovePin:"pin",columnMoveHide:"eye-slash",columnMoveMove:"arrows",columnMoveLeft:"left",columnMoveRight:"right",columnMoveGroup:"group",columnMoveValue:"aggregation",columnMovePivot:"pivot",dropNotAllowed:"not-allowed",groupContracted:"tree-closed",groupExpanded:"tree-open",setFilterGroupClosed:"tree-closed",setFilterGroupOpen:"tree-open",setFilterGroupIndeterminate:"tree-indeterminate",chart:"chart",close:"cross",cancel:"cancel",check:"tick",first:"first",previous:"previous",next:"next",last:"last",linked:"linked",unlinked:"unlinked",colorPicker:"color-picker",groupLoading:"loading",menu:"menu",filter:"filter",columns:"columns",maximize:"maximize",minimize:"minimize",menuPin:"pin",menuValue:"aggregation",menuAddRowGroup:"group",menuRemoveRowGroup:"group",clipboardCopy:"copy",clipboardCut:"cut",clipboardPaste:"paste",pivotPanel:"pivot",rowGroupPanel:"group",valuePanel:"aggregation",columnDrag:"grip",rowDrag:"grip",save:"save",csvExport:"csv",excelExport:"excel",smallDown:"small-down",smallLeft:"small-left",smallRight:"small-right",smallUp:"small-up",sortAscending:"asc",sortDescending:"desc",sortUnSort:"none"};function createIcon(n,t,e){var r=createIconNoSpan(n,t,e);if(r){var o=r.className;if(typeof o=="string"&&o.indexOf("ag-icon")>-1||typeof o=="object"&&o["ag-icon"])return r}var s=document.createElement("span");return s.appendChild(r),s}function createIconNoSpan(n,t,e,r){var o=null,s=e&&e.getColDef().icons;if(s&&(o=s[n]),t&&!o){var l=t.get("icons");l&&(o=l[n])}if(o){var a=void 0;if(typeof o=="function")a=o();else if(typeof o=="string")a=o;else throw new Error("icon from grid options needs to be a string or a function");if(typeof a=="string")return loadTemplate(a);if(isNodeOrElement(a))return a;console.warn("AG Grid: iconRenderer should return back a string or a dom object")}else{var h=document.createElement("span"),y=iconNameClassMap[n];return y||(r?y=n:(console.warn("AG Grid: Did not find icon "+n),y="")),h.setAttribute("class","ag-icon ag-icon-"+y),h.setAttribute("unselectable","on"),setAriaRole(h,"presentation"),h}}var IconUtils=Object.freeze({__proto__:null,iconNameClassMap,createIcon,createIconNoSpan}),KeyCode=function(){function n(){}return n.BACKSPACE="Backspace",n.TAB="Tab",n.ENTER="Enter",n.ESCAPE="Escape",n.SPACE=" ",n.LEFT="ArrowLeft",n.UP="ArrowUp",n.RIGHT="ArrowRight",n.DOWN="ArrowDown",n.DELETE="Delete",n.F2="F2",n.PAGE_UP="PageUp",n.PAGE_DOWN="PageDown",n.PAGE_HOME="Home",n.PAGE_END="End",n.A="KeyA",n.C="KeyC",n.D="KeyD",n.V="KeyV",n.X="KeyX",n.Y="KeyY",n.Z="KeyZ",n}(),A_KEYCODE=65,C_KEYCODE=67,V_KEYCODE=86,D_KEYCODE=68,Z_KEYCODE=90,Y_KEYCODE=89;function isEventFromPrintableCharacter(n){if(n.altKey||n.ctrlKey||n.metaKey)return!1;var t=n.key.length===1;return t}function isUserSuppressingKeyboardEvent(n,t,e,r,o){var s=r?r.getColDef().suppressKeyboardEvent:void 0;if(!s)return!1;var l={event:t,editing:o,column:r,api:n.api,node:e,data:e.data,colDef:r.getColDef(),context:n.context,columnApi:n.columnApi};if(s){var a=s(l);if(a)return!0}return!1}function isUserSuppressingHeaderKeyboardEvent(n,t,e,r){var o=r.getDefinition(),s=o&&o.suppressHeaderKeyboardEvent;if(!exists(s))return!1;var l={api:n.api,columnApi:n.columnApi,context:n.context,colDef:o,column:r,headerRowIndex:e,event:t};return!!s(l)}function normaliseQwertyAzerty(n){var t=n.keyCode,e;switch(t){case A_KEYCODE:e=KeyCode.A;break;case C_KEYCODE:e=KeyCode.C;break;case V_KEYCODE:e=KeyCode.V;break;case D_KEYCODE:e=KeyCode.D;break;case Z_KEYCODE:e=KeyCode.Z;break;case Y_KEYCODE:e=KeyCode.Y;break;default:e=n.code}return e}function isDeleteKey(n,t){return t===void 0&&(t=!1),n===KeyCode.DELETE?!0:!t&&n===KeyCode.BACKSPACE?isMacOsUserAgent():!1}var KeyboardUtils=Object.freeze({__proto__:null,isEventFromPrintableCharacter,isUserSuppressingKeyboardEvent,isUserSuppressingHeaderKeyboardEvent,normaliseQwertyAzerty,isDeleteKey});function areEventsNear(n,t,e){if(e===0)return!1;var r=Math.abs(n.clientX-t.clientX),o=Math.abs(n.clientY-t.clientY);return Math.max(r,o)<=e}var MouseUtils=Object.freeze({__proto__:null,areEventsNear});function sortRowNodesByOrder(n,t){if(!n)return!1;for(var e=function(a,h){var y=t[a.id],C=t[h.id],L=y!==void 0,Y=C!==void 0,ze=L&&Y,Bt=!L&&!Y;return ze?y-C:Bt?a.__objectId-h.__objectId:L?1:-1},r,o,s=!1,l=0;l<n.length-1;l++)if(r=n[l],o=n[l+1],e(r,o)>0){s=!0;break}return s?(n.sort(e),!0):!1}function traverseNodesWithKey(n,t){var e=[];r(n);function r(o){o&&o.forEach(function(s){if(s.group||s.hasChildren()){e.push(s.key);var l=e.join("|");t(s,l),r(s.childrenAfterGroup),e.pop()}})}}var RowNodeUtils=Object.freeze({__proto__:null,sortRowNodesByOrder,traverseNodesWithKey});function convertToSet(n){var t=new Set;return n.forEach(function(e){return t.add(e)}),t}var SetUtils=Object.freeze({__proto__:null,convertToSet}),__assign$k=function(){return __assign$k=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},__assign$k.apply(this,arguments)},utils=__assign$k(__assign$k(__assign$k(__assign$k(__assign$k(__assign$k(__assign$k(__assign$k(__assign$k(__assign$k(__assign$k(__assign$k(__assign$k(__assign$k(__assign$k(__assign$k(__assign$k(__assign$k({},AriaUtils),ArrayUtils),BrowserUtils),DateUtils),DomUtils),EventUtils),FunctionUtils),FuzzyMatchUtils),GenericUtils),IconUtils),KeyboardUtils),MapUtils),MouseUtils),NumberUtils),ObjectUtils),RowNodeUtils),SetUtils),StringUtils),_=utils,NumberSequence=function(){function n(t,e){t===void 0&&(t=0),e===void 0&&(e=1),this.nextValue=t,this.step=e}return n.prototype.next=function(){var t=this.nextValue;return this.nextValue+=this.step,t},n.prototype.peek=function(){return this.nextValue},n.prototype.skip=function(t){this.nextValue+=t},n}(),AgPromiseStatus;(function(n){n[n.IN_PROGRESS=0]="IN_PROGRESS",n[n.RESOLVED=1]="RESOLVED"})(AgPromiseStatus||(AgPromiseStatus={}));var AgPromise=function(){function n(t){var e=this;this.status=AgPromiseStatus.IN_PROGRESS,this.resolution=null,this.waiters=[],t(function(r){return e.onDone(r)},function(r){return e.onReject(r)})}return n.all=function(t){return new n(function(e){var r=t.length,o=new Array(r);t.forEach(function(s,l){s.then(function(a){o[l]=a,r--,r===0&&e(o)})})})},n.resolve=function(t){return t===void 0&&(t=null),new n(function(e){return e(t)})},n.prototype.then=function(t){var e=this;return new n(function(r){e.status===AgPromiseStatus.RESOLVED?r(t(e.resolution)):e.waiters.push(function(o){return r(t(o))})})},n.prototype.resolveNow=function(t,e){return this.status===AgPromiseStatus.RESOLVED?e(this.resolution):t},n.prototype.onDone=function(t){this.status=AgPromiseStatus.RESOLVED,this.resolution=t,this.waiters.forEach(function(e){return e(t)})},n.prototype.onReject=function(t){console.warn("TBI")},n}(),__extends$2V=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__assign$j=function(){return __assign$j=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},__assign$j.apply(this,arguments)},__decorate$2s=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},TooltipStates;(function(n){n[n.NOTHING=0]="NOTHING",n[n.WAITING_TO_SHOW=1]="WAITING_TO_SHOW",n[n.SHOWING=2]="SHOWING"})(TooltipStates||(TooltipStates={}));var CustomTooltipFeature=function(n){__extends$2V(t,n);function t(e){var r=n.call(this)||this;return r.DEFAULT_SHOW_TOOLTIP_DELAY=2e3,r.DEFAULT_HIDE_TOOLTIP_DELAY=1e4,r.SHOW_QUICK_TOOLTIP_DIFF=1e3,r.FADE_OUT_TOOLTIP_TIMEOUT=1e3,r.state=TooltipStates.NOTHING,r.tooltipInstanceCount=0,r.tooltipMouseTrack=!1,r.parentComp=e,r}return t.prototype.postConstruct=function(){this.tooltipShowDelay=this.getTooltipDelay("show")||this.DEFAULT_SHOW_TOOLTIP_DELAY,this.tooltipHideDelay=this.getTooltipDelay("hide")||this.DEFAULT_HIDE_TOOLTIP_DELAY,this.tooltipMouseTrack=this.gridOptionsService.is("tooltipMouseTrack");var e=this.parentComp.getGui();this.addManagedListener(e,"mouseenter",this.onMouseEnter.bind(this)),this.addManagedListener(e,"mouseleave",this.onMouseLeave.bind(this)),this.addManagedListener(e,"mousemove",this.onMouseMove.bind(this)),this.addManagedListener(e,"mousedown",this.onMouseDown.bind(this)),this.addManagedListener(e,"keydown",this.onKeyDown.bind(this))},t.prototype.destroy=function(){this.setToDoNothing(),n.prototype.destroy.call(this)},t.prototype.onMouseEnter=function(e){if(!isIOSUserAgent()&&this.state==TooltipStates.NOTHING){var r=this.isLastTooltipHiddenRecently()?200:this.tooltipShowDelay;this.showTooltipTimeoutId=window.setTimeout(this.showTooltip.bind(this),r),this.lastMouseEvent=e,this.state=TooltipStates.WAITING_TO_SHOW}},t.prototype.onMouseLeave=function(){this.setToDoNothing()},t.prototype.onKeyDown=function(){this.setToDoNothing()},t.prototype.setToDoNothing=function(){this.state===TooltipStates.SHOWING&&this.hideTooltip(),this.clearTimeouts(),this.state=TooltipStates.NOTHING},t.prototype.onMouseMove=function(e){this.lastMouseEvent=e,this.tooltipMouseTrack&&this.state===TooltipStates.SHOWING&&this.tooltipComp&&this.positionTooltipUnderLastMouseEvent()},t.prototype.onMouseDown=function(){this.setToDoNothing()},t.prototype.getTooltipDelay=function(e){var r=this.gridOptionsService.getNum("tooltipShowDelay"),o=this.gridOptionsService.getNum("tooltipHideDelay"),s=e==="show"?r:o,l=capitalise(e);return exists(s)?(s<0&&doOnce(function(){return console.warn("AG Grid: tooltip"+l+"Delay should not be lower than 0")},"tooltip"+l+"DelayWarn"),Math.max(200,s)):null},t.prototype.hideTooltip=function(){this.tooltipComp&&(this.destroyTooltipComp(),t.lastTooltipHideTime=new Date().getTime()),this.state=TooltipStates.NOTHING},t.prototype.destroyTooltipComp=function(){var e=this;this.tooltipComp.getGui().classList.add("ag-tooltip-hiding");var r=this.tooltipPopupDestroyFunc,o=this.tooltipComp;window.setTimeout(function(){r(),e.getContext().destroyBean(o)},this.FADE_OUT_TOOLTIP_TIMEOUT),this.tooltipPopupDestroyFunc=void 0,this.tooltipComp=void 0},t.prototype.isLastTooltipHiddenRecently=function(){var e=new Date().getTime(),r=t.lastTooltipHideTime;return e-r<this.SHOW_QUICK_TOOLTIP_DIFF},t.prototype.showTooltip=function(){var e=__assign$j({},this.parentComp.getTooltipParams());if(!exists(e.value)){this.setToDoNothing();return}this.state=TooltipStates.SHOWING,this.tooltipInstanceCount++;var r=this.newTooltipComponentCallback.bind(this,this.tooltipInstanceCount),o=this.userComponentFactory.getTooltipCompDetails(e);o.newAgStackInstance().then(r)},t.prototype.newTooltipComponentCallback=function(e,r){var o=this.state!==TooltipStates.SHOWING||this.tooltipInstanceCount!==e;if(o){this.getContext().destroyBean(r);return}var s=r.getGui();this.tooltipComp=r,s.classList.contains("ag-tooltip")||s.classList.add("ag-tooltip-custom");var l=this.localeService.getLocaleTextFunc(),a=this.popupService.addPopup({eChild:s,ariaLabel:l("ariaLabelTooltip","Tooltip")});a&&(this.tooltipPopupDestroyFunc=a.hideFunc),this.positionTooltipUnderLastMouseEvent(),this.hideTooltipTimeoutId=window.setTimeout(this.hideTooltip.bind(this),this.tooltipHideDelay)},t.prototype.positionTooltipUnderLastMouseEvent=function(){this.popupService.positionPopupUnderMouseEvent({type:"tooltip",mouseEvent:this.lastMouseEvent,ePopup:this.tooltipComp.getGui(),nudgeY:18,skipObserver:this.tooltipMouseTrack})},t.prototype.clearTimeouts=function(){this.showTooltipTimeoutId&&(window.clearTimeout(this.showTooltipTimeoutId),this.showTooltipTimeoutId=void 0),this.hideTooltipTimeoutId&&(window.clearTimeout(this.hideTooltipTimeoutId),this.hideTooltipTimeoutId=void 0)},__decorate$2s([Autowired("popupService")],t.prototype,"popupService",void 0),__decorate$2s([Autowired("userComponentFactory")],t.prototype,"userComponentFactory",void 0),__decorate$2s([PostConstruct],t.prototype,"postConstruct",null),t}(BeanStub),CssClassManager=function(){function n(t){this.cssClassStates={},this.getGui=t}return n.prototype.addCssClass=function(t){var e=this,r=(t||"").split(" ");if(r.length>1){r.forEach(function(l){return e.addCssClass(l)});return}var o=this.cssClassStates[t]!==!0;if(o&&t.length){var s=this.getGui();s&&s.classList.add(t),this.cssClassStates[t]=!0}},n.prototype.removeCssClass=function(t){var e=this,r=(t||"").split(" ");if(r.length>1){r.forEach(function(l){return e.removeCssClass(l)});return}var o=this.cssClassStates[t]!==!1;if(o&&t.length){var s=this.getGui();s&&s.classList.remove(t),this.cssClassStates[t]=!1}},n.prototype.containsCssClass=function(t){var e=this.getGui();return e?e.classList.contains(t):!1},n.prototype.addOrRemoveCssClass=function(t,e){var r=this;if(t){if(t.indexOf(" ")>=0){var o=(t||"").split(" ");if(o.length>1){o.forEach(function(a){return r.addOrRemoveCssClass(a,e)});return}}var s=this.cssClassStates[t]!==e;if(s&&t.length){var l=this.getGui();l&&l.classList.toggle(t,e),this.cssClassStates[t]=e}}},n}(),__extends$2U=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$2r=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},compIdSequence=new NumberSequence,Component=function(n){__extends$2U(t,n);function t(e){var r=n.call(this)||this;return r.displayed=!0,r.visible=!0,r.compId=compIdSequence.next(),r.cssClassManager=new CssClassManager(function(){return r.eGui}),e&&r.setTemplate(e),r}return t.prototype.preConstructOnComponent=function(){this.usingBrowserTooltips=this.gridOptionsService.is("enableBrowserTooltips")},t.prototype.getCompId=function(){return this.compId},t.prototype.getTooltipParams=function(){return{value:this.tooltipText,location:"UNKNOWN"}},t.prototype.setTooltip=function(e){var r=this,o=function(){r.usingBrowserTooltips?r.getGui().removeAttribute("title"):r.tooltipFeature=r.destroyBean(r.tooltipFeature)},s=function(){r.usingBrowserTooltips?r.getGui().setAttribute("title",r.tooltipText):r.tooltipFeature=r.createBean(new CustomTooltipFeature(r))};this.tooltipText!=e&&(this.tooltipText&&o(),e!=null&&(this.tooltipText=e,this.tooltipText&&s()))},t.prototype.createChildComponentsFromTags=function(e,r){var o=this,s=copyNodeList(e.childNodes);s.forEach(function(l){if(l instanceof HTMLElement){var a=o.createComponentFromElement(l,function(y){var C=y.getGui();C&&o.copyAttributesFromNode(l,y.getGui())},r);if(a){if(a.addItems&&l.children.length){o.createChildComponentsFromTags(l,r);var h=Array.prototype.slice.call(l.children);a.addItems(h)}o.swapComponentForNode(a,e,l)}else l.childNodes&&o.createChildComponentsFromTags(l,r)}})},t.prototype.createComponentFromElement=function(e,r,o){var s=e.nodeName,l=o?o[e.getAttribute("ref")]:void 0,a=this.agStackComponentsRegistry.getComponentClass(s);if(a){t.elementGettingCreated=e;var h=new a(l);return h.setParentComponent(this),this.createBean(h,null,r),h}return null},t.prototype.copyAttributesFromNode=function(e,r){iterateNamedNodeMap(e.attributes,function(o,s){return r.setAttribute(o,s)})},t.prototype.swapComponentForNode=function(e,r,o){var s=e.getGui();r.replaceChild(s,o),r.insertBefore(document.createComment(o.nodeName),s),this.addDestroyFunc(this.destroyBean.bind(this,e)),this.swapInComponentForQuerySelectors(e,o)},t.prototype.swapInComponentForQuerySelectors=function(e,r){var o=this;this.iterateOverQuerySelectors(function(s){o[s.attributeName]===r&&(o[s.attributeName]=e)})},t.prototype.iterateOverQuerySelectors=function(e){for(var r=Object.getPrototypeOf(this);r!=null;){var o=r.__agComponentMetaData,s=getFunctionName(r.constructor);o&&o[s]&&o[s].querySelectors&&o[s].querySelectors.forEach(function(l){return e(l)}),r=Object.getPrototypeOf(r)}},t.prototype.activateTabIndex=function(e){var r=this.gridOptionsService.getNum("tabIndex")||0;e||(e=[]),e.length||e.push(this.getGui()),e.forEach(function(o){return o.setAttribute("tabindex",r.toString())})},t.prototype.setTemplate=function(e,r){var o=loadTemplate(e);this.setTemplateFromElement(o,r)},t.prototype.setTemplateFromElement=function(e,r){this.eGui=e,this.eGui.__agComponent=this,this.wireQuerySelectors(),this.getContext()&&this.createChildComponentsFromTags(this.getGui(),r)},t.prototype.createChildComponentsPreConstruct=function(){this.getGui()&&this.createChildComponentsFromTags(this.getGui())},t.prototype.wireQuerySelectors=function(){var e=this;if(this.eGui){var r=this;this.iterateOverQuerySelectors(function(o){var s=function(h){return r[o.attributeName]=h},l=o.refSelector&&e.getAttribute("ref")===o.refSelector;if(l)s(e.eGui);else{var a=e.eGui.querySelector(o.querySelector);a&&s(a.__agComponent||a)}})}},t.prototype.getGui=function(){return this.eGui},t.prototype.getFocusableElement=function(){return this.eGui},t.prototype.setParentComponent=function(e){this.parentComponent=e},t.prototype.getParentComponent=function(){return this.parentComponent},t.prototype.setGui=function(e){this.eGui=e},t.prototype.queryForHtmlElement=function(e){return this.eGui.querySelector(e)},t.prototype.queryForHtmlInputElement=function(e){return this.eGui.querySelector(e)},t.prototype.appendChild=function(e,r){if(e!=null)if(r||(r=this.eGui),isNodeOrElement(e))r.appendChild(e);else{var o=e;r.appendChild(o.getGui())}},t.prototype.isDisplayed=function(){return this.displayed},t.prototype.setVisible=function(e,r){if(r===void 0&&(r={}),e!==this.visible){this.visible=e;var o=r.skipAriaHidden;setVisible(this.eGui,e,{skipAriaHidden:o})}},t.prototype.setDisplayed=function(e,r){if(r===void 0&&(r={}),e!==this.displayed){this.displayed=e;var o=r.skipAriaHidden;setDisplayed(this.eGui,e,{skipAriaHidden:o});var s={type:t.EVENT_DISPLAYED_CHANGED,visible:this.displayed};this.dispatchEvent(s)}},t.prototype.destroy=function(){this.tooltipFeature&&(this.tooltipFeature=this.destroyBean(this.tooltipFeature)),this.parentComponent&&(this.parentComponent=void 0);var e=this.eGui;e&&e.__agComponent&&(e.__agComponent=void 0),n.prototype.destroy.call(this)},t.prototype.addGuiEventListener=function(e,r,o){var s=this;this.eGui.addEventListener(e,r,o),this.addDestroyFunc(function(){return s.eGui.removeEventListener(e,r)})},t.prototype.addCssClass=function(e){this.cssClassManager.addCssClass(e)},t.prototype.removeCssClass=function(e){this.cssClassManager.removeCssClass(e)},t.prototype.containsCssClass=function(e){return this.cssClassManager.containsCssClass(e)},t.prototype.addOrRemoveCssClass=function(e,r){this.cssClassManager.addOrRemoveCssClass(e,r)},t.prototype.getAttribute=function(e){var r=this.eGui;return r?r.getAttribute(e):null},t.prototype.getRefElement=function(e){return this.queryForHtmlElement('[ref="'+e+'"]')},t.EVENT_DISPLAYED_CHANGED="displayedChanged",__decorate$2r([Autowired("agStackComponentsRegistry")],t.prototype,"agStackComponentsRegistry",void 0),__decorate$2r([PreConstruct],t.prototype,"preConstructOnComponent",null),__decorate$2r([PreConstruct],t.prototype,"createChildComponentsPreConstruct",null),t}(BeanStub);function RefSelector(n){return querySelectorFunc.bind(this,"[ref="+n+"]",n)}function querySelectorFunc(n,t,e,r,o){if(n===null){console.error("AG Grid: QuerySelector selector should not be null");return}if(typeof o=="number"){console.error("AG Grid: QuerySelector should be on an attribute");return}addToObjectProps(e,"querySelectors",{attributeName:r,querySelector:n,refSelector:t})}function addToObjectProps(n,t,e){var r=getOrCreateProps(n,getFunctionName(n.constructor));r[t]||(r[t]=[]),r[t].push(e)}function getOrCreateProps(n,t){return n.__agComponentMetaData||(n.__agComponentMetaData={}),n.__agComponentMetaData[t]||(n.__agComponentMetaData[t]={}),n.__agComponentMetaData[t]}var __extends$2T=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$2q=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},ReadOnlyFloatingFilter=function(n){__extends$2T(t,n);function t(){return n.call(this,`
            <div class="ag-floating-filter-input" role="presentation">
                <ag-input-text-field ref="eFloatingFilterText"></ag-input-text-field>
            </div>`)||this}return t.prototype.destroy=function(){n.prototype.destroy.call(this)},t.prototype.init=function(e){this.params=e;var r=this.columnModel.getDisplayNameForColumn(e.column,"header",!0),o=this.localeService.getLocaleTextFunc();this.eFloatingFilterText.setDisabled(!0).setInputAriaLabel(r+" "+o("ariaFilterInput","Filter Input"))},t.prototype.onParentModelChanged=function(e){var r=this;if(!e){this.eFloatingFilterText.setValue("");return}this.params.parentFilterInstance(function(o){if(o.getModelAsString){var s=o.getModelAsString(e);r.eFloatingFilterText.setValue(s)}})},__decorate$2q([RefSelector("eFloatingFilterText")],t.prototype,"eFloatingFilterText",void 0),__decorate$2q([Autowired("columnModel")],t.prototype,"columnModel",void 0),t}(Component),DateCompWrapper=function(){function n(t,e,r,o){var s=this;this.alive=!0,this.context=t,this.eParent=o;var l=e.getDateCompDetails(r),a=l.newAgStackInstance();a.then(function(h){if(!s.alive){t.destroyBean(h);return}s.dateComp=h,h&&(o.appendChild(h.getGui()),h.afterGuiAttached&&h.afterGuiAttached(),s.tempValue&&h.setDate(s.tempValue),s.disabled!=null&&s.setDateCompDisabled(s.disabled))})}return n.prototype.destroy=function(){this.alive=!1,this.dateComp=this.context.destroyBean(this.dateComp)},n.prototype.getDate=function(){return this.dateComp?this.dateComp.getDate():this.tempValue},n.prototype.setDate=function(t){this.dateComp?this.dateComp.setDate(t):this.tempValue=t},n.prototype.setDisabled=function(t){this.dateComp?this.setDateCompDisabled(t):this.disabled=t},n.prototype.setDisplayed=function(t){setDisplayed(this.eParent,t)},n.prototype.setInputPlaceholder=function(t){this.dateComp&&this.dateComp.setInputPlaceholder&&this.dateComp.setInputPlaceholder(t)},n.prototype.setInputAriaLabel=function(t){this.dateComp&&this.dateComp.setInputAriaLabel&&this.dateComp.setInputAriaLabel(t)},n.prototype.afterGuiAttached=function(t){this.dateComp&&typeof this.dateComp.afterGuiAttached=="function"&&this.dateComp.afterGuiAttached(t)},n.prototype.setDateCompDisabled=function(t){this.dateComp!=null&&this.dateComp.setDisabled!=null&&this.dateComp.setDisabled(t)},n}(),OptionsFactory=function(){function n(){this.customFilterOptions={}}return n.prototype.init=function(t,e){this.filterOptions=t.filterOptions||e,this.mapCustomOptions(),this.selectDefaultItem(t)},n.prototype.getFilterOptions=function(){return this.filterOptions},n.prototype.mapCustomOptions=function(){var t=this;this.filterOptions&&this.filterOptions.forEach(function(e){if(typeof e!="string"){var r=[["displayKey"],["displayName"],["predicate","test"]],o=function(s){return s.some(function(l){return e[l]!=null})?!0:(console.warn("AG Grid: ignoring FilterOptionDef as it doesn't contain one of '"+s+"'"),!1)};if(!r.every(o)){t.filterOptions=t.filterOptions.filter(function(s){return s===e})||[];return}t.customFilterOptions[e.displayKey]=e}})},n.prototype.selectDefaultItem=function(t){if(t.defaultOption)this.defaultOption=t.defaultOption;else if(this.filterOptions.length>=1){var e=this.filterOptions[0];typeof e=="string"?this.defaultOption=e:e.displayKey?this.defaultOption=e.displayKey:console.warn("AG Grid: invalid FilterOptionDef supplied as it doesn't contain a 'displayKey'")}else console.warn("AG Grid: no filter options for filter")},n.prototype.getDefaultOption=function(){return this.defaultOption},n.prototype.getCustomOption=function(t){return this.customFilterOptions[t]},n}(),DEFAULT_FILTER_LOCALE_TEXT={applyFilter:"Apply",clearFilter:"Clear",resetFilter:"Reset",cancelFilter:"Cancel",textFilter:"Text Filter",numberFilter:"Number Filter",dateFilter:"Date Filter",setFilter:"Set Filter",filterOoo:"Filter...",empty:"Choose One",equals:"Equals",notEqual:"Not equal",lessThan:"Less than",greaterThan:"Greater than",inRange:"In range",inRangeStart:"From",inRangeEnd:"To",lessThanOrEqual:"Less than or equals",greaterThanOrEqual:"Greater than or equals",contains:"Contains",notContains:"Not contains",startsWith:"Starts with",endsWith:"Ends with",blank:"Blank",notBlank:"Not blank",andCondition:"AND",orCondition:"OR",dateFormatOoo:"yyyy-mm-dd"},__extends$2S=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__assign$i=function(){return __assign$i=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},__assign$i.apply(this,arguments)},__decorate$2p=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},ManagedFocusFeature=function(n){__extends$2S(t,n);function t(e,r){r===void 0&&(r={});var o=n.call(this)||this;return o.eFocusableElement=e,o.callbacks=r,o.callbacks=__assign$i({shouldStopEventPropagation:function(){return!1},onTabKeyDown:function(s){if(!s.defaultPrevented){var l=o.focusService.findNextFocusableElement(o.eFocusableElement,!1,s.shiftKey);l&&(l.focus(),s.preventDefault())}}},r),o}return t.prototype.postConstruct=function(){this.eFocusableElement.classList.add(t.FOCUS_MANAGED_CLASS),this.addKeyDownListeners(this.eFocusableElement),this.callbacks.onFocusIn&&this.addManagedListener(this.eFocusableElement,"focusin",this.callbacks.onFocusIn),this.callbacks.onFocusOut&&this.addManagedListener(this.eFocusableElement,"focusout",this.callbacks.onFocusOut)},t.prototype.addKeyDownListeners=function(e){var r=this;this.addManagedListener(e,"keydown",function(o){if(!(o.defaultPrevented||isStopPropagationForAgGrid(o))){if(r.callbacks.shouldStopEventPropagation(o)){stopPropagationForAgGrid(o);return}o.key===KeyCode.TAB?r.callbacks.onTabKeyDown(o):r.callbacks.handleKeyDown&&r.callbacks.handleKeyDown(o)}})},t.FOCUS_MANAGED_CLASS="ag-focus-managed",__decorate$2p([Autowired("focusService")],t.prototype,"focusService",void 0),__decorate$2p([PostConstruct],t.prototype,"postConstruct",null),t}(BeanStub),__extends$2R=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$2o=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},RESIZE_CONTAINER_STYLE="ag-resizer-wrapper",RESIZE_TEMPLATE='<div class="'+RESIZE_CONTAINER_STYLE+`">
        <div ref="eTopLeftResizer" class="ag-resizer ag-resizer-topLeft"></div>
        <div ref="eTopResizer" class="ag-resizer ag-resizer-top"></div>
        <div ref="eTopRightResizer" class="ag-resizer ag-resizer-topRight"></div>
        <div ref="eRightResizer" class="ag-resizer ag-resizer-right"></div>
        <div ref="eBottomRightResizer" class="ag-resizer ag-resizer-bottomRight"></div>
        <div ref="eBottomResizer" class="ag-resizer ag-resizer-bottom"></div>
        <div ref="eBottomLeftResizer" class="ag-resizer ag-resizer-bottomLeft"></div>
        <div ref="eLeftResizer" class="ag-resizer ag-resizer-left"></div>
    </div>`,PositionableFeature=function(n){__extends$2R(t,n);function t(e,r){var o=n.call(this)||this;return o.element=e,o.dragStartPosition={x:0,y:0},o.position={x:0,y:0},o.lastSize={width:-1,height:-1},o.positioned=!1,o.resizersAdded=!1,o.resizeListeners=[],o.boundaryEl=null,o.isResizing=!1,o.isMoving=!1,o.resizable={},o.movable=!1,o.currentResizer=null,o.config=Object.assign({},{popup:!1},r),o}return t.prototype.center=function(){var e=this.offsetParent,r=e.clientHeight,o=e.clientWidth,s=o/2-this.getWidth()/2,l=r/2-this.getHeight()/2;this.offsetElement(s,l)},t.prototype.initialisePosition=function(){if(!this.positioned){var e=this.config,r=e.centered,o=e.forcePopupParentAsOffsetParent,s=e.minWidth,l=e.width,a=e.minHeight,h=e.height,y=e.x,C=e.y;this.offsetParent||this.setOffsetParent();var L=0,Y=0,ze=!!this.element.offsetParent;if(ze){var Bt=this.findBoundaryElement(),Ir=window.getComputedStyle(Bt);if(Ir.minWidth!=null){var Wr=Bt.offsetWidth-this.element.offsetWidth;Y=parseInt(Ir.minWidth,10)-Wr}if(Ir.minHeight!=null){var yi=Bt.offsetHeight-this.element.offsetHeight;L=parseInt(Ir.minHeight,10)-yi}}if(this.minHeight=a||L,this.minWidth=s||Y,l&&this.setWidth(l),h&&this.setHeight(h),(!l||!h)&&this.refreshSize(),r)this.center();else if(y||C)this.offsetElement(y,C);else if(ze&&o){var Bt=this.boundaryEl,Bn=!0;if(Bt||(Bt=this.findBoundaryElement(),Bn=!1),Bt){var vi=parseFloat(Bt.style.top),wo=parseFloat(Bt.style.left);Bn?this.offsetElement(isNaN(wo)?0:wo,isNaN(vi)?0:vi):this.setPosition(wo,vi)}}this.positioned=!!this.offsetParent}},t.prototype.isPositioned=function(){return this.positioned},t.prototype.getPosition=function(){return this.position},t.prototype.setMovable=function(e,r){if(!(!this.config.popup||e===this.movable)){this.movable=e;var o=this.moveElementDragListener||{eElement:r,onDragStart:this.onMoveStart.bind(this),onDragging:this.onMove.bind(this),onDragStop:this.onMoveEnd.bind(this)};e?(this.dragService.addDragSource(o),this.moveElementDragListener=o):(this.dragService.removeDragSource(o),this.moveElementDragListener=void 0)}},t.prototype.setResizable=function(e){var r=this;if(this.clearResizeListeners(),e?this.addResizers():this.removeResizers(),typeof e=="boolean"){if(e===!1)return;e={topLeft:e,top:e,topRight:e,right:e,bottomRight:e,bottom:e,bottomLeft:e,left:e}}Object.keys(e).forEach(function(o){var s=e,l=!!s[o],a=r.getResizerElement(o),h={dragStartPixels:0,eElement:a,onDragStart:function(y){return r.onResizeStart(y,o)},onDragging:r.onResize.bind(r),onDragStop:function(y){return r.onResizeEnd(y,o)}};(l||!r.isAlive()&&!l)&&(l?(r.dragService.addDragSource(h),r.resizeListeners.push(h),a.style.pointerEvents="all"):a.style.pointerEvents="none",r.resizable[o]=l)})},t.prototype.removeSizeFromEl=function(){this.element.style.removeProperty("height"),this.element.style.removeProperty("width"),this.element.style.removeProperty("flex")},t.prototype.restoreLastSize=function(){this.element.style.flex="0 0 auto";var e=this.lastSize,r=e.height,o=e.width;o!==-1&&(this.element.style.width=o+"px"),r!==-1&&(this.element.style.height=r+"px")},t.prototype.getHeight=function(){return this.element.offsetHeight},t.prototype.setHeight=function(e){var r=this.config.popup,o=this.element,s=!1;if(typeof e=="string"&&e.indexOf("%")!==-1)setFixedHeight(o,e),e=getAbsoluteHeight(o),s=!0;else if(e=Math.max(this.minHeight,e),this.positioned){var l=this.getAvailableHeight();l&&e>l&&(e=l)}this.getHeight()!==e&&(s?(o.style.maxHeight="unset",o.style.minHeight="unset"):r?setFixedHeight(o,e):(o.style.height=e+"px",o.style.flex="0 0 auto",this.lastSize.height=typeof e=="number"?e:parseFloat(e)))},t.prototype.getAvailableHeight=function(){var e=this.config,r=e.popup,o=e.forcePopupParentAsOffsetParent;this.positioned||this.initialisePosition();var s=this.offsetParent.clientHeight;if(!s)return null;var l=this.element.getBoundingClientRect(),a=this.offsetParent.getBoundingClientRect(),h=r?this.position.y:l.top,y=r?0:a.top,C=0;if(o){var L=this.element.parentElement;if(L){var Y=L.getBoundingClientRect().bottom;C=Y-l.bottom}}var ze=s+y-h-C;return ze},t.prototype.getWidth=function(){return this.element.offsetWidth},t.prototype.setWidth=function(e){var r=this.element,o=this.config.popup,s=!1;if(typeof e=="string"&&e.indexOf("%")!==-1)setFixedWidth(r,e),e=getAbsoluteWidth(r),s=!0;else if(this.positioned){e=Math.max(this.minWidth,e);var l=this.offsetParent.clientWidth,a=o?this.position.x:this.element.getBoundingClientRect().left;l&&e+a>l&&(e=l-a)}this.getWidth()!==e&&(s?(r.style.maxWidth="unset",r.style.minWidth="unset"):this.config.popup?setFixedWidth(r,e):(r.style.width=e+"px",r.style.flex=" unset",this.lastSize.width=typeof e=="number"?e:parseFloat(e)))},t.prototype.offsetElement=function(e,r){e===void 0&&(e=0),r===void 0&&(r=0);var o=this.config.forcePopupParentAsOffsetParent,s=o?this.boundaryEl:this.element;s&&(this.popupService.positionPopup({ePopup:s,keepWithinBounds:!0,skipObserver:this.movable||this.isResizable(),updatePosition:function(){return{x:e,y:r}}}),this.setPosition(parseFloat(s.style.left),parseFloat(s.style.top)))},t.prototype.constrainSizeToAvailableHeight=function(e){var r=this;if(this.config.forcePopupParentAsOffsetParent){var o=function(){var s=r.getAvailableHeight();r.element.style.setProperty("max-height",s+"px")};e?this.resizeObserverSubscriber=this.resizeObserverService.observeResize(this.popupService.getPopupParent(),o):(this.element.style.removeProperty("max-height"),this.resizeObserverSubscriber&&(this.resizeObserverSubscriber(),this.resizeObserverSubscriber=void 0))}},t.prototype.setPosition=function(e,r){this.position.x=e,this.position.y=r},t.prototype.updateDragStartPosition=function(e,r){this.dragStartPosition={x:e,y:r}},t.prototype.calculateMouseMovement=function(e){var r=e.e,o=e.isLeft,s=e.isTop,l=e.anywhereWithin,a=e.topBuffer,h=r.clientX-this.dragStartPosition.x,y=r.clientY-this.dragStartPosition.y,C=this.shouldSkipX(r,!!o,!!l,h)?0:h,L=this.shouldSkipY(r,!!s,a,y)?0:y;return{movementX:C,movementY:L}},t.prototype.shouldSkipX=function(e,r,o,s){var l=this.element.getBoundingClientRect(),a=this.offsetParent.getBoundingClientRect(),h=this.boundaryEl.getBoundingClientRect(),y=this.config.popup?this.position.x:l.left,C=y<=0&&a.left>=e.clientX||a.right<=e.clientX&&a.right<=h.right;return C?!0:(r?C=s<0&&e.clientX>y+a.left||s>0&&e.clientX<y+a.left:o?C=s<0&&e.clientX>h.right||s>0&&e.clientX<y+a.left:C=s<0&&e.clientX>h.right||s>0&&e.clientX<h.right,C)},t.prototype.shouldSkipY=function(e,r,o,s){o===void 0&&(o=0);var l=this.element.getBoundingClientRect(),a=this.offsetParent.getBoundingClientRect(),h=this.boundaryEl.getBoundingClientRect(),y=this.config.popup?this.position.y:l.top,C=y<=0&&a.top>=e.clientY||a.bottom<=e.clientY&&a.bottom<=h.bottom;return C?!0:(r?C=s<0&&e.clientY>y+a.top+o||s>0&&e.clientY<y+a.top:C=s<0&&e.clientY>h.bottom||s>0&&e.clientY<h.bottom,C)},t.prototype.createResizeMap=function(){var e=this.element;this.resizerMap={topLeft:{element:e.querySelector("[ref=eTopLeftResizer]")},top:{element:e.querySelector("[ref=eTopResizer]")},topRight:{element:e.querySelector("[ref=eTopRightResizer]")},right:{element:e.querySelector("[ref=eRightResizer]")},bottomRight:{element:e.querySelector("[ref=eBottomRightResizer]")},bottom:{element:e.querySelector("[ref=eBottomResizer]")},bottomLeft:{element:e.querySelector("[ref=eBottomLeftResizer]")},left:{element:e.querySelector("[ref=eLeftResizer]")}}},t.prototype.addResizers=function(){if(!this.resizersAdded){var e=this.element;if(e){var r=new DOMParser,o=r.parseFromString(RESIZE_TEMPLATE,"text/html").body;e.appendChild(o.firstChild),this.createResizeMap(),this.resizersAdded=!0}}},t.prototype.removeResizers=function(){this.resizerMap=void 0;var e=this.element.querySelector("."+RESIZE_CONTAINER_STYLE);e&&this.element.removeChild(e),this.resizersAdded=!1},t.prototype.getResizerElement=function(e){return this.resizerMap[e].element},t.prototype.onResizeStart=function(e,r){this.boundaryEl=this.findBoundaryElement(),this.positioned||this.initialisePosition(),this.currentResizer={isTop:!!r.match(/top/i),isRight:!!r.match(/right/i),isBottom:!!r.match(/bottom/i),isLeft:!!r.match(/left/i)},this.element.classList.add("ag-resizing"),this.resizerMap[r].element.classList.add("ag-active");var o=this.config,s=o.popup,l=o.forcePopupParentAsOffsetParent;!s&&!l&&this.applySizeToSiblings(this.currentResizer.isBottom||this.currentResizer.isTop),this.isResizing=!0,this.updateDragStartPosition(e.clientX,e.clientY)},t.prototype.getSiblings=function(){var e=this.element,r=e.parentElement;return r?Array.prototype.slice.call(r.children).filter(function(o){return!o.classList.contains("ag-hidden")}):null},t.prototype.getMinSizeOfSiblings=function(){for(var e=this.getSiblings()||[],r=0,o=0,s=0;s<e.length;s++){var l=e[s],a=!!l.style.flex&&l.style.flex!=="0 0 auto";if(l!==this.element){var h=this.minHeight||0,y=this.minWidth||0;if(a){var C=window.getComputedStyle(l);C.minHeight&&(h=parseInt(C.minHeight,10)),C.minWidth&&(y=parseInt(C.minWidth,10))}else h=l.offsetHeight,y=l.offsetWidth;r+=h,o+=y}}return{height:r,width:o}},t.prototype.applySizeToSiblings=function(e){var r=null,o=this.getSiblings();if(o){for(var s=0;s<o.length;s++){var l=o[s];l!==r&&(e?l.style.height=l.offsetHeight+"px":l.style.width=l.offsetWidth+"px",l.style.flex="0 0 auto",l===this.element&&(r=o[s+1]))}r&&(r.style.removeProperty("height"),r.style.removeProperty("min-height"),r.style.removeProperty("max-height"),r.style.flex="1 1 auto")}},t.prototype.isResizable=function(){return Object.values(this.resizable).some(function(e){return e})},t.prototype.onResize=function(e){if(!(!this.isResizing||!this.currentResizer)){var r=this.config,o=r.popup,s=r.forcePopupParentAsOffsetParent,l=this.currentResizer,a=l.isTop,h=l.isRight,y=l.isBottom,C=l.isLeft,L=h||C,Y=y||a,ze=this.calculateMouseMovement({e,isLeft:C,isTop:a}),Bt=ze.movementX,Ir=ze.movementY,Wr=this.position.x,yi=this.position.y,Bn=0,vi=0;if(L&&Bt){var wo=C?-1:1,ia=this.getWidth(),gl=ia+Bt*wo,ml=!1;C&&(Bn=ia-gl,(Wr+Bn<=0||gl<=this.minWidth)&&(ml=!0,Bn=0)),ml||this.setWidth(gl)}if(Y&&Ir){var wo=a?-1:1,il=this.getHeight(),sl=il+Ir*wo,ol=!1;a?(vi=il-sl,(yi+vi<=0||sl<=this.minHeight)&&(ol=!0,vi=0)):!this.config.popup&&!this.config.forcePopupParentAsOffsetParent&&il<sl&&this.getMinSizeOfSiblings().height+sl>this.element.parentElement.offsetHeight&&(ol=!0),ol||this.setHeight(sl)}this.updateDragStartPosition(e.clientX,e.clientY),((o||s)&&Bn||vi)&&this.offsetElement(Wr+Bn,yi+vi)}},t.prototype.onResizeEnd=function(e,r){this.isResizing=!1,this.currentResizer=null,this.boundaryEl=null;var o={type:"resize",api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi};this.element.classList.remove("ag-resizing"),this.resizerMap[r].element.classList.remove("ag-active"),this.dispatchEvent(o)},t.prototype.refreshSize=function(){var e=this.element;this.config.popup&&(this.config.width||this.setWidth(e.offsetWidth),this.config.height||this.setHeight(e.offsetHeight))},t.prototype.onMoveStart=function(e){this.boundaryEl=this.findBoundaryElement(),this.positioned||this.initialisePosition(),this.isMoving=!0,this.element.classList.add("ag-moving"),this.updateDragStartPosition(e.clientX,e.clientY)},t.prototype.onMove=function(e){if(this.isMoving){var r=this.position,o=r.x,s=r.y,l;this.config.calculateTopBuffer&&(l=this.config.calculateTopBuffer());var a=this.calculateMouseMovement({e,isTop:!0,anywhereWithin:!0,topBuffer:l}),h=a.movementX,y=a.movementY;this.offsetElement(o+h,s+y),this.updateDragStartPosition(e.clientX,e.clientY)}},t.prototype.onMoveEnd=function(){this.isMoving=!1,this.boundaryEl=null,this.element.classList.remove("ag-moving")},t.prototype.setOffsetParent=function(){this.config.forcePopupParentAsOffsetParent?this.offsetParent=this.popupService.getPopupParent():this.offsetParent=this.element.offsetParent},t.prototype.findBoundaryElement=function(){for(var e=this.element;e;){if(window.getComputedStyle(e).position!=="static")return e;e=e.parentElement}return this.element},t.prototype.clearResizeListeners=function(){for(;this.resizeListeners.length;){var e=this.resizeListeners.pop();this.dragService.removeDragSource(e)}},t.prototype.destroy=function(){n.prototype.destroy.call(this),this.moveElementDragListener&&this.dragService.removeDragSource(this.moveElementDragListener),this.constrainSizeToAvailableHeight(!1),this.clearResizeListeners(),this.removeResizers()},__decorate$2o([Autowired("popupService")],t.prototype,"popupService",void 0),__decorate$2o([Autowired("resizeObserverService")],t.prototype,"resizeObserverService",void 0),__decorate$2o([Autowired("dragService")],t.prototype,"dragService",void 0),t}(BeanStub),__extends$2Q=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$2n=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},ProvidedFilter=function(n){__extends$2Q(t,n);function t(e){var r=n.call(this)||this;return r.filterNameKey=e,r.applyActive=!1,r.hidePopup=null,r.debouncePending=!1,r.appliedModel=null,r}return t.prototype.postConstruct=function(){this.resetTemplate(),this.createManagedBean(new ManagedFocusFeature(this.getFocusableElement(),{handleKeyDown:this.handleKeyDown.bind(this)})),this.positionableFeature=new PositionableFeature(this.getPositionableElement(),{forcePopupParentAsOffsetParent:!0}),this.createBean(this.positionableFeature)},t.prototype.handleKeyDown=function(e){},t.prototype.getFilterTitle=function(){return this.translate(this.filterNameKey)},t.prototype.isFilterActive=function(){return!!this.appliedModel},t.prototype.resetTemplate=function(e){var r=this.getGui();r&&r.removeEventListener("submit",this.onFormSubmit);var o=`
            <form class="ag-filter-wrapper">
                <div class="ag-filter-body-wrapper ag-`+this.getCssIdentifier()+`-body-wrapper" ref="eFilterBody">
                    `+this.createBodyTemplate()+`
                </div>
            </form>`;this.setTemplate(o,e),r=this.getGui(),r&&r.addEventListener("submit",this.onFormSubmit)},t.prototype.isReadOnly=function(){return!!this.providedFilterParams.readOnly},t.prototype.init=function(e){var r=this;this.setParams(e),this.resetUiToDefaults(!0).then(function(){r.updateUiVisibility(),r.setupOnBtApplyDebounce()})},t.prototype.setParams=function(e){this.providedFilterParams=e,this.applyActive=t.isUseApplyButton(e),this.createButtonPanel()},t.prototype.createButtonPanel=function(){var e=this,r=this.providedFilterParams.buttons;if(!(!r||r.length<1||this.isReadOnly())){var o=document.createElement("div");o.classList.add("ag-filter-apply-panel");var s=function(l){var a,h;switch(l){case"apply":a=e.translate("applyFilter"),h=function(L){return e.onBtApply(!1,!1,L)};break;case"clear":a=e.translate("clearFilter"),h=function(){return e.onBtClear()};break;case"reset":a=e.translate("resetFilter"),h=function(){return e.onBtReset()};break;case"cancel":a=e.translate("cancelFilter"),h=function(L){e.onBtCancel(L)};break;default:console.warn("AG Grid: Unknown button type specified");return}var y=l==="apply"?"submit":"button",C=loadTemplate(`<button
                    type="`+y+`"
                    ref="`+l+`FilterButton"
                    class="ag-button ag-standard-button ag-filter-apply-panel-button"
                >`+a+`
                </button>`);o.appendChild(C),e.addManagedListener(C,"click",h)};convertToSet(r).forEach(function(l){return s(l)}),this.getGui().appendChild(o)}},t.prototype.getDefaultDebounceMs=function(){return 0},t.prototype.setupOnBtApplyDebounce=function(){var e=this,r=t.getDebounceMs(this.providedFilterParams,this.getDefaultDebounceMs()),o=debounce(this.checkApplyDebounce.bind(this),r);this.onBtApplyDebounce=function(){e.debouncePending=!0,o()}},t.prototype.checkApplyDebounce=function(){this.debouncePending&&(this.debouncePending=!1,this.onBtApply())},t.prototype.getModel=function(){return this.appliedModel?this.appliedModel:null},t.prototype.setModel=function(e){var r=this,o=e!=null?this.setModelIntoUi(e):this.resetUiToDefaults();return o.then(function(){r.updateUiVisibility(),r.applyModel("api")})},t.prototype.onBtCancel=function(e){var r=this;this.resetUiToActiveModel(this.getModel(),function(){r.handleCancelEnd(e)})},t.prototype.handleCancelEnd=function(e){this.providedFilterParams.closeOnApply&&this.close(e)},t.prototype.resetUiToActiveModel=function(e,r){var o=this,s=function(){o.onUiChanged(!1,"prevent"),r==null||r()};e!=null?this.setModelIntoUi(e).then(s):this.resetUiToDefaults().then(s)},t.prototype.onBtClear=function(){var e=this;this.resetUiToDefaults().then(function(){return e.onUiChanged()})},t.prototype.onBtReset=function(){this.onBtClear(),this.onBtApply()},t.prototype.applyModel=function(e){var r=this.getModelFromUi();if(!this.isModelValid(r))return!1;var o=this.appliedModel;return this.appliedModel=r,!this.areModelsEqual(o,r)},t.prototype.isModelValid=function(e){return!0},t.prototype.onFormSubmit=function(e){e.preventDefault()},t.prototype.onBtApply=function(e,r,o){e===void 0&&(e=!1),r===void 0&&(r=!1),o&&o.preventDefault(),this.applyModel(r?"rowDataUpdated":"ui")&&this.providedFilterParams.filterChangedCallback({afterFloatingFilter:e,afterDataChange:r});var s=this.providedFilterParams.closeOnApply;s&&this.applyActive&&!e&&!r&&this.close(o)},t.prototype.onNewRowsLoaded=function(){},t.prototype.close=function(e){if(this.hidePopup){var r=e,o=r&&r.key,s;(o==="Enter"||o==="Space")&&(s={keyboardEvent:r}),this.hidePopup(s),this.hidePopup=null}},t.prototype.onUiChanged=function(e,r){if(e===void 0&&(e=!1),this.updateUiVisibility(),this.providedFilterParams.filterModifiedCallback(),this.applyActive&&!this.isReadOnly()){var o=this.isModelValid(this.getModelFromUi());setDisabled(this.getRefElement("applyFilterButton"),!o)}e&&!r||r==="immediately"?this.onBtApply(e):(!this.applyActive&&!r||r==="debounce")&&this.onBtApplyDebounce()},t.prototype.afterGuiAttached=function(e){e&&(this.hidePopup=e.hidePopup),this.refreshFilterResizer(e==null?void 0:e.container)},t.prototype.refreshFilterResizer=function(e){if(!(!this.positionableFeature||e==="toolPanel")){var r=e==="floatingFilter",o=this,s=o.positionableFeature,l=o.gridOptionsService;r?(s.restoreLastSize(),s.setResizable(l.is("enableRtl")?{bottom:!0,bottomLeft:!0,left:!0}:{bottom:!0,bottomRight:!0,right:!0})):(this.positionableFeature.removeSizeFromEl(),this.positionableFeature.setResizable(!1)),this.positionableFeature.constrainSizeToAvailableHeight(!0)}},t.prototype.afterGuiDetached=function(){this.checkApplyDebounce(),this.positionableFeature&&this.positionableFeature.constrainSizeToAvailableHeight(!1)},t.getDebounceMs=function(e,r){return t.isUseApplyButton(e)?(e.debounceMs!=null&&console.warn("AG Grid: debounceMs is ignored when apply button is present"),0):e.debounceMs!=null?e.debounceMs:r},t.isUseApplyButton=function(e){return!!e.buttons&&e.buttons.indexOf("apply")>=0},t.prototype.destroy=function(){var e=this.getGui();e&&e.removeEventListener("submit",this.onFormSubmit),this.hidePopup=null,this.positionableFeature&&(this.positionableFeature=this.destroyBean(this.positionableFeature)),n.prototype.destroy.call(this)},t.prototype.translate=function(e){var r=this.localeService.getLocaleTextFunc();return r(e,DEFAULT_FILTER_LOCALE_TEXT[e])},t.prototype.getCellValue=function(e){var r=this.providedFilterParams,o=r.api,s=r.colDef,l=r.column,a=r.columnApi,h=r.context;return this.providedFilterParams.valueGetter({api:o,colDef:s,column:l,columnApi:a,context:h,data:e.data,getValue:function(y){return e.data[y]},node:e})},t.prototype.getPositionableElement=function(){return this.eFilterBody},__decorate$2n([Autowired("rowModel")],t.prototype,"rowModel",void 0),__decorate$2n([RefSelector("eFilterBody")],t.prototype,"eFilterBody",void 0),__decorate$2n([PostConstruct],t.prototype,"postConstruct",null),t}(Component),__extends$2P=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$2m=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},AgAbstractLabel=function(n){__extends$2P(t,n);function t(e,r){var o=n.call(this,r)||this;return o.labelSeparator="",o.labelAlignment="left",o.disabled=!1,o.label="",o.config=e||{},o}return t.prototype.postConstruct=function(){this.addCssClass("ag-labeled"),this.eLabel.classList.add("ag-label");var e=this.config,r=e.labelSeparator,o=e.label,s=e.labelWidth,l=e.labelAlignment;r!=null&&this.setLabelSeparator(r),o!=null&&this.setLabel(o),s!=null&&this.setLabelWidth(s),this.setLabelAlignment(l||this.labelAlignment),this.refreshLabel()},t.prototype.refreshLabel=function(){clearElement(this.eLabel),typeof this.label=="string"?this.eLabel.innerText=this.label+this.labelSeparator:this.label&&this.eLabel.appendChild(this.label),this.label===""?(setDisplayed(this.eLabel,!1),setAriaRole(this.eLabel,"presentation")):(setDisplayed(this.eLabel,!0),setAriaRole(this.eLabel,null))},t.prototype.setLabelSeparator=function(e){return this.labelSeparator===e?this:(this.labelSeparator=e,this.label!=null&&this.refreshLabel(),this)},t.prototype.getLabelId=function(){return this.eLabel.id=this.eLabel.id||"ag-"+this.getCompId()+"-label",this.eLabel.id},t.prototype.getLabel=function(){return this.label},t.prototype.setLabel=function(e){return this.label===e?this:(this.label=e,this.refreshLabel(),this)},t.prototype.setLabelAlignment=function(e){var r=this.getGui(),o=r.classList;return o.toggle("ag-label-align-left",e==="left"),o.toggle("ag-label-align-right",e==="right"),o.toggle("ag-label-align-top",e==="top"),this},t.prototype.setLabelEllipsis=function(e){return this.eLabel.classList.toggle("ag-label-ellipsis",e),this},t.prototype.setLabelWidth=function(e){return this.label==null?this:(setElementWidth(this.eLabel,e),this)},t.prototype.setDisabled=function(e){e=!!e;var r=this.getGui();return setDisabled(r,e),r.classList.toggle("ag-disabled",e),this.disabled=e,this},t.prototype.isDisabled=function(){return!!this.disabled},__decorate$2m([PostConstruct],t.prototype,"postConstruct",null),t}(Component),__extends$2O=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),AgAbstractField=function(n){__extends$2O(t,n);function t(e,r,o){var s=n.call(this,e,r)||this;return s.className=o,s}return t.prototype.postConstruct=function(){n.prototype.postConstruct.call(this),this.className&&this.addCssClass(this.className)},t.prototype.onValueChange=function(e){var r=this;return this.addManagedListener(this,t.EVENT_CHANGED,function(){return e(r.getValue())}),this},t.prototype.getWidth=function(){return this.getGui().clientWidth},t.prototype.setWidth=function(e){return setFixedWidth(this.getGui(),e),this},t.prototype.getPreviousValue=function(){return this.previousValue},t.prototype.getValue=function(){return this.value},t.prototype.setValue=function(e,r){return this.value===e?this:(this.previousValue=this.value,this.value=e,r||this.dispatchEvent({type:t.EVENT_CHANGED}),this)},t.EVENT_CHANGED="valueChange",t}(AgAbstractLabel),__extends$2N=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$2l=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},AgPickerField=function(n){__extends$2N(t,n);function t(e,r,o,s){var l=n.call(this,e,`<div class="ag-picker-field" role="presentation">
                <div ref="eLabel"></div>
                <div ref="eWrapper"
                    class="ag-wrapper ag-picker-field-wrapper"
                    tabIndex="-1"
                    aria-expanded="false"
                    `+(s?'role="'+s+'"':"")+`
                >
                    <div ref="eDisplayField" class="ag-picker-field-display"></div>
                    <div ref="eIcon" class="ag-picker-field-icon" aria-hidden="true"></div>
                </div>
            </div>`,r)||this;return l.pickerIcon=o,l.isPickerDisplayed=!1,l.isDestroyingPicker=!1,l.skipClick=!1,l}return t.prototype.postConstruct=function(){var e=this;n.prototype.postConstruct.call(this);var r="ag-"+this.getCompId()+"-display";this.eDisplayField.setAttribute("id",r),setAriaDescribedBy(this.eWrapper,r);var o=function(){if(e.skipClick){e.skipClick=!1;return}e.isDisabled()||(e.pickerComponent=e.showPicker())},s=this.getGui();if(this.addManagedListener(s,"mousedown",function(a){!e.skipClick&&e.pickerComponent&&e.pickerComponent.isAlive()&&isVisible(e.pickerComponent.getGui())&&s.contains(a.target)&&(e.skipClick=!0)}),this.addManagedListener(s,"keydown",function(a){switch(a.key){case KeyCode.UP:case KeyCode.DOWN:case KeyCode.ENTER:case KeyCode.SPACE:o();case KeyCode.ESCAPE:e.isPickerDisplayed&&a.preventDefault();break}}),this.addManagedListener(this.eWrapper,"click",o),this.addManagedListener(this.eLabel,"click",o),this.pickerIcon){var l=createIconNoSpan(this.pickerIcon,this.gridOptionsService);l&&this.eIcon.appendChild(l)}},t.prototype.refreshLabel=function(){exists(this.getLabel())?setAriaLabelledBy(this.eWrapper,this.getLabelId()):this.eWrapper.removeAttribute("aria-labelledby"),n.prototype.refreshLabel.call(this)},t.prototype.setAriaLabel=function(e){return setAriaLabel(this.eWrapper,e),this},t.prototype.setInputWidth=function(e){return setElementWidth(this.eWrapper,e),this},t.prototype.getFocusableElement=function(){return this.eWrapper},__decorate$2l([RefSelector("eLabel")],t.prototype,"eLabel",void 0),__decorate$2l([RefSelector("eWrapper")],t.prototype,"eWrapper",void 0),__decorate$2l([RefSelector("eDisplayField")],t.prototype,"eDisplayField",void 0),__decorate$2l([RefSelector("eIcon")],t.prototype,"eIcon",void 0),t}(AgAbstractField),__extends$2M=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$2k=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},AgList=function(n){__extends$2M(t,n);function t(e){e===void 0&&(e="default");var r=n.call(this,'<div class="ag-list ag-'+e+'-list" role="listbox"></div>')||this;return r.cssIdentifier=e,r.options=[],r.itemEls=[],r}return t.prototype.init=function(){this.addManagedListener(this.getGui(),"keydown",this.handleKeyDown.bind(this))},t.prototype.handleKeyDown=function(e){var r=e.key;switch(r){case KeyCode.ENTER:if(!this.highlightedEl)this.setValue(this.getValue());else{var o=this.itemEls.indexOf(this.highlightedEl);this.setValueByIndex(o)}break;case KeyCode.DOWN:case KeyCode.UP:var s=r===KeyCode.DOWN,l=void 0;if(e.preventDefault(),!this.highlightedEl)l=this.itemEls[s?0:this.itemEls.length-1];else{var a=this.itemEls.indexOf(this.highlightedEl),h=a+(s?1:-1);h=Math.min(Math.max(h,0),this.itemEls.length-1),l=this.itemEls[h]}this.highlightItem(l);break}},t.prototype.addOptions=function(e){var r=this;return e.forEach(function(o){return r.addOption(o)}),this},t.prototype.addOption=function(e){var r=e.value,o=e.text,s=escapeString(o||r);return this.options.push({value:r,text:s}),this.renderOption(r,s),this.updateIndices(),this},t.prototype.updateIndices=function(){var e=this.getGui().querySelectorAll(".ag-list-item");e.forEach(function(r,o){setAriaPosInSet(r,o+1),setAriaSetSize(r,e.length)})},t.prototype.renderOption=function(e,r){var o=this,s=document.createElement("div");setAriaRole(s,"option"),s.classList.add("ag-list-item","ag-"+this.cssIdentifier+"-list-item"),s.innerHTML="<span>"+r+"</span>",s.tabIndex=-1,this.itemEls.push(s),this.addManagedListener(s,"mouseover",function(){return o.highlightItem(s)}),this.addManagedListener(s,"mouseleave",function(){return o.clearHighlighted()}),this.addManagedListener(s,"click",function(){return o.setValue(e)}),this.getGui().appendChild(s)},t.prototype.setValue=function(e,r){if(this.value===e)return this.fireItemSelected(),this;if(e==null)return this.reset(),this;var o=this.options.findIndex(function(l){return l.value===e});if(o!==-1){var s=this.options[o];this.value=s.value,this.displayValue=s.text!=null?s.text:s.value,this.highlightItem(this.itemEls[o]),r||this.fireChangeEvent()}return this},t.prototype.setValueByIndex=function(e){return this.setValue(this.options[e].value)},t.prototype.getValue=function(){return this.value},t.prototype.getDisplayValue=function(){return this.displayValue},t.prototype.refreshHighlighted=function(){var e=this;this.clearHighlighted();var r=this.options.findIndex(function(o){return o.value===e.value});r!==-1&&this.highlightItem(this.itemEls[r])},t.prototype.reset=function(){this.value=null,this.displayValue=null,this.clearHighlighted(),this.fireChangeEvent()},t.prototype.highlightItem=function(e){e.offsetParent&&(this.clearHighlighted(),this.highlightedEl=e,this.highlightedEl.classList.add(t.ACTIVE_CLASS),setAriaSelected(this.highlightedEl,!0),this.highlightedEl.focus())},t.prototype.clearHighlighted=function(){!this.highlightedEl||!this.highlightedEl.offsetParent||(this.highlightedEl.classList.remove(t.ACTIVE_CLASS),setAriaSelected(this.highlightedEl,!1),this.highlightedEl=null)},t.prototype.fireChangeEvent=function(){this.dispatchEvent({type:AgAbstractField.EVENT_CHANGED}),this.fireItemSelected()},t.prototype.fireItemSelected=function(){this.dispatchEvent({type:t.EVENT_ITEM_SELECTED})},t.EVENT_ITEM_SELECTED="selectedItem",t.ACTIVE_CLASS="ag-active-item",__decorate$2k([PostConstruct],t.prototype,"init",null),t}(Component),__extends$2L=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$2j=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},AgSelect=function(n){__extends$2L(t,n);function t(e){return n.call(this,e,"ag-select","smallDown","listbox")||this}return t.prototype.init=function(){var e=this;this.listComponent=this.createBean(new AgList("select")),this.listComponent.setParentComponent(this),this.eWrapper.tabIndex=0,this.listComponent.addManagedListener(this.listComponent,AgList.EVENT_ITEM_SELECTED,function(){e.hideList&&e.hideList(),e.dispatchEvent({type:t.EVENT_ITEM_SELECTED})}),this.listComponent.addManagedListener(this.listComponent,AgAbstractField.EVENT_CHANGED,function(){e.setValue(e.listComponent.getValue(),!1,!0),e.hideList&&e.hideList()})},t.prototype.showPicker=function(){var e=this,r=this.listComponent.getGui(),o=this.gridOptionsService.getDocument(),s=this.addManagedListener(o.body,"wheel",function(y){!r.contains(y.target)&&e.hideList&&e.hideList()}),l=this.addManagedListener(r,"focusout",function(y){!r.contains(y.relatedTarget)&&e.hideList&&e.hideList()}),a=this.localeService.getLocaleTextFunc(),h=this.popupService.addPopup({modal:!0,eChild:r,closeOnEsc:!0,closedCallback:function(){e.hideList=null,e.isPickerDisplayed=!1,l(),s(),e.isAlive()&&(setAriaExpanded(e.eWrapper,!1),e.getFocusableElement().focus())},ariaLabel:a("ariaLabelSelectField","Select Field")});return h&&(this.hideList=h.hideFunc),this.isPickerDisplayed=!0,setElementWidth(r,getAbsoluteWidth(this.eWrapper)),setAriaExpanded(this.eWrapper,!0),r.style.maxHeight=getInnerHeight(this.popupService.getPopupParent())+"px",r.style.position="absolute",this.popupService.positionPopupByComponent({type:"ag-list",eventSource:this.eWrapper,ePopup:r,position:"under",keepWithinBounds:!0}),this.listComponent.refreshHighlighted(),this.listComponent},t.prototype.addOptions=function(e){var r=this;return e.forEach(function(o){return r.addOption(o)}),this},t.prototype.addOption=function(e){return this.listComponent.addOption(e),this},t.prototype.setValue=function(e,r,o){if(this.value===e)return this;o||this.listComponent.setValue(e,!0);var s=this.listComponent.getValue();return s===this.getValue()?this:(this.eDisplayField.innerHTML=this.listComponent.getDisplayValue(),n.prototype.setValue.call(this,e,r))},t.prototype.destroy=function(){this.hideList&&this.hideList(),this.destroyBean(this.listComponent),n.prototype.destroy.call(this)},t.EVENT_ITEM_SELECTED="selectedItem",__decorate$2j([Autowired("popupService")],t.prototype,"popupService",void 0),__decorate$2j([PostConstruct],t.prototype,"init",null),t}(AgPickerField),__extends$2K=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$2i=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},AgAbstractInputField=function(n){__extends$2K(t,n);function t(e,r,o,s){o===void 0&&(o="text"),s===void 0&&(s="input");var l=n.call(this,e,`
            <div role="presentation">
                <div ref="eLabel" class="ag-input-field-label"></div>
                <div ref="eWrapper" class="ag-wrapper ag-input-wrapper" role="presentation">
                    <`+s+' ref="eInput" class="ag-input-field-input"></'+s+`>
                </div>
            </div>`,r)||this;return l.inputType=o,l.displayFieldTag=s,l}return t.prototype.postConstruct=function(){n.prototype.postConstruct.call(this),this.setInputType(),this.eLabel.classList.add(this.className+"-label"),this.eWrapper.classList.add(this.className+"-input-wrapper"),this.eInput.classList.add(this.className+"-input"),this.addCssClass("ag-input-field"),this.eInput.id=this.eInput.id||"ag-"+this.getCompId()+"-input";var e=this.config,r=e.width,o=e.value;r!=null&&this.setWidth(r),o!=null&&this.setValue(o),this.addInputListeners(),this.activateTabIndex([this.eInput])},t.prototype.refreshLabel=function(){exists(this.getLabel())?setAriaLabelledBy(this.eInput,this.getLabelId()):this.eInput.removeAttribute("aria-labelledby"),n.prototype.refreshLabel.call(this)},t.prototype.addInputListeners=function(){var e=this;this.addManagedListener(this.eInput,"input",function(r){return e.setValue(r.target.value)})},t.prototype.setInputType=function(){this.displayFieldTag==="input"&&this.eInput.setAttribute("type",this.inputType)},t.prototype.getInputElement=function(){return this.eInput},t.prototype.setInputWidth=function(e){return setElementWidth(this.eWrapper,e),this},t.prototype.setInputName=function(e){return this.getInputElement().setAttribute("name",e),this},t.prototype.getFocusableElement=function(){return this.eInput},t.prototype.setMaxLength=function(e){var r=this.eInput;return r.maxLength=e,this},t.prototype.setInputPlaceholder=function(e){return addOrRemoveAttribute(this.eInput,"placeholder",e),this},t.prototype.setInputAriaLabel=function(e){return setAriaLabel(this.eInput,e),this},t.prototype.setDisabled=function(e){return setDisabled(this.eInput,e),n.prototype.setDisabled.call(this,e)},__decorate$2i([RefSelector("eLabel")],t.prototype,"eLabel",void 0),__decorate$2i([RefSelector("eWrapper")],t.prototype,"eWrapper",void 0),__decorate$2i([RefSelector("eInput")],t.prototype,"eInput",void 0),t}(AgAbstractField),__extends$2J=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),AgCheckbox=function(n){__extends$2J(t,n);function t(e,r,o){r===void 0&&(r="ag-checkbox"),o===void 0&&(o="checkbox");var s=n.call(this,e,r,o)||this;return s.labelAlignment="right",s.selected=!1,s.readOnly=!1,s.passive=!1,s}return t.prototype.addInputListeners=function(){this.addManagedListener(this.eInput,"click",this.onCheckboxClick.bind(this)),this.addManagedListener(this.eLabel,"click",this.toggle.bind(this))},t.prototype.getNextValue=function(){return this.selected===void 0?!0:!this.selected},t.prototype.setPassive=function(e){this.passive=e},t.prototype.isReadOnly=function(){return this.readOnly},t.prototype.setReadOnly=function(e){this.eWrapper.classList.toggle("ag-disabled",e),this.eInput.disabled=e,this.readOnly=e},t.prototype.setDisabled=function(e){return this.eWrapper.classList.toggle("ag-disabled",e),n.prototype.setDisabled.call(this,e)},t.prototype.toggle=function(){if(!this.eInput.disabled){var e=this.isSelected(),r=this.getNextValue();this.passive?this.dispatchChange(r,e):this.setValue(r)}},t.prototype.getValue=function(){return this.isSelected()},t.prototype.setValue=function(e,r){return this.refreshSelectedClass(e),this.setSelected(e,r),this},t.prototype.setName=function(e){var r=this.getInputElement();return r.name=e,this},t.prototype.isSelected=function(){return this.selected},t.prototype.setSelected=function(e,r){this.isSelected()!==e&&(this.previousValue=this.isSelected(),e=this.selected=typeof e=="boolean"?e:void 0,this.eInput.checked=e,this.eInput.indeterminate=e===void 0,r||this.dispatchChange(this.selected,this.previousValue))},t.prototype.dispatchChange=function(e,r,o){this.dispatchEvent({type:t.EVENT_CHANGED,selected:e,previousValue:r,event:o});var s=this.getInputElement(),l={type:Events.EVENT_CHECKBOX_CHANGED,id:s.id,name:s.name,selected:e,previousValue:r};this.eventService.dispatchEvent(l)},t.prototype.onCheckboxClick=function(e){if(!(this.passive||this.eInput.disabled)){var r=this.isSelected(),o=this.selected=e.target.checked;this.refreshSelectedClass(o),this.dispatchChange(o,r,e)}},t.prototype.refreshSelectedClass=function(e){this.eWrapper.classList.toggle("ag-checked",e===!0),this.eWrapper.classList.toggle("ag-indeterminate",e==null)},t}(AgAbstractInputField),__extends$2I=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),AgRadioButton=function(n){__extends$2I(t,n);function t(e){return n.call(this,e,"ag-radio-button","radio")||this}return t.prototype.isSelected=function(){return this.eInput.checked},t.prototype.toggle=function(){this.eInput.disabled||this.isSelected()||this.setValue(!0)},t.prototype.addInputListeners=function(){n.prototype.addInputListeners.call(this),this.addManagedListener(this.eventService,Events.EVENT_CHECKBOX_CHANGED,this.onChange.bind(this))},t.prototype.onChange=function(e){e.selected&&e.name&&this.eInput.name&&this.eInput.name===e.name&&e.id&&this.eInput.id!==e.id&&this.setValue(!1,!0)},t}(AgCheckbox),__extends$2H=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__read$o=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray$k=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n},SimpleFilterModelFormatter=function(){function n(t,e){this.localeService=t,this.optionsFactory=e}return n.prototype.getModelAsString=function(t){var e=this;if(!t)return null;var r=t.operator!=null,o=this.localeService.getLocaleTextFunc();if(r){var s=t,l=s.conditions;if(!l){var a=s.condition1,h=s.condition2;l=[a,h]}var y=l.map(function(yi){return e.getModelAsString(yi)}),C=s.operator==="AND"?"andCondition":"orCondition";return y.join(" "+o(C,DEFAULT_FILTER_LOCALE_TEXT[C])+" ")}else{if(t.type===SimpleFilter.BLANK||t.type===SimpleFilter.NOT_BLANK)return o(t.type,t.type);var L=t,Y=this.optionsFactory.getCustomOption(L.type),ze=Y||{},Bt=ze.displayKey,Ir=ze.displayName,Wr=ze.numberOfInputs;return Bt&&Ir&&Wr===0?(o(Bt,Ir),Ir):this.conditionToString(L,Y)}},n}(),SimpleFilter=function(n){__extends$2H(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.eTypes=[],e.eJoinOperatorPanels=[],e.eJoinOperatorsAnd=[],e.eJoinOperatorsOr=[],e.eConditionBodies=[],e.listener=function(){return e.onUiChanged()},e.lastUiCompletePosition=null,e.joinOperatorId=0,e}return t.prototype.getNumberOfInputs=function(e){var r=this.optionsFactory.getCustomOption(e);if(r){var o=r.numberOfInputs;return o??1}var s=[t.EMPTY,t.NOT_BLANK,t.BLANK];return e&&s.indexOf(e)>=0?0:e===t.IN_RANGE?2:1},t.prototype.onFloatingFilterChanged=function(e,r){this.setTypeFromFloatingFilter(e),this.setValueFromFloatingFilter(r),this.onUiChanged(!0)},t.prototype.setTypeFromFloatingFilter=function(e){var r=this;this.eTypes.forEach(function(o,s){s===0?o.setValue(e,!0):o.setValue(r.optionsFactory.getDefaultOption(),!0)})},t.prototype.getModelFromUi=function(){var e=this.getUiCompleteConditions();return e.length===0?null:this.maxNumConditions>1&&e.length>1?{filterType:this.getFilterType(),operator:this.getJoinOperator(),condition1:e[0],condition2:e[1],conditions:e}:e[0]},t.prototype.getConditionTypes=function(){return this.eTypes.map(function(e){return e.getValue()})},t.prototype.getConditionType=function(e){return this.eTypes[e].getValue()},t.prototype.getJoinOperator=function(){return this.eJoinOperatorsOr.length===0?this.defaultJoinOperator:this.eJoinOperatorsOr[0].getValue()===!0?"OR":"AND"},t.prototype.areModelsEqual=function(e,r){var o=this;if(!e&&!r)return!0;if(!e&&r||e&&!r)return!1;var s=!e.operator,l=!r.operator,a=!s&&l||s&&!l;if(a)return!1;var h;if(s){var y=e,C=r;h=this.areSimpleModelsEqual(y,C)}else{var L=e,Y=r;h=L.operator===Y.operator&&areEqual(L.conditions,Y.conditions,function(ze,Bt){return o.areSimpleModelsEqual(ze,Bt)})}return h},t.prototype.setModelIntoUi=function(e){var r=this,o=e.operator;if(o){var s=e;s.conditions||(s.conditions=[s.condition1,s.condition2]);var l=this.validateAndUpdateConditions(s.conditions),a=this.getNumConditions();if(l<a)this.removeConditionsAndOperators(l);else if(l>a)for(var h=a;h<l;h++)this.createJoinOperatorPanel(),this.createOption();var y=s.operator==="OR";this.eJoinOperatorsAnd.forEach(function(L){return L.setValue(!y,!0)}),this.eJoinOperatorsOr.forEach(function(L){return L.setValue(y,!0)}),s.conditions.forEach(function(L,Y){r.eTypes[Y].setValue(L.type,!0),r.setConditionIntoUi(L,Y)})}else{var C=e;this.getNumConditions()>1&&this.removeConditionsAndOperators(1),this.eTypes[0].setValue(C.type,!0),this.setConditionIntoUi(C,0)}return this.lastUiCompletePosition=this.getNumConditions()-1,this.createMissingConditionsAndOperators(),this.onUiChanged(),AgPromise.resolve()},t.prototype.validateAndUpdateConditions=function(e){var r=e.length;return r>this.maxNumConditions&&(e.splice(this.maxNumConditions),doOnce(function(){return console.warn('AG Grid: Filter Model contains more conditions than "filterParams.maxNumConditions". Additional conditions have been ignored.')},"simpleFilterSetModelMaxNumConditions"),r=this.maxNumConditions),r},t.prototype.doesFilterPass=function(e){var r=this,o,s=this.getModel();if(s==null)return!0;var l=s.operator,a=[];if(l){var h=s;a.push.apply(a,__spreadArray$k([],__read$o((o=h.conditions)!==null&&o!==void 0?o:[])))}else a.push(s);var y=l&&l==="OR"?"some":"every";return a[y](function(C){return r.individualConditionPasses(e,C)})},t.prototype.setParams=function(e){n.prototype.setParams.call(this,e),this.setNumConditions(e),this.defaultJoinOperator=this.getDefaultJoinOperator(e.defaultJoinOperator),this.filterPlaceholder=e.filterPlaceholder,this.optionsFactory=new OptionsFactory,this.optionsFactory.init(e,this.getDefaultFilterOptions()),this.createFilterListOptions(),this.createOption(),this.createMissingConditionsAndOperators()},t.prototype.setNumConditions=function(e){var r,o;e.suppressAndOrCondition!=null&&doOnce(function(){return console.warn('AG Grid: Since v29.2 "filterParams.suppressAndOrCondition" is deprecated. Use "filterParams.maxNumConditions = 1" instead.')},"simpleFilterSuppressAndOrCondition"),e.alwaysShowBothConditions!=null&&doOnce(function(){return console.warn('AG Grid: Since v29.2 "filterParams.alwaysShowBothConditions" is deprecated. Use "filterParams.numAlwaysVisibleConditions = 2" instead.')},"simpleFilterAlwaysShowBothConditions"),this.maxNumConditions=(r=e.maxNumConditions)!==null&&r!==void 0?r:e.suppressAndOrCondition?1:2,this.maxNumConditions<1&&(doOnce(function(){return console.warn('AG Grid: "filterParams.maxNumConditions" must be greater than or equal to zero.')},"simpleFilterMaxNumConditions"),this.maxNumConditions=1),this.numAlwaysVisibleConditions=(o=e.numAlwaysVisibleConditions)!==null&&o!==void 0?o:e.alwaysShowBothConditions?2:1,this.numAlwaysVisibleConditions<1&&(doOnce(function(){return console.warn('AG Grid: "filterParams.numAlwaysVisibleConditions" must be greater than or equal to zero.')},"simpleFilterNumAlwaysVisibleConditions"),this.numAlwaysVisibleConditions=1),this.numAlwaysVisibleConditions>this.maxNumConditions&&(doOnce(function(){return console.warn('AG Grid: "filterParams.numAlwaysVisibleConditions" cannot be greater than "filterParams.maxNumConditions".')},"simpleFilterNumAlwaysVisibleGreaterThanMaxNumConditions"),this.numAlwaysVisibleConditions=this.maxNumConditions)},t.prototype.createOption=function(){var e=this,r=this.createManagedBean(new AgSelect);this.eTypes.push(r),r.addCssClass("ag-filter-select"),this.eFilterBody.appendChild(r.getGui());var o=this.createValueElement();this.eConditionBodies.push(o),this.eFilterBody.appendChild(o),this.putOptionsIntoDropdown(r),this.resetType(r);var s=this.getNumConditions()-1;this.forEachPositionInput(s,function(l){return e.resetInput(l)}),this.addChangedListeners(r,s)},t.prototype.createJoinOperatorPanel=function(){var e=document.createElement("div");this.eJoinOperatorPanels.push(e),e.classList.add("ag-filter-condition");var r=this.createJoinOperator(this.eJoinOperatorsAnd,e,"and"),o=this.createJoinOperator(this.eJoinOperatorsOr,e,"or");this.eFilterBody.appendChild(e);var s=this.eJoinOperatorPanels.length-1,l=this.joinOperatorId++;this.resetJoinOperatorAnd(r,s,l),this.resetJoinOperatorOr(o,s,l),this.isReadOnly()||(r.onValueChange(this.listener),o.onValueChange(this.listener))},t.prototype.createJoinOperator=function(e,r,o){var s=this.createManagedBean(new AgRadioButton);return e.push(s),s.addCssClass("ag-filter-condition-operator"),s.addCssClass("ag-filter-condition-operator-"+o),r.appendChild(s.getGui()),s},t.prototype.getDefaultJoinOperator=function(e){return e==="AND"||e==="OR"?e:"AND"},t.prototype.createFilterListOptions=function(){var e=this,r=this.optionsFactory.getFilterOptions();this.filterListOptions=r.map(function(o){return typeof o=="string"?e.createBoilerplateListOption(o):e.createCustomListOption(o)})},t.prototype.putOptionsIntoDropdown=function(e){this.filterListOptions.forEach(function(r){e.addOption(r)}),e.setDisabled(this.filterListOptions.length<=1)},t.prototype.createBoilerplateListOption=function(e){return{value:e,text:this.translate(e)}},t.prototype.createCustomListOption=function(e){var r=e.displayKey,o=this.optionsFactory.getCustomOption(e.displayKey);return{value:r,text:o?this.localeService.getLocaleTextFunc()(o.displayKey,o.displayName):this.translate(r)}},t.prototype.isAllowTwoConditions=function(){return this.maxNumConditions>=2},t.prototype.createBodyTemplate=function(){return""},t.prototype.getCssIdentifier=function(){return"simple-filter"},t.prototype.updateUiVisibility=function(){var e=this.getJoinOperator();this.updateNumConditions(),this.updateConditionStatusesAndValues(this.lastUiCompletePosition,e)},t.prototype.updateNumConditions=function(){for(var e,r=-1,o=!0,s=0;s<this.getNumConditions();s++)this.isConditionUiComplete(s)?r=s:o=!1;if(this.shouldAddNewConditionAtEnd(o))this.createJoinOperatorPanel(),this.createOption();else{var l=(e=this.lastUiCompletePosition)!==null&&e!==void 0?e:this.getNumConditions()-2;if(r<l){this.removeConditionsAndOperators(l+1);var a=r+1,h=l-a;h>0&&this.removeConditionsAndOperators(a,h),this.createMissingConditionsAndOperators()}}this.lastUiCompletePosition=r},t.prototype.updateConditionStatusesAndValues=function(e,r){var o=this;this.eTypes.forEach(function(l,a){var h=o.isConditionDisabled(a,e);l.setDisabled(h||o.filterListOptions.length<=1),a===1&&(setDisabled(o.eJoinOperatorPanels[0],h),o.eJoinOperatorsAnd[0].setDisabled(h),o.eJoinOperatorsOr[0].setDisabled(h))}),this.eConditionBodies.forEach(function(l,a){setDisplayed(l,o.isConditionBodyVisible(a))});var s=(r??this.getJoinOperator())==="OR";this.eJoinOperatorsAnd.forEach(function(l,a){l.setValue(!s,!0)}),this.eJoinOperatorsOr.forEach(function(l,a){l.setValue(s,!0)}),this.forEachInput(function(l,a,h,y){o.setElementDisplayed(l,a<y),o.setElementDisabled(l,o.isConditionDisabled(h,e))}),this.resetPlaceholder()},t.prototype.shouldAddNewConditionAtEnd=function(e){return e&&this.getNumConditions()<this.maxNumConditions&&!this.isReadOnly()},t.prototype.removeConditionsAndOperators=function(e,r){if(!(e>=this.getNumConditions())){this.removeComponents(this.eTypes,e,r),this.removeElements(this.eConditionBodies,e,r),this.removeValueElements(e,r);var o=Math.max(e-1,0);this.removeElements(this.eJoinOperatorPanels,o,r),this.removeComponents(this.eJoinOperatorsAnd,o,r),this.removeComponents(this.eJoinOperatorsOr,o,r)}},t.prototype.removeElements=function(e,r,o){var s=this.removeItems(e,r,o);s.forEach(function(l){return removeFromParent(l)})},t.prototype.removeComponents=function(e,r,o){var s=this,l=this.removeItems(e,r,o);l.forEach(function(a){removeFromParent(a.getGui()),s.destroyBean(a)})},t.prototype.removeItems=function(e,r,o){return o==null?e.splice(r):e.splice(r,o)},t.prototype.afterGuiAttached=function(e){if(n.prototype.afterGuiAttached.call(this,e),this.resetPlaceholder(),!e||!e.suppressFocus&&!this.isReadOnly()){var r=this.getInputs(0)[0];if(!r)return;r instanceof AgAbstractInputField&&r.getInputElement().focus()}},t.prototype.afterGuiDetached=function(){n.prototype.afterGuiDetached.call(this);var e=this.getModel();(!this.areModelsEqual(e,this.getModelFromUi())||this.hasInvalidInputs())&&this.resetUiToActiveModel(e);for(var r=-1,o=-1,s=!1,l=this.getJoinOperator(),a=this.getNumConditions()-1;a>=0;a--)if(this.isConditionUiComplete(a))r===-1&&(r=a,o=a);else{var h=a>=this.numAlwaysVisibleConditions&&!this.isConditionUiComplete(a-1),y=a<r;(h||y)&&(this.removeConditionsAndOperators(a,1),s=!0,y&&o--)}var C=!1;this.getNumConditions()<this.numAlwaysVisibleConditions&&(this.createMissingConditionsAndOperators(),C=!0),this.shouldAddNewConditionAtEnd(o===this.getNumConditions()-1)&&(this.createJoinOperatorPanel(),this.createOption(),C=!0),C&&this.updateConditionStatusesAndValues(o,l),s&&this.updateJoinOperatorsDisabled(),this.lastUiCompletePosition=o},t.prototype.getPlaceholderText=function(e,r){var o=this.translate(e);if(isFunction(this.filterPlaceholder)){var s=this.filterPlaceholder,l=this.eTypes[r].getValue(),a=this.translate(l);o=s({filterOptionKey:l,filterOption:a,placeholder:o})}else typeof this.filterPlaceholder=="string"&&(o=this.filterPlaceholder);return o},t.prototype.resetPlaceholder=function(){var e=this,r=this.localeService.getLocaleTextFunc();this.forEachInput(function(o,s,l,a){if(o instanceof AgAbstractInputField){var h=s===0&&a>1?"inRangeStart":s===0?"filterOoo":"inRangeEnd",y=s===0&&a>1?r("ariaFilterFromValue","Filter from value"):s===0?r("ariaFilterValue","Filter Value"):r("ariaFilterToValue","Filter to Value");o.setInputPlaceholder(e.getPlaceholderText(h,l)),o.setInputAriaLabel(y)}})},t.prototype.setElementValue=function(e,r){e instanceof AgAbstractInputField&&e.setValue(r!=null?String(r):null,!0)},t.prototype.setElementDisplayed=function(e,r){e instanceof Component&&setDisplayed(e.getGui(),r)},t.prototype.setElementDisabled=function(e,r){e instanceof Component&&setDisabled(e.getGui(),r)},t.prototype.attachElementOnChange=function(e,r){e instanceof AgAbstractInputField&&e.onValueChange(r)},t.prototype.forEachInput=function(e){var r=this;this.getConditionTypes().forEach(function(o,s){r.forEachPositionTypeInput(s,o,e)})},t.prototype.forEachPositionInput=function(e,r){var o=this.getConditionType(e);this.forEachPositionTypeInput(e,o,r)},t.prototype.forEachPositionTypeInput=function(e,r,o){for(var s=this.getNumberOfInputs(r),l=this.getInputs(e),a=0;a<l.length;a++){var h=l[a];h!=null&&o(h,a,e,s)}},t.prototype.isConditionDisabled=function(e,r){return this.isReadOnly()?!0:e===0?!1:e>r+1},t.prototype.isConditionBodyVisible=function(e){var r=this.getConditionType(e),o=this.getNumberOfInputs(r);return o>0},t.prototype.isConditionUiComplete=function(e){if(e>=this.getNumConditions())return!1;var r=this.getConditionType(e);return!(r===t.EMPTY||this.getValues(e).some(function(o){return o==null}))},t.prototype.getNumConditions=function(){return this.eTypes.length},t.prototype.getUiCompleteConditions=function(){for(var e=[],r=0;r<this.getNumConditions();r++)this.isConditionUiComplete(r)&&e.push(this.createCondition(r));return e},t.prototype.createMissingConditionsAndOperators=function(){if(!this.isReadOnly())for(var e=this.getNumConditions();e<this.numAlwaysVisibleConditions;e++)this.createJoinOperatorPanel(),this.createOption()},t.prototype.resetUiToDefaults=function(e){var r=this;return this.removeConditionsAndOperators(this.isReadOnly()?1:this.numAlwaysVisibleConditions),this.eTypes.forEach(function(o){return r.resetType(o)}),this.eJoinOperatorsAnd.forEach(function(o,s){return r.resetJoinOperatorAnd(o,s,r.joinOperatorId+s)}),this.eJoinOperatorsOr.forEach(function(o,s){return r.resetJoinOperatorOr(o,s,r.joinOperatorId+s)}),this.joinOperatorId++,this.forEachInput(function(o){return r.resetInput(o)}),this.resetPlaceholder(),this.createMissingConditionsAndOperators(),this.lastUiCompletePosition=null,e||this.onUiChanged(),AgPromise.resolve()},t.prototype.resetType=function(e){var r=this.localeService.getLocaleTextFunc(),o=r("ariaFilteringOperator","Filtering operator");e.setValue(this.optionsFactory.getDefaultOption(),!0).setAriaLabel(o).setDisabled(this.isReadOnly()||this.filterListOptions.length<=1)},t.prototype.resetJoinOperatorAnd=function(e,r,o){this.resetJoinOperator(e,r,this.isDefaultOperator("AND"),this.translate("andCondition"),o)},t.prototype.resetJoinOperatorOr=function(e,r,o){this.resetJoinOperator(e,r,this.isDefaultOperator("OR"),this.translate("orCondition"),o)},t.prototype.resetJoinOperator=function(e,r,o,s,l){this.updateJoinOperatorDisabled(e.setValue(o,!0).setName("ag-simple-filter-and-or-"+this.getCompId()+"-"+l).setLabel(s),r)},t.prototype.updateJoinOperatorsDisabled=function(){var e=this;this.eJoinOperatorsAnd.forEach(function(r,o){return e.updateJoinOperatorDisabled(r,o)}),this.eJoinOperatorsOr.forEach(function(r,o){return e.updateJoinOperatorDisabled(r,o)})},t.prototype.updateJoinOperatorDisabled=function(e,r){e.setDisabled(this.isReadOnly()||r>0)},t.prototype.resetInput=function(e){this.setElementValue(e,null),this.setElementDisabled(e,this.isReadOnly())},t.prototype.setConditionIntoUi=function(e,r){var o=this,s=this.mapValuesFromModel(e);this.forEachInput(function(l,a,h,y){h===r&&o.setElementValue(l,s[a]!=null?s[a]:null)})},t.prototype.setValueFromFloatingFilter=function(e){var r=this;this.forEachInput(function(o,s,l,a){r.setElementValue(o,s===0&&l===0?e:null)})},t.prototype.isDefaultOperator=function(e){return e===this.defaultJoinOperator},t.prototype.addChangedListeners=function(e,r){var o=this;this.isReadOnly()||(e.onValueChange(this.listener),this.forEachPositionInput(r,function(s){o.attachElementOnChange(s,o.listener)}))},t.prototype.individualConditionPasses=function(e,r){var o=this.getCellValue(e.node),s=this.mapValuesFromModel(r),l=this.optionsFactory.getCustomOption(r.type),a=this.evaluateCustomFilter(l,s,o);return a??(o==null?this.evaluateNullValue(r.type):this.evaluateNonNullValue(s,o,r,e))},t.prototype.evaluateCustomFilter=function(e,r,o){if(e!=null){var s=e.predicate;if(s!=null&&!r.some(function(l){return l==null}))return s(r,o)}},t.prototype.isBlank=function(e){return e==null||typeof e=="string"&&e.trim().length===0},t.prototype.hasInvalidInputs=function(){return!1},t.EMPTY="empty",t.BLANK="blank",t.NOT_BLANK="notBlank",t.EQUALS="equals",t.NOT_EQUAL="notEqual",t.LESS_THAN="lessThan",t.LESS_THAN_OR_EQUAL="lessThanOrEqual",t.GREATER_THAN="greaterThan",t.GREATER_THAN_OR_EQUAL="greaterThanOrEqual",t.IN_RANGE="inRange",t.CONTAINS="contains",t.NOT_CONTAINS="notContains",t.STARTS_WITH="startsWith",t.ENDS_WITH="endsWith",t}(ProvidedFilter),__extends$2G=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),ScalarFilter=function(n){__extends$2G(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.setParams=function(e){n.prototype.setParams.call(this,e),this.scalarFilterParams=e},t.prototype.evaluateNullValue=function(e){switch(e){case t.EQUALS:case t.NOT_EQUAL:if(this.scalarFilterParams.includeBlanksInEquals)return!0;break;case t.GREATER_THAN:case t.GREATER_THAN_OR_EQUAL:if(this.scalarFilterParams.includeBlanksInGreaterThan)return!0;break;case t.LESS_THAN:case t.LESS_THAN_OR_EQUAL:if(this.scalarFilterParams.includeBlanksInLessThan)return!0;break;case t.IN_RANGE:if(this.scalarFilterParams.includeBlanksInRange)return!0;break;case t.BLANK:return!0;case t.NOT_BLANK:return!1}return!1},t.prototype.evaluateNonNullValue=function(e,r,o){var s=this.comparator(),l=e[0]!=null?s(e[0],r):0;switch(o.type){case t.EQUALS:return l===0;case t.NOT_EQUAL:return l!==0;case t.GREATER_THAN:return l>0;case t.GREATER_THAN_OR_EQUAL:return l>=0;case t.LESS_THAN:return l<0;case t.LESS_THAN_OR_EQUAL:return l<=0;case t.IN_RANGE:{var a=s(e[1],r);return this.scalarFilterParams.inRangeInclusive?l>=0&&a<=0:l>0&&a<0}case t.BLANK:return this.isBlank(r);case t.NOT_BLANK:return!this.isBlank(r);default:return console.warn('AG Grid: Unexpected type of filter "'+o.type+'", it looks like the filter was configured with incorrect Filter Options'),!0}},t}(SimpleFilter),__extends$2F=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__assign$h=function(){return __assign$h=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},__assign$h.apply(this,arguments)},__decorate$2h=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},DEFAULT_MIN_YEAR=1e3,DEFAULT_MAX_YEAR=1/0,DateFilterModelFormatter=function(n){__extends$2F(t,n);function t(e,r,o){var s=n.call(this,r,o)||this;return s.dateFilterParams=e,s}return t.prototype.conditionToString=function(e,r){var o=e.type,s=(r||{}).numberOfInputs,l=o==SimpleFilter.IN_RANGE||s===2,a=parseDateTimeFromString(e.dateFrom),h=parseDateTimeFromString(e.dateTo),y=this.dateFilterParams.inRangeFloatingFilterDateFormat;if(l){var C=a!==null?dateToFormattedString(a,y):"null",L=h!==null?dateToFormattedString(h,y):"null";return C+"-"+L}return a!=null?dateToFormattedString(a,y):""+o},t}(SimpleFilterModelFormatter),DateFilter=function(n){__extends$2F(t,n);function t(){var e=n.call(this,"dateFilter")||this;return e.eConditionPanelsFrom=[],e.eConditionPanelsTo=[],e.dateConditionFromComps=[],e.dateConditionToComps=[],e.minValidYear=DEFAULT_MIN_YEAR,e.maxValidYear=DEFAULT_MAX_YEAR,e}return t.prototype.afterGuiAttached=function(e){n.prototype.afterGuiAttached.call(this,e),this.dateConditionFromComps[0].afterGuiAttached(e)},t.prototype.mapValuesFromModel=function(e){var r=e||{},o=r.dateFrom,s=r.dateTo,l=r.type;return[o&&parseDateTimeFromString(o)||null,s&&parseDateTimeFromString(s)||null].slice(0,this.getNumberOfInputs(l))},t.prototype.comparator=function(){return this.dateFilterParams.comparator?this.dateFilterParams.comparator:this.defaultComparator.bind(this)},t.prototype.defaultComparator=function(e,r){var o=r;return r==null||o<e?-1:o>e?1:0},t.prototype.setParams=function(e){this.dateFilterParams=e,n.prototype.setParams.call(this,e);var r=function(o,s){if(e[o]!=null)if(isNaN(e[o]))console.warn("AG Grid: DateFilter "+o+" is not a number");else return e[o]==null?s:Number(e[o]);return s};this.minValidYear=r("minValidYear",DEFAULT_MIN_YEAR),this.maxValidYear=r("maxValidYear",DEFAULT_MAX_YEAR),this.minValidYear>this.maxValidYear&&console.warn("AG Grid: DateFilter minValidYear should be <= maxValidYear"),this.filterModelFormatter=new DateFilterModelFormatter(this.dateFilterParams,this.localeService,this.optionsFactory)},t.prototype.createDateCompWrapper=function(e){var r=this,o=new DateCompWrapper(this.getContext(),this.userComponentFactory,{onDateChanged:function(){return r.onUiChanged()},filterParams:this.dateFilterParams},e);return this.addDestroyFunc(function(){return o.destroy()}),o},t.prototype.setElementValue=function(e,r){e.setDate(r)},t.prototype.setElementDisplayed=function(e,r){e.setDisplayed(r)},t.prototype.setElementDisabled=function(e,r){e.setDisabled(r)},t.prototype.getDefaultFilterOptions=function(){return t.DEFAULT_FILTER_OPTIONS},t.prototype.createValueElement=function(){var e=document.createElement("div");return e.classList.add("ag-filter-body"),this.createFromToElement(e,this.eConditionPanelsFrom,this.dateConditionFromComps,"from"),this.createFromToElement(e,this.eConditionPanelsTo,this.dateConditionToComps,"to"),e},t.prototype.createFromToElement=function(e,r,o,s){var l=document.createElement("div");l.classList.add("ag-filter-"+s),l.classList.add("ag-filter-date-"+s),r.push(l),e.appendChild(l),o.push(this.createDateCompWrapper(l))},t.prototype.removeValueElements=function(e,r){this.removeDateComps(this.dateConditionFromComps,e,r),this.removeDateComps(this.dateConditionToComps,e,r),this.removeItems(this.eConditionPanelsFrom,e,r),this.removeItems(this.eConditionPanelsTo,e,r)},t.prototype.removeDateComps=function(e,r,o){var s=this.removeItems(e,r,o);s.forEach(function(l){return l.destroy()})},t.prototype.isConditionUiComplete=function(e){var r=this;if(!n.prototype.isConditionUiComplete.call(this,e))return!1;var o=function(l){return l!=null&&l.getUTCFullYear()>=r.minValidYear&&l.getUTCFullYear()<=r.maxValidYear},s=!0;return this.forEachInput(function(l,a,h,y){h!==e||!s||a>=y||(s=s&&o(l.getDate()))}),s},t.prototype.areSimpleModelsEqual=function(e,r){return e.dateFrom===r.dateFrom&&e.dateTo===r.dateTo&&e.type===r.type},t.prototype.getFilterType=function(){return"date"},t.prototype.createCondition=function(e){var r=this.getConditionType(e),o={},s=this.getValues(e);return s.length>0&&(o.dateFrom=serialiseDate(s[0])),s.length>1&&(o.dateTo=serialiseDate(s[1])),__assign$h({dateFrom:null,dateTo:null,filterType:this.getFilterType(),type:r},o)},t.prototype.resetPlaceholder=function(){var e=this.localeService.getLocaleTextFunc(),r=this.translate("dateFormatOoo"),o=e("ariaFilterValue","Filter Value");this.forEachInput(function(s){s.setInputPlaceholder(r),s.setInputAriaLabel(o)})},t.prototype.getInputs=function(e){return e>=this.dateConditionFromComps.length?[null,null]:[this.dateConditionFromComps[e],this.dateConditionToComps[e]]},t.prototype.getValues=function(e){var r=[];return this.forEachPositionInput(e,function(o,s,l,a){s<a&&r.push(o.getDate())}),r},t.prototype.getModelAsString=function(e){var r;return(r=this.filterModelFormatter.getModelAsString(e))!==null&&r!==void 0?r:""},t.DEFAULT_FILTER_OPTIONS=[ScalarFilter.EQUALS,ScalarFilter.GREATER_THAN,ScalarFilter.LESS_THAN,ScalarFilter.NOT_EQUAL,ScalarFilter.IN_RANGE,ScalarFilter.BLANK,ScalarFilter.NOT_BLANK],__decorate$2h([Autowired("userComponentFactory")],t.prototype,"userComponentFactory",void 0),t}(ScalarFilter),__extends$2E=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),SimpleFloatingFilter=function(n){__extends$2E(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.getDefaultDebounceMs=function(){return 0},t.prototype.destroy=function(){n.prototype.destroy.call(this)},t.prototype.isEventFromFloatingFilter=function(e){return e&&e.afterFloatingFilter},t.prototype.isEventFromDataChange=function(e){return e==null?void 0:e.afterDataChange},t.prototype.getLastType=function(){return this.lastType},t.prototype.isReadOnly=function(){return this.readOnly},t.prototype.setLastTypeFromModel=function(e){if(!e){this.lastType=this.optionsFactory.getDefaultOption();return}var r=e.operator,o;if(r){var s=e;o=s.conditions[0]}else o=e;this.lastType=o.type},t.prototype.canWeEditAfterModelFromParentFilter=function(e){if(!e)return this.isTypeEditable(this.lastType);var r=e.operator;if(r)return!1;var o=e;return this.isTypeEditable(o.type)},t.prototype.init=function(e){this.optionsFactory=new OptionsFactory,this.optionsFactory.init(e.filterParams,this.getDefaultFilterOptions()),this.lastType=this.optionsFactory.getDefaultOption(),this.readOnly=!!e.filterParams.readOnly;var r=this.isTypeEditable(this.lastType);this.setEditable(r)},t.prototype.doesFilterHaveSingleInput=function(e){var r=this.optionsFactory.getCustomOption(e),o=(r||{}).numberOfInputs;return o==null||o==1},t.prototype.isTypeEditable=function(e){var r=[SimpleFilter.IN_RANGE,SimpleFilter.EMPTY,SimpleFilter.BLANK,SimpleFilter.NOT_BLANK];return!!e&&!this.isReadOnly()&&this.doesFilterHaveSingleInput(e)&&r.indexOf(e)<0},t}(Component),__extends$2D=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$2g=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},DateFloatingFilter=function(n){__extends$2D(t,n);function t(){return n.call(this,`
            <div class="ag-floating-filter-input" role="presentation">
                <ag-input-text-field ref="eReadOnlyText"></ag-input-text-field>
                <div ref="eDateWrapper" style="display: flex;"></div>
            </div>`)||this}return t.prototype.getDefaultFilterOptions=function(){return DateFilter.DEFAULT_FILTER_OPTIONS},t.prototype.init=function(e){n.prototype.init.call(this,e),this.params=e,this.filterParams=e.filterParams,this.createDateComponent();var r=this.localeService.getLocaleTextFunc();this.eReadOnlyText.setDisabled(!0).setInputAriaLabel(r("ariaDateFilterInput","Date Filter Input")),this.filterModelFormatter=new DateFilterModelFormatter(this.filterParams,this.localeService,this.optionsFactory)},t.prototype.setEditable=function(e){setDisplayed(this.eDateWrapper,e),setDisplayed(this.eReadOnlyText.getGui(),!e)},t.prototype.onParentModelChanged=function(e,r){if(!(this.isEventFromFloatingFilter(r)||this.isEventFromDataChange(r))){n.prototype.setLastTypeFromModel.call(this,e);var o=!this.isReadOnly()&&this.canWeEditAfterModelFromParentFilter(e);if(this.setEditable(o),o){if(e){var s=e;this.dateComp.setDate(parseDateTimeFromString(s.dateFrom))}else this.dateComp.setDate(null);this.eReadOnlyText.setValue("")}else this.eReadOnlyText.setValue(this.filterModelFormatter.getModelAsString(e)),this.dateComp.setDate(null)}},t.prototype.onDateChanged=function(){var e=this,r=this.dateComp.getDate(),o=serialiseDate(r);this.params.parentFilterInstance(function(s){if(s){var l=parseDateTimeFromString(o);s.onFloatingFilterChanged(e.getLastType()||null,l)}})},t.prototype.createDateComponent=function(){var e=this,r=ProvidedFilter.getDebounceMs(this.params.filterParams,this.getDefaultDebounceMs()),o={onDateChanged:debounce(this.onDateChanged.bind(this),r),filterParams:this.params.column.getColDef().filterParams};this.dateComp=new DateCompWrapper(this.getContext(),this.userComponentFactory,o,this.eDateWrapper),this.addDestroyFunc(function(){return e.dateComp.destroy()})},t.prototype.getFilterModelFormatter=function(){return this.filterModelFormatter},__decorate$2g([Autowired("userComponentFactory")],t.prototype,"userComponentFactory",void 0),__decorate$2g([RefSelector("eReadOnlyText")],t.prototype,"eReadOnlyText",void 0),__decorate$2g([RefSelector("eDateWrapper")],t.prototype,"eDateWrapper",void 0),t}(SimpleFloatingFilter),__extends$2C=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$2f=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},DefaultDateComponent=function(n){__extends$2C(t,n);function t(){return n.call(this,`
            <div class="ag-filter-filter">
                <ag-input-text-field class="ag-date-filter" ref="eDateInput"></ag-input-text-field>
            </div>`)||this}return t.prototype.destroy=function(){n.prototype.destroy.call(this)},t.prototype.init=function(e){var r=this,o=this.gridOptionsService.getDocument(),s=this.eDateInput.getInputElement(),l=this.shouldUseBrowserDatePicker(e);l&&(s.type="date");var a=l&&isBrowserSafari();this.addManagedListener(s,"mousedown",function(){r.eDateInput.isDisabled()||a||s.focus()}),this.addManagedListener(s,"input",function(L){L.target===o.activeElement&&(r.eDateInput.isDisabled()||e.onDateChanged())});var h=e.filterParams||{},y=h.minValidYear,C=h.maxValidYear;y&&(s.min=y+"-01-01"),C&&(s.max=C+"-12-31")},t.prototype.getDate=function(){return parseDateTimeFromString(this.eDateInput.getValue())},t.prototype.setDate=function(e){this.eDateInput.setValue(serialiseDate(e,!1))},t.prototype.setInputPlaceholder=function(e){this.eDateInput.setInputPlaceholder(e)},t.prototype.setDisabled=function(e){this.eDateInput.setDisabled(e)},t.prototype.afterGuiAttached=function(e){(!e||!e.suppressFocus)&&this.eDateInput.getInputElement().focus()},t.prototype.shouldUseBrowserDatePicker=function(e){return e.filterParams&&e.filterParams.browserDatePicker!=null?e.filterParams.browserDatePicker:isBrowserChrome()||isBrowserFirefox()||isBrowserSafari()&&getSafariVersion()>=14.1},__decorate$2f([RefSelector("eDateInput")],t.prototype,"eDateInput",void 0),t}(Component),__extends$2B=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),AgInputTextField=function(n){__extends$2B(t,n);function t(e,r,o){return r===void 0&&(r="ag-text-field"),o===void 0&&(o="text"),n.call(this,e,r,o)||this}return t.prototype.postConstruct=function(){n.prototype.postConstruct.call(this),this.config.allowedCharPattern&&this.preventDisallowedCharacters()},t.prototype.setValue=function(e,r){var o=n.prototype.setValue.call(this,e,r);return this.eInput.value!==e&&(this.eInput.value=exists(e)?e:""),o},t.prototype.setStartValue=function(e){this.setValue(e,!0)},t.prototype.preventDisallowedCharacters=function(){var e=new RegExp("["+this.config.allowedCharPattern+"]"),r=function(o){isEventFromPrintableCharacter(o)&&o.key&&!e.test(o.key)&&o.preventDefault()};this.addManagedListener(this.eInput,"keydown",r),this.addManagedListener(this.eInput,"paste",function(o){var s,l=(s=o.clipboardData)===null||s===void 0?void 0:s.getData("text");l&&l.split("").some(function(a){return!e.test(a)})&&o.preventDefault()})},t}(AgAbstractInputField),__extends$2A=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),AgInputNumberField=function(n){__extends$2A(t,n);function t(e){return n.call(this,e,"ag-number-field","number")||this}return t.prototype.postConstruct=function(){var e=this;n.prototype.postConstruct.call(this),this.addManagedListener(this.eInput,"blur",function(){var r=parseFloat(e.eInput.value),o=isNaN(r)?"":e.normalizeValue(r.toString());e.value!==o&&e.setValue(o)}),this.addManagedListener(this.eInput,"wheel",this.onWheel.bind(this)),this.eInput.step="any"},t.prototype.onWheel=function(e){document.activeElement===this.eInput&&e.preventDefault()},t.prototype.normalizeValue=function(e){if(e==="")return"";this.precision!=null&&(e=this.adjustPrecision(e));var r=parseFloat(e);return this.min!=null&&r<this.min?e=this.min.toString():this.max!=null&&r>this.max&&(e=this.max.toString()),e},t.prototype.adjustPrecision=function(e,r){if(this.precision==null)return e;if(r){var o=parseFloat(e).toFixed(this.precision);return parseFloat(o).toString()}var s=String(e).split(".");if(s.length>1){if(s[1].length<=this.precision)return e;if(this.precision>0)return s[0]+"."+s[1].slice(0,this.precision)}return s[0]},t.prototype.setMin=function(e){return this.min===e?this:(this.min=e,addOrRemoveAttribute(this.eInput,"min",e),this)},t.prototype.setMax=function(e){return this.max===e?this:(this.max=e,addOrRemoveAttribute(this.eInput,"max",e),this)},t.prototype.setPrecision=function(e){return this.precision=e,this},t.prototype.setStep=function(e){return this.step===e?this:(this.step=e,addOrRemoveAttribute(this.eInput,"step",e),this)},t.prototype.setValue=function(e,r){var o=this;return this.setValueOrInputValue(function(s){return n.prototype.setValue.call(o,s,r)},function(){return o},e)},t.prototype.setStartValue=function(e){var r=this;return this.setValueOrInputValue(function(o){return n.prototype.setValue.call(r,o,!0)},function(o){r.eInput.value=o},e)},t.prototype.setValueOrInputValue=function(e,r,o){if(exists(o)){var s=this.isScientificNotation(o);if(s&&this.eInput.validity.valid)return e(o);if(!s){o=this.adjustPrecision(o);var l=this.normalizeValue(o);s=o!=l}if(s)return r(o)}return e(o)},t.prototype.getValue=function(){if(this.eInput.validity.valid){var e=this.eInput.value;return this.isScientificNotation(e)?this.adjustPrecision(e,!0):n.prototype.getValue.call(this)}},t.prototype.isScientificNotation=function(e){return typeof e=="string"&&e.includes("e")},t}(AgInputTextField),__extends$2z=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),NumberFilterModelFormatter=function(n){__extends$2z(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.conditionToString=function(e,r){var o=(r||{}).numberOfInputs,s=e.type==SimpleFilter.IN_RANGE||o===2;return s?e.filter+"-"+e.filterTo:e.filter!=null?""+e.filter:""+e.type},t}(SimpleFilterModelFormatter);function getAllowedCharPattern(n){var t=(n??{}).allowedCharPattern;return t??null}var NumberFilter=function(n){__extends$2z(t,n);function t(){var e=n.call(this,"numberFilter")||this;return e.eValuesFrom=[],e.eValuesTo=[],e}return t.prototype.mapValuesFromModel=function(e){var r=e||{},o=r.filter,s=r.filterTo,l=r.type;return[this.processValue(o),this.processValue(s)].slice(0,this.getNumberOfInputs(l))},t.prototype.getDefaultDebounceMs=function(){return 500},t.prototype.comparator=function(){return function(e,r){return e===r?0:e<r?1:-1}},t.prototype.setParams=function(e){this.numberFilterParams=e,n.prototype.setParams.call(this,e),this.filterModelFormatter=new NumberFilterModelFormatter(this.localeService,this.optionsFactory)},t.prototype.getDefaultFilterOptions=function(){return t.DEFAULT_FILTER_OPTIONS},t.prototype.createValueElement=function(){var e=getAllowedCharPattern(this.numberFilterParams),r=document.createElement("div");return r.classList.add("ag-filter-body"),setAriaRole(r,"presentation"),this.createFromToElement(r,this.eValuesFrom,"from",e),this.createFromToElement(r,this.eValuesTo,"to",e),r},t.prototype.createFromToElement=function(e,r,o,s){var l=this.createManagedBean(s?new AgInputTextField({allowedCharPattern:s}):new AgInputNumberField);l.addCssClass("ag-filter-"+o),l.addCssClass("ag-filter-filter"),r.push(l),e.appendChild(l.getGui())},t.prototype.removeValueElements=function(e,r){this.removeComponents(this.eValuesFrom,e,r),this.removeComponents(this.eValuesTo,e,r)},t.prototype.getValues=function(e){var r=this,o=[];return this.forEachPositionInput(e,function(s,l,a,h){l<h&&o.push(r.processValue(r.stringToFloat(s.getValue())))}),o},t.prototype.areSimpleModelsEqual=function(e,r){return e.filter===r.filter&&e.filterTo===r.filterTo&&e.type===r.type},t.prototype.getFilterType=function(){return"number"},t.prototype.processValue=function(e){return e==null||isNaN(e)?null:e},t.prototype.stringToFloat=function(e){if(typeof e=="number")return e;var r=makeNull(e);return r!=null&&r.trim()===""&&(r=null),this.numberFilterParams.numberParser?this.numberFilterParams.numberParser(r):r==null||r.trim()==="-"?null:parseFloat(r)},t.prototype.createCondition=function(e){var r=this.getConditionType(e),o={filterType:this.getFilterType(),type:r},s=this.getValues(e);return s.length>0&&(o.filter=s[0]),s.length>1&&(o.filterTo=s[1]),o},t.prototype.getInputs=function(e){return e>=this.eValuesFrom.length?[null,null]:[this.eValuesFrom[e],this.eValuesTo[e]]},t.prototype.getModelAsString=function(e){var r;return(r=this.filterModelFormatter.getModelAsString(e))!==null&&r!==void 0?r:""},t.prototype.hasInvalidInputs=function(){var e=!1;return this.forEachInput(function(r){if(!r.getInputElement().validity.valid){e=!0;return}}),e},t.DEFAULT_FILTER_OPTIONS=[ScalarFilter.EQUALS,ScalarFilter.NOT_EQUAL,ScalarFilter.LESS_THAN,ScalarFilter.LESS_THAN_OR_EQUAL,ScalarFilter.GREATER_THAN,ScalarFilter.GREATER_THAN_OR_EQUAL,ScalarFilter.IN_RANGE,ScalarFilter.BLANK,ScalarFilter.NOT_BLANK],t}(ScalarFilter),__extends$2y=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__assign$g=function(){return __assign$g=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},__assign$g.apply(this,arguments)},TextFilterModelFormatter=function(n){__extends$2y(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.conditionToString=function(e,r){var o=(r||{}).numberOfInputs,s=e.type==SimpleFilter.IN_RANGE||o===2;return s?e.filter+"-"+e.filterTo:e.filter!=null?""+e.filter:""+e.type},t}(SimpleFilterModelFormatter),TextFilter=function(n){__extends$2y(t,n);function t(){var e=n.call(this,"textFilter")||this;return e.eValuesFrom=[],e.eValuesTo=[],e}return t.trimInput=function(e){var r=e&&e.trim();return r===""?e:r},t.prototype.getDefaultDebounceMs=function(){return 500},t.prototype.setParams=function(e){this.textFilterParams=e,n.prototype.setParams.call(this,e),this.matcher=this.getTextMatcher(),this.formatter=this.textFilterParams.textFormatter||(this.textFilterParams.caseSensitive?t.DEFAULT_FORMATTER:t.DEFAULT_LOWERCASE_FORMATTER),this.filterModelFormatter=new TextFilterModelFormatter(this.localeService,this.optionsFactory)},t.prototype.getTextMatcher=function(){var e=this.textFilterParams.textCustomComparator;return e?(_.doOnce(function(){return console.warn("AG Grid - textCustomComparator is deprecated, use textMatcher instead.")},"textCustomComparator.deprecated"),function(r){var o=r.filterOption,s=r.value,l=r.filterText;return e(o,s,l)}):this.textFilterParams.textMatcher||t.DEFAULT_MATCHER},t.prototype.createCondition=function(e){var r=this.getConditionType(e),o={filterType:this.getFilterType(),type:r},s=this.getValues(e);return s.length>0&&(o.filter=s[0]),s.length>1&&(o.filterTo=s[1]),o},t.prototype.getFilterType=function(){return"text"},t.prototype.areSimpleModelsEqual=function(e,r){return e.filter===r.filter&&e.filterTo===r.filterTo&&e.type===r.type},t.prototype.getInputs=function(e){return e>=this.eValuesFrom.length?[null,null]:[this.eValuesFrom[e],this.eValuesTo[e]]},t.prototype.getValues=function(e){var r=this,o=[];return this.forEachPositionInput(e,function(s,l,a,h){if(l<h){var y=makeNull(s.getValue()),C=(r.textFilterParams.trimInput?t.trimInput(y):y)||null;o.push(C),s.setValue(C,!0)}}),o},t.prototype.getDefaultFilterOptions=function(){return t.DEFAULT_FILTER_OPTIONS},t.prototype.createValueElement=function(){var e=document.createElement("div");return e.classList.add("ag-filter-body"),setAriaRole(e,"presentation"),this.createFromToElement(e,this.eValuesFrom,"from"),this.createFromToElement(e,this.eValuesTo,"to"),e},t.prototype.createFromToElement=function(e,r,o){var s=this.createManagedBean(new AgInputTextField);s.addCssClass("ag-filter-"+o),s.addCssClass("ag-filter-filter"),r.push(s),e.appendChild(s.getGui())},t.prototype.removeValueElements=function(e,r){this.removeComponents(this.eValuesFrom,e,r),this.removeComponents(this.eValuesTo,e,r)},t.prototype.mapValuesFromModel=function(e){var r=e||{},o=r.filter,s=r.filterTo,l=r.type;return[o||null,s||null].slice(0,this.getNumberOfInputs(l))},t.prototype.evaluateNullValue=function(e){var r=[SimpleFilter.NOT_EQUAL,SimpleFilter.NOT_CONTAINS,SimpleFilter.BLANK];return e?r.indexOf(e)>=0:!1},t.prototype.evaluateNonNullValue=function(e,r,o,s){var l=this,a=e.map(function(yi){return l.formatter(yi)})||[],h=this.formatter(r),y=this.textFilterParams,C=y.api,L=y.colDef,Y=y.column,ze=y.columnApi,Bt=y.context,Ir=y.textFormatter;if(o.type===SimpleFilter.BLANK)return this.isBlank(r);if(o.type===SimpleFilter.NOT_BLANK)return!this.isBlank(r);var Wr={api:C,colDef:L,column:Y,columnApi:ze,context:Bt,node:s.node,data:s.data,filterOption:o.type,value:h,textFormatter:Ir};return a.some(function(yi){return l.matcher(__assign$g(__assign$g({},Wr),{filterText:yi}))})},t.prototype.getModelAsString=function(e){var r;return(r=this.filterModelFormatter.getModelAsString(e))!==null&&r!==void 0?r:""},t.DEFAULT_FILTER_OPTIONS=[SimpleFilter.CONTAINS,SimpleFilter.NOT_CONTAINS,SimpleFilter.EQUALS,SimpleFilter.NOT_EQUAL,SimpleFilter.STARTS_WITH,SimpleFilter.ENDS_WITH,SimpleFilter.BLANK,SimpleFilter.NOT_BLANK],t.DEFAULT_FORMATTER=function(e){return e},t.DEFAULT_LOWERCASE_FORMATTER=function(e){return e==null?null:e.toString().toLowerCase()},t.DEFAULT_MATCHER=function(e){var r=e.filterOption,o=e.value,s=e.filterText;if(s==null)return!1;switch(r){case t.CONTAINS:return o.indexOf(s)>=0;case t.NOT_CONTAINS:return o.indexOf(s)<0;case t.EQUALS:return o===s;case t.NOT_EQUAL:return o!=s;case t.STARTS_WITH:return o.indexOf(s)===0;case t.ENDS_WITH:var l=o.lastIndexOf(s);return l>=0&&l===o.length-s.length;default:return!1}},t}(SimpleFilter),__extends$2x=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$2e=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},FloatingFilterTextInputService=function(n){__extends$2x(t,n);function t(e){var r=n.call(this)||this;return r.params=e,r}return t.prototype.setupGui=function(e){this.eFloatingFilterTextInput=this.createManagedBean(new AgInputTextField(this.params.config)),this.eFloatingFilterTextInput.setInputAriaLabel(this.params.ariaLabel),e.appendChild(this.eFloatingFilterTextInput.getGui())},t.prototype.setEditable=function(e){this.eFloatingFilterTextInput.setDisabled(!e)},t.prototype.getValue=function(){return this.eFloatingFilterTextInput.getValue()},t.prototype.setValue=function(e,r){this.eFloatingFilterTextInput.setValue(e,r)},t.prototype.addValueChangedListener=function(e){var r=this.eFloatingFilterTextInput.getGui();this.addManagedListener(r,"input",e),this.addManagedListener(r,"keydown",e)},t}(BeanStub),TextInputFloatingFilter=function(n){__extends$2x(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.postConstruct=function(){this.setTemplate(`
            <div class="ag-floating-filter-input" role="presentation" ref="eFloatingFilterInputContainer"></div>
        `)},t.prototype.getDefaultDebounceMs=function(){return 500},t.prototype.onParentModelChanged=function(e,r){this.isEventFromFloatingFilter(r)||this.isEventFromDataChange(r)||(this.setLastTypeFromModel(e),this.setEditable(this.canWeEditAfterModelFromParentFilter(e)),this.floatingFilterInputService.setValue(this.getFilterModelFormatter().getModelAsString(e)))},t.prototype.init=function(e){this.params=e;var r=this.columnModel.getDisplayNameForColumn(e.column,"header",!0),o=this.localeService.getLocaleTextFunc(),s=r+" "+o("ariaFilterInput","Filter Input");if(this.floatingFilterInputService=this.createFloatingFilterInputService(s),this.floatingFilterInputService.setupGui(this.eFloatingFilterInputContainer),n.prototype.init.call(this,e),this.applyActive=ProvidedFilter.isUseApplyButton(this.params.filterParams),!this.isReadOnly()){var l=ProvidedFilter.getDebounceMs(this.params.filterParams,this.getDefaultDebounceMs()),a=debounce(this.syncUpWithParentFilter.bind(this),l);this.floatingFilterInputService.addValueChangedListener(a)}},t.prototype.syncUpWithParentFilter=function(e){var r=this,o=e.key===KeyCode.ENTER;if(!(this.applyActive&&!o)){var s=this.floatingFilterInputService.getValue();this.params.filterParams.trimInput&&(s=TextFilter.trimInput(s),this.floatingFilterInputService.setValue(s,!0)),this.params.parentFilterInstance(function(l){l&&l.onFloatingFilterChanged(r.getLastType()||null,s||null)})}},t.prototype.setEditable=function(e){this.floatingFilterInputService.setEditable(e)},__decorate$2e([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$2e([RefSelector("eFloatingFilterInputContainer")],t.prototype,"eFloatingFilterInputContainer",void 0),__decorate$2e([PostConstruct],t.prototype,"postConstruct",null),t}(SimpleFloatingFilter),__extends$2w=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),FloatingFilterNumberInputService=function(n){__extends$2w(t,n);function t(e){var r=n.call(this)||this;return r.params=e,r.numberInputActive=!0,r}return t.prototype.setupGui=function(e){this.eFloatingFilterNumberInput=this.createManagedBean(new AgInputNumberField),this.eFloatingFilterTextInput=this.createManagedBean(new AgInputTextField),this.eFloatingFilterTextInput.setDisabled(!0),this.eFloatingFilterNumberInput.setInputAriaLabel(this.params.ariaLabel),this.eFloatingFilterTextInput.setInputAriaLabel(this.params.ariaLabel),e.appendChild(this.eFloatingFilterNumberInput.getGui()),e.appendChild(this.eFloatingFilterTextInput.getGui())},t.prototype.setEditable=function(e){this.numberInputActive=e,this.eFloatingFilterNumberInput.setDisplayed(this.numberInputActive),this.eFloatingFilterTextInput.setDisplayed(!this.numberInputActive)},t.prototype.getValue=function(){return this.getActiveInputElement().getValue()},t.prototype.setValue=function(e,r){this.getActiveInputElement().setValue(e,r)},t.prototype.getActiveInputElement=function(){return this.numberInputActive?this.eFloatingFilterNumberInput:this.eFloatingFilterTextInput},t.prototype.addValueChangedListener=function(e){this.setupListeners(this.eFloatingFilterNumberInput.getGui(),e),this.setupListeners(this.eFloatingFilterTextInput.getGui(),e)},t.prototype.setupListeners=function(e,r){this.addManagedListener(e,"input",r),this.addManagedListener(e,"keydown",r)},t}(BeanStub),NumberFloatingFilter=function(n){__extends$2w(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.init=function(e){n.prototype.init.call(this,e),this.filterModelFormatter=new NumberFilterModelFormatter(this.localeService,this.optionsFactory)},t.prototype.getDefaultFilterOptions=function(){return NumberFilter.DEFAULT_FILTER_OPTIONS},t.prototype.getFilterModelFormatter=function(){return this.filterModelFormatter},t.prototype.createFloatingFilterInputService=function(e){var r=getAllowedCharPattern(this.params.filterParams);return r?this.createManagedBean(new FloatingFilterTextInputService({config:{allowedCharPattern:r},ariaLabel:e})):this.createManagedBean(new FloatingFilterNumberInputService({ariaLabel:e}))},t}(TextInputFloatingFilter),__extends$2v=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),TextFloatingFilter=function(n){__extends$2v(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.init=function(e){n.prototype.init.call(this,e),this.filterModelFormatter=new TextFilterModelFormatter(this.localeService,this.optionsFactory)},t.prototype.getDefaultFilterOptions=function(){return TextFilter.DEFAULT_FILTER_OPTIONS},t.prototype.getFilterModelFormatter=function(){return this.filterModelFormatter},t.prototype.createFloatingFilterInputService=function(e){return this.createManagedBean(new FloatingFilterTextInputService({ariaLabel:e}))},t}(TextInputFloatingFilter),TouchListener=function(){function n(t,e){var r=this;e===void 0&&(e=!1),this.destroyFuncs=[],this.touching=!1,this.eventService=new EventService,this.eElement=t,this.preventMouseClick=e;var o=this.onTouchStart.bind(this),s=this.onTouchMove.bind(this),l=this.onTouchEnd.bind(this);this.eElement.addEventListener("touchstart",o,{passive:!0}),this.eElement.addEventListener("touchmove",s,{passive:!0}),this.eElement.addEventListener("touchend",l,{passive:!1}),this.destroyFuncs.push(function(){r.eElement.removeEventListener("touchstart",o,{passive:!0}),r.eElement.removeEventListener("touchmove",s,{passive:!0}),r.eElement.removeEventListener("touchend",l,{passive:!1})})}return n.prototype.getActiveTouch=function(t){for(var e=0;e<t.length;e++){var r=t[e].identifier===this.touchStart.identifier;if(r)return t[e]}return null},n.prototype.addEventListener=function(t,e){this.eventService.addEventListener(t,e)},n.prototype.removeEventListener=function(t,e){this.eventService.removeEventListener(t,e)},n.prototype.onTouchStart=function(t){var e=this;if(!this.touching){this.touchStart=t.touches[0],this.touching=!0,this.moved=!1;var r=this.touchStart;window.setTimeout(function(){var o=e.touchStart===r;if(e.touching&&o&&!e.moved){e.moved=!0;var s={type:n.EVENT_LONG_TAP,touchStart:e.touchStart,touchEvent:t};e.eventService.dispatchEvent(s)}},500)}},n.prototype.onTouchMove=function(t){if(this.touching){var e=this.getActiveTouch(t.touches);if(e){var r=!areEventsNear(e,this.touchStart,4);r&&(this.moved=!0)}}},n.prototype.onTouchEnd=function(t){if(this.touching){if(!this.moved){var e={type:n.EVENT_TAP,touchStart:this.touchStart};this.eventService.dispatchEvent(e),this.checkForDoubleTap()}this.preventMouseClick&&t.cancelable&&t.preventDefault(),this.touching=!1}},n.prototype.checkForDoubleTap=function(){var t=new Date().getTime();if(this.lastTapTime&&this.lastTapTime>0){var e=t-this.lastTapTime;if(e>n.DOUBLE_TAP_MILLIS){var r={type:n.EVENT_DOUBLE_TAP,touchStart:this.touchStart};this.eventService.dispatchEvent(r),this.lastTapTime=null}else this.lastTapTime=t}else this.lastTapTime=t},n.prototype.destroy=function(){this.destroyFuncs.forEach(function(t){return t()})},n.EVENT_TAP="tap",n.EVENT_DOUBLE_TAP="doubleTap",n.EVENT_LONG_TAP="longTap",n.DOUBLE_TAP_MILLIS=500,n}(),__extends$2u=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$2d=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},SortIndicatorComp=function(n){__extends$2u(t,n);function t(e){var r=n.call(this)||this;return e||r.setTemplate(t.TEMPLATE),r}return t.prototype.attachCustomElements=function(e,r,o,s,l){this.eSortOrder=e,this.eSortAsc=r,this.eSortDesc=o,this.eSortMixed=s,this.eSortNone=l},t.prototype.setupSort=function(e,r){var o=this;r===void 0&&(r=!1),this.column=e,this.suppressOrder=r,this.setupMultiSortIndicator();var s=!!this.column.getColDef().sortable;s&&(this.addInIcon("sortAscending",this.eSortAsc,e),this.addInIcon("sortDescending",this.eSortDesc,e),this.addInIcon("sortUnSort",this.eSortNone,e),this.addManagedListener(this.eventService,Events.EVENT_SORT_CHANGED,function(){return o.onSortChanged()}),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_ROW_GROUP_CHANGED,function(){return o.onSortChanged()}),this.onSortChanged())},t.prototype.addInIcon=function(e,r,o){if(r!=null){var s=createIconNoSpan(e,this.gridOptionsService,o);s&&r.appendChild(s)}},t.prototype.onSortChanged=function(){this.updateIcons(),this.suppressOrder||this.updateSortOrder()},t.prototype.updateIcons=function(){var e=this.sortController.getDisplaySortForColumn(this.column);if(this.eSortAsc){var r=e==="asc";setDisplayed(this.eSortAsc,r,{skipAriaHidden:!0})}if(this.eSortDesc){var o=e==="desc";setDisplayed(this.eSortDesc,o,{skipAriaHidden:!0})}if(this.eSortNone){var s=!this.column.getColDef().unSortIcon&&!this.gridOptionsService.is("unSortIcon"),l=e==null;setDisplayed(this.eSortNone,!s&&l,{skipAriaHidden:!0})}},t.prototype.setupMultiSortIndicator=function(){var e=this;this.addInIcon("sortUnSort",this.eSortMixed,this.column);var r=this.column.getColDef().showRowGroup,o=this.gridOptionsService.isColumnsSortingCoupledToGroup();o&&r&&(this.addManagedListener(this.eventService,Events.EVENT_SORT_CHANGED,function(){return e.updateMultiSortIndicator()}),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_ROW_GROUP_CHANGED,function(){return e.updateMultiSortIndicator()}),this.updateMultiSortIndicator())},t.prototype.updateMultiSortIndicator=function(){if(this.eSortMixed){var e=this.sortController.getDisplaySortForColumn(this.column)==="mixed";setDisplayed(this.eSortMixed,e,{skipAriaHidden:!0})}},t.prototype.updateSortOrder=function(){var e=this,r;if(this.eSortOrder){var o=this.sortController.getColumnsWithSortingOrdered(),s=(r=this.sortController.getDisplaySortIndexForColumn(this.column))!==null&&r!==void 0?r:-1,l=o.some(function(h){var y;return(y=e.sortController.getDisplaySortIndexForColumn(h))!==null&&y!==void 0?y:-1>=1}),a=s>=0&&l;setDisplayed(this.eSortOrder,a,{skipAriaHidden:!0}),s>=0?this.eSortOrder.innerHTML=(s+1).toString():clearElement(this.eSortOrder)}},t.TEMPLATE=`<span class="ag-sort-indicator-container">
            <span ref="eSortOrder" class="ag-sort-indicator-icon ag-sort-order ag-hidden" aria-hidden="true"></span>
            <span ref="eSortAsc" class="ag-sort-indicator-icon ag-sort-ascending-icon ag-hidden" aria-hidden="true"></span>
            <span ref="eSortDesc" class="ag-sort-indicator-icon ag-sort-descending-icon ag-hidden" aria-hidden="true"></span>
            <span ref="eSortMixed" class="ag-sort-indicator-icon ag-sort-mixed-icon ag-hidden" aria-hidden="true"></span>
            <span ref="eSortNone" class="ag-sort-indicator-icon ag-sort-none-icon ag-hidden" aria-hidden="true"></span>
        </span>`,__decorate$2d([RefSelector("eSortOrder")],t.prototype,"eSortOrder",void 0),__decorate$2d([RefSelector("eSortAsc")],t.prototype,"eSortAsc",void 0),__decorate$2d([RefSelector("eSortDesc")],t.prototype,"eSortDesc",void 0),__decorate$2d([RefSelector("eSortMixed")],t.prototype,"eSortMixed",void 0),__decorate$2d([RefSelector("eSortNone")],t.prototype,"eSortNone",void 0),__decorate$2d([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$2d([Autowired("sortController")],t.prototype,"sortController",void 0),t}(Component),__extends$2t=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$2c=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},HeaderComp=function(n){__extends$2t(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.lastMovingChanged=0,e}return t.prototype.destroy=function(){n.prototype.destroy.call(this)},t.prototype.refresh=function(e){return this.params=e,this.workOutTemplate()!=this.currentTemplate||this.workOutShowMenu()!=this.currentShowMenu||this.workOutSort()!=this.currentSort?!1:(this.setDisplayName(e),!0)},t.prototype.workOutTemplate=function(){var e=firstExistingValue(this.params.template,t.TEMPLATE);return e=e&&e.trim?e.trim():e,e},t.prototype.init=function(e){this.params=e,this.currentTemplate=this.workOutTemplate(),this.setTemplate(this.currentTemplate),this.setupTap(),this.setupIcons(e.column),this.setMenu(),this.setupSort(),this.setupFilterIcon(),this.setDisplayName(e)},t.prototype.setDisplayName=function(e){if(this.currentDisplayName!=e.displayName){this.currentDisplayName=e.displayName;var r=escapeString(this.currentDisplayName);this.eText&&(this.eText.innerHTML=r)}},t.prototype.setupIcons=function(e){this.addInIcon("menu",this.eMenu,e),this.addInIcon("filter",this.eFilter,e)},t.prototype.addInIcon=function(e,r,o){if(r!=null){var s=createIconNoSpan(e,this.gridOptionsService,o);s&&r.appendChild(s)}},t.prototype.setupTap=function(){var e=this,r=this.gridOptionsService;if(!r.is("suppressTouch")){var o=new TouchListener(this.getGui(),!0),s=r.is("suppressMenuHide"),l=s&&exists(this.eMenu),a=l?new TouchListener(this.eMenu,!0):o;if(this.params.enableMenu){var h=l?"EVENT_TAP":"EVENT_LONG_TAP",y=function(L){r.api.showColumnMenuAfterMouseClick(e.params.column,L.touchStart)};this.addManagedListener(a,TouchListener[h],y)}if(this.params.enableSorting){var C=function(L){var Y=L.touchStart.target;s&&e.eMenu.contains(Y)||e.sortController.progressSort(e.params.column,!1,"uiColumnSorted")};this.addManagedListener(o,TouchListener.EVENT_TAP,C)}this.addDestroyFunc(function(){return o.destroy()}),l&&this.addDestroyFunc(function(){return a.destroy()})}},t.prototype.workOutShowMenu=function(){var e=!this.gridOptionsService.is("suppressMenuHide"),r=isIOSUserAgent()&&e,o=this.params.enableMenu&&!r;return o},t.prototype.setMenu=function(){var e=this;if(this.eMenu){if(this.currentShowMenu=this.workOutShowMenu(),!this.currentShowMenu){removeFromParent(this.eMenu);return}var r=this.gridOptionsService.is("suppressMenuHide");this.addManagedListener(this.eMenu,"click",function(){return e.showMenu(e.eMenu)}),this.eMenu.classList.toggle("ag-header-menu-always-show",r)}},t.prototype.showMenu=function(e){e||(e=this.eMenu),this.menuFactory.showMenuAfterButtonClick(this.params.column,e,"columnMenu")},t.prototype.workOutSort=function(){return this.params.enableSorting},t.prototype.setupSort=function(){var e=this;if(this.currentSort=this.params.enableSorting,this.eSortIndicator||(this.eSortIndicator=this.context.createBean(new SortIndicatorComp(!0)),this.eSortIndicator.attachCustomElements(this.eSortOrder,this.eSortAsc,this.eSortDesc,this.eSortMixed,this.eSortNone)),this.eSortIndicator.setupSort(this.params.column),!!this.currentSort){var r=this.gridOptionsService.get("multiSortKey")==="ctrl";this.addManagedListener(this.params.column,Column.EVENT_MOVING_CHANGED,function(){e.lastMovingChanged=new Date().getTime()}),this.eLabel&&this.addManagedListener(this.eLabel,"click",function(s){var l=e.params.column.isMoving(),a=new Date().getTime(),h=a-e.lastMovingChanged<50,y=l||h;if(!y){var C=r?s.ctrlKey||s.metaKey:s.shiftKey;e.params.progressSort(C)}});var o=function(){if(e.addOrRemoveCssClass("ag-header-cell-sorted-asc",e.params.column.isSortAscending()),e.addOrRemoveCssClass("ag-header-cell-sorted-desc",e.params.column.isSortDescending()),e.addOrRemoveCssClass("ag-header-cell-sorted-none",e.params.column.isSortNone()),e.params.column.getColDef().showRowGroup){var s=e.columnModel.getSourceColumnsForGroupColumn(e.params.column),l=s==null?void 0:s.every(function(h){return e.params.column.getSort()==h.getSort()}),a=!l;e.addOrRemoveCssClass("ag-header-cell-sorted-mixed",a)}};this.addManagedListener(this.eventService,Events.EVENT_SORT_CHANGED,o),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_ROW_GROUP_CHANGED,o)}},t.prototype.setupFilterIcon=function(){this.eFilter&&(this.addManagedListener(this.params.column,Column.EVENT_FILTER_CHANGED,this.onFilterChanged.bind(this)),this.onFilterChanged())},t.prototype.onFilterChanged=function(){var e=this.params.column.isFilterActive();setDisplayed(this.eFilter,e,{skipAriaHidden:!0})},t.TEMPLATE=`<div class="ag-cell-label-container" role="presentation">
            <span ref="eMenu" class="ag-header-icon ag-header-cell-menu-button" aria-hidden="true"></span>
            <div ref="eLabel" class="ag-header-cell-label" role="presentation">
                <span ref="eText" class="ag-header-cell-text"></span>
                <span ref="eFilter" class="ag-header-icon ag-header-label-icon ag-filter-icon" aria-hidden="true"></span>
                <ag-sort-indicator ref="eSortIndicator"></ag-sort-indicator>
            </div>
        </div>`,__decorate$2c([Autowired("sortController")],t.prototype,"sortController",void 0),__decorate$2c([Autowired("menuFactory")],t.prototype,"menuFactory",void 0),__decorate$2c([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$2c([RefSelector("eFilter")],t.prototype,"eFilter",void 0),__decorate$2c([RefSelector("eSortIndicator")],t.prototype,"eSortIndicator",void 0),__decorate$2c([RefSelector("eMenu")],t.prototype,"eMenu",void 0),__decorate$2c([RefSelector("eLabel")],t.prototype,"eLabel",void 0),__decorate$2c([RefSelector("eText")],t.prototype,"eText",void 0),__decorate$2c([RefSelector("eSortOrder")],t.prototype,"eSortOrder",void 0),__decorate$2c([RefSelector("eSortAsc")],t.prototype,"eSortAsc",void 0),__decorate$2c([RefSelector("eSortDesc")],t.prototype,"eSortDesc",void 0),__decorate$2c([RefSelector("eSortMixed")],t.prototype,"eSortMixed",void 0),__decorate$2c([RefSelector("eSortNone")],t.prototype,"eSortNone",void 0),t}(Component),__extends$2s=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$2b=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},HeaderGroupComp=function(n){__extends$2s(t,n);function t(){return n.call(this,t.TEMPLATE)||this}return t.prototype.destroy=function(){n.prototype.destroy.call(this)},t.prototype.init=function(e){this.params=e,this.checkWarnings(),this.setupLabel(),this.addGroupExpandIcon(),this.setupExpandIcons()},t.prototype.checkWarnings=function(){var e=this.params;if(e.template){var r="AG Grid: A template was provided for Header Group Comp - templates are only supported for Header Comps (not groups)";doOnce(function(){return console.warn(r)},"HeaderGroupComp.templateNotSupported")}},t.prototype.setupExpandIcons=function(){var e=this;this.addInIcon("columnGroupOpened","agOpened"),this.addInIcon("columnGroupClosed","agClosed");var r=function(l){if(!isStopPropagationForAgGrid(l)){var a=!e.params.columnGroup.isExpanded();e.columnModel.setColumnGroupOpened(e.params.columnGroup.getProvidedColumnGroup(),a,"uiColumnExpanded")}};this.addTouchAndClickListeners(this.eCloseIcon,r),this.addTouchAndClickListeners(this.eOpenIcon,r);var o=function(l){stopPropagationForAgGrid(l)};this.addManagedListener(this.eCloseIcon,"dblclick",o),this.addManagedListener(this.eOpenIcon,"dblclick",o),this.addManagedListener(this.getGui(),"dblclick",r),this.updateIconVisibility();var s=this.params.columnGroup.getProvidedColumnGroup();this.addManagedListener(s,ProvidedColumnGroup.EVENT_EXPANDED_CHANGED,this.updateIconVisibility.bind(this)),this.addManagedListener(s,ProvidedColumnGroup.EVENT_EXPANDABLE_CHANGED,this.updateIconVisibility.bind(this))},t.prototype.addTouchAndClickListeners=function(e,r){var o=new TouchListener(e,!0);this.addManagedListener(o,TouchListener.EVENT_TAP,r),this.addDestroyFunc(function(){return o.destroy()}),this.addManagedListener(e,"click",r)},t.prototype.updateIconVisibility=function(){var e=this.params.columnGroup;if(e.isExpandable()){var r=this.params.columnGroup.isExpanded();setDisplayed(this.eOpenIcon,r),setDisplayed(this.eCloseIcon,!r)}else setDisplayed(this.eOpenIcon,!1),setDisplayed(this.eCloseIcon,!1)},t.prototype.addInIcon=function(e,r){var o=createIconNoSpan(e,this.gridOptionsService,null);o&&this.getRefElement(r).appendChild(o)},t.prototype.addGroupExpandIcon=function(){if(!this.params.columnGroup.isExpandable()){setDisplayed(this.eOpenIcon,!1),setDisplayed(this.eCloseIcon,!1);return}},t.prototype.setupLabel=function(){var e,r=this.params,o=r.displayName,s=r.columnGroup;if(exists(o)){var l=escapeString(o);this.getRefElement("agLabel").innerHTML=l}this.addOrRemoveCssClass("ag-sticky-label",!(!((e=s.getColGroupDef())===null||e===void 0)&&e.suppressStickyLabel))},t.TEMPLATE=`<div class="ag-header-group-cell-label" ref="agContainer" role="presentation">
            <span ref="agLabel" class="ag-header-group-text" role="presentation"></span>
            <span ref="agOpened" class="ag-header-icon ag-header-expand-icon ag-header-expand-icon-expanded"></span>
            <span ref="agClosed" class="ag-header-icon ag-header-expand-icon ag-header-expand-icon-collapsed"></span>
        </div>`,__decorate$2b([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$2b([RefSelector("agOpened")],t.prototype,"eOpenIcon",void 0),__decorate$2b([RefSelector("agClosed")],t.prototype,"eCloseIcon",void 0),t}(Component),__extends$2r=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),PopupComponent=function(n){__extends$2r(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.isPopup=function(){return!0},t.prototype.setParentComponent=function(e){e.addCssClass("ag-has-popup"),n.prototype.setParentComponent.call(this,e)},t.prototype.destroy=function(){var e=this.parentComponent,r=e&&e.isAlive();r&&e.getGui().classList.remove("ag-has-popup"),n.prototype.destroy.call(this)},t}(Component),__extends$2q=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$2a=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},LargeTextCellEditor=function(n){__extends$2q(t,n);function t(){return n.call(this,t.TEMPLATE)||this}return t.prototype.init=function(e){this.params=e,this.focusAfterAttached=e.cellStartedEdit,this.eTextArea.setMaxLength(e.maxLength||200).setCols(e.cols||60).setRows(e.rows||10),exists(e.value,!0)&&this.eTextArea.setValue(e.value.toString(),!0),this.addGuiEventListener("keydown",this.onKeyDown.bind(this)),this.activateTabIndex()},t.prototype.onKeyDown=function(e){var r=e.key;(r===KeyCode.LEFT||r===KeyCode.UP||r===KeyCode.RIGHT||r===KeyCode.DOWN||e.shiftKey&&r===KeyCode.ENTER)&&e.stopPropagation()},t.prototype.afterGuiAttached=function(){var e=this.localeService.getLocaleTextFunc();this.eTextArea.setInputAriaLabel(e("ariaInputEditor","Input Editor")),this.focusAfterAttached&&this.eTextArea.getFocusableElement().focus()},t.prototype.getValue=function(){var e=this.eTextArea.getValue();return!exists(e)&&!exists(this.params.value)?this.params.value:this.params.parseValue(e)},t.TEMPLATE=`<div class="ag-large-text">
            <ag-input-text-area ref="eTextArea" class="ag-large-text-input"></ag-input-text-area>
        </div>`,__decorate$2a([RefSelector("eTextArea")],t.prototype,"eTextArea",void 0),t}(PopupComponent),__extends$2p=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$29=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},SelectCellEditor=function(n){__extends$2p(t,n);function t(){var e=n.call(this,'<div class="ag-cell-edit-wrapper"><ag-select class="ag-cell-editor" ref="eSelect"></ag-select></div>')||this;return e.startedByEnter=!1,e}return t.prototype.init=function(e){var r=this;if(this.focusAfterAttached=e.cellStartedEdit,missing(e.values)){console.warn("AG Grid: no values found for select cellEditor");return}this.startedByEnter=e.eventKey!=null?e.eventKey===KeyCode.ENTER:!1;var o=!1;e.values.forEach(function(s){var l={value:s},a=r.valueFormatterService.formatValue(e.column,null,s),h=a!=null;l.text=h?a:s,r.eSelect.addOption(l),o=o||e.value===s}),o?this.eSelect.setValue(e.value,!0):e.values.length&&this.eSelect.setValue(e.values[0],!0),this.gridOptionsService.get("editType")!=="fullRow"&&this.addManagedListener(this.eSelect,AgSelect.EVENT_ITEM_SELECTED,function(){return e.stopEditing()})},t.prototype.afterGuiAttached=function(){this.focusAfterAttached&&this.eSelect.getFocusableElement().focus(),this.startedByEnter&&this.eSelect.showPicker()},t.prototype.focusIn=function(){this.eSelect.getFocusableElement().focus()},t.prototype.getValue=function(){return this.eSelect.getValue()},t.prototype.isPopup=function(){return!1},__decorate$29([Autowired("valueFormatterService")],t.prototype,"valueFormatterService",void 0),__decorate$29([RefSelector("eSelect")],t.prototype,"eSelect",void 0),t}(PopupComponent),__extends$2o=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$28=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},SimpleCellEditor=function(n){__extends$2o(t,n);function t(e){var r=n.call(this,`
            <div class="ag-cell-edit-wrapper">
                `+e.getTemplate()+`
            </div>`)||this;return r.cellEditorInput=e,r}return t.prototype.init=function(e){this.params=e;var r=this.eInput;this.cellEditorInput.init(r,e);var o;if(e.cellStartedEdit){this.focusAfterAttached=!0;var s=e.eventKey;s===KeyCode.BACKSPACE||e.eventKey===KeyCode.DELETE?o="":s&&s.length===1?o=s:(o=this.cellEditorInput.getStartValue(),s!==KeyCode.F2&&(this.highlightAllOnFocus=!0))}else this.focusAfterAttached=!1,o=this.cellEditorInput.getStartValue();o!=null&&r.setStartValue(o),this.addManagedListener(r.getGui(),"keydown",function(l){var a=l.key;(a===KeyCode.PAGE_UP||a===KeyCode.PAGE_DOWN)&&l.preventDefault()})},t.prototype.afterGuiAttached=function(){var e,r,o=this.localeService.getLocaleTextFunc(),s=this.eInput;if(s.setInputAriaLabel(o("ariaInputEditor","Input Editor")),!!this.focusAfterAttached){isBrowserSafari()||s.getFocusableElement().focus();var l=s.getInputElement();this.highlightAllOnFocus?l.select():(r=(e=this.cellEditorInput).setCaret)===null||r===void 0||r.call(e)}},t.prototype.focusIn=function(){var e=this.eInput,r=e.getFocusableElement(),o=e.getInputElement();r.focus(),o.select()},t.prototype.getValue=function(){return this.cellEditorInput.getValue()},t.prototype.isPopup=function(){return!1},__decorate$28([RefSelector("eInput")],t.prototype,"eInput",void 0),t}(PopupComponent),__extends$2n=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),TextCellEditorInput=function(){function n(){}return n.prototype.getTemplate=function(){return'<ag-input-text-field class="ag-cell-editor" ref="eInput"></ag-input-text-field>'},n.prototype.init=function(t,e){this.eInput=t,this.params=e,e.maxLength!=null&&t.setMaxLength(e.maxLength)},n.prototype.getValue=function(){var t=this.eInput.getValue();return!exists(t)&&!exists(this.params.value)?this.params.value:this.params.parseValue(t)},n.prototype.getStartValue=function(){var t=this.params.useFormatter||this.params.column.getColDef().refData;return t?this.params.formatValue(this.params.value):this.params.value},n.prototype.setCaret=function(){var t=this.eInput.getValue(),e=exists(t)&&t.length||0;e&&this.eInput.getInputElement().setSelectionRange(e,e)},n}(),TextCellEditor=function(n){__extends$2n(t,n);function t(){return n.call(this,new TextCellEditorInput)||this}return t}(SimpleCellEditor),__extends$2m=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$27=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},ARROW_UP="↑",ARROW_DOWN="↓",AnimateShowChangeCellRenderer=function(n){__extends$2m(t,n);function t(){var e=n.call(this,t.TEMPLATE)||this;return e.refreshCount=0,e}return t.prototype.init=function(e){this.eValue=this.queryForHtmlElement(".ag-value-change-value"),this.eDelta=this.queryForHtmlElement(".ag-value-change-delta"),this.refresh(e)},t.prototype.showDelta=function(e,r){var o=Math.abs(r),s=e.formatValue(o),l=exists(s)?s:o,a=r>=0;a?this.eDelta.innerHTML=ARROW_UP+l:this.eDelta.innerHTML=ARROW_DOWN+l,this.eDelta.classList.toggle("ag-value-change-delta-up",a),this.eDelta.classList.toggle("ag-value-change-delta-down",!a)},t.prototype.setTimerToRemoveDelta=function(){var e=this;this.refreshCount++;var r=this.refreshCount;window.setTimeout(function(){r===e.refreshCount&&e.hideDeltaValue()},2e3)},t.prototype.hideDeltaValue=function(){this.eValue.classList.remove("ag-value-change-value-highlight"),clearElement(this.eDelta)},t.prototype.refresh=function(e){var r=e.value;if(r===this.lastValue||(exists(e.valueFormatted)?this.eValue.innerHTML=e.valueFormatted:exists(e.value)?this.eValue.innerHTML=r:clearElement(this.eValue),this.filterManager.isSuppressFlashingCellsBecauseFiltering()))return!1;if(typeof r=="number"&&typeof this.lastValue=="number"){var o=r-this.lastValue;this.showDelta(e,o)}return this.lastValue&&this.eValue.classList.add("ag-value-change-value-highlight"),this.setTimerToRemoveDelta(),this.lastValue=r,!0},t.TEMPLATE='<span><span class="ag-value-change-delta"></span><span class="ag-value-change-value"></span></span>',__decorate$27([Autowired("filterManager")],t.prototype,"filterManager",void 0),t}(Component),__extends$2l=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$26=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},AnimateSlideCellRenderer=function(n){__extends$2l(t,n);function t(){var e=n.call(this,t.TEMPLATE)||this;return e.refreshCount=0,e.eCurrent=e.queryForHtmlElement(".ag-value-slide-current"),e}return t.prototype.init=function(e){this.refresh(e)},t.prototype.addSlideAnimation=function(){var e=this;this.refreshCount++;var r=this.refreshCount;this.ePrevious&&this.getGui().removeChild(this.ePrevious),this.ePrevious=loadTemplate('<span class="ag-value-slide-previous ag-value-slide-out"></span>'),this.ePrevious.innerHTML=this.eCurrent.innerHTML,this.getGui().insertBefore(this.ePrevious,this.eCurrent),window.setTimeout(function(){r===e.refreshCount&&e.ePrevious.classList.add("ag-value-slide-out-end")},50),window.setTimeout(function(){r===e.refreshCount&&(e.getGui().removeChild(e.ePrevious),e.ePrevious=null)},3e3)},t.prototype.refresh=function(e){var r=e.value;return missing(r)&&(r=""),r===this.lastValue||this.filterManager.isSuppressFlashingCellsBecauseFiltering()?!1:(this.addSlideAnimation(),this.lastValue=r,exists(e.valueFormatted)?this.eCurrent.innerHTML=e.valueFormatted:exists(e.value)?this.eCurrent.innerHTML=r:clearElement(this.eCurrent),!0)},t.TEMPLATE=`<span>
            <span class="ag-value-slide-current"></span>
        </span>`,__decorate$26([Autowired("filterManager")],t.prototype,"filterManager",void 0),t}(Component),__assign$f=function(){return __assign$f=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},__assign$f.apply(this,arguments)},RowNode=function(){function n(t){this.rowIndex=null,this.key=null,this.childrenMapped={},this.displayed=!1,this.rowTop=null,this.oldRowTop=null,this.selectable=!0,this.__objectId=n.OBJECT_ID_SEQUENCE++,this.__autoHeights={},this.alreadyRendered=!1,this.highlighted=null,this.hovered=!1,this.selected=!1,this.beans=t}return n.prototype.setData=function(t){this.setDataCommon(t,!1)},n.prototype.updateData=function(t){this.setDataCommon(t,!0)},n.prototype.setDataCommon=function(t,e){var r=this.data;this.data=t,this.beans.valueCache.onDataChanged(),this.updateDataOnDetailNode(),this.checkRowSelectable(),this.resetQuickFilterAggregateText();var o=this.createDataChangedEvent(t,r,e);this.dispatchLocalEvent(o)},n.prototype.updateDataOnDetailNode=function(){this.detailNode&&(this.detailNode.data=this.data)},n.prototype.createDataChangedEvent=function(t,e,r){return{type:n.EVENT_DATA_CHANGED,node:this,oldData:e,newData:t,update:r}},n.prototype.createLocalRowEvent=function(t){return{type:t,node:this}},n.prototype.getRowIndexString=function(){return this.rowPinned==="top"?"t-"+this.rowIndex:this.rowPinned==="bottom"?"b-"+this.rowIndex:this.rowIndex.toString()},n.prototype.createDaemonNode=function(){var t=new n(this.beans);return t.id=this.id,t.data=this.data,t.__daemon=!0,t.selected=this.selected,t.level=this.level,t},n.prototype.setDataAndId=function(t,e){var r=exists(this.id)?this.createDaemonNode():null,o=this.data;this.data=t,this.updateDataOnDetailNode(),this.setId(e),this.beans.selectionService.syncInRowNode(this,r),this.checkRowSelectable();var s=this.createDataChangedEvent(t,o,!1);this.dispatchLocalEvent(s)},n.prototype.checkRowSelectable=function(){var t=this.beans.gridOptionsService.get("isRowSelectable");this.setRowSelectable(t?t(this):!0)},n.prototype.setRowSelectable=function(t){if(this.selectable!==t){this.selectable=t,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(n.EVENT_SELECTABLE_CHANGED));var e=this.beans.gridOptionsService.is("groupSelectsChildren");if(e){var r=this.calculateSelectedFromChildren();this.setSelectedParams({newValue:r??!1,source:"selectableChanged"})}}},n.prototype.setId=function(t){var e=this.beans.gridOptionsService.getCallback("getRowId");if(e)if(this.data){var r=this.getGroupKeys(!0);this.id=e({data:this.data,parentKeys:r.length>0?r:void 0,level:this.level}),this.id!==null&&typeof this.id=="string"&&this.id.startsWith(n.ID_PREFIX_ROW_GROUP)&&console.error("AG Grid: Row IDs cannot start with "+n.ID_PREFIX_ROW_GROUP+", this is a reserved prefix for AG Grid's row grouping feature."),this.id!==null&&typeof this.id!="string"&&(this.id=""+this.id)}else this.id=void 0;else this.id=t},n.prototype.getGroupKeys=function(t){t===void 0&&(t=!1);var e=[],r=this;for(t&&(r=r.parent);r&&r.level>=0;)e.push(r.key),r=r.parent;return e.reverse(),e},n.prototype.isPixelInRange=function(t){return!exists(this.rowTop)||!exists(this.rowHeight)?!1:t>=this.rowTop&&t<this.rowTop+this.rowHeight},n.prototype.setFirstChild=function(t){this.firstChild!==t&&(this.firstChild=t,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(n.EVENT_FIRST_CHILD_CHANGED)))},n.prototype.setLastChild=function(t){this.lastChild!==t&&(this.lastChild=t,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(n.EVENT_LAST_CHILD_CHANGED)))},n.prototype.setChildIndex=function(t){this.childIndex!==t&&(this.childIndex=t,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(n.EVENT_CHILD_INDEX_CHANGED)))},n.prototype.setRowTop=function(t){this.oldRowTop=this.rowTop,this.rowTop!==t&&(this.rowTop=t,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(n.EVENT_TOP_CHANGED)),this.setDisplayed(t!==null))},n.prototype.clearRowTopAndRowIndex=function(){this.oldRowTop=null,this.setRowTop(null),this.setRowIndex(null)},n.prototype.setDisplayed=function(t){this.displayed!==t&&(this.displayed=t,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(n.EVENT_DISPLAYED_CHANGED)))},n.prototype.setDragging=function(t){this.dragging!==t&&(this.dragging=t,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(n.EVENT_DRAGGING_CHANGED)))},n.prototype.setHighlighted=function(t){t!==this.highlighted&&(this.highlighted=t,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(n.EVENT_HIGHLIGHT_CHANGED)))},n.prototype.setHovered=function(t){this.hovered!==t&&(this.hovered=t)},n.prototype.isHovered=function(){return this.hovered},n.prototype.setAllChildrenCount=function(t){this.allChildrenCount!==t&&(this.allChildrenCount=t,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(n.EVENT_ALL_CHILDREN_COUNT_CHANGED)))},n.prototype.setMaster=function(t){this.master!==t&&(this.master&&!t&&(this.expanded=!1),this.master=t,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(n.EVENT_MASTER_CHANGED)))},n.prototype.setGroup=function(t){this.group!==t&&(this.group&&!t&&(this.expanded=!1),this.group=t,this.updateHasChildren(),this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(n.EVENT_GROUP_CHANGED)))},n.prototype.setRowHeight=function(t,e){e===void 0&&(e=!1),this.rowHeight=t,this.rowHeightEstimated=e,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(n.EVENT_HEIGHT_CHANGED))},n.prototype.setRowAutoHeight=function(t,e){this.__autoHeights||(this.__autoHeights={}),this.__autoHeights[e.getId()]=t,t!=null&&(this.checkAutoHeightsDebounced==null&&(this.checkAutoHeightsDebounced=debounce(this.checkAutoHeights.bind(this),1)),this.checkAutoHeightsDebounced())},n.prototype.checkAutoHeights=function(){var t=this,e=!1,r=!0,o=0,s=this.__autoHeights;if(s!=null){var l=this.beans.columnModel.getAllDisplayedAutoHeightCols();if(l.forEach(function(h){var y=s[h.getId()];if(y==null)if(t.beans.columnModel.isColSpanActive()){var C=[];switch(h.getPinned()){case"left":C=t.beans.columnModel.getDisplayedLeftColumnsForRow(t);break;case"right":C=t.beans.columnModel.getDisplayedRightColumnsForRow(t);break;case null:C=t.beans.columnModel.getViewportCenterColumnsForRow(t);break}if(C.includes(h)){e=!0;return}y=-1}else{e=!0;return}else r=!1;y>o&&(o=y)}),!e&&((r||o<10)&&(o=this.beans.gridOptionsService.getRowHeightForNode(this).height),o!=this.rowHeight)){this.setRowHeight(o);var a=this.beans.rowModel;a.onRowHeightChangedDebounced&&a.onRowHeightChangedDebounced()}}},n.prototype.setRowIndex=function(t){this.rowIndex!==t&&(this.rowIndex=t,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(n.EVENT_ROW_INDEX_CHANGED)))},n.prototype.setUiLevel=function(t){this.uiLevel!==t&&(this.uiLevel=t,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(n.EVENT_UI_LEVEL_CHANGED)))},n.prototype.setExpanded=function(t,e){if(this.expanded!==t){this.expanded=t,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(n.EVENT_EXPANDED_CHANGED));var r=Object.assign({},this.createGlobalRowEvent(Events.EVENT_ROW_GROUP_OPENED),{expanded:t,event:e||null});this.beans.rowNodeEventThrottle.dispatchExpanded(r),this.beans.gridOptionsService.is("groupIncludeFooter")&&this.beans.rowRenderer.refreshCells({rowNodes:[this]})}},n.prototype.createGlobalRowEvent=function(t){return{type:t,node:this,data:this.data,rowIndex:this.rowIndex,rowPinned:this.rowPinned,context:this.beans.gridOptionsService.context,api:this.beans.gridOptionsService.api,columnApi:this.beans.gridOptionsService.columnApi}},n.prototype.dispatchLocalEvent=function(t){this.eventService&&this.eventService.dispatchEvent(t)},n.prototype.setDataValue=function(t,e,r){var o=this,s=function(){var y;return typeof t!="string"?t:(y=o.beans.columnModel.getGridColumn(t))!==null&&y!==void 0?y:o.beans.columnModel.getPrimaryColumn(t)},l=s(),a=this.getValueFromValueService(l);if(this.beans.gridOptionsService.is("readOnlyEdit"))return this.dispatchEventForSaveValueReadOnly(l,a,e,r),!1;var h=this.beans.valueService.setValue(this,l,e,r);return this.dispatchCellChangedEvent(l,e,a),this.checkRowSelectable(),h},n.prototype.getValueFromValueService=function(t){var e=this.leafGroup&&this.beans.columnModel.isPivotMode(),r=this.group&&this.expanded&&!this.footer&&!e,o=this.beans.gridOptionsService.is("groupIncludeFooter"),s=this.beans.gridOptionsService.is("groupSuppressBlankHeader"),l=r&&o&&!s,a=this.beans.valueService.getValue(t,this,!1,l);return a},n.prototype.dispatchEventForSaveValueReadOnly=function(t,e,r,o){var s={type:Events.EVENT_CELL_EDIT_REQUEST,event:null,rowIndex:this.rowIndex,rowPinned:this.rowPinned,column:t,colDef:t.getColDef(),context:this.beans.gridOptionsService.context,api:this.beans.gridOptionsService.api,columnApi:this.beans.gridOptionsService.columnApi,data:this.data,node:this,oldValue:e,newValue:r,value:r,source:o};this.beans.eventService.dispatchEvent(s)},n.prototype.setGroupValue=function(t,e){var r=this.beans.columnModel.getGridColumn(t);missing(this.groupData)&&(this.groupData={});var o=r.getColId(),s=this.groupData[o];s!==e&&(this.groupData[o]=e,this.dispatchCellChangedEvent(r,e,s))},n.prototype.setAggData=function(t){var e=this,r=getAllKeysInObjects([this.aggData,t]),o=this.aggData;this.aggData=t,this.eventService&&r.forEach(function(s){var l=e.beans.columnModel.getGridColumn(s),a=e.aggData?e.aggData[s]:void 0,h=o?o[s]:void 0;e.dispatchCellChangedEvent(l,a,h)})},n.prototype.updateHasChildren=function(){var t=this.group&&!this.footer||this.childrenAfterGroup&&this.childrenAfterGroup.length>0,e=this.beans.gridOptionsService.isRowModelType("serverSide");if(e){var r=this.beans.gridOptionsService.isTreeData(),o=this.beans.gridOptionsService.get("isServerSideGroup");t=!this.stub&&!this.footer&&(r?!!o&&o(this.data):!!this.group)}t!==this.__hasChildren&&(this.__hasChildren=!!t,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(n.EVENT_HAS_CHILDREN_CHANGED)))},n.prototype.hasChildren=function(){return this.__hasChildren==null&&this.updateHasChildren(),this.__hasChildren},n.prototype.isEmptyRowGroupNode=function(){return this.group&&missingOrEmpty(this.childrenAfterGroup)},n.prototype.dispatchCellChangedEvent=function(t,e,r){var o={type:n.EVENT_CELL_CHANGED,node:this,column:t,newValue:e,oldValue:r};this.dispatchLocalEvent(o)},n.prototype.resetQuickFilterAggregateText=function(){this.quickFilterAggregateText=null},n.prototype.isExpandable=function(){return!!(this.hasChildren()&&!this.footer||this.master)},n.prototype.isSelected=function(){return this.footer?this.sibling.isSelected():this.selected},n.prototype.depthFirstSearch=function(t){this.childrenAfterGroup&&this.childrenAfterGroup.forEach(function(e){return e.depthFirstSearch(t)}),t(this)},n.prototype.calculateSelectedFromChildren=function(){var t,e=!1,r=!1,o=!1;if(!(!((t=this.childrenAfterGroup)===null||t===void 0)&&t.length))return this.selectable?this.selected:null;for(var s=0;s<this.childrenAfterGroup.length;s++){var l=this.childrenAfterGroup[s],a=l.isSelected();if(!l.selectable){var h=l.calculateSelectedFromChildren();if(h===null)continue;a=h}switch(a){case!0:e=!0;break;case!1:r=!0;break;default:o=!0;break}}if(!(o||e&&r))return e?!0:r?!1:this.selectable?this.selected:null},n.prototype.setSelectedInitialValue=function(t){this.selected=t},n.prototype.selectThisNode=function(t,e,r){r===void 0&&(r="api");var o=!this.selectable&&t,s=this.selected===t;if(o||s)return!1;this.selected=t,this.eventService&&this.dispatchLocalEvent(this.createLocalRowEvent(n.EVENT_ROW_SELECTED));var l=__assign$f(__assign$f({},this.createGlobalRowEvent(Events.EVENT_ROW_SELECTED)),{event:e||null,source:r});return this.beans.eventService.dispatchEvent(l),!0},n.prototype.setSelected=function(t,e,r){if(e===void 0&&(e=!1),r===void 0&&(r="api"),typeof r=="boolean"){console.warn("AG Grid: since version v30, rowNode.setSelected() property `suppressFinishActions` has been removed, please use `gridApi.setNodesSelected()` for bulk actions, and the event `source` property for ignoring events instead.");return}this.setSelectedParams({newValue:t,clearSelection:e,rangeSelect:!1,source:r})},n.prototype.setSelectedParams=function(t){return this.rowPinned?(console.warn("AG Grid: cannot select pinned rows"),0):this.id===void 0?(console.warn("AG Grid: cannot select node until id for node is known"),0):this.beans.selectionService.setNodesSelected(__assign$f(__assign$f({},t),{nodes:[this.footer?this.sibling:this]}))},n.prototype.isRowPinned=function(){return this.rowPinned==="top"||this.rowPinned==="bottom"},n.prototype.isParentOfNode=function(t){for(var e=this.parent;e;){if(e===t)return!0;e=e.parent}return!1},n.prototype.addEventListener=function(t,e){this.eventService||(this.eventService=new EventService),this.eventService.addEventListener(t,e)},n.prototype.removeEventListener=function(t,e){this.eventService&&(this.eventService.removeEventListener(t,e),this.eventService.noRegisteredListenersExist()&&(this.eventService=null))},n.prototype.onMouseEnter=function(){this.dispatchLocalEvent(this.createLocalRowEvent(n.EVENT_MOUSE_ENTER))},n.prototype.onMouseLeave=function(){this.dispatchLocalEvent(this.createLocalRowEvent(n.EVENT_MOUSE_LEAVE))},n.prototype.getFirstChildOfFirstChild=function(t){for(var e=this,r=!0,o=!1,s=null;r&&!o;){var l=e.parent,a=exists(l)&&e.firstChild;a?l.rowGroupColumn===t&&(o=!0,s=l):r=!1,e=l}return o?s:null},n.prototype.isFullWidthCell=function(){var t=this.beans.gridOptionsService.getCallback("isFullWidthRow");return t?t({rowNode:this}):!1},n.prototype.getRoute=function(){if(this.key!=null){for(var t=[],e=this;e.key!=null;)t.push(e.key),e=e.parent;return t.reverse()}},n.prototype.createFooter=function(){var t=this;if(!this.sibling){var e=new n(this.beans);Object.keys(this).forEach(function(r){e[r]=t[r]}),e.footer=!0,e.setRowTop(null),e.setRowIndex(null),e.oldRowTop=null,e.id="rowGroupFooter_"+this.id,e.sibling=this,this.sibling=e}},n.ID_PREFIX_ROW_GROUP="row-group-",n.ID_PREFIX_TOP_PINNED="t-",n.ID_PREFIX_BOTTOM_PINNED="b-",n.OBJECT_ID_SEQUENCE=0,n.EVENT_ROW_SELECTED="rowSelected",n.EVENT_DATA_CHANGED="dataChanged",n.EVENT_CELL_CHANGED="cellChanged",n.EVENT_ALL_CHILDREN_COUNT_CHANGED="allChildrenCountChanged",n.EVENT_MASTER_CHANGED="masterChanged",n.EVENT_GROUP_CHANGED="groupChanged",n.EVENT_MOUSE_ENTER="mouseEnter",n.EVENT_MOUSE_LEAVE="mouseLeave",n.EVENT_HEIGHT_CHANGED="heightChanged",n.EVENT_TOP_CHANGED="topChanged",n.EVENT_DISPLAYED_CHANGED="displayedChanged",n.EVENT_FIRST_CHILD_CHANGED="firstChildChanged",n.EVENT_LAST_CHILD_CHANGED="lastChildChanged",n.EVENT_CHILD_INDEX_CHANGED="childIndexChanged",n.EVENT_ROW_INDEX_CHANGED="rowIndexChanged",n.EVENT_EXPANDED_CHANGED="expandedChanged",n.EVENT_HAS_CHILDREN_CHANGED="hasChildrenChanged",n.EVENT_SELECTABLE_CHANGED="selectableChanged",n.EVENT_UI_LEVEL_CHANGED="uiLevelChanged",n.EVENT_HIGHLIGHT_CHANGED="rowHighlightChanged",n.EVENT_DRAGGING_CHANGED="draggingChanged",n}(),__extends$2k=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__assign$e=function(){return __assign$e=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},__assign$e.apply(this,arguments)},__decorate$25=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},CheckboxSelectionComponent=function(n){__extends$2k(t,n);function t(){return n.call(this,`
            <div class="ag-selection-checkbox" role="presentation">
                <ag-checkbox role="presentation" ref="eCheckbox"></ag-checkbox>
            </div>`)||this}return t.prototype.postConstruct=function(){this.eCheckbox.setPassive(!0),setAriaLive(this.eCheckbox.getInputElement(),"polite")},t.prototype.getCheckboxId=function(){return this.eCheckbox.getInputElement().id},t.prototype.onDataChanged=function(){this.onSelectionChanged()},t.prototype.onSelectableChanged=function(){this.showOrHideSelect()},t.prototype.onSelectionChanged=function(){var e=this.localeService.getLocaleTextFunc(),r=this.rowNode.isSelected(),o=getAriaCheckboxStateName(e,r),s=e("ariaRowToggleSelection","Press Space to toggle row selection");this.eCheckbox.setValue(r,!0),this.eCheckbox.setInputAriaLabel(s+" ("+o+")")},t.prototype.onClicked=function(e,r,o){return this.rowNode.setSelectedParams({newValue:e,rangeSelect:o.shiftKey,groupSelectsFiltered:r,event:o,source:"checkboxSelected"})},t.prototype.init=function(e){var r=this;this.rowNode=e.rowNode,this.column=e.column,this.overrides=e.overrides,this.onSelectionChanged(),this.addManagedListener(this.eCheckbox.getInputElement(),"dblclick",function(a){stopPropagationForAgGrid(a)}),this.addManagedListener(this.eCheckbox.getInputElement(),"click",function(a){stopPropagationForAgGrid(a);var h=r.gridOptionsService.is("groupSelectsFiltered"),y=r.eCheckbox.getValue();if(r.shouldHandleIndeterminateState(y,h)){var C=r.onClicked(!0,h,a||{});C===0&&r.onClicked(!1,h,a)}else y?r.onClicked(!1,h,a):r.onClicked(!0,h,a||{})}),this.addManagedListener(this.rowNode,RowNode.EVENT_ROW_SELECTED,this.onSelectionChanged.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_DATA_CHANGED,this.onDataChanged.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_SELECTABLE_CHANGED,this.onSelectableChanged.bind(this));var o=this.gridOptionsService.get("isRowSelectable"),s=o||typeof this.getIsVisible()=="function";if(s){var l=this.showOrHideSelect.bind(this);this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,l),this.addManagedListener(this.rowNode,RowNode.EVENT_DATA_CHANGED,l),this.addManagedListener(this.rowNode,RowNode.EVENT_CELL_CHANGED,l),this.showOrHideSelect()}this.eCheckbox.getInputElement().setAttribute("tabindex","-1")},t.prototype.shouldHandleIndeterminateState=function(e,r){return r&&(this.eCheckbox.getPreviousValue()===void 0||e===void 0)&&this.gridOptionsService.isRowModelType("clientSide")},t.prototype.showOrHideSelect=function(){var e,r,o,s,l=this.rowNode.selectable,a=this.getIsVisible();if(l)if(typeof a=="function"){var h=(e=this.overrides)===null||e===void 0?void 0:e.callbackParams,y=(r=this.column)===null||r===void 0?void 0:r.createColumnFunctionCallbackParams(this.rowNode);l=y?a(__assign$e(__assign$e({},h),y)):!1}else l=a??!1;var C=(o=this.column)===null||o===void 0?void 0:o.getColDef().showDisabledCheckboxes;if(C){this.eCheckbox.setDisabled(!l),this.setVisible(!0),this.setDisplayed(!0);return}if(!((s=this.overrides)===null||s===void 0)&&s.removeHidden){this.setDisplayed(l);return}this.setVisible(l)},t.prototype.getIsVisible=function(){var e,r;return this.overrides?this.overrides.isVisible:(r=(e=this.column)===null||e===void 0?void 0:e.getColDef())===null||r===void 0?void 0:r.checkboxSelection},__decorate$25([RefSelector("eCheckbox")],t.prototype,"eCheckbox",void 0),__decorate$25([PostConstruct],t.prototype,"postConstruct",null),t}(Component),__extends$2j=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$24=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__values$4=function(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],r=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},DragSourceType;(function(n){n[n.ToolPanel=0]="ToolPanel",n[n.HeaderCell=1]="HeaderCell",n[n.RowDrag=2]="RowDrag",n[n.ChartPanel=3]="ChartPanel"})(DragSourceType||(DragSourceType={}));var VerticalDirection;(function(n){n[n.Up=0]="Up",n[n.Down=1]="Down"})(VerticalDirection||(VerticalDirection={}));var HorizontalDirection;(function(n){n[n.Left=0]="Left",n[n.Right=1]="Right"})(HorizontalDirection||(HorizontalDirection={}));var DragAndDropService=function(n){__extends$2j(t,n);function t(){var r=n!==null&&n.apply(this,arguments)||this;return r.dragSourceAndParamsList=[],r.dropTargets=[],r}e=t,t.prototype.init=function(){this.ePinnedIcon=createIcon("columnMovePin",this.gridOptionsService,null),this.eHideIcon=createIcon("columnMoveHide",this.gridOptionsService,null),this.eMoveIcon=createIcon("columnMoveMove",this.gridOptionsService,null),this.eLeftIcon=createIcon("columnMoveLeft",this.gridOptionsService,null),this.eRightIcon=createIcon("columnMoveRight",this.gridOptionsService,null),this.eGroupIcon=createIcon("columnMoveGroup",this.gridOptionsService,null),this.eAggregateIcon=createIcon("columnMoveValue",this.gridOptionsService,null),this.ePivotIcon=createIcon("columnMovePivot",this.gridOptionsService,null),this.eDropNotAllowedIcon=createIcon("dropNotAllowed",this.gridOptionsService,null)},t.prototype.addDragSource=function(r,o){o===void 0&&(o=!1);var s={eElement:r.eElement,dragStartPixels:r.dragStartPixels,onDragStart:this.onDragStart.bind(this,r),onDragStop:this.onDragStop.bind(this),onDragging:this.onDragging.bind(this),includeTouch:o};this.dragSourceAndParamsList.push({params:s,dragSource:r}),this.dragService.addDragSource(s)},t.prototype.removeDragSource=function(r){var o=this.dragSourceAndParamsList.find(function(s){return s.dragSource===r});o&&(this.dragService.removeDragSource(o.params),removeFromArray(this.dragSourceAndParamsList,o))},t.prototype.clearDragSourceParamsList=function(){var r=this;this.dragSourceAndParamsList.forEach(function(o){return r.dragService.removeDragSource(o.params)}),this.dragSourceAndParamsList.length=0,this.dropTargets.length=0},t.prototype.nudge=function(){this.dragging&&this.onDragging(this.eventLastTime,!0)},t.prototype.onDragStart=function(r,o){this.dragging=!0,this.dragSource=r,this.eventLastTime=o,this.dragItem=this.dragSource.getDragItem(),this.lastDropTarget=this.dragSource.dragSourceDropTarget,this.dragSource.onDragStarted&&this.dragSource.onDragStarted(),this.createGhost()},t.prototype.onDragStop=function(r){if(this.eventLastTime=null,this.dragging=!1,this.dragSource.onDragStopped&&this.dragSource.onDragStopped(),this.lastDropTarget&&this.lastDropTarget.onDragStop){var o=this.createDropTargetEvent(this.lastDropTarget,r,null,null,!1);this.lastDropTarget.onDragStop(o)}this.lastDropTarget=null,this.dragItem=null,this.removeGhost()},t.prototype.onDragging=function(r,o){var s=this,l,a,h,y,C=this.getHorizontalDirection(r),L=this.getVerticalDirection(r);this.eventLastTime=r,this.positionGhost(r);var Y=this.dropTargets.filter(function(Ir){return s.isMouseOnDropTarget(r,Ir)}),ze=this.findCurrentDropTarget(r,Y);if(ze!==this.lastDropTarget)this.leaveLastTargetIfExists(r,C,L,o),this.lastDropTarget!==null&&ze===null&&((a=(l=this.dragSource).onGridExit)===null||a===void 0||a.call(l,this.dragItem)),this.lastDropTarget===null&&ze!==null&&((y=(h=this.dragSource).onGridEnter)===null||y===void 0||y.call(h,this.dragItem)),this.enterDragTargetIfExists(ze,r,C,L,o),this.lastDropTarget=ze;else if(ze&&ze.onDragging){var Bt=this.createDropTargetEvent(ze,r,C,L,o);ze.onDragging(Bt)}},t.prototype.getAllContainersFromDropTarget=function(r){var o=r.getSecondaryContainers?r.getSecondaryContainers():null,s=[[r.getContainer()]];return o?s.concat(o):s},t.prototype.allContainersIntersect=function(r,o){var s,l;try{for(var a=__values$4(o),h=a.next();!h.done;h=a.next()){var y=h.value,C=y.getBoundingClientRect();if(C.width===0||C.height===0)return!1;var L=r.clientX>=C.left&&r.clientX<C.right,Y=r.clientY>=C.top&&r.clientY<C.bottom;if(!L||!Y)return!1}}catch(ze){s={error:ze}}finally{try{h&&!h.done&&(l=a.return)&&l.call(a)}finally{if(s)throw s.error}}return!0},t.prototype.isMouseOnDropTarget=function(r,o){var s,l,a=this.getAllContainersFromDropTarget(o),h=!1;try{for(var y=__values$4(a),C=y.next();!C.done;C=y.next()){var L=C.value;if(this.allContainersIntersect(r,L)){h=!0;break}}}catch(Y){s={error:Y}}finally{try{C&&!C.done&&(l=y.return)&&l.call(y)}finally{if(s)throw s.error}}return o.targetContainsSource&&!o.getContainer().contains(this.dragSource.eElement)?!1:h&&o.isInterestedIn(this.dragSource.type,this.dragSource.eElement)},t.prototype.findCurrentDropTarget=function(r,o){var s,l,a,h,y=o.length;if(y===0)return null;if(y===1)return o[0];var C=this.gridOptionsService.getRootNode(),L=C.elementsFromPoint(r.clientX,r.clientY);try{for(var Y=__values$4(L),ze=Y.next();!ze.done;ze=Y.next()){var Bt=ze.value;try{for(var Ir=(a=void 0,__values$4(o)),Wr=Ir.next();!Wr.done;Wr=Ir.next()){var yi=Wr.value,Bn=flatten(this.getAllContainersFromDropTarget(yi));if(Bn.indexOf(Bt)!==-1)return yi}}catch(vi){a={error:vi}}finally{try{Wr&&!Wr.done&&(h=Ir.return)&&h.call(Ir)}finally{if(a)throw a.error}}}}catch(vi){s={error:vi}}finally{try{ze&&!ze.done&&(l=Y.return)&&l.call(Y)}finally{if(s)throw s.error}}return null},t.prototype.enterDragTargetIfExists=function(r,o,s,l,a){if(r){if(r.onDragEnter){var h=this.createDropTargetEvent(r,o,s,l,a);r.onDragEnter(h)}this.setGhostIcon(r.getIconName?r.getIconName():null)}},t.prototype.leaveLastTargetIfExists=function(r,o,s,l){if(this.lastDropTarget){if(this.lastDropTarget.onDragLeave){var a=this.createDropTargetEvent(this.lastDropTarget,r,o,s,l);this.lastDropTarget.onDragLeave(a)}this.setGhostIcon(null)}},t.prototype.addDropTarget=function(r){this.dropTargets.push(r)},t.prototype.removeDropTarget=function(r){this.dropTargets=this.dropTargets.filter(function(o){return o.getContainer()!==r.getContainer()})},t.prototype.hasExternalDropZones=function(){return this.dropTargets.some(function(r){return r.external})},t.prototype.findExternalZone=function(r){var o=this.dropTargets.filter(function(s){return s.external});return o.find(function(s){return s.getContainer()===r.getContainer()})||null},t.prototype.getHorizontalDirection=function(r){var o=this.eventLastTime&&this.eventLastTime.clientX,s=r.clientX;return o===s?null:o>s?HorizontalDirection.Left:HorizontalDirection.Right},t.prototype.getVerticalDirection=function(r){var o=this.eventLastTime&&this.eventLastTime.clientY,s=r.clientY;return o===s?null:o>s?VerticalDirection.Up:VerticalDirection.Down},t.prototype.createDropTargetEvent=function(r,o,s,l,a){var h=r.getContainer(),y=h.getBoundingClientRect(),C=this,L=C.gridApi,Y=C.columnApi,ze=C.dragItem,Bt=C.dragSource,Ir=o.clientX-y.left,Wr=o.clientY-y.top;return{event:o,x:Ir,y:Wr,vDirection:l,hDirection:s,dragSource:Bt,fromNudge:a,dragItem:ze,api:L,columnApi:Y,dropZoneTarget:h}},t.prototype.positionGhost=function(r){var o=this.eGhost;if(o){var s=o.getBoundingClientRect(),l=s.height,a=getBodyWidth()-2,h=getBodyHeight()-2,y=getElementRectWithOffset(o.offsetParent),C=r.clientY,L=r.clientX,Y=C-y.top-l/2,ze=L-y.left-10,Bt=this.gridOptionsService.getDocument(),Ir=Bt.defaultView||window,Wr=Ir.pageYOffset||Bt.documentElement.scrollTop,yi=Ir.pageXOffset||Bt.documentElement.scrollLeft;a>0&&ze+o.clientWidth>a+yi&&(ze=a+yi-o.clientWidth),ze<0&&(ze=0),h>0&&Y+o.clientHeight>h+Wr&&(Y=h+Wr-o.clientHeight),Y<0&&(Y=0),o.style.left=ze+"px",o.style.top=Y+"px"}},t.prototype.removeGhost=function(){this.eGhost&&this.eGhostParent&&this.eGhostParent.removeChild(this.eGhost),this.eGhost=null},t.prototype.createGhost=function(){this.eGhost=loadTemplate(e.GHOST_TEMPLATE),this.mouseEventService.stampTopLevelGridCompWithGridInstance(this.eGhost);var r=this.environment.getTheme().theme;r&&this.eGhost.classList.add(r),this.eGhostIcon=this.eGhost.querySelector(".ag-dnd-ghost-icon"),this.setGhostIcon(null);var o=this.eGhost.querySelector(".ag-dnd-ghost-label"),s=this.dragSource.dragItemName;isFunction(s)&&(s=s()),o.innerHTML=escapeString(s)||"",this.eGhost.style.height="25px",this.eGhost.style.top="20px",this.eGhost.style.left="20px";var l=this.gridOptionsService.getDocument(),a=null;try{a=l.fullscreenElement}catch{}finally{if(!a){var h=this.gridOptionsService.getRootNode(),y=h.querySelector("body");y?a=y:h instanceof ShadowRoot?a=h:a=h==null?void 0:h.documentElement}}this.eGhostParent=a,this.eGhostParent?this.eGhostParent.appendChild(this.eGhost):console.warn("AG Grid: could not find document body, it is needed for dragging columns")},t.prototype.setGhostIcon=function(r,o){o===void 0&&(o=!1),clearElement(this.eGhostIcon);var s=null;switch(r||(r=this.dragSource.defaultIconName||e.ICON_NOT_ALLOWED),r){case e.ICON_PINNED:s=this.ePinnedIcon;break;case e.ICON_MOVE:s=this.eMoveIcon;break;case e.ICON_LEFT:s=this.eLeftIcon;break;case e.ICON_RIGHT:s=this.eRightIcon;break;case e.ICON_GROUP:s=this.eGroupIcon;break;case e.ICON_AGGREGATE:s=this.eAggregateIcon;break;case e.ICON_PIVOT:s=this.ePivotIcon;break;case e.ICON_NOT_ALLOWED:s=this.eDropNotAllowedIcon;break;case e.ICON_HIDE:s=this.eHideIcon;break}this.eGhostIcon.classList.toggle("ag-shake-left-to-right",o),!(s===this.eHideIcon&&this.gridOptionsService.is("suppressDragLeaveHidesColumns"))&&s&&this.eGhostIcon.appendChild(s)};var e;return t.ICON_PINNED="pinned",t.ICON_MOVE="move",t.ICON_LEFT="left",t.ICON_RIGHT="right",t.ICON_GROUP="group",t.ICON_AGGREGATE="aggregate",t.ICON_PIVOT="pivot",t.ICON_NOT_ALLOWED="notAllowed",t.ICON_HIDE="hide",t.GHOST_TEMPLATE=`<div class="ag-dnd-ghost ag-unselectable">
            <span class="ag-dnd-ghost-icon ag-shake-left-to-right"></span>
            <div class="ag-dnd-ghost-label"></div>
        </div>`,__decorate$24([Autowired("dragService")],t.prototype,"dragService",void 0),__decorate$24([Autowired("mouseEventService")],t.prototype,"mouseEventService",void 0),__decorate$24([Autowired("columnApi")],t.prototype,"columnApi",void 0),__decorate$24([Autowired("gridApi")],t.prototype,"gridApi",void 0),__decorate$24([PostConstruct],t.prototype,"init",null),__decorate$24([PreDestroy],t.prototype,"clearDragSourceParamsList",null),t=e=__decorate$24([Bean("dragAndDropService")],t),t}(BeanStub),__extends$2i=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$23=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},RowDragComp=function(n){__extends$2i(t,n);function t(e,r,o,s,l,a){var h=n.call(this)||this;return h.cellValueFn=e,h.rowNode=r,h.column=o,h.customGui=s,h.dragStartPixels=l,h.suppressVisibilityChange=a,h.dragSource=null,h}return t.prototype.isCustomGui=function(){return this.customGui!=null},t.prototype.postConstruct=function(){if(this.customGui?this.setDragElement(this.customGui,this.dragStartPixels):(this.setTemplate('<div class="ag-drag-handle ag-row-drag" aria-hidden="true"></div>'),this.getGui().appendChild(createIconNoSpan("rowDrag",this.gridOptionsService,null)),this.addDragSource()),this.checkCompatibility(),!this.suppressVisibilityChange){var e=this.gridOptionsService.is("rowDragManaged")?new ManagedVisibilityStrategy(this,this.beans,this.rowNode,this.column):new NonManagedVisibilityStrategy(this,this.beans,this.rowNode,this.column);this.createManagedBean(e,this.beans.context)}},t.prototype.setDragElement=function(e,r){this.setTemplateFromElement(e),this.addDragSource(r)},t.prototype.getSelectedNodes=function(){var e=this.gridOptionsService.is("rowDragMultiRow");if(!e)return[this.rowNode];var r=this.beans.selectionService.getSelectedNodes();return r.indexOf(this.rowNode)!==-1?r:[this.rowNode]},t.prototype.checkCompatibility=function(){var e=this.gridOptionsService.is("rowDragManaged"),r=this.gridOptionsService.isTreeData();r&&e&&doOnce(function(){return console.warn("AG Grid: If using row drag with tree data, you cannot have rowDragManaged=true")},"RowDragComp.managedAndTreeData")},t.prototype.getDragItem=function(){return{rowNode:this.rowNode,rowNodes:this.getSelectedNodes(),columns:this.column?[this.column]:void 0,defaultTextValue:this.cellValueFn()}},t.prototype.getRowDragText=function(e){if(e){var r=e.getColDef();if(r.rowDragText)return r.rowDragText}return this.gridOptionsService.get("rowDragText")},t.prototype.addDragSource=function(e){var r=this;e===void 0&&(e=4),this.dragSource&&this.removeDragSource();var o=this.getRowDragText(this.column),s=this.localeService.getLocaleTextFunc();this.dragSource={type:DragSourceType.RowDrag,eElement:this.getGui(),dragItemName:function(){var l,a=r.getDragItem(),h=((l=a.rowNodes)===null||l===void 0?void 0:l.length)||1;return o?o(a,h):h===1?r.cellValueFn():h+" "+s("rowDragRows","rows")},getDragItem:function(){return r.getDragItem()},dragStartPixels:e,dragSourceDomDataKey:this.gridOptionsService.getDomDataKey()},this.beans.dragAndDropService.addDragSource(this.dragSource,!0)},t.prototype.removeDragSource=function(){this.dragSource&&this.beans.dragAndDropService.removeDragSource(this.dragSource),this.dragSource=null},__decorate$23([Autowired("beans")],t.prototype,"beans",void 0),__decorate$23([PostConstruct],t.prototype,"postConstruct",null),__decorate$23([PreDestroy],t.prototype,"removeDragSource",null),t}(Component),VisibilityStrategy=function(n){__extends$2i(t,n);function t(e,r,o){var s=n.call(this)||this;return s.parent=e,s.rowNode=r,s.column=o,s}return t.prototype.setDisplayedOrVisible=function(e){var r={skipAriaHidden:!0};if(e)this.parent.setDisplayed(!1,r);else{var o=!0,s=!1;this.column&&(o=this.column.isRowDrag(this.rowNode)||this.parent.isCustomGui(),s=isFunction(this.column.getColDef().rowDrag)),s?(this.parent.setDisplayed(!0,r),this.parent.setVisible(o,r)):(this.parent.setDisplayed(o,r),this.parent.setVisible(!0,r))}},t}(BeanStub),NonManagedVisibilityStrategy=function(n){__extends$2i(t,n);function t(e,r,o,s){var l=n.call(this,e,o,s)||this;return l.beans=r,l}return t.prototype.postConstruct=function(){this.addManagedPropertyListener("suppressRowDrag",this.onSuppressRowDrag.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_DATA_CHANGED,this.workOutVisibility.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_CELL_CHANGED,this.workOutVisibility.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_CELL_CHANGED,this.workOutVisibility.bind(this)),this.addManagedListener(this.beans.eventService,Events.EVENT_NEW_COLUMNS_LOADED,this.workOutVisibility.bind(this)),this.workOutVisibility()},t.prototype.onSuppressRowDrag=function(){this.workOutVisibility()},t.prototype.workOutVisibility=function(){var e=this.gridOptionsService.is("suppressRowDrag");this.setDisplayedOrVisible(e)},__decorate$23([PostConstruct],t.prototype,"postConstruct",null),t}(VisibilityStrategy),ManagedVisibilityStrategy=function(n){__extends$2i(t,n);function t(e,r,o,s){var l=n.call(this,e,o,s)||this;return l.beans=r,l}return t.prototype.postConstruct=function(){this.addManagedListener(this.beans.eventService,Events.EVENT_SORT_CHANGED,this.workOutVisibility.bind(this)),this.addManagedListener(this.beans.eventService,Events.EVENT_FILTER_CHANGED,this.workOutVisibility.bind(this)),this.addManagedListener(this.beans.eventService,Events.EVENT_COLUMN_ROW_GROUP_CHANGED,this.workOutVisibility.bind(this)),this.addManagedListener(this.beans.eventService,Events.EVENT_NEW_COLUMNS_LOADED,this.workOutVisibility.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_DATA_CHANGED,this.workOutVisibility.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_CELL_CHANGED,this.workOutVisibility.bind(this)),this.addManagedPropertyListener("suppressRowDrag",this.onSuppressRowDrag.bind(this)),this.workOutVisibility()},t.prototype.onSuppressRowDrag=function(){this.workOutVisibility()},t.prototype.workOutVisibility=function(){var e=this.beans.ctrlsService.getGridBodyCtrl(),r=e.getRowDragFeature(),o=r&&r.shouldPreventRowMove(),s=this.gridOptionsService.is("suppressRowDrag"),l=this.beans.dragAndDropService.hasExternalDropZones(),a=o&&!l||s;this.setDisplayedOrVisible(a)},__decorate$23([PostConstruct],t.prototype,"postConstruct",null),t}(VisibilityStrategy),__extends$2h=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__assign$d=function(){return __assign$d=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},__assign$d.apply(this,arguments)},__decorate$22=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},GroupCellRendererCtrl=function(n){__extends$2h(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.init=function(e,r,o,s,l,a,h){this.params=h,this.eGui=r,this.eCheckbox=o,this.eExpanded=s,this.eContracted=l,this.comp=e,this.compClass=a;var y=this.isTopLevelFooter(),C=this.isEmbeddedRowMismatch(),L=h.value==null&&!h.node.master,Y=!1;if(this.gridOptionsService.is("groupIncludeFooter")&&this.gridOptionsService.is("groupHideOpenParents")){var ze=h.node;if(ze.footer){var Bt=h.colDef&&h.colDef.showRowGroup,Ir=ze.rowGroupColumn&&ze.rowGroupColumn.getColId();Y=Bt!==Ir}}this.cellIsBlank=y?!1:C||L&&!h.node.master||Y,!this.cellIsBlank&&(this.setupShowingValueForOpenedParent(),this.findDisplayedGroupNode(),this.addFullWidthRowDraggerIfNeeded(),this.addExpandAndContract(),this.addCheckboxIfNeeded(),this.addValueElement(),this.setupIndent(),this.refreshAriaExpanded())},t.prototype.destroy=function(){n.prototype.destroy.call(this),this.expandListener=null},t.prototype.refreshAriaExpanded=function(){var e=this.params,r=e.node,o=e.eParentOfValue;if(this.expandListener&&(this.expandListener=this.expandListener()),!this.isExpandable()){removeAriaExpanded(o);return}var s=function(){setAriaExpanded(o,!!r.expanded)};this.expandListener=this.addManagedListener(r,RowNode.EVENT_EXPANDED_CHANGED,s)||null,s()},t.prototype.isTopLevelFooter=function(){if(!this.gridOptionsService.is("groupIncludeTotalFooter")||this.params.value!=null||this.params.node.level!=-1)return!1;var e=this.params.colDef,r=e==null;if(r||e.showRowGroup===!0)return!0;var o=this.columnModel.getRowGroupColumns();if(!o||o.length===0)return!0;var s=o[0];return s.getId()===e.showRowGroup},t.prototype.isEmbeddedRowMismatch=function(){if(!this.params.fullWidth||!this.gridOptionsService.is("embedFullWidthRows"))return!1;var e=this.params.pinned==="left",r=this.params.pinned==="right",o=!e&&!r;return this.gridOptionsService.is("enableRtl")?this.columnModel.isPinningLeft()?!r:!o:this.columnModel.isPinningLeft()?!e:!o},t.prototype.findDisplayedGroupNode=function(){var e=this.params.column,r=this.params.node;if(this.showingValueForOpenedParent)for(var o=r.parent;o!=null;){if(o.rowGroupColumn&&e.isRowGroupDisplayed(o.rowGroupColumn.getId())){this.displayedGroupNode=o;break}o=o.parent}missing(this.displayedGroupNode)&&(this.displayedGroupNode=r)},t.prototype.setupShowingValueForOpenedParent=function(){var e=this.params.node,r=this.params.column;if(!this.gridOptionsService.is("groupHideOpenParents")){this.showingValueForOpenedParent=!1;return}if(!e.groupData){this.showingValueForOpenedParent=!1;return}var o=e.rowGroupColumn!=null;if(o){var s=e.rowGroupColumn.getId(),l=r.isRowGroupDisplayed(s);if(l){this.showingValueForOpenedParent=!1;return}}var a=e.groupData[r.getId()]!=null;this.showingValueForOpenedParent=a},t.prototype.addValueElement=function(){this.displayedGroupNode.footer?this.addFooterValue():(this.addGroupValue(),this.addChildCount())},t.prototype.addGroupValue=function(){var e=this.adjustParamsWithDetailsFromRelatedColumn(),r=this.getInnerCompDetails(e),o=e.valueFormatted,s=e.value,l=o;if(l==null)if(s===""&&this.params.node.group){var a=this.localeService.getLocaleTextFunc();l=a("blanks","(Blanks)")}else l=s??null;this.comp.setInnerRenderer(r,l)},t.prototype.adjustParamsWithDetailsFromRelatedColumn=function(){var e=this.displayedGroupNode.rowGroupColumn,r=this.params.column;if(!e)return this.params;var o=r!=null;if(o){var s=r.isRowGroupDisplayed(e.getId());if(!s)return this.params}var l=this.params,a=this.params,h=a.value,y=a.node,C=this.valueFormatterService.formatValue(e,y,h),L=__assign$d(__assign$d({},l),{valueFormatted:C});return L},t.prototype.addFooterValue=function(){var e=this.params.footerValueGetter,r="";if(e){var o=cloneObject(this.params);o.value=this.params.value,typeof e=="function"?r=e(o):typeof e=="string"?r=this.expressionService.evaluate(e,o):console.warn("AG Grid: footerValueGetter should be either a function or a string (expression)")}else r="Total "+(this.params.value!=null?this.params.value:"");var s=this.getInnerCompDetails(this.params);this.comp.setInnerRenderer(s,r)},t.prototype.getInnerCompDetails=function(e){var r=this;if(e.fullWidth)return this.userComponentFactory.getFullWidthGroupRowInnerCellRenderer(this.gridOptionsService.get("groupRowRendererParams"),e);var o=this.userComponentFactory.getInnerRendererDetails(e,e),s=function(C){return C&&C.componentClass==r.compClass};if(o&&!s(o))return o;var l=this.displayedGroupNode.rowGroupColumn,a=l?l.getColDef():void 0;if(a){var h=this.userComponentFactory.getCellRendererDetails(a,e);if(h&&!s(h))return h;if(s(h)&&a.cellRendererParams&&a.cellRendererParams.innerRenderer){var y=this.userComponentFactory.getInnerRendererDetails(a.cellRendererParams,e);return y}}},t.prototype.addChildCount=function(){this.params.suppressCount||(this.addManagedListener(this.displayedGroupNode,RowNode.EVENT_ALL_CHILDREN_COUNT_CHANGED,this.updateChildCount.bind(this)),this.updateChildCount())},t.prototype.updateChildCount=function(){var e=this.displayedGroupNode.allChildrenCount,r=this.isShowRowGroupForThisRow(),o=r&&e!=null&&e>=0,s=o?"("+e+")":"";this.comp.setChildCount(s)},t.prototype.isShowRowGroupForThisRow=function(){if(this.gridOptionsService.isTreeData())return!0;var e=this.displayedGroupNode.rowGroupColumn;if(!e)return!1;var r=this.params.column,o=r==null||r.isRowGroupDisplayed(e.getId());return o},t.prototype.addExpandAndContract=function(){var e,r=this.params,o=createIconNoSpan("groupExpanded",this.gridOptionsService,null),s=createIconNoSpan("groupContracted",this.gridOptionsService,null);o&&this.eExpanded.appendChild(o),s&&this.eContracted.appendChild(s);var l=r.eGridCell,a=((e=this.params.column)===null||e===void 0?void 0:e.isCellEditable(r.node))&&this.gridOptionsService.is("enableGroupEdit");!a&&this.isExpandable()&&!r.suppressDoubleClickExpand&&this.addManagedListener(l,"dblclick",this.onCellDblClicked.bind(this)),this.addManagedListener(this.eExpanded,"click",this.onExpandClicked.bind(this)),this.addManagedListener(this.eContracted,"click",this.onExpandClicked.bind(this)),this.addManagedListener(l,"keydown",this.onKeyDown.bind(this)),this.addManagedListener(r.node,RowNode.EVENT_EXPANDED_CHANGED,this.showExpandAndContractIcons.bind(this)),this.showExpandAndContractIcons();var h=this.onRowNodeIsExpandableChanged.bind(this);this.addManagedListener(this.displayedGroupNode,RowNode.EVENT_ALL_CHILDREN_COUNT_CHANGED,h),this.addManagedListener(this.displayedGroupNode,RowNode.EVENT_MASTER_CHANGED,h),this.addManagedListener(this.displayedGroupNode,RowNode.EVENT_GROUP_CHANGED,h),this.addManagedListener(this.displayedGroupNode,RowNode.EVENT_HAS_CHILDREN_CHANGED,h)},t.prototype.onExpandClicked=function(e){isStopPropagationForAgGrid(e)||(stopPropagationForAgGrid(e),this.onExpandOrContract(e))},t.prototype.onExpandOrContract=function(e){var r=this.displayedGroupNode,o=!r.expanded;!o&&r.sticky&&this.scrollToStickyNode(r),r.setExpanded(o,e)},t.prototype.scrollToStickyNode=function(e){var r=this.ctrlsService.getGridBodyCtrl(),o=r.getScrollFeature();o.setVerticalScrollPosition(e.rowTop-e.stickyRowTop)},t.prototype.isExpandable=function(){if(this.showingValueForOpenedParent)return!0;var e=this.displayedGroupNode,r=this.columnModel.isPivotMode()&&e.leafGroup,o=e.isExpandable()&&!e.footer&&!r;if(!o)return!1;var s=this.params.column,l=s!=null&&typeof s.getColDef().showRowGroup=="string";if(l){var a=this.isShowRowGroupForThisRow();return a}return!0},t.prototype.showExpandAndContractIcons=function(){var e=this,r=e.params,o=e.displayedGroupNode,s=e.columnModel,l=r.node,a=this.isExpandable();if(a){var h=this.showingValueForOpenedParent?!0:l.expanded;this.comp.setExpandedDisplayed(h),this.comp.setContractedDisplayed(!h)}else this.comp.setExpandedDisplayed(!1),this.comp.setContractedDisplayed(!1);var y=s.isPivotMode(),C=y&&o.leafGroup,L=a&&!C,Y=l.footer&&l.level===-1;this.comp.addOrRemoveCssClass("ag-cell-expandable",L),this.comp.addOrRemoveCssClass("ag-row-group",L),y?this.comp.addOrRemoveCssClass("ag-pivot-leaf-group",C):Y||this.comp.addOrRemoveCssClass("ag-row-group-leaf-indent",!L)},t.prototype.onRowNodeIsExpandableChanged=function(){this.showExpandAndContractIcons(),this.setIndent(),this.refreshAriaExpanded()},t.prototype.setupIndent=function(){var e=this.params.node,r=this.params.suppressPadding;r||(this.addManagedListener(e,RowNode.EVENT_UI_LEVEL_CHANGED,this.setIndent.bind(this)),this.setIndent())},t.prototype.setIndent=function(){if(!this.gridOptionsService.is("groupHideOpenParents")){var e=this.params,r=e.node,o=!!e.colDef,s=this.gridOptionsService.isTreeData(),l=!o||s||e.colDef.showRowGroup===!0,a=l?r.uiLevel:0;this.indentClass&&this.comp.addOrRemoveCssClass(this.indentClass,!1),this.indentClass="ag-row-group-indent-"+a,this.comp.addOrRemoveCssClass(this.indentClass,!0)}},t.prototype.addFullWidthRowDraggerIfNeeded=function(){var e=this;if(!(!this.params.fullWidth||!this.params.rowDrag)){var r=new RowDragComp(function(){return e.params.value},this.params.node);this.createManagedBean(r,this.context),this.eGui.insertAdjacentElement("afterbegin",r.getGui())}},t.prototype.isUserWantsSelected=function(){var e=this.params.checkbox;return typeof e=="function"||e===!0},t.prototype.addCheckboxIfNeeded=function(){var e=this,r=this.displayedGroupNode,o=this.isUserWantsSelected()&&!r.footer&&!r.rowPinned&&!r.detail;if(o){var s=new CheckboxSelectionComponent;this.getContext().createBean(s),s.init({rowNode:r,column:this.params.column,overrides:{isVisible:this.params.checkbox,callbackParams:this.params,removeHidden:!0}}),this.eCheckbox.appendChild(s.getGui()),this.addDestroyFunc(function(){return e.getContext().destroyBean(s)})}this.comp.setCheckboxVisible(o)},t.prototype.onKeyDown=function(e){var r=e.key===KeyCode.ENTER;if(!(!r||this.params.suppressEnterExpand)){var o=this.params.column&&this.params.column.isCellEditable(this.params.node);o||this.onExpandOrContract(e)}},t.prototype.onCellDblClicked=function(e){if(!isStopPropagationForAgGrid(e)){var r=isElementInEventPath(this.eExpanded,e)||isElementInEventPath(this.eContracted,e);r||this.onExpandOrContract(e)}},__decorate$22([Autowired("expressionService")],t.prototype,"expressionService",void 0),__decorate$22([Autowired("valueFormatterService")],t.prototype,"valueFormatterService",void 0),__decorate$22([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$22([Autowired("userComponentFactory")],t.prototype,"userComponentFactory",void 0),__decorate$22([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),t}(BeanStub),__extends$2g=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$21=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},GroupCellRenderer=function(n){__extends$2g(t,n);function t(){return n.call(this,t.TEMPLATE)||this}return t.prototype.init=function(e){var r=this,o={setInnerRenderer:function(h,y){return r.setRenderDetails(h,y)},setChildCount:function(h){return r.eChildCount.innerHTML=h},addOrRemoveCssClass:function(h,y){return r.addOrRemoveCssClass(h,y)},setContractedDisplayed:function(h){return setDisplayed(r.eContracted,h)},setExpandedDisplayed:function(h){return setDisplayed(r.eExpanded,h)},setCheckboxVisible:function(h){return r.eCheckbox.classList.toggle("ag-invisible",!h)}},s=this.createManagedBean(new GroupCellRendererCtrl),l=!e.colDef,a=this.getGui();s.init(o,a,this.eCheckbox,this.eExpanded,this.eContracted,this.constructor,e),l&&setAriaRole(a,"gridcell")},t.prototype.setRenderDetails=function(e,r){var o=this;if(e){var s=e.newAgStackInstance();if(!s)return;s.then(function(l){if(l){var a=function(){return o.context.destroyBean(l)};o.isAlive()?(o.eValue.appendChild(l.getGui()),o.addDestroyFunc(a)):a()}})}else this.eValue.innerText=r},t.prototype.destroy=function(){this.getContext().destroyBean(this.innerCellRenderer),n.prototype.destroy.call(this)},t.prototype.refresh=function(){return!1},t.TEMPLATE=`<span class="ag-cell-wrapper">
            <span class="ag-group-expanded" ref="eExpanded"></span>
            <span class="ag-group-contracted" ref="eContracted"></span>
            <span class="ag-group-checkbox ag-invisible" ref="eCheckbox"></span>
            <span class="ag-group-value" ref="eValue"></span>
            <span class="ag-group-child-count" ref="eChildCount"></span>
        </span>`,__decorate$21([RefSelector("eExpanded")],t.prototype,"eExpanded",void 0),__decorate$21([RefSelector("eContracted")],t.prototype,"eContracted",void 0),__decorate$21([RefSelector("eCheckbox")],t.prototype,"eCheckbox",void 0),__decorate$21([RefSelector("eValue")],t.prototype,"eValue",void 0),__decorate$21([RefSelector("eChildCount")],t.prototype,"eChildCount",void 0),t}(Component),__extends$2f=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$20=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},LoadingCellRenderer=function(n){__extends$2f(t,n);function t(){return n.call(this,t.TEMPLATE)||this}return t.prototype.init=function(e){e.node.failedLoad?this.setupFailed():this.setupLoading()},t.prototype.setupFailed=function(){var e=this.localeService.getLocaleTextFunc();this.eLoadingText.innerText=e("loadingError","ERR")},t.prototype.setupLoading=function(){var e=createIconNoSpan("groupLoading",this.gridOptionsService,null);e&&this.eLoadingIcon.appendChild(e);var r=this.localeService.getLocaleTextFunc();this.eLoadingText.innerText=r("loadingOoo","Loading")},t.prototype.refresh=function(e){return!1},t.prototype.destroy=function(){n.prototype.destroy.call(this)},t.TEMPLATE=`<div class="ag-loading">
            <span class="ag-loading-icon" ref="eLoadingIcon"></span>
            <span class="ag-loading-text" ref="eLoadingText"></span>
        </div>`,__decorate$20([RefSelector("eLoadingIcon")],t.prototype,"eLoadingIcon",void 0),__decorate$20([RefSelector("eLoadingText")],t.prototype,"eLoadingText",void 0),t}(Component),__extends$2e=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),LoadingOverlayComponent$1=function(n){__extends$2e(t,n);function t(){return n.call(this)||this}return t.prototype.destroy=function(){n.prototype.destroy.call(this)},t.prototype.init=function(e){var r,o=(r=this.gridOptionsService.get("overlayLoadingTemplate"))!==null&&r!==void 0?r:t.DEFAULT_LOADING_OVERLAY_TEMPLATE,s=this.localeService.getLocaleTextFunc(),l=o.replace("[LOADING...]",s("loadingOoo","Loading..."));this.setTemplate(l)},t.DEFAULT_LOADING_OVERLAY_TEMPLATE='<span class="ag-overlay-loading-center">[LOADING...]</span>',t}(Component),__extends$2d=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),NoRowsOverlayComponent$1=function(n){__extends$2d(t,n);function t(){return n.call(this)||this}return t.prototype.destroy=function(){n.prototype.destroy.call(this)},t.prototype.init=function(e){var r,o=(r=this.gridOptionsService.get("overlayNoRowsTemplate"))!==null&&r!==void 0?r:t.DEFAULT_NO_ROWS_TEMPLATE,s=this.localeService.getLocaleTextFunc(),l=o.replace("[NO_ROWS_TO_SHOW]",s("noRowsToShow","No Rows To Show"));this.setTemplate(l)},t.DEFAULT_NO_ROWS_TEMPLATE='<span class="ag-overlay-no-rows-center">[NO_ROWS_TO_SHOW]</span>',t}(Component),__extends$2c=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),TooltipComponent$1=function(n){__extends$2c(t,n);function t(){return n.call(this,'<div class="ag-tooltip"></div>')||this}return t.prototype.init=function(e){var r=e.value;this.getGui().innerHTML=escapeString(r)},t}(PopupComponent),__extends$2b=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),NumberCellEditorInput=function(){function n(){}return n.prototype.getTemplate=function(){return'<ag-input-number-field class="ag-cell-editor" ref="eInput"></ag-input-number-field>'},n.prototype.init=function(t,e){this.eInput=t,this.params=e,e.max!=null&&t.setMax(e.max),e.min!=null&&t.setMin(e.min),e.precision!=null&&t.setPrecision(e.precision),e.step!=null&&t.setStep(e.step),e.showStepperButtons&&t.getInputElement().classList.add("ag-number-field-input-stepper")},n.prototype.getValue=function(){var t=this.eInput.getValue();if(!exists(t)&&!exists(this.params.value))return this.params.value;var e=this.params.parseValue(t);if(e==null)return e;if(typeof e=="string"){if(e==="")return null;e=Number(e)}return isNaN(e)?null:e},n.prototype.getStartValue=function(){return this.params.value},n}(),NumberCellEditor=function(n){__extends$2b(t,n);function t(){return n.call(this,new NumberCellEditorInput)||this}return t}(SimpleCellEditor),__extends$2a=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),DateCellEditorInput=function(){function n(){}return n.prototype.getTemplate=function(){return'<ag-input-date-field class="ag-cell-editor" ref="eInput"></ag-input-date-field>'},n.prototype.init=function(t,e){this.eInput=t,this.params=e,e.min!=null&&t.setMin(e.min),e.max!=null&&t.setMax(e.max),e.step!=null&&t.setStep(e.step)},n.prototype.getValue=function(){var t=this.eInput.getDate();return!exists(t)&&!exists(this.params.value)?this.params.value:t??null},n.prototype.getStartValue=function(){var t=this.params.value;if(t instanceof Date)return serialiseDate(t,!1)},n}(),DateCellEditor=function(n){__extends$2a(t,n);function t(){return n.call(this,new DateCellEditorInput)||this}return t}(SimpleCellEditor),__extends$29=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1$=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},DateStringCellEditorInput=function(){function n(t){this.getDataTypeService=t}return n.prototype.getTemplate=function(){return'<ag-input-date-field class="ag-cell-editor" ref="eInput"></ag-input-date-field>'},n.prototype.init=function(t,e){this.eInput=t,this.params=e,e.min!=null&&t.setMin(e.min),e.max!=null&&t.setMax(e.max),e.step!=null&&t.setStep(e.step)},n.prototype.getValue=function(){var t=this.formatDate(this.eInput.getDate());return!exists(t)&&!exists(this.params.value)?this.params.value:this.params.parseValue(t??"")},n.prototype.getStartValue=function(){var t,e;return serialiseDate((e=this.parseDate((t=this.params.value)!==null&&t!==void 0?t:void 0))!==null&&e!==void 0?e:null,!1)},n.prototype.parseDate=function(t){return this.getDataTypeService().getDateParserFunction()(t)},n.prototype.formatDate=function(t){return this.getDataTypeService().getDateFormatterFunction()(t)},n}(),DateStringCellEditor=function(n){__extends$29(t,n);function t(){var e=n.call(this,new DateStringCellEditorInput(function(){return e.dataTypeService}))||this;return e}return __decorate$1$([Autowired("dataTypeService")],t.prototype,"dataTypeService",void 0),t}(SimpleCellEditor),__extends$28=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1_=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},CheckboxCellRenderer=function(n){__extends$28(t,n);function t(){return n.call(this,t.TEMPLATE)||this}return t.prototype.init=function(e){var r=this;this.params=e,this.updateCheckbox(e),this.eCheckbox.getInputElement().setAttribute("tabindex","-1"),this.addManagedListener(this.eCheckbox.getInputElement(),"click",function(s){if(stopPropagationForAgGrid(s),!r.eCheckbox.isDisabled()){var l=r.eCheckbox.getValue();r.onCheckboxChanged(l)}}),this.addManagedListener(this.eCheckbox.getInputElement(),"dblclick",function(s){stopPropagationForAgGrid(s)});var o=this.gridOptionsService.getDocument();this.addManagedListener(this.params.eGridCell,"keydown",function(s){if(s.key===KeyCode.SPACE&&!r.eCheckbox.isDisabled()){r.params.eGridCell===o.activeElement&&r.eCheckbox.toggle();var l=r.eCheckbox.getValue();r.onCheckboxChanged(l),s.preventDefault()}})},t.prototype.refresh=function(e){return this.params=e,this.updateCheckbox(e),!0},t.prototype.updateCheckbox=function(e){var r,o,s,l,a=!0;if(e.node.group&&e.column){var h=e.column.getColId();h.startsWith(GROUP_AUTO_COLUMN_ID)?l=e.value==null||e.value===""?void 0:e.value==="true":e.node.aggData&&e.node.aggData[h]!==void 0?l=(r=e.value)!==null&&r!==void 0?r:void 0:a=!1}else l=(o=e.value)!==null&&o!==void 0?o:void 0;if(!a){this.eCheckbox.setDisplayed(!1);return}this.eCheckbox.setValue(l);var y=e.disabled!=null?e.disabled:!(!((s=e.column)===null||s===void 0)&&s.isCellEditable(e.node));this.eCheckbox.setDisabled(y);var C=this.localeService.getLocaleTextFunc(),L=getAriaCheckboxStateName(C,l),Y=y?L:C("ariaToggleCellValue","Press SPACE to toggle cell value")+" ("+L+")";this.eCheckbox.setInputAriaLabel(Y)},t.prototype.onCheckboxChanged=function(e){var r=this.params,o=r.column,s=r.node,l=r.rowIndex,a=r.value,h={type:Events.EVENT_CELL_EDITING_STARTED,column:o,colDef:o==null?void 0:o.getColDef(),data:s.data,node:s,rowIndex:l,rowPinned:s.rowPinned,value:a};this.eventService.dispatchEvent(h);var y=this.params.node.setDataValue(this.params.column,e,"edit"),C={type:Events.EVENT_CELL_EDITING_STOPPED,column:o,colDef:o==null?void 0:o.getColDef(),data:s.data,node:s,rowIndex:l,rowPinned:s.rowPinned,value:a,oldValue:a,newValue:e,valueChanged:y};this.eventService.dispatchEvent(C)},t.TEMPLATE=`
        <div class="ag-cell-wrapper ag-checkbox-cell" role="presentation">
            <ag-checkbox role="presentation" ref="eCheckbox"></ag-checkbox>
        </div>`,__decorate$1_([RefSelector("eCheckbox")],t.prototype,"eCheckbox",void 0),t}(Component),__extends$27=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1Z=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},CheckboxCellEditor=function(n){__extends$27(t,n);function t(){return n.call(this,`
            <div class="ag-cell-wrapper ag-cell-edit-wrapper ag-checkbox-edit">
                <ag-checkbox role="presentation" ref="eCheckbox"></ag-checkbox>
            </div>`)||this}return t.prototype.init=function(e){var r=this,o;this.params=e;var s=(o=e.value)!==null&&o!==void 0?o:void 0;this.eCheckbox.setValue(s),this.eCheckbox.getInputElement().setAttribute("tabindex","-1"),this.setAriaLabel(s),this.addManagedListener(this.eCheckbox,AgCheckbox.EVENT_CHANGED,function(l){return r.setAriaLabel(l.selected)})},t.prototype.getValue=function(){return this.eCheckbox.getValue()},t.prototype.focusIn=function(){this.eCheckbox.getFocusableElement().focus()},t.prototype.afterGuiAttached=function(){this.params.cellStartedEdit&&this.focusIn()},t.prototype.isPopup=function(){return!1},t.prototype.setAriaLabel=function(e){var r=this.localeService.getLocaleTextFunc(),o=getAriaCheckboxStateName(r,e),s=r("ariaToggleCellValue","Press SPACE to toggle cell value");this.eCheckbox.setInputAriaLabel(s+" ("+o+")")},__decorate$1Z([RefSelector("eCheckbox")],t.prototype,"eCheckbox",void 0),t}(PopupComponent),__extends$26=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1Y=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__read$n=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray$j=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n},UserComponentRegistry=function(n){__extends$26(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.agGridDefaults={agDateInput:DefaultDateComponent,agColumnHeader:HeaderComp,agColumnGroupHeader:HeaderGroupComp,agSortIndicator:SortIndicatorComp,agTextColumnFloatingFilter:TextFloatingFilter,agNumberColumnFloatingFilter:NumberFloatingFilter,agDateColumnFloatingFilter:DateFloatingFilter,agReadOnlyFloatingFilter:ReadOnlyFloatingFilter,agAnimateShowChangeCellRenderer:AnimateShowChangeCellRenderer,agAnimateSlideCellRenderer:AnimateSlideCellRenderer,agGroupCellRenderer:GroupCellRenderer,agGroupRowRenderer:GroupCellRenderer,agLoadingCellRenderer:LoadingCellRenderer,agCheckboxCellRenderer:CheckboxCellRenderer,agCellEditor:TextCellEditor,agTextCellEditor:TextCellEditor,agNumberCellEditor:NumberCellEditor,agDateCellEditor:DateCellEditor,agDateStringCellEditor:DateStringCellEditor,agSelectCellEditor:SelectCellEditor,agLargeTextCellEditor:LargeTextCellEditor,agCheckboxCellEditor:CheckboxCellEditor,agTextColumnFilter:TextFilter,agNumberColumnFilter:NumberFilter,agDateColumnFilter:DateFilter,agLoadingOverlay:LoadingOverlayComponent$1,agNoRowsOverlay:NoRowsOverlayComponent$1,agTooltipComponent:TooltipComponent$1},e.enterpriseAgDefaultCompsModule={agSetColumnFilter:ModuleNames.SetFilterModule,agSetColumnFloatingFilter:ModuleNames.SetFilterModule,agMultiColumnFilter:ModuleNames.MultiFilterModule,agMultiColumnFloatingFilter:ModuleNames.MultiFilterModule,agGroupColumnFilter:ModuleNames.RowGroupingModule,agGroupColumnFloatingFilter:ModuleNames.RowGroupingModule,agRichSelect:ModuleNames.RichSelectModule,agRichSelectCellEditor:ModuleNames.RichSelectModule,agDetailCellRenderer:ModuleNames.MasterDetailModule,agSparklineCellRenderer:ModuleNames.SparklinesModule},e.jsComps={},e}return t.prototype.init=function(){var e=this;this.gridOptions.components!=null&&iterateObject(this.gridOptions.components,function(r,o){return e.registerJsComponent(r,o)})},t.prototype.registerDefaultComponent=function(e,r){if(this.agGridDefaults[e]){console.error("Trying to overwrite a default component. You should call registerComponent");return}this.agGridDefaults[e]=r},t.prototype.registerJsComponent=function(e,r){this.jsComps[e]=r},t.prototype.retrieve=function(e,r){var o=this,s=function(L,Y){return{componentFromFramework:Y,component:L}},l=this.getFrameworkOverrides().frameworkComponent(r,this.gridOptions.components);if(l!=null)return s(l,!0);var a=this.jsComps[r];if(a){var h=this.getFrameworkOverrides().isFrameworkComponent(a);return s(a,h)}var y=this.agGridDefaults[r];if(y)return s(y,!1);var C=this.enterpriseAgDefaultCompsModule[r];return C?ModuleRegistry.__assertRegistered(C,"AG Grid '"+e+"' component: "+r,this.context.getGridId()):doOnce(function(){o.warnAboutMissingComponent(e,r)},"MissingComp"+r),null},t.prototype.warnAboutMissingComponent=function(e,r){var o=__spreadArray$j(__spreadArray$j([],__read$n(Object.keys(this.agGridDefaults).filter(function(l){return!["agCellEditor","agGroupRowRenderer","agSortIndicator"].includes(l)}))),__read$n(Object.keys(this.jsComps))),s=fuzzySuggestions(r,o,!0,.8);console.warn("AG Grid: Could not find '"+r+`' component. It was configured as "`+e+": '"+r+`'" but it wasn't found in the list of registered components.`),s.length>0&&console.warn("         Did you mean: ["+s.slice(0,3)+"]?"),console.warn("If using a custom component check it has been registered as described in: https://ag-grid.com/javascript-data-grid/components/")},__decorate$1Y([Autowired("gridOptions")],t.prototype,"gridOptions",void 0),__decorate$1Y([PostConstruct],t.prototype,"init",null),t=__decorate$1Y([Bean("userComponentRegistry")],t),t}(BeanStub),DateComponent={propertyName:"dateComponent",cellRenderer:!1},HeaderComponent={propertyName:"headerComponent",cellRenderer:!1},HeaderGroupComponent={propertyName:"headerGroupComponent",cellRenderer:!1},CellRendererComponent={propertyName:"cellRenderer",cellRenderer:!0},CellEditorComponent={propertyName:"cellEditor",cellRenderer:!1},InnerRendererComponent={propertyName:"innerRenderer",cellRenderer:!0},LoadingOverlayComponent={propertyName:"loadingOverlayComponent",cellRenderer:!1},NoRowsOverlayComponent={propertyName:"noRowsOverlayComponent",cellRenderer:!1},TooltipComponent={propertyName:"tooltipComponent",cellRenderer:!1},FilterComponent={propertyName:"filter",cellRenderer:!1},FloatingFilterComponent={propertyName:"floatingFilterComponent",cellRenderer:!1},ToolPanelComponent={propertyName:"toolPanel",cellRenderer:!1},StatusPanelComponent={propertyName:"statusPanel",cellRenderer:!1},FullWidth={propertyName:"fullWidthCellRenderer",cellRenderer:!0},FullWidthLoading={propertyName:"loadingCellRenderer",cellRenderer:!0},FullWidthGroup={propertyName:"groupRowRenderer",cellRenderer:!0},FullWidthDetail={propertyName:"detailCellRenderer",cellRenderer:!0},FloatingFilterMapper=function(){function n(){}return n.getFloatingFilterType=function(t){return this.filterToFloatingFilterMapping[t]},n.filterToFloatingFilterMapping={set:"agSetColumnFloatingFilter",agSetColumnFilter:"agSetColumnFloatingFilter",multi:"agMultiColumnFloatingFilter",agMultiColumnFilter:"agMultiColumnFloatingFilter",group:"agGroupColumnFloatingFilter",agGroupColumnFilter:"agGroupColumnFloatingFilter",number:"agNumberColumnFloatingFilter",agNumberColumnFilter:"agNumberColumnFloatingFilter",date:"agDateColumnFloatingFilter",agDateColumnFilter:"agDateColumnFloatingFilter",text:"agTextColumnFloatingFilter",agTextColumnFilter:"agTextColumnFloatingFilter"},n}(),__extends$25=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1X=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},UserComponentFactory=function(n){__extends$25(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.getHeaderCompDetails=function(e,r){return this.getCompDetails(e,HeaderComponent,"agColumnHeader",r)},t.prototype.getHeaderGroupCompDetails=function(e){var r=e.columnGroup.getColGroupDef();return this.getCompDetails(r,HeaderGroupComponent,"agColumnGroupHeader",e)},t.prototype.getFullWidthCellRendererDetails=function(e){return this.getCompDetails(this.gridOptions,FullWidth,null,e,!0)},t.prototype.getFullWidthLoadingCellRendererDetails=function(e){return this.getCompDetails(this.gridOptions,FullWidthLoading,"agLoadingCellRenderer",e,!0)},t.prototype.getFullWidthGroupCellRendererDetails=function(e){return this.getCompDetails(this.gridOptions,FullWidthGroup,"agGroupRowRenderer",e,!0)},t.prototype.getFullWidthDetailCellRendererDetails=function(e){return this.getCompDetails(this.gridOptions,FullWidthDetail,"agDetailCellRenderer",e,!0)},t.prototype.getInnerRendererDetails=function(e,r){return this.getCompDetails(e,InnerRendererComponent,null,r)},t.prototype.getFullWidthGroupRowInnerCellRenderer=function(e,r){return this.getCompDetails(e,InnerRendererComponent,null,r)},t.prototype.getCellRendererDetails=function(e,r){return this.getCompDetails(e,CellRendererComponent,null,r)},t.prototype.getCellEditorDetails=function(e,r){return this.getCompDetails(e,CellEditorComponent,"agCellEditor",r,!0)},t.prototype.getFilterDetails=function(e,r,o){return this.getCompDetails(e,FilterComponent,o,r,!0)},t.prototype.getDateCompDetails=function(e){return this.getCompDetails(this.gridOptions,DateComponent,"agDateInput",e,!0)},t.prototype.getLoadingOverlayCompDetails=function(e){return this.getCompDetails(this.gridOptions,LoadingOverlayComponent,"agLoadingOverlay",e,!0)},t.prototype.getNoRowsOverlayCompDetails=function(e){return this.getCompDetails(this.gridOptions,NoRowsOverlayComponent,"agNoRowsOverlay",e,!0)},t.prototype.getTooltipCompDetails=function(e){return this.getCompDetails(e.colDef,TooltipComponent,"agTooltipComponent",e,!0)},t.prototype.getSetFilterCellRendererDetails=function(e,r){return this.getCompDetails(e,CellRendererComponent,null,r)},t.prototype.getFloatingFilterCompDetails=function(e,r,o){return this.getCompDetails(e,FloatingFilterComponent,o,r)},t.prototype.getToolPanelCompDetails=function(e,r){return this.getCompDetails(e,ToolPanelComponent,null,r,!0)},t.prototype.getStatusPanelCompDetails=function(e,r){return this.getCompDetails(e,StatusPanelComponent,null,r,!0)},t.prototype.getCompDetails=function(e,r,o,s,l){var a=this;l===void 0&&(l=!1);var h=r.propertyName,y=r.cellRenderer,C=this.getCompKeys(e,r,s),L=C.compName,Y=C.jsComp,ze=C.fwComp,Bt=C.paramsFromSelector,Ir=C.popupFromSelector,Wr=C.popupPositionFromSelector,yi=function(ia){var gl=a.userComponentRegistry.retrieve(h,ia);gl&&(Y=gl.componentFromFramework?void 0:gl.component,ze=gl.componentFromFramework?gl.component:void 0)};if(L!=null&&yi(L),Y==null&&ze==null&&o!=null&&yi(o),Y&&y&&!this.agComponentUtils.doesImplementIComponent(Y)&&(Y=this.agComponentUtils.adaptFunction(h,Y)),!Y&&!ze){l&&console.error("AG Grid: Could not find component "+L+", did you forget to configure this component?");return}var Bn=this.mergeParamsWithApplicationProvidedParams(e,r,s,Bt),vi=Y==null,wo=Y||ze;return{componentFromFramework:vi,componentClass:wo,params:Bn,type:r,popupFromSelector:Ir,popupPositionFromSelector:Wr,newAgStackInstance:function(){return a.newAgStackInstance(wo,vi,Bn,r)}}},t.prototype.getCompKeys=function(e,r,o){var s=this,l=r.propertyName,a,h,y,C,L,Y;if(e){var ze=e,Bt=ze[l+"Selector"],Ir=Bt?Bt(o):null,Wr=function(yi){if(typeof yi=="string")a=yi;else if(yi!=null&&yi!==!0){var Bn=s.getFrameworkOverrides().isFrameworkComponent(yi);Bn?y=yi:h=yi}};Ir?(Wr(Ir.component),C=Ir.params,L=Ir.popup,Y=Ir.popupPosition):Wr(ze[l])}return{compName:a,jsComp:h,fwComp:y,paramsFromSelector:C,popupFromSelector:L,popupPositionFromSelector:Y}},t.prototype.newAgStackInstance=function(e,r,o,s){var l=s.propertyName,a=!r,h;if(a)h=new e;else{var y=this.componentMetadataProvider.retrieve(l);h=this.frameworkComponentWrapper.wrap(e,y.mandatoryMethodList,y.optionalMethodList,s)}var C=this.initComponent(h,o);return C==null?AgPromise.resolve(h):C.then(function(){return h})},t.prototype.mergeParamsWithApplicationProvidedParams=function(e,r,o,s){s===void 0&&(s=null);var l={context:this.gridOptionsService.context,columnApi:this.gridOptionsService.columnApi,api:this.gridOptionsService.api};mergeDeep(l,o);var a=e,h=a&&a[r.propertyName+"Params"];if(typeof h=="function"){var y=h(o);mergeDeep(l,y)}else typeof h=="object"&&mergeDeep(l,h);return mergeDeep(l,s),l},t.prototype.initComponent=function(e,r){if(this.context.createBean(e),e.init!=null)return e.init(r)},t.prototype.getDefaultFloatingFilterType=function(e,r){if(e==null)return null;var o=null,s=this.getCompKeys(e,FilterComponent),l=s.compName,a=s.jsComp,h=s.fwComp;if(l)o=FloatingFilterMapper.getFloatingFilterType(l);else{var y=a==null&&h==null&&e.filter===!0;y&&(o=r())}return o},__decorate$1X([Autowired("gridOptions")],t.prototype,"gridOptions",void 0),__decorate$1X([Autowired("agComponentUtils")],t.prototype,"agComponentUtils",void 0),__decorate$1X([Autowired("componentMetadataProvider")],t.prototype,"componentMetadataProvider",void 0),__decorate$1X([Autowired("userComponentRegistry")],t.prototype,"userComponentRegistry",void 0),__decorate$1X([Optional("frameworkComponentWrapper")],t.prototype,"frameworkComponentWrapper",void 0),t=__decorate$1X([Bean("userComponentFactory")],t),t}(BeanStub),ExcelFactoryMode;(function(n){n[n.SINGLE_SHEET=0]="SINGLE_SHEET",n[n.MULTI_SHEET=1]="MULTI_SHEET"})(ExcelFactoryMode||(ExcelFactoryMode={}));var __extends$24=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1W=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},DragService=function(n){__extends$24(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.dragEndFunctions=[],e.dragSources=[],e}return t.prototype.removeAllListeners=function(){this.dragSources.forEach(this.removeListener.bind(this)),this.dragSources.length=0},t.prototype.removeListener=function(e){var r=e.dragSource.eElement,o=e.mouseDownListener;if(r.removeEventListener("mousedown",o),e.touchEnabled){var s=e.touchStartListener;r.removeEventListener("touchstart",s,{passive:!0})}},t.prototype.removeDragSource=function(e){var r=this.dragSources.find(function(o){return o.dragSource===e});r&&(this.removeListener(r),removeFromArray(this.dragSources,r))},t.prototype.isDragging=function(){return this.dragging},t.prototype.addDragSource=function(e){var r=this,o=this.onMouseDown.bind(this,e),s=e.eElement,l=e.includeTouch,a=e.stopPropagationForTouch;s.addEventListener("mousedown",o);var h=null,y=this.gridOptionsService.is("suppressTouch");l&&!y&&(h=function(C){isFocusableFormField(C.target)||(C.cancelable&&(C.preventDefault(),a&&C.stopPropagation()),r.onTouchStart(e,C))},s.addEventListener("touchstart",h,{passive:!1})),this.dragSources.push({dragSource:e,mouseDownListener:o,touchStartListener:h,touchEnabled:!!l})},t.prototype.getStartTarget=function(){return this.startTarget},t.prototype.onTouchStart=function(e,r){var o=this;this.currentDragParams=e,this.dragging=!1;var s=r.touches[0];this.touchLastTime=s,this.touchStart=s;var l=function(L){return o.onTouchMove(L,e.eElement)},a=function(L){return o.onTouchUp(L,e.eElement)},h=function(L){L.cancelable&&L.preventDefault()},y=r.target,C=[{target:this.gridOptionsService.getRootNode(),type:"touchmove",listener:h,options:{passive:!1}},{target:y,type:"touchmove",listener:l,options:{passive:!0}},{target:y,type:"touchend",listener:a,options:{passive:!0}},{target:y,type:"touchcancel",listener:a,options:{passive:!0}}];this.addTemporaryEvents(C),e.dragStartPixels===0&&this.onCommonMove(s,this.touchStart,e.eElement)},t.prototype.onMouseDown=function(e,r){var o=this,s=r;if(!(e.skipMouseEvent&&e.skipMouseEvent(r))&&!s._alreadyProcessedByDragService&&(s._alreadyProcessedByDragService=!0,r.button===0)){this.shouldPreventMouseEvent(r)&&r.preventDefault(),this.currentDragParams=e,this.dragging=!1,this.mouseStartEvent=r,this.startTarget=r.target;var l=function(L){return o.onMouseMove(L,e.eElement)},a=function(L){return o.onMouseUp(L,e.eElement)},h=function(L){return L.preventDefault()},y=this.gridOptionsService.getRootNode(),C=[{target:y,type:"mousemove",listener:l},{target:y,type:"mouseup",listener:a},{target:y,type:"contextmenu",listener:h}];this.addTemporaryEvents(C),e.dragStartPixels===0&&this.onMouseMove(r,e.eElement)}},t.prototype.addTemporaryEvents=function(e){e.forEach(function(r){var o=r.target,s=r.type,l=r.listener,a=r.options;o.addEventListener(s,l,a)}),this.dragEndFunctions.push(function(){e.forEach(function(r){var o=r.target,s=r.type,l=r.listener,a=r.options;o.removeEventListener(s,l,a)})})},t.prototype.isEventNearStartEvent=function(e,r){var o=this.currentDragParams.dragStartPixels,s=exists(o)?o:4;return areEventsNear(e,r,s)},t.prototype.getFirstActiveTouch=function(e){for(var r=0;r<e.length;r++)if(e[r].identifier===this.touchStart.identifier)return e[r];return null},t.prototype.onCommonMove=function(e,r,o){if(!this.dragging){if(!this.dragging&&this.isEventNearStartEvent(e,r))return;this.dragging=!0;var s={type:Events.EVENT_DRAG_STARTED,target:o};this.eventService.dispatchEvent(s),this.currentDragParams.onDragStart(r),this.currentDragParams.onDragging(r)}this.currentDragParams.onDragging(e)},t.prototype.onTouchMove=function(e,r){var o=this.getFirstActiveTouch(e.touches);o&&this.onCommonMove(o,this.touchStart,r)},t.prototype.onMouseMove=function(e,r){this.shouldPreventMouseEvent(e)&&e.preventDefault(),this.onCommonMove(e,this.mouseStartEvent,r)},t.prototype.shouldPreventMouseEvent=function(e){var r=this.gridOptionsService.is("enableCellTextSelection"),o=isBrowserSafari(),s=e.type==="mousemove";return(r&&s||o)&&e.cancelable&&this.mouseEventService.isEventFromThisGrid(e)&&!this.isOverFormFieldElement(e)},t.prototype.isOverFormFieldElement=function(e){var r=e.target,o=r==null?void 0:r.tagName.toLocaleLowerCase();return!!(o!=null&&o.match("^a$|textarea|input|select|button"))},t.prototype.onTouchUp=function(e,r){var o=this.getFirstActiveTouch(e.changedTouches);o||(o=this.touchLastTime),this.onUpCommon(o,r)},t.prototype.onMouseUp=function(e,r){this.onUpCommon(e,r)},t.prototype.onUpCommon=function(e,r){if(this.dragging){this.dragging=!1,this.currentDragParams.onDragStop(e);var o={type:Events.EVENT_DRAG_STOPPED,target:r};this.eventService.dispatchEvent(o)}this.mouseStartEvent=null,this.startTarget=null,this.touchStart=null,this.touchLastTime=null,this.currentDragParams=null,this.dragEndFunctions.forEach(function(s){return s()}),this.dragEndFunctions.length=0},__decorate$1W([Autowired("mouseEventService")],t.prototype,"mouseEventService",void 0),__decorate$1W([PreDestroy],t.prototype,"removeAllListeners",null),t=__decorate$1W([Bean("dragService")],t),t}(BeanStub),RowHighlightPosition;(function(n){n[n.Above=0]="Above",n[n.Below=1]="Below"})(RowHighlightPosition||(RowHighlightPosition={}));var ClientSideRowModelSteps;(function(n){n.EVERYTHING="group",n.FILTER="filter",n.SORT="sort",n.MAP="map",n.AGGREGATE="aggregate",n.FILTER_AGGREGATES="filter_aggregates",n.PIVOT="pivot",n.NOTHING="nothing"})(ClientSideRowModelSteps||(ClientSideRowModelSteps={}));var __decorate$1V=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};function unwrapUserComp(n){var t=n,e=t!=null&&t.getFrameworkComponentInstance!=null;return e?t.getFrameworkComponentInstance():n}var GridApi=function(){function n(){this.detailGridInfoMap={},this.destroyCalled=!1}return n.prototype.registerOverlayWrapperComp=function(t){this.overlayWrapperComp=t},n.prototype.registerSideBarComp=function(t){this.sideBarComp=t},n.prototype.init=function(){var t=this;switch(this.rowModel.getType()){case"clientSide":this.clientSideRowModel=this.rowModel;break;case"infinite":this.infiniteRowModel=this.rowModel;break;case"serverSide":this.serverSideRowModel=this.rowModel;break}this.ctrlsService.whenReady(function(){t.gridBodyCtrl=t.ctrlsService.getGridBodyCtrl()})},n.prototype.__getAlignedGridService=function(){return this.alignedGridsService},n.prototype.__getContext=function(){return this.context},n.prototype.getSetterMethod=function(t){return"set"+t.charAt(0).toUpperCase()+t.substring(1)},n.prototype.__setProperty=function(t,e){this.gridOptionsService.set(t,e);var r=this.getSetterMethod(t),o=this;o[r]&&o[r](e)},n.prototype.getGridId=function(){return this.context.getGridId()},n.prototype.addDetailGridInfo=function(t,e){this.detailGridInfoMap[t]=e},n.prototype.removeDetailGridInfo=function(t){this.detailGridInfoMap[t]=void 0},n.prototype.getDetailGridInfo=function(t){return this.detailGridInfoMap[t]},n.prototype.forEachDetailGridInfo=function(t){var e=0;iterateObject(this.detailGridInfoMap,function(r,o){exists(o)&&(t(o,e),e++)})},n.prototype.getDataAsCsv=function(t){if(ModuleRegistry.__assertRegistered(ModuleNames.CsvExportModule,"api.getDataAsCsv",this.context.getGridId()))return this.csvCreator.getDataAsCsv(t)},n.prototype.exportDataAsCsv=function(t){ModuleRegistry.__assertRegistered(ModuleNames.CsvExportModule,"api.exportDataAsCSv",this.context.getGridId())&&this.csvCreator.exportDataAsCsv(t)},n.prototype.getExcelExportMode=function(t){var e=this.gridOptionsService.get("defaultExcelExportParams"),r=Object.assign({exportMode:"xlsx"},e,t);return r.exportMode},n.prototype.assertNotExcelMultiSheet=function(t,e){if(!ModuleRegistry.__assertRegistered(ModuleNames.ExcelExportModule,"api."+t,this.context.getGridId()))return!1;var r=this.getExcelExportMode(e);return this.excelCreator.getFactoryMode(r)===ExcelFactoryMode.MULTI_SHEET?(console.warn("AG Grid: The Excel Exporter is currently on Multi Sheet mode. End that operation by calling 'api.getMultipleSheetAsExcel()' or 'api.exportMultipleSheetsAsExcel()'"),!1):!0},n.prototype.getDataAsExcel=function(t){if(this.assertNotExcelMultiSheet("getDataAsExcel",t))return this.excelCreator.getDataAsExcel(t)},n.prototype.exportDataAsExcel=function(t){this.assertNotExcelMultiSheet("exportDataAsExcel",t)&&this.excelCreator.exportDataAsExcel(t)},n.prototype.getSheetDataForExcel=function(t){if(ModuleRegistry.__assertRegistered(ModuleNames.ExcelExportModule,"api.getSheetDataForExcel",this.context.getGridId())){var e=this.getExcelExportMode(t);return this.excelCreator.setFactoryMode(ExcelFactoryMode.MULTI_SHEET,e),this.excelCreator.getSheetDataForExcel(t)}},n.prototype.getMultipleSheetsAsExcel=function(t){if(ModuleRegistry.__assertRegistered(ModuleNames.ExcelExportModule,"api.getMultipleSheetsAsExcel",this.context.getGridId()))return this.excelCreator.getMultipleSheetsAsExcel(t)},n.prototype.exportMultipleSheetsAsExcel=function(t){if(ModuleRegistry.__assertRegistered(ModuleNames.ExcelExportModule,"api.exportMultipleSheetsAsExcel",this.context.getGridId()))return this.excelCreator.exportMultipleSheetsAsExcel(t)},n.prototype.setGridAriaProperty=function(t,e){if(t){var r=this.ctrlsService.getGridBodyCtrl().getGui(),o="aria-"+t;e===null?r.removeAttribute(o):r.setAttribute(o,e)}},n.prototype.logMissingRowModel=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];console.error("AG Grid: api."+t+" can only be called when gridOptions.rowModelType is "+e.join(" or "))},n.prototype.setServerSideDatasource=function(t){this.serverSideRowModel?this.serverSideRowModel.setDatasource(t):this.logMissingRowModel("setServerSideDatasource","serverSide")},n.prototype.setCacheBlockSize=function(t){this.serverSideRowModel?(this.gridOptionsService.set("cacheBlockSize",t),this.serverSideRowModel.resetRootStore()):this.logMissingRowModel("setCacheBlockSize","serverSide")},n.prototype.setDatasource=function(t){this.gridOptionsService.isRowModelType("infinite")?this.rowModel.setDatasource(t):this.logMissingRowModel("setDatasource","infinite")},n.prototype.setViewportDatasource=function(t){this.gridOptionsService.isRowModelType("viewport")?this.rowModel.setViewportDatasource(t):this.logMissingRowModel("setViewportDatasource","viewport")},n.prototype.setRowData=function(t){var e=this.immutableService==null;if(e){this.logMissingRowModel("setRowData","clientSide");return}this.immutableService.isActive()?this.immutableService.setRowData(t):(this.selectionService.reset(),this.clientSideRowModel.setRowData(t))},n.prototype.setPinnedTopRowData=function(t){this.pinnedRowModel.setPinnedTopRowData(t)},n.prototype.setPinnedBottomRowData=function(t){this.pinnedRowModel.setPinnedBottomRowData(t)},n.prototype.getPinnedTopRowCount=function(){return this.pinnedRowModel.getPinnedTopRowCount()},n.prototype.getPinnedBottomRowCount=function(){return this.pinnedRowModel.getPinnedBottomRowCount()},n.prototype.getPinnedTopRow=function(t){return this.pinnedRowModel.getPinnedTopRow(t)},n.prototype.getPinnedBottomRow=function(t){return this.pinnedRowModel.getPinnedBottomRow(t)},n.prototype.setColumnDefs=function(t,e){e===void 0&&(e="api"),this.columnModel.setColumnDefs(t,e),this.gridOptionsService.set("columnDefs",t,!0,{source:e})},n.prototype.setAutoGroupColumnDef=function(t,e){e===void 0&&(e="api"),this.gridOptionsService.set("autoGroupColumnDef",t,!0,{source:e})},n.prototype.setDefaultColDef=function(t,e){e===void 0&&(e="api"),this.gridOptionsService.set("defaultColDef",t,!0,{source:e})},n.prototype.setColumnTypes=function(t,e){e===void 0&&(e="api"),this.gridOptionsService.set("columnTypes",t,!0,{source:e})},n.prototype.expireValueCache=function(){this.valueCache.expire()},n.prototype.getVerticalPixelRange=function(){return this.gridBodyCtrl.getScrollFeature().getVScrollPosition()},n.prototype.getHorizontalPixelRange=function(){return this.gridBodyCtrl.getScrollFeature().getHScrollPosition()},n.prototype.setAlwaysShowHorizontalScroll=function(t){this.gridOptionsService.set("alwaysShowHorizontalScroll",t)},n.prototype.setAlwaysShowVerticalScroll=function(t){this.gridOptionsService.set("alwaysShowVerticalScroll",t)},n.prototype.refreshCells=function(t){t===void 0&&(t={}),this.rowRenderer.refreshCells(t)},n.prototype.flashCells=function(t){t===void 0&&(t={}),this.rowRenderer.flashCells(t)},n.prototype.redrawRows=function(t){t===void 0&&(t={});var e=t?t.rowNodes:void 0;this.rowRenderer.redrawRows(e)},n.prototype.setFunctionsReadOnly=function(t){this.gridOptionsService.set("functionsReadOnly",t)},n.prototype.refreshHeader=function(){this.ctrlsService.getHeaderRowContainerCtrls().forEach(function(t){return t.refresh()})},n.prototype.isAnyFilterPresent=function(){return this.filterManager.isAnyFilterPresent()},n.prototype.isColumnFilterPresent=function(){return this.filterManager.isColumnFilterPresent()||this.filterManager.isAggregateFilterPresent()},n.prototype.isQuickFilterPresent=function(){return this.filterManager.isQuickFilterPresent()},n.prototype.getModel=function(){return this.rowModel},n.prototype.setRowNodeExpanded=function(t,e,r){t&&(r&&t.parent&&t.parent.level!==-1&&this.setRowNodeExpanded(t.parent,e,r),t.setExpanded(e))},n.prototype.onGroupExpandedOrCollapsed=function(){if(missing(this.clientSideRowModel)){this.logMissingRowModel("onGroupExpandedOrCollapsed","clientSide");return}this.clientSideRowModel.refreshModel({step:ClientSideRowModelSteps.MAP})},n.prototype.refreshClientSideRowModel=function(t){if(missing(this.clientSideRowModel)){this.logMissingRowModel("refreshClientSideRowModel","clientSide");return}this.clientSideRowModel.refreshModel(t)},n.prototype.isAnimationFrameQueueEmpty=function(){return this.animationFrameService.isQueueEmpty()},n.prototype.flushAllAnimationFrames=function(){this.animationFrameService.flushAllFrames()},n.prototype.getRowNode=function(t){return this.rowModel.getRowNode(t)},n.prototype.getSizesForCurrentTheme=function(){return{rowHeight:this.gridOptionsService.getRowHeightAsNumber(),headerHeight:this.columnModel.getHeaderHeight()}},n.prototype.expandAll=function(){this.clientSideRowModel?this.clientSideRowModel.expandOrCollapseAll(!0):this.serverSideRowModel?this.serverSideRowModel.expandAll(!0):this.logMissingRowModel("expandAll","clientSide","serverSide")},n.prototype.collapseAll=function(){this.clientSideRowModel?this.clientSideRowModel.expandOrCollapseAll(!1):this.serverSideRowModel?this.serverSideRowModel.expandAll(!1):this.logMissingRowModel("expandAll","clientSide","serverSide")},n.prototype.addRenderedRowListener=function(t,e,r){this.rowRenderer.addRenderedRowListener(t,e,r)},n.prototype.getQuickFilter=function(){return this.gridOptionsService.get("quickFilterText")},n.prototype.setQuickFilter=function(t){this.gridOptionsService.set("quickFilterText",t)},n.prototype.setExcludeHiddenColumnsFromQuickFilter=function(t){logDeprecation("30","setExcludeHiddenColumnsFromQuickFilter",void 0,"Hidden columns are now excluded from the Quick Filter by default. This can be toggled using `setIncludeHiddenColumnsInQuickFilter`"),this.setIncludeHiddenColumnsInQuickFilter(!t)},n.prototype.setIncludeHiddenColumnsInQuickFilter=function(t){this.gridOptionsService.set("includeHiddenColumnsInQuickFilter",t)},n.prototype.setNodesSelected=function(t){var e=t.nodes.every(function(a){return a.rowPinned?(console.warn("AG Grid: cannot select pinned rows"),!1):a.id===void 0?(console.warn("AG Grid: cannot select node until id for node is known"),!1):!0});if(e){var r=t.nodes,o=t.source,s=t.newValue,l=r;this.selectionService.setNodesSelected({nodes:l,source:o??"api",newValue:s})}},n.prototype.selectAll=function(t){t===void 0&&(t="apiSelectAll"),this.selectionService.selectAllRowNodes({source:t})},n.prototype.deselectAll=function(t){t===void 0&&(t="apiSelectAll"),this.selectionService.deselectAllRowNodes({source:t})},n.prototype.selectAllFiltered=function(t){t===void 0&&(t="apiSelectAllFiltered"),this.selectionService.selectAllRowNodes({source:t,justFiltered:!0})},n.prototype.deselectAllFiltered=function(t){t===void 0&&(t="apiSelectAllFiltered"),this.selectionService.deselectAllRowNodes({source:t,justFiltered:!0})},n.prototype.getServerSideSelectionState=function(){return missing(this.serverSideRowModel)?(this.logMissingRowModel("getServerSideSelectionState","serverSide"),null):this.selectionService.getServerSideSelectionState()},n.prototype.setServerSideSelectionState=function(t){if(missing(this.serverSideRowModel)){this.logMissingRowModel("setServerSideSelectionState","serverSide");return}this.selectionService.setServerSideSelectionState(t)},n.prototype.selectAllOnCurrentPage=function(t){t===void 0&&(t="apiSelectAllCurrentPage"),this.selectionService.selectAllRowNodes({source:t,justCurrentPage:!0})},n.prototype.deselectAllOnCurrentPage=function(t){t===void 0&&(t="apiSelectAllCurrentPage"),this.selectionService.deselectAllRowNodes({source:t,justCurrentPage:!0})},n.prototype.sizeColumnsToFit=function(t){this.gridBodyCtrl.sizeColumnsToFit(t)},n.prototype.showLoadingOverlay=function(){this.overlayWrapperComp.showLoadingOverlay()},n.prototype.showNoRowsOverlay=function(){this.overlayWrapperComp.showNoRowsOverlay()},n.prototype.hideOverlay=function(){this.overlayWrapperComp.hideOverlay()},n.prototype.getSelectedNodes=function(){return this.selectionService.getSelectedNodes()},n.prototype.getSelectedRows=function(){return this.selectionService.getSelectedRows()},n.prototype.getBestCostNodeSelection=function(){if(missing(this.clientSideRowModel)){this.logMissingRowModel("getBestCostNodeSelection","clientSide");return}return this.selectionService.getBestCostNodeSelection()},n.prototype.getRenderedNodes=function(){return this.rowRenderer.getRenderedNodes()},n.prototype.ensureColumnVisible=function(t,e){e===void 0&&(e="auto"),this.gridBodyCtrl.getScrollFeature().ensureColumnVisible(t,e)},n.prototype.ensureIndexVisible=function(t,e){this.gridBodyCtrl.getScrollFeature().ensureIndexVisible(t,e)},n.prototype.ensureNodeVisible=function(t,e){e===void 0&&(e=null),this.gridBodyCtrl.getScrollFeature().ensureNodeVisible(t,e)},n.prototype.forEachLeafNode=function(t){if(missing(this.clientSideRowModel)){this.logMissingRowModel("forEachLeafNode","clientSide");return}this.clientSideRowModel.forEachLeafNode(t)},n.prototype.forEachNode=function(t,e){this.rowModel.forEachNode(t,e)},n.prototype.forEachNodeAfterFilter=function(t){if(missing(this.clientSideRowModel)){this.logMissingRowModel("forEachNodeAfterFilter","clientSide");return}this.clientSideRowModel.forEachNodeAfterFilter(t)},n.prototype.forEachNodeAfterFilterAndSort=function(t){if(missing(this.clientSideRowModel)){this.logMissingRowModel("forEachNodeAfterFilterAndSort","clientSide");return}this.clientSideRowModel.forEachNodeAfterFilterAndSort(t)},n.prototype.getFilterInstance=function(t,e){var r=this.getFilterInstanceImpl(t,function(s){if(e){var l=unwrapUserComp(s);e(l)}}),o=unwrapUserComp(r);return o},n.prototype.getFilterInstanceImpl=function(t,e){var r=this.columnModel.getPrimaryColumn(t);if(r){var o=this.filterManager.getFilterComponent(r,"NO_UI"),s=o&&o.resolveNow(null,function(l){return l});return s?setTimeout(e,0,s):o&&o.then(function(l){e(l)}),s}},n.prototype.destroyFilter=function(t){var e=this.columnModel.getPrimaryColumn(t);if(e)return this.filterManager.destroyFilter(e,"api")},n.prototype.getStatusPanel=function(t){if(ModuleRegistry.__assertRegistered(ModuleNames.StatusBarModule,"api.getStatusPanel",this.context.getGridId())){var e=this.statusBarService.getStatusPanel(t);return unwrapUserComp(e)}},n.prototype.getColumnDef=function(t){var e=this.columnModel.getPrimaryColumn(t);return e?e.getColDef():null},n.prototype.getColumnDefs=function(){return this.columnModel.getColumnDefs()},n.prototype.onFilterChanged=function(){this.filterManager.onFilterChanged()},n.prototype.onSortChanged=function(){this.sortController.onSortChanged("api")},n.prototype.setFilterModel=function(t){this.filterManager.setFilterModel(t)},n.prototype.getFilterModel=function(){return this.filterManager.getFilterModel()},n.prototype.getFocusedCell=function(){return this.focusService.getFocusedCell()},n.prototype.clearFocusedCell=function(){return this.focusService.clearFocusedCell()},n.prototype.setFocusedCell=function(t,e,r){this.focusService.setFocusedCell({rowIndex:t,column:e,rowPinned:r,forceBrowserFocus:!0})},n.prototype.setSuppressRowDrag=function(t){this.gridOptionsService.set("suppressRowDrag",t)},n.prototype.setSuppressMoveWhenRowDragging=function(t){this.gridOptionsService.set("suppressMoveWhenRowDragging",t)},n.prototype.setSuppressRowClickSelection=function(t){this.gridOptionsService.set("suppressRowClickSelection",t)},n.prototype.addRowDropZone=function(t){this.gridBodyCtrl.getRowDragFeature().addRowDropZone(t)},n.prototype.removeRowDropZone=function(t){var e=this.dragAndDropService.findExternalZone(t);e&&this.dragAndDropService.removeDropTarget(e)},n.prototype.getRowDropZoneParams=function(t){return this.gridBodyCtrl.getRowDragFeature().getRowDropZone(t)},n.prototype.setHeaderHeight=function(t){this.gridOptionsService.set("headerHeight",t)},n.prototype.setDomLayout=function(t){this.gridOptionsService.set("domLayout",t)},n.prototype.setEnableCellTextSelection=function(t){this.gridBodyCtrl.setCellTextSelection(t)},n.prototype.setFillHandleDirection=function(t){this.gridOptionsService.set("fillHandleDirection",t)},n.prototype.setGroupHeaderHeight=function(t){this.gridOptionsService.set("groupHeaderHeight",t)},n.prototype.setFloatingFiltersHeight=function(t){this.gridOptionsService.set("floatingFiltersHeight",t)},n.prototype.setPivotHeaderHeight=function(t){this.gridOptionsService.set("pivotHeaderHeight",t)},n.prototype.setPivotGroupHeaderHeight=function(t){this.gridOptionsService.set("pivotGroupHeaderHeight",t)},n.prototype.setPivotMode=function(t){this.columnModel.setPivotMode(t)},n.prototype.setAnimateRows=function(t){this.gridOptionsService.set("animateRows",t)},n.prototype.setIsExternalFilterPresent=function(t){this.gridOptionsService.set("isExternalFilterPresent",t)},n.prototype.setDoesExternalFilterPass=function(t){this.gridOptionsService.set("doesExternalFilterPass",t)},n.prototype.setNavigateToNextCell=function(t){this.gridOptionsService.set("navigateToNextCell",t)},n.prototype.setTabToNextCell=function(t){this.gridOptionsService.set("tabToNextCell",t)},n.prototype.setTabToNextHeader=function(t){this.gridOptionsService.set("tabToNextHeader",t)},n.prototype.setNavigateToNextHeader=function(t){this.gridOptionsService.set("navigateToNextHeader",t)},n.prototype.setRowGroupPanelShow=function(t){this.gridOptionsService.set("rowGroupPanelShow",t)},n.prototype.setGetGroupRowAgg=function(t){this.gridOptionsService.set("getGroupRowAgg",t)},n.prototype.setGetBusinessKeyForNode=function(t){this.gridOptionsService.set("getBusinessKeyForNode",t)},n.prototype.setGetChildCount=function(t){this.gridOptionsService.set("getChildCount",t)},n.prototype.setProcessRowPostCreate=function(t){this.gridOptionsService.set("processRowPostCreate",t)},n.prototype.setGetRowId=function(t){this.gridOptionsService.set("getRowId",t)},n.prototype.setGetRowClass=function(t){this.gridOptionsService.set("getRowClass",t)},n.prototype.setIsFullWidthRow=function(t){this.gridOptionsService.set("isFullWidthRow",t)},n.prototype.setIsRowSelectable=function(t){this.gridOptionsService.set("isRowSelectable",t)},n.prototype.setIsRowMaster=function(t){this.gridOptionsService.set("isRowMaster",t)},n.prototype.setPostSortRows=function(t){this.gridOptionsService.set("postSortRows",t)},n.prototype.setGetDocument=function(t){this.gridOptionsService.set("getDocument",t)},n.prototype.setGetContextMenuItems=function(t){this.gridOptionsService.set("getContextMenuItems",t)},n.prototype.setGetMainMenuItems=function(t){this.gridOptionsService.set("getMainMenuItems",t)},n.prototype.setProcessCellForClipboard=function(t){this.gridOptionsService.set("processCellForClipboard",t)},n.prototype.setSendToClipboard=function(t){this.gridOptionsService.set("sendToClipboard",t)},n.prototype.setProcessCellFromClipboard=function(t){this.gridOptionsService.set("processCellFromClipboard",t)},n.prototype.setProcessSecondaryColDef=function(t){logDeprecation("28.0","setProcessSecondaryColDef","setProcessPivotResultColDef"),this.setProcessPivotResultColDef(t)},n.prototype.setProcessSecondaryColGroupDef=function(t){logDeprecation("28.0","setProcessSecondaryColGroupDef","setProcessPivotResultColGroupDef"),this.setProcessPivotResultColGroupDef(t)},n.prototype.setProcessPivotResultColDef=function(t){this.gridOptionsService.set("processPivotResultColDef",t)},n.prototype.setProcessPivotResultColGroupDef=function(t){this.gridOptionsService.set("processPivotResultColGroupDef",t)},n.prototype.setPostProcessPopup=function(t){this.gridOptionsService.set("postProcessPopup",t)},n.prototype.setInitialGroupOrderComparator=function(t){this.gridOptionsService.set("initialGroupOrderComparator",t)},n.prototype.setGetChartToolbarItems=function(t){this.gridOptionsService.set("getChartToolbarItems",t)},n.prototype.setPaginationNumberFormatter=function(t){this.gridOptionsService.set("paginationNumberFormatter",t)},n.prototype.setGetServerSideStoreParams=function(t){logDeprecation("28.0","setGetServerSideStoreParams","setGetServerSideGroupLevelParams"),this.setGetServerSideGroupLevelParams(t)},n.prototype.setGetServerSideGroupLevelParams=function(t){this.gridOptionsService.set("getServerSideGroupLevelParams",t)},n.prototype.setIsServerSideGroupOpenByDefault=function(t){this.gridOptionsService.set("isServerSideGroupOpenByDefault",t)},n.prototype.setIsApplyServerSideTransaction=function(t){this.gridOptionsService.set("isApplyServerSideTransaction",t)},n.prototype.setIsServerSideGroup=function(t){this.gridOptionsService.set("isServerSideGroup",t)},n.prototype.setGetServerSideGroupKey=function(t){this.gridOptionsService.set("getServerSideGroupKey",t)},n.prototype.setGetRowStyle=function(t){this.gridOptionsService.set("getRowStyle",t)},n.prototype.setGetRowHeight=function(t){this.gridOptionsService.set("getRowHeight",t)},n.prototype.assertSideBarLoaded=function(t){return ModuleRegistry.__assertRegistered(ModuleNames.SideBarModule,"api."+t,this.context.getGridId())},n.prototype.isSideBarVisible=function(){return this.assertSideBarLoaded("isSideBarVisible")&&this.sideBarComp.isDisplayed()},n.prototype.setSideBarVisible=function(t){this.assertSideBarLoaded("setSideBarVisible")&&this.sideBarComp.setDisplayed(t)},n.prototype.setSideBarPosition=function(t){this.assertSideBarLoaded("setSideBarPosition")&&this.sideBarComp.setSideBarPosition(t)},n.prototype.openToolPanel=function(t){this.assertSideBarLoaded("openToolPanel")&&this.sideBarComp.openToolPanel(t,"api")},n.prototype.closeToolPanel=function(){this.assertSideBarLoaded("closeToolPanel")&&this.sideBarComp.close("api")},n.prototype.getOpenedToolPanel=function(){return this.assertSideBarLoaded("getOpenedToolPanel")?this.sideBarComp.openedItem():null},n.prototype.refreshToolPanel=function(){this.assertSideBarLoaded("refreshToolPanel")&&this.sideBarComp.refresh()},n.prototype.isToolPanelShowing=function(){return this.assertSideBarLoaded("isToolPanelShowing")&&this.sideBarComp.isToolPanelShowing()},n.prototype.getToolPanelInstance=function(t){if(this.assertSideBarLoaded("getToolPanelInstance")){var e=this.sideBarComp.getToolPanelInstance(t);return unwrapUserComp(e)}},n.prototype.getSideBar=function(){if(this.assertSideBarLoaded("getSideBar"))return this.sideBarComp.getDef()},n.prototype.setSideBar=function(t){this.gridOptionsService.set("sideBar",t)},n.prototype.setSuppressClipboardPaste=function(t){this.gridOptionsService.set("suppressClipboardPaste",t)},n.prototype.resetRowHeights=function(){if(exists(this.clientSideRowModel)){if(this.columnModel.isAutoRowHeightActive()){console.warn("AG Grid: calling gridApi.resetRowHeights() makes no sense when using Auto Row Height.");return}this.clientSideRowModel.resetRowHeights()}},n.prototype.setGroupRemoveSingleChildren=function(t){this.gridOptionsService.set("groupRemoveSingleChildren",t)},n.prototype.setGroupRemoveLowestSingleChildren=function(t){this.gridOptionsService.set("groupRemoveLowestSingleChildren",t)},n.prototype.setGroupDisplayType=function(t){this.gridOptionsService.set("groupDisplayType",t)},n.prototype.setRowClass=function(t){this.gridOptionsService.set("rowClass",t)},n.prototype.setDeltaSort=function(t){this.gridOptionsService.set("deltaSort",t)},n.prototype.setRowCount=function(t,e){if(this.serverSideRowModel){if(this.columnModel.isRowGroupEmpty()){this.serverSideRowModel.setRowCount(t,e);return}console.error("AG Grid: setRowCount cannot be used while using row grouping.");return}if(this.infiniteRowModel){this.infiniteRowModel.setRowCount(t,e);return}this.logMissingRowModel("setRowCount","infinite","serverSide")},n.prototype.onRowHeightChanged=function(){this.clientSideRowModel?this.clientSideRowModel.onRowHeightChanged():this.serverSideRowModel&&this.serverSideRowModel.onRowHeightChanged()},n.prototype.getValue=function(t,e){var r=this.columnModel.getPrimaryColumn(t);return missing(r)&&(r=this.columnModel.getGridColumn(t)),missing(r)?null:this.valueService.getValue(r,e)},n.prototype.addEventListener=function(t,e){var r=this.gridOptionsService.useAsyncEvents();this.eventService.addEventListener(t,e,r)},n.prototype.addGlobalListener=function(t){var e=this.gridOptionsService.useAsyncEvents();this.eventService.addGlobalListener(t,e)},n.prototype.removeEventListener=function(t,e){var r=this.gridOptionsService.useAsyncEvents();this.eventService.removeEventListener(t,e,r)},n.prototype.removeGlobalListener=function(t){var e=this.gridOptionsService.useAsyncEvents();this.eventService.removeGlobalListener(t,e)},n.prototype.dispatchEvent=function(t){this.eventService.dispatchEvent(t)},n.prototype.destroy=function(){if(!this.destroyCalled){this.destroyCalled=!0;var t=this.ctrlsService.getGridCtrl();t&&t.destroyGridUi(),this.context.destroy()}},n.prototype.cleanDownReferencesToAvoidMemoryLeakInCaseApplicationIsKeepingReferenceToDestroyedGrid=function(){setTimeout(removeAllReferences.bind(window,this,"Grid API"),100)},n.prototype.warnIfDestroyed=function(t){return this.destroyCalled&&console.warn("AG Grid: Grid API method "+t+" was called on a grid that was destroyed."),this.destroyCalled},n.prototype.resetQuickFilter=function(){this.warnIfDestroyed("resetQuickFilter")||this.filterManager.resetQuickFilterCache()},n.prototype.getCellRanges=function(){return this.rangeService?this.rangeService.getCellRanges():(ModuleRegistry.__assertRegistered(ModuleNames.RangeSelectionModule,"api.getCellRanges",this.context.getGridId()),null)},n.prototype.addCellRange=function(t){if(this.rangeService){this.rangeService.addCellRange(t);return}ModuleRegistry.__assertRegistered(ModuleNames.RangeSelectionModule,"api.addCellRange",this.context.getGridId())},n.prototype.clearRangeSelection=function(){this.rangeService&&this.rangeService.removeAllCellRanges(),ModuleRegistry.__assertRegistered(ModuleNames.RangeSelectionModule,"gridApi.clearRangeSelection",this.context.getGridId())},n.prototype.undoCellEditing=function(){this.undoRedoService.undo("api")},n.prototype.redoCellEditing=function(){this.undoRedoService.redo("api")},n.prototype.getCurrentUndoSize=function(){return this.undoRedoService.getCurrentUndoStackSize()},n.prototype.getCurrentRedoSize=function(){return this.undoRedoService.getCurrentRedoStackSize()},n.prototype.getChartModels=function(){if(ModuleRegistry.__assertRegistered(ModuleNames.GridChartsModule,"api.getChartModels",this.context.getGridId()))return this.chartService.getChartModels()},n.prototype.getChartRef=function(t){if(ModuleRegistry.__assertRegistered(ModuleNames.GridChartsModule,"api.getChartRef",this.context.getGridId()))return this.chartService.getChartRef(t)},n.prototype.getChartImageDataURL=function(t){if(ModuleRegistry.__assertRegistered(ModuleNames.GridChartsModule,"api.getChartImageDataURL",this.context.getGridId()))return this.chartService.getChartImageDataURL(t)},n.prototype.downloadChart=function(t){if(ModuleRegistry.__assertRegistered(ModuleNames.GridChartsModule,"api.downloadChart",this.context.getGridId()))return this.chartService.downloadChart(t)},n.prototype.openChartToolPanel=function(t){if(ModuleRegistry.__assertRegistered(ModuleNames.GridChartsModule,"api.openChartToolPanel",this.context.getGridId()))return this.chartService.openChartToolPanel(t)},n.prototype.closeChartToolPanel=function(t){if(ModuleRegistry.__assertRegistered(ModuleNames.GridChartsModule,"api.closeChartToolPanel",this.context.getGridId()))return this.chartService.closeChartToolPanel(t.chartId)},n.prototype.createRangeChart=function(t){if(ModuleRegistry.__assertRegistered(ModuleNames.GridChartsModule,"api.createRangeChart",this.context.getGridId()))return this.chartService.createRangeChart(t)},n.prototype.createPivotChart=function(t){if(ModuleRegistry.__assertRegistered(ModuleNames.GridChartsModule,"api.createPivotChart",this.context.getGridId()))return this.chartService.createPivotChart(t)},n.prototype.createCrossFilterChart=function(t){if(ModuleRegistry.__assertRegistered(ModuleNames.GridChartsModule,"api.createCrossFilterChart",this.context.getGridId()))return this.chartService.createCrossFilterChart(t)},n.prototype.updateChart=function(t){ModuleRegistry.__assertRegistered(ModuleNames.GridChartsModule,"api.updateChart",this.context.getGridId())&&this.chartService.updateChart(t)},n.prototype.restoreChart=function(t,e){if(ModuleRegistry.__assertRegistered(ModuleNames.GridChartsModule,"api.restoreChart",this.context.getGridId()))return this.chartService.restoreChart(t,e)},n.prototype.copyToClipboard=function(t){ModuleRegistry.__assertRegistered(ModuleNames.ClipboardModule,"api.copyToClipboard",this.context.getGridId())&&this.clipboardService.copyToClipboard(t)},n.prototype.cutToClipboard=function(t){ModuleRegistry.__assertRegistered(ModuleNames.ClipboardModule,"api.cutToClipboard",this.context.getGridId())&&this.clipboardService.cutToClipboard(t,"api")},n.prototype.copySelectedRowsToClipboard=function(t){ModuleRegistry.__assertRegistered(ModuleNames.ClipboardModule,"api.copySelectedRowsToClipboard",this.context.getGridId())&&this.clipboardService.copySelectedRowsToClipboard(t)},n.prototype.copySelectedRangeToClipboard=function(t){ModuleRegistry.__assertRegistered(ModuleNames.ClipboardModule,"api.copySelectedRangeToClipboard",this.context.getGridId())&&this.clipboardService.copySelectedRangeToClipboard(t)},n.prototype.copySelectedRangeDown=function(){ModuleRegistry.__assertRegistered(ModuleNames.ClipboardModule,"api.copySelectedRangeDown",this.context.getGridId())&&this.clipboardService.copyRangeDown()},n.prototype.pasteFromClipboard=function(){ModuleRegistry.__assertRegistered(ModuleNames.ClipboardModule,"api.pasteFromClipboard",this.context.getGridId())&&this.clipboardService.pasteFromClipboard()},n.prototype.showColumnMenuAfterButtonClick=function(t,e){var r=this.columnModel.getGridColumn(t);this.menuFactory.showMenuAfterButtonClick(r,e,"columnMenu")},n.prototype.showColumnMenuAfterMouseClick=function(t,e){var r=this.columnModel.getGridColumn(t);if(r||(r=this.columnModel.getPrimaryColumn(t)),!r){console.error("AG Grid: column '"+t+"' not found");return}this.menuFactory.showMenuAfterMouseEvent(r,e)},n.prototype.hidePopupMenu=function(){this.contextMenuFactory&&this.contextMenuFactory.hideActiveMenu(),this.menuFactory.hideActiveMenu()},n.prototype.setPopupParent=function(t){this.gridOptionsService.set("popupParent",t)},n.prototype.tabToNextCell=function(t){return this.navigationService.tabToNextCell(!1,t)},n.prototype.tabToPreviousCell=function(t){return this.navigationService.tabToNextCell(!0,t)},n.prototype.getCellRendererInstances=function(t){t===void 0&&(t={});var e=this.rowRenderer.getCellRendererInstances(t),r=e.map(unwrapUserComp);return r},n.prototype.getCellEditorInstances=function(t){t===void 0&&(t={});var e=this.rowRenderer.getCellEditorInstances(t),r=e.map(unwrapUserComp);return r},n.prototype.getEditingCells=function(){return this.rowRenderer.getEditingCells()},n.prototype.stopEditing=function(t){t===void 0&&(t=!1),this.rowRenderer.stopEditing(t)},n.prototype.startEditingCell=function(t){var e=this.columnModel.getGridColumn(t.colKey);if(!e){console.warn("AG Grid: no column found for "+t.colKey);return}var r={rowIndex:t.rowIndex,rowPinned:t.rowPinned||null,column:e},o=t.rowPinned==null;o&&this.gridBodyCtrl.getScrollFeature().ensureIndexVisible(t.rowIndex);var s=this.navigationService.getCellByPosition(r);s&&s.startRowOrCellEdit(t.key)},n.prototype.addAggFunc=function(t,e){this.aggFuncService&&this.aggFuncService.addAggFunc(t,e)},n.prototype.addAggFuncs=function(t){this.aggFuncService&&this.aggFuncService.addAggFuncs(t)},n.prototype.clearAggFuncs=function(){this.aggFuncService&&this.aggFuncService.clear()},n.prototype.applyServerSideTransaction=function(t){if(!this.serverSideTransactionManager){this.logMissingRowModel("applyServerSideTransaction","serverSide");return}return this.serverSideTransactionManager.applyTransaction(t)},n.prototype.applyServerSideTransactionAsync=function(t,e){if(!this.serverSideTransactionManager){this.logMissingRowModel("applyServerSideTransactionAsync","serverSide");return}return this.serverSideTransactionManager.applyTransactionAsync(t,e)},n.prototype.retryServerSideLoads=function(){if(!this.serverSideRowModel){this.logMissingRowModel("retryServerSideLoads","serverSide");return}this.serverSideRowModel.retryLoads()},n.prototype.flushServerSideAsyncTransactions=function(){if(!this.serverSideTransactionManager){this.logMissingRowModel("flushServerSideAsyncTransactions","serverSide");return}return this.serverSideTransactionManager.flushAsyncTransactions()},n.prototype.applyTransaction=function(t){if(!this.clientSideRowModel){this.logMissingRowModel("applyTransaction","clientSide");return}return this.clientSideRowModel.updateRowData(t)},n.prototype.applyTransactionAsync=function(t,e){if(!this.clientSideRowModel){this.logMissingRowModel("applyTransactionAsync","clientSide");return}this.clientSideRowModel.batchUpdateRowData(t,e)},n.prototype.flushAsyncTransactions=function(){if(!this.clientSideRowModel){this.logMissingRowModel("flushAsyncTransactions","clientSide");return}this.clientSideRowModel.flushAsyncTransactions()},n.prototype.setSuppressModelUpdateAfterUpdateTransaction=function(t){this.gridOptionsService.set("suppressModelUpdateAfterUpdateTransaction",t)},n.prototype.refreshInfiniteCache=function(){this.infiniteRowModel?this.infiniteRowModel.refreshCache():this.logMissingRowModel("refreshInfiniteCache","infinite")},n.prototype.purgeInfiniteCache=function(){this.infiniteRowModel?this.infiniteRowModel.purgeCache():this.logMissingRowModel("purgeInfiniteCache","infinite")},n.prototype.refreshServerSide=function(t){if(!this.serverSideRowModel){this.logMissingRowModel("refreshServerSide","serverSide");return}this.serverSideRowModel.refreshStore(t)},n.prototype.refreshServerSideStore=function(t){return logDeprecation("28.0","refreshServerSideStore","refreshServerSide"),this.refreshServerSide(t)},n.prototype.getServerSideStoreState=function(){return logDeprecation("28.0","getServerSideStoreState","getServerSideGroupLevelState"),this.getServerSideGroupLevelState()},n.prototype.getServerSideGroupLevelState=function(){return this.serverSideRowModel?this.serverSideRowModel.getStoreState():(this.logMissingRowModel("getServerSideGroupLevelState","serverSide"),[])},n.prototype.getInfiniteRowCount=function(){if(this.infiniteRowModel)return this.infiniteRowModel.getRowCount();this.logMissingRowModel("getInfiniteRowCount","infinite")},n.prototype.isLastRowIndexKnown=function(){if(this.infiniteRowModel)return this.infiniteRowModel.isLastRowIndexKnown();this.logMissingRowModel("isLastRowIndexKnown","infinite")},n.prototype.getCacheBlockState=function(){return this.rowNodeBlockLoader.getBlockState()},n.prototype.getFirstDisplayedRow=function(){return this.rowRenderer.getFirstVirtualRenderedRow()},n.prototype.getLastDisplayedRow=function(){return this.rowRenderer.getLastVirtualRenderedRow()},n.prototype.getDisplayedRowAtIndex=function(t){return this.rowModel.getRow(t)},n.prototype.getDisplayedRowCount=function(){return this.rowModel.getRowCount()},n.prototype.setDataTypeDefinitions=function(t){this.gridOptionsService.set("dataTypeDefinitions",t)},n.prototype.setPagination=function(t){this.gridOptionsService.set("pagination",t)},n.prototype.paginationIsLastPageFound=function(){return this.paginationProxy.isLastPageFound()},n.prototype.paginationGetPageSize=function(){return this.paginationProxy.getPageSize()},n.prototype.paginationSetPageSize=function(t){this.gridOptionsService.set("paginationPageSize",t)},n.prototype.paginationGetCurrentPage=function(){return this.paginationProxy.getCurrentPage()},n.prototype.paginationGetTotalPages=function(){return this.paginationProxy.getTotalPages()},n.prototype.paginationGetRowCount=function(){return this.paginationProxy.getMasterRowCount()},n.prototype.paginationGoToNextPage=function(){this.paginationProxy.goToNextPage()},n.prototype.paginationGoToPreviousPage=function(){this.paginationProxy.goToPreviousPage()},n.prototype.paginationGoToFirstPage=function(){this.paginationProxy.goToFirstPage()},n.prototype.paginationGoToLastPage=function(){this.paginationProxy.goToLastPage()},n.prototype.paginationGoToPage=function(t){this.paginationProxy.goToPage(t)},__decorate$1V([Optional("immutableService")],n.prototype,"immutableService",void 0),__decorate$1V([Optional("csvCreator")],n.prototype,"csvCreator",void 0),__decorate$1V([Optional("excelCreator")],n.prototype,"excelCreator",void 0),__decorate$1V([Autowired("rowRenderer")],n.prototype,"rowRenderer",void 0),__decorate$1V([Autowired("navigationService")],n.prototype,"navigationService",void 0),__decorate$1V([Autowired("filterManager")],n.prototype,"filterManager",void 0),__decorate$1V([Autowired("columnModel")],n.prototype,"columnModel",void 0),__decorate$1V([Autowired("selectionService")],n.prototype,"selectionService",void 0),__decorate$1V([Autowired("gridOptionsService")],n.prototype,"gridOptionsService",void 0),__decorate$1V([Autowired("valueService")],n.prototype,"valueService",void 0),__decorate$1V([Autowired("alignedGridsService")],n.prototype,"alignedGridsService",void 0),__decorate$1V([Autowired("eventService")],n.prototype,"eventService",void 0),__decorate$1V([Autowired("pinnedRowModel")],n.prototype,"pinnedRowModel",void 0),__decorate$1V([Autowired("context")],n.prototype,"context",void 0),__decorate$1V([Autowired("rowModel")],n.prototype,"rowModel",void 0),__decorate$1V([Autowired("sortController")],n.prototype,"sortController",void 0),__decorate$1V([Autowired("paginationProxy")],n.prototype,"paginationProxy",void 0),__decorate$1V([Autowired("focusService")],n.prototype,"focusService",void 0),__decorate$1V([Autowired("dragAndDropService")],n.prototype,"dragAndDropService",void 0),__decorate$1V([Optional("rangeService")],n.prototype,"rangeService",void 0),__decorate$1V([Optional("clipboardService")],n.prototype,"clipboardService",void 0),__decorate$1V([Optional("aggFuncService")],n.prototype,"aggFuncService",void 0),__decorate$1V([Autowired("menuFactory")],n.prototype,"menuFactory",void 0),__decorate$1V([Optional("contextMenuFactory")],n.prototype,"contextMenuFactory",void 0),__decorate$1V([Autowired("valueCache")],n.prototype,"valueCache",void 0),__decorate$1V([Autowired("animationFrameService")],n.prototype,"animationFrameService",void 0),__decorate$1V([Optional("statusBarService")],n.prototype,"statusBarService",void 0),__decorate$1V([Optional("chartService")],n.prototype,"chartService",void 0),__decorate$1V([Optional("undoRedoService")],n.prototype,"undoRedoService",void 0),__decorate$1V([Optional("rowNodeBlockLoader")],n.prototype,"rowNodeBlockLoader",void 0),__decorate$1V([Optional("ssrmTransactionManager")],n.prototype,"serverSideTransactionManager",void 0),__decorate$1V([Autowired("ctrlsService")],n.prototype,"ctrlsService",void 0),__decorate$1V([PostConstruct],n.prototype,"init",null),__decorate$1V([PreDestroy],n.prototype,"cleanDownReferencesToAvoidMemoryLeakInCaseApplicationIsKeepingReferenceToDestroyedGrid",null),n=__decorate$1V([Bean("gridApi")],n),n}(),__extends$23=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__assign$c=function(){return __assign$c=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},__assign$c.apply(this,arguments)},__decorate$1U=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},FilterManager=function(n){__extends$23(t,n);function t(){var r=n!==null&&n.apply(this,arguments)||this;return r.allColumnFilters=new Map,r.allColumnListeners=new Map,r.activeAggregateFilters=[],r.activeColumnFilters=[],r.quickFilter=null,r.quickFilterParts=null,r.processingFilterChange=!1,r}e=t,t.prototype.init=function(){var r=this;this.addManagedListener(this.eventService,Events.EVENT_GRID_COLUMNS_CHANGED,function(){return r.onColumnsChanged()}),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_VALUE_CHANGED,function(){return r.refreshFiltersForAggregations()}),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_PIVOT_CHANGED,function(){return r.refreshFiltersForAggregations()}),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_PIVOT_MODE_CHANGED,function(){r.refreshFiltersForAggregations(),r.resetQuickFilterCache()}),this.addManagedListener(this.eventService,Events.EVENT_NEW_COLUMNS_LOADED,function(){return r.resetQuickFilterCache()}),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_ROW_GROUP_CHANGED,function(){return r.resetQuickFilterCache()}),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_VISIBLE,function(){r.gridOptionsService.is("includeHiddenColumnsInQuickFilter")||r.resetQuickFilterCache()}),this.addManagedPropertyListener("quickFilterText",function(o){return r.setQuickFilter(o.currentValue)}),this.addManagedPropertyListener("includeHiddenColumnsInQuickFilter",function(){return r.onIncludeHiddenColumnsInQuickFilterChanged()}),this.quickFilter=this.parseQuickFilter(this.gridOptionsService.get("quickFilterText")),this.setQuickFilterParts(),this.allowShowChangeAfterFilter=this.gridOptionsService.is("allowShowChangeAfterFilter"),this.externalFilterPresent=this.isExternalFilterPresentCallback(),this.updateAggFiltering(),this.addManagedPropertyListener("groupAggFiltering",function(){return r.updateAggFiltering()})},t.prototype.isExternalFilterPresentCallback=function(){var r=this.gridOptionsService.getCallback("isExternalFilterPresent");return typeof r=="function"?r({}):!1},t.prototype.doesExternalFilterPass=function(r){var o=this.gridOptionsService.get("doesExternalFilterPass");return typeof o=="function"?o(r):!1},t.prototype.setQuickFilterParts=function(){this.quickFilterParts=this.quickFilter?this.quickFilter.split(" "):null},t.prototype.setFilterModel=function(r){var o=this,s=[],l=this.getFilterModel();if(r){var a=convertToSet(Object.keys(r));this.allColumnFilters.forEach(function(h,y){var C=r[y];s.push(o.setModelOnFilterWrapper(h.filterPromise,C)),a.delete(y)}),a.forEach(function(h){var y=o.columnModel.getPrimaryColumn(h)||o.columnModel.getGridColumn(h);if(!y){console.warn("AG Grid: setFilterModel() - no column found for colId: "+h);return}if(!y.isFilterAllowed()){console.warn("AG Grid: setFilterModel() - unable to fully apply model, filtering disabled for colId: "+h);return}var C=o.getOrCreateFilterWrapper(y,"NO_UI");if(!C){console.warn("AG-Grid: setFilterModel() - unable to fully apply model, unable to create filter for colId: "+h);return}s.push(o.setModelOnFilterWrapper(C.filterPromise,r[h]))})}else this.allColumnFilters.forEach(function(h){s.push(o.setModelOnFilterWrapper(h.filterPromise,null))});AgPromise.all(s).then(function(){var h=o.getFilterModel(),y=[];o.allColumnFilters.forEach(function(C,L){var Y=l?l[L]:null,ze=h?h[L]:null;_.jsonEquals(Y,ze)||y.push(C.column)}),y.length>0&&o.onFilterChanged({columns:y})})},t.prototype.setModelOnFilterWrapper=function(r,o){return new AgPromise(function(s){r.then(function(l){typeof l.setModel!="function"&&(console.warn("AG Grid: filter missing setModel method, which is needed for setFilterModel"),s()),(l.setModel(o)||AgPromise.resolve()).then(function(){return s()})})})},t.prototype.getFilterModel=function(){var r={};return this.allColumnFilters.forEach(function(o,s){var l=o.filterPromise,a=l.resolveNow(null,function(y){return y});if(a==null)return null;if(typeof a.getModel!="function"){console.warn("AG Grid: filter API missing getModel method, which is needed for getFilterModel");return}var h=a.getModel();exists(h)&&(r[s]=h)}),r},t.prototype.isColumnFilterPresent=function(){return this.activeColumnFilters.length>0},t.prototype.isAggregateFilterPresent=function(){return!!this.activeAggregateFilters.length},t.prototype.isExternalFilterPresent=function(){return this.externalFilterPresent},t.prototype.doAggregateFiltersPass=function(r,o){return this.doColumnFiltersPass(r,o,!0)},t.prototype.updateActiveFilters=function(){var r=this;this.activeColumnFilters.length=0,this.activeAggregateFilters.length=0;var o=function(a){return a?a.isFilterActive?a.isFilterActive():(console.warn("AG Grid: Filter is missing isFilterActive() method"),!1):!1},s=!!this.gridOptionsService.getGroupAggFiltering(),l=function(a){var h=!a.isPrimary();if(h)return!0;var y=!r.columnModel.isPivotActive(),C=a.isValueActive();return!C||!y?!1:r.columnModel.isPivotMode()?!0:s};this.allColumnFilters.forEach(function(a){if(a.filterPromise.resolveNow(!1,o)){var h=a.filterPromise.resolveNow(null,function(y){return y});l(a.column)?r.activeAggregateFilters.push(h):r.activeColumnFilters.push(h)}})},t.prototype.updateFilterFlagInColumns=function(r,o){this.allColumnFilters.forEach(function(s){var l=s.filterPromise.resolveNow(!1,function(a){return a.isFilterActive()});s.column.setFilterActive(l,r,o)})},t.prototype.isAnyFilterPresent=function(){return this.isQuickFilterPresent()||this.isColumnFilterPresent()||this.isAggregateFilterPresent()||this.isExternalFilterPresent()},t.prototype.doColumnFiltersPass=function(r,o,s){for(var l=r.data,a=r.aggData,h=s?this.activeAggregateFilters:this.activeColumnFilters,y=s?a:l,C=0;C<h.length;C++){var L=h[C];if(!(L==null||L===o)){if(typeof L.doesFilterPass!="function")throw new Error("Filter is missing method doesFilterPass");if(!L.doesFilterPass({node:r,data:y}))return!1}}return!0},t.prototype.parseQuickFilter=function(r){return exists(r)?this.gridOptionsService.isRowModelType("clientSide")?r.toUpperCase():(console.warn("AG Grid - Quick filtering only works with the Client-Side Row Model"),null):null},t.prototype.setQuickFilter=function(r){if(r!=null&&typeof r!="string"){console.warn("AG Grid - setQuickFilter() only supports string inputs, received: "+typeof r);return}var o=this.parseQuickFilter(r);this.quickFilter!==o&&(this.quickFilter=o,this.setQuickFilterParts(),this.onFilterChanged())},t.prototype.resetQuickFilterCache=function(){this.rowModel.forEachNode(function(r){return r.quickFilterAggregateText=null})},t.prototype.onIncludeHiddenColumnsInQuickFilterChanged=function(){this.columnModel.refreshQuickFilterColumns(),this.resetQuickFilterCache(),this.isQuickFilterPresent()&&this.onFilterChanged()},t.prototype.refreshFiltersForAggregations=function(){var r=this.gridOptionsService.getGroupAggFiltering();r&&this.onFilterChanged()},t.prototype.callOnFilterChangedOutsideRenderCycle=function(r){var o=this;r===void 0&&(r={});var s=function(){return o.onFilterChanged(r)};this.rowRenderer.isRefreshInProgress()?setTimeout(s,0):s()},t.prototype.onFilterChanged=function(r){r===void 0&&(r={});var o=r.filterInstance,s=r.additionalEventAttributes,l=r.columns;this.updateDependantFilters(),this.updateActiveFilters(),this.updateFilterFlagInColumns("filterChanged",s),this.externalFilterPresent=this.isExternalFilterPresentCallback(),this.allColumnFilters.forEach(function(h){h.filterPromise&&h.filterPromise.then(function(y){y&&y!==o&&y.onAnyFilterChanged&&y.onAnyFilterChanged()})});var a={type:Events.EVENT_FILTER_CHANGED,columns:l||[]};s&&mergeDeep(a,s),this.processingFilterChange=!0,this.eventService.dispatchEvent(a),this.processingFilterChange=!1},t.prototype.isSuppressFlashingCellsBecauseFiltering=function(){return!this.allowShowChangeAfterFilter&&this.processingFilterChange},t.prototype.isQuickFilterPresent=function(){return this.quickFilter!==null},t.prototype.updateAggFiltering=function(){this.aggFiltering=!!this.gridOptionsService.getGroupAggFiltering()},t.prototype.isAggregateQuickFilterPresent=function(){return this.isQuickFilterPresent()&&(this.aggFiltering||this.columnModel.isPivotMode())},t.prototype.isNonAggregateQuickFilterPresent=function(){return this.isQuickFilterPresent()&&!(this.aggFiltering||this.columnModel.isPivotMode())},t.prototype.doesRowPassOtherFilters=function(r,o){return this.doesRowPassFilter({rowNode:o,filterInstanceToSkip:r})},t.prototype.doesRowPassQuickFilterNoCache=function(r,o){var s=this,l=this.columnModel.getAllColumnsForQuickFilter();return l.some(function(a){var h=s.getQuickFilterTextForColumn(a,r);return exists(h)&&h.indexOf(o)>=0})},t.prototype.doesRowPassQuickFilterCache=function(r,o){return r.quickFilterAggregateText||this.aggregateRowForQuickFilter(r),r.quickFilterAggregateText.indexOf(o)>=0},t.prototype.doesRowPassQuickFilter=function(r){var o=this,s=this.gridOptionsService.is("cacheQuickFilter");return this.quickFilterParts.every(function(l){return s?o.doesRowPassQuickFilterCache(r,l):o.doesRowPassQuickFilterNoCache(r,l)})},t.prototype.doesRowPassAggregateFilters=function(r){return!(this.isAggregateQuickFilterPresent()&&!this.doesRowPassQuickFilter(r.rowNode)||this.isAggregateFilterPresent()&&!this.doAggregateFiltersPass(r.rowNode,r.filterInstanceToSkip))},t.prototype.doesRowPassFilter=function(r){return!(this.isNonAggregateQuickFilterPresent()&&!this.doesRowPassQuickFilter(r.rowNode)||this.isExternalFilterPresent()&&!this.doesExternalFilterPass(r.rowNode)||this.isColumnFilterPresent()&&!this.doColumnFiltersPass(r.rowNode,r.filterInstanceToSkip))},t.prototype.getQuickFilterTextForColumn=function(r,o){var s=this.valueService.getValue(r,o,!0),l=r.getColDef();if(l.getQuickFilterText){var a={value:s,node:o,data:o.data,column:r,colDef:l,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context};s=l.getQuickFilterText(a)}return exists(s)?s.toString().toUpperCase():null},t.prototype.aggregateRowForQuickFilter=function(r){var o=this,s=[],l=this.columnModel.getAllColumnsForQuickFilter();l.forEach(function(a){var h=o.getQuickFilterTextForColumn(a,r);exists(h)&&s.push(h)}),r.quickFilterAggregateText=s.join(e.QUICK_FILTER_SEPARATOR)},t.prototype.onNewRowsLoaded=function(r){this.allColumnFilters.forEach(function(o){o.filterPromise.then(function(s){s.onNewRowsLoaded&&s.onNewRowsLoaded()})}),this.updateFilterFlagInColumns(r,{afterDataChange:!0}),this.updateActiveFilters()},t.prototype.createValueGetter=function(r){var o=this;return function(s){var l=s.node;return o.valueService.getValue(r,l,!0)}},t.prototype.getFilterComponent=function(r,o,s){var l;if(s===void 0&&(s=!0),s)return((l=this.getOrCreateFilterWrapper(r,o))===null||l===void 0?void 0:l.filterPromise)||null;var a=this.cachedFilter(r);return a?a.filterPromise:null},t.prototype.isFilterActive=function(r){var o=this.cachedFilter(r);return!!o&&o.filterPromise.resolveNow(!1,function(s){return s.isFilterActive()})},t.prototype.getOrCreateFilterWrapper=function(r,o){var s=this;if(!r.isFilterAllowed())return null;var l=this.cachedFilter(r);if(l)o!=="NO_UI"&&this.putIntoGui(l,o);else{l=this.createFilterWrapper(r,o);var a=r.getColId();this.allColumnFilters.set(a,l),this.allColumnListeners.set(a,this.addManagedListener(r,Column.EVENT_COL_DEF_CHANGED,function(){return s.checkDestroyFilter(a)}))}return l},t.prototype.cachedFilter=function(r){return this.allColumnFilters.get(r.getColId())},t.prototype.getDefaultFilter=function(r){var o;if(ModuleRegistry.__isRegistered(ModuleNames.SetFilterModule,this.context.getGridId()))o="agSetColumnFilter";else{var s=r.getColDef().cellDataType;s==="number"?o="agNumberColumnFilter":s==="date"||s==="dateString"?o="agDateColumnFilter":o="agTextColumnFilter"}return o},t.prototype.getDefaultFloatingFilter=function(r){var o;if(ModuleRegistry.__isRegistered(ModuleNames.SetFilterModule,this.context.getGridId()))o="agSetColumnFloatingFilter";else{var s=r.getColDef().cellDataType;s==="number"?o="agNumberColumnFloatingFilter":s==="date"||s==="dateString"?o="agDateColumnFloatingFilter":o="agTextColumnFloatingFilter"}return o},t.prototype.createFilterInstance=function(r){var o=this,s=this.getDefaultFilter(r),l=r.getColDef(),a,h=__assign$c(__assign$c({},this.createFilterParams(r,l)),{filterModifiedCallback:function(){var C={type:Events.EVENT_FILTER_MODIFIED,column:r,filterInstance:a};o.eventService.dispatchEvent(C)},filterChangedCallback:function(C){var L={filterInstance:a,additionalEventAttributes:C,columns:[r]};o.callOnFilterChangedOutsideRenderCycle(L)},doesRowPassOtherFilter:function(C){return o.doesRowPassOtherFilters(a,C)}}),y=this.userComponentFactory.getFilterDetails(l,h,s);return y?{filterPromise:function(){var C=y.newAgStackInstance();return C&&C.then(function(L){return a=L}),C},compDetails:y}:{filterPromise:null,compDetails:null}},t.prototype.createFilterParams=function(r,o){var s={column:r,colDef:cloneObject(o),rowModel:this.rowModel,filterChangedCallback:function(){},filterModifiedCallback:function(){},valueGetter:this.createValueGetter(r),doesRowPassOtherFilter:function(){return!0},api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context};return s},t.prototype.createFilterWrapper=function(r,o){var s,l={column:r,filterPromise:null,compiledElement:null,guiPromise:AgPromise.resolve(null),compDetails:null},a=this.createFilterInstance(r),h=a.filterPromise,y=a.compDetails;return l.filterPromise=(s=h==null?void 0:h())!==null&&s!==void 0?s:null,l.compDetails=y,h&&this.putIntoGui(l,o),l},t.prototype.putIntoGui=function(r,o){var s=this,l=document.createElement("div");l.className="ag-filter",r.guiPromise=new AgPromise(function(a){r.filterPromise.then(function(h){var y=h.getGui();exists(y)||console.warn("AG Grid: getGui method from filter returned "+y+", it should be a DOM element or an HTML template string."),typeof y=="string"&&(y=loadTemplate(y)),l.appendChild(y),a(l);var C={type:Events.EVENT_FILTER_OPENED,column:r.column,source:o,eGui:l};s.eventService.dispatchEvent(C)})})},t.prototype.onColumnsChanged=function(){var r=this,o=[];this.allColumnFilters.forEach(function(s,l){var a;s.column.isPrimary()?a=r.columnModel.getPrimaryColumn(l):a=r.columnModel.getGridColumn(l),!a&&(o.push(s.column),r.disposeFilterWrapper(s,"columnChanged"),r.disposeColumnListener(l))}),o.length>0?this.onFilterChanged({columns:o}):this.updateDependantFilters()},t.prototype.updateDependantFilters=function(){var r=this,o=this.columnModel.getGroupAutoColumns();o==null||o.forEach(function(s){s.getColDef().filter==="agGroupColumnFilter"&&r.getOrCreateFilterWrapper(s,"NO_UI")})},t.prototype.isFilterAllowed=function(r){var o,s,l=r.isFilterAllowed();if(!l)return!1;var a=this.allColumnFilters.get(r.getColId());return(s=(o=a==null?void 0:a.filterPromise)===null||o===void 0?void 0:o.resolveNow(!0,function(h){var y,C;return typeof((y=h)===null||y===void 0?void 0:y.isFilterAllowed)=="function"?(C=h)===null||C===void 0?void 0:C.isFilterAllowed():!0}))!==null&&s!==void 0?s:!0},t.prototype.getFloatingFilterCompDetails=function(r,o){var s=this,l=r.getColDef(),a=this.createFilterParams(r,l),h=this.userComponentFactory.mergeParamsWithApplicationProvidedParams(l,FilterComponent,a),y=this.userComponentFactory.getDefaultFloatingFilterType(l,function(){return s.getDefaultFloatingFilter(r)});y==null&&(y="agReadOnlyFloatingFilter");var C=function(Y){var ze=s.getFilterComponent(r,"NO_UI");ze!=null&&ze.then(function(Bt){Y(unwrapUserComp(Bt))})},L={column:r,filterParams:h,currentParentModel:function(){return s.getCurrentFloatingFilterParentModel(r)},parentFilterInstance:C,showParentFilter:o,suppressFilterButton:!1};return this.userComponentFactory.getFloatingFilterCompDetails(l,L,y)},t.prototype.getCurrentFloatingFilterParentModel=function(r){var o=this.getFilterComponent(r,"NO_UI",!1);return o?o.resolveNow(null,function(s){return s&&s.getModel()}):null},t.prototype.destroyFilter=function(r,o){o===void 0&&(o="api");var s=r.getColId(),l=this.allColumnFilters.get(s);this.disposeColumnListener(s),l&&(this.disposeFilterWrapper(l,o),this.onFilterChanged({columns:[r]}))},t.prototype.disposeColumnListener=function(r){var o=this.allColumnListeners.get(r);o&&(this.allColumnListeners.delete(r),o())},t.prototype.disposeFilterWrapper=function(r,o){var s=this;r.filterPromise.then(function(l){(l.setModel(null)||AgPromise.resolve()).then(function(){s.getContext().destroyBean(l),r.column.setFilterActive(!1,"filterDestroyed"),s.allColumnFilters.delete(r.column.getColId());var a={type:Events.EVENT_FILTER_DESTROYED,source:o,column:r.column};s.eventService.dispatchEvent(a)})})},t.prototype.checkDestroyFilter=function(r){var o=this.allColumnFilters.get(r);if(o){var s=o.column,l=(s.isFilterAllowed()?this.createFilterInstance(s):{compDetails:null}).compDetails,a=function(h,y){if(!y||!h)return!0;var C=h.componentClass,L=y.componentClass,Y=C===L||(C==null?void 0:C.render)&&(L==null?void 0:L.render)&&C.render===L.render;return!Y};a(o.compDetails,l)&&this.destroyFilter(s,"columnChanged")}},t.prototype.destroy=function(){var r=this;n.prototype.destroy.call(this),this.allColumnFilters.forEach(function(o){return r.disposeFilterWrapper(o,"gridDestroyed")}),this.allColumnListeners.clear()};var e;return t.QUICK_FILTER_SEPARATOR=`
`,__decorate$1U([Autowired("valueService")],t.prototype,"valueService",void 0),__decorate$1U([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$1U([Autowired("rowModel")],t.prototype,"rowModel",void 0),__decorate$1U([Autowired("userComponentFactory")],t.prototype,"userComponentFactory",void 0),__decorate$1U([Autowired("rowRenderer")],t.prototype,"rowRenderer",void 0),__decorate$1U([PostConstruct],t.prototype,"init",null),t=e=__decorate$1U([Bean("filterManager")],t),t}(BeanStub),__extends$22=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),AbstractHeaderCellComp=function(n){__extends$22(t,n);function t(e,r){var o=n.call(this,e)||this;return o.ctrl=r,o}return t.prototype.getCtrl=function(){return this.ctrl},t}(Component),__extends$21=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1T=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},HeaderFilterCellComp=function(n){__extends$21(t,n);function t(e){return n.call(this,t.TEMPLATE,e)||this}return t.prototype.postConstruct=function(){var e=this,r=this.getGui(),o={addOrRemoveCssClass:function(s,l){return e.addOrRemoveCssClass(s,l)},addOrRemoveBodyCssClass:function(s,l){return e.eFloatingFilterBody.classList.toggle(s,l)},setButtonWrapperDisplayed:function(s){return setDisplayed(e.eButtonWrapper,s)},setCompDetails:function(s){return e.setCompDetails(s)},getFloatingFilterComp:function(){return e.compPromise},setWidth:function(s){return r.style.width=s},setMenuIcon:function(s){return e.eButtonShowMainFilter.appendChild(s)}};this.ctrl.setComp(o,r,this.eButtonShowMainFilter,this.eFloatingFilterBody)},t.prototype.setCompDetails=function(e){var r=this;if(!e){this.destroyFloatingFilterComp(),this.compPromise=null;return}this.compPromise=e.newAgStackInstance(),this.compPromise.then(function(o){return r.afterCompCreated(o)})},t.prototype.destroyFloatingFilterComp=function(){this.floatingFilterComp&&(this.eFloatingFilterBody.removeChild(this.floatingFilterComp.getGui()),this.floatingFilterComp=this.destroyBean(this.floatingFilterComp))},t.prototype.afterCompCreated=function(e){if(e){if(!this.isAlive()){this.destroyBean(e);return}this.destroyFloatingFilterComp(),this.floatingFilterComp=e,this.eFloatingFilterBody.appendChild(e.getGui()),e.afterGuiAttached&&e.afterGuiAttached()}},t.TEMPLATE=`<div class="ag-header-cell ag-floating-filter" role="gridcell" tabindex="-1">
            <div ref="eFloatingFilterBody" role="presentation"></div>
            <div class="ag-floating-filter-button ag-hidden" ref="eButtonWrapper" role="presentation">
                <button type="button" class="ag-button ag-floating-filter-button-button" ref="eButtonShowMainFilter" tabindex="-1"></button>
            </div>
        </div>`,__decorate$1T([RefSelector("eFloatingFilterBody")],t.prototype,"eFloatingFilterBody",void 0),__decorate$1T([RefSelector("eButtonWrapper")],t.prototype,"eButtonWrapper",void 0),__decorate$1T([RefSelector("eButtonShowMainFilter")],t.prototype,"eButtonShowMainFilter",void 0),__decorate$1T([PostConstruct],t.prototype,"postConstruct",null),__decorate$1T([PreDestroy],t.prototype,"destroyFloatingFilterComp",null),t}(AbstractHeaderCellComp),__extends$20=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1S=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},LayoutCssClasses;(function(n){n.AUTO_HEIGHT="ag-layout-auto-height",n.NORMAL="ag-layout-normal",n.PRINT="ag-layout-print"})(LayoutCssClasses||(LayoutCssClasses={}));var LayoutFeature=function(n){__extends$20(t,n);function t(e){var r=n.call(this)||this;return r.view=e,r}return t.prototype.postConstruct=function(){this.addManagedPropertyListener("domLayout",this.updateLayoutClasses.bind(this)),this.updateLayoutClasses()},t.prototype.updateLayoutClasses=function(){var e=this.getDomLayout(),r={autoHeight:e==="autoHeight",normal:e==="normal",print:e==="print"},o=r.autoHeight?LayoutCssClasses.AUTO_HEIGHT:r.print?LayoutCssClasses.PRINT:LayoutCssClasses.NORMAL;this.view.updateLayoutClasses(o,r)},t.prototype.getDomLayout=function(){var e,r=(e=this.gridOptionsService.get("domLayout"))!==null&&e!==void 0?e:"normal",o=["normal","print","autoHeight"];return o.indexOf(r)===-1?(doOnce(function(){return console.warn("AG Grid: "+r+" is not valid for DOM Layout, valid values are 'normal', 'autoHeight', 'print'.")},"warn about dom layout values"),"normal"):r},__decorate$1S([PostConstruct],t.prototype,"postConstruct",null),t}(BeanStub),__extends$1$=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__assign$b=function(){return __assign$b=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},__assign$b.apply(this,arguments)},__decorate$1R=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},ScrollDirection;(function(n){n[n.Vertical=0]="Vertical",n[n.Horizontal=1]="Horizontal"})(ScrollDirection||(ScrollDirection={}));var ScrollSource;(function(n){n[n.Container=0]="Container",n[n.FakeContainer=1]="FakeContainer"})(ScrollSource||(ScrollSource={}));var GridBodyScrollFeature=function(n){__extends$1$(t,n);function t(e){var r=n.call(this)||this;return r.lastScrollSource=[null,null],r.scrollLeft=-1,r.nextScrollTop=-1,r.scrollTop=-1,r.eBodyViewport=e,r.resetLastHScrollDebounced=debounce(function(){return r.lastScrollSource[ScrollDirection.Horizontal]=null},500),r.resetLastVScrollDebounced=debounce(function(){return r.lastScrollSource[ScrollDirection.Vertical]=null},500),r}return t.prototype.postConstruct=function(){var e=this;this.enableRtl=this.gridOptionsService.is("enableRtl"),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED,this.onDisplayedColumnsWidthChanged.bind(this)),this.ctrlsService.whenReady(function(r){e.centerRowContainerCtrl=r.centerRowContainerCtrl,e.onDisplayedColumnsWidthChanged(),e.addScrollListener()})},t.prototype.addScrollListener=function(){var e=this.ctrlsService.getFakeHScrollComp(),r=this.ctrlsService.getFakeVScrollComp();this.addManagedListener(this.centerRowContainerCtrl.getViewportElement(),"scroll",this.onHScroll.bind(this)),e.onScrollCallback(this.onFakeHScroll.bind(this));var o=this.gridOptionsService.is("debounceVerticalScrollbar"),s=o?debounce(this.onVScroll.bind(this),100):this.onVScroll.bind(this),l=o?debounce(this.onFakeVScroll.bind(this),100):this.onFakeVScroll.bind(this);this.addManagedListener(this.eBodyViewport,"scroll",s),r.onScrollCallback(l)},t.prototype.onDisplayedColumnsWidthChanged=function(){this.enableRtl&&this.horizontallyScrollHeaderCenterAndFloatingCenter()},t.prototype.horizontallyScrollHeaderCenterAndFloatingCenter=function(e){var r=this.centerRowContainerCtrl==null;if(!r){e===void 0&&(e=this.centerRowContainerCtrl.getCenterViewportScrollLeft());var o=this.enableRtl?e:-e,s=this.ctrlsService.getTopCenterRowContainerCtrl(),l=this.ctrlsService.getStickyTopCenterRowContainerCtrl(),a=this.ctrlsService.getBottomCenterRowContainerCtrl(),h=this.ctrlsService.getFakeHScrollComp(),y=this.ctrlsService.getHeaderRowContainerCtrl();y.setHorizontalScroll(-o),a.setContainerTranslateX(o),s.setContainerTranslateX(o),l.setContainerTranslateX(o);var C=this.centerRowContainerCtrl.getViewportElement(),L=this.lastScrollSource[ScrollDirection.Horizontal]===ScrollSource.Container;e=Math.abs(e),L?h.setScrollPosition(e):setScrollLeft(C,e,this.enableRtl)}},t.prototype.isControllingScroll=function(e,r){return this.lastScrollSource[r]==null?(this.lastScrollSource[r]=e,!0):this.lastScrollSource[r]===e},t.prototype.onFakeHScroll=function(){this.isControllingScroll(ScrollSource.FakeContainer,ScrollDirection.Horizontal)&&this.onHScrollCommon(ScrollSource.FakeContainer)},t.prototype.onHScroll=function(){this.isControllingScroll(ScrollSource.Container,ScrollDirection.Horizontal)&&this.onHScrollCommon(ScrollSource.Container)},t.prototype.onHScrollCommon=function(e){var r=this.centerRowContainerCtrl.getViewportElement(),o=r.scrollLeft;if(!this.shouldBlockScrollUpdate(ScrollDirection.Horizontal,o,!0)){var s;e===ScrollSource.Container?s=getScrollLeft(r,this.enableRtl):s=this.ctrlsService.getFakeHScrollComp().getScrollPosition(),this.doHorizontalScroll(Math.round(s)),this.resetLastHScrollDebounced()}},t.prototype.onFakeVScroll=function(){this.isControllingScroll(ScrollSource.FakeContainer,ScrollDirection.Vertical)&&this.onVScrollCommon(ScrollSource.FakeContainer)},t.prototype.onVScroll=function(){this.isControllingScroll(ScrollSource.Container,ScrollDirection.Vertical)&&this.onVScrollCommon(ScrollSource.Container)},t.prototype.onVScrollCommon=function(e){var r;e===ScrollSource.Container?r=this.eBodyViewport.scrollTop:r=this.ctrlsService.getFakeVScrollComp().getScrollPosition(),!this.shouldBlockScrollUpdate(ScrollDirection.Vertical,r,!0)&&(this.animationFrameService.setScrollTop(r),this.nextScrollTop=r,e===ScrollSource.Container?this.ctrlsService.getFakeVScrollComp().setScrollPosition(r):this.eBodyViewport.scrollTop=r,this.gridOptionsService.is("suppressAnimationFrame")?this.scrollGridIfNeeded():this.animationFrameService.schedule(),this.resetLastVScrollDebounced())},t.prototype.doHorizontalScroll=function(e){var r=this.ctrlsService.getFakeHScrollComp().getScrollPosition();this.scrollLeft===e&&e===r||(this.scrollLeft=e,this.fireScrollEvent(ScrollDirection.Horizontal),this.horizontallyScrollHeaderCenterAndFloatingCenter(e),this.onHorizontalViewportChanged())},t.prototype.fireScrollEvent=function(e){var r=this,o={type:Events.EVENT_BODY_SCROLL,direction:e===ScrollDirection.Horizontal?"horizontal":"vertical",left:this.scrollLeft,top:this.scrollTop};this.eventService.dispatchEvent(o),window.clearTimeout(this.scrollTimer),this.scrollTimer=void 0,this.scrollTimer=window.setTimeout(function(){var s=__assign$b(__assign$b({},o),{type:Events.EVENT_BODY_SCROLL_END});r.eventService.dispatchEvent(s)},100)},t.prototype.shouldBlockScrollUpdate=function(e,r,o){return o===void 0&&(o=!1),o&&!isIOSUserAgent()?!1:e===ScrollDirection.Vertical?this.shouldBlockVerticalScroll(r):this.shouldBlockHorizontalScroll(r)},t.prototype.shouldBlockVerticalScroll=function(e){var r=getInnerHeight(this.eBodyViewport),o=this.eBodyViewport.scrollHeight;return e<0||e+r>o},t.prototype.shouldBlockHorizontalScroll=function(e){var r=this.centerRowContainerCtrl.getCenterWidth(),o=this.centerRowContainerCtrl.getViewportElement().scrollWidth;if(this.enableRtl&&isRtlNegativeScroll()){if(e>0)return!0}else if(e<0)return!0;return Math.abs(e)+r>o},t.prototype.redrawRowsAfterScroll=function(){this.fireScrollEvent(ScrollDirection.Vertical)},t.prototype.onHorizontalViewportChanged=function(){this.centerRowContainerCtrl.onHorizontalViewportChanged()},t.prototype.checkScrollLeft=function(){this.scrollLeft!==this.centerRowContainerCtrl.getCenterViewportScrollLeft()&&this.onHScrollCommon(ScrollSource.Container)},t.prototype.scrollGridIfNeeded=function(){var e=this.scrollTop!=this.nextScrollTop;return e&&(this.scrollTop=this.nextScrollTop,this.redrawRowsAfterScroll()),e},t.prototype.setHorizontalScrollPosition=function(e,r){r===void 0&&(r=!1);var o=0,s=this.centerRowContainerCtrl.getViewportElement().scrollWidth-this.centerRowContainerCtrl.getCenterWidth();!r&&this.shouldBlockScrollUpdate(ScrollDirection.Horizontal,e)&&(this.enableRtl&&isRtlNegativeScroll()?e=e>0?0:s:e=Math.min(Math.max(e,o),s)),setScrollLeft(this.centerRowContainerCtrl.getViewportElement(),Math.abs(e),this.enableRtl),this.doHorizontalScroll(e)},t.prototype.setVerticalScrollPosition=function(e){this.eBodyViewport.scrollTop=e},t.prototype.getVScrollPosition=function(){var e={top:this.eBodyViewport.scrollTop,bottom:this.eBodyViewport.scrollTop+this.eBodyViewport.offsetHeight};return e},t.prototype.getHScrollPosition=function(){return this.centerRowContainerCtrl.getHScrollPosition()},t.prototype.isHorizontalScrollShowing=function(){return this.centerRowContainerCtrl.isHorizontalScrollShowing()},t.prototype.scrollHorizontally=function(e){var r=this.centerRowContainerCtrl.getViewportElement().scrollLeft;return this.setHorizontalScrollPosition(r+e),this.centerRowContainerCtrl.getViewportElement().scrollLeft-r},t.prototype.scrollToTop=function(){this.eBodyViewport.scrollTop=0},t.prototype.ensureNodeVisible=function(e,r){r===void 0&&(r=null);for(var o=this.rowModel.getRowCount(),s=-1,l=0;l<o;l++){var a=this.rowModel.getRow(l);if(typeof e=="function"){var h=e;if(a&&h(a)){s=l;break}}else if(e===a||e===a.data){s=l;break}}s>=0&&this.ensureIndexVisible(s,r)},t.prototype.ensureIndexVisible=function(e,r){if(!this.gridOptionsService.isDomLayout("print")){var o=this.paginationProxy.getRowCount();if(typeof e!="number"||e<0||e>=o){console.warn("AG Grid: Invalid row index for ensureIndexVisible: "+e);return}var s=this.gridOptionsService.is("pagination"),l=s&&!this.gridOptionsService.is("suppressPaginationPanel");l||this.paginationProxy.goToPageWithIndex(e);var a=this.ctrlsService.getGridBodyCtrl(),h=a.getStickyTopHeight(),y=this.paginationProxy.getRow(e),C;do{var L=y.rowTop,Y=y.rowHeight,ze=this.paginationProxy.getPixelOffset(),Bt=y.rowTop-ze,Ir=Bt+y.rowHeight,Wr=this.getVScrollPosition(),yi=this.heightScaler.getDivStretchOffset(),Bn=Wr.top+yi,vi=Wr.bottom+yi,wo=vi-Bn,ia=this.heightScaler.getScrollPositionForPixel(Bt),gl=this.heightScaler.getScrollPositionForPixel(Ir-wo),ml=Math.min((ia+gl)/2,Bt),il=Bn+h>Bt,sl=vi<Ir,ol=null;r==="top"?ol=ia:r==="bottom"?ol=gl:r==="middle"?ol=ml:il?ol=ia-h:sl&&(ol=gl),ol!==null&&(this.setVerticalScrollPosition(ol),this.rowRenderer.redraw()),C=L!==y.rowTop||Y!==y.rowHeight}while(C);this.animationFrameService.flushAllFrames()}},t.prototype.ensureColumnVisible=function(e,r){r===void 0&&(r="auto");var o=this.columnModel.getGridColumn(e);if(o&&!o.isPinned()&&this.columnModel.isColumnDisplayed(o)){var s=this.getPositionedHorizontalScroll(o,r);s!==null&&this.centerRowContainerCtrl.setCenterViewportScrollLeft(s),this.centerRowContainerCtrl.onHorizontalViewportChanged(),this.animationFrameService.flushAllFrames()}},t.prototype.getPositionedHorizontalScroll=function(e,r){var o=this.isColumnOutsideViewport(e),s=o.columnBeforeStart,l=o.columnAfterEnd,a=this.centerRowContainerCtrl.getCenterWidth()<e.getActualWidth(),h=this.centerRowContainerCtrl.getCenterWidth(),y=this.enableRtl,C=(y?s:l)||a,L=y?l:s;r!=="auto"&&(C=r==="start",L=r==="end");var Y=r==="middle";if(C||L||Y){var ze=this.getColumnBounds(e),Bt=ze.colLeft,Ir=ze.colMiddle,Wr=ze.colRight;return Y?Ir-h/2:C?y?Wr:Bt:y?Bt-h:Wr-h}return null},t.prototype.isColumnOutsideViewport=function(e){var r=this.getViewportBounds(),o=r.start,s=r.end,l=this.getColumnBounds(e),a=l.colLeft,h=l.colRight,y=this.enableRtl,C=y?o>h:s<h,L=y?s<a:o>a;return{columnBeforeStart:C,columnAfterEnd:L}},t.prototype.getColumnBounds=function(e){var r=this.enableRtl,o=this.columnModel.getBodyContainerWidth(),s=e.getActualWidth(),l=e.getLeft(),a=r?-1:1,h=r?o-l:l,y=h+s*a,C=h+s/2*a;return{colLeft:h,colMiddle:C,colRight:y}},t.prototype.getViewportBounds=function(){var e=this.centerRowContainerCtrl.getCenterWidth(),r=this.centerRowContainerCtrl.getCenterViewportScrollLeft(),o=r,s=e+r;return{start:o,end:s,width:e}},__decorate$1R([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),__decorate$1R([Autowired("animationFrameService")],t.prototype,"animationFrameService",void 0),__decorate$1R([Autowired("paginationProxy")],t.prototype,"paginationProxy",void 0),__decorate$1R([Autowired("rowModel")],t.prototype,"rowModel",void 0),__decorate$1R([Autowired("rowContainerHeightService")],t.prototype,"heightScaler",void 0),__decorate$1R([Autowired("rowRenderer")],t.prototype,"rowRenderer",void 0),__decorate$1R([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$1R([PostConstruct],t.prototype,"postConstruct",null),t}(BeanStub),AutoScrollService=function(){function n(t){this.tickingInterval=null,this.onScrollCallback=null,this.scrollContainer=t.scrollContainer,this.scrollHorizontally=t.scrollAxis.indexOf("x")!==-1,this.scrollVertically=t.scrollAxis.indexOf("y")!==-1,this.scrollByTick=t.scrollByTick!=null?t.scrollByTick:20,t.onScrollCallback&&(this.onScrollCallback=t.onScrollCallback),this.scrollVertically&&(this.getVerticalPosition=t.getVerticalPosition,this.setVerticalPosition=t.setVerticalPosition),this.scrollHorizontally&&(this.getHorizontalPosition=t.getHorizontalPosition,this.setHorizontalPosition=t.setHorizontalPosition),this.shouldSkipVerticalScroll=t.shouldSkipVerticalScroll||function(){return!1},this.shouldSkipHorizontalScroll=t.shouldSkipHorizontalScroll||function(){return!1}}return n.prototype.check=function(t,e){e===void 0&&(e=!1);var r=e||this.shouldSkipVerticalScroll();if(!(r&&this.shouldSkipHorizontalScroll())){var o=this.scrollContainer.getBoundingClientRect(),s=this.scrollByTick;this.tickLeft=t.clientX<o.left+s,this.tickRight=t.clientX>o.right-s,this.tickUp=t.clientY<o.top+s&&!r,this.tickDown=t.clientY>o.bottom-s&&!r,this.tickLeft||this.tickRight||this.tickUp||this.tickDown?this.ensureTickingStarted():this.ensureCleared()}},n.prototype.ensureTickingStarted=function(){this.tickingInterval===null&&(this.tickingInterval=window.setInterval(this.doTick.bind(this),100),this.tickCount=0)},n.prototype.doTick=function(){this.tickCount++;var t;if(t=this.tickCount>20?200:this.tickCount>10?80:40,this.scrollVertically){var e=this.getVerticalPosition();this.tickUp&&this.setVerticalPosition(e-t),this.tickDown&&this.setVerticalPosition(e+t)}if(this.scrollHorizontally){var r=this.getHorizontalPosition();this.tickLeft&&this.setHorizontalPosition(r-t),this.tickRight&&this.setHorizontalPosition(r+t)}this.onScrollCallback&&this.onScrollCallback()},n.prototype.ensureCleared=function(){this.tickingInterval&&(window.clearInterval(this.tickingInterval),this.tickingInterval=null)},n}(),__extends$1_=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__assign$a=function(){return __assign$a=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},__assign$a.apply(this,arguments)},__decorate$1Q=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__read$m=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray$i=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n},RowDragFeature=function(n){__extends$1_(t,n);function t(e){var r=n.call(this)||this;return r.isMultiRowDrag=!1,r.isGridSorted=!1,r.isGridFiltered=!1,r.isRowGroupActive=!1,r.eContainer=e,r}return t.prototype.postConstruct=function(){var e=this;this.gridOptionsService.isRowModelType("clientSide")&&(this.clientSideRowModel=this.rowModel);var r=function(){e.onSortChanged(),e.onFilterChanged(),e.onRowGroupChanged()};this.addManagedListener(this.eventService,Events.EVENT_SORT_CHANGED,this.onSortChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_FILTER_CHANGED,this.onFilterChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_ROW_GROUP_CHANGED,this.onRowGroupChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_MODEL_UPDATED,function(){r()}),r(),this.ctrlsService.whenReady(function(){var o=e.ctrlsService.getGridBodyCtrl();e.autoScrollService=new AutoScrollService({scrollContainer:o.getBodyViewportElement(),scrollAxis:"y",getVerticalPosition:function(){return o.getScrollFeature().getVScrollPosition().top},setVerticalPosition:function(s){return o.getScrollFeature().setVerticalScrollPosition(s)},onScrollCallback:function(){e.onDragging(e.lastDraggingEvent)}})})},t.prototype.onSortChanged=function(){this.isGridSorted=this.sortController.isSortActive()},t.prototype.onFilterChanged=function(){this.isGridFiltered=this.filterManager.isAnyFilterPresent()},t.prototype.onRowGroupChanged=function(){var e=this.columnModel.getRowGroupColumns();this.isRowGroupActive=!missingOrEmpty(e)},t.prototype.getContainer=function(){return this.eContainer},t.prototype.isInterestedIn=function(e){return e===DragSourceType.RowDrag},t.prototype.getIconName=function(){var e=this.gridOptionsService.is("rowDragManaged");return e&&this.shouldPreventRowMove()?DragAndDropService.ICON_NOT_ALLOWED:DragAndDropService.ICON_MOVE},t.prototype.shouldPreventRowMove=function(){return this.isGridSorted||this.isGridFiltered||this.isRowGroupActive},t.prototype.getRowNodes=function(e){var r=this;if(!this.isFromThisGrid(e))return e.dragItem.rowNodes||[];var o=this.gridOptionsService.is("rowDragMultiRow"),s=__spreadArray$i([],__read$m(this.selectionService.getSelectedNodes())).sort(function(a,h){return a.rowIndex==null||h.rowIndex==null?0:r.getRowIndexNumber(a)-r.getRowIndexNumber(h)}),l=e.dragItem.rowNode;return o&&s.indexOf(l)!==-1?(this.isMultiRowDrag=!0,s):(this.isMultiRowDrag=!1,[l])},t.prototype.onDragEnter=function(e){e.dragItem.rowNodes=this.getRowNodes(e),this.dispatchGridEvent(Events.EVENT_ROW_DRAG_ENTER,e),this.getRowNodes(e).forEach(function(r){r.setDragging(!0)}),this.onEnterOrDragging(e)},t.prototype.onDragging=function(e){this.onEnterOrDragging(e)},t.prototype.isFromThisGrid=function(e){var r=e.dragSource.dragSourceDomDataKey;return r===this.gridOptionsService.getDomDataKey()},t.prototype.isDropZoneWithinThisGrid=function(e){var r=this.ctrlsService.getGridBodyCtrl(),o=r.getGui(),s=e.dropZoneTarget;return!o.contains(s)},t.prototype.onEnterOrDragging=function(e){this.dispatchGridEvent(Events.EVENT_ROW_DRAG_MOVE,e),this.lastDraggingEvent=e;var r=this.mouseEventService.getNormalisedPosition(e).y,o=this.gridOptionsService.is("rowDragManaged");o&&this.doManagedDrag(e,r),this.autoScrollService.check(e.event)},t.prototype.doManagedDrag=function(e,r){var o=this.isFromThisGrid(e),s=this.gridOptionsService.is("rowDragManaged"),l=e.dragItem.rowNodes;s&&this.shouldPreventRowMove()||(this.gridOptionsService.is("suppressMoveWhenRowDragging")||!o?this.isDropZoneWithinThisGrid(e)||this.clientSideRowModel.highlightRowAtPixel(l[0],r):this.moveRows(l,r))},t.prototype.getRowIndexNumber=function(e){return parseInt(last(e.getRowIndexString().split("-")),10)},t.prototype.moveRowAndClearHighlight=function(e){var r=this,o=this.clientSideRowModel.getLastHighlightedRowNode(),s=o&&o.highlighted===RowHighlightPosition.Below,l=this.mouseEventService.getNormalisedPosition(e).y,a=e.dragItem.rowNodes,h=s?1:0;if(this.isFromThisGrid(e))a.forEach(function(L){L.rowTop<l&&(h-=1)}),this.moveRows(a,l,h);else{var y=this.gridOptionsService.getCallback("getRowId"),C=this.clientSideRowModel.getRowIndexAtPixel(l)+1;this.clientSideRowModel.getHighlightPosition(l)===RowHighlightPosition.Above&&C--,this.clientSideRowModel.updateRowData({add:a.map(function(L){return L.data}).filter(function(L){return!r.clientSideRowModel.getRowNode(y?y({data:L,level:0}):L.id)}),addIndex:C})}this.clearRowHighlight()},t.prototype.clearRowHighlight=function(){this.clientSideRowModel.highlightRowAtPixel(null)},t.prototype.moveRows=function(e,r,o){o===void 0&&(o=0);var s=this.clientSideRowModel.ensureRowsAtPixel(e,r,o);s&&(this.focusService.clearFocusedCell(),this.rangeService&&this.rangeService.removeAllCellRanges())},t.prototype.addRowDropZone=function(e){var r=this;if(!e.getContainer()){doOnce(function(){return console.warn("AG Grid: addRowDropZone - A container target needs to be provided")},"add-drop-zone-empty-target");return}if(this.dragAndDropService.findExternalZone(e)){console.warn("AG Grid: addRowDropZone - target already exists in the list of DropZones. Use `removeRowDropZone` before adding it again.");return}var o={getContainer:e.getContainer};e.fromGrid?(e.fromGrid=void 0,o=e):(e.onDragEnter&&(o.onDragEnter=function(s){e.onDragEnter(r.draggingToRowDragEvent(Events.EVENT_ROW_DRAG_ENTER,s))}),e.onDragLeave&&(o.onDragLeave=function(s){e.onDragLeave(r.draggingToRowDragEvent(Events.EVENT_ROW_DRAG_LEAVE,s))}),e.onDragging&&(o.onDragging=function(s){e.onDragging(r.draggingToRowDragEvent(Events.EVENT_ROW_DRAG_MOVE,s))}),e.onDragStop&&(o.onDragStop=function(s){e.onDragStop(r.draggingToRowDragEvent(Events.EVENT_ROW_DRAG_END,s))})),this.dragAndDropService.addDropTarget(__assign$a({isInterestedIn:function(s){return s===DragSourceType.RowDrag},getIconName:function(){return DragAndDropService.ICON_MOVE},external:!0},o))},t.prototype.getRowDropZone=function(e){var r=this,o=this.getContainer.bind(this),s=this.onDragEnter.bind(this),l=this.onDragLeave.bind(this),a=this.onDragging.bind(this),h=this.onDragStop.bind(this);return e?{getContainer:o,onDragEnter:e.onDragEnter?function(y){s(y),e.onDragEnter(r.draggingToRowDragEvent(Events.EVENT_ROW_DRAG_ENTER,y))}:s,onDragLeave:e.onDragLeave?function(y){l(y),e.onDragLeave(r.draggingToRowDragEvent(Events.EVENT_ROW_DRAG_LEAVE,y))}:l,onDragging:e.onDragging?function(y){a(y),e.onDragging(r.draggingToRowDragEvent(Events.EVENT_ROW_DRAG_MOVE,y))}:a,onDragStop:e.onDragStop?function(y){h(y),e.onDragStop(r.draggingToRowDragEvent(Events.EVENT_ROW_DRAG_END,y))}:h,fromGrid:!0}:{getContainer:o,onDragEnter:s,onDragLeave:l,onDragging:a,onDragStop:h,fromGrid:!0}},t.prototype.draggingToRowDragEvent=function(e,r){var o=this.mouseEventService.getNormalisedPosition(r).y,s=o>this.paginationProxy.getCurrentPageHeight(),l=-1,a;s||(l=this.rowModel.getRowIndexAtPixel(o),a=this.rowModel.getRow(l));var h;switch(r.vDirection){case VerticalDirection.Down:h="down";break;case VerticalDirection.Up:h="up";break;default:h=null;break}var y={type:e,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context,event:r.event,node:r.dragItem.rowNode,nodes:r.dragItem.rowNodes,overIndex:l,overNode:a,y:o,vDirection:h};return y},t.prototype.dispatchGridEvent=function(e,r){var o=this.draggingToRowDragEvent(e,r);this.eventService.dispatchEvent(o)},t.prototype.onDragLeave=function(e){this.dispatchGridEvent(Events.EVENT_ROW_DRAG_LEAVE,e),this.stopDragging(e),this.gridOptionsService.is("rowDragManaged")&&this.clearRowHighlight(),this.isFromThisGrid(e)&&(this.isMultiRowDrag=!1)},t.prototype.onDragStop=function(e){this.dispatchGridEvent(Events.EVENT_ROW_DRAG_END,e),this.stopDragging(e),this.gridOptionsService.is("rowDragManaged")&&(this.gridOptionsService.is("suppressMoveWhenRowDragging")||!this.isFromThisGrid(e))&&!this.isDropZoneWithinThisGrid(e)&&this.moveRowAndClearHighlight(e)},t.prototype.stopDragging=function(e){this.autoScrollService.ensureCleared(),this.getRowNodes(e).forEach(function(r){r.setDragging(!1)})},__decorate$1Q([Autowired("dragAndDropService")],t.prototype,"dragAndDropService",void 0),__decorate$1Q([Autowired("rowModel")],t.prototype,"rowModel",void 0),__decorate$1Q([Autowired("paginationProxy")],t.prototype,"paginationProxy",void 0),__decorate$1Q([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$1Q([Autowired("focusService")],t.prototype,"focusService",void 0),__decorate$1Q([Autowired("sortController")],t.prototype,"sortController",void 0),__decorate$1Q([Autowired("filterManager")],t.prototype,"filterManager",void 0),__decorate$1Q([Autowired("selectionService")],t.prototype,"selectionService",void 0),__decorate$1Q([Autowired("mouseEventService")],t.prototype,"mouseEventService",void 0),__decorate$1Q([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),__decorate$1Q([Optional("rangeService")],t.prototype,"rangeService",void 0),__decorate$1Q([PostConstruct],t.prototype,"postConstruct",null),t}(BeanStub),__extends$1Z=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1P=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},RowAnimationCssClasses;(function(n){n.ANIMATION_ON="ag-row-animation",n.ANIMATION_OFF="ag-row-no-animation"})(RowAnimationCssClasses||(RowAnimationCssClasses={}));var CSS_CLASS_FORCE_VERTICAL_SCROLL="ag-force-vertical-scroll",CSS_CLASS_CELL_SELECTABLE="ag-selectable",CSS_CLASS_COLUMN_MOVING="ag-column-moving",GridBodyCtrl=function(n){__extends$1Z(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.stickyTopHeight=0,e}return t.prototype.getScrollFeature=function(){return this.bodyScrollFeature},t.prototype.getBodyViewportElement=function(){return this.eBodyViewport},t.prototype.setComp=function(e,r,o,s,l,a){this.comp=e,this.eGridBody=r,this.eBodyViewport=o,this.eTop=s,this.eBottom=l,this.eStickyTop=a,this.setCellTextSelection(this.gridOptionsService.is("enableCellTextSelection")),this.createManagedBean(new LayoutFeature(this.comp)),this.bodyScrollFeature=this.createManagedBean(new GridBodyScrollFeature(this.eBodyViewport)),this.addRowDragListener(),this.setupRowAnimationCssClass(),this.addEventListeners(),this.addFocusListeners([s,o,l,a]),this.onGridColumnsChanged(),this.addBodyViewportListener(),this.setFloatingHeights(),this.disableBrowserDragging(),this.addStopEditingWhenGridLosesFocus(),this.ctrlsService.registerGridBodyCtrl(this)},t.prototype.getComp=function(){return this.comp},t.prototype.addEventListeners=function(){this.addManagedListener(this.eventService,Events.EVENT_GRID_COLUMNS_CHANGED,this.onGridColumnsChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_SCROLL_VISIBILITY_CHANGED,this.onScrollVisibilityChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_PINNED_ROW_DATA_CHANGED,this.onPinnedRowDataChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_HEADER_HEIGHT_CHANGED,this.onHeaderHeightChanged.bind(this))},t.prototype.addFocusListeners=function(e){var r=this;e.forEach(function(o){r.addManagedListener(o,"focusin",function(s){var l=s.target,a=isElementChildOfClass(l,"ag-root",o);o.classList.toggle("ag-has-focus",!a)}),r.addManagedListener(o,"focusout",function(s){var l=s.target,a=s.relatedTarget,h=o.contains(a),y=isElementChildOfClass(a,"ag-root",o),C=isElementChildOfClass(l,"ag-root",o);C||(!h||y)&&o.classList.remove("ag-has-focus")})})},t.prototype.setColumnMovingCss=function(e){this.comp.setColumnMovingCss(CSS_CLASS_COLUMN_MOVING,e)},t.prototype.setCellTextSelection=function(e){e===void 0&&(e=!1),this.comp.setCellSelectableCss(CSS_CLASS_CELL_SELECTABLE,e)},t.prototype.onScrollVisibilityChanged=function(){var e=this,r=this.scrollVisibleService.isVerticalScrollShowing();this.setVerticalScrollPaddingVisible(r),this.setStickyTopWidth(r);var o=r&&this.gridOptionsService.getScrollbarWidth()||0,s=isInvisibleScrollbar()?16:0,l="calc(100% + "+(o+s)+"px)";this.animationFrameService.requestAnimationFrame(function(){return e.comp.setBodyViewportWidth(l)})},t.prototype.onGridColumnsChanged=function(){var e=this.columnModel.getAllGridColumns();this.comp.setColumnCount(e?e.length:0)},t.prototype.disableBrowserDragging=function(){this.addManagedListener(this.eGridBody,"dragstart",function(e){if(e.target instanceof HTMLImageElement)return e.preventDefault(),!1})},t.prototype.addStopEditingWhenGridLosesFocus=function(){var e=this;if(this.gridOptionsService.is("stopEditingWhenCellsLoseFocus")){var r=function(s){var l=s.relatedTarget;if(getTabIndex(l)===null){e.rowRenderer.stopEditing();return}var a=o.some(function(y){return y.contains(l)})&&e.mouseEventService.isElementInThisGrid(l);if(!a){var h=e.popupService;a=h.getActivePopups().some(function(y){return y.contains(l)})||h.isElementWithinCustomPopup(l)}a||e.rowRenderer.stopEditing()},o=[this.eBodyViewport,this.eBottom,this.eTop,this.eStickyTop];o.forEach(function(s){return e.addManagedListener(s,"focusout",r)})}},t.prototype.updateRowCount=function(){var e=this.headerNavigationService.getHeaderRowCount(),r=this.rowModel.isLastRowIndexKnown()?this.rowModel.getRowCount():-1,o=r===-1?-1:e+r;this.comp.setRowCount(o)},t.prototype.registerBodyViewportResizeListener=function(e){this.comp.registerBodyViewportResizeListener(e)},t.prototype.setVerticalScrollPaddingVisible=function(e){var r=e?"scroll":"hidden";this.comp.setPinnedTopBottomOverflowY(r)},t.prototype.isVerticalScrollShowing=function(){var e=this.gridOptionsService.is("alwaysShowVerticalScroll"),r=e?CSS_CLASS_FORCE_VERTICAL_SCROLL:null,o=this.gridOptionsService.isDomLayout("normal");return this.comp.setAlwaysVerticalScrollClass(r,e),e||o&&isVerticalScrollShowing(this.eBodyViewport)},t.prototype.setupRowAnimationCssClass=function(){var e=this,r=function(){var o=e.gridOptionsService.isAnimateRows()&&!e.rowContainerHeightService.isStretching(),s=o?RowAnimationCssClasses.ANIMATION_ON:RowAnimationCssClasses.ANIMATION_OFF;e.comp.setRowAnimationCssOnBodyViewport(s,o)};r(),this.addManagedListener(this.eventService,Events.EVENT_HEIGHT_SCALE_CHANGED,r),this.addManagedPropertyListener("animateRows",r)},t.prototype.getGridBodyElement=function(){return this.eGridBody},t.prototype.addBodyViewportListener=function(){var e=this.onBodyViewportContextMenu.bind(this);this.addManagedListener(this.eBodyViewport,"contextmenu",e),this.mockContextMenuForIPad(e),this.addManagedListener(this.eBodyViewport,"wheel",this.onBodyViewportWheel.bind(this)),this.addManagedListener(this.eStickyTop,"wheel",this.onStickyTopWheel.bind(this)),this.addFullWidthContainerWheelListener()},t.prototype.addFullWidthContainerWheelListener=function(){var e=this,r=this.eBodyViewport.querySelector(".ag-full-width-container"),o=this.eBodyViewport.querySelector(".ag-center-cols-viewport");r&&o&&this.addManagedListener(r,"wheel",function(s){return e.onFullWidthContainerWheel(s,o)})},t.prototype.onFullWidthContainerWheel=function(e,r){!e.deltaX||Math.abs(e.deltaY)>Math.abs(e.deltaX)||!this.mouseEventService.isEventFromThisGrid(e)||(e.preventDefault(),r.scrollBy({left:e.deltaX}))},t.prototype.onBodyViewportContextMenu=function(e,r,o){if(!(!e&&!o)){if(this.gridOptionsService.is("preventDefaultOnContextMenu")){var s=e||o;s.preventDefault()}var l=(e||r).target;if(l===this.eBodyViewport||l===this.ctrlsService.getCenterRowContainerCtrl().getViewportElement()){if(!this.contextMenuFactory)return;e?this.contextMenuFactory.onContextMenu(e,null,null,null,null,this.eGridBody):o&&this.contextMenuFactory.onContextMenu(null,o,null,null,null,this.eGridBody)}}},t.prototype.mockContextMenuForIPad=function(e){if(isIOSUserAgent()){var r=new TouchListener(this.eBodyViewport),o=function(s){e(void 0,s.touchStart,s.touchEvent)};this.addManagedListener(r,TouchListener.EVENT_LONG_TAP,o),this.addDestroyFunc(function(){return r.destroy()})}},t.prototype.onBodyViewportWheel=function(e){this.gridOptionsService.is("suppressScrollWhenPopupsAreOpen")&&this.popupService.hasAnchoredPopup()&&e.preventDefault()},t.prototype.onStickyTopWheel=function(e){e.preventDefault(),e.offsetY&&this.scrollVertically(e.deltaY)},t.prototype.getGui=function(){return this.eGridBody},t.prototype.scrollVertically=function(e){var r=this.eBodyViewport.scrollTop;return this.bodyScrollFeature.setVerticalScrollPosition(r+e),this.eBodyViewport.scrollTop-r},t.prototype.addRowDragListener=function(){this.rowDragFeature=this.createManagedBean(new RowDragFeature(this.eBodyViewport)),this.dragAndDropService.addDropTarget(this.rowDragFeature)},t.prototype.getRowDragFeature=function(){return this.rowDragFeature},t.prototype.onPinnedRowDataChanged=function(){this.setFloatingHeights()},t.prototype.setFloatingHeights=function(){var e=this.pinnedRowModel,r=e.getPinnedTopTotalHeight();r&&(r+=1);var o=e.getPinnedBottomTotalHeight();o&&(o+=1),this.comp.setTopHeight(r),this.comp.setBottomHeight(o),this.comp.setTopDisplay(r?"inherit":"none"),this.comp.setBottomDisplay(o?"inherit":"none"),this.setStickyTopOffsetTop()},t.prototype.setStickyTopHeight=function(e){e===void 0&&(e=0),this.comp.setStickyTopHeight(e+"px"),this.stickyTopHeight=e},t.prototype.getStickyTopHeight=function(){return this.stickyTopHeight},t.prototype.setStickyTopWidth=function(e){if(!e)this.comp.setStickyTopWidth("100%");else{var r=this.gridOptionsService.getScrollbarWidth();this.comp.setStickyTopWidth("calc(100% - "+r+"px)")}},t.prototype.onHeaderHeightChanged=function(){this.setStickyTopOffsetTop()},t.prototype.setStickyTopOffsetTop=function(){var e=this.ctrlsService.getGridHeaderCtrl(),r=e.getHeaderHeight(),o=this.pinnedRowModel.getPinnedTopTotalHeight(),s=0;r>0&&(s+=r+1),o>0&&(s+=o+1),this.comp.setStickyTopTop(s+"px")},t.prototype.sizeColumnsToFit=function(e,r){var o=this,s=this.isVerticalScrollShowing(),l=s?this.gridOptionsService.getScrollbarWidth():0,a=getInnerWidth(this.eGridBody),h=a-l;if(h>0){this.columnModel.sizeColumnsToFit(h,"sizeColumnsToFit",!1,e);return}r===void 0?window.setTimeout(function(){o.sizeColumnsToFit(e,100)},0):r===100?window.setTimeout(function(){o.sizeColumnsToFit(e,500)},100):r===500?window.setTimeout(function(){o.sizeColumnsToFit(e,-1)},500):console.warn("AG Grid: tried to call sizeColumnsToFit() but the grid is coming back with zero width, maybe the grid is not visible yet on the screen?")},t.prototype.addScrollEventListener=function(e){this.eBodyViewport.addEventListener("scroll",e,{passive:!0})},t.prototype.removeScrollEventListener=function(e){this.eBodyViewport.removeEventListener("scroll",e)},__decorate$1P([Autowired("animationFrameService")],t.prototype,"animationFrameService",void 0),__decorate$1P([Autowired("rowContainerHeightService")],t.prototype,"rowContainerHeightService",void 0),__decorate$1P([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),__decorate$1P([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$1P([Autowired("scrollVisibleService")],t.prototype,"scrollVisibleService",void 0),__decorate$1P([Optional("contextMenuFactory")],t.prototype,"contextMenuFactory",void 0),__decorate$1P([Autowired("headerNavigationService")],t.prototype,"headerNavigationService",void 0),__decorate$1P([Autowired("dragAndDropService")],t.prototype,"dragAndDropService",void 0),__decorate$1P([Autowired("pinnedRowModel")],t.prototype,"pinnedRowModel",void 0),__decorate$1P([Autowired("rowRenderer")],t.prototype,"rowRenderer",void 0),__decorate$1P([Autowired("popupService")],t.prototype,"popupService",void 0),__decorate$1P([Autowired("mouseEventService")],t.prototype,"mouseEventService",void 0),__decorate$1P([Autowired("rowModel")],t.prototype,"rowModel",void 0),t}(BeanStub),SelectionHandleType;(function(n){n[n.FILL=0]="FILL",n[n.RANGE=1]="RANGE"})(SelectionHandleType||(SelectionHandleType={}));var CellRangeType;(function(n){n[n.VALUE=0]="VALUE",n[n.DIMENSION=1]="DIMENSION"})(CellRangeType||(CellRangeType={}));var CSS_CELL_RANGE_SELECTED="ag-cell-range-selected",CSS_CELL_RANGE_CHART="ag-cell-range-chart",CSS_CELL_RANGE_SINGLE_CELL="ag-cell-range-single-cell",CSS_CELL_RANGE_CHART_CATEGORY="ag-cell-range-chart-category",CSS_CELL_RANGE_HANDLE="ag-cell-range-handle",CSS_CELL_RANGE_TOP="ag-cell-range-top",CSS_CELL_RANGE_RIGHT="ag-cell-range-right",CSS_CELL_RANGE_BOTTOM="ag-cell-range-bottom",CSS_CELL_RANGE_LEFT="ag-cell-range-left",CellRangeFeature=function(){function n(t,e){this.beans=t,this.cellCtrl=e}return n.prototype.setComp=function(t,e){this.cellComp=t,this.eGui=e,this.onRangeSelectionChanged()},n.prototype.onRangeSelectionChanged=function(){this.cellComp&&(this.rangeCount=this.beans.rangeService.getCellRangeCount(this.cellCtrl.getCellPosition()),this.hasChartRange=this.getHasChartRange(),this.cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_SELECTED,this.rangeCount!==0),this.cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_SELECTED+"-1",this.rangeCount===1),this.cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_SELECTED+"-2",this.rangeCount===2),this.cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_SELECTED+"-3",this.rangeCount===3),this.cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_SELECTED+"-4",this.rangeCount>=4),this.cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_CHART,this.hasChartRange),setAriaSelected(this.eGui,this.rangeCount>0?!0:void 0),this.cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_SINGLE_CELL,this.isSingleCell()),this.updateRangeBorders(),this.refreshHandle())},n.prototype.updateRangeBorders=function(){var t=this.getRangeBorders(),e=this.isSingleCell(),r=!e&&t.top,o=!e&&t.right,s=!e&&t.bottom,l=!e&&t.left;this.cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_TOP,r),this.cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_RIGHT,o),this.cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_BOTTOM,s),this.cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_LEFT,l)},n.prototype.isSingleCell=function(){var t=this.beans.rangeService;return this.rangeCount===1&&t&&!t.isMoreThanOneCell()},n.prototype.getHasChartRange=function(){var t=this.beans.rangeService;if(!this.rangeCount||!t)return!1;var e=t.getCellRanges();return e.length>0&&e.every(function(r){return includes([CellRangeType.DIMENSION,CellRangeType.VALUE],r.type)})},n.prototype.updateRangeBordersIfRangeCount=function(){this.rangeCount>0&&(this.updateRangeBorders(),this.refreshHandle())},n.prototype.getRangeBorders=function(){var t=this,e=this.beans.gridOptionsService.is("enableRtl"),r=!1,o=!1,s=!1,l=!1,a=this.cellCtrl.getCellPosition().column,h=this.beans,y=h.rangeService,C=h.columnModel,L,Y;e?(L=C.getDisplayedColAfter(a),Y=C.getDisplayedColBefore(a)):(L=C.getDisplayedColBefore(a),Y=C.getDisplayedColAfter(a));var ze=y.getCellRanges().filter(function(Bn){return y.isCellInSpecificRange(t.cellCtrl.getCellPosition(),Bn)});L||(l=!0),Y||(o=!0);for(var Bt=0;Bt<ze.length&&!(r&&o&&s&&l);Bt++){var Ir=ze[Bt],Wr=y.getRangeStartRow(Ir),yi=y.getRangeEndRow(Ir);!r&&this.beans.rowPositionUtils.sameRow(Wr,this.cellCtrl.getCellPosition())&&(r=!0),!s&&this.beans.rowPositionUtils.sameRow(yi,this.cellCtrl.getCellPosition())&&(s=!0),!l&&L&&Ir.columns.indexOf(L)<0&&(l=!0),!o&&Y&&Ir.columns.indexOf(Y)<0&&(o=!0)}return{top:r,right:o,bottom:s,left:l}},n.prototype.refreshHandle=function(){if(this.beans.rangeService){var t=this.shouldHaveSelectionHandle();this.selectionHandle&&!t&&(this.selectionHandle=this.beans.context.destroyBean(this.selectionHandle)),t&&this.addSelectionHandle(),this.cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_HANDLE,!!this.selectionHandle)}},n.prototype.shouldHaveSelectionHandle=function(){var t=this.beans,e=t.gridOptionsService,r=t.rangeService,o=r.getCellRanges(),s=o.length;if(this.rangeCount<1||s<1)return!1;var l=last(o),a=this.cellCtrl.getCellPosition(),h=e.is("enableFillHandle")&&!this.cellCtrl.isSuppressFillHandle(),y=e.is("enableRangeHandle"),C=s===1&&!this.cellCtrl.isEditing()&&(h||y);if(this.hasChartRange){var L=o[0].type===CellRangeType.DIMENSION,Y=L&&r.isCellInSpecificRange(a,o[0]);this.cellComp.addOrRemoveCssClass(CSS_CELL_RANGE_CHART_CATEGORY,Y),C=l.type===CellRangeType.VALUE}return C&&l.endRow!=null&&r.isContiguousRange(l)&&r.isBottomRightCell(l,a)},n.prototype.addSelectionHandle=function(){var t=this.beans,e=t.gridOptionsService,r=t.rangeService,o=last(r.getCellRanges()).type,s=e.is("enableFillHandle")&&missing(o),l=s?SelectionHandleType.FILL:SelectionHandleType.RANGE;this.selectionHandle&&this.selectionHandle.getType()!==l&&(this.selectionHandle=this.beans.context.destroyBean(this.selectionHandle)),this.selectionHandle||(this.selectionHandle=this.beans.selectionHandleFactory.createSelectionHandle(l)),this.selectionHandle.refresh(this.cellCtrl)},n.prototype.destroy=function(){this.beans.context.destroyBean(this.selectionHandle)},n}(),__extends$1Y=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),CellPositionFeature=function(n){__extends$1Y(t,n);function t(e,r){var o=n.call(this)||this;return o.cellCtrl=e,o.beans=r,o.column=e.getColumn(),o.rowNode=e.getRowNode(),o.setupColSpan(),o.setupRowSpan(),o}return t.prototype.setupRowSpan=function(){this.rowSpan=this.column.getRowSpan(this.rowNode)},t.prototype.setComp=function(e){this.eGui=e,this.onLeftChanged(),this.onWidthChanged(),this.applyRowSpan()},t.prototype.onDisplayColumnsChanged=function(){var e=this.getColSpanningList();areEqual(this.colsSpanning,e)||(this.colsSpanning=e,this.onWidthChanged(),this.onLeftChanged())},t.prototype.setupColSpan=function(){this.column.getColDef().colSpan!=null&&(this.colsSpanning=this.getColSpanningList(),this.addManagedListener(this.beans.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,this.onDisplayColumnsChanged.bind(this)),this.addManagedListener(this.beans.eventService,Events.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED,this.onWidthChanged.bind(this)))},t.prototype.onWidthChanged=function(){if(this.eGui){var e=this.getCellWidth();this.eGui.style.width=e+"px"}},t.prototype.getCellWidth=function(){return this.colsSpanning?this.colsSpanning.reduce(function(e,r){return e+r.getActualWidth()},0):this.column.getActualWidth()},t.prototype.getColSpanningList=function(){var e=this.column.getColSpan(this.rowNode),r=[];if(e===1)r.push(this.column);else for(var o=this.column,s=this.column.getPinned(),l=0;o&&l<e&&(r.push(o),o=this.beans.columnModel.getDisplayedColAfter(o),!(!o||missing(o)||s!==o.getPinned()));l++);return r},t.prototype.onLeftChanged=function(){if(this.eGui){var e=this.modifyLeftForPrintLayout(this.getCellLeft());this.eGui.style.left=e+"px"}},t.prototype.getCellLeft=function(){var e;return this.beans.gridOptionsService.is("enableRtl")&&this.colsSpanning?e=last(this.colsSpanning):e=this.column,e.getLeft()},t.prototype.modifyLeftForPrintLayout=function(e){if(!this.cellCtrl.isPrintLayout()||this.column.getPinned()==="left")return e;var r=this.beans.columnModel.getDisplayedColumnsLeftWidth();if(this.column.getPinned()==="right"){var o=this.beans.columnModel.getBodyContainerWidth();return r+o+(e||0)}return r+(e||0)},t.prototype.applyRowSpan=function(){if(this.rowSpan!==1){var e=this.beans.gridOptionsService.getRowHeightAsNumber(),r=e*this.rowSpan;this.eGui.style.height=r+"px",this.eGui.style.zIndex="1"}},t.prototype.destroy=function(){n.prototype.destroy.call(this)},t}(BeanStub),__extends$1X=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),CellCustomStyleFeature=function(n){__extends$1X(t,n);function t(e,r){var o=n.call(this)||this;return o.staticClasses=[],o.cellCtrl=e,o.beans=r,o.column=e.getColumn(),o.rowNode=e.getRowNode(),o}return t.prototype.setComp=function(e){this.cellComp=e,this.applyUserStyles(),this.applyCellClassRules(),this.applyClassesFromColDef()},t.prototype.applyCellClassRules=function(){var e=this,r=this.column.getColDef(),o={value:this.cellCtrl.getValue(),data:this.rowNode.data,node:this.rowNode,colDef:r,column:this.column,rowIndex:this.rowNode.rowIndex,api:this.beans.gridOptionsService.api,columnApi:this.beans.gridOptionsService.columnApi,context:this.beans.gridOptionsService.context};this.beans.stylingService.processClassRules(r.cellClassRules,o,function(s){return e.cellComp.addOrRemoveCssClass(s,!0)},function(s){return e.cellComp.addOrRemoveCssClass(s,!1)})},t.prototype.applyUserStyles=function(){var e=this.column.getColDef();if(e.cellStyle){var r;if(typeof e.cellStyle=="function"){var o={column:this.column,value:this.cellCtrl.getValue(),colDef:e,data:this.rowNode.data,node:this.rowNode,rowIndex:this.rowNode.rowIndex,api:this.beans.gridOptionsService.api,columnApi:this.beans.gridOptionsService.columnApi,context:this.beans.gridOptionsService.context},s=e.cellStyle;r=s(o)}else r=e.cellStyle;r&&this.cellComp.setUserStyles(r)}},t.prototype.applyClassesFromColDef=function(){var e=this,r=this.column.getColDef(),o={value:this.cellCtrl.getValue(),data:this.rowNode.data,node:this.rowNode,column:this.column,colDef:r,rowIndex:this.rowNode.rowIndex,api:this.beans.gridOptionsService.api,columnApi:this.beans.gridOptionsService.columnApi,context:this.beans.gridOptionsService.context};this.staticClasses.length&&this.staticClasses.forEach(function(s){return e.cellComp.addOrRemoveCssClass(s,!1)}),this.staticClasses=this.beans.stylingService.getStaticCellClasses(r,o),this.staticClasses.length&&this.staticClasses.forEach(function(s){return e.cellComp.addOrRemoveCssClass(s,!0)})},t.prototype.destroy=function(){n.prototype.destroy.call(this)},t}(BeanStub),__extends$1W=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),TooltipFeature=function(n){__extends$1W(t,n);function t(e,r){var o=n.call(this)||this;return o.ctrl=e,o.beans=r,o}return t.prototype.setComp=function(e){this.comp=e,this.setupTooltip()},t.prototype.setupTooltip=function(){this.browserTooltips=this.beans.gridOptionsService.is("enableBrowserTooltips"),this.updateTooltipText(),this.browserTooltips?this.comp.setTitle(this.tooltip!=null?this.tooltip:void 0):this.createTooltipFeatureIfNeeded()},t.prototype.updateTooltipText=function(){this.tooltip=this.ctrl.getTooltipValue()},t.prototype.createTooltipFeatureIfNeeded=function(){var e=this;if(this.genericTooltipFeature==null){var r={getTooltipParams:function(){return e.getTooltipParams()},getGui:function(){return e.ctrl.getGui()}};this.genericTooltipFeature=this.createManagedBean(new CustomTooltipFeature(r),this.beans.context)}},t.prototype.refreshToolTip=function(){this.updateTooltipText(),this.browserTooltips&&this.comp.setTitle(this.tooltip!=null?this.tooltip:void 0)},t.prototype.getTooltipParams=function(){var e=this.ctrl,r=e.getColumn?e.getColumn():void 0,o=e.getColDef?e.getColDef():void 0,s=e.getRowNode?e.getRowNode():void 0;return{location:e.getLocation(),colDef:o,column:r,rowIndex:e.getRowIndex?e.getRowIndex():void 0,node:s,data:s?s.data:void 0,value:this.getTooltipText(),valueFormatted:e.getValueFormatted?e.getValueFormatted():void 0}},t.prototype.getTooltipText=function(){return this.tooltip},t.prototype.destroy=function(){n.prototype.destroy.call(this)},t}(BeanStub),__decorate$1O=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},Beans=function(){function n(){}return n.prototype.postConstruct=function(){this.doingMasterDetail=this.gridOptionsService.isMasterDetail(),this.gridOptionsService.isRowModelType("clientSide")&&(this.clientSideRowModel=this.rowModel),this.gridOptionsService.isRowModelType("serverSide")&&(this.serverSideRowModel=this.rowModel)},__decorate$1O([Autowired("resizeObserverService")],n.prototype,"resizeObserverService",void 0),__decorate$1O([Autowired("paginationProxy")],n.prototype,"paginationProxy",void 0),__decorate$1O([Autowired("context")],n.prototype,"context",void 0),__decorate$1O([Autowired("columnApi")],n.prototype,"columnApi",void 0),__decorate$1O([Autowired("gridApi")],n.prototype,"gridApi",void 0),__decorate$1O([Autowired("gridOptionsService")],n.prototype,"gridOptionsService",void 0),__decorate$1O([Autowired("expressionService")],n.prototype,"expressionService",void 0),__decorate$1O([Autowired("environment")],n.prototype,"environment",void 0),__decorate$1O([Autowired("rowRenderer")],n.prototype,"rowRenderer",void 0),__decorate$1O([Autowired("templateService")],n.prototype,"templateService",void 0),__decorate$1O([Autowired("valueService")],n.prototype,"valueService",void 0),__decorate$1O([Autowired("eventService")],n.prototype,"eventService",void 0),__decorate$1O([Autowired("columnModel")],n.prototype,"columnModel",void 0),__decorate$1O([Autowired("headerNavigationService")],n.prototype,"headerNavigationService",void 0),__decorate$1O([Autowired("navigationService")],n.prototype,"navigationService",void 0),__decorate$1O([Autowired("columnAnimationService")],n.prototype,"columnAnimationService",void 0),__decorate$1O([Optional("rangeService")],n.prototype,"rangeService",void 0),__decorate$1O([Autowired("focusService")],n.prototype,"focusService",void 0),__decorate$1O([Optional("contextMenuFactory")],n.prototype,"contextMenuFactory",void 0),__decorate$1O([Autowired("popupService")],n.prototype,"popupService",void 0),__decorate$1O([Autowired("valueFormatterService")],n.prototype,"valueFormatterService",void 0),__decorate$1O([Autowired("stylingService")],n.prototype,"stylingService",void 0),__decorate$1O([Autowired("columnHoverService")],n.prototype,"columnHoverService",void 0),__decorate$1O([Autowired("userComponentFactory")],n.prototype,"userComponentFactory",void 0),__decorate$1O([Autowired("userComponentRegistry")],n.prototype,"userComponentRegistry",void 0),__decorate$1O([Autowired("animationFrameService")],n.prototype,"animationFrameService",void 0),__decorate$1O([Autowired("dragService")],n.prototype,"dragService",void 0),__decorate$1O([Autowired("dragAndDropService")],n.prototype,"dragAndDropService",void 0),__decorate$1O([Autowired("sortController")],n.prototype,"sortController",void 0),__decorate$1O([Autowired("filterManager")],n.prototype,"filterManager",void 0),__decorate$1O([Autowired("rowContainerHeightService")],n.prototype,"rowContainerHeightService",void 0),__decorate$1O([Autowired("frameworkOverrides")],n.prototype,"frameworkOverrides",void 0),__decorate$1O([Autowired("cellPositionUtils")],n.prototype,"cellPositionUtils",void 0),__decorate$1O([Autowired("rowPositionUtils")],n.prototype,"rowPositionUtils",void 0),__decorate$1O([Autowired("selectionService")],n.prototype,"selectionService",void 0),__decorate$1O([Optional("selectionHandleFactory")],n.prototype,"selectionHandleFactory",void 0),__decorate$1O([Autowired("rowCssClassCalculator")],n.prototype,"rowCssClassCalculator",void 0),__decorate$1O([Autowired("rowModel")],n.prototype,"rowModel",void 0),__decorate$1O([Autowired("ctrlsService")],n.prototype,"ctrlsService",void 0),__decorate$1O([Autowired("ctrlsFactory")],n.prototype,"ctrlsFactory",void 0),__decorate$1O([Autowired("agStackComponentsRegistry")],n.prototype,"agStackComponentsRegistry",void 0),__decorate$1O([Autowired("valueCache")],n.prototype,"valueCache",void 0),__decorate$1O([Autowired("rowNodeEventThrottle")],n.prototype,"rowNodeEventThrottle",void 0),__decorate$1O([Autowired("localeService")],n.prototype,"localeService",void 0),__decorate$1O([Autowired("valueParserService")],n.prototype,"valueParserService",void 0),__decorate$1O([PostConstruct],n.prototype,"postConstruct",null),n=__decorate$1O([Bean("beans")],n),n}(),__extends$1V=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),CellMouseListenerFeature=function(n){__extends$1V(t,n);function t(e,r,o){var s=n.call(this)||this;return s.cellCtrl=e,s.beans=r,s.column=o,s}return t.prototype.onMouseEvent=function(e,r){if(!isStopPropagationForAgGrid(r))switch(e){case"click":this.onCellClicked(r);break;case"mousedown":case"touchstart":this.onMouseDown(r);break;case"dblclick":this.onCellDoubleClicked(r);break;case"mouseout":this.onMouseOut(r);break;case"mouseover":this.onMouseOver(r);break}},t.prototype.onCellClicked=function(e){if(this.isDoubleClickOnIPad()){this.onCellDoubleClicked(e),e.preventDefault();return}var r=this.beans,o=r.eventService,s=r.rangeService,l=r.gridOptionsService,a=e.ctrlKey||e.metaKey;s&&a&&s.getCellRangeCount(this.cellCtrl.getCellPosition())>1&&s.intersectLastRange(!0);var h=this.cellCtrl.createEvent(e,Events.EVENT_CELL_CLICKED);o.dispatchEvent(h);var y=this.column.getColDef();y.onCellClicked&&window.setTimeout(function(){return y.onCellClicked(h)},0);var C=(l.is("singleClickEdit")||y.singleClickEdit)&&!l.is("suppressClickEdit");C&&this.cellCtrl.startRowOrCellEdit()},t.prototype.isDoubleClickOnIPad=function(){if(!isIOSUserAgent()||isEventSupported("dblclick"))return!1;var e=new Date().getTime(),r=e-this.lastIPadMouseClickEvent<200;return this.lastIPadMouseClickEvent=e,r},t.prototype.onCellDoubleClicked=function(e){var r=this.column.getColDef(),o=this.cellCtrl.createEvent(e,Events.EVENT_CELL_DOUBLE_CLICKED);this.beans.eventService.dispatchEvent(o),typeof r.onCellDoubleClicked=="function"&&window.setTimeout(function(){return r.onCellDoubleClicked(o)},0);var s=!this.beans.gridOptionsService.is("singleClickEdit")&&!this.beans.gridOptionsService.is("suppressClickEdit");s&&this.cellCtrl.startRowOrCellEdit(null,e)},t.prototype.onMouseDown=function(e){var r=e.ctrlKey,o=e.metaKey,s=e.shiftKey,l=e.target,a=this.beans,h=a.eventService,y=a.rangeService;if(!this.isRightClickInExistingRange(e)){var C=y&&y.getCellRanges().length!=0;if(!s||!C){var L=isBrowserSafari()&&!this.cellCtrl.isEditing()&&!isFocusableFormField(l);this.cellCtrl.focusCell(L)}if(s&&C&&e.preventDefault(),!this.containsWidget(l)){if(y){var Y=this.cellCtrl.getCellPosition();if(s)y.extendLatestRangeToCell(Y);else{var ze=r||o;y.setRangeToCell(Y,ze)}}h.dispatchEvent(this.cellCtrl.createEvent(e,Events.EVENT_CELL_MOUSE_DOWN))}}},t.prototype.isRightClickInExistingRange=function(e){var r=this.beans.rangeService;if(r){var o=r.isCellInAnyRange(this.cellCtrl.getCellPosition());if(o&&e.button===2)return!0}return!1},t.prototype.containsWidget=function(e){return isElementChildOfClass(e,"ag-selection-checkbox",3)},t.prototype.onMouseOut=function(e){if(!this.mouseStayingInsideCell(e)){var r=this.cellCtrl.createEvent(e,Events.EVENT_CELL_MOUSE_OUT);this.beans.eventService.dispatchEvent(r),this.beans.columnHoverService.clearMouseOver()}},t.prototype.onMouseOver=function(e){if(!this.mouseStayingInsideCell(e)){var r=this.cellCtrl.createEvent(e,Events.EVENT_CELL_MOUSE_OVER);this.beans.eventService.dispatchEvent(r),this.beans.columnHoverService.setMouseOver([this.column])}},t.prototype.mouseStayingInsideCell=function(e){if(!e.target||!e.relatedTarget)return!1;var r=this.cellCtrl.getGui(),o=r.contains(e.target),s=r.contains(e.relatedTarget);return o&&s},t.prototype.destroy=function(){},t}(Beans),__extends$1U=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),CellKeyboardListenerFeature=function(n){__extends$1U(t,n);function t(e,r,o,s,l){var a=n.call(this)||this;return a.cellCtrl=e,a.beans=r,a.rowNode=s,a.rowCtrl=l,a}return t.prototype.setComp=function(e){this.eGui=e},t.prototype.onKeyDown=function(e){var r=e.key;switch(r){case KeyCode.ENTER:this.onEnterKeyDown(e);break;case KeyCode.F2:this.onF2KeyDown(e);break;case KeyCode.ESCAPE:this.onEscapeKeyDown(e);break;case KeyCode.TAB:this.onTabKeyDown(e);break;case KeyCode.BACKSPACE:case KeyCode.DELETE:this.onBackspaceOrDeleteKeyDown(r,e);break;case KeyCode.DOWN:case KeyCode.UP:case KeyCode.RIGHT:case KeyCode.LEFT:this.onNavigationKeyDown(e,r);break}},t.prototype.onNavigationKeyDown=function(e,r){this.cellCtrl.isEditing()||(e.shiftKey&&this.cellCtrl.isRangeSelectionEnabled()?this.onShiftRangeSelect(e):this.beans.navigationService.navigateToNextCell(e,r,this.cellCtrl.getCellPosition(),!0),e.preventDefault())},t.prototype.onShiftRangeSelect=function(e){if(this.beans.rangeService){var r=this.beans.rangeService.extendLatestRangeInDirection(e);r&&this.beans.navigationService.ensureCellVisible(r)}},t.prototype.onTabKeyDown=function(e){this.beans.navigationService.onTabKeyDown(this.cellCtrl,e)},t.prototype.onBackspaceOrDeleteKeyDown=function(e,r){var o=this,s=o.cellCtrl,l=o.beans,a=o.rowNode,h=l.gridOptionsService,y=l.rangeService,C=l.eventService;s.isEditing()||(C.dispatchEvent({type:Events.EVENT_KEY_SHORTCUT_CHANGED_CELL_START}),isDeleteKey(e,h.is("enableCellEditingOnBackspace"))?y&&h.isEnableRangeSelection()?y.clearCellRangeCellValues({dispatchWrapperEvents:!0,wrapperEventSource:"deleteKey"}):s.isCellEditable()&&a.setDataValue(s.getColumn(),null,"cellClear"):s.startRowOrCellEdit(e,r),C.dispatchEvent({type:Events.EVENT_KEY_SHORTCUT_CHANGED_CELL_END}))},t.prototype.onEnterKeyDown=function(e){if(this.cellCtrl.isEditing()||this.rowCtrl.isEditing())this.cellCtrl.stopEditingAndFocus(!1,e.shiftKey);else if(this.beans.gridOptionsService.is("enterNavigatesVertically")){var r=e.shiftKey?KeyCode.UP:KeyCode.DOWN;this.beans.navigationService.navigateToNextCell(null,r,this.cellCtrl.getCellPosition(),!1)}else this.cellCtrl.startRowOrCellEdit(KeyCode.ENTER,e),this.cellCtrl.isEditing()&&e.preventDefault()},t.prototype.onF2KeyDown=function(e){this.cellCtrl.isEditing()||this.cellCtrl.startRowOrCellEdit(KeyCode.F2,e)},t.prototype.onEscapeKeyDown=function(e){this.cellCtrl.isEditing()&&(this.cellCtrl.stopRowOrCellEdit(!0),this.cellCtrl.focusCell(!0))},t.prototype.processCharacter=function(e){var r=e.target,o=r!==this.eGui;if(!(o||this.cellCtrl.isEditing())){var s=e.key;s===" "?this.onSpaceKeyDown(e):(this.cellCtrl.startRowOrCellEdit(s,e),e.preventDefault())}},t.prototype.onSpaceKeyDown=function(e){var r=this.beans.gridOptionsService;if(!this.cellCtrl.isEditing()&&r.isRowSelection()){var o=this.rowNode.isSelected(),s=!o;if(s||!r.is("suppressRowDeselection")){var l=this.beans.gridOptionsService.is("groupSelectsFiltered"),a=this.rowNode.setSelectedParams({newValue:s,rangeSelect:e.shiftKey,groupSelectsFiltered:l,event:e,source:"spaceKey"});o===void 0&&a===0&&this.rowNode.setSelectedParams({newValue:!1,rangeSelect:e.shiftKey,groupSelectsFiltered:l,event:e,source:"spaceKey"})}}e.preventDefault()},t.prototype.destroy=function(){n.prototype.destroy.call(this)},t}(BeanStub),__extends$1T=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1N=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},DndSourceComp=function(n){__extends$1T(t,n);function t(e,r,o){var s=n.call(this,'<div class="ag-drag-handle ag-row-drag" draggable="true"></div>')||this;return s.rowNode=e,s.column=r,s.eCell=o,s}return t.prototype.postConstruct=function(){var e=this.getGui();e.appendChild(createIconNoSpan("rowDrag",this.gridOptionsService,null)),this.addGuiEventListener("mousedown",function(r){r.stopPropagation()}),this.addDragSource(),this.checkVisibility()},t.prototype.addDragSource=function(){this.addGuiEventListener("dragstart",this.onDragStart.bind(this))},t.prototype.onDragStart=function(e){var r=this,o=this.column.getColDef().dndSourceOnRowDrag;e.dataTransfer.setDragImage(this.eCell,0,0);var s=function(){try{var a=JSON.stringify(r.rowNode.data);e.dataTransfer.setData("application/json",a),e.dataTransfer.setData("text/plain",a)}catch{}};if(o){var l={rowNode:this.rowNode,dragEvent:e,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context};o(l)}else s()},t.prototype.checkVisibility=function(){var e=this.column.isDndSource(this.rowNode);this.setDisplayed(e)},__decorate$1N([PostConstruct],t.prototype,"postConstruct",null),t}(Component),__extends$1S=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__assign$9=function(){return __assign$9=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},__assign$9.apply(this,arguments)},CSS_CELL="ag-cell",CSS_AUTO_HEIGHT="ag-cell-auto-height",CSS_NORMAL_HEIGHT="ag-cell-normal-height",CSS_CELL_FOCUS="ag-cell-focus",CSS_CELL_FIRST_RIGHT_PINNED="ag-cell-first-right-pinned",CSS_CELL_LAST_LEFT_PINNED="ag-cell-last-left-pinned",CSS_CELL_NOT_INLINE_EDITING="ag-cell-not-inline-editing",CSS_COLUMN_HOVER="ag-column-hover",CSS_CELL_WRAP_TEXT="ag-cell-wrap-text",instanceIdSequence$3=0,CellCtrl=function(n){__extends$1S(t,n);function t(e,r,o,s){var l=n.call(this)||this;return l.cellRangeFeature=null,l.cellPositionFeature=null,l.cellCustomStyleFeature=null,l.tooltipFeature=null,l.cellMouseListenerFeature=null,l.cellKeyboardListenerFeature=null,l.suppressRefreshCell=!1,l.onCellCompAttachedFuncs=[],l.column=e,l.rowNode=r,l.beans=o,l.rowCtrl=s,l.instanceId=e.getId()+"-"+instanceIdSequence$3++,l.createCellPosition(),l.addFeatures(),l}return t.prototype.shouldRestoreFocus=function(){return this.beans.focusService.shouldRestoreFocus(this.cellPosition)},t.prototype.addFeatures=function(){var e=this;this.cellPositionFeature=new CellPositionFeature(this,this.beans),this.addDestroyFunc(function(){var o;(o=e.cellPositionFeature)===null||o===void 0||o.destroy(),e.cellPositionFeature=null}),this.cellCustomStyleFeature=new CellCustomStyleFeature(this,this.beans),this.addDestroyFunc(function(){var o;(o=e.cellCustomStyleFeature)===null||o===void 0||o.destroy(),e.cellCustomStyleFeature=null}),this.cellMouseListenerFeature=new CellMouseListenerFeature(this,this.beans,this.column),this.addDestroyFunc(function(){var o;(o=e.cellMouseListenerFeature)===null||o===void 0||o.destroy(),e.cellMouseListenerFeature=null}),this.cellKeyboardListenerFeature=new CellKeyboardListenerFeature(this,this.beans,this.column,this.rowNode,this.rowCtrl),this.addDestroyFunc(function(){var o;(o=e.cellKeyboardListenerFeature)===null||o===void 0||o.destroy(),e.cellKeyboardListenerFeature=null});var r=this.beans.rangeService&&this.beans.gridOptionsService.isEnableRangeSelection();r&&(this.cellRangeFeature=new CellRangeFeature(this.beans,this),this.addDestroyFunc(function(){var o;(o=e.cellRangeFeature)===null||o===void 0||o.destroy(),e.cellRangeFeature=null})),this.column.isTooltipEnabled()&&this.addTooltipFeature()},t.prototype.addTooltipFeature=function(){var e=this,r=function(){var s=e.column.getColDef(),l=e.rowNode.data;if(s.tooltipField&&exists(l))return getValueUsingField(l,s.tooltipField,e.column.isTooltipFieldContainsDots());var a=s.tooltipValueGetter;return a?a({location:"cell",api:e.beans.gridOptionsService.api,columnApi:e.beans.gridOptionsService.columnApi,context:e.beans.gridOptionsService.context,colDef:e.column.getColDef(),column:e.column,rowIndex:e.cellPosition.rowIndex,node:e.rowNode,data:e.rowNode.data,value:e.value,valueFormatted:e.valueFormatted}):null},o={getColumn:function(){return e.column},getColDef:function(){return e.column.getColDef()},getRowIndex:function(){return e.cellPosition.rowIndex},getRowNode:function(){return e.rowNode},getGui:function(){return e.getGui()},getLocation:function(){return"cell"},getTooltipValue:r,getValueFormatted:function(){return e.valueFormatted}};this.tooltipFeature=new TooltipFeature(o,this.beans),this.addDestroyFunc(function(){var s;(s=e.tooltipFeature)===null||s===void 0||s.destroy(),e.tooltipFeature=null})},t.prototype.setComp=function(e,r,o,s,l){var a,h,y,C;this.cellComp=e,this.eGui=r,this.printLayout=s,this.updateAndFormatValue(!0),this.addDomData(),this.onCellFocused(),this.applyStaticCssClasses(),this.setWrapText(),this.onFirstRightPinnedChanged(),this.onLastLeftPinnedChanged(),this.onColumnHover(),this.setupControlComps(),o&&this.setupAutoHeight(o),this.setAriaColIndex(),this.beans.gridOptionsService.is("suppressCellFocus")||this.cellComp.setTabIndex(-1);var L=escapeString(this.column.getId());this.cellComp.setColId(L),this.cellComp.setRole("gridcell"),(a=this.cellPositionFeature)===null||a===void 0||a.setComp(r),(h=this.cellCustomStyleFeature)===null||h===void 0||h.setComp(e),(y=this.tooltipFeature)===null||y===void 0||y.setComp(e),(C=this.cellKeyboardListenerFeature)===null||C===void 0||C.setComp(this.eGui),this.cellRangeFeature&&this.cellRangeFeature.setComp(e,r),l&&this.isCellEditable()?this.startEditing():this.showValue(),this.onCellCompAttachedFuncs.length&&(this.onCellCompAttachedFuncs.forEach(function(Y){return Y()}),this.onCellCompAttachedFuncs=[])},t.prototype.setupAutoHeight=function(e){var r=this;if(this.column.isAutoHeight()){var o=e.parentElement,s=this.beans.gridOptionsService.getRowHeightForNode(this.rowNode).height,l=function(y){if(!r.editing&&r.isAlive()){var C=getElementSize(o),L=C.paddingTop,Y=C.paddingBottom,ze=C.borderBottomWidth,Bt=C.borderTopWidth,Ir=L+Y+ze+Bt,Wr=e.offsetHeight,yi=Wr+Ir;if(y<5){var Bn=r.beans.gridOptionsService.getDocument(),vi=!Bn||!Bn.contains(e),wo=yi==0;if(vi||wo){r.beans.frameworkOverrides.setTimeout(function(){return l(y+1)},0);return}}var ia=Math.max(yi,s);r.rowNode.setRowAutoHeight(ia,r.column)}},a=function(){return l(0)};a();var h=this.beans.resizeObserverService.observeResize(e,a);this.addDestroyFunc(function(){h(),r.rowNode.setRowAutoHeight(void 0,r.column)})}},t.prototype.getInstanceId=function(){return this.instanceId},t.prototype.showValue=function(e){e===void 0&&(e=!1);var r=this.valueFormatted!=null?this.valueFormatted:this.value,o=this.createCellRendererParams(),s=this.beans.userComponentFactory.getCellRendererDetails(this.column.getColDef(),o);this.cellComp.setRenderDetails(s,r,e),this.refreshHandle()},t.prototype.setupControlComps=function(){var e=this.column.getColDef();this.includeSelection=this.isIncludeControl(e.checkboxSelection),this.includeRowDrag=this.isIncludeControl(e.rowDrag),this.includeDndSource=this.isIncludeControl(e.dndSource),this.cellComp.setIncludeSelection(this.includeSelection),this.cellComp.setIncludeDndSource(this.includeDndSource),this.cellComp.setIncludeRowDrag(this.includeRowDrag)},t.prototype.isForceWrapper=function(){var e=this.beans.gridOptionsService.is("enableCellTextSelection")||this.column.isAutoHeight();return e},t.prototype.isIncludeControl=function(e){var r=this.rowNode.rowPinned!=null,o=typeof e=="function",s=r?!1:o||e===!0;return s},t.prototype.refreshShouldDestroy=function(){var e=this.column.getColDef(),r=this.includeSelection!=this.isIncludeControl(e.checkboxSelection),o=this.includeRowDrag!=this.isIncludeControl(e.rowDrag),s=this.includeDndSource!=this.isIncludeControl(e.dndSource);return r||o||s},t.prototype.startEditing=function(e,r,o){var s=this;if(e===void 0&&(e=null),r===void 0&&(r=!1),o===void 0&&(o=null),!(!this.isCellEditable()||this.editing)){if(!this.cellComp){this.onCellCompAttachedFuncs.push(function(){s.startEditing(e,r,o)});return}var l=this.createCellEditorParams(e,r),a=this.column.getColDef(),h=this.beans.userComponentFactory.getCellEditorDetails(a,l),y=(h==null?void 0:h.popupFromSelector)!=null?h.popupFromSelector:!!a.cellEditorPopup,C=(h==null?void 0:h.popupPositionFromSelector)!=null?h.popupPositionFromSelector:a.cellEditorPopupPosition;this.setEditing(!0),this.cellComp.setEditDetails(h,y,C);var L=this.createEvent(o,Events.EVENT_CELL_EDITING_STARTED);this.beans.eventService.dispatchEvent(L)}},t.prototype.setEditing=function(e){this.editing!==e&&(this.editing=e,this.refreshHandle())},t.prototype.stopRowOrCellEdit=function(e){e===void 0&&(e=!1),this.beans.gridOptionsService.get("editType")==="fullRow"?this.rowCtrl.stopRowEditing(e):this.stopEditing(e)},t.prototype.onPopupEditorClosed=function(){this.isEditing()&&this.stopEditingAndFocus()},t.prototype.takeValueFromCellEditor=function(e){var r={newValueExists:!1};if(e)return r;var o=this.cellComp.getCellEditor();if(!o)return r;var s=o.isCancelAfterEnd&&o.isCancelAfterEnd();if(s)return r;var l=o.getValue();return{newValue:l,newValueExists:!0}},t.prototype.saveNewValue=function(e,r){if(r===e)return!1;this.suppressRefreshCell=!0;var o=this.rowNode.setDataValue(this.column,r,"edit");return this.suppressRefreshCell=!1,o},t.prototype.stopEditing=function(e){if(e===void 0&&(e=!1),!this.editing)return!1;var r=this.takeValueFromCellEditor(e),o=r.newValue,s=r.newValueExists,l=this.rowNode.getValueFromValueService(this.column),a=!1;return s&&(a=this.saveNewValue(l,o)),this.setEditing(!1),this.cellComp.setEditDetails(),this.updateAndFormatValue(),this.refreshCell({forceRefresh:!0,suppressFlash:!0}),this.dispatchEditingStoppedEvent(l,o,!e&&!!a),a},t.prototype.dispatchEditingStoppedEvent=function(e,r,o){var s=__assign$9(__assign$9({},this.createEvent(null,Events.EVENT_CELL_EDITING_STOPPED)),{oldValue:e,newValue:r,valueChanged:o});this.beans.eventService.dispatchEvent(s)},t.prototype.createCellEditorParams=function(e,r){return{value:this.rowNode.getValueFromValueService(this.column),eventKey:e,column:this.column,colDef:this.column.getColDef(),rowIndex:this.getCellPosition().rowIndex,node:this.rowNode,data:this.rowNode.data,api:this.beans.gridOptionsService.api,cellStartedEdit:r,columnApi:this.beans.gridOptionsService.columnApi,context:this.beans.gridOptionsService.context,onKeyDown:this.onKeyDown.bind(this),stopEditing:this.stopEditingAndFocus.bind(this),eGridCell:this.getGui(),parseValue:this.parseValue.bind(this),formatValue:this.formatValue.bind(this)}},t.prototype.createCellRendererParams=function(){var e=this,r={value:this.value,valueFormatted:this.valueFormatted,getValue:function(){return e.rowNode.getValueFromValueService(e.column)},setValue:function(o){return e.beans.valueService.setValue(e.rowNode,e.column,o)},formatValue:this.formatValue.bind(this),data:this.rowNode.data,node:this.rowNode,pinned:this.column.getPinned(),colDef:this.column.getColDef(),column:this.column,rowIndex:this.getCellPosition().rowIndex,api:this.beans.gridOptionsService.api,columnApi:this.beans.gridOptionsService.columnApi,context:this.beans.gridOptionsService.context,refreshCell:this.refreshCell.bind(this),eGridCell:this.getGui(),eParentOfValue:this.cellComp.getParentOfValue(),registerRowDragger:function(o,s,l,a){return e.registerRowDragger(o,s,a)}};return r},t.prototype.parseValue=function(e){return this.beans.valueParserService.parseValue(this.column,this.rowNode,e,this.getValue())},t.prototype.setFocusOutOnEditor=function(){if(this.editing){var e=this.cellComp.getCellEditor();e&&e.focusOut&&e.focusOut()}},t.prototype.setFocusInOnEditor=function(){if(this.editing){var e=this.cellComp.getCellEditor();e&&e.focusIn?e.focusIn():this.focusCell(!0)}},t.prototype.onCellChanged=function(e){if(this.cellComp){var r=e.column===this.column;r&&this.refreshCell({})}},t.prototype.refreshCell=function(e){var r,o,s;if(!(this.suppressRefreshCell||this.editing)&&this.cellComp){var l=this.column.getColDef(),a=e!=null&&!!e.newData,h=e!=null&&!!e.suppressFlash||!!l.suppressCellFlash,y=l.field==null&&l.valueGetter==null&&l.showRowGroup==null,C=e&&e.forceRefresh||y||a,L=this.updateAndFormatValue(),Y=C||L;if(Y){this.showValue(a);var ze=this.beans.filterManager.isSuppressFlashingCellsBecauseFiltering(),Bt=!h&&!ze&&(this.beans.gridOptionsService.is("enableCellChangeFlash")||l.enableCellChangeFlash);Bt&&this.flashCell(),(r=this.cellCustomStyleFeature)===null||r===void 0||r.applyUserStyles(),(o=this.cellCustomStyleFeature)===null||o===void 0||o.applyClassesFromColDef()}this.refreshToolTip(),(s=this.cellCustomStyleFeature)===null||s===void 0||s.applyCellClassRules()}},t.prototype.stopEditingAndFocus=function(e,r){e===void 0&&(e=!1),r===void 0&&(r=!1),this.stopRowOrCellEdit(),this.focusCell(!0),e||this.navigateAfterEdit(r)},t.prototype.navigateAfterEdit=function(e){var r=this.beans.gridOptionsService.is("enterNavigatesVerticallyAfterEdit");if(r){var o=e?KeyCode.UP:KeyCode.DOWN;this.beans.navigationService.navigateToNextCell(null,o,this.getCellPosition(),!1)}},t.prototype.flashCell=function(e){var r=e&&e.flashDelay,o=e&&e.fadeDelay;this.animateCell("data-changed",r,o)},t.prototype.animateCell=function(e,r,o){var s=this,l,a,h="ag-cell-"+e,y="ag-cell-"+e+"-animation",C=this.beans.gridOptionsService;r||(r=(l=C.getNum("cellFlashDelay"))!==null&&l!==void 0?l:500),exists(o)||(o=(a=C.getNum("cellFadeDelay"))!==null&&a!==void 0?a:1e3),this.cellComp.addOrRemoveCssClass(h,!0),this.cellComp.addOrRemoveCssClass(y,!1),window.setTimeout(function(){s.isAlive()&&(s.cellComp.addOrRemoveCssClass(h,!1),s.cellComp.addOrRemoveCssClass(y,!0),s.eGui.style.transition="background-color "+o+"ms",window.setTimeout(function(){s.isAlive()&&(s.cellComp.addOrRemoveCssClass(y,!1),s.eGui.style.transition="")},o))},r)},t.prototype.onFlashCells=function(e){if(this.cellComp){var r=this.beans.cellPositionUtils.createId(this.getCellPosition()),o=e.cells[r];o&&this.animateCell("highlight")}},t.prototype.isCellEditable=function(){return this.column.isCellEditable(this.rowNode)},t.prototype.isSuppressFillHandle=function(){return this.column.isSuppressFillHandle()},t.prototype.formatValue=function(e){var r=this.callValueFormatter(e);return r??e},t.prototype.callValueFormatter=function(e){return this.beans.valueFormatterService.formatValue(this.column,this.rowNode,e)},t.prototype.updateAndFormatValue=function(e){e===void 0&&(e=!1);var r=this.value,o=this.valueFormatted;this.value=this.rowNode.getValueFromValueService(this.column),this.valueFormatted=this.callValueFormatter(this.value);var s=e?!0:!this.valuesAreEqual(r,this.value)||this.valueFormatted!=o;return s},t.prototype.valuesAreEqual=function(e,r){var o=this.column.getColDef();return o.equals?o.equals(e,r):e===r},t.prototype.getComp=function(){return this.cellComp},t.prototype.getValue=function(){return this.value},t.prototype.getValueFormatted=function(){return this.valueFormatted},t.prototype.addDomData=function(){var e=this,r=this.getGui();this.beans.gridOptionsService.setDomData(r,t.DOM_DATA_KEY_CELL_CTRL,this),this.addDestroyFunc(function(){return e.beans.gridOptionsService.setDomData(r,t.DOM_DATA_KEY_CELL_CTRL,null)})},t.prototype.createEvent=function(e,r){var o={type:r,node:this.rowNode,data:this.rowNode.data,value:this.value,column:this.column,colDef:this.column.getColDef(),context:this.beans.gridOptionsService.context,api:this.beans.gridApi,columnApi:this.beans.columnApi,rowPinned:this.rowNode.rowPinned,event:e,rowIndex:this.rowNode.rowIndex};return o},t.prototype.processCharacter=function(e){var r;(r=this.cellKeyboardListenerFeature)===null||r===void 0||r.processCharacter(e)},t.prototype.onKeyDown=function(e){var r;(r=this.cellKeyboardListenerFeature)===null||r===void 0||r.onKeyDown(e)},t.prototype.onMouseEvent=function(e,r){var o;(o=this.cellMouseListenerFeature)===null||o===void 0||o.onMouseEvent(e,r)},t.prototype.getGui=function(){return this.eGui},t.prototype.refreshToolTip=function(){var e;(e=this.tooltipFeature)===null||e===void 0||e.refreshToolTip()},t.prototype.getColSpanningList=function(){return this.cellPositionFeature.getColSpanningList()},t.prototype.onLeftChanged=function(){var e;this.cellComp&&((e=this.cellPositionFeature)===null||e===void 0||e.onLeftChanged())},t.prototype.onDisplayedColumnsChanged=function(){this.eGui&&this.setAriaColIndex()},t.prototype.setAriaColIndex=function(){var e=this.beans.columnModel.getAriaColumnIndex(this.column);setAriaColIndex(this.getGui(),e)},t.prototype.isSuppressNavigable=function(){return this.column.isSuppressNavigable(this.rowNode)},t.prototype.onWidthChanged=function(){var e;return(e=this.cellPositionFeature)===null||e===void 0?void 0:e.onWidthChanged()},t.prototype.getColumn=function(){return this.column},t.prototype.getRowNode=function(){return this.rowNode},t.prototype.getBeans=function(){return this.beans},t.prototype.isPrintLayout=function(){return this.printLayout},t.prototype.appendChild=function(e){this.eGui.appendChild(e)},t.prototype.refreshHandle=function(){this.cellRangeFeature&&this.cellRangeFeature.refreshHandle()},t.prototype.getCellPosition=function(){return this.cellPosition},t.prototype.isEditing=function(){return this.editing},t.prototype.startRowOrCellEdit=function(e,r){r===void 0&&(r=null),this.cellComp&&(this.beans.gridOptionsService.get("editType")==="fullRow"?this.rowCtrl.startRowEditing(e,this):this.startEditing(e,!0,r))},t.prototype.getRowCtrl=function(){return this.rowCtrl},t.prototype.getRowPosition=function(){return{rowIndex:this.cellPosition.rowIndex,rowPinned:this.cellPosition.rowPinned}},t.prototype.updateRangeBordersIfRangeCount=function(){this.cellComp&&this.cellRangeFeature&&this.cellRangeFeature.updateRangeBordersIfRangeCount()},t.prototype.onRangeSelectionChanged=function(){this.cellComp&&this.cellRangeFeature&&this.cellRangeFeature.onRangeSelectionChanged()},t.prototype.isRangeSelectionEnabled=function(){return this.cellRangeFeature!=null},t.prototype.focusCell=function(e){e===void 0&&(e=!1),this.beans.focusService.setFocusedCell({rowIndex:this.getCellPosition().rowIndex,column:this.column,rowPinned:this.rowNode.rowPinned,forceBrowserFocus:e})},t.prototype.onRowIndexChanged=function(){this.createCellPosition(),this.onCellFocused(),this.cellRangeFeature&&this.cellRangeFeature.onRangeSelectionChanged()},t.prototype.onFirstRightPinnedChanged=function(){if(this.cellComp){var e=this.column.isFirstRightPinned();this.cellComp.addOrRemoveCssClass(CSS_CELL_FIRST_RIGHT_PINNED,e)}},t.prototype.onLastLeftPinnedChanged=function(){if(this.cellComp){var e=this.column.isLastLeftPinned();this.cellComp.addOrRemoveCssClass(CSS_CELL_LAST_LEFT_PINNED,e)}},t.prototype.onCellFocused=function(e){if(!(!this.cellComp||this.beans.gridOptionsService.is("suppressCellFocus"))){var r=this.beans.focusService.isCellFocused(this.cellPosition);if(this.cellComp.addOrRemoveCssClass(CSS_CELL_FOCUS,r),r&&e&&e.forceBrowserFocus){var o=this.cellComp.getFocusableElement();o.focus({preventScroll:!!e.preventScrollOnBrowserFocus})}var s=this.beans.gridOptionsService.get("editType")==="fullRow";!r&&!s&&this.editing&&this.stopRowOrCellEdit()}},t.prototype.createCellPosition=function(){this.cellPosition={rowIndex:this.rowNode.rowIndex,rowPinned:makeNull(this.rowNode.rowPinned),column:this.column}},t.prototype.applyStaticCssClasses=function(){this.cellComp.addOrRemoveCssClass(CSS_CELL,!0),this.cellComp.addOrRemoveCssClass(CSS_CELL_NOT_INLINE_EDITING,!0);var e=this.column.isAutoHeight()==!0;this.cellComp.addOrRemoveCssClass(CSS_AUTO_HEIGHT,e),this.cellComp.addOrRemoveCssClass(CSS_NORMAL_HEIGHT,!e)},t.prototype.onColumnHover=function(){if(this.cellComp&&this.beans.gridOptionsService.is("columnHoverHighlight")){var e=this.beans.columnHoverService.isHovered(this.column);this.cellComp.addOrRemoveCssClass(CSS_COLUMN_HOVER,e)}},t.prototype.onColDefChanged=function(){this.cellComp&&(this.setWrapText(),this.editing||this.refreshCell({forceRefresh:!0,suppressFlash:!0}))},t.prototype.setWrapText=function(){var e=this.column.getColDef().wrapText==!0;this.cellComp.addOrRemoveCssClass(CSS_CELL_WRAP_TEXT,e)},t.prototype.dispatchCellContextMenuEvent=function(e){var r=this.column.getColDef(),o=this.createEvent(e,Events.EVENT_CELL_CONTEXT_MENU);this.beans.eventService.dispatchEvent(o),r.onCellContextMenu&&window.setTimeout(function(){return r.onCellContextMenu(o)},0)},t.prototype.getCellRenderer=function(){return this.cellComp?this.cellComp.getCellRenderer():null},t.prototype.getCellEditor=function(){return this.cellComp?this.cellComp.getCellEditor():null},t.prototype.destroy=function(){this.onCellCompAttachedFuncs=[],n.prototype.destroy.call(this)},t.prototype.createSelectionCheckbox=function(){var e=new CheckboxSelectionComponent;return this.beans.context.createBean(e),e.init({rowNode:this.rowNode,column:this.column}),e},t.prototype.createDndSource=function(){var e=new DndSourceComp(this.rowNode,this.column,this.eGui);return this.beans.context.createBean(e),e},t.prototype.registerRowDragger=function(e,r,o){var s=this;if(this.customRowDragComp){this.customRowDragComp.setDragElement(e,r);return}var l=this.createRowDragComp(e,r,o);l&&(this.customRowDragComp=l,this.addDestroyFunc(function(){s.beans.context.destroyBean(l),s.customRowDragComp=null}))},t.prototype.createRowDragComp=function(e,r,o){var s=this,l=this.beans.gridOptionsService.is("pagination"),a=this.beans.gridOptionsService.is("rowDragManaged"),h=this.beans.gridOptionsService.isRowModelType("clientSide");if(a){if(!h){doOnce(function(){return console.warn("AG Grid: managed row dragging is only allowed in the Client Side Row Model")},"CellComp.addRowDragging");return}if(l){doOnce(function(){return console.warn("AG Grid: managed row dragging is not possible when doing pagination")},"CellComp.addRowDragging");return}}var y=new RowDragComp(function(){return s.value},this.rowNode,this.column,e,r,o);return this.beans.context.createBean(y),y},t.DOM_DATA_KEY_CELL_CTRL="cellCtrl",t}(BeanStub),__extends$1R=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__values$3=function(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],r=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},__read$l=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray$h=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n},RowType$1;(function(n){n.Normal="Normal",n.FullWidth="FullWidth",n.FullWidthLoading="FullWidthLoading",n.FullWidthGroup="FullWidthGroup",n.FullWidthDetail="FullWidthDetail"})(RowType$1||(RowType$1={}));var instanceIdSequence$2=0,RowCtrl=function(n){__extends$1R(t,n);function t(e,r,o,s,l){var a=n.call(this)||this;return a.allRowGuis=[],a.active=!0,a.centerCellCtrls={list:[],map:{}},a.leftCellCtrls={list:[],map:{}},a.rightCellCtrls={list:[],map:{}},a.slideInAnimation={left:!1,center:!1,right:!1,fullWidth:!1},a.fadeInAnimation={left:!1,center:!1,right:!1,fullWidth:!1},a.lastMouseDownOnDragger=!1,a.updateColumnListsPending=!1,a.businessKeySanitised=null,a.beans=r,a.gridOptionsService=r.gridOptionsService,a.rowNode=e,a.paginationPage=r.paginationProxy.getCurrentPage(),a.useAnimationFrameForCreate=s,a.printLayout=l,a.instanceId=e.id+"-"+instanceIdSequence$2++,a.setAnimateFlags(o),a.initRowBusinessKey(),a.rowFocused=r.focusService.isRowFocused(a.rowNode.rowIndex,a.rowNode.rowPinned),a.rowLevel=r.rowCssClassCalculator.calculateRowLevel(a.rowNode),a.setRowType(),a.addListeners(),a}return t.prototype.initRowBusinessKey=function(){this.businessKeyForNodeFunc=this.gridOptionsService.get("getBusinessKeyForNode"),this.updateRowBusinessKey()},t.prototype.updateRowBusinessKey=function(){if(typeof this.businessKeyForNodeFunc=="function"){var e=this.businessKeyForNodeFunc(this.rowNode);this.businessKeySanitised=escapeString(e)}},t.prototype.isSticky=function(){return this.rowNode.sticky},t.prototype.getBeans=function(){return this.beans},t.prototype.getInstanceId=function(){return this.instanceId},t.prototype.setComp=function(e,r,o){var s={rowComp:e,element:r,containerType:o};this.allRowGuis.push(s),o===RowContainerType.LEFT?this.leftGui=s:o===RowContainerType.RIGHT?this.rightGui=s:o===RowContainerType.FULL_WIDTH?this.fullWidthGui=s:this.centerGui=s,this.initialiseRowComp(s),this.rowType!=="FullWidthLoading"&&!this.rowNode.rowPinned&&this.beans.rowRenderer.dispatchFirstDataRenderedEvent()},t.prototype.unsetComp=function(e){this.allRowGuis=this.allRowGuis.filter(function(r){return r.containerType!==e}),e===RowContainerType.LEFT?this.leftGui=void 0:e===RowContainerType.RIGHT?this.rightGui=void 0:e===RowContainerType.FULL_WIDTH&&(this.fullWidthGui=void 0)},t.prototype.isCacheable=function(){return this.rowType===RowType$1.FullWidthDetail&&this.gridOptionsService.is("keepDetailRows")},t.prototype.setCached=function(e){var r=e?"none":"";this.allRowGuis.forEach(function(o){return o.element.style.display=r})},t.prototype.initialiseRowComp=function(e){var r=this,o=this.gridOptionsService;this.listenOnDomOrder(e),this.onRowHeightChanged(e),this.updateRowIndexes(e),this.setFocusedClasses(e),this.setStylesFromGridOptions(e),o.isRowSelection()&&this.rowNode.selectable&&this.onRowSelected(e),this.updateColumnLists(!this.useAnimationFrameForCreate);var s=e.rowComp;s.setRole("row");var l=this.getInitialRowClasses(e.containerType);l.forEach(function(a){return s.addOrRemoveCssClass(a,!0)}),this.executeSlideAndFadeAnimations(e),this.rowNode.group&&setAriaExpanded(e.element,this.rowNode.expanded==!0),this.setRowCompRowId(s),this.setRowCompRowBusinessKey(s),this.isFullWidth()&&!this.gridOptionsService.is("suppressCellFocus")&&s.setTabIndex(-1),o.setDomData(e.element,t.DOM_DATA_KEY_ROW_CTRL,this),this.addDestroyFunc(function(){return o.setDomData(e.element,t.DOM_DATA_KEY_ROW_CTRL,null)}),this.useAnimationFrameForCreate?this.beans.animationFrameService.createTask(this.addHoverFunctionality.bind(this,e.element),this.rowNode.rowIndex,"createTasksP2"):this.addHoverFunctionality(e.element),this.isFullWidth()&&this.setupFullWidth(e),o.is("rowDragEntireRow")&&this.addRowDraggerToRow(e),this.useAnimationFrameForCreate&&this.beans.animationFrameService.addDestroyTask(function(){r.isAlive()&&e.rowComp.addOrRemoveCssClass("ag-after-created",!0)}),this.executeProcessRowPostCreateFunc()},t.prototype.setRowCompRowBusinessKey=function(e){this.businessKeySanitised!=null&&e.setRowBusinessKey(this.businessKeySanitised)},t.prototype.setRowCompRowId=function(e){var r=escapeString(this.rowNode.id);r!=null&&e.setRowId(r)},t.prototype.executeSlideAndFadeAnimations=function(e){var r=this,o=e.containerType,s=this.slideInAnimation[o];s&&(executeNextVMTurn(function(){r.onTopChanged()}),this.slideInAnimation[o]=!1);var l=this.fadeInAnimation[o];l&&(executeNextVMTurn(function(){e.rowComp.addOrRemoveCssClass("ag-opacity-zero",!1)}),this.fadeInAnimation[o]=!1)},t.prototype.addRowDraggerToRow=function(e){if(this.gridOptionsService.isEnableRangeSelection()){doOnce(function(){console.warn("AG Grid: Setting `rowDragEntireRow: true` in the gridOptions doesn't work with `enableRangeSelection: true`")},"rowDragAndRangeSelectionEnabled");return}var r=this.beans.localeService.getLocaleTextFunc(),o=new RowDragComp(function(){return"1 "+r("rowDragRow","row")},this.rowNode,void 0,e.element,void 0,!0);this.createManagedBean(o,this.beans.context)},t.prototype.setupFullWidth=function(e){var r=this.getPinnedForContainer(e.containerType),o=this.createFullWidthParams(e.element,r);if(!(this.rowType==RowType$1.FullWidthDetail&&!ModuleRegistry.__assertRegistered(ModuleNames.MasterDetailModule,"cell renderer 'agDetailCellRenderer' (for master detail)",this.beans.context.getGridId()))){var s;switch(this.rowType){case RowType$1.FullWidthDetail:s=this.beans.userComponentFactory.getFullWidthDetailCellRendererDetails(o);break;case RowType$1.FullWidthGroup:s=this.beans.userComponentFactory.getFullWidthGroupCellRendererDetails(o);break;case RowType$1.FullWidthLoading:s=this.beans.userComponentFactory.getFullWidthLoadingCellRendererDetails(o);break;default:s=this.beans.userComponentFactory.getFullWidthCellRendererDetails(o);break}e.rowComp.showFullWidth(s)}},t.prototype.isPrintLayout=function(){return this.printLayout},t.prototype.getFullWidthCellRenderer=function(){var e,r;return(r=(e=this.fullWidthGui)===null||e===void 0?void 0:e.rowComp)===null||r===void 0?void 0:r.getFullWidthCellRenderer()},t.prototype.getCellElement=function(e){var r=this.getCellCtrl(e);return r?r.getGui():null},t.prototype.executeProcessRowPostCreateFunc=function(){var e,r=this.gridOptionsService.getCallback("processRowPostCreate");if(!(!r||!this.areAllContainersReady())){var o={eRow:(e=this.centerGui)===null||e===void 0?void 0:e.element,ePinnedLeftRow:this.leftGui?this.leftGui.element:void 0,ePinnedRightRow:this.rightGui?this.rightGui.element:void 0,node:this.rowNode,rowIndex:this.rowNode.rowIndex,addRenderedRowListener:this.addEventListener.bind(this)};r(o)}},t.prototype.areAllContainersReady=function(){var e=!!this.leftGui||!this.beans.columnModel.isPinningLeft(),r=!!this.centerGui,o=!!this.rightGui||!this.beans.columnModel.isPinningRight();return e&&r&&o},t.prototype.setRowType=function(){var e=this.rowNode.stub,r=this.rowNode.isFullWidthCell(),o=this.beans.doingMasterDetail&&this.rowNode.detail,s=this.beans.columnModel.isPivotMode(),l=!!this.rowNode.group&&!this.rowNode.footer,a=l&&this.gridOptionsService.isGroupUseEntireRow(s);e?this.rowType=RowType$1.FullWidthLoading:o?this.rowType=RowType$1.FullWidthDetail:r?this.rowType=RowType$1.FullWidth:a?this.rowType=RowType$1.FullWidthGroup:this.rowType=RowType$1.Normal},t.prototype.updateColumnLists=function(e,r){var o=this;if(e===void 0&&(e=!1),r===void 0&&(r=!1),!this.isFullWidth()){var s=e||this.gridOptionsService.is("suppressAnimationFrame")||this.printLayout;if(s){this.updateColumnListsImpl(r);return}this.updateColumnListsPending||(this.beans.animationFrameService.createTask(function(){o.active&&o.updateColumnListsImpl(!0)},this.rowNode.rowIndex,"createTasksP1"),this.updateColumnListsPending=!0)}},t.prototype.createCellCtrls=function(e,r,o){var s=this;o===void 0&&(o=null);var l={list:[],map:{}},a=function(h,y){l.list.push(y),l.map[h]=y};return r.forEach(function(h){var y=h.getInstanceId(),C=e.map[y];C||(C=new CellCtrl(h,s.rowNode,s.beans,s)),a(y,C)}),e.list.forEach(function(h){var y=l.map[h.getColumn().getInstanceId()]!=null;if(!y){var C=!s.isCellEligibleToBeRemoved(h,o);if(C){a(h.getColumn().getInstanceId(),h);return}h.destroy()}}),l},t.prototype.updateColumnListsImpl=function(e){var r=this;e===void 0&&(e=!1),this.updateColumnListsPending=!1;var o=this.beans.columnModel;if(this.printLayout)this.centerCellCtrls=this.createCellCtrls(this.centerCellCtrls,o.getAllDisplayedColumns()),this.leftCellCtrls={list:[],map:{}},this.rightCellCtrls={list:[],map:{}};else{var s=o.getViewportCenterColumnsForRow(this.rowNode);this.centerCellCtrls=this.createCellCtrls(this.centerCellCtrls,s);var l=o.getDisplayedLeftColumnsForRow(this.rowNode);this.leftCellCtrls=this.createCellCtrls(this.leftCellCtrls,l,"left");var a=o.getDisplayedRightColumnsForRow(this.rowNode);this.rightCellCtrls=this.createCellCtrls(this.rightCellCtrls,a,"right")}this.allRowGuis.forEach(function(h){var y=h.containerType===RowContainerType.LEFT?r.leftCellCtrls:h.containerType===RowContainerType.RIGHT?r.rightCellCtrls:r.centerCellCtrls;h.rowComp.setCellCtrls(y.list,e)})},t.prototype.isCellEligibleToBeRemoved=function(e,r){var o=!0,s=!1,l=e.getColumn();if(l.getPinned()!=r)return o;var a=e.isEditing(),h=this.beans.focusService.isCellFocused(e.getCellPosition()),y=a||h;if(y){var C=e.getColumn(),L=this.beans.columnModel.getAllDisplayedColumns(),Y=L.indexOf(C)>=0;return Y?s:o}return o},t.prototype.listenOnDomOrder=function(e){var r=this,o=function(){var s=r.gridOptionsService.is("ensureDomOrder"),l=r.gridOptionsService.isDomLayout("print");e.rowComp.setDomOrder(s||l)};this.addManagedPropertyListener("domLayout",o),o()},t.prototype.setAnimateFlags=function(e){if(!(this.isSticky()||!e)){var r=exists(this.rowNode.oldRowTop),o=this.beans.columnModel.isPinningLeft(),s=this.beans.columnModel.isPinningRight();r?(this.slideInAnimation.center=!0,this.slideInAnimation.left=o,this.slideInAnimation.right=s):(this.fadeInAnimation.center=!0,this.fadeInAnimation.left=o,this.fadeInAnimation.right=s)}},t.prototype.isEditing=function(){return this.editingRow},t.prototype.stopRowEditing=function(e){this.stopEditing(e)},t.prototype.isFullWidth=function(){return this.rowType!==RowType$1.Normal},t.prototype.getRowType=function(){return this.rowType},t.prototype.refreshFullWidth=function(){var e=this,r=function(y,C){if(!y)return!0;var L=y.rowComp.getFullWidthCellRenderer();if(!L||!L.refresh)return!1;var Y=e.createFullWidthParams(y.element,C),ze=L.refresh(Y);return ze},o=r(this.fullWidthGui,null),s=r(this.centerGui,null),l=r(this.leftGui,"left"),a=r(this.rightGui,"right"),h=o&&s&&l&&a;return h},t.prototype.addListeners=function(){var e=this;this.addManagedListener(this.rowNode,RowNode.EVENT_HEIGHT_CHANGED,function(){return e.onRowHeightChanged()}),this.addManagedListener(this.rowNode,RowNode.EVENT_ROW_SELECTED,function(){return e.onRowSelected()}),this.addManagedListener(this.rowNode,RowNode.EVENT_ROW_INDEX_CHANGED,this.onRowIndexChanged.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_TOP_CHANGED,this.onTopChanged.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_EXPANDED_CHANGED,this.updateExpandedCss.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_HAS_CHILDREN_CHANGED,this.updateExpandedCss.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_DATA_CHANGED,this.onRowNodeDataChanged.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_CELL_CHANGED,this.onRowNodeCellChanged.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_HIGHLIGHT_CHANGED,this.onRowNodeHighlightChanged.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_DRAGGING_CHANGED,this.onRowNodeDraggingChanged.bind(this)),this.addManagedListener(this.rowNode,RowNode.EVENT_UI_LEVEL_CHANGED,this.onUiLevelChanged.bind(this));var r=this.beans.eventService;this.addManagedListener(r,Events.EVENT_PAGINATION_PIXEL_OFFSET_CHANGED,this.onPaginationPixelOffsetChanged.bind(this)),this.addManagedListener(r,Events.EVENT_HEIGHT_SCALE_CHANGED,this.onTopChanged.bind(this)),this.addManagedListener(r,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,this.onDisplayedColumnsChanged.bind(this)),this.addManagedListener(r,Events.EVENT_VIRTUAL_COLUMNS_CHANGED,this.onVirtualColumnsChanged.bind(this)),this.addManagedListener(r,Events.EVENT_CELL_FOCUSED,this.onCellFocused.bind(this)),this.addManagedListener(r,Events.EVENT_CELL_FOCUS_CLEARED,this.onCellFocusCleared.bind(this)),this.addManagedListener(r,Events.EVENT_PAGINATION_CHANGED,this.onPaginationChanged.bind(this)),this.addManagedListener(r,Events.EVENT_MODEL_UPDATED,this.onModelUpdated.bind(this)),this.addManagedListener(r,Events.EVENT_COLUMN_MOVED,this.onColumnMoved.bind(this)),this.addListenersForCellComps()},t.prototype.onColumnMoved=function(){this.updateColumnLists()},t.prototype.addListenersForCellComps=function(){var e=this;this.addManagedListener(this.rowNode,RowNode.EVENT_ROW_INDEX_CHANGED,function(){e.getAllCellCtrls().forEach(function(r){return r.onRowIndexChanged()})}),this.addManagedListener(this.rowNode,RowNode.EVENT_CELL_CHANGED,function(r){e.getAllCellCtrls().forEach(function(o){return o.onCellChanged(r)})})},t.prototype.onRowNodeDataChanged=function(e){var r=this;if(this.rowNode.detailNode&&this.beans.rowRenderer.refreshFullWidthRow(this.rowNode.detailNode),this.isFullWidth()){this.beans.rowRenderer.refreshFullWidthRow(this.rowNode);return}this.getAllCellCtrls().forEach(function(o){return o.refreshCell({suppressFlash:!e.update,newData:!e.update})}),this.allRowGuis.forEach(function(o){r.setRowCompRowId(o.rowComp),r.updateRowBusinessKey(),r.setRowCompRowBusinessKey(o.rowComp)}),this.onRowSelected(),this.postProcessCss()},t.prototype.onRowNodeCellChanged=function(){this.postProcessCss()},t.prototype.postProcessCss=function(){this.setStylesFromGridOptions(),this.postProcessClassesFromGridOptions(),this.postProcessRowClassRules(),this.postProcessRowDragging()},t.prototype.onRowNodeHighlightChanged=function(){var e=this.rowNode.highlighted;this.allRowGuis.forEach(function(r){var o=e===RowHighlightPosition.Above,s=e===RowHighlightPosition.Below;r.rowComp.addOrRemoveCssClass("ag-row-highlight-above",o),r.rowComp.addOrRemoveCssClass("ag-row-highlight-below",s)})},t.prototype.onRowNodeDraggingChanged=function(){this.postProcessRowDragging()},t.prototype.postProcessRowDragging=function(){var e=this.rowNode.dragging;this.allRowGuis.forEach(function(r){return r.rowComp.addOrRemoveCssClass("ag-row-dragging",e)})},t.prototype.updateExpandedCss=function(){var e=this.rowNode.isExpandable(),r=this.rowNode.expanded==!0;this.allRowGuis.forEach(function(o){o.rowComp.addOrRemoveCssClass("ag-row-group",e),o.rowComp.addOrRemoveCssClass("ag-row-group-expanded",e&&r),o.rowComp.addOrRemoveCssClass("ag-row-group-contracted",e&&!r),setAriaExpanded(o.element,e&&r)})},t.prototype.onDisplayedColumnsChanged=function(){this.updateColumnLists(!0),this.beans.columnModel.wasAutoRowHeightEverActive()&&this.rowNode.checkAutoHeights()},t.prototype.onVirtualColumnsChanged=function(){this.updateColumnLists(!1,!0)},t.prototype.getRowPosition=function(){return{rowPinned:makeNull(this.rowNode.rowPinned),rowIndex:this.rowNode.rowIndex}},t.prototype.onKeyboardNavigate=function(e){var r=this.allRowGuis.find(function(y){return y.element.contains(e.target)}),o=r?r.element:null,s=o===e.target;if(s){var l=this.rowNode,a=this.beans.focusService.getFocusedCell(),h={rowIndex:l.rowIndex,rowPinned:l.rowPinned,column:a&&a.column};this.beans.navigationService.navigateToNextCell(e,e.key,h,!0),e.preventDefault()}},t.prototype.onTabKeyDown=function(e){if(!(e.defaultPrevented||isStopPropagationForAgGrid(e))){var r=this.allRowGuis.find(function(a){return a.element.contains(e.target)}),o=r?r.element:null,s=o===e.target,l=null;s||(l=this.beans.focusService.findNextFocusableElement(o,!1,e.shiftKey)),(this.isFullWidth()&&s||!l)&&this.beans.navigationService.onTabKeyDown(this,e)}},t.prototype.onFullWidthRowFocused=function(e){var r,o=this.rowNode,s=e?this.isFullWidth()&&e.rowIndex===o.rowIndex&&e.rowPinned==o.rowPinned:!1,l=this.fullWidthGui?this.fullWidthGui.element:(r=this.centerGui)===null||r===void 0?void 0:r.element;l&&(l.classList.toggle("ag-full-width-focus",s),s&&l.focus({preventScroll:!0}))},t.prototype.refreshCell=function(e){this.centerCellCtrls=this.removeCellCtrl(this.centerCellCtrls,e),this.leftCellCtrls=this.removeCellCtrl(this.leftCellCtrls,e),this.rightCellCtrls=this.removeCellCtrl(this.rightCellCtrls,e),this.updateColumnLists()},t.prototype.removeCellCtrl=function(e,r){var o={list:[],map:{}};return e.list.forEach(function(s){s!==r&&(o.list.push(s),o.map[s.getInstanceId()]=s)}),o},t.prototype.onMouseEvent=function(e,r){switch(e){case"dblclick":this.onRowDblClick(r);break;case"click":this.onRowClick(r);break;case"touchstart":case"mousedown":this.onRowMouseDown(r);break}},t.prototype.createRowEvent=function(e,r){return{type:e,node:this.rowNode,data:this.rowNode.data,rowIndex:this.rowNode.rowIndex,rowPinned:this.rowNode.rowPinned,context:this.gridOptionsService.context,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,event:r}},t.prototype.createRowEventWithSource=function(e,r){var o=this.createRowEvent(e,r);return o.source=this,o},t.prototype.onRowDblClick=function(e){if(!isStopPropagationForAgGrid(e)){var r=this.createRowEventWithSource(Events.EVENT_ROW_DOUBLE_CLICKED,e);this.beans.eventService.dispatchEvent(r)}},t.prototype.onRowMouseDown=function(e){if(this.lastMouseDownOnDragger=isElementChildOfClass(e.target,"ag-row-drag",3),!!this.isFullWidth()){var r=this.rowNode,o=this.beans.columnModel;this.beans.rangeService&&this.beans.rangeService.removeAllCellRanges(),this.beans.focusService.setFocusedCell({rowIndex:r.rowIndex,column:o.getAllDisplayedColumns()[0],rowPinned:r.rowPinned,forceBrowserFocus:!0})}},t.prototype.onRowClick=function(e){var r=isStopPropagationForAgGrid(e)||this.lastMouseDownOnDragger;if(!r){var o=this.createRowEventWithSource(Events.EVENT_ROW_CLICKED,e);this.beans.eventService.dispatchEvent(o);var s=e.ctrlKey||e.metaKey,l=e.shiftKey,a=this.gridOptionsService.is("groupSelectsChildren");if(!(a&&this.rowNode.group||!this.rowNode.selectable||this.rowNode.rowPinned||!this.gridOptionsService.isRowSelection()||this.gridOptionsService.is("suppressRowClickSelection"))){var h=this.gridOptionsService.is("rowMultiSelectWithClick"),y=!this.gridOptionsService.is("suppressRowDeselection"),C="rowClicked";if(this.rowNode.isSelected())h?this.rowNode.setSelectedParams({newValue:!1,event:e,source:C}):s?y&&this.rowNode.setSelectedParams({newValue:!1,event:e,source:C}):this.rowNode.setSelectedParams({newValue:!0,clearSelection:!l,rangeSelect:l,event:e,source:C});else{var L=h?!1:!s;this.rowNode.setSelectedParams({newValue:!0,clearSelection:L,rangeSelect:l,event:e,source:C})}}}},t.prototype.setupDetailRowAutoHeight=function(e){var r=this;if(this.rowType===RowType$1.FullWidthDetail&&this.gridOptionsService.is("detailRowAutoHeight")){var o=function(){var l=e.clientHeight;if(l!=null&&l>0){var a=function(){r.rowNode.setRowHeight(l),r.beans.clientSideRowModel?r.beans.clientSideRowModel.onRowHeightChanged():r.beans.serverSideRowModel&&r.beans.serverSideRowModel.onRowHeightChanged()};r.beans.frameworkOverrides.setTimeout(a,0)}},s=this.beans.resizeObserverService.observeResize(e,o);this.addDestroyFunc(s),o()}},t.prototype.createFullWidthParams=function(e,r){var o=this,s={fullWidth:!0,data:this.rowNode.data,node:this.rowNode,value:this.rowNode.key,valueFormatted:this.rowNode.key,rowIndex:this.rowNode.rowIndex,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context,eGridCell:e,eParentOfValue:e,pinned:r,addRenderedRowListener:this.addEventListener.bind(this),registerRowDragger:function(l,a,h,y){return o.addFullWidthRowDragging(l,a,h,y)}};return s},t.prototype.addFullWidthRowDragging=function(e,r,o,s){if(o===void 0&&(o=""),!!this.isFullWidth()){var l=new RowDragComp(function(){return o},this.rowNode,void 0,e,r,s);this.createManagedBean(l,this.beans.context)}},t.prototype.onUiLevelChanged=function(){var e=this.beans.rowCssClassCalculator.calculateRowLevel(this.rowNode);if(this.rowLevel!=e){var r="ag-row-level-"+e,o="ag-row-level-"+this.rowLevel;this.allRowGuis.forEach(function(s){s.rowComp.addOrRemoveCssClass(r,!0),s.rowComp.addOrRemoveCssClass(o,!1)})}this.rowLevel=e},t.prototype.isFirstRowOnPage=function(){return this.rowNode.rowIndex===this.beans.paginationProxy.getPageFirstRow()},t.prototype.isLastRowOnPage=function(){return this.rowNode.rowIndex===this.beans.paginationProxy.getPageLastRow()},t.prototype.onModelUpdated=function(){this.refreshFirstAndLastRowStyles()},t.prototype.refreshFirstAndLastRowStyles=function(){var e=this.isFirstRowOnPage(),r=this.isLastRowOnPage();this.firstRowOnPage!==e&&(this.firstRowOnPage=e,this.allRowGuis.forEach(function(o){return o.rowComp.addOrRemoveCssClass("ag-row-first",e)})),this.lastRowOnPage!==r&&(this.lastRowOnPage=r,this.allRowGuis.forEach(function(o){return o.rowComp.addOrRemoveCssClass("ag-row-last",r)}))},t.prototype.stopEditing=function(e){var r,o;if(e===void 0&&(e=!1),!this.stoppingRowEdit){var s=this.getAllCellCtrls(),l=this.editingRow;this.stoppingRowEdit=!0;var a=!1;try{for(var h=__values$3(s),y=h.next();!y.done;y=h.next()){var C=y.value,L=C.stopEditing(e);l&&!e&&!a&&L&&(a=!0)}}catch(ze){r={error:ze}}finally{try{y&&!y.done&&(o=h.return)&&o.call(h)}finally{if(r)throw r.error}}if(a){var Y=this.createRowEvent(Events.EVENT_ROW_VALUE_CHANGED);this.beans.eventService.dispatchEvent(Y)}l&&this.setEditingRow(!1),this.stoppingRowEdit=!1}},t.prototype.setInlineEditingCss=function(e){this.allRowGuis.forEach(function(r){r.rowComp.addOrRemoveCssClass("ag-row-inline-editing",e),r.rowComp.addOrRemoveCssClass("ag-row-not-inline-editing",!e)})},t.prototype.setEditingRow=function(e){this.editingRow=e,this.allRowGuis.forEach(function(o){return o.rowComp.addOrRemoveCssClass("ag-row-editing",e)});var r=e?this.createRowEvent(Events.EVENT_ROW_EDITING_STARTED):this.createRowEvent(Events.EVENT_ROW_EDITING_STOPPED);this.beans.eventService.dispatchEvent(r)},t.prototype.startRowEditing=function(e,r,o){if(e===void 0&&(e=null),r===void 0&&(r=null),o===void 0&&(o=null),!this.editingRow){var s=this.getAllCellCtrls().reduce(function(l,a){var h=a===r;return h?a.startEditing(e,h,o):a.startEditing(null,h,o),l?!0:a.isEditing()},!1);s&&this.setEditingRow(!0)}},t.prototype.getAllCellCtrls=function(){if(this.leftCellCtrls.list.length===0&&this.rightCellCtrls.list.length===0)return this.centerCellCtrls.list;var e=__spreadArray$h(__spreadArray$h(__spreadArray$h([],__read$l(this.centerCellCtrls.list)),__read$l(this.leftCellCtrls.list)),__read$l(this.rightCellCtrls.list));return e},t.prototype.postProcessClassesFromGridOptions=function(){var e=this,r=this.beans.rowCssClassCalculator.processClassesFromGridOptions(this.rowNode);!r||!r.length||r.forEach(function(o){e.allRowGuis.forEach(function(s){return s.rowComp.addOrRemoveCssClass(o,!0)})})},t.prototype.postProcessRowClassRules=function(){var e=this;this.beans.rowCssClassCalculator.processRowClassRules(this.rowNode,function(r){e.allRowGuis.forEach(function(o){return o.rowComp.addOrRemoveCssClass(r,!0)})},function(r){e.allRowGuis.forEach(function(o){return o.rowComp.addOrRemoveCssClass(r,!1)})})},t.prototype.setStylesFromGridOptions=function(e){var r=this.processStylesFromGridOptions();this.forEachGui(e,function(o){return o.rowComp.setUserStyles(r)})},t.prototype.getPinnedForContainer=function(e){var r=e===RowContainerType.LEFT?"left":e===RowContainerType.RIGHT?"right":null;return r},t.prototype.getInitialRowClasses=function(e){var r=this.getPinnedForContainer(e),o={rowNode:this.rowNode,rowFocused:this.rowFocused,fadeRowIn:this.fadeInAnimation[e],rowIsEven:this.rowNode.rowIndex%2===0,rowLevel:this.rowLevel,fullWidthRow:this.isFullWidth(),firstRowOnPage:this.isFirstRowOnPage(),lastRowOnPage:this.isLastRowOnPage(),printLayout:this.printLayout,expandable:this.rowNode.isExpandable(),pinned:r};return this.beans.rowCssClassCalculator.getInitialRowClasses(o)},t.prototype.processStylesFromGridOptions=function(){var e=this.gridOptionsService.get("rowStyle");if(e&&typeof e=="function"){console.warn("AG Grid: rowStyle should be an object of key/value styles, not be a function, use getRowStyle() instead");return}var r=this.gridOptionsService.getCallback("getRowStyle"),o;if(r){var s={data:this.rowNode.data,node:this.rowNode,rowIndex:this.rowNode.rowIndex};o=r(s)}return Object.assign({},e,o)},t.prototype.onRowSelected=function(e){var r=this,o=!!this.rowNode.isSelected();this.forEachGui(e,function(s){s.rowComp.addOrRemoveCssClass("ag-row-selected",o),setAriaSelected(s.element,o?!0:void 0);var l=r.createAriaLabel();setAriaLabel(s.element,l??"")})},t.prototype.createAriaLabel=function(){var e=this.rowNode.isSelected();if(!(e&&this.gridOptionsService.is("suppressRowDeselection"))){var r=this.beans.localeService.getLocaleTextFunc(),o=r(e?"ariaRowDeselect":"ariaRowSelect","Press SPACE to "+(e?"deselect":"select")+" this row.");return o}},t.prototype.isUseAnimationFrameForCreate=function(){return this.useAnimationFrameForCreate},t.prototype.addHoverFunctionality=function(e){var r=this;this.active&&(this.addManagedListener(e,"mouseenter",function(){return r.rowNode.onMouseEnter()}),this.addManagedListener(e,"mouseleave",function(){return r.rowNode.onMouseLeave()}),this.addManagedListener(this.rowNode,RowNode.EVENT_MOUSE_ENTER,function(){!r.beans.dragService.isDragging()&&!r.gridOptionsService.is("suppressRowHoverHighlight")&&(e.classList.add("ag-row-hover"),r.rowNode.setHovered(!0))}),this.addManagedListener(this.rowNode,RowNode.EVENT_MOUSE_LEAVE,function(){e.classList.remove("ag-row-hover"),r.rowNode.setHovered(!1)}))},t.prototype.roundRowTopToBounds=function(e){var r=this.beans.ctrlsService.getGridBodyCtrl(),o=r.getScrollFeature().getVScrollPosition(),s=this.applyPaginationOffset(o.top,!0)-100,l=this.applyPaginationOffset(o.bottom,!0)+100;return Math.min(Math.max(s,e),l)},t.prototype.getFrameworkOverrides=function(){return this.beans.frameworkOverrides},t.prototype.forEachGui=function(e,r){var o=e?[e]:this.allRowGuis;o.forEach(r)},t.prototype.onRowHeightChanged=function(e){if(this.rowNode.rowHeight!=null){var r=this.rowNode.rowHeight,o=this.beans.environment.getDefaultRowHeight(),s=this.gridOptionsService.isGetRowHeightFunction(),l=s?this.gridOptionsService.getRowHeightForNode(this.rowNode).height:void 0,a=l?Math.min(o,l)-2+"px":void 0;this.forEachGui(e,function(h){h.element.style.height=r+"px",a&&h.element.style.setProperty("--ag-line-height",a)})}},t.prototype.addEventListener=function(e,r){n.prototype.addEventListener.call(this,e,r)},t.prototype.removeEventListener=function(e,r){n.prototype.removeEventListener.call(this,e,r)},t.prototype.destroyFirstPass=function(){this.active=!1,this.gridOptionsService.isAnimateRows()&&this.setupRemoveAnimation(),this.rowNode.setHovered(!1);var e=this.createRowEvent(Events.EVENT_VIRTUAL_ROW_REMOVED);this.dispatchEvent(e),this.beans.eventService.dispatchEvent(e),n.prototype.destroy.call(this)},t.prototype.setupRemoveAnimation=function(){if(!this.isSticky()){var e=this.rowNode.rowTop!=null;if(e){var r=this.roundRowTopToBounds(this.rowNode.rowTop);this.setRowTop(r)}else this.allRowGuis.forEach(function(o){return o.rowComp.addOrRemoveCssClass("ag-opacity-zero",!0)})}},t.prototype.destroySecondPass=function(){this.allRowGuis.length=0;var e=function(r){return r.list.forEach(function(o){return o.destroy()}),{list:[],map:{}}};this.centerCellCtrls=e(this.centerCellCtrls),this.leftCellCtrls=e(this.leftCellCtrls),this.rightCellCtrls=e(this.rightCellCtrls)},t.prototype.setFocusedClasses=function(e){var r=this;this.forEachGui(e,function(o){o.rowComp.addOrRemoveCssClass("ag-row-focus",r.rowFocused),o.rowComp.addOrRemoveCssClass("ag-row-no-focus",!r.rowFocused)})},t.prototype.onCellFocused=function(){this.onCellFocusChanged()},t.prototype.onCellFocusCleared=function(){this.onCellFocusChanged()},t.prototype.onCellFocusChanged=function(){var e=this.beans.focusService.isRowFocused(this.rowNode.rowIndex,this.rowNode.rowPinned);e!==this.rowFocused&&(this.rowFocused=e,this.setFocusedClasses()),!e&&this.editingRow&&this.stopEditing(!1)},t.prototype.onPaginationChanged=function(){var e=this.beans.paginationProxy.getCurrentPage();this.paginationPage!==e&&(this.paginationPage=e,this.onTopChanged()),this.refreshFirstAndLastRowStyles()},t.prototype.onTopChanged=function(){this.setRowTop(this.rowNode.rowTop)},t.prototype.onPaginationPixelOffsetChanged=function(){this.onTopChanged()},t.prototype.applyPaginationOffset=function(e,r){if(r===void 0&&(r=!1),this.rowNode.isRowPinned()||this.rowNode.sticky)return e;var o=this.beans.paginationProxy.getPixelOffset(),s=r?1:-1;return e+o*s},t.prototype.setRowTop=function(e){if(!this.printLayout&&exists(e)){var r=this.applyPaginationOffset(e),o=this.rowNode.isRowPinned()||this.rowNode.sticky,s=o?r:this.beans.rowContainerHeightService.getRealPixelPosition(r),l=s+"px";this.setRowTopStyle(l)}},t.prototype.getInitialRowTop=function(e){var r=this.gridOptionsService.is("suppressRowTransform");return r?this.getInitialRowTopShared(e):void 0},t.prototype.getInitialTransform=function(e){var r=this.gridOptionsService.is("suppressRowTransform");return r?void 0:"translateY("+this.getInitialRowTopShared(e)+")"},t.prototype.getInitialRowTopShared=function(e){if(this.printLayout)return"";var r;if(this.isSticky())r=this.rowNode.stickyRowTop;else{var o=this.slideInAnimation[e]?this.roundRowTopToBounds(this.rowNode.oldRowTop):this.rowNode.rowTop,s=this.applyPaginationOffset(o);r=this.rowNode.isRowPinned()?s:this.beans.rowContainerHeightService.getRealPixelPosition(s)}return r+"px"},t.prototype.setRowTopStyle=function(e){var r=this.gridOptionsService.is("suppressRowTransform");this.allRowGuis.forEach(function(o){return r?o.rowComp.setTop(e):o.rowComp.setTransform("translateY("+e+")")})},t.prototype.getRowNode=function(){return this.rowNode},t.prototype.getCellCtrl=function(e){var r=null;return this.getAllCellCtrls().forEach(function(o){o.getColumn()==e&&(r=o)}),r!=null||this.getAllCellCtrls().forEach(function(o){o.getColSpanningList().indexOf(e)>=0&&(r=o)}),r},t.prototype.onRowIndexChanged=function(){this.rowNode.rowIndex!=null&&(this.onCellFocusChanged(),this.updateRowIndexes(),this.postProcessCss())},t.prototype.updateRowIndexes=function(e){var r=this.rowNode.getRowIndexString(),o=this.beans.headerNavigationService.getHeaderRowCount(),s=this.rowNode.rowIndex%2===0,l=o+this.rowNode.rowIndex+1;this.forEachGui(e,function(a){a.rowComp.setRowIndex(r),a.rowComp.addOrRemoveCssClass("ag-row-even",s),a.rowComp.addOrRemoveCssClass("ag-row-odd",!s),setAriaRowIndex(a.element,l)})},t.prototype.getPinnedLeftRowElement=function(){return this.leftGui?this.leftGui.element:void 0},t.prototype.getPinnedRightRowElement=function(){return this.rightGui?this.rightGui.element:void 0},t.prototype.getBodyRowElement=function(){return this.centerGui?this.centerGui.element:void 0},t.prototype.getFullWidthRowElement=function(){return this.fullWidthGui?this.fullWidthGui.element:void 0},t.DOM_DATA_KEY_ROW_CTRL="renderedRow",t}(BeanStub),__extends$1Q=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1M=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__read$k=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},RowContainerEventsFeature=function(n){__extends$1Q(t,n);function t(e){var r=n.call(this)||this;return r.element=e,r}return t.prototype.postConstruct=function(){this.addKeyboardListeners(),this.addMouseListeners(),this.mockContextMenuForIPad()},t.prototype.addKeyboardListeners=function(){var e="keydown",r=this.processKeyboardEvent.bind(this,e);this.addManagedListener(this.element,e,r)},t.prototype.addMouseListeners=function(){var e=this,r=isEventSupported("touchstart")?"touchstart":"mousedown",o=["dblclick","contextmenu","mouseover","mouseout","click",r];o.forEach(function(s){var l=e.processMouseEvent.bind(e,s);e.addManagedListener(e.element,s,l)})},t.prototype.processMouseEvent=function(e,r){if(!(!this.mouseEventService.isEventFromThisGrid(r)||isStopPropagationForAgGrid(r))){var o=this.getRowForEvent(r),s=this.mouseEventService.getRenderedCellForEvent(r);e==="contextmenu"?this.handleContextMenuMouseEvent(r,null,o,s):(s&&s.onMouseEvent(e,r),o&&o.onMouseEvent(e,r))}},t.prototype.mockContextMenuForIPad=function(){var e=this;if(isIOSUserAgent()){var r=new TouchListener(this.element),o=function(s){var l=e.getRowForEvent(s.touchEvent),a=e.mouseEventService.getRenderedCellForEvent(s.touchEvent);e.handleContextMenuMouseEvent(null,s.touchEvent,l,a)};this.addManagedListener(r,TouchListener.EVENT_LONG_TAP,o),this.addDestroyFunc(function(){return r.destroy()})}},t.prototype.getRowForEvent=function(e){for(var r=e.target;r;){var o=this.gridOptionsService.getDomData(r,RowCtrl.DOM_DATA_KEY_ROW_CTRL);if(o)return o;r=r.parentElement}return null},t.prototype.handleContextMenuMouseEvent=function(e,r,o,s){var l=o?o.getRowNode():null,a=s?s.getColumn():null,h=null;if(a){var y=e||r;s.dispatchCellContextMenuEvent(y),h=this.valueService.getValue(a,l)}var C=this.ctrlsService.getGridBodyCtrl(),L=s?s.getGui():C.getGridBodyElement();this.contextMenuFactory&&this.contextMenuFactory.onContextMenu(e,r,l,a,h,L)},t.prototype.getControlsForEventTarget=function(e){return{cellCtrl:getCtrlForEventTarget(this.gridOptionsService,e,CellCtrl.DOM_DATA_KEY_CELL_CTRL),rowCtrl:getCtrlForEventTarget(this.gridOptionsService,e,RowCtrl.DOM_DATA_KEY_ROW_CTRL)}},t.prototype.processKeyboardEvent=function(e,r){var o=this.getControlsForEventTarget(r.target),s=o.cellCtrl,l=o.rowCtrl;r.defaultPrevented||(s?this.processCellKeyboardEvent(s,e,r):l&&l.isFullWidth()&&this.processFullWidthRowKeyboardEvent(l,e,r))},t.prototype.processCellKeyboardEvent=function(e,r,o){var s=e.getRowNode(),l=e.getColumn(),a=e.isEditing(),h=!isUserSuppressingKeyboardEvent(this.gridOptionsService,o,s,l,a);if(h&&r==="keydown"){var y=!a&&this.navigationService.handlePageScrollingKey(o);y||e.onKeyDown(o),this.doGridOperations(o,e.isEditing()),isEventFromPrintableCharacter(o)&&e.processCharacter(o)}if(r==="keydown"){var C=e.createEvent(o,Events.EVENT_CELL_KEY_DOWN);this.eventService.dispatchEvent(C)}},t.prototype.processFullWidthRowKeyboardEvent=function(e,r,o){var s=e.getRowNode(),l=this.focusService.getFocusedCell(),a=l&&l.column,h=!isUserSuppressingKeyboardEvent(this.gridOptionsService,o,s,a,!1);if(h){var y=o.key;if(r==="keydown")switch(y){case KeyCode.PAGE_HOME:case KeyCode.PAGE_END:case KeyCode.PAGE_UP:case KeyCode.PAGE_DOWN:this.navigationService.handlePageScrollingKey(o,!0);break;case KeyCode.UP:case KeyCode.DOWN:e.onKeyboardNavigate(o);break;case KeyCode.TAB:e.onTabKeyDown(o);break}}if(r==="keydown"){var C=e.createRowEvent(Events.EVENT_CELL_KEY_DOWN,o);this.eventService.dispatchEvent(C)}},t.prototype.doGridOperations=function(e,r){if(!(!e.ctrlKey&&!e.metaKey)&&!r&&this.mouseEventService.isEventFromThisGrid(e)){var o=normaliseQwertyAzerty(e);if(o===KeyCode.A)return this.onCtrlAndA(e);if(o===KeyCode.C)return this.onCtrlAndC(e);if(o===KeyCode.D)return this.onCtrlAndD(e);if(o===KeyCode.V)return this.onCtrlAndV(e);if(o===KeyCode.X)return this.onCtrlAndX(e);if(o===KeyCode.Y)return this.onCtrlAndY();if(o===KeyCode.Z)return this.onCtrlAndZ(e)}},t.prototype.onCtrlAndA=function(e){var r=this,o=r.pinnedRowModel,s=r.paginationProxy,l=r.rangeService;if(l&&s.isRowsToRender()){var a=__read$k([o.isEmpty("top"),o.isEmpty("bottom")],2),h=a[0],y=a[1],C=h?null:"top",L=void 0,Y=void 0;y?(L=null,Y=this.paginationProxy.getRowCount()-1):(L="bottom",Y=o.getPinnedBottomRowData().length-1);var ze=this.columnModel.getAllDisplayedColumns();if(missingOrEmpty(ze))return;l.setCellRange({rowStartIndex:0,rowStartPinned:C,rowEndIndex:Y,rowEndPinned:L,columnStart:ze[0],columnEnd:last(ze)})}e.preventDefault()},t.prototype.onCtrlAndC=function(e){if(!(!this.clipboardService||this.gridOptionsService.is("enableCellTextSelection"))){var r=this.getControlsForEventTarget(e.target),o=r.cellCtrl,s=r.rowCtrl;o!=null&&o.isEditing()||s!=null&&s.isEditing()||(e.preventDefault(),this.clipboardService.copyToClipboard())}},t.prototype.onCtrlAndX=function(e){if(!(!this.clipboardService||this.gridOptionsService.is("enableCellTextSelection")||this.gridOptionsService.is("suppressCutToClipboard"))){var r=this.getControlsForEventTarget(e.target),o=r.cellCtrl,s=r.rowCtrl;o!=null&&o.isEditing()||s!=null&&s.isEditing()||(e.preventDefault(),this.clipboardService.cutToClipboard(void 0,"ui"))}},t.prototype.onCtrlAndV=function(e){var r=this.getControlsForEventTarget(e.target),o=r.cellCtrl,s=r.rowCtrl;o!=null&&o.isEditing()||s!=null&&s.isEditing()||this.clipboardService&&!this.gridOptionsService.is("suppressClipboardPaste")&&this.clipboardService.pasteFromClipboard()},t.prototype.onCtrlAndD=function(e){this.clipboardService&&!this.gridOptionsService.is("suppressClipboardPaste")&&this.clipboardService.copyRangeDown(),e.preventDefault()},t.prototype.onCtrlAndZ=function(e){this.gridOptionsService.is("undoRedoCellEditing")&&(e.preventDefault(),e.shiftKey?this.undoRedoService.redo("ui"):this.undoRedoService.undo("ui"))},t.prototype.onCtrlAndY=function(){this.undoRedoService.redo("ui")},__decorate$1M([Autowired("mouseEventService")],t.prototype,"mouseEventService",void 0),__decorate$1M([Autowired("valueService")],t.prototype,"valueService",void 0),__decorate$1M([Optional("contextMenuFactory")],t.prototype,"contextMenuFactory",void 0),__decorate$1M([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),__decorate$1M([Autowired("navigationService")],t.prototype,"navigationService",void 0),__decorate$1M([Autowired("focusService")],t.prototype,"focusService",void 0),__decorate$1M([Autowired("undoRedoService")],t.prototype,"undoRedoService",void 0),__decorate$1M([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$1M([Autowired("paginationProxy")],t.prototype,"paginationProxy",void 0),__decorate$1M([Autowired("pinnedRowModel")],t.prototype,"pinnedRowModel",void 0),__decorate$1M([Optional("rangeService")],t.prototype,"rangeService",void 0),__decorate$1M([Optional("clipboardService")],t.prototype,"clipboardService",void 0),__decorate$1M([PostConstruct],t.prototype,"postConstruct",null),t}(BeanStub),__extends$1P=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1L=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},ViewportSizeFeature=function(n){__extends$1P(t,n);function t(e){var r=n.call(this)||this;return r.centerContainerCtrl=e,r}return t.prototype.postConstruct=function(){var e=this;this.ctrlsService.whenReady(function(){e.gridBodyCtrl=e.ctrlsService.getGridBodyCtrl(),e.listenForResize()}),this.addManagedListener(this.eventService,Events.EVENT_SCROLLBAR_WIDTH_CHANGED,this.onScrollbarWidthChanged.bind(this))},t.prototype.listenForResize=function(){var e=this,r=function(){return e.onCenterViewportResized()};this.centerContainerCtrl.registerViewportResizeListener(r),this.gridBodyCtrl.registerBodyViewportResizeListener(r)},t.prototype.onScrollbarWidthChanged=function(){this.checkViewportAndScrolls()},t.prototype.onCenterViewportResized=function(){if(this.centerContainerCtrl.isViewportVisible()){this.checkViewportAndScrolls();var e=this.centerContainerCtrl.getCenterWidth();e!==this.centerWidth&&(this.centerWidth=e,this.columnModel.refreshFlexedColumns({viewportWidth:this.centerWidth,updateBodyWidths:!0,fireResizedEvent:!0}))}else this.bodyHeight=0},t.prototype.checkViewportAndScrolls=function(){this.updateScrollVisibleService(),this.checkBodyHeight(),this.onHorizontalViewportChanged(),this.gridBodyCtrl.getScrollFeature().checkScrollLeft()},t.prototype.getBodyHeight=function(){return this.bodyHeight},t.prototype.checkBodyHeight=function(){var e=this.gridBodyCtrl.getBodyViewportElement(),r=getInnerHeight(e);if(this.bodyHeight!==r){this.bodyHeight=r;var o={type:Events.EVENT_BODY_HEIGHT_CHANGED};this.eventService.dispatchEvent(o)}},t.prototype.updateScrollVisibleService=function(){this.updateScrollVisibleServiceImpl(),setTimeout(this.updateScrollVisibleServiceImpl.bind(this),500)},t.prototype.updateScrollVisibleServiceImpl=function(){var e={horizontalScrollShowing:this.isHorizontalScrollShowing(),verticalScrollShowing:this.gridBodyCtrl.isVerticalScrollShowing()};this.scrollVisibleService.setScrollsVisible(e)},t.prototype.isHorizontalScrollShowing=function(){return this.centerContainerCtrl.isHorizontalScrollShowing()},t.prototype.onHorizontalViewportChanged=function(){var e=this.centerContainerCtrl.getCenterWidth(),r=this.centerContainerCtrl.getViewportScrollLeft();this.columnModel.setViewportPosition(e,r)},__decorate$1L([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),__decorate$1L([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$1L([Autowired("scrollVisibleService")],t.prototype,"scrollVisibleService",void 0),__decorate$1L([PostConstruct],t.prototype,"postConstruct",null),t}(BeanStub),__extends$1O=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1K=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},SetPinnedLeftWidthFeature=function(n){__extends$1O(t,n);function t(e){var r=n.call(this)||this;return r.element=e,r}return t.prototype.postConstruct=function(){this.addManagedListener(this.eventService,Events.EVENT_LEFT_PINNED_WIDTH_CHANGED,this.onPinnedLeftWidthChanged.bind(this))},t.prototype.onPinnedLeftWidthChanged=function(){var e=this.pinnedWidthService.getPinnedLeftWidth(),r=e>0;setDisplayed(this.element,r),setFixedWidth(this.element,e)},t.prototype.getWidth=function(){return this.pinnedWidthService.getPinnedLeftWidth()},__decorate$1K([Autowired("pinnedWidthService")],t.prototype,"pinnedWidthService",void 0),__decorate$1K([PostConstruct],t.prototype,"postConstruct",null),t}(BeanStub),__extends$1N=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1J=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},SetPinnedRightWidthFeature=function(n){__extends$1N(t,n);function t(e){var r=n.call(this)||this;return r.element=e,r}return t.prototype.postConstruct=function(){this.addManagedListener(this.eventService,Events.EVENT_RIGHT_PINNED_WIDTH_CHANGED,this.onPinnedRightWidthChanged.bind(this))},t.prototype.onPinnedRightWidthChanged=function(){var e=this.pinnedWidthService.getPinnedRightWidth(),r=e>0;setDisplayed(this.element,r),setFixedWidth(this.element,e)},t.prototype.getWidth=function(){return this.pinnedWidthService.getPinnedRightWidth()},__decorate$1J([Autowired("pinnedWidthService")],t.prototype,"pinnedWidthService",void 0),__decorate$1J([PostConstruct],t.prototype,"postConstruct",null),t}(BeanStub),__extends$1M=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1I=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},SetHeightFeature=function(n){__extends$1M(t,n);function t(e,r){var o=n.call(this)||this;return o.eContainer=e,o.eWrapper=r,o}return t.prototype.postConstruct=function(){this.addManagedListener(this.eventService,Events.EVENT_ROW_CONTAINER_HEIGHT_CHANGED,this.onHeightChanged.bind(this))},t.prototype.onHeightChanged=function(){var e=this.maxDivHeightScaler.getUiContainerHeight(),r=e!=null?e+"px":"";this.eContainer.style.height=r,this.eWrapper&&(this.eWrapper.style.height=r)},__decorate$1I([Autowired("rowContainerHeightService")],t.prototype,"maxDivHeightScaler",void 0),__decorate$1I([PostConstruct],t.prototype,"postConstruct",null),t}(BeanStub),__extends$1L=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1H=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},DragListenerFeature=function(n){__extends$1L(t,n);function t(e){var r=n.call(this)||this;return r.eContainer=e,r}return t.prototype.postConstruct=function(){var e=this;if(!(!this.gridOptionsService.isEnableRangeSelection()||missing(this.rangeService))){var r={eElement:this.eContainer,onDragStart:this.rangeService.onDragStart.bind(this.rangeService),onDragStop:this.rangeService.onDragStop.bind(this.rangeService),onDragging:this.rangeService.onDragging.bind(this.rangeService)};this.dragService.addDragSource(r),this.addDestroyFunc(function(){return e.dragService.removeDragSource(r)})}},__decorate$1H([Optional("rangeService")],t.prototype,"rangeService",void 0),__decorate$1H([Autowired("dragService")],t.prototype,"dragService",void 0),__decorate$1H([PostConstruct],t.prototype,"postConstruct",null),t}(BeanStub),__extends$1K=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1G=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},CenterWidthFeature=function(n){__extends$1K(t,n);function t(e,r){r===void 0&&(r=!1);var o=n.call(this)||this;return o.callback=e,o.addSpacer=r,o}return t.prototype.postConstruct=function(){var e=this.setWidth.bind(this);this.addManagedPropertyListener("domLayout",e),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,e),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED,e),this.addManagedListener(this.eventService,Events.EVENT_LEFT_PINNED_WIDTH_CHANGED,e),this.addSpacer&&(this.addManagedListener(this.eventService,Events.EVENT_RIGHT_PINNED_WIDTH_CHANGED,e),this.addManagedListener(this.eventService,Events.EVENT_SCROLL_VISIBILITY_CHANGED,e),this.addManagedListener(this.eventService,Events.EVENT_SCROLLBAR_WIDTH_CHANGED,e)),this.setWidth()},t.prototype.setWidth=function(){var e=this.columnModel,r=this.gridOptionsService.isDomLayout("print"),o=e.getBodyContainerWidth(),s=e.getDisplayedColumnsLeftWidth(),l=e.getDisplayedColumnsRightWidth(),a;if(r)a=o+s+l;else if(a=o,this.addSpacer){var h=this.gridOptionsService.is("enableRtl")?s:l;h===0&&this.scrollVisibleService.isVerticalScrollShowing()&&(a+=this.gridOptionsService.getScrollbarWidth())}this.callback(a)},__decorate$1G([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$1G([Autowired("scrollVisibleService")],t.prototype,"scrollVisibleService",void 0),__decorate$1G([PostConstruct],t.prototype,"postConstruct",null),t}(BeanStub),__extends$1J=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1F=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__read$j=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray$g=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n},RowContainerName;(function(n){n.LEFT="left",n.RIGHT="right",n.CENTER="center",n.FULL_WIDTH="fullWidth",n.TOP_LEFT="topLeft",n.TOP_RIGHT="topRight",n.TOP_CENTER="topCenter",n.TOP_FULL_WIDTH="topFullWidth",n.STICKY_TOP_LEFT="stickyTopLeft",n.STICKY_TOP_RIGHT="stickyTopRight",n.STICKY_TOP_CENTER="stickyTopCenter",n.STICKY_TOP_FULL_WIDTH="stickyTopFullWidth",n.BOTTOM_LEFT="bottomLeft",n.BOTTOM_RIGHT="bottomRight",n.BOTTOM_CENTER="bottomCenter",n.BOTTOM_FULL_WIDTH="bottomFullWidth"})(RowContainerName||(RowContainerName={}));var RowContainerType;(function(n){n.LEFT="left",n.RIGHT="right",n.CENTER="center",n.FULL_WIDTH="fullWidth"})(RowContainerType||(RowContainerType={}));function getRowContainerTypeForName(n){switch(n){case RowContainerName.CENTER:case RowContainerName.TOP_CENTER:case RowContainerName.STICKY_TOP_CENTER:case RowContainerName.BOTTOM_CENTER:return RowContainerType.CENTER;case RowContainerName.LEFT:case RowContainerName.TOP_LEFT:case RowContainerName.STICKY_TOP_LEFT:case RowContainerName.BOTTOM_LEFT:return RowContainerType.LEFT;case RowContainerName.RIGHT:case RowContainerName.TOP_RIGHT:case RowContainerName.STICKY_TOP_RIGHT:case RowContainerName.BOTTOM_RIGHT:return RowContainerType.RIGHT;case RowContainerName.FULL_WIDTH:case RowContainerName.TOP_FULL_WIDTH:case RowContainerName.STICKY_TOP_FULL_WIDTH:case RowContainerName.BOTTOM_FULL_WIDTH:return RowContainerType.FULL_WIDTH;default:throw Error("Invalid Row Container Type")}}var ContainerCssClasses=convertToMap([[RowContainerName.CENTER,"ag-center-cols-container"],[RowContainerName.LEFT,"ag-pinned-left-cols-container"],[RowContainerName.RIGHT,"ag-pinned-right-cols-container"],[RowContainerName.FULL_WIDTH,"ag-full-width-container"],[RowContainerName.TOP_CENTER,"ag-floating-top-container"],[RowContainerName.TOP_LEFT,"ag-pinned-left-floating-top"],[RowContainerName.TOP_RIGHT,"ag-pinned-right-floating-top"],[RowContainerName.TOP_FULL_WIDTH,"ag-floating-top-full-width-container"],[RowContainerName.STICKY_TOP_CENTER,"ag-sticky-top-container"],[RowContainerName.STICKY_TOP_LEFT,"ag-pinned-left-sticky-top"],[RowContainerName.STICKY_TOP_RIGHT,"ag-pinned-right-sticky-top"],[RowContainerName.STICKY_TOP_FULL_WIDTH,"ag-sticky-top-full-width-container"],[RowContainerName.BOTTOM_CENTER,"ag-floating-bottom-container"],[RowContainerName.BOTTOM_LEFT,"ag-pinned-left-floating-bottom"],[RowContainerName.BOTTOM_RIGHT,"ag-pinned-right-floating-bottom"],[RowContainerName.BOTTOM_FULL_WIDTH,"ag-floating-bottom-full-width-container"]]),ViewportCssClasses=convertToMap([[RowContainerName.CENTER,"ag-center-cols-viewport"],[RowContainerName.TOP_CENTER,"ag-floating-top-viewport"],[RowContainerName.STICKY_TOP_CENTER,"ag-sticky-top-viewport"],[RowContainerName.BOTTOM_CENTER,"ag-floating-bottom-viewport"]]),WrapperCssClasses=convertToMap([[RowContainerName.CENTER,"ag-center-cols-clipper"]]),RowContainerCtrl=function(n){__extends$1J(t,n);function t(e){var r=n.call(this)||this;return r.visible=!0,r.EMPTY_CTRLS=[],r.name=e,r.isFullWithContainer=r.name===RowContainerName.TOP_FULL_WIDTH||r.name===RowContainerName.STICKY_TOP_FULL_WIDTH||r.name===RowContainerName.BOTTOM_FULL_WIDTH||r.name===RowContainerName.FULL_WIDTH,r}return t.getRowContainerCssClasses=function(e){var r=ContainerCssClasses.get(e),o=ViewportCssClasses.get(e),s=WrapperCssClasses.get(e);return{container:r,viewport:o,wrapper:s}},t.getPinned=function(e){switch(e){case RowContainerName.BOTTOM_LEFT:case RowContainerName.TOP_LEFT:case RowContainerName.STICKY_TOP_LEFT:case RowContainerName.LEFT:return"left";case RowContainerName.BOTTOM_RIGHT:case RowContainerName.TOP_RIGHT:case RowContainerName.STICKY_TOP_RIGHT:case RowContainerName.RIGHT:return"right";default:return null}},t.prototype.postConstruct=function(){var e=this;this.enableRtl=this.gridOptionsService.is("enableRtl"),this.embedFullWidthRows=this.gridOptionsService.is("embedFullWidthRows"),this.forContainers([RowContainerName.CENTER],function(){return e.viewportSizeFeature=e.createManagedBean(new ViewportSizeFeature(e))})},t.prototype.registerWithCtrlsService=function(){switch(this.name){case RowContainerName.CENTER:this.ctrlsService.registerCenterRowContainerCtrl(this);break;case RowContainerName.LEFT:this.ctrlsService.registerLeftRowContainerCtrl(this);break;case RowContainerName.RIGHT:this.ctrlsService.registerRightRowContainerCtrl(this);break;case RowContainerName.TOP_CENTER:this.ctrlsService.registerTopCenterRowContainerCtrl(this);break;case RowContainerName.TOP_LEFT:this.ctrlsService.registerTopLeftRowContainerCon(this);break;case RowContainerName.TOP_RIGHT:this.ctrlsService.registerTopRightRowContainerCtrl(this);break;case RowContainerName.STICKY_TOP_CENTER:this.ctrlsService.registerStickyTopCenterRowContainerCtrl(this);break;case RowContainerName.STICKY_TOP_LEFT:this.ctrlsService.registerStickyTopLeftRowContainerCon(this);break;case RowContainerName.STICKY_TOP_RIGHT:this.ctrlsService.registerStickyTopRightRowContainerCtrl(this);break;case RowContainerName.BOTTOM_CENTER:this.ctrlsService.registerBottomCenterRowContainerCtrl(this);break;case RowContainerName.BOTTOM_LEFT:this.ctrlsService.registerBottomLeftRowContainerCtrl(this);break;case RowContainerName.BOTTOM_RIGHT:this.ctrlsService.registerBottomRightRowContainerCtrl(this);break}},t.prototype.forContainers=function(e,r){e.indexOf(this.name)>=0&&r()},t.prototype.getContainerElement=function(){return this.eContainer},t.prototype.getViewportSizeFeature=function(){return this.viewportSizeFeature},t.prototype.setComp=function(e,r,o,s){var l=this;this.comp=e,this.eContainer=r,this.eViewport=o,this.eWrapper=s,this.createManagedBean(new RowContainerEventsFeature(this.eContainer)),this.addPreventScrollWhileDragging(),this.listenOnDomOrder(),this.stopHScrollOnPinnedRows();var a=[RowContainerName.TOP_CENTER,RowContainerName.TOP_LEFT,RowContainerName.TOP_RIGHT],h=[RowContainerName.STICKY_TOP_CENTER,RowContainerName.STICKY_TOP_LEFT,RowContainerName.STICKY_TOP_RIGHT],y=[RowContainerName.BOTTOM_CENTER,RowContainerName.BOTTOM_LEFT,RowContainerName.BOTTOM_RIGHT],C=[RowContainerName.CENTER,RowContainerName.LEFT,RowContainerName.RIGHT],L=__spreadArray$g(__spreadArray$g(__spreadArray$g(__spreadArray$g([],__read$j(a)),__read$j(y)),__read$j(C)),__read$j(h)),Y=[RowContainerName.CENTER,RowContainerName.LEFT,RowContainerName.RIGHT,RowContainerName.FULL_WIDTH],ze=[RowContainerName.CENTER,RowContainerName.TOP_CENTER,RowContainerName.STICKY_TOP_CENTER,RowContainerName.BOTTOM_CENTER],Bt=[RowContainerName.LEFT,RowContainerName.BOTTOM_LEFT,RowContainerName.TOP_LEFT,RowContainerName.STICKY_TOP_LEFT],Ir=[RowContainerName.RIGHT,RowContainerName.BOTTOM_RIGHT,RowContainerName.TOP_RIGHT,RowContainerName.STICKY_TOP_RIGHT];this.forContainers(Bt,function(){l.pinnedWidthFeature=l.createManagedBean(new SetPinnedLeftWidthFeature(l.eContainer)),l.addManagedListener(l.eventService,Events.EVENT_LEFT_PINNED_WIDTH_CHANGED,function(){return l.onPinnedWidthChanged()})}),this.forContainers(Ir,function(){l.pinnedWidthFeature=l.createManagedBean(new SetPinnedRightWidthFeature(l.eContainer)),l.addManagedListener(l.eventService,Events.EVENT_RIGHT_PINNED_WIDTH_CHANGED,function(){return l.onPinnedWidthChanged()})}),this.forContainers(Y,function(){return l.createManagedBean(new SetHeightFeature(l.eContainer,l.eWrapper))}),this.forContainers(L,function(){return l.createManagedBean(new DragListenerFeature(l.eContainer))}),this.forContainers(ze,function(){return l.createManagedBean(new CenterWidthFeature(function(Wr){return l.comp.setContainerWidth(Wr+"px")}))}),isInvisibleScrollbar()&&(this.forContainers([RowContainerName.CENTER],function(){var Wr=l.enableRtl?Events.EVENT_LEFT_PINNED_WIDTH_CHANGED:Events.EVENT_RIGHT_PINNED_WIDTH_CHANGED;l.addManagedListener(l.eventService,Wr,function(){return l.refreshPaddingForFakeScrollbar()})}),this.refreshPaddingForFakeScrollbar()),this.addListeners(),this.registerWithCtrlsService()},t.prototype.refreshPaddingForFakeScrollbar=function(){var e=this,r=e.enableRtl,o=e.columnModel,s=e.name,l=e.eWrapper,a=e.eContainer,h=r?RowContainerName.LEFT:RowContainerName.RIGHT;this.forContainers([RowContainerName.CENTER,h],function(){var y=o.getContainerWidth(h),C=r?"marginLeft":"marginRight";s===RowContainerName.CENTER?l.style[C]=y?"0px":"16px":a.style[C]=y?"16px":"0px"})},t.prototype.addListeners=function(){var e=this;this.addManagedListener(this.eventService,Events.EVENT_SCROLL_VISIBILITY_CHANGED,function(){return e.onScrollVisibilityChanged()}),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,function(){return e.onDisplayedColumnsChanged()}),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED,function(){return e.onDisplayedColumnsWidthChanged()}),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_ROWS_CHANGED,function(r){return e.onDisplayedRowsChanged(r.afterScroll)}),this.onScrollVisibilityChanged(),this.onDisplayedColumnsChanged(),this.onDisplayedColumnsWidthChanged(),this.onDisplayedRowsChanged()},t.prototype.listenOnDomOrder=function(){var e=this,r=[RowContainerName.STICKY_TOP_CENTER,RowContainerName.STICKY_TOP_LEFT,RowContainerName.STICKY_TOP_RIGHT,RowContainerName.STICKY_TOP_FULL_WIDTH],o=r.indexOf(this.name)>=0;if(o){this.comp.setDomOrder(!0);return}var s=function(){var l=e.gridOptionsService.is("ensureDomOrder"),a=e.gridOptionsService.isDomLayout("print");e.comp.setDomOrder(l||a)};this.addManagedPropertyListener("domLayout",s),s()},t.prototype.stopHScrollOnPinnedRows=function(){var e=this;this.forContainers([RowContainerName.TOP_CENTER,RowContainerName.STICKY_TOP_CENTER,RowContainerName.BOTTOM_CENTER],function(){var r=function(){return e.eViewport.scrollLeft=0};e.addManagedListener(e.eViewport,"scroll",r)})},t.prototype.onDisplayedColumnsChanged=function(){var e=this;this.forContainers([RowContainerName.CENTER],function(){return e.onHorizontalViewportChanged()})},t.prototype.onDisplayedColumnsWidthChanged=function(){var e=this;this.forContainers([RowContainerName.CENTER],function(){return e.onHorizontalViewportChanged()})},t.prototype.onScrollVisibilityChanged=function(){var e=this,r=this.gridOptionsService.getScrollbarWidth()||0;if(this.name===RowContainerName.CENTER){var o=this.scrollVisibleService.isHorizontalScrollShowing(),s=o?r:0,l=s==0?"100%":"calc(100% + "+s+"px)";this.animationFrameService.requestAnimationFrame(function(){return e.comp.setViewportHeight(l)})}if(this.name===RowContainerName.FULL_WIDTH){var a=isInvisibleScrollbar()?16:0,h="calc(100% - "+a+"px)";this.eContainer.style.setProperty("width",h)}},t.prototype.addPreventScrollWhileDragging=function(){var e=this,r=function(o){e.dragService.isDragging()&&o.cancelable&&o.preventDefault()};this.eContainer.addEventListener("touchmove",r,{passive:!1}),this.addDestroyFunc(function(){return e.eContainer.removeEventListener("touchmove",r)})},t.prototype.onHorizontalViewportChanged=function(){var e=this.getCenterWidth(),r=this.getCenterViewportScrollLeft();this.columnModel.setViewportPosition(e,r)},t.prototype.getCenterWidth=function(){return getInnerWidth(this.eViewport)},t.prototype.getCenterViewportScrollLeft=function(){return getScrollLeft(this.eViewport,this.enableRtl)},t.prototype.registerViewportResizeListener=function(e){var r=this.resizeObserverService.observeResize(this.eViewport,e);this.addDestroyFunc(function(){return r()})},t.prototype.isViewportVisible=function(){return isVisible(this.eViewport)},t.prototype.getViewportScrollLeft=function(){return getScrollLeft(this.eViewport,this.enableRtl)},t.prototype.isHorizontalScrollShowing=function(){var e=this.gridOptionsService.is("alwaysShowHorizontalScroll");return e||isHorizontalScrollShowing(this.eViewport)},t.prototype.getViewportElement=function(){return this.eViewport},t.prototype.setContainerTranslateX=function(e){this.eContainer.style.transform="translateX("+e+"px)"},t.prototype.getHScrollPosition=function(){var e={left:this.eViewport.scrollLeft,right:this.eViewport.scrollLeft+this.eViewport.offsetWidth};return e},t.prototype.setCenterViewportScrollLeft=function(e){setScrollLeft(this.eViewport,e,this.enableRtl)},t.prototype.isContainerVisible=function(){var e=t.getPinned(this.name);return!e||!!this.pinnedWidthFeature&&this.pinnedWidthFeature.getWidth()>0},t.prototype.onPinnedWidthChanged=function(){var e=this.isContainerVisible();this.visible!=e&&(this.visible=e,this.onDisplayedRowsChanged()),isInvisibleScrollbar()&&this.refreshPaddingForFakeScrollbar()},t.prototype.onDisplayedRowsChanged=function(e){var r=this;if(e===void 0&&(e=!1),this.visible){var o=this.gridOptionsService.isDomLayout("print"),s=function(a){var h=a.isFullWidth(),y=r.embedFullWidthRows||o,C=r.isFullWithContainer?!y&&h:y||!h;return C},l=this.getRowCtrls().filter(s);this.comp.setRowCtrls(l,e)}else this.comp.setRowCtrls(this.EMPTY_CTRLS,!1)},t.prototype.getRowCtrls=function(){switch(this.name){case RowContainerName.TOP_CENTER:case RowContainerName.TOP_LEFT:case RowContainerName.TOP_RIGHT:case RowContainerName.TOP_FULL_WIDTH:return this.rowRenderer.getTopRowCtrls();case RowContainerName.STICKY_TOP_CENTER:case RowContainerName.STICKY_TOP_LEFT:case RowContainerName.STICKY_TOP_RIGHT:case RowContainerName.STICKY_TOP_FULL_WIDTH:return this.rowRenderer.getStickyTopRowCtrls();case RowContainerName.BOTTOM_CENTER:case RowContainerName.BOTTOM_LEFT:case RowContainerName.BOTTOM_RIGHT:case RowContainerName.BOTTOM_FULL_WIDTH:return this.rowRenderer.getBottomRowCtrls();default:return this.rowRenderer.getRowCtrls()}},__decorate$1F([Autowired("scrollVisibleService")],t.prototype,"scrollVisibleService",void 0),__decorate$1F([Autowired("dragService")],t.prototype,"dragService",void 0),__decorate$1F([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),__decorate$1F([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$1F([Autowired("resizeObserverService")],t.prototype,"resizeObserverService",void 0),__decorate$1F([Autowired("animationFrameService")],t.prototype,"animationFrameService",void 0),__decorate$1F([Autowired("rowRenderer")],t.prototype,"rowRenderer",void 0),__decorate$1F([PostConstruct],t.prototype,"postConstruct",null),t}(BeanStub),__extends$1I=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1E=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},GRID_BODY_TEMPLATE=`<div class="ag-root ag-unselectable" role="treegrid">
        <ag-header-root ref="gridHeader"></ag-header-root>
        <div class="ag-floating-top" ref="eTop" role="presentation">
            <ag-row-container ref="topLeftContainer" name="`+RowContainerName.TOP_LEFT+`"></ag-row-container>
            <ag-row-container ref="topCenterContainer" name="`+RowContainerName.TOP_CENTER+`"></ag-row-container>
            <ag-row-container ref="topRightContainer" name="`+RowContainerName.TOP_RIGHT+`"></ag-row-container>
            <ag-row-container ref="topFullWidthContainer" name="`+RowContainerName.TOP_FULL_WIDTH+`"></ag-row-container>
        </div>
        <div class="ag-body" ref="eBody" role="presentation">
            <div class="ag-body-clipper" ref="eBodyClipper" role="presentation">
                <div class="ag-body-viewport" ref="eBodyViewport" role="presentation">
                    <ag-row-container ref="leftContainer" name="`+RowContainerName.LEFT+`"></ag-row-container>
                    <ag-row-container ref="centerContainer" name="`+RowContainerName.CENTER+`"></ag-row-container>
                    <ag-row-container ref="rightContainer" name="`+RowContainerName.RIGHT+`"></ag-row-container>
                    <ag-row-container ref="fullWidthContainer" name="`+RowContainerName.FULL_WIDTH+`"></ag-row-container>
                </div>
            </div>
            <ag-fake-vertical-scroll></ag-fake-vertical-scroll>
        </div>
        <div class="ag-sticky-top" ref="eStickyTop" role="presentation">
            <ag-row-container ref="stickyTopLeftContainer" name="`+RowContainerName.STICKY_TOP_LEFT+`"></ag-row-container>
            <ag-row-container ref="stickyTopCenterContainer" name="`+RowContainerName.STICKY_TOP_CENTER+`"></ag-row-container>
            <ag-row-container ref="stickyTopRightContainer" name="`+RowContainerName.STICKY_TOP_RIGHT+`"></ag-row-container>
            <ag-row-container ref="stickyTopFullWidthContainer" name="`+RowContainerName.STICKY_TOP_FULL_WIDTH+`"></ag-row-container>
        </div>
        <div class="ag-floating-bottom" ref="eBottom" role="presentation">
            <ag-row-container ref="bottomLeftContainer" name="`+RowContainerName.BOTTOM_LEFT+`"></ag-row-container>
            <ag-row-container ref="bottomCenterContainer" name="`+RowContainerName.BOTTOM_CENTER+`"></ag-row-container>
            <ag-row-container ref="bottomRightContainer" name="`+RowContainerName.BOTTOM_RIGHT+`"></ag-row-container>
            <ag-row-container ref="bottomFullWidthContainer" name="`+RowContainerName.BOTTOM_FULL_WIDTH+`"></ag-row-container>
        </div>
        <ag-fake-horizontal-scroll></ag-fake-horizontal-scroll>
        <ag-overlay-wrapper></ag-overlay-wrapper>
    </div>`,GridBodyComp=function(n){__extends$1I(t,n);function t(){return n.call(this,GRID_BODY_TEMPLATE)||this}return t.prototype.init=function(){var e=this,r=function(s,l){var a=s+"px";l.style.minHeight=a,l.style.height=a},o={setRowAnimationCssOnBodyViewport:function(s,l){return e.setRowAnimationCssOnBodyViewport(s,l)},setColumnCount:function(s){return setAriaColCount(e.getGui(),s)},setRowCount:function(s){return setAriaRowCount(e.getGui(),s)},setTopHeight:function(s){return r(s,e.eTop)},setBottomHeight:function(s){return r(s,e.eBottom)},setTopDisplay:function(s){return e.eTop.style.display=s},setBottomDisplay:function(s){return e.eBottom.style.display=s},setStickyTopHeight:function(s){return e.eStickyTop.style.height=s},setStickyTopTop:function(s){return e.eStickyTop.style.top=s},setStickyTopWidth:function(s){return e.eStickyTop.style.width=s},setColumnMovingCss:function(s,l){return e.addOrRemoveCssClass(s,l)},updateLayoutClasses:function(s,l){var a=[e.eBodyViewport.classList,e.eBodyClipper.classList,e.eBody.classList];a.forEach(function(h){h.toggle(LayoutCssClasses.AUTO_HEIGHT,l.autoHeight),h.toggle(LayoutCssClasses.NORMAL,l.normal),h.toggle(LayoutCssClasses.PRINT,l.print)}),e.addOrRemoveCssClass(LayoutCssClasses.AUTO_HEIGHT,l.autoHeight),e.addOrRemoveCssClass(LayoutCssClasses.NORMAL,l.normal),e.addOrRemoveCssClass(LayoutCssClasses.PRINT,l.print)},setAlwaysVerticalScrollClass:function(s,l){return e.eBodyViewport.classList.toggle(CSS_CLASS_FORCE_VERTICAL_SCROLL,l)},registerBodyViewportResizeListener:function(s){var l=e.resizeObserverService.observeResize(e.eBodyViewport,s);e.addDestroyFunc(function(){return l()})},setPinnedTopBottomOverflowY:function(s){return e.eTop.style.overflowY=e.eBottom.style.overflowY=s},setCellSelectableCss:function(s,l){[e.eTop,e.eBodyViewport,e.eBottom].forEach(function(a){return a.classList.toggle(s,l)})},setBodyViewportWidth:function(s){return e.eBodyViewport.style.width=s}};this.ctrl=this.createManagedBean(new GridBodyCtrl),this.ctrl.setComp(o,this.getGui(),this.eBodyViewport,this.eTop,this.eBottom,this.eStickyTop),(this.rangeService||this.gridOptionsService.get("rowSelection")==="multiple")&&setAriaMultiSelectable(this.getGui(),!0)},t.prototype.setRowAnimationCssOnBodyViewport=function(e,r){var o=this.eBodyViewport.classList;o.toggle(RowAnimationCssClasses.ANIMATION_ON,r),o.toggle(RowAnimationCssClasses.ANIMATION_OFF,!r)},t.prototype.getFloatingTopBottom=function(){return[this.eTop,this.eBottom]},__decorate$1E([Autowired("resizeObserverService")],t.prototype,"resizeObserverService",void 0),__decorate$1E([Optional("rangeService")],t.prototype,"rangeService",void 0),__decorate$1E([RefSelector("eBodyViewport")],t.prototype,"eBodyViewport",void 0),__decorate$1E([RefSelector("eStickyTop")],t.prototype,"eStickyTop",void 0),__decorate$1E([RefSelector("eTop")],t.prototype,"eTop",void 0),__decorate$1E([RefSelector("eBottom")],t.prototype,"eBottom",void 0),__decorate$1E([RefSelector("gridHeader")],t.prototype,"headerRootComp",void 0),__decorate$1E([RefSelector("eBodyClipper")],t.prototype,"eBodyClipper",void 0),__decorate$1E([RefSelector("eBody")],t.prototype,"eBody",void 0),__decorate$1E([PostConstruct],t.prototype,"init",null),t}(Component),__extends$1H=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1D=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},ScrollVisibleService=function(n){__extends$1H(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.postConstruct=function(){this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,this.onDisplayedColumnsChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED,this.onDisplayedColumnsWidthChanged.bind(this))},t.prototype.onDisplayedColumnsChanged=function(){this.update()},t.prototype.onDisplayedColumnsWidthChanged=function(){this.update()},t.prototype.update=function(){this.updateImpl(),setTimeout(this.updateImpl.bind(this),500)},t.prototype.updateImpl=function(){var e=this.ctrlsService.getCenterRowContainerCtrl();if(e){var r={horizontalScrollShowing:e.isHorizontalScrollShowing(),verticalScrollShowing:this.isVerticalScrollShowing()};this.setScrollsVisible(r)}},t.prototype.setScrollsVisible=function(e){var r=this.horizontalScrollShowing!==e.horizontalScrollShowing||this.verticalScrollShowing!==e.verticalScrollShowing;if(r){this.horizontalScrollShowing=e.horizontalScrollShowing,this.verticalScrollShowing=e.verticalScrollShowing;var o={type:Events.EVENT_SCROLL_VISIBILITY_CHANGED};this.eventService.dispatchEvent(o)}},t.prototype.isHorizontalScrollShowing=function(){return this.horizontalScrollShowing},t.prototype.isVerticalScrollShowing=function(){return this.verticalScrollShowing},__decorate$1D([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),__decorate$1D([PostConstruct],t.prototype,"postConstruct",null),t=__decorate$1D([Bean("scrollVisibleService")],t),t}(BeanStub),__extends$1G=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1C=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},MouseEventService=function(n){__extends$1G(t,n);function t(){var r=n!==null&&n.apply(this,arguments)||this;return r.gridInstanceId=e.gridInstanceSequence.next(),r}e=t,t.prototype.stampTopLevelGridCompWithGridInstance=function(r){r[e.GRID_DOM_KEY]=this.gridInstanceId},t.prototype.getRenderedCellForEvent=function(r){return getCtrlForEventTarget(this.gridOptionsService,r.target,CellCtrl.DOM_DATA_KEY_CELL_CTRL)},t.prototype.isEventFromThisGrid=function(r){var o=this.isElementInThisGrid(r.target);return o},t.prototype.isElementInThisGrid=function(r){for(var o=r;o;){var s=o[e.GRID_DOM_KEY];if(exists(s)){var l=s===this.gridInstanceId;return l}o=o.parentElement}return!1},t.prototype.getCellPositionForEvent=function(r){var o=this.getRenderedCellForEvent(r);return o?o.getCellPosition():null},t.prototype.getNormalisedPosition=function(r){var o=this.gridOptionsService.isDomLayout("normal"),s=r,l,a;if(s.clientX!=null||s.clientY!=null?(l=s.clientX,a=s.clientY):(l=s.x,a=s.y),o){var h=this.ctrlsService.getGridBodyCtrl(),y=h.getScrollFeature().getVScrollPosition(),C=h.getScrollFeature().getHScrollPosition();l+=C.left,a+=y.top}return{x:l,y:a}};var e;return t.gridInstanceSequence=new NumberSequence,t.GRID_DOM_KEY="__ag_grid_instance",__decorate$1C([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),t=e=__decorate$1C([Bean("mouseEventService")],t),t}(BeanStub),__extends$1F=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__assign$8=function(){return __assign$8=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},__assign$8.apply(this,arguments)},__decorate$1B=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},NavigationService=function(n){__extends$1F(t,n);function t(){var e=n.call(this)||this;return e.onPageDown=throttle(e.onPageDown,100),e.onPageUp=throttle(e.onPageUp,100),e}return t.prototype.postConstruct=function(){var e=this;this.ctrlsService.whenReady(function(r){e.gridBodyCon=r.gridBodyCtrl})},t.prototype.handlePageScrollingKey=function(e,r){r===void 0&&(r=!1);var o=e.key,s=e.altKey,l=e.ctrlKey||e.metaKey,a=!!this.rangeService&&e.shiftKey,h=this.mouseEventService.getCellPositionForEvent(e),y=!1;switch(o){case KeyCode.PAGE_HOME:case KeyCode.PAGE_END:!l&&!s&&(this.onHomeOrEndKey(o),y=!0);break;case KeyCode.LEFT:case KeyCode.RIGHT:case KeyCode.UP:case KeyCode.DOWN:if(!h)return!1;l&&!s&&!a&&(this.onCtrlUpDownLeftRight(o,h),y=!0);break;case KeyCode.PAGE_DOWN:case KeyCode.PAGE_UP:!l&&!s&&(y=this.handlePageUpDown(o,h,r));break}return y&&e.preventDefault(),y},t.prototype.handlePageUpDown=function(e,r,o){return o&&(r=this.focusService.getFocusedCell()),r?(e===KeyCode.PAGE_UP?this.onPageUp(r):this.onPageDown(r),!0):!1},t.prototype.navigateTo=function(e){var r=e.scrollIndex,o=e.scrollType,s=e.scrollColumn,l=e.focusIndex,a=e.focusColumn;if(exists(s)&&!s.isPinned()&&this.gridBodyCon.getScrollFeature().ensureColumnVisible(s),exists(r)&&this.gridBodyCon.getScrollFeature().ensureIndexVisible(r,o),e.isAsync||this.gridBodyCon.getScrollFeature().ensureIndexVisible(l),this.focusService.setFocusedCell({rowIndex:l,column:a,rowPinned:null,forceBrowserFocus:!0}),this.rangeService){var h={rowIndex:l,rowPinned:null,column:a};this.rangeService.setRangeToCell(h)}},t.prototype.onPageDown=function(e){var r=this.ctrlsService.getGridBodyCtrl(),o=r.getScrollFeature().getVScrollPosition(),s=this.getViewportHeight(),l=this.paginationProxy.getPixelOffset(),a=o.top+s,h=this.paginationProxy.getRowIndexAtPixel(a+l);this.columnModel.isAutoRowHeightActive()?this.navigateToNextPageWithAutoHeight(e,h):this.navigateToNextPage(e,h)},t.prototype.onPageUp=function(e){var r=this.ctrlsService.getGridBodyCtrl(),o=r.getScrollFeature().getVScrollPosition(),s=this.paginationProxy.getPixelOffset(),l=o.top,a=this.paginationProxy.getRowIndexAtPixel(l+s);this.columnModel.isAutoRowHeightActive()?this.navigateToNextPageWithAutoHeight(e,a,!0):this.navigateToNextPage(e,a,!0)},t.prototype.navigateToNextPage=function(e,r,o){o===void 0&&(o=!1);var s=this.getViewportHeight(),l=this.paginationProxy.getPageFirstRow(),a=this.paginationProxy.getPageLastRow(),h=this.paginationProxy.getPixelOffset(),y=this.paginationProxy.getRow(e.rowIndex),C=o?(y==null?void 0:y.rowHeight)-s-h:s-h,L=(y==null?void 0:y.rowTop)+C,Y=this.paginationProxy.getRowIndexAtPixel(L+h);if(Y===e.rowIndex){var ze=o?-1:1;r=Y=e.rowIndex+ze}var Bt;o?(Bt="bottom",Y<l&&(Y=l),r<l&&(r=l)):(Bt="top",Y>a&&(Y=a),r>a&&(r=a)),this.isRowTallerThanView(Y)&&(r=Y,Bt="top"),this.navigateTo({scrollIndex:r,scrollType:Bt,scrollColumn:null,focusIndex:Y,focusColumn:e.column})},t.prototype.navigateToNextPageWithAutoHeight=function(e,r,o){var s=this;o===void 0&&(o=!1),this.navigateTo({scrollIndex:r,scrollType:o?"bottom":"top",scrollColumn:null,focusIndex:r,focusColumn:e.column}),setTimeout(function(){var l=s.getNextFocusIndexForAutoHeight(e,o);s.navigateTo({scrollIndex:r,scrollType:o?"bottom":"top",scrollColumn:null,focusIndex:l,focusColumn:e.column,isAsync:!0})},50)},t.prototype.getNextFocusIndexForAutoHeight=function(e,r){var o;r===void 0&&(r=!1);for(var s=r?-1:1,l=this.getViewportHeight(),a=this.paginationProxy.getPageLastRow(),h=0,y=e.rowIndex;y>=0&&y<=a;){var C=this.paginationProxy.getRow(y);if(C){var L=(o=C.rowHeight)!==null&&o!==void 0?o:0;if(h+L>l)break;h+=L}y+=s}return Math.max(0,Math.min(y,a))},t.prototype.getViewportHeight=function(){var e=this.ctrlsService.getGridBodyCtrl(),r=e.getScrollFeature().getVScrollPosition(),o=this.gridOptionsService.getScrollbarWidth(),s=r.bottom-r.top;return this.ctrlsService.getCenterRowContainerCtrl().isHorizontalScrollShowing()&&(s-=o),s},t.prototype.isRowTallerThanView=function(e){var r=this.paginationProxy.getRow(e);if(!r)return!1;var o=r.rowHeight;return typeof o!="number"?!1:o>this.getViewportHeight()},t.prototype.onCtrlUpDownLeftRight=function(e,r){var o=this.cellNavigationService.getNextCellToFocus(e,r,!0),s=o.rowIndex,l=o.column;this.navigateTo({scrollIndex:s,scrollType:null,scrollColumn:l,focusIndex:s,focusColumn:l})},t.prototype.onHomeOrEndKey=function(e){var r=e===KeyCode.PAGE_HOME,o=this.columnModel.getAllDisplayedColumns(),s=r?o[0]:last(o),l=r?this.paginationProxy.getPageFirstRow():this.paginationProxy.getPageLastRow();this.navigateTo({scrollIndex:l,scrollType:null,scrollColumn:s,focusIndex:l,focusColumn:s})},t.prototype.onTabKeyDown=function(e,r){var o=r.shiftKey,s=this.tabToNextCellCommon(e,o,r);if(s){r.preventDefault();return}if(o){var l=e.getRowPosition(),a=l.rowIndex,h=l.rowPinned,y=h?a===0:a===this.paginationProxy.getPageFirstRow();y&&(this.gridOptionsService.getNum("headerHeight")===0?this.focusService.focusNextGridCoreContainer(!0,!0):(r.preventDefault(),this.focusService.focusLastHeader(r)))}else e instanceof CellCtrl&&e.focusCell(!0),this.focusService.focusNextGridCoreContainer(o)&&r.preventDefault()},t.prototype.tabToNextCell=function(e,r){var o=this.focusService.getFocusedCell();if(!o)return!1;var s=this.getCellByPosition(o);return!s&&(s=this.rowRenderer.getRowByPosition(o),!s||!s.isFullWidth())?!1:this.tabToNextCellCommon(s,e,r)},t.prototype.tabToNextCellCommon=function(e,r,o){var s=e.isEditing();if(!s&&e instanceof CellCtrl){var l=e,a=l.getRowCtrl();a&&(s=a.isEditing())}var h;return s?this.gridOptionsService.get("editType")==="fullRow"?h=this.moveToNextEditingRow(e,r,o):h=this.moveToNextEditingCell(e,r,o):h=this.moveToNextCellNotEditing(e,r),h||!!this.focusService.getFocusedHeader()},t.prototype.moveToNextEditingCell=function(e,r,o){o===void 0&&(o=null);var s=e.getCellPosition();e.getGui().focus(),e.stopEditing();var l=this.findNextCellToFocusOn(s,r,!0);return l==null?!1:(l.startEditing(null,!0,o),l.focusCell(!1),!0)},t.prototype.moveToNextEditingRow=function(e,r,o){o===void 0&&(o=null);var s=e.getCellPosition(),l=this.findNextCellToFocusOn(s,r,!0);if(l==null)return!1;var a=l.getCellPosition(),h=this.isCellEditable(s),y=this.isCellEditable(a),C=a&&s.rowIndex===a.rowIndex&&s.rowPinned===a.rowPinned;if(h&&e.setFocusOutOnEditor(),!C){var L=e.getRowCtrl();L.stopEditing();var Y=l.getRowCtrl();Y.startRowEditing(void 0,void 0,o)}return y?(l.setFocusInOnEditor(),l.focusCell()):l.focusCell(!0),!0},t.prototype.moveToNextCellNotEditing=function(e,r){var o=this.columnModel.getAllDisplayedColumns(),s;e instanceof RowCtrl?s=__assign$8(__assign$8({},e.getRowPosition()),{column:r?o[0]:last(o)}):s=e.getCellPosition();var l=this.findNextCellToFocusOn(s,r,!1);if(l instanceof CellCtrl)l.focusCell(!0);else if(l)return this.tryToFocusFullWidthRow(l.getRowPosition(),r);return exists(l)},t.prototype.findNextCellToFocusOn=function(e,r,o){for(var s=e;;){e!==s&&(e=s),r||(s=this.getLastCellOfColSpan(s)),s=this.cellNavigationService.getNextTabbedCell(s,r);var l=this.gridOptionsService.getCallback("tabToNextCell");if(exists(l)){var a={backwards:r,editing:o,previousCellPosition:e,nextCellPosition:s||null},h=l(a);exists(h)?(h.floating&&(doOnce(function(){console.warn("AG Grid: tabToNextCellFunc return type should have attributes: rowIndex, rowPinned, column. However you had 'floating', maybe you meant 'rowPinned'?")},"no floating in userCell"),h.rowPinned=h.floating),s={rowIndex:h.rowIndex,column:h.column,rowPinned:h.rowPinned}):s=null}if(!s)return null;if(s.rowIndex<0){var y=this.headerNavigationService.getHeaderRowCount();return this.focusService.focusHeaderPosition({headerPosition:{headerRowIndex:y+s.rowIndex,column:s.column}}),null}var C=this.gridOptionsService.get("editType")==="fullRow";if(o&&!C){var L=this.isCellEditable(s);if(!L)continue}this.ensureCellVisible(s);var Y=this.getCellByPosition(s);if(!Y){var ze=this.rowRenderer.getRowByPosition(s);if(!ze||!ze.isFullWidth()||o)continue;return ze}if(!Y.isSuppressNavigable())return this.rangeService&&this.rangeService.setRangeToCell(s),Y}},t.prototype.isCellEditable=function(e){var r=this.lookupRowNodeForCell(e);return r?e.column.isCellEditable(r):!1},t.prototype.getCellByPosition=function(e){var r=this.rowRenderer.getRowByPosition(e);return r?r.getCellCtrl(e.column):null},t.prototype.lookupRowNodeForCell=function(e){return e.rowPinned==="top"?this.pinnedRowModel.getPinnedTopRow(e.rowIndex):e.rowPinned==="bottom"?this.pinnedRowModel.getPinnedBottomRow(e.rowIndex):this.paginationProxy.getRow(e.rowIndex)},t.prototype.navigateToNextCell=function(e,r,o,s){for(var l=o,a=!1;l&&(l===o||!this.isValidNavigateCell(l));)this.gridOptionsService.is("enableRtl")?r===KeyCode.LEFT&&(l=this.getLastCellOfColSpan(l)):r===KeyCode.RIGHT&&(l=this.getLastCellOfColSpan(l)),l=this.cellNavigationService.getNextCellToFocus(r,l),a=missing(l);if(a&&e&&e.key===KeyCode.UP&&(l={rowIndex:-1,rowPinned:null,column:o.column}),s){var h=this.gridOptionsService.getCallback("navigateToNextCell");if(exists(h)){var y={key:r,previousCellPosition:o,nextCellPosition:l||null,event:e},C=h(y);exists(C)?(C.floating&&(doOnce(function(){console.warn("AG Grid: tabToNextCellFunc return type should have attributes: rowIndex, rowPinned, column. However you had 'floating', maybe you meant 'rowPinned'?")},"no floating in userCell"),C.rowPinned=C.floating),l={rowPinned:C.rowPinned,rowIndex:C.rowIndex,column:C.column}):l=null}}if(l){if(l.rowIndex<0){var L=this.headerNavigationService.getHeaderRowCount();this.focusService.focusHeaderPosition({headerPosition:{headerRowIndex:L+l.rowIndex,column:o.column},event:e||void 0});return}var Y=this.getNormalisedPosition(l);Y?this.focusPosition(Y):this.tryToFocusFullWidthRow(l)}},t.prototype.getNormalisedPosition=function(e){this.ensureCellVisible(e);var r=this.getCellByPosition(e);return r?(e=r.getCellPosition(),this.ensureCellVisible(e),e):null},t.prototype.tryToFocusFullWidthRow=function(e,r){r===void 0&&(r=!1);var o=this.columnModel.getAllDisplayedColumns(),s=this.rowRenderer.getRowByPosition(e);if(!s||!s.isFullWidth())return!1;var l=this.focusService.getFocusedCell(),a={rowIndex:e.rowIndex,rowPinned:e.rowPinned,column:e.column||(r?last(o):o[0])};this.focusPosition(a);var h=l!=null?this.rowPositionUtils.before(a,l):!1,y={type:Events.EVENT_FULL_WIDTH_ROW_FOCUSED,rowIndex:a.rowIndex,rowPinned:a.rowPinned,column:a.column,isFullWidthCell:!0,floating:a.rowPinned,fromBelow:h};return this.eventService.dispatchEvent(y),!0},t.prototype.focusPosition=function(e){this.focusService.setFocusedCell({rowIndex:e.rowIndex,column:e.column,rowPinned:e.rowPinned,forceBrowserFocus:!0}),this.rangeService&&this.rangeService.setRangeToCell(e)},t.prototype.isValidNavigateCell=function(e){var r=this.rowPositionUtils.getRowNode(e);return!!r},t.prototype.getLastCellOfColSpan=function(e){var r=this.getCellByPosition(e);if(!r)return e;var o=r.getColSpanningList();return o.length===1?e:{rowIndex:e.rowIndex,column:last(o),rowPinned:e.rowPinned}},t.prototype.ensureCellVisible=function(e){var r=this.gridOptionsService.isGroupRowsSticky(),o=this.rowModel.getRow(e.rowIndex),s=r&&(o==null?void 0:o.sticky);!s&&missing(e.rowPinned)&&this.gridBodyCon.getScrollFeature().ensureIndexVisible(e.rowIndex),e.column.isPinned()||this.gridBodyCon.getScrollFeature().ensureColumnVisible(e.column)},__decorate$1B([Autowired("mouseEventService")],t.prototype,"mouseEventService",void 0),__decorate$1B([Autowired("paginationProxy")],t.prototype,"paginationProxy",void 0),__decorate$1B([Autowired("focusService")],t.prototype,"focusService",void 0),__decorate$1B([Optional("rangeService")],t.prototype,"rangeService",void 0),__decorate$1B([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$1B([Autowired("rowModel")],t.prototype,"rowModel",void 0),__decorate$1B([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),__decorate$1B([Autowired("rowRenderer")],t.prototype,"rowRenderer",void 0),__decorate$1B([Autowired("headerNavigationService")],t.prototype,"headerNavigationService",void 0),__decorate$1B([Autowired("rowPositionUtils")],t.prototype,"rowPositionUtils",void 0),__decorate$1B([Autowired("cellNavigationService")],t.prototype,"cellNavigationService",void 0),__decorate$1B([Autowired("pinnedRowModel")],t.prototype,"pinnedRowModel",void 0),__decorate$1B([PostConstruct],t.prototype,"postConstruct",null),t=__decorate$1B([Bean("navigationService")],t),t}(BeanStub),__extends$1E=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1A=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},PopupEditorWrapper=function(n){__extends$1E(t,n);function t(e){var r=n.call(this,'<div class="ag-popup-editor" tabindex="-1"/>')||this;return r.params=e,r}return t.prototype.postConstruct=function(){this.gridOptionsService.setDomData(this.getGui(),t.DOM_KEY_POPUP_EDITOR_WRAPPER,!0),this.addKeyDownListener()},t.prototype.addKeyDownListener=function(){var e=this,r=this.getGui(),o=this.params,s=function(l){isUserSuppressingKeyboardEvent(e.gridOptionsService,l,o.node,o.column,!0)||o.onKeyDown(l)};this.addManagedListener(r,"keydown",s)},t.DOM_KEY_POPUP_EDITOR_WRAPPER="popupEditorWrapper",__decorate$1A([PostConstruct],t.prototype,"postConstruct",null),t}(PopupComponent),__extends$1D=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),CellComp=function(n){__extends$1D(t,n);function t(e,r,o,s,l){var a=n.call(this)||this;a.rendererVersion=0,a.editorVersion=0,a.beans=e,a.column=r.getColumn(),a.rowNode=r.getRowNode(),a.rowCtrl=r.getRowCtrl(),a.eRow=s,a.setTemplate('<div comp-id="'+a.getCompId()+'"/>');var h=a.getGui();a.forceWrapper=r.isForceWrapper(),a.refreshWrapper(!1);var y=function(L,Y,ze){var Bt=ze||h;Y!=null&&Y!=""?Bt.setAttribute(L,Y):Bt.removeAttribute(L)},C={addOrRemoveCssClass:function(L,Y){return a.addOrRemoveCssClass(L,Y)},setUserStyles:function(L){return addStylesToElement(h,L)},getFocusableElement:function(){return a.getFocusableElement()},setTabIndex:function(L){return y("tabindex",L.toString())},setRole:function(L){return setAriaRole(h,L)},setColId:function(L){return y("col-id",L)},setTitle:function(L){return y("title",L)},setIncludeSelection:function(L){return a.includeSelection=L},setIncludeRowDrag:function(L){return a.includeRowDrag=L},setIncludeDndSource:function(L){return a.includeDndSource=L},setRenderDetails:function(L,Y,ze){return a.setRenderDetails(L,Y,ze)},setEditDetails:function(L,Y,ze){return a.setEditDetails(L,Y,ze)},getCellEditor:function(){return a.cellEditor||null},getCellRenderer:function(){return a.cellRenderer||null},getParentOfValue:function(){return a.getParentOfValue()}};return a.cellCtrl=r,r.setComp(C,a.getGui(),a.eCellWrapper,o,l),a}return t.prototype.getParentOfValue=function(){return this.eCellValue?this.eCellValue:this.eCellWrapper?this.eCellWrapper:this.getGui()},t.prototype.setRenderDetails=function(e,r,o){var s=this.cellEditor&&!this.cellEditorPopupWrapper;if(!s){this.firstRender=this.firstRender==null;var l=this.refreshWrapper(!1);if(this.refreshEditStyles(!1),e){var a=o||l,h=a?!1:this.refreshCellRenderer(e);h||(this.destroyRenderer(),this.createCellRendererInstance(e))}else this.destroyRenderer(),this.insertValueWithoutCellRenderer(r)}},t.prototype.setEditDetails=function(e,r,o){e?this.createCellEditorInstance(e,r,o):this.destroyEditor()},t.prototype.removeControls=function(){this.checkboxSelectionComp=this.beans.context.destroyBean(this.checkboxSelectionComp),this.dndSourceComp=this.beans.context.destroyBean(this.dndSourceComp),this.rowDraggingComp=this.beans.context.destroyBean(this.rowDraggingComp)},t.prototype.refreshWrapper=function(e){var r=this.includeRowDrag||this.includeDndSource||this.includeSelection,o=r||this.forceWrapper,s=o&&this.eCellWrapper==null;s&&(this.eCellWrapper=loadTemplate('<div class="ag-cell-wrapper" role="presentation"></div>'),this.getGui().appendChild(this.eCellWrapper));var l=!o&&this.eCellWrapper!=null;l&&(removeFromParent(this.eCellWrapper),this.eCellWrapper=void 0),this.addOrRemoveCssClass("ag-cell-value",!o);var a=!e&&o,h=a&&this.eCellValue==null;h&&(this.eCellValue=loadTemplate('<span class="ag-cell-value" role="presentation"></span>'),this.eCellWrapper.appendChild(this.eCellValue));var y=!a&&this.eCellValue!=null;y&&(removeFromParent(this.eCellValue),this.eCellValue=void 0);var C=s||l||h||y;return C&&this.removeControls(),e||r&&this.addControls(),C},t.prototype.addControls=function(){this.includeRowDrag&&this.rowDraggingComp==null&&(this.rowDraggingComp=this.cellCtrl.createRowDragComp(),this.rowDraggingComp&&this.eCellWrapper.insertBefore(this.rowDraggingComp.getGui(),this.eCellValue)),this.includeDndSource&&this.dndSourceComp==null&&(this.dndSourceComp=this.cellCtrl.createDndSource(),this.eCellWrapper.insertBefore(this.dndSourceComp.getGui(),this.eCellValue)),this.includeSelection&&this.checkboxSelectionComp==null&&(this.checkboxSelectionComp=this.cellCtrl.createSelectionCheckbox(),this.eCellWrapper.insertBefore(this.checkboxSelectionComp.getGui(),this.eCellValue))},t.prototype.createCellEditorInstance=function(e,r,o){var s=this,l=this.editorVersion,a=e.newAgStackInstance();if(a){var h=e.params;a.then(function(C){return s.afterCellEditorCreated(l,C,h,r,o)});var y=missing(this.cellEditor);y&&h.cellStartedEdit&&this.cellCtrl.focusCell(!0)}},t.prototype.insertValueWithoutCellRenderer=function(e){var r=this.getParentOfValue();clearElement(r);var o=e!=null?escapeString(e):null;o!=null&&(r.innerHTML=o)},t.prototype.destroyEditorAndRenderer=function(){this.destroyRenderer(),this.destroyEditor()},t.prototype.destroyRenderer=function(){var e=this.beans.context;this.cellRenderer=e.destroyBean(this.cellRenderer),removeFromParent(this.cellRendererGui),this.cellRendererGui=null,this.rendererVersion++},t.prototype.destroyEditor=function(){var e=this.beans.context;this.hideEditorPopup&&this.hideEditorPopup(),this.hideEditorPopup=void 0,this.cellEditor=e.destroyBean(this.cellEditor),this.cellEditorPopupWrapper=e.destroyBean(this.cellEditorPopupWrapper),removeFromParent(this.cellEditorGui),this.cellEditorGui=null,this.editorVersion++},t.prototype.refreshCellRenderer=function(e){if(this.cellRenderer==null||this.cellRenderer.refresh==null||this.cellRendererClass!==e.componentClass)return!1;var r=this.cellRenderer.refresh(e.params);return r===!0||r===void 0},t.prototype.createCellRendererInstance=function(e){var r=this,o=this.beans.gridOptionsService.is("suppressAnimationFrame"),s=!o,l=this.rendererVersion,a=e.componentClass,h=function(){var y=r.rendererVersion!==l||!r.isAlive();if(!y){var C=e.newAgStackInstance(),L=r.afterCellRendererCreated.bind(r,l,a);C&&C.then(L)}};s&&this.firstRender?this.beans.animationFrameService.createTask(h,this.rowNode.rowIndex,"createTasksP2"):h()},t.prototype.getCtrl=function(){return this.cellCtrl},t.prototype.getRowCtrl=function(){return this.rowCtrl},t.prototype.getCellRenderer=function(){return this.cellRenderer},t.prototype.getCellEditor=function(){return this.cellEditor},t.prototype.afterCellRendererCreated=function(e,r,o){var s=!this.isAlive()||e!==this.rendererVersion;if(s){this.beans.context.destroyBean(o);return}if(this.cellRenderer=o,this.cellRendererClass=r,this.cellRendererGui=this.cellRenderer.getGui(),this.cellRendererGui!=null){var l=this.getParentOfValue();clearElement(l),l.appendChild(this.cellRendererGui)}},t.prototype.afterCellEditorCreated=function(e,r,o,s,l){var a=e!==this.editorVersion;if(a){this.beans.context.destroyBean(r);return}var h=r.isCancelBeforeStart&&r.isCancelBeforeStart();if(h){this.beans.context.destroyBean(r),this.cellCtrl.stopEditing(!0);return}if(!r.getGui){console.warn("AG Grid: cellEditor for column "+this.column.getId()+" is missing getGui() method"),this.beans.context.destroyBean(r);return}this.cellEditor=r,this.cellEditorGui=r.getGui();var y=s||r.isPopup!==void 0&&r.isPopup();y?this.addPopupCellEditor(o,l):this.addInCellEditor(),this.refreshEditStyles(!0,y),r.afterGuiAttached&&r.afterGuiAttached()},t.prototype.refreshEditStyles=function(e,r){var o;this.addOrRemoveCssClass("ag-cell-inline-editing",e&&!r),this.addOrRemoveCssClass("ag-cell-popup-editing",e&&!!r),this.addOrRemoveCssClass("ag-cell-not-inline-editing",!e||!!r),(o=this.rowCtrl)===null||o===void 0||o.setInlineEditingCss(e)},t.prototype.addInCellEditor=function(){var e=this.getGui(),r=this.beans.gridOptionsService.getDocument();if(e.contains(r.activeElement)&&e.focus(),this.destroyRenderer(),this.refreshWrapper(!0),this.clearParentOfValue(),this.cellEditorGui){var o=this.getParentOfValue();o.appendChild(this.cellEditorGui)}},t.prototype.addPopupCellEditor=function(e,r){var o=this;this.beans.gridOptionsService.get("editType")==="fullRow"&&console.warn("AG Grid: popup cellEditor does not work with fullRowEdit - you cannot use them both - either turn off fullRowEdit, or stop using popup editors.");var s=this.cellEditor;this.cellEditorPopupWrapper=this.beans.context.createBean(new PopupEditorWrapper(e));var l=this.cellEditorPopupWrapper.getGui();this.cellEditorGui&&l.appendChild(this.cellEditorGui);var a=this.beans.popupService,h=this.beans.gridOptionsService.is("stopEditingWhenCellsLoseFocus"),y=r??(s.getPopupPosition?s.getPopupPosition():"over"),C=this.beans.gridOptionsService.is("enableRtl"),L={ePopup:l,column:this.column,rowNode:this.rowNode,type:"popupCellEditor",eventSource:this.getGui(),position:y,alignSide:C?"right":"left",keepWithinBounds:!0},Y=a.positionPopupByComponent.bind(a,L),ze=this.beans.localeService.getLocaleTextFunc(),Bt=a.addPopup({modal:h,eChild:l,closeOnEsc:!0,closedCallback:function(){o.cellCtrl.onPopupEditorClosed()},anchorToElement:this.getGui(),positionCallback:Y,ariaLabel:ze("ariaLabelCellEditor","Cell Editor")});Bt&&(this.hideEditorPopup=Bt.hideFunc)},t.prototype.detach=function(){this.eRow.removeChild(this.getGui())},t.prototype.destroy=function(){this.cellCtrl.stopEditing(),this.destroyEditorAndRenderer(),this.removeControls(),n.prototype.destroy.call(this)},t.prototype.clearParentOfValue=function(){var e=this.getGui(),r=this.beans.gridOptionsService.getDocument();e.contains(r.activeElement)&&browserSupportsPreventScroll()&&e.focus({preventScroll:!0}),clearElement(this.getParentOfValue())},t}(Component),__extends$1C=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),RowComp=function(n){__extends$1C(t,n);function t(e,r,o){var s=n.call(this)||this;s.cellComps={},s.beans=r,s.rowCtrl=e,s.setTemplate('<div comp-id="'+s.getCompId()+'" style="'+s.getInitialStyle(o)+'"/>');var l=s.getGui(),a=l.style,h={setDomOrder:function(y){return s.domOrder=y},setCellCtrls:function(y){return s.setCellCtrls(y)},showFullWidth:function(y){return s.showFullWidth(y)},getFullWidthCellRenderer:function(){return s.getFullWidthCellRenderer()},addOrRemoveCssClass:function(y,C){return s.addOrRemoveCssClass(y,C)},setUserStyles:function(y){return addStylesToElement(l,y)},setTop:function(y){return a.top=y},setTransform:function(y){return a.transform=y},setRowIndex:function(y){return l.setAttribute("row-index",y)},setRole:function(y){return setAriaRole(l,y)},setRowId:function(y){return l.setAttribute("row-id",y)},setRowBusinessKey:function(y){return l.setAttribute("row-business-key",y)},setTabIndex:function(y){return l.setAttribute("tabindex",y.toString())}};return e.setComp(h,s.getGui(),o),s.addDestroyFunc(function(){e.unsetComp(o)}),s}return t.prototype.getInitialStyle=function(e){var r=this.rowCtrl.getInitialTransform(e),o=this.rowCtrl.getInitialRowTop(e);return r?"transform: "+r:"top: "+o},t.prototype.showFullWidth=function(e){var r=this,o=function(l){if(r.isAlive()){var a=l.getGui();r.getGui().appendChild(a),r.rowCtrl.setupDetailRowAutoHeight(a),r.setFullWidthRowComp(l)}else r.beans.context.destroyBean(l)},s=e.newAgStackInstance();s&&s.then(o)},t.prototype.setCellCtrls=function(e){var r=this,o=Object.assign({},this.cellComps);e.forEach(function(l){var a=l.getInstanceId(),h=r.cellComps[a];h==null?r.newCellComp(l):o[a]=null});var s=getAllValuesInObject(o).filter(function(l){return l!=null});this.destroyCells(s),this.ensureDomOrder(e)},t.prototype.ensureDomOrder=function(e){var r=this;if(this.domOrder){var o=[];e.forEach(function(s){var l=r.cellComps[s.getInstanceId()];l&&o.push(l.getGui())}),setDomChildOrder(this.getGui(),o)}},t.prototype.newCellComp=function(e){var r=new CellComp(this.beans,e,this.rowCtrl.isPrintLayout(),this.getGui(),this.rowCtrl.isEditing());this.cellComps[e.getInstanceId()]=r,this.getGui().appendChild(r.getGui())},t.prototype.destroy=function(){n.prototype.destroy.call(this),this.destroyAllCells()},t.prototype.destroyAllCells=function(){var e=getAllValuesInObject(this.cellComps).filter(function(r){return r!=null});this.destroyCells(e)},t.prototype.setFullWidthRowComp=function(e){var r=this;this.fullWidthCellRenderer&&console.error("AG Grid - should not be setting fullWidthRowComponent twice"),this.fullWidthCellRenderer=e,this.addDestroyFunc(function(){r.fullWidthCellRenderer=r.beans.context.destroyBean(r.fullWidthCellRenderer)})},t.prototype.getFullWidthCellRenderer=function(){return this.fullWidthCellRenderer},t.prototype.destroyCells=function(e){var r=this;e.forEach(function(o){if(o){var s=o.getCtrl().getInstanceId();r.cellComps[s]===o&&(o.detach(),o.destroy(),r.cellComps[s]=null)}})},t}(Component),__extends$1B=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__assign$7=function(){return __assign$7=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},__assign$7.apply(this,arguments)},__decorate$1z=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};function templateFactory(){var n=Component.elementGettingCreated.getAttribute("name"),t=RowContainerCtrl.getRowContainerCssClasses(n),e,r=n===RowContainerName.CENTER,o=n===RowContainerName.TOP_CENTER||n===RowContainerName.STICKY_TOP_CENTER||n===RowContainerName.BOTTOM_CENTER;return r?e='<div class="'+t.wrapper+`" ref="eWrapper" role="presentation">
                <div class="`+t.viewport+`" ref="eViewport" role="presentation">
                    <div class="`+t.container+`" ref="eContainer"></div>
                </div>
            </div>`:o?e='<div class="'+t.viewport+`" ref="eViewport" role="presentation">
                <div class="`+t.container+`" ref="eContainer"></div>
            </div>`:e='<div class="'+t.container+'" ref="eContainer"></div>',e}var RowContainerComp=function(n){__extends$1B(t,n);function t(){var e=n.call(this,templateFactory())||this;return e.rowComps={},e.name=Component.elementGettingCreated.getAttribute("name"),e.type=getRowContainerTypeForName(e.name),e}return t.prototype.postConstruct=function(){var e=this,r={setViewportHeight:function(s){return e.eViewport.style.height=s},setRowCtrls:function(s){return e.setRowCtrls(s)},setDomOrder:function(s){e.domOrder=s},setContainerWidth:function(s){return e.eContainer.style.width=s}},o=this.createManagedBean(new RowContainerCtrl(this.name));o.setComp(r,this.eContainer,this.eViewport,this.eWrapper)},t.prototype.preDestroy=function(){this.setRowCtrls([])},t.prototype.setRowCtrls=function(e){var r=this,o=__assign$7({},this.rowComps);this.rowComps={},this.lastPlacedElement=null;var s=function(l){var a=l.getInstanceId(),h=o[a];if(h)r.rowComps[a]=h,delete o[a],r.ensureDomOrder(h.getGui());else{if(!l.getRowNode().displayed)return;var y=new RowComp(l,r.beans,r.type);r.rowComps[a]=y,r.appendRow(y.getGui())}};e.forEach(s),getAllValuesInObject(o).forEach(function(l){r.eContainer.removeChild(l.getGui()),l.destroy()}),setAriaRole(this.eContainer,e.length?"rowgroup":"presentation")},t.prototype.appendRow=function(e){this.domOrder?insertWithDomOrder(this.eContainer,e,this.lastPlacedElement):this.eContainer.appendChild(e),this.lastPlacedElement=e},t.prototype.ensureDomOrder=function(e){this.domOrder&&(ensureDomOrder(this.eContainer,e,this.lastPlacedElement),this.lastPlacedElement=e)},__decorate$1z([Autowired("beans")],t.prototype,"beans",void 0),__decorate$1z([RefSelector("eViewport")],t.prototype,"eViewport",void 0),__decorate$1z([RefSelector("eContainer")],t.prototype,"eContainer",void 0),__decorate$1z([RefSelector("eWrapper")],t.prototype,"eWrapper",void 0),__decorate$1z([PostConstruct],t.prototype,"postConstruct",null),__decorate$1z([PreDestroy],t.prototype,"preDestroy",null),t}(Component),__decorate$1y=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},BodyDropPivotTarget=function(){function n(t){this.columnsToAggregate=[],this.columnsToGroup=[],this.columnsToPivot=[],this.pinned=t}return n.prototype.onDragEnter=function(t){var e=this;if(this.clearColumnsList(),!this.gridOptionsService.is("functionsReadOnly")){var r=t.dragItem.columns;r&&r.forEach(function(o){o.isPrimary()&&(o.isAnyFunctionActive()||(o.isAllowValue()?e.columnsToAggregate.push(o):o.isAllowRowGroup()?e.columnsToGroup.push(o):o.isAllowPivot()&&e.columnsToPivot.push(o)))})}},n.prototype.getIconName=function(){var t=this.columnsToAggregate.length+this.columnsToGroup.length+this.columnsToPivot.length;return t>0?this.pinned?DragAndDropService.ICON_PINNED:DragAndDropService.ICON_MOVE:null},n.prototype.onDragLeave=function(t){this.clearColumnsList()},n.prototype.clearColumnsList=function(){this.columnsToAggregate.length=0,this.columnsToGroup.length=0,this.columnsToPivot.length=0},n.prototype.onDragging=function(t){},n.prototype.onDragStop=function(t){this.columnsToAggregate.length>0&&this.columnModel.addValueColumns(this.columnsToAggregate,"toolPanelDragAndDrop"),this.columnsToGroup.length>0&&this.columnModel.addRowGroupColumns(this.columnsToGroup,"toolPanelDragAndDrop"),this.columnsToPivot.length>0&&this.columnModel.addPivotColumns(this.columnsToPivot,"toolPanelDragAndDrop")},__decorate$1y([Autowired("columnModel")],n.prototype,"columnModel",void 0),__decorate$1y([Autowired("gridOptionsService")],n.prototype,"gridOptionsService",void 0),n}(),__decorate$1x=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__read$i=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},MoveColumnFeature=function(){function n(t,e){this.needToMoveLeft=!1,this.needToMoveRight=!1,this.lastMovedInfo=null,this.pinned=t,this.eContainer=e,this.centerContainer=!exists(t)}return n.prototype.init=function(){var t=this;this.ctrlsService.whenReady(function(){t.gridBodyCon=t.ctrlsService.getGridBodyCtrl()})},n.prototype.getIconName=function(){return this.pinned?DragAndDropService.ICON_PINNED:DragAndDropService.ICON_MOVE},n.prototype.onDragEnter=function(t){var e=t.dragItem.columns,r=t.dragSource.type===DragSourceType.ToolPanel;if(r)this.setColumnsVisible(e,!0,"uiColumnDragged");else{var o=t.dragItem.visibleState,s=(e||[]).filter(function(l){return o[l.getId()]});this.setColumnsVisible(s,!0,"uiColumnDragged")}this.setColumnsPinned(e,this.pinned,"uiColumnDragged"),this.onDragging(t,!0,!0)},n.prototype.onDragLeave=function(){this.ensureIntervalCleared(),this.lastMovedInfo=null},n.prototype.setColumnsVisible=function(t,e,r){if(r===void 0&&(r="api"),t){var o=t.filter(function(s){return!s.getColDef().lockVisible});this.columnModel.setColumnsVisible(o,e,r)}},n.prototype.setColumnsPinned=function(t,e,r){if(r===void 0&&(r="api"),t){var o=t.filter(function(s){return!s.getColDef().lockPinned});this.columnModel.setColumnsPinned(o,e,r)}},n.prototype.onDragStop=function(){this.onDragging(this.lastDraggingEvent,!1,!0,!0),this.ensureIntervalCleared(),this.lastMovedInfo=null},n.prototype.normaliseX=function(t){if(this.gridOptionsService.is("enableRtl")){var e=this.eContainer.clientWidth;t=e-t}return this.centerContainer&&(t+=this.ctrlsService.getCenterRowContainerCtrl().getCenterViewportScrollLeft()),t},n.prototype.checkCenterForScrolling=function(t){if(this.centerContainer){var e=this.ctrlsService.getCenterRowContainerCtrl().getCenterViewportScrollLeft(),r=e+this.ctrlsService.getCenterRowContainerCtrl().getCenterWidth();this.gridOptionsService.is("enableRtl")?(this.needToMoveRight=t<e+50,this.needToMoveLeft=t>r-50):(this.needToMoveLeft=t<e+50,this.needToMoveRight=t>r-50),this.needToMoveLeft||this.needToMoveRight?this.ensureIntervalStarted():this.ensureIntervalCleared()}},n.prototype.onDragging=function(t,e,r,o){var s=this,l;if(t===void 0&&(t=this.lastDraggingEvent),e===void 0&&(e=!1),r===void 0&&(r=!1),o===void 0&&(o=!1),o){if(this.lastMovedInfo){var a=this.lastMovedInfo,h=a.columns,y=a.toIndex;this.moveColumns(h,y,"uiColumnMoved",!0)}return}if(this.lastDraggingEvent=t,!missing(t.hDirection)){var C=this.normaliseX(t.x);e||this.checkCenterForScrolling(C);var L=this.normaliseDirection(t.hDirection),Y=t.dragSource.type,ze=((l=t.dragSource.getDragItem().columns)===null||l===void 0?void 0:l.filter(function(Bt){return Bt.getColDef().lockPinned?Bt.getPinned()==s.pinned:!0}))||[];this.attemptMoveColumns({dragSourceType:Y,allMovingColumns:ze,hDirection:L,mouseX:C,fromEnter:e,fakeEvent:r})}},n.prototype.normaliseDirection=function(t){if(this.gridOptionsService.is("enableRtl"))switch(t){case HorizontalDirection.Left:return HorizontalDirection.Right;case HorizontalDirection.Right:return HorizontalDirection.Left;default:console.error("AG Grid: Unknown direction "+t)}else return t},n.prototype.attemptMoveColumns=function(t){var e=t.dragSourceType,r=t.hDirection,o=t.mouseX,s=t.fromEnter,l=t.fakeEvent,a=r===HorizontalDirection.Left,h=r===HorizontalDirection.Right,y=t.allMovingColumns;if(e===DragSourceType.HeaderCell){var C=[];y.forEach(function(il){for(var sl=null,ol=il.getParent();ol!=null&&ol.getDisplayedLeafColumns().length===1;)sl=ol,ol=ol.getParent();if(sl!=null){var _l=sl.getProvidedColumnGroup();_l.getLeafColumns().forEach(function(rh){C.includes(rh)||C.push(rh)})}else C.includes(il)||C.push(il)}),y=C}var L=y.slice();this.columnModel.sortColumnsLikeGridColumns(L);var Y=this.calculateValidMoves(L,h,o),ze=this.calculateOldIndex(L);if(Y.length!==0){var Bt=Y[0],Ir=ze!==null&&!s;if(e==DragSourceType.HeaderCell&&(Ir=ze!==null),!(Ir&&!l&&(a&&Bt>=ze||h&&Bt<=ze))){for(var Wr=this.columnModel.getAllDisplayedColumns(),yi=[],Bn=null,vi=0;vi<Y.length;vi++){var wo=Y[vi],ia=this.columnModel.getProposedColumnOrder(L,wo);if(this.columnModel.doesOrderPassRules(ia)){var gl=ia.filter(function(il){return Wr.includes(il)});if(Bn===null)Bn=gl;else if(!_.areEqual(gl,Bn))break;var ml=this.groupFragCount(ia);yi.push({move:wo,fragCount:ml})}}yi.length!==0&&(yi.sort(function(il,sl){return il.fragCount-sl.fragCount}),this.moveColumns(y,yi[0].move,"uiColumnMoved",!1))}}},n.prototype.calculateOldIndex=function(t){var e=this.columnModel.getAllGridColumns(),r=sortNumerically(t.map(function(h){return e.indexOf(h)})),o=r[0],s=last(r),l=s-o,a=l!==r.length-1;return a?null:o},n.prototype.moveColumns=function(t,e,r,o){this.columnModel.moveColumns(t,e,r,o),this.lastMovedInfo=o?null:{columns:t,toIndex:e}},n.prototype.groupFragCount=function(t){function e(l){for(var a=[],h=l.getOriginalParent();h!=null;)a.push(h),h=h.getOriginalParent();return a}for(var r=0,o=function(l){var a,h=e(t[l]),y=e(t[l+1]);a=__read$i(h.length>y.length?[h,y]:[y,h],2),h=a[0],y=a[1],h.forEach(function(C){y.indexOf(C)===-1&&r++})},s=0;s<t.length-1;s++)o(s);return r},n.prototype.calculateValidMoves=function(t,e,r){var o=this.gridOptionsService.is("suppressMovableColumns")||t.some(function(ml){return ml.getColDef().suppressMovable});if(o)return[];var s=this.columnModel.getDisplayedColumns(this.pinned),l=this.columnModel.getAllGridColumns(),a=s.filter(function(ml){return includes(t,ml)}),h=s.filter(function(ml){return!includes(t,ml)}),y=l.filter(function(ml){return!includes(t,ml)}),C=0,L=r;if(e){var Y=0;a.forEach(function(ml){return Y+=ml.getActualWidth()}),L-=Y}if(L>0){for(var ze=0;ze<h.length;ze++){var Bt=h[ze];if(L-=Bt.getActualWidth(),L<0)break;C++}e&&C++}var Ir;if(C>0){var Wr=h[C-1];Ir=y.indexOf(Wr)+1}else Ir=y.indexOf(h[0]),Ir===-1&&(Ir=0);var yi=[Ir],Bn=function(ml,il){return ml-il};if(e){for(var vi=Ir+1,wo=l.length-1;vi<=wo;)yi.push(vi),vi++;yi.sort(Bn)}else{for(var vi=Ir,wo=l.length-1,ia=l[vi];vi<=wo&&this.isColumnHidden(s,ia);)vi++,yi.push(vi),ia=l[vi];vi=Ir-1;for(var gl=0;vi>=gl;)yi.push(vi),vi--;yi.sort(Bn).reverse()}return yi},n.prototype.isColumnHidden=function(t,e){return t.indexOf(e)<0},n.prototype.ensureIntervalStarted=function(){this.movingIntervalId||(this.intervalCount=0,this.failedMoveAttempts=0,this.movingIntervalId=window.setInterval(this.moveInterval.bind(this),100),this.needToMoveLeft?this.dragAndDropService.setGhostIcon(DragAndDropService.ICON_LEFT,!0):this.dragAndDropService.setGhostIcon(DragAndDropService.ICON_RIGHT,!0))},n.prototype.ensureIntervalCleared=function(){this.movingIntervalId&&(window.clearInterval(this.movingIntervalId),this.movingIntervalId=null,this.dragAndDropService.setGhostIcon(DragAndDropService.ICON_MOVE))},n.prototype.moveInterval=function(){var t;this.intervalCount++,t=10+this.intervalCount*5,t>100&&(t=100);var e=null,r=this.gridBodyCon.getScrollFeature();if(this.needToMoveLeft?e=r.scrollHorizontally(-t):this.needToMoveRight&&(e=r.scrollHorizontally(t)),e!==0)this.onDragging(this.lastDraggingEvent),this.failedMoveAttempts=0;else{this.failedMoveAttempts++;var o=this.lastDraggingEvent.dragItem.columns,s=o.filter(function(a){return!a.getColDef().lockPinned});if(s.length>0&&(this.dragAndDropService.setGhostIcon(DragAndDropService.ICON_PINNED),this.failedMoveAttempts>7)){var l=this.needToMoveLeft?"left":"right";this.setColumnsPinned(s,l,"uiColumnDragged"),this.dragAndDropService.nudge()}}},__decorate$1x([Autowired("columnModel")],n.prototype,"columnModel",void 0),__decorate$1x([Autowired("dragAndDropService")],n.prototype,"dragAndDropService",void 0),__decorate$1x([Autowired("gridOptionsService")],n.prototype,"gridOptionsService",void 0),__decorate$1x([Autowired("ctrlsService")],n.prototype,"ctrlsService",void 0),__decorate$1x([PostConstruct],n.prototype,"init",null),n}(),__extends$1A=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1w=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},BodyDropTarget=function(n){__extends$1A(t,n);function t(e,r){var o=n.call(this)||this;return o.pinned=e,o.eContainer=r,o}return t.prototype.postConstruct=function(){var e=this;this.ctrlsService.whenReady(function(r){switch(e.pinned){case"left":e.eSecondaryContainers=[[r.gridBodyCtrl.getBodyViewportElement(),r.leftRowContainerCtrl.getContainerElement()],[r.bottomLeftRowContainerCtrl.getContainerElement()],[r.topLeftRowContainerCtrl.getContainerElement()]];break;case"right":e.eSecondaryContainers=[[r.gridBodyCtrl.getBodyViewportElement(),r.rightRowContainerCtrl.getContainerElement()],[r.bottomRightRowContainerCtrl.getContainerElement()],[r.topRightRowContainerCtrl.getContainerElement()]];break;default:e.eSecondaryContainers=[[r.gridBodyCtrl.getBodyViewportElement(),r.centerRowContainerCtrl.getViewportElement()],[r.bottomCenterRowContainerCtrl.getViewportElement()],[r.topCenterRowContainerCtrl.getViewportElement()]];break}})},t.prototype.isInterestedIn=function(e){return e===DragSourceType.HeaderCell||e===DragSourceType.ToolPanel&&this.gridOptionsService.is("allowDragFromColumnsToolPanel")},t.prototype.getSecondaryContainers=function(){return this.eSecondaryContainers},t.prototype.getContainer=function(){return this.eContainer},t.prototype.init=function(){this.moveColumnFeature=this.createManagedBean(new MoveColumnFeature(this.pinned,this.eContainer)),this.bodyDropPivotTarget=this.createManagedBean(new BodyDropPivotTarget(this.pinned)),this.dragAndDropService.addDropTarget(this)},t.prototype.getIconName=function(){return this.currentDropListener.getIconName()},t.prototype.isDropColumnInPivotMode=function(e){return this.columnModel.isPivotMode()&&e.dragSource.type===DragSourceType.ToolPanel},t.prototype.onDragEnter=function(e){this.currentDropListener=this.isDropColumnInPivotMode(e)?this.bodyDropPivotTarget:this.moveColumnFeature,this.currentDropListener.onDragEnter(e)},t.prototype.onDragLeave=function(e){this.currentDropListener.onDragLeave(e)},t.prototype.onDragging=function(e){this.currentDropListener.onDragging(e)},t.prototype.onDragStop=function(e){this.currentDropListener.onDragStop(e)},__decorate$1w([Autowired("dragAndDropService")],t.prototype,"dragAndDropService",void 0),__decorate$1w([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$1w([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),__decorate$1w([PostConstruct],t.prototype,"postConstruct",null),__decorate$1w([PostConstruct],t.prototype,"init",null),t}(BeanStub),__read$h=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray$f=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n},CssClassApplier=function(){function n(){}return n.getHeaderClassesFromColDef=function(t,e,r,o){return missing(t)?[]:this.getColumnClassesFromCollDef(t.headerClass,t,e,r,o)},n.getToolPanelClassesFromColDef=function(t,e,r,o){return missing(t)?[]:this.getColumnClassesFromCollDef(t.toolPanelClass,t,e,r,o)},n.getClassParams=function(t,e,r,o){return{colDef:t,column:r,columnGroup:o,api:e.api,columnApi:e.columnApi,context:e.context}},n.getColumnClassesFromCollDef=function(t,e,r,o,s){if(missing(t))return[];var l;if(typeof t=="function"){var a=this.getClassParams(e,r,o,s);l=t(a)}else l=t;return typeof l=="string"?[l]:Array.isArray(l)?__spreadArray$f([],__read$h(l)):[]},n}(),__extends$1z=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1v=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},HeaderCellComp=function(n){__extends$1z(t,n);function t(e){var r=n.call(this,t.TEMPLATE,e)||this;return r.headerCompVersion=0,r.column=e.getColumnGroupChild(),r.pinned=e.getPinned(),r}return t.prototype.postConstruct=function(){var e=this,r=this.getGui(),o=function(a,h,y){var C=y||r;h!=null&&h!=""?C.setAttribute(a,h):C.removeAttribute(a)},s={setWidth:function(a){return r.style.width=a},addOrRemoveCssClass:function(a,h){return e.addOrRemoveCssClass(a,h)},setColId:function(a){return o("col-id",a)},setTitle:function(a){return o("title",a)},setAriaDescription:function(a){return setAriaDescription(r,a)},setAriaSort:function(a){return a?setAriaSort(r,a):removeAriaSort(r)},setUserCompDetails:function(a){return e.setUserCompDetails(a)},getUserCompInstance:function(){return e.headerComp}};this.ctrl.setComp(s,this.getGui(),this.eResize,this.eHeaderCompWrapper);var l=this.ctrl.getSelectAllGui();this.eResize.insertAdjacentElement("afterend",l)},t.prototype.destroyHeaderComp=function(){this.headerComp&&(this.eHeaderCompWrapper.removeChild(this.headerCompGui),this.headerComp=this.destroyBean(this.headerComp),this.headerCompGui=void 0)},t.prototype.setUserCompDetails=function(e){var r=this;this.headerCompVersion++;var o=this.headerCompVersion;e.newAgStackInstance().then(function(s){return r.afterCompCreated(o,s)})},t.prototype.afterCompCreated=function(e,r){if(e!=this.headerCompVersion||!this.isAlive()){this.destroyBean(r);return}this.destroyHeaderComp(),this.headerComp=r,this.headerCompGui=r.getGui(),this.eHeaderCompWrapper.appendChild(this.headerCompGui),this.ctrl.setDragSource(this.getGui())},t.TEMPLATE=`<div class="ag-header-cell" role="columnheader" tabindex="-1">
            <div ref="eResize" class="ag-header-cell-resize" role="presentation"></div>
            <div ref="eHeaderCompWrapper" class="ag-header-cell-comp-wrapper" role="presentation"></div>
        </div>`,__decorate$1v([RefSelector("eResize")],t.prototype,"eResize",void 0),__decorate$1v([RefSelector("eHeaderCompWrapper")],t.prototype,"eHeaderCompWrapper",void 0),__decorate$1v([PostConstruct],t.prototype,"postConstruct",null),__decorate$1v([PreDestroy],t.prototype,"destroyHeaderComp",null),t}(AbstractHeaderCellComp),__extends$1y=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1u=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},HeaderGroupCellComp=function(n){__extends$1y(t,n);function t(e){return n.call(this,t.TEMPLATE,e)||this}return t.prototype.postConstruct=function(){var e=this,r=this.getGui(),o=function(l,a){return a!=null?r.setAttribute(l,a):r.removeAttribute(l)},s={addOrRemoveCssClass:function(l,a){return e.addOrRemoveCssClass(l,a)},setResizableDisplayed:function(l){return setDisplayed(e.eResize,l)},setWidth:function(l){return r.style.width=l},setColId:function(l){return r.setAttribute("col-id",l)},setAriaExpanded:function(l){return o("aria-expanded",l)},setTitle:function(l){return o("title",l)},setUserCompDetails:function(l){return e.setUserCompDetails(l)}};this.ctrl.setComp(s,r,this.eResize)},t.prototype.setUserCompDetails=function(e){var r=this;e.newAgStackInstance().then(function(o){return r.afterHeaderCompCreated(o)})},t.prototype.afterHeaderCompCreated=function(e){var r=this,o=function(){return r.destroyBean(e)};if(!this.isAlive()){o();return}var s=this.getGui(),l=e.getGui();s.appendChild(l),this.addDestroyFunc(o),this.ctrl.setDragSource(s)},t.TEMPLATE=`<div class="ag-header-group-cell" role="columnheader" tabindex="-1">
            <div ref="eResize" class="ag-header-cell-resize" role="presentation"></div>
        </div>`,__decorate$1u([Autowired("userComponentFactory")],t.prototype,"userComponentFactory",void 0),__decorate$1u([RefSelector("eResize")],t.prototype,"eResize",void 0),__decorate$1u([PostConstruct],t.prototype,"postConstruct",null),t}(AbstractHeaderCellComp),__extends$1x=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1t=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},HeaderRowType;(function(n){n.COLUMN_GROUP="group",n.COLUMN="column",n.FLOATING_FILTER="filter"})(HeaderRowType||(HeaderRowType={}));var HeaderRowComp=function(n){__extends$1x(t,n);function t(e){var r=n.call(this)||this;r.headerComps={};var o=e.getType()==HeaderRowType.COLUMN_GROUP?"ag-header-row-column-group":e.getType()==HeaderRowType.FLOATING_FILTER?"ag-header-row-column-filter":"ag-header-row-column";return r.setTemplate('<div class="ag-header-row '+o+'" role="row"></div>'),r.ctrl=e,r}return t.prototype.init=function(){var e=this,r={setTransform:function(o){return e.getGui().style.transform=o},setHeight:function(o){return e.getGui().style.height=o},setTop:function(o){return e.getGui().style.top=o},setHeaderCtrls:function(o){return e.setHeaderCtrls(o)},setWidth:function(o){return e.getGui().style.width=o},setAriaRowIndex:function(o){return setAriaRowIndex(e.getGui(),o)}};this.ctrl.setComp(r)},t.prototype.destroyHeaderCtrls=function(){this.setHeaderCtrls([])},t.prototype.setHeaderCtrls=function(e){var r=this;if(this.isAlive()){var o=this.headerComps;this.headerComps={},e.forEach(function(y){var C=y.getInstanceId(),L=o[C];delete o[C],L==null&&(L=r.createHeaderComp(y),r.getGui().appendChild(L.getGui())),r.headerComps[C]=L}),iterateObject(o,function(y,C){r.getGui().removeChild(C.getGui()),r.destroyBean(C)});var s=this.gridOptionsService.is("ensureDomOrder"),l=this.gridOptionsService.isDomLayout("print");if(s||l){var a=getAllValuesInObject(this.headerComps);a.sort(function(y,C){var L=y.getCtrl().getColumnGroupChild().getLeft(),Y=C.getCtrl().getColumnGroupChild().getLeft();return L-Y});var h=a.map(function(y){return y.getGui()});setDomChildOrder(this.getGui(),h)}}},t.prototype.createHeaderComp=function(e){var r;switch(this.ctrl.getType()){case HeaderRowType.COLUMN_GROUP:r=new HeaderGroupCellComp(e);break;case HeaderRowType.FLOATING_FILTER:r=new HeaderFilterCellComp(e);break;default:r=new HeaderCellComp(e);break}return this.createBean(r),r.setParentComponent(this),r},__decorate$1t([PostConstruct],t.prototype,"init",null),__decorate$1t([PreDestroy],t.prototype,"destroyHeaderCtrls",null),t}(Component),__extends$1w=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1s=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},instanceIdSequence$1=0,AbstractHeaderCellCtrl=function(n){__extends$1w(t,n);function t(e,r){var o=n.call(this)||this;return o.lastFocusEvent=null,o.columnGroupChild=e,o.parentRowCtrl=r,o.instanceId=e.getUniqueId()+"-"+instanceIdSequence$1++,o}return t.prototype.shouldStopEventPropagation=function(e){var r=this.focusService.getFocusedHeader(),o=r.headerRowIndex,s=r.column;return isUserSuppressingHeaderKeyboardEvent(this.gridOptionsService,e,o,s)},t.prototype.getWrapperHasFocus=function(){var e=this.gridOptionsService.getDocument(),r=e.activeElement;return r===this.eGui},t.prototype.setGui=function(e){this.eGui=e,this.addDomData()},t.prototype.handleKeyDown=function(e){var r=this.getWrapperHasFocus();switch(e.key){case KeyCode.PAGE_DOWN:case KeyCode.PAGE_UP:case KeyCode.PAGE_HOME:case KeyCode.PAGE_END:r&&e.preventDefault()}},t.prototype.addDomData=function(){var e=this,r=t.DOM_DATA_KEY_HEADER_CTRL;this.gridOptionsService.setDomData(this.eGui,r,this),this.addDestroyFunc(function(){return e.gridOptionsService.setDomData(e.eGui,r,null)})},t.prototype.getGui=function(){return this.eGui},t.prototype.focus=function(e){return this.eGui?(this.lastFocusEvent=e||null,this.eGui.focus(),!0):!1},t.prototype.getRowIndex=function(){return this.parentRowCtrl.getRowIndex()},t.prototype.getParentRowCtrl=function(){return this.parentRowCtrl},t.prototype.getPinned=function(){return this.parentRowCtrl.getPinned()},t.prototype.getInstanceId=function(){return this.instanceId},t.prototype.getColumnGroupChild=function(){return this.columnGroupChild},t.DOM_DATA_KEY_HEADER_CTRL="headerCtrl",__decorate$1s([Autowired("focusService")],t.prototype,"focusService",void 0),__decorate$1s([Autowired("beans")],t.prototype,"beans",void 0),__decorate$1s([Autowired("userComponentFactory")],t.prototype,"userComponentFactory",void 0),t}(BeanStub),__extends$1v=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1r=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},SetLeftFeature=function(n){__extends$1v(t,n);function t(e,r,o,s){var l=n.call(this)||this;return l.columnOrGroup=e,l.eCell=r,l.ariaEl=l.eCell.querySelector("[role=columnheader]")||l.eCell,l.colsSpanning=s,l.beans=o,l}return t.prototype.setColsSpanning=function(e){this.colsSpanning=e,this.onLeftChanged()},t.prototype.getColumnOrGroup=function(){return this.beans.gridOptionsService.is("enableRtl")&&this.colsSpanning?last(this.colsSpanning):this.columnOrGroup},t.prototype.postConstruct=function(){this.addManagedListener(this.columnOrGroup,Column.EVENT_LEFT_CHANGED,this.onLeftChanged.bind(this)),this.setLeftFirstTime(),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED,this.onLeftChanged.bind(this)),this.addManagedPropertyListener("domLayout",this.onLeftChanged.bind(this))},t.prototype.setLeftFirstTime=function(){var e=this.beans.gridOptionsService.is("suppressColumnMoveAnimation"),r=exists(this.columnOrGroup.getOldLeft()),o=this.beans.columnAnimationService.isActive()&&r&&!e;o?this.animateInLeft():this.onLeftChanged()},t.prototype.animateInLeft=function(){var e=this,r=this.getColumnOrGroup(),o=r.getLeft(),s=r.getOldLeft(),l=this.modifyLeftForPrintLayout(r,s),a=this.modifyLeftForPrintLayout(r,o);this.setLeft(l),this.actualLeft=a,this.beans.columnAnimationService.executeNextVMTurn(function(){e.actualLeft===a&&e.setLeft(a)})},t.prototype.onLeftChanged=function(){var e=this.getColumnOrGroup(),r=e.getLeft();this.actualLeft=this.modifyLeftForPrintLayout(e,r),this.setLeft(this.actualLeft)},t.prototype.modifyLeftForPrintLayout=function(e,r){var o=this.beans.gridOptionsService.isDomLayout("print");if(!o||e.getPinned()==="left")return r;var s=this.beans.columnModel.getDisplayedColumnsLeftWidth();if(e.getPinned()==="right"){var l=this.beans.columnModel.getBodyContainerWidth();return s+l+r}return s+r},t.prototype.setLeft=function(e){exists(e)&&(this.eCell.style.left=e+"px");var r;if(this.columnOrGroup instanceof Column)r=this.columnOrGroup;else{var o=this.columnOrGroup,s=o.getLeafColumns();if(!s.length)return;s.length>1&&setAriaColSpan(this.ariaEl,s.length),r=s[0]}var l=this.beans.columnModel.getAriaColumnIndex(r);setAriaColIndex(this.ariaEl,l)},__decorate$1r([PostConstruct],t.prototype,"postConstruct",null),t}(BeanStub),__extends$1u=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1q=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},HoverFeature=function(n){__extends$1u(t,n);function t(e,r){var o=n.call(this)||this;return o.columns=e,o.element=r,o}return t.prototype.postConstruct=function(){this.gridOptionsService.is("columnHoverHighlight")&&this.addMouseHoverListeners()},t.prototype.addMouseHoverListeners=function(){this.addManagedListener(this.element,"mouseout",this.onMouseOut.bind(this)),this.addManagedListener(this.element,"mouseover",this.onMouseOver.bind(this))},t.prototype.onMouseOut=function(){this.columnHoverService.clearMouseOver()},t.prototype.onMouseOver=function(){this.columnHoverService.setMouseOver(this.columns)},__decorate$1q([Autowired("columnHoverService")],t.prototype,"columnHoverService",void 0),__decorate$1q([PostConstruct],t.prototype,"postConstruct",null),t}(BeanStub),__extends$1t=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1p=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},HeaderFilterCellCtrl=function(n){__extends$1t(t,n);function t(e,r){var o=n.call(this,e,r)||this;return o.iconCreated=!1,o.column=e,o}return t.prototype.setComp=function(e,r,o,s){n.prototype.setGui.call(this,r),this.comp=e,this.eButtonShowMainFilter=o,this.eFloatingFilterBody=s,this.setupActive(),this.setupWidth(),this.setupLeft(),this.setupHover(),this.setupFocus(),this.setupAria(),this.setupFilterButton(),this.setupUserComp(),this.setupSyncWithFilter(),this.setupUi(),this.addManagedListener(this.eButtonShowMainFilter,"click",this.showParentFilter.bind(this)),this.setupFilterChangedListener(),this.addManagedListener(this.column,Column.EVENT_COL_DEF_CHANGED,this.onColDefChanged.bind(this))},t.prototype.setupActive=function(){var e=this.column.getColDef(),r=!!e.filter,o=!!e.floatingFilter;this.active=r&&o},t.prototype.setupUi=function(){if(this.comp.setButtonWrapperDisplayed(!this.suppressFilterButton&&this.active),this.comp.addOrRemoveBodyCssClass("ag-floating-filter-full-body",this.suppressFilterButton),this.comp.addOrRemoveBodyCssClass("ag-floating-filter-body",!this.suppressFilterButton),!(!this.active||this.iconCreated)){var e=createIconNoSpan("filter",this.gridOptionsService,this.column);e&&(this.iconCreated=!0,this.eButtonShowMainFilter.appendChild(e))}},t.prototype.setupFocus=function(){this.createManagedBean(new ManagedFocusFeature(this.eGui,{shouldStopEventPropagation:this.shouldStopEventPropagation.bind(this),onTabKeyDown:this.onTabKeyDown.bind(this),handleKeyDown:this.handleKeyDown.bind(this),onFocusIn:this.onFocusIn.bind(this)}))},t.prototype.setupAria=function(){var e=this.localeService.getLocaleTextFunc();setAriaLabel(this.eButtonShowMainFilter,e("ariaFilterMenuOpen","Open Filter Menu"))},t.prototype.onTabKeyDown=function(e){var r=this.gridOptionsService.getDocument(),o=r.activeElement,s=o===this.eGui;if(!s){var l=this.focusService.findNextFocusableElement(this.eGui,null,e.shiftKey);if(l){this.beans.headerNavigationService.scrollToColumn(this.column),e.preventDefault(),l.focus();return}var a=this.findNextColumnWithFloatingFilter(e.shiftKey);a&&this.focusService.focusHeaderPosition({headerPosition:{headerRowIndex:this.getParentRowCtrl().getRowIndex(),column:a},event:e})&&e.preventDefault()}},t.prototype.findNextColumnWithFloatingFilter=function(e){var r=this.beans.columnModel,o=this.column;do if(o=e?r.getDisplayedColBefore(o):r.getDisplayedColAfter(o),!o)break;while(!o.getColDef().filter||!o.getColDef().floatingFilter);return o},t.prototype.handleKeyDown=function(e){n.prototype.handleKeyDown.call(this,e);var r=this.getWrapperHasFocus();switch(e.key){case KeyCode.UP:case KeyCode.DOWN:r||e.preventDefault();case KeyCode.LEFT:case KeyCode.RIGHT:if(r)return;e.stopPropagation();case KeyCode.ENTER:r&&this.focusService.focusInto(this.eGui)&&e.preventDefault();break;case KeyCode.ESCAPE:r||this.eGui.focus()}},t.prototype.onFocusIn=function(e){var r=this.eGui.contains(e.relatedTarget);if(!r){var o=!!e.relatedTarget&&!e.relatedTarget.classList.contains("ag-floating-filter"),s=!!e.relatedTarget&&isElementChildOfClass(e.relatedTarget,"ag-floating-filter");if(o&&s&&e.target===this.eGui){var l=this.lastFocusEvent,a=!!(l&&l.key===KeyCode.TAB);if(l&&a){var h=l.shiftKey;this.focusService.focusInto(this.eGui,h)}}var y=this.getRowIndex();this.beans.focusService.setFocusedHeader(y,this.column)}},t.prototype.setupHover=function(){var e=this;this.createManagedBean(new HoverFeature([this.column],this.eGui));var r=function(){if(e.gridOptionsService.is("columnHoverHighlight")){var o=e.columnHoverService.isHovered(e.column);e.comp.addOrRemoveCssClass("ag-column-hover",o)}};this.addManagedListener(this.eventService,Events.EVENT_COLUMN_HOVER_CHANGED,r),r()},t.prototype.setupLeft=function(){var e=new SetLeftFeature(this.column,this.eGui,this.beans);this.createManagedBean(e)},t.prototype.setupFilterButton=function(){var e=this.column.getColDef();this.suppressFilterButton=e.floatingFilterComponentParams?!!e.floatingFilterComponentParams.suppressFilterButton:!1},t.prototype.setupUserComp=function(){var e=this;if(this.active){var r=this.filterManager.getFloatingFilterCompDetails(this.column,function(){return e.showParentFilter()});r&&this.setCompDetails(r)}},t.prototype.setCompDetails=function(e){this.userCompDetails=e,this.comp.setCompDetails(e)},t.prototype.showParentFilter=function(){var e=this.suppressFilterButton?this.eFloatingFilterBody:this.eButtonShowMainFilter;this.menuFactory.showMenuAfterButtonClick(this.column,e,"floatingFilter","filterMenuTab",["filterMenuTab"])},t.prototype.setupSyncWithFilter=function(){var e=this;if(this.active){var r=function(o){var s=e.comp.getFloatingFilterComp();s&&s.then(function(l){if(l){var a=e.filterManager.getCurrentFloatingFilterParentModel(e.column);l.onParentModelChanged(a,o)}})};this.destroySyncListener=this.addManagedListener(this.column,Column.EVENT_FILTER_CHANGED,r),this.filterManager.isFilterActive(this.column)&&r(null)}},t.prototype.setupWidth=function(){var e=this,r=function(){var o=e.column.getActualWidth()+"px";e.comp.setWidth(o)};this.addManagedListener(this.column,Column.EVENT_WIDTH_CHANGED,r),r()},t.prototype.setupFilterChangedListener=function(){this.active&&(this.destroyFilterChangedListener=this.addManagedListener(this.column,Column.EVENT_FILTER_CHANGED,this.updateFilterButton.bind(this)))},t.prototype.updateFilterButton=function(){!this.suppressFilterButton&&this.comp&&this.comp.setButtonWrapperDisplayed(this.filterManager.isFilterAllowed(this.column))},t.prototype.onColDefChanged=function(){var e=this,r,o,s=this.active;this.setupActive();var l=!s&&this.active;s&&!this.active&&((r=this.destroySyncListener)===null||r===void 0||r.call(this),(o=this.destroyFilterChangedListener)===null||o===void 0||o.call(this));var a=this.active?this.filterManager.getFloatingFilterCompDetails(this.column,function(){return e.showParentFilter()}):null,h=this.comp.getFloatingFilterComp();!h||!a?this.updateCompDetails(a,l):h.then(function(y){var C;(!y||((C=e.userCompDetails)===null||C===void 0?void 0:C.componentClass)!==a.componentClass)&&e.updateCompDetails(a,l)})},t.prototype.updateCompDetails=function(e,r){this.setCompDetails(e),this.setupFilterButton(),this.setupUi(),r&&(this.setupSyncWithFilter(),this.setupFilterChangedListener())},__decorate$1p([Autowired("filterManager")],t.prototype,"filterManager",void 0),__decorate$1p([Autowired("columnHoverService")],t.prototype,"columnHoverService",void 0),__decorate$1p([Autowired("menuFactory")],t.prototype,"menuFactory",void 0),t}(AbstractHeaderCellCtrl),__extends$1s=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1o=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},ResizeFeature=function(n){__extends$1s(t,n);function t(e,r,o,s,l){var a=n.call(this)||this;return a.pinned=e,a.column=r,a.eResize=o,a.comp=s,a.ctrl=l,a}return t.prototype.postConstruct=function(){var e=this,r=this.column.getColDef(),o=[],s,l,a=function(){if(setDisplayed(e.eResize,s),!!s){var C=e.horizontalResizeService.addResizeBar({eResizeBar:e.eResize,onResizeStart:e.onResizeStart.bind(e),onResizing:e.onResizing.bind(e,!1),onResizeEnd:e.onResizing.bind(e,!0)});if(o.push(C),l){var L=e.gridOptionsService.is("skipHeaderOnAutoSize"),Y=function(){e.columnModel.autoSizeColumn(e.column,L,"uiColumnResized")};e.eResize.addEventListener("dblclick",Y);var ze=new TouchListener(e.eResize);ze.addEventListener(TouchListener.EVENT_DOUBLE_TAP,Y),e.addDestroyFunc(function(){e.eResize.removeEventListener("dblclick",Y),ze.removeEventListener(TouchListener.EVENT_DOUBLE_TAP,Y),ze.destroy()})}}},h=function(){o.forEach(function(C){return C()}),o.length=0},y=function(){var C=e.column.isResizable(),L=!e.gridOptionsService.is("suppressAutoSize")&&!r.suppressAutoSize,Y=C!==s||L!==l;Y&&(s=C,l=L,h(),a())};y(),this.addDestroyFunc(h),this.ctrl.addRefreshFunction(y)},t.prototype.onResizing=function(e,r){var o=this.normaliseResizeAmount(r),s=[{key:this.column,newWidth:this.resizeStartWidth+o}];this.columnModel.setColumnWidths(s,this.resizeWithShiftKey,e,"uiColumnResized"),e&&this.comp.addOrRemoveCssClass("ag-column-resizing",!1)},t.prototype.onResizeStart=function(e){this.resizeStartWidth=this.column.getActualWidth(),this.resizeWithShiftKey=e,this.comp.addOrRemoveCssClass("ag-column-resizing",!0)},t.prototype.normaliseResizeAmount=function(e){var r=e,o=this.pinned!=="left",s=this.pinned==="right";return this.gridOptionsService.is("enableRtl")?o&&(r*=-1):s&&(r*=-1),r},__decorate$1o([Autowired("horizontalResizeService")],t.prototype,"horizontalResizeService",void 0),__decorate$1o([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$1o([PostConstruct],t.prototype,"postConstruct",null),t}(BeanStub),__extends$1r=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1n=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},SelectAllFeature=function(n){__extends$1r(t,n);function t(e){var r=n.call(this)||this;r.cbSelectAllVisible=!1,r.processingEventFromCheckbox=!1,r.column=e;var o=e.getColDef();return r.filteredOnly=!!(o!=null&&o.headerCheckboxSelectionFilteredOnly),r.currentPageOnly=!!(o!=null&&o.headerCheckboxSelectionCurrentPageOnly),r}return t.prototype.onSpaceKeyDown=function(e){var r=this.cbSelectAll,o=this.gridOptionsService.getDocument();r.isDisplayed()&&!r.getGui().contains(o.activeElement)&&(e.preventDefault(),r.setValue(!r.getValue()))},t.prototype.getCheckboxGui=function(){return this.cbSelectAll.getGui()},t.prototype.setComp=function(e){this.headerCellCtrl=e,this.cbSelectAll=this.createManagedBean(new AgCheckbox),this.cbSelectAll.addCssClass("ag-header-select-all"),setAriaRole(this.cbSelectAll.getGui(),"presentation"),this.showOrHideSelectAll(),this.addManagedListener(this.eventService,Events.EVENT_NEW_COLUMNS_LOADED,this.showOrHideSelectAll.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,this.showOrHideSelectAll.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_SELECTION_CHANGED,this.onSelectionChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_PAGINATION_CHANGED,this.onSelectionChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_MODEL_UPDATED,this.onModelChanged.bind(this)),this.addManagedListener(this.cbSelectAll,AgCheckbox.EVENT_CHANGED,this.onCbSelectAll.bind(this)),setAriaHidden(this.cbSelectAll.getGui(),!0),this.cbSelectAll.getInputElement().setAttribute("tabindex","-1"),this.refreshSelectAllLabel()},t.prototype.showOrHideSelectAll=function(){this.cbSelectAllVisible=this.isCheckboxSelection(),this.cbSelectAll.setDisplayed(this.cbSelectAllVisible,{skipAriaHidden:!0}),this.cbSelectAllVisible&&(this.checkRightRowModelType("selectAllCheckbox"),this.updateStateOfCheckbox()),this.refreshSelectAllLabel()},t.prototype.onModelChanged=function(){this.cbSelectAllVisible&&this.updateStateOfCheckbox()},t.prototype.onSelectionChanged=function(){this.cbSelectAllVisible&&this.updateStateOfCheckbox()},t.prototype.updateStateOfCheckbox=function(){if(!this.processingEventFromCheckbox){this.processingEventFromCheckbox=!0;var e=this.selectionService.getSelectAllState(this.filteredOnly,this.currentPageOnly);this.cbSelectAll.setValue(e),this.refreshSelectAllLabel(),this.processingEventFromCheckbox=!1}},t.prototype.refreshSelectAllLabel=function(){var e=this.localeService.getLocaleTextFunc(),r=this.cbSelectAll.getValue(),o=r?e("ariaChecked","checked"):e("ariaUnchecked","unchecked"),s=e("ariaRowSelectAll","Press Space to toggle all rows selection");this.cbSelectAllVisible?this.headerCellCtrl.setAriaDescriptionProperty("selectAll",s+" ("+o+")"):this.headerCellCtrl.setAriaDescriptionProperty("selectAll",null),this.cbSelectAll.setInputAriaLabel(s+" ("+o+")"),this.headerCellCtrl.refreshAriaDescription()},t.prototype.checkRightRowModelType=function(e){var r=this.rowModel.getType(),o=r==="clientSide"||r==="serverSide";return o?!0:(console.warn("AG Grid: "+e+" is only available if using 'clientSide' or 'serverSide' rowModelType, you are using "+r+"."),!1)},t.prototype.onCbSelectAll=function(){if(!this.processingEventFromCheckbox&&this.cbSelectAllVisible){var e=this.cbSelectAll.getValue(),r="uiSelectAll";this.currentPageOnly?r="uiSelectAllCurrentPage":this.filteredOnly&&(r="uiSelectAllFiltered");var o={source:r,justFiltered:this.filteredOnly,justCurrentPage:this.currentPageOnly};e?this.selectionService.selectAllRowNodes(o):this.selectionService.deselectAllRowNodes(o)}},t.prototype.isCheckboxSelection=function(){var e=this.column.getColDef().headerCheckboxSelection;if(typeof e=="function"){var r=e,o={column:this.column,colDef:this.column.getColDef(),columnApi:this.columnApi,api:this.gridApi,context:this.gridOptionsService.context};e=r(o)}return e?this.checkRightRowModelType("headerCheckboxSelection"):!1},__decorate$1n([Autowired("gridApi")],t.prototype,"gridApi",void 0),__decorate$1n([Autowired("columnApi")],t.prototype,"columnApi",void 0),__decorate$1n([Autowired("rowModel")],t.prototype,"rowModel",void 0),__decorate$1n([Autowired("selectionService")],t.prototype,"selectionService",void 0),t}(BeanStub),__extends$1q=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1m=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},TabGuardClassNames;(function(n){n.TAB_GUARD="ag-tab-guard",n.TAB_GUARD_TOP="ag-tab-guard-top",n.TAB_GUARD_BOTTOM="ag-tab-guard-bottom"})(TabGuardClassNames||(TabGuardClassNames={}));var TabGuardCtrl=function(n){__extends$1q(t,n);function t(e){var r=n.call(this)||this;r.skipTabGuardFocus=!1;var o=e.comp,s=e.eTopGuard,l=e.eBottomGuard,a=e.focusInnerElement,h=e.onFocusIn,y=e.onFocusOut,C=e.shouldStopEventPropagation,L=e.onTabKeyDown,Y=e.handleKeyDown,ze=e.eFocusableElement;return r.comp=o,r.eTopGuard=s,r.eBottomGuard=l,r.providedFocusInnerElement=a,r.eFocusableElement=ze,r.providedFocusIn=h,r.providedFocusOut=y,r.providedShouldStopEventPropagation=C,r.providedOnTabKeyDown=L,r.providedHandleKeyDown=Y,r}return t.prototype.postConstruct=function(){var e=this;this.createManagedBean(new ManagedFocusFeature(this.eFocusableElement,{shouldStopEventPropagation:function(){return e.shouldStopEventPropagation()},onTabKeyDown:function(r){return e.onTabKeyDown(r)},handleKeyDown:function(r){return e.handleKeyDown(r)},onFocusIn:function(r){return e.onFocusIn(r)},onFocusOut:function(r){return e.onFocusOut(r)}})),this.activateTabGuards(),[this.eTopGuard,this.eBottomGuard].forEach(function(r){return e.addManagedListener(r,"focus",e.onFocus.bind(e))})},t.prototype.handleKeyDown=function(e){this.providedHandleKeyDown&&this.providedHandleKeyDown(e)},t.prototype.tabGuardsAreActive=function(){return!!this.eTopGuard&&this.eTopGuard.hasAttribute("tabIndex")},t.prototype.shouldStopEventPropagation=function(){return this.providedShouldStopEventPropagation?this.providedShouldStopEventPropagation():!1},t.prototype.activateTabGuards=function(){var e=this.gridOptionsService.getNum("tabIndex")||0;this.comp.setTabIndex(e.toString())},t.prototype.deactivateTabGuards=function(){this.comp.setTabIndex()},t.prototype.onFocus=function(e){if(this.skipTabGuardFocus){this.skipTabGuardFocus=!1;return}var r=e.target===this.eBottomGuard;this.providedFocusInnerElement?this.providedFocusInnerElement(r):this.focusInnerElement(r)},t.prototype.onFocusIn=function(e){this.providedFocusIn&&this.providedFocusIn(e)||this.deactivateTabGuards()},t.prototype.onFocusOut=function(e){this.providedFocusOut&&this.providedFocusOut(e)||this.eFocusableElement.contains(e.relatedTarget)||this.activateTabGuards()},t.prototype.onTabKeyDown=function(e){var r=this;if(this.providedOnTabKeyDown){this.providedOnTabKeyDown(e);return}if(!e.defaultPrevented){var o=this.tabGuardsAreActive();o&&this.deactivateTabGuards();var s=this.getNextFocusableElement(e.shiftKey);o&&setTimeout(function(){return r.activateTabGuards()},0),s&&(s.focus(),e.preventDefault())}},t.prototype.focusInnerElement=function(e){e===void 0&&(e=!1);var r=this.focusService.findFocusableElements(this.eFocusableElement);this.tabGuardsAreActive()&&(r.splice(0,1),r.splice(r.length-1,1)),r.length&&r[e?r.length-1:0].focus({preventScroll:!0})},t.prototype.getNextFocusableElement=function(e){return this.focusService.findNextFocusableElement(this.eFocusableElement,!1,e)},t.prototype.forceFocusOutOfContainer=function(e){e===void 0&&(e=!1);var r=e?this.eTopGuard:this.eBottomGuard;this.activateTabGuards(),this.skipTabGuardFocus=!0,r.focus()},__decorate$1m([Autowired("focusService")],t.prototype,"focusService",void 0),__decorate$1m([PostConstruct],t.prototype,"postConstruct",null),t}(BeanStub),__extends$1p=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__assign$6=function(){return __assign$6=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},__assign$6.apply(this,arguments)},__decorate$1l=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__read$g=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray$e=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n},FocusService=function(n){__extends$1p(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}e=t,t.addKeyboardModeEvents=function(r,o){var s=e.instancesMonitored.get(r);s&&s.length>0?s.indexOf(o)===-1&&s.push(o):(e.instancesMonitored.set(r,[o]),r.addEventListener("keydown",e.toggleKeyboardMode),r.addEventListener("mousedown",e.toggleKeyboardMode))},t.removeKeyboardModeEvents=function(r,o){var s=e.instancesMonitored.get(r),l=[];s&&s.length&&(l=__spreadArray$e([],__read$g(s)).filter(function(a){return a!==o}),e.instancesMonitored.set(r,l)),l.length===0&&(r.removeEventListener("keydown",e.toggleKeyboardMode),r.removeEventListener("mousedown",e.toggleKeyboardMode))},t.toggleKeyboardMode=function(r){var o=e.keyboardModeActive,s=r.type==="keydown";if(!(s&&(r.ctrlKey||r.metaKey||r.altKey))&&!(o&&s||!o&&!s)){e.keyboardModeActive=s;var l=r.target.ownerDocument;if(l){var a=e.instancesMonitored.get(l);a&&a.forEach(function(h){h.dispatchEvent({type:s?Events.EVENT_KEYBOARD_FOCUS:Events.EVENT_MOUSE_FOCUS})})}}},t.prototype.init=function(){var r=this,o=this.clearFocusedCell.bind(this);this.addManagedListener(this.eventService,Events.EVENT_COLUMN_PIVOT_MODE_CHANGED,o),this.addManagedListener(this.eventService,Events.EVENT_NEW_COLUMNS_LOADED,this.onColumnEverythingChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_GROUP_OPENED,o),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_ROW_GROUP_CHANGED,o),this.ctrlsService.whenReady(function(s){r.gridCtrl=s.gridCtrl;var l=r.gridOptionsService.getDocument();e.addKeyboardModeEvents(l,r.gridCtrl),r.addDestroyFunc(function(){return r.unregisterGridCompController(r.gridCtrl)})})},t.prototype.unregisterGridCompController=function(r){var o=this.gridOptionsService.getDocument();e.removeKeyboardModeEvents(o,r)},t.prototype.onColumnEverythingChanged=function(){if(this.focusedCellPosition){var r=this.focusedCellPosition.column,o=this.columnModel.getGridColumn(r.getId());r!==o&&this.clearFocusedCell()}},t.prototype.isKeyboardMode=function(){return e.keyboardModeActive},t.prototype.getFocusCellToUseAfterRefresh=function(){var r=this.gridOptionsService.getDocument();return this.gridOptionsService.is("suppressFocusAfterRefresh")||!this.focusedCellPosition||this.isDomDataMissingInHierarchy(r.activeElement,RowCtrl.DOM_DATA_KEY_ROW_CTRL)?null:this.focusedCellPosition},t.prototype.getFocusHeaderToUseAfterRefresh=function(){var r=this.gridOptionsService.getDocument();return this.gridOptionsService.is("suppressFocusAfterRefresh")||!this.focusedHeaderPosition||this.isDomDataMissingInHierarchy(r.activeElement,AbstractHeaderCellCtrl.DOM_DATA_KEY_HEADER_CTRL)?null:this.focusedHeaderPosition},t.prototype.isDomDataMissingInHierarchy=function(r,o){for(var s=r;s;){var l=this.gridOptionsService.getDomData(s,o);if(l)return!1;s=s.parentNode}return!0},t.prototype.getFocusedCell=function(){return this.focusedCellPosition},t.prototype.shouldRestoreFocus=function(r){var o=this;return this.isCellRestoreFocused(r)?(setTimeout(function(){o.restoredFocusedCellPosition=null},0),!0):!1},t.prototype.isCellRestoreFocused=function(r){return this.restoredFocusedCellPosition==null?!1:this.cellPositionUtils.equals(r,this.restoredFocusedCellPosition)},t.prototype.setRestoreFocusedCell=function(r){this.getFrameworkOverrides().renderingEngine==="react"&&(this.restoredFocusedCellPosition=r)},t.prototype.getFocusEventParams=function(){var r=this.focusedCellPosition,o=r.rowIndex,s=r.rowPinned,l=r.column,a={rowIndex:o,rowPinned:s,column:l,isFullWidthCell:!1},h=this.rowRenderer.getRowByPosition({rowIndex:o,rowPinned:s});return h&&(a.isFullWidthCell=h.isFullWidth()),a},t.prototype.clearFocusedCell=function(){if(this.restoredFocusedCellPosition=null,this.focusedCellPosition!=null){var r=__assign$6({type:Events.EVENT_CELL_FOCUS_CLEARED},this.getFocusEventParams());this.focusedCellPosition=null,this.eventService.dispatchEvent(r)}},t.prototype.setFocusedCell=function(r){var o=r.column,s=r.rowIndex,l=r.rowPinned,a=r.forceBrowserFocus,h=a===void 0?!1:a,y=r.preventScrollOnBrowserFocus,C=y===void 0?!1:y,L=this.columnModel.getGridColumn(o);if(!L){this.focusedCellPosition=null;return}this.focusedCellPosition=L?{rowIndex:s,rowPinned:makeNull(l),column:L}:null;var Y=__assign$6(__assign$6({type:Events.EVENT_CELL_FOCUSED},this.getFocusEventParams()),{forceBrowserFocus:h,preventScrollOnBrowserFocus:C,floating:null});this.eventService.dispatchEvent(Y)},t.prototype.isCellFocused=function(r){return this.focusedCellPosition==null?!1:this.cellPositionUtils.equals(r,this.focusedCellPosition)},t.prototype.isRowNodeFocused=function(r){return this.isRowFocused(r.rowIndex,r.rowPinned)},t.prototype.isHeaderWrapperFocused=function(r){if(this.focusedHeaderPosition==null)return!1;var o=r.getColumnGroupChild(),s=r.getRowIndex(),l=r.getPinned(),a=this.focusedHeaderPosition,h=a.column,y=a.headerRowIndex;return o===h&&s===y&&l==h.getPinned()},t.prototype.clearFocusedHeader=function(){this.focusedHeaderPosition=null},t.prototype.getFocusedHeader=function(){return this.focusedHeaderPosition},t.prototype.setFocusedHeader=function(r,o){this.focusedHeaderPosition={headerRowIndex:r,column:o}},t.prototype.focusHeaderPosition=function(r){var o=r.direction,s=r.fromTab,l=r.allowUserOverride,a=r.event,h=r.headerPosition;if(l){var y=this.getFocusedHeader(),C=this.headerNavigationService.getHeaderRowCount();if(s){var L=this.gridOptionsService.getCallback("tabToNextHeader");if(L){var Y={backwards:o==="Before",previousHeaderPosition:y,nextHeaderPosition:h,headerRowCount:C};h=L(Y)}}else{var L=this.gridOptionsService.getCallback("navigateToNextHeader");if(L&&a){var ze={key:a.key,previousHeaderPosition:y,nextHeaderPosition:h,headerRowCount:C,event:a};h=L(ze)}}}if(!h)return!1;if(h.headerRowIndex===-1)return this.focusGridView(h.column);this.headerNavigationService.scrollToColumn(h.column,o);var Bt=this.ctrlsService.getHeaderRowContainerCtrl(h.column.getPinned()),Ir=Bt.focusHeader(h.headerRowIndex,h.column,a);return Ir},t.prototype.focusFirstHeader=function(){var r=this.columnModel.getAllDisplayedColumns()[0];return r?(r.getParent()&&(r=this.columnModel.getColumnGroupAtLevel(r,0)),this.focusHeaderPosition({headerPosition:{headerRowIndex:0,column:r}})):!1},t.prototype.focusLastHeader=function(r){var o=this.headerNavigationService.getHeaderRowCount()-1,s=last(this.columnModel.getAllDisplayedColumns());return this.focusHeaderPosition({headerPosition:{headerRowIndex:o,column:s},event:r})},t.prototype.isAnyCellFocused=function(){return!!this.focusedCellPosition},t.prototype.isRowFocused=function(r,o){return this.focusedCellPosition==null?!1:this.focusedCellPosition.rowIndex===r&&this.focusedCellPosition.rowPinned===makeNull(o)},t.prototype.findFocusableElements=function(r,o,s){s===void 0&&(s=!1);var l=FOCUSABLE_SELECTOR,a=FOCUSABLE_EXCLUDE;o&&(a+=", "+o),s&&(a+=', [tabindex="-1"]');var h=Array.prototype.slice.apply(r.querySelectorAll(l)),y=Array.prototype.slice.apply(r.querySelectorAll(a));if(!y.length)return h;var C=function(L,Y){return L.filter(function(ze){return Y.indexOf(ze)===-1})};return C(h,y)},t.prototype.focusInto=function(r,o,s){o===void 0&&(o=!1),s===void 0&&(s=!1);var l=this.findFocusableElements(r,null,s),a=o?last(l):l[0];return a?(a.focus({preventScroll:!0}),!0):!1},t.prototype.findFocusableElementBeforeTabGuard=function(r,o){if(!o)return null;var s=this.findFocusableElements(r),l=s.indexOf(o);if(l===-1)return null;for(var a=-1,h=l-1;h>=0;h--)if(s[h].classList.contains(TabGuardClassNames.TAB_GUARD_TOP)){a=h;break}return a<=0?null:s[a-1]},t.prototype.findNextFocusableElement=function(r,o,s){r===void 0&&(r=this.eGridDiv);var l=this.findFocusableElements(r,o?':not([tabindex="-1"])':null),a=this.gridOptionsService.getDocument(),h=a.activeElement,y;o?y=l.findIndex(function(L){return L.contains(h)}):y=l.indexOf(h);var C=y+(s?-1:1);return C<0||C>=l.length?null:l[C]},t.prototype.isTargetUnderManagedComponent=function(r,o){if(!o)return!1;var s=r.querySelectorAll("."+ManagedFocusFeature.FOCUS_MANAGED_CLASS);if(!s.length)return!1;for(var l=0;l<s.length;l++)if(s[l].contains(o))return!0;return!1},t.prototype.findTabbableParent=function(r,o){o===void 0&&(o=5);for(var s=0;r&&getTabIndex(r)===null&&++s<=o;)r=r.parentElement;return getTabIndex(r)===null?null:r},t.prototype.focusGridView=function(r,o){if(this.gridOptionsService.is("suppressCellFocus"))return o?this.focusLastHeader():this.focusNextGridCoreContainer(!1);var s=o?this.rowPositionUtils.getLastRow():this.rowPositionUtils.getFirstRow();if(!s)return!1;var l=s.rowIndex,a=s.rowPinned,h=this.getFocusedHeader();if(!r&&h&&(r=h.column),l==null||!r)return!1;if(this.navigationService.ensureCellVisible({rowIndex:l,column:r,rowPinned:a}),this.setFocusedCell({rowIndex:l,column:r,rowPinned:makeNull(a),forceBrowserFocus:!0}),this.rangeService){var y={rowIndex:l,rowPinned:a,column:r};this.rangeService.setRangeToCell(y)}return!0},t.prototype.focusNextGridCoreContainer=function(r,o){return o===void 0&&(o=!1),!o&&this.gridCtrl.focusNextInnerContainer(r)?!0:((o||!r&&!this.gridCtrl.isDetailGrid())&&this.gridCtrl.forceFocusOutOfContainer(r),!1)};var e;return t.AG_KEYBOARD_FOCUS="ag-keyboard-focus",t.keyboardModeActive=!1,t.instancesMonitored=new Map,__decorate$1l([Autowired("eGridDiv")],t.prototype,"eGridDiv",void 0),__decorate$1l([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$1l([Autowired("headerNavigationService")],t.prototype,"headerNavigationService",void 0),__decorate$1l([Autowired("rowRenderer")],t.prototype,"rowRenderer",void 0),__decorate$1l([Autowired("rowPositionUtils")],t.prototype,"rowPositionUtils",void 0),__decorate$1l([Autowired("cellPositionUtils")],t.prototype,"cellPositionUtils",void 0),__decorate$1l([Optional("rangeService")],t.prototype,"rangeService",void 0),__decorate$1l([Autowired("navigationService")],t.prototype,"navigationService",void 0),__decorate$1l([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),__decorate$1l([PostConstruct],t.prototype,"init",null),t=e=__decorate$1l([Bean("focusService")],t),t}(BeanStub),__extends$1o=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1k=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},HeaderCellCtrl=function(n){__extends$1o(t,n);function t(e,r){var o=n.call(this,e,r)||this;return o.refreshFunctions=[],o.userHeaderClasses=new Set,o.ariaDescriptionProperties=new Map,o.column=e,o}return t.prototype.setComp=function(e,r,o,s){var l=this;n.prototype.setGui.call(this,r),this.comp=e,this.updateState(),this.setupWidth(),this.setupMovingCss(),this.setupMenuClass(),this.setupSortableClass(),this.setupWrapTextClass(),this.refreshSpanHeaderHeight(),this.setupAutoHeight(s),this.addColumnHoverListener(),this.setupFilterCss(),this.setupColId(),this.setupClassesFromColDef(),this.setupTooltip(),this.addActiveHeaderMouseListeners(),this.setupSelectAll(),this.setupUserComp(),this.refreshAria(),this.createManagedBean(new ResizeFeature(this.getPinned(),this.column,o,e,this)),this.createManagedBean(new HoverFeature([this.column],r)),this.createManagedBean(new SetLeftFeature(this.column,r,this.beans)),this.createManagedBean(new ManagedFocusFeature(r,{shouldStopEventPropagation:function(a){return l.shouldStopEventPropagation(a)},onTabKeyDown:function(){return null},handleKeyDown:this.handleKeyDown.bind(this),onFocusIn:this.onFocusIn.bind(this),onFocusOut:this.onFocusOut.bind(this)})),this.addMouseDownListenerIfNeeded(r),this.addManagedListener(this.column,Column.EVENT_COL_DEF_CHANGED,this.onColDefChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_VALUE_CHANGED,this.onColumnValueChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_ROW_GROUP_CHANGED,this.onColumnRowGroupChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_PIVOT_CHANGED,this.onColumnPivotChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_HEADER_HEIGHT_CHANGED,this.onHeaderHeightChanged.bind(this))},t.prototype.addMouseDownListenerIfNeeded=function(e){var r=this;if(isBrowserSafari()){var o=["mousedown","touchstart"],s=this.gridOptionsService.getDocument();o.forEach(function(l){r.addManagedListener(e,l,function(a){var h=s.activeElement;h!==e&&!e.contains(h)&&(e.focus(),FocusService.toggleKeyboardMode(a))})})}},t.prototype.setupUserComp=function(){var e=this.lookupUserCompDetails();this.setCompDetails(e)},t.prototype.setCompDetails=function(e){this.userCompDetails=e,this.comp.setUserCompDetails(e)},t.prototype.lookupUserCompDetails=function(){var e=this.createParams(),r=this.column.getColDef();return this.userComponentFactory.getHeaderCompDetails(r,e)},t.prototype.createParams=function(){var e=this,r=this.column.getColDef(),o={column:this.column,displayName:this.displayName,enableSorting:r.sortable,enableMenu:this.menuEnabled,showColumnMenu:function(s){e.gridApi.showColumnMenuAfterButtonClick(e.column,s)},progressSort:function(s){e.sortController.progressSort(e.column,!!s,"uiColumnSorted")},setSort:function(s,l){e.sortController.setSortForColumn(e.column,s,!!l,"uiColumnSorted")},api:this.gridApi,columnApi:this.columnApi,context:this.gridOptionsService.context,eGridHeader:this.getGui()};return o},t.prototype.setupSelectAll=function(){this.selectAllFeature=this.createManagedBean(new SelectAllFeature(this.column)),this.selectAllFeature.setComp(this)},t.prototype.getSelectAllGui=function(){return this.selectAllFeature.getCheckboxGui()},t.prototype.handleKeyDown=function(e){n.prototype.handleKeyDown.call(this,e),e.key===KeyCode.SPACE&&this.selectAllFeature.onSpaceKeyDown(e),e.key===KeyCode.ENTER&&this.onEnterKeyDown(e)},t.prototype.onEnterKeyDown=function(e){var r=this.comp.getUserCompInstance();if(r){if(e.ctrlKey||e.metaKey)this.menuEnabled&&r.showMenu&&(e.preventDefault(),r.showMenu());else if(this.sortable){var o=e.shiftKey;this.sortController.progressSort(this.column,o,"uiColumnSorted")}}},t.prototype.isMenuEnabled=function(){return this.menuEnabled},t.prototype.onFocusIn=function(e){if(!this.getGui().contains(e.relatedTarget)){var r=this.getRowIndex();this.focusService.setFocusedHeader(r,this.column)}this.setActiveHeader(!0)},t.prototype.onFocusOut=function(e){this.getGui().contains(e.relatedTarget)||this.setActiveHeader(!1)},t.prototype.setupTooltip=function(){var e=this,r={getColumn:function(){return e.column},getColDef:function(){return e.column.getColDef()},getGui:function(){return e.eGui},getLocation:function(){return"header"},getTooltipValue:function(){var s=e.column.getColDef().headerTooltip;return s}},o=this.createManagedBean(new TooltipFeature(r,this.beans));o.setComp(this.comp),this.refreshFunctions.push(function(){return o.refreshToolTip()})},t.prototype.setupClassesFromColDef=function(){var e=this,r=function(){var o=e.column.getColDef(),s=CssClassApplier.getHeaderClassesFromColDef(o,e.gridOptionsService,e.column,null),l=e.userHeaderClasses;e.userHeaderClasses=new Set(s),s.forEach(function(a){l.has(a)?l.delete(a):e.comp.addOrRemoveCssClass(a,!0)}),l.forEach(function(a){return e.comp.addOrRemoveCssClass(a,!1)})};this.refreshFunctions.push(r),r()},t.prototype.setDragSource=function(e){var r=this;if(this.dragSourceElement=e,this.removeDragSource(),!!e&&this.draggable){var o=!this.gridOptionsService.is("suppressDragLeaveHidesColumns");this.moveDragSource={type:DragSourceType.HeaderCell,eElement:e,defaultIconName:o?DragAndDropService.ICON_HIDE:DragAndDropService.ICON_NOT_ALLOWED,getDragItem:function(){return r.createDragItem()},dragItemName:this.displayName,onDragStarted:function(){return r.column.setMoving(!0,"uiColumnMoved")},onDragStopped:function(){return r.column.setMoving(!1,"uiColumnMoved")},onGridEnter:function(s){var l;if(o){var a=((l=s==null?void 0:s.columns)===null||l===void 0?void 0:l.filter(function(h){return!h.getColDef().lockVisible}))||[];r.columnModel.setColumnsVisible(a,!0,"uiColumnMoved")}},onGridExit:function(s){var l;if(o){var a=((l=s==null?void 0:s.columns)===null||l===void 0?void 0:l.filter(function(h){return!h.getColDef().lockVisible}))||[];r.columnModel.setColumnsVisible(a,!1,"uiColumnMoved")}}},this.dragAndDropService.addDragSource(this.moveDragSource,!0)}},t.prototype.createDragItem=function(){var e={};return e[this.column.getId()]=this.column.isVisible(),{columns:[this.column],visibleState:e}},t.prototype.removeDragSource=function(){this.moveDragSource&&(this.dragAndDropService.removeDragSource(this.moveDragSource),this.moveDragSource=void 0)},t.prototype.onColDefChanged=function(){this.refresh()},t.prototype.updateState=function(){var e=this.column.getColDef();this.menuEnabled=this.menuFactory.isMenuEnabled(this.column)&&!e.suppressMenu,this.sortable=e.sortable,this.displayName=this.calculateDisplayName(),this.draggable=this.workOutDraggable()},t.prototype.addRefreshFunction=function(e){this.refreshFunctions.push(e)},t.prototype.refresh=function(){this.updateState(),this.refreshHeaderComp(),this.refreshAria(),this.refreshFunctions.forEach(function(e){return e()})},t.prototype.refreshHeaderComp=function(){var e=this.lookupUserCompDetails(),r=this.comp.getUserCompInstance(),o=r!=null&&this.userCompDetails.componentClass==e.componentClass,s=o?this.attemptHeaderCompRefresh(e.params):!1;s?this.setDragSource(this.dragSourceElement):this.setCompDetails(e)},t.prototype.attemptHeaderCompRefresh=function(e){var r=this.comp.getUserCompInstance();if(!r||!r.refresh)return!1;var o=r.refresh(e);return o},t.prototype.calculateDisplayName=function(){return this.columnModel.getDisplayNameForColumn(this.column,"header",!0)},t.prototype.checkDisplayName=function(){this.displayName!==this.calculateDisplayName()&&this.refresh()},t.prototype.workOutDraggable=function(){var e=this.column.getColDef(),r=this.gridOptionsService.is("suppressMovableColumns"),o=!r&&!e.suppressMovable&&!e.lockPosition;return!!o||!!e.enableRowGroup||!!e.enablePivot},t.prototype.onColumnRowGroupChanged=function(){this.checkDisplayName()},t.prototype.onColumnPivotChanged=function(){this.checkDisplayName()},t.prototype.onColumnValueChanged=function(){this.checkDisplayName()},t.prototype.setupWidth=function(){var e=this,r=function(){var o=e.column.getActualWidth();e.comp.setWidth(o+"px")};this.addManagedListener(this.column,Column.EVENT_WIDTH_CHANGED,r),r()},t.prototype.setupMovingCss=function(){var e=this,r=function(){e.comp.addOrRemoveCssClass("ag-header-cell-moving",e.column.isMoving())};this.addManagedListener(this.column,Column.EVENT_MOVING_CHANGED,r),r()},t.prototype.setupMenuClass=function(){var e=this,r=function(){e.comp.addOrRemoveCssClass("ag-column-menu-visible",e.column.isMenuVisible())};this.addManagedListener(this.column,Column.EVENT_MENU_VISIBLE_CHANGED,r),r()},t.prototype.setupSortableClass=function(){var e=this,r=function(){e.comp.addOrRemoveCssClass("ag-header-cell-sortable",!!e.sortable)};r(),this.addRefreshFunction(r),this.addManagedListener(this.eventService,Column.EVENT_SORT_CHANGED,this.refreshAriaSort.bind(this))},t.prototype.setupWrapTextClass=function(){var e=this,r=function(){var o=!!e.column.getColDef().wrapHeaderText;e.comp.addOrRemoveCssClass("ag-header-cell-wrap-text",o)};r(),this.addRefreshFunction(r)},t.prototype.onHeaderHeightChanged=function(){this.refreshSpanHeaderHeight()},t.prototype.refreshSpanHeaderHeight=function(){var e=this,r=e.eGui,o=e.column,s=e.comp,l=e.columnModel,a=e.gridOptionsService;if(o.isSpanHeaderHeight()){var h=this.getColumnGroupPaddingInfo(),y=h.numberOfParents,C=h.isSpanningTotal;if(s.addOrRemoveCssClass("ag-header-span-height",y>0),y!==0){s.addOrRemoveCssClass("ag-header-span-total",C);var L=a.is("pivotMode"),Y=L?l.getPivotGroupHeaderHeight():l.getGroupHeaderHeight(),ze=l.getColumnHeaderRowHeight(),Bt=y*Y;r.style.setProperty("top",-Bt+"px"),r.style.setProperty("height",ze+Bt+"px")}}},t.prototype.getColumnGroupPaddingInfo=function(){var e=this.column.getParent();if(!e||!e.isPadding())return{numberOfParents:0,isSpanningTotal:!1};for(var r=e.getPaddingLevel()+1,o=!0;e;){if(!e.isPadding()){o=!1;break}e=e.getParent()}return{numberOfParents:r,isSpanningTotal:o}},t.prototype.setupAutoHeight=function(e){var r=this,o=function(C){if(r.isAlive()){var L=getElementSize(r.getGui()),Y=L.paddingTop,ze=L.paddingBottom,Bt=L.borderBottomWidth,Ir=L.borderTopWidth,Wr=Y+ze+Bt+Ir,yi=e.offsetHeight,Bn=yi+Wr;if(C<5){var vi=r.beans.gridOptionsService.getDocument(),wo=!vi||!vi.contains(e),ia=Bn==0;if(wo||ia){r.beans.frameworkOverrides.setTimeout(function(){return o(C+1)},0);return}}r.columnModel.setColumnHeaderHeight(r.column,Bn)}},s=!1,l,a=function(){var C=r.column.isAutoHeaderHeight();C&&!s&&h(),!C&&s&&y()},h=function(){s=!0,o(0),r.comp.addOrRemoveCssClass("ag-header-cell-auto-height",!0),l=r.resizeObserverService.observeResize(e,function(){return o(0)})},y=function(){s=!1,l&&l(),r.comp.addOrRemoveCssClass("ag-header-cell-auto-height",!1),l=void 0};a(),this.addDestroyFunc(function(){return y()}),this.addManagedListener(this.column,Column.EVENT_WIDTH_CHANGED,function(){return s&&o(0)}),this.addManagedListener(this.eventService,Column.EVENT_SORT_CHANGED,function(){s&&r.beans.frameworkOverrides.setTimeout(function(){return o(0)})}),this.addRefreshFunction(a)},t.prototype.refreshAriaSort=function(){if(this.sortable){var e=this.localeService.getLocaleTextFunc(),r=this.sortController.getDisplaySortForColumn(this.column)||null;this.comp.setAriaSort(getAriaSortState(r)),this.setAriaDescriptionProperty("sort",e("ariaSortableColumn","Press ENTER to sort."))}else this.comp.setAriaSort(),this.setAriaDescriptionProperty("sort",null)},t.prototype.refreshAriaMenu=function(){if(this.menuEnabled){var e=this.localeService.getLocaleTextFunc();this.setAriaDescriptionProperty("menu",e("ariaMenuColumn","Press CTRL ENTER to open column menu."))}else this.setAriaDescriptionProperty("menu",null)},t.prototype.setAriaDescriptionProperty=function(e,r){r!=null?this.ariaDescriptionProperties.set(e,r):this.ariaDescriptionProperties.delete(e)},t.prototype.refreshAriaDescription=function(){var e=Array.from(this.ariaDescriptionProperties.values());this.comp.setAriaDescription(e.length?e.join(" "):void 0)},t.prototype.refreshAria=function(){this.refreshAriaSort(),this.refreshAriaMenu(),this.refreshAriaDescription()},t.prototype.addColumnHoverListener=function(){var e=this,r=function(){if(e.gridOptionsService.is("columnHoverHighlight")){var o=e.columnHoverService.isHovered(e.column);e.comp.addOrRemoveCssClass("ag-column-hover",o)}};this.addManagedListener(this.eventService,Events.EVENT_COLUMN_HOVER_CHANGED,r),r()},t.prototype.setupFilterCss=function(){var e=this,r=function(){e.comp.addOrRemoveCssClass("ag-header-cell-filtered",e.column.isFilterActive())};this.addManagedListener(this.column,Column.EVENT_FILTER_ACTIVE_CHANGED,r),r()},t.prototype.setupColId=function(){this.comp.setColId(this.column.getColId())},t.prototype.addActiveHeaderMouseListeners=function(){var e=this,r=function(o){return e.setActiveHeader(o.type==="mouseenter")};this.addManagedListener(this.getGui(),"mouseenter",r),this.addManagedListener(this.getGui(),"mouseleave",r)},t.prototype.setActiveHeader=function(e){this.comp.addOrRemoveCssClass("ag-header-active",e)},__decorate$1k([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$1k([Autowired("columnHoverService")],t.prototype,"columnHoverService",void 0),__decorate$1k([Autowired("sortController")],t.prototype,"sortController",void 0),__decorate$1k([Autowired("menuFactory")],t.prototype,"menuFactory",void 0),__decorate$1k([Autowired("dragAndDropService")],t.prototype,"dragAndDropService",void 0),__decorate$1k([Autowired("resizeObserverService")],t.prototype,"resizeObserverService",void 0),__decorate$1k([Autowired("gridApi")],t.prototype,"gridApi",void 0),__decorate$1k([Autowired("columnApi")],t.prototype,"columnApi",void 0),__decorate$1k([PreDestroy],t.prototype,"removeDragSource",null),t}(AbstractHeaderCellCtrl),__extends$1n=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1j=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},GroupResizeFeature=function(n){__extends$1n(t,n);function t(e,r,o,s){var l=n.call(this)||this;return l.eResize=r,l.comp=e,l.pinned=o,l.columnGroup=s,l}return t.prototype.postConstruct=function(){var e=this;if(!this.columnGroup.isResizable()){this.comp.setResizableDisplayed(!1);return}var r=this.horizontalResizeService.addResizeBar({eResizeBar:this.eResize,onResizeStart:this.onResizeStart.bind(this),onResizing:this.onResizing.bind(this,!1),onResizeEnd:this.onResizing.bind(this,!0)});if(this.addDestroyFunc(r),!this.gridOptionsService.is("suppressAutoSize")){var o=this.gridOptionsService.is("skipHeaderOnAutoSize");this.eResize.addEventListener("dblclick",function(){var s=[],l=e.columnGroup.getDisplayedLeafColumns();l.forEach(function(a){a.getColDef().suppressAutoSize||s.push(a.getColId())}),s.length>0&&e.columnModel.autoSizeColumns({columns:s,skipHeader:o,stopAtGroup:e.columnGroup,source:"uiColumnResized"}),e.resizeLeafColumnsToFit("uiColumnResized")})}},t.prototype.onResizeStart=function(e){var r=this;this.calculateInitialValues();var o=null;if(e&&(o=this.columnModel.getDisplayedGroupAfter(this.columnGroup)),o){var s=o.getDisplayedLeafColumns();this.resizeTakeFromCols=s.filter(function(l){return l.isResizable()}),this.resizeTakeFromStartWidth=0,this.resizeTakeFromCols.forEach(function(l){return r.resizeTakeFromStartWidth+=l.getActualWidth()}),this.resizeTakeFromRatios=[],this.resizeTakeFromCols.forEach(function(l){return r.resizeTakeFromRatios.push(l.getActualWidth()/r.resizeTakeFromStartWidth)})}else this.resizeTakeFromCols=null,this.resizeTakeFromStartWidth=null,this.resizeTakeFromRatios=null;this.comp.addOrRemoveCssClass("ag-column-resizing",!0)},t.prototype.onResizing=function(e,r,o){o===void 0&&(o="uiColumnResized");var s=this.normaliseDragChange(r),l=this.resizeStartWidth+s;this.resizeColumns(l,o,e)},t.prototype.resizeLeafColumnsToFit=function(e){var r=this.autoWidthCalculator.getPreferredWidthForColumnGroup(this.columnGroup);this.calculateInitialValues(),r>this.resizeStartWidth&&this.resizeColumns(r,e,!0)},t.prototype.resizeColumns=function(e,r,o){o===void 0&&(o=!0);var s=[];if(s.push({columns:this.resizeCols,ratios:this.resizeRatios,width:e}),this.resizeTakeFromCols){var l=e-this.resizeStartWidth;s.push({columns:this.resizeTakeFromCols,ratios:this.resizeTakeFromRatios,width:this.resizeTakeFromStartWidth-l})}this.columnModel.resizeColumnSets({resizeSets:s,finished:o,source:r}),o&&this.comp.addOrRemoveCssClass("ag-column-resizing",!1)},t.prototype.calculateInitialValues=function(){var e=this,r=this.columnGroup.getDisplayedLeafColumns();this.resizeCols=r.filter(function(o){return o.isResizable()}),this.resizeStartWidth=0,this.resizeCols.forEach(function(o){return e.resizeStartWidth+=o.getActualWidth()}),this.resizeRatios=[],this.resizeCols.forEach(function(o){return e.resizeRatios.push(o.getActualWidth()/e.resizeStartWidth)})},t.prototype.normaliseDragChange=function(e){var r=e;return this.gridOptionsService.is("enableRtl")?this.pinned!=="left"&&(r*=-1):this.pinned==="right"&&(r*=-1),r},__decorate$1j([Autowired("horizontalResizeService")],t.prototype,"horizontalResizeService",void 0),__decorate$1j([Autowired("autoWidthCalculator")],t.prototype,"autoWidthCalculator",void 0),__decorate$1j([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$1j([PostConstruct],t.prototype,"postConstruct",null),t}(BeanStub),__extends$1m=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1i=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},GroupWidthFeature=function(n){__extends$1m(t,n);function t(e,r){var o=n.call(this)||this;return o.removeChildListenersFuncs=[],o.columnGroup=r,o.comp=e,o}return t.prototype.postConstruct=function(){this.addListenersToChildrenColumns(),this.addManagedListener(this.columnGroup,ColumnGroup.EVENT_DISPLAYED_CHILDREN_CHANGED,this.onDisplayedChildrenChanged.bind(this)),this.onWidthChanged(),this.addDestroyFunc(this.removeListenersOnChildrenColumns.bind(this))},t.prototype.addListenersToChildrenColumns=function(){var e=this;this.removeListenersOnChildrenColumns();var r=this.onWidthChanged.bind(this);this.columnGroup.getLeafColumns().forEach(function(o){o.addEventListener("widthChanged",r),o.addEventListener("visibleChanged",r),e.removeChildListenersFuncs.push(function(){o.removeEventListener("widthChanged",r),o.removeEventListener("visibleChanged",r)})})},t.prototype.removeListenersOnChildrenColumns=function(){this.removeChildListenersFuncs.forEach(function(e){return e()}),this.removeChildListenersFuncs=[]},t.prototype.onDisplayedChildrenChanged=function(){this.addListenersToChildrenColumns(),this.onWidthChanged()},t.prototype.onWidthChanged=function(){var e=this.columnGroup.getActualWidth();this.comp.setWidth(e+"px"),this.comp.addOrRemoveCssClass("ag-hidden",e===0)},__decorate$1i([PostConstruct],t.prototype,"postConstruct",null),t}(BeanStub),__extends$1l=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1h=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},HeaderGroupCellCtrl=function(n){__extends$1l(t,n);function t(e,r){var o=n.call(this,e,r)||this;return o.columnGroup=e,o}return t.prototype.setComp=function(e,r,o){n.prototype.setGui.call(this,r),this.comp=e,this.displayName=this.columnModel.getDisplayNameForColumnGroup(this.columnGroup,"header"),this.addClasses(),this.addAttributes(),this.setupMovingCss(),this.setupExpandable(),this.setupTooltip(),this.setupUserComp();var s=this.getParentRowCtrl().getPinned(),l=this.columnGroup.getProvidedColumnGroup().getLeafColumns();this.createManagedBean(new HoverFeature(l,r)),this.createManagedBean(new SetLeftFeature(this.columnGroup,r,this.beans)),this.createManagedBean(new GroupWidthFeature(e,this.columnGroup)),this.groupResizeFeature=this.createManagedBean(new GroupResizeFeature(e,o,s,this.columnGroup)),this.createManagedBean(new ManagedFocusFeature(r,{shouldStopEventPropagation:this.shouldStopEventPropagation.bind(this),onTabKeyDown:function(){},handleKeyDown:this.handleKeyDown.bind(this),onFocusIn:this.onFocusIn.bind(this)}))},t.prototype.resizeLeafColumnsToFit=function(e){this.groupResizeFeature&&this.groupResizeFeature.resizeLeafColumnsToFit(e)},t.prototype.setupUserComp=function(){var e=this,r=this.displayName,o={displayName:this.displayName,columnGroup:this.columnGroup,setExpanded:function(y){e.columnModel.setColumnGroupOpened(e.columnGroup.getProvidedColumnGroup(),y,"gridInitializing")},api:this.gridApi,columnApi:this.columnApi,context:this.gridOptionsService.context};if(!r){for(var s=this.columnGroup,l=s.getLeafColumns();s.getParent()&&s.getParent().getLeafColumns().length===l.length;)s=s.getParent();var a=s.getColGroupDef();a&&(r=a.headerName),r||(r=l?this.columnModel.getDisplayNameForColumn(l[0],"header",!0):"")}var h=this.userComponentFactory.getHeaderGroupCompDetails(o);this.comp.setUserCompDetails(h)},t.prototype.setupTooltip=function(){var e=this,r=this.columnGroup.getColGroupDef(),o={getColumn:function(){return e.columnGroup},getGui:function(){return e.eGui},getLocation:function(){return"headerGroup"},getTooltipValue:function(){return r&&r.headerTooltip}};r&&(o.getColDef=function(){return r});var s=this.createManagedBean(new TooltipFeature(o,this.beans));s.setComp(this.comp)},t.prototype.setupExpandable=function(){var e=this.columnGroup.getProvidedColumnGroup();this.refreshExpanded(),this.addManagedListener(e,ProvidedColumnGroup.EVENT_EXPANDABLE_CHANGED,this.refreshExpanded.bind(this)),this.addManagedListener(e,ProvidedColumnGroup.EVENT_EXPANDED_CHANGED,this.refreshExpanded.bind(this))},t.prototype.refreshExpanded=function(){var e=this.columnGroup;this.expandable=e.isExpandable();var r=e.isExpanded();this.expandable?this.comp.setAriaExpanded(r?"true":"false"):this.comp.setAriaExpanded(void 0)},t.prototype.addAttributes=function(){this.comp.setColId(this.columnGroup.getUniqueId())},t.prototype.addClasses=function(){var e=this,r=this.columnGroup.getColGroupDef(),o=CssClassApplier.getHeaderClassesFromColDef(r,this.gridOptionsService,null,this.columnGroup);if(this.columnGroup.isPadding()){o.push("ag-header-group-cell-no-group");var s=this.columnGroup.getLeafColumns();s.every(function(l){return l.isSpanHeaderHeight()})&&o.push("ag-header-span-height")}else o.push("ag-header-group-cell-with-group");o.forEach(function(l){return e.comp.addOrRemoveCssClass(l,!0)})},t.prototype.setupMovingCss=function(){var e=this,r=this.columnGroup.getProvidedColumnGroup(),o=r.getLeafColumns(),s=function(){return e.comp.addOrRemoveCssClass("ag-header-cell-moving",e.columnGroup.isMoving())};o.forEach(function(l){e.addManagedListener(l,Column.EVENT_MOVING_CHANGED,s)}),s()},t.prototype.onFocusIn=function(e){if(!this.eGui.contains(e.relatedTarget)){var r=this.getRowIndex();this.beans.focusService.setFocusedHeader(r,this.columnGroup)}},t.prototype.handleKeyDown=function(e){n.prototype.handleKeyDown.call(this,e);var r=this.getWrapperHasFocus();if(!(!this.expandable||!r)&&e.key===KeyCode.ENTER){var o=this.columnGroup,s=!o.isExpanded();this.columnModel.setColumnGroupOpened(o.getProvidedColumnGroup(),s,"uiColumnExpanded")}},t.prototype.setDragSource=function(e){var r=this;if(!this.isSuppressMoving()){var o=this.columnGroup.getProvidedColumnGroup().getLeafColumns(),s=!this.gridOptionsService.is("suppressDragLeaveHidesColumns"),l={type:DragSourceType.HeaderCell,eElement:e,defaultIconName:s?DragAndDropService.ICON_HIDE:DragAndDropService.ICON_NOT_ALLOWED,dragItemName:this.displayName,getDragItem:this.getDragItemForGroup.bind(this),onDragStarted:function(){return o.forEach(function(a){return a.setMoving(!0,"uiColumnDragged")})},onDragStopped:function(){return o.forEach(function(a){return a.setMoving(!1,"uiColumnDragged")})},onGridEnter:function(a){var h;if(s){var y=((h=a==null?void 0:a.columns)===null||h===void 0?void 0:h.filter(function(C){return!C.getColDef().lockVisible}))||[];r.columnModel.setColumnsVisible(y,!0,"uiColumnMoved")}},onGridExit:function(a){var h;if(s){var y=((h=a==null?void 0:a.columns)===null||h===void 0?void 0:h.filter(function(C){return!C.getColDef().lockVisible}))||[];r.columnModel.setColumnsVisible(y,!1,"uiColumnMoved")}}};this.dragAndDropService.addDragSource(l,!0),this.addDestroyFunc(function(){return r.dragAndDropService.removeDragSource(l)})}},t.prototype.getDragItemForGroup=function(){var e=this.columnGroup.getProvidedColumnGroup().getLeafColumns(),r={};e.forEach(function(s){return r[s.getId()]=s.isVisible()});var o=[];return this.columnModel.getAllDisplayedColumns().forEach(function(s){e.indexOf(s)>=0&&(o.push(s),removeFromArray(e,s))}),e.forEach(function(s){return o.push(s)}),{columns:o,visibleState:r}},t.prototype.isSuppressMoving=function(){var e=!1;this.columnGroup.getLeafColumns().forEach(function(o){(o.getColDef().suppressMovable||o.getColDef().lockPosition)&&(e=!0)});var r=e||this.gridOptionsService.is("suppressMovableColumns");return r},__decorate$1h([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$1h([Autowired("dragAndDropService")],t.prototype,"dragAndDropService",void 0),__decorate$1h([Autowired("gridApi")],t.prototype,"gridApi",void 0),__decorate$1h([Autowired("columnApi")],t.prototype,"columnApi",void 0),t}(AbstractHeaderCellCtrl),__extends$1k=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1g=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},instanceIdSequence=0,HeaderRowCtrl=function(n){__extends$1k(t,n);function t(e,r,o){var s=n.call(this)||this;return s.instanceId=instanceIdSequence++,s.headerCellCtrls={},s.rowIndex=e,s.pinned=r,s.type=o,s}return t.prototype.getInstanceId=function(){return this.instanceId},t.prototype.setComp=function(e){this.comp=e,this.onRowHeightChanged(),this.onVirtualColumnsChanged(),this.setWidth(),this.addEventListeners(),isBrowserSafari()&&this.comp.setTransform("translateZ(0)"),e.setAriaRowIndex(this.rowIndex+1)},t.prototype.addEventListeners=function(){this.addManagedListener(this.eventService,Events.EVENT_COLUMN_RESIZED,this.onColumnResized.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,this.onDisplayedColumnsChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_VIRTUAL_COLUMNS_CHANGED,this.onVirtualColumnsChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_HEADER_HEIGHT_CHANGED,this.onRowHeightChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_GRID_STYLES_CHANGED,this.onRowHeightChanged.bind(this)),this.addManagedPropertyListener("domLayout",this.onDisplayedColumnsChanged.bind(this)),this.addManagedPropertyListener("headerHeight",this.onRowHeightChanged.bind(this)),this.addManagedPropertyListener("pivotHeaderHeight",this.onRowHeightChanged.bind(this)),this.addManagedPropertyListener("groupHeaderHeight",this.onRowHeightChanged.bind(this)),this.addManagedPropertyListener("pivotGroupHeaderHeight",this.onRowHeightChanged.bind(this)),this.addManagedPropertyListener("floatingFiltersHeight",this.onRowHeightChanged.bind(this))},t.prototype.getHeaderCellCtrl=function(e){return values(this.headerCellCtrls).find(function(r){return r.getColumnGroupChild()===e})},t.prototype.onDisplayedColumnsChanged=function(){this.onVirtualColumnsChanged(),this.setWidth(),this.onRowHeightChanged()},t.prototype.getType=function(){return this.type},t.prototype.onColumnResized=function(){this.setWidth()},t.prototype.setWidth=function(){var e=this.getWidthForRow();this.comp.setWidth(e+"px")},t.prototype.getWidthForRow=function(){var e=this.gridOptionsService.isDomLayout("print");if(e){var r=this.pinned!=null;return r?0:this.columnModel.getContainerWidth("right")+this.columnModel.getContainerWidth("left")+this.columnModel.getContainerWidth(null)}return this.columnModel.getContainerWidth(this.pinned)},t.prototype.onRowHeightChanged=function(){var e=this.columnModel.getHeaderRowCount(),r=[],o=0;this.columnModel.hasFloatingFilters()&&(e++,o=1);for(var s=this.columnModel.getColumnGroupHeaderRowHeight(),l=this.columnModel.getColumnHeaderRowHeight(),a=1+o,h=e-a,y=0;y<h;y++)r.push(s);r.push(l);for(var y=0;y<o;y++)r.push(this.columnModel.getFloatingFiltersHeight());for(var C=0,y=0;y<this.rowIndex;y++)C+=r[y];var L=r[this.rowIndex]+"px";this.comp.setTop(C+"px"),this.comp.setHeight(L)},t.prototype.getPinned=function(){return this.pinned},t.prototype.getRowIndex=function(){return this.rowIndex},t.prototype.onVirtualColumnsChanged=function(){var e=this,r=this.headerCellCtrls;this.headerCellCtrls={};var o=this.getColumnsInViewport();o.forEach(function(a){if(!a.isEmptyGroup()){var h=a.getUniqueId(),y=r[h];delete r[h];var C=y&&y.getColumnGroupChild()!=a;if(C&&(e.destroyBean(y),y=void 0),y==null)switch(e.type){case HeaderRowType.FLOATING_FILTER:y=e.createBean(new HeaderFilterCellCtrl(a,e));break;case HeaderRowType.COLUMN_GROUP:y=e.createBean(new HeaderGroupCellCtrl(a,e));break;default:y=e.createBean(new HeaderCellCtrl(a,e));break}e.headerCellCtrls[h]=y}});var s=function(a){var h=e.focusService.isHeaderWrapperFocused(a);if(!h)return!1;var y=e.columnModel.isDisplayed(a.getColumnGroupChild());return y};iterateObject(r,function(a,h){var y=s(h);y?e.headerCellCtrls[a]=h:e.destroyBean(h)});var l=getAllValuesInObject(this.headerCellCtrls);this.comp.setHeaderCtrls(l)},t.prototype.getColumnsInViewport=function(){var e=this.gridOptionsService.isDomLayout("print");return e?this.getColumnsInViewportPrintLayout():this.getColumnsInViewportNormalLayout()},t.prototype.getColumnsInViewportPrintLayout=function(){var e=this;if(this.pinned!=null)return[];var r=[],o=this.getActualDepth();return["left",null,"right"].forEach(function(s){var l=e.columnModel.getVirtualHeaderGroupRow(s,o);r=r.concat(l)}),r},t.prototype.getActualDepth=function(){return this.type==HeaderRowType.FLOATING_FILTER?this.rowIndex-1:this.rowIndex},t.prototype.getColumnsInViewportNormalLayout=function(){return this.columnModel.getVirtualHeaderGroupRow(this.pinned,this.getActualDepth())},t.prototype.focusHeader=function(e,r){var o=getAllValuesInObject(this.headerCellCtrls),s=o.find(function(l){return l.getColumnGroupChild()==e});return s?(s.focus(r),!0):!1},t.prototype.destroy=function(){var e=this;iterateObject(this.headerCellCtrls,function(r,o){e.destroyBean(o)}),this.headerCellCtrls={},n.prototype.destroy.call(this)},__decorate$1g([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$1g([Autowired("focusService")],t.prototype,"focusService",void 0),t}(BeanStub),__extends$1j=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1f=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__read$f=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray$d=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n},HeaderRowContainerCtrl=function(n){__extends$1j(t,n);function t(e){var r=n.call(this)||this;return r.hidden=!1,r.includeFloatingFilter=!1,r.groupsRowCtrls=[],r.pinned=e,r}return t.prototype.setComp=function(e,r){this.comp=e,this.eViewport=r,this.setupCenterWidth(),this.setupPinnedWidth(),this.setupDragAndDrop(this.eViewport),this.addManagedListener(this.eventService,Events.EVENT_GRID_COLUMNS_CHANGED,this.onGridColumnsChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,this.onDisplayedColumnsChanged.bind(this)),this.ctrlsService.registerHeaderContainer(this,this.pinned),this.columnModel.isReady()&&this.refresh()},t.prototype.setupDragAndDrop=function(e){var r=new BodyDropTarget(this.pinned,e);this.createManagedBean(r)},t.prototype.refresh=function(e){var r=this;e===void 0&&(e=!1);var o=new NumberSequence,s=this.focusService.getFocusHeaderToUseAfterRefresh(),l=function(){var C=r.columnModel.getHeaderRowCount()-1;r.groupsRowCtrls=r.destroyBeans(r.groupsRowCtrls);for(var L=0;L<C;L++){var Y=r.createBean(new HeaderRowCtrl(o.next(),r.pinned,HeaderRowType.COLUMN_GROUP));r.groupsRowCtrls.push(Y)}},a=function(){var C=o.next(),L=!r.hidden&&(r.columnsRowCtrl==null||!e||r.columnsRowCtrl.getRowIndex()!==C),Y=L||r.hidden;Y&&(r.columnsRowCtrl=r.destroyBean(r.columnsRowCtrl)),L&&(r.columnsRowCtrl=r.createBean(new HeaderRowCtrl(C,r.pinned,HeaderRowType.COLUMN)))},h=function(){r.includeFloatingFilter=r.columnModel.hasFloatingFilters()&&!r.hidden;var C=function(){r.filtersRowCtrl=r.destroyBean(r.filtersRowCtrl)};if(!r.includeFloatingFilter){C();return}var L=o.next();if(r.filtersRowCtrl){var Y=r.filtersRowCtrl.getRowIndex()!==L;(!e||Y)&&C()}r.filtersRowCtrl||(r.filtersRowCtrl=r.createBean(new HeaderRowCtrl(L,r.pinned,HeaderRowType.FLOATING_FILTER)))};l(),a(),h();var y=this.getAllCtrls();this.comp.setCtrls(y),this.restoreFocusOnHeader(s)},t.prototype.restoreFocusOnHeader=function(e){e==null||e.column.getPinned()!=this.pinned||this.focusService.focusHeaderPosition({headerPosition:e})},t.prototype.getAllCtrls=function(){var e=__spreadArray$d([],__read$f(this.groupsRowCtrls));return this.columnsRowCtrl&&e.push(this.columnsRowCtrl),this.filtersRowCtrl&&e.push(this.filtersRowCtrl),e},t.prototype.onGridColumnsChanged=function(){this.refresh(!0)},t.prototype.onDisplayedColumnsChanged=function(){var e=this.columnModel.hasFloatingFilters()&&!this.hidden;this.includeFloatingFilter!==e&&this.refresh(!0)},t.prototype.setupCenterWidth=function(){var e=this;this.pinned==null&&this.createManagedBean(new CenterWidthFeature(function(r){return e.comp.setCenterWidth(r+"px")},!0))},t.prototype.setHorizontalScroll=function(e){this.comp.setViewportScrollLeft(e)},t.prototype.setupPinnedWidth=function(){var e=this;if(this.pinned!=null){var r=this.pinned==="left",o=this.pinned==="right";this.hidden=!0;var s=function(){var l=r?e.pinnedWidthService.getPinnedLeftWidth():e.pinnedWidthService.getPinnedRightWidth();if(l!=null){var a=l==0,h=e.hidden!==a,y=e.gridOptionsService.is("enableRtl"),C=e.gridOptionsService.getScrollbarWidth(),L=e.scrollVisibleService.isVerticalScrollShowing()&&(y&&r||!y&&o),Y=L?l+C:l;e.comp.setPinnedContainerWidth(Y+"px"),e.comp.setDisplayed(!a),h&&(e.hidden=a,e.refresh())}};this.addManagedListener(this.eventService,Events.EVENT_LEFT_PINNED_WIDTH_CHANGED,s),this.addManagedListener(this.eventService,Events.EVENT_RIGHT_PINNED_WIDTH_CHANGED,s),this.addManagedListener(this.eventService,Events.EVENT_SCROLL_VISIBILITY_CHANGED,s),this.addManagedListener(this.eventService,Events.EVENT_SCROLLBAR_WIDTH_CHANGED,s)}},t.prototype.getHeaderCtrlForColumn=function(e){if(e instanceof Column)return this.columnsRowCtrl?this.columnsRowCtrl.getHeaderCellCtrl(e):void 0;if(this.groupsRowCtrls.length!==0)for(var r=0;r<this.groupsRowCtrls.length;r++){var o=this.groupsRowCtrls[r].getHeaderCellCtrl(e);if(o)return o}},t.prototype.getHtmlElementForColumnHeader=function(e){var r=this.getHeaderCtrlForColumn(e);return r?r.getGui():null},t.prototype.getRowType=function(e){var r=this.getAllCtrls(),o=r[e];return o?o.getType():void 0},t.prototype.focusHeader=function(e,r,o){var s=this.getAllCtrls(),l=s[e];return l?l.focusHeader(r,o):!1},t.prototype.getRowCount=function(){return this.groupsRowCtrls.length+(this.columnsRowCtrl?1:0)+(this.filtersRowCtrl?1:0)},t.prototype.destroy=function(){this.filtersRowCtrl&&(this.filtersRowCtrl=this.destroyBean(this.filtersRowCtrl)),this.columnsRowCtrl&&(this.columnsRowCtrl=this.destroyBean(this.columnsRowCtrl)),this.groupsRowCtrls&&this.groupsRowCtrls.length&&(this.groupsRowCtrls=this.destroyBeans(this.groupsRowCtrls)),n.prototype.destroy.call(this)},__decorate$1f([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),__decorate$1f([Autowired("scrollVisibleService")],t.prototype,"scrollVisibleService",void 0),__decorate$1f([Autowired("pinnedWidthService")],t.prototype,"pinnedWidthService",void 0),__decorate$1f([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$1f([Autowired("focusService")],t.prototype,"focusService",void 0),t}(BeanStub),__extends$1i=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1e=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},HeaderRowContainerComp=function(n){__extends$1i(t,n);function t(e){var r=n.call(this)||this;return r.headerRowComps={},r.rowCompsList=[],r.pinned=e,r}return t.prototype.init=function(){var e=this;this.selectAndSetTemplate();var r={setDisplayed:function(s){return e.setDisplayed(s)},setCtrls:function(s){return e.setCtrls(s)},setCenterWidth:function(s){return e.eCenterContainer.style.width=s},setViewportScrollLeft:function(s){return e.getGui().scrollLeft=s},setPinnedContainerWidth:function(s){var l=e.getGui();l.style.width=s,l.style.maxWidth=s,l.style.minWidth=s}},o=this.createManagedBean(new HeaderRowContainerCtrl(this.pinned));o.setComp(r,this.getGui())},t.prototype.selectAndSetTemplate=function(){var e=this.pinned=="left",r=this.pinned=="right",o=e?t.PINNED_LEFT_TEMPLATE:r?t.PINNED_RIGHT_TEMPLATE:t.CENTER_TEMPLATE;this.setTemplate(o),this.eRowContainer=this.eCenterContainer?this.eCenterContainer:this.getGui()},t.prototype.destroyRowComps=function(){this.setCtrls([])},t.prototype.destroyRowComp=function(e){this.destroyBean(e),this.eRowContainer.removeChild(e.getGui())},t.prototype.setCtrls=function(e){var r=this,o=this.headerRowComps;this.headerRowComps={},this.rowCompsList=[];var s,l=function(a){var h=a.getGui(),y=h.parentElement!=r.eRowContainer;y&&r.eRowContainer.appendChild(h),s&&ensureDomOrder(r.eRowContainer,h,s),s=h};e.forEach(function(a){var h=a.getInstanceId(),y=o[h];delete o[h];var C=y||r.createBean(new HeaderRowComp(a));r.headerRowComps[h]=C,r.rowCompsList.push(C),l(C)}),getAllValuesInObject(o).forEach(function(a){return r.destroyRowComp(a)})},t.PINNED_LEFT_TEMPLATE='<div class="ag-pinned-left-header" role="presentation"></div>',t.PINNED_RIGHT_TEMPLATE='<div class="ag-pinned-right-header" role="presentation"></div>',t.CENTER_TEMPLATE=`<div class="ag-header-viewport" role="presentation">
            <div class="ag-header-container" ref="eCenterContainer" role="rowgroup"></div>
        </div>`,__decorate$1e([RefSelector("eCenterContainer")],t.prototype,"eCenterContainer",void 0),__decorate$1e([PostConstruct],t.prototype,"init",null),__decorate$1e([PreDestroy],t.prototype,"destroyRowComps",null),t}(Component),__extends$1h=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1d=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},HeaderNavigationDirection;(function(n){n[n.UP=0]="UP",n[n.DOWN=1]="DOWN",n[n.LEFT=2]="LEFT",n[n.RIGHT=3]="RIGHT"})(HeaderNavigationDirection||(HeaderNavigationDirection={}));var HeaderNavigationService=function(n){__extends$1h(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.postConstruct=function(){var e=this;this.ctrlsService.whenReady(function(r){e.gridBodyCon=r.gridBodyCtrl})},t.prototype.getHeaderRowCount=function(){var e=this.ctrlsService.getHeaderRowContainerCtrl();return e?e.getRowCount():0},t.prototype.navigateVertically=function(e,r,o){if(r||(r=this.focusService.getFocusedHeader()),!r)return!1;var s=r.headerRowIndex,l=r.column,a=this.getHeaderRowCount(),h=e===HeaderNavigationDirection.UP,y=h?this.headerPositionUtils.getColumnVisibleParent(l,s):this.headerPositionUtils.getColumnVisibleChild(l,s),C=y.nextRow,L=y.nextFocusColumn,Y=!1;return C<0&&(C=0,L=l,Y=!0),C>=a&&(C=-1),!Y&&!L?!1:this.focusService.focusHeaderPosition({headerPosition:{headerRowIndex:C,column:L},allowUserOverride:!0,event:o})},t.prototype.navigateHorizontally=function(e,r,o){r===void 0&&(r=!1);var s=this.focusService.getFocusedHeader(),l=e===HeaderNavigationDirection.LEFT,a=this.gridOptionsService.is("enableRtl"),h,y;return l!==a?(y="Before",h=this.headerPositionUtils.findHeader(s,y)):(y="After",h=this.headerPositionUtils.findHeader(s,y)),h||!r?this.focusService.focusHeaderPosition({headerPosition:h,direction:y,fromTab:r,allowUserOverride:!0,event:o}):this.focusNextHeaderRow(s,y,o)},t.prototype.focusNextHeaderRow=function(e,r,o){var s=e.headerRowIndex,l=null,a;return r==="Before"?s>0&&(a=s-1,l=this.headerPositionUtils.findColAtEdgeForHeaderRow(a,"end")):(a=s+1,l=this.headerPositionUtils.findColAtEdgeForHeaderRow(a,"start")),this.focusService.focusHeaderPosition({headerPosition:l,direction:r,fromTab:!0,allowUserOverride:!0,event:o})},t.prototype.scrollToColumn=function(e,r){if(r===void 0&&(r="After"),!e.getPinned()){var o;if(e instanceof ColumnGroup){var s=e.getDisplayedLeafColumns();o=r==="Before"?last(s):s[0]}else o=e;this.gridBodyCon.getScrollFeature().ensureColumnVisible(o)}},__decorate$1d([Autowired("focusService")],t.prototype,"focusService",void 0),__decorate$1d([Autowired("headerPositionUtils")],t.prototype,"headerPositionUtils",void 0),__decorate$1d([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),__decorate$1d([PostConstruct],t.prototype,"postConstruct",null),t=__decorate$1d([Bean("headerNavigationService")],t),t}(BeanStub),__extends$1g=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1c=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},GridHeaderCtrl=function(n){__extends$1g(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.setComp=function(e,r,o){this.comp=e,this.eGui=r,this.createManagedBean(new ManagedFocusFeature(o,{onTabKeyDown:this.onTabKeyDown.bind(this),handleKeyDown:this.handleKeyDown.bind(this),onFocusOut:this.onFocusOut.bind(this)})),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_PIVOT_MODE_CHANGED,this.onPivotModeChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,this.onDisplayedColumnsChanged.bind(this)),this.onPivotModeChanged(),this.setupHeaderHeight(),this.ctrlsService.registerGridHeaderCtrl(this)},t.prototype.setupHeaderHeight=function(){var e=this.setHeaderHeight.bind(this);e(),this.addManagedPropertyListener("headerHeight",e),this.addManagedPropertyListener("pivotHeaderHeight",e),this.addManagedPropertyListener("groupHeaderHeight",e),this.addManagedPropertyListener("pivotGroupHeaderHeight",e),this.addManagedPropertyListener("floatingFiltersHeight",e),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,e),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_HEADER_HEIGHT_CHANGED,e),this.addManagedListener(this.eventService,Events.EVENT_GRID_STYLES_CHANGED,e)},t.prototype.getHeaderHeight=function(){return this.headerHeight},t.prototype.setHeaderHeight=function(){var e=this.columnModel,r=0,o=e.getHeaderRowCount(),s,l=e.hasFloatingFilters();l&&(o++,r=1);var a=this.columnModel.getColumnGroupHeaderRowHeight(),h=this.columnModel.getColumnHeaderRowHeight(),y=1+r,C=o-y;if(s=r*e.getFloatingFiltersHeight(),s+=C*a,s+=h,this.headerHeight!==s){this.headerHeight=s;var L=s+1+"px";this.comp.setHeightAndMinHeight(L),this.eventService.dispatchEvent({type:Events.EVENT_HEADER_HEIGHT_CHANGED})}},t.prototype.onPivotModeChanged=function(){var e=this.columnModel.isPivotMode();this.comp.addOrRemoveCssClass("ag-pivot-on",e),this.comp.addOrRemoveCssClass("ag-pivot-off",!e)},t.prototype.onDisplayedColumnsChanged=function(){var e=this.columnModel.getAllDisplayedColumns(),r=e.some(function(o){return o.isSpanHeaderHeight()});this.comp.addOrRemoveCssClass("ag-header-allow-overflow",r)},t.prototype.onTabKeyDown=function(e){var r=this.gridOptionsService.is("enableRtl"),o=e.shiftKey!==r?HeaderNavigationDirection.LEFT:HeaderNavigationDirection.RIGHT;(this.headerNavigationService.navigateHorizontally(o,!0,e)||this.focusService.focusNextGridCoreContainer(e.shiftKey))&&e.preventDefault()},t.prototype.handleKeyDown=function(e){var r=null;switch(e.key){case KeyCode.LEFT:r=HeaderNavigationDirection.LEFT;case KeyCode.RIGHT:exists(r)||(r=HeaderNavigationDirection.RIGHT),this.headerNavigationService.navigateHorizontally(r,!1,e);break;case KeyCode.UP:r=HeaderNavigationDirection.UP;case KeyCode.DOWN:exists(r)||(r=HeaderNavigationDirection.DOWN),this.headerNavigationService.navigateVertically(r,null,e)&&e.preventDefault();break;default:return}},t.prototype.onFocusOut=function(e){var r=this.gridOptionsService.getDocument(),o=e.relatedTarget;!o&&this.eGui.contains(r.activeElement)||this.eGui.contains(o)||this.focusService.clearFocusedHeader()},__decorate$1c([Autowired("headerNavigationService")],t.prototype,"headerNavigationService",void 0),__decorate$1c([Autowired("focusService")],t.prototype,"focusService",void 0),__decorate$1c([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$1c([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),t}(BeanStub),__extends$1f=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1b=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},GridHeaderComp=function(n){__extends$1f(t,n);function t(){return n.call(this,t.TEMPLATE)||this}return t.prototype.postConstruct=function(){var e=this,r={addOrRemoveCssClass:function(l,a){return e.addOrRemoveCssClass(l,a)},setHeightAndMinHeight:function(l){e.getGui().style.height=l,e.getGui().style.minHeight=l}},o=this.createManagedBean(new GridHeaderCtrl);o.setComp(r,this.getGui(),this.getFocusableElement());var s=function(l){e.createManagedBean(l),e.appendChild(l)};s(new HeaderRowContainerComp("left")),s(new HeaderRowContainerComp(null)),s(new HeaderRowContainerComp("right"))},t.TEMPLATE='<div class="ag-header" role="presentation"/>',__decorate$1b([PostConstruct],t.prototype,"postConstruct",null),t}(Component),__extends$1e=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1a=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},HorizontalResizeService=function(n){__extends$1e(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.addResizeBar=function(e){var r=this,o={dragStartPixels:e.dragStartPixels||0,eElement:e.eResizeBar,onDragStart:this.onDragStart.bind(this,e),onDragStop:this.onDragStop.bind(this,e),onDragging:this.onDragging.bind(this,e),includeTouch:!0,stopPropagationForTouch:!0};this.dragService.addDragSource(o);var s=function(){return r.dragService.removeDragSource(o)};return s},t.prototype.onDragStart=function(e,r){this.dragStartX=r.clientX,this.setResizeIcons();var o=r instanceof MouseEvent&&r.shiftKey===!0;e.onResizeStart(o)},t.prototype.setResizeIcons=function(){var e=this.ctrlsService.getGridCtrl();e.setResizeCursor(!0),e.disableUserSelect(!0)},t.prototype.onDragStop=function(e,r){e.onResizeEnd(this.resizeAmount),this.resetIcons()},t.prototype.resetIcons=function(){var e=this.ctrlsService.getGridCtrl();e.setResizeCursor(!1),e.disableUserSelect(!1)},t.prototype.onDragging=function(e,r){this.resizeAmount=r.clientX-this.dragStartX,e.onResizing(this.resizeAmount)},__decorate$1a([Autowired("dragService")],t.prototype,"dragService",void 0),__decorate$1a([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),t=__decorate$1a([Bean("horizontalResizeService")],t),t}(BeanStub),__extends$1d=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$19=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},StandardMenuFactory=function(n){__extends$1d(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.hideActiveMenu=function(){this.hidePopup&&this.hidePopup()},t.prototype.showMenuAfterMouseEvent=function(e,r){var o=this;this.showPopup(e,function(s){o.popupService.positionPopupUnderMouseEvent({column:e,type:"columnMenu",mouseEvent:r,ePopup:s})},"columnMenu",r.target)},t.prototype.showMenuAfterButtonClick=function(e,r,o){var s=this;this.showPopup(e,function(l){s.popupService.positionPopupByComponent({type:o,eventSource:r,ePopup:l,keepWithinBounds:!0,position:"under",column:e})},o,r)},t.prototype.showPopup=function(e,r,o,s){var l=this,a=this.filterManager.getOrCreateFilterWrapper(e,"COLUMN_MENU");if(!a)throw new Error("AG Grid - unable to show popup filter, filter instantiation failed");var h=document.createElement("div");setAriaRole(h,"presentation"),h.classList.add("ag-menu"),this.tabListener=this.addManagedListener(h,"keydown",function(Ir){return l.trapFocusWithin(Ir,h)}),a.guiPromise.then(function(Ir){return h.appendChild(Ir)});var y,C=function(){var Ir;return(Ir=a.filterPromise)===null||Ir===void 0?void 0:Ir.then(function(Wr){var yi;return(yi=Wr==null?void 0:Wr.afterGuiDetached)===null||yi===void 0?void 0:yi.call(Wr)})},L=s||this.ctrlsService.getGridBodyCtrl().getGui(),Y=function(Ir){e.setMenuVisible(!1,"contextMenu");var Wr=Ir instanceof KeyboardEvent;if(l.tabListener&&(l.tabListener=l.tabListener()),Wr&&s&&isVisible(s)){var yi=l.focusService.findTabbableParent(s);yi&&yi.focus()}C()},ze=this.localeService.getLocaleTextFunc(),Bt=this.popupService.addPopup({modal:!0,eChild:h,closeOnEsc:!0,closedCallback:Y,positionCallback:function(){return r(h)},anchorToElement:L,ariaLabel:ze("ariaLabelColumnMenu","Column Menu")});Bt&&(this.hidePopup=y=Bt.hideFunc),a.filterPromise.then(function(Ir){r(h),Ir.afterGuiAttached&&Ir.afterGuiAttached({container:o,hidePopup:y})}),e.setMenuVisible(!0,"contextMenu")},t.prototype.trapFocusWithin=function(e,r){e.key!==KeyCode.TAB||e.defaultPrevented||this.focusService.findNextFocusableElement(r,!1,e.shiftKey)||(e.preventDefault(),this.focusService.focusInto(r,e.shiftKey))},t.prototype.isMenuEnabled=function(e){return e.isFilterAllowed()&&e.getMenuTabs(["filterMenuTab"]).includes("filterMenuTab")},__decorate$19([Autowired("filterManager")],t.prototype,"filterManager",void 0),__decorate$19([Autowired("popupService")],t.prototype,"popupService",void 0),__decorate$19([Autowired("focusService")],t.prototype,"focusService",void 0),__decorate$19([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),t=__decorate$19([Bean("menuFactory")],t),t}(BeanStub),__extends$1c=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$18=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};(function(n){__extends$1c(t,n);function t(e){var r=n.call(this,t.getTemplate(e.cssClass))||this;return r.items=[],r.tabbedItemScrollMap=new Map,r.params=e,e.items&&e.items.forEach(function(o){return r.addItem(o)}),r}return t.prototype.postConstruct=function(){var e=this;this.createManagedBean(new ManagedFocusFeature(this.getFocusableElement(),{onTabKeyDown:this.onTabKeyDown.bind(this),handleKeyDown:this.handleKeyDown.bind(this)})),this.addDestroyFunc(function(){var r,o,s;return(s=(o=(r=e.activeItem)===null||r===void 0?void 0:r.tabbedItem)===null||o===void 0?void 0:o.afterDetachedCallback)===null||s===void 0?void 0:s.call(o)})},t.getTemplate=function(e){return'<div class="ag-tabs '+e+`">
            <div ref="eHeader" role="tablist" class="ag-tabs-header `+(e?e+"-header":"")+`"></div>
            <div ref="eBody" role="presentation" class="ag-tabs-body `+(e?e+"-body":"")+`"></div>
        </div>`},t.prototype.handleKeyDown=function(e){var r=this.gridOptionsService.getDocument();switch(e.key){case KeyCode.RIGHT:case KeyCode.LEFT:if(!this.eHeader.contains(r.activeElement))return;var o=e.key===KeyCode.RIGHT,s=this.gridOptionsService.is("enableRtl"),l=this.items.indexOf(this.activeItem),a=o!==s?Math.min(l+1,this.items.length-1):Math.max(l-1,0);if(l===a)return;e.preventDefault();var h=this.items[a];this.showItemWrapper(h),h.eHeaderButton.focus();break;case KeyCode.UP:case KeyCode.DOWN:e.stopPropagation();break}},t.prototype.onTabKeyDown=function(e){if(!e.defaultPrevented){var r=this,o=r.focusService,s=r.eHeader,l=r.eBody,a=r.activeItem,h=this.gridOptionsService.getDocument(),y=h.activeElement,C=e.target;if(e.preventDefault(),s.contains(y)){o.focusInto(l,e.shiftKey);return}var L=null;o.isTargetUnderManagedComponent(l,C)&&(e.shiftKey&&(L=this.focusService.findFocusableElementBeforeTabGuard(l,C)),L||(L=a.eHeaderButton)),!L&&l.contains(y)&&(L=o.findNextFocusableElement(l,!1,e.shiftKey),L||(L=a.eHeaderButton)),L&&L.focus()}},t.prototype.setAfterAttachedParams=function(e){this.afterAttachedParams=e},t.prototype.showFirstItem=function(){this.items.length>0&&this.showItemWrapper(this.items[0])},t.prototype.addItem=function(e){var r=document.createElement("span");setAriaRole(r,"tab"),r.setAttribute("tabindex","-1"),r.appendChild(e.title),r.classList.add("ag-tab"),this.eHeader.appendChild(r),setAriaLabel(r,e.titleLabel);var o={tabbedItem:e,eHeaderButton:r};this.items.push(o),r.addEventListener("click",this.showItemWrapper.bind(this,o))},t.prototype.showItem=function(e){var r=this.items.find(function(o){return o.tabbedItem===e});r&&this.showItemWrapper(r)},t.prototype.showItemWrapper=function(e){var r=this,o,s,l=e.tabbedItem,a=e.eHeaderButton;if(this.params.onItemClicked&&this.params.onItemClicked({item:l}),this.activeItem===e){callIfPresent(this.params.onActiveItemClicked);return}this.lastScrollListener&&(this.lastScrollListener=this.lastScrollListener()),clearElement(this.eBody),l.bodyPromise.then(function(h){r.eBody.appendChild(h);var y=!r.focusService.isKeyboardMode();if(r.focusService.focusInto(r.eBody,!1,y),l.afterAttachedCallback&&l.afterAttachedCallback(r.afterAttachedParams),r.params.keepScrollPosition){var C=l.getScrollableContainer&&l.getScrollableContainer()||h;r.lastScrollListener=r.addManagedListener(C,"scroll",function(){r.tabbedItemScrollMap.set(l.name,C.scrollTop)});var L=r.tabbedItemScrollMap.get(l.name);L!==void 0&&setTimeout(function(){C.scrollTop=L},0)}}),this.activeItem&&(this.activeItem.eHeaderButton.classList.remove("ag-tab-selected"),(s=(o=this.activeItem.tabbedItem).afterDetachedCallback)===null||s===void 0||s.call(o)),a.classList.add("ag-tab-selected"),this.activeItem=e},__decorate$18([Autowired("focusService")],t.prototype,"focusService",void 0),__decorate$18([RefSelector("eHeader")],t.prototype,"eHeader",void 0),__decorate$18([RefSelector("eBody")],t.prototype,"eBody",void 0),__decorate$18([PostConstruct],t.prototype,"postConstruct",null),t})(Component);var __extends$1b=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$17=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},DEBOUNCE_DELAY=50,ResizeObserverService=function(n){__extends$1b(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.polyfillFunctions=[],e}return t.prototype.observeResize=function(e,r){var o=this,s=this.gridOptionsService.getWindow(),l=function(){var C=new s.ResizeObserver(r);return C.observe(e),function(){return C.disconnect()}},a=function(){var C=offsetWidth(e),L=offsetHeight(e),Y=!0,ze=function(){if(Y){var Bt=offsetWidth(e),Ir=offsetHeight(e),Wr=Bt!==C||Ir!==L;Wr&&(C=Bt,L=Ir,r()),o.doNextPolyfillTurn(ze)}};return ze(),function(){return Y=!1}},h=this.gridOptionsService.is("suppressBrowserResizeObserver"),y=!!s.ResizeObserver;return y&&!h?l():a()},t.prototype.doNextPolyfillTurn=function(e){this.polyfillFunctions.push(e),this.schedulePolyfill()},t.prototype.schedulePolyfill=function(){var e=this;if(!this.polyfillScheduled){var r=function(){var o=e.polyfillFunctions;e.polyfillScheduled=!1,e.polyfillFunctions=[],o.forEach(function(s){return s()})};this.polyfillScheduled=!0,this.getFrameworkOverrides().setTimeout(r,DEBOUNCE_DELAY)}},t=__decorate$17([Bean("resizeObserverService")],t),t}(BeanStub),__extends$1a=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$16=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},AnimationFrameService=function(n){__extends$1a(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.createTasksP1={list:[],sorted:!1},e.createTasksP2={list:[],sorted:!1},e.destroyTasks=[],e.ticking=!1,e.scrollGoingDown=!0,e.lastPage=0,e.lastScrollTop=0,e.taskCount=0,e.cancelledTasks=new Set,e}return t.prototype.setScrollTop=function(e){var r=this.gridOptionsService.is("pagination");if(this.scrollGoingDown=e>=this.lastScrollTop,r&&e===0){var o=this.paginationProxy.getCurrentPage();o!==this.lastPage&&(this.lastPage=o,this.scrollGoingDown=!0)}this.lastScrollTop=e},t.prototype.init=function(){this.useAnimationFrame=!this.gridOptionsService.is("suppressAnimationFrame")},t.prototype.isOn=function(){return this.useAnimationFrame},t.prototype.verifyAnimationFrameOn=function(e){this.useAnimationFrame===!1&&console.warn("AG Grid: AnimationFrameService."+e+" called but animation frames are off")},t.prototype.createTask=function(e,r,o){this.verifyAnimationFrameOn(o);var s={task:e,index:r,createOrder:++this.taskCount};this.addTaskToList(this[o],s),this.schedule()},t.prototype.cancelTask=function(e){this.cancelledTasks.add(e)},t.prototype.addTaskToList=function(e,r){e.list.push(r),e.sorted=!1},t.prototype.sortTaskList=function(e){if(!e.sorted){var r=this.scrollGoingDown?1:-1;e.list.sort(function(o,s){return o.index!==s.index?r*(s.index-o.index):s.createOrder-o.createOrder}),e.sorted=!0}},t.prototype.addDestroyTask=function(e){this.verifyAnimationFrameOn("createTasksP3"),this.destroyTasks.push(e),this.schedule()},t.prototype.executeFrame=function(e){this.verifyAnimationFrameOn("executeFrame");for(var r=this.createTasksP1,o=r.list,s=this.createTasksP2,l=s.list,a=this.destroyTasks,h=new Date().getTime(),y=new Date().getTime()-h,C=e<=0,L=this.ctrlsService.getGridBodyCtrl();C||y<e;){var Y=L.getScrollFeature().scrollGridIfNeeded();if(!Y){var ze=void 0;if(o.length)this.sortTaskList(r),ze=o.pop().task;else if(l.length)this.sortTaskList(s),ze=l.pop().task;else if(a.length)ze=a.pop();else{this.cancelledTasks.clear();break}this.cancelledTasks.has(ze)||ze()}y=new Date().getTime()-h}o.length||l.length||a.length?this.requestFrame():this.stopTicking()},t.prototype.stopTicking=function(){this.ticking=!1},t.prototype.flushAllFrames=function(){this.useAnimationFrame&&this.executeFrame(-1)},t.prototype.schedule=function(){this.useAnimationFrame&&(this.ticking||(this.ticking=!0,this.requestFrame()))},t.prototype.requestFrame=function(){var e=this.executeFrame.bind(this,60);this.requestAnimationFrame(e)},t.prototype.requestAnimationFrame=function(e){var r=this.gridOptionsService.getWindow();r.requestAnimationFrame?r.requestAnimationFrame(e):r.webkitRequestAnimationFrame?r.webkitRequestAnimationFrame(e):r.setTimeout(e,0)},t.prototype.isQueueEmpty=function(){return!this.ticking},t.prototype.debounce=function(e){var r=this,o=!1;return function(){if(!r.isOn()){r.getFrameworkOverrides().setTimeout(e,0);return}o||(o=!0,r.addDestroyTask(function(){o=!1,e()}))}},__decorate$16([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),__decorate$16([Autowired("paginationProxy")],t.prototype,"paginationProxy",void 0),__decorate$16([PostConstruct],t.prototype,"init",null),t=__decorate$16([Bean("animationFrameService")],t),t}(BeanStub),__extends$19=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$15=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},AutoWidthCalculator=function(n){__extends$19(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.postConstruct=function(){var e=this;this.ctrlsService.whenReady(function(r){e.centerRowContainerCtrl=r.centerRowContainerCtrl})},t.prototype.getPreferredWidthForColumn=function(e,r){var o=this.getHeaderCellForColumn(e);if(!o)return-1;var s=this.rowRenderer.getAllCellsForColumn(e);return r||s.push(o),this.addElementsToContainerAndGetWidth(s)},t.prototype.getPreferredWidthForColumnGroup=function(e){var r=this.getHeaderCellForColumn(e);return r?this.addElementsToContainerAndGetWidth([r]):-1},t.prototype.addElementsToContainerAndGetWidth=function(e){var r=this,o=document.createElement("form");o.style.position="fixed";var s=this.centerRowContainerCtrl.getContainerElement();e.forEach(function(h){return r.cloneItemIntoDummy(h,o)}),s.appendChild(o);var l=o.offsetWidth;s.removeChild(o);var a=this.getAutoSizePadding();return l+a},t.prototype.getAutoSizePadding=function(){var e=this.gridOptionsService.getNum("autoSizePadding");return e!=null&&e>=0?e:20},t.prototype.getHeaderCellForColumn=function(e){var r=null;return this.ctrlsService.getHeaderRowContainerCtrls().forEach(function(o){var s=o.getHtmlElementForColumnHeader(e);s!=null&&(r=s)}),r},t.prototype.cloneItemIntoDummy=function(e,r){var o=e.cloneNode(!0);o.style.width="",o.style.position="static",o.style.left="";var s=document.createElement("div"),l=s.classList,a=["ag-header-cell","ag-header-group-cell"].some(function(Y){return o.classList.contains(Y)});a?(l.add("ag-header","ag-header-row"),s.style.position="static"):l.add("ag-row");for(var h=e.parentElement;h;){var y=["ag-header-row","ag-row"].some(function(Y){return h.classList.contains(Y)});if(y){for(var C=0;C<h.classList.length;C++){var L=h.classList[C];L!="ag-row-position-absolute"&&l.add(L)}break}h=h.parentElement}s.appendChild(o),r.appendChild(s)},__decorate$15([Autowired("rowRenderer")],t.prototype,"rowRenderer",void 0),__decorate$15([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),__decorate$15([Autowired("rowCssClassCalculator")],t.prototype,"rowCssClassCalculator",void 0),__decorate$15([PostConstruct],t.prototype,"postConstruct",null),t=__decorate$15([Bean("autoWidthCalculator")],t),t}(BeanStub),__extends$18=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$14=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__values$2=function(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],r=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},__read$e=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray$c=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n},StickyRowFeature=function(n){__extends$18(t,n);function t(e,r){var o=n.call(this)||this;return o.createRowCon=e,o.destroyRowCtrls=r,o.stickyRowCtrls=[],o.containerHeight=0,o}return t.prototype.postConstruct=function(){var e=this;this.isClientSide=this.rowModel.getType()==="clientSide",this.ctrlsService.whenReady(function(r){e.gridBodyCtrl=r.gridBodyCtrl})},t.prototype.getStickyRowCtrls=function(){return this.stickyRowCtrls},t.prototype.checkStickyRows=function(){var e=this,r=0;if(!this.gridOptionsService.isGroupRowsSticky()){this.refreshNodesAndContainerHeight([],r);return}for(var o=[],s=this.rowRenderer.getFirstVisibleVerticalPixel(),l=function(ze){var Bt,Ir,Wr;o.push(ze);var yi;if(e.isClientSide){for(var Bn=ze;Bn.expanded;)if(Bn.master)Bn=Bn.detailNode;else if(Bn.childrenAfterSort){if(Bn.childrenAfterSort.length===0)break;Bn=last(Bn.childrenAfterSort)}yi=Bn.rowTop+Bn.rowHeight}else if(ze.master)yi=ze.detailNode.rowTop+ze.detailNode.rowHeight;else{var vi=(Bt=ze.childStore)===null||Bt===void 0?void 0:Bt.getStoreBounds();yi=((Ir=vi==null?void 0:vi.heightPx)!==null&&Ir!==void 0?Ir:0)+((Wr=vi==null?void 0:vi.topPx)!==null&&Wr!==void 0?Wr:0)}var wo=s+r+ze.rowHeight;yi<wo?ze.stickyRowTop=r+(yi-wo):ze.stickyRowTop=r,r=0,o.forEach(function(ia){var gl=ia.stickyRowTop+ia.rowHeight;r<gl&&(r=gl)})};;){var a=s+r,h=this.rowModel.getRowIndexAtPixel(a),y=this.rowModel.getRow(h);if(y==null||y.level<0)break;for(var C=[],L=y.parent;L.level>=0;)C.push(L),L=L.parent;var Y=C.reverse().find(function(ze){return o.indexOf(ze)<0&&ze.displayed});if(Y){l(Y);continue}if(y.isExpandable()&&y.expanded&&y.rowTop<a){l(y);continue}break}this.refreshNodesAndContainerHeight(o,r)},t.prototype.refreshStickyNode=function(e){for(var r=[],o=0;o<this.stickyRowCtrls.length;o++){var s=this.stickyRowCtrls[o].getRowNode();s!==e&&r.push(s)}this.refreshNodesAndContainerHeight(r,this.containerHeight),this.checkStickyRows()},t.prototype.refreshNodesAndContainerHeight=function(e,r){var o,s,l,a=this,h=this.stickyRowCtrls.filter(function(Ir){return e.indexOf(Ir.getRowNode())===-1}),y=e.filter(function(Ir){return a.stickyRowCtrls.findIndex(function(Wr){return Wr.getRowNode()===Ir})===-1}),C={};h.forEach(function(Ir){C[Ir.getRowNode().id]=Ir,a.stickyRowCtrls=a.stickyRowCtrls.filter(function(Wr){return Wr!==Ir})});try{for(var L=__values$2(Object.values(C)),Y=L.next();!Y.done;Y=L.next()){var ze=Y.value;ze.getRowNode().sticky=!1}}catch(Ir){o={error:Ir}}finally{try{Y&&!Y.done&&(s=L.return)&&s.call(L)}finally{if(o)throw o.error}}this.destroyRowCtrls(C,!1);var Bt=y.map(function(Ir){return Ir.sticky=!0,a.createRowCon(Ir,!1,!1)});(l=this.stickyRowCtrls).push.apply(l,__spreadArray$c([],__read$e(Bt))),this.stickyRowCtrls.forEach(function(Ir){return Ir.setRowTop(Ir.getRowNode().stickyRowTop)}),this.stickyRowCtrls.sort(function(Ir,Wr){return Wr.getRowNode().rowIndex-Ir.getRowNode().rowIndex}),this.containerHeight!==r&&(this.containerHeight=r,this.gridBodyCtrl.setStickyTopHeight(r))},__decorate$14([Autowired("rowModel")],t.prototype,"rowModel",void 0),__decorate$14([Autowired("rowRenderer")],t.prototype,"rowRenderer",void 0),__decorate$14([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),__decorate$14([PostConstruct],t.prototype,"postConstruct",null),t}(BeanStub),__extends$17=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$13=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__read$d=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray$b=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n},__values$1=function(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],r=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},DEFAULT_KEEP_DETAIL_ROW_COUNT=10,RowRenderer=function(n){__extends$17(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.destroyFuncsForColumnListeners=[],e.rowCtrlsByRowIndex={},e.zombieRowCtrls={},e.allRowCtrls=[],e.topRowCtrls=[],e.bottomRowCtrls=[],e.refreshInProgress=!1,e.dataFirstRenderedFired=!1,e}return t.prototype.postConstruct=function(){var e=this;this.ctrlsService.whenReady(function(){e.gridBodyCtrl=e.ctrlsService.getGridBodyCtrl(),e.initialise()})},t.prototype.initialise=function(){if(this.addManagedListener(this.eventService,Events.EVENT_PAGINATION_CHANGED,this.onPageLoaded.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_PINNED_ROW_DATA_CHANGED,this.onPinnedRowDataChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,this.onDisplayedColumnsChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_BODY_SCROLL,this.onBodyScroll.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_BODY_HEIGHT_CHANGED,this.redraw.bind(this)),this.addManagedPropertyListener("domLayout",this.onDomLayoutChanged.bind(this)),this.addManagedPropertyListener("rowClass",this.redrawRows.bind(this)),this.gridOptionsService.isGroupRowsSticky()){var e=this.rowModel.getType();(e==="clientSide"||e==="serverSide")&&(this.stickyRowFeature=this.createManagedBean(new StickyRowFeature(this.createRowCon.bind(this),this.destroyRowCtrls.bind(this))))}this.registerCellEventListeners(),this.initialiseCache(),this.printLayout=this.gridOptionsService.isDomLayout("print"),this.embedFullWidthRows=this.printLayout||this.gridOptionsService.is("embedFullWidthRows"),this.redrawAfterModelUpdate()},t.prototype.initialiseCache=function(){if(this.gridOptionsService.is("keepDetailRows")){var e=this.getKeepDetailRowsCount(),r=e??3;this.cachedRowCtrls=new RowCtrlCache(r)}},t.prototype.getKeepDetailRowsCount=function(){var e=this.gridOptionsService.getNum("keepDetailRowsCount");return exists(e)&&e>0?e:DEFAULT_KEEP_DETAIL_ROW_COUNT},t.prototype.getRowCtrls=function(){return this.allRowCtrls},t.prototype.getStickyTopRowCtrls=function(){return this.stickyRowFeature?this.stickyRowFeature.getStickyRowCtrls():[]},t.prototype.updateAllRowCtrls=function(){var e=getAllValuesInObject(this.rowCtrlsByRowIndex),r=this.gridOptionsService.is("ensureDomOrder"),o=this.gridOptionsService.isDomLayout("print");(r||o)&&e.sort(function(a,h){return a.getRowNode().rowIndex-h.getRowNode.rowIndex});var s=getAllValuesInObject(this.zombieRowCtrls),l=this.cachedRowCtrls?this.cachedRowCtrls.getEntries():[];this.allRowCtrls=__spreadArray$b(__spreadArray$b(__spreadArray$b([],__read$d(e)),__read$d(s)),__read$d(l))},t.prototype.onCellFocusChanged=function(e){this.getAllCellCtrls().forEach(function(r){return r.onCellFocused(e)}),this.getFullWidthRowCtrls().forEach(function(r){return r.onFullWidthRowFocused(e)})},t.prototype.registerCellEventListeners=function(){var e=this;this.addManagedListener(this.eventService,Events.EVENT_CELL_FOCUSED,function(o){e.onCellFocusChanged(o)}),this.addManagedListener(this.eventService,Events.EVENT_CELL_FOCUS_CLEARED,function(){e.onCellFocusChanged()}),this.addManagedListener(this.eventService,Events.EVENT_FLASH_CELLS,function(o){e.getAllCellCtrls().forEach(function(s){return s.onFlashCells(o)})}),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_HOVER_CHANGED,function(){e.getAllCellCtrls().forEach(function(o){return o.onColumnHover()})}),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,function(){e.getAllCellCtrls().forEach(function(o){return o.onDisplayedColumnsChanged()})}),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED,function(){e.printLayout&&e.getAllCellCtrls().forEach(function(o){return o.onLeftChanged()})});var r=this.gridOptionsService.isEnableRangeSelection();r&&(this.addManagedListener(this.eventService,Events.EVENT_RANGE_SELECTION_CHANGED,function(){e.getAllCellCtrls().forEach(function(o){return o.onRangeSelectionChanged()})}),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_MOVED,function(){e.getAllCellCtrls().forEach(function(o){return o.updateRangeBordersIfRangeCount()})}),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_PINNED,function(){e.getAllCellCtrls().forEach(function(o){return o.updateRangeBordersIfRangeCount()})}),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_VISIBLE,function(){e.getAllCellCtrls().forEach(function(o){return o.updateRangeBordersIfRangeCount()})})),this.refreshListenersToColumnsForCellComps(),this.addManagedListener(this.eventService,Events.EVENT_GRID_COLUMNS_CHANGED,this.refreshListenersToColumnsForCellComps.bind(this)),this.addDestroyFunc(this.removeGridColumnListeners.bind(this))},t.prototype.removeGridColumnListeners=function(){this.destroyFuncsForColumnListeners.forEach(function(e){return e()}),this.destroyFuncsForColumnListeners.length=0},t.prototype.refreshListenersToColumnsForCellComps=function(){var e=this;this.removeGridColumnListeners();var r=this.columnModel.getAllGridColumns();r&&r.forEach(function(o){var s=function(L){e.getAllCellCtrls().forEach(function(Y){Y.getColumn()===o&&L(Y)})},l=function(){s(function(L){return L.onLeftChanged()})},a=function(){s(function(L){return L.onWidthChanged()})},h=function(){s(function(L){return L.onFirstRightPinnedChanged()})},y=function(){s(function(L){return L.onLastLeftPinnedChanged()})},C=function(){s(function(L){return L.onColDefChanged()})};o.addEventListener("leftChanged",l),o.addEventListener("widthChanged",a),o.addEventListener("firstRightPinnedChanged",h),o.addEventListener("lastLeftPinnedChanged",y),o.addEventListener("colDefChanged",C),e.destroyFuncsForColumnListeners.push(function(){o.removeEventListener("leftChanged",l),o.removeEventListener("widthChanged",a),o.removeEventListener("firstRightPinnedChanged",h),o.removeEventListener("lastLeftPinnedChanged",y),o.removeEventListener("colDefChanged",C)})})},t.prototype.onDomLayoutChanged=function(){var e=this.gridOptionsService.isDomLayout("print"),r=e||this.gridOptionsService.is("embedFullWidthRows"),o=r!==this.embedFullWidthRows||this.printLayout!==e;this.printLayout=e,this.embedFullWidthRows=r,o&&this.redrawAfterModelUpdate({domLayoutChanged:!0})},t.prototype.datasourceChanged=function(){this.firstRenderedRow=0,this.lastRenderedRow=-1;var e=Object.keys(this.rowCtrlsByRowIndex);this.removeRowCtrls(e)},t.prototype.onPageLoaded=function(e){var r={recycleRows:e.keepRenderedRows,animate:e.animate,newData:e.newData,newPage:e.newPage,onlyBody:!0};this.redrawAfterModelUpdate(r)},t.prototype.getAllCellsForColumn=function(e){var r=[];return this.getAllRowCtrls().forEach(function(o){var s=o.getCellElement(e);s&&r.push(s)}),r},t.prototype.refreshFloatingRowComps=function(){this.refreshFloatingRows(this.topRowCtrls,this.pinnedRowModel.getPinnedTopRowData()),this.refreshFloatingRows(this.bottomRowCtrls,this.pinnedRowModel.getPinnedBottomRowData())},t.prototype.getTopRowCtrls=function(){return this.topRowCtrls},t.prototype.getBottomRowCtrls=function(){return this.bottomRowCtrls},t.prototype.refreshFloatingRows=function(e,r){var o=this;e.forEach(function(s){s.destroyFirstPass(),s.destroySecondPass()}),e.length=0,r&&r.forEach(function(s){var l=new RowCtrl(s,o.beans,!1,!1,o.printLayout);e.push(l)})},t.prototype.onPinnedRowDataChanged=function(){var e={recycleRows:!0};this.redrawAfterModelUpdate(e)},t.prototype.getRenderedIndexesForRowNodes=function(e){var r=[];return missing(e)||iterateObject(this.rowCtrlsByRowIndex,function(o,s){var l=s.getRowNode();e.indexOf(l)>=0&&r.push(o)}),r},t.prototype.redrawRows=function(e){var r=e!=null&&e.length>0;if(r){var o=this.getRenderedIndexesForRowNodes(e);this.removeRowCtrls(o)}this.redrawAfterModelUpdate({recycleRows:r})},t.prototype.getCellToRestoreFocusToAfterRefresh=function(e){var r=e!=null&&e.suppressKeepFocus?null:this.focusService.getFocusCellToUseAfterRefresh();if(r==null)return null;var o=this.gridOptionsService.getDocument(),s=o.activeElement,l=this.gridOptionsService.getDomData(s,CellCtrl.DOM_DATA_KEY_CELL_CTRL),a=this.gridOptionsService.getDomData(s,RowCtrl.DOM_DATA_KEY_ROW_CTRL),h=l||a;return h?r:null},t.prototype.redrawAfterModelUpdate=function(e){e===void 0&&(e={}),this.getLockOnRefresh();var r=this.getCellToRestoreFocusToAfterRefresh(e);this.updateContainerHeights(),this.scrollToTopIfNewData(e);var o=!e.domLayoutChanged&&!!e.recycleRows,s=e.animate&&this.gridOptionsService.isAnimateRows(),l=o?this.getRowsToRecycle():null;o||this.removeAllRowComps(),this.recycleRows(l,s),this.gridBodyCtrl.updateRowCount(),e.onlyBody||this.refreshFloatingRowComps(),this.dispatchDisplayedRowsChanged(),r!=null&&this.restoreFocusedCell(r),this.releaseLockOnRefresh()},t.prototype.scrollToTopIfNewData=function(e){var r=e.newData||e.newPage,o=this.gridOptionsService.is("suppressScrollOnNewData");r&&!o&&this.gridBodyCtrl.getScrollFeature().scrollToTop()},t.prototype.updateContainerHeights=function(){if(this.printLayout){this.rowContainerHeightService.setModelHeight(null);return}var e=this.paginationProxy.getCurrentPageHeight();e===0&&(e=1),this.rowContainerHeightService.setModelHeight(e)},t.prototype.getLockOnRefresh=function(){if(this.refreshInProgress)throw new Error("AG Grid: cannot get grid to draw rows when it is in the middle of drawing rows. Your code probably called a grid API method while the grid was in the render stage. To overcome this, put the API call into a timeout, e.g. instead of api.redrawRows(), call setTimeout(function() { api.redrawRows(); }, 0). To see what part of your code that caused the refresh check this stacktrace.");this.refreshInProgress=!0},t.prototype.releaseLockOnRefresh=function(){this.refreshInProgress=!1},t.prototype.isRefreshInProgress=function(){return this.refreshInProgress},t.prototype.restoreFocusedCell=function(e){e&&(this.focusService.setRestoreFocusedCell(e),this.onCellFocusChanged({rowIndex:e.rowIndex,column:e.column,rowPinned:e.rowPinned,forceBrowserFocus:!0,preventScrollOnBrowserFocus:!0,api:this.beans.gridApi,columnApi:this.beans.columnApi,context:this.beans.gridOptionsService.context,type:"mock"}))},t.prototype.stopEditing=function(e){e===void 0&&(e=!1),this.getAllRowCtrls().forEach(function(r){r.stopEditing(e)})},t.prototype.getAllCellCtrls=function(){for(var e=[],r=this.getAllRowCtrls(),o=r.length,s=0;s<o;s++)for(var l=r[s].getAllCellCtrls(),a=l.length,h=0;h<a;h++)e.push(l[h]);return e},t.prototype.getAllRowCtrls=function(){var e,r,o=this.stickyRowFeature&&this.stickyRowFeature.getStickyRowCtrls()||[],s=__spreadArray$b(__spreadArray$b(__spreadArray$b([],__read$d(this.topRowCtrls)),__read$d(this.bottomRowCtrls)),__read$d(o));try{for(var l=__values$1(Object.keys(this.rowCtrlsByRowIndex)),a=l.next();!a.done;a=l.next()){var h=a.value;s.push(this.rowCtrlsByRowIndex[h])}}catch(y){e={error:y}}finally{try{a&&!a.done&&(r=l.return)&&r.call(l)}finally{if(e)throw e.error}}return s},t.prototype.addRenderedRowListener=function(e,r,o){var s=this.rowCtrlsByRowIndex[r];s&&s.addEventListener(e,o)},t.prototype.flashCells=function(e){e===void 0&&(e={});var r=e.flashDelay,o=e.fadeDelay;this.getCellCtrls(e.rowNodes,e.columns).forEach(function(s){return s.flashCell({flashDelay:r,fadeDelay:o})})},t.prototype.refreshCells=function(e){e===void 0&&(e={});var r={forceRefresh:e.force,newData:!1,suppressFlash:e.suppressFlash};this.getCellCtrls(e.rowNodes,e.columns).forEach(function(o){if(o.refreshShouldDestroy()){var s=o.getRowCtrl();s&&s.refreshCell(o)}else o.refreshCell(r)}),this.refreshFullWidthRows(e.rowNodes)},t.prototype.getCellRendererInstances=function(e){var r=this,o,s=this.getCellCtrls(e.rowNodes,e.columns).map(function(h){return h.getCellRenderer()}).filter(function(h){return h!=null});if(!((o=e.columns)===null||o===void 0)&&o.length)return s;var l=[],a=this.mapRowNodes(e.rowNodes);return this.getAllRowCtrls().forEach(function(h){if(!(a&&!r.isRowInMap(h.getRowNode(),a))&&h.isFullWidth()){var y=h.getFullWidthCellRenderer();y&&l.push(y)}}),__spreadArray$b(__spreadArray$b([],__read$d(l)),__read$d(s))},t.prototype.getCellEditorInstances=function(e){var r=[];return this.getCellCtrls(e.rowNodes,e.columns).forEach(function(o){var s=o.getCellEditor();s&&r.push(s)}),r},t.prototype.getEditingCells=function(){var e=[];return this.getAllCellCtrls().forEach(function(r){if(r.isEditing()){var o=r.getCellPosition();e.push(o)}}),e},t.prototype.mapRowNodes=function(e){if(e){var r={top:{},bottom:{},normal:{}};return e.forEach(function(o){var s=o.id;o.rowPinned==="top"?r.top[s]=o:o.rowPinned==="bottom"?r.bottom[s]=o:r.normal[s]=o}),r}},t.prototype.isRowInMap=function(e,r){var o=e.id,s=e.rowPinned;return s==="bottom"?r.bottom[o]!=null:s==="top"?r.top[o]!=null:r.normal[o]!=null},t.prototype.getCellCtrls=function(e,r){var o=this,s=this.mapRowNodes(e),l=[],a;exists(r)&&(a={},r.forEach(function(y){var C=o.columnModel.getGridColumn(y);exists(C)&&(a[C.getId()]=!0)}));var h=function(y){var C=y.getRowNode();s!=null&&!o.isRowInMap(C,s)||y.getAllCellCtrls().forEach(function(L){var Y=L.getColumn().getId(),ze=a&&!a[Y];ze||l.push(L)})};return this.getAllRowCtrls().forEach(function(y){return h(y)}),l},t.prototype.destroy=function(){this.removeAllRowComps(),n.prototype.destroy.call(this)},t.prototype.removeAllRowComps=function(){var e=Object.keys(this.rowCtrlsByRowIndex);this.removeRowCtrls(e)},t.prototype.getRowsToRecycle=function(){var e=[];iterateObject(this.rowCtrlsByRowIndex,function(o,s){var l=s.getRowNode().id==null;l&&e.push(o)}),this.removeRowCtrls(e);var r={};return iterateObject(this.rowCtrlsByRowIndex,function(o,s){var l=s.getRowNode();r[l.id]=s}),this.rowCtrlsByRowIndex={},r},t.prototype.removeRowCtrls=function(e){var r=this;e.forEach(function(o){var s=r.rowCtrlsByRowIndex[o];s&&(s.destroyFirstPass(),s.destroySecondPass()),delete r.rowCtrlsByRowIndex[o]})},t.prototype.onBodyScroll=function(e){e.direction==="vertical"&&this.redraw()},t.prototype.redraw=function(e){e===void 0&&(e=!0);var r;if(this.stickyRowFeature&&browserSupportsPreventScroll()&&(r=this.getCellToRestoreFocusToAfterRefresh()||void 0),this.getLockOnRefresh(),this.recycleRows(null,!1,e),this.releaseLockOnRefresh(),this.dispatchDisplayedRowsChanged(e),r!=null){var o=this.getCellToRestoreFocusToAfterRefresh();r!=null&&o==null&&(this.animationFrameService.flushAllFrames(),this.restoreFocusedCell(r))}},t.prototype.removeRowCompsNotToDraw=function(e){var r={};e.forEach(function(l){return r[l]=!0});var o=Object.keys(this.rowCtrlsByRowIndex),s=o.filter(function(l){return!r[l]});this.removeRowCtrls(s)},t.prototype.calculateIndexesToDraw=function(e){var r=this,o=createArrayOfNumbers(this.firstRenderedRow,this.lastRenderedRow),s=function(l,a){var h=a.getRowNode().rowIndex;h!=null&&(h<r.firstRenderedRow||h>r.lastRenderedRow)&&r.doNotUnVirtualiseRow(a)&&o.push(h)};return iterateObject(this.rowCtrlsByRowIndex,s),iterateObject(e,s),o.sort(function(l,a){return l-a}),o=o.filter(function(l){var a=r.paginationProxy.getRow(l);return a&&!a.sticky}),o},t.prototype.recycleRows=function(e,r,o){var s=this;r===void 0&&(r=!1),o===void 0&&(o=!1),this.rowContainerHeightService.updateOffset(),this.workOutFirstAndLastRowsToRender(),this.stickyRowFeature&&this.stickyRowFeature.checkStickyRows();var l=this.calculateIndexesToDraw(e);if(this.removeRowCompsNotToDraw(l),this.printLayout&&(r=!1),l.forEach(function(h){var y=s.createOrUpdateRowCtrl(h,e,r,o);exists(y)}),e){var a=o&&!this.gridOptionsService.is("suppressAnimationFrame")&&!this.printLayout;a?this.beans.animationFrameService.addDestroyTask(function(){s.destroyRowCtrls(e,r),s.updateAllRowCtrls(),s.dispatchDisplayedRowsChanged()}):this.destroyRowCtrls(e,r)}this.updateAllRowCtrls()},t.prototype.dispatchDisplayedRowsChanged=function(e){e===void 0&&(e=!1);var r={type:Events.EVENT_DISPLAYED_ROWS_CHANGED,afterScroll:e};this.eventService.dispatchEvent(r)},t.prototype.onDisplayedColumnsChanged=function(){var e=this.columnModel.isPinningLeft(),r=this.columnModel.isPinningRight(),o=this.pinningLeft!==e||r!==this.pinningRight;o&&(this.pinningLeft=e,this.pinningRight=r,this.embedFullWidthRows&&this.redrawFullWidthEmbeddedRows())},t.prototype.redrawFullWidthEmbeddedRows=function(){var e=[];this.getFullWidthRowCtrls().forEach(function(r){var o=r.getRowNode().rowIndex;e.push(o.toString())}),this.refreshFloatingRowComps(),this.removeRowCtrls(e),this.redraw()},t.prototype.getFullWidthRowCtrls=function(e){var r=this,o=this.mapRowNodes(e);return this.getAllRowCtrls().filter(function(s){if(!s.isFullWidth())return!1;var l=s.getRowNode();return!(o!=null&&!r.isRowInMap(l,o))})},t.prototype.refreshFullWidthRow=function(e){this.refreshFullWidthRows([e])},t.prototype.refreshFullWidthRows=function(e){var r=this,o=this.getFullWidthRowCtrls(e),s=!1,l=[];o.forEach(function(a){var h=a.refreshFullWidth();if(!h){var y=a.getRowNode();y.sticky?r.stickyRowFeature.refreshStickyNode(y):l.push(y.rowIndex),s=!0}}),l.length>0&&this.removeRowCtrls(l),s&&this.redraw(!1)},t.prototype.createOrUpdateRowCtrl=function(e,r,o,s){var l,a=this.rowCtrlsByRowIndex[e];a||(l=this.paginationProxy.getRow(e),exists(l)&&exists(r)&&r[l.id]&&l.alreadyRendered&&(a=r[l.id],r[l.id]=null));var h=!a;if(h)if(l||(l=this.paginationProxy.getRow(e)),exists(l))a=this.createRowCon(l,o,s);else return;return l&&(l.alreadyRendered=!0),this.rowCtrlsByRowIndex[e]=a,a},t.prototype.destroyRowCtrls=function(e,r){var o=this,s=[];iterateObject(e,function(l,a){if(a){if(o.cachedRowCtrls&&a.isCacheable()){o.cachedRowCtrls.addRow(a);return}a.destroyFirstPass(),r?(o.zombieRowCtrls[a.getInstanceId()]=a,s.push(function(){a.destroySecondPass(),delete o.zombieRowCtrls[a.getInstanceId()]})):a.destroySecondPass()}}),r&&(s.push(function(){o.updateAllRowCtrls(),o.dispatchDisplayedRowsChanged()}),executeInAWhile(s))},t.prototype.getRowBuffer=function(){var e=this.gridOptionsService.getNum("rowBuffer");return typeof e=="number"?e<0&&(doOnce(function(){return console.warn("AG Grid: rowBuffer should not be negative")},"warn rowBuffer negative"),e=0,this.gridOptionsService.set("rowBuffer",0)):e=10,e},t.prototype.getRowBufferInPixels=function(){var e=this.getRowBuffer(),r=this.gridOptionsService.getRowHeightAsNumber();return e*r},t.prototype.workOutFirstAndLastRowsToRender=function(){var e,r;if(!this.paginationProxy.isRowsToRender())e=0,r=-1;else if(this.printLayout)e=this.paginationProxy.getPageFirstRow(),r=this.paginationProxy.getPageLastRow();else{var o=this.getRowBufferInPixels(),s=this.ctrlsService.getGridBodyCtrl(),l=this.gridOptionsService.is("suppressRowVirtualisation"),a=!1,h=void 0,y=void 0;do{var C=this.paginationProxy.getPixelOffset(),L=this.paginationProxy.getCurrentPagePixelRange(),Y=L.pageFirstPixel,ze=L.pageLastPixel,Bt=this.rowContainerHeightService.getDivStretchOffset(),Ir=s.getScrollFeature().getVScrollPosition(),Wr=Ir.top,yi=Ir.bottom;l?(h=Y+Bt,y=ze+Bt):(h=Math.max(Wr+C-o,Y)+Bt,y=Math.min(yi+C+o,ze)+Bt),this.firstVisibleVPixel=Math.max(Wr+C,Y)+Bt,a=this.ensureAllRowsInRangeHaveHeightsCalculated(h,y)}while(a);var Bn=this.paginationProxy.getRowIndexAtPixel(h),vi=this.paginationProxy.getRowIndexAtPixel(y),wo=this.paginationProxy.getPageFirstRow(),ia=this.paginationProxy.getPageLastRow();Bn<wo&&(Bn=wo),vi>ia&&(vi=ia),e=Bn,r=vi}var gl=this.gridOptionsService.isDomLayout("normal"),ml=this.gridOptionsService.is("suppressMaxRenderedRowRestriction"),il=Math.max(this.getRowBuffer(),500);gl&&!ml&&r-e>il&&(r=e+il);var sl=e!==this.firstRenderedRow,ol=r!==this.lastRenderedRow;if(sl||ol){this.firstRenderedRow=e,this.lastRenderedRow=r;var _l={type:Events.EVENT_VIEWPORT_CHANGED,firstRow:e,lastRow:r};this.eventService.dispatchEvent(_l)}},t.prototype.dispatchFirstDataRenderedEvent=function(){var e=this;if(!this.dataFirstRenderedFired){this.dataFirstRenderedFired=!0;var r={type:Events.EVENT_FIRST_DATA_RENDERED,firstRow:this.firstRenderedRow,lastRow:this.lastRenderedRow};window.requestAnimationFrame(function(){e.beans.eventService.dispatchEvent(r)})}},t.prototype.ensureAllRowsInRangeHaveHeightsCalculated=function(e,r){var o=this.paginationProxy.ensureRowHeightsValid(e,r,-1,-1);return o&&this.updateContainerHeights(),o},t.prototype.getFirstVisibleVerticalPixel=function(){return this.firstVisibleVPixel},t.prototype.getFirstVirtualRenderedRow=function(){return this.firstRenderedRow},t.prototype.getLastVirtualRenderedRow=function(){return this.lastRenderedRow},t.prototype.doNotUnVirtualiseRow=function(e){var r=!1,o=!0,s=e.getRowNode(),l=this.focusService.isRowNodeFocused(s),a=e.isEditing(),h=s.detail,y=l||a||h;if(!y)return r;var C=this.paginationProxy.isRowPresent(s);return C?o:r},t.prototype.createRowCon=function(e,r,o){var s=this.cachedRowCtrls?this.cachedRowCtrls.getRow(e):null;if(s)return s;var l=this.gridOptionsService.is("suppressAnimationFrame"),a=o&&!l&&!this.printLayout,h=new RowCtrl(e,this.beans,r,a,this.printLayout);return h},t.prototype.getRenderedNodes=function(){var e=this.rowCtrlsByRowIndex;return Object.keys(e).map(function(r){return e[r].getRowNode()})},t.prototype.getRowByPosition=function(e){var r,o=e.rowIndex;switch(e.rowPinned){case"top":r=this.topRowCtrls[o];break;case"bottom":r=this.bottomRowCtrls[o];break;default:r=this.rowCtrlsByRowIndex[o],r||(r=this.getStickyTopRowCtrls().find(function(s){return s.getRowNode().rowIndex===o})||null);break}return r},t.prototype.getRowNode=function(e){switch(e.rowPinned){case"top":return this.pinnedRowModel.getPinnedTopRowData()[e.rowIndex];case"bottom":return this.pinnedRowModel.getPinnedBottomRowData()[e.rowIndex];default:return this.rowModel.getRow(e.rowIndex)}},t.prototype.isRangeInRenderedViewport=function(e,r){var o=e==null||r==null;if(o)return!1;var s=e>this.lastRenderedRow,l=r<this.firstRenderedRow,a=!l&&!s;return a},__decorate$13([Autowired("animationFrameService")],t.prototype,"animationFrameService",void 0),__decorate$13([Autowired("paginationProxy")],t.prototype,"paginationProxy",void 0),__decorate$13([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$13([Autowired("pinnedRowModel")],t.prototype,"pinnedRowModel",void 0),__decorate$13([Autowired("rowModel")],t.prototype,"rowModel",void 0),__decorate$13([Autowired("focusService")],t.prototype,"focusService",void 0),__decorate$13([Autowired("beans")],t.prototype,"beans",void 0),__decorate$13([Autowired("rowContainerHeightService")],t.prototype,"rowContainerHeightService",void 0),__decorate$13([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),__decorate$13([PostConstruct],t.prototype,"postConstruct",null),t=__decorate$13([Bean("rowRenderer")],t),t}(BeanStub),RowCtrlCache=function(){function n(t){this.entriesMap={},this.entriesList=[],this.maxCount=t}return n.prototype.addRow=function(t){if(this.entriesMap[t.getRowNode().id]=t,this.entriesList.push(t),t.setCached(!0),this.entriesList.length>this.maxCount){var e=this.entriesList[0];e.destroyFirstPass(),e.destroySecondPass(),this.removeFromCache(e)}},n.prototype.getRow=function(t){if(t==null||t.id==null)return null;var e=this.entriesMap[t.id];if(!e)return null;this.removeFromCache(e),e.setCached(!1);var r=e.getRowNode()!=t;return r?null:e},n.prototype.removeFromCache=function(t){var e=t.getRowNode().id;delete this.entriesMap[e],removeFromArray(this.entriesList,t)},n.prototype.getEntries=function(){return this.entriesList},n}(),__extends$16=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$12=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},ValueFormatterService=function(n){__extends$16(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.formatValue=function(e,r,o,s,l){l===void 0&&(l=!0);var a=null,h,y=e.getColDef();if(s?h=s:l&&(h=y.valueFormatter),h){var C={value:o,node:r,data:r?r.data:null,colDef:y,column:e,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context};typeof h=="function"?a=h(C):a=this.expressionService.evaluate(h,C)}else if(y.refData)return y.refData[o]||"";return a==null&&Array.isArray(o)&&(a=o.join(", ")),a},__decorate$12([Autowired("expressionService")],t.prototype,"expressionService",void 0),t=__decorate$12([Bean("valueFormatterService")],t),t}(BeanStub),__extends$15=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$11=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},PinnedRowModel=function(n){__extends$15(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.init=function(){this.setPinnedTopRowData(this.gridOptionsService.get("pinnedTopRowData")),this.setPinnedBottomRowData(this.gridOptionsService.get("pinnedBottomRowData"))},t.prototype.isEmpty=function(e){var r=e==="top"?this.pinnedTopRows:this.pinnedBottomRows;return missingOrEmpty(r)},t.prototype.isRowsToRender=function(e){return!this.isEmpty(e)},t.prototype.getRowAtPixel=function(e,r){var o=r==="top"?this.pinnedTopRows:this.pinnedBottomRows;if(missingOrEmpty(o))return 0;for(var s=0;s<o.length;s++){var l=o[s],a=l.rowTop+l.rowHeight-1;if(a>=e)return s}return o.length-1},t.prototype.setPinnedTopRowData=function(e){this.pinnedTopRows=this.createNodesFromData(e,!0);var r={type:Events.EVENT_PINNED_ROW_DATA_CHANGED};this.eventService.dispatchEvent(r)},t.prototype.setPinnedBottomRowData=function(e){this.pinnedBottomRows=this.createNodesFromData(e,!1);var r={type:Events.EVENT_PINNED_ROW_DATA_CHANGED};this.eventService.dispatchEvent(r)},t.prototype.createNodesFromData=function(e,r){var o=this,s=[];if(e){var l=0;e.forEach(function(a,h){var y=new RowNode(o.beans);y.data=a;var C=r?RowNode.ID_PREFIX_TOP_PINNED:RowNode.ID_PREFIX_BOTTOM_PINNED;y.id=C+h,y.rowPinned=r?"top":"bottom",y.setRowTop(l),y.setRowHeight(o.gridOptionsService.getRowHeightForNode(y).height),y.setRowIndex(h),l+=y.rowHeight,s.push(y)})}return s},t.prototype.getPinnedTopRowData=function(){return this.pinnedTopRows},t.prototype.getPinnedBottomRowData=function(){return this.pinnedBottomRows},t.prototype.getPinnedTopTotalHeight=function(){return this.getTotalHeight(this.pinnedTopRows)},t.prototype.getPinnedTopRowCount=function(){return this.pinnedTopRows?this.pinnedTopRows.length:0},t.prototype.getPinnedBottomRowCount=function(){return this.pinnedBottomRows?this.pinnedBottomRows.length:0},t.prototype.getPinnedTopRow=function(e){return this.pinnedTopRows[e]},t.prototype.getPinnedBottomRow=function(e){return this.pinnedBottomRows[e]},t.prototype.forEachPinnedTopRow=function(e){missingOrEmpty(this.pinnedTopRows)||this.pinnedTopRows.forEach(e)},t.prototype.forEachPinnedBottomRow=function(e){missingOrEmpty(this.pinnedBottomRows)||this.pinnedBottomRows.forEach(e)},t.prototype.getPinnedBottomTotalHeight=function(){return this.getTotalHeight(this.pinnedBottomRows)},t.prototype.getTotalHeight=function(e){if(!e||e.length===0)return 0;var r=last(e);return r.rowTop+r.rowHeight},__decorate$11([Autowired("beans")],t.prototype,"beans",void 0),__decorate$11([PostConstruct],t.prototype,"init",null),t=__decorate$11([Bean("pinnedRowModel")],t),t}(BeanStub),ServerSideTransactionResultStatus;(function(n){n.Applied="Applied",n.StoreNotFound="StoreNotFound",n.StoreLoading="StoreLoading",n.StoreWaitingToLoad="StoreWaitingToLoad",n.StoreLoadingFailed="StoreLoadingFailed",n.StoreWrongType="StoreWrongType",n.Cancelled="Cancelled"})(ServerSideTransactionResultStatus||(ServerSideTransactionResultStatus={}));var ChangedPath=function(){function n(t,e){this.active=!0,this.nodeIdsToColumns={},this.mapToItems={},this.keepingColumns=t,this.pathRoot={rowNode:e,children:null},this.mapToItems[e.id]=this.pathRoot}return n.prototype.setInactive=function(){this.active=!1},n.prototype.isActive=function(){return this.active},n.prototype.depthFirstSearchChangedPath=function(t,e){if(t.children)for(var r=0;r<t.children.length;r++)this.depthFirstSearchChangedPath(t.children[r],e);e(t.rowNode)},n.prototype.depthFirstSearchEverything=function(t,e,r){if(t.childrenAfterGroup)for(var o=0;o<t.childrenAfterGroup.length;o++){var s=t.childrenAfterGroup[o];s.childrenAfterGroup?this.depthFirstSearchEverything(t.childrenAfterGroup[o],e,r):r&&e(s)}e(t)},n.prototype.forEachChangedNodeDepthFirst=function(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!1),this.active&&!r?this.depthFirstSearchChangedPath(this.pathRoot,t):this.depthFirstSearchEverything(this.pathRoot.rowNode,t,e)},n.prototype.executeFromRootNode=function(t){t(this.pathRoot.rowNode)},n.prototype.createPathItems=function(t){for(var e=t,r=0;!this.mapToItems[e.id];){var o={rowNode:e,children:null};this.mapToItems[e.id]=o,r++,e=e.parent}return r},n.prototype.populateColumnsMap=function(t,e){var r=this;if(!(!this.keepingColumns||!e))for(var o=t;o;)this.nodeIdsToColumns[o.id]||(this.nodeIdsToColumns[o.id]={}),e.forEach(function(s){return r.nodeIdsToColumns[o.id][s.getId()]=!0}),o=o.parent},n.prototype.linkPathItems=function(t,e){for(var r=t,o=0;o<e;o++){var s=this.mapToItems[r.id],l=this.mapToItems[r.parent.id];l.children||(l.children=[]),l.children.push(s),r=r.parent}},n.prototype.addParentNode=function(t,e){if(!(!t||t.isRowPinned())){var r=this.createPathItems(t);this.linkPathItems(t,r),this.populateColumnsMap(t,e)}},n.prototype.canSkip=function(t){return this.active&&!this.mapToItems[t.id]},n.prototype.getValueColumnsForNode=function(t,e){if(!this.keepingColumns)return e;var r=this.nodeIdsToColumns[t.id],o=e.filter(function(s){return r[s.getId()]});return o},n.prototype.getNotValueColumnsForNode=function(t,e){if(!this.keepingColumns)return null;var r=this.nodeIdsToColumns[t.id],o=e.filter(function(s){return!r[s.getId()]});return o},n}(),__extends$14=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),RowNodeBlock=function(n){__extends$14(t,n);function t(e){var r=n.call(this)||this;return r.state=t.STATE_WAITING_TO_LOAD,r.version=0,r.id=e,r}return t.prototype.getId=function(){return this.id},t.prototype.load=function(){this.state=t.STATE_LOADING,this.loadFromDatasource()},t.prototype.getVersion=function(){return this.version},t.prototype.setStateWaitingToLoad=function(){this.version++,this.state=t.STATE_WAITING_TO_LOAD},t.prototype.getState=function(){return this.state},t.prototype.pageLoadFailed=function(e){var r=this.isRequestMostRecentAndLive(e);r&&(this.state=t.STATE_FAILED,this.processServerFail()),this.dispatchLoadCompleted(!1)},t.prototype.success=function(e,r){this.successCommon(e,r)},t.prototype.pageLoaded=function(e,r,o){this.successCommon(e,{rowData:r,rowCount:o})},t.prototype.isRequestMostRecentAndLive=function(e){var r=e===this.version,o=this.isAlive();return r&&o},t.prototype.successCommon=function(e,r){this.dispatchLoadCompleted();var o=this.isRequestMostRecentAndLive(e);o&&(this.state=t.STATE_LOADED,this.processServerResult(r))},t.prototype.dispatchLoadCompleted=function(e){e===void 0&&(e=!0);var r={type:t.EVENT_LOAD_COMPLETE,success:e,block:this};this.dispatchEvent(r)},t.EVENT_LOAD_COMPLETE="loadComplete",t.STATE_WAITING_TO_LOAD="needsLoading",t.STATE_LOADING="loading",t.STATE_LOADED="loaded",t.STATE_FAILED="failed",t}(BeanStub),__extends$13=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$10=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__param$7=function(n,t){return function(e,r){t(e,r,n)}},RowNodeBlockLoader=function(n){__extends$13(t,n);function t(){var r=n!==null&&n.apply(this,arguments)||this;return r.activeBlockLoadsCount=0,r.blocks=[],r.active=!0,r}e=t,t.prototype.postConstruct=function(){this.maxConcurrentRequests=this.getMaxConcurrentDatasourceRequests();var r=this.gridOptionsService.getNum("blockLoadDebounceMillis");r&&r>0&&(this.checkBlockToLoadDebounce=_.debounce(this.performCheckBlocksToLoad.bind(this),r))},t.prototype.setBeans=function(r){this.logger=r.create("RowNodeBlockLoader")},t.prototype.getMaxConcurrentDatasourceRequests=function(){var r=this.gridOptionsService.getNum("maxConcurrentDatasourceRequests");if(r==null)return 2;if(!(r<=0))return r},t.prototype.addBlock=function(r){this.blocks.push(r),r.addEventListener(RowNodeBlock.EVENT_LOAD_COMPLETE,this.loadComplete.bind(this)),this.checkBlockToLoad()},t.prototype.removeBlock=function(r){_.removeFromArray(this.blocks,r)},t.prototype.destroy=function(){n.prototype.destroy.call(this),this.active=!1},t.prototype.loadComplete=function(){this.activeBlockLoadsCount--,this.checkBlockToLoad(),this.dispatchEvent({type:e.BLOCK_LOADED_EVENT}),this.activeBlockLoadsCount==0&&this.dispatchEvent({type:e.BLOCK_LOADER_FINISHED_EVENT})},t.prototype.checkBlockToLoad=function(){this.checkBlockToLoadDebounce?this.checkBlockToLoadDebounce():this.performCheckBlocksToLoad()},t.prototype.performCheckBlocksToLoad=function(){if(this.active){if(this.printCacheStatus(),this.maxConcurrentRequests!=null&&this.activeBlockLoadsCount>=this.maxConcurrentRequests){this.logger.log("checkBlockToLoad: max loads exceeded");return}var r=this.getAvailableLoadingCount(),o=this.blocks.filter(function(s){return s.getState()===RowNodeBlock.STATE_WAITING_TO_LOAD}).slice(0,r);this.registerLoads(o.length),o.forEach(function(s){return s.load()}),this.printCacheStatus()}},t.prototype.getBlockState=function(){if(this.gridOptionsService.isRowModelType("serverSide")){var r=this.rowModel;return r.getBlockStates()}var o={};return this.blocks.forEach(function(s){var l=s.getBlockStateJson(),a=l.id,h=l.state;o[a]=h}),o},t.prototype.printCacheStatus=function(){this.logger.isLogging()&&this.logger.log("printCacheStatus: activePageLoadsCount = "+this.activeBlockLoadsCount+","+(" blocks = "+JSON.stringify(this.getBlockState())))},t.prototype.isLoading=function(){return this.activeBlockLoadsCount>0},t.prototype.registerLoads=function(r){this.activeBlockLoadsCount+=r},t.prototype.getAvailableLoadingCount=function(){return this.maxConcurrentRequests!==void 0?this.maxConcurrentRequests-this.activeBlockLoadsCount:void 0};var e;return t.BLOCK_LOADED_EVENT="blockLoaded",t.BLOCK_LOADER_FINISHED_EVENT="blockLoaderFinished",__decorate$10([Autowired("rowModel")],t.prototype,"rowModel",void 0),__decorate$10([PostConstruct],t.prototype,"postConstruct",null),__decorate$10([__param$7(0,Qualifier("loggerFactory"))],t.prototype,"setBeans",null),t=e=__decorate$10([Bean("rowNodeBlockLoader")],t),t}(BeanStub),__extends$12=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$$=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},PaginationProxy=function(n){__extends$12(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.currentPage=0,e.topDisplayedRowIndex=0,e.bottomDisplayedRowIndex=0,e.pixelOffset=0,e.masterRowCount=0,e}return t.prototype.postConstruct=function(){this.active=this.gridOptionsService.is("pagination"),this.paginateChildRows=this.isPaginateChildRows(),this.addManagedListener(this.eventService,Events.EVENT_MODEL_UPDATED,this.onModelUpdated.bind(this)),this.addManagedPropertyListener("pagination",this.onPaginationPageSizeChanged.bind(this)),this.addManagedPropertyListener("paginationPageSize",this.onPaginationPageSizeChanged.bind(this)),this.onModelUpdated()},t.prototype.ensureRowHeightsValid=function(e,r,o,s){var l=this.rowModel.ensureRowHeightsValid(e,r,this.getPageFirstRow(),this.getPageLastRow());return l&&this.calculatePages(),l},t.prototype.isPaginateChildRows=function(){var e=this.gridOptionsService.is("groupRemoveSingleChildren")||this.gridOptionsService.is("groupRemoveLowestSingleChildren");return e?!0:this.gridOptionsService.is("paginateChildRows")},t.prototype.onModelUpdated=function(e){this.calculatePages();var r={type:Events.EVENT_PAGINATION_CHANGED,animate:e?e.animate:!1,newData:e?e.newData:!1,newPage:e?e.newPage:!1,keepRenderedRows:e?e.keepRenderedRows:!1};this.eventService.dispatchEvent(r)},t.prototype.onPaginationPageSizeChanged=function(){this.active=this.gridOptionsService.is("pagination"),this.calculatePages();var e={type:Events.EVENT_PAGINATION_CHANGED,animate:!1,newData:!1,newPage:!1,keepRenderedRows:!0};this.eventService.dispatchEvent(e)},t.prototype.goToPage=function(e){if(!(!this.active||this.currentPage===e||typeof this.currentPage!="number")){this.currentPage=e;var r={type:Events.EVENT_MODEL_UPDATED,animate:!1,keepRenderedRows:!1,newData:!1,newPage:!0};this.onModelUpdated(r)}},t.prototype.getPixelOffset=function(){return this.pixelOffset},t.prototype.getRow=function(e){return this.rowModel.getRow(e)},t.prototype.getRowNode=function(e){return this.rowModel.getRowNode(e)},t.prototype.getRowIndexAtPixel=function(e){return this.rowModel.getRowIndexAtPixel(e)},t.prototype.getCurrentPageHeight=function(){return missing(this.topRowBounds)||missing(this.bottomRowBounds)?0:Math.max(this.bottomRowBounds.rowTop+this.bottomRowBounds.rowHeight-this.topRowBounds.rowTop,0)},t.prototype.getCurrentPagePixelRange=function(){var e=this.topRowBounds?this.topRowBounds.rowTop:0,r=this.bottomRowBounds?this.bottomRowBounds.rowTop+this.bottomRowBounds.rowHeight:0;return{pageFirstPixel:e,pageLastPixel:r}},t.prototype.isRowPresent=function(e){if(!this.rowModel.isRowPresent(e))return!1;var r=e.rowIndex>=this.topDisplayedRowIndex&&e.rowIndex<=this.bottomDisplayedRowIndex;return r},t.prototype.isEmpty=function(){return this.rowModel.isEmpty()},t.prototype.isRowsToRender=function(){return this.rowModel.isRowsToRender()},t.prototype.forEachNode=function(e){return this.rowModel.forEachNode(e)},t.prototype.forEachNodeOnPage=function(e){for(var r=this.getPageFirstRow(),o=this.getPageLastRow(),s=r;s<=o;s++){var l=this.getRow(s);l&&e(l)}},t.prototype.getType=function(){return this.rowModel.getType()},t.prototype.getRowBounds=function(e){var r=this.rowModel.getRowBounds(e);return r.rowIndex=e,r},t.prototype.getPageFirstRow=function(){return this.topRowBounds?this.topRowBounds.rowIndex:-1},t.prototype.getPageLastRow=function(){return this.bottomRowBounds?this.bottomRowBounds.rowIndex:-1},t.prototype.getRowCount=function(){return this.rowModel.getRowCount()},t.prototype.getPageForIndex=function(e){return Math.floor(e/this.pageSize)},t.prototype.goToPageWithIndex=function(e){if(this.active){var r=this.getPageForIndex(e);this.goToPage(r)}},t.prototype.isRowInPage=function(e){if(!this.active)return!0;var r=this.getPageForIndex(e.rowIndex);return r===this.currentPage},t.prototype.isLastPageFound=function(){return this.rowModel.isLastRowIndexKnown()},t.prototype.getCurrentPage=function(){return this.currentPage},t.prototype.goToNextPage=function(){this.goToPage(this.currentPage+1)},t.prototype.goToPreviousPage=function(){this.goToPage(this.currentPage-1)},t.prototype.goToFirstPage=function(){this.goToPage(0)},t.prototype.goToLastPage=function(){var e=this.rowModel.getRowCount(),r=Math.floor(e/this.pageSize);this.goToPage(r)},t.prototype.getPageSize=function(){return this.pageSize},t.prototype.getTotalPages=function(){return this.totalPages},t.prototype.setPageSize=function(){this.pageSize=this.gridOptionsService.getNum("paginationPageSize"),(this.pageSize==null||this.pageSize<1)&&(this.pageSize=100)},t.prototype.calculatePages=function(){this.active?(this.setPageSize(),this.paginateChildRows?this.calculatePagesAllRows():this.calculatePagesMasterRowsOnly()):this.calculatedPagesNotActive(),this.topRowBounds=this.rowModel.getRowBounds(this.topDisplayedRowIndex),this.topRowBounds&&(this.topRowBounds.rowIndex=this.topDisplayedRowIndex),this.bottomRowBounds=this.rowModel.getRowBounds(this.bottomDisplayedRowIndex),this.bottomRowBounds&&(this.bottomRowBounds.rowIndex=this.bottomDisplayedRowIndex),this.setPixelOffset(exists(this.topRowBounds)?this.topRowBounds.rowTop:0)},t.prototype.setPixelOffset=function(e){this.pixelOffset!==e&&(this.pixelOffset=e,this.eventService.dispatchEvent({type:Events.EVENT_PAGINATION_PIXEL_OFFSET_CHANGED}))},t.prototype.setZeroRows=function(){this.masterRowCount=0,this.topDisplayedRowIndex=0,this.bottomDisplayedRowIndex=-1,this.currentPage=0,this.totalPages=0},t.prototype.adjustCurrentPageIfInvalid=function(){this.currentPage>=this.totalPages&&(this.currentPage=this.totalPages-1),(!isFinite(this.currentPage)||isNaN(this.currentPage)||this.currentPage<0)&&(this.currentPage=0)},t.prototype.calculatePagesMasterRowsOnly=function(){if(this.masterRowCount=this.rowModel.getTopLevelRowCount(),this.masterRowCount<=0){this.setZeroRows();return}var e=this.masterRowCount-1;this.totalPages=Math.floor(e/this.pageSize)+1,this.adjustCurrentPageIfInvalid();var r=this.pageSize*this.currentPage,o=this.pageSize*(this.currentPage+1)-1;if(o>e&&(o=e),this.topDisplayedRowIndex=this.rowModel.getTopLevelRowDisplayedIndex(r),o===e)this.bottomDisplayedRowIndex=this.rowModel.getRowCount()-1;else{var s=this.rowModel.getTopLevelRowDisplayedIndex(o+1);this.bottomDisplayedRowIndex=s-1}},t.prototype.getMasterRowCount=function(){return this.masterRowCount},t.prototype.calculatePagesAllRows=function(){if(this.masterRowCount=this.rowModel.getRowCount(),this.masterRowCount===0){this.setZeroRows();return}var e=this.masterRowCount-1;this.totalPages=Math.floor(e/this.pageSize)+1,this.adjustCurrentPageIfInvalid(),this.topDisplayedRowIndex=this.pageSize*this.currentPage,this.bottomDisplayedRowIndex=this.pageSize*(this.currentPage+1)-1,this.bottomDisplayedRowIndex>e&&(this.bottomDisplayedRowIndex=e)},t.prototype.calculatedPagesNotActive=function(){this.pageSize=this.rowModel.getRowCount(),this.totalPages=1,this.currentPage=0,this.topDisplayedRowIndex=0,this.bottomDisplayedRowIndex=this.rowModel.getRowCount()-1},__decorate$$([Autowired("rowModel")],t.prototype,"rowModel",void 0),__decorate$$([PostConstruct],t.prototype,"postConstruct",null),t=__decorate$$([Bean("paginationProxy")],t),t}(BeanStub),__extends$11=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$_=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},StylingService=function(n){__extends$11(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.processAllCellClasses=function(e,r,o,s){this.processClassRules(e.cellClassRules,r,o,s),this.processStaticCellClasses(e,r,o)},t.prototype.processClassRules=function(e,r,o,s){if(e!=null){for(var l=Object.keys(e),a={},h={},y=function(Y){var ze=l[Y],Bt=e[ze],Ir;typeof Bt=="string"?Ir=C.expressionService.evaluate(Bt,r):typeof Bt=="function"&&(Ir=Bt(r)),ze.split(" ").forEach(function(Wr){Wr==null||Wr.trim()==""||(Ir?a[Wr]=!0:h[Wr]=!0)})},C=this,L=0;L<l.length;L++)y(L);s&&Object.keys(h).forEach(s),Object.keys(a).forEach(o)}},t.prototype.getStaticCellClasses=function(e,r){var o=e.cellClass;if(!o)return[];var s;if(typeof o=="function"){var l=o;s=l(r)}else s=o;return typeof s=="string"&&(s=[s]),s||[]},t.prototype.processStaticCellClasses=function(e,r,o){var s=this.getStaticCellClasses(e,r);s.forEach(function(l){o(l)})},__decorate$_([Autowired("expressionService")],t.prototype,"expressionService",void 0),t=__decorate$_([Bean("stylingService")],t),t}(BeanStub),__extends$10=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),AgToggleButton=function(n){__extends$10(t,n);function t(e){return n.call(this,e,"ag-toggle-button")||this}return t.prototype.setValue=function(e,r){return n.prototype.setValue.call(this,e,r),this.addOrRemoveCssClass("ag-selected",this.getValue()),this},t}(AgCheckbox),__extends$$=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),AgInputTextArea=function(n){__extends$$(t,n);function t(e){return n.call(this,e,"ag-text-area",null,"textarea")||this}return t.prototype.setValue=function(e,r){var o=n.prototype.setValue.call(this,e,r);return this.eInput.value=e,o},t.prototype.setCols=function(e){return this.eInput.cols=e,this},t.prototype.setRows=function(e){return this.eInput.rows=e,this},t}(AgAbstractInputField),__extends$_=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),AgInputDateField=function(n){__extends$_(t,n);function t(e){return n.call(this,e,"ag-date-field","date")||this}return t.prototype.postConstruct=function(){var e=this;n.prototype.postConstruct.call(this),this.addManagedListener(this.eInput,"wheel",this.onWheel.bind(this));var r=isBrowserSafari();this.addManagedListener(this.eInput,"mousedown",function(){e.isDisabled()||r||e.eInput.focus()}),this.eInput.step="any"},t.prototype.onWheel=function(e){document.activeElement===this.eInput&&e.preventDefault()},t.prototype.setMin=function(e){var r,o=e instanceof Date?(r=serialiseDate(e??null,!1))!==null&&r!==void 0?r:void 0:e;return this.min===o?this:(this.min=o,addOrRemoveAttribute(this.eInput,"min",o),this)},t.prototype.setMax=function(e){var r,o=e instanceof Date?(r=serialiseDate(e??null,!1))!==null&&r!==void 0?r:void 0:e;return this.max===o?this:(this.max=o,addOrRemoveAttribute(this.eInput,"max",o),this)},t.prototype.setStep=function(e){return this.step===e?this:(this.step=e,addOrRemoveAttribute(this.eInput,"step",e),this)},t.prototype.getDate=function(){var e;if(this.eInput.validity.valid)return(e=parseDateTimeFromString(this.getValue()))!==null&&e!==void 0?e:void 0},t.prototype.setDate=function(e,r){this.setValue(serialiseDate(e??null,!1),r)},t}(AgInputTextField),__extends$Z=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),AgInputRange=function(n){__extends$Z(t,n);function t(e){return n.call(this,e,"ag-range-field","range")||this}return t.prototype.postConstruct=function(){n.prototype.postConstruct.call(this);var e=this.config,r=e.min,o=e.max,s=e.step;r!=null&&this.setMinValue(r),o!=null&&this.setMaxValue(o),this.setStep(s||1)},t.prototype.addInputListeners=function(){var e=this;this.addManagedListener(this.eInput,"input",function(r){var o=r.target.value;e.setValue(o)})},t.prototype.setMinValue=function(e){return this.min=e,this.eInput.setAttribute("min",e.toString()),this},t.prototype.setMaxValue=function(e){return this.max=e,this.eInput.setAttribute("max",e.toString()),this},t.prototype.setStep=function(e){return this.eInput.setAttribute("step",e.toString()),this},t.prototype.setValue=function(e,r){this.min!=null&&(e=Math.max(parseFloat(e),this.min).toString()),this.max!=null&&(e=Math.min(parseFloat(e),this.max).toString());var o=n.prototype.setValue.call(this,e,r);return this.eInput.value=e,o},t}(AgAbstractInputField),__extends$Y=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$Z=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},AgSlider=function(n){__extends$Y(t,n);function t(e){var r=n.call(this,e,t.TEMPLATE)||this;return r.labelAlignment="top",r}return t.prototype.init=function(){this.eSlider.addCssClass("ag-slider-field")},t.prototype.onValueChange=function(e){var r=this,o=AgAbstractField.EVENT_CHANGED;return this.addManagedListener(this.eText,o,function(){var s=parseFloat(r.eText.getValue());r.eSlider.setValue(s.toString(),!0),e(s||0)}),this.addManagedListener(this.eSlider,o,function(){var s=r.eSlider.getValue();r.eText.setValue(s,!0),e(parseFloat(s))}),this},t.prototype.setSliderWidth=function(e){return this.eSlider.setWidth(e),this},t.prototype.setTextFieldWidth=function(e){return this.eText.setWidth(e),this},t.prototype.setMinValue=function(e){return this.eSlider.setMinValue(e),this.eText.setMin(e),this},t.prototype.setMaxValue=function(e){return this.eSlider.setMaxValue(e),this.eText.setMax(e),this},t.prototype.getValue=function(){return this.eText.getValue()},t.prototype.setValue=function(e){return this.getValue()===e?this:(this.eText.setValue(e,!0),this.eSlider.setValue(e,!0),this.dispatchEvent({type:AgAbstractField.EVENT_CHANGED}),this)},t.prototype.setStep=function(e){return this.eSlider.setStep(e),this.eText.setStep(e),this},t.TEMPLATE=`<div class="ag-slider">
            <label ref="eLabel"></label>
            <div class="ag-wrapper ag-slider-wrapper">
                <ag-input-range ref="eSlider"></ag-input-range>
                <ag-input-number-field ref="eText"></ag-input-number-field>
            </div>
        </div>`,__decorate$Z([RefSelector("eLabel")],t.prototype,"eLabel",void 0),__decorate$Z([RefSelector("eSlider")],t.prototype,"eSlider",void 0),__decorate$Z([RefSelector("eText")],t.prototype,"eText",void 0),__decorate$Z([PostConstruct],t.prototype,"init",null),t}(AgAbstractLabel),__extends$X=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$Y=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},AgGroupComponent=function(n){__extends$X(t,n);function t(e){e===void 0&&(e={});var r=n.call(this,t.getTemplate(e))||this;r.suppressEnabledCheckbox=!0,r.suppressOpenCloseIcons=!1;var o=e.title,s=e.enabled,l=e.items,a=e.suppressEnabledCheckbox,h=e.suppressOpenCloseIcons;return r.title=o,r.cssIdentifier=e.cssIdentifier||"default",r.enabled=s??!0,r.items=l||[],r.alignItems=e.alignItems||"center",a!=null&&(r.suppressEnabledCheckbox=a),h!=null&&(r.suppressOpenCloseIcons=h),r}return t.getTemplate=function(e){var r=e.cssIdentifier||"default",o=e.direction||"vertical";return'<div class="ag-group ag-'+r+`-group" role="presentation">
            <div class="ag-group-title-bar ag-`+r+`-group-title-bar ag-unselectable" ref="eTitleBar" role="button">
                <span class="ag-group-title-bar-icon ag-`+r+`-group-title-bar-icon" ref="eGroupOpenedIcon" role="presentation"></span>
                <span class="ag-group-title-bar-icon ag-`+r+`-group-title-bar-icon" ref="eGroupClosedIcon" role="presentation"></span>
                <span ref="eTitle" class="ag-group-title ag-`+r+`-group-title"></span>
            </div>
            <div ref="eToolbar" class="ag-group-toolbar ag-`+r+`-group-toolbar">
                <ag-checkbox ref="cbGroupEnabled"></ag-checkbox>
            </div>
            <div ref="eContainer" class="ag-group-container ag-group-container-`+o+" ag-"+r+`-group-container"></div>
        </div>`},t.prototype.postConstruct=function(){if(this.items.length){var e=this.items;this.items=[],this.addItems(e)}var r=this.localeService.getLocaleTextFunc();this.cbGroupEnabled.setLabel(r("enabled","Enabled")),this.title&&this.setTitle(this.title),this.enabled&&this.setEnabled(this.enabled),this.setAlignItems(this.alignItems),this.hideEnabledCheckbox(this.suppressEnabledCheckbox),this.hideOpenCloseIcons(this.suppressOpenCloseIcons),this.setupExpandContract(),this.refreshAriaStatus(),this.refreshChildDisplay()},t.prototype.setupExpandContract=function(){var e=this;this.eGroupClosedIcon.appendChild(createIcon("columnSelectClosed",this.gridOptionsService,null)),this.eGroupOpenedIcon.appendChild(createIcon("columnSelectOpen",this.gridOptionsService,null)),this.addManagedListener(this.eTitleBar,"click",function(){return e.toggleGroupExpand()}),this.addManagedListener(this.eTitleBar,"keydown",function(r){switch(r.key){case KeyCode.ENTER:case KeyCode.SPACE:r.preventDefault(),e.toggleGroupExpand();break;case KeyCode.RIGHT:case KeyCode.LEFT:r.preventDefault(),e.toggleGroupExpand(r.key===KeyCode.RIGHT);break}})},t.prototype.refreshAriaStatus=function(){this.suppressOpenCloseIcons||setAriaExpanded(this.eTitleBar,this.expanded)},t.prototype.refreshChildDisplay=function(){var e=!this.suppressOpenCloseIcons;setDisplayed(this.eToolbar,this.expanded&&!this.suppressEnabledCheckbox),setDisplayed(this.eGroupOpenedIcon,e&&this.expanded),setDisplayed(this.eGroupClosedIcon,e&&!this.expanded)},t.prototype.isExpanded=function(){return this.expanded},t.prototype.setAlignItems=function(e){this.alignItems!==e&&this.removeCssClass("ag-group-item-alignment-"+this.alignItems),this.alignItems=e;var r="ag-group-item-alignment-"+this.alignItems;return this.addCssClass(r),this},t.prototype.toggleGroupExpand=function(e){return this.suppressOpenCloseIcons?(this.expanded=!0,this.refreshChildDisplay(),setDisplayed(this.eContainer,!0),this):(e=e??!this.expanded,this.expanded===e?this:(this.expanded=e,this.refreshAriaStatus(),this.refreshChildDisplay(),setDisplayed(this.eContainer,e),this.dispatchEvent({type:this.expanded?t.EVENT_EXPANDED:t.EVENT_COLLAPSED}),this))},t.prototype.addItems=function(e){var r=this;e.forEach(function(o){return r.addItem(o)})},t.prototype.addItem=function(e){var r=this.eContainer,o=e instanceof Component?e.getGui():e;o.classList.add("ag-group-item","ag-"+this.cssIdentifier+"-group-item"),r.appendChild(o),this.items.push(o)},t.prototype.hideItem=function(e,r){var o=this.items[r];setDisplayed(o,!e)},t.prototype.setTitle=function(e){return this.eTitle.innerText=e,this},t.prototype.addCssClassToTitleBar=function(e){this.eTitleBar.classList.add(e)},t.prototype.setEnabled=function(e,r){return this.enabled=e,this.refreshDisabledStyles(),this.toggleGroupExpand(e),r||this.cbGroupEnabled.setValue(e),this},t.prototype.isEnabled=function(){return this.enabled},t.prototype.onEnableChange=function(e){var r=this;return this.cbGroupEnabled.onValueChange(function(o){r.setEnabled(o,!0),e(o)}),this},t.prototype.hideEnabledCheckbox=function(e){return this.suppressEnabledCheckbox=e,this.refreshChildDisplay(),this.refreshDisabledStyles(),this},t.prototype.hideOpenCloseIcons=function(e){return this.suppressOpenCloseIcons=e,e&&this.toggleGroupExpand(!0),this},t.prototype.refreshDisabledStyles=function(){this.addOrRemoveCssClass("ag-disabled",!this.enabled),this.suppressEnabledCheckbox&&!this.enabled?(this.eTitleBar.classList.add("ag-disabled-group-title-bar"),this.eTitleBar.removeAttribute("tabindex")):(this.eTitleBar.classList.remove("ag-disabled-group-title-bar"),this.eTitleBar.setAttribute("tabindex","0")),this.eContainer.classList.toggle("ag-disabled-group-container",!this.enabled)},t.EVENT_EXPANDED="expanded",t.EVENT_COLLAPSED="collapsed",__decorate$Y([RefSelector("eTitleBar")],t.prototype,"eTitleBar",void 0),__decorate$Y([RefSelector("eGroupOpenedIcon")],t.prototype,"eGroupOpenedIcon",void 0),__decorate$Y([RefSelector("eGroupClosedIcon")],t.prototype,"eGroupClosedIcon",void 0),__decorate$Y([RefSelector("eToolbar")],t.prototype,"eToolbar",void 0),__decorate$Y([RefSelector("cbGroupEnabled")],t.prototype,"cbGroupEnabled",void 0),__decorate$Y([RefSelector("eTitle")],t.prototype,"eTitle",void 0),__decorate$Y([RefSelector("eContainer")],t.prototype,"eContainer",void 0),__decorate$Y([PostConstruct],t.prototype,"postConstruct",null),t}(Component),__extends$W=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__read$c=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray$a=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n},TabGuardComp=function(n){__extends$W(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.initialiseTabGuard=function(e){this.eTopGuard=this.createTabGuard("top"),this.eBottomGuard=this.createTabGuard("bottom"),this.eFocusableElement=this.getFocusableElement();var r=[this.eTopGuard,this.eBottomGuard],o={setTabIndex:function(s){r.forEach(function(l){return s!=null?l.setAttribute("tabindex",s):l.removeAttribute("tabindex")})}};this.addTabGuards(this.eTopGuard,this.eBottomGuard),this.tabGuardCtrl=this.createManagedBean(new TabGuardCtrl({comp:o,eTopGuard:this.eTopGuard,eBottomGuard:this.eBottomGuard,eFocusableElement:this.eFocusableElement,onFocusIn:e.onFocusIn,onFocusOut:e.onFocusOut,focusInnerElement:e.focusInnerElement,handleKeyDown:e.handleKeyDown,onTabKeyDown:e.onTabKeyDown,shouldStopEventPropagation:e.shouldStopEventPropagation}))},t.prototype.createTabGuard=function(e){var r=document.createElement("div"),o=e==="top"?TabGuardClassNames.TAB_GUARD_TOP:TabGuardClassNames.TAB_GUARD_BOTTOM;return r.classList.add(TabGuardClassNames.TAB_GUARD,o),setAriaRole(r,"presentation"),r},t.prototype.addTabGuards=function(e,r){this.eFocusableElement.insertAdjacentElement("afterbegin",e),this.eFocusableElement.insertAdjacentElement("beforeend",r)},t.prototype.removeAllChildrenExceptTabGuards=function(){var e=[this.eTopGuard,this.eBottomGuard];clearElement(this.getFocusableElement()),this.addTabGuards.apply(this,__spreadArray$a([],__read$c(e)))},t.prototype.forceFocusOutOfContainer=function(e){e===void 0&&(e=!1),this.tabGuardCtrl.forceFocusOutOfContainer(e)},t.prototype.appendChild=function(e,r){isNodeOrElement(e)||(e=e.getGui());var o=this.eBottomGuard;o?o.insertAdjacentElement("beforebegin",e):n.prototype.appendChild.call(this,e,r)},t}(Component),__extends$V=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__assign$5=function(){return __assign$5=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},__assign$5.apply(this,arguments)},__decorate$X=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},AgMenuList=function(n){__extends$V(t,n);function t(e){e===void 0&&(e=1);var r=n.call(this,'<div class="ag-menu-list" role="tree"></div>')||this;return r.level=e,r.menuItems=[],r}return t.prototype.postConstruct=function(){var e=this;this.initialiseTabGuard({onTabKeyDown:function(r){return e.onTabKeyDown(r)},handleKeyDown:function(r){return e.handleKeyDown(r)}})},t.prototype.onTabKeyDown=function(e){var r=this.getParentComponent(),o=r&&r.getGui(),s=o&&o.classList.contains("ag-focus-managed");s||e.preventDefault(),e.shiftKey&&this.closeIfIsChild(e)},t.prototype.handleKeyDown=function(e){switch(e.key){case KeyCode.UP:case KeyCode.RIGHT:case KeyCode.DOWN:case KeyCode.LEFT:e.preventDefault(),this.handleNavKey(e.key);break;case KeyCode.ESCAPE:var r=this.findTopMenu();r&&this.focusService.focusInto(r.getGui());break}},t.prototype.clearActiveItem=function(){this.activeMenuItem&&(this.activeMenuItem.deactivate(),this.activeMenuItem=null)},t.prototype.addMenuItems=function(e){var r=this;e!=null&&e.forEach(function(o){o==="separator"?r.addSeparator():typeof o=="string"?console.warn("AG Grid: unrecognised menu item "+o):r.addItem(o)})},t.prototype.addItem=function(e){var r=this,o=this.createManagedBean(new AgMenuItemComponent(__assign$5(__assign$5({},e),{isAnotherSubMenuOpen:function(){return r.menuItems.some(function(s){return s.isSubMenuOpen()})}})));o.setParentComponent(this),setAriaLevel(o.getGui(),this.level),this.menuItems.push(o),this.appendChild(o.getGui()),this.addManagedListener(o,AgMenuItemComponent.EVENT_MENU_ITEM_SELECTED,function(s){r.dispatchEvent(s)}),this.addManagedListener(o,AgMenuItemComponent.EVENT_MENU_ITEM_ACTIVATED,function(s){r.activeMenuItem&&r.activeMenuItem!==s.menuItem&&r.activeMenuItem.deactivate(),r.activeMenuItem=s.menuItem})},t.prototype.activateFirstItem=function(){var e=this.menuItems.filter(function(r){return!r.isDisabled()})[0];e&&e.activate()},t.prototype.addSeparator=function(){var e=`
            <div class="ag-menu-separator" aria-hidden="true">
                <div class="ag-menu-separator-part"></div>
                <div class="ag-menu-separator-part"></div>
                <div class="ag-menu-separator-part"></div>
                <div class="ag-menu-separator-part"></div>
            </div>`;this.appendChild(loadTemplate(e))},t.prototype.findTopMenu=function(){var e=this.getParentComponent();if(!e&&this instanceof t)return this;for(;;){var r=e&&e.getParentComponent&&e.getParentComponent();if(!r||!(r instanceof t||r instanceof AgMenuItemComponent))break;e=r}return e instanceof t?e:void 0},t.prototype.handleNavKey=function(e){switch(e){case KeyCode.UP:case KeyCode.DOWN:var r=this.findNextItem(e===KeyCode.UP);r&&r!==this.activeMenuItem&&r.activate();return}var o=this.gridOptionsService.is("enableRtl")?KeyCode.RIGHT:KeyCode.LEFT;e===o?this.closeIfIsChild():this.openChild()},t.prototype.closeIfIsChild=function(e){var r=this.getParentComponent();r&&r instanceof AgMenuItemComponent&&(e&&e.preventDefault(),r.closeSubMenu(),r.getGui().focus())},t.prototype.openChild=function(){this.activeMenuItem&&this.activeMenuItem.openSubMenu(!0)},t.prototype.findNextItem=function(e){var r=this.menuItems.filter(function(h){return!h.isDisabled()});if(r.length){if(!this.activeMenuItem)return e?last(r):r[0];e&&r.reverse();for(var o,s=!1,l=0;l<r.length;l++){var a=r[l];if(!s){a===this.activeMenuItem&&(s=!0);continue}o=a;break}return o||this.activeMenuItem}},t.prototype.destroy=function(){this.clearActiveItem(),n.prototype.destroy.call(this)},__decorate$X([Autowired("focusService")],t.prototype,"focusService",void 0),__decorate$X([PostConstruct],t.prototype,"postConstruct",null),t}(TabGuardComp),__extends$U=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$W=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},AgMenuPanel=function(n){__extends$U(t,n);function t(e){var r=n.call(this)||this;return r.wrappedComponent=e,r.setTemplateFromElement(e.getGui()),r}return t.prototype.postConstruct=function(){var e=this;this.initialiseTabGuard({onTabKeyDown:function(r){return e.onTabKeyDown(r)},handleKeyDown:function(r){return e.handleKeyDown(r)}})},t.prototype.handleKeyDown=function(e){e.key===KeyCode.ESCAPE&&this.closePanel()},t.prototype.onTabKeyDown=function(e){e.defaultPrevented||(this.closePanel(),e.preventDefault())},t.prototype.closePanel=function(){var e=this.parentComponent;e.closeSubMenu(),setTimeout(function(){return e.getGui().focus()},0)},__decorate$W([PostConstruct],t.prototype,"postConstruct",null),t}(TabGuardComp),__extends$T=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$V=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},AgMenuItemComponent=function(n){__extends$T(t,n);function t(e){var r=n.call(this)||this;return r.params=e,r.isActive=!1,r.subMenuIsOpen=!1,r.setTemplate('<div class="'+r.getClassName()+'" tabindex="-1" role="treeitem"></div>'),r}return t.prototype.init=function(){var e=this;this.addIcon(),this.addName(),this.addShortcut(),this.addSubMenu(),this.addTooltip();var r=this.getGui();this.params.disabled?(this.addCssClass(this.getClassName("disabled")),setAriaDisabled(r,!0)):(this.addGuiEventListener("click",function(o){return e.onItemSelected(o)}),this.addGuiEventListener("keydown",function(o){(o.key===KeyCode.ENTER||o.key===KeyCode.SPACE)&&(o.preventDefault(),e.onItemSelected(o))}),this.addGuiEventListener("mousedown",function(o){o.stopPropagation(),o.preventDefault()}),this.addGuiEventListener("mouseenter",function(){return e.onMouseEnter()}),this.addGuiEventListener("mouseleave",function(){return e.onMouseLeave()})),this.params.cssClasses&&this.params.cssClasses.forEach(function(o){return e.addCssClass(o)})},t.prototype.isDisabled=function(){return!!this.params.disabled},t.prototype.openSubMenu=function(e){var r=this;if(e===void 0&&(e=!1),this.closeSubMenu(),!!this.params.subMenu){var o=loadTemplate('<div class="ag-menu" role="presentation"></div>'),s;if(this.params.subMenu instanceof Array){var l=getAriaLevel(this.getGui()),a=isNaN(l)?1:l+1,h=this.createBean(new AgMenuList(a));h.setParentComponent(this),h.addMenuItems(this.params.subMenu),o.appendChild(h.getGui()),this.addManagedListener(h,t.EVENT_MENU_ITEM_SELECTED,function(Bn){return r.dispatchEvent(Bn)}),h.addGuiEventListener("mouseenter",function(){return r.cancelDeactivate()}),s=function(){return r.destroyBean(h)},e&&setTimeout(function(){return h.activateFirstItem()},0)}else{var y=this.params.subMenu,C=this.createBean(new AgMenuPanel(y));C.setParentComponent(this);var L=C.getGui(),Y="mouseenter",ze=function(){return r.cancelDeactivate()};L.addEventListener(Y,ze),s=function(){return L.removeEventListener(Y,ze)},o.appendChild(L),y.afterGuiAttached&&setTimeout(function(){return y.afterGuiAttached()},0)}var Bt=this.getGui(),Ir=this.popupService.positionPopupForMenu.bind(this.popupService,{eventSource:Bt,ePopup:o}),Wr=this.localeService.getLocaleTextFunc(),yi=this.popupService.addPopup({modal:!0,eChild:o,positionCallback:Ir,anchorToElement:Bt,ariaLabel:Wr("ariaLabelSubMenu","SubMenu")});this.subMenuIsOpen=!0,setAriaExpanded(Bt,!0),this.hideSubMenu=function(){yi&&yi.hideFunc(),r.subMenuIsOpen=!1,setAriaExpanded(Bt,!1),s()}}},t.prototype.closeSubMenu=function(){this.hideSubMenu&&(this.hideSubMenu(),this.hideSubMenu=null,setAriaExpanded(this.getGui(),!1))},t.prototype.isSubMenuOpen=function(){return this.subMenuIsOpen},t.prototype.activate=function(e){var r=this;this.cancelActivate(),!this.params.disabled&&(this.isActive=!0,this.addCssClass(this.getClassName("active")),this.getGui().focus(),e&&this.params.subMenu&&window.setTimeout(function(){r.isAlive()&&r.isActive&&r.openSubMenu()},300),this.onItemActivated())},t.prototype.deactivate=function(){this.cancelDeactivate(),this.removeCssClass(this.getClassName("active")),this.isActive=!1,this.subMenuIsOpen&&this.hideSubMenu()},t.prototype.addIcon=function(){if(!(!this.params.checked&&!this.params.icon&&this.params.isCompact)){var e=loadTemplate('<span ref="eIcon" class="'+this.getClassName("part")+" "+this.getClassName("icon")+'" role="presentation"></span>');this.params.checked?e.appendChild(createIconNoSpan("check",this.gridOptionsService)):this.params.icon&&(isNodeOrElement(this.params.icon)?e.appendChild(this.params.icon):typeof this.params.icon=="string"?e.innerHTML=this.params.icon:console.warn("AG Grid: menu item icon must be DOM node or string")),this.getGui().appendChild(e)}},t.prototype.addName=function(){if(!(!this.params.name&&this.params.isCompact)){var e=loadTemplate('<span ref="eName" class="'+this.getClassName("part")+" "+this.getClassName("text")+'">'+(this.params.name||"")+"</span>");this.getGui().appendChild(e)}},t.prototype.addTooltip=function(){this.params.tooltip&&(this.tooltip=this.params.tooltip,this.gridOptionsService.is("enableBrowserTooltips")?this.getGui().setAttribute("title",this.tooltip):this.createManagedBean(new CustomTooltipFeature(this)))},t.prototype.getTooltipParams=function(){return{location:"menu",value:this.tooltip}},t.prototype.addShortcut=function(){if(!(!this.params.shortcut&&this.params.isCompact)){var e=loadTemplate('<span ref="eShortcut" class="'+this.getClassName("part")+" "+this.getClassName("shortcut")+'">'+(this.params.shortcut||"")+"</span>");this.getGui().appendChild(e)}},t.prototype.addSubMenu=function(){if(!(!this.params.subMenu&&this.params.isCompact)){var e=loadTemplate('<span ref="ePopupPointer" class="'+this.getClassName("part")+" "+this.getClassName("popup-pointer")+'"></span>'),r=this.getGui();if(this.params.subMenu){var o=this.gridOptionsService.is("enableRtl")?"smallLeft":"smallRight";setAriaExpanded(r,!1),e.appendChild(createIconNoSpan(o,this.gridOptionsService))}r.appendChild(e)}},t.prototype.onItemSelected=function(e){if(this.params.action?this.params.action():this.openSubMenu(e&&e.type==="keydown"),!(this.params.subMenu&&!this.params.action)){var r={type:t.EVENT_MENU_ITEM_SELECTED,action:this.params.action,checked:this.params.checked,cssClasses:this.params.cssClasses,disabled:this.params.disabled,icon:this.params.icon,name:this.params.name,shortcut:this.params.shortcut,subMenu:this.params.subMenu,tooltip:this.params.tooltip,event:e};this.dispatchEvent(r)}},t.prototype.onItemActivated=function(){var e={type:t.EVENT_MENU_ITEM_ACTIVATED,menuItem:this};this.dispatchEvent(e)},t.prototype.cancelActivate=function(){this.activateTimeoutId&&(window.clearTimeout(this.activateTimeoutId),this.activateTimeoutId=0)},t.prototype.cancelDeactivate=function(){this.deactivateTimeoutId&&(window.clearTimeout(this.deactivateTimeoutId),this.deactivateTimeoutId=0)},t.prototype.onMouseEnter=function(){var e=this;this.cancelDeactivate(),this.params.isAnotherSubMenuOpen()?this.activateTimeoutId=window.setTimeout(function(){return e.activate(!0)},t.ACTIVATION_DELAY):this.activate(!0)},t.prototype.onMouseLeave=function(){var e=this;this.cancelActivate(),this.isSubMenuOpen()?this.deactivateTimeoutId=window.setTimeout(function(){return e.deactivate()},t.ACTIVATION_DELAY):this.deactivate()},t.prototype.getClassName=function(e){var r=this.params.isCompact?"ag-compact-menu-option":"ag-menu-option";return e?r+"-"+e:r},t.EVENT_MENU_ITEM_SELECTED="menuItemSelected",t.EVENT_MENU_ITEM_ACTIVATED="menuItemActivated",t.ACTIVATION_DELAY=80,__decorate$V([Autowired("popupService")],t.prototype,"popupService",void 0),__decorate$V([PostConstruct],t.prototype,"init",null),t}(Component),__extends$S=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$U=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},AgPanel=function(n){__extends$S(t,n);function t(e){var r=n.call(this,t.getTemplate(e))||this;return r.closable=!0,r.config=e,r}return t.getTemplate=function(e){var r=e&&e.cssIdentifier||"default";return'<div class="ag-panel ag-'+r+`-panel" tabindex="-1">
            <div ref="eTitleBar" class="ag-panel-title-bar ag-`+r+`-panel-title-bar ag-unselectable">
                <span ref="eTitle" class="ag-panel-title-bar-title ag-`+r+`-panel-title-bar-title"></span>
                <div ref="eTitleBarButtons" class="ag-panel-title-bar-buttons ag-`+r+`-panel-title-bar-buttons"></div>
            </div>
            <div ref="eContentWrapper" class="ag-panel-content-wrapper ag-`+r+`-panel-content-wrapper"></div>
        </div>`},t.prototype.postConstruct=function(){var e=this,r=this.config,o=r.component,s=r.closable,l=r.hideTitleBar,a=r.title,h=r.minWidth,y=h===void 0?250:h,C=r.width,L=r.minHeight,Y=L===void 0?250:L,ze=r.height,Bt=r.centered,Ir=r.popup,Wr=r.x,yi=r.y;this.positionableFeature=new PositionableFeature(this.getGui(),{minWidth:y,width:C,minHeight:Y,height:ze,centered:Bt,x:Wr,y:yi,popup:Ir,calculateTopBuffer:function(){return e.positionableFeature.getHeight()-e.getBodyHeight()}}),this.createManagedBean(this.positionableFeature);var Bn=this.getGui();o&&this.setBodyComponent(o),l?setDisplayed(this.eTitleBar,!1):(a&&this.setTitle(a),this.setClosable(s??this.closable)),this.addManagedListener(this.eTitleBar,"mousedown",function(vi){var wo=e.gridOptionsService.getDocument();if(Bn.contains(vi.relatedTarget)||Bn.contains(wo.activeElement)||e.eTitleBarButtons.contains(vi.target)){vi.preventDefault();return}var ia=e.eContentWrapper.querySelector("button, [href], input, select, textarea, [tabindex]");ia&&ia.focus()}),!(Ir&&this.positionableFeature.isPositioned())&&(this.renderComponent&&this.renderComponent(),this.positionableFeature.initialisePosition(),this.eContentWrapper.style.height="0")},t.prototype.renderComponent=function(){var e=this,r=this.getGui();r.focus(),this.close=function(){r.parentElement.removeChild(r),e.destroy()}},t.prototype.getHeight=function(){return this.positionableFeature.getHeight()},t.prototype.setHeight=function(e){this.positionableFeature.setHeight(e)},t.prototype.getWidth=function(){return this.positionableFeature.getWidth()},t.prototype.setWidth=function(e){this.positionableFeature.setWidth(e)},t.prototype.setClosable=function(e){if(e!==this.closable&&(this.closable=e),e){var r=this.closeButtonComp=new Component(t.CLOSE_BTN_TEMPLATE);this.getContext().createBean(r);var o=r.getGui(),s=createIconNoSpan("close",this.gridOptionsService);s.classList.add("ag-panel-title-bar-button-icon"),o.appendChild(s),this.addTitleBarButton(r),r.addManagedListener(o,"click",this.onBtClose.bind(this))}else if(this.closeButtonComp){var o=this.closeButtonComp.getGui();o.parentElement.removeChild(o),this.closeButtonComp=this.destroyBean(this.closeButtonComp)}},t.prototype.setBodyComponent=function(e){e.setParentComponent(this),this.eContentWrapper.appendChild(e.getGui())},t.prototype.addTitleBarButton=function(e,r){var o=this.eTitleBarButtons,s=o.children,l=s.length;r==null&&(r=l),r=Math.max(0,Math.min(r,l)),e.addCssClass("ag-panel-title-bar-button");var a=e.getGui();r===0?o.insertAdjacentElement("afterbegin",a):r===l?o.insertAdjacentElement("beforeend",a):s[r-1].insertAdjacentElement("afterend",a),e.setParentComponent(this)},t.prototype.getBodyHeight=function(){return getInnerHeight(this.eContentWrapper)},t.prototype.getBodyWidth=function(){return getInnerWidth(this.eContentWrapper)},t.prototype.setTitle=function(e){this.eTitle.innerText=e},t.prototype.onBtClose=function(){this.close()},t.prototype.destroy=function(){this.closeButtonComp&&(this.closeButtonComp=this.destroyBean(this.closeButtonComp));var e=this.getGui();e&&e.offsetParent&&this.close(),n.prototype.destroy.call(this)},t.CLOSE_BTN_TEMPLATE='<div class="ag-button"></div>',__decorate$U([RefSelector("eContentWrapper")],t.prototype,"eContentWrapper",void 0),__decorate$U([RefSelector("eTitleBar")],t.prototype,"eTitleBar",void 0),__decorate$U([RefSelector("eTitleBarButtons")],t.prototype,"eTitleBarButtons",void 0),__decorate$U([RefSelector("eTitle")],t.prototype,"eTitle",void 0),__decorate$U([PostConstruct],t.prototype,"postConstruct",null),t}(Component),__extends$R=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__assign$4=function(){return __assign$4=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},__assign$4.apply(this,arguments)},__decorate$T=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},AgDialog=function(n){__extends$R(t,n);function t(e){var r=n.call(this,__assign$4(__assign$4({},e),{popup:!0}))||this;return r.isMaximizable=!1,r.isMaximized=!1,r.maximizeListeners=[],r.resizeListenerDestroy=null,r.lastPosition={x:0,y:0,width:0,height:0},r}return t.prototype.postConstruct=function(){var e=this,r=this.getGui(),o=this.config,s=o.movable,l=o.resizable,a=o.maximizable;this.addCssClass("ag-dialog"),n.prototype.postConstruct.call(this),this.addManagedListener(r,"focusin",function(h){r.contains(h.relatedTarget)||e.popupService.bringPopupToFront(r)}),s&&this.setMovable(s),a&&this.setMaximizable(a),l&&this.setResizable(l)},t.prototype.renderComponent=function(){var e=this.getGui(),r=this.config,o=r.alwaysOnTop,s=r.modal,l=r.title,a=this.localeService.getLocaleTextFunc(),h=this.popupService.addPopup({modal:s,eChild:e,closeOnEsc:!0,closedCallback:this.destroy.bind(this),alwaysOnTop:o,ariaLabel:l||a("ariaLabelDialog","Dialog")});h&&(this.close=h.hideFunc)},t.prototype.toggleMaximize=function(){var e=this.positionableFeature.getPosition();if(this.isMaximized){var r=this.lastPosition,o=r.x,s=r.y,l=r.width,a=r.height;this.setWidth(l),this.setHeight(a),this.positionableFeature.offsetElement(o,s)}else this.lastPosition.width=this.getWidth(),this.lastPosition.height=this.getHeight(),this.lastPosition.x=e.x,this.lastPosition.y=e.y,this.positionableFeature.offsetElement(0,0),this.setHeight("100%"),this.setWidth("100%");this.isMaximized=!this.isMaximized,this.refreshMaximizeIcon()},t.prototype.refreshMaximizeIcon=function(){setDisplayed(this.maximizeIcon,!this.isMaximized),setDisplayed(this.minimizeIcon,this.isMaximized)},t.prototype.clearMaximizebleListeners=function(){this.maximizeListeners.length&&(this.maximizeListeners.forEach(function(e){return e()}),this.maximizeListeners.length=0),this.resizeListenerDestroy&&(this.resizeListenerDestroy(),this.resizeListenerDestroy=null)},t.prototype.destroy=function(){this.maximizeButtonComp=this.destroyBean(this.maximizeButtonComp),this.clearMaximizebleListeners(),n.prototype.destroy.call(this)},t.prototype.setResizable=function(e){this.positionableFeature.setResizable(e)},t.prototype.setMovable=function(e){this.positionableFeature.setMovable(e,this.eTitleBar)},t.prototype.setMaximizable=function(e){var r=this;if(!e){this.clearMaximizebleListeners(),this.maximizeButtonComp&&(this.destroyBean(this.maximizeButtonComp),this.maximizeButtonComp=this.maximizeIcon=this.minimizeIcon=void 0);return}var o=this.eTitleBar;if(!(!o||e===this.isMaximizable)){var s=this.buildMaximizeAndMinimizeElements();this.refreshMaximizeIcon(),s.addManagedListener(s.getGui(),"click",this.toggleMaximize.bind(this)),this.addTitleBarButton(s,0),this.maximizeListeners.push(this.addManagedListener(o,"dblclick",this.toggleMaximize.bind(this))),this.resizeListenerDestroy=this.addManagedListener(this,"resize",function(){r.isMaximized=!1,r.refreshMaximizeIcon()})}},t.prototype.buildMaximizeAndMinimizeElements=function(){var e=this.maximizeButtonComp=this.createBean(new Component('<div class="ag-dialog-button"></span>')),r=e.getGui();return this.maximizeIcon=createIconNoSpan("maximize",this.gridOptionsService),r.appendChild(this.maximizeIcon),this.maximizeIcon.classList.add("ag-panel-title-bar-button-icon"),this.minimizeIcon=createIconNoSpan("minimize",this.gridOptionsService),r.appendChild(this.minimizeIcon),this.minimizeIcon.classList.add("ag-panel-title-bar-button-icon"),e},__decorate$T([Autowired("popupService")],t.prototype,"popupService",void 0),t}(AgPanel),__extends$Q=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__assign$3=function(){return __assign$3=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},__assign$3.apply(this,arguments)},__decorate$S=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__read$b=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray$9=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n},DIRECTION;(function(n){n[n.vertical=0]="vertical",n[n.horizontal=1]="horizontal"})(DIRECTION||(DIRECTION={}));var instanceIdSeq=0,PopupService=function(n){__extends$Q(t,n);function t(){var r=n!==null&&n.apply(this,arguments)||this;return r.popupList=[],r}e=t,t.prototype.postConstruct=function(){var r=this;this.ctrlsService.whenReady(function(o){r.gridCtrl=o.gridCtrl,r.addManagedListener(r.gridCtrl,Events.EVENT_KEYBOARD_FOCUS,function(){r.popupList.forEach(function(s){return s.element.classList.add(FocusService.AG_KEYBOARD_FOCUS)})}),r.addManagedListener(r.gridCtrl,Events.EVENT_MOUSE_FOCUS,function(){r.popupList.forEach(function(s){return s.element.classList.remove(FocusService.AG_KEYBOARD_FOCUS)})})})},t.prototype.getPopupParent=function(){var r=this.gridOptionsService.get("popupParent");return r||this.gridCtrl.getGui()},t.prototype.positionPopupForMenu=function(r){var o=r.eventSource.getBoundingClientRect(),s=this.getParentRect(),l=this.keepXYWithinBounds(r.ePopup,o.top-s.top,DIRECTION.vertical),a=r.ePopup.clientWidth>0?r.ePopup.clientWidth:200;r.ePopup.style.minWidth=a+"px";var h=s.right-s.left,y=h-a,C;this.gridOptionsService.is("enableRtl")?(C=Y(),C<0&&(C=L()),C>y&&(C=0)):(C=L(),C>y&&(C=Y()),C<0&&(C=0)),r.ePopup.style.left=C+"px",r.ePopup.style.top=l+"px";function L(){return o.right-s.left-2}function Y(){return o.left-s.left-a}},t.prototype.positionPopupUnderMouseEvent=function(r){var o=this,s=r.ePopup,l=r.nudgeX,a=r.nudgeY,h=r.skipObserver;this.positionPopup({ePopup:s,nudgeX:l,nudgeY:a,keepWithinBounds:!0,skipObserver:h,updatePosition:function(){return o.calculatePointerAlign(r.mouseEvent)},postProcessCallback:function(){return o.callPostProcessPopup(r.type,r.ePopup,null,r.mouseEvent,r.column,r.rowNode)}})},t.prototype.calculatePointerAlign=function(r){var o=this.getParentRect();return{x:r.clientX-o.left,y:r.clientY-o.top}},t.prototype.positionPopupByComponent=function(r){var o=this,s=r.eventSource.getBoundingClientRect(),l=r.alignSide||"left",a=r.position||"over",h=this.getParentRect(),y=function(){var C=s.left-h.left;l==="right"&&(C-=r.ePopup.offsetWidth-s.width);var L=a==="over"?s.top-h.top:s.top-h.top+s.height;return{x:C,y:L}};this.positionPopup({ePopup:r.ePopup,nudgeX:r.nudgeX,nudgeY:r.nudgeY,keepWithinBounds:r.keepWithinBounds,updatePosition:y,postProcessCallback:function(){return o.callPostProcessPopup(r.type,r.ePopup,r.eventSource,null,r.column,r.rowNode)}})},t.prototype.callPostProcessPopup=function(r,o,s,l,a,h){var y=this.gridOptionsService.getCallback("postProcessPopup");if(y){var C={column:a,rowNode:h,ePopup:o,type:r,eventSource:s,mouseEvent:l};y(C)}},t.prototype.positionPopup=function(r){var o=this,s=r.ePopup,l=r.keepWithinBounds,a=r.nudgeX,h=r.nudgeY,y=r.skipObserver,C=r.updatePosition,L={width:0,height:0},Y=function(Bt){Bt===void 0&&(Bt=!1);var Ir=C(),Wr=Ir.x,yi=Ir.y;Bt&&s.clientWidth===L.width&&s.clientHeight===L.height||(L.width=s.clientWidth,L.height=s.clientHeight,a&&(Wr+=a),h&&(yi+=h),l&&(Wr=o.keepXYWithinBounds(s,Wr,DIRECTION.horizontal),yi=o.keepXYWithinBounds(s,yi,DIRECTION.vertical)),s.style.left=Wr+"px",s.style.top=yi+"px",r.postProcessCallback&&r.postProcessCallback())};if(Y(),!y){var ze=this.resizeObserverService.observeResize(s,function(){return Y(!0)});setTimeout(function(){return ze()},e.WAIT_FOR_POPUP_CONTENT_RESIZE)}},t.prototype.getActivePopups=function(){return this.popupList.map(function(r){return r.element})},t.prototype.getPopupList=function(){return this.popupList},t.prototype.getParentRect=function(){var r=this.gridOptionsService.getDocument(),o=this.getPopupParent();return o===r.body?o=r.documentElement:getComputedStyle(o).position==="static"&&(o=o.offsetParent),getElementRectWithOffset(o)},t.prototype.keepXYWithinBounds=function(r,o,s){var l=s===DIRECTION.vertical,a=l?"clientHeight":"clientWidth",h=l?"top":"left",y=l?"offsetHeight":"offsetWidth",C=l?"scrollTop":"scrollLeft",L=this.gridOptionsService.getDocument(),Y=L.documentElement,ze=this.getPopupParent(),Bt=ze.getBoundingClientRect(),Ir=L.documentElement.getBoundingClientRect(),Wr=ze===L.body,yi=r[y],Bn=l?getAbsoluteHeight:getAbsoluteWidth,vi=Wr?Bn(Y)+Y[C]:ze[a];Wr&&(vi-=Math.abs(Ir[h]-Bt[h]));var wo=vi-yi;return Math.min(Math.max(o,0),Math.abs(wo))},t.prototype.addPopup=function(r){var o=this.gridOptionsService.getDocument(),s=r.eChild,l=r.ariaLabel,a=r.alwaysOnTop,h=r.positionCallback,y=r.anchorToElement;if(!o)return console.warn("AG Grid: could not find the document, document is empty"),{hideFunc:function(){}};var C=this.popupList.findIndex(function(Bt){return Bt.element===s});if(C!==-1){var L=this.popupList[C];return{hideFunc:L.hideFunc}}this.initialisePopupPosition(s);var Y=this.createPopupWrapper(s,l,!!a),ze=this.addEventListenersToPopup(__assign$3(__assign$3({},r),{wrapperEl:Y}));return h&&h(),this.addPopupToPopupList(s,Y,ze,y),{hideFunc:ze}},t.prototype.initialisePopupPosition=function(r){var o=this.getPopupParent(),s=o.getBoundingClientRect();exists(r.style.top)||(r.style.top=s.top*-1+"px"),exists(r.style.left)||(r.style.left=s.left*-1+"px")},t.prototype.createPopupWrapper=function(r,o,s){var l,a=this.getPopupParent(),h=document.createElement("div"),y=this.environment.getTheme().allThemes;return y.length&&(l=h.classList).add.apply(l,__spreadArray$9([],__read$b(y))),h.classList.add("ag-popup"),r.classList.add(this.gridOptionsService.is("enableRtl")?"ag-rtl":"ag-ltr","ag-popup-child"),r.hasAttribute("role")||setAriaRole(r,"dialog"),setAriaLabel(r,o),this.focusService.isKeyboardMode()&&r.classList.add(FocusService.AG_KEYBOARD_FOCUS),h.appendChild(r),a.appendChild(h),s?this.setAlwaysOnTop(r,!0):this.bringPopupToFront(r),h},t.prototype.addEventListenersToPopup=function(r){var o=this,s=this.gridOptionsService.getDocument(),l=this.getPopupParent(),a=r.wrapperEl,h=r.eChild,y=r.click,C=r.closedCallback,L=r.afterGuiAttached,Y=r.closeOnEsc,ze=r.modal,Bt=!1,Ir=function(vi){if(a.contains(s.activeElement)){var wo=vi.key;wo===KeyCode.ESCAPE&&Bn({keyboardEvent:vi})}},Wr=function(vi){return Bn({mouseEvent:vi})},yi=function(vi){return Bn({touchEvent:vi})},Bn=function(vi){vi===void 0&&(vi={});var wo=vi.mouseEvent,ia=vi.touchEvent,gl=vi.keyboardEvent;o.isEventFromCurrentPopup({mouseEvent:wo,touchEvent:ia},h)||o.isEventSameChainAsOriginalEvent({originalMouseEvent:y,mouseEvent:wo,touchEvent:ia})||Bt||(Bt=!0,l.removeChild(a),s.removeEventListener("keydown",Ir),s.removeEventListener("mousedown",Wr),s.removeEventListener("touchstart",yi),s.removeEventListener("contextmenu",Wr),o.eventService.removeEventListener(Events.EVENT_DRAG_STARTED,Wr),C&&C(wo||ia||gl),o.removePopupFromPopupList(h))};return L&&L({hidePopup:Bn}),window.setTimeout(function(){Y&&s.addEventListener("keydown",Ir),ze&&(s.addEventListener("mousedown",Wr),o.eventService.addEventListener(Events.EVENT_DRAG_STARTED,Wr),s.addEventListener("touchstart",yi),s.addEventListener("contextmenu",Wr))},0),Bn},t.prototype.addPopupToPopupList=function(r,o,s,l){this.popupList.push({element:r,wrapper:o,hideFunc:s,instanceId:instanceIdSeq++,isAnchored:!!l}),l&&this.setPopupPositionRelatedToElement(r,l)},t.prototype.setPopupPositionRelatedToElement=function(r,o){var s=this.popupList.find(function(a){return a.element===r});if(s&&(s.stopAnchoringPromise&&s.stopAnchoringPromise.then(function(a){return a&&a()}),s.stopAnchoringPromise=void 0,s.isAnchored=!1,!!o)){var l=this.keepPopupPositionedRelativeTo({element:o,ePopup:r,hidePopup:s.hideFunc});return s.stopAnchoringPromise=l,s.isAnchored=!0,l}},t.prototype.removePopupFromPopupList=function(r){this.setPopupPositionRelatedToElement(r,null),this.popupList=this.popupList.filter(function(o){return o.element!==r})},t.prototype.keepPopupPositionedRelativeTo=function(r){var o=this,s=this.getPopupParent(),l=s.getBoundingClientRect(),a=r.element,h=r.ePopup,y=a.getBoundingClientRect(),C=l.top-y.top,L=l.left-y.left,Y=C,ze=L,Bt=h.style.top,Ir=parseInt(Bt.substring(0,Bt.length-1),10),Wr=h.style.left,yi=parseInt(Wr.substring(0,Wr.length-1),10);return new AgPromise(function(Bn){o.getFrameworkOverrides().setInterval(function(){var vi=s.getBoundingClientRect(),wo=a.getBoundingClientRect(),ia=wo.top==0&&wo.left==0&&wo.height==0&&wo.width==0;if(ia){r.hidePopup();return}var gl=vi.top-wo.top;if(gl!=Y){var ml=o.keepXYWithinBounds(h,Ir+C-gl,DIRECTION.vertical);h.style.top=ml+"px"}Y=gl;var il=vi.left-wo.left;if(il!=ze){var sl=o.keepXYWithinBounds(h,yi+L-il,DIRECTION.horizontal);h.style.left=sl+"px"}ze=il},200).then(function(vi){var wo=function(){vi!=null&&window.clearInterval(vi)};Bn(wo)})})},t.prototype.hasAnchoredPopup=function(){return this.popupList.some(function(r){return r.isAnchored})},t.prototype.isEventFromCurrentPopup=function(r,o){var s=r.mouseEvent,l=r.touchEvent,a=s||l;if(!a)return!1;var h=this.popupList.findIndex(function(L){return L.element===o});if(h===-1)return!1;for(var y=h;y<this.popupList.length;y++){var C=this.popupList[y];if(isElementInEventPath(C.element,a))return!0}return this.isElementWithinCustomPopup(a.target)},t.prototype.isElementWithinCustomPopup=function(r){for(var o=this.gridOptionsService.getDocument();r&&r!==o.body;){if(r.classList.contains("ag-custom-component-popup")||r.parentElement===null)return!0;r=r.parentElement}return!1},t.prototype.isEventSameChainAsOriginalEvent=function(r){var o=r.originalMouseEvent,s=r.mouseEvent,l=r.touchEvent,a=null;if(s?a=s:l&&(a=l.touches[0]),a&&o){var h=s?s.screenX:0,y=s?s.screenY:0,C=Math.abs(o.screenX-h)<5,L=Math.abs(o.screenY-y)<5;if(C&&L)return!0}return!1},t.prototype.getWrapper=function(r){for(;!r.classList.contains("ag-popup")&&r.parentElement;)r=r.parentElement;return r.classList.contains("ag-popup")?r:null},t.prototype.setAlwaysOnTop=function(r,o){var s=this.getWrapper(r);s&&(s.classList.toggle("ag-always-on-top",!!o),o&&this.bringPopupToFront(s))},t.prototype.bringPopupToFront=function(r){var o=this.getPopupParent(),s=Array.prototype.slice.call(o.querySelectorAll(".ag-popup")),l=s.length,a=Array.prototype.slice.call(o.querySelectorAll(".ag-popup.ag-always-on-top")),h=a.length,y=this.getWrapper(r);if(!(!y||l<=1||!o.contains(r))){var C=s.indexOf(y),L=y.querySelectorAll("div"),Y=[];if(L.forEach(function(Wr){Wr.scrollTop!==0&&Y.push([Wr,Wr.scrollTop])}),h){var ze=y.classList.contains("ag-always-on-top");ze?C!==l-1&&last(a).insertAdjacentElement("afterend",y):C!==l-h-1&&a[0].insertAdjacentElement("beforebegin",y)}else C!==l-1&&last(s).insertAdjacentElement("afterend",y);for(;Y.length;){var Bt=Y.pop();Bt[0].scrollTop=Bt[1]}var Ir={type:"popupToFront",api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,eWrapper:y};this.eventService.dispatchEvent(Ir)}};var e;return t.WAIT_FOR_POPUP_CONTENT_RESIZE=200,__decorate$S([Autowired("focusService")],t.prototype,"focusService",void 0),__decorate$S([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),__decorate$S([Autowired("resizeObserverService")],t.prototype,"resizeObserverService",void 0),__decorate$S([PostConstruct],t.prototype,"postConstruct",null),t=e=__decorate$S([Bean("popupService")],t),t}(BeanStub),__extends$P=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$R=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};(function(n){__extends$P(t,n);function t(e,r,o){e===void 0&&(e="default"),r===void 0&&(r="listbox");var s=n.call(this,t.getTemplate(e))||this;return s.cssIdentifier=e,s.ariaRole=r,s.listName=o,s.renderedRows=new Map,s.rowHeight=20,s}return t.prototype.postConstruct=function(){var e=this;this.addScrollListener(),this.rowHeight=this.getItemHeight(),this.addResizeObserver(),this.initialiseTabGuard({onFocusIn:function(r){return e.onFocusIn(r)},onFocusOut:function(r){return e.onFocusOut(r)},focusInnerElement:function(r){return e.focusInnerElement(r)},onTabKeyDown:function(r){return e.onTabKeyDown(r)},handleKeyDown:function(r){return e.handleKeyDown(r)}}),this.setAriaProperties(),this.addManagedListener(this.eventService,Events.EVENT_GRID_STYLES_CHANGED,this.onGridStylesChanged.bind(this))},t.prototype.onGridStylesChanged=function(){this.rowHeight=this.getItemHeight(),this.refresh()},t.prototype.setAriaProperties=function(){var e=this.localeService.getLocaleTextFunc(),r=e("ariaDefaultListName",this.listName||"List"),o=this.eContainer;setAriaRole(o,this.ariaRole),setAriaLabel(o,r)},t.prototype.addResizeObserver=function(){var e=this,r=function(){return e.drawVirtualRows()},o=this.resizeObserverService.observeResize(this.getGui(),r);this.addDestroyFunc(o)},t.prototype.focusInnerElement=function(e){this.focusRow(e?this.model.getRowCount()-1:0)},t.prototype.onFocusIn=function(e){var r=e.target;return r.classList.contains("ag-virtual-list-item")&&(this.lastFocusedRowIndex=getAriaPosInSet(r)-1),!1},t.prototype.onFocusOut=function(e){return this.getFocusableElement().contains(e.relatedTarget)||(this.lastFocusedRowIndex=null),!1},t.prototype.handleKeyDown=function(e){switch(e.key){case KeyCode.UP:case KeyCode.DOWN:this.navigate(e.key===KeyCode.UP)&&e.preventDefault();break}},t.prototype.onTabKeyDown=function(e){this.navigate(e.shiftKey)?e.preventDefault():(stopPropagationForAgGrid(e),this.forceFocusOutOfContainer(e.shiftKey))},t.prototype.navigate=function(e){if(this.lastFocusedRowIndex==null)return!1;var r=this.lastFocusedRowIndex+(e?-1:1);return r<0||r>=this.model.getRowCount()?!1:(this.focusRow(r),!0)},t.prototype.getLastFocusedRow=function(){return this.lastFocusedRowIndex},t.prototype.focusRow=function(e){var r=this;this.ensureIndexVisible(e),window.setTimeout(function(){if(r.isAlive()){var o=r.renderedRows.get(e);o&&o.eDiv.focus()}},10)},t.prototype.getComponentAt=function(e){var r=this.renderedRows.get(e);return r&&r.rowComponent},t.prototype.forEachRenderedRow=function(e){this.renderedRows.forEach(function(r,o){return e(r.rowComponent,o)})},t.getTemplate=function(e){return`
            <div class="ag-virtual-list-viewport ag-`+e+`-virtual-list-viewport" role="presentation">
                <div class="ag-virtual-list-container ag-`+e+`-virtual-list-container" ref="eContainer"></div>
            </div>`},t.prototype.getItemHeight=function(){return this.environment.getListItemHeight()},t.prototype.ensureIndexVisible=function(e){var r=this.model.getRowCount();if(typeof e!="number"||e<0||e>=r){console.warn("AG Grid: invalid row index for ensureIndexVisible: "+e);return}var o=e*this.rowHeight,s=o+this.rowHeight,l=this.getGui(),a=l.scrollTop,h=l.offsetHeight,y=a+h,C=a>o,L=y<s;if(C)l.scrollTop=o;else if(L){var Y=s-h;l.scrollTop=Y}},t.prototype.setComponentCreator=function(e){this.componentCreator=e},t.prototype.setComponentUpdater=function(e){this.componentUpdater=e},t.prototype.getRowHeight=function(){return this.rowHeight},t.prototype.getScrollTop=function(){return this.getGui().scrollTop},t.prototype.setRowHeight=function(e){this.rowHeight=e,this.refresh()},t.prototype.refresh=function(e){var r=this;if(!(this.model==null||!this.isAlive())){var o=this.model.getRowCount();this.eContainer.style.height=o*this.rowHeight+"px",waitUntil(function(){return r.eContainer.clientHeight>=o*r.rowHeight},function(){r.isAlive()&&(r.canSoftRefresh(e)?r.drawVirtualRows(!0):(r.clearVirtualRows(),r.drawVirtualRows()))})}},t.prototype.canSoftRefresh=function(e){return!!(e&&this.renderedRows.size&&typeof this.model.areRowsEqual=="function"&&this.componentUpdater)},t.prototype.clearVirtualRows=function(){var e=this;this.renderedRows.forEach(function(r,o){return e.removeRow(o)})},t.prototype.drawVirtualRows=function(e){if(this.isAlive()){var r=this.getGui(),o=r.scrollTop,s=o+r.offsetHeight,l=Math.floor(o/this.rowHeight),a=Math.floor(s/this.rowHeight);this.ensureRowsRendered(l,a,e)}},t.prototype.ensureRowsRendered=function(e,r,o){var s=this;this.renderedRows.forEach(function(a,h){(h<e||h>r)&&h!==s.lastFocusedRowIndex&&s.removeRow(h)}),o&&this.refreshRows();for(var l=e;l<=r;l++)this.renderedRows.has(l)||l<this.model.getRowCount()&&this.insertRow(l)},t.prototype.insertRow=function(e){var r=this,o=this.model.getRow(e),s=document.createElement("div");if(s.classList.add("ag-virtual-list-item","ag-"+this.cssIdentifier+"-virtual-list-item"),setAriaRole(s,this.ariaRole==="tree"?"treeitem":"option"),setAriaSetSize(s,this.model.getRowCount()),setAriaPosInSet(s,e+1),s.setAttribute("tabindex","-1"),typeof this.model.isRowSelected=="function"){var l=this.model.isRowSelected(e);setAriaSelected(s,!!l),setAriaChecked(s,l)}s.style.height=this.rowHeight+"px",s.style.top=this.rowHeight*e+"px";var a=this.componentCreator(o,s);a.addGuiEventListener("focusin",function(){return r.lastFocusedRowIndex=e}),s.appendChild(a.getGui()),this.renderedRows.has(e-1)?this.renderedRows.get(e-1).eDiv.insertAdjacentElement("afterend",s):this.renderedRows.has(e+1)?this.renderedRows.get(e+1).eDiv.insertAdjacentElement("beforebegin",s):this.eContainer.appendChild(s),this.renderedRows.set(e,{rowComponent:a,eDiv:s,value:o})},t.prototype.removeRow=function(e){var r=this.renderedRows.get(e);this.eContainer.removeChild(r.eDiv),this.destroyBean(r.rowComponent),this.renderedRows.delete(e)},t.prototype.refreshRows=function(){var e=this,r=this.model.getRowCount();this.renderedRows.forEach(function(o,s){var l,a;if(s>=r)e.removeRow(s);else{var h=e.model.getRow(s);!((a=(l=e.model).areRowsEqual)===null||a===void 0)&&a.call(l,o.value,h)?e.componentUpdater(h,o.rowComponent):e.removeRow(s)}})},t.prototype.addScrollListener=function(){var e=this;this.addGuiEventListener("scroll",function(){return e.drawVirtualRows()},{passive:!0})},t.prototype.setModel=function(e){this.model=e},t.prototype.destroy=function(){this.isAlive()&&(this.clearVirtualRows(),n.prototype.destroy.call(this))},__decorate$R([Autowired("resizeObserverService")],t.prototype,"resizeObserverService",void 0),__decorate$R([RefSelector("eContainer")],t.prototype,"eContainer",void 0),__decorate$R([PostConstruct],t.prototype,"postConstruct",null),t})(TabGuardComp);var OUTSIDE_ANGULAR_EVENTS=["mouseover","mouseout","mouseenter","mouseleave","mousemove"],PASSIVE_EVENTS=["touchstart","touchend","touchmove","touchcancel"],VanillaFrameworkOverrides=function(){function n(){this.renderingEngine="vanilla",this.isOutsideAngular=function(t){return includes(OUTSIDE_ANGULAR_EVENTS,t)}}return n.prototype.setTimeout=function(t,e){window.setTimeout(t,e)},n.prototype.setInterval=function(t,e){return new AgPromise(function(r){r(window.setInterval(t,e))})},n.prototype.addEventListener=function(t,e,r,o){var s=includes(PASSIVE_EVENTS,e);t.addEventListener(e,r,{capture:!!o,passive:s})},n.prototype.dispatchEvent=function(t,e,r){e()},n.prototype.frameworkComponent=function(t){return null},n.prototype.isFrameworkComponent=function(t){return!1},n}(),__extends$O=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$Q=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__read$a=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray$8=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n},CellNavigationService=function(n){__extends$O(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.getNextCellToFocus=function(e,r,o){return o===void 0&&(o=!1),o?this.getNextCellToFocusWithCtrlPressed(e,r):this.getNextCellToFocusWithoutCtrlPressed(e,r)},t.prototype.getNextCellToFocusWithCtrlPressed=function(e,r){var o=e===KeyCode.UP,s=e===KeyCode.DOWN,l=e===KeyCode.LEFT,a,h;if(o||s)h=o?this.paginationProxy.getPageFirstRow():this.paginationProxy.getPageLastRow(),a=r.column;else{var y=this.columnModel.getAllDisplayedColumns(),C=this.gridOptionsService.is("enableRtl");h=r.rowIndex,a=l!==C?y[0]:last(y)}return{rowIndex:h,rowPinned:null,column:a}},t.prototype.getNextCellToFocusWithoutCtrlPressed=function(e,r){for(var o=r,s=!1;!s;){switch(e){case KeyCode.UP:o=this.getCellAbove(o);break;case KeyCode.DOWN:o=this.getCellBelow(o);break;case KeyCode.RIGHT:this.gridOptionsService.is("enableRtl")?o=this.getCellToLeft(o):o=this.getCellToRight(o);break;case KeyCode.LEFT:this.gridOptionsService.is("enableRtl")?o=this.getCellToRight(o):o=this.getCellToLeft(o);break;default:o=null,console.warn("AG Grid: unknown key for navigation "+e);break}o?s=this.isCellGoodToFocusOn(o):s=!0}return o},t.prototype.isCellGoodToFocusOn=function(e){var r=e.column,o;switch(e.rowPinned){case"top":o=this.pinnedRowModel.getPinnedTopRow(e.rowIndex);break;case"bottom":o=this.pinnedRowModel.getPinnedBottomRow(e.rowIndex);break;default:o=this.rowModel.getRow(e.rowIndex);break}if(!o)return!1;var s=r.isSuppressNavigable(o);return!s},t.prototype.getCellToLeft=function(e){if(!e)return null;var r=this.columnModel.getDisplayedColBefore(e.column);return r?{rowIndex:e.rowIndex,column:r,rowPinned:e.rowPinned}:null},t.prototype.getCellToRight=function(e){if(!e)return null;var r=this.columnModel.getDisplayedColAfter(e.column);return r?{rowIndex:e.rowIndex,column:r,rowPinned:e.rowPinned}:null},t.prototype.getRowBelow=function(e){var r=e.rowIndex,o=e.rowPinned;if(this.isLastRowInContainer(e))switch(o){case"bottom":return null;case"top":return this.rowModel.isRowsToRender()?{rowIndex:this.paginationProxy.getPageFirstRow(),rowPinned:null}:this.pinnedRowModel.isRowsToRender("bottom")?{rowIndex:0,rowPinned:"bottom"}:null;default:return this.pinnedRowModel.isRowsToRender("bottom")?{rowIndex:0,rowPinned:"bottom"}:null}var s=this.rowModel.getRow(e.rowIndex),l=this.getNextStickyPosition(s);return l||{rowIndex:r+1,rowPinned:o}},t.prototype.getNextStickyPosition=function(e,r){if(!(!this.gridOptionsService.isGroupRowsSticky()||!e||!e.sticky)){var o=__spreadArray$8([],__read$a(this.rowRenderer.getStickyTopRowCtrls())).sort(function(h,y){return h.getRowNode().rowIndex-y.getRowNode().rowIndex}),s=r?-1:1,l=o.findIndex(function(h){return h.getRowNode().rowIndex===e.rowIndex}),a=o[l+s];if(a)return{rowIndex:a.getRowNode().rowIndex,rowPinned:null}}},t.prototype.getCellBelow=function(e){if(!e)return null;var r=this.getRowBelow(e);return r?{rowIndex:r.rowIndex,column:e.column,rowPinned:r.rowPinned}:null},t.prototype.isLastRowInContainer=function(e){var r=e.rowPinned,o=e.rowIndex;if(r==="top"){var s=this.pinnedRowModel.getPinnedTopRowData().length-1;return s<=o}if(r==="bottom"){var l=this.pinnedRowModel.getPinnedBottomRowData().length-1;return l<=o}var a=this.paginationProxy.getPageLastRow();return a<=o},t.prototype.getRowAbove=function(e){var r=e.rowIndex,o=e.rowPinned,s=o?r===0:r===this.paginationProxy.getPageFirstRow();if(s)return o==="top"?null:o?this.rowModel.isRowsToRender()?this.getLastBodyCell():this.pinnedRowModel.isRowsToRender("top")?this.getLastFloatingTopRow():null:this.pinnedRowModel.isRowsToRender("top")?this.getLastFloatingTopRow():null;var l=this.rowModel.getRow(e.rowIndex),a=this.getNextStickyPosition(l,!0);return a||{rowIndex:r-1,rowPinned:o}},t.prototype.getCellAbove=function(e){if(!e)return null;var r=this.getRowAbove({rowIndex:e.rowIndex,rowPinned:e.rowPinned});return r?{rowIndex:r.rowIndex,column:e.column,rowPinned:r.rowPinned}:null},t.prototype.getLastBodyCell=function(){var e=this.paginationProxy.getPageLastRow();return{rowIndex:e,rowPinned:null}},t.prototype.getLastFloatingTopRow=function(){var e=this.pinnedRowModel.getPinnedTopRowData().length-1;return{rowIndex:e,rowPinned:"top"}},t.prototype.getNextTabbedCell=function(e,r){return r?this.getNextTabbedCellBackwards(e):this.getNextTabbedCellForwards(e)},t.prototype.getNextTabbedCellForwards=function(e){var r=this.columnModel.getAllDisplayedColumns(),o=e.rowIndex,s=e.rowPinned,l=this.columnModel.getDisplayedColAfter(e.column);if(!l){l=r[0];var a=this.getRowBelow(e);if(missing(a)||!a.rowPinned&&!this.paginationProxy.isRowInPage(a))return null;o=a?a.rowIndex:null,s=a?a.rowPinned:null}return{rowIndex:o,column:l,rowPinned:s}},t.prototype.getNextTabbedCellBackwards=function(e){var r=this.columnModel.getAllDisplayedColumns(),o=e.rowIndex,s=e.rowPinned,l=this.columnModel.getDisplayedColBefore(e.column);if(!l){l=last(r);var a=this.getRowAbove({rowIndex:e.rowIndex,rowPinned:e.rowPinned});if(missing(a)||!a.rowPinned&&!this.paginationProxy.isRowInPage(a))return null;o=a?a.rowIndex:null,s=a?a.rowPinned:null}return{rowIndex:o,column:l,rowPinned:s}},__decorate$Q([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$Q([Autowired("rowModel")],t.prototype,"rowModel",void 0),__decorate$Q([Autowired("rowRenderer")],t.prototype,"rowRenderer",void 0),__decorate$Q([Autowired("pinnedRowModel")],t.prototype,"pinnedRowModel",void 0),__decorate$Q([Autowired("paginationProxy")],t.prototype,"paginationProxy",void 0),t=__decorate$Q([Bean("cellNavigationService")],t),t}(BeanStub),__extends$N=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$P=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__param$6=function(n,t){return function(e,r){t(e,r,n)}},AlignedGridsService=function(n){__extends$N(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.consuming=!1,e}return t.prototype.setBeans=function(e){this.logger=e.create("AlignedGridsService")},t.prototype.init=function(){this.addManagedListener(this.eventService,Events.EVENT_COLUMN_MOVED,this.fireColumnEvent.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_VISIBLE,this.fireColumnEvent.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_PINNED,this.fireColumnEvent.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_GROUP_OPENED,this.fireColumnEvent.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_RESIZED,this.fireColumnEvent.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_BODY_SCROLL,this.fireScrollEvent.bind(this))},t.prototype.fireEvent=function(e){if(!this.consuming){var r=this.gridOptionsService.get("alignedGrids");r&&r.forEach(function(o){if(o.api){var s=o.api.__getAlignedGridService();e(s)}})}},t.prototype.onEvent=function(e){this.consuming=!0,e(),this.consuming=!1},t.prototype.fireColumnEvent=function(e){this.fireEvent(function(r){r.onColumnEvent(e)})},t.prototype.fireScrollEvent=function(e){e.direction==="horizontal"&&this.fireEvent(function(r){r.onScrollEvent(e)})},t.prototype.onScrollEvent=function(e){var r=this;this.onEvent(function(){var o=r.ctrlsService.getGridBodyCtrl();o.getScrollFeature().setHorizontalScrollPosition(e.left,!0)})},t.prototype.getMasterColumns=function(e){var r=[];return e.columns?e.columns.forEach(function(o){r.push(o)}):e.column&&r.push(e.column),r},t.prototype.getColumnIds=function(e){var r=[];return e.columns?e.columns.forEach(function(o){r.push(o.getColId())}):e.column&&r.push(e.column.getColId()),r},t.prototype.onColumnEvent=function(e){var r=this;this.onEvent(function(){switch(e.type){case Events.EVENT_COLUMN_MOVED:case Events.EVENT_COLUMN_VISIBLE:case Events.EVENT_COLUMN_PINNED:case Events.EVENT_COLUMN_RESIZED:var o=e;r.processColumnEvent(o);break;case Events.EVENT_COLUMN_GROUP_OPENED:var s=e;r.processGroupOpenedEvent(s);break;case Events.EVENT_COLUMN_PIVOT_CHANGED:console.warn("AG Grid: pivoting is not supported with aligned grids. You can only use one of these features at a time in a grid.");break}})},t.prototype.processGroupOpenedEvent=function(e){var r=e.columnGroup,o=null;if(r){var s=r.getGroupId();o=this.columnModel.getProvidedColumnGroup(s)}r&&!o||(this.logger.log("onColumnEvent-> processing "+e+" expanded = "+r.isExpanded()),this.columnModel.setColumnGroupOpened(o,r.isExpanded(),"alignedGridChanged"))},t.prototype.processColumnEvent=function(e){var r=this,o,s=e.column,l=null;if(s&&(l=this.columnModel.getPrimaryColumn(s.getColId())),!(s&&!l)){var a=this.getMasterColumns(e);switch(e.type){case Events.EVENT_COLUMN_MOVED:{var h=e,y=e.columnApi.getColumnState(),C=y.map(function(Bn){return{colId:Bn.colId}});this.columnModel.applyColumnState({state:C,applyOrder:!0},"alignedGridChanged"),this.logger.log("onColumnEvent-> processing "+e.type+" toIndex = "+h.toIndex)}break;case Events.EVENT_COLUMN_VISIBLE:{var L=e,y=e.columnApi.getColumnState(),C=y.map(function(wo){return{colId:wo.colId,hide:wo.hide}});this.columnModel.applyColumnState({state:C},"alignedGridChanged"),this.logger.log("onColumnEvent-> processing "+e.type+" visible = "+L.visible)}break;case Events.EVENT_COLUMN_PINNED:{var Y=e,y=e.columnApi.getColumnState(),C=y.map(function(wo){return{colId:wo.colId,pinned:wo.pinned}});this.columnModel.applyColumnState({state:C},"alignedGridChanged"),this.logger.log("onColumnEvent-> processing "+e.type+" pinned = "+Y.pinned)}break;case Events.EVENT_COLUMN_RESIZED:var ze=e,Bt={};a.forEach(function(Bn){r.logger.log("onColumnEvent-> processing "+e.type+" actualWidth = "+Bn.getActualWidth()),Bt[Bn.getId()]={key:Bn.getColId(),newWidth:Bn.getActualWidth()}}),(o=ze.flexColumns)===null||o===void 0||o.forEach(function(Bn){Bt[Bn.getId()]&&delete Bt[Bn.getId()]}),this.columnModel.setColumnWidths(Object.values(Bt),!1,ze.finished,"alignedGridChanged");break}var Ir=this.ctrlsService.getGridBodyCtrl(),Wr=Ir.isVerticalScrollShowing(),yi=this.gridOptionsService.get("alignedGrids");yi&&yi.forEach(function(Bn){Bn.api&&Bn.api.setAlwaysShowVerticalScroll(Wr)})}},__decorate$P([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$P([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),__decorate$P([__param$6(0,Qualifier("loggerFactory"))],t.prototype,"setBeans",null),__decorate$P([PostConstruct],t.prototype,"init",null),t=__decorate$P([Bean("alignedGridsService")],t),t}(BeanStub),__extends$M=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$O=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__param$5=function(n,t){return function(e,r){t(e,r,n)}},__read$9=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},SelectionService=function(n){__extends$M(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.setBeans=function(e){this.logger=e.create("selectionService"),this.reset()},t.prototype.init=function(){var e=this;this.groupSelectsChildren=this.gridOptionsService.is("groupSelectsChildren"),this.addManagedPropertyListener("groupSelectsChildren",function(r){return e.groupSelectsChildren=r.currentValue}),this.rowSelection=this.gridOptionsService.get("rowSelection"),this.addManagedPropertyListener("rowSelection",function(r){return e.rowSelection=r.currentValue}),this.addManagedListener(this.eventService,Events.EVENT_ROW_SELECTED,this.onRowSelected.bind(this))},t.prototype.isMultiselect=function(){return this.rowSelection==="multiple"},t.prototype.setNodesSelected=function(e){var r;if(e.nodes.length===0)return 0;var o=e.newValue,s=e.clearSelection,l=e.suppressFinishActions,a=e.rangeSelect;e.event;var h=e.source,y=h===void 0?"api":h;if(e.nodes.length>1&&!this.isMultiselect())return console.warn("AG Grid: cannot multi select while rowSelection='single'"),0;var C=this.groupSelectsChildren&&e.groupSelectsFiltered===!0,L=e.nodes.map(function(gl){return gl.footer?gl.sibling:gl});if(a){if(e.nodes.length>1)return console.warn("AG Grid: cannot range select while selecting multiple rows"),0;var Y=this.getLastSelectedNode();if(Y){var ze=L[0],Bt=Y!==ze;if(Bt&&this.isMultiselect()){var Ir=this.selectRange(ze,Y,e.newValue,y);return this.setLastSelectedNode(ze),Ir}}}for(var Wr=0,yi=0;yi<L.length;yi++){var ze=L[yi],Bn=C&&ze.group;if(!Bn){var vi=ze.selectThisNode(o,e.event,y);vi&&Wr++}this.groupSelectsChildren&&(!((r=ze.childrenAfterGroup)===null||r===void 0)&&r.length)&&(Wr+=this.selectChildren(ze,o,C,y))}if(!l){var wo=o&&(s||!this.isMultiselect());if(wo&&(Wr+=this.clearOtherNodes(L[0],y)),Wr>0){this.updateGroupsFromChildrenSelections(y);var ia={type:Events.EVENT_SELECTION_CHANGED,source:y};this.eventService.dispatchEvent(ia)}o&&this.setLastSelectedNode(L[L.length-1])}return Wr},t.prototype.selectRange=function(e,r,o,s){var l=this;o===void 0&&(o=!0);var a=this.rowModel.getNodesInRangeForSelection(e,r),h=0;a.forEach(function(C){if(!(C.group&&l.groupSelectsChildren||o===!1&&e===C)){var L=C.selectThisNode(o,void 0,s);L&&h++}}),this.updateGroupsFromChildrenSelections(s);var y={type:Events.EVENT_SELECTION_CHANGED,source:s};return this.eventService.dispatchEvent(y),h},t.prototype.selectChildren=function(e,r,o,s){var l=o?e.childrenAfterAggFilter:e.childrenAfterGroup;return _.missing(l)?0:this.setNodesSelected({newValue:r,clearSelection:!1,suppressFinishActions:!0,groupSelectsFiltered:o,source:s,nodes:l})},t.prototype.setLastSelectedNode=function(e){this.lastSelectedNode=e},t.prototype.getLastSelectedNode=function(){return this.lastSelectedNode},t.prototype.getSelectedNodes=function(){var e=[];return iterateObject(this.selectedNodes,function(r,o){o&&e.push(o)}),e},t.prototype.getSelectedRows=function(){var e=[];return iterateObject(this.selectedNodes,function(r,o){o&&o.data&&e.push(o.data)}),e},t.prototype.getSelectionCount=function(){return Object.values(this.selectedNodes).length},t.prototype.filterFromSelection=function(e){var r={};Object.entries(this.selectedNodes).forEach(function(o){var s=__read$9(o,2),l=s[0],a=s[1],h=a&&e(a);h&&(r[l]=a)}),this.selectedNodes=r},t.prototype.updateGroupsFromChildrenSelections=function(e,r){if(!this.groupSelectsChildren||this.rowModel.getType()!=="clientSide")return!1;var o=this.rowModel,s=o.getRootNode();r||(r=new ChangedPath(!0,s),r.setInactive());var l=!1;return r.forEachChangedNodeDepthFirst(function(a){if(a!==s){var h=a.calculateSelectedFromChildren();l=a.selectThisNode(h===null?!1:h,void 0,e)||l}}),l},t.prototype.clearOtherNodes=function(e,r){var o=this,s={},l=0;return iterateObject(this.selectedNodes,function(a,h){if(h&&h.id!==e.id){var y=o.selectedNodes[h.id];l+=y.setSelectedParams({newValue:!1,clearSelection:!1,suppressFinishActions:!0,source:r}),o.groupSelectsChildren&&h.parent&&(s[h.parent.id]=h.parent)}}),iterateObject(s,function(a,h){var y=h.calculateSelectedFromChildren();h.selectThisNode(y===null?!1:y,void 0,r)}),l},t.prototype.onRowSelected=function(e){var r=e.node;this.groupSelectsChildren&&r.group||(r.isSelected()?this.selectedNodes[r.id]=r:delete this.selectedNodes[r.id])},t.prototype.syncInRowNode=function(e,r){this.syncInOldRowNode(e,r),this.syncInNewRowNode(e)},t.prototype.syncInOldRowNode=function(e,r){var o=exists(r)&&e.id!==r.id;if(o&&r){var s=r.id,l=this.selectedNodes[s]==e;l&&(this.selectedNodes[r.id]=r)}},t.prototype.syncInNewRowNode=function(e){exists(this.selectedNodes[e.id])?(e.setSelectedInitialValue(!0),this.selectedNodes[e.id]=e):e.setSelectedInitialValue(!1)},t.prototype.reset=function(){this.logger.log("reset"),this.selectedNodes={},this.lastSelectedNode=null},t.prototype.getBestCostNodeSelection=function(){if(this.rowModel.getType()!=="clientSide")return;var e=this.rowModel,r=e.getTopLevelNodes();if(r===null)return;var o=[];function s(l){for(var a=0,h=l.length;a<h;a++){var y=l[a];if(y.isSelected())o.push(y);else{var C=y;C.group&&C.children&&s(C.children)}}}return s(r),o},t.prototype.isEmpty=function(){var e=0;return iterateObject(this.selectedNodes,function(r,o){o&&e++}),e===0},t.prototype.deselectAllRowNodes=function(e){var r=function(y){return y.selectThisNode(!1,void 0,s)},o=this.rowModel.getType()==="clientSide",s=e.source,l=e.justFiltered,a=e.justCurrentPage;if(a||l){if(!o){console.error("AG Grid: selecting just filtered only works when gridOptions.rowModelType='clientSide'");return}this.getNodesToSelect(l,a).forEach(r)}else iterateObject(this.selectedNodes,function(y,C){C&&r(C)}),this.reset();o&&this.groupSelectsChildren&&this.updateGroupsFromChildrenSelections(s);var h={type:Events.EVENT_SELECTION_CHANGED,source:s};this.eventService.dispatchEvent(h)},t.prototype.getSelectAllState=function(e,r){var o=this,s=0,l=0,a=function(h){o.groupSelectsChildren&&h.group||(h.isSelected()?s++:h.selectable&&l++)};return this.getNodesToSelect(e,r).forEach(a),s===0&&l===0?!1:s>0&&l>0?null:s>0},t.prototype.getNodesToSelect=function(e,r){var o=this;if(e===void 0&&(e=!1),r===void 0&&(r=!1),this.rowModel.getType()!=="clientSide")throw new Error("selectAll only available when rowModelType='clientSide', ie not "+this.rowModel.getType());var s=[];if(r)return this.paginationProxy.forEachNodeOnPage(function(a){if(!a.group){s.push(a);return}if(!a.expanded){var h=function(y){var C;s.push(y),!((C=y.childrenAfterFilter)===null||C===void 0)&&C.length&&y.childrenAfterFilter.forEach(h)};h(a);return}o.groupSelectsChildren||s.push(a)}),s;var l=this.rowModel;return e?(l.forEachNodeAfterFilter(function(a){s.push(a)}),s):(l.forEachNode(function(a){s.push(a)}),s)},t.prototype.selectAllRowNodes=function(e){if(this.rowModel.getType()!=="clientSide")throw new Error("selectAll only available when rowModelType='clientSide', ie not "+this.rowModel.getType());var r=e.source,o=e.justFiltered,s=e.justCurrentPage,l=function(h){return h.selectThisNode(!0,void 0,r)};this.getNodesToSelect(o,s).forEach(l),this.rowModel.getType()==="clientSide"&&this.groupSelectsChildren&&this.updateGroupsFromChildrenSelections(r);var a={type:Events.EVENT_SELECTION_CHANGED,source:r};this.eventService.dispatchEvent(a)},t.prototype.getServerSideSelectionState=function(){return null},t.prototype.setServerSideSelectionState=function(e){},__decorate$O([Autowired("rowModel")],t.prototype,"rowModel",void 0),__decorate$O([Autowired("paginationProxy")],t.prototype,"paginationProxy",void 0),__decorate$O([__param$5(0,Qualifier("loggerFactory"))],t.prototype,"setBeans",null),__decorate$O([PostConstruct],t.prototype,"init",null),t=__decorate$O([Bean("selectionService")],t),t}(BeanStub),__decorate$N=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},ColumnApi=function(){function n(){}return n.prototype.sizeColumnsToFit=function(t){typeof t>"u"&&console.error("AG Grid: missing parameter to columnApi.sizeColumnsToFit(gridWidth)"),this.columnModel.sizeColumnsToFit(t,"api")},n.prototype.setColumnGroupOpened=function(t,e){this.columnModel.setColumnGroupOpened(t,e,"api")},n.prototype.getColumnGroup=function(t,e){return this.columnModel.getColumnGroup(t,e)},n.prototype.getProvidedColumnGroup=function(t){return this.columnModel.getProvidedColumnGroup(t)},n.prototype.getDisplayNameForColumn=function(t,e){return this.columnModel.getDisplayNameForColumn(t,e)||""},n.prototype.getDisplayNameForColumnGroup=function(t,e){return this.columnModel.getDisplayNameForColumnGroup(t,e)||""},n.prototype.getColumn=function(t){return this.columnModel.getPrimaryColumn(t)},n.prototype.getColumns=function(){return this.columnModel.getAllPrimaryColumns()},n.prototype.applyColumnState=function(t){return this.columnModel.applyColumnState(t,"api")},n.prototype.getColumnState=function(){return this.columnModel.getColumnState()},n.prototype.resetColumnState=function(){this.columnModel.resetColumnState("api")},n.prototype.getColumnGroupState=function(){return this.columnModel.getColumnGroupState()},n.prototype.setColumnGroupState=function(t){this.columnModel.setColumnGroupState(t,"api")},n.prototype.resetColumnGroupState=function(){this.columnModel.resetColumnGroupState("api")},n.prototype.isPinning=function(){return this.columnModel.isPinningLeft()||this.columnModel.isPinningRight()},n.prototype.isPinningLeft=function(){return this.columnModel.isPinningLeft()},n.prototype.isPinningRight=function(){return this.columnModel.isPinningRight()},n.prototype.getDisplayedColAfter=function(t){return this.columnModel.getDisplayedColAfter(t)},n.prototype.getDisplayedColBefore=function(t){return this.columnModel.getDisplayedColBefore(t)},n.prototype.setColumnVisible=function(t,e){this.columnModel.setColumnVisible(t,e,"api")},n.prototype.setColumnsVisible=function(t,e){this.columnModel.setColumnsVisible(t,e,"api")},n.prototype.setColumnPinned=function(t,e){this.columnModel.setColumnPinned(t,e,"api")},n.prototype.setColumnsPinned=function(t,e){this.columnModel.setColumnsPinned(t,e,"api")},n.prototype.getAllGridColumns=function(){return this.columnModel.getAllGridColumns()},n.prototype.getDisplayedLeftColumns=function(){return this.columnModel.getDisplayedLeftColumns()},n.prototype.getDisplayedCenterColumns=function(){return this.columnModel.getDisplayedCenterColumns()},n.prototype.getDisplayedRightColumns=function(){return this.columnModel.getDisplayedRightColumns()},n.prototype.getAllDisplayedColumns=function(){return this.columnModel.getAllDisplayedColumns()},n.prototype.getAllDisplayedVirtualColumns=function(){return this.columnModel.getViewportColumns()},n.prototype.moveColumn=function(t,e){this.columnModel.moveColumn(t,e,"api")},n.prototype.moveColumnByIndex=function(t,e){this.columnModel.moveColumnByIndex(t,e,"api")},n.prototype.moveColumns=function(t,e){this.columnModel.moveColumns(t,e,"api")},n.prototype.moveRowGroupColumn=function(t,e){this.columnModel.moveRowGroupColumn(t,e)},n.prototype.setColumnAggFunc=function(t,e){this.columnModel.setColumnAggFunc(t,e)},n.prototype.setColumnWidth=function(t,e,r,o){r===void 0&&(r=!0),this.columnModel.setColumnWidths([{key:t,newWidth:e}],!1,r,o)},n.prototype.setColumnWidths=function(t,e,r){e===void 0&&(e=!0),this.columnModel.setColumnWidths(t,!1,e,r)},n.prototype.setPivotMode=function(t){this.columnModel.setPivotMode(t)},n.prototype.isPivotMode=function(){return this.columnModel.isPivotMode()},n.prototype.getPivotResultColumn=function(t,e){return this.columnModel.getSecondaryPivotColumn(t,e)},n.prototype.setValueColumns=function(t){this.columnModel.setValueColumns(t,"api")},n.prototype.getValueColumns=function(){return this.columnModel.getValueColumns()},n.prototype.removeValueColumn=function(t){this.columnModel.removeValueColumn(t,"api")},n.prototype.removeValueColumns=function(t){this.columnModel.removeValueColumns(t,"api")},n.prototype.addValueColumn=function(t){this.columnModel.addValueColumn(t,"api")},n.prototype.addValueColumns=function(t){this.columnModel.addValueColumns(t,"api")},n.prototype.setRowGroupColumns=function(t){this.columnModel.setRowGroupColumns(t,"api")},n.prototype.removeRowGroupColumn=function(t){this.columnModel.removeRowGroupColumn(t,"api")},n.prototype.removeRowGroupColumns=function(t){this.columnModel.removeRowGroupColumns(t,"api")},n.prototype.addRowGroupColumn=function(t){this.columnModel.addRowGroupColumn(t,"api")},n.prototype.addRowGroupColumns=function(t){this.columnModel.addRowGroupColumns(t,"api")},n.prototype.getRowGroupColumns=function(){return this.columnModel.getRowGroupColumns()},n.prototype.setPivotColumns=function(t){this.columnModel.setPivotColumns(t,"api")},n.prototype.removePivotColumn=function(t){this.columnModel.removePivotColumn(t,"api")},n.prototype.removePivotColumns=function(t){this.columnModel.removePivotColumns(t,"api")},n.prototype.addPivotColumn=function(t){this.columnModel.addPivotColumn(t,"api")},n.prototype.addPivotColumns=function(t){this.columnModel.addPivotColumns(t,"api")},n.prototype.getPivotColumns=function(){return this.columnModel.getPivotColumns()},n.prototype.getLeftDisplayedColumnGroups=function(){return this.columnModel.getDisplayedTreeLeft()},n.prototype.getCenterDisplayedColumnGroups=function(){return this.columnModel.getDisplayedTreeCentre()},n.prototype.getRightDisplayedColumnGroups=function(){return this.columnModel.getDisplayedTreeRight()},n.prototype.getAllDisplayedColumnGroups=function(){return this.columnModel.getAllDisplayedTrees()},n.prototype.autoSizeColumn=function(t,e){return this.columnModel.autoSizeColumn(t,e,"api")},n.prototype.autoSizeColumns=function(t,e){this.columnModel.autoSizeColumns({columns:t,skipHeader:e})},n.prototype.autoSizeAllColumns=function(t){this.columnModel.autoSizeAllColumns(t,"api")},n.prototype.setPivotResultColumns=function(t){this.columnModel.setSecondaryColumns(t,"api")},n.prototype.getPivotResultColumns=function(){return this.columnModel.getSecondaryColumns()},n.prototype.cleanDownReferencesToAvoidMemoryLeakInCaseApplicationIsKeepingReferenceToDestroyedGrid=function(){setTimeout(_.removeAllReferences.bind(window,this,"Column API"),100)},n.prototype.getAllColumns=function(){return logDeprecation("28.0","getAllColumns","getColumns"),this.getColumns()},n.prototype.getPrimaryColumns=function(){return logDeprecation("28.0","getPrimaryColumns","getColumns"),this.getColumns()},n.prototype.getSecondaryColumns=function(){return logDeprecation("28.0","getSecondaryColumns","getPivotResultColumns"),this.getPivotResultColumns()},n.prototype.setSecondaryColumns=function(t){logDeprecation("28.0","setSecondaryColumns","setPivotResultColumns"),this.setPivotResultColumns(t)},n.prototype.getSecondaryPivotColumn=function(t,e){return logDeprecation("28.0","getSecondaryPivotColumn","getPivotResultColumn"),this.getPivotResultColumn(t,e)},__decorate$N([Autowired("columnModel")],n.prototype,"columnModel",void 0),__decorate$N([PreDestroy],n.prototype,"cleanDownReferencesToAvoidMemoryLeakInCaseApplicationIsKeepingReferenceToDestroyedGrid",null),n=__decorate$N([Bean("columnApi")],n),n}(),__extends$L=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$M=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},ValueService=function(n){__extends$L(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.initialised=!1,e.isSsrm=!1,e}return t.prototype.init=function(){var e=this;this.isSsrm=this.gridOptionsService.isRowModelType("serverSide"),this.cellExpressions=this.gridOptionsService.is("enableCellExpressions"),this.isTreeData=this.gridOptionsService.is("treeData"),this.initialised=!0,this.eventService.addEventListener(Events.EVENT_CELL_VALUE_CHANGED,function(r){return e.callColumnCellValueChangedHandler(r)},this.gridOptionsService.useAsyncEvents()),this.addManagedPropertyListener("treeData",function(r){return e.isTreeData=r.currentValue})},t.prototype.getValue=function(e,r,o,s){if(o===void 0&&(o=!1),s===void 0&&(s=!1),this.initialised||this.init(),!!r){var l=e.getColDef(),a=l.field,h=e.getColId(),y=r.data,C,L=r.groupData&&r.groupData[h]!==void 0,Y=!s&&r.aggData&&r.aggData[h]!==void 0,ze=this.isSsrm&&s&&!!e.getColDef().aggFunc,Bt=this.isSsrm&&r.footer&&r.field&&(e.getColDef().showRowGroup===!0||e.getColDef().showRowGroup===r.field);if(o&&l.filterValueGetter?C=this.executeFilterValueGetter(l.filterValueGetter,y,e,r):this.isTreeData&&Y?C=r.aggData[h]:this.isTreeData&&l.valueGetter?C=this.executeValueGetter(l.valueGetter,y,e,r):this.isTreeData&&a&&y?C=getValueUsingField(y,a,e.isFieldContainsDots()):L?C=r.groupData[h]:Y?C=r.aggData[h]:l.valueGetter?C=this.executeValueGetter(l.valueGetter,y,e,r):Bt?C=getValueUsingField(y,r.field,e.isFieldContainsDots()):a&&y&&!ze&&(C=getValueUsingField(y,a,e.isFieldContainsDots())),this.cellExpressions&&typeof C=="string"&&C.indexOf("=")===0){var Ir=C.substring(1);C=this.executeValueGetter(Ir,y,e,r)}if(C==null){var Wr=this.getOpenedGroup(r,e);if(Wr!=null)return Wr}return C}},t.prototype.getOpenedGroup=function(e,r){if(this.gridOptionsService.is("showOpenedGroup")){var o=r.getColDef();if(o.showRowGroup)for(var s=r.getColDef().showRowGroup,l=e.parent;l!=null;){if(l.rowGroupColumn&&(s===!0||s===l.rowGroupColumn.getColId()))return l.key;l=l.parent}}},t.prototype.setValue=function(e,r,o,s){var l=this.columnModel.getPrimaryColumn(r);if(!e||!l)return!1;missing(e.data)&&(e.data={});var a=l.getColDef(),h=a.field,y=a.valueSetter;if(missing(h)&&missing(y))return console.warn("AG Grid: you need either field or valueSetter set on colDef for editing to work"),!1;if(!this.dataTypeService.checkType(l,o))return console.warn("AG Grid: Data type of the new value does not match the cell data type of the column"),!1;var C={node:e,data:e.data,oldValue:this.getValue(l,e),newValue:o,colDef:l.getColDef(),column:l,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context};C.newValue=o;var L;if(exists(y)?typeof y=="function"?L=y(C):L=this.expressionService.evaluate(y,C):L=this.setValueUsingField(e.data,h,o,l.isFieldContainsDots()),L===void 0&&(L=!0),!L)return!1;e.resetQuickFilterAggregateText(),this.valueCache.onDataChanged(),C.newValue=this.getValue(l,e);var Y={type:Events.EVENT_CELL_VALUE_CHANGED,event:null,rowIndex:e.rowIndex,rowPinned:e.rowPinned,column:C.column,api:C.api,columnApi:C.columnApi,colDef:C.colDef,context:C.context,data:e.data,node:e,oldValue:C.oldValue,newValue:C.newValue,value:C.newValue,source:s};return this.eventService.dispatchEvent(Y),!0},t.prototype.callColumnCellValueChangedHandler=function(e){var r=e.colDef.onCellValueChanged;typeof r=="function"&&r({node:e.node,data:e.data,oldValue:e.oldValue,newValue:e.newValue,colDef:e.colDef,column:e.column,api:e.api,columnApi:e.columnApi,context:e.context})},t.prototype.setValueUsingField=function(e,r,o,s){if(!r)return!1;var l=!1;if(!s)l=e[r]==o,l||(e[r]=o);else for(var a=r.split("."),h=e;a.length>0&&h;){var y=a.shift();a.length===0?(l=h[y]==o,l||(h[y]=o)):h=h[y]}return!l},t.prototype.executeFilterValueGetter=function(e,r,o,s){var l={data:r,node:s,column:o,colDef:o.getColDef(),api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context,getValue:this.getValueCallback.bind(this,s)};return typeof e=="function"?e(l):this.expressionService.evaluate(e,l)},t.prototype.executeValueGetter=function(e,r,o,s){var l=o.getColId(),a=this.valueCache.getValue(s,l);if(a!==void 0)return a;var h={data:r,node:s,column:o,colDef:o.getColDef(),api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context,getValue:this.getValueCallback.bind(this,s)},y;return typeof e=="function"?y=e(h):y=this.expressionService.evaluate(e,h),this.valueCache.setValue(s,l,y),y},t.prototype.getValueCallback=function(e,r){var o=this.columnModel.getPrimaryColumn(r);return o?this.getValue(o,e):null},t.prototype.getKeyForNode=function(e,r){var o=this.getValue(e,r),s=e.getColDef().keyCreator,l=o;if(s){var a={value:o,colDef:e.getColDef(),column:e,node:r,data:r.data,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context};l=s(a)}return typeof l=="string"||l==null||(l=String(l),l==="[object Object]"&&doOnce(function(){console.warn("AG Grid: a column you are grouping or pivoting by has objects as values. If you want to group by complex objects then either a) use a colDef.keyCreator (se AG Grid docs) or b) to toString() on the object to return a key")},"getKeyForNode - warn about [object,object]")),l},__decorate$M([Autowired("expressionService")],t.prototype,"expressionService",void 0),__decorate$M([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$M([Autowired("valueCache")],t.prototype,"valueCache",void 0),__decorate$M([Autowired("dataTypeService")],t.prototype,"dataTypeService",void 0),__decorate$M([PostConstruct],t.prototype,"init",null),t=__decorate$M([Bean("valueService")],t),t}(BeanStub),__extends$K=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$L=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__param$4=function(n,t){return function(e,r){t(e,r,n)}},ExpressionService=function(n){__extends$K(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.expressionToFunctionCache={},e}return t.prototype.setBeans=function(e){this.logger=e.create("ExpressionService")},t.prototype.evaluate=function(e,r){if(typeof e=="string")return this.evaluateExpression(e,r);console.error("AG Grid: value should be either a string or a function",e)},t.prototype.evaluateExpression=function(e,r){try{var o=this.createExpressionFunction(e),s=o(r.value,r.context,r.oldValue,r.newValue,r.value,r.node,r.data,r.colDef,r.rowIndex,r.api,r.columnApi,r.getValue,r.column,r.columnGroup);return s}catch(l){return console.log("Processing of the expression failed"),console.log("Expression = "+e),console.log("Params =",r),console.log("Exception = "+l),null}},t.prototype.createExpressionFunction=function(e){if(this.expressionToFunctionCache[e])return this.expressionToFunctionCache[e];var r=this.createFunctionBody(e),o=new Function("x, ctx, oldValue, newValue, value, node, data, colDef, rowIndex, api, columnApi, getValue, column, columnGroup",r);return this.expressionToFunctionCache[e]=o,o},t.prototype.createFunctionBody=function(e){return e.indexOf("return")>=0?e:"return "+e+";"},__decorate$L([__param$4(0,Qualifier("loggerFactory"))],t.prototype,"setBeans",null),t=__decorate$L([Bean("expressionService")],t),t}(BeanStub),__extends$J=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$K=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},TemplateService=function(n){__extends$J(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.templateCache={},e.waitingCallbacks={},e}return t.prototype.getTemplate=function(e,r){var o=this.templateCache[e];if(o)return o;var s=this.waitingCallbacks[e],l=this;if(!s){s=[],this.waitingCallbacks[e]=s;var a=new XMLHttpRequest;a.onload=function(){l.handleHttpResult(this,e)},a.open("GET",e),a.send()}return r&&s.push(r),null},t.prototype.handleHttpResult=function(e,r){if(e.status!==200||e.response===null){console.warn("AG Grid: Unable to get template error "+e.status+" - "+r);return}this.templateCache[r]=e.response||e.responseText;for(var o=this.waitingCallbacks[r],s=0;s<o.length;s++){var l=o[s];l()}},t=__decorate$K([Bean("templateService")],t),t}(BeanStub),__extends$I=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$J=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__param$3=function(n,t){return function(e,r){t(e,r,n)}},LoggerFactory=function(n){__extends$I(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.setBeans=function(e){this.logging=e.is("debug")},t.prototype.create=function(e){return new Logger(e,this.isLogging.bind(this))},t.prototype.isLogging=function(){return this.logging},__decorate$J([__param$3(0,Qualifier("gridOptionsService"))],t.prototype,"setBeans",null),t=__decorate$J([Bean("loggerFactory")],t),t}(BeanStub),Logger=function(){function n(t,e){this.name=t,this.isLoggingFunc=e}return n.prototype.isLogging=function(){return this.isLoggingFunc()},n.prototype.log=function(t){this.isLoggingFunc()&&console.log("AG Grid."+this.name+": "+t)},n}(),__extends$H=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$I=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},GridCtrl=function(n){__extends$H(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.setComp=function(e,r,o){var s=this;this.view=e,this.eGridHostDiv=r,this.eGui=o,this.eGui.setAttribute("grid-id",this.context.getGridId()),this.dragAndDropService.addDropTarget({getContainer:function(){return s.eGui},isInterestedIn:function(a){return a===DragSourceType.HeaderCell||a===DragSourceType.ToolPanel},getIconName:function(){return DragAndDropService.ICON_NOT_ALLOWED}}),this.mouseEventService.stampTopLevelGridCompWithGridInstance(r),this.createManagedBean(new LayoutFeature(this.view)),this.addRtlSupport(),this.addManagedListener(this,Events.EVENT_KEYBOARD_FOCUS,function(){s.view.addOrRemoveKeyboardFocusClass(!0)}),this.addManagedListener(this,Events.EVENT_MOUSE_FOCUS,function(){s.view.addOrRemoveKeyboardFocusClass(!1)});var l=this.resizeObserverService.observeResize(this.eGridHostDiv,this.onGridSizeChanged.bind(this));this.addDestroyFunc(function(){return l()}),this.ctrlsService.registerGridCtrl(this)},t.prototype.isDetailGrid=function(){var e,r=this.focusService.findTabbableParent(this.getGui());return((e=r==null?void 0:r.getAttribute("row-id"))===null||e===void 0?void 0:e.startsWith("detail"))||!1},t.prototype.showDropZones=function(){return ModuleRegistry.__isRegistered(ModuleNames.RowGroupingModule,this.context.getGridId())},t.prototype.showSideBar=function(){return ModuleRegistry.__isRegistered(ModuleNames.SideBarModule,this.context.getGridId())},t.prototype.showStatusBar=function(){return ModuleRegistry.__isRegistered(ModuleNames.StatusBarModule,this.context.getGridId())},t.prototype.showWatermark=function(){return ModuleRegistry.__isRegistered(ModuleNames.EnterpriseCoreModule,this.context.getGridId())},t.prototype.onGridSizeChanged=function(){var e={type:Events.EVENT_GRID_SIZE_CHANGED,clientWidth:this.eGridHostDiv.clientWidth,clientHeight:this.eGridHostDiv.clientHeight};this.eventService.dispatchEvent(e)},t.prototype.addRtlSupport=function(){var e=this.gridOptionsService.is("enableRtl")?"ag-rtl":"ag-ltr";this.view.setRtlClass(e)},t.prototype.destroyGridUi=function(){this.view.destroyGridUi()},t.prototype.getGui=function(){return this.eGui},t.prototype.setResizeCursor=function(e){this.view.setCursor(e?"ew-resize":null)},t.prototype.disableUserSelect=function(e){this.view.setUserSelect(e?"none":null)},t.prototype.focusNextInnerContainer=function(e){var r=this.gridOptionsService.getDocument(),o=this.view.getFocusableContainers(),s=o.findIndex(function(a){return a.contains(r.activeElement)}),l=s+(e?-1:1);return l<=0||l>=o.length?!1:this.focusService.focusInto(o[l])},t.prototype.focusInnerElement=function(e){var r=this.view.getFocusableContainers(),o=this.columnModel.getAllDisplayedColumns();if(e){if(r.length>1)return this.focusService.focusInto(last(r),!0);var s=last(o);if(this.focusService.focusGridView(s,!0))return!0}return this.gridOptionsService.getNum("headerHeight")===0?this.focusService.focusGridView(o[0]):this.focusService.focusFirstHeader()},t.prototype.forceFocusOutOfContainer=function(e){e===void 0&&(e=!1),this.view.forceFocusOutOfContainer(e)},__decorate$I([Autowired("focusService")],t.prototype,"focusService",void 0),__decorate$I([Autowired("resizeObserverService")],t.prototype,"resizeObserverService",void 0),__decorate$I([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$I([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),__decorate$I([Autowired("mouseEventService")],t.prototype,"mouseEventService",void 0),__decorate$I([Autowired("dragAndDropService")],t.prototype,"dragAndDropService",void 0),t}(BeanStub),__extends$G=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$H=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},GridComp=function(n){__extends$G(t,n);function t(e){var r=n.call(this)||this;return r.eGridDiv=e,r}return t.prototype.postConstruct=function(){var e=this;this.logger=this.loggerFactory.create("GridComp");var r={destroyGridUi:function(){return e.destroyBean(e)},setRtlClass:function(s){return e.addCssClass(s)},addOrRemoveKeyboardFocusClass:function(s){return e.addOrRemoveCssClass(FocusService.AG_KEYBOARD_FOCUS,s)},forceFocusOutOfContainer:this.forceFocusOutOfContainer.bind(this),updateLayoutClasses:this.updateLayoutClasses.bind(this),getFocusableContainers:this.getFocusableContainers.bind(this),setUserSelect:function(s){e.getGui().style.userSelect=s??"",e.getGui().style.webkitUserSelect=s??""},setCursor:function(s){e.getGui().style.cursor=s??""}};this.ctrl=this.createManagedBean(new GridCtrl);var o=this.createTemplate();this.setTemplate(o),this.ctrl.setComp(r,this.eGridDiv,this.getGui()),this.insertGridIntoDom(),this.initialiseTabGuard({onTabKeyDown:function(){},focusInnerElement:function(s){return e.ctrl.focusInnerElement(s)}})},t.prototype.insertGridIntoDom=function(){var e=this,r=this.getGui();this.eGridDiv.appendChild(r),this.addDestroyFunc(function(){e.eGridDiv.removeChild(r),e.logger.log("Grid removed from DOM")})},t.prototype.updateLayoutClasses=function(e,r){var o=this.eRootWrapperBody.classList;o.toggle(LayoutCssClasses.AUTO_HEIGHT,r.autoHeight),o.toggle(LayoutCssClasses.NORMAL,r.normal),o.toggle(LayoutCssClasses.PRINT,r.print),this.addOrRemoveCssClass(LayoutCssClasses.AUTO_HEIGHT,r.autoHeight),this.addOrRemoveCssClass(LayoutCssClasses.NORMAL,r.normal),this.addOrRemoveCssClass(LayoutCssClasses.PRINT,r.print)},t.prototype.createTemplate=function(){var e=this.ctrl.showDropZones()?"<ag-grid-header-drop-zones></ag-grid-header-drop-zones>":"",r=this.ctrl.showSideBar()?'<ag-side-bar ref="sideBar"></ag-side-bar>':"",o=this.ctrl.showStatusBar()?'<ag-status-bar ref="statusBar"></ag-status-bar>':"",s=this.ctrl.showWatermark()?"<ag-watermark></ag-watermark>":"",l=`<div class="ag-root-wrapper" role="presentation">
                `+e+`
                <div class="ag-root-wrapper-body" ref="rootWrapperBody" role="presentation">
                    <ag-grid-body ref="gridBody"></ag-grid-body>
                    `+r+`
                </div>
                `+o+`
                <ag-pagination></ag-pagination>
                `+s+`
            </div>`;return l},t.prototype.getFocusableElement=function(){return this.eRootWrapperBody},t.prototype.getFocusableContainers=function(){var e=[this.gridBodyComp.getGui()];return this.sideBarComp&&e.push(this.sideBarComp.getGui()),e.filter(function(r){return isVisible(r)})},__decorate$H([Autowired("loggerFactory")],t.prototype,"loggerFactory",void 0),__decorate$H([RefSelector("gridBody")],t.prototype,"gridBodyComp",void 0),__decorate$H([RefSelector("sideBar")],t.prototype,"sideBarComp",void 0),__decorate$H([RefSelector("rootWrapperBody")],t.prototype,"eRootWrapperBody",void 0),__decorate$H([PostConstruct],t.prototype,"postConstruct",null),t}(TabGuardComp),__extends$F=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$G=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__read$8=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray$7=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n},SortController=function(n){__extends$F(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}e=t,t.prototype.progressSort=function(r,o,s){var l=this.getNextSortDirection(r);this.setSortForColumn(r,l,o,s)},t.prototype.setSortForColumn=function(r,o,s,l){o!=="asc"&&o!=="desc"&&(o=null);var a=this.gridOptionsService.isColumnsSortingCoupledToGroup(),h=[r];if(a&&r.getColDef().showRowGroup){var y=this.columnModel.getSourceColumnsForGroupColumn(r),C=y==null?void 0:y.filter(function(Y){return Y.getColDef().sortable});C&&(h=__spreadArray$7([r],__read$8(C)))}h.forEach(function(Y){return Y.setSort(o,l)});var L=(s||this.gridOptionsService.is("alwaysMultiSort"))&&!this.gridOptionsService.is("suppressMultiSort");L||this.clearSortBarTheseColumns(h,l),this.updateSortIndex(r),this.dispatchSortChangedEvents(l)},t.prototype.updateSortIndex=function(r){var o=this.gridOptionsService.isColumnsSortingCoupledToGroup(),s=this.columnModel.getGroupDisplayColumnForGroup(r.getId()),l=o&&s||r,a=this.getColumnsWithSortingOrdered();this.columnModel.getPrimaryAndSecondaryAndAutoColumns().forEach(function(C){return C.setSortIndex(null)});var h=a.filter(function(C){return C!==l}),y=l.getSort()?__spreadArray$7(__spreadArray$7([],__read$8(h)),[l]):h;y.forEach(function(C,L){return C.setSortIndex(L)})},t.prototype.onSortChanged=function(r){this.dispatchSortChangedEvents(r)},t.prototype.isSortActive=function(){var r=this.columnModel.getPrimaryAndSecondaryAndAutoColumns(),o=r.filter(function(s){return!!s.getSort()});return o&&o.length>0},t.prototype.dispatchSortChangedEvents=function(r){var o={type:Events.EVENT_SORT_CHANGED,source:r};this.eventService.dispatchEvent(o)},t.prototype.clearSortBarTheseColumns=function(r,o){this.columnModel.getPrimaryAndSecondaryAndAutoColumns().forEach(function(s){r.includes(s)||s.setSort(void 0,o)})},t.prototype.getNextSortDirection=function(r){var o;if(r.getColDef().sortingOrder?o=r.getColDef().sortingOrder:this.gridOptionsService.get("sortingOrder")?o=this.gridOptionsService.get("sortingOrder"):o=e.DEFAULT_SORTING_ORDER,!Array.isArray(o)||o.length<=0)return console.warn("AG Grid: sortingOrder must be an array with at least one element, currently it's "+o),null;var s=o.indexOf(r.getSort()),l=s<0,a=s==o.length-1,h;return l||a?h=o[0]:h=o[s+1],e.DEFAULT_SORTING_ORDER.indexOf(h)<0?(console.warn("AG Grid: invalid sort type "+h),null):h},t.prototype.getIndexedSortMap=function(){var r=this,o=this.columnModel.getPrimaryAndSecondaryAndAutoColumns().filter(function(C){return!!C.getSort()});if(this.columnModel.isPivotMode()){var s=this.gridOptionsService.isColumnsSortingCoupledToGroup();o=o.filter(function(C){var L=!!C.getAggFunc(),Y=!C.isPrimary(),ze=s?r.columnModel.getGroupDisplayColumnForGroup(C.getId()):C.getColDef().showRowGroup;return L||Y||ze})}var l=this.columnModel.getRowGroupColumns().filter(function(C){return!!C.getSort()}),a=this.gridOptionsService.isColumnsSortingCoupledToGroup()&&!!l.length;a&&(o=__spreadArray$7([],__read$8(new Set(o.map(function(C){var L;return(L=r.columnModel.getGroupDisplayColumnForGroup(C.getId()))!==null&&L!==void 0?L:C})))));var h={};o.forEach(function(C,L){return h[C.getId()]=L}),o.sort(function(C,L){var Y=C.getSortIndex(),ze=L.getSortIndex();if(Y!=null&&ze!=null)return Y-ze;if(Y==null&&ze==null){var Bt=h[C.getId()],Ir=h[L.getId()];return Bt>Ir?1:-1}else return ze==null?-1:1});var y=new Map;return o.forEach(function(C,L){return y.set(C,L)}),a&&l.forEach(function(C){var L=r.columnModel.getGroupDisplayColumnForGroup(C.getId());y.set(C,y.get(L))}),y},t.prototype.getColumnsWithSortingOrdered=function(){return __spreadArray$7([],__read$8(this.getIndexedSortMap().entries())).sort(function(r,o){var s=__read$8(r,2);s[0];var l=s[1],a=__read$8(o,2);a[0];var h=a[1];return l-h}).map(function(r){var o=__read$8(r,1),s=o[0];return s})},t.prototype.getSortModel=function(){return this.getColumnsWithSortingOrdered().map(function(r){return{sort:r.getSort(),colId:r.getId()}})},t.prototype.getSortOptions=function(){return this.getColumnsWithSortingOrdered().map(function(r){return{sort:r.getSort(),column:r}})},t.prototype.canColumnDisplayMixedSort=function(r){var o=this.gridOptionsService.isColumnsSortingCoupledToGroup(),s=!!r.getColDef().showRowGroup;return o&&s},t.prototype.getDisplaySortForColumn=function(r){var o=this.columnModel.getSourceColumnsForGroupColumn(r);if(!this.canColumnDisplayMixedSort(r)||!(o!=null&&o.length))return r.getSort();var s=!!r.getColDef().field,l=s?__spreadArray$7([r],__read$8(o)):o,a=l[0].getSort(),h=l.every(function(y){return y.getSort()==a});return h?a:"mixed"},t.prototype.getDisplaySortIndexForColumn=function(r){return this.getIndexedSortMap().get(r)};var e;return t.DEFAULT_SORTING_ORDER=["asc","desc",null],__decorate$G([Autowired("columnModel")],t.prototype,"columnModel",void 0),t=e=__decorate$G([Bean("sortController")],t),t}(BeanStub),__extends$E=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$F=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},ColumnHoverService=function(n){__extends$E(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.setMouseOver=function(e){this.selectedColumns=e;var r={type:Events.EVENT_COLUMN_HOVER_CHANGED};this.eventService.dispatchEvent(r)},t.prototype.clearMouseOver=function(){this.selectedColumns=null;var e={type:Events.EVENT_COLUMN_HOVER_CHANGED};this.eventService.dispatchEvent(e)},t.prototype.isHovered=function(e){return!!this.selectedColumns&&this.selectedColumns.indexOf(e)>=0},t=__decorate$F([Bean("columnHoverService")],t),t}(BeanStub),__extends$D=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$E=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},ColumnAnimationService=function(n){__extends$D(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.executeNextFuncs=[],e.executeLaterFuncs=[],e.active=!1,e.animationThreadCount=0,e}return t.prototype.postConstruct=function(){var e=this;this.ctrlsService.whenReady(function(r){return e.gridBodyCtrl=r.gridBodyCtrl})},t.prototype.isActive=function(){return this.active},t.prototype.start=function(){this.active||this.gridOptionsService.is("suppressColumnMoveAnimation")||this.gridOptionsService.is("enableRtl")||(this.ensureAnimationCssClassPresent(),this.active=!0)},t.prototype.finish=function(){this.active&&(this.flush(),this.active=!1)},t.prototype.executeNextVMTurn=function(e){this.active?this.executeNextFuncs.push(e):e()},t.prototype.executeLaterVMTurn=function(e){this.active?this.executeLaterFuncs.push(e):e()},t.prototype.ensureAnimationCssClassPresent=function(){var e=this;this.animationThreadCount++;var r=this.animationThreadCount;this.gridBodyCtrl.setColumnMovingCss(!0),this.executeLaterFuncs.push(function(){e.animationThreadCount===r&&e.gridBodyCtrl.setColumnMovingCss(!1)})},t.prototype.flush=function(){var e=this.executeNextFuncs;this.executeNextFuncs=[];var r=this.executeLaterFuncs;this.executeLaterFuncs=[],!(e.length===0&&r.length===0)&&(window.setTimeout(function(){return e.forEach(function(o){return o()})},0),window.setTimeout(function(){return r.forEach(function(o){return o()})},300))},__decorate$E([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),__decorate$E([PostConstruct],t.prototype,"postConstruct",null),t=__decorate$E([Bean("columnAnimationService")],t),t}(BeanStub),__extends$C=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$D=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},PaginationAutoPageSizeService=function(n){__extends$C(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.postConstruct=function(){var e=this;this.ctrlsService.whenReady(function(r){e.centerRowContainerCon=r.centerRowContainerCtrl,e.addManagedListener(e.eventService,Events.EVENT_BODY_HEIGHT_CHANGED,e.checkPageSize.bind(e)),e.addManagedListener(e.eventService,Events.EVENT_SCROLL_VISIBILITY_CHANGED,e.checkPageSize.bind(e)),e.checkPageSize()})},t.prototype.notActive=function(){return!this.gridOptionsService.is("paginationAutoPageSize")||this.centerRowContainerCon==null},t.prototype.checkPageSize=function(){var e=this;if(!this.notActive()){var r=this.centerRowContainerCon.getViewportSizeFeature().getBodyHeight();if(r>0){var o=function(){var s=e.gridOptionsService.getRowHeightAsNumber(),l=Math.floor(r/s);e.gridOptionsService.set("paginationPageSize",l)};this.isBodyRendered?debounce(function(){return o()},50)():(o(),this.isBodyRendered=!0)}else this.isBodyRendered=!1}},__decorate$D([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),__decorate$D([PostConstruct],t.prototype,"postConstruct",null),t=__decorate$D([Bean("paginationAutoPageSizeService")],t),t}(BeanStub),__extends$B=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$C=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},ValueCache=function(n){__extends$B(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.cacheVersion=0,e}return t.prototype.init=function(){this.active=this.gridOptionsService.is("valueCache"),this.neverExpires=this.gridOptionsService.is("valueCacheNeverExpires")},t.prototype.onDataChanged=function(){this.neverExpires||this.expire()},t.prototype.expire=function(){this.cacheVersion++},t.prototype.setValue=function(e,r,o){this.active&&(e.__cacheVersion!==this.cacheVersion&&(e.__cacheVersion=this.cacheVersion,e.__cacheData={}),e.__cacheData[r]=o)},t.prototype.getValue=function(e,r){if(!(!this.active||e.__cacheVersion!==this.cacheVersion))return e.__cacheData[r]},__decorate$C([PostConstruct],t.prototype,"init",null),t=__decorate$C([Bean("valueCache")],t),t}(BeanStub),__extends$A=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$B=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},SOURCE_PASTE="paste",ChangeDetectionService=function(n){__extends$A(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.init=function(){this.rowModel.getType()==="clientSide"&&(this.clientSideRowModel=this.rowModel),this.addManagedListener(this.eventService,Events.EVENT_CELL_VALUE_CHANGED,this.onCellValueChanged.bind(this))},t.prototype.onCellValueChanged=function(e){e.source!==SOURCE_PASTE&&this.doChangeDetection(e.node,e.column)},t.prototype.doChangeDetection=function(e,r){if(!this.gridOptionsService.is("suppressChangeDetection")){var o=[e];if(this.clientSideRowModel&&!e.isRowPinned()){var s=this.gridOptionsService.is("aggregateOnlyChangedColumns"),l=new ChangedPath(s,this.clientSideRowModel.getRootNode());l.addParentNode(e.parent,[r]),this.clientSideRowModel.doAggregate(l),l.forEachChangedNodeDepthFirst(function(a){o.push(a)})}this.rowRenderer.refreshCells({rowNodes:o})}},__decorate$B([Autowired("rowModel")],t.prototype,"rowModel",void 0),__decorate$B([Autowired("rowRenderer")],t.prototype,"rowRenderer",void 0),__decorate$B([PostConstruct],t.prototype,"init",null),t=__decorate$B([Bean("changeDetectionService")],t),t}(BeanStub),__extends$z=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$A=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},AgComponentUtils=function(n){__extends$z(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.adaptFunction=function(e,r){var o=this.componentMetadataProvider.retrieve(e);return o&&o.functionAdapter?o.functionAdapter(r):null},t.prototype.adaptCellRendererFunction=function(e){var r=function(){function o(){}return o.prototype.refresh=function(s){return!1},o.prototype.getGui=function(){return this.eGui},o.prototype.init=function(s){var l=e(s),a=typeof l;if(a==="string"||a==="number"||a==="boolean"){this.eGui=loadTemplate("<span>"+l+"</span>");return}if(l==null){this.eGui=loadTemplate("<span></span>");return}this.eGui=l},o}();return r},t.prototype.doesImplementIComponent=function(e){return e?e.prototype&&"getGui"in e.prototype:!1},__decorate$A([Autowired("componentMetadataProvider")],t.prototype,"componentMetadataProvider",void 0),t=__decorate$A([Bean("agComponentUtils")],t),t}(BeanStub),__extends$y=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$z=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},ComponentMetadataProvider=function(n){__extends$y(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.postConstruct=function(){this.componentMetaData={dateComponent:{mandatoryMethodList:["getDate","setDate"],optionalMethodList:["afterGuiAttached","setInputPlaceholder","setInputAriaLabel"]},detailCellRenderer:{mandatoryMethodList:[],optionalMethodList:["refresh"],functionAdapter:this.agComponentUtils.adaptCellRendererFunction.bind(this.agComponentUtils)},headerComponent:{mandatoryMethodList:[],optionalMethodList:["refresh"]},headerGroupComponent:{mandatoryMethodList:[],optionalMethodList:[]},loadingCellRenderer:{mandatoryMethodList:[],optionalMethodList:[]},loadingOverlayComponent:{mandatoryMethodList:[],optionalMethodList:[]},noRowsOverlayComponent:{mandatoryMethodList:[],optionalMethodList:[]},floatingFilterComponent:{mandatoryMethodList:["onParentModelChanged"],optionalMethodList:["afterGuiAttached"]},floatingFilterWrapperComponent:{mandatoryMethodList:[],optionalMethodList:[]},cellRenderer:{mandatoryMethodList:[],optionalMethodList:["refresh","afterGuiAttached"],functionAdapter:this.agComponentUtils.adaptCellRendererFunction.bind(this.agComponentUtils)},cellEditor:{mandatoryMethodList:["getValue"],optionalMethodList:["isPopup","isCancelBeforeStart","isCancelAfterEnd","getPopupPosition","focusIn","focusOut","afterGuiAttached"]},innerRenderer:{mandatoryMethodList:[],optionalMethodList:["afterGuiAttached"],functionAdapter:this.agComponentUtils.adaptCellRendererFunction.bind(this.agComponentUtils)},fullWidthCellRenderer:{mandatoryMethodList:[],optionalMethodList:["refresh","afterGuiAttached"],functionAdapter:this.agComponentUtils.adaptCellRendererFunction.bind(this.agComponentUtils)},groupRowRenderer:{mandatoryMethodList:[],optionalMethodList:["afterGuiAttached"],functionAdapter:this.agComponentUtils.adaptCellRendererFunction.bind(this.agComponentUtils)},filter:{mandatoryMethodList:["isFilterActive","doesFilterPass","getModel","setModel"],optionalMethodList:["afterGuiAttached","afterGuiDetached","onNewRowsLoaded","getModelAsString","onFloatingFilterChanged","onAnyFilterChanged"]},filterComponent:{mandatoryMethodList:["isFilterActive","doesFilterPass","getModel","setModel"],optionalMethodList:["afterGuiAttached","afterGuiDetached","onNewRowsLoaded","getModelAsString","onFloatingFilterChanged","onAnyFilterChanged"]},statusPanel:{mandatoryMethodList:[],optionalMethodList:["afterGuiAttached"]},toolPanel:{mandatoryMethodList:[],optionalMethodList:["refresh","afterGuiAttached"]},tooltipComponent:{mandatoryMethodList:[],optionalMethodList:[]}}},t.prototype.retrieve=function(e){return this.componentMetaData[e]},__decorate$z([Autowired("agComponentUtils")],t.prototype,"agComponentUtils",void 0),__decorate$z([PostConstruct],t.prototype,"postConstruct",null),t=__decorate$z([Bean("componentMetadataProvider")],t),t}(BeanStub),__extends$x=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$y=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__read$7=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray$6=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n},DEFAULT_ROW_HEIGHT=25,MIN_COL_WIDTH=10,MAT_GRID_SIZE=8,BASE_GRID_SIZE=4,BALHAM_GRID_SIZE=4,ALPINE_GRID_SIZE=6,HARD_CODED_SIZES={"ag-theme-custom":{headerHeight:25,headerCellMinWidth:24,listItemHeight:BASE_GRID_SIZE*5,rowHeight:25,chartMenuPanelWidth:220},"ag-theme-material":{headerHeight:MAT_GRID_SIZE*7,headerCellMinWidth:48,listItemHeight:MAT_GRID_SIZE*4,rowHeight:MAT_GRID_SIZE*6,chartMenuPanelWidth:240},"ag-theme-balham":{headerHeight:BALHAM_GRID_SIZE*8,headerCellMinWidth:24,listItemHeight:BALHAM_GRID_SIZE*6,rowHeight:BALHAM_GRID_SIZE*7,chartMenuPanelWidth:220},"ag-theme-alpine":{headerHeight:ALPINE_GRID_SIZE*8,headerCellMinWidth:36,listItemHeight:ALPINE_GRID_SIZE*4,rowHeight:ALPINE_GRID_SIZE*7,chartMenuPanelWidth:240}},SASS_PROPERTY_BUILDER={headerHeight:["ag-header-row"],headerCellMinWidth:["ag-header-cell"],listItemHeight:["ag-virtual-list-item"],rowHeight:["ag-row"],chartMenuPanelWidth:["ag-chart-docked-container"]},Environment=function(n){__extends$x(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.calculatedSizes={},e}return t.prototype.postConstruct=function(){var e=this,r,o=(r=this.getTheme().el)!==null&&r!==void 0?r:this.eGridDiv;this.mutationObserver=new MutationObserver(function(){e.calculatedSizes={},e.fireGridStylesChangedEvent()}),this.mutationObserver.observe(o||this.eGridDiv,{attributes:!0,attributeFilter:["class"]})},t.prototype.fireGridStylesChangedEvent=function(){var e={type:Events.EVENT_GRID_STYLES_CHANGED};this.eventService.dispatchEvent(e)},t.prototype.getSassVariable=function(e){var r=this.getTheme(),o=r.themeFamily,s=r.el;if(!(!o||o.indexOf("ag-theme")!==0)){this.calculatedSizes||(this.calculatedSizes={}),this.calculatedSizes[o]||(this.calculatedSizes[o]={});var l=this.calculatedSizes[o][e];return l??(this.calculatedSizes[o][e]=this.calculateValueForSassProperty(e,o,s),this.calculatedSizes[o][e])}},t.prototype.calculateValueForSassProperty=function(e,r,o){var s,l="ag-theme-"+(r.match("material")?"material":r.match("balham")?"balham":r.match("alpine")?"alpine":"custom"),a=HARD_CODED_SIZES[l][e],h=this.gridOptionsService.getDocument();if(o||(o=this.eGridDiv),!SASS_PROPERTY_BUILDER[e])return a;var y=SASS_PROPERTY_BUILDER[e],C=h.createElement("div"),L=Array.from(o.classList);(s=C.classList).add.apply(s,__spreadArray$6([r],__read$7(L))),C.style.position="absolute";var Y=y.reduce(function(Ir,Wr){var yi=h.createElement("div");return yi.style.position="static",yi.classList.add(Wr),Ir.appendChild(yi),yi},C),ze=0;if(h.body){h.body.appendChild(C);var Bt=e.toLowerCase().indexOf("height")!==-1?"height":"width";ze=parseInt(window.getComputedStyle(Y)[Bt],10),h.body.removeChild(C)}return ze||a},t.prototype.isThemeDark=function(){var e=this.getTheme().theme;return!!e&&e.indexOf("dark")>=0},t.prototype.chartMenuPanelWidth=function(){return this.getSassVariable("chartMenuPanelWidth")},t.prototype.getTheme=function(){for(var e=/\bag-(material|(?:theme-([\w\-]*)))\b/g,r=this.eGridDiv,o=null,s=[];r;)if(o=e.exec(r.className),!o)r=r.parentElement||void 0;else{var l=r.className.match(e);l&&(s=l);break}if(!o)return{allThemes:s};var a=o[0];return{theme:a,el:r,themeFamily:a.replace(/-dark$/,""),allThemes:s}},t.prototype.getFromTheme=function(e,r){var o;return(o=this.getSassVariable(r))!==null&&o!==void 0?o:e},t.prototype.getDefaultRowHeight=function(){return this.getFromTheme(DEFAULT_ROW_HEIGHT,"rowHeight")},t.prototype.getListItemHeight=function(){return this.getFromTheme(20,"listItemHeight")},t.prototype.setRowHeightVariable=function(e){var r=this.eGridDiv.style.getPropertyValue("--ag-line-height").trim(),o=e+"px";r!=o&&this.eGridDiv.style.setProperty("--ag-line-height",o)},t.prototype.getMinColWidth=function(){var e=this.getFromTheme(null,"headerCellMinWidth");return exists(e)?Math.max(e,MIN_COL_WIDTH):MIN_COL_WIDTH},t.prototype.destroy=function(){this.calculatedSizes=null,this.mutationObserver&&this.mutationObserver.disconnect(),n.prototype.destroy.call(this)},__decorate$y([Autowired("eGridDiv")],t.prototype,"eGridDiv",void 0),__decorate$y([PostConstruct],t.prototype,"postConstruct",null),t=__decorate$y([Bean("environment")],t),t}(BeanStub),__extends$w=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$x=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__param$2=function(n,t){return function(e,r){t(e,r,n)}},RowContainerHeightService=function(n){__extends$w(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.scrollY=0,e.uiBodyHeight=0,e}return t.prototype.agWire=function(e){this.logger=e.create("RowContainerHeightService")},t.prototype.postConstruct=function(){this.addManagedListener(this.eventService,Events.EVENT_BODY_HEIGHT_CHANGED,this.updateOffset.bind(this)),this.maxDivHeight=getMaxDivHeight(),this.logger.log("maxDivHeight = "+this.maxDivHeight)},t.prototype.isStretching=function(){return this.stretching},t.prototype.getDivStretchOffset=function(){return this.divStretchOffset},t.prototype.updateOffset=function(){if(this.stretching){var e=this.ctrlsService.getGridBodyCtrl(),r=e.getScrollFeature().getVScrollPosition().top,o=this.getUiBodyHeight(),s=r!==this.scrollY||o!==this.uiBodyHeight;s&&(this.scrollY=r,this.uiBodyHeight=o,this.calculateOffset())}},t.prototype.calculateOffset=function(){this.setUiContainerHeight(this.maxDivHeight),this.pixelsToShave=this.modelHeight-this.uiContainerHeight,this.maxScrollY=this.uiContainerHeight-this.uiBodyHeight;var e=this.scrollY/this.maxScrollY,r=e*this.pixelsToShave;this.logger.log("Div Stretch Offset = "+r+" ("+this.pixelsToShave+" * "+e+")"),this.setDivStretchOffset(r)},t.prototype.setUiContainerHeight=function(e){e!==this.uiContainerHeight&&(this.uiContainerHeight=e,this.eventService.dispatchEvent({type:Events.EVENT_ROW_CONTAINER_HEIGHT_CHANGED}))},t.prototype.clearOffset=function(){this.setUiContainerHeight(this.modelHeight),this.pixelsToShave=0,this.setDivStretchOffset(0)},t.prototype.setDivStretchOffset=function(e){var r=typeof e=="number"?Math.floor(e):null;this.divStretchOffset!==r&&(this.divStretchOffset=r,this.eventService.dispatchEvent({type:Events.EVENT_HEIGHT_SCALE_CHANGED}))},t.prototype.setModelHeight=function(e){this.modelHeight=e,this.stretching=e!=null&&this.maxDivHeight>0&&e>this.maxDivHeight,this.stretching?this.calculateOffset():this.clearOffset()},t.prototype.getUiContainerHeight=function(){return this.uiContainerHeight},t.prototype.getRealPixelPosition=function(e){return e-this.divStretchOffset},t.prototype.getUiBodyHeight=function(){var e=this.ctrlsService.getGridBodyCtrl(),r=e.getScrollFeature().getVScrollPosition();return r.bottom-r.top},t.prototype.getScrollPositionForPixel=function(e){if(this.pixelsToShave<=0)return e;var r=this.modelHeight-this.getUiBodyHeight(),o=e/r,s=this.maxScrollY*o;return s},__decorate$x([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),__decorate$x([__param$2(0,Qualifier("loggerFactory"))],t.prototype,"agWire",null),__decorate$x([PostConstruct],t.prototype,"postConstruct",null),t=__decorate$x([Bean("rowContainerHeightService")],t),t}(BeanStub),__extends$v=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$w=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},SelectableService=function(n){__extends$v(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.init=function(){this.groupSelectsChildren=this.gridOptionsService.is("groupSelectsChildren"),this.isRowSelectableFunc=this.gridOptionsService.get("isRowSelectable")},t.prototype.updateSelectableAfterGrouping=function(e){if(this.isRowSelectableFunc){var r=function(o){return o.childrenAfterGroup};this.recurseDown(e.childrenAfterGroup,r)}},t.prototype.recurseDown=function(e,r){var o=this;e&&e.forEach(function(s){if(s.group){s.hasChildren()&&o.recurseDown(r(s),r);var l;if(o.groupSelectsChildren){var a=(r(s)||[]).find(function(h){return h.selectable===!0});l=exists(a)}else l=o.isRowSelectableFunc?o.isRowSelectableFunc(s):!1;s.setRowSelectable(l)}})},__decorate$w([PostConstruct],t.prototype,"init",null),t=__decorate$w([Bean("selectableService")],t),t}(BeanStub),__extends$u=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$v=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},PaginationComp=function(n){__extends$u(t,n);function t(){var e=n.call(this)||this;return e.previousAndFirstButtonsDisabled=!1,e.nextButtonDisabled=!1,e.lastButtonDisabled=!1,e.areListenersSetup=!1,e}return t.prototype.postConstruct=function(){var e=this.gridOptionsService.is("enableRtl");this.setTemplate(this.getTemplate());var r=this,o=r.btFirst,s=r.btPrevious,l=r.btNext,a=r.btLast;this.activateTabIndex([o,s,l,a]),o.insertAdjacentElement("afterbegin",createIconNoSpan(e?"last":"first",this.gridOptionsService)),s.insertAdjacentElement("afterbegin",createIconNoSpan(e?"next":"previous",this.gridOptionsService)),l.insertAdjacentElement("afterbegin",createIconNoSpan(e?"previous":"next",this.gridOptionsService)),a.insertAdjacentElement("afterbegin",createIconNoSpan(e?"first":"last",this.gridOptionsService)),this.addManagedPropertyListener("pagination",this.onPaginationChanged.bind(this)),this.addManagedPropertyListener("suppressPaginationPanel",this.onPaginationChanged.bind(this)),this.onPaginationChanged()},t.prototype.onPaginationChanged=function(){var e=this.gridOptionsService.is("pagination"),r=e&&!this.gridOptionsService.is("suppressPaginationPanel");this.setDisplayed(r),r&&(this.setupListeners(),this.enableOrDisableButtons(),this.updateRowLabels(),this.setCurrentPageLabel(),this.setTotalLabels())},t.prototype.setupListeners=function(){var e=this;this.areListenersSetup||(this.addManagedListener(this.eventService,Events.EVENT_PAGINATION_CHANGED,this.onPaginationChanged.bind(this)),[{el:this.btFirst,fn:this.onBtFirst.bind(this)},{el:this.btPrevious,fn:this.onBtPrevious.bind(this)},{el:this.btNext,fn:this.onBtNext.bind(this)},{el:this.btLast,fn:this.onBtLast.bind(this)}].forEach(function(r){var o=r.el,s=r.fn;e.addManagedListener(o,"click",s),e.addManagedListener(o,"keydown",function(l){(l.key===KeyCode.ENTER||l.key===KeyCode.SPACE)&&(l.preventDefault(),s())})}),this.areListenersSetup=!0)},t.prototype.onBtFirst=function(){this.previousAndFirstButtonsDisabled||this.paginationProxy.goToFirstPage()},t.prototype.setCurrentPageLabel=function(){var e=this.paginationProxy.getTotalPages()>0,r=this.paginationProxy.getCurrentPage(),o=e?r+1:0;this.lbCurrent.innerHTML=this.formatNumber(o)},t.prototype.formatNumber=function(e){var r=this.gridOptionsService.getCallback("paginationNumberFormatter");if(r){var o={value:e};return r(o)}var s=this.localeService.getLocaleTextFunc(),l=s("thousandSeparator",","),a=s("decimalSeparator",".");return formatNumberCommas(e,l,a)},t.prototype.getTemplate=function(){var e=this.localeService.getLocaleTextFunc(),r=e("page","Page"),o=e("to","to"),s=e("of","of"),l=e("firstPage","First Page"),a=e("previousPage","Previous Page"),h=e("nextPage","Next Page"),y=e("lastPage","Last Page"),C=this.getCompId();return'<div class="ag-paging-panel ag-unselectable" id="ag-'+C+`">
                <span class="ag-paging-row-summary-panel" role="status">
                    <span id="ag-`+C+`-first-row" ref="lbFirstRowOnPage" class="ag-paging-row-summary-panel-number"></span>
                    <span id="ag-`+C+'-to">'+o+`</span>
                    <span id="ag-`+C+`-last-row" ref="lbLastRowOnPage" class="ag-paging-row-summary-panel-number"></span>
                    <span id="ag-`+C+'-of">'+s+`</span>
                    <span id="ag-`+C+`-row-count" ref="lbRecordCount" class="ag-paging-row-summary-panel-number"></span>
                </span>
                <span class="ag-paging-page-summary-panel" role="presentation">
                    <div ref="btFirst" class="ag-button ag-paging-button" role="button" aria-label="`+l+`"></div>
                    <div ref="btPrevious" class="ag-button ag-paging-button" role="button" aria-label="`+a+`"></div>
                    <span class="ag-paging-description" role="status">
                        <span id="ag-`+C+'-start-page">'+r+`</span>
                        <span id="ag-`+C+`-start-page-number" ref="lbCurrent" class="ag-paging-number"></span>
                        <span id="ag-`+C+'-of-page">'+s+`</span>
                        <span id="ag-`+C+`-of-page-number" ref="lbTotal" class="ag-paging-number"></span>
                    </span>
                    <div ref="btNext" class="ag-button ag-paging-button" role="button" aria-label="`+h+`"></div>
                    <div ref="btLast" class="ag-button ag-paging-button" role="button" aria-label="`+y+`"></div>
                </span>
            </div>`},t.prototype.onBtNext=function(){this.nextButtonDisabled||this.paginationProxy.goToNextPage()},t.prototype.onBtPrevious=function(){this.previousAndFirstButtonsDisabled||this.paginationProxy.goToPreviousPage()},t.prototype.onBtLast=function(){this.lastButtonDisabled||this.paginationProxy.goToLastPage()},t.prototype.enableOrDisableButtons=function(){var e=this.paginationProxy.getCurrentPage(),r=this.paginationProxy.isLastPageFound(),o=this.paginationProxy.getTotalPages();this.previousAndFirstButtonsDisabled=e===0,this.toggleButtonDisabled(this.btFirst,this.previousAndFirstButtonsDisabled),this.toggleButtonDisabled(this.btPrevious,this.previousAndFirstButtonsDisabled);var s=this.isZeroPagesToDisplay(),l=r&&e===o-1;this.nextButtonDisabled=l||s,this.lastButtonDisabled=!r||s||e===o-1,this.toggleButtonDisabled(this.btNext,this.nextButtonDisabled),this.toggleButtonDisabled(this.btLast,this.lastButtonDisabled)},t.prototype.toggleButtonDisabled=function(e,r){setAriaDisabled(e,r),e.classList.toggle("ag-disabled",r)},t.prototype.updateRowLabels=function(){var e=this.paginationProxy.getCurrentPage(),r=this.paginationProxy.getPageSize(),o=this.paginationProxy.isLastPageFound(),s=this.paginationProxy.isLastPageFound()?this.paginationProxy.getMasterRowCount():null,l,a;if(this.isZeroPagesToDisplay()?l=a=0:(l=r*e+1,a=l+r-1,o&&a>s&&(a=s)),this.lbFirstRowOnPage.innerHTML=this.formatNumber(l),this.rowNodeBlockLoader.isLoading()){var h=this.localeService.getLocaleTextFunc();this.lbLastRowOnPage.innerHTML=h("pageLastRowUnknown","?")}else this.lbLastRowOnPage.innerHTML=this.formatNumber(a)},t.prototype.isZeroPagesToDisplay=function(){var e=this.paginationProxy.isLastPageFound(),r=this.paginationProxy.getTotalPages();return e&&r===0},t.prototype.setTotalLabels=function(){var e=this.paginationProxy.isLastPageFound(),r=this.paginationProxy.getTotalPages(),o=e?this.paginationProxy.getMasterRowCount():null;if(o===1){var s=this.paginationProxy.getRow(0),l=s&&s.group&&!(s.groupData||s.aggData);if(l){this.setTotalLabelsToZero();return}}if(e)this.lbTotal.innerHTML=this.formatNumber(r),this.lbRecordCount.innerHTML=this.formatNumber(o);else{var a=this.localeService.getLocaleTextFunc()("more","more");this.lbTotal.innerHTML=a,this.lbRecordCount.innerHTML=a}},t.prototype.setTotalLabelsToZero=function(){this.lbFirstRowOnPage.innerHTML=this.formatNumber(0),this.lbCurrent.innerHTML=this.formatNumber(0),this.lbLastRowOnPage.innerHTML=this.formatNumber(0),this.lbTotal.innerHTML=this.formatNumber(0),this.lbRecordCount.innerHTML=this.formatNumber(0)},__decorate$v([Autowired("paginationProxy")],t.prototype,"paginationProxy",void 0),__decorate$v([Autowired("rowNodeBlockLoader")],t.prototype,"rowNodeBlockLoader",void 0),__decorate$v([RefSelector("btFirst")],t.prototype,"btFirst",void 0),__decorate$v([RefSelector("btPrevious")],t.prototype,"btPrevious",void 0),__decorate$v([RefSelector("btNext")],t.prototype,"btNext",void 0),__decorate$v([RefSelector("btLast")],t.prototype,"btLast",void 0),__decorate$v([RefSelector("lbRecordCount")],t.prototype,"lbRecordCount",void 0),__decorate$v([RefSelector("lbFirstRowOnPage")],t.prototype,"lbFirstRowOnPage",void 0),__decorate$v([RefSelector("lbLastRowOnPage")],t.prototype,"lbLastRowOnPage",void 0),__decorate$v([RefSelector("lbCurrent")],t.prototype,"lbCurrent",void 0),__decorate$v([RefSelector("lbTotal")],t.prototype,"lbTotal",void 0),__decorate$v([PostConstruct],t.prototype,"postConstruct",null),t}(Component),__extends$t=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$u=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},LoadingType;(function(n){n[n.Loading=0]="Loading",n[n.NoRows=1]="NoRows"})(LoadingType||(LoadingType={}));var OverlayWrapperComponent=function(n){__extends$t(t,n);function t(){var e=n.call(this,t.TEMPLATE)||this;return e.inProgress=!1,e.destroyRequested=!1,e.manuallyDisplayed=!1,e}return t.prototype.updateLayoutClasses=function(e,r){var o=this.eOverlayWrapper.classList;o.toggle(LayoutCssClasses.AUTO_HEIGHT,r.autoHeight),o.toggle(LayoutCssClasses.NORMAL,r.normal),o.toggle(LayoutCssClasses.PRINT,r.print)},t.prototype.postConstruct=function(){this.createManagedBean(new LayoutFeature(this)),this.setDisplayed(!1,{skipAriaHidden:!0}),this.addManagedListener(this.eventService,Events.EVENT_ROW_DATA_UPDATED,this.onRowDataUpdated.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_NEW_COLUMNS_LOADED,this.onNewColumnsLoaded.bind(this)),this.gridOptionsService.isRowModelType("clientSide")&&!this.gridOptionsService.get("rowData")&&this.showLoadingOverlay(),this.gridApi.registerOverlayWrapperComp(this)},t.prototype.setWrapperTypeClass=function(e){var r=this.eOverlayWrapper.classList;r.toggle("ag-overlay-loading-wrapper",e===LoadingType.Loading),r.toggle("ag-overlay-no-rows-wrapper",e===LoadingType.NoRows)},t.prototype.showLoadingOverlay=function(){if(!this.gridOptionsService.is("suppressLoadingOverlay")){var e={},r=this.userComponentFactory.getLoadingOverlayCompDetails(e),o=r.newAgStackInstance();this.showOverlay(o,LoadingType.Loading)}},t.prototype.showNoRowsOverlay=function(){if(!this.gridOptionsService.is("suppressNoRowsOverlay")){var e={},r=this.userComponentFactory.getNoRowsOverlayCompDetails(e),o=r.newAgStackInstance();this.showOverlay(o,LoadingType.NoRows)}},t.prototype.showOverlay=function(e,r){var o=this;this.inProgress||(this.setWrapperTypeClass(r),this.destroyActiveOverlay(),this.inProgress=!0,e&&e.then(function(s){o.inProgress=!1,o.eOverlayWrapper.appendChild(s.getGui()),o.activeOverlay=s,o.destroyRequested&&(o.destroyRequested=!1,o.destroyActiveOverlay())}),this.manuallyDisplayed=this.columnModel.isReady()&&!this.paginationProxy.isEmpty(),this.setDisplayed(!0,{skipAriaHidden:!0}))},t.prototype.destroyActiveOverlay=function(){if(this.inProgress){this.destroyRequested=!0;return}this.activeOverlay&&(this.activeOverlay=this.getContext().destroyBean(this.activeOverlay),clearElement(this.eOverlayWrapper))},t.prototype.hideOverlay=function(){this.manuallyDisplayed=!1,this.destroyActiveOverlay(),this.setDisplayed(!1,{skipAriaHidden:!0})},t.prototype.destroy=function(){this.destroyActiveOverlay(),n.prototype.destroy.call(this)},t.prototype.showOrHideOverlay=function(){var e=this.paginationProxy.isEmpty(),r=this.gridOptionsService.is("suppressNoRowsOverlay");e&&!r?this.showNoRowsOverlay():this.hideOverlay()},t.prototype.onRowDataUpdated=function(){this.showOrHideOverlay()},t.prototype.onNewColumnsLoaded=function(){this.columnModel.isReady()&&!this.paginationProxy.isEmpty()&&!this.manuallyDisplayed&&this.hideOverlay()},t.TEMPLATE=`
        <div class="ag-overlay" aria-hidden="true">
            <div class="ag-overlay-panel">
                <div class="ag-overlay-wrapper" ref="eOverlayWrapper"></div>
            </div>
        </div>`,__decorate$u([Autowired("userComponentFactory")],t.prototype,"userComponentFactory",void 0),__decorate$u([Autowired("paginationProxy")],t.prototype,"paginationProxy",void 0),__decorate$u([Autowired("gridApi")],t.prototype,"gridApi",void 0),__decorate$u([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$u([RefSelector("eOverlayWrapper")],t.prototype,"eOverlayWrapper",void 0),__decorate$u([PostConstruct],t.prototype,"postConstruct",null),t}(Component),__extends$s=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$t=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},RowPositionUtils=function(n){__extends$s(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.getFirstRow=function(){var e=0,r;return this.pinnedRowModel.getPinnedTopRowCount()?r="top":this.rowModel.getRowCount()?(r=null,e=this.paginationProxy.getPageFirstRow()):this.pinnedRowModel.getPinnedBottomRowCount()&&(r="bottom"),r===void 0?null:{rowIndex:e,rowPinned:r}},t.prototype.getLastRow=function(){var e,r=null,o=this.pinnedRowModel.getPinnedBottomRowCount(),s=this.pinnedRowModel.getPinnedTopRowCount();return o?(r="bottom",e=o-1):this.rowModel.getRowCount()?(r=null,e=this.paginationProxy.getPageLastRow()):s&&(r="top",e=s-1),e===void 0?null:{rowIndex:e,rowPinned:r}},t.prototype.getRowNode=function(e){switch(e.rowPinned){case"top":return this.pinnedRowModel.getPinnedTopRowData()[e.rowIndex];case"bottom":return this.pinnedRowModel.getPinnedBottomRowData()[e.rowIndex];default:return this.rowModel.getRow(e.rowIndex)}},t.prototype.sameRow=function(e,r){return!e&&!r?!0:e&&!r||!e&&r?!1:e.rowIndex===r.rowIndex&&e.rowPinned==r.rowPinned},t.prototype.before=function(e,r){switch(e.rowPinned){case"top":if(r.rowPinned!=="top")return!0;break;case"bottom":if(r.rowPinned!=="bottom")return!1;break;default:if(exists(r.rowPinned))return r.rowPinned!=="top";break}return e.rowIndex<r.rowIndex},t.prototype.rowMax=function(e){var r=this,o;return e.forEach(function(s){(o===void 0||r.before(o,s))&&(o=s)}),o},t.prototype.rowMin=function(e){var r=this,o;return e.forEach(function(s){(o===void 0||r.before(s,o))&&(o=s)}),o},__decorate$t([Autowired("rowModel")],t.prototype,"rowModel",void 0),__decorate$t([Autowired("pinnedRowModel")],t.prototype,"pinnedRowModel",void 0),__decorate$t([Autowired("paginationProxy")],t.prototype,"paginationProxy",void 0),t=__decorate$t([Bean("rowPositionUtils")],t),t}(BeanStub),__extends$r=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$s=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},CellPositionUtils=function(n){__extends$r(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.createId=function(e){var r=e.rowIndex,o=e.rowPinned,s=e.column;return this.createIdFromValues({rowIndex:r,column:s,rowPinned:o})},t.prototype.createIdFromValues=function(e){var r=e.rowIndex,o=e.rowPinned,s=e.column;return r+"."+(o??"null")+"."+s.getId()},t.prototype.equals=function(e,r){var o=e.column===r.column,s=e.rowPinned===r.rowPinned,l=e.rowIndex===r.rowIndex;return o&&s&&l},t=__decorate$s([Bean("cellPositionUtils")],t),t}(BeanStub),__extends$q=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),UndoRedoAction=function(){function n(t){this.cellValueChanges=t}return n}(),RangeUndoRedoAction=function(n){__extends$q(t,n);function t(e,r,o,s){var l=n.call(this,e)||this;return l.initialRange=r,l.finalRange=o,l.ranges=s,l}return t}(UndoRedoAction),UndoRedoStack=function(){function n(t){this.actionStack=[],this.maxStackSize=t||n.DEFAULT_STACK_SIZE,this.actionStack=new Array(this.maxStackSize)}return n.prototype.pop=function(){return this.actionStack.pop()},n.prototype.push=function(t){var e=t.cellValueChanges&&t.cellValueChanges.length>0;e&&(this.actionStack.length===this.maxStackSize&&this.actionStack.shift(),this.actionStack.push(t))},n.prototype.clear=function(){this.actionStack=[]},n.prototype.getCurrentStackSize=function(){return this.actionStack.length},n.DEFAULT_STACK_SIZE=10,n}(),__extends$p=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__assign$2=function(){return __assign$2=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},__assign$2.apply(this,arguments)},__decorate$r=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__read$6=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray$5=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n},UndoRedoService=function(n){__extends$p(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.cellValueChanges=[],e.activeCellEdit=null,e.activeRowEdit=null,e.isPasting=!1,e.isRangeInAction=!1,e.onCellValueChanged=function(r){var o={column:r.column,rowIndex:r.rowIndex,rowPinned:r.rowPinned},s=e.activeCellEdit!==null&&e.cellPositionUtils.equals(e.activeCellEdit,o),l=e.activeRowEdit!==null&&e.rowPositionUtils.sameRow(e.activeRowEdit,o),a=s||l||e.isPasting||e.isRangeInAction;if(a){var h=r.rowPinned,y=r.rowIndex,C=r.column,L=r.oldValue,Y=r.value,ze={rowPinned:h,rowIndex:y,columnId:C.getColId(),newValue:Y,oldValue:L};e.cellValueChanges.push(ze)}},e.clearStacks=function(){e.undoStack.clear(),e.redoStack.clear()},e}return t.prototype.init=function(){var e=this;if(this.gridOptionsService.is("undoRedoCellEditing")){var r=this.gridOptionsService.getNum("undoRedoCellEditingLimit");r<=0||(this.undoStack=new UndoRedoStack(r),this.redoStack=new UndoRedoStack(r),this.addRowEditingListeners(),this.addCellEditingListeners(),this.addPasteListeners(),this.addFillListeners(),this.addCellKeyListeners(),this.addManagedListener(this.eventService,Events.EVENT_CELL_VALUE_CHANGED,this.onCellValueChanged),this.addManagedListener(this.eventService,Events.EVENT_MODEL_UPDATED,function(o){o.keepUndoRedoStack||e.clearStacks()}),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_PIVOT_MODE_CHANGED,this.clearStacks),this.addManagedListener(this.eventService,Events.EVENT_NEW_COLUMNS_LOADED,this.clearStacks),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_GROUP_OPENED,this.clearStacks),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_ROW_GROUP_CHANGED,this.clearStacks),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_MOVED,this.clearStacks),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_PINNED,this.clearStacks),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_VISIBLE,this.clearStacks),this.addManagedListener(this.eventService,Events.EVENT_ROW_DRAG_END,this.clearStacks),this.ctrlsService.whenReady(function(){e.gridBodyCtrl=e.ctrlsService.getGridBodyCtrl()}))}},t.prototype.getCurrentUndoStackSize=function(){return this.undoStack?this.undoStack.getCurrentStackSize():0},t.prototype.getCurrentRedoStackSize=function(){return this.redoStack?this.redoStack.getCurrentStackSize():0},t.prototype.undo=function(e){var r={type:Events.EVENT_UNDO_STARTED,source:e};this.eventService.dispatchEvent(r);var o=this.undoRedo(this.undoStack,this.redoStack,"initialRange","oldValue","undo"),s={type:Events.EVENT_UNDO_ENDED,source:e,operationPerformed:o};this.eventService.dispatchEvent(s)},t.prototype.redo=function(e){var r={type:Events.EVENT_REDO_STARTED,source:e};this.eventService.dispatchEvent(r);var o=this.undoRedo(this.redoStack,this.undoStack,"finalRange","newValue","redo"),s={type:Events.EVENT_REDO_ENDED,source:e,operationPerformed:o};this.eventService.dispatchEvent(s)},t.prototype.undoRedo=function(e,r,o,s,l){if(!e)return!1;var a=e.pop();return!a||!a.cellValueChanges?!1:(this.processAction(a,function(h){return h[s]},l),a instanceof RangeUndoRedoAction?this.processRange(a.ranges||[a[o]]):this.processCell(a.cellValueChanges),r.push(a),!0)},t.prototype.processAction=function(e,r,o){var s=this;e.cellValueChanges.forEach(function(l){var a=l.rowIndex,h=l.rowPinned,y=l.columnId,C={rowIndex:a,rowPinned:h},L=s.getRowNode(C);L.displayed&&L.setDataValue(y,r(l),o)})},t.prototype.processRange=function(e){var r=this,o;this.rangeService.removeAllCellRanges(!0),e.forEach(function(s,l){if(s){var a=s.startRow,h=s.endRow;l===e.length-1&&(o={rowPinned:a.rowPinned,rowIndex:a.rowIndex,columnId:s.startColumn.getColId()},r.setLastFocusedCell(o));var y={rowStartIndex:a.rowIndex,rowStartPinned:a.rowPinned,rowEndIndex:h.rowIndex,rowEndPinned:h.rowPinned,columnStart:s.startColumn,columns:s.columns};r.rangeService.addCellRange(y)}})},t.prototype.processCell=function(e){var r=e[0],o=r.rowIndex,s=r.rowPinned,l={rowIndex:o,rowPinned:s},a=this.getRowNode(l),h={rowPinned:r.rowPinned,rowIndex:a.rowIndex,columnId:r.columnId};this.setLastFocusedCell(h,!!this.rangeService)},t.prototype.setLastFocusedCell=function(e,r){var o=e.rowIndex,s=e.columnId,l=e.rowPinned,a=this.gridBodyCtrl.getScrollFeature(),h=this.columnModel.getGridColumn(s);if(h){a.ensureIndexVisible(o),a.ensureColumnVisible(h);var y={rowIndex:o,column:h,rowPinned:l};this.focusService.setFocusedCell(__assign$2(__assign$2({},y),{forceBrowserFocus:!0})),r&&this.rangeService.setRangeToCell(y)}},t.prototype.addRowEditingListeners=function(){var e=this;this.addManagedListener(this.eventService,Events.EVENT_ROW_EDITING_STARTED,function(r){e.activeRowEdit={rowIndex:r.rowIndex,rowPinned:r.rowPinned}}),this.addManagedListener(this.eventService,Events.EVENT_ROW_EDITING_STOPPED,function(){var r=new UndoRedoAction(e.cellValueChanges);e.pushActionsToUndoStack(r),e.activeRowEdit=null})},t.prototype.addCellEditingListeners=function(){var e=this;this.addManagedListener(this.eventService,Events.EVENT_CELL_EDITING_STARTED,function(r){e.activeCellEdit={column:r.column,rowIndex:r.rowIndex,rowPinned:r.rowPinned}}),this.addManagedListener(this.eventService,Events.EVENT_CELL_EDITING_STOPPED,function(r){e.activeCellEdit=null;var o=r.valueChanged&&!e.activeRowEdit&&!e.isPasting&&!e.isRangeInAction;if(o){var s=new UndoRedoAction(e.cellValueChanges);e.pushActionsToUndoStack(s)}})},t.prototype.addPasteListeners=function(){var e=this;this.addManagedListener(this.eventService,Events.EVENT_PASTE_START,function(){e.isPasting=!0}),this.addManagedListener(this.eventService,Events.EVENT_PASTE_END,function(){var r=new UndoRedoAction(e.cellValueChanges);e.pushActionsToUndoStack(r),e.isPasting=!1})},t.prototype.addFillListeners=function(){var e=this;this.addManagedListener(this.eventService,Events.EVENT_FILL_START,function(){e.isRangeInAction=!0}),this.addManagedListener(this.eventService,Events.EVENT_FILL_END,function(r){var o=new RangeUndoRedoAction(e.cellValueChanges,r.initialRange,r.finalRange);e.pushActionsToUndoStack(o),e.isRangeInAction=!1})},t.prototype.addCellKeyListeners=function(){var e=this;this.addManagedListener(this.eventService,Events.EVENT_KEY_SHORTCUT_CHANGED_CELL_START,function(){e.isRangeInAction=!0}),this.addManagedListener(this.eventService,Events.EVENT_KEY_SHORTCUT_CHANGED_CELL_END,function(){var r;e.rangeService&&e.gridOptionsService.isEnableRangeSelection()?r=new RangeUndoRedoAction(e.cellValueChanges,void 0,void 0,__spreadArray$5([],__read$6(e.rangeService.getCellRanges()))):r=new UndoRedoAction(e.cellValueChanges),e.pushActionsToUndoStack(r),e.isRangeInAction=!1})},t.prototype.pushActionsToUndoStack=function(e){this.undoStack.push(e),this.cellValueChanges=[],this.redoStack.clear()},t.prototype.getRowNode=function(e){switch(e.rowPinned){case"top":return this.pinnedRowModel.getPinnedTopRowData()[e.rowIndex];case"bottom":return this.pinnedRowModel.getPinnedBottomRowData()[e.rowIndex];default:return this.rowModel.getRow(e.rowIndex)}},__decorate$r([Autowired("focusService")],t.prototype,"focusService",void 0),__decorate$r([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),__decorate$r([Autowired("rowModel")],t.prototype,"rowModel",void 0),__decorate$r([Autowired("pinnedRowModel")],t.prototype,"pinnedRowModel",void 0),__decorate$r([Autowired("cellPositionUtils")],t.prototype,"cellPositionUtils",void 0),__decorate$r([Autowired("rowPositionUtils")],t.prototype,"rowPositionUtils",void 0),__decorate$r([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$r([Optional("rangeService")],t.prototype,"rangeService",void 0),__decorate$r([PostConstruct],t.prototype,"init",null),t=__decorate$r([Bean("undoRedoService")],t),t}(BeanStub),__extends$o=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$q=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},HeaderPositionUtils=function(n){__extends$o(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.findHeader=function(e,r){var o,s,l;if(e.column instanceof ColumnGroup?(s="getDisplayedGroup"+r,o=this.columnModel[s](e.column)):(l="getDisplayedCol"+r,o=this.columnModel[l](e.column)),!!o){var a=e.headerRowIndex,h=this.getHeaderRowType(a);if(h===HeaderRowType.COLUMN_GROUP){var y=o;if(y.isPadding()&&this.isAnyChildSpanningHeaderHeight(y)){var C=this.getColumnVisibleChild(y,a,r),L=C.nextFocusColumn,Y=C.nextRow;L&&(o=L,a=Y)}}return{column:o,headerRowIndex:a}}},t.prototype.isAnyChildSpanningHeaderHeight=function(e){return e?e.getLeafColumns().some(function(r){return r.isSpanHeaderHeight()}):!1},t.prototype.getColumnVisibleParent=function(e,r){var o=this.getHeaderRowType(r),s=o===HeaderRowType.FLOATING_FILTER,l=o===HeaderRowType.COLUMN,a=s?e:e.getParent(),h=r-1;if(l&&this.isAnyChildSpanningHeaderHeight(e.getParent())){for(;a&&a.isPadding();)a=a.getParent(),h--;h<0&&(a=e,h=r)}return{nextFocusColumn:a,nextRow:h}},t.prototype.getColumnVisibleChild=function(e,r,o){o===void 0&&(o="After");var s=this.getHeaderRowType(r),l=e,a=r+1;if(s===HeaderRowType.COLUMN_GROUP){var h=e.getLeafColumns(),y=o==="After"?h[0]:last(h);if(this.isAnyChildSpanningHeaderHeight(y.getParent())){l=y;for(var C=y.getParent();C&&C!==e;)C=C.getParent(),a++}else l=e.getDisplayedChildren()[0]}return{nextFocusColumn:l,nextRow:a}},t.prototype.getHeaderRowType=function(e){var r=this.ctrlsService.getHeaderRowContainerCtrl();if(r)return r.getRowType(e)},t.prototype.findColAtEdgeForHeaderRow=function(e,r){var o=this.columnModel.getAllDisplayedColumns(),s=o[r==="start"?0:o.length-1];if(s){var l=this.ctrlsService.getHeaderRowContainerCtrl(s.getPinned()),a=l.getRowType(e);if(a==HeaderRowType.COLUMN_GROUP){var h=this.columnModel.getColumnGroupAtLevel(s,e);return{headerRowIndex:e,column:h}}return{headerRowIndex:a==null?-1:e,column:s}}},__decorate$q([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$q([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),t=__decorate$q([Bean("headerPositionUtils")],t),t}(BeanStub),__decorate$p=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},ColumnDefFactory=function(){function n(){}return n.prototype.buildColumnDefs=function(t,e,r){var o=this,s=[],l={};return t.forEach(function(a){for(var h=o.createDefFromColumn(a,e,r),y=!0,C=h,L=a.getOriginalParent(),Y=null;L;){var ze=null;if(L.isPadding()){L=L.getOriginalParent();continue}var Bt=l[L.getGroupId()];if(Bt){Bt.children.push(C),y=!1;break}if(ze=o.createDefFromGroup(L),ze&&(ze.children=[C],l[ze.groupId]=ze,C=ze,L=L.getOriginalParent()),L!=null&&Y===L){y=!1;break}Y=L}y&&s.push(C)}),s},n.prototype.createDefFromGroup=function(t){var e=deepCloneDefinition(t.getColGroupDef(),["children"]);return e&&(e.groupId=t.getGroupId()),e},n.prototype.createDefFromColumn=function(t,e,r){var o=deepCloneDefinition(t.getColDef());return o.colId=t.getColId(),o.width=t.getActualWidth(),o.rowGroup=t.isRowGroupActive(),o.rowGroupIndex=t.isRowGroupActive()?e.indexOf(t):null,o.pivot=t.isPivotActive(),o.pivotIndex=t.isPivotActive()?r.indexOf(t):null,o.aggFunc=t.isValueActive()?t.getAggFunc():null,o.hide=t.isVisible()?void 0:!0,o.pinned=t.isPinned()?t.getPinned():null,o.sort=t.getSort()?t.getSort():null,o.sortIndex=t.getSortIndex()!=null?t.getSortIndex():null,o},n=__decorate$p([Bean("columnDefFactory")],n),n}(),__decorate$o=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},RowCssClassCalculator=function(){function n(){}return n.prototype.getInitialRowClasses=function(t){var e=[];return exists(t.extraCssClass)&&e.push(t.extraCssClass),e.push("ag-row"),e.push(t.rowFocused?"ag-row-focus":"ag-row-no-focus"),t.fadeRowIn&&e.push("ag-opacity-zero"),e.push(t.rowIsEven?"ag-row-even":"ag-row-odd"),t.rowNode.isRowPinned()&&e.push("ag-row-pinned"),t.rowNode.isSelected()&&e.push("ag-row-selected"),t.rowNode.footer&&e.push("ag-row-footer"),e.push("ag-row-level-"+t.rowLevel),t.rowNode.stub&&e.push("ag-row-loading"),t.fullWidthRow&&e.push("ag-full-width-row"),t.expandable&&(e.push("ag-row-group"),e.push(t.rowNode.expanded?"ag-row-group-expanded":"ag-row-group-contracted")),t.rowNode.dragging&&e.push("ag-row-dragging"),pushAll(e,this.processClassesFromGridOptions(t.rowNode)),pushAll(e,this.preProcessRowClassRules(t.rowNode)),e.push(t.printLayout?"ag-row-position-relative":"ag-row-position-absolute"),t.firstRowOnPage&&e.push("ag-row-first"),t.lastRowOnPage&&e.push("ag-row-last"),t.fullWidthRow&&(t.pinned==="left"&&e.push("ag-cell-last-left-pinned"),t.pinned==="right"&&e.push("ag-cell-first-right-pinned")),e},n.prototype.processClassesFromGridOptions=function(t){var e=[],r=function(h){typeof h=="string"?e.push(h):Array.isArray(h)&&h.forEach(function(y){return e.push(y)})},o=this.gridOptionsService.get("rowClass");if(o){if(typeof o=="function")return console.warn("AG Grid: rowClass should not be a function, please use getRowClass instead"),[];r(o)}var s=this.gridOptionsService.getCallback("getRowClass");if(s){var l={data:t.data,node:t,rowIndex:t.rowIndex},a=s(l);r(a)}return e},n.prototype.preProcessRowClassRules=function(t){var e=[];return this.processRowClassRules(t,function(r){e.push(r)},function(r){}),e},n.prototype.processRowClassRules=function(t,e,r){var o={data:t.data,node:t,rowIndex:t.rowIndex,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context};this.stylingService.processClassRules(this.gridOptionsService.get("rowClassRules"),o,e,r)},n.prototype.calculateRowLevel=function(t){return t.group?t.level:t.parent?t.parent.level+1:0},__decorate$o([Autowired("stylingService")],n.prototype,"stylingService",void 0),__decorate$o([Autowired("gridOptionsService")],n.prototype,"gridOptionsService",void 0),n=__decorate$o([Bean("rowCssClassCalculator")],n),n}(),__extends$n=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$n=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},RowNodeSorter=function(n){__extends$n(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.init=function(){var e=this;this.isAccentedSort=this.gridOptionsService.is("accentedSort"),this.primaryColumnsSortGroups=this.gridOptionsService.isColumnsSortingCoupledToGroup(),this.addManagedPropertyListener("accentedSort",function(r){return e.isAccentedSort=r.currentValue}),this.addManagedPropertyListener("autoGroupColumnDef",function(){return e.primaryColumnsSortGroups=e.gridOptionsService.isColumnsSortingCoupledToGroup()})},t.prototype.doFullSort=function(e,r){var o=function(l,a){return{currentPos:a,rowNode:l}},s=e.map(o);return s.sort(this.compareRowNodes.bind(this,r)),s.map(function(l){return l.rowNode})},t.prototype.compareRowNodes=function(e,r,o){for(var s=r.rowNode,l=o.rowNode,a=0,h=e.length;a<h;a++){var y=e[a],C=y.sort==="desc",L=this.getValue(s,y.column),Y=this.getValue(l,y.column),ze=void 0,Bt=this.getComparator(y,s);Bt?ze=Bt(L,Y,s,l,C):ze=_.defaultComparator(L,Y,this.isAccentedSort);var Ir=!isNaN(ze);if(Ir&&ze!==0)return y.sort==="asc"?ze:ze*-1}return r.currentPos-o.currentPos},t.prototype.getComparator=function(e,r){var o=e.column,s=o.getColDef().comparator;if(s!=null)return s;if(o.getColDef().showRowGroup){var l=!r.group&&o.getColDef().field;if(l){var a=this.columnModel.getPrimaryColumn(l);if(a)return a.getColDef().comparator}}},t.prototype.getValue=function(e,r){var o,s;if(!this.primaryColumnsSortGroups)return this.valueService.getValue(r,e,!1,!1);var l=e.rowGroupColumn===r;if(l){var a=this.gridOptionsService.isGroupUseEntireRow(this.columnModel.isPivotActive());if(a){var h=r.getColDef().keyCreator;if(h)return e.key;var y=(o=e.allLeafChildren)===null||o===void 0?void 0:o[0];return y?this.valueService.getValue(r,y,!1,!1):void 0}var C=this.columnModel.getGroupDisplayColumnForGroup(r.getId());return C?(s=e.groupData)===null||s===void 0?void 0:s[C.getId()]:void 0}if(!(e.group&&r.getColDef().showRowGroup))return this.valueService.getValue(r,e,!1,!1)},__decorate$n([Autowired("valueService")],t.prototype,"valueService",void 0),__decorate$n([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$n([PostConstruct],t.prototype,"init",null),t=__decorate$n([Bean("rowNodeSorter")],t),t}(BeanStub),__extends$m=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$m=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},CtrlsService=function(n){__extends$m(t,n);function t(){var r=n!==null&&n.apply(this,arguments)||this;return r.ready=!1,r.readyCallbacks=[],r}e=t,t.prototype.checkReady=function(){if(this.ready=this.gridCtrl!=null&&this.gridBodyCtrl!=null&&this.centerRowContainerCtrl!=null&&this.leftRowContainerCtrl!=null&&this.rightRowContainerCtrl!=null&&this.bottomCenterRowContainerCtrl!=null&&this.bottomLeftRowContainerCtrl!=null&&this.bottomRightRowContainerCtrl!=null&&this.topCenterRowContainerCtrl!=null&&this.topLeftRowContainerCtrl!=null&&this.topRightRowContainerCtrl!=null&&this.stickyTopCenterRowContainerCtrl!=null&&this.stickyTopLeftRowContainerCtrl!=null&&this.stickyTopRightRowContainerCtrl!=null&&this.centerHeaderRowContainerCtrl!=null&&this.leftHeaderRowContainerCtrl!=null&&this.rightHeaderRowContainerCtrl!=null&&this.fakeHScrollComp!=null&&this.fakeVScrollComp!=null&&this.gridHeaderCtrl!=null,this.ready){var r=this.createReadyParams();this.readyCallbacks.forEach(function(o){return o(r)}),this.readyCallbacks.length=0}},t.prototype.whenReady=function(r){this.ready?r(this.createReadyParams()):this.readyCallbacks.push(r)},t.prototype.createReadyParams=function(){return{centerRowContainerCtrl:this.centerRowContainerCtrl,leftRowContainerCtrl:this.leftRowContainerCtrl,rightRowContainerCtrl:this.rightRowContainerCtrl,bottomCenterRowContainerCtrl:this.bottomCenterRowContainerCtrl,bottomLeftRowContainerCtrl:this.bottomLeftRowContainerCtrl,bottomRightRowContainerCtrl:this.bottomRightRowContainerCtrl,topCenterRowContainerCtrl:this.topCenterRowContainerCtrl,topLeftRowContainerCtrl:this.topLeftRowContainerCtrl,topRightRowContainerCtrl:this.topRightRowContainerCtrl,stickyTopCenterRowContainerCtrl:this.stickyTopCenterRowContainerCtrl,stickyTopLeftRowContainerCtrl:this.stickyTopLeftRowContainerCtrl,stickyTopRightRowContainerCtrl:this.stickyTopRightRowContainerCtrl,centerHeaderRowContainerCtrl:this.centerHeaderRowContainerCtrl,leftHeaderRowContainerCtrl:this.leftHeaderRowContainerCtrl,rightHeaderRowContainerCtrl:this.rightHeaderRowContainerCtrl,fakeHScrollComp:this.fakeHScrollComp,fakeVScrollComp:this.fakeVScrollComp,gridBodyCtrl:this.gridBodyCtrl,gridCtrl:this.gridCtrl,gridHeaderCtrl:this.gridHeaderCtrl}},t.prototype.registerFakeHScrollComp=function(r){this.fakeHScrollComp=r,this.checkReady()},t.prototype.registerFakeVScrollComp=function(r){this.fakeVScrollComp=r,this.checkReady()},t.prototype.registerGridHeaderCtrl=function(r){this.gridHeaderCtrl=r,this.checkReady()},t.prototype.registerCenterRowContainerCtrl=function(r){this.centerRowContainerCtrl=r,this.checkReady()},t.prototype.registerLeftRowContainerCtrl=function(r){this.leftRowContainerCtrl=r,this.checkReady()},t.prototype.registerRightRowContainerCtrl=function(r){this.rightRowContainerCtrl=r,this.checkReady()},t.prototype.registerTopCenterRowContainerCtrl=function(r){this.topCenterRowContainerCtrl=r,this.checkReady()},t.prototype.registerTopLeftRowContainerCon=function(r){this.topLeftRowContainerCtrl=r,this.checkReady()},t.prototype.registerTopRightRowContainerCtrl=function(r){this.topRightRowContainerCtrl=r,this.checkReady()},t.prototype.registerStickyTopCenterRowContainerCtrl=function(r){this.stickyTopCenterRowContainerCtrl=r,this.checkReady()},t.prototype.registerStickyTopLeftRowContainerCon=function(r){this.stickyTopLeftRowContainerCtrl=r,this.checkReady()},t.prototype.registerStickyTopRightRowContainerCtrl=function(r){this.stickyTopRightRowContainerCtrl=r,this.checkReady()},t.prototype.registerBottomCenterRowContainerCtrl=function(r){this.bottomCenterRowContainerCtrl=r,this.checkReady()},t.prototype.registerBottomLeftRowContainerCtrl=function(r){this.bottomLeftRowContainerCtrl=r,this.checkReady()},t.prototype.registerBottomRightRowContainerCtrl=function(r){this.bottomRightRowContainerCtrl=r,this.checkReady()},t.prototype.registerHeaderContainer=function(r,o){switch(o){case"left":this.leftHeaderRowContainerCtrl=r;break;case"right":this.rightHeaderRowContainerCtrl=r;break;default:this.centerHeaderRowContainerCtrl=r;break}this.checkReady()},t.prototype.registerGridBodyCtrl=function(r){this.gridBodyCtrl=r,this.checkReady()},t.prototype.registerGridCtrl=function(r){this.gridCtrl=r,this.checkReady()},t.prototype.getFakeHScrollComp=function(){return this.fakeHScrollComp},t.prototype.getFakeVScrollComp=function(){return this.fakeVScrollComp},t.prototype.getGridHeaderCtrl=function(){return this.gridHeaderCtrl},t.prototype.getGridCtrl=function(){return this.gridCtrl},t.prototype.getCenterRowContainerCtrl=function(){return this.centerRowContainerCtrl},t.prototype.getTopCenterRowContainerCtrl=function(){return this.topCenterRowContainerCtrl},t.prototype.getBottomCenterRowContainerCtrl=function(){return this.bottomCenterRowContainerCtrl},t.prototype.getStickyTopCenterRowContainerCtrl=function(){return this.stickyTopCenterRowContainerCtrl},t.prototype.getGridBodyCtrl=function(){return this.gridBodyCtrl},t.prototype.getHeaderRowContainerCtrls=function(){return[this.leftHeaderRowContainerCtrl,this.rightHeaderRowContainerCtrl,this.centerHeaderRowContainerCtrl]},t.prototype.getHeaderRowContainerCtrl=function(r){switch(r){case"left":return this.leftHeaderRowContainerCtrl;case"right":return this.rightHeaderRowContainerCtrl;default:return this.centerHeaderRowContainerCtrl}};var e;return t.NAME="ctrlsService",t=e=__decorate$m([Bean(e.NAME)],t),t}(BeanStub),__extends$l=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$l=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},CtrlsFactory=function(n){__extends$l(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.registry={},e}return t.prototype.register=function(e){this.registry[e.controllerName]=e.controllerClass},t.prototype.getInstance=function(e){var r=this.registry[e];if(r!=null)return new r},t=__decorate$l([Bean("ctrlsFactory")],t),t}(BeanStub),__extends$k=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$k=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},AbstractFakeScrollComp=function(n){__extends$k(t,n);function t(e,r){var o=n.call(this,e)||this;return o.direction=r,o.hideTimeout=null,o}return t.prototype.postConstruct=function(){this.addManagedListener(this.eventService,Events.EVENT_SCROLL_VISIBILITY_CHANGED,this.onScrollVisibilityChanged.bind(this)),this.onScrollVisibilityChanged(),this.addOrRemoveCssClass("ag-apple-scrollbar",isMacOsUserAgent()||isIOSUserAgent())},t.prototype.initialiseInvisibleScrollbar=function(){this.invisibleScrollbar===void 0&&(this.invisibleScrollbar=isInvisibleScrollbar(),this.invisibleScrollbar&&(this.hideAndShowInvisibleScrollAsNeeded(),this.addActiveListenerToggles()))},t.prototype.addActiveListenerToggles=function(){var e=this,r=["mouseenter","mousedown","touchstart"],o=["mouseleave","touchend"],s=this.getGui();r.forEach(function(l){return e.addManagedListener(s,l,function(){return e.addOrRemoveCssClass("ag-scrollbar-active",!0)})}),o.forEach(function(l){return e.addManagedListener(s,l,function(){return e.addOrRemoveCssClass("ag-scrollbar-active",!1)})})},t.prototype.onScrollVisibilityChanged=function(){var e=this;this.invisibleScrollbar===void 0&&this.initialiseInvisibleScrollbar(),this.animationFrameService.requestAnimationFrame(function(){return e.setScrollVisible()})},t.prototype.hideAndShowInvisibleScrollAsNeeded=function(){var e=this;this.addManagedListener(this.eventService,Events.EVENT_BODY_SCROLL,function(r){r.direction===e.direction&&(e.hideTimeout!==null&&(window.clearTimeout(e.hideTimeout),e.hideTimeout=null),e.addOrRemoveCssClass("ag-scrollbar-scrolling",!0))}),this.addManagedListener(this.eventService,Events.EVENT_BODY_SCROLL_END,function(){e.hideTimeout=window.setTimeout(function(){e.addOrRemoveCssClass("ag-scrollbar-scrolling",!1),e.hideTimeout=null},400)})},t.prototype.attemptSettingScrollPosition=function(e){var r=this,o=this.getViewport();waitUntil(function(){return isVisible(o)},function(){return r.setScrollPosition(e)},100)},t.prototype.getViewport=function(){return this.eViewport},t.prototype.getContainer=function(){return this.eContainer},t.prototype.onScrollCallback=function(e){this.addManagedListener(this.getViewport(),"scroll",e)},__decorate$k([RefSelector("eViewport")],t.prototype,"eViewport",void 0),__decorate$k([RefSelector("eContainer")],t.prototype,"eContainer",void 0),__decorate$k([Autowired("scrollVisibleService")],t.prototype,"scrollVisibleService",void 0),__decorate$k([Autowired("ctrlsService")],t.prototype,"ctrlsService",void 0),__decorate$k([Autowired("animationFrameService")],t.prototype,"animationFrameService",void 0),t}(Component),__extends$j=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$j=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},FakeHScrollComp=function(n){__extends$j(t,n);function t(){return n.call(this,t.TEMPLATE,"horizontal")||this}return t.prototype.postConstruct=function(){var e=this;n.prototype.postConstruct.call(this);var r=this.setFakeHScrollSpacerWidths.bind(this);this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,r),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED,r),this.addManagedListener(this.eventService,Events.EVENT_PINNED_ROW_DATA_CHANGED,this.onPinnedRowDataChanged.bind(this)),this.addManagedPropertyListener("domLayout",r),this.ctrlsService.registerFakeHScrollComp(this),this.createManagedBean(new CenterWidthFeature(function(o){return e.eContainer.style.width=o+"px"}))},t.prototype.initialiseInvisibleScrollbar=function(){this.invisibleScrollbar===void 0&&(this.enableRtl=this.gridOptionsService.is("enableRtl"),n.prototype.initialiseInvisibleScrollbar.call(this),this.invisibleScrollbar&&this.refreshCompBottom())},t.prototype.onPinnedRowDataChanged=function(){this.refreshCompBottom()},t.prototype.refreshCompBottom=function(){if(this.invisibleScrollbar){var e=this.pinnedRowModel.getPinnedBottomTotalHeight();this.getGui().style.bottom=e+"px"}},t.prototype.onScrollVisibilityChanged=function(){n.prototype.onScrollVisibilityChanged.call(this),this.setFakeHScrollSpacerWidths()},t.prototype.setFakeHScrollSpacerWidths=function(){var e=this.scrollVisibleService.isVerticalScrollShowing(),r=this.columnModel.getDisplayedColumnsRightWidth(),o=!this.enableRtl&&e,s=this.gridOptionsService.getScrollbarWidth();o&&(r+=s),setFixedWidth(this.eRightSpacer,r),this.eRightSpacer.classList.toggle("ag-scroller-corner",r<=s);var l=this.columnModel.getDisplayedColumnsLeftWidth(),a=this.enableRtl&&e;a&&(l+=s),setFixedWidth(this.eLeftSpacer,l),this.eLeftSpacer.classList.toggle("ag-scroller-corner",l<=s)},t.prototype.setScrollVisible=function(){var e=this.scrollVisibleService.isHorizontalScrollShowing(),r=this.invisibleScrollbar,o=this.gridOptionsService.is("suppressHorizontalScroll"),s=e&&this.gridOptionsService.getScrollbarWidth()||0,l=s===0&&r?16:s,a=o?0:l;this.addOrRemoveCssClass("ag-scrollbar-invisible",r),setFixedHeight(this.getGui(),a),setFixedHeight(this.eViewport,a),setFixedHeight(this.eContainer,a),this.setDisplayed(e,{skipAriaHidden:!0})},t.prototype.getScrollPosition=function(){return getScrollLeft(this.getViewport(),this.enableRtl)},t.prototype.setScrollPosition=function(e){isVisible(this.getViewport())||this.attemptSettingScrollPosition(e),setScrollLeft(this.getViewport(),e,this.enableRtl)},t.TEMPLATE=`<div class="ag-body-horizontal-scroll" aria-hidden="true">
            <div class="ag-horizontal-left-spacer" ref="eLeftSpacer"></div>
            <div class="ag-body-horizontal-scroll-viewport" ref="eViewport">
                <div class="ag-body-horizontal-scroll-container" ref="eContainer"></div>
            </div>
            <div class="ag-horizontal-right-spacer" ref="eRightSpacer"></div>
        </div>`,__decorate$j([RefSelector("eLeftSpacer")],t.prototype,"eLeftSpacer",void 0),__decorate$j([RefSelector("eRightSpacer")],t.prototype,"eRightSpacer",void 0),__decorate$j([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$j([Autowired("pinnedRowModel")],t.prototype,"pinnedRowModel",void 0),__decorate$j([PostConstruct],t.prototype,"postConstruct",null),t}(AbstractFakeScrollComp),__extends$i=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$i=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},PinnedWidthService=function(n){__extends$i(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.postConstruct=function(){var e=this.checkContainerWidths.bind(this);this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_CHANGED,e),this.addManagedListener(this.eventService,Events.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED,e),this.addManagedPropertyListener("domLayout",e)},t.prototype.checkContainerWidths=function(){var e=this.gridOptionsService.isDomLayout("print"),r=e?0:this.columnModel.getDisplayedColumnsLeftWidth(),o=e?0:this.columnModel.getDisplayedColumnsRightWidth();r!=this.leftWidth&&(this.leftWidth=r,this.eventService.dispatchEvent({type:Events.EVENT_LEFT_PINNED_WIDTH_CHANGED})),o!=this.rightWidth&&(this.rightWidth=o,this.eventService.dispatchEvent({type:Events.EVENT_RIGHT_PINNED_WIDTH_CHANGED}))},t.prototype.getPinnedRightWidth=function(){return this.rightWidth},t.prototype.getPinnedLeftWidth=function(){return this.leftWidth},__decorate$i([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$i([PostConstruct],t.prototype,"postConstruct",null),t=__decorate$i([Bean("pinnedWidthService")],t),t}(BeanStub),__extends$h=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$h=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},RowNodeEventThrottle=function(n){__extends$h(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.events=[],e}return t.prototype.postConstruct=function(){this.rowModel.getType()=="clientSide"&&(this.clientSideRowModel=this.rowModel)},t.prototype.dispatchExpanded=function(e){var r=this;if(this.clientSideRowModel==null){this.eventService.dispatchEvent(e);return}this.events.push(e);var o=function(){r.clientSideRowModel&&r.clientSideRowModel.onRowGroupOpened(),r.events.forEach(function(s){return r.eventService.dispatchEvent(s)}),r.events=[]};this.dispatchExpandedDebounced==null&&(this.dispatchExpandedDebounced=this.animationFrameService.debounce(o)),this.dispatchExpandedDebounced()},__decorate$h([Autowired("animationFrameService")],t.prototype,"animationFrameService",void 0),__decorate$h([Autowired("rowModel")],t.prototype,"rowModel",void 0),__decorate$h([PostConstruct],t.prototype,"postConstruct",null),t=__decorate$h([Bean("rowNodeEventThrottle")],t),t}(BeanStub),__assign$1=function(){return __assign$1=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},__assign$1.apply(this,arguments)},__decorate$g=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__param$1=function(n,t){return function(e,r){t(e,r,n)}},__read$5=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray$4=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n};function toNumber(n){if(typeof n=="number")return n;if(typeof n=="string")return parseInt(n,10)}function isTrue(n){return n===!0||n==="true"}var GridOptionsService=function(){function n(){this.destroyed=!1,this.domDataKey="__AG_"+Math.random().toString(),this.propertyEventService=new EventService}return Object.defineProperty(n.prototype,"context",{get:function(){return this.gridOptions.context},enumerable:!1,configurable:!0}),n.prototype.agWire=function(t,e){this.gridOptions.api=t,this.gridOptions.columnApi=e,this.api=t,this.columnApi=e},n.prototype.init=function(){this.gridOptionLookup=new Set(__spreadArray$4(__spreadArray$4([],__read$5(ComponentUtil.ALL_PROPERTIES)),__read$5(ComponentUtil.EVENT_CALLBACKS)));var t=!this.is("suppressAsyncEvents");this.eventService.addGlobalListener(this.globalEventHandler.bind(this),t),this.getScrollbarWidth()},n.prototype.destroy=function(){this.gridOptions.api=null,this.gridOptions.columnApi=null,this.destroyed=!0},n.prototype.is=function(t){return isTrue(this.gridOptions[t])},n.prototype.get=function(t){return this.gridOptions[t]},n.prototype.getNum=function(t){return toNumber(this.gridOptions[t])},n.prototype.getCallback=function(t){return this.mergeGridCommonParams(this.gridOptions[t])},n.prototype.exists=function(t){return exists(this.gridOptions[t])},n.prototype.mergeGridCommonParams=function(t){var e=this;if(t){var r=function(o){var s=o;return s.api=e.api,s.columnApi=e.columnApi,s.context=e.context,t(s)};return r}return t},n.prototype.set=function(t,e,r,o){if(r===void 0&&(r=!1),o===void 0&&(o={}),this.gridOptionLookup.has(t)){var s=this.gridOptions[t];if(r||s!==e){this.gridOptions[t]=e;var l=__assign$1({type:t,currentValue:e,previousValue:s},o);this.propertyEventService.dispatchEvent(l)}}},n.prototype.addEventListener=function(t,e){this.propertyEventService.addEventListener(t,e)},n.prototype.removeEventListener=function(t,e){this.propertyEventService.removeEventListener(t,e)},n.prototype.globalEventHandler=function(t,e){if(!this.destroyed){var r=ComponentUtil.getCallbackForEvent(t);typeof this.gridOptions[r]=="function"&&this.gridOptions[r](e)}},n.prototype.getGridId=function(){return this.api.getGridId()},n.prototype.getScrollbarWidth=function(){if(this.scrollbarWidth==null){var t=typeof this.gridOptions.scrollbarWidth=="number"&&this.gridOptions.scrollbarWidth>=0,e=t?this.gridOptions.scrollbarWidth:getScrollbarWidth();e!=null&&(this.scrollbarWidth=e,this.eventService.dispatchEvent({type:Events.EVENT_SCROLLBAR_WIDTH_CHANGED}))}return this.scrollbarWidth},n.prototype.isRowModelType=function(t){return this.gridOptions.rowModelType===t||t==="clientSide"&&missing(this.gridOptions.rowModelType)},n.prototype.isDomLayout=function(t){var e,r=(e=this.gridOptions.domLayout)!==null&&e!==void 0?e:"normal";return r===t},n.prototype.isRowSelection=function(){return this.gridOptions.rowSelection==="single"||this.gridOptions.rowSelection==="multiple"},n.prototype.useAsyncEvents=function(){return!this.is("suppressAsyncEvents")},n.prototype.isGetRowHeightFunction=function(){return typeof this.gridOptions.getRowHeight=="function"},n.prototype.getRowHeightForNode=function(t,e,r){if(e===void 0&&(e=!1),r==null&&(r=this.environment.getDefaultRowHeight()),this.isGetRowHeightFunction()){if(e)return{height:r,estimated:!0};var o={node:t,data:t.data},s=this.getCallback("getRowHeight")(o);if(this.isNumeric(s))return s===0&&doOnce(function(){return console.warn("AG Grid: The return of `getRowHeight` cannot be zero. If the intention is to hide rows, use a filter instead.")},"invalidRowHeight"),{height:Math.max(1,s),estimated:!1}}if(t.detail&&this.is("masterDetail"))return this.getMasterDetailRowHeight();var l=this.gridOptions.rowHeight&&this.isNumeric(this.gridOptions.rowHeight)?this.gridOptions.rowHeight:r;return{height:l,estimated:!1}},n.prototype.getMasterDetailRowHeight=function(){return this.is("detailRowAutoHeight")?{height:1,estimated:!1}:this.isNumeric(this.gridOptions.detailRowHeight)?{height:this.gridOptions.detailRowHeight,estimated:!1}:{height:300,estimated:!1}},n.prototype.getRowHeightAsNumber=function(){if(!this.gridOptions.rowHeight||missing(this.gridOptions.rowHeight))return this.environment.getDefaultRowHeight();var t=this.gridOptions.rowHeight;return t&&this.isNumeric(t)?(this.environment.setRowHeightVariable(t),t):(console.warn("AG Grid row height must be a number if not using standard row model"),this.environment.getDefaultRowHeight())},n.prototype.isNumeric=function(t){return!isNaN(t)&&typeof t=="number"&&isFinite(t)},n.prototype.getDomDataKey=function(){return this.domDataKey},n.prototype.getDomData=function(t,e){var r=t[this.getDomDataKey()];return r?r[e]:void 0},n.prototype.setDomData=function(t,e,r){var o=this.getDomDataKey(),s=t[o];missing(s)&&(s={},t[o]=s),s[e]=r},n.prototype.getDocument=function(){var t=null;return this.gridOptions.getDocument&&exists(this.gridOptions.getDocument)?t=this.gridOptions.getDocument():this.eGridDiv&&(t=this.eGridDiv.ownerDocument),t&&exists(t)?t:document},n.prototype.getWindow=function(){var t=this.getDocument();return t.defaultView||window},n.prototype.getRootNode=function(){return this.eGridDiv.getRootNode()},n.prototype.getAsyncTransactionWaitMillis=function(){return exists(this.gridOptions.asyncTransactionWaitMillis)?this.gridOptions.asyncTransactionWaitMillis:50},n.prototype.isAnimateRows=function(){return this.is("ensureDomOrder")?!1:this.is("animateRows")},n.prototype.isGroupRowsSticky=function(){return!(this.is("suppressGroupRowsSticky")||this.is("paginateChildRows")||this.is("groupHideOpenParents"))},n.prototype.isTreeData=function(){return this.is("treeData")&&ModuleRegistry.__assertRegistered(ModuleNames.RowGroupingModule,"Tree Data",this.api.getGridId())},n.prototype.isMasterDetail=function(){return this.is("masterDetail")&&ModuleRegistry.__assertRegistered(ModuleNames.MasterDetailModule,"masterDetail",this.api.getGridId())},n.prototype.isEnableRangeSelection=function(){return this.is("enableRangeSelection")&&ModuleRegistry.__isRegistered(ModuleNames.RangeSelectionModule,this.api.getGridId())},n.prototype.isColumnsSortingCoupledToGroup=function(){var t=this.gridOptions.autoGroupColumnDef,e=this.isRowModelType("clientSide");return e&&!(t!=null&&t.comparator)&&!this.isTreeData()},n.prototype.getGroupAggFiltering=function(){var t=this.gridOptions.groupAggFiltering;if(typeof t=="function")return this.getCallback("groupAggFiltering");if(isTrue(t))return function(){return!0}},n.prototype.isGroupMultiAutoColumn=function(){return this.gridOptions.groupDisplayType?matchesGroupDisplayType("multipleColumns",this.gridOptions.groupDisplayType):this.is("groupHideOpenParents")},n.prototype.isGroupUseEntireRow=function(t){return t?!1:this.gridOptions.groupDisplayType?matchesGroupDisplayType("groupRows",this.gridOptions.groupDisplayType):!1},__decorate$g([Autowired("gridOptions")],n.prototype,"gridOptions",void 0),__decorate$g([Autowired("eventService")],n.prototype,"eventService",void 0),__decorate$g([Autowired("environment")],n.prototype,"environment",void 0),__decorate$g([Autowired("eGridDiv")],n.prototype,"eGridDiv",void 0),__decorate$g([__param$1(0,Qualifier("gridApi")),__param$1(1,Qualifier("columnApi"))],n.prototype,"agWire",null),__decorate$g([PostConstruct],n.prototype,"init",null),__decorate$g([PreDestroy],n.prototype,"destroy",null),n=__decorate$g([Bean("gridOptionsService")],n),n}(),__extends$g=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$f=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},LocaleService=function(n){__extends$g(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.getLocaleTextFunc=function(){var e=this.gridOptionsService.getCallback("getLocaleText");if(e)return function(o,s,l){var a={key:o,defaultValue:s,variableValues:l};return e(a)};var r=this.gridOptionsService.get("localeText");return function(o,s,l){var a=r&&r[o];if(a&&l&&l.length)for(var h=0;!(h>=l.length);){var y=a.indexOf("${variable}");if(y===-1)break;a=a.replace("${variable}",l[h++])}return a??s}},t=__decorate$f([Bean("localeService")],t),t}(BeanStub),__extends$f=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$e=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},FakeVScrollComp=function(n){__extends$f(t,n);function t(){return n.call(this,t.TEMPLATE,"vertical")||this}return t.prototype.postConstruct=function(){n.prototype.postConstruct.call(this),this.createManagedBean(new SetHeightFeature(this.eContainer)),this.ctrlsService.registerFakeVScrollComp(this),this.addManagedListener(this.eventService,Events.EVENT_ROW_CONTAINER_HEIGHT_CHANGED,this.onRowContainerHeightChanged.bind(this))},t.prototype.setScrollVisible=function(){var e=this.scrollVisibleService.isVerticalScrollShowing(),r=this.invisibleScrollbar,o=e&&this.gridOptionsService.getScrollbarWidth()||0,s=o===0&&r?16:o;this.addOrRemoveCssClass("ag-scrollbar-invisible",r),setFixedWidth(this.getGui(),s),setFixedWidth(this.eViewport,s),setFixedWidth(this.eContainer,s),this.setDisplayed(e,{skipAriaHidden:!0})},t.prototype.onRowContainerHeightChanged=function(){var e=this.ctrlsService.getGridBodyCtrl(),r=e.getBodyViewportElement();this.eViewport.scrollTop!=r.scrollTop&&(this.eViewport.scrollTop=r.scrollTop)},t.prototype.getScrollPosition=function(){return this.getViewport().scrollTop},t.prototype.setScrollPosition=function(e){isVisible(this.getViewport())||this.attemptSettingScrollPosition(e),this.getViewport().scrollTop=e},t.TEMPLATE=`<div class="ag-body-vertical-scroll" aria-hidden="true">
            <div class="ag-body-vertical-scroll-viewport" ref="eViewport">
                <div class="ag-body-vertical-scroll-container" ref="eContainer"></div>
            </div>
        </div>`,__decorate$e([PostConstruct],t.prototype,"postConstruct",null),t}(AbstractFakeScrollComp),__extends$e=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__assign=function(){return __assign=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},__assign.apply(this,arguments)},__decorate$d=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__read$4=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray$3=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n},MONTH_LOCALE_TEXT={january:"January",february:"February",march:"March",april:"April",may:"May",june:"June",july:"July",august:"August",september:"September",october:"October",november:"November",december:"December"},MONTH_KEYS=["january","february","march","april","may","june","july","august","september","october","november","december"],DataTypeService=function(n){__extends$e(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.dataTypeDefinitions={},e.isWaitingForRowData=!1,e.isColumnTypeOverrideInDataTypeDefinitions=!1,e.columnStateUpdatesPendingInference={},e.columnStateUpdateListenerDestroyFuncs=[],e}return t.prototype.init=function(){var e=this;this.groupHideOpenParents=this.gridOptionsService.is("groupHideOpenParents"),this.addManagedPropertyListener("groupHideOpenParents",function(){e.groupHideOpenParents=e.gridOptionsService.is("groupHideOpenParents")}),this.processDataTypeDefinitions(),this.addManagedPropertyListener("dataTypeDefinitions",function(){e.processDataTypeDefinitions(),e.columnModel.recreateColumnDefs("gridOptionsChanged")})},t.prototype.processDataTypeDefinitions=function(){var e=this,r,o=this.getDefaultDataTypes();this.dataTypeDefinitions={},Object.entries(o).forEach(function(l){var a=__read$4(l,2),h=a[0],y=a[1];e.dataTypeDefinitions[h]=__assign(__assign({},y),{groupSafeValueFormatter:e.createGroupSafeValueFormatter(y)})});var s=(r=this.gridOptionsService.get("dataTypeDefinitions"))!==null&&r!==void 0?r:{};this.dataTypeMatchers={},Object.entries(s).forEach(function(l){var a=__read$4(l,2),h=a[0],y=a[1],C=e.processDataTypeDefinition(y,s,[h],o);C&&(e.dataTypeDefinitions[h]=C,y.dataTypeMatcher&&(e.dataTypeMatchers[h]=y.dataTypeMatcher))}),this.checkObjectValueHandlers(o),["dateString","text","number","boolean","date"].forEach(function(l){var a=e.dataTypeMatchers[l];a&&delete e.dataTypeMatchers[l],e.dataTypeMatchers[l]=a??o[l].dataTypeMatcher})},t.prototype.mergeDataTypeDefinitions=function(e,r){var o=__assign(__assign({},e),r);return e.columnTypes&&r.columnTypes&&r.appendColumnTypes&&(o.columnTypes=__spreadArray$3(__spreadArray$3([],__read$4(this.convertColumnTypes(e.columnTypes))),__read$4(this.convertColumnTypes(r.columnTypes)))),o},t.prototype.processDataTypeDefinition=function(e,r,o,s){var l,a=e.extendsDataType;if(e.columnTypes&&(this.isColumnTypeOverrideInDataTypeDefinitions=!0),e.extendsDataType===e.baseDataType){var h=s[a];if(!this.validateDataTypeDefinition(e,h,a))return;l=this.mergeDataTypeDefinitions(h,e)}else{if(o.includes(a)){doOnce(function(){return console.warn('AG Grid: Data type definition hierarchies (via the "extendsDataType" property) cannot contain circular references.')},"dataTypeExtendsCircularRef");return}var y=r[a];if(!this.validateDataTypeDefinition(e,y,a))return;var C=this.processDataTypeDefinition(y,r,__spreadArray$3(__spreadArray$3([],__read$4(o)),[a]),s);if(!C)return;l=this.mergeDataTypeDefinitions(C,e)}return __assign(__assign({},l),{groupSafeValueFormatter:this.createGroupSafeValueFormatter(l)})},t.prototype.validateDataTypeDefinition=function(e,r,o){return r?r.baseDataType!==e.baseDataType?(doOnce(function(){return console.warn('AG Grid: The "baseDataType" property of a data type definition must match that of its parent.')},"dataTypeBaseTypesMatch"),!1):!0:(doOnce(function(){return console.warn("AG Grid: The data type definition "+o+" does not exist.")},"dataTypeDefMissing"+o),!1)},t.prototype.createGroupSafeValueFormatter=function(e){var r=this;if(e.valueFormatter)return function(o){var s,l;if(!((s=o.node)===null||s===void 0)&&s.group){var a=o.column.getAggFunc();if(a){if(a==="first"||a==="last")return e.valueFormatter(o);if(e.baseDataType==="number"&&a!=="count"){if(typeof o.value=="number")return e.valueFormatter(o);if(typeof o.value=="object"){if(!o.value)return;if("toNumber"in o.value)return e.valueFormatter(__assign(__assign({},o),{value:o.value.toNumber()}));if("value"in o.value)return e.valueFormatter(__assign(__assign({},o),{value:o.value.value}))}}}return}else if(r.groupHideOpenParents&&o.column.isRowGroupActive())return typeof o.value!="string"||!((l=e.dataTypeMatcher)===null||l===void 0)&&l.call(e,o.value)?e.valueFormatter(o):void 0;return e.valueFormatter(o)}},t.prototype.updateColDefAndGetDataTypeDefinitionColumnType=function(e,r,o){var s=r.cellDataType,l=r.field;if(s===void 0&&(s=e.cellDataType),(s==null||s===!0)&&(s=this.canInferCellDataType(e,r)?this.inferCellDataType(l,o):!1),!s){e.cellDataType=!1;return}var a=this.dataTypeDefinitions[s];if(!a){doOnce(function(){return console.warn('AG Grid: Missing data type definition - "'+s+'"')},"dataTypeMissing"+s);return}return e.cellDataType=s,a.groupSafeValueFormatter&&(e.valueFormatter=a.groupSafeValueFormatter),a.valueParser&&(e.valueParser=a.valueParser),a.suppressDefaultProperties||this.setColDefPropertiesForBaseDataType(e,a,o),a.columnTypes},t.prototype.updateColDefAndGetColumnType=function(e,r,o){var s,l,a=this.updateColDefAndGetDataTypeDefinitionColumnType(e,r,o),h=(l=(s=r.type)!==null&&s!==void 0?s:a)!==null&&l!==void 0?l:e.type;return e.type=h,h?this.convertColumnTypes(h):void 0},t.prototype.addColumnListeners=function(e){if(this.isWaitingForRowData){var r=this.columnStateUpdatesPendingInference[e.getColId()];if(r){var o=function(s){r.add(s.key)};e.addEventListener(Column.EVENT_STATE_UPDATED,o),this.columnStateUpdateListenerDestroyFuncs.push(function(){return e.removeEventListener(Column.EVENT_STATE_UPDATED,o)})}}},t.prototype.canInferCellDataType=function(e,r){var o=this,s;if(this.rowModel.getType()!=="clientSide")return!1;var l={cellRenderer:!0,valueGetter:!0,valueParser:!0,refData:!0};if(this.doColDefPropsPreventInference(r,l))return!1;var a=r.type===null?e.type:r.type;if(a){var h=(s=this.gridOptionsService.get("columnTypes"))!==null&&s!==void 0?s:{},y=this.convertColumnTypes(a).some(function(C){var L=h[C.trim()];return L&&o.doColDefPropsPreventInference(L,l)});if(y)return!1}return!this.doColDefPropsPreventInference(e,l)},t.prototype.doColDefPropsPreventInference=function(e,r){var o=this;return[["cellRenderer","agSparklineCellRenderer"],["valueGetter",void 0],["valueParser",void 0],["refData",void 0]].some(function(s){var l=__read$4(s,2),a=l[0],h=l[1];return o.doesColDefPropPreventInference(e,r,a,h)})},t.prototype.doesColDefPropPreventInference=function(e,r,o,s){if(!r[o])return!1;var l=e[o];return l===null?(r[o]=!1,!1):s===void 0?!!l:l===s},t.prototype.inferCellDataType=function(e,r){var o;if(e){var s,l=this.getInitialData();if(l){var a=e.indexOf(".")>=0&&!this.gridOptionsService.is("suppressFieldDotNotation");s=getValueUsingField(l,e,a)}else this.initWaitForRowData(r);if(s!=null){var h=__read$4((o=Object.entries(this.dataTypeMatchers).find(function(C){var L=__read$4(C,2);L[0];var Y=L[1];return Y(s)}))!==null&&o!==void 0?o:["object"],1),y=h[0];return y}}},t.prototype.getInitialData=function(){var e=this.gridOptionsService.get("rowData");if(e!=null&&e.length)return e[0];if(this.initialData)return this.initialData;var r=this.rowModel.getRootNode().allLeafChildren;return r!=null&&r.length?r[0].data:null},t.prototype.initWaitForRowData=function(e){var r=this;if(this.columnStateUpdatesPendingInference[e]=new Set,!this.isWaitingForRowData){this.isWaitingForRowData=!0;var o=this.isColumnTypeOverrideInDataTypeDefinitions;o&&this.columnModel.queueResizeOperations();var s=this.addManagedListener(this.eventService,Events.EVENT_ROW_DATA_UPDATE_STARTED,function(l){var a=l.firstRowData;a&&(s==null||s(),r.isWaitingForRowData=!1,r.processColumnsPendingInference(a,o),r.columnStateUpdatesPendingInference={},o&&r.columnModel.processResizeOperations())})}},t.prototype.processColumnsPendingInference=function(e,r){var o=this;this.initialData=e;var s=[];this.columnStateUpdateListenerDestroyFuncs.forEach(function(h){return h()}),this.columnStateUpdateListenerDestroyFuncs=[];var l={},a={};Object.entries(this.columnStateUpdatesPendingInference).forEach(function(h){var y=__read$4(h,2),C=y[0],L=y[1],Y=o.columnModel.getGridColumn(C);if(Y){var ze=Y.getColDef();if(o.columnModel.resetColumnDefIntoColumn(Y)){var Bt=Y.getColDef();if(r&&Bt.type&&Bt.type!==ze.type){var Ir=o.getUpdatedColumnState(Y,L);Ir.rowGroup&&Ir.rowGroupIndex==null&&(l[C]=Ir),Ir.pivot&&Ir.pivotIndex==null&&(a[C]=Ir),s.push(Ir)}}}}),r&&s.push.apply(s,__spreadArray$3([],__read$4(this.columnModel.generateColumnStateForRowGroupAndPivotIndexes(l,a)))),s.length&&this.columnModel.applyColumnState({state:s},"cellDataTypeInferred"),this.initialData=null},t.prototype.getUpdatedColumnState=function(e,r){var o=this.columnModel.getColumnStateFromColDef(e);return r.forEach(function(s){delete o[s],s==="rowGroup"?delete o.rowGroupIndex:s==="pivot"&&delete o.pivotIndex}),o},t.prototype.checkObjectValueHandlers=function(e){var r=this.dataTypeDefinitions.object,o=e.object;this.hasObjectValueParser=r.valueParser!==o.valueParser,this.hasObjectValueFormatter=r.valueFormatter!==o.valueFormatter},t.prototype.convertColumnTypes=function(e){var r=[];if(e instanceof Array){var o=e.some(function(s){return typeof s!="string"});o?console.warn("AG Grid: if colDef.type is supplied an array it should be of type 'string[]'"):r=e}else typeof e=="string"?r=e.split(","):console.warn("AG Grid: colDef.type should be of type 'string' | 'string[]'");return r},t.prototype.getDateStringTypeDefinition=function(){return this.dataTypeDefinitions.dateString},t.prototype.getDateParserFunction=function(){return this.getDateStringTypeDefinition().dateParser},t.prototype.getDateFormatterFunction=function(){return this.getDateStringTypeDefinition().dateFormatter},t.prototype.checkType=function(e,r){var o,s=e.getColDef();if(!s.cellDataType||r==null)return!0;var l=(o=this.dataTypeDefinitions[s.cellDataType])===null||o===void 0?void 0:o.dataTypeMatcher;return l?l(r):!0},t.prototype.validateColDef=function(e){e.cellDataType==="object"&&(e.valueFormatter===this.dataTypeDefinitions.object.groupSafeValueFormatter&&!this.hasObjectValueFormatter&&doOnce(function(){return console.warn('AG Grid: Cell data type is "object" but no value formatter has been provided. Please either provide an object data type definition with a value formatter, or set "colDef.valueFormatter"')},"dataTypeObjectValueFormatter"),e.editable&&e.valueParser===this.dataTypeDefinitions.object.valueParser&&!this.hasObjectValueParser&&doOnce(function(){return console.warn('AG Grid: Cell data type is "object" but no value parser has been provided. Please either provide an object data type definition with a value parser, or set "colDef.valueParser"')},"dataTypeObjectValueParser"))},t.prototype.setColDefPropertiesForBaseDataType=function(e,r,o){var s=this,l=function(L,Y,ze){var Bt=L.getColDef().valueFormatter;return Bt===r.groupSafeValueFormatter&&(Bt=r.valueFormatter),s.valueFormatterService.formatValue(L,Y,ze,Bt)},a=ModuleRegistry.__isRegistered(ModuleNames.SetFilterModule,this.context.getGridId()),h=this.localeService.getLocaleTextFunc(),y=function(L){var Y=e.filterParams;e.filterParams=typeof Y=="object"?__assign(__assign({},Y),L):L};switch(e.useValueFormatterForExport=!0,e.useValueParserForImport=!0,r.baseDataType){case"number":{e.cellEditor="agNumberCellEditor",a&&y({comparator:function(L,Y){var ze=L==null?0:parseInt(L),Bt=Y==null?0:parseInt(Y);return ze===Bt?0:ze>Bt?1:-1}});break}case"boolean":{e.cellEditor="agCheckboxCellEditor",e.cellRenderer="agCheckboxCellRenderer",e.suppressKeyboardEvent=function(L){return!!L.colDef.editable&&L.event.key===KeyCode.SPACE},y(a?{valueFormatter:function(L){return exists(L.value)?h(String(L.value),L.value?"True":"False"):h("blanks","(Blanks)")}}:{maxNumConditions:1,filterOptions:["empty",{displayKey:"true",displayName:"True",predicate:function(L,Y){return Y},numberOfInputs:0},{displayKey:"false",displayName:"False",predicate:function(L,Y){return Y===!1},numberOfInputs:0}]});break}case"date":{e.cellEditor="agDateCellEditor",e.keyCreator=function(L){return l(L.column,L.node,L.value)},a&&y({valueFormatter:function(L){var Y=l(L.column,L.node,L.value);return exists(Y)?Y:h("blanks","(Blanks)")},treeList:!0,treeListFormatter:function(L,Y){if(Y===1&&L!=null){var ze=MONTH_KEYS[Number(L)-1];return h(ze,MONTH_LOCALE_TEXT[ze])}return L??h("blanks","(Blanks)")}});break}case"dateString":{e.cellEditor="agDateStringCellEditor",e.keyCreator=function(L){return l(L.column,L.node,L.value)};var C=this.getDateParserFunction();y(a?{valueFormatter:function(L){var Y=l(L.column,L.node,L.value);return exists(Y)?Y:h("blanks","(Blanks)")},treeList:!0,treeListPathGetter:function(L){var Y=C(L??void 0);return Y?[String(Y.getFullYear()),String(Y.getMonth()+1),String(Y.getDate())]:null},treeListFormatter:function(L,Y){if(Y===1&&L!=null){var ze=MONTH_KEYS[Number(L)-1];return h(ze,MONTH_LOCALE_TEXT[ze])}return L??h("blanks","(Blanks)")}}:{comparator:function(L,Y){var ze=C(Y);return Y==null||ze<L?-1:ze>L?1:0}});break}case"object":{e.cellEditorParams={useFormatter:!0},e.comparator=function(L,Y){var ze=s.columnModel.getPrimaryColumn(o),Bt=ze==null?void 0:ze.getColDef();if(!ze||!Bt)return 0;var Ir=L==null?"":l(ze,null,L),Wr=Y==null?"":l(ze,null,Y);return Ir===Wr?0:Ir>Wr?1:-1},e.keyCreator=function(L){return l(L.column,L.node,L.value)},a?y({valueFormatter:function(L){var Y=l(L.column,L.node,L.value);return exists(Y)?Y:h("blanks","(Blanks)")}}):e.filterValueGetter=function(L){return l(L.column,L.node,s.valueService.getValue(L.column,L.node))};break}}},t.prototype.getDefaultDataTypes=function(){var e=function(o){return!!o.match("^\\d{4}-\\d{2}-\\d{2}$")},r=this.localeService.getLocaleTextFunc();return{number:{baseDataType:"number",valueParser:function(o){return o.newValue===""?null:Number(o.newValue)},valueFormatter:function(o){return o.value==null?"":typeof o.value!="number"||isNaN(o.value)?r("invalidNumber","Invalid Number"):String(o.value)},dataTypeMatcher:function(o){return typeof o=="number"}},text:{baseDataType:"text",valueParser:function(o){return o.newValue===""?null:toStringOrNull(o.newValue)},dataTypeMatcher:function(o){return typeof o=="string"}},boolean:{baseDataType:"boolean",valueParser:function(o){return o.newValue===""?null:String(o.newValue).toLowerCase()==="true"},valueFormatter:function(o){return o.value==null?"":String(o.value)},dataTypeMatcher:function(o){return typeof o=="boolean"}},date:{baseDataType:"date",valueParser:function(o){return parseDateTimeFromString(o.newValue==null?null:String(o.newValue))},valueFormatter:function(o){var s;return o.value==null?"":!(o.value instanceof Date)||isNaN(o.value.getTime())?r("invalidDate","Invalid Date"):(s=serialiseDate(o.value,!1))!==null&&s!==void 0?s:""},dataTypeMatcher:function(o){return o instanceof Date}},dateString:{baseDataType:"dateString",dateParser:function(o){var s;return(s=parseDateTimeFromString(o))!==null&&s!==void 0?s:void 0},dateFormatter:function(o){var s;return(s=serialiseDate(o??null,!1))!==null&&s!==void 0?s:void 0},valueParser:function(o){return e(String(o.newValue))?o.newValue:null},valueFormatter:function(o){return e(String(o.value))?o.value:""},dataTypeMatcher:function(o){return typeof o=="string"&&e(o)}},object:{baseDataType:"object",valueParser:function(){return null},valueFormatter:function(o){var s;return(s=toStringOrNull(o.value))!==null&&s!==void 0?s:""}}}},__decorate$d([Autowired("rowModel")],t.prototype,"rowModel",void 0),__decorate$d([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$d([Autowired("columnUtils")],t.prototype,"columnUtils",void 0),__decorate$d([Autowired("valueService")],t.prototype,"valueService",void 0),__decorate$d([Autowired("valueFormatterService")],t.prototype,"valueFormatterService",void 0),__decorate$d([PostConstruct],t.prototype,"init",null),t=__decorate$d([Bean("dataTypeService")],t),t}(BeanStub),__extends$d=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$c=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},ValueParserService=function(n){__extends$d(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.parseValue=function(e,r,o,s){var l=e.getColDef(),a={node:r,data:r==null?void 0:r.data,oldValue:s,newValue:o,colDef:l,column:e,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context},h=l.valueParser;return exists(h)?typeof h=="function"?h(a):this.expressionService.evaluate(h,a):o},__decorate$c([Autowired("expressionService")],t.prototype,"expressionService",void 0),t=__decorate$c([Bean("valueParserService")],t),t}(BeanStub),__read$3=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray$2=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n},Grid=function(){function n(t,e,r){if(!e){console.error("AG Grid: no gridOptions provided to the grid");return}this.gridOptions=e,new GridCoreCreator().create(t,e,function(o){var s=new GridComp(t);o.createBean(s)},void 0,r)}return n.prototype.destroy=function(){this.gridOptions&&this.gridOptions.api&&this.gridOptions.api.destroy()},n}(),nextGridId=1,GridCoreCreator=function(){function n(){}return n.prototype.create=function(t,e,r,o,s){var l=this,a,h=!!e.debug,y=(a=e.gridId)!==null&&a!==void 0?a:String(nextGridId++),C=this.getRegisteredModules(s,y),L=this.createBeansList(e.rowModelType,C,y),Y=this.createProvidedBeans(t,e,s);if(L){var ze={providedBeanInstances:Y,beanClasses:L,debug:h,gridId:y},Bt=new Logger("AG Grid",function(){return e.debug}),Ir=new Logger("Context",function(){return ze.debug}),Wr=new Context(ze,Ir),yi=Wr.getBean("beans");this.registerModuleUserComponents(yi,C),this.registerStackComponents(yi,C),this.registerControllers(yi,C),r(Wr),yi.ctrlsService.whenReady(function(){l.setColumnsAndData(yi),l.dispatchGridReadyEvent(yi);var Bn=ModuleRegistry.__isRegistered(ModuleNames.EnterpriseCoreModule,y);Bt.log("initialised successfully, enterprise = "+Bn)}),o&&o(Wr)}},n.prototype.registerControllers=function(t,e){e.forEach(function(r){r.controllers&&r.controllers.forEach(function(o){return t.ctrlsFactory.register(o)})})},n.prototype.registerStackComponents=function(t,e){var r=this.createAgStackComponentsList(e);t.agStackComponentsRegistry.setupComponents(r)},n.prototype.getRegisteredModules=function(t,e){var r=t?t.modules:null,o=ModuleRegistry.__getRegisteredModules(e),s=[],l={},a=function(h,y,C){var L=function(Y){l[Y.moduleName]||(l[Y.moduleName]=!0,s.push(Y),ModuleRegistry.__register(Y,h,C))};L(y),y.dependantModules&&y.dependantModules.forEach(function(Y){return a(h,Y,C)})};return r&&r.forEach(function(h){return a(!0,h,e)}),o&&o.forEach(function(h){return a(!ModuleRegistry.__isPackageBased(),h,void 0)}),s},n.prototype.registerModuleUserComponents=function(t,e){var r=this.extractModuleEntity(e,function(o){return o.userComponents?o.userComponents:[]});r.forEach(function(o){t.userComponentRegistry.registerDefaultComponent(o.componentName,o.componentClass)})},n.prototype.createProvidedBeans=function(t,e,r){var o=r?r.frameworkOverrides:null;missing(o)&&(o=new VanillaFrameworkOverrides);var s={gridOptions:e,eGridDiv:t,globalEventListener:r?r.globalEventListener:null,frameworkOverrides:o};return r&&r.providedBeanInstances&&Object.assign(s,r.providedBeanInstances),s},n.prototype.createAgStackComponentsList=function(t){var e=[{componentName:"AgCheckbox",componentClass:AgCheckbox},{componentName:"AgRadioButton",componentClass:AgRadioButton},{componentName:"AgToggleButton",componentClass:AgToggleButton},{componentName:"AgInputTextField",componentClass:AgInputTextField},{componentName:"AgInputTextArea",componentClass:AgInputTextArea},{componentName:"AgInputNumberField",componentClass:AgInputNumberField},{componentName:"AgInputDateField",componentClass:AgInputDateField},{componentName:"AgInputRange",componentClass:AgInputRange},{componentName:"AgSelect",componentClass:AgSelect},{componentName:"AgSlider",componentClass:AgSlider},{componentName:"AgGridBody",componentClass:GridBodyComp},{componentName:"AgHeaderRoot",componentClass:GridHeaderComp},{componentName:"AgSortIndicator",componentClass:SortIndicatorComp},{componentName:"AgPagination",componentClass:PaginationComp},{componentName:"AgOverlayWrapper",componentClass:OverlayWrapperComponent},{componentName:"AgGroupComponent",componentClass:AgGroupComponent},{componentName:"AgPanel",componentClass:AgPanel},{componentName:"AgDialog",componentClass:AgDialog},{componentName:"AgRowContainer",componentClass:RowContainerComp},{componentName:"AgFakeHorizontalScroll",componentClass:FakeHScrollComp},{componentName:"AgFakeVerticalScroll",componentClass:FakeVScrollComp}],r=this.extractModuleEntity(t,function(o){return o.agStackComponents?o.agStackComponents:[]});return e=e.concat(r),e},n.prototype.createBeansList=function(t,e,r){t===void 0&&(t="clientSide");var o=e.filter(function(y){return!y.rowModel||y.rowModel===t}),s={clientSide:ModuleNames.ClientSideRowModelModule,infinite:ModuleNames.InfiniteRowModelModule,serverSide:ModuleNames.ServerSideRowModelModule,viewport:ModuleNames.ViewportRowModelModule};if(!s[t]){console.error("AG Grid: could not find row model for rowModelType = "+t);return}if(ModuleRegistry.__assertRegistered(s[t],"rowModelType = '"+t+"'",r)){var l=[Beans,RowPositionUtils,CellPositionUtils,HeaderPositionUtils,PaginationAutoPageSizeService,GridApi,UserComponentRegistry,AgComponentUtils,ComponentMetadataProvider,ResizeObserverService,UserComponentFactory,RowContainerHeightService,HorizontalResizeService,LocaleService,GridOptionsValidator,PinnedRowModel,DragService,DisplayedGroupCreator,EventService,GridOptionsService,PopupService,SelectionService,FilterManager,ColumnModel,HeaderNavigationService,PaginationProxy,RowRenderer,ExpressionService,ColumnFactory,TemplateService,AlignedGridsService,NavigationService,ValueCache,ValueService,LoggerFactory,ColumnUtils,AutoWidthCalculator,StandardMenuFactory,DragAndDropService,ColumnApi,FocusService,MouseEventService,Environment,CellNavigationService,ValueFormatterService,StylingService,ScrollVisibleService,SortController,ColumnHoverService,ColumnAnimationService,SelectableService,AutoGroupColService,ChangeDetectionService,AnimationFrameService,UndoRedoService,AgStackComponentsRegistry,ColumnDefFactory,RowCssClassCalculator,RowNodeBlockLoader,RowNodeSorter,CtrlsService,PinnedWidthService,RowNodeEventThrottle,CtrlsFactory,DataTypeService,ValueParserService],a=this.extractModuleEntity(o,function(y){return y.beans?y.beans:[]});l.push.apply(l,__spreadArray$2([],__read$3(a)));var h=[];return l.forEach(function(y){h.indexOf(y)<0&&h.push(y)}),h}},n.prototype.extractModuleEntity=function(t,e){return[].concat.apply([],__spreadArray$2([],__read$3(t.map(e))))},n.prototype.setColumnsAndData=function(t){var e=t.gridOptionsService.get("columnDefs");t.columnModel.setColumnDefs(e||[],"gridInitializing"),t.rowModel.start()},n.prototype.dispatchGridReadyEvent=function(t){var e={type:Events.EVENT_GRID_READY};t.eventService.dispatchEvent(e)},n}(),BarColumnLabelPlacement;(function(n){n.InsideBase="insideBase",n.InsideEnd="insideEnd",n.Center="center",n.OutsideEnd="outsideEnd"})(BarColumnLabelPlacement||(BarColumnLabelPlacement={}));/**
 * @ag-grid-community/core - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue
 * @version v30.0.6
 * @link https://www.ag-grid.com/
 * @license MIT
 */var globalObj=typeof global>"u"?{}:global;globalObj.HTMLElement=typeof HTMLElement>"u"?{}:HTMLElement;globalObj.HTMLButtonElement=typeof HTMLButtonElement>"u"?{}:HTMLButtonElement;globalObj.HTMLSelectElement=typeof HTMLSelectElement>"u"?{}:HTMLSelectElement;globalObj.HTMLInputElement=typeof HTMLInputElement>"u"?{}:HTMLInputElement;globalObj.Node=typeof Node>"u"?{}:Node;globalObj.MouseEvent=typeof MouseEvent>"u"?{}:MouseEvent;var __read$2=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray$1=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n},ClientSideNodeManager=function(){function n(t,e,r,o,s,l){this.nextId=0,this.allNodesMap={},this.rootNode=t,this.gridOptionsService=e,this.eventService=r,this.columnModel=o,this.beans=l,this.selectionService=s,this.rootNode.group=!0,this.rootNode.level=-1,this.rootNode.id=n.ROOT_NODE_ID,this.rootNode.allLeafChildren=[],this.rootNode.childrenAfterGroup=[],this.rootNode.childrenAfterSort=[],this.rootNode.childrenAfterAggFilter=[],this.rootNode.childrenAfterFilter=[],this.postConstruct()}return n.prototype.postConstruct=function(){this.suppressParentsInRowNodes=this.gridOptionsService.is("suppressParentsInRowNodes"),this.isRowMasterFunc=this.gridOptionsService.get("isRowMaster"),this.doingTreeData=this.gridOptionsService.isTreeData(),this.doingMasterDetail=this.gridOptionsService.isMasterDetail()},n.prototype.getCopyOfNodesMap=function(){return _.cloneObject(this.allNodesMap)},n.prototype.getRowNode=function(t){return this.allNodesMap[t]},n.prototype.setRowData=function(t){var e=this;if(typeof t=="string"){console.warn("AG Grid: rowData must be an array, however you passed in a string. If you are loading JSON, make sure you convert the JSON string to JavaScript objects first");return}this.dispatchRowDataUpdateStartedEvent(t);var r=this.rootNode,o=this.rootNode.sibling;r.childrenAfterFilter=null,r.childrenAfterGroup=null,r.childrenAfterAggFilter=null,r.childrenAfterSort=null,r.childrenMapped=null,r.updateHasChildren(),this.nextId=0,this.allNodesMap={},t?r.allLeafChildren=t.map(function(s){return e.createNode(s,e.rootNode,n.TOP_LEVEL)}):(r.allLeafChildren=[],r.childrenAfterGroup=[]),o&&(o.childrenAfterFilter=r.childrenAfterFilter,o.childrenAfterGroup=r.childrenAfterGroup,o.childrenAfterAggFilter=r.childrenAfterAggFilter,o.childrenAfterSort=r.childrenAfterSort,o.childrenMapped=r.childrenMapped,o.allLeafChildren=r.allLeafChildren)},n.prototype.updateRowData=function(t,e){this.dispatchRowDataUpdateStartedEvent(t.add);var r={remove:[],update:[],add:[]},o=[];return this.executeRemove(t,r,o),this.executeUpdate(t,r,o),this.executeAdd(t,r),this.updateSelection(o,"rowDataChanged"),e&&_.sortRowNodesByOrder(this.rootNode.allLeafChildren,e),r},n.prototype.dispatchRowDataUpdateStartedEvent=function(t){var e={type:Events.EVENT_ROW_DATA_UPDATE_STARTED,firstRowData:t!=null&&t.length?t[0]:null};this.eventService.dispatchEvent(e)},n.prototype.updateSelection=function(t,e){var r=t.length>0;if(r&&this.selectionService.setNodesSelected({newValue:!1,nodes:t,suppressFinishActions:!0,source:e}),this.selectionService.updateGroupsFromChildrenSelections(e),r){var o={type:Events.EVENT_SELECTION_CHANGED,source:e};this.eventService.dispatchEvent(o)}},n.prototype.executeAdd=function(t,e){var r=this,o,s=t.add,l=t.addIndex;if(!_.missingOrEmpty(s)){var a=s.map(function(Bt){return r.createNode(Bt,r.rootNode,n.TOP_LEVEL)});if(typeof l=="number"&&l>=0){var h=this.rootNode.allLeafChildren,y=h.length,C=l;if(this.doingTreeData&&l>0&&y>0){for(var L=0;L<y;L++)if(((o=h[L])===null||o===void 0?void 0:o.rowIndex)==l-1){C=L+1;break}}var Y=h.slice(0,C),ze=h.slice(C,h.length);this.rootNode.allLeafChildren=__spreadArray$1(__spreadArray$1(__spreadArray$1([],__read$2(Y)),__read$2(a)),__read$2(ze))}else this.rootNode.allLeafChildren=__spreadArray$1(__spreadArray$1([],__read$2(this.rootNode.allLeafChildren)),__read$2(a));this.rootNode.sibling&&(this.rootNode.sibling.allLeafChildren=this.rootNode.allLeafChildren),e.add=a}},n.prototype.executeRemove=function(t,e,r){var o=this,s=t.remove;if(!_.missingOrEmpty(s)){var l={};s.forEach(function(a){var h=o.lookupRowNode(a);h&&(h.isSelected()&&r.push(h),h.clearRowTopAndRowIndex(),l[h.id]=!0,delete o.allNodesMap[h.id],e.remove.push(h))}),this.rootNode.allLeafChildren=this.rootNode.allLeafChildren.filter(function(a){return!l[a.id]}),this.rootNode.sibling&&(this.rootNode.sibling.allLeafChildren=this.rootNode.allLeafChildren)}},n.prototype.executeUpdate=function(t,e,r){var o=this,s=t.update;_.missingOrEmpty(s)||s.forEach(function(l){var a=o.lookupRowNode(l);a&&(a.updateData(l),!a.selectable&&a.isSelected()&&r.push(a),o.setMasterForRow(a,l,n.TOP_LEVEL,!1),e.update.push(a))})},n.prototype.lookupRowNode=function(t){var e=this.gridOptionsService.getCallback("getRowId"),r;if(e){var o=e({data:t,level:0});if(r=this.allNodesMap[o],!r)return console.error("AG Grid: could not find row id="+o+", data item was not found for this id"),null}else if(r=this.rootNode.allLeafChildren.find(function(s){return s.data===t}),!r)return console.error("AG Grid: could not find data item as object was not found",t),console.error("Consider using getRowId to help the Grid find matching row data"),null;return r||null},n.prototype.createNode=function(t,e,r){var o=new RowNode(this.beans);return o.group=!1,this.setMasterForRow(o,t,r,!0),e&&!this.suppressParentsInRowNodes&&(o.parent=e),o.level=r,o.setDataAndId(t,this.nextId.toString()),this.allNodesMap[o.id]&&console.warn("AG Grid: duplicate node id '"+o.id+"' detected from getRowId callback, this could cause issues in your grid."),this.allNodesMap[o.id]=o,this.nextId++,o},n.prototype.setMasterForRow=function(t,e,r,o){if(this.doingTreeData)t.setMaster(!1),o&&(t.expanded=!1);else if(this.doingMasterDetail?this.isRowMasterFunc?t.setMaster(this.isRowMasterFunc(e)):t.setMaster(!0):t.setMaster(!1),o){var s=this.columnModel.getRowGroupColumns(),l=s?s.length:0,a=r+l;t.expanded=t.master?this.isExpanded(a):!1}},n.prototype.isExpanded=function(t){var e=this.gridOptionsService.getNum("groupDefaultExpanded");return e===-1?!0:t<e},n.TOP_LEVEL=0,n.ROOT_NODE_ID="ROOT_NODE_ID",n}(),__extends$c=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$b=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__read$1=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},__spreadArray=function(n,t){for(var e=0,r=t.length,o=n.length;e<r;e++,o++)n[o]=t[e];return n},RecursionType;(function(n){n[n.Normal=0]="Normal",n[n.AfterFilter=1]="AfterFilter",n[n.AfterFilterAndSort=2]="AfterFilterAndSort",n[n.PivotNodes=3]="PivotNodes"})(RecursionType||(RecursionType={}));var ClientSideRowModel=function(n){__extends$c(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.onRowHeightChanged_debounced=_.debounce(e.onRowHeightChanged.bind(e),100),e.rowsToDisplay=[],e}return t.prototype.init=function(){var e=this.refreshModel.bind(this,{step:ClientSideRowModelSteps.EVERYTHING}),r=!this.gridOptionsService.is("suppressAnimationFrame"),o=this.refreshModel.bind(this,{step:ClientSideRowModelSteps.EVERYTHING,afterColumnsChanged:!0,keepRenderedRows:!0,animate:r});this.addManagedListener(this.eventService,Events.EVENT_NEW_COLUMNS_LOADED,o),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_ROW_GROUP_CHANGED,e),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_VALUE_CHANGED,this.onValueChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_PIVOT_CHANGED,this.refreshModel.bind(this,{step:ClientSideRowModelSteps.PIVOT})),this.addManagedListener(this.eventService,Events.EVENT_FILTER_CHANGED,this.onFilterChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_SORT_CHANGED,this.onSortChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_COLUMN_PIVOT_MODE_CHANGED,e),this.addManagedListener(this.eventService,Events.EVENT_GRID_STYLES_CHANGED,this.onGridStylesChanges.bind(this));var s=this.refreshModel.bind(this,{step:ClientSideRowModelSteps.MAP,keepRenderedRows:!0,animate:r});this.addManagedPropertyListener("groupRemoveSingleChildren",s),this.addManagedPropertyListener("groupRemoveLowestSingleChildren",s),this.rootNode=new RowNode(this.beans),this.nodeManager=new ClientSideNodeManager(this.rootNode,this.gridOptionsService,this.eventService,this.columnModel,this.selectionService,this.beans)},t.prototype.start=function(){var e=this.gridOptionsService.get("rowData");e&&this.setRowData(e)},t.prototype.ensureRowHeightsValid=function(e,r,o,s){var l,a=!1;do{l=!1;for(var h=this.getRowIndexAtPixel(e),y=this.getRowIndexAtPixel(r),C=Math.max(h,o),L=Math.min(y,s),Y=C;Y<=L;Y++){var ze=this.getRow(Y);if(ze.rowHeightEstimated){var Bt=this.gridOptionsService.getRowHeightForNode(ze);ze.setRowHeight(Bt.height),l=!0,a=!0}}l&&this.setRowTopAndRowIndex()}while(l);return a},t.prototype.setRowTopAndRowIndex=function(){for(var e=this.environment.getDefaultRowHeight(),r=0,o=new Set,s=this.gridOptionsService.isDomLayout("normal"),l=0;l<this.rowsToDisplay.length;l++){var a=this.rowsToDisplay[l];if(a.id!=null&&o.add(a.id),a.rowHeight==null){var h=this.gridOptionsService.getRowHeightForNode(a,s,e);a.setRowHeight(h.height,h.estimated)}a.setRowTop(r),a.setRowIndex(l),r+=a.rowHeight}return o},t.prototype.clearRowTopAndRowIndex=function(e,r){var o=e.isActive(),s=function(a){a&&a.id!=null&&!r.has(a.id)&&a.clearRowTopAndRowIndex()},l=function(a){if(s(a),s(a.detailNode),s(a.sibling),a.hasChildren()&&a.childrenAfterGroup){var h=a.level==-1,y=o&&!h&&!a.expanded;y||a.childrenAfterGroup.forEach(l)}};l(this.rootNode)},t.prototype.ensureRowsAtPixel=function(e,r,o){var s=this;o===void 0&&(o=0);var l=this.getRowIndexAtPixel(r),a=this.getRow(l),h=!this.gridOptionsService.is("suppressAnimationFrame");return a===e[0]?!1:(e.forEach(function(y){_.removeFromArray(s.rootNode.allLeafChildren,y)}),e.forEach(function(y,C){_.insertIntoArray(s.rootNode.allLeafChildren,y,Math.max(l+o,0)+C)}),this.refreshModel({step:ClientSideRowModelSteps.EVERYTHING,keepRenderedRows:!0,keepEditingRows:!0,animate:h}),!0)},t.prototype.highlightRowAtPixel=function(e,r){var o=r!=null?this.getRowIndexAtPixel(r):null,s=o!=null?this.getRow(o):null;if(!s||!e||s===e||r==null){this.lastHighlightedRow&&(this.lastHighlightedRow.setHighlighted(null),this.lastHighlightedRow=null);return}var l=this.getHighlightPosition(r,s);this.lastHighlightedRow&&this.lastHighlightedRow!==s&&(this.lastHighlightedRow.setHighlighted(null),this.lastHighlightedRow=null),s.setHighlighted(l),this.lastHighlightedRow=s},t.prototype.getHighlightPosition=function(e,r){if(!r){var o=this.getRowIndexAtPixel(e);if(r=this.getRow(o||0),!r)return RowHighlightPosition.Below}var s=r.rowTop,l=r.rowHeight;return e-s<l/2?RowHighlightPosition.Above:RowHighlightPosition.Below},t.prototype.getLastHighlightedRowNode=function(){return this.lastHighlightedRow},t.prototype.isLastRowIndexKnown=function(){return!0},t.prototype.getRowCount=function(){return this.rowsToDisplay?this.rowsToDisplay.length:0},t.prototype.getTopLevelRowCount=function(){var e=this.rowsToDisplay&&this.rowsToDisplay[0]===this.rootNode;if(e)return 1;var r=this.rootNode.childrenAfterAggFilter;return r?r.length:0},t.prototype.getTopLevelRowDisplayedIndex=function(e){var r=this.rowsToDisplay&&this.rowsToDisplay[0]===this.rootNode;if(r)return e;var o=this.rootNode.childrenAfterSort[e];if(this.gridOptionsService.is("groupHideOpenParents"))for(;o.expanded&&o.childrenAfterSort&&o.childrenAfterSort.length>0;)o=o.childrenAfterSort[0];return o.rowIndex},t.prototype.getRowBounds=function(e){if(_.missing(this.rowsToDisplay))return null;var r=this.rowsToDisplay[e];return r?{rowTop:r.rowTop,rowHeight:r.rowHeight}:null},t.prototype.onRowGroupOpened=function(){var e=this.gridOptionsService.isAnimateRows();this.refreshModel({step:ClientSideRowModelSteps.MAP,keepRenderedRows:!0,animate:e})},t.prototype.onFilterChanged=function(e){if(!e.afterDataChange){var r=this.gridOptionsService.isAnimateRows(),o=e.columns.length===0||e.columns.some(function(l){return l.isPrimary()}),s=o?ClientSideRowModelSteps.FILTER:ClientSideRowModelSteps.FILTER_AGGREGATES;this.refreshModel({step:s,keepRenderedRows:!0,animate:r})}},t.prototype.onSortChanged=function(){var e=this.gridOptionsService.isAnimateRows();this.refreshModel({step:ClientSideRowModelSteps.SORT,keepRenderedRows:!0,animate:e,keepEditingRows:!0})},t.prototype.getType=function(){return"clientSide"},t.prototype.onValueChanged=function(){this.columnModel.isPivotActive()?this.refreshModel({step:ClientSideRowModelSteps.PIVOT}):this.refreshModel({step:ClientSideRowModelSteps.AGGREGATE})},t.prototype.createChangePath=function(e){var r=_.missingOrEmpty(e),o=new ChangedPath(!1,this.rootNode);return(r||this.gridOptionsService.isTreeData())&&o.setInactive(),o},t.prototype.isSuppressModelUpdateAfterUpdateTransaction=function(e){if(!this.gridOptionsService.is("suppressModelUpdateAfterUpdateTransaction")||e.rowNodeTransactions==null)return!1;var r=e.rowNodeTransactions.filter(function(s){return s.add!=null&&s.add.length>0||s.remove!=null&&s.remove.length>0}),o=r==null||r.length==0;return o},t.prototype.buildRefreshModelParams=function(e){var r=ClientSideRowModelSteps.EVERYTHING,o={everything:ClientSideRowModelSteps.EVERYTHING,group:ClientSideRowModelSteps.EVERYTHING,filter:ClientSideRowModelSteps.FILTER,map:ClientSideRowModelSteps.MAP,aggregate:ClientSideRowModelSteps.AGGREGATE,sort:ClientSideRowModelSteps.SORT,pivot:ClientSideRowModelSteps.PIVOT};if(_.exists(e)&&(r=o[e]),_.missing(r)){console.error("AG Grid: invalid step "+e+", available steps are "+Object.keys(o).join(", "));return}var s=!this.gridOptionsService.is("suppressAnimationFrame"),l={step:r,keepRenderedRows:!0,keepEditingRows:!0,animate:s};return l},t.prototype.refreshModel=function(e){var r=typeof e=="object"&&"step"in e?e:this.buildRefreshModelParams(e);if(r&&!this.isSuppressModelUpdateAfterUpdateTransaction(r)){var o=this.createChangePath(r.rowNodeTransactions);switch(r.step){case ClientSideRowModelSteps.EVERYTHING:this.doRowGrouping(r.groupState,r.rowNodeTransactions,r.rowNodeOrder,o,!!r.afterColumnsChanged);case ClientSideRowModelSteps.FILTER:this.doFilter(o);case ClientSideRowModelSteps.PIVOT:this.doPivot(o);case ClientSideRowModelSteps.AGGREGATE:this.doAggregate(o);case ClientSideRowModelSteps.FILTER_AGGREGATES:this.doFilterAggregates(o);case ClientSideRowModelSteps.SORT:this.doSort(r.rowNodeTransactions,o);case ClientSideRowModelSteps.MAP:this.doRowsToDisplay()}var s=this.setRowTopAndRowIndex();this.clearRowTopAndRowIndex(o,s);var l={type:Events.EVENT_MODEL_UPDATED,animate:r.animate,keepRenderedRows:r.keepRenderedRows,newData:r.newData,newPage:!1,keepUndoRedoStack:r.keepUndoRedoStack};this.eventService.dispatchEvent(l)}},t.prototype.isEmpty=function(){var e=_.missing(this.rootNode.allLeafChildren)||this.rootNode.allLeafChildren.length===0;return _.missing(this.rootNode)||e||!this.columnModel.isReady()},t.prototype.isRowsToRender=function(){return _.exists(this.rowsToDisplay)&&this.rowsToDisplay.length>0},t.prototype.getNodesInRangeForSelection=function(e,r){var o=!r,s=!1,l=[],a=this.gridOptionsService.is("groupSelectsChildren");return this.forEachNodeAfterFilterAndSort(function(h){if(!s){if(o&&(h===r||h===e)&&(s=!0,h.group&&a)){l.push.apply(l,__spreadArray([],__read$1(h.allLeafChildren)));return}if(!o){if(h!==r&&h!==e)return;o=!0}var y=!h.group||!a;if(y){l.push(h);return}}}),l},t.prototype.setDatasource=function(e){console.error("AG Grid: should never call setDatasource on clientSideRowController")},t.prototype.getTopLevelNodes=function(){return this.rootNode?this.rootNode.childrenAfterGroup:null},t.prototype.getRootNode=function(){return this.rootNode},t.prototype.getRow=function(e){return this.rowsToDisplay[e]},t.prototype.isRowPresent=function(e){return this.rowsToDisplay.indexOf(e)>=0},t.prototype.getRowIndexAtPixel=function(e){if(this.isEmpty()||this.rowsToDisplay.length===0)return-1;var r=0,o=this.rowsToDisplay.length-1;if(e<=0)return 0;var s=_.last(this.rowsToDisplay);if(s.rowTop<=e)return this.rowsToDisplay.length-1;for(var l=-1,a=-1;;){var h=Math.floor((r+o)/2),y=this.rowsToDisplay[h];if(this.isRowInPixel(y,e))return h;y.rowTop<e?r=h+1:y.rowTop>e&&(o=h-1);var C=l===r&&a===o;if(C)return h;l=r,a=o}},t.prototype.isRowInPixel=function(e,r){var o=e.rowTop,s=e.rowTop+e.rowHeight,l=o<=r&&s>r;return l},t.prototype.forEachLeafNode=function(e){this.rootNode.allLeafChildren&&this.rootNode.allLeafChildren.forEach(function(r,o){return e(r,o)})},t.prototype.forEachNode=function(e,r){r===void 0&&(r=!1),this.recursivelyWalkNodesAndCallback({nodes:__spreadArray([],__read$1(this.rootNode.childrenAfterGroup||[])),callback:e,recursionType:RecursionType.Normal,index:0,includeFooterNodes:r})},t.prototype.forEachNodeAfterFilter=function(e,r){r===void 0&&(r=!1),this.recursivelyWalkNodesAndCallback({nodes:__spreadArray([],__read$1(this.rootNode.childrenAfterAggFilter||[])),callback:e,recursionType:RecursionType.AfterFilter,index:0,includeFooterNodes:r})},t.prototype.forEachNodeAfterFilterAndSort=function(e,r){r===void 0&&(r=!1),this.recursivelyWalkNodesAndCallback({nodes:__spreadArray([],__read$1(this.rootNode.childrenAfterSort||[])),callback:e,recursionType:RecursionType.AfterFilterAndSort,index:0,includeFooterNodes:r})},t.prototype.forEachPivotNode=function(e,r){r===void 0&&(r=!1),this.recursivelyWalkNodesAndCallback({nodes:[this.rootNode],callback:e,recursionType:RecursionType.PivotNodes,index:0,includeFooterNodes:r})},t.prototype.recursivelyWalkNodesAndCallback=function(e){var r,o=e.nodes,s=e.callback,l=e.recursionType,a=e.includeFooterNodes,h=e.index,y=o[0];a&&(!((r=y==null?void 0:y.parent)===null||r===void 0)&&r.sibling)&&o.push(y.parent.sibling);for(var C=0;C<o.length;C++){var L=o[C];if(s(L,h++),L.hasChildren()&&!L.footer){var Y=null;switch(l){case RecursionType.Normal:Y=L.childrenAfterGroup;break;case RecursionType.AfterFilter:Y=L.childrenAfterAggFilter;break;case RecursionType.AfterFilterAndSort:Y=L.childrenAfterSort;break;case RecursionType.PivotNodes:Y=L.leafGroup?null:L.childrenAfterSort;break}Y&&(h=this.recursivelyWalkNodesAndCallback({nodes:__spreadArray([],__read$1(Y)),callback:s,recursionType:l,index:h,includeFooterNodes:a}))}}return h},t.prototype.doAggregate=function(e){this.aggregationStage&&this.aggregationStage.execute({rowNode:this.rootNode,changedPath:e})},t.prototype.doFilterAggregates=function(e){this.filterAggregatesStage?this.filterAggregatesStage.execute({rowNode:this.rootNode,changedPath:e}):this.rootNode.childrenAfterAggFilter=this.rootNode.childrenAfterFilter},t.prototype.expandOrCollapseAll=function(e){var r=this.gridOptionsService.isTreeData(),o=this.columnModel.isPivotActive(),s=function(h){h&&h.forEach(function(y){var C=function(){y.expanded=e,s(y.childrenAfterGroup)};if(r){var L=_.exists(y.childrenAfterGroup);L&&C();return}if(o){var Y=!y.leafGroup;Y&&C();return}var ze=y.group;ze&&C()})};this.rootNode&&s(this.rootNode.childrenAfterGroup),this.refreshModel({step:ClientSideRowModelSteps.MAP});var l=e?"expandAll":"collapseAll",a={type:Events.EVENT_EXPAND_COLLAPSE_ALL,source:l};this.eventService.dispatchEvent(a)},t.prototype.doSort=function(e,r){this.sortStage.execute({rowNode:this.rootNode,rowNodeTransactions:e,changedPath:r})},t.prototype.doRowGrouping=function(e,r,o,s,l){if(this.groupStage){if(r?this.groupStage.execute({rowNode:this.rootNode,rowNodeTransactions:r,rowNodeOrder:o,changedPath:s}):(this.groupStage.execute({rowNode:this.rootNode,changedPath:s,afterColumnsChanged:l}),this.restoreGroupState(e)),this.gridOptionsService.is("groupSelectsChildren")){var a=this.selectionService.updateGroupsFromChildrenSelections("rowGroupChanged",s);if(a){var h={type:Events.EVENT_SELECTION_CHANGED,source:"rowGroupChanged"};this.eventService.dispatchEvent(h)}}}else this.rootNode.childrenAfterGroup=this.rootNode.allLeafChildren,this.rootNode.sibling&&(this.rootNode.sibling.childrenAfterGroup=this.rootNode.childrenAfterGroup),this.rootNode.updateHasChildren()},t.prototype.restoreGroupState=function(e){e&&_.traverseNodesWithKey(this.rootNode.childrenAfterGroup,function(r,o){typeof e[o]=="boolean"&&(r.expanded=e[o])})},t.prototype.doFilter=function(e){this.filterStage.execute({rowNode:this.rootNode,changedPath:e})},t.prototype.doPivot=function(e){this.pivotStage&&this.pivotStage.execute({rowNode:this.rootNode,changedPath:e})},t.prototype.getGroupState=function(){if(!this.rootNode.childrenAfterGroup||!this.gridOptionsService.is("rememberGroupStateWhenNewData"))return null;var e={};return _.traverseNodesWithKey(this.rootNode.childrenAfterGroup,function(r,o){return e[o]=r.expanded}),e},t.prototype.getCopyOfNodesMap=function(){return this.nodeManager.getCopyOfNodesMap()},t.prototype.getRowNode=function(e){var r=typeof e=="string"&&e.indexOf(RowNode.ID_PREFIX_ROW_GROUP)==0;if(r){var o=void 0;return this.forEachNode(function(s){s.id===e&&(o=s)}),o}return this.nodeManager.getRowNode(e)},t.prototype.setRowData=function(e){var r=this.getGroupState();this.nodeManager.setRowData(e),this.selectionService.reset(),this.filterManager.onNewRowsLoaded("rowDataUpdated");var o={type:Events.EVENT_ROW_DATA_UPDATED};this.eventService.dispatchEvent(o),this.refreshModel({step:ClientSideRowModelSteps.EVERYTHING,groupState:r,newData:!0})},t.prototype.batchUpdateRowData=function(e,r){var o=this;if(this.applyAsyncTransactionsTimeout==null){this.rowDataTransactionBatch=[];var s=this.gridOptionsService.getAsyncTransactionWaitMillis();this.applyAsyncTransactionsTimeout=window.setTimeout(function(){o.executeBatchUpdateRowData()},s)}this.rowDataTransactionBatch.push({rowDataTransaction:e,callback:r})},t.prototype.flushAsyncTransactions=function(){this.applyAsyncTransactionsTimeout!=null&&(clearTimeout(this.applyAsyncTransactionsTimeout),this.executeBatchUpdateRowData())},t.prototype.executeBatchUpdateRowData=function(){var e=this;this.valueCache.onDataChanged();var r=[],o=[],s=!1;if(this.rowDataTransactionBatch&&this.rowDataTransactionBatch.forEach(function(a){var h=e.nodeManager.updateRowData(a.rowDataTransaction,void 0);o.push(h),a.callback&&r.push(a.callback.bind(null,h)),typeof a.rowDataTransaction.addIndex=="number"&&(s=!0)}),this.commonUpdateRowData(o,void 0,s),r.length>0&&window.setTimeout(function(){r.forEach(function(a){return a()})},0),o.length>0){var l={type:Events.EVENT_ASYNC_TRANSACTIONS_FLUSHED,results:o};this.eventService.dispatchEvent(l)}this.rowDataTransactionBatch=null,this.applyAsyncTransactionsTimeout=void 0},t.prototype.updateRowData=function(e,r){this.valueCache.onDataChanged();var o=this.nodeManager.updateRowData(e,r),s=typeof e.addIndex=="number";return this.commonUpdateRowData([o],r,s),o},t.prototype.createRowNodeOrder=function(){var e=this.gridOptionsService.is("suppressMaintainUnsortedOrder");if(!e){var r={};if(this.rootNode&&this.rootNode.allLeafChildren)for(var o=0;o<this.rootNode.allLeafChildren.length;o++){var s=this.rootNode.allLeafChildren[o];r[s.id]=o}return r}},t.prototype.commonUpdateRowData=function(e,r,o){var s=!this.gridOptionsService.is("suppressAnimationFrame");o&&(r=this.createRowNodeOrder()),this.refreshModel({step:ClientSideRowModelSteps.EVERYTHING,rowNodeTransactions:e,rowNodeOrder:r,keepRenderedRows:!0,keepEditingRows:!0,animate:s}),this.filterManager.onNewRowsLoaded("rowDataUpdated");var l={type:Events.EVENT_ROW_DATA_UPDATED};this.eventService.dispatchEvent(l)},t.prototype.doRowsToDisplay=function(){this.rowsToDisplay=this.flattenStage.execute({rowNode:this.rootNode})},t.prototype.onRowHeightChanged=function(){this.refreshModel({step:ClientSideRowModelSteps.MAP,keepRenderedRows:!0,keepEditingRows:!0,keepUndoRedoStack:!0})},t.prototype.onRowHeightChangedDebounced=function(){this.onRowHeightChanged_debounced()},t.prototype.resetRowHeights=function(){var e=this.resetRowHeightsForAllRowNodes();this.rootNode.setRowHeight(this.rootNode.rowHeight,!0),e&&this.onRowHeightChanged()},t.prototype.resetRowHeightsForAllRowNodes=function(){var e=!1;return this.forEachNode(function(r){r.setRowHeight(r.rowHeight,!0);var o=r.detailNode;o&&o.setRowHeight(o.rowHeight,!0),e=!0}),e},t.prototype.onGridStylesChanges=function(){this.columnModel.isAutoRowHeightActive()||this.resetRowHeights()},__decorate$b([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$b([Autowired("selectionService")],t.prototype,"selectionService",void 0),__decorate$b([Autowired("filterManager")],t.prototype,"filterManager",void 0),__decorate$b([Autowired("valueCache")],t.prototype,"valueCache",void 0),__decorate$b([Autowired("beans")],t.prototype,"beans",void 0),__decorate$b([Autowired("filterStage")],t.prototype,"filterStage",void 0),__decorate$b([Autowired("sortStage")],t.prototype,"sortStage",void 0),__decorate$b([Autowired("flattenStage")],t.prototype,"flattenStage",void 0),__decorate$b([Optional("groupStage")],t.prototype,"groupStage",void 0),__decorate$b([Optional("aggregationStage")],t.prototype,"aggregationStage",void 0),__decorate$b([Optional("pivotStage")],t.prototype,"pivotStage",void 0),__decorate$b([Optional("filterAggregatesStage")],t.prototype,"filterAggregatesStage",void 0),__decorate$b([PostConstruct],t.prototype,"init",null),t=__decorate$b([Bean("rowModel")],t),t}(BeanStub),__extends$b=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$a=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},FilterStage=function(n){__extends$b(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.execute=function(e){var r=e.changedPath;this.filterService.filter(r)},__decorate$a([Autowired("filterService")],t.prototype,"filterService",void 0),t=__decorate$a([Bean("filterStage")],t),t}(BeanStub),__extends$a=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$9=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},SortStage=function(n){__extends$a(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.execute=function(e){var r=this,o=this.sortController.getSortOptions(),s=_.exists(o)&&o.length>0,l=s&&_.exists(e.rowNodeTransactions)&&this.gridOptionsService.is("deltaSort"),a=o.some(function(h){return!!r.columnModel.getGroupDisplayColumnForGroup(h.column.getId())});this.sortService.sort(o,s,l,e.rowNodeTransactions,e.changedPath,a)},__decorate$9([Autowired("sortService")],t.prototype,"sortService",void 0),__decorate$9([Autowired("sortController")],t.prototype,"sortController",void 0),__decorate$9([Autowired("columnModel")],t.prototype,"columnModel",void 0),t=__decorate$9([Bean("sortStage")],t),t}(BeanStub),__extends$9=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$8=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},FlattenStage=function(n){__extends$9(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.execute=function(e){var r=e.rowNode,o=[],s={value:0},l=this.columnModel.isPivotMode(),a=l&&r.leafGroup,h=a?[r]:r.childrenAfterSort;this.recursivelyAddToRowsToDisplay(h,o,s,l,0);var y=o.length>0,C=!a&&y&&this.gridOptionsService.is("groupIncludeTotalFooter");return C&&(r.createFooter(),this.addRowNodeToRowsToDisplay(r.sibling,o,s,0)),o},t.prototype.recursivelyAddToRowsToDisplay=function(e,r,o,s,l){if(!_.missingOrEmpty(e))for(var a=this.gridOptionsService.is("groupHideOpenParents"),h=this.gridOptionsService.is("groupRemoveSingleChildren"),y=!h&&this.gridOptionsService.is("groupRemoveLowestSingleChildren"),C=0;C<e.length;C++){var L=e[C],Y=L.hasChildren(),ze=s&&!Y,Bt=h&&Y&&L.childrenAfterGroup.length===1,Ir=y&&Y&&L.leafGroup&&L.childrenAfterGroup.length===1,Wr=s&&L.leafGroup,yi=a&&L.expanded&&!L.master&&!Wr,Bn=!ze&&!yi&&!Bt&&!Ir;if(Bn&&this.addRowNodeToRowsToDisplay(L,r,o,l),!(s&&L.leafGroup)){if(Y){var vi=Bt||Ir;if(L.expanded||vi){var wo=vi?l:l+1;this.recursivelyAddToRowsToDisplay(L.childrenAfterSort,r,o,s,wo),this.gridOptionsService.is("groupIncludeFooter")&&this.addRowNodeToRowsToDisplay(L.sibling,r,o,wo)}}else if(L.master&&L.expanded){var ia=this.createDetailNode(L);this.addRowNodeToRowsToDisplay(ia,r,o,l)}}}},t.prototype.addRowNodeToRowsToDisplay=function(e,r,o,s){var l=this.gridOptionsService.isGroupMultiAutoColumn();r.push(e),e.setUiLevel(l?0:s)},t.prototype.createDetailNode=function(e){if(_.exists(e.detailNode))return e.detailNode;var r=new RowNode(this.beans);return r.detail=!0,r.selectable=!1,r.parent=e,_.exists(e.id)&&(r.id="detail_"+e.id),r.data=e.data,r.level=e.level+1,e.detailNode=r,r},__decorate$8([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$8([Autowired("beans")],t.prototype,"beans",void 0),t=__decorate$8([Bean("flattenStage")],t),t}(BeanStub),__extends$8=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$7=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},SortService=function(n){__extends$8(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.init=function(){this.postSortFunc=this.gridOptionsService.getCallback("postSortRows")},t.prototype.sort=function(e,r,o,s,l,a){var h=this,y=this.gridOptionsService.is("groupMaintainOrder"),C=this.columnModel.getAllGridColumns().some(function(Bt){return Bt.isRowGroupActive()}),L={};o&&s&&(L=this.calculateDirtyNodes(s));var Y=this.columnModel.isPivotMode(),ze=function(Bt){h.pullDownGroupDataForHideOpenParents(Bt.childrenAfterAggFilter,!0);var Ir=Y&&Bt.leafGroup,Wr=y&&C&&!Bt.leafGroup&&!a;if(Wr){var yi=Bt.childrenAfterAggFilter.slice(0);if(Bt.childrenAfterSort){var Bn={};Bt.childrenAfterSort.forEach(function(wo,ia){Bn[wo.id]=ia}),yi.sort(function(wo,ia){var gl,ml;return((gl=Bn[wo.id])!==null&&gl!==void 0?gl:0)-((ml=Bn[ia.id])!==null&&ml!==void 0?ml:0)})}Bt.childrenAfterSort=yi}else!r||Ir?Bt.childrenAfterSort=Bt.childrenAfterAggFilter.slice(0):o?Bt.childrenAfterSort=h.doDeltaSort(Bt,L,l,e):Bt.childrenAfterSort=h.rowNodeSorter.doFullSort(Bt.childrenAfterAggFilter,e);if(Bt.sibling&&(Bt.sibling.childrenAfterSort=Bt.childrenAfterSort),h.updateChildIndexes(Bt),h.postSortFunc){var vi={nodes:Bt.childrenAfterSort};h.postSortFunc(vi)}};l&&l.forEachChangedNodeDepthFirst(ze),this.updateGroupDataForHideOpenParents(l)},t.prototype.calculateDirtyNodes=function(e){var r={},o=function(s){s&&s.forEach(function(l){return r[l.id]=!0})};return e&&e.forEach(function(s){o(s.add),o(s.update),o(s.remove)}),r},t.prototype.doDeltaSort=function(e,r,o,s){var l=this,a=e.childrenAfterAggFilter,h=e.childrenAfterSort;if(!h)return this.rowNodeSorter.doFullSort(a,s);var y={},C=[];a.forEach(function(Bt){r[Bt.id]||!o.canSkip(Bt)?C.push(Bt):y[Bt.id]=!0});var L=h.filter(function(Bt){return y[Bt.id]}),Y=function(Bt,Ir){return{currentPos:Ir,rowNode:Bt}},ze=C.map(Y).sort(function(Bt,Ir){return l.rowNodeSorter.compareRowNodes(s,Bt,Ir)});return this.mergeSortedArrays(s,ze,L.map(Y)).map(function(Bt){var Ir=Bt.rowNode;return Ir})},t.prototype.mergeSortedArrays=function(e,r,o){for(var s=[],l=0,a=0;l<r.length&&a<o.length;){var h=this.rowNodeSorter.compareRowNodes(e,r[l],o[a]);h<0?s.push(r[l++]):s.push(o[a++])}for(;l<r.length;)s.push(r[l++]);for(;a<o.length;)s.push(o[a++]);return s},t.prototype.updateChildIndexes=function(e){if(!_.missing(e.childrenAfterSort))for(var r=e.childrenAfterSort,o=0;o<r.length;o++){var s=r[o],l=o===0,a=o===e.childrenAfterSort.length-1;s.setFirstChild(l),s.setLastChild(a),s.setChildIndex(o)}},t.prototype.updateGroupDataForHideOpenParents=function(e){var r=this;if(this.gridOptionsService.is("groupHideOpenParents")){if(this.gridOptionsService.isTreeData()){var o="AG Grid: The property hideOpenParents dose not work with Tree Data. This is because Tree Data has values at the group level, it doesn't make sense to hide them (as opposed to Row Grouping, which only has Aggregated Values at the group level).";return _.doOnce(function(){return console.warn(o)},"sortService.hideOpenParentsWithTreeData"),!1}var s=function(l){r.pullDownGroupDataForHideOpenParents(l.childrenAfterSort,!1),l.childrenAfterSort.forEach(function(a){a.hasChildren()&&s(a)})};e&&e.executeFromRootNode(function(l){return s(l)})}},t.prototype.pullDownGroupDataForHideOpenParents=function(e,r){var o=this;!this.gridOptionsService.is("groupHideOpenParents")||_.missing(e)||e.forEach(function(s){var l=o.columnModel.getGroupDisplayColumns();l.forEach(function(a){var h=a.getColDef().showRowGroup;if(typeof h!="string"){console.error("AG Grid: groupHideOpenParents only works when specifying specific columns for colDef.showRowGroup");return}var y=h,C=o.columnModel.getPrimaryColumn(y),L=C===s.rowGroupColumn;if(!L)if(r)s.setGroupValue(a.getId(),void 0);else{var Y=s.getFirstChildOfFirstChild(C);Y&&s.setGroupValue(a.getId(),Y.key)}})})},__decorate$7([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$7([Autowired("rowNodeSorter")],t.prototype,"rowNodeSorter",void 0),__decorate$7([PostConstruct],t.prototype,"init",null),t=__decorate$7([Bean("sortService")],t),t}(BeanStub),__extends$7=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$6=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},FilterService=function(n){__extends$7(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.filter=function(e){var r=this.filterManager.isColumnFilterPresent()||this.filterManager.isQuickFilterPresent()||this.filterManager.isExternalFilterPresent();this.filterNodes(r,e)},t.prototype.filterNodes=function(e,r){var o=this,s=function(y,C){y.hasChildren()&&e&&!C?y.childrenAfterFilter=y.childrenAfterGroup.filter(function(L){var Y=L.childrenAfterFilter&&L.childrenAfterFilter.length>0,ze=L.data&&o.filterManager.doesRowPassFilter({rowNode:L});return Y||ze}):y.childrenAfterFilter=y.childrenAfterGroup,y.sibling&&(y.sibling.childrenAfterFilter=y.childrenAfterFilter)};if(this.doingTreeDataFiltering()){var l=function(y,C){if(y.childrenAfterGroup)for(var L=0;L<y.childrenAfterGroup.length;L++){var Y=y.childrenAfterGroup[L],ze=C||o.filterManager.doesRowPassFilter({rowNode:Y});Y.childrenAfterGroup?l(y.childrenAfterGroup[L],ze):s(Y,ze)}s(y,C)},a=function(y){return l(y,!1)};r.executeFromRootNode(a)}else{var h=function(y){return s(y,!1)};r.forEachChangedNodeDepthFirst(h,!0)}},t.prototype.doingTreeDataFiltering=function(){return this.gridOptionsService.isTreeData()&&!this.gridOptionsService.is("excludeChildrenWhenTreeDataFiltering")},__decorate$6([Autowired("filterManager")],t.prototype,"filterManager",void 0),t=__decorate$6([Bean("filterService")],t),t}(BeanStub),__extends$6=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$5=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__read=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),o,s=[],l;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(a){l={error:a}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return s},ImmutableService=function(n){__extends$6(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.postConstruct=function(){this.rowModel.getType()==="clientSide"&&(this.clientSideRowModel=this.rowModel)},t.prototype.isActive=function(){var e=this.gridOptionsService.exists("getRowId"),r=this.gridOptionsService.is("resetRowDataOnUpdate");return r?!1:e},t.prototype.setRowData=function(e){var r=this.createTransactionForRowData(e);if(r){var o=__read(r,2),s=o[0],l=o[1];this.clientSideRowModel.updateRowData(s,l)}},t.prototype.createTransactionForRowData=function(e){if(_.missing(this.clientSideRowModel)){console.error("AG Grid: ImmutableService only works with ClientSideRowModel");return}var r=this.gridOptionsService.getCallback("getRowId");if(r==null){console.error("AG Grid: ImmutableService requires getRowId() callback to be implemented, your row data needs IDs!");return}var o={remove:[],update:[],add:[]},s=this.clientSideRowModel.getCopyOfNodesMap(),l=this.gridOptionsService.is("suppressMaintainUnsortedOrder"),a=l?void 0:{};return _.exists(e)&&e.forEach(function(h,y){var C=r({data:h,level:0}),L=s[C];if(a&&(a[C]=y),L){var Y=L.data!==h;Y&&o.update.push(h),s[C]=void 0}else o.add.push(h)}),_.iterateObject(s,function(h,y){y&&o.remove.push(y.data)}),[o,a]},__decorate$5([Autowired("rowModel")],t.prototype,"rowModel",void 0),__decorate$5([Autowired("rowRenderer")],t.prototype,"rowRenderer",void 0),__decorate$5([PostConstruct],t.prototype,"postConstruct",null),t=__decorate$5([Bean("immutableService")],t),t}(BeanStub),VERSION$2="30.0.6",ClientSideRowModelModule={version:VERSION$2,moduleName:ModuleNames.ClientSideRowModelModule,rowModel:"clientSide",beans:[ClientSideRowModel,FilterStage,SortStage,FlattenStage,SortService,FilterService,ImmutableService]},__extends$5=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$4=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},InfiniteBlock=function(n){__extends$5(t,n);function t(e,r,o){var s=n.call(this,e)||this;return s.parentCache=r,s.params=o,s.startRow=e*o.blockSize,s.endRow=s.startRow+o.blockSize,s}return t.prototype.postConstruct=function(){this.createRowNodes()},t.prototype.getBlockStateJson=function(){return{id:""+this.getId(),state:{blockNumber:this.getId(),startRow:this.getStartRow(),endRow:this.getEndRow(),pageStatus:this.getState()}}},t.prototype.setDataAndId=function(e,r,o){_.exists(r)?e.setDataAndId(r,o.toString()):e.setDataAndId(void 0,void 0)},t.prototype.loadFromDatasource=function(){var e=this,r=this.createLoadParams();if(_.missing(this.params.datasource.getRows)){console.warn("AG Grid: datasource is missing getRows method");return}window.setTimeout(function(){e.params.datasource.getRows(r)},0)},t.prototype.processServerFail=function(){},t.prototype.createLoadParams=function(){var e={startRow:this.getStartRow(),endRow:this.getEndRow(),successCallback:this.pageLoaded.bind(this,this.getVersion()),failCallback:this.pageLoadFailed.bind(this,this.getVersion()),sortModel:this.params.sortModel,filterModel:this.params.filterModel,context:this.gridOptionsService.context};return e},t.prototype.forEachNode=function(e,r,o){var s=this;this.rowNodes.forEach(function(l,a){var h=s.startRow+a;h<o&&e(l,r.next())})},t.prototype.getLastAccessed=function(){return this.lastAccessed},t.prototype.getRow=function(e,r){r===void 0&&(r=!1),r||(this.lastAccessed=this.params.lastAccessedSequence.next());var o=e-this.startRow;return this.rowNodes[o]},t.prototype.getStartRow=function(){return this.startRow},t.prototype.getEndRow=function(){return this.endRow},t.prototype.createRowNodes=function(){this.rowNodes=[];for(var e=0;e<this.params.blockSize;e++){var r=this.startRow+e,o=new RowNode(this.beans);o.setRowHeight(this.params.rowHeight),o.uiLevel=0,o.setRowIndex(r),o.setRowTop(this.params.rowHeight*r),this.rowNodes.push(o)}},t.prototype.processServerResult=function(e){var r=this;this.rowNodes.forEach(function(s,l){var a=e.rowData?e.rowData[l]:void 0;!s.id&&s.alreadyRendered&&a&&(r.rowNodes[l]=new RowNode(r.beans),r.rowNodes[l].setRowIndex(s.rowIndex),r.rowNodes[l].setRowTop(s.rowTop),s.clearRowTopAndRowIndex()),r.setDataAndId(r.rowNodes[l],a,r.startRow+l)});var o=e.rowCount!=null&&e.rowCount>=0?e.rowCount:void 0;this.parentCache.pageLoaded(this,o)},t.prototype.destroyRowNodes=function(){this.rowNodes.forEach(function(e){e.clearRowTopAndRowIndex()})},__decorate$4([Autowired("beans")],t.prototype,"beans",void 0),__decorate$4([PostConstruct],t.prototype,"postConstruct",null),__decorate$4([PreDestroy],t.prototype,"destroyRowNodes",null),t}(RowNodeBlock),__extends$4=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$3=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},__param=function(n,t){return function(e,r){t(e,r,n)}},InfiniteCache=function(n){__extends$4(t,n);function t(e){var r=n.call(this)||this;return r.lastRowIndexKnown=!1,r.blocks={},r.blockCount=0,r.rowCount=e.initialRowCount,r.params=e,r}return t.prototype.setBeans=function(e){this.logger=e.create("InfiniteCache")},t.prototype.getRow=function(e,r){r===void 0&&(r=!1);var o=Math.floor(e/this.params.blockSize),s=this.blocks[o];if(!s){if(r)return;s=this.createBlock(o)}return s.getRow(e)},t.prototype.createBlock=function(e){var r=this.createBean(new InfiniteBlock(e,this,this.params));return this.blocks[r.getId()]=r,this.blockCount++,this.purgeBlocksIfNeeded(r),this.params.rowNodeBlockLoader.addBlock(r),r},t.prototype.refreshCache=function(){var e=this.blockCount==0;if(e){this.purgeCache();return}this.getBlocksInOrder().forEach(function(r){return r.setStateWaitingToLoad()}),this.params.rowNodeBlockLoader.checkBlockToLoad()},t.prototype.destroyAllBlocks=function(){var e=this;this.getBlocksInOrder().forEach(function(r){return e.destroyBlock(r)})},t.prototype.getRowCount=function(){return this.rowCount},t.prototype.isLastRowIndexKnown=function(){return this.lastRowIndexKnown},t.prototype.pageLoaded=function(e,r){this.isAlive()&&(this.logger.log("onPageLoaded: page = "+e.getId()+", lastRow = "+r),this.checkRowCount(e,r),this.onCacheUpdated())},t.prototype.purgeBlocksIfNeeded=function(e){var r=this,o=this.getBlocksInOrder().filter(function(y){return y!=e}),s=function(y,C){return C.getLastAccessed()-y.getLastAccessed()};o.sort(s);var l=this.params.maxBlocksInCache>0,a=l?this.params.maxBlocksInCache-1:null,h=t.MAX_EMPTY_BLOCKS_TO_KEEP-1;o.forEach(function(y,C){var L=y.getState()===InfiniteBlock.STATE_WAITING_TO_LOAD&&C>=h,Y=l?C>=a:!1;if(L||Y){if(r.isBlockCurrentlyDisplayed(y)||r.isBlockFocused(y))return;r.removeBlockFromCache(y)}})},t.prototype.isBlockFocused=function(e){var r=this.focusService.getFocusCellToUseAfterRefresh();if(!r||r.rowPinned!=null)return!1;var o=e.getStartRow(),s=e.getEndRow(),l=r.rowIndex>=o&&r.rowIndex<s;return l},t.prototype.isBlockCurrentlyDisplayed=function(e){var r=e.getStartRow(),o=e.getEndRow()-1;return this.rowRenderer.isRangeInRenderedViewport(r,o)},t.prototype.removeBlockFromCache=function(e){e&&this.destroyBlock(e)},t.prototype.checkRowCount=function(e,r){if(typeof r=="number"&&r>=0)this.rowCount=r,this.lastRowIndexKnown=!0;else if(!this.lastRowIndexKnown){var o=(e.getId()+1)*this.params.blockSize,s=o+this.params.overflowSize;this.rowCount<s&&(this.rowCount=s)}},t.prototype.setRowCount=function(e,r){this.rowCount=e,_.exists(r)&&(this.lastRowIndexKnown=r),this.lastRowIndexKnown||this.rowCount%this.params.blockSize===0&&this.rowCount++,this.onCacheUpdated()},t.prototype.forEachNodeDeep=function(e){var r=this,o=new NumberSequence;this.getBlocksInOrder().forEach(function(s){return s.forEachNode(e,o,r.rowCount)})},t.prototype.getBlocksInOrder=function(){var e=function(o,s){return o.getId()-s.getId()},r=_.getAllValuesInObject(this.blocks).sort(e);return r},t.prototype.destroyBlock=function(e){delete this.blocks[e.getId()],this.destroyBean(e),this.blockCount--,this.params.rowNodeBlockLoader.removeBlock(e)},t.prototype.onCacheUpdated=function(){if(this.isAlive()){this.destroyAllBlocksPastVirtualRowCount();var e={type:Events.EVENT_STORE_UPDATED};this.eventService.dispatchEvent(e)}},t.prototype.destroyAllBlocksPastVirtualRowCount=function(){var e=this,r=[];this.getBlocksInOrder().forEach(function(o){var s=o.getId()*e.params.blockSize;s>=e.rowCount&&r.push(o)}),r.length>0&&r.forEach(function(o){return e.destroyBlock(o)})},t.prototype.purgeCache=function(){var e=this;this.getBlocksInOrder().forEach(function(r){return e.removeBlockFromCache(r)}),this.lastRowIndexKnown=!1,this.rowCount===0&&(this.rowCount=this.params.initialRowCount),this.onCacheUpdated()},t.prototype.getRowNodesInRange=function(e,r){var o=this,s=[],l=-1,a=!1,h=new NumberSequence;_.missing(e)&&(a=!0);var y=!1;this.getBlocksInOrder().forEach(function(L){if(!y){if(a&&l+1!==L.getId()){y=!0;return}l=L.getId(),L.forEachNode(function(Y){var ze=Y===e||Y===r;(a||ze)&&s.push(Y),ze&&(a=!a)},h,o.rowCount)}});var C=y||a;return C?[]:s},t.MAX_EMPTY_BLOCKS_TO_KEEP=2,__decorate$3([Autowired("rowRenderer")],t.prototype,"rowRenderer",void 0),__decorate$3([Autowired("focusService")],t.prototype,"focusService",void 0),__decorate$3([__param(0,Qualifier("loggerFactory"))],t.prototype,"setBeans",null),__decorate$3([PreDestroy],t.prototype,"destroyAllBlocks",null),t}(BeanStub),__extends$3=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$2=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},InfiniteRowModel=function(n){__extends$3(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.getRowBounds=function(e){return{rowHeight:this.rowHeight,rowTop:this.rowHeight*e}},t.prototype.ensureRowHeightsValid=function(e,r,o,s){return!1},t.prototype.init=function(){var e=this;this.gridOptionsService.isRowModelType("infinite")&&(this.rowHeight=this.gridOptionsService.getRowHeightAsNumber(),this.addEventListeners(),this.addDestroyFunc(function(){return e.destroyCache()}),this.verifyProps())},t.prototype.verifyProps=function(){if(this.gridOptionsService.exists("initialGroupOrderComparator")){var e="AG Grid: initialGroupOrderComparator cannot be used with Infinite Row Model. If using Infinite Row Model, then sorting is done on the server side, nothing to do with the client.";_.doOnce(function(){return console.warn(e)},"IRM.InitialGroupOrderComparator")}},t.prototype.start=function(){this.setDatasource(this.gridOptionsService.get("datasource"))},t.prototype.destroyDatasource=function(){this.datasource&&(this.getContext().destroyBean(this.datasource),this.rowRenderer.datasourceChanged(),this.datasource=null)},t.prototype.addEventListeners=function(){this.addManagedListener(this.eventService,Events.EVENT_FILTER_CHANGED,this.onFilterChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_SORT_CHANGED,this.onSortChanged.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_NEW_COLUMNS_LOADED,this.onColumnEverything.bind(this)),this.addManagedListener(this.eventService,Events.EVENT_STORE_UPDATED,this.onCacheUpdated.bind(this))},t.prototype.onFilterChanged=function(){this.reset()},t.prototype.onSortChanged=function(){this.reset()},t.prototype.onColumnEverything=function(){var e;this.cacheParams?e=this.isSortModelDifferent():e=!0,e&&this.reset()},t.prototype.isSortModelDifferent=function(){return!_.jsonEquals(this.cacheParams.sortModel,this.sortController.getSortModel())},t.prototype.getType=function(){return"infinite"},t.prototype.setDatasource=function(e){this.destroyDatasource(),this.datasource=e,e&&this.reset()},t.prototype.isEmpty=function(){return!this.infiniteCache},t.prototype.isRowsToRender=function(){return!!this.infiniteCache},t.prototype.getNodesInRangeForSelection=function(e,r){return this.infiniteCache?this.infiniteCache.getRowNodesInRange(e,r):[]},t.prototype.reset=function(){if(this.datasource){var e=this.gridOptionsService.getCallback("getRowId"),r=e!=null;r||this.selectionService.reset(),this.resetCache();var o=this.createModelUpdatedEvent();this.eventService.dispatchEvent(o)}},t.prototype.createModelUpdatedEvent=function(){return{type:Events.EVENT_MODEL_UPDATED,newPage:!1,newData:!1,keepRenderedRows:!0,animate:!1}},t.prototype.resetCache=function(){this.destroyCache(),this.cacheParams={datasource:this.datasource,filterModel:this.filterManager.getFilterModel(),sortModel:this.sortController.getSortModel(),rowNodeBlockLoader:this.rowNodeBlockLoader,initialRowCount:this.defaultIfInvalid(this.gridOptionsService.getNum("infiniteInitialRowCount"),1),maxBlocksInCache:this.gridOptionsService.getNum("maxBlocksInCache"),rowHeight:this.gridOptionsService.getRowHeightAsNumber(),overflowSize:this.defaultIfInvalid(this.gridOptionsService.getNum("cacheOverflowSize"),1),blockSize:this.defaultIfInvalid(this.gridOptionsService.getNum("cacheBlockSize"),100),lastAccessedSequence:new NumberSequence},this.infiniteCache=this.createBean(new InfiniteCache(this.cacheParams))},t.prototype.defaultIfInvalid=function(e,r){return e>0?e:r},t.prototype.destroyCache=function(){this.infiniteCache&&(this.infiniteCache=this.destroyBean(this.infiniteCache))},t.prototype.onCacheUpdated=function(){var e=this.createModelUpdatedEvent();this.eventService.dispatchEvent(e)},t.prototype.getRow=function(e){if(this.infiniteCache&&!(e>=this.infiniteCache.getRowCount()))return this.infiniteCache.getRow(e)},t.prototype.getRowNode=function(e){var r;return this.forEachNode(function(o){o.id===e&&(r=o)}),r},t.prototype.forEachNode=function(e){this.infiniteCache&&this.infiniteCache.forEachNodeDeep(e)},t.prototype.getTopLevelRowCount=function(){return this.getRowCount()},t.prototype.getTopLevelRowDisplayedIndex=function(e){return e},t.prototype.getRowIndexAtPixel=function(e){if(this.rowHeight!==0){var r=Math.floor(e/this.rowHeight),o=this.getRowCount()-1;return r>o?o:r}return 0},t.prototype.getRowCount=function(){return this.infiniteCache?this.infiniteCache.getRowCount():0},t.prototype.isRowPresent=function(e){var r=this.getRowNode(e.id);return!!r},t.prototype.refreshCache=function(){this.infiniteCache&&this.infiniteCache.refreshCache()},t.prototype.purgeCache=function(){this.infiniteCache&&this.infiniteCache.purgeCache()},t.prototype.isLastRowIndexKnown=function(){return this.infiniteCache?this.infiniteCache.isLastRowIndexKnown():!1},t.prototype.setRowCount=function(e,r){this.infiniteCache&&this.infiniteCache.setRowCount(e,r)},__decorate$2([Autowired("filterManager")],t.prototype,"filterManager",void 0),__decorate$2([Autowired("sortController")],t.prototype,"sortController",void 0),__decorate$2([Autowired("selectionService")],t.prototype,"selectionService",void 0),__decorate$2([Autowired("rowRenderer")],t.prototype,"rowRenderer",void 0),__decorate$2([Autowired("rowNodeBlockLoader")],t.prototype,"rowNodeBlockLoader",void 0),__decorate$2([PostConstruct],t.prototype,"init",null),__decorate$2([PreDestroy],t.prototype,"destroyDatasource",null),t=__decorate$2([Bean("rowModel")],t),t}(BeanStub),VERSION$1="30.0.6",InfiniteRowModelModule={version:VERSION$1,moduleName:ModuleNames.InfiniteRowModelModule,rowModel:"infinite",beans:[InfiniteRowModel]},BaseCreator=function(){function n(){}return n.prototype.setBeans=function(t){this.beans=t},n.prototype.getFileName=function(t){var e=this.getDefaultFileExtension();return(t==null||!t.length)&&(t=this.getDefaultFileName()),t.indexOf(".")===-1?t+"."+e:t},n.prototype.getData=function(t){var e=this.createSerializingSession(t),r=this.beans.gridSerializer.serialize(e,t);return r},n}(),BaseGridSerializingSession=function(){function n(t){this.groupColumns=[];var e=t.columnModel,r=t.valueService,o=t.gridOptionsService,s=t.valueFormatterService,l=t.valueParserService,a=t.processCellCallback,h=t.processHeaderCallback,y=t.processGroupHeaderCallback,C=t.processRowGroupCallback;this.columnModel=e,this.valueService=r,this.gridOptionsService=o,this.valueFormatterService=s,this.valueParserService=l,this.processCellCallback=a,this.processHeaderCallback=h,this.processGroupHeaderCallback=y,this.processRowGroupCallback=C}return n.prototype.prepare=function(t){this.groupColumns=t.filter(function(e){return!!e.getColDef().showRowGroup})},n.prototype.extractHeaderValue=function(t){var e=this.getHeaderName(this.processHeaderCallback,t);return e??""},n.prototype.extractRowCellValue=function(t,e,r,o,s){var l=this.gridOptionsService.is("groupHideOpenParents"),a=(!l||s.footer)&&this.shouldRenderGroupSummaryCell(s,t,e)?this.createValueForGroupNode(s):this.valueService.getValue(t,s),h=this.processCell({accumulatedRowIndex:r,rowNode:s,column:t,value:a,processCellCallback:this.processCellCallback,type:o});return h},n.prototype.shouldRenderGroupSummaryCell=function(t,e,r){var o,s=t&&t.group;if(!s)return!1;var l=this.groupColumns.indexOf(e);if(l!==-1){if(((o=t.groupData)===null||o===void 0?void 0:o[e.getId()])!=null)return!0;if(t.footer&&t.level===-1){var a=e.getColDef(),h=a==null||a.showRowGroup===!0;return h||a.showRowGroup===this.columnModel.getRowGroupColumns()[0].getId()}}var y=this.gridOptionsService.isGroupUseEntireRow(this.columnModel.isPivotMode());return r===0&&y},n.prototype.getHeaderName=function(t,e){return t?t({column:e,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context}):this.columnModel.getDisplayNameForColumn(e,"csv",!0)},n.prototype.createValueForGroupNode=function(t){if(this.processRowGroupCallback)return this.processRowGroupCallback({node:t,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context});var e=t.footer,r=[t.key];if(!this.gridOptionsService.isGroupMultiAutoColumn())for(;t.parent;)t=t.parent,r.push(t.key);var o=r.reverse().join(" -> ");return e?"Total "+o:o},n.prototype.processCell=function(t){var e=this,r,o=t.accumulatedRowIndex,s=t.rowNode,l=t.column,a=t.value,h=t.processCellCallback,y=t.type;return h?{value:(r=h({accumulatedRowIndex:o,column:l,node:s,value:a,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context,type:y,parseValue:function(C){return e.valueParserService.parseValue(l,s,C,e.valueService.getValue(l,s))},formatValue:function(C){var L;return(L=e.valueFormatterService.formatValue(l,s,C))!==null&&L!==void 0?L:C}}))!==null&&r!==void 0?r:""}:l.getColDef().useValueFormatterForExport?{value:a??"",valueFormatted:this.valueFormatterService.formatValue(l,s,a)}:{value:a??""}},n}(),Downloader=function(){function n(){}return n.download=function(t,e){var r=document.defaultView||window;if(!r){console.warn("AG Grid: There is no `window` associated with the current `document`");return}var o=document.createElement("a"),s=r.URL.createObjectURL(e);o.setAttribute("href",s),o.setAttribute("download",t),o.style.display="none",document.body.appendChild(o),o.dispatchEvent(new MouseEvent("click",{bubbles:!1,cancelable:!0,view:r})),document.body.removeChild(o),r.setTimeout(function(){r.URL.revokeObjectURL(s)},0)},n}(),__extends$2=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),LINE_SEPARATOR$1=`\r
`,CsvSerializingSession=function(n){__extends$2(t,n);function t(e){var r=n.call(this,e)||this;r.isFirstLine=!0,r.result="";var o=e.suppressQuotes,s=e.columnSeparator;return r.suppressQuotes=o,r.columnSeparator=s,r}return t.prototype.addCustomContent=function(e){var r=this;e&&(typeof e=="string"?(/^\s*\n/.test(e)||this.beginNewLine(),e=e.replace(/\r?\n/g,LINE_SEPARATOR$1),this.result+=e):e.forEach(function(o){r.beginNewLine(),o.forEach(function(s,l){l!==0&&(r.result+=r.columnSeparator),r.result+=r.putInQuotes(s.data.value||""),s.mergeAcross&&r.appendEmptyCells(s.mergeAcross)})}))},t.prototype.onNewHeaderGroupingRow=function(){return this.beginNewLine(),{onColumn:this.onNewHeaderGroupingRowColumn.bind(this)}},t.prototype.onNewHeaderGroupingRowColumn=function(e,r,o,s){o!=0&&(this.result+=this.columnSeparator),this.result+=this.putInQuotes(r),this.appendEmptyCells(s)},t.prototype.appendEmptyCells=function(e){for(var r=1;r<=e;r++)this.result+=this.columnSeparator+this.putInQuotes("")},t.prototype.onNewHeaderRow=function(){return this.beginNewLine(),{onColumn:this.onNewHeaderRowColumn.bind(this)}},t.prototype.onNewHeaderRowColumn=function(e,r){r!=0&&(this.result+=this.columnSeparator),this.result+=this.putInQuotes(this.extractHeaderValue(e))},t.prototype.onNewBodyRow=function(){return this.beginNewLine(),{onColumn:this.onNewBodyRowColumn.bind(this)}},t.prototype.onNewBodyRowColumn=function(e,r,o){var s;r!=0&&(this.result+=this.columnSeparator);var l=this.extractRowCellValue(e,r,r,"csv",o);this.result+=this.putInQuotes((s=l.valueFormatted)!==null&&s!==void 0?s:l.value)},t.prototype.putInQuotes=function(e){if(this.suppressQuotes)return e;if(e==null)return'""';var r;typeof e=="string"?r=e:typeof e.toString=="function"?r=e.toString():(console.warn("AG Grid: unknown value type during csv conversion"),r="");var o=r.replace(/"/g,'""');return'"'+o+'"'},t.prototype.parse=function(){return this.result},t.prototype.beginNewLine=function(){this.isFirstLine||(this.result+=LINE_SEPARATOR$1),this.isFirstLine=!1},t}(BaseGridSerializingSession),__extends$1=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate$1=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},CsvCreator=function(n){__extends$1(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.postConstruct=function(){this.setBeans({gridSerializer:this.gridSerializer,gridOptionsService:this.gridOptionsService})},t.prototype.getMergedParams=function(e){var r=this.gridOptionsService.get("defaultCsvExportParams");return Object.assign({},r,e)},t.prototype.export=function(e){if(this.isExportSuppressed())return console.warn("AG Grid: Export cancelled. Export is not allowed as per your configuration."),"";var r=this.getMergedParams(e),o=this.getData(r),s=new Blob(["\uFEFF",o],{type:"text/plain"});return Downloader.download(this.getFileName(r.fileName),s),o},t.prototype.exportDataAsCsv=function(e){return this.export(e)},t.prototype.getDataAsCsv=function(e,r){r===void 0&&(r=!1);var o=r?Object.assign({},e):this.getMergedParams(e);return this.getData(o)},t.prototype.getDefaultFileName=function(){return"export.csv"},t.prototype.getDefaultFileExtension=function(){return"csv"},t.prototype.createSerializingSession=function(e){var r=this,o=r.columnModel,s=r.valueService,l=r.gridOptionsService,a=r.valueFormatterService,h=r.valueParserService,y=e,C=y.processCellCallback,L=y.processHeaderCallback,Y=y.processGroupHeaderCallback,ze=y.processRowGroupCallback,Bt=y.suppressQuotes,Ir=y.columnSeparator;return new CsvSerializingSession({columnModel:o,valueService:s,gridOptionsService:l,valueFormatterService:a,valueParserService:h,processCellCallback:C||void 0,processHeaderCallback:L||void 0,processGroupHeaderCallback:Y||void 0,processRowGroupCallback:ze||void 0,suppressQuotes:Bt||!1,columnSeparator:Ir||","})},t.prototype.isExportSuppressed=function(){return this.gridOptionsService.is("suppressCsvExport")},__decorate$1([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate$1([Autowired("valueService")],t.prototype,"valueService",void 0),__decorate$1([Autowired("gridSerializer")],t.prototype,"gridSerializer",void 0),__decorate$1([Autowired("gridOptionsService")],t.prototype,"gridOptionsService",void 0),__decorate$1([Autowired("valueFormatterService")],t.prototype,"valueFormatterService",void 0),__decorate$1([Autowired("valueParserService")],t.prototype,"valueParserService",void 0),__decorate$1([PostConstruct],t.prototype,"postConstruct",null),t=__decorate$1([Bean("csvCreator")],t),t}(BaseCreator),__extends=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate=function(n,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(l=n[a])&&(s=(o<3?l(s):o>3?l(t,e,s):l(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},RowType;(function(n){n[n.HEADER_GROUPING=0]="HEADER_GROUPING",n[n.HEADER=1]="HEADER",n[n.BODY=2]="BODY"})(RowType||(RowType={}));var GridSerializer=function(n){__extends(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.serialize=function(e,r){r===void 0&&(r={});var o=this.getColumnsToExport(r.allColumns,r.columnKeys),s=_.compose(this.prepareSession(o),this.prependContent(r),this.exportColumnGroups(r,o),this.exportHeaders(r,o),this.processPinnedTopRows(r,o),this.processRows(r,o),this.processPinnedBottomRows(r,o),this.appendContent(r));return s(e).parse()},t.prototype.processRow=function(e,r,o,s){var l=r.shouldRowBeSkipped||function(){return!1},a=this.gridOptionsService.context,h=this.gridOptionsService.api,y=this.gridOptionsService.columnApi,C=this.gridOptionsService.is("groupRemoveSingleChildren"),L=this.gridOptionsService.is("groupRemoveLowestSingleChildren"),Y=r.rowPositions!=null,ze=Y||!!r.onlySelected,Bt=this.gridOptionsService.is("groupHideOpenParents")&&!ze,Ir=this.columnModel.isPivotMode()?s.leafGroup:!s.group,Wr=!!s.footer,yi=r.skipGroups||r.skipRowGroups,Bn=L&&s.leafGroup,vi=s.allChildrenCount===1&&(C||Bn);if(yi&&r.skipGroups&&_.doOnce(function(){return console.warn("AG Grid: Since v25.2 `skipGroups` has been renamed to `skipRowGroups`.")},"gridSerializer-skipGroups"),!(!Ir&&!Wr&&(r.skipRowGroups||vi||Bt)||r.onlySelected&&!s.isSelected()||r.skipPinnedTop&&s.rowPinned==="top"||r.skipPinnedBottom&&s.rowPinned==="bottom")){var wo=s.level===-1;if(!(wo&&!Ir&&!Wr)){var ia=l({node:s,api:h,columnApi:y,context:a});if(!ia){var gl=e.onNewBodyRow(s);if(o.forEach(function(il,sl){gl.onColumn(il,sl,s)}),r.getCustomContentBelowRow){var ml=r.getCustomContentBelowRow({node:s,api:h,columnApi:y,context:a});ml&&e.addCustomContent(ml)}}}}},t.prototype.appendContent=function(e){return function(r){var o=e.customFooter||e.appendContent;return o&&(e.customFooter&&_.doOnce(function(){return console.warn("AG Grid: Since version 25.2.0 the `customFooter` param has been deprecated. Use `appendContent` instead.")},"gridSerializer-customFooter"),r.addCustomContent(o)),r}},t.prototype.prependContent=function(e){return function(r){var o=e.customHeader||e.prependContent;return o&&(e.customHeader&&_.doOnce(function(){return console.warn("AG Grid: Since version 25.2.0 the `customHeader` param has been deprecated. Use `prependContent` instead.")},"gridSerializer-customHeader"),r.addCustomContent(o)),r}},t.prototype.prepareSession=function(e){return function(r){return r.prepare(e),r}},t.prototype.exportColumnGroups=function(e,r){var o=this;return function(s){if(e.skipColumnGroupHeaders)e.columnGroups&&_.doOnce(function(){return console.warn("AG Grid: Since v25.2 the `columnGroups` param has deprecated, and groups are exported by default.")},"gridSerializer-columnGroups");else{var l=new GroupInstanceIdCreator,a=o.displayedGroupCreator.createDisplayedGroups(r,o.columnModel.getGridBalancedTree(),l,null);o.recursivelyAddHeaderGroups(a,s,e.processGroupHeaderCallback)}return s}},t.prototype.exportHeaders=function(e,r){return function(o){if(!e.skipHeader&&!e.skipColumnHeaders){var s=o.onNewHeaderRow();r.forEach(function(l,a){s.onColumn(l,a,void 0)})}else e.skipHeader&&_.doOnce(function(){return console.warn("AG Grid: Since v25.2 the `skipHeader` param has been renamed to `skipColumnHeaders`.")},"gridSerializer-skipHeader");return o}},t.prototype.processPinnedTopRows=function(e,r){var o=this;return function(s){var l=o.processRow.bind(o,s,e,r);return e.rowPositions?e.rowPositions.filter(function(a){return a.rowPinned==="top"}).sort(function(a,h){return a.rowIndex-h.rowIndex}).map(function(a){return o.pinnedRowModel.getPinnedTopRow(a.rowIndex)}).forEach(l):o.pinnedRowModel.forEachPinnedTopRow(l),s}},t.prototype.processRows=function(e,r){var o=this;return function(s){var l=o.rowModel,a=l.getType(),h=a==="clientSide",y=a==="serverSide",C=!h&&e.onlySelected,L=o.processRow.bind(o,s,e,r),Y=e.exportedRows,ze=Y===void 0?"filteredAndSorted":Y;if(e.rowPositions)e.rowPositions.filter(function(Ir){return Ir.rowPinned==null}).sort(function(Ir,Wr){return Ir.rowIndex-Wr.rowIndex}).map(function(Ir){return l.getRow(Ir.rowIndex)}).forEach(L);else if(o.columnModel.isPivotMode())h?l.forEachPivotNode(L,!0):l.forEachNode(L);else if(e.onlySelectedAllPages||C){var Bt=o.selectionService.getSelectedNodes();o.replicateSortedOrder(Bt),Bt.forEach(L)}else ze==="all"?l.forEachNode(L):h?l.forEachNodeAfterFilterAndSort(L,!0):y?l.forEachNodeAfterFilterAndSort(L):l.forEachNode(L);return s}},t.prototype.replicateSortedOrder=function(e){var r=this,o=this.sortController.getSortOptions(),s=function(l,a){var h,y,C,L;return l.rowIndex!=null&&a.rowIndex!=null?l.rowIndex-a.rowIndex:l.level===a.level?((h=l.parent)===null||h===void 0?void 0:h.id)===((y=a.parent)===null||y===void 0?void 0:y.id)?r.rowNodeSorter.compareRowNodes(o,{rowNode:l,currentPos:(C=l.rowIndex)!==null&&C!==void 0?C:-1},{rowNode:a,currentPos:(L=a.rowIndex)!==null&&L!==void 0?L:-1}):s(l.parent,a.parent):l.level>a.level?s(l.parent,a):s(l,a.parent)};e.sort(s)},t.prototype.processPinnedBottomRows=function(e,r){var o=this;return function(s){var l=o.processRow.bind(o,s,e,r);return e.rowPositions?e.rowPositions.filter(function(a){return a.rowPinned==="bottom"}).sort(function(a,h){return a.rowIndex-h.rowIndex}).map(function(a){return o.pinnedRowModel.getPinnedBottomRow(a.rowIndex)}).forEach(l):o.pinnedRowModel.forEachPinnedBottomRow(l),s}},t.prototype.getColumnsToExport=function(e,r){e===void 0&&(e=!1);var o=this.columnModel.isPivotMode();if(r&&r.length)return this.columnModel.getGridColumns(r);if(e&&!o){var s=this.gridOptionsService.isTreeData()?this.columnModel.getGridColumns([GROUP_AUTO_COLUMN_ID]):[];return s.concat(this.columnModel.getAllGridColumns()||[])}return this.columnModel.getAllDisplayedColumns()},t.prototype.recursivelyAddHeaderGroups=function(e,r,o){var s=[];e.forEach(function(l){var a=l;a.getChildren&&a.getChildren().forEach(function(h){return s.push(h)})}),e.length>0&&e[0]instanceof ColumnGroup&&this.doAddHeaderHeader(r,e,o),s&&s.length>0&&this.recursivelyAddHeaderGroups(s,r,o)},t.prototype.doAddHeaderHeader=function(e,r,o){var s=this,l=e.onNewHeaderGroupingRow(),a=0;r.forEach(function(h){var y=h,C;o?C=o({columnGroup:y,api:s.gridOptionsService.api,columnApi:s.gridOptionsService.columnApi,context:s.gridOptionsService.context}):C=s.columnModel.getDisplayNameForColumnGroup(y,"header");var L=y.getLeafColumns().reduce(function(Y,ze,Bt,Ir){var Wr=_.last(Y),yi=ze.getColumnGroupShow()==="open";return yi?(!Wr||Wr[1]!=null)&&(Wr=[Bt],Y.push(Wr)):Wr&&Wr[1]==null&&(Wr[1]=Bt-1),Bt===Ir.length-1&&Wr&&Wr[1]==null&&(Wr[1]=Bt),Y},[]);l.onColumn(y,C||"",a++,y.getLeafColumns().length-1,L)})},__decorate([Autowired("displayedGroupCreator")],t.prototype,"displayedGroupCreator",void 0),__decorate([Autowired("columnModel")],t.prototype,"columnModel",void 0),__decorate([Autowired("rowModel")],t.prototype,"rowModel",void 0),__decorate([Autowired("pinnedRowModel")],t.prototype,"pinnedRowModel",void 0),__decorate([Autowired("selectionService")],t.prototype,"selectionService",void 0),__decorate([Autowired("rowNodeSorter")],t.prototype,"rowNodeSorter",void 0),__decorate([Autowired("sortController")],t.prototype,"sortController",void 0),t=__decorate([Bean("gridSerializer")],t),t}(BeanStub),VERSION="30.0.6",CsvExportModule={version:VERSION,moduleName:ModuleNames.CsvExportModule,beans:[CsvCreator,GridSerializer]},AllCommunityModules=[ClientSideRowModelModule,InfiniteRowModelModule,CsvExportModule];ModuleRegistry.registerModules(AllCommunityModules);const agGrid="",agThemeAlpine="";var earthRadius=63710088e-1,factors={centimeters:earthRadius*100,centimetres:earthRadius*100,degrees:earthRadius/111325,feet:earthRadius*3.28084,inches:earthRadius*39.37,kilometers:earthRadius/1e3,kilometres:earthRadius/1e3,meters:earthRadius,metres:earthRadius,miles:earthRadius/1609.344,millimeters:earthRadius*1e3,millimetres:earthRadius*1e3,nauticalmiles:earthRadius/1852,radians:1,yards:earthRadius*1.0936},unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/earthRadius,yards:1.0936133},areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function feature(n,t,e){e===void 0&&(e={});var r={type:"Feature"};return(e.id===0||e.id)&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.properties=t||{},r.geometry=n,r}function geometry(n,t,e){switch(n){case"Point":return point(t).geometry;case"LineString":return lineString(t).geometry;case"Polygon":return polygon(t).geometry;case"MultiPoint":return multiPoint(t).geometry;case"MultiLineString":return multiLineString(t).geometry;case"MultiPolygon":return multiPolygon(t).geometry;default:throw new Error(n+" is invalid")}}function point(n,t,e){if(e===void 0&&(e={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!isNumber(n[0])||!isNumber(n[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:n};return feature(r,t,e)}function points$1(n,t,e){return e===void 0&&(e={}),featureCollection$1(n.map(function(r){return point(r,t)}),e)}function polygon(n,t,e){e===void 0&&(e={});for(var r=0,o=n;r<o.length;r++){var s=o[r];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var l=0;l<s[s.length-1].length;l++)if(s[s.length-1][l]!==s[0][l])throw new Error("First and last Position are not equivalent.")}var a={type:"Polygon",coordinates:n};return feature(a,t,e)}function polygons(n,t,e){return e===void 0&&(e={}),featureCollection$1(n.map(function(r){return polygon(r,t)}),e)}function lineString(n,t,e){if(e===void 0&&(e={}),n.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:n};return feature(r,t,e)}function lineStrings(n,t,e){return e===void 0&&(e={}),featureCollection$1(n.map(function(r){return lineString(r,t)}),e)}function featureCollection$1(n,t){t===void 0&&(t={});var e={type:"FeatureCollection"};return t.id&&(e.id=t.id),t.bbox&&(e.bbox=t.bbox),e.features=n,e}function multiLineString(n,t,e){e===void 0&&(e={});var r={type:"MultiLineString",coordinates:n};return feature(r,t,e)}function multiPoint(n,t,e){e===void 0&&(e={});var r={type:"MultiPoint",coordinates:n};return feature(r,t,e)}function multiPolygon(n,t,e){e===void 0&&(e={});var r={type:"MultiPolygon",coordinates:n};return feature(r,t,e)}function geometryCollection(n,t,e){e===void 0&&(e={});var r={type:"GeometryCollection",geometries:n};return feature(r,t,e)}function round$1(n,t){if(t===void 0&&(t=0),t&&!(t>=0))throw new Error("precision must be a positive number");var e=Math.pow(10,t||0);return Math.round(n*e)/e}function radiansToLength(n,t){t===void 0&&(t="kilometers");var e=factors[t];if(!e)throw new Error(t+" units is invalid");return n*e}function lengthToRadians(n,t){t===void 0&&(t="kilometers");var e=factors[t];if(!e)throw new Error(t+" units is invalid");return n/e}function lengthToDegrees(n,t){return radiansToDegrees(lengthToRadians(n,t))}function bearingToAzimuth(n){var t=n%360;return t<0&&(t+=360),t}function radiansToDegrees(n){var t=n%(2*Math.PI);return t*180/Math.PI}function degreesToRadians(n){var t=n%360;return t*Math.PI/180}function convertLength(n,t,e){if(t===void 0&&(t="kilometers"),e===void 0&&(e="kilometers"),!(n>=0))throw new Error("length must be a positive number");return radiansToLength(lengthToRadians(n,t),e)}function convertArea(n,t,e){if(t===void 0&&(t="meters"),e===void 0&&(e="kilometers"),!(n>=0))throw new Error("area must be a positive number");var r=areaFactors[t];if(!r)throw new Error("invalid original units");var o=areaFactors[e];if(!o)throw new Error("invalid final units");return n/r*o}function isNumber(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function isObject(n){return!!n&&n.constructor===Object}function validateBBox(n){if(!n)throw new Error("bbox is required");if(!Array.isArray(n))throw new Error("bbox must be an Array");if(n.length!==4&&n.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");n.forEach(function(t){if(!isNumber(t))throw new Error("bbox must only contain numbers")})}function validateId(n){if(!n)throw new Error("id is required");if(["string","number"].indexOf(typeof n)===-1)throw new Error("id must be a number or a string")}const es$2=Object.freeze(Object.defineProperty({__proto__:null,areaFactors,bearingToAzimuth,convertArea,convertLength,degreesToRadians,earthRadius,factors,feature,featureCollection:featureCollection$1,geometry,geometryCollection,isNumber,isObject,lengthToDegrees,lengthToRadians,lineString,lineStrings,multiLineString,multiPoint,multiPolygon,point,points:points$1,polygon,polygons,radiansToDegrees,radiansToLength,round:round$1,unitsFactors,validateBBox,validateId},Symbol.toStringTag,{value:"Module"}));function coordEach(n,t,e){if(n!==null)for(var r,o,s,l,a,h,y,C=0,L=0,Y,ze=n.type,Bt=ze==="FeatureCollection",Ir=ze==="Feature",Wr=Bt?n.features.length:1,yi=0;yi<Wr;yi++){y=Bt?n.features[yi].geometry:Ir?n.geometry:n,Y=y?y.type==="GeometryCollection":!1,a=Y?y.geometries.length:1;for(var Bn=0;Bn<a;Bn++){var vi=0,wo=0;if(l=Y?y.geometries[Bn]:y,l!==null){h=l.coordinates;var ia=l.type;switch(C=e&&(ia==="Polygon"||ia==="MultiPolygon")?1:0,ia){case null:break;case"Point":if(t(h,L,yi,vi,wo)===!1)return!1;L++,vi++;break;case"LineString":case"MultiPoint":for(r=0;r<h.length;r++){if(t(h[r],L,yi,vi,wo)===!1)return!1;L++,ia==="MultiPoint"&&vi++}ia==="LineString"&&vi++;break;case"Polygon":case"MultiLineString":for(r=0;r<h.length;r++){for(o=0;o<h[r].length-C;o++){if(t(h[r][o],L,yi,vi,wo)===!1)return!1;L++}ia==="MultiLineString"&&vi++,ia==="Polygon"&&wo++}ia==="Polygon"&&vi++;break;case"MultiPolygon":for(r=0;r<h.length;r++){for(wo=0,o=0;o<h[r].length;o++){for(s=0;s<h[r][o].length-C;s++){if(t(h[r][o][s],L,yi,vi,wo)===!1)return!1;L++}wo++}vi++}break;case"GeometryCollection":for(r=0;r<l.geometries.length;r++)if(coordEach(l.geometries[r],t,e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function coordReduce(n,t,e,r){var o=e;return coordEach(n,function(s,l,a,h,y){l===0&&e===void 0?o=s:o=t(o,s,l,a,h,y)},r),o}function propEach(n,t){var e;switch(n.type){case"FeatureCollection":for(e=0;e<n.features.length&&t(n.features[e].properties,e)!==!1;e++);break;case"Feature":t(n.properties,0);break}}function propReduce(n,t,e){var r=e;return propEach(n,function(o,s){s===0&&e===void 0?r=o:r=t(r,o,s)}),r}function featureEach$1(n,t){if(n.type==="Feature")t(n,0);else if(n.type==="FeatureCollection")for(var e=0;e<n.features.length&&t(n.features[e],e)!==!1;e++);}function featureReduce(n,t,e){var r=e;return featureEach$1(n,function(o,s){s===0&&e===void 0?r=o:r=t(r,o,s)}),r}function coordAll(n){var t=[];return coordEach(n,function(e){t.push(e)}),t}function geomEach(n,t){var e,r,o,s,l,a,h,y,C,L,Y=0,ze=n.type==="FeatureCollection",Bt=n.type==="Feature",Ir=ze?n.features.length:1;for(e=0;e<Ir;e++){for(a=ze?n.features[e].geometry:Bt?n.geometry:n,y=ze?n.features[e].properties:Bt?n.properties:{},C=ze?n.features[e].bbox:Bt?n.bbox:void 0,L=ze?n.features[e].id:Bt?n.id:void 0,h=a?a.type==="GeometryCollection":!1,l=h?a.geometries.length:1,o=0;o<l;o++){if(s=h?a.geometries[o]:a,s===null){if(t(null,Y,y,C,L)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(s,Y,y,C,L)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<s.geometries.length;r++)if(t(s.geometries[r],Y,y,C,L)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}Y++}}function geomReduce(n,t,e){var r=e;return geomEach(n,function(o,s,l,a,h){s===0&&e===void 0?r=o:r=t(r,o,s,l,a,h)}),r}function flattenEach(n,t){geomEach(n,function(e,r,o,s,l){var a=e===null?null:e.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return t(feature(e,o,{bbox:s,id:l}),r,0)===!1?!1:void 0}var h;switch(a){case"MultiPoint":h="Point";break;case"MultiLineString":h="LineString";break;case"MultiPolygon":h="Polygon";break}for(var y=0;y<e.coordinates.length;y++){var C=e.coordinates[y],L={type:h,coordinates:C};if(t(feature(L,o),r,y)===!1)return!1}})}function flattenReduce(n,t,e){var r=e;return flattenEach(n,function(o,s,l){s===0&&l===0&&e===void 0?r=o:r=t(r,o,s,l)}),r}function segmentEach(n,t){flattenEach(n,function(e,r,o){var s=0;if(e.geometry){var l=e.geometry.type;if(!(l==="Point"||l==="MultiPoint")){var a,h=0,y=0,C=0;if(coordEach(e,function(L,Y,ze,Bt,Ir){if(a===void 0||r>h||Bt>y||Ir>C){a=L,h=r,y=Bt,C=Ir,s=0;return}var Wr=lineString([a,L],e.properties);if(t(Wr,r,o,Ir,s)===!1)return!1;s++,a=L})===!1)return!1}}})}function segmentReduce(n,t,e){var r=e,o=!1;return segmentEach(n,function(s,l,a,h,y){o===!1&&e===void 0?r=s:r=t(r,s,l,a,h,y),o=!0}),r}function lineEach(n,t){if(!n)throw new Error("geojson is required");flattenEach(n,function(e,r,o){if(e.geometry!==null){var s=e.geometry.type,l=e.geometry.coordinates;switch(s){case"LineString":if(t(e,r,o,0,0)===!1)return!1;break;case"Polygon":for(var a=0;a<l.length;a++)if(t(lineString(l[a],e.properties),r,o,a)===!1)return!1;break}}})}function lineReduce(n,t,e){var r=e;return lineEach(n,function(o,s,l,a){s===0&&e===void 0?r=o:r=t(r,o,s,l,a)}),r}function findSegment(n,t){if(t=t||{},!isObject(t))throw new Error("options is invalid");var e=t.featureIndex||0,r=t.multiFeatureIndex||0,o=t.geometryIndex||0,s=t.segmentIndex||0,l=t.properties,a;switch(n.type){case"FeatureCollection":e<0&&(e=n.features.length+e),l=l||n.features[e].properties,a=n.features[e].geometry;break;case"Feature":l=l||n.properties,a=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=n;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var h=a.coordinates;switch(a.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=h.length+s-1),lineString([h[s],h[s+1]],l,t);case"Polygon":return o<0&&(o=h.length+o),s<0&&(s=h[o].length+s-1),lineString([h[o][s],h[o][s+1]],l,t);case"MultiLineString":return r<0&&(r=h.length+r),s<0&&(s=h[r].length+s-1),lineString([h[r][s],h[r][s+1]],l,t);case"MultiPolygon":return r<0&&(r=h.length+r),o<0&&(o=h[r].length+o),s<0&&(s=h[r][o].length-s-1),lineString([h[r][o][s],h[r][o][s+1]],l,t)}throw new Error("geojson is invalid")}function findPoint(n,t){if(t=t||{},!isObject(t))throw new Error("options is invalid");var e=t.featureIndex||0,r=t.multiFeatureIndex||0,o=t.geometryIndex||0,s=t.coordIndex||0,l=t.properties,a;switch(n.type){case"FeatureCollection":e<0&&(e=n.features.length+e),l=l||n.features[e].properties,a=n.features[e].geometry;break;case"Feature":l=l||n.properties,a=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=n;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var h=a.coordinates;switch(a.type){case"Point":return point(h,l,t);case"MultiPoint":return r<0&&(r=h.length+r),point(h[r],l,t);case"LineString":return s<0&&(s=h.length+s),point(h[s],l,t);case"Polygon":return o<0&&(o=h.length+o),s<0&&(s=h[o].length+s),point(h[o][s],l,t);case"MultiLineString":return r<0&&(r=h.length+r),s<0&&(s=h[r].length+s),point(h[r][s],l,t);case"MultiPolygon":return r<0&&(r=h.length+r),o<0&&(o=h[r].length+o),s<0&&(s=h[r][o].length-s),point(h[r][o][s],l,t)}throw new Error("geojson is invalid")}const es$1=Object.freeze(Object.defineProperty({__proto__:null,coordAll,coordEach,coordReduce,featureEach:featureEach$1,featureReduce,findPoint,findSegment,flattenEach,flattenReduce,geomEach,geomReduce,lineEach,lineReduce,propEach,propReduce,segmentEach,segmentReduce},Symbol.toStringTag,{value:"Module"}));function bbox$1(n){var t=[1/0,1/0,-1/0,-1/0];return coordEach(n,function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])}),t}bbox$1.default=bbox$1;const es=Object.freeze(Object.defineProperty({__proto__:null,default:bbox$1},Symbol.toStringTag,{value:"Module"}));function getCoord(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function getCoords(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function getGeom(n){return n.type==="Feature"?n.geometry:n}function booleanPointInPolygon(n,t,e){if(e===void 0&&(e={}),!n)throw new Error("point is required");if(!t)throw new Error("polygon is required");var r=getCoord(n),o=getGeom(t),s=o.type,l=t.bbox,a=o.coordinates;if(l&&inBBox(r,l)===!1)return!1;s==="Polygon"&&(a=[a]);for(var h=!1,y=0;y<a.length&&!h;y++)if(inRing(r,a[y][0],e.ignoreBoundary)){for(var C=!1,L=1;L<a[y].length&&!C;)inRing(r,a[y][L],!e.ignoreBoundary)&&(C=!0),L++;C||(h=!0)}return h}function inRing(n,t,e){var r=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var o=0,s=t.length-1;o<t.length;s=o++){var l=t[o][0],a=t[o][1],h=t[s][0],y=t[s][1],C=n[1]*(l-h)+a*(h-n[0])+y*(n[0]-l)===0&&(l-n[0])*(h-n[0])<=0&&(a-n[1])*(y-n[1])<=0;if(C)return!e;var L=a>n[1]!=y>n[1]&&n[0]<(h-l)*(n[1]-a)/(y-a)+l;L&&(r=!r)}return r}function inBBox(n,t){return t[0]<=n[0]&&t[1]<=n[1]&&t[2]>=n[0]&&t[3]>=n[1]}function distance$1(n,t,e){e===void 0&&(e={});var r=getCoord(n),o=getCoord(t),s=degreesToRadians(o[1]-r[1]),l=degreesToRadians(o[0]-r[0]),a=degreesToRadians(r[1]),h=degreesToRadians(o[1]),y=Math.pow(Math.sin(s/2),2)+Math.pow(Math.sin(l/2),2)*Math.cos(a)*Math.cos(h);return radiansToLength(2*Math.atan2(Math.sqrt(y),Math.sqrt(1-y)),e.units)}function destination(n,t,e,r){r===void 0&&(r={});var o=getCoord(n),s=degreesToRadians(o[0]),l=degreesToRadians(o[1]),a=degreesToRadians(e),h=lengthToRadians(t,r.units),y=Math.asin(Math.sin(l)*Math.cos(h)+Math.cos(l)*Math.sin(h)*Math.cos(a)),C=s+Math.atan2(Math.sin(a)*Math.sin(h)*Math.cos(l),Math.cos(h)-Math.sin(l)*Math.sin(y)),L=radiansToDegrees(C),Y=radiansToDegrees(y);return point([L,Y],r.properties)}function lineSegment(n){if(!n)throw new Error("geojson is required");var t=[];return flattenEach(n,function(e){lineSegmentFeature(e,t)}),featureCollection$1(t)}function lineSegmentFeature(n,t){var e=[],r=n.geometry;if(r!==null){switch(r.type){case"Polygon":e=getCoords(r);break;case"LineString":e=[getCoords(r)]}e.forEach(function(o){var s=createSegments(o,n.properties);s.forEach(function(l){l.id=t.length,t.push(l)})})}}function createSegments(n,t){var e=[];return n.reduce(function(r,o){var s=lineString([r,o],t);return s.bbox=bbox(r,o),e.push(s),o}),e}function bbox(n,t){var e=n[0],r=n[1],o=t[0],s=t[1],l=e<o?e:o,a=r<s?r:s,h=e>o?e:o,y=r>s?r:s;return[l,a,h,y]}var geojsonRbush$1={exports:{}},rbush_min={exports:{}};(function(n,t){(function(e,r){n.exports=r()})(commonjsGlobal,function(){function e(Bn,vi,wo,ia,gl){(function ml(il,sl,ol,_l,rh){for(;_l>ol;){if(_l-ol>600){var wh=_l-ol+1,Fh=sl-ol+1,Mh=Math.log(wh),vp=.5*Math.exp(2*Mh/3),gp=.5*Math.sqrt(Mh*vp*(wh-vp)/wh)*(Fh-wh/2<0?-1:1),Jh=Math.max(ol,Math.floor(sl-Fh*vp/wh+gp)),Lp=Math.min(_l,Math.floor(sl+(wh-Fh)*vp/wh+gp));ml(il,sl,Jh,Lp,rh)}var Ip=il[sl],$p=ol,Xp=_l;for(r(il,ol,sl),rh(il[_l],Ip)>0&&r(il,ol,_l);$p<Xp;){for(r(il,$p,Xp),$p++,Xp--;rh(il[$p],Ip)<0;)$p++;for(;rh(il[Xp],Ip)>0;)Xp--}rh(il[ol],Ip)===0?r(il,ol,Xp):r(il,++Xp,_l),Xp<=sl&&(ol=Xp+1),sl<=Xp&&(_l=Xp-1)}})(Bn,vi,wo||0,ia||Bn.length-1,gl||o)}function r(Bn,vi,wo){var ia=Bn[vi];Bn[vi]=Bn[wo],Bn[wo]=ia}function o(Bn,vi){return Bn<vi?-1:Bn>vi?1:0}var s=function(Bn){Bn===void 0&&(Bn=9),this._maxEntries=Math.max(4,Bn),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function l(Bn,vi,wo){if(!wo)return vi.indexOf(Bn);for(var ia=0;ia<vi.length;ia++)if(wo(Bn,vi[ia]))return ia;return-1}function a(Bn,vi){h(Bn,0,Bn.children.length,vi,Bn)}function h(Bn,vi,wo,ia,gl){gl||(gl=Wr(null)),gl.minX=1/0,gl.minY=1/0,gl.maxX=-1/0,gl.maxY=-1/0;for(var ml=vi;ml<wo;ml++){var il=Bn.children[ml];y(gl,Bn.leaf?ia(il):il)}return gl}function y(Bn,vi){return Bn.minX=Math.min(Bn.minX,vi.minX),Bn.minY=Math.min(Bn.minY,vi.minY),Bn.maxX=Math.max(Bn.maxX,vi.maxX),Bn.maxY=Math.max(Bn.maxY,vi.maxY),Bn}function C(Bn,vi){return Bn.minX-vi.minX}function L(Bn,vi){return Bn.minY-vi.minY}function Y(Bn){return(Bn.maxX-Bn.minX)*(Bn.maxY-Bn.minY)}function ze(Bn){return Bn.maxX-Bn.minX+(Bn.maxY-Bn.minY)}function Bt(Bn,vi){return Bn.minX<=vi.minX&&Bn.minY<=vi.minY&&vi.maxX<=Bn.maxX&&vi.maxY<=Bn.maxY}function Ir(Bn,vi){return vi.minX<=Bn.maxX&&vi.minY<=Bn.maxY&&vi.maxX>=Bn.minX&&vi.maxY>=Bn.minY}function Wr(Bn){return{children:Bn,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function yi(Bn,vi,wo,ia,gl){for(var ml=[vi,wo];ml.length;)if(!((wo=ml.pop())-(vi=ml.pop())<=ia)){var il=vi+Math.ceil((wo-vi)/ia/2)*ia;e(Bn,il,vi,wo,gl),ml.push(vi,il,il,wo)}}return s.prototype.all=function(){return this._all(this.data,[])},s.prototype.search=function(Bn){var vi=this.data,wo=[];if(!Ir(Bn,vi))return wo;for(var ia=this.toBBox,gl=[];vi;){for(var ml=0;ml<vi.children.length;ml++){var il=vi.children[ml],sl=vi.leaf?ia(il):il;Ir(Bn,sl)&&(vi.leaf?wo.push(il):Bt(Bn,sl)?this._all(il,wo):gl.push(il))}vi=gl.pop()}return wo},s.prototype.collides=function(Bn){var vi=this.data;if(!Ir(Bn,vi))return!1;for(var wo=[];vi;){for(var ia=0;ia<vi.children.length;ia++){var gl=vi.children[ia],ml=vi.leaf?this.toBBox(gl):gl;if(Ir(Bn,ml)){if(vi.leaf||Bt(Bn,ml))return!0;wo.push(gl)}}vi=wo.pop()}return!1},s.prototype.load=function(Bn){if(!Bn||!Bn.length)return this;if(Bn.length<this._minEntries){for(var vi=0;vi<Bn.length;vi++)this.insert(Bn[vi]);return this}var wo=this._build(Bn.slice(),0,Bn.length-1,0);if(this.data.children.length)if(this.data.height===wo.height)this._splitRoot(this.data,wo);else{if(this.data.height<wo.height){var ia=this.data;this.data=wo,wo=ia}this._insert(wo,this.data.height-wo.height-1,!0)}else this.data=wo;return this},s.prototype.insert=function(Bn){return Bn&&this._insert(Bn,this.data.height-1),this},s.prototype.clear=function(){return this.data=Wr([]),this},s.prototype.remove=function(Bn,vi){if(!Bn)return this;for(var wo,ia,gl,ml=this.data,il=this.toBBox(Bn),sl=[],ol=[];ml||sl.length;){if(ml||(ml=sl.pop(),ia=sl[sl.length-1],wo=ol.pop(),gl=!0),ml.leaf){var _l=l(Bn,ml.children,vi);if(_l!==-1)return ml.children.splice(_l,1),sl.push(ml),this._condense(sl),this}gl||ml.leaf||!Bt(ml,il)?ia?(wo++,ml=ia.children[wo],gl=!1):ml=null:(sl.push(ml),ol.push(wo),wo=0,ia=ml,ml=ml.children[0])}return this},s.prototype.toBBox=function(Bn){return Bn},s.prototype.compareMinX=function(Bn,vi){return Bn.minX-vi.minX},s.prototype.compareMinY=function(Bn,vi){return Bn.minY-vi.minY},s.prototype.toJSON=function(){return this.data},s.prototype.fromJSON=function(Bn){return this.data=Bn,this},s.prototype._all=function(Bn,vi){for(var wo=[];Bn;)Bn.leaf?vi.push.apply(vi,Bn.children):wo.push.apply(wo,Bn.children),Bn=wo.pop();return vi},s.prototype._build=function(Bn,vi,wo,ia){var gl,ml=wo-vi+1,il=this._maxEntries;if(ml<=il)return a(gl=Wr(Bn.slice(vi,wo+1)),this.toBBox),gl;ia||(ia=Math.ceil(Math.log(ml)/Math.log(il)),il=Math.ceil(ml/Math.pow(il,ia-1))),(gl=Wr([])).leaf=!1,gl.height=ia;var sl=Math.ceil(ml/il),ol=sl*Math.ceil(Math.sqrt(il));yi(Bn,vi,wo,ol,this.compareMinX);for(var _l=vi;_l<=wo;_l+=ol){var rh=Math.min(_l+ol-1,wo);yi(Bn,_l,rh,sl,this.compareMinY);for(var wh=_l;wh<=rh;wh+=sl){var Fh=Math.min(wh+sl-1,rh);gl.children.push(this._build(Bn,wh,Fh,ia-1))}}return a(gl,this.toBBox),gl},s.prototype._chooseSubtree=function(Bn,vi,wo,ia){for(;ia.push(vi),!vi.leaf&&ia.length-1!==wo;){for(var gl=1/0,ml=1/0,il=void 0,sl=0;sl<vi.children.length;sl++){var ol=vi.children[sl],_l=Y(ol),rh=(wh=Bn,Fh=ol,(Math.max(Fh.maxX,wh.maxX)-Math.min(Fh.minX,wh.minX))*(Math.max(Fh.maxY,wh.maxY)-Math.min(Fh.minY,wh.minY))-_l);rh<ml?(ml=rh,gl=_l<gl?_l:gl,il=ol):rh===ml&&_l<gl&&(gl=_l,il=ol)}vi=il||vi.children[0]}var wh,Fh;return vi},s.prototype._insert=function(Bn,vi,wo){var ia=wo?Bn:this.toBBox(Bn),gl=[],ml=this._chooseSubtree(ia,this.data,vi,gl);for(ml.children.push(Bn),y(ml,ia);vi>=0&&gl[vi].children.length>this._maxEntries;)this._split(gl,vi),vi--;this._adjustParentBBoxes(ia,gl,vi)},s.prototype._split=function(Bn,vi){var wo=Bn[vi],ia=wo.children.length,gl=this._minEntries;this._chooseSplitAxis(wo,gl,ia);var ml=this._chooseSplitIndex(wo,gl,ia),il=Wr(wo.children.splice(ml,wo.children.length-ml));il.height=wo.height,il.leaf=wo.leaf,a(wo,this.toBBox),a(il,this.toBBox),vi?Bn[vi-1].children.push(il):this._splitRoot(wo,il)},s.prototype._splitRoot=function(Bn,vi){this.data=Wr([Bn,vi]),this.data.height=Bn.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},s.prototype._chooseSplitIndex=function(Bn,vi,wo){for(var ia,gl,ml,il,sl,ol,_l,rh=1/0,wh=1/0,Fh=vi;Fh<=wo-vi;Fh++){var Mh=h(Bn,0,Fh,this.toBBox),vp=h(Bn,Fh,wo,this.toBBox),gp=(gl=Mh,ml=vp,il=void 0,sl=void 0,ol=void 0,_l=void 0,il=Math.max(gl.minX,ml.minX),sl=Math.max(gl.minY,ml.minY),ol=Math.min(gl.maxX,ml.maxX),_l=Math.min(gl.maxY,ml.maxY),Math.max(0,ol-il)*Math.max(0,_l-sl)),Jh=Y(Mh)+Y(vp);gp<rh?(rh=gp,ia=Fh,wh=Jh<wh?Jh:wh):gp===rh&&Jh<wh&&(wh=Jh,ia=Fh)}return ia||wo-vi},s.prototype._chooseSplitAxis=function(Bn,vi,wo){var ia=Bn.leaf?this.compareMinX:C,gl=Bn.leaf?this.compareMinY:L;this._allDistMargin(Bn,vi,wo,ia)<this._allDistMargin(Bn,vi,wo,gl)&&Bn.children.sort(ia)},s.prototype._allDistMargin=function(Bn,vi,wo,ia){Bn.children.sort(ia);for(var gl=this.toBBox,ml=h(Bn,0,vi,gl),il=h(Bn,wo-vi,wo,gl),sl=ze(ml)+ze(il),ol=vi;ol<wo-vi;ol++){var _l=Bn.children[ol];y(ml,Bn.leaf?gl(_l):_l),sl+=ze(ml)}for(var rh=wo-vi-1;rh>=vi;rh--){var wh=Bn.children[rh];y(il,Bn.leaf?gl(wh):wh),sl+=ze(il)}return sl},s.prototype._adjustParentBBoxes=function(Bn,vi,wo){for(var ia=wo;ia>=0;ia--)y(vi[ia],Bn)},s.prototype._condense=function(Bn){for(var vi=Bn.length-1,wo=void 0;vi>=0;vi--)Bn[vi].children.length===0?vi>0?(wo=Bn[vi-1].children).splice(wo.indexOf(Bn[vi]),1):this.clear():a(Bn[vi],this.toBBox)},s})})(rbush_min);var rbush_minExports=rbush_min.exports;const require$$1=getAugmentedNamespace(es$2),require$$2=getAugmentedNamespace(es$1),require$$3=getAugmentedNamespace(es);var rbush=rbush_minExports,helpers=require$$1,meta=require$$2,turfBBox=require$$3.default,featureEach=meta.featureEach;meta.coordEach;helpers.polygon;var featureCollection=helpers.featureCollection;function geojsonRbush(n){var t=new rbush(n);return t.insert=function(e){if(e.type!=="Feature")throw new Error("invalid feature");return e.bbox=e.bbox?e.bbox:turfBBox(e),rbush.prototype.insert.call(this,e)},t.load=function(e){var r=[];return Array.isArray(e)?e.forEach(function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:turfBBox(o),r.push(o)}):featureEach(e,function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:turfBBox(o),r.push(o)}),rbush.prototype.load.call(this,r)},t.remove=function(e,r){if(e.type!=="Feature")throw new Error("invalid feature");return e.bbox=e.bbox?e.bbox:turfBBox(e),rbush.prototype.remove.call(this,e,r)},t.clear=function(){return rbush.prototype.clear.call(this)},t.search=function(e){var r=rbush.prototype.search.call(this,this.toBBox(e));return featureCollection(r)},t.collides=function(e){return rbush.prototype.collides.call(this,this.toBBox(e))},t.all=function(){var e=rbush.prototype.all.call(this);return featureCollection(e)},t.toJSON=function(){return rbush.prototype.toJSON.call(this)},t.fromJSON=function(e){return rbush.prototype.fromJSON.call(this,e)},t.toBBox=function(e){var r;if(e.bbox)r=e.bbox;else if(Array.isArray(e)&&e.length===4)r=e;else if(Array.isArray(e)&&e.length===6)r=[e[0],e[1],e[3],e[4]];else if(e.type==="Feature")r=turfBBox(e);else if(e.type==="FeatureCollection")r=turfBBox(e);else throw new Error("invalid geojson");return{minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]}},t}geojsonRbush$1.exports=geojsonRbush;geojsonRbush$1.exports.default=geojsonRbush;var geojsonRbushExports=geojsonRbush$1.exports;const rbush$1=getDefaultExportFromCjs(geojsonRbushExports);function lineIntersect(n,t){var e={},r=[];if(n.type==="LineString"&&(n=feature(n)),t.type==="LineString"&&(t=feature(t)),n.type==="Feature"&&t.type==="Feature"&&n.geometry!==null&&t.geometry!==null&&n.geometry.type==="LineString"&&t.geometry.type==="LineString"&&n.geometry.coordinates.length===2&&t.geometry.coordinates.length===2){var o=intersects(n,t);return o&&r.push(o),featureCollection$1(r)}var s=rbush$1();return s.load(lineSegment(t)),featureEach$1(lineSegment(n),function(l){featureEach$1(s.search(l),function(a){var h=intersects(l,a);if(h){var y=getCoords(h).join(",");e[y]||(e[y]=!0,r.push(h))}})}),featureCollection$1(r)}function intersects(n,t){var e=getCoords(n),r=getCoords(t);if(e.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(r.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var o=e[0][0],s=e[0][1],l=e[1][0],a=e[1][1],h=r[0][0],y=r[0][1],C=r[1][0],L=r[1][1],Y=(L-y)*(l-o)-(C-h)*(a-s),ze=(C-h)*(s-y)-(L-y)*(o-h),Bt=(l-o)*(s-y)-(a-s)*(o-h);if(Y===0)return null;var Ir=ze/Y,Wr=Bt/Y;if(Ir>=0&&Ir<=1&&Wr>=0&&Wr<=1){var yi=o+Ir*(l-o),Bn=s+Ir*(a-s);return point([yi,Bn])}return null}function polygonToLine(n,t){t===void 0&&(t={});var e=getGeom(n);switch(!t.properties&&n.type==="Feature"&&(t.properties=n.properties),e.type){case"Polygon":return polygonToLine$1(e,t);case"MultiPolygon":return multiPolygonToLine(e,t);default:throw new Error("invalid poly")}}function polygonToLine$1(n,t){t===void 0&&(t={});var e=getGeom(n),r=e.coordinates,o=t.properties?t.properties:n.type==="Feature"?n.properties:{};return coordsToLine(r,o)}function multiPolygonToLine(n,t){t===void 0&&(t={});var e=getGeom(n),r=e.coordinates,o=t.properties?t.properties:n.type==="Feature"?n.properties:{},s=[];return r.forEach(function(l){s.push(coordsToLine(l,o))}),featureCollection$1(s)}function coordsToLine(n,t){return n.length>1?multiLineString(n,t):lineString(n[0],t)}function booleanDisjoint(n,t){var e=!0;return flattenEach(n,function(r){flattenEach(t,function(o){if(e===!1)return!1;e=disjoint(r.geometry,o.geometry)})}),e}function disjoint(n,t){switch(n.type){case"Point":switch(t.type){case"Point":return!compareCoords(n.coordinates,t.coordinates);case"LineString":return!isPointOnLine(t,n);case"Polygon":return!booleanPointInPolygon(n,t)}break;case"LineString":switch(t.type){case"Point":return!isPointOnLine(n,t);case"LineString":return!isLineOnLine(n,t);case"Polygon":return!isLineInPoly(t,n)}break;case"Polygon":switch(t.type){case"Point":return!booleanPointInPolygon(t,n);case"LineString":return!isLineInPoly(n,t);case"Polygon":return!isPolyInPoly(t,n)}}return!1}function isPointOnLine(n,t){for(var e=0;e<n.coordinates.length-1;e++)if(isPointOnLineSegment(n.coordinates[e],n.coordinates[e+1],t.coordinates))return!0;return!1}function isLineOnLine(n,t){var e=lineIntersect(n,t);return e.features.length>0}function isLineInPoly(n,t){for(var e=0,r=t.coordinates;e<r.length;e++){var o=r[e];if(booleanPointInPolygon(o,n))return!0}var s=lineIntersect(t,polygonToLine(n));return s.features.length>0}function isPolyInPoly(n,t){for(var e=0,r=n.coordinates[0];e<r.length;e++){var o=r[e];if(booleanPointInPolygon(o,t))return!0}for(var s=0,l=t.coordinates[0];s<l.length;s++){var a=l[s];if(booleanPointInPolygon(a,n))return!0}var h=lineIntersect(polygonToLine(n),polygonToLine(t));return h.features.length>0}function isPointOnLineSegment(n,t,e){var r=e[0]-n[0],o=e[1]-n[1],s=t[0]-n[0],l=t[1]-n[1],a=r*l-o*s;return a!==0?!1:Math.abs(s)>=Math.abs(l)?s>0?n[0]<=e[0]&&e[0]<=t[0]:t[0]<=e[0]&&e[0]<=n[0]:l>0?n[1]<=e[1]&&e[1]<=t[1]:t[1]<=e[1]&&e[1]<=n[1]}function compareCoords(n,t){return n[0]===t[0]&&n[1]===t[1]}function booleanIntersects(n,t){var e=!1;return flattenEach(n,function(r){flattenEach(t,function(o){if(e===!0)return!0;e=!booleanDisjoint(r.geometry,o.geometry)})}),e}function rectangleGrid(n,t,e,r){r===void 0&&(r={});for(var o=[],s=n[0],l=n[1],a=n[2],h=n[3],y=t/distance$1([s,l],[a,l],r),C=y*(a-s),L=e/distance$1([s,l],[s,h],r),Y=L*(h-l),ze=a-s,Bt=h-l,Ir=Math.floor(ze/C),Wr=Math.floor(Bt/Y),yi=(ze-Ir*C)/2,Bn=(Bt-Wr*Y)/2,vi=s+yi,wo=0;wo<Ir;wo++){for(var ia=l+Bn,gl=0;gl<Wr;gl++){var ml=polygon([[[vi,ia],[vi,ia+Y],[vi+C,ia+Y],[vi+C,ia],[vi,ia]]],r.properties);r.mask?booleanIntersects(r.mask,ml)&&o.push(ml):o.push(ml),ia+=Y}vi+=C}return featureCollection$1(o)}function squareGrid(n,t,e){return e===void 0&&(e={}),rectangleGrid(n,t,t,e)}class Store{constructor(t="unreal-map-bridge",e="keyval"){this.storeName=e,this._dbp=new Promise((r,o)=>{const s=indexedDB.open(t,3);s.onerror=()=>o(s.error),s.onsuccess=()=>r(s.result),s.onupgradeneeded=()=>{try{s.result.deleteObjectStore(e)}catch{}s.result.createObjectStore(e)}})}_withIDBStore(t,e){return this._dbp.then(r=>new Promise((o,s)=>{const l=r.transaction(this.storeName,t);l.oncomplete=()=>o(),l.onabort=l.onerror=()=>s(l.error),e(l.objectStore(this.storeName))}))}}let store;function getDefaultStore(){return store||(store=new Store),store}function get(n,t=getDefaultStore()){let e;return t._withIDBStore("readonly",r=>{e=r.get(n)}).then(()=>e.result)}function set(n,t,e=getDefaultStore()){return e._withIDBStore("readwrite",r=>{r.put(t,n)})}function del(n,t=getDefaultStore()){return t._withIDBStore("readwrite",e=>{e.delete(n)})}function clear(n=getDefaultStore()){return n._withIDBStore("readwrite",t=>{t.clear()})}function keys(n=getDefaultStore()){const t=[];return n._withIDBStore("readonly",e=>{(e.openKeyCursor||e.openCursor).call(e).onsuccess=function(){this.result&&(t.push(this.result.key),this.result.continue())}}).then(()=>t)}const idbKeyval={keys,clear,del,set,get};function getFileHandle(){if("showOpenFilePicker"in window)return window.showOpenFilePicker().then(n=>n[0])}function getDirHandle(){if("showDirectoryPicker"in window)return window.showDirectoryPicker().then(n=>n)}async function verifyPermission(n,t){const e={};return t&&(e.writable=!0,e.mode="readwrite"),await n.queryPermission(e)==="granted"||await n.requestPermission(e)==="granted"}async function writeFileToDisk(n,t,e){let o=await(await n.getFileHandle(t,{create:!0})).createWritable();await o.write(e),await o.close()}async function fileExists(n,t){try{return await n.getFileHandle(t),!0}catch(e){if(e.name==="NotFoundError")return!1;if(e.name==="NotAllowedError")return console.log("Please select directory to verify permissions"),!1}}async function readFileFromDisk(n,t){return await(await(await n.getFileHandle(t)).getFile()).arrayBuffer()}function checkFileApiSupport$1(){let n;return"showDirectoryPicker"in window?n=!0:n=!1,n}const fileUtils={getDirHandle,verifyPermission,writeFileToDisk,fileExists,getFileHandle,readFileFromDisk,checkFileApiSupport:checkFileApiSupport$1},scriptRel="modulepreload",assetsURL=function(n){return"/"+n},seen={},__vitePreload=function(t,e,r){if(!e||e.length===0)return t();const o=document.getElementsByTagName("link");return Promise.all(e.map(s=>{if(s=assetsURL(s),s in seen)return;seen[s]=!0;const l=s.endsWith(".css"),a=l?'[rel="stylesheet"]':"";if(!!r)for(let C=o.length-1;C>=0;C--){const L=o[C];if(L.href===s&&(!l||L.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const y=document.createElement("link");if(y.rel=l?"stylesheet":scriptRel,l||(y.as="script",y.crossOrigin=""),y.href=s,document.head.appendChild(y),l)return new Promise((C,L)=>{y.addEventListener("load",C),y.addEventListener("error",()=>L(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>t()).catch(s=>{const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=s,window.dispatchEvent(l),!l.defaultPrevented)throw s})},bitMethods={getBit(n){return this.data[getSlot(n)]&1<<getShift(n)?1:0},setBit(n){this.data[getSlot(n)]|=1<<getShift(n)},clearBit(n){this.data[getSlot(n)]&=~(1<<getShift(n))},toggleBit(n){this.data[getSlot(n)]^=1<<getShift(n)},getBitXY(n,t){return n>=this.width||t>=this.height?0:this.getBit(t*this.width+n)},setBitXY(n,t){this.setBit(t*this.width+n)},clearBitXY(n,t){this.clearBit(t*this.width+n)},toggleBitXY(n,t){this.toggleBit(t*this.width+n)}};function getSlot(n){return n>>3}function getShift(n){return 7-(n&7)}function setBitMethods(n){for(const t in bitMethods)n.prototype[t]=bitMethods[t]}function checkProcessable(n,t={}){let{bitDepth:e,alpha:r,colorModel:o,components:s,channels:l}=t;if(typeof n!="string"||n.length===0)throw new TypeError("processName must be a string");if(e&&(Array.isArray(e)||(e=[e]),!e.includes(this.bitDepth)))throw new TypeError(`The process: ${n} can only be applied if bit depth is in: ${e}`);if(r&&(Array.isArray(r)||(r=[r]),!r.includes(this.alpha)))throw new TypeError(`The process: ${n} can only be applied if alpha is in: ${r}`);if(o&&(Array.isArray(o)||(o=[o]),!o.includes(this.colorModel)))throw new TypeError(`The process: ${n} can only be applied if color model is in: ${o}`);if(s&&(Array.isArray(s)||(s=[s]),!s.includes(this.components))){let a=`The process: ${n} can only be applied if the number of components is in: ${s}`;throw s.length===1&&s[0]===1?new TypeError(`${a}.\rYou should transform your image using "image.grey()" before applying the algorithm.`):new TypeError(a)}if(l&&(Array.isArray(l)||(l=[l]),!l.includes(this.channels)))throw new TypeError(`The process: ${n} can only be applied if the number of channels is in: ${l}`)}function createBlob(n,t){n=n||[],t=t||{},typeof t=="string"&&(t={type:t});try{return new Blob(n,t)}catch(s){if(s.name!=="TypeError")throw s;for(var e=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,r=new e,o=0;o<n.length;o+=1)r.append(n[o]);return r.getBlob(t.type)}}function dataURLToBlob(n){var t=n.match(/data:([^;]+)/)[1],e=n.replace(/^[^,]+,/,""),r=binaryStringToArrayBuffer(atob(e));return createBlob([r],{type:t})}function canvasToBlob(n,t,e){return typeof n.toBlob=="function"?new Promise(function(r){n.toBlob(r,t,e)}):Promise.resolve(dataURLToBlob(n.toDataURL(t,e)))}function binaryStringToArrayBuffer(n){for(var t=n.length,e=new ArrayBuffer(t),r=new Uint8Array(e),o=-1;++o<t;)r[o]=n.charCodeAt(o);return e}(function(n){if(n.TextEncoder&&n.TextDecoder)return!1;function t(r="utf-8"){if(r!=="utf-8")throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${r}') is invalid.`)}Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),t.prototype.encode=function(r,o={stream:!1}){if(o.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let s=0;const l=r.length;let a=0,h=Math.max(32,l+(l>>1)+7),y=new Uint8Array(h>>3<<3);for(;s<l;){let C=r.charCodeAt(s++);if(C>=55296&&C<=56319){if(s<l){const L=r.charCodeAt(s);(L&64512)===56320&&(++s,C=((C&1023)<<10)+(L&1023)+65536)}if(C>=55296&&C<=56319)continue}if(a+4>y.length){h+=8,h*=1+s/r.length*2,h=h>>3<<3;const L=new Uint8Array(h);L.set(y),y=L}if(C&4294967168)if(!(C&4294965248))y[a++]=C>>6&31|192;else if(!(C&4294901760))y[a++]=C>>12&15|224,y[a++]=C>>6&63|128;else if(!(C&4292870144))y[a++]=C>>18&7|240,y[a++]=C>>12&63|128,y[a++]=C>>6&63|128;else continue;else{y[a++]=C;continue}y[a++]=C&63|128}return y.slice(0,a)};function e(r="utf-8",o={fatal:!1}){if(r!=="utf-8")throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${r}') is invalid.`);if(o.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(e.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(e.prototype,"fatal",{value:!1}),Object.defineProperty(e.prototype,"ignoreBOM",{value:!1}),e.prototype.decode=function(r,o={stream:!1}){if(o.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const s=new Uint8Array(r);let l=0;const a=s.length,h=[];for(;l<a;){const y=s[l++];if(y===0)break;if(!(y&128))h.push(y);else if((y&224)===192){const C=s[l++]&63;h.push((y&31)<<6|C)}else if((y&240)===224){const C=s[l++]&63,L=s[l++]&63;h.push((y&31)<<12|C<<6|L)}else if((y&248)===240){const C=s[l++]&63,L=s[l++]&63,Y=s[l++]&63;let ze=(y&7)<<18|C<<12|L<<6|Y;ze>65535&&(ze-=65536,h.push(ze>>>10&1023|55296),ze=56320|ze&1023),h.push(ze)}}return String.fromCharCode.apply(null,h)},n.TextEncoder=t,n.TextDecoder=e})(typeof window<"u"?window:typeof self<"u"?self:globalThis);function decode$5(n,t="utf8"){return new TextDecoder(t).decode(n)}const encoder$1=new TextEncoder;function encode$3(n){return encoder$1.encode(n)}const defaultByteLength$1=1024*8,hostBigEndian=(()=>{const n=new Uint8Array(4),t=new Uint32Array(n.buffer);return!((t[0]=1)&n[0])})(),typedArrays={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};let IOBuffer$4=class JS{constructor(t=defaultByteLength$1,e={}){let r=!1;typeof t=="number"?t=new ArrayBuffer(t):(r=!0,this.lastWrittenByte=t.byteLength);const o=e.offset?e.offset>>>0:0,s=t.byteLength-o;let l=o;(ArrayBuffer.isView(t)||t instanceof JS)&&(t.byteLength!==t.buffer.byteLength&&(l=t.byteOffset+o),t=t.buffer),r?this.lastWrittenByte=s:this.lastWrittenByte=0,this.buffer=t,this.length=s,this.byteLength=s,this.byteOffset=l,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,l,s),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}back(t=1){return this.offset-=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(t===void 0)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){const r=(this.offset+t)*2,o=new Uint8Array(r);o.set(new Uint8Array(this.buffer)),this.buffer=o.buffer,this.length=this.byteLength=r,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){return this.readArray(t,"uint8")}readArray(t,e){const r=typedArrays[e].BYTES_PER_ELEMENT*t,o=this.byteOffset+this.offset,s=this.buffer.slice(o,o+r);if(this.littleEndian===hostBigEndian&&e!=="uint8"&&e!=="int8"){const a=new Uint8Array(this.buffer.slice(o,o+r));a.reverse();const h=new typedArrays[e](a.buffer);return this.offset+=r,h.reverse(),h}const l=new typedArrays[e](s);return this.offset+=r,l}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readBigInt64(){const t=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,t}readBigUint64(){const t=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let e="";for(let r=0;r<t;r++)e+=this.readChar();return e}readUtf8(t=1){return decode$5(this.readBytes(t))}decodeText(t=1,e="utf-8"){return decode$5(this.readBytes(t),e)}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(t){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(t){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e));return this}writeUtf8(t){return this.writeBytes(encode$3(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}};const IOBuffer$5=Object.freeze(Object.defineProperty({__proto__:null,IOBuffer:IOBuffer$4},Symbol.toStringTag,{value:"Module"})),require$$0$3=getAugmentedNamespace(IOBuffer$5);var constants$4={BITMAPV5HEADER:{LogicalColorSpace:{LCS_CALIBRATED_RGB:0,LCS_sRGB:1934772034,LCS_WINDOWS_COLOR_SPACE:1466527264},Compression:{BI_RGB:0,BI_RLE8:1,BI_RLE4:2,BI_BITFIELDS:3,BI_JPEG:4,BI_PNG:5,BI_CMYK:11,BI_CMYKRLE8:12,BI_CMYKRLE4:13},GamutMappingIntent:{LCS_GM_ABS_COLORIMETRIC:8,LCS_GM_BUSINESS:1,LCS_GM_GRAPHICS:2,LCS_GM_IMAGES:4}}};const{IOBuffer:IOBuffer$3}=require$$0$3,constants$3=constants$4,tableLeft=[];for(let n=0;n<=8;n++)tableLeft.push(255<<n);class BMPEncoder extends IOBuffer$3{constructor(t){if(t.bitDepth!==1)throw new Error("Only bitDepth of 1 is supported");if(!t.height||!t.width)throw new Error("ImageData width and height are required");super(t.data),this.width=t.width,this.height=t.height,this.bitDepth=t.bitDepth,this.channels=t.channels,this.components=t.components}encode(){this.encoded=new IOBuffer$3,this.encoded.skip(14),this.writeBitmapV5Header(),this.writeColorTable();const t=this.encoded.offset;return this.writePixelArray(),this.encoded.rewind(),this.writeBitmapFileHeader(t),this.encoded.toArray()}writePixelArray(){let t=this.encoded;const e=Math.floor((this.bitDepth*this.width+31)/32)*4,r=Math.ceil(this.bitDepth*this.width/8),o=e-r,s=this.bitDepth*this.width%8,l=s===0?0:8-s,a=e*this.height;let h,y,C=0,L=0,Y=8;t.mark(),y=this.readUint8();for(let ze=this.height-1;ze>=0;ze--){const Bt=ze===0;t.reset(),t.skip(ze*e);for(let Ir=0;Ir<r;Ir++){const Wr=Ir===r-1;L<=l&&Wr?(t.writeByte(y<<L),(l===0||l===L)&&!Bt&&(h=y,y=this.readByte())):L===0?(h=y,y=this.readUint8(),t.writeByte(h)):(h=y,y=this.readUint8(),t.writeByte(h<<L&tableLeft[L]|y>>Y)),Wr&&(C+=s||0,t.skip(o),L=C%8,Y=8-L)}}e>r&&(t.reset(),t.skip(a-1),t.writeUint8(0))}writeColorTable(){this.encoded.writeUint32(0).writeUint32(16777215)}writeBitmapFileHeader(t){this.encoded.writeChars("BM").writeInt32(this.encoded.lastWrittenByte).writeUint16(0).writeUint16(0).writeUint32(t)}writeBitmapV5Header(){const e=Math.floor((this.bitDepth*this.width+31)/32)*4*this.height;this.encoded.writeUint32(124).writeInt32(this.width).writeInt32(this.height).writeUint16(1).writeUint16(this.bitDepth).writeUint32(constants$3.BITMAPV5HEADER.Compression.BI_RGB).writeUint32(e).writeInt32(0).writeInt32(0).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(4278190080).writeUint32(16711680).writeUint32(65280).writeUint32(255).writeUint32(constants$3.BITMAPV5HEADER.LogicalColorSpace.LCS_sRGB).skip(36).skip(12).writeUint32(constants$3.BITMAPV5HEADER.GamutMappingIntent.LCS_GM_IMAGES).skip(12)}}var BMPEncoder_1=BMPEncoder;const Encoder=BMPEncoder_1;var encode$2=function(t){return new Encoder(t).encode()};/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Z_FIXED$1=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN$1=2;function zero$1(n){let t=n.length;for(;--t>=0;)n[t]=0}const STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH$1=3,MAX_MATCH$1=258,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),extra_dbits=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),extra_blbits=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bl_order=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DIST_CODE_LEN=512,static_ltree=new Array((L_CODES$1+2)*2);zero$1(static_ltree);const static_dtree=new Array(D_CODES$1*2);zero$1(static_dtree);const _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);const _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);const base_length=new Array(LENGTH_CODES$1);zero$1(base_length);const base_dist=new Array(D_CODES$1);zero$1(base_dist);function StaticTreeDesc(n,t,e,r,o){this.static_tree=n,this.extra_bits=t,this.extra_base=e,this.elems=r,this.max_length=o,this.has_stree=n&&n.length}let static_l_desc,static_d_desc,static_bl_desc;function TreeDesc(n,t){this.dyn_tree=n,this.max_code=0,this.stat_desc=t}const d_code=n=>n<256?_dist_code[n]:_dist_code[256+(n>>>7)],put_short=(n,t)=>{n.pending_buf[n.pending++]=t&255,n.pending_buf[n.pending++]=t>>>8&255},send_bits=(n,t,e)=>{n.bi_valid>Buf_size-e?(n.bi_buf|=t<<n.bi_valid&65535,put_short(n,n.bi_buf),n.bi_buf=t>>Buf_size-n.bi_valid,n.bi_valid+=e-Buf_size):(n.bi_buf|=t<<n.bi_valid&65535,n.bi_valid+=e)},send_code=(n,t,e)=>{send_bits(n,e[t*2],e[t*2+1])},bi_reverse=(n,t)=>{let e=0;do e|=n&1,n>>>=1,e<<=1;while(--t>0);return e>>>1},bi_flush=n=>{n.bi_valid===16?(put_short(n,n.bi_buf),n.bi_buf=0,n.bi_valid=0):n.bi_valid>=8&&(n.pending_buf[n.pending++]=n.bi_buf&255,n.bi_buf>>=8,n.bi_valid-=8)},gen_bitlen=(n,t)=>{const e=t.dyn_tree,r=t.max_code,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.extra_bits,a=t.stat_desc.extra_base,h=t.stat_desc.max_length;let y,C,L,Y,ze,Bt,Ir=0;for(Y=0;Y<=MAX_BITS$1;Y++)n.bl_count[Y]=0;for(e[n.heap[n.heap_max]*2+1]=0,y=n.heap_max+1;y<HEAP_SIZE$1;y++)C=n.heap[y],Y=e[e[C*2+1]*2+1]+1,Y>h&&(Y=h,Ir++),e[C*2+1]=Y,!(C>r)&&(n.bl_count[Y]++,ze=0,C>=a&&(ze=l[C-a]),Bt=e[C*2],n.opt_len+=Bt*(Y+ze),s&&(n.static_len+=Bt*(o[C*2+1]+ze)));if(Ir!==0){do{for(Y=h-1;n.bl_count[Y]===0;)Y--;n.bl_count[Y]--,n.bl_count[Y+1]+=2,n.bl_count[h]--,Ir-=2}while(Ir>0);for(Y=h;Y!==0;Y--)for(C=n.bl_count[Y];C!==0;)L=n.heap[--y],!(L>r)&&(e[L*2+1]!==Y&&(n.opt_len+=(Y-e[L*2+1])*e[L*2],e[L*2+1]=Y),C--)}},gen_codes=(n,t,e)=>{const r=new Array(MAX_BITS$1+1);let o=0,s,l;for(s=1;s<=MAX_BITS$1;s++)o=o+e[s-1]<<1,r[s]=o;for(l=0;l<=t;l++){let a=n[l*2+1];a!==0&&(n[l*2]=bi_reverse(r[a]++,a))}},tr_static_init=()=>{let n,t,e,r,o;const s=new Array(MAX_BITS$1+1);for(e=0,r=0;r<LENGTH_CODES$1-1;r++)for(base_length[r]=e,n=0;n<1<<extra_lbits[r];n++)_length_code[e++]=r;for(_length_code[e-1]=r,o=0,r=0;r<16;r++)for(base_dist[r]=o,n=0;n<1<<extra_dbits[r];n++)_dist_code[o++]=r;for(o>>=7;r<D_CODES$1;r++)for(base_dist[r]=o<<7,n=0;n<1<<extra_dbits[r]-7;n++)_dist_code[256+o++]=r;for(t=0;t<=MAX_BITS$1;t++)s[t]=0;for(n=0;n<=143;)static_ltree[n*2+1]=8,n++,s[8]++;for(;n<=255;)static_ltree[n*2+1]=9,n++,s[9]++;for(;n<=279;)static_ltree[n*2+1]=7,n++,s[7]++;for(;n<=287;)static_ltree[n*2+1]=8,n++,s[8]++;for(gen_codes(static_ltree,L_CODES$1+1,s),n=0;n<D_CODES$1;n++)static_dtree[n*2+1]=5,static_dtree[n*2]=bi_reverse(n,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS$1+1,L_CODES$1,MAX_BITS$1),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES$1,MAX_BITS$1),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES$1,MAX_BL_BITS)},init_block=n=>{let t;for(t=0;t<L_CODES$1;t++)n.dyn_ltree[t*2]=0;for(t=0;t<D_CODES$1;t++)n.dyn_dtree[t*2]=0;for(t=0;t<BL_CODES$1;t++)n.bl_tree[t*2]=0;n.dyn_ltree[END_BLOCK*2]=1,n.opt_len=n.static_len=0,n.sym_next=n.matches=0},bi_windup=n=>{n.bi_valid>8?put_short(n,n.bi_buf):n.bi_valid>0&&(n.pending_buf[n.pending++]=n.bi_buf),n.bi_buf=0,n.bi_valid=0},smaller=(n,t,e,r)=>{const o=t*2,s=e*2;return n[o]<n[s]||n[o]===n[s]&&r[t]<=r[e]},pqdownheap=(n,t,e)=>{const r=n.heap[e];let o=e<<1;for(;o<=n.heap_len&&(o<n.heap_len&&smaller(t,n.heap[o+1],n.heap[o],n.depth)&&o++,!smaller(t,r,n.heap[o],n.depth));)n.heap[e]=n.heap[o],e=o,o<<=1;n.heap[e]=r},compress_block=(n,t,e)=>{let r,o,s=0,l,a;if(n.sym_next!==0)do r=n.pending_buf[n.sym_buf+s++]&255,r+=(n.pending_buf[n.sym_buf+s++]&255)<<8,o=n.pending_buf[n.sym_buf+s++],r===0?send_code(n,o,t):(l=_length_code[o],send_code(n,l+LITERALS$1+1,t),a=extra_lbits[l],a!==0&&(o-=base_length[l],send_bits(n,o,a)),r--,l=d_code(r),send_code(n,l,e),a=extra_dbits[l],a!==0&&(r-=base_dist[l],send_bits(n,r,a)));while(s<n.sym_next);send_code(n,END_BLOCK,t)},build_tree=(n,t)=>{const e=t.dyn_tree,r=t.stat_desc.static_tree,o=t.stat_desc.has_stree,s=t.stat_desc.elems;let l,a,h=-1,y;for(n.heap_len=0,n.heap_max=HEAP_SIZE$1,l=0;l<s;l++)e[l*2]!==0?(n.heap[++n.heap_len]=h=l,n.depth[l]=0):e[l*2+1]=0;for(;n.heap_len<2;)y=n.heap[++n.heap_len]=h<2?++h:0,e[y*2]=1,n.depth[y]=0,n.opt_len--,o&&(n.static_len-=r[y*2+1]);for(t.max_code=h,l=n.heap_len>>1;l>=1;l--)pqdownheap(n,e,l);y=s;do l=n.heap[1],n.heap[1]=n.heap[n.heap_len--],pqdownheap(n,e,1),a=n.heap[1],n.heap[--n.heap_max]=l,n.heap[--n.heap_max]=a,e[y*2]=e[l*2]+e[a*2],n.depth[y]=(n.depth[l]>=n.depth[a]?n.depth[l]:n.depth[a])+1,e[l*2+1]=e[a*2+1]=y,n.heap[1]=y++,pqdownheap(n,e,1);while(n.heap_len>=2);n.heap[--n.heap_max]=n.heap[1],gen_bitlen(n,t),gen_codes(e,h,n.bl_count)},scan_tree=(n,t,e)=>{let r,o=-1,s,l=t[0*2+1],a=0,h=7,y=4;for(l===0&&(h=138,y=3),t[(e+1)*2+1]=65535,r=0;r<=e;r++)s=l,l=t[(r+1)*2+1],!(++a<h&&s===l)&&(a<y?n.bl_tree[s*2]+=a:s!==0?(s!==o&&n.bl_tree[s*2]++,n.bl_tree[REP_3_6*2]++):a<=10?n.bl_tree[REPZ_3_10*2]++:n.bl_tree[REPZ_11_138*2]++,a=0,o=s,l===0?(h=138,y=3):s===l?(h=6,y=3):(h=7,y=4))},send_tree=(n,t,e)=>{let r,o=-1,s,l=t[0*2+1],a=0,h=7,y=4;for(l===0&&(h=138,y=3),r=0;r<=e;r++)if(s=l,l=t[(r+1)*2+1],!(++a<h&&s===l)){if(a<y)do send_code(n,s,n.bl_tree);while(--a!==0);else s!==0?(s!==o&&(send_code(n,s,n.bl_tree),a--),send_code(n,REP_3_6,n.bl_tree),send_bits(n,a-3,2)):a<=10?(send_code(n,REPZ_3_10,n.bl_tree),send_bits(n,a-3,3)):(send_code(n,REPZ_11_138,n.bl_tree),send_bits(n,a-11,7));a=0,o=s,l===0?(h=138,y=3):s===l?(h=6,y=3):(h=7,y=4)}},build_bl_tree=n=>{let t;for(scan_tree(n,n.dyn_ltree,n.l_desc.max_code),scan_tree(n,n.dyn_dtree,n.d_desc.max_code),build_tree(n,n.bl_desc),t=BL_CODES$1-1;t>=3&&n.bl_tree[bl_order[t]*2+1]===0;t--);return n.opt_len+=3*(t+1)+5+5+4,t},send_all_trees=(n,t,e,r)=>{let o;for(send_bits(n,t-257,5),send_bits(n,e-1,5),send_bits(n,r-4,4),o=0;o<r;o++)send_bits(n,n.bl_tree[bl_order[o]*2+1],3);send_tree(n,n.dyn_ltree,t-1),send_tree(n,n.dyn_dtree,e-1)},detect_data_type=n=>{let t=4093624447,e;for(e=0;e<=31;e++,t>>>=1)if(t&1&&n.dyn_ltree[e*2]!==0)return Z_BINARY;if(n.dyn_ltree[9*2]!==0||n.dyn_ltree[10*2]!==0||n.dyn_ltree[13*2]!==0)return Z_TEXT;for(e=32;e<LITERALS$1;e++)if(n.dyn_ltree[e*2]!==0)return Z_TEXT;return Z_BINARY};let static_init_done=!1;const _tr_init$1=n=>{static_init_done||(tr_static_init(),static_init_done=!0),n.l_desc=new TreeDesc(n.dyn_ltree,static_l_desc),n.d_desc=new TreeDesc(n.dyn_dtree,static_d_desc),n.bl_desc=new TreeDesc(n.bl_tree,static_bl_desc),n.bi_buf=0,n.bi_valid=0,init_block(n)},_tr_stored_block$1=(n,t,e,r)=>{send_bits(n,(STORED_BLOCK<<1)+(r?1:0),3),bi_windup(n),put_short(n,e),put_short(n,~e),e&&n.pending_buf.set(n.window.subarray(t,t+e),n.pending),n.pending+=e},_tr_align$1=n=>{send_bits(n,STATIC_TREES<<1,3),send_code(n,END_BLOCK,static_ltree),bi_flush(n)},_tr_flush_block$1=(n,t,e,r)=>{let o,s,l=0;n.level>0?(n.strm.data_type===Z_UNKNOWN$1&&(n.strm.data_type=detect_data_type(n)),build_tree(n,n.l_desc),build_tree(n,n.d_desc),l=build_bl_tree(n),o=n.opt_len+3+7>>>3,s=n.static_len+3+7>>>3,s<=o&&(o=s)):o=s=e+5,e+4<=o&&t!==-1?_tr_stored_block$1(n,t,e,r):n.strategy===Z_FIXED$1||s===o?(send_bits(n,(STATIC_TREES<<1)+(r?1:0),3),compress_block(n,static_ltree,static_dtree)):(send_bits(n,(DYN_TREES<<1)+(r?1:0),3),send_all_trees(n,n.l_desc.max_code+1,n.d_desc.max_code+1,l+1),compress_block(n,n.dyn_ltree,n.dyn_dtree)),init_block(n),r&&bi_windup(n)},_tr_tally$1=(n,t,e)=>(n.pending_buf[n.sym_buf+n.sym_next++]=t,n.pending_buf[n.sym_buf+n.sym_next++]=t>>8,n.pending_buf[n.sym_buf+n.sym_next++]=e,t===0?n.dyn_ltree[e*2]++:(n.matches++,t--,n.dyn_ltree[(_length_code[e]+LITERALS$1+1)*2]++,n.dyn_dtree[d_code(t)*2]++),n.sym_next===n.sym_end);var _tr_init_1=_tr_init$1,_tr_stored_block_1=_tr_stored_block$1,_tr_flush_block_1=_tr_flush_block$1,_tr_tally_1=_tr_tally$1,_tr_align_1=_tr_align$1,trees={_tr_init:_tr_init_1,_tr_stored_block:_tr_stored_block_1,_tr_flush_block:_tr_flush_block_1,_tr_tally:_tr_tally_1,_tr_align:_tr_align_1};const adler32=(n,t,e,r)=>{let o=n&65535|0,s=n>>>16&65535|0,l=0;for(;e!==0;){l=e>2e3?2e3:e,e-=l;do o=o+t[r++]|0,s=s+o|0;while(--l);o%=65521,s%=65521}return o|s<<16|0};var adler32_1=adler32;const makeTable=()=>{let n,t=[];for(var e=0;e<256;e++){n=e;for(var r=0;r<8;r++)n=n&1?3988292384^n>>>1:n>>>1;t[e]=n}return t},crcTable$1=new Uint32Array(makeTable()),crc32=(n,t,e,r)=>{const o=crcTable$1,s=r+e;n^=-1;for(let l=r;l<s;l++)n=n>>>8^o[(n^t[l])&255];return n^-1};var crc32_1=crc32,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},constants$2={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init,_tr_stored_block,_tr_flush_block,_tr_tally,_tr_align}=trees,{Z_NO_FLUSH:Z_NO_FLUSH$2,Z_PARTIAL_FLUSH,Z_FULL_FLUSH:Z_FULL_FLUSH$1,Z_FINISH:Z_FINISH$3,Z_BLOCK:Z_BLOCK$1,Z_OK:Z_OK$3,Z_STREAM_END:Z_STREAM_END$3,Z_STREAM_ERROR:Z_STREAM_ERROR$2,Z_DATA_ERROR:Z_DATA_ERROR$2,Z_BUF_ERROR:Z_BUF_ERROR$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$1,Z_FILTERED,Z_HUFFMAN_ONLY,Z_RLE,Z_FIXED,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$1,Z_UNKNOWN,Z_DEFLATED:Z_DEFLATED$2}=constants$2,MAX_MEM_LEVEL=9,MAX_WBITS$1=15,DEF_MEM_LEVEL=8,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,MIN_MATCH=3,MAX_MATCH=258,MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1,PRESET_DICT=32,INIT_STATE=42,GZIP_STATE=57,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,err=(n,t)=>(n.msg=messages[t],t),rank=n=>n*2-(n>4?9:0),zero=n=>{let t=n.length;for(;--t>=0;)n[t]=0},slide_hash=n=>{let t,e,r,o=n.w_size;t=n.hash_size,r=t;do e=n.head[--r],n.head[r]=e>=o?e-o:0;while(--t);t=o,r=t;do e=n.prev[--r],n.prev[r]=e>=o?e-o:0;while(--t)};let HASH_ZLIB=(n,t,e)=>(t<<n.hash_shift^e)&n.hash_mask,HASH=HASH_ZLIB;const flush_pending=n=>{const t=n.state;let e=t.pending;e>n.avail_out&&(e=n.avail_out),e!==0&&(n.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+e),n.next_out),n.next_out+=e,t.pending_out+=e,n.total_out+=e,n.avail_out-=e,t.pending-=e,t.pending===0&&(t.pending_out=0))},flush_block_only=(n,t)=>{_tr_flush_block(n,n.block_start>=0?n.block_start:-1,n.strstart-n.block_start,t),n.block_start=n.strstart,flush_pending(n.strm)},put_byte=(n,t)=>{n.pending_buf[n.pending++]=t},putShortMSB=(n,t)=>{n.pending_buf[n.pending++]=t>>>8&255,n.pending_buf[n.pending++]=t&255},read_buf=(n,t,e,r)=>{let o=n.avail_in;return o>r&&(o=r),o===0?0:(n.avail_in-=o,t.set(n.input.subarray(n.next_in,n.next_in+o),e),n.state.wrap===1?n.adler=adler32_1(n.adler,t,o,e):n.state.wrap===2&&(n.adler=crc32_1(n.adler,t,o,e)),n.next_in+=o,n.total_in+=o,o)},longest_match=(n,t)=>{let e=n.max_chain_length,r=n.strstart,o,s,l=n.prev_length,a=n.nice_match;const h=n.strstart>n.w_size-MIN_LOOKAHEAD?n.strstart-(n.w_size-MIN_LOOKAHEAD):0,y=n.window,C=n.w_mask,L=n.prev,Y=n.strstart+MAX_MATCH;let ze=y[r+l-1],Bt=y[r+l];n.prev_length>=n.good_match&&(e>>=2),a>n.lookahead&&(a=n.lookahead);do if(o=t,!(y[o+l]!==Bt||y[o+l-1]!==ze||y[o]!==y[r]||y[++o]!==y[r+1])){r+=2,o++;do;while(y[++r]===y[++o]&&y[++r]===y[++o]&&y[++r]===y[++o]&&y[++r]===y[++o]&&y[++r]===y[++o]&&y[++r]===y[++o]&&y[++r]===y[++o]&&y[++r]===y[++o]&&r<Y);if(s=MAX_MATCH-(Y-r),r=Y-MAX_MATCH,s>l){if(n.match_start=t,l=s,s>=a)break;ze=y[r+l-1],Bt=y[r+l]}}while((t=L[t&C])>h&&--e!==0);return l<=n.lookahead?l:n.lookahead},fill_window=n=>{const t=n.w_size;let e,r,o;do{if(r=n.window_size-n.lookahead-n.strstart,n.strstart>=t+(t-MIN_LOOKAHEAD)&&(n.window.set(n.window.subarray(t,t+t-r),0),n.match_start-=t,n.strstart-=t,n.block_start-=t,n.insert>n.strstart&&(n.insert=n.strstart),slide_hash(n),r+=t),n.strm.avail_in===0)break;if(e=read_buf(n.strm,n.window,n.strstart+n.lookahead,r),n.lookahead+=e,n.lookahead+n.insert>=MIN_MATCH)for(o=n.strstart-n.insert,n.ins_h=n.window[o],n.ins_h=HASH(n,n.ins_h,n.window[o+1]);n.insert&&(n.ins_h=HASH(n,n.ins_h,n.window[o+MIN_MATCH-1]),n.prev[o&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=o,o++,n.insert--,!(n.lookahead+n.insert<MIN_MATCH)););}while(n.lookahead<MIN_LOOKAHEAD&&n.strm.avail_in!==0)},deflate_stored=(n,t)=>{let e=n.pending_buf_size-5>n.w_size?n.w_size:n.pending_buf_size-5,r,o,s,l=0,a=n.strm.avail_in;do{if(r=65535,s=n.bi_valid+42>>3,n.strm.avail_out<s||(s=n.strm.avail_out-s,o=n.strstart-n.block_start,r>o+n.strm.avail_in&&(r=o+n.strm.avail_in),r>s&&(r=s),r<e&&(r===0&&t!==Z_FINISH$3||t===Z_NO_FLUSH$2||r!==o+n.strm.avail_in)))break;l=t===Z_FINISH$3&&r===o+n.strm.avail_in?1:0,_tr_stored_block(n,0,0,l),n.pending_buf[n.pending-4]=r,n.pending_buf[n.pending-3]=r>>8,n.pending_buf[n.pending-2]=~r,n.pending_buf[n.pending-1]=~r>>8,flush_pending(n.strm),o&&(o>r&&(o=r),n.strm.output.set(n.window.subarray(n.block_start,n.block_start+o),n.strm.next_out),n.strm.next_out+=o,n.strm.avail_out-=o,n.strm.total_out+=o,n.block_start+=o,r-=o),r&&(read_buf(n.strm,n.strm.output,n.strm.next_out,r),n.strm.next_out+=r,n.strm.avail_out-=r,n.strm.total_out+=r)}while(l===0);return a-=n.strm.avail_in,a&&(a>=n.w_size?(n.matches=2,n.window.set(n.strm.input.subarray(n.strm.next_in-n.w_size,n.strm.next_in),0),n.strstart=n.w_size,n.insert=n.strstart):(n.window_size-n.strstart<=a&&(n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,n.insert>n.strstart&&(n.insert=n.strstart)),n.window.set(n.strm.input.subarray(n.strm.next_in-a,n.strm.next_in),n.strstart),n.strstart+=a,n.insert+=a>n.w_size-n.insert?n.w_size-n.insert:a),n.block_start=n.strstart),n.high_water<n.strstart&&(n.high_water=n.strstart),l?BS_FINISH_DONE:t!==Z_NO_FLUSH$2&&t!==Z_FINISH$3&&n.strm.avail_in===0&&n.strstart===n.block_start?BS_BLOCK_DONE:(s=n.window_size-n.strstart,n.strm.avail_in>s&&n.block_start>=n.w_size&&(n.block_start-=n.w_size,n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,s+=n.w_size,n.insert>n.strstart&&(n.insert=n.strstart)),s>n.strm.avail_in&&(s=n.strm.avail_in),s&&(read_buf(n.strm,n.window,n.strstart,s),n.strstart+=s,n.insert+=s>n.w_size-n.insert?n.w_size-n.insert:s),n.high_water<n.strstart&&(n.high_water=n.strstart),s=n.bi_valid+42>>3,s=n.pending_buf_size-s>65535?65535:n.pending_buf_size-s,e=s>n.w_size?n.w_size:s,o=n.strstart-n.block_start,(o>=e||(o||t===Z_FINISH$3)&&t!==Z_NO_FLUSH$2&&n.strm.avail_in===0&&o<=s)&&(r=o>s?s:o,l=t===Z_FINISH$3&&n.strm.avail_in===0&&r===o?1:0,_tr_stored_block(n,n.block_start,r,l),n.block_start+=r,flush_pending(n.strm)),l?BS_FINISH_STARTED:BS_NEED_MORE)},deflate_fast=(n,t)=>{let e,r;for(;;){if(n.lookahead<MIN_LOOKAHEAD){if(fill_window(n),n.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(n.lookahead===0)break}if(e=0,n.lookahead>=MIN_MATCH&&(n.ins_h=HASH(n,n.ins_h,n.window[n.strstart+MIN_MATCH-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),e!==0&&n.strstart-e<=n.w_size-MIN_LOOKAHEAD&&(n.match_length=longest_match(n,e)),n.match_length>=MIN_MATCH)if(r=_tr_tally(n,n.strstart-n.match_start,n.match_length-MIN_MATCH),n.lookahead-=n.match_length,n.match_length<=n.max_lazy_match&&n.lookahead>=MIN_MATCH){n.match_length--;do n.strstart++,n.ins_h=HASH(n,n.ins_h,n.window[n.strstart+MIN_MATCH-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart;while(--n.match_length!==0);n.strstart++}else n.strstart+=n.match_length,n.match_length=0,n.ins_h=n.window[n.strstart],n.ins_h=HASH(n,n.ins_h,n.window[n.strstart+1]);else r=_tr_tally(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++;if(r&&(flush_block_only(n,!1),n.strm.avail_out===0))return BS_NEED_MORE}return n.insert=n.strstart<MIN_MATCH-1?n.strstart:MIN_MATCH-1,t===Z_FINISH$3?(flush_block_only(n,!0),n.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):n.sym_next&&(flush_block_only(n,!1),n.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_slow=(n,t)=>{let e,r,o;for(;;){if(n.lookahead<MIN_LOOKAHEAD){if(fill_window(n),n.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(n.lookahead===0)break}if(e=0,n.lookahead>=MIN_MATCH&&(n.ins_h=HASH(n,n.ins_h,n.window[n.strstart+MIN_MATCH-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),n.prev_length=n.match_length,n.prev_match=n.match_start,n.match_length=MIN_MATCH-1,e!==0&&n.prev_length<n.max_lazy_match&&n.strstart-e<=n.w_size-MIN_LOOKAHEAD&&(n.match_length=longest_match(n,e),n.match_length<=5&&(n.strategy===Z_FILTERED||n.match_length===MIN_MATCH&&n.strstart-n.match_start>4096)&&(n.match_length=MIN_MATCH-1)),n.prev_length>=MIN_MATCH&&n.match_length<=n.prev_length){o=n.strstart+n.lookahead-MIN_MATCH,r=_tr_tally(n,n.strstart-1-n.prev_match,n.prev_length-MIN_MATCH),n.lookahead-=n.prev_length-1,n.prev_length-=2;do++n.strstart<=o&&(n.ins_h=HASH(n,n.ins_h,n.window[n.strstart+MIN_MATCH-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart);while(--n.prev_length!==0);if(n.match_available=0,n.match_length=MIN_MATCH-1,n.strstart++,r&&(flush_block_only(n,!1),n.strm.avail_out===0))return BS_NEED_MORE}else if(n.match_available){if(r=_tr_tally(n,0,n.window[n.strstart-1]),r&&flush_block_only(n,!1),n.strstart++,n.lookahead--,n.strm.avail_out===0)return BS_NEED_MORE}else n.match_available=1,n.strstart++,n.lookahead--}return n.match_available&&(r=_tr_tally(n,0,n.window[n.strstart-1]),n.match_available=0),n.insert=n.strstart<MIN_MATCH-1?n.strstart:MIN_MATCH-1,t===Z_FINISH$3?(flush_block_only(n,!0),n.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):n.sym_next&&(flush_block_only(n,!1),n.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_rle=(n,t)=>{let e,r,o,s;const l=n.window;for(;;){if(n.lookahead<=MAX_MATCH){if(fill_window(n),n.lookahead<=MAX_MATCH&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(n.lookahead===0)break}if(n.match_length=0,n.lookahead>=MIN_MATCH&&n.strstart>0&&(o=n.strstart-1,r=l[o],r===l[++o]&&r===l[++o]&&r===l[++o])){s=n.strstart+MAX_MATCH;do;while(r===l[++o]&&r===l[++o]&&r===l[++o]&&r===l[++o]&&r===l[++o]&&r===l[++o]&&r===l[++o]&&r===l[++o]&&o<s);n.match_length=MAX_MATCH-(s-o),n.match_length>n.lookahead&&(n.match_length=n.lookahead)}if(n.match_length>=MIN_MATCH?(e=_tr_tally(n,1,n.match_length-MIN_MATCH),n.lookahead-=n.match_length,n.strstart+=n.match_length,n.match_length=0):(e=_tr_tally(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++),e&&(flush_block_only(n,!1),n.strm.avail_out===0))return BS_NEED_MORE}return n.insert=0,t===Z_FINISH$3?(flush_block_only(n,!0),n.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):n.sym_next&&(flush_block_only(n,!1),n.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_huff=(n,t)=>{let e;for(;;){if(n.lookahead===0&&(fill_window(n),n.lookahead===0)){if(t===Z_NO_FLUSH$2)return BS_NEED_MORE;break}if(n.match_length=0,e=_tr_tally(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++,e&&(flush_block_only(n,!1),n.strm.avail_out===0))return BS_NEED_MORE}return n.insert=0,t===Z_FINISH$3?(flush_block_only(n,!0),n.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):n.sym_next&&(flush_block_only(n,!1),n.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE};function Config(n,t,e,r,o){this.good_length=n,this.max_lazy=t,this.nice_length=e,this.max_chain=r,this.func=o}const configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],lm_init=n=>{n.window_size=2*n.w_size,zero(n.head),n.max_lazy_match=configuration_table[n.level].max_lazy,n.good_match=configuration_table[n.level].good_length,n.nice_match=configuration_table[n.level].nice_length,n.max_chain_length=configuration_table[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=MIN_MATCH-1,n.match_available=0,n.ins_h=0};function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED$2,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(HEAP_SIZE*2),this.dyn_dtree=new Uint16Array((2*D_CODES+1)*2),this.bl_tree=new Uint16Array((2*BL_CODES+1)*2),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(MAX_BITS+1),this.heap=new Uint16Array(2*L_CODES+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*L_CODES+1),zero(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const deflateStateCheck=n=>{if(!n)return 1;const t=n.state;return!t||t.strm!==n||t.status!==INIT_STATE&&t.status!==GZIP_STATE&&t.status!==EXTRA_STATE&&t.status!==NAME_STATE&&t.status!==COMMENT_STATE&&t.status!==HCRC_STATE&&t.status!==BUSY_STATE&&t.status!==FINISH_STATE?1:0},deflateResetKeep=n=>{if(deflateStateCheck(n))return err(n,Z_STREAM_ERROR$2);n.total_in=n.total_out=0,n.data_type=Z_UNKNOWN;const t=n.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?GZIP_STATE:t.wrap?INIT_STATE:BUSY_STATE,n.adler=t.wrap===2?0:1,t.last_flush=-2,_tr_init(t),Z_OK$3},deflateReset=n=>{const t=deflateResetKeep(n);return t===Z_OK$3&&lm_init(n.state),t},deflateSetHeader=(n,t)=>deflateStateCheck(n)||n.state.wrap!==2?Z_STREAM_ERROR$2:(n.state.gzhead=t,Z_OK$3),deflateInit2=(n,t,e,r,o,s)=>{if(!n)return Z_STREAM_ERROR$2;let l=1;if(t===Z_DEFAULT_COMPRESSION$1&&(t=6),r<0?(l=0,r=-r):r>15&&(l=2,r-=16),o<1||o>MAX_MEM_LEVEL||e!==Z_DEFLATED$2||r<8||r>15||t<0||t>9||s<0||s>Z_FIXED||r===8&&l!==1)return err(n,Z_STREAM_ERROR$2);r===8&&(r=9);const a=new DeflateState;return n.state=a,a.strm=n,a.status=INIT_STATE,a.wrap=l,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=o+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+MIN_MATCH-1)/MIN_MATCH),a.window=new Uint8Array(a.w_size*2),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<o+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=(a.lit_bufsize-1)*3,a.level=t,a.strategy=s,a.method=e,deflateReset(n)},deflateInit=(n,t)=>deflateInit2(n,t,Z_DEFLATED$2,MAX_WBITS$1,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY$1),deflate$2=(n,t)=>{if(deflateStateCheck(n)||t>Z_BLOCK$1||t<0)return n?err(n,Z_STREAM_ERROR$2):Z_STREAM_ERROR$2;const e=n.state;if(!n.output||n.avail_in!==0&&!n.input||e.status===FINISH_STATE&&t!==Z_FINISH$3)return err(n,n.avail_out===0?Z_BUF_ERROR$1:Z_STREAM_ERROR$2);const r=e.last_flush;if(e.last_flush=t,e.pending!==0){if(flush_pending(n),n.avail_out===0)return e.last_flush=-1,Z_OK$3}else if(n.avail_in===0&&rank(t)<=rank(r)&&t!==Z_FINISH$3)return err(n,Z_BUF_ERROR$1);if(e.status===FINISH_STATE&&n.avail_in!==0)return err(n,Z_BUF_ERROR$1);if(e.status===INIT_STATE&&e.wrap===0&&(e.status=BUSY_STATE),e.status===INIT_STATE){let o=Z_DEFLATED$2+(e.w_bits-8<<4)<<8,s=-1;if(e.strategy>=Z_HUFFMAN_ONLY||e.level<2?s=0:e.level<6?s=1:e.level===6?s=2:s=3,o|=s<<6,e.strstart!==0&&(o|=PRESET_DICT),o+=31-o%31,putShortMSB(e,o),e.strstart!==0&&(putShortMSB(e,n.adler>>>16),putShortMSB(e,n.adler&65535)),n.adler=1,e.status=BUSY_STATE,flush_pending(n),e.pending!==0)return e.last_flush=-1,Z_OK$3}if(e.status===GZIP_STATE){if(n.adler=0,put_byte(e,31),put_byte(e,139),put_byte(e,8),e.gzhead)put_byte(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),put_byte(e,e.gzhead.time&255),put_byte(e,e.gzhead.time>>8&255),put_byte(e,e.gzhead.time>>16&255),put_byte(e,e.gzhead.time>>24&255),put_byte(e,e.level===9?2:e.strategy>=Z_HUFFMAN_ONLY||e.level<2?4:0),put_byte(e,e.gzhead.os&255),e.gzhead.extra&&e.gzhead.extra.length&&(put_byte(e,e.gzhead.extra.length&255),put_byte(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(n.adler=crc32_1(n.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=EXTRA_STATE;else if(put_byte(e,0),put_byte(e,0),put_byte(e,0),put_byte(e,0),put_byte(e,0),put_byte(e,e.level===9?2:e.strategy>=Z_HUFFMAN_ONLY||e.level<2?4:0),put_byte(e,OS_CODE),e.status=BUSY_STATE,flush_pending(n),e.pending!==0)return e.last_flush=-1,Z_OK$3}if(e.status===EXTRA_STATE){if(e.gzhead.extra){let o=e.pending,s=(e.gzhead.extra.length&65535)-e.gzindex;for(;e.pending+s>e.pending_buf_size;){let a=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+a),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>o&&(n.adler=crc32_1(n.adler,e.pending_buf,e.pending-o,o)),e.gzindex+=a,flush_pending(n),e.pending!==0)return e.last_flush=-1,Z_OK$3;o=0,s-=a}let l=new Uint8Array(e.gzhead.extra);e.pending_buf.set(l.subarray(e.gzindex,e.gzindex+s),e.pending),e.pending+=s,e.gzhead.hcrc&&e.pending>o&&(n.adler=crc32_1(n.adler,e.pending_buf,e.pending-o,o)),e.gzindex=0}e.status=NAME_STATE}if(e.status===NAME_STATE){if(e.gzhead.name){let o=e.pending,s;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>o&&(n.adler=crc32_1(n.adler,e.pending_buf,e.pending-o,o)),flush_pending(n),e.pending!==0)return e.last_flush=-1,Z_OK$3;o=0}e.gzindex<e.gzhead.name.length?s=e.gzhead.name.charCodeAt(e.gzindex++)&255:s=0,put_byte(e,s)}while(s!==0);e.gzhead.hcrc&&e.pending>o&&(n.adler=crc32_1(n.adler,e.pending_buf,e.pending-o,o)),e.gzindex=0}e.status=COMMENT_STATE}if(e.status===COMMENT_STATE){if(e.gzhead.comment){let o=e.pending,s;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>o&&(n.adler=crc32_1(n.adler,e.pending_buf,e.pending-o,o)),flush_pending(n),e.pending!==0)return e.last_flush=-1,Z_OK$3;o=0}e.gzindex<e.gzhead.comment.length?s=e.gzhead.comment.charCodeAt(e.gzindex++)&255:s=0,put_byte(e,s)}while(s!==0);e.gzhead.hcrc&&e.pending>o&&(n.adler=crc32_1(n.adler,e.pending_buf,e.pending-o,o))}e.status=HCRC_STATE}if(e.status===HCRC_STATE){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(flush_pending(n),e.pending!==0))return e.last_flush=-1,Z_OK$3;put_byte(e,n.adler&255),put_byte(e,n.adler>>8&255),n.adler=0}if(e.status=BUSY_STATE,flush_pending(n),e.pending!==0)return e.last_flush=-1,Z_OK$3}if(n.avail_in!==0||e.lookahead!==0||t!==Z_NO_FLUSH$2&&e.status!==FINISH_STATE){let o=e.level===0?deflate_stored(e,t):e.strategy===Z_HUFFMAN_ONLY?deflate_huff(e,t):e.strategy===Z_RLE?deflate_rle(e,t):configuration_table[e.level].func(e,t);if((o===BS_FINISH_STARTED||o===BS_FINISH_DONE)&&(e.status=FINISH_STATE),o===BS_NEED_MORE||o===BS_FINISH_STARTED)return n.avail_out===0&&(e.last_flush=-1),Z_OK$3;if(o===BS_BLOCK_DONE&&(t===Z_PARTIAL_FLUSH?_tr_align(e):t!==Z_BLOCK$1&&(_tr_stored_block(e,0,0,!1),t===Z_FULL_FLUSH$1&&(zero(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),flush_pending(n),n.avail_out===0))return e.last_flush=-1,Z_OK$3}return t!==Z_FINISH$3?Z_OK$3:e.wrap<=0?Z_STREAM_END$3:(e.wrap===2?(put_byte(e,n.adler&255),put_byte(e,n.adler>>8&255),put_byte(e,n.adler>>16&255),put_byte(e,n.adler>>24&255),put_byte(e,n.total_in&255),put_byte(e,n.total_in>>8&255),put_byte(e,n.total_in>>16&255),put_byte(e,n.total_in>>24&255)):(putShortMSB(e,n.adler>>>16),putShortMSB(e,n.adler&65535)),flush_pending(n),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?Z_OK$3:Z_STREAM_END$3)},deflateEnd=n=>{if(deflateStateCheck(n))return Z_STREAM_ERROR$2;const t=n.state.status;return n.state=null,t===BUSY_STATE?err(n,Z_DATA_ERROR$2):Z_OK$3},deflateSetDictionary=(n,t)=>{let e=t.length;if(deflateStateCheck(n))return Z_STREAM_ERROR$2;const r=n.state,o=r.wrap;if(o===2||o===1&&r.status!==INIT_STATE||r.lookahead)return Z_STREAM_ERROR$2;if(o===1&&(n.adler=adler32_1(n.adler,t,e,0)),r.wrap=0,e>=r.w_size){o===0&&(zero(r.head),r.strstart=0,r.block_start=0,r.insert=0);let h=new Uint8Array(r.w_size);h.set(t.subarray(e-r.w_size,e),0),t=h,e=r.w_size}const s=n.avail_in,l=n.next_in,a=n.input;for(n.avail_in=e,n.next_in=0,n.input=t,fill_window(r);r.lookahead>=MIN_MATCH;){let h=r.strstart,y=r.lookahead-(MIN_MATCH-1);do r.ins_h=HASH(r,r.ins_h,r.window[h+MIN_MATCH-1]),r.prev[h&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=h,h++;while(--y);r.strstart=h,r.lookahead=MIN_MATCH-1,fill_window(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=MIN_MATCH-1,r.match_available=0,n.next_in=l,n.input=a,n.avail_in=s,r.wrap=o,Z_OK$3};var deflateInit_1=deflateInit,deflateInit2_1=deflateInit2,deflateReset_1=deflateReset,deflateResetKeep_1=deflateResetKeep,deflateSetHeader_1=deflateSetHeader,deflate_2$1=deflate$2,deflateEnd_1=deflateEnd,deflateSetDictionary_1=deflateSetDictionary,deflateInfo="pako deflate (from Nodeca project)",deflate_1$2={deflateInit:deflateInit_1,deflateInit2:deflateInit2_1,deflateReset:deflateReset_1,deflateResetKeep:deflateResetKeep_1,deflateSetHeader:deflateSetHeader_1,deflate:deflate_2$1,deflateEnd:deflateEnd_1,deflateSetDictionary:deflateSetDictionary_1,deflateInfo};const _has=(n,t)=>Object.prototype.hasOwnProperty.call(n,t);var assign=function(n){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const e=t.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const r in e)_has(e,r)&&(n[r]=e[r])}}return n},flattenChunks=n=>{let t=0;for(let r=0,o=n.length;r<o;r++)t+=n[r].length;const e=new Uint8Array(t);for(let r=0,o=0,s=n.length;r<s;r++){let l=n[r];e.set(l,o),o+=l.length}return e},common={assign,flattenChunks};let STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{STR_APPLY_UIA_OK=!1}const _utf8len=new Uint8Array(256);for(let n=0;n<256;n++)_utf8len[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;_utf8len[254]=_utf8len[254]=1;var string2buf=n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let t,e,r,o,s,l=n.length,a=0;for(o=0;o<l;o++)e=n.charCodeAt(o),(e&64512)===55296&&o+1<l&&(r=n.charCodeAt(o+1),(r&64512)===56320&&(e=65536+(e-55296<<10)+(r-56320),o++)),a+=e<128?1:e<2048?2:e<65536?3:4;for(t=new Uint8Array(a),s=0,o=0;s<a;o++)e=n.charCodeAt(o),(e&64512)===55296&&o+1<l&&(r=n.charCodeAt(o+1),(r&64512)===56320&&(e=65536+(e-55296<<10)+(r-56320),o++)),e<128?t[s++]=e:e<2048?(t[s++]=192|e>>>6,t[s++]=128|e&63):e<65536?(t[s++]=224|e>>>12,t[s++]=128|e>>>6&63,t[s++]=128|e&63):(t[s++]=240|e>>>18,t[s++]=128|e>>>12&63,t[s++]=128|e>>>6&63,t[s++]=128|e&63);return t};const buf2binstring=(n,t)=>{if(t<65534&&n.subarray&&STR_APPLY_UIA_OK)return String.fromCharCode.apply(null,n.length===t?n:n.subarray(0,t));let e="";for(let r=0;r<t;r++)e+=String.fromCharCode(n[r]);return e};var buf2string=(n,t)=>{const e=t||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,t));let r,o;const s=new Array(e*2);for(o=0,r=0;r<e;){let l=n[r++];if(l<128){s[o++]=l;continue}let a=_utf8len[l];if(a>4){s[o++]=65533,r+=a-1;continue}for(l&=a===2?31:a===3?15:7;a>1&&r<e;)l=l<<6|n[r++]&63,a--;if(a>1){s[o++]=65533;continue}l<65536?s[o++]=l:(l-=65536,s[o++]=55296|l>>10&1023,s[o++]=56320|l&1023)}return buf2binstring(s,o)},utf8border=(n,t)=>{t=t||n.length,t>n.length&&(t=n.length);let e=t-1;for(;e>=0&&(n[e]&192)===128;)e--;return e<0||e===0?t:e+_utf8len[n[e]]>t?e:t},strings={string2buf,buf2string,utf8border};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream=ZStream;const toString$1$1=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$1,Z_SYNC_FLUSH,Z_FULL_FLUSH,Z_FINISH:Z_FINISH$2,Z_OK:Z_OK$2,Z_STREAM_END:Z_STREAM_END$2,Z_DEFAULT_COMPRESSION,Z_DEFAULT_STRATEGY,Z_DEFLATED:Z_DEFLATED$1}=constants$2;function Deflate$1(n){this.options=common.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY},n||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let e=deflate_1$2.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(e!==Z_OK$2)throw new Error(messages[e]);if(t.header&&deflate_1$2.deflateSetHeader(this.strm,t.header),t.dictionary){let r;if(typeof t.dictionary=="string"?r=strings.string2buf(t.dictionary):toString$1$1.call(t.dictionary)==="[object ArrayBuffer]"?r=new Uint8Array(t.dictionary):r=t.dictionary,e=deflate_1$2.deflateSetDictionary(this.strm,r),e!==Z_OK$2)throw new Error(messages[e]);this._dict_set=!0}}Deflate$1.prototype.push=function(n,t){const e=this.strm,r=this.options.chunkSize;let o,s;if(this.ended)return!1;for(t===~~t?s=t:s=t===!0?Z_FINISH$2:Z_NO_FLUSH$1,typeof n=="string"?e.input=strings.string2buf(n):toString$1$1.call(n)==="[object ArrayBuffer]"?e.input=new Uint8Array(n):e.input=n,e.next_in=0,e.avail_in=e.input.length;;){if(e.avail_out===0&&(e.output=new Uint8Array(r),e.next_out=0,e.avail_out=r),(s===Z_SYNC_FLUSH||s===Z_FULL_FLUSH)&&e.avail_out<=6){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(o=deflate_1$2.deflate(e,s),o===Z_STREAM_END$2)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),o=deflate_1$2.deflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===Z_OK$2;if(e.avail_out===0){this.onData(e.output);continue}if(s>0&&e.next_out>0){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(e.avail_in===0)break}return!0};Deflate$1.prototype.onData=function(n){this.chunks.push(n)};Deflate$1.prototype.onEnd=function(n){n===Z_OK$2&&(this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};function deflate$1(n,t){const e=new Deflate$1(t);if(e.push(n,!0),e.err)throw e.msg||messages[e.err];return e.result}function deflateRaw$1(n,t){return t=t||{},t.raw=!0,deflate$1(n,t)}function gzip$1(n,t){return t=t||{},t.gzip=!0,deflate$1(n,t)}var Deflate_1$1=Deflate$1,deflate_2=deflate$1,deflateRaw_1$1=deflateRaw$1,gzip_1$1=gzip$1,constants$1=constants$2,deflate_1$1={Deflate:Deflate_1$1,deflate:deflate_2,deflateRaw:deflateRaw_1$1,gzip:gzip_1$1,constants:constants$1};const BAD$1=16209,TYPE$1=16191;var inffast=function(t,e){let r,o,s,l,a,h,y,C,L,Y,ze,Bt,Ir,Wr,yi,Bn,vi,wo,ia,gl,ml,il,sl,ol;const _l=t.state;r=t.next_in,sl=t.input,o=r+(t.avail_in-5),s=t.next_out,ol=t.output,l=s-(e-t.avail_out),a=s+(t.avail_out-257),h=_l.dmax,y=_l.wsize,C=_l.whave,L=_l.wnext,Y=_l.window,ze=_l.hold,Bt=_l.bits,Ir=_l.lencode,Wr=_l.distcode,yi=(1<<_l.lenbits)-1,Bn=(1<<_l.distbits)-1;e:do{Bt<15&&(ze+=sl[r++]<<Bt,Bt+=8,ze+=sl[r++]<<Bt,Bt+=8),vi=Ir[ze&yi];t:for(;;){if(wo=vi>>>24,ze>>>=wo,Bt-=wo,wo=vi>>>16&255,wo===0)ol[s++]=vi&65535;else if(wo&16){ia=vi&65535,wo&=15,wo&&(Bt<wo&&(ze+=sl[r++]<<Bt,Bt+=8),ia+=ze&(1<<wo)-1,ze>>>=wo,Bt-=wo),Bt<15&&(ze+=sl[r++]<<Bt,Bt+=8,ze+=sl[r++]<<Bt,Bt+=8),vi=Wr[ze&Bn];r:for(;;){if(wo=vi>>>24,ze>>>=wo,Bt-=wo,wo=vi>>>16&255,wo&16){if(gl=vi&65535,wo&=15,Bt<wo&&(ze+=sl[r++]<<Bt,Bt+=8,Bt<wo&&(ze+=sl[r++]<<Bt,Bt+=8)),gl+=ze&(1<<wo)-1,gl>h){t.msg="invalid distance too far back",_l.mode=BAD$1;break e}if(ze>>>=wo,Bt-=wo,wo=s-l,gl>wo){if(wo=gl-wo,wo>C&&_l.sane){t.msg="invalid distance too far back",_l.mode=BAD$1;break e}if(ml=0,il=Y,L===0){if(ml+=y-wo,wo<ia){ia-=wo;do ol[s++]=Y[ml++];while(--wo);ml=s-gl,il=ol}}else if(L<wo){if(ml+=y+L-wo,wo-=L,wo<ia){ia-=wo;do ol[s++]=Y[ml++];while(--wo);if(ml=0,L<ia){wo=L,ia-=wo;do ol[s++]=Y[ml++];while(--wo);ml=s-gl,il=ol}}}else if(ml+=L-wo,wo<ia){ia-=wo;do ol[s++]=Y[ml++];while(--wo);ml=s-gl,il=ol}for(;ia>2;)ol[s++]=il[ml++],ol[s++]=il[ml++],ol[s++]=il[ml++],ia-=3;ia&&(ol[s++]=il[ml++],ia>1&&(ol[s++]=il[ml++]))}else{ml=s-gl;do ol[s++]=ol[ml++],ol[s++]=ol[ml++],ol[s++]=ol[ml++],ia-=3;while(ia>2);ia&&(ol[s++]=ol[ml++],ia>1&&(ol[s++]=ol[ml++]))}}else if(wo&64){t.msg="invalid distance code",_l.mode=BAD$1;break e}else{vi=Wr[(vi&65535)+(ze&(1<<wo)-1)];continue r}break}}else if(wo&64)if(wo&32){_l.mode=TYPE$1;break e}else{t.msg="invalid literal/length code",_l.mode=BAD$1;break e}else{vi=Ir[(vi&65535)+(ze&(1<<wo)-1)];continue t}break}}while(r<o&&s<a);ia=Bt>>3,r-=ia,Bt-=ia<<3,ze&=(1<<Bt)-1,t.next_in=r,t.next_out=s,t.avail_in=r<o?5+(o-r):5-(r-o),t.avail_out=s<a?257+(a-s):257-(s-a),_l.hold=ze,_l.bits=Bt};const MAXBITS=15,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,CODES$1=0,LENS$1=1,DISTS$1=2,lbase=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lext=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dbase=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dext=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),inflate_table=(n,t,e,r,o,s,l,a)=>{const h=a.bits;let y=0,C=0,L=0,Y=0,ze=0,Bt=0,Ir=0,Wr=0,yi=0,Bn=0,vi,wo,ia,gl,ml,il=null,sl;const ol=new Uint16Array(MAXBITS+1),_l=new Uint16Array(MAXBITS+1);let rh=null,wh,Fh,Mh;for(y=0;y<=MAXBITS;y++)ol[y]=0;for(C=0;C<r;C++)ol[t[e+C]]++;for(ze=h,Y=MAXBITS;Y>=1&&ol[Y]===0;Y--);if(ze>Y&&(ze=Y),Y===0)return o[s++]=1<<24|64<<16|0,o[s++]=1<<24|64<<16|0,a.bits=1,0;for(L=1;L<Y&&ol[L]===0;L++);for(ze<L&&(ze=L),Wr=1,y=1;y<=MAXBITS;y++)if(Wr<<=1,Wr-=ol[y],Wr<0)return-1;if(Wr>0&&(n===CODES$1||Y!==1))return-1;for(_l[1]=0,y=1;y<MAXBITS;y++)_l[y+1]=_l[y]+ol[y];for(C=0;C<r;C++)t[e+C]!==0&&(l[_l[t[e+C]]++]=C);if(n===CODES$1?(il=rh=l,sl=20):n===LENS$1?(il=lbase,rh=lext,sl=257):(il=dbase,rh=dext,sl=0),Bn=0,C=0,y=L,ml=s,Bt=ze,Ir=0,ia=-1,yi=1<<ze,gl=yi-1,n===LENS$1&&yi>ENOUGH_LENS$1||n===DISTS$1&&yi>ENOUGH_DISTS$1)return 1;for(;;){wh=y-Ir,l[C]+1<sl?(Fh=0,Mh=l[C]):l[C]>=sl?(Fh=rh[l[C]-sl],Mh=il[l[C]-sl]):(Fh=32+64,Mh=0),vi=1<<y-Ir,wo=1<<Bt,L=wo;do wo-=vi,o[ml+(Bn>>Ir)+wo]=wh<<24|Fh<<16|Mh|0;while(wo!==0);for(vi=1<<y-1;Bn&vi;)vi>>=1;if(vi!==0?(Bn&=vi-1,Bn+=vi):Bn=0,C++,--ol[y]===0){if(y===Y)break;y=t[e+l[C]]}if(y>ze&&(Bn&gl)!==ia){for(Ir===0&&(Ir=ze),ml+=L,Bt=y-Ir,Wr=1<<Bt;Bt+Ir<Y&&(Wr-=ol[Bt+Ir],!(Wr<=0));)Bt++,Wr<<=1;if(yi+=1<<Bt,n===LENS$1&&yi>ENOUGH_LENS$1||n===DISTS$1&&yi>ENOUGH_DISTS$1)return 1;ia=Bn&gl,o[ia]=ze<<24|Bt<<16|ml-s|0}}return Bn!==0&&(o[ml+Bn]=y-Ir<<24|64<<16|0),a.bits=ze,0};var inftrees=inflate_table;const CODES=0,LENS=1,DISTS=2,{Z_FINISH:Z_FINISH$1,Z_BLOCK,Z_TREES,Z_OK:Z_OK$1,Z_STREAM_END:Z_STREAM_END$1,Z_NEED_DICT:Z_NEED_DICT$1,Z_STREAM_ERROR:Z_STREAM_ERROR$1,Z_DATA_ERROR:Z_DATA_ERROR$1,Z_MEM_ERROR:Z_MEM_ERROR$1,Z_BUF_ERROR,Z_DEFLATED}=constants$2,HEAD=16180,FLAGS=16181,TIME=16182,OS=16183,EXLEN=16184,EXTRA=16185,NAME=16186,COMMENT=16187,HCRC=16188,DICTID=16189,DICT=16190,TYPE=16191,TYPEDO=16192,STORED=16193,COPY_=16194,COPY=16195,TABLE=16196,LENLENS=16197,CODELENS=16198,LEN_=16199,LEN=16200,LENEXT=16201,DIST=16202,DISTEXT=16203,MATCH=16204,LIT=16205,CHECK=16206,LENGTH=16207,DONE=16208,BAD=16209,MEM=16210,SYNC=16211,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS,zswap32=n=>(n>>>24&255)+(n>>>8&65280)+((n&65280)<<8)+((n&255)<<24);function InflateState(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const inflateStateCheck=n=>{if(!n)return 1;const t=n.state;return!t||t.strm!==n||t.mode<HEAD||t.mode>SYNC?1:0},inflateResetKeep=n=>{if(inflateStateCheck(n))return Z_STREAM_ERROR$1;const t=n.state;return n.total_in=n.total_out=t.total=0,n.msg="",t.wrap&&(n.adler=t.wrap&1),t.mode=HEAD,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(ENOUGH_LENS),t.distcode=t.distdyn=new Int32Array(ENOUGH_DISTS),t.sane=1,t.back=-1,Z_OK$1},inflateReset=n=>{if(inflateStateCheck(n))return Z_STREAM_ERROR$1;const t=n.state;return t.wsize=0,t.whave=0,t.wnext=0,inflateResetKeep(n)},inflateReset2=(n,t)=>{let e;if(inflateStateCheck(n))return Z_STREAM_ERROR$1;const r=n.state;return t<0?(e=0,t=-t):(e=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?Z_STREAM_ERROR$1:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=e,r.wbits=t,inflateReset(n))},inflateInit2=(n,t)=>{if(!n)return Z_STREAM_ERROR$1;const e=new InflateState;n.state=e,e.strm=n,e.window=null,e.mode=HEAD;const r=inflateReset2(n,t);return r!==Z_OK$1&&(n.state=null),r},inflateInit=n=>inflateInit2(n,DEF_WBITS);let virgin=!0,lenfix,distfix;const fixedtables=n=>{if(virgin){lenfix=new Int32Array(512),distfix=new Int32Array(32);let t=0;for(;t<144;)n.lens[t++]=8;for(;t<256;)n.lens[t++]=9;for(;t<280;)n.lens[t++]=7;for(;t<288;)n.lens[t++]=8;for(inftrees(LENS,n.lens,0,288,lenfix,0,n.work,{bits:9}),t=0;t<32;)n.lens[t++]=5;inftrees(DISTS,n.lens,0,32,distfix,0,n.work,{bits:5}),virgin=!1}n.lencode=lenfix,n.lenbits=9,n.distcode=distfix,n.distbits=5},updatewindow=(n,t,e,r)=>{let o;const s=n.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(t.subarray(e-s.wsize,e),0),s.wnext=0,s.whave=s.wsize):(o=s.wsize-s.wnext,o>r&&(o=r),s.window.set(t.subarray(e-r,e-r+o),s.wnext),r-=o,r?(s.window.set(t.subarray(e-r,e),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=o,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=o))),0},inflate$2=(n,t)=>{let e,r,o,s,l,a,h,y,C,L,Y,ze,Bt,Ir,Wr=0,yi,Bn,vi,wo,ia,gl,ml,il;const sl=new Uint8Array(4);let ol,_l;const rh=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(inflateStateCheck(n)||!n.output||!n.input&&n.avail_in!==0)return Z_STREAM_ERROR$1;e=n.state,e.mode===TYPE&&(e.mode=TYPEDO),l=n.next_out,o=n.output,h=n.avail_out,s=n.next_in,r=n.input,a=n.avail_in,y=e.hold,C=e.bits,L=a,Y=h,il=Z_OK$1;e:for(;;)switch(e.mode){case HEAD:if(e.wrap===0){e.mode=TYPEDO;break}for(;C<16;){if(a===0)break e;a--,y+=r[s++]<<C,C+=8}if(e.wrap&2&&y===35615){e.wbits===0&&(e.wbits=15),e.check=0,sl[0]=y&255,sl[1]=y>>>8&255,e.check=crc32_1(e.check,sl,2,0),y=0,C=0,e.mode=FLAGS;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((y&255)<<8)+(y>>8))%31){n.msg="incorrect header check",e.mode=BAD;break}if((y&15)!==Z_DEFLATED){n.msg="unknown compression method",e.mode=BAD;break}if(y>>>=4,C-=4,ml=(y&15)+8,e.wbits===0&&(e.wbits=ml),ml>15||ml>e.wbits){n.msg="invalid window size",e.mode=BAD;break}e.dmax=1<<e.wbits,e.flags=0,n.adler=e.check=1,e.mode=y&512?DICTID:TYPE,y=0,C=0;break;case FLAGS:for(;C<16;){if(a===0)break e;a--,y+=r[s++]<<C,C+=8}if(e.flags=y,(e.flags&255)!==Z_DEFLATED){n.msg="unknown compression method",e.mode=BAD;break}if(e.flags&57344){n.msg="unknown header flags set",e.mode=BAD;break}e.head&&(e.head.text=y>>8&1),e.flags&512&&e.wrap&4&&(sl[0]=y&255,sl[1]=y>>>8&255,e.check=crc32_1(e.check,sl,2,0)),y=0,C=0,e.mode=TIME;case TIME:for(;C<32;){if(a===0)break e;a--,y+=r[s++]<<C,C+=8}e.head&&(e.head.time=y),e.flags&512&&e.wrap&4&&(sl[0]=y&255,sl[1]=y>>>8&255,sl[2]=y>>>16&255,sl[3]=y>>>24&255,e.check=crc32_1(e.check,sl,4,0)),y=0,C=0,e.mode=OS;case OS:for(;C<16;){if(a===0)break e;a--,y+=r[s++]<<C,C+=8}e.head&&(e.head.xflags=y&255,e.head.os=y>>8),e.flags&512&&e.wrap&4&&(sl[0]=y&255,sl[1]=y>>>8&255,e.check=crc32_1(e.check,sl,2,0)),y=0,C=0,e.mode=EXLEN;case EXLEN:if(e.flags&1024){for(;C<16;){if(a===0)break e;a--,y+=r[s++]<<C,C+=8}e.length=y,e.head&&(e.head.extra_len=y),e.flags&512&&e.wrap&4&&(sl[0]=y&255,sl[1]=y>>>8&255,e.check=crc32_1(e.check,sl,2,0)),y=0,C=0}else e.head&&(e.head.extra=null);e.mode=EXTRA;case EXTRA:if(e.flags&1024&&(ze=e.length,ze>a&&(ze=a),ze&&(e.head&&(ml=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(r.subarray(s,s+ze),ml)),e.flags&512&&e.wrap&4&&(e.check=crc32_1(e.check,r,ze,s)),a-=ze,s+=ze,e.length-=ze),e.length))break e;e.length=0,e.mode=NAME;case NAME:if(e.flags&2048){if(a===0)break e;ze=0;do ml=r[s+ze++],e.head&&ml&&e.length<65536&&(e.head.name+=String.fromCharCode(ml));while(ml&&ze<a);if(e.flags&512&&e.wrap&4&&(e.check=crc32_1(e.check,r,ze,s)),a-=ze,s+=ze,ml)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=COMMENT;case COMMENT:if(e.flags&4096){if(a===0)break e;ze=0;do ml=r[s+ze++],e.head&&ml&&e.length<65536&&(e.head.comment+=String.fromCharCode(ml));while(ml&&ze<a);if(e.flags&512&&e.wrap&4&&(e.check=crc32_1(e.check,r,ze,s)),a-=ze,s+=ze,ml)break e}else e.head&&(e.head.comment=null);e.mode=HCRC;case HCRC:if(e.flags&512){for(;C<16;){if(a===0)break e;a--,y+=r[s++]<<C,C+=8}if(e.wrap&4&&y!==(e.check&65535)){n.msg="header crc mismatch",e.mode=BAD;break}y=0,C=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),n.adler=e.check=0,e.mode=TYPE;break;case DICTID:for(;C<32;){if(a===0)break e;a--,y+=r[s++]<<C,C+=8}n.adler=e.check=zswap32(y),y=0,C=0,e.mode=DICT;case DICT:if(e.havedict===0)return n.next_out=l,n.avail_out=h,n.next_in=s,n.avail_in=a,e.hold=y,e.bits=C,Z_NEED_DICT$1;n.adler=e.check=1,e.mode=TYPE;case TYPE:if(t===Z_BLOCK||t===Z_TREES)break e;case TYPEDO:if(e.last){y>>>=C&7,C-=C&7,e.mode=CHECK;break}for(;C<3;){if(a===0)break e;a--,y+=r[s++]<<C,C+=8}switch(e.last=y&1,y>>>=1,C-=1,y&3){case 0:e.mode=STORED;break;case 1:if(fixedtables(e),e.mode=LEN_,t===Z_TREES){y>>>=2,C-=2;break e}break;case 2:e.mode=TABLE;break;case 3:n.msg="invalid block type",e.mode=BAD}y>>>=2,C-=2;break;case STORED:for(y>>>=C&7,C-=C&7;C<32;){if(a===0)break e;a--,y+=r[s++]<<C,C+=8}if((y&65535)!==(y>>>16^65535)){n.msg="invalid stored block lengths",e.mode=BAD;break}if(e.length=y&65535,y=0,C=0,e.mode=COPY_,t===Z_TREES)break e;case COPY_:e.mode=COPY;case COPY:if(ze=e.length,ze){if(ze>a&&(ze=a),ze>h&&(ze=h),ze===0)break e;o.set(r.subarray(s,s+ze),l),a-=ze,s+=ze,h-=ze,l+=ze,e.length-=ze;break}e.mode=TYPE;break;case TABLE:for(;C<14;){if(a===0)break e;a--,y+=r[s++]<<C,C+=8}if(e.nlen=(y&31)+257,y>>>=5,C-=5,e.ndist=(y&31)+1,y>>>=5,C-=5,e.ncode=(y&15)+4,y>>>=4,C-=4,e.nlen>286||e.ndist>30){n.msg="too many length or distance symbols",e.mode=BAD;break}e.have=0,e.mode=LENLENS;case LENLENS:for(;e.have<e.ncode;){for(;C<3;){if(a===0)break e;a--,y+=r[s++]<<C,C+=8}e.lens[rh[e.have++]]=y&7,y>>>=3,C-=3}for(;e.have<19;)e.lens[rh[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,ol={bits:e.lenbits},il=inftrees(CODES,e.lens,0,19,e.lencode,0,e.work,ol),e.lenbits=ol.bits,il){n.msg="invalid code lengths set",e.mode=BAD;break}e.have=0,e.mode=CODELENS;case CODELENS:for(;e.have<e.nlen+e.ndist;){for(;Wr=e.lencode[y&(1<<e.lenbits)-1],yi=Wr>>>24,Bn=Wr>>>16&255,vi=Wr&65535,!(yi<=C);){if(a===0)break e;a--,y+=r[s++]<<C,C+=8}if(vi<16)y>>>=yi,C-=yi,e.lens[e.have++]=vi;else{if(vi===16){for(_l=yi+2;C<_l;){if(a===0)break e;a--,y+=r[s++]<<C,C+=8}if(y>>>=yi,C-=yi,e.have===0){n.msg="invalid bit length repeat",e.mode=BAD;break}ml=e.lens[e.have-1],ze=3+(y&3),y>>>=2,C-=2}else if(vi===17){for(_l=yi+3;C<_l;){if(a===0)break e;a--,y+=r[s++]<<C,C+=8}y>>>=yi,C-=yi,ml=0,ze=3+(y&7),y>>>=3,C-=3}else{for(_l=yi+7;C<_l;){if(a===0)break e;a--,y+=r[s++]<<C,C+=8}y>>>=yi,C-=yi,ml=0,ze=11+(y&127),y>>>=7,C-=7}if(e.have+ze>e.nlen+e.ndist){n.msg="invalid bit length repeat",e.mode=BAD;break}for(;ze--;)e.lens[e.have++]=ml}}if(e.mode===BAD)break;if(e.lens[256]===0){n.msg="invalid code -- missing end-of-block",e.mode=BAD;break}if(e.lenbits=9,ol={bits:e.lenbits},il=inftrees(LENS,e.lens,0,e.nlen,e.lencode,0,e.work,ol),e.lenbits=ol.bits,il){n.msg="invalid literal/lengths set",e.mode=BAD;break}if(e.distbits=6,e.distcode=e.distdyn,ol={bits:e.distbits},il=inftrees(DISTS,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,ol),e.distbits=ol.bits,il){n.msg="invalid distances set",e.mode=BAD;break}if(e.mode=LEN_,t===Z_TREES)break e;case LEN_:e.mode=LEN;case LEN:if(a>=6&&h>=258){n.next_out=l,n.avail_out=h,n.next_in=s,n.avail_in=a,e.hold=y,e.bits=C,inffast(n,Y),l=n.next_out,o=n.output,h=n.avail_out,s=n.next_in,r=n.input,a=n.avail_in,y=e.hold,C=e.bits,e.mode===TYPE&&(e.back=-1);break}for(e.back=0;Wr=e.lencode[y&(1<<e.lenbits)-1],yi=Wr>>>24,Bn=Wr>>>16&255,vi=Wr&65535,!(yi<=C);){if(a===0)break e;a--,y+=r[s++]<<C,C+=8}if(Bn&&!(Bn&240)){for(wo=yi,ia=Bn,gl=vi;Wr=e.lencode[gl+((y&(1<<wo+ia)-1)>>wo)],yi=Wr>>>24,Bn=Wr>>>16&255,vi=Wr&65535,!(wo+yi<=C);){if(a===0)break e;a--,y+=r[s++]<<C,C+=8}y>>>=wo,C-=wo,e.back+=wo}if(y>>>=yi,C-=yi,e.back+=yi,e.length=vi,Bn===0){e.mode=LIT;break}if(Bn&32){e.back=-1,e.mode=TYPE;break}if(Bn&64){n.msg="invalid literal/length code",e.mode=BAD;break}e.extra=Bn&15,e.mode=LENEXT;case LENEXT:if(e.extra){for(_l=e.extra;C<_l;){if(a===0)break e;a--,y+=r[s++]<<C,C+=8}e.length+=y&(1<<e.extra)-1,y>>>=e.extra,C-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=DIST;case DIST:for(;Wr=e.distcode[y&(1<<e.distbits)-1],yi=Wr>>>24,Bn=Wr>>>16&255,vi=Wr&65535,!(yi<=C);){if(a===0)break e;a--,y+=r[s++]<<C,C+=8}if(!(Bn&240)){for(wo=yi,ia=Bn,gl=vi;Wr=e.distcode[gl+((y&(1<<wo+ia)-1)>>wo)],yi=Wr>>>24,Bn=Wr>>>16&255,vi=Wr&65535,!(wo+yi<=C);){if(a===0)break e;a--,y+=r[s++]<<C,C+=8}y>>>=wo,C-=wo,e.back+=wo}if(y>>>=yi,C-=yi,e.back+=yi,Bn&64){n.msg="invalid distance code",e.mode=BAD;break}e.offset=vi,e.extra=Bn&15,e.mode=DISTEXT;case DISTEXT:if(e.extra){for(_l=e.extra;C<_l;){if(a===0)break e;a--,y+=r[s++]<<C,C+=8}e.offset+=y&(1<<e.extra)-1,y>>>=e.extra,C-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){n.msg="invalid distance too far back",e.mode=BAD;break}e.mode=MATCH;case MATCH:if(h===0)break e;if(ze=Y-h,e.offset>ze){if(ze=e.offset-ze,ze>e.whave&&e.sane){n.msg="invalid distance too far back",e.mode=BAD;break}ze>e.wnext?(ze-=e.wnext,Bt=e.wsize-ze):Bt=e.wnext-ze,ze>e.length&&(ze=e.length),Ir=e.window}else Ir=o,Bt=l-e.offset,ze=e.length;ze>h&&(ze=h),h-=ze,e.length-=ze;do o[l++]=Ir[Bt++];while(--ze);e.length===0&&(e.mode=LEN);break;case LIT:if(h===0)break e;o[l++]=e.length,h--,e.mode=LEN;break;case CHECK:if(e.wrap){for(;C<32;){if(a===0)break e;a--,y|=r[s++]<<C,C+=8}if(Y-=h,n.total_out+=Y,e.total+=Y,e.wrap&4&&Y&&(n.adler=e.check=e.flags?crc32_1(e.check,o,Y,l-Y):adler32_1(e.check,o,Y,l-Y)),Y=h,e.wrap&4&&(e.flags?y:zswap32(y))!==e.check){n.msg="incorrect data check",e.mode=BAD;break}y=0,C=0}e.mode=LENGTH;case LENGTH:if(e.wrap&&e.flags){for(;C<32;){if(a===0)break e;a--,y+=r[s++]<<C,C+=8}if(e.wrap&4&&y!==(e.total&4294967295)){n.msg="incorrect length check",e.mode=BAD;break}y=0,C=0}e.mode=DONE;case DONE:il=Z_STREAM_END$1;break e;case BAD:il=Z_DATA_ERROR$1;break e;case MEM:return Z_MEM_ERROR$1;case SYNC:default:return Z_STREAM_ERROR$1}return n.next_out=l,n.avail_out=h,n.next_in=s,n.avail_in=a,e.hold=y,e.bits=C,(e.wsize||Y!==n.avail_out&&e.mode<BAD&&(e.mode<CHECK||t!==Z_FINISH$1))&&updatewindow(n,n.output,n.next_out,Y-n.avail_out),L-=n.avail_in,Y-=n.avail_out,n.total_in+=L,n.total_out+=Y,e.total+=Y,e.wrap&4&&Y&&(n.adler=e.check=e.flags?crc32_1(e.check,o,Y,n.next_out-Y):adler32_1(e.check,o,Y,n.next_out-Y)),n.data_type=e.bits+(e.last?64:0)+(e.mode===TYPE?128:0)+(e.mode===LEN_||e.mode===COPY_?256:0),(L===0&&Y===0||t===Z_FINISH$1)&&il===Z_OK$1&&(il=Z_BUF_ERROR),il},inflateEnd=n=>{if(inflateStateCheck(n))return Z_STREAM_ERROR$1;let t=n.state;return t.window&&(t.window=null),n.state=null,Z_OK$1},inflateGetHeader=(n,t)=>{if(inflateStateCheck(n))return Z_STREAM_ERROR$1;const e=n.state;return e.wrap&2?(e.head=t,t.done=!1,Z_OK$1):Z_STREAM_ERROR$1},inflateSetDictionary=(n,t)=>{const e=t.length;let r,o,s;return inflateStateCheck(n)||(r=n.state,r.wrap!==0&&r.mode!==DICT)?Z_STREAM_ERROR$1:r.mode===DICT&&(o=1,o=adler32_1(o,t,e,0),o!==r.check)?Z_DATA_ERROR$1:(s=updatewindow(n,t,e,e),s?(r.mode=MEM,Z_MEM_ERROR$1):(r.havedict=1,Z_OK$1))};var inflateReset_1=inflateReset,inflateReset2_1=inflateReset2,inflateResetKeep_1=inflateResetKeep,inflateInit_1=inflateInit,inflateInit2_1=inflateInit2,inflate_2$1=inflate$2,inflateEnd_1=inflateEnd,inflateGetHeader_1=inflateGetHeader,inflateSetDictionary_1=inflateSetDictionary,inflateInfo="pako inflate (from Nodeca project)",inflate_1$2={inflateReset:inflateReset_1,inflateReset2:inflateReset2_1,inflateResetKeep:inflateResetKeep_1,inflateInit:inflateInit_1,inflateInit2:inflateInit2_1,inflate:inflate_2$1,inflateEnd:inflateEnd_1,inflateGetHeader:inflateGetHeader_1,inflateSetDictionary:inflateSetDictionary_1,inflateInfo};function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader;const toString$2=Object.prototype.toString,{Z_NO_FLUSH,Z_FINISH,Z_OK,Z_STREAM_END,Z_NEED_DICT,Z_STREAM_ERROR,Z_DATA_ERROR,Z_MEM_ERROR}=constants$2;function Inflate$1(n){this.options=common.assign({chunkSize:1024*64,windowBits:15,to:""},n||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(n&&n.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let e=inflate_1$2.inflateInit2(this.strm,t.windowBits);if(e!==Z_OK)throw new Error(messages[e]);if(this.header=new gzheader,inflate_1$2.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=strings.string2buf(t.dictionary):toString$2.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=inflate_1$2.inflateSetDictionary(this.strm,t.dictionary),e!==Z_OK)))throw new Error(messages[e])}Inflate$1.prototype.push=function(n,t){const e=this.strm,r=this.options.chunkSize,o=this.options.dictionary;let s,l,a;if(this.ended)return!1;for(t===~~t?l=t:l=t===!0?Z_FINISH:Z_NO_FLUSH,toString$2.call(n)==="[object ArrayBuffer]"?e.input=new Uint8Array(n):e.input=n,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(r),e.next_out=0,e.avail_out=r),s=inflate_1$2.inflate(e,l),s===Z_NEED_DICT&&o&&(s=inflate_1$2.inflateSetDictionary(e,o),s===Z_OK?s=inflate_1$2.inflate(e,l):s===Z_DATA_ERROR&&(s=Z_NEED_DICT));e.avail_in>0&&s===Z_STREAM_END&&e.state.wrap>0&&n[e.next_in]!==0;)inflate_1$2.inflateReset(e),s=inflate_1$2.inflate(e,l);switch(s){case Z_STREAM_ERROR:case Z_DATA_ERROR:case Z_NEED_DICT:case Z_MEM_ERROR:return this.onEnd(s),this.ended=!0,!1}if(a=e.avail_out,e.next_out&&(e.avail_out===0||s===Z_STREAM_END))if(this.options.to==="string"){let h=strings.utf8border(e.output,e.next_out),y=e.next_out-h,C=strings.buf2string(e.output,h);e.next_out=y,e.avail_out=r-y,y&&e.output.set(e.output.subarray(h,h+y),0),this.onData(C)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(s===Z_OK&&a===0)){if(s===Z_STREAM_END)return s=inflate_1$2.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};Inflate$1.prototype.onData=function(n){this.chunks.push(n)};Inflate$1.prototype.onEnd=function(n){n===Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};function inflate$1(n,t){const e=new Inflate$1(t);if(e.push(n),e.err)throw e.msg||messages[e.err];return e.result}function inflateRaw$1(n,t){return t=t||{},t.raw=!0,inflate$1(n,t)}var Inflate_1$1=Inflate$1,inflate_2=inflate$1,inflateRaw_1$1=inflateRaw$1,ungzip$1=inflate$1,constants=constants$2,inflate_1$1={Inflate:Inflate_1$1,inflate:inflate_2,inflateRaw:inflateRaw_1$1,ungzip:ungzip$1,constants};const{Deflate,deflate,deflateRaw,gzip}=deflate_1$1,{Inflate,inflate,inflateRaw,ungzip}=inflate_1$1;var deflate_1=deflate,Inflate_1=Inflate,inflate_1=inflate;const pngSignature=[137,80,78,71,13,10,26,10],crcTable=[];for(let n=0;n<256;n++){let t=n;for(let e=0;e<8;e++)t&1?t=3988292384^t>>>1:t=t>>>1;crcTable[n]=t}const initialCrc=4294967295;function updateCrc(n,t,e){let r=n;for(let o=0;o<e;o++)r=crcTable[(r^t[o])&255]^r>>>8;return r}function crc(n,t){return(updateCrc(initialCrc,n,t)^initialCrc)>>>0}var ColorType;(function(n){n[n.UNKNOWN=-1]="UNKNOWN",n[n.GREYSCALE=0]="GREYSCALE",n[n.TRUECOLOUR=2]="TRUECOLOUR",n[n.INDEXED_COLOUR=3]="INDEXED_COLOUR",n[n.GREYSCALE_ALPHA=4]="GREYSCALE_ALPHA",n[n.TRUECOLOUR_ALPHA=6]="TRUECOLOUR_ALPHA"})(ColorType||(ColorType={}));var CompressionMethod;(function(n){n[n.UNKNOWN=-1]="UNKNOWN",n[n.DEFLATE=0]="DEFLATE"})(CompressionMethod||(CompressionMethod={}));var FilterMethod;(function(n){n[n.UNKNOWN=-1]="UNKNOWN",n[n.ADAPTIVE=0]="ADAPTIVE"})(FilterMethod||(FilterMethod={}));var InterlaceMethod;(function(n){n[n.UNKNOWN=-1]="UNKNOWN",n[n.NO_INTERLACE=0]="NO_INTERLACE",n[n.ADAM7=1]="ADAM7"})(InterlaceMethod||(InterlaceMethod={}));const empty=new Uint8Array(0),NULL="\0",uint16=new Uint16Array([255]),uint8=new Uint8Array(uint16.buffer),osIsLittleEndian=uint8[0]===255;class PngDecoder extends IOBuffer$4{constructor(t,e={}){super(t);const{checkCrc:r=!1}=e;this._checkCrc=r,this._inflator=new Inflate_1,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._compressionMethod=CompressionMethod.UNKNOWN,this._filterMethod=FilterMethod.UNKNOWN,this._interlaceMethod=InterlaceMethod.UNKNOWN,this._colorType=-1,this.setBigEndian()}decode(){for(this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(let t=0;t<pngSignature.length;t++)if(this.readUint8()!==pngSignature[t])throw new Error(`wrong PNG signature. Byte at ${t} should be ${pngSignature[t]}.`)}decodeChunk(){const t=this.readUint32(),e=this.readChars(4),r=this.offset;switch(e){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(t);break;case"IDAT":this.decodeIDAT(t);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(t);break;case"iCCP":this.decodeiCCP(t);break;case"tEXt":this.decodetEXt(t);break;case"pHYs":this.decodepHYs();break;default:this.skip(t);break}if(this.offset-r!==t)throw new Error(`Length mismatch while decoding chunk ${e}`);if(this._checkCrc){const o=this.readUint32(),s=t+4,l=crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-s-4,s),s);if(l!==o)throw new Error(`CRC mismatch for chunk ${e}. Expected ${o}, found ${l}`)}else this.skip(4)}decodeIHDR(){const t=this._png;t.width=this.readUint32(),t.height=this.readUint32(),t.depth=checkBitDepth(this.readUint8());const e=this.readUint8();this._colorType=e;let r;switch(e){case ColorType.GREYSCALE:r=1;break;case ColorType.TRUECOLOUR:r=3;break;case ColorType.INDEXED_COLOUR:r=1;break;case ColorType.GREYSCALE_ALPHA:r=2;break;case ColorType.TRUECOLOUR_ALPHA:r=4;break;default:throw new Error(`Unknown color type: ${e}`)}if(this._png.channels=r,this._compressionMethod=this.readUint8(),this._compressionMethod!==CompressionMethod.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(t){if(t%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${t}`);const e=t/3;this._hasPalette=!0;const r=[];this._palette=r;for(let o=0;o<e;o++)r.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(t){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,t)),this.skip(t)}decodetRNS(t){if(this._colorType===3){if(t>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${t} vs ${this._palette.length})`);let e=0;for(;e<t;e++){const r=this.readByte();this._palette[e].push(r)}for(;e<this._palette.length;e++)this._palette[e].push(255)}}decodeiCCP(t){let e="",r;for(;(r=this.readChar())!==NULL;)e+=r;const o=this.readUint8();if(o!==CompressionMethod.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${o}`);const s=this.readBytes(t-e.length-2);this._png.iccEmbeddedProfile={name:e,profile:inflate_1(s)}}decodetEXt(t){let e="",r;for(;(r=this.readChar())!==NULL;)e+=r;this._png.text[e]=this.readChars(t-e.length-1)}decodepHYs(){const t=this.readUint32(),e=this.readUint32(),r=this.readByte();this._png.resolution={x:t,y:e,unit:r}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const t=this._inflator.result;if(this._filterMethod!==FilterMethod.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===InterlaceMethod.NO_INTERLACE)this.decodeInterlaceNull(t);else throw new Error(`Interlace method ${this._interlaceMethod} not supported`)}decodeInterlaceNull(t){const e=this._png.height,r=this._png.channels*this._png.depth/8,o=this._png.width*r,s=new Uint8Array(this._png.height*o);let l=empty,a=0,h,y;for(let C=0;C<e;C++){switch(h=t.subarray(a+1,a+1+o),y=s.subarray(C*o,(C+1)*o),t[a]){case 0:unfilterNone(h,y,o);break;case 1:unfilterSub(h,y,o,r);break;case 2:unfilterUp(h,y,l,o);break;case 3:unfilterAverage(h,y,l,o,r);break;case 4:unfilterPaeth(h,y,l,o,r);break;default:throw new Error(`Unsupported filter: ${t[a]}`)}l=y,a+=o+1}if(this._hasPalette&&(this._png.palette=this._palette),this._png.depth===16){const C=new Uint16Array(s.buffer);if(osIsLittleEndian)for(let L=0;L<C.length;L++)C[L]=swap16(C[L]);this._png.data=C}else this._png.data=s}}function unfilterNone(n,t,e){for(let r=0;r<e;r++)t[r]=n[r]}function unfilterSub(n,t,e,r){let o=0;for(;o<r;o++)t[o]=n[o];for(;o<e;o++)t[o]=n[o]+t[o-r]&255}function unfilterUp(n,t,e,r){let o=0;if(e.length===0)for(;o<r;o++)t[o]=n[o];else for(;o<r;o++)t[o]=n[o]+e[o]&255}function unfilterAverage(n,t,e,r,o){let s=0;if(e.length===0){for(;s<o;s++)t[s]=n[s];for(;s<r;s++)t[s]=n[s]+(t[s-o]>>1)&255}else{for(;s<o;s++)t[s]=n[s]+(e[s]>>1)&255;for(;s<r;s++)t[s]=n[s]+(t[s-o]+e[s]>>1)&255}}function unfilterPaeth(n,t,e,r,o){let s=0;if(e.length===0){for(;s<o;s++)t[s]=n[s];for(;s<r;s++)t[s]=n[s]+t[s-o]&255}else{for(;s<o;s++)t[s]=n[s]+e[s]&255;for(;s<r;s++)t[s]=n[s]+paethPredictor(t[s-o],e[s],e[s-o])&255}}function paethPredictor(n,t,e){const r=n+t-e,o=Math.abs(r-n),s=Math.abs(r-t),l=Math.abs(r-e);return o<=s&&o<=l?n:s<=l?t:e}function swap16(n){return(n&255)<<8|n>>8&255}function checkBitDepth(n){if(n!==1&&n!==2&&n!==4&&n!==8&&n!==16)throw new Error(`invalid bit depth: ${n}`);return n}const defaultZlibOptions={level:3};class PngEncoder extends IOBuffer$4{constructor(t,e={}){super(),this._colorType=ColorType.UNKNOWN,this._zlibOptions=Object.assign({},defaultZlibOptions,e.zlib),this._png=this._checkData(t),this.setBigEndian()}encode(){return this.encodeSignature(),this.encodeIHDR(),this.encodeData(),this.encodeIEND(),this.toArray()}encodeSignature(){this.writeBytes(pngSignature)}encodeIHDR(){this.writeUint32(13),this.writeChars("IHDR"),this.writeUint32(this._png.width),this.writeUint32(this._png.height),this.writeByte(this._png.depth),this.writeByte(this._colorType),this.writeByte(CompressionMethod.DEFLATE),this.writeByte(FilterMethod.ADAPTIVE),this.writeByte(InterlaceMethod.NO_INTERLACE),this.writeCrc(17)}encodeIEND(){this.writeUint32(0),this.writeChars("IEND"),this.writeCrc(4)}encodeIDAT(t){this.writeUint32(t.length),this.writeChars("IDAT"),this.writeBytes(t),this.writeCrc(t.length+4)}encodeData(){const{width:t,height:e,channels:r,depth:o,data:s}=this._png,l=r*t,a=new IOBuffer$4().setBigEndian();let h=0;for(let L=0;L<e;L++)if(a.writeByte(0),o===8)h=writeDataBytes(s,a,l,h);else if(o===16)h=writeDataUint16(s,a,l,h);else throw new Error("unreachable");const y=a.toArray(),C=deflate_1(y,this._zlibOptions);this.encodeIDAT(C)}_checkData(t){const{colorType:e,channels:r,depth:o}=getColorType(t),s={width:checkInteger(t.width,"width"),height:checkInteger(t.height,"height"),channels:r,data:t.data,depth:o,text:{}};this._colorType=e;const l=s.width*s.height*r;if(s.data.length!==l)throw new RangeError(`wrong data size. Found ${s.data.length}, expected ${l}`);return s}writeCrc(t){this.writeUint32(crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-t,t),t))}}function checkInteger(n,t){if(Number.isInteger(n)&&n>0)return n;throw new TypeError(`${t} must be a positive integer`)}function getColorType(n){const{channels:t=4,depth:e=8}=n;if(t!==4&&t!==3&&t!==2&&t!==1)throw new RangeError(`unsupported number of channels: ${t}`);if(e!==8&&e!==16)throw new RangeError(`unsupported bit depth: ${e}`);const r={channels:t,depth:e,colorType:ColorType.UNKNOWN};switch(t){case 4:r.colorType=ColorType.TRUECOLOUR_ALPHA;break;case 3:r.colorType=ColorType.TRUECOLOUR;break;case 1:r.colorType=ColorType.GREYSCALE;break;case 2:r.colorType=ColorType.GREYSCALE_ALPHA;break;default:throw new Error("unsupported number of channels")}return r}function writeDataBytes(n,t,e,r){for(let o=0;o<e;o++)t.writeByte(n[r++]);return r}function writeDataUint16(n,t,e,r){for(let o=0;o<e;o++)t.writeUint16(n[r++]);return r}var ResolutionUnitSpecifier;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.METRE=1]="METRE"})(ResolutionUnitSpecifier||(ResolutionUnitSpecifier={}));function decodePng(n,t){return new PngDecoder(n,t).decode()}function encodePng$1(n,t){return new PngEncoder(n,t).encode()}var encoder={exports:{}};(function(n){function t(r){var o=Math.floor,s=new Array(64),l=new Array(64),a=new Array(64),h=new Array(64),y,C,L,Y,ze=new Array(65535),Bt=new Array(65535),Ir=new Array(64),Wr=new Array(64),yi=[],Bn=0,vi=7,wo=new Array(64),ia=new Array(64),gl=new Array(64),ml=new Array(256),il=new Array(2048),sl,ol=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],_l=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],rh=[0,1,2,3,4,5,6,7,8,9,10,11],wh=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],Fh=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],Mh=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],vp=[0,1,2,3,4,5,6,7,8,9,10,11],gp=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Jh=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Lp(fp){for(var Cd=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],Fd=0;Fd<64;Fd++){var yd=o((Cd[Fd]*fp+50)/100);yd<1?yd=1:yd>255&&(yd=255),s[ol[Fd]]=yd}for(var kp=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Uf=0;Uf<64;Uf++){var $f=o((kp[Uf]*fp+50)/100);$f<1?$f=1:$f>255&&($f=255),l[ol[Uf]]=$f}for(var up=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],ud=0,xd=0;xd<8;xd++)for(var Ed=0;Ed<8;Ed++)a[ud]=1/(s[ol[ud]]*up[xd]*up[Ed]*8),h[ud]=1/(l[ol[ud]]*up[xd]*up[Ed]*8),ud++}function Ip(fp,Cd){for(var Fd=0,yd=0,kp=new Array,Uf=1;Uf<=16;Uf++){for(var $f=1;$f<=fp[Uf];$f++)kp[Cd[yd]]=[],kp[Cd[yd]][0]=Fd,kp[Cd[yd]][1]=Uf,yd++,Fd++;Fd*=2}return kp}function $p(){y=Ip(_l,rh),C=Ip(Mh,vp),L=Ip(wh,Fh),Y=Ip(gp,Jh)}function Xp(){for(var fp=1,Cd=2,Fd=1;Fd<=15;Fd++){for(var yd=fp;yd<Cd;yd++)Bt[32767+yd]=Fd,ze[32767+yd]=[],ze[32767+yd][1]=Fd,ze[32767+yd][0]=yd;for(var kp=-(Cd-1);kp<=-fp;kp++)Bt[32767+kp]=Fd,ze[32767+kp]=[],ze[32767+kp][1]=Fd,ze[32767+kp][0]=Cd-1+kp;fp<<=1,Cd<<=1}}function Cp(){for(var fp=0;fp<256;fp++)il[fp]=19595*fp,il[fp+256>>0]=38470*fp,il[fp+512>>0]=7471*fp+32768,il[fp+768>>0]=-11059*fp,il[fp+1024>>0]=-21709*fp,il[fp+1280>>0]=32768*fp+8421375,il[fp+1536>>0]=-27439*fp,il[fp+1792>>0]=-5329*fp}function Gp(fp){for(var Cd=fp[0],Fd=fp[1]-1;Fd>=0;)Cd&1<<Fd&&(Bn|=1<<vi),Fd--,vi--,vi<0&&(Bn==255?(Rp(255),Rp(0)):Rp(Bn),vi=7,Bn=0)}function Rp(fp){yi.push(fp)}function od(fp){Rp(fp>>8&255),Rp(fp&255)}function Wp(fp,Cd){var Fd,yd,kp,Uf,$f,up,ud,xd,Ed=0,Vd,Ep=8,Yp=64;for(Vd=0;Vd<Ep;++Vd){Fd=fp[Ed],yd=fp[Ed+1],kp=fp[Ed+2],Uf=fp[Ed+3],$f=fp[Ed+4],up=fp[Ed+5],ud=fp[Ed+6],xd=fp[Ed+7];var nd=Fd+xd,$d=Fd-xd,Qd=yd+ud,Rd=yd-ud,ng=kp+up,bg=kp-up,Ih=Uf+$f,nh=Uf-$f,sh=nd+Ih,oh=nd-Ih,Oh=Qd+ng,Uh=Qd-ng;fp[Ed]=sh+Oh,fp[Ed+4]=sh-Oh;var vl=(Uh+oh)*.707106781;fp[Ed+2]=oh+vl,fp[Ed+6]=oh-vl,sh=nh+bg,Oh=bg+Rd,Uh=Rd+$d;var gs=(sh-Uh)*.382683433,di=.5411961*sh+gs,fs=1.306562965*Uh+gs,cl=Oh*.707106781,ih=$d+cl,uh=$d-cl;fp[Ed+5]=uh+di,fp[Ed+3]=uh-di,fp[Ed+1]=ih+fs,fp[Ed+7]=ih-fs,Ed+=8}for(Ed=0,Vd=0;Vd<Ep;++Vd){Fd=fp[Ed],yd=fp[Ed+8],kp=fp[Ed+16],Uf=fp[Ed+24],$f=fp[Ed+32],up=fp[Ed+40],ud=fp[Ed+48],xd=fp[Ed+56];var vh=Fd+xd,Th=Fd-xd,kh=yd+ud,ep=yd-ud,ip=kp+up,_p=kp-up,rd=Uf+$f,Dd=Uf-$f,qp=vh+rd,wd=vh-rd,dd=kh+ip,Wd=kh-ip;fp[Ed]=qp+dd,fp[Ed+32]=qp-dd;var Vf=(Wd+wd)*.707106781;fp[Ed+16]=wd+Vf,fp[Ed+48]=wd-Vf,qp=Dd+_p,dd=_p+ep,Wd=ep+Th;var Wf=(qp-Wd)*.382683433,pg=.5411961*qp+Wf,Jd=1.306562965*Wd+Wf,Yd=dd*.707106781,Cg=Th+Yd,oy=Th-Yd;fp[Ed+40]=oy+pg,fp[Ed+24]=oy-pg,fp[Ed+8]=Cg+Jd,fp[Ed+56]=Cg-Jd,Ed++}var Bg;for(Vd=0;Vd<Yp;++Vd)Bg=fp[Vd]*Cd[Vd],Ir[Vd]=Bg>0?Bg+.5|0:Bg-.5|0;return Ir}function Ld(){od(65504),od(16),Rp(74),Rp(70),Rp(73),Rp(70),Rp(0),Rp(1),Rp(1),Rp(0),od(1),od(1),Rp(0),Rp(0)}function ed(fp){if(fp){od(65505),fp[0]===69&&fp[1]===120&&fp[2]===105&&fp[3]===102?od(fp.length+2):(od(fp.length+5+2),Rp(69),Rp(120),Rp(105),Rp(102),Rp(0));for(var Cd=0;Cd<fp.length;Cd++)Rp(fp[Cd])}}function Gd(fp,Cd){od(65472),od(17),Rp(8),od(Cd),od(fp),Rp(3),Rp(1),Rp(17),Rp(0),Rp(2),Rp(17),Rp(1),Rp(3),Rp(17),Rp(1)}function Kp(){od(65499),od(132),Rp(0);for(var fp=0;fp<64;fp++)Rp(s[fp]);Rp(1);for(var Cd=0;Cd<64;Cd++)Rp(l[Cd])}function Ad(){od(65476),od(418),Rp(0);for(var fp=0;fp<16;fp++)Rp(_l[fp+1]);for(var Cd=0;Cd<=11;Cd++)Rp(rh[Cd]);Rp(16);for(var Fd=0;Fd<16;Fd++)Rp(wh[Fd+1]);for(var yd=0;yd<=161;yd++)Rp(Fh[yd]);Rp(1);for(var kp=0;kp<16;kp++)Rp(Mh[kp+1]);for(var Uf=0;Uf<=11;Uf++)Rp(vp[Uf]);Rp(17);for(var $f=0;$f<16;$f++)Rp(gp[$f+1]);for(var up=0;up<=161;up++)Rp(Jh[up])}function Id(fp){typeof fp>"u"||fp.constructor!==Array||fp.forEach(Cd=>{if(typeof Cd=="string"){od(65534);var Fd=Cd.length;od(Fd+2);var yd;for(yd=0;yd<Fd;yd++)Rp(Cd.charCodeAt(yd))}})}function Yh(){od(65498),od(12),Rp(3),Rp(1),Rp(0),Rp(2),Rp(17),Rp(3),Rp(17),Rp(0),Rp(63),Rp(0)}function Ap(fp,Cd,Fd,yd,kp){for(var Uf=kp[0],$f=kp[240],up,ud=16,xd=63,Ed=64,Vd=Wp(fp,Cd),Ep=0;Ep<Ed;++Ep)Wr[ol[Ep]]=Vd[Ep];var Yp=Wr[0]-Fd;Fd=Wr[0],Yp==0?Gp(yd[0]):(up=32767+Yp,Gp(yd[Bt[up]]),Gp(ze[up]));for(var nd=63;nd>0&&Wr[nd]==0;nd--);if(nd==0)return Gp(Uf),Fd;for(var $d=1,Qd;$d<=nd;){for(var Rd=$d;Wr[$d]==0&&$d<=nd;++$d);var ng=$d-Rd;if(ng>=ud){Qd=ng>>4;for(var bg=1;bg<=Qd;++bg)Gp($f);ng=ng&15}up=32767+Wr[$d],Gp(kp[(ng<<4)+Bt[up]]),Gp(ze[up]),$d++}return nd!=xd&&Gp(Uf),Fd}function kd(){for(var fp=String.fromCharCode,Cd=0;Cd<256;Cd++)ml[Cd]=fp(Cd)}this.encode=function(fp,Cd){new Date().getTime(),Cd&&cd(Cd),yi=new Array,Bn=0,vi=7,od(65496),Ld(),Id(fp.comments),ed(fp.exifBuffer),Kp(),Gd(fp.width,fp.height),Ad(),Yh();var Fd=0,yd=0,kp=0;Bn=0,vi=7,this.encode.displayName="_encode_";for(var Uf=fp.data,$f=fp.width,up=fp.height,ud=$f*4,xd,Ed=0,Vd,Ep,Yp,nd,$d,Qd,Rd,ng;Ed<up;){for(xd=0;xd<ud;){for(nd=ud*Ed+xd,$d=nd,Qd=-1,Rd=0,ng=0;ng<64;ng++)Rd=ng>>3,Qd=(ng&7)*4,$d=nd+Rd*ud+Qd,Ed+Rd>=up&&($d-=ud*(Ed+1+Rd-up)),xd+Qd>=ud&&($d-=xd+Qd-ud+4),Vd=Uf[$d++],Ep=Uf[$d++],Yp=Uf[$d++],wo[ng]=(il[Vd]+il[Ep+256>>0]+il[Yp+512>>0]>>16)-128,ia[ng]=(il[Vd+768>>0]+il[Ep+1024>>0]+il[Yp+1280>>0]>>16)-128,gl[ng]=(il[Vd+1280>>0]+il[Ep+1536>>0]+il[Yp+1792>>0]>>16)-128;Fd=Ap(wo,a,Fd,y,L),yd=Ap(ia,h,yd,C,Y),kp=Ap(gl,h,kp,C,Y),xd+=32}Ed+=8}if(vi>=0){var bg=[];bg[1]=vi+1,bg[0]=(1<<vi+1)-1,Gp(bg)}return od(65497),Buffer.from(yi)};function cd(fp){if(fp<=0&&(fp=1),fp>100&&(fp=100),sl!=fp){var Cd=0;fp<50?Cd=Math.floor(5e3/fp):Cd=Math.floor(200-fp*2),Lp(Cd),sl=fp}}function id(){var fp=new Date().getTime();r||(r=50),kd(),$p(),Xp(),Cp(),cd(r),new Date().getTime()-fp}id()}n.exports=e;function e(r,o){typeof o>"u"&&(o=50);var s=new t(o),l=s.encode(r,o);return{data:l,width:r.width,height:r.height}}})(encoder);var encoderExports=encoder.exports,decoder={exports:{}};(function(n){var t=function(){var o=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),s=4017,l=799,a=3406,h=2276,y=1567,C=3784,L=5793,Y=2896;function ze(){}function Bt(ia,gl){for(var ml=0,il=[],sl,ol,_l=16;_l>0&&!ia[_l-1];)_l--;il.push({children:[],index:0});var rh=il[0],wh;for(sl=0;sl<_l;sl++){for(ol=0;ol<ia[sl];ol++){for(rh=il.pop(),rh.children[rh.index]=gl[ml];rh.index>0;){if(il.length===0)throw new Error("Could not recreate Huffman Table");rh=il.pop()}for(rh.index++,il.push(rh);il.length<=sl;)il.push(wh={children:[],index:0}),rh.children[rh.index]=wh.children,rh=wh;ml++}sl+1<_l&&(il.push(wh={children:[],index:0}),rh.children[rh.index]=wh.children,rh=wh)}return il[0].children}function Ir(ia,gl,ml,il,sl,ol,_l,rh,wh,Fh){ml.precision,ml.samplesPerLine,ml.scanLines;var Mh=ml.mcusPerLine,vp=ml.progressive;ml.maxH,ml.maxV;var gp=gl,Jh=0,Lp=0;function Ip(){if(Lp>0)return Lp--,Jh>>Lp&1;if(Jh=ia[gl++],Jh==255){var up=ia[gl++];if(up)throw new Error("unexpected marker: "+(Jh<<8|up).toString(16))}return Lp=7,Jh>>>7}function $p(up){for(var ud=up,xd;(xd=Ip())!==null;){if(ud=ud[xd],typeof ud=="number")return ud;if(typeof ud!="object")throw new Error("invalid huffman sequence")}return null}function Xp(up){for(var ud=0;up>0;){var xd=Ip();if(xd===null)return;ud=ud<<1|xd,up--}return ud}function Cp(up){var ud=Xp(up);return ud>=1<<up-1?ud:ud+(-1<<up)+1}function Gp(up,ud){var xd=$p(up.huffmanTableDC),Ed=xd===0?0:Cp(xd);ud[0]=up.pred+=Ed;for(var Vd=1;Vd<64;){var Ep=$p(up.huffmanTableAC),Yp=Ep&15,nd=Ep>>4;if(Yp===0){if(nd<15)break;Vd+=16;continue}Vd+=nd;var $d=o[Vd];ud[$d]=Cp(Yp),Vd++}}function Rp(up,ud){var xd=$p(up.huffmanTableDC),Ed=xd===0?0:Cp(xd)<<wh;ud[0]=up.pred+=Ed}function od(up,ud){ud[0]|=Ip()<<wh}var Wp=0;function Ld(up,ud){if(Wp>0){Wp--;return}for(var xd=ol,Ed=_l;xd<=Ed;){var Vd=$p(up.huffmanTableAC),Ep=Vd&15,Yp=Vd>>4;if(Ep===0){if(Yp<15){Wp=Xp(Yp)+(1<<Yp)-1;break}xd+=16;continue}xd+=Yp;var nd=o[xd];ud[nd]=Cp(Ep)*(1<<wh),xd++}}var ed=0,Gd;function Kp(up,ud){for(var xd=ol,Ed=_l,Vd=0;xd<=Ed;){var Ep=o[xd],Yp=ud[Ep]<0?-1:1;switch(ed){case 0:var nd=$p(up.huffmanTableAC),$d=nd&15,Vd=nd>>4;if($d===0)Vd<15?(Wp=Xp(Vd)+(1<<Vd),ed=4):(Vd=16,ed=1);else{if($d!==1)throw new Error("invalid ACn encoding");Gd=Cp($d),ed=Vd?2:3}continue;case 1:case 2:ud[Ep]?ud[Ep]+=(Ip()<<wh)*Yp:(Vd--,Vd===0&&(ed=ed==2?3:0));break;case 3:ud[Ep]?ud[Ep]+=(Ip()<<wh)*Yp:(ud[Ep]=Gd<<wh,ed=0);break;case 4:ud[Ep]&&(ud[Ep]+=(Ip()<<wh)*Yp);break}xd++}ed===4&&(Wp--,Wp===0&&(ed=0))}function Ad(up,ud,xd,Ed,Vd){var Ep=xd/Mh|0,Yp=xd%Mh,nd=Ep*up.v+Ed,$d=Yp*up.h+Vd;up.blocks[nd]===void 0&&Fh.tolerantDecoding||ud(up,up.blocks[nd][$d])}function Id(up,ud,xd){var Ed=xd/up.blocksPerLine|0,Vd=xd%up.blocksPerLine;up.blocks[Ed]===void 0&&Fh.tolerantDecoding||ud(up,up.blocks[Ed][Vd])}var Yh=il.length,Ap,kd,cd,id,fp,Cd;vp?ol===0?Cd=rh===0?Rp:od:Cd=rh===0?Ld:Kp:Cd=Gp;var Fd=0,yd,kp;Yh==1?kp=il[0].blocksPerLine*il[0].blocksPerColumn:kp=Mh*ml.mcusPerColumn,sl||(sl=kp);for(var Uf,$f;Fd<kp;){for(kd=0;kd<Yh;kd++)il[kd].pred=0;if(Wp=0,Yh==1)for(Ap=il[0],fp=0;fp<sl;fp++)Id(Ap,Cd,Fd),Fd++;else for(fp=0;fp<sl;fp++){for(kd=0;kd<Yh;kd++)for(Ap=il[kd],Uf=Ap.h,$f=Ap.v,cd=0;cd<$f;cd++)for(id=0;id<Uf;id++)Ad(Ap,Cd,Fd,cd,id);if(Fd++,Fd===kp)break}if(Fd===kp)do{if(ia[gl]===255&&ia[gl+1]!==0)break;gl+=1}while(gl<ia.length-2);if(Lp=0,yd=ia[gl]<<8|ia[gl+1],yd<65280)throw new Error("marker was not found");if(yd>=65488&&yd<=65495)gl+=2;else break}return gl-gp}function Wr(ia,gl){var ml=[],il=gl.blocksPerLine,sl=gl.blocksPerColumn,ol=il<<3,_l=new Int32Array(64),rh=new Uint8Array(64);function wh(Xp,Cp,Gp){var Rp=gl.quantizationTable,od,Wp,Ld,ed,Gd,Kp,Ad,Id,Yh,Ap=Gp,kd;for(kd=0;kd<64;kd++)Ap[kd]=Xp[kd]*Rp[kd];for(kd=0;kd<8;++kd){var cd=8*kd;if(Ap[1+cd]==0&&Ap[2+cd]==0&&Ap[3+cd]==0&&Ap[4+cd]==0&&Ap[5+cd]==0&&Ap[6+cd]==0&&Ap[7+cd]==0){Yh=L*Ap[0+cd]+512>>10,Ap[0+cd]=Yh,Ap[1+cd]=Yh,Ap[2+cd]=Yh,Ap[3+cd]=Yh,Ap[4+cd]=Yh,Ap[5+cd]=Yh,Ap[6+cd]=Yh,Ap[7+cd]=Yh;continue}od=L*Ap[0+cd]+128>>8,Wp=L*Ap[4+cd]+128>>8,Ld=Ap[2+cd],ed=Ap[6+cd],Gd=Y*(Ap[1+cd]-Ap[7+cd])+128>>8,Id=Y*(Ap[1+cd]+Ap[7+cd])+128>>8,Kp=Ap[3+cd]<<4,Ad=Ap[5+cd]<<4,Yh=od-Wp+1>>1,od=od+Wp+1>>1,Wp=Yh,Yh=Ld*C+ed*y+128>>8,Ld=Ld*y-ed*C+128>>8,ed=Yh,Yh=Gd-Ad+1>>1,Gd=Gd+Ad+1>>1,Ad=Yh,Yh=Id+Kp+1>>1,Kp=Id-Kp+1>>1,Id=Yh,Yh=od-ed+1>>1,od=od+ed+1>>1,ed=Yh,Yh=Wp-Ld+1>>1,Wp=Wp+Ld+1>>1,Ld=Yh,Yh=Gd*h+Id*a+2048>>12,Gd=Gd*a-Id*h+2048>>12,Id=Yh,Yh=Kp*l+Ad*s+2048>>12,Kp=Kp*s-Ad*l+2048>>12,Ad=Yh,Ap[0+cd]=od+Id,Ap[7+cd]=od-Id,Ap[1+cd]=Wp+Ad,Ap[6+cd]=Wp-Ad,Ap[2+cd]=Ld+Kp,Ap[5+cd]=Ld-Kp,Ap[3+cd]=ed+Gd,Ap[4+cd]=ed-Gd}for(kd=0;kd<8;++kd){var id=kd;if(Ap[8+id]==0&&Ap[16+id]==0&&Ap[24+id]==0&&Ap[32+id]==0&&Ap[40+id]==0&&Ap[48+id]==0&&Ap[56+id]==0){Yh=L*Gp[kd+0]+8192>>14,Ap[0+id]=Yh,Ap[8+id]=Yh,Ap[16+id]=Yh,Ap[24+id]=Yh,Ap[32+id]=Yh,Ap[40+id]=Yh,Ap[48+id]=Yh,Ap[56+id]=Yh;continue}od=L*Ap[0+id]+2048>>12,Wp=L*Ap[32+id]+2048>>12,Ld=Ap[16+id],ed=Ap[48+id],Gd=Y*(Ap[8+id]-Ap[56+id])+2048>>12,Id=Y*(Ap[8+id]+Ap[56+id])+2048>>12,Kp=Ap[24+id],Ad=Ap[40+id],Yh=od-Wp+1>>1,od=od+Wp+1>>1,Wp=Yh,Yh=Ld*C+ed*y+2048>>12,Ld=Ld*y-ed*C+2048>>12,ed=Yh,Yh=Gd-Ad+1>>1,Gd=Gd+Ad+1>>1,Ad=Yh,Yh=Id+Kp+1>>1,Kp=Id-Kp+1>>1,Id=Yh,Yh=od-ed+1>>1,od=od+ed+1>>1,ed=Yh,Yh=Wp-Ld+1>>1,Wp=Wp+Ld+1>>1,Ld=Yh,Yh=Gd*h+Id*a+2048>>12,Gd=Gd*a-Id*h+2048>>12,Id=Yh,Yh=Kp*l+Ad*s+2048>>12,Kp=Kp*s-Ad*l+2048>>12,Ad=Yh,Ap[0+id]=od+Id,Ap[56+id]=od-Id,Ap[8+id]=Wp+Ad,Ap[48+id]=Wp-Ad,Ap[16+id]=Ld+Kp,Ap[40+id]=Ld-Kp,Ap[24+id]=ed+Gd,Ap[32+id]=ed-Gd}for(kd=0;kd<64;++kd){var fp=128+(Ap[kd]+8>>4);Cp[kd]=fp<0?0:fp>255?255:fp}}wo(ol*sl*8);for(var Fh,Mh,vp=0;vp<sl;vp++){var gp=vp<<3;for(Fh=0;Fh<8;Fh++)ml.push(new Uint8Array(ol));for(var Jh=0;Jh<il;Jh++){wh(gl.blocks[vp][Jh],rh,_l);var Lp=0,Ip=Jh<<3;for(Mh=0;Mh<8;Mh++){var $p=ml[gp+Mh];for(Fh=0;Fh<8;Fh++)$p[Ip+Fh]=rh[Lp++]}}}return ml}function yi(ia){return ia<0?0:ia>255?255:ia}ze.prototype={load:function(gl){var ml=new XMLHttpRequest;ml.open("GET",gl,!0),ml.responseType="arraybuffer",ml.onload=(function(){var il=new Uint8Array(ml.response||ml.mozResponseArrayBuffer);this.parse(il),this.onload&&this.onload()}).bind(this),ml.send(null)},parse:function(gl){var ml=this.opts.maxResolutionInMP*1e3*1e3,il=0;gl.length;function sl(){var Yp=gl[il]<<8|gl[il+1];return il+=2,Yp}function ol(){var Yp=sl(),nd=gl.subarray(il,il+Yp-2);return il+=nd.length,nd}function _l(Yp){var nd=1,$d=1,Qd,Rd;for(Rd in Yp.components)Yp.components.hasOwnProperty(Rd)&&(Qd=Yp.components[Rd],nd<Qd.h&&(nd=Qd.h),$d<Qd.v&&($d=Qd.v));var ng=Math.ceil(Yp.samplesPerLine/8/nd),bg=Math.ceil(Yp.scanLines/8/$d);for(Rd in Yp.components)if(Yp.components.hasOwnProperty(Rd)){Qd=Yp.components[Rd];var Ih=Math.ceil(Math.ceil(Yp.samplesPerLine/8)*Qd.h/nd),nh=Math.ceil(Math.ceil(Yp.scanLines/8)*Qd.v/$d),sh=ng*Qd.h,oh=bg*Qd.v,Oh=oh*sh,Uh=[];wo(Oh*256);for(var vl=0;vl<oh;vl++){for(var gs=[],di=0;di<sh;di++)gs.push(new Int32Array(64));Uh.push(gs)}Qd.blocksPerLine=Ih,Qd.blocksPerColumn=nh,Qd.blocks=Uh}Yp.maxH=nd,Yp.maxV=$d,Yp.mcusPerLine=ng,Yp.mcusPerColumn=bg}var rh=null,wh=null,Fh,Mh,vp=[],gp=[],Jh=[],Lp=[],Ip=sl(),$p=-1;if(this.comments=[],Ip!=65496)throw new Error("SOI not found");for(Ip=sl();Ip!=65497;){var Xp,Cp;switch(Ip){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var Gp=ol();if(Ip===65534){var Rp=String.fromCharCode.apply(null,Gp);this.comments.push(Rp)}Ip===65504&&Gp[0]===74&&Gp[1]===70&&Gp[2]===73&&Gp[3]===70&&Gp[4]===0&&(rh={version:{major:Gp[5],minor:Gp[6]},densityUnits:Gp[7],xDensity:Gp[8]<<8|Gp[9],yDensity:Gp[10]<<8|Gp[11],thumbWidth:Gp[12],thumbHeight:Gp[13],thumbData:Gp.subarray(14,14+3*Gp[12]*Gp[13])}),Ip===65505&&Gp[0]===69&&Gp[1]===120&&Gp[2]===105&&Gp[3]===102&&Gp[4]===0&&(this.exifBuffer=Gp.subarray(5,Gp.length)),Ip===65518&&Gp[0]===65&&Gp[1]===100&&Gp[2]===111&&Gp[3]===98&&Gp[4]===101&&Gp[5]===0&&(wh={version:Gp[6],flags0:Gp[7]<<8|Gp[8],flags1:Gp[9]<<8|Gp[10],transformCode:Gp[11]});break;case 65499:for(var od=sl(),Wp=od+il-2;il<Wp;){var Ld=gl[il++];wo(256);var ed=new Int32Array(64);if(Ld>>4)if(Ld>>4===1)for(Cp=0;Cp<64;Cp++){var Gd=o[Cp];ed[Gd]=sl()}else throw new Error("DQT: invalid table spec");else for(Cp=0;Cp<64;Cp++){var Gd=o[Cp];ed[Gd]=gl[il++]}vp[Ld&15]=ed}break;case 65472:case 65473:case 65474:sl(),Fh={},Fh.extended=Ip===65473,Fh.progressive=Ip===65474,Fh.precision=gl[il++],Fh.scanLines=sl(),Fh.samplesPerLine=sl(),Fh.components={},Fh.componentsOrder=[];var Kp=Fh.scanLines*Fh.samplesPerLine;if(Kp>ml){var Ad=Math.ceil((Kp-ml)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${Ad}MP`)}var Id=gl[il++],Yh;for(Xp=0;Xp<Id;Xp++){Yh=gl[il];var Ap=gl[il+1]>>4,kd=gl[il+1]&15,cd=gl[il+2];if(Ap<=0||kd<=0)throw new Error("Invalid sampling factor, expected values above 0");Fh.componentsOrder.push(Yh),Fh.components[Yh]={h:Ap,v:kd,quantizationIdx:cd},il+=3}_l(Fh),gp.push(Fh);break;case 65476:var id=sl();for(Xp=2;Xp<id;){var fp=gl[il++],Cd=new Uint8Array(16),Fd=0;for(Cp=0;Cp<16;Cp++,il++)Fd+=Cd[Cp]=gl[il];wo(16+Fd);var yd=new Uint8Array(Fd);for(Cp=0;Cp<Fd;Cp++,il++)yd[Cp]=gl[il];Xp+=17+Fd,(fp>>4?Jh:Lp)[fp&15]=Bt(Cd,yd)}break;case 65501:sl(),Mh=sl();break;case 65500:sl(),sl();break;case 65498:sl();var kp=gl[il++],Uf=[],$f;for(Xp=0;Xp<kp;Xp++){$f=Fh.components[gl[il++]];var up=gl[il++];$f.huffmanTableDC=Lp[up>>4],$f.huffmanTableAC=Jh[up&15],Uf.push($f)}var ud=gl[il++],xd=gl[il++],Ed=gl[il++],Vd=Ir(gl,il,Fh,Uf,Mh,ud,xd,Ed>>4,Ed&15,this.opts);il+=Vd;break;case 65535:gl[il]!==255&&il--;break;default:if(gl[il-3]==255&&gl[il-2]>=192&&gl[il-2]<=254){il-=3;break}else if(Ip===224||Ip==225){if($p!==-1)throw new Error(`first unknown JPEG marker at offset ${$p.toString(16)}, second unknown JPEG marker ${Ip.toString(16)} at offset ${(il-1).toString(16)}`);$p=il-1;const Yp=sl();if(gl[il+Yp-2]===255){il+=Yp-2;break}}throw new Error("unknown JPEG marker "+Ip.toString(16))}Ip=sl()}if(gp.length!=1)throw new Error("only single frame JPEGs supported");for(var Xp=0;Xp<gp.length;Xp++){var Ep=gp[Xp].components;for(var Cp in Ep)Ep[Cp].quantizationTable=vp[Ep[Cp].quantizationIdx],delete Ep[Cp].quantizationIdx}this.width=Fh.samplesPerLine,this.height=Fh.scanLines,this.jfif=rh,this.adobe=wh,this.components=[];for(var Xp=0;Xp<Fh.componentsOrder.length;Xp++){var $f=Fh.components[Fh.componentsOrder[Xp]];this.components.push({lines:Wr(Fh,$f),scaleX:$f.h/Fh.maxH,scaleY:$f.v/Fh.maxV})}},getData:function(gl,ml){var il=this.width/gl,sl=this.height/ml,ol,_l,rh,wh,Fh,Mh,vp,gp,Jh,Lp,Ip=0,$p,Xp,Cp,Gp,Rp,od,Wp,Ld,ed,Gd,Kp,Ad=gl*ml*this.components.length;wo(Ad);var Id=new Uint8Array(Ad);switch(this.components.length){case 1:for(ol=this.components[0],Lp=0;Lp<ml;Lp++)for(Fh=ol.lines[0|Lp*ol.scaleY*sl],Jh=0;Jh<gl;Jh++)$p=Fh[0|Jh*ol.scaleX*il],Id[Ip++]=$p;break;case 2:for(ol=this.components[0],_l=this.components[1],Lp=0;Lp<ml;Lp++)for(Fh=ol.lines[0|Lp*ol.scaleY*sl],Mh=_l.lines[0|Lp*_l.scaleY*sl],Jh=0;Jh<gl;Jh++)$p=Fh[0|Jh*ol.scaleX*il],Id[Ip++]=$p,$p=Mh[0|Jh*_l.scaleX*il],Id[Ip++]=$p;break;case 3:for(Kp=!0,this.adobe&&this.adobe.transformCode?Kp=!0:typeof this.opts.colorTransform<"u"&&(Kp=!!this.opts.colorTransform),ol=this.components[0],_l=this.components[1],rh=this.components[2],Lp=0;Lp<ml;Lp++)for(Fh=ol.lines[0|Lp*ol.scaleY*sl],Mh=_l.lines[0|Lp*_l.scaleY*sl],vp=rh.lines[0|Lp*rh.scaleY*sl],Jh=0;Jh<gl;Jh++)Kp?($p=Fh[0|Jh*ol.scaleX*il],Xp=Mh[0|Jh*_l.scaleX*il],Cp=vp[0|Jh*rh.scaleX*il],Ld=yi($p+1.402*(Cp-128)),ed=yi($p-.3441363*(Xp-128)-.71413636*(Cp-128)),Gd=yi($p+1.772*(Xp-128))):(Ld=Fh[0|Jh*ol.scaleX*il],ed=Mh[0|Jh*_l.scaleX*il],Gd=vp[0|Jh*rh.scaleX*il]),Id[Ip++]=Ld,Id[Ip++]=ed,Id[Ip++]=Gd;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(Kp=!1,this.adobe&&this.adobe.transformCode?Kp=!0:typeof this.opts.colorTransform<"u"&&(Kp=!!this.opts.colorTransform),ol=this.components[0],_l=this.components[1],rh=this.components[2],wh=this.components[3],Lp=0;Lp<ml;Lp++)for(Fh=ol.lines[0|Lp*ol.scaleY*sl],Mh=_l.lines[0|Lp*_l.scaleY*sl],vp=rh.lines[0|Lp*rh.scaleY*sl],gp=wh.lines[0|Lp*wh.scaleY*sl],Jh=0;Jh<gl;Jh++)Kp?($p=Fh[0|Jh*ol.scaleX*il],Xp=Mh[0|Jh*_l.scaleX*il],Cp=vp[0|Jh*rh.scaleX*il],Gp=gp[0|Jh*wh.scaleX*il],Rp=255-yi($p+1.402*(Cp-128)),od=255-yi($p-.3441363*(Xp-128)-.71413636*(Cp-128)),Wp=255-yi($p+1.772*(Xp-128))):(Rp=Fh[0|Jh*ol.scaleX*il],od=Mh[0|Jh*_l.scaleX*il],Wp=vp[0|Jh*rh.scaleX*il],Gp=gp[0|Jh*wh.scaleX*il]),Id[Ip++]=255-Rp,Id[Ip++]=255-od,Id[Ip++]=255-Wp,Id[Ip++]=255-Gp;break;default:throw new Error("Unsupported color mode")}return Id},copyToImageData:function(gl,ml){var il=gl.width,sl=gl.height,ol=gl.data,_l=this.getData(il,sl),rh=0,wh=0,Fh,Mh,vp,gp,Jh,Lp,Ip,$p,Xp;switch(this.components.length){case 1:for(Mh=0;Mh<sl;Mh++)for(Fh=0;Fh<il;Fh++)vp=_l[rh++],ol[wh++]=vp,ol[wh++]=vp,ol[wh++]=vp,ml&&(ol[wh++]=255);break;case 3:for(Mh=0;Mh<sl;Mh++)for(Fh=0;Fh<il;Fh++)Ip=_l[rh++],$p=_l[rh++],Xp=_l[rh++],ol[wh++]=Ip,ol[wh++]=$p,ol[wh++]=Xp,ml&&(ol[wh++]=255);break;case 4:for(Mh=0;Mh<sl;Mh++)for(Fh=0;Fh<il;Fh++)Jh=_l[rh++],Lp=_l[rh++],vp=_l[rh++],gp=_l[rh++],Ip=255-yi(Jh*(1-gp/255)+gp),$p=255-yi(Lp*(1-gp/255)+gp),Xp=255-yi(vp*(1-gp/255)+gp),ol[wh++]=Ip,ol[wh++]=$p,ol[wh++]=Xp,ml&&(ol[wh++]=255);break;default:throw new Error("Unsupported color mode")}}};var Bn=0,vi=0;function wo(ia=0){var gl=Bn+ia;if(gl>vi){var ml=Math.ceil((gl-vi)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${ml}MB`)}Bn=gl}return ze.resetMaxMemoryUsage=function(ia){Bn=0,vi=ia},ze.getBytesAllocated=function(){return Bn},ze.requestMemoryAllocation=wo,ze}();n.exports=e;function e(r,o={}){var s={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512},l={...s,...o},a=new Uint8Array(r),h=new t;h.opts=l,t.resetMaxMemoryUsage(l.maxMemoryUsageInMB*1024*1024),h.parse(a);var y=l.formatAsRGBA?4:3,C=h.width*h.height*y;try{t.requestMemoryAllocation(C);var L={width:h.width,height:h.height,exifBuffer:h.exifBuffer,data:l.useTArray?new Uint8Array(C):Buffer.alloc(C)};h.comments.length>0&&(L.comments=h.comments)}catch(Y){throw Y instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+C):Y instanceof ReferenceError&&Y.message==="Buffer is not defined"?new Error("Buffer is not globally defined in this environment. Consider setting useTArray to true"):Y}return h.copyToImageData(L,l.formatAsRGBA),L}})(decoder);var decoderExports=decoder.exports,encode$1=encoderExports,decode$4=decoderExports,jpegJs={encode:encode$1,decode:decode$4};let chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup=new Uint8Array(256);for(let n=0;n<chars.length;n++)lookup[chars.charCodeAt(n)]=n;function encode(n){let t,e=n.length,r="";for(t=0;t<e;t+=3)r+=chars[n[t]>>2],r+=chars[(n[t]&3)<<4|n[t+1]>>4],r+=chars[(n[t+1]&15)<<2|n[t+2]>>6],r+=chars[n[t+2]&63];return e%3===2?r=`${r.substring(0,r.length-1)}=`:e%3===1&&(r=`${r.substring(0,r.length-2)}==`),r}function decode$3(n){let t=n.length*.75,e=n.length,r=0,o,s,l,a;n[n.length-1]==="="&&(t--,n[n.length-2]==="="&&t--);const h=new Uint8Array(t);for(let y=0;y<e;y+=4)o=lookup[n.charCodeAt(y)],s=lookup[n.charCodeAt(y+1)],l=lookup[n.charCodeAt(y+2)],a=lookup[n.charCodeAt(y+3)],h[r++]=o<<2|s>>4,h[r++]=(s&15)<<4|l>>2,h[r++]=(l&3)<<6|a&63;return h}function toBase64URL(n,t){const e=encode(n);return`data:${t};base64,${e}`}const ImageData$1=self.ImageData,DOMImage=self.Image;function createCanvas(n,t){let e=self.document.createElement("canvas");return e.width=n,e.height=t,e}function fetchBinary(n,{withCredentials:t=!1}={}){return new Promise(function(e,r){let o=new self.XMLHttpRequest;o.open("GET",n,!0),o.responseType="arraybuffer",o.withCredentials=t,o.onload=function(s){this.status!==200?r(s):e(this.response)},o.onerror=r,o.send()})}function createWriteStream(){throw new Error("createWriteStream does not exist in the browser")}function writeFile(){throw new Error("writeFile does not exist in the browser")}function getType(n){return n.includes("/")||(n=`image/${n}`),n}function encodeJpeg(n,t={}){const e={width:n.width,height:n.height,data:n.getRGBAData()};return jpegJs.encode(e,t.quality).data}function encodePng(n,t){const e={width:n.width,height:n.height,channels:n.channels,depth:n.bitDepth,data:n.data};return(e.depth===1||e.depth===32)&&(e.depth=8,e.channels=4,e.data=n.getRGBAData()),encodePng$1(e,t)}const exportMethods={save(n,t={}){const{useCanvas:e=!1,encoder:r=void 0}=t;let{format:o}=t;if(!o){const s=/\.(?<format>[a-zA-Z]+)$/.exec(n);s&&(o=s.groups.format.toLowerCase())}if(!o)throw new Error("file format not provided");return new Promise((s,l)=>{let a,h;switch(o.toLowerCase()){case"png":{e?a=this.getCanvas().pngStream():h=encodePng(this,r);break}case"jpg":case"jpeg":e?a=this.getCanvas().jpegStream():h=encodeJpeg(this,r);break;case"bmp":h=encode$2(this,r);break;default:throw new RangeError(`invalid output format: ${o}`)}if(a){let y=createWriteStream();y.on("finish",s),y.on("error",l),a.pipe(y)}else h&&writeFile()})},toDataURL(n="image/png",t={}){typeof n=="object"&&(t=n,n="image/png");const{useCanvas:e=!1,encoder:r=void 0}=t;n=getType(n);function o(s,l){const a=s(l,r);return toBase64URL(a,n)}return n==="image/bmp"?o(encode$2,this):n==="image/png"&&!e?o(encodePng,this):n==="image/jpeg"&&!e?o(encodeJpeg,this):this.getCanvas().toDataURL(n)},toBuffer(n={}){const{format:t="png",encoder:e=void 0}=n;switch(t.toLowerCase()){case"png":return encodePng(this,e);case"jpeg":case"jpg":return encodeJpeg(this,e);case"bmp":return encode$2(this,e);default:throw new RangeError(`invalid output format: ${t}`)}},toBase64(n="image/png",t={}){if(t.async)return this.toDataURL(n,t).then(function(e){return e.substring(e.indexOf(",")+1)});{const e=this.toDataURL(n,t);return e.substring(e.indexOf(",")+1)}},toBlob(n="image/png",t=.8){return canvasToBlob(this.getCanvas(),n,t)},getCanvas(){const n=new ImageData$1(this.getRGBAData({clamped:!0}),this.width,this.height);let t=createCanvas(this.width,this.height);return t.getContext("2d").putImageData(n,0,0),t}};function setExportMethods(n){for(const t in exportMethods)n.prototype[t]=exportMethods[t]}var hasOwn$1={exports:{}};const name="has-own",version="1.0.1",description="A safer .hasOwnProperty() - hasOwn(name, obj)",main="index.js",scripts={test:"make test"},author="Aaron Heckmann <aaron.heckmann+github@gmail.com>",license="MIT",repository={type:"git",url:"git://github.com/aheckmann/has-own.git"},homepage="https://github.com/aheckmann/has-own/",devDependencies={mocha:"^6.2.2"},require$$0$2={name,version,description,main,scripts,author,license,repository,homepage,devDependencies};(function(n,t){var e=Object.prototype.hasOwnProperty;n.exports=t=function(o,s){return e.call(s,o)},t.version=require$$0$2.version})(hasOwn$1,hasOwn$1.exports);var hasOwnExports=hasOwn$1.exports;const hasOwn=getDefaultExportFromCjs(hasOwnExports);let computedPropertyDescriptor$1={configurable:!0,enumerable:!1,get:void 0};function extendMethod(n,t,e={}){let{inPlace:r=!1,returnThis:o=!0,partialArgs:s=[]}=e;return r?Image$1.prototype[n]=function(...l){this.computed=null;let a=t.apply(this,[...s,...l]);return o?this:a}:Image$1.prototype[n]=function(...l){return t.apply(this,[...s,...l])},Image$1}function extendProperty(n,t,e={}){let{partialArgs:r=[]}=e;return computedPropertyDescriptor$1.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(n,this.computed))return this.computed[n];let o=t.apply(this,r);return this.computed[n]=o,o},Object.defineProperty(Image$1.prototype,n,computedPropertyDescriptor$1),Image$1}const GREY$1="GREY",RGB$1="RGB",HSL="HSL",HSV="HSV",CMYK$1="CMYK",ColorModel=Object.freeze(Object.defineProperty({__proto__:null,CMYK:CMYK$1,GREY:GREY$1,HSL,HSV,RGB:RGB$1},Symbol.toStringTag,{value:"Module"}));function getRGBAData(n={}){const{clamped:t}=n;this.checkProcessable("getRGBAData",{components:[1,3],bitDepth:[1,8,16,32]});const e=this.width*this.height*4;let r=t?new Uint8ClampedArray(e):new Uint8Array(e);return this.bitDepth===1?fillDataFromBinary(this,r):this.bitDepth===32?(this.checkProcessable("getRGBAData",{alpha:0}),this.components===1?fillDataFromGrey32(this,r):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB32(this,r))):this.components===1?fillDataFromGrey(this,r):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB(this,r)),this.alpha===1?(this.checkProcessable("getRGBAData",{bitDepth:[8,16]}),copyAlpha(this,r)):fillAlpha(this,r),r}function fillDataFromBinary(n,t){for(let e=0;e<n.size;e++){const r=n.getBit(e);t[e*4]=r*255,t[e*4+1]=r*255,t[e*4+2]=r*255}}function fillDataFromGrey32(n,t){const e=n.min[0],o=n.max[0]-e;for(let s=0;s<n.size;s++){const l=Math.floor(255*(n.data[s]-e)/o);t[s*4]=l,t[s*4+1]=l,t[s*4+2]=l}}function fillDataFromRGB32(n,t){const e=Math.min(...n.min),o=Math.max(...n.max)-e;for(let s=0;s<n.size;s++){const l=Math.floor(255*(n.data[s*3]-e)/o),a=Math.floor(255*(n.data[s*3+1]-e)/o),h=Math.floor(255*(n.data[s*3+2]-e)/o);t[s*4]=l,t[s*4+1]=a,t[s*4+2]=h}}function fillDataFromGrey(n,t){for(let e=0;e<n.size;e++)t[e*4]=n.data[e*n.channels]>>>n.bitDepth-8,t[e*4+1]=n.data[e*n.channels]>>>n.bitDepth-8,t[e*4+2]=n.data[e*n.channels]>>>n.bitDepth-8}function fillDataFromRGB(n,t){for(let e=0;e<n.size;e++)t[e*4]=n.data[e*n.channels]>>>n.bitDepth-8,t[e*4+1]=n.data[e*n.channels+1]>>>n.bitDepth-8,t[e*4+2]=n.data[e*n.channels+2]>>>n.bitDepth-8}function copyAlpha(n,t){for(let e=0;e<n.size;e++)t[e*4+3]=n.data[e*n.channels+n.components]>>n.bitDepth-8}function fillAlpha(n,t){for(let e=0;e<n.size;e++)t[e*4+3]=255}const BINARY="BINARY",GREY="GREY",GREYA="GREYA",RGB="RGB",RGBA="RGBA",CMYK="CMYK",CMYKA="CMYKA",kinds={};kinds[BINARY]={components:1,alpha:0,bitDepth:1,colorModel:GREY$1};kinds[GREYA]={components:1,alpha:1,bitDepth:8,colorModel:GREY$1};kinds[GREY]={components:1,alpha:0,bitDepth:8,colorModel:GREY$1};kinds[RGBA]={components:3,alpha:1,bitDepth:8,colorModel:RGB$1};kinds[RGB]={components:3,alpha:0,bitDepth:8,colorModel:RGB$1};kinds[CMYK]={components:4,alpha:0,bitDepth:8,colorModel:CMYK$1};kinds[CMYKA]={components:4,alpha:1,bitDepth:8,colorModel:CMYK$1};function getKind(n){const t=kinds[n];if(!t)throw new RangeError(`invalid image kind: ${n}`);return t}const validBitDepth=[1,8,16,32];function verifyKindDefinition(n){const{components:t,alpha:e,bitDepth:r,colorModel:o}=n;if(!Number.isInteger(t)||t<=0)throw new RangeError(`invalid components: ${t}. Must be a positive integer`);if(e!==0&&e!==1&&typeof e!="boolean")throw new TypeError(`invalid alpha: ${e}: must be a boolean, 0 or 1`);if(!validBitDepth.includes(r))throw new RangeError(`invalid bitDepth: ${r}. Must be one of ${validBitDepth.join(", ")}`);if(!ColorModel[o])throw new RangeError(`invalid colorModel: ${o}. Must be one of ${Object.keys(ColorModel).join(", ")}`)}function getTheoreticalPixelArraySize(n,t,e){let r=t*n;return e===1&&(r=Math.ceil(r/8)),r}function createPixelArray(n,t,e,r,o,s){const l=r*n;let a;switch(o){case 1:a=new Uint8Array(Math.ceil(l/8));break;case 8:a=new Uint8Array(l);break;case 16:a=new Uint16Array(l);break;case 32:a=new Float32Array(l);break;default:throw new Error(`Cannot create pixel array for bit depth ${o}`)}if(e)for(let h=t;h<a.length;h+=r)a[h]=s;return a}const defaultByteLength=1024*8,charArray=[];let IOBuffer$2=class{constructor(t,e){e=e||{},t===void 0&&(t=defaultByteLength),typeof t=="number"&&(t=new ArrayBuffer(t));let r=t.byteLength;const o=e.offset?e.offset>>>0:0;t.buffer&&(r=t.byteLength-o,t.byteLength!==t.buffer.byteLength?t=t.buffer.slice(t.byteOffset+o,t.byteOffset+t.byteLength):o?t=t.buffer.slice(o):t=t.buffer),this.buffer=t,this.length=r,this.byteLength=r,this.byteOffset=0,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer),this._increment=r||defaultByteLength,this._mark=0}available(t){return t===void 0&&(t=1),this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){this.littleEndian=!0}isBigEndian(){return!this.littleEndian}setBigEndian(){this.littleEndian=!1}skip(t){t===void 0&&(t=1),this.offset+=t}seek(t){this.offset=t}mark(){this._mark=this.offset}reset(){this.offset=this._mark}rewind(){this.offset=0}ensureAvailable(t){if(t===void 0&&(t=1),!this.available(t)){const e=this._increment+this._increment;this._increment=e;const r=this.length+e,o=new Uint8Array(r);o.set(new Uint8Array(this.buffer)),this.buffer=o.buffer,this.length=r,this._data=new DataView(this.buffer)}}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t){t===void 0&&(t=1);for(var e=new Uint8Array(t),r=0;r<t;r++)e[r]=this.readByte();return e}readInt16(){var t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){var t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){var t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){var t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){var t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){var t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t){t===void 0&&(t=1),charArray.length=t;for(var e=0;e<t;e++)charArray[e]=this.readChar();return charArray.join("")}writeBoolean(t){this.writeUint8(t?255:0)}writeInt8(t){this.ensureAvailable(1),this._data.setInt8(this.offset++,t)}writeUint8(t){this.ensureAvailable(1),this._data.setUint8(this.offset++,t)}writeByte(t){this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(var e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e])}writeInt16(t){this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2}writeUint16(t){this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2}writeInt32(t){this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4}writeUint32(t){this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4}writeFloat32(t){this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4}writeFloat64(t){this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8}writeChar(t){this.writeUint8(t.charCodeAt(0))}writeChars(t){for(var e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e))}toArray(){return new Uint8Array(this.buffer,0,this.offset)}};var IOBuffer_1=IOBuffer$2,src$4={};const tagsById$5={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName$5={};for(var i$2 in tagsById$5)tagsByName$5[tagsById$5[i$2]]=i$2;var standard$1={tagsById:tagsById$5,tagsByName:tagsByName$5};const tagsById$4={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$4={};for(var i$1 in tagsById$4)tagsByName$4[tagsById$4[i$1]]=i$1;var exif$1={tagsById:tagsById$4,tagsByName:tagsByName$4};const tagsById$3={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$3={};for(var i in tagsById$3)tagsByName$3[tagsById$3[i]]=i;var gps$1={tagsById:tagsById$3,tagsByName:tagsByName$3};const tags$1={standard:standard$1,exif:exif$1,gps:gps$1};let IFD$2=class{constructor(t){if(!t)throw new Error("missing kind");this.data=null,this.fields=new Map,this.kind=t,this._map=null}get(t){if(typeof t=="number")return this.fields.get(t);if(typeof t=="string")return this.fields.get(tags$1[this.kind].tagsByName[t]);throw new Error("expected a number or string")}get map(){if(!this._map){this._map={};const e=tags$1[this.kind].tagsById;for(var t of this.fields.keys())e[t]&&(this._map[e[t]]=this.fields.get(t))}return this._map}};var ifd=IFD$2;const Ifd=ifd,dateTimeRegex$1=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;let TiffIfd$1=class extends Ifd{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){var t=new Date,e=dateTimeRegex$1.exec(this.dateTime);return t.setFullYear(e[1],e[2]-1,e[3]),t.setHours(e[4],e[5],e[6]),t}get newSubfileType(){return this.get(254)}get imageWidth(){return this.get(256)}get imageLength(){return this.get(257)}get bitsPerSample(){return this.get(258)}get compression(){return this.get(259)||1}get type(){return this.get(262)}get fillOrder(){return this.get(266)||1}get documentName(){return this.get(269)}get imageDescription(){return this.get(270)}get stripOffsets(){return alwaysArray$1(this.get(273))}get orientation(){return this.get(274)}get samplesPerPixel(){return this.get(277)}get rowsPerStrip(){return this.get(278)}get stripByteCounts(){return alwaysArray$1(this.get(279))}get minSampleValue(){return this.get(280)||0}get maxSampleValue(){return this.get(281)||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get(282)}get yResolution(){return this.get(283)}get planarConfiguration(){return this.get(284)||1}get resolutionUnit(){return this.get(296)||2}get dateTime(){return this.get(306)}get predictor(){return this.get(317)||1}get sampleFormat(){return this.get(339)||1}get sMinSampleValue(){return this.get(340)||this.minSampleValue}get sMaxSampleValue(){return this.get(341)||this.maxSampleValue}};function alwaysArray$1(n){return typeof n=="number"?[n]:n}var tiffIfd=TiffIfd$1,ifdValue={},types$1=new Map([[1,[1,readByte$1]],[2,[1,readASCII$1]],[3,[2,readShort$1]],[4,[4,readLong$1]],[5,[8,readRational$1]],[6,[1,readSByte$1]],[7,[1,readByte$1]],[8,[2,readSShort$1]],[9,[4,readSLong$1]],[10,[8,readSRational$1]],[11,[4,readFloat$1]],[12,[8,readDouble$1]]]);ifdValue.getByteLength=function(n,t){return types$1.get(n)[0]*t};ifdValue.readData=function(n,t,e){return types$1.get(t)[1](n,e)};function readByte$1(n,t){if(t===1)return n.readUint8();for(var e=new Uint8Array(t),r=0;r<t;r++)e[r]=n.readUint8();return e}function readASCII$1(n,t){for(var e=[],r="",o=0;o<t;o++){var s=String.fromCharCode(n.readUint8());s==="\0"?(e.push(r),r=""):r+=s}return e.length===1?e[0]:e}function readShort$1(n,t){if(t===1)return n.readUint16();for(var e=new Uint16Array(t),r=0;r<t;r++)e[r]=n.readUint16();return e}function readLong$1(n,t){if(t===1)return n.readUint32();for(var e=new Uint32Array(t),r=0;r<t;r++)e[r]=n.readUint32();return e}function readRational$1(n,t){if(t===1)return n.readUint32()/n.readUint32();for(var e=new Array(t),r=0;r<t;r++)e[r]=n.readUint32()/n.readUint32();return e}function readSByte$1(n,t){if(t===1)return n.readInt8();for(var e=new Int8Array(t),r=0;r<t;r++)e[r]=n.readInt8();return e}function readSShort$1(n,t){if(t===1)return n.readInt16();for(var e=new Int16Array(t),r=0;r<t;r++)e[r]=n.readInt16();return e}function readSLong$1(n,t){if(t===1)return n.readInt32();for(var e=new Int32Array(t),r=0;r<t;r++)e[r]=n.readInt32();return e}function readSRational$1(n,t){if(t===1)return n.readInt32()/n.readInt32();for(var e=new Array(t),r=0;r<t;r++)e[r]=n.readInt32()/n.readInt32();return e}function readFloat$1(n,t){if(t===1)return n.readFloat32();for(var e=new Float32Array(t),r=0;r<t;r++)e[r]=n.readFloat32();return e}function readDouble$1(n,t){if(t===1)return n.readFloat64();for(var e=new Float64Array(t),r=0;r<t;r++)e[r]=n.readFloat64();return e}const IOBuffer$1=IOBuffer_1,IFD$1=ifd,TiffIFD=tiffIfd,IFDValue=ifdValue,defaultOptions$d={ignoreImageData:!1,onlyFirst:!1};let TIFFDecoder$2=class extends IOBuffer$1{constructor(t,e){super(t,e),this._nextIFD=0}decode(t){t=Object.assign({},defaultOptions$d,t);const e=[];for(this.decodeHeader();this._nextIFD;)if(e.push(this.decodeIFD(t)),t.onlyFirst)return e[0];return e}decodeHeader(){let t=this.readUint16();if(t===18761)this.setLittleEndian();else if(t===19789)this.setBigEndian();else throw new Error("invalid byte order: 0x"+t.toString(16));if(t=this.readUint16(),t!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(t){this.seek(this._nextIFD);var e;t.kind?e=new IFD$1(t.kind):e=new TiffIFD;const r=this.readUint16();for(var o=0;o<r;o++)this.decodeIFDEntry(e);return t.ignoreImageData||this.decodeImageData(e),this._nextIFD=this.readUint32(),e}decodeIFDEntry(t){const e=this.offset,r=this.readUint16(),o=this.readUint16(),s=this.readUint32();if(o<1||o>12){this.skip(4);return}IFDValue.getByteLength(o,s)>4&&this.seek(this.readUint32());const a=IFDValue.readData(this,o,s);if(t.fields.set(r,a),r===34665||r===34853){let h=this.offset,y;r===34665?y="exif":r===34853&&(y="gps"),this._nextIFD=a,t[y]=this.decodeIFD({kind:y,ignoreImageData:!0}),this.offset=h}this.seek(e),this.skip(12)}decodeImageData(t){const e=t.orientation;switch(e&&e!==1&&unsupported$1("orientation",e),t.type){case 1:case 2:this.readStripData(t);break;default:unsupported$1("image type",t.type);break}}readStripData(t){const e=t.width,r=t.height,o=validateBitDepth(t.bitsPerSample),s=t.sampleFormat;let l=e*r;const a=getDataArray$1(l,1,o,s),h=t.compression,C=t.rowsPerStrip*e,L=t.stripOffsets,Y=t.stripByteCounts;for(var ze=0,Bt=0;Bt<L.length;Bt++){var Ir=this.getStripData(h,L[Bt],Y[Bt]),Wr=l>C?C:l;l-=Wr,o===8?ze=fill8bit$1(a,Ir,ze,Wr):o===16?ze=fill16bit$1(a,Ir,ze,Wr,this.isLittleEndian()):o===32&&s===3?ze=fillFloat32$1(a,Ir,ze,Wr,this.isLittleEndian()):unsupported$1("bitDepth",o)}t.data=a}getStripData(t,e,r){switch(t){case 1:return new DataView(this.buffer,e,r);case 2:case 32773:return unsupported$1("Compression",t);default:throw new Error("invalid compression: "+t)}}};var tiffDecoder=TIFFDecoder$2;function getDataArray$1(n,t,e,r){return e===8?new Uint8Array(n*t):e===16?new Uint16Array(n*t):e===32&&r===3?new Float32Array(n*t):unsupported$1("bit depth / sample format",e+" / "+r)}function fill8bit$1(n,t,e,r){for(var o=0;o<r;o++)n[e++]=t.getUint8(o);return e}function fill16bit$1(n,t,e,r,o){for(var s=0;s<r*2;s+=2)n[e++]=t.getUint16(s,o);return e}function fillFloat32$1(n,t,e,r,o){for(var s=0;s<r*4;s+=4)n[e++]=t.getFloat32(s,o);return e}function unsupported$1(n,t){throw new Error("Unsupported "+n+": "+t)}function validateBitDepth(n){if(n.length){const e=n;n=e[0];for(var t=0;t<e.length;t++)e[t]!==n&&unsupported$1("bit depth",e)}return n}const TIFFDecoder$1=tiffDecoder;var decode$2=function(t,e){return new TIFFDecoder$1(t,e).decode(e)};src$4.decode=decode$2;const IOBuffer=IOBuffer_1,tiff=src$4;function decode$1(n){const t=new IOBuffer(n),e={};if(t.setBigEndian(),t.readUint16()!==65496)throw new Error("SOI marker not found. Not a valid JPEG file");if(t.readUint16()===65505){t.readUint16();const s=t.readBytes(6);if(s[0]===69&&s[1]===120&&s[2]===105&&s[3]===102&&s[4]===0&&s[5]===0){const l=tiff.decode(t,{onlyFirst:!0,ignoreImageData:!0,offset:t.offset});e.exif=l}}return e}var decode_1=decode$1,decode=decode_1,imageType$2={exports:{}},fileType$1={exports:{}};(function(module){const toBytes=n=>[...n].map(t=>t.charCodeAt(0)),xpiZipFilename=toBytes("META-INF/mozilla.rsa"),oxmlContentTypes=toBytes("[Content_Types].xml"),oxmlRels=toBytes("_rels/.rels");function readUInt64LE(n,t=0){let e=n[t],r=1,o=0;for(;++o<8;)r*=256,e+=n[t+o]*r;return e}const fileType=n=>{if(!(n instanceof Uint8Array||n instanceof ArrayBuffer||Buffer.isBuffer(n)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof n}\``);const t=n instanceof Uint8Array?n:new Uint8Array(n);if(!(t&&t.length>1))return null;const e=(o,s)=>{s=Object.assign({offset:0},s);for(let l=0;l<o.length;l++)if(s.mask){if(o[l]!==(s.mask[l]&t[l+s.offset]))return!1}else if(o[l]!==t[l+s.offset])return!1;return!0},r=(o,s)=>e(toBytes(o),s);if(e([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(e([137,80,78,71,13,10,26,10]))return{ext:"png",mime:"image/png"};if(e([71,73,70]))return{ext:"gif",mime:"image/gif"};if(e([87,69,66,80],{offset:8}))return{ext:"webp",mime:"image/webp"};if(e([70,76,73,70]))return{ext:"flif",mime:"image/flif"};if((e([73,73,42,0])||e([77,77,0,42]))&&e([67,82],{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(e([73,73,42,0])||e([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(e([66,77]))return{ext:"bmp",mime:"image/bmp"};if(e([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(e([56,66,80,83]))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(e([80,75,3,4])){if(e([109,105,109,101,116,121,112,101,97,112,112,108,105,99,97,116,105,111,110,47,101,112,117,98,43,122,105,112],{offset:30}))return{ext:"epub",mime:"application/epub+zip"};if(e(xpiZipFilename,{offset:30}))return{ext:"xpi",mime:"application/x-xpinstall"};if(r("mimetypeapplication/vnd.oasis.opendocument.text",{offset:30}))return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};if(r("mimetypeapplication/vnd.oasis.opendocument.spreadsheet",{offset:30}))return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};if(r("mimetypeapplication/vnd.oasis.opendocument.presentation",{offset:30}))return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};const o=(h,y=0)=>h.findIndex((C,L,Y)=>L>=y&&Y[L]===80&&Y[L+1]===75&&Y[L+2]===3&&Y[L+3]===4);let s=0,l=!1,a=null;do{const h=s+30;if(l||(l=e(oxmlContentTypes,{offset:h})||e(oxmlRels,{offset:h})),a||(r("word/",{offset:h})?a={ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}:r("ppt/",{offset:h})?a={ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}:r("xl/",{offset:h})&&(a={ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),l&&a)return a;s=o(t,h)}while(s>=0);if(a)return a}if(e([80,75])&&(t[2]===3||t[2]===5||t[2]===7)&&(t[3]===4||t[3]===6||t[3]===8))return{ext:"zip",mime:"application/zip"};if(e([117,115,116,97,114],{offset:257}))return{ext:"tar",mime:"application/x-tar"};if(e([82,97,114,33,26,7])&&(t[6]===0||t[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(e([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(e([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(e([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(e([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(e([51,103,112,53])||e([0,0,0])&&e([102,116,121,112],{offset:4})&&(e([109,112,52,49],{offset:8})||e([109,112,52,50],{offset:8})||e([105,115,111,109],{offset:8})||e([105,115,111,50],{offset:8})||e([109,109,112,52],{offset:8})||e([77,52,86],{offset:8})||e([100,97,115,104],{offset:8})))return{ext:"mp4",mime:"video/mp4"};if(e([77,84,104,100]))return{ext:"mid",mime:"audio/midi"};if(e([26,69,223,163])){const o=t.subarray(4,4100),s=o.findIndex((l,a,h)=>h[a]===66&&h[a+1]===130);if(s!==-1){const l=s+3,a=h=>[...h].every((y,C)=>o[l+C]===y.charCodeAt(0));if(a("matroska"))return{ext:"mkv",mime:"video/x-matroska"};if(a("webm"))return{ext:"webm",mime:"video/webm"}}}if(e([0,0,0,20,102,116,121,112,113,116,32,32])||e([102,114,101,101],{offset:4})||e([102,116,121,112,113,116,32,32],{offset:4})||e([109,100,97,116],{offset:4})||e([109,111,111,118],{offset:4})||e([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(e([82,73,70,70])){if(e([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(e([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(e([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(e([48,38,178,117,142,102,207,17,166,217])){let o=30;do{const s=readUInt64LE(t,o+16);if(e([145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101],{offset:o})){if(e([64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43],{offset:o+24}))return{ext:"wma",mime:"audio/x-ms-wma"};if(e([192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43],{offset:o+24}))return{ext:"wmv",mime:"video/x-ms-asf"};break}o+=s}while(o+24<=t.length);return{ext:"asf",mime:"application/vnd.ms-asf"}}if(e([0,0,1,186])||e([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(e([102,116,121,112,51,103],{offset:4}))return{ext:"3gp",mime:"video/3gpp"};for(let o=0;o<2&&o<t.length-16;o++){if(e([73,68,51],{offset:o})||e([255,226],{offset:o,mask:[255,226]}))return{ext:"mp3",mime:"audio/mpeg"};if(e([255,228],{offset:o,mask:[255,228]}))return{ext:"mp2",mime:"audio/mpeg"};if(e([255,248],{offset:o,mask:[255,252]}))return{ext:"mp2",mime:"audio/mpeg"};if(e([255,240],{offset:o,mask:[255,252]}))return{ext:"mp4",mime:"audio/mpeg"}}if(e([102,116,121,112,77,52,65],{offset:4}))return{ext:"m4a",mime:"audio/mp4"};if(e([79,112,117,115,72,101,97,100],{offset:28}))return{ext:"opus",mime:"audio/opus"};if(e([79,103,103,83]))return e([128,116,104,101,111,114,97],{offset:28})?{ext:"ogv",mime:"video/ogg"}:e([1,118,105,100,101,111,0],{offset:28})?{ext:"ogm",mime:"video/ogg"}:e([127,70,76,65,67],{offset:28})?{ext:"oga",mime:"audio/ogg"}:e([83,112,101,101,120,32,32],{offset:28})?{ext:"spx",mime:"audio/ogg"}:e([1,118,111,114,98,105,115],{offset:28})?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"};if(e([102,76,97,67]))return{ext:"flac",mime:"audio/x-flac"};if(e([77,65,67,32]))return{ext:"ape",mime:"audio/ape"};if(e([119,118,112,107]))return{ext:"wv",mime:"audio/wavpack"};if(e([35,33,65,77,82,10]))return{ext:"amr",mime:"audio/amr"};if(e([37,80,68,70]))return{ext:"pdf",mime:"application/pdf"};if(e([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if((t[0]===67||t[0]===70)&&e([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(e([123,92,114,116,102]))return{ext:"rtf",mime:"application/rtf"};if(e([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(e([119,79,70,70])&&(e([0,1,0,0],{offset:4})||e([79,84,84,79],{offset:4})))return{ext:"woff",mime:"font/woff"};if(e([119,79,70,50])&&(e([0,1,0,0],{offset:4})||e([79,84,84,79],{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(e([76,80],{offset:34})&&(e([0,0,1],{offset:8})||e([1,0,2],{offset:8})||e([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(e([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(e([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(e([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(e([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(e([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(e([37,33]))return{ext:"ps",mime:"application/postscript"};if(e([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(e([83,81,76,105]))return{ext:"sqlite",mime:"application/x-sqlite3"};if(e([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(e([67,114,50,52]))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(e([77,83,67,70])||e([73,83,99,40]))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(e([33,60,97,114,99,104,62,10,100,101,98,105,97,110,45,98,105,110,97,114,121]))return{ext:"deb",mime:"application/x-deb"};if(e([33,60,97,114,99,104,62]))return{ext:"ar",mime:"application/x-unix-archive"};if(e([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(e([31,160])||e([31,157]))return{ext:"Z",mime:"application/x-compress"};if(e([76,90,73,80]))return{ext:"lz",mime:"application/x-lzip"};if(e([208,207,17,224,161,177,26,225]))return{ext:"msi",mime:"application/x-msi"};if(e([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(e([71],{offset:4})&&(e([71],{offset:192})||e([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(e([66,76,69,78,68,69,82]))return{ext:"blend",mime:"application/x-blender"};if(e([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(e([0,0,0,12,106,80,32,32,13,10,135,10])){if(e([106,112,50,32],{offset:20}))return{ext:"jp2",mime:"image/jp2"};if(e([106,112,120,32],{offset:20}))return{ext:"jpx",mime:"image/jpx"};if(e([106,112,109,32],{offset:20}))return{ext:"jpm",mime:"image/jpm"};if(e([109,106,112,50],{offset:20}))return{ext:"mj2",mime:"image/mj2"}}if(e([70,79,82,77]))return{ext:"aif",mime:"audio/aiff"};if(r("<?xml "))return{ext:"xml",mime:"application/xml"};if(e([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(e([102,116,121,112],{offset:4})){if(e([109,105,102,49],{offset:8}))return{ext:"heic",mime:"image/heif"};if(e([109,115,102,49],{offset:8}))return{ext:"heic",mime:"image/heif-sequence"};if(e([104,101,105,99],{offset:8})||e([104,101,105,120],{offset:8}))return{ext:"heic",mime:"image/heic"};if(e([104,101,118,99],{offset:8})||e([104,101,118,120],{offset:8}))return{ext:"heic",mime:"image/heic-sequence"}}return e([171,75,84,88,32,49,49,187,13,10,26,10])?{ext:"ktx",mime:"image/ktx"}:e([68,73,67,77],{offset:128})?{ext:"dcm",mime:"application/dicom"}:e([77,80,43])?{ext:"mpc",mime:"audio/x-musepack"}:e([77,80,67,75])?{ext:"mpc",mime:"audio/x-musepack"}:e([66,69,71,73,78,58])?{ext:"ics",mime:"text/calendar"}:e([103,108,84,70,2,0,0,0])?{ext:"glb",mime:"model/gltf-binary"}:e([212,195,178,161])||e([161,178,195,212])?{ext:"pcap",mime:"application/vnd.tcpdump.pcap"}:null};module.exports=fileType,module.exports.default=fileType,Object.defineProperty(fileType,"minimumBytes",{value:4100}),module.exports.stream=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.once("readable",()=>{const n=new stream.PassThrough,t=readableStream.read(module.exports.minimumBytes)||readableStream.read();try{n.fileType=fileType(t)}catch(e){reject(e)}readableStream.unshift(t),stream.pipeline?resolve(stream.pipeline(readableStream,n,()=>{})):resolve(readableStream.pipe(n))})})})(fileType$1);var fileTypeExports=fileType$1.exports;const fileType=fileTypeExports,imageExts=new Set(["jpg","png","gif","webp","flif","cr2","tif","bmp","jxr","psd","ico","bpg","jp2","jpm","jpx","heic","cur","dcm"]),imageType=n=>{const t=fileType(n);return imageExts.has(t&&t.ext)?t:null};imageType$2.exports=imageType;imageType$2.exports.default=imageType;Object.defineProperty(imageType,"minimumBytes",{value:fileType.minimumBytes});var imageTypeExports=imageType$2.exports;const imageType$1=getDefaultExportFromCjs(imageTypeExports);function guessStripByteCounts(n){if(n.compression!==1)throw new Error("missing mandatory StripByteCounts field in compressed image");const t=n.rowsPerStrip*n.width*n.samplesPerPixel*(n.bitsPerSample/8);return new Array(n.stripOffsets.length).fill(t)}function applyHorizontalDifferencing8Bit(n,t,e){let r=0;for(;r<n.length;){for(let o=e;o<t*e;o+=e)for(let s=0;s<e;s++)n[r+o+s]=n[r+o+s]+n[r+o-(e-s)]&255;r+=t*e}}function applyHorizontalDifferencing16Bit(n,t,e){let r=0;for(;r<n.length;){for(let o=e;o<t*e;o+=e)for(let s=0;s<e;s++)n[r+o+s]=n[r+o+s]+n[r+o-(e-s)]&65535;r+=t*e}}const tagsById$2={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$2={};for(let n in tagsById$2)tagsByName$2[tagsById$2[n]]=Number(n);const exif=Object.freeze(Object.defineProperty({__proto__:null,tagsById:tagsById$2,tagsByName:tagsByName$2},Symbol.toStringTag,{value:"Module"})),tagsById$1={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$1={};for(let n in tagsById$1)tagsByName$1[tagsById$1[n]]=Number(n);const gps=Object.freeze(Object.defineProperty({__proto__:null,tagsById:tagsById$1,tagsByName:tagsByName$1},Symbol.toStringTag,{value:"Module"})),tagsById={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName={};for(let n in tagsById)tagsByName[tagsById[n]]=Number(n);const standard=Object.freeze(Object.defineProperty({__proto__:null,tagsById,tagsByName},Symbol.toStringTag,{value:"Module"})),tags={standard,exif,gps};class IFD{constructor(t){if(!t)throw new Error("missing kind");this.data=new Uint8Array,this.fields=new Map,this.kind=t,this._hasMap=!1,this._map={}}get(t){if(typeof t=="number")return this.fields.get(t);if(typeof t=="string")return this.fields.get(tags[this.kind].tagsByName[t]);throw new Error("expected a number or string")}get map(){if(!this._hasMap){const t=tags[this.kind].tagsById;for(let e of this.fields.keys())t[e]&&(this._map[t[e]]=this.fields.get(e));this._hasMap=!0}return this._map}}let types=new Map([[1,[1,readByte]],[2,[1,readASCII]],[3,[2,readShort]],[4,[4,readLong]],[5,[8,readRational]],[6,[1,readSByte]],[7,[1,readByte]],[8,[2,readSShort]],[9,[4,readSLong]],[10,[8,readSRational]],[11,[4,readFloat]],[12,[8,readDouble]]]);function getByteLength(n,t){const e=types.get(n);if(!e)throw new Error(`type not found: ${n}`);return e[0]*t}function readData(n,t,e){const r=types.get(t);if(!r)throw new Error(`type not found: ${t}`);return r[1](n,e)}function readByte(n,t){if(t===1)return n.readUint8();let e=new Uint8Array(t);for(let r=0;r<t;r++)e[r]=n.readUint8();return e}function readASCII(n,t){let e=[],r="";for(let o=0;o<t;o++){let s=String.fromCharCode(n.readUint8());s==="\0"?(e.push(r),r=""):r+=s}return e.length===1?e[0]:e}function readShort(n,t){if(t===1)return n.readUint16();let e=new Uint16Array(t);for(let r=0;r<t;r++)e[r]=n.readUint16();return e}function readLong(n,t){if(t===1)return n.readUint32();let e=new Uint32Array(t);for(let r=0;r<t;r++)e[r]=n.readUint32();return e}function readRational(n,t){if(t===1)return n.readUint32()/n.readUint32();let e=new Array(t);for(let r=0;r<t;r++)e[r]=n.readUint32()/n.readUint32();return e}function readSByte(n,t){if(t===1)return n.readInt8();let e=new Int8Array(t);for(let r=0;r<t;r++)e[r]=n.readInt8();return e}function readSShort(n,t){if(t===1)return n.readInt16();let e=new Int16Array(t);for(let r=0;r<t;r++)e[r]=n.readInt16();return e}function readSLong(n,t){if(t===1)return n.readInt32();let e=new Int32Array(t);for(let r=0;r<t;r++)e[r]=n.readInt32();return e}function readSRational(n,t){if(t===1)return n.readInt32()/n.readInt32();let e=new Array(t);for(let r=0;r<t;r++)e[r]=n.readInt32()/n.readInt32();return e}function readFloat(n,t){if(t===1)return n.readFloat32();let e=new Float32Array(t);for(let r=0;r<t;r++)e[r]=n.readFloat32();return e}function readDouble(n,t){if(t===1)return n.readFloat64();let e=new Float64Array(t);for(let r=0;r<t;r++)e[r]=n.readFloat64();return e}const CLEAR_CODE=256,EOI_CODE=257,TABLE_START=258,MIN_BIT_LENGTH=9;let stringTable=[];function initializeStringTable(){if(stringTable.length===0){for(let t=0;t<256;t++)stringTable.push([t]);const n=[];for(let t=256;t<4096;t++)stringTable.push(n)}}const andTable=[511,1023,2047,4095],bitJumps=[0,0,0,0,0,0,0,0,0,511,1023,2047,4095];class LzwDecoder{constructor(t){this.nextData=0,this.nextBits=0,this.bytePointer=0,this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH,this.stripArray=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),this.outData=new IOBuffer$4(t.byteLength),this.initializeTable()}decode(){let t=0,e=0;for(;(t=this.getNextCode())!==EOI_CODE;)if(t===CLEAR_CODE){if(this.initializeTable(),t=this.getNextCode(),t===EOI_CODE)break;this.writeString(this.stringFromCode(t)),e=t}else if(this.isInTable(t))this.writeString(this.stringFromCode(t)),this.addStringToTable(this.stringFromCode(e).concat(this.stringFromCode(t)[0])),e=t;else{const o=this.stringFromCode(e).concat(this.stringFromCode(e)[0]);this.writeString(o),this.addStringToTable(o),e=t}const r=this.outData.toArray();return new DataView(r.buffer,r.byteOffset,r.byteLength)}initializeTable(){initializeStringTable(),this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH}writeString(t){this.outData.writeBytes(t)}stringFromCode(t){return stringTable[t]}isInTable(t){return t<this.tableLength}addStringToTable(t){if(stringTable[this.tableLength++]=t,stringTable.length>4096)throw stringTable=[],new Error("LZW decoding error. Please open an issue at https://github.com/image-js/tiff/issues/new/choose (include a test image).");this.tableLength===bitJumps[this.currentBitLength]&&this.currentBitLength++}getNextCode(){this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8,this.nextBits<this.currentBitLength&&(this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8);const t=this.nextData>>this.nextBits-this.currentBitLength&andTable[this.currentBitLength-9];return this.nextBits-=this.currentBitLength,this.bytePointer>this.stripArray.length?257:t}}function decompressLzw(n){return new LzwDecoder(n).decode()}const dateTimeRegex=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class TiffIfd extends IFD{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){let t=new Date,e=dateTimeRegex.exec(this.dateTime);if(e===null)throw new Error(`invalid dateTime: ${this.dateTime}`);return t.setFullYear(Number(e[1]),Number(e[2])-1,Number(e[3])),t.setHours(Number(e[4]),Number(e[5]),Number(e[6])),t}get newSubfileType(){return this.get("NewSubfileType")}get imageWidth(){return this.get("ImageWidth")}get imageLength(){return this.get("ImageLength")}get bitsPerSample(){const t=this.get("BitsPerSample");return t&&typeof t!="number"?t[0]:t}get alpha(){const t=this.extraSamples;return t?t[0]!==0:!1}get associatedAlpha(){const t=this.extraSamples;return t?t[0]===1:!1}get extraSamples(){return alwaysArray(this.get("ExtraSamples"))}get compression(){return this.get("Compression")||1}get type(){return this.get("PhotometricInterpretation")}get fillOrder(){return this.get("FillOrder")||1}get documentName(){return this.get("DocumentName")}get imageDescription(){return this.get("ImageDescription")}get stripOffsets(){return alwaysArray(this.get("StripOffsets"))}get orientation(){return this.get("Orientation")}get samplesPerPixel(){return this.get("SamplesPerPixel")||1}get rowsPerStrip(){return this.get("RowsPerStrip")}get stripByteCounts(){return alwaysArray(this.get("StripByteCounts"))}get minSampleValue(){return this.get("MinSampleValue")||0}get maxSampleValue(){return this.get("MaxSampleValue")||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get("XResolution")}get yResolution(){return this.get("YResolution")}get planarConfiguration(){return this.get("PlanarConfiguration")||1}get resolutionUnit(){return this.get("ResolutionUnit")||2}get dateTime(){return this.get("DateTime")}get predictor(){return this.get("Predictor")||1}get sampleFormat(){return this.get("SampleFormat")||1}get sMinSampleValue(){return this.get("SMinSampleValue")||this.minSampleValue}get sMaxSampleValue(){return this.get("SMaxSampleValue")||this.maxSampleValue}get palette(){const t=2**this.bitsPerSample,e=this.get("ColorMap");if(!e)return;if(e.length!==3*t)throw new Error(`ColorMap size must be ${t}`);const r=[];for(let o=0;o<t;o++)r.push([e[o],e[o+t],e[o+2*t]]);return r}}function alwaysArray(n){return typeof n=="number"?[n]:n}function decompressZlib(n){const t=new Uint8Array(n.buffer,n.byteOffset,n.byteLength),e=inflate_1(t);return new DataView(e.buffer,e.byteOffset,e.byteLength)}const defaultOptions$c={ignoreImageData:!1,onlyFirst:!1};class TIFFDecoder extends IOBuffer$4{constructor(t){super(t),this._nextIFD=0}get isMultiPage(){let t=0;for(this.decodeHeader();this._nextIFD;)if(t++,this.decodeIFD({ignoreImageData:!0},!0),t===2)return!0;if(t===1)return!1;throw unsupported("ifdCount",t)}get pageCount(){let t=0;for(this.decodeHeader();this._nextIFD;)t++,this.decodeIFD({ignoreImageData:!0},!0);if(t>0)return t;throw unsupported("ifdCount",t)}decode(t={}){t=Object.assign({},defaultOptions$c,t);const e=[];for(this.decodeHeader();this._nextIFD;)if(e.push(this.decodeIFD(t,!0)),t.onlyFirst)return[e[0]];return e}decodeHeader(){const t=this.readUint16();if(t===18761)this.setLittleEndian();else if(t===19789)this.setBigEndian();else throw new Error(`invalid byte order: 0x${t.toString(16)}`);if(this.readUint16()!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(t,e){this.seek(this._nextIFD);let r;if(e)r=new TiffIfd;else{if(!t.kind)throw new Error("kind is missing");r=new IFD(t.kind)}const o=this.readUint16();for(let s=0;s<o;s++)this.decodeIFDEntry(r);if(!t.ignoreImageData){if(!(r instanceof TiffIfd))throw new Error("must be a tiff ifd");this.decodeImageData(r)}return this._nextIFD=this.readUint32(),r}decodeIFDEntry(t){const e=this.offset,r=this.readUint16(),o=this.readUint16(),s=this.readUint32();if(o<1||o>12){this.skip(4);return}getByteLength(o,s)>4&&this.seek(this.readUint32());const a=readData(this,o,s);if(t.fields.set(r,a),r===34665||r===34853){let h=this.offset,y="exif";r===34665?y="exif":r===34853&&(y="gps"),this._nextIFD=a,t[y]=this.decodeIFD({kind:y,ignoreImageData:!0},!1),this.offset=h}this.seek(e),this.skip(12)}decodeImageData(t){const e=t.orientation;if(e&&e!==1)throw unsupported("orientation",e);switch(t.type){case 0:case 1:case 2:case 3:this.readStripData(t);break;default:throw unsupported("image type",t.type)}if(this.applyPredictor(t),this.convertAlpha(t),t.type===0){const r=t.bitsPerSample,o=Math.pow(2,r)-1;for(let s=0;s<t.data.length;s++)t.data[s]=o-t.data[s]}}readStripData(t){const e=t.width,r=t.height,o=t.bitsPerSample,s=t.sampleFormat,l=e*r*t.samplesPerPixel,a=getDataArray(l,o,s),y=t.rowsPerStrip*e*t.samplesPerPixel,C=t.stripOffsets,L=t.stripByteCounts||guessStripByteCounts(t);let Y=l,ze=0;for(let Bt=0;Bt<C.length;Bt++){let Ir=new DataView(this.buffer,this.byteOffset+C[Bt],L[Bt]),Wr=Y>y?y:Y;Y-=Wr;let yi=Ir;switch(t.compression){case 1:break;case 5:{yi=decompressLzw(Ir);break}case 8:{yi=decompressZlib(Ir);break}case 2:throw unsupported("Compression","CCITT Group 3");case 32773:throw unsupported("Compression","PackBits");default:throw unsupported("Compression",t.compression)}ze=this.fillUncompressed(o,s,a,yi,ze,Wr)}t.data=a}fillUncompressed(t,e,r,o,s,l){if(t===8)return fill8bit(r,o,s,l);if(t===16)return fill16bit(r,o,s,l,this.isLittleEndian());if(t===32&&e===3)return fillFloat32(r,o,s,l,this.isLittleEndian());throw unsupported("bitDepth",t)}applyPredictor(t){const e=t.bitsPerSample;switch(t.predictor){case 1:break;case 2:{if(e===8)applyHorizontalDifferencing8Bit(t.data,t.width,t.components);else if(e===16)applyHorizontalDifferencing16Bit(t.data,t.width,t.components);else throw new Error(`Horizontal differencing is only supported for images with a bit depth of ${e}`);break}default:throw new Error(`invalid predictor: ${t.predictor}`)}}convertAlpha(t){if(t.alpha&&t.associatedAlpha){const{data:e,components:r,maxSampleValue:o}=t;for(let s=0;s<e.length;s+=r){const l=e[s+r-1];for(let a=0;a<r-1;a++)e[s+a]=Math.round(e[s+a]*o/l)}}}}function getDataArray(n,t,e){if(t===8)return new Uint8Array(n);if(t===16)return new Uint16Array(n);if(t===32&&e===3)return new Float32Array(n);throw unsupported("bit depth / sample format",`${t} / ${e}`)}function fill8bit(n,t,e,r){for(let o=0;o<r;o++)n[e++]=t.getUint8(o);return e}function fill16bit(n,t,e,r,o){for(let s=0;s<r*2;s+=2)n[e++]=t.getUint16(s,o);return e}function fillFloat32(n,t,e,r,o){for(let s=0;s<r*4;s+=4)n[e++]=t.getFloat32(s,o);return e}function unsupported(n,t){return new Error(`Unsupported ${n}: ${t}`)}function decodeTIFF(n,t){return new TIFFDecoder(n).decode(t)}function matchAndCrop(n={}){let{algorithm:t="matchToPrevious",ignoreBorder:e=[0,0]}=n;this.checkProcessable("matchAndCrop",{bitDepth:[8,16]});let r=t==="matchToPrevious",o=this[0],s=[];s[0]={position:[0,0],image:this[0]};let l=[0,0];for(let Y=1;Y<this.length;Y++){let ze=o.getBestMatch(this[Y],{border:e});s[Y]={position:[ze[0]+l[0],ze[1]+l[1]],image:this[Y]},r&&(l[0]+=ze[0],l[1]+=ze[1],o=this[Y])}let a=0,h=0,y=0,C=0;for(let Y=0;Y<s.length;Y++){let ze=s[Y];ze.position[0]>a&&(a=ze.position[0]),ze.position[0]<h&&(h=ze.position[0]),ze.position[1]>y&&(y=ze.position[1]),ze.position[1]<C&&(C=ze.position[1])}h=0-h,C=0-C;for(let Y=0;Y<s.length;Y++){let ze=s[Y];ze.crop=ze.image.crop({x:a-ze.position[0],y:y-ze.position[1],width:o.width-h-a,height:o.height-C-y})}let L=[];for(let Y=0;Y<s.length;Y++)L[Y]=s[Y].crop;return new Stack(L)}function min$2(){this.checkProcessable("min",{bitDepth:[8,16]});let n=this[0].min;for(let t=1;t<this.length;t++)for(let e=0;e<n.length;e++)n[e]=Math.min(n[e],this[t].min[e]);return n}function max$2(){this.checkProcessable("min",{bitDepth:[8,16]});let n=this[0].max;for(let t=1;t<this.length;t++)for(let e=0;e<n.length;e++)n[e]=Math.max(n[e],this[t].max[e]);return n}function median$2(n){let t=n.reduce((l,a)=>l+a);if(t===0)throw new Error("unreachable");let e=0,r=0,o=t/2,s;for(;;){if(n[e]>0){if(s!==void 0)return(s+e)/2;if(r+=n[e],r>o)return e;r===o&&(s=e)}e++}}function mean$2(n){let t=0,e=0;for(let r=0;r<n.length;r++)t+=n[r],e+=n[r]*r;return t===0?0:e/t}function median$1(){this.checkProcessable("median",{bitDepth:[8,16]});let n=this.getHistograms({maxSlots:this[0].maxValue+1}),t=new Array(n.length);for(let e=0;e<n.length;e++){let r=n[e];t[e]=median$2(r)}return t}function histogram(n){this.checkProcessable("min",{bitDepth:[8,16]});let t=this[0].getHistogram(n);for(let e=1;e<this.length;e++){let r=this[e].getHistogram(n);for(let o=0;o<t.length;o++)t[o]+=r[o]}return t}function histograms(n){this.checkProcessable("min",{bitDepth:[8,16]});let t=this[0].getHistograms(n),e=t[0].length;for(let r=1;r<this.length;r++){let o=this[r].getHistograms(n);for(let s=0;s<t.length;s++)for(let l=0;l<e;l++)t[s][l]+=o[s][l]}return t}function averageImage(){this.checkProcessable("averageImage",{bitDepth:[8,16]});let n=new Uint32Array(this[0].data.length);for(let r=0;r<this.length;r++){let o=this[r];for(let s=0;s<this[0].data.length;s++)n[s]+=o.data[s]}let t=Image$1.createFrom(this[0]),e=t.data;for(let r=0;r<this[0].data.length;r++)e[r]=n[r]/this.length;return t}function maxImage(){this.checkProcessable("max",{bitDepth:[8,16]});let n=Image$1.createFrom(this[0]);n.data.fill(0);for(const t of this)for(let e=0;e<n.data.length;e++)n.data[e]=Math.max(t.data[e],n.data[e]);return n}function minImage(){this.checkProcessable("max",{bitDepth:[8,16]});let n=Image$1.createFrom(this[0]);n.data.fill(n.maxValue);for(const t of this)for(let e=0;e<n.data.length;e++)n.data[e]=Math.min(t.data[e],n.data[e]);return n}function extend$2(n){n.extendMethod("matchAndCrop",matchAndCrop),n.extendMethod("getMin",min$2),n.extendMethod("getMax",max$2),n.extendMethod("getMedian",median$1),n.extendMethod("getHistogram",histogram),n.extendMethod("getHistograms",histograms),n.extendMethod("getAverage",averageImage),n.extendMethod("getAverageImage",averageImage),n.extendMethod("getMaxImage",maxImage),n.extendMethod("getMinImage",minImage)}let computedPropertyDescriptor={configurable:!0,enumerable:!1,get:void 0};class Stack extends Array{constructor(t){if(Array.isArray(t)){super(t.length);for(let e=0;e<t.length;e++)this[e]=t[e]}else typeof t=="number"?super(t):super();this.computed=null}static load(t){return Promise.all(t.map(Image$1.load)).then(e=>new Stack(e))}static extendMethod(t,e,r={}){let{inPlace:o=!1,returnThis:s=!0,partialArgs:l=[]}=r;return o?Stack.prototype[t]=function(...a){this.computed=null;let h=e.apply(this,[...l,...a]);return s?this:h}:Stack.prototype[t]=function(...a){return e.apply(this,[...l,...a])},Stack}static extendProperty(t,e,r={}){let{partialArgs:o=[]}=r;return computedPropertyDescriptor.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(t,this.computed))return this.computed[t];let s=e.apply(this,o);return this.computed[t]=s,s},Object.defineProperty(Stack.prototype,t,computedPropertyDescriptor),Stack}checkProcessable(t,e={}){if(typeof t!="string")throw new TypeError("checkProcessable requires as first parameter the processName (a string)");if(this.size===0)throw new TypeError(`The process: ${t} can not be applied on an empty stack`);this[0].checkProcessable(t,e);for(let r=1;r<this.length;r++){if((e.sameSize===void 0||e.sameSize)&&this[0].width!==this[r].width)throw new TypeError(`The process: ${t} can not be applied if width is not identical in all images`);if((e.sameSize===void 0||e.sameSize)&&this[0].height!==this[r].height)throw new TypeError(`The process: ${t} can not be applied if height is not identical in all images`);if((e.sameAlpha===void 0||e.sameAlpha)&&this[0].alpha!==this[r].alpha)throw new TypeError(`The process: ${t} can not be applied if alpha is not identical in all images`);if((e.sameBitDepth===void 0||e.sameBitDepth)&&this[0].bitDepth!==this[r].bitDepth)throw new TypeError(`The process: ${t} can not be applied if bitDepth is not identical in all images`);if((e.sameColorModel===void 0||e.sameColorModel)&&this[0].colorModel!==this[r].colorModel)throw new TypeError(`The process: ${t} can not be applied if colorModel is not identical in all images`);if((e.sameNumberChannels===void 0||e.sameNumberChannels)&&this[0].channels!==this[r].channels)throw new TypeError(`The process: ${t} can not be applied if channels is not identical in all images`)}}}Array[Symbol.species]||(Stack.prototype.map=function(n,t){if(typeof n!="function")throw new TypeError(`${n} is not a function`);let e=new Stack(this.length);for(let r=0;r<this.length;r++)e[r]=n.call(t,this[r],r,this);return e});extend$2(Stack);const isDataURL=/^data:[a-z]+\/(?:[a-z]+);base64,/;function load(n,t){if(typeof n=="string")return loadURL(n,t);if(n instanceof ArrayBuffer)return Promise.resolve(loadBinary(new Uint8Array(n),void 0,t&&t.ignorePalette));if(n.buffer)return Promise.resolve(loadBinary(n,void 0,t&&t.ignorePalette));throw new Error('argument to "load" must be a string or buffer.')}function loadBinary(n,t,e){const r=imageType$1(n);if(r)switch(r.mime){case"image/png":return loadPNG(n);case"image/jpeg":return loadJPEG(n);case"image/tiff":return loadTIFF(n,e);default:return loadGeneric(o(r.mime))}return loadGeneric(o("application/octet-stream"));function o(s){return t||toBase64URL(n,s)}}function loadURL(n,t){const e=n.slice(0,64).match(isDataURL);let r;return e!==null?r=Promise.resolve(decode$3(n.slice(e[0].length))):r=fetchBinary(n,t),r.then(o=>{const s=new Uint8Array(o);return loadBinary(s,e?n:void 0,t&&t.ignorePalette)})}function loadPNG(n){const t=decodePng(n);let e=t.channels,r,o=0;return e===2||e===4?(r=e-1,o=1):r=e,t.palette?loadPNGFromPalette(t):new Image$1(t.width,t.height,t.data,{components:r,alpha:o,bitDepth:t.depth})}function loadPNGFromPalette(n){const t=n.width*n.height,e=n.palette[0].length,r=new Uint8Array(t*e),o=8/n.depth,s=n.depth<8?o:1,l=parseInt("1".repeat(n.depth),2),a=e===4;let h=0;for(let y=0;y<t;y++){const C=Math.floor(y/s);let L=n.data[C];n.depth<8&&(L=L>>>n.depth*(o-1-y%o)&l);const Y=n.palette[L];r[h++]=Y[0],r[h++]=Y[1],r[h++]=Y[2],a&&(r[h++]=Y[3])}return new Image$1(n.width,n.height,r,{components:3,alpha:a,bitDepth:8})}function loadJPEG(n){const t=decode(n);let e;t.exif&&(e=getMetadata(t.exif));const r=jpegJs.decode(n,{useTArray:!0,maxMemoryUsageInMB:1024});let o=new Image$1(r.width,r.height,r.data,{meta:e});if(e&&e.tiff.tags.Orientation){const s=e.tiff.tags.Orientation;s>2&&(o=o.rotate({3:180,4:180,5:90,6:90,7:270,8:270}[s])),[2,4,5,7].includes(s)&&(o=o.flipX())}return o}function loadTIFF(n,t){let e=decodeTIFF(n);return e.length===1?getImageFromIFD(e[0],t):new Stack(e.map(function(r){return getImageFromIFD(r,t)}))}function getMetadata(n){const t={tiff:{fields:n.fields,tags:n.map}};return n.exif&&(t.exif=n.exif),n.gps&&(t.gps=n.gps),t}function getImageFromIFD(n,t){if(!t&&n.type===3){const e=new Uint16Array(3*n.width*n.height),r=n.palette;let o=0;for(let s=0;s<n.data.length;s++){const l=n.data[s],a=r[l];e[o++]=a[0],e[o++]=a[1],e[o++]=a[2]}return new Image$1(n.width,n.height,e,{components:3,alpha:n.alpha,colorModel:RGB$1,bitDepth:16,meta:getMetadata(n)})}else return new Image$1(n.width,n.height,n.data,{components:n.type===2?3:1,alpha:n.alpha,colorModel:n.type===2?RGB$1:GREY$1,bitDepth:n.bitsPerSample.length?n.bitsPerSample[0]:n.bitsPerSample,meta:getMetadata(n)})}function loadGeneric(n,t){return t=t||{},new Promise(function(e,r){let o=new DOMImage;o.onload=function(){let s=o.width,l=o.height,h=createCanvas(s,l).getContext("2d");h.drawImage(o,0,0,s,l);let y=h.getImageData(0,0,s,l).data;e(new Image$1(s,l,y,t))},o.onerror=function(){r(new Error(`Could not load ${n}`))},o.src=n})}const valueMethods={getValueXY(n,t,e){return this.data[(t*this.width+n)*this.channels+e]},setValueXY(n,t,e,r){return this.data[(t*this.width+n)*this.channels+e]=r,this.computed=null,this},getValue(n,t){return this.data[n*this.channels+t]},setValue(n,t,e){return this.data[n*this.channels+t]=e,this.computed=null,this},getPixelXY(n,t){return this.getPixel(t*this.width+n)},setPixelXY(n,t,e){return this.setPixel(t*this.width+n,e)},getPixel(n){const t=new Array(this.channels),e=n*this.channels;for(let r=0;r<this.channels;r++)t[r]=this.data[e+r];return t},setPixel(n,t){const e=n*this.channels;for(let r=0;r<t.length;r++)this.data[e+r]=t[r];return this.computed=null,this}};function setValueMethods(n){for(const t in valueMethods)n.prototype[t]=valueMethods[t]}function getImageParameters(n){return{width:n.width,height:n.height,components:n.components,alpha:n.alpha,colorModel:n.colorModel,bitDepth:n.bitDepth}}function getOutputImage(n,t,e,r={}){const{out:o}=t;if(o===void 0)return r.copy?n.clone():Image$1.createFrom(n,e);{if(!Image$1.isImage(o))throw new TypeError("out must be an Image object");const s=Object.assign(getImageParameters(n),e);for(const l in s)if(o[l]!==s[l])throw new RangeError(`cannot use out. Its ${l} must be "${s[l]}" (found "${o[l]}")`);return o}}function getOutputImageOrInPlace(n,t,e){if(t.inPlace!==void 0&&typeof t.inPlace!="boolean")throw new TypeError("inPlace option must be a boolean");if(t.inPlace){if(t.out!==void 0)throw new TypeError("out option must not be set if inPlace option is true");return n}return getOutputImage(n,t,null,e)}function abs(n={}){this.checkProcessable("abs",{bitDepth:[32]});const t=getOutputImageOrInPlace(this,n);return absolute(this,t),t}function absolute(n,t){for(let e=0;e<n.data.length;e++)t.data[e]=Math.abs(n.data[e])}function copyAlphaChannel(n,t){if(n.alpha===1&&t.alpha===1)for(let e=0;e<n.size;e++)t.data[e*t.channels+t.components]=n.data[e*n.channels+n.components]}function invert(n={}){this.checkProcessable("invert",{bitDepth:[1,8,16]});const t=getOutputImageOrInPlace(this,n);return this.bitDepth===1?invertBinary(this,t):(invertColor(this,t),this!==t&&copyAlphaChannel(this,t)),t}function invertBinary(n,t){for(let e=0;e<n.data.length;e++)t.data[e]=~n.data[e]}function invertColor(n,t){for(let e=0;e<n.data.length;e+=n.channels)for(let r=0;r<n.components;r++)t.data[e+r]=n.maxValue-n.data[e+r]}function flipX(){this.checkProcessable("flipX",{bitDepth:[8,16]});for(let n=0;n<this.height;n++){let t=n*this.width*this.channels;for(let e=0;e<Math.floor(this.width/2);e++){let r=e*this.channels+t,o=(this.width-e-1)*this.channels+t;for(let s=0;s<this.channels;s++){let l=this.data[r+s];this.data[r+s]=this.data[o+s],this.data[o+s]=l}}}return this}function flipY(){this.checkProcessable("flipY",{bitDepth:[8,16]});for(let n=0;n<Math.floor(this.height/2);n++)for(let t=0;t<this.width;t++){let e=t*this.channels+n*this.width*this.channels,r=t*this.channels+(this.height-1-n)*this.channels*this.width;for(let o=0;o<this.channels;o++){let s=this.data[e+o];this.data[e+o]=this.data[r+o],this.data[r+o]=s}}return this}function blurFilter(n={}){const{radius:t=1}=n;if(t<1)throw new Error("radius must be greater than 1");const e=2*t+1,r=new Array(e);for(let o=0;o<e;o++){r[o]=new Array(e);for(let s=0;s<e;s++)r[o][s]=1/(e*e)}return this.convolution(r)}var medianQuickselect_min={exports:{}};(function(n){(function(){function t(o){for(var s=0,l=o.length-1,a=void 0,h=void 0,y=void 0,C=r(s,l);;){if(l<=s)return o[C];if(l==s+1)return o[s]>o[l]&&e(o,s,l),o[C];for(a=r(s,l),o[a]>o[l]&&e(o,a,l),o[s]>o[l]&&e(o,s,l),o[a]>o[s]&&e(o,a,s),e(o,a,s+1),h=s+1,y=l;;){do h++;while(o[s]>o[h]);do y--;while(o[y]>o[s]);if(y<h)break;e(o,h,y)}e(o,s,y),y<=C&&(s=h),y>=C&&(l=y-1)}}var e=function(s,l,a){var h;return h=[s[a],s[l]],s[l]=h[0],s[a]=h[1],h},r=function(s,l){return~~((s+l)/2)};n.exports?n.exports=t:window.median=t})()})(medianQuickselect_min);var medianQuickselect_minExports=medianQuickselect_min.exports;const quickSelectMedian=getDefaultExportFromCjs(medianQuickselect_minExports);function validateArrayOfChannels(n,t={}){let{channels:e,allowAlpha:r,defaultAlpha:o}=t;return typeof r!="boolean"&&(r=!0),typeof e>"u"?allChannels(n,o):validateChannels(n,e,r)}function allChannels(n,t){let e=t?n.channels:n.components,r=new Array(e);for(let o=0;o<e;o++)r[o]=o;return r}function validateChannels(n,t,e){Array.isArray(t)||(t=[t]);for(let r=0;r<t.length;r++)t[r]=validateChannel(n,t[r],e);return t}function validateChannel(n,t,e=!0){if(t===void 0)throw new RangeError(`validateChannel : the channel has to be >=0 and <${n.channels}`);if(typeof t=="string"){switch(n.colorModel){case GREY$1:break;case RGB$1:if("rgb".includes(t))switch(t){case"r":t=0;break;case"g":t=1;break;case"b":t=2;break}break;case HSL:if("hsl".includes(t))switch(t){case"h":t=0;break;case"s":t=1;break;case"l":t=2;break}break;case HSV:if("hsv".includes(t))switch(t){case"h":t=0;break;case"s":t=1;break;case"v":t=2;break}break;case CMYK$1:if("cmyk".includes(t))switch(t){case"c":t=0;break;case"m":t=1;break;case"y":t=2;break;case"k":t=3;break}break;default:throw new Error(`Unexpected color model: ${n.colorModel}`)}if(t==="a"){if(!n.alpha)throw new Error("validateChannel : the image does not contain alpha channel");t=n.components}if(typeof t=="string")throw new Error(`validateChannel : undefined channel: ${t}`)}if(t>=n.channels)throw new RangeError(`validateChannel : the channel has to be >=0 and <${n.channels}`);if(!e&&t>=n.components)throw new RangeError("validateChannel : alpha channel may not be selected");return t}function medianFilter(n={}){let{radius:t=1,border:e="copy",channels:r}=n;if(this.checkProcessable("medianFilter",{bitDepth:[8,16]}),t<1)throw new Error("radius must be greater than 0");r=validateArrayOfChannels(this,r);let o=t,s=t,l=Image$1.createFrom(this),a=(o*2+1)*(s*2+1),h=new Array(a);for(let y=0;y<r.length;y++){let C=r[y];for(let L=s;L<this.height-s;L++)for(let Y=o;Y<this.width-o;Y++){let ze=0;for(let Ir=-s;Ir<=s;Ir++)for(let Wr=-o;Wr<=o;Wr++){let yi=((L+Ir)*this.width+Y+Wr)*this.channels+C;h[ze++]=this.data[yi]}let Bt=(L*this.width+Y)*this.channels+C;l.data[Bt]=quickSelectMedian(h)}}if(this.alpha&&!r.includes(this.channels))for(let y=this.components;y<this.data.length;y=y+this.channels)l.data[y]=this.data[y];return l.setBorder({size:[o,s],algorithm:e}),l}function gaussianFilter(n={}){let{radius:t=1,sigma:e,channels:r,border:o="copy"}=n;this.checkProcessable("gaussian",{bitDepth:[8,16]});const s=getKernel(t,e);return this.convolution([s,s],{border:o,channels:r,algorithm:"separable"})}function getKernel(n,t){const e=n*2+1,r=new Array(e),o=t||((e-1)*.5-1)*.3+.8,s=-.5/(o*o);let l=0;for(let a=0;a<e;a++){const h=a-n,y=Math.exp(s*h*h);r[a]=y,l+=y}for(let a=0;a<e;a++)r[a]/=l;return r}const SOBEL_X=[[-1,0,1],[-2,0,2],[-1,0,1]],SOBEL_Y=[[-1,-2,-1],[0,0,0],[1,2,1]],SCHARR_X=[[3,0,-3],[10,0,-10],[3,0,-3]],SCHARR_Y=[[3,10,3],[0,0,0],[-3,-10,-3]];var src$3={},fftlib={};(function(n){(function(){var t;t=n;var e={release:"0.3.0",date:"2013-03"};t.toString=function(){return"version "+e.release+", released "+e.date};for(var r=0,o=null,s=null,l={init:function(y){if(y!==0&&!(y&y-1))r=y,l._initArray(),l._makeBitReversalTable(),l._makeCosSinTable();else throw new Error("init: radix-2 required")},fft1d:function(y,C){l.fft(y,C,1)},ifft1d:function(y,C){var L=1/r;l.fft(y,C,-1);for(var Y=0;Y<r;Y++)y[Y]*=L,C[Y]*=L},bt1d:function(y,C){l.fft(y,C,-1)},fft2d:function(y,C){for(var L=[],Y=[],ze=0,Bt=0;Bt<r;Bt++){ze=Bt*r;for(var Ir=0;Ir<r;Ir++)L[Ir]=y[Ir+ze],Y[Ir]=C[Ir+ze];l.fft1d(L,Y);for(var Wr=0;Wr<r;Wr++)y[Wr+ze]=L[Wr],C[Wr+ze]=Y[Wr]}for(var yi=0;yi<r;yi++){for(var Bn=0;Bn<r;Bn++)ze=yi+Bn*r,L[Bn]=y[ze],Y[Bn]=C[ze];l.fft1d(L,Y);for(var vi=0;vi<r;vi++)ze=yi+vi*r,y[ze]=L[vi],C[ze]=Y[vi]}},ifft2d:function(y,C){for(var L=[],Y=[],ze=0,Bt=0;Bt<r;Bt++){ze=Bt*r;for(var Ir=0;Ir<r;Ir++)L[Ir]=y[Ir+ze],Y[Ir]=C[Ir+ze];l.ifft1d(L,Y);for(var Wr=0;Wr<r;Wr++)y[Wr+ze]=L[Wr],C[Wr+ze]=Y[Wr]}for(var yi=0;yi<r;yi++){for(var Bn=0;Bn<r;Bn++)ze=yi+Bn*r,L[Bn]=y[ze],Y[Bn]=C[ze];l.ifft1d(L,Y);for(var vi=0;vi<r;vi++)ze=yi+vi*r,y[ze]=L[vi],C[ze]=Y[vi]}},fft:function(y,C,L){for(var Y,ze,Bt,Ir,Wr,yi,Bn,vi,wo,ia=r>>2,gl=0;gl<r;gl++)Ir=o[gl],gl<Ir&&(Wr=y[gl],y[gl]=y[Ir],y[Ir]=Wr,Wr=C[gl],C[gl]=C[Ir],C[Ir]=Wr);for(var ml=1;ml<r;ml<<=1){ze=0,Y=r/(ml<<1);for(var il=0;il<ml;il++){yi=s[ze+ia],Bn=L*s[ze];for(var sl=il;sl<r;sl+=ml<<1)Bt=sl+ml,vi=yi*y[Bt]+Bn*C[Bt],wo=yi*C[Bt]-Bn*y[Bt],y[Bt]=y[sl]-vi,y[sl]+=vi,C[Bt]=C[sl]-wo,C[sl]+=wo;ze+=Y}}},_initArray:function(){typeof Uint32Array<"u"?o=new Uint32Array(r):o=[],typeof Float64Array<"u"?s=new Float64Array(r*1.25):s=[]},_paddingZero:function(){},_makeBitReversalTable:function(){var y=0,C=0,L=0;for(o[0]=0;++y<r;){for(L=r>>1;L<=C;)C-=L,L>>=1;C+=L,o[y]=C}},_makeCosSinTable:function(){var y=r>>1,C=r>>2,L=r>>3,Y=y+C,ze=Math.sin(Math.PI/r),Bt=2*ze*ze,Ir=Math.sqrt(Bt*(2-Bt)),Wr=s[C]=1,yi=s[0]=0;ze=2*Bt;for(var Bn=1;Bn<L;Bn++)Wr-=Bt,Bt+=ze*Wr,yi+=Ir,Ir-=ze*yi,s[Bn]=yi,s[C-Bn]=Wr;L!==0&&(s[L]=Math.sqrt(.5));for(var vi=0;vi<C;vi++)s[y-vi]=s[vi];for(var wo=0;wo<Y;wo++)s[wo+y]=-s[wo]}},a=["init","fft1d","ifft1d","fft2d","ifft2d"],h=0;h<a.length;h++)t[a[h]]=l[a[h]];return t.bt=l.bt1d,t.fft=l.fft1d,t.ifft=l.ifft1d,t}).call(commonjsGlobal)})(fftlib);var FFT$1=fftlib,FFTUtils$1={DEBUG:!1,ifft2DArray:function(n,t,e){var r=new Array(t*e),o=t/2,s=(e-1)*2;FFT$1.init(o);for(var l={re:new Array(o),im:new Array(o)},a=0;a<e;a++){for(var h=o-1;h>=0;h--)l.re[h]=n[h*2*e+a],l.im[h]=n[(h*2+1)*e+a];FFT$1.bt(l.re,l.im);for(var h=o-1;h>=0;h--)r[h*2*e+a]=l.re[h],r[(h*2+1)*e+a]=l.im[h]}var y=new Array(o*s);FFT$1.init(s);for(var C={re:new Array(s),im:new Array(s)},L=s*o,h=0;h<t;h+=2){C.re[0]=r[h*e],C.im[0]=r[(h+1)*e];for(var a=1;a<e;a++)C.re[a]=r[h*e+a],C.im[a]=r[(h+1)*e+a],C.re[s-a]=r[h*e+a],C.im[s-a]=-r[(h+1)*e+a];FFT$1.bt(C.re,C.im);for(var Y=h/2*s,a=s-1;a>=0;a--)y[Y+a]=C.re[a]/L}return y},fft2DArray:function(n,t,e,r){Object.assign({},{inplace:!0});var o=e/2+1,s=t*2,l=new Array(s*o);FFT$1.init(e);for(var a={re:new Array(e),im:new Array(e)},h={re:new Array(e),im:new Array(e)},y={re:new Array(e),im:new Array(e)},C,L,Y,ze,Bt,Ir=0;Ir<t/2;Ir++){C=Ir*2*e,a.re=n.slice(C,C+e),C=(Ir*2+1)*e,a.im=n.slice(C,C+e),FFT$1.fft1d(a.re,a.im),this.reconstructTwoRealFFT(a,h,y),L=Ir*4*o,Y=(Ir*4+1)*o,ze=(Ir*4+2)*o,Bt=(Ir*4+3)*o;for(var Wr=o-1;Wr>=0;Wr--)l[L+Wr]=h.re[Wr],l[Y+Wr]=h.im[Wr],l[ze+Wr]=y.re[Wr],l[Bt+Wr]=y.im[Wr]}h=null,y=null;var yi=new Array(s*o);FFT$1.init(t);for(var Bn={re:new Array(t),im:new Array(t)},vi=o-1;vi>=0;vi--){for(var Ir=t-1;Ir>=0;Ir--)Bn.re[Ir]=l[Ir*2*o+vi],Bn.im[Ir]=l[(Ir*2+1)*o+vi],isNaN(Bn.re[Ir])&&(Bn.re[Ir]=0),isNaN(Bn.im[Ir])&&(Bn.im[Ir]=0);FFT$1.fft1d(Bn.re,Bn.im);for(var Ir=t-1;Ir>=0;Ir--)yi[Ir*2*o+vi]=Bn.re[Ir],yi[(Ir*2+1)*o+vi]=Bn.im[Ir]}return yi},reconstructTwoRealFFT:function(n,t,e){var r=n.re.length;t.re[0]=n.re[0],t.im[0]=0,e.re[0]=n.im[0],e.im[0]=0;for(var o,s,l,a,h,y=r/2;y>0;y--)h=r-y,o=.5*(n.re[y]-n.re[h]),s=.5*(n.re[y]+n.re[h]),l=.5*(n.im[y]-n.im[h]),a=.5*(n.im[y]+n.im[h]),t.re[y]=s,t.im[y]=l,t.re[h]=s,t.im[h]=-l,e.re[y]=a,e.im[y]=-o,e.re[h]=a,e.im[h]=o},convolute2DI:function(n,t,e,r){for(var o,s,l=0;l<e/2;l++)for(var a=0;a<r;a++)o=n[l*2*r+a]*t[l*2*r+a]-n[(l*2+1)*r+a]*t[(l*2+1)*r+a],s=n[l*2*r+a]*t[(l*2+1)*r+a]+n[(l*2+1)*r+a]*t[l*2*r+a],n[l*2*r+a]=o,n[(l*2+1)*r+a]=s},convolute:function(n,t,e,r,o){for(var s=new Array(r*e),l=0;l<e*r;l++)s[l]=n[l];s=this.fft2DArray(s,e,r);for(var a=t.length,h=t[0].length,y=new Array(r*e),l=0;l<r*e;l++)y[l]=0;for(var C,L,Y=Math.floor((a-1)/2),ze=Math.floor((h-1)/2),Bt=0;Bt<a;Bt++){C=(Bt-Y+e)%e;for(var Ir=0;Ir<h;Ir++)L=(Ir-ze+r)%r,y[C*r+L]=t[Bt][Ir]}y=this.fft2DArray(y,e,r);var Wr=e*2,yi=r/2+1;return this.convolute2DI(s,y,Wr,yi),this.ifft2DArray(s,Wr,yi)},toRadix2:function(n,t,e){var r,o,s,l,a=e,h=t;if(!(e!==0&&!(e&e-1))){for(a=0;e>>++a;);a=1<<a}if(!(t!==0&&!(t&t-1))){for(h=0;t>>++h;);h=1<<h}if(h==t&&a==e)return{data:n,rows:t,cols:e};var y=new Array(h*a),C=Math.floor((h-t)/2)-t,L=Math.floor((a-e)/2)-e;for(r=0;r<h;r++)for(s=r*a,l=(r-C)%t*e,o=0;o<a;o++)y[s+o]=n[l+(o-L)%e];return{data:y,rows:h,cols:a}},crop:function(n,t,e,r,o,s){if(t==r&&e==o)return n;Object.assign({},s);var l=new Array(o*r),a=Math.floor((t-r)/2),h=Math.floor((e-o)/2),y,C,L,Y;for(L=0;L<r;L++)for(y=L*o,C=(L+a)*e,Y=0;Y<o;Y++)l[y+Y]=n[C+(Y+h)];return l}},FFTUtils_1=FFTUtils$1;src$3.FFTUtils=FFTUtils_1;src$3.FFT=fftlib;var FFTUtils=src$3.FFTUtils;function convolutionFFT(n,t,e){var r=matrix2Array(n),o=r.data,s=Object.assign({normalize:!1,divisor:1,rows:r.rows,cols:r.cols},e),l,a;if(s.rows&&s.cols)l=s.rows,a=s.cols;else throw new Error("Invalid number of rows or columns "+l+" "+a);var h=s.divisor,y,C,L=t.length,Y=t[0].length;if(s.normalize)for(h=0,y=0;y<L;y++)for(C=0;C<Y;C++)h+=t[y][C];if(h===0)throw new RangeError("convolution: The divisor is equal to zero");var ze=FFTUtils.toRadix2(o,l,a),Bt=FFTUtils.convolute(ze.data,t,ze.rows,ze.cols);if(Bt=FFTUtils.crop(Bt,ze.rows,ze.cols,l,a),h!=0&&h!=1)for(y=0;y<Bt.length;y++)Bt[y]/=h;return Bt}function convolutionDirect(n,t,e){var r=matrix2Array(n),o=r.data,s=Object.assign({normalize:!1,divisor:1,rows:r.rows,cols:r.cols},e),l,a;if(s.rows&&s.cols)l=s.rows,a=s.cols;else throw new Error("Invalid number of rows or columns "+l+" "+a);var h=s.divisor,y=t.length,C=t[0].length,L,Y,ze,Bt,Ir,Wr,yi,Bn,vi;if(s.normalize)for(h=0,L=0;L<y;L++)for(Y=0;Y<C;Y++)h+=t[L][Y];if(h===0)throw new RangeError("convolution: The divisor is equal to zero");var wo=new Array(l*a),ia=Math.floor(y/2),gl=Math.floor(C/2);for(Bt=0;Bt<l;Bt++)for(ze=0;ze<a;ze++){for(Wr=0,Y=0;Y<y;Y++)for(L=0;L<C;L++)yi=t[y-Y-1][C-L-1],Bn=(Bt+Y-ia+l)%l,vi=(ze+L-gl+a)%a,Ir=Bn*a+vi,Wr+=o[Ir]*yi;Ir=Bt*a+ze,wo[Ir]=Wr/h}return wo}function LoG(n,t,e){var r=1e3;e&&e.factor&&(r=e.factor);var o=new Array(t),s,l,a,h;r*=-1;var y=(t-1)/2,C=2*n*n;for(s=0;s<t;s++)for(o[s]=new Array(t),h=(s-y)*(s-y),l=0;l<t;l++)a=-((l-y)*(l-y)+h)/C,o[s][l]=Math.round(r*(1+a)*Math.exp(a));return o}function matrix2Array(n){var t=n,e,r;if(typeof n[0]!="number"){e=n.length,r=n[0].length,t=new Array(e*r);for(var o=0;o<e;o++)for(var s=0;s<r;s++)t[o*r+s]=n[o][s]}else{var l=Math.sqrt(n.length);Number.isInteger(l)&&(e=l,r=l)}return{data:t,rows:e,cols:r}}var src$2={fft:convolutionFFT,direct:convolutionDirect,kernelFactory:{LoG},matrix2Array},_isFinite=Number.isFinite||function(n){return!(typeof n!="number"||n!==n||n===1/0||n===-1/0)},isFinite$1=_isFinite,isInteger=Number.isInteger||function(n){return typeof n=="number"&&isFinite$1(n)&&Math.floor(n)===n};const isInteger$1=getDefaultExportFromCjs(isInteger);function validateKernel(n){let t,e;if(Array.isArray(n))if(Array.isArray(n[0])){if(!(n.length&1)||!(n[0].length&1))throw new RangeError("validateKernel: Kernel rows and columns should be odd numbers");t=Math.floor(n.length/2),e=Math.floor(n[0].length/2)}else{let r=Math.sqrt(n.length);if(isInteger$1(r))e=t=Math.floor(Math.sqrt(n.length)/2);else throw new RangeError("validateKernel: Kernel array should be a square");let o=new Array(r);for(let s=0;s<r;s++){o[s]=new Array(r);for(let l=0;l<r;l++)o[s][l]=n[s*r+l]}n=o}else throw new Error(`validateKernel: Invalid Kernel: ${n}`);return{kernel:n,kWidth:e,kHeight:t}}function clamp(n,t){return Math.round(Math.min(Math.max(n,0),t.maxValue))}function directConvolution(n,t,e){if(e===void 0){const s=n.length+t.length-1;e=new Array(s)}fill(e);for(var r=0;r<n.length;r++)for(var o=0;o<t.length;o++)e[r+o]+=n[r]*t[o];return e}function fill(n){for(var t=0;t<n.length;t++)n[t]=0}function FFT(n){if(this.size=n|0,this.size<=1||this.size&this.size-1)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=n<<1;for(var t=new Array(this.size*2),e=0;e<t.length;e+=2){const h=Math.PI*e/this.size;t[e]=Math.cos(h),t[e+1]=-Math.sin(h)}this.table=t;for(var r=0,o=1;this.size>o;o<<=1)r++;this._width=r%2===0?r-1:r,this._bitrev=new Array(1<<this._width);for(var s=0;s<this._bitrev.length;s++){this._bitrev[s]=0;for(var l=0;l<this._width;l+=2){var a=this._width-l-2;this._bitrev[s]|=(s>>>l&3)<<a}}this._out=null,this._data=null,this._inv=0}FFT.prototype.fromComplexArray=function n(t,e){for(var r=e||new Array(t.length>>>1),o=0;o<t.length;o+=2)r[o>>>1]=t[o];return r};FFT.prototype.createComplexArray=function n(){const t=new Array(this._csize);for(var e=0;e<t.length;e++)t[e]=0;return t};FFT.prototype.toComplexArray=function n(t,e){for(var r=e||this.createComplexArray(),o=0;o<r.length;o+=2)r[o]=t[o>>>1],r[o+1]=0;return r};FFT.prototype.completeSpectrum=function n(t){for(var e=this._csize,r=e>>>1,o=2;o<r;o+=2)t[e-o]=t[o],t[e-o+1]=-t[o+1]};FFT.prototype.transform=function n(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=0,this._transform4(),this._out=null,this._data=null};FFT.prototype.realTransform=function n(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=0,this._realTransform4(),this._out=null,this._data=null};FFT.prototype.inverseTransform=function n(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=1,this._transform4();for(var r=0;r<t.length;r++)t[r]/=this.size;this._out=null,this._data=null};FFT.prototype._transform4=function n(){var t=this._out,e=this._csize,r=this._width,o=1<<r,s=e/o<<1,l,a,h=this._bitrev;if(s===4)for(l=0,a=0;l<e;l+=s,a++){const Ir=h[a];this._singleTransform2(l,Ir,o)}else for(l=0,a=0;l<e;l+=s,a++){const Ir=h[a];this._singleTransform4(l,Ir,o)}var y=this._inv?-1:1,C=this.table;for(o>>=2;o>=2;o>>=2){s=e/o<<1;var L=s>>>2;for(l=0;l<e;l+=s)for(var Y=l+L,ze=l,Bt=0;ze<Y;ze+=2,Bt+=o){const Ir=ze,Wr=Ir+L,yi=Wr+L,Bn=yi+L,vi=t[Ir],wo=t[Ir+1],ia=t[Wr],gl=t[Wr+1],ml=t[yi],il=t[yi+1],sl=t[Bn],ol=t[Bn+1],_l=vi,rh=wo,wh=C[Bt],Fh=y*C[Bt+1],Mh=ia*wh-gl*Fh,vp=ia*Fh+gl*wh,gp=C[2*Bt],Jh=y*C[2*Bt+1],Lp=ml*gp-il*Jh,Ip=ml*Jh+il*gp,$p=C[3*Bt],Xp=y*C[3*Bt+1],Cp=sl*$p-ol*Xp,Gp=sl*Xp+ol*$p,Rp=_l+Lp,od=rh+Ip,Wp=_l-Lp,Ld=rh-Ip,ed=Mh+Cp,Gd=vp+Gp,Kp=y*(Mh-Cp),Ad=y*(vp-Gp),Id=Rp+ed,Yh=od+Gd,Ap=Rp-ed,kd=od-Gd,cd=Wp+Ad,id=Ld-Kp,fp=Wp-Ad,Cd=Ld+Kp;t[Ir]=Id,t[Ir+1]=Yh,t[Wr]=cd,t[Wr+1]=id,t[yi]=Ap,t[yi+1]=kd,t[Bn]=fp,t[Bn+1]=Cd}}};FFT.prototype._singleTransform2=function n(t,e,r){const o=this._out,s=this._data,l=s[e],a=s[e+1],h=s[e+r],y=s[e+r+1],C=l+h,L=a+y,Y=l-h,ze=a-y;o[t]=C,o[t+1]=L,o[t+2]=Y,o[t+3]=ze};FFT.prototype._singleTransform4=function n(t,e,r){const o=this._out,s=this._data,l=this._inv?-1:1,a=r*2,h=r*3,y=s[e],C=s[e+1],L=s[e+r],Y=s[e+r+1],ze=s[e+a],Bt=s[e+a+1],Ir=s[e+h],Wr=s[e+h+1],yi=y+ze,Bn=C+Bt,vi=y-ze,wo=C-Bt,ia=L+Ir,gl=Y+Wr,ml=l*(L-Ir),il=l*(Y-Wr),sl=yi+ia,ol=Bn+gl,_l=vi+il,rh=wo-ml,wh=yi-ia,Fh=Bn-gl,Mh=vi-il,vp=wo+ml;o[t]=sl,o[t+1]=ol,o[t+2]=_l,o[t+3]=rh,o[t+4]=wh,o[t+5]=Fh,o[t+6]=Mh,o[t+7]=vp};FFT.prototype._realTransform4=function n(){var t=this._out,e=this._csize,r=this._width,o=1<<r,s=e/o<<1,l,a,h=this._bitrev;if(s===4)for(l=0,a=0;l<e;l+=s,a++){const $d=h[a];this._singleRealTransform2(l,$d>>>1,o>>>1)}else for(l=0,a=0;l<e;l+=s,a++){const $d=h[a];this._singleRealTransform4(l,$d>>>1,o>>>1)}var y=this._inv?-1:1,C=this.table;for(o>>=2;o>=2;o>>=2){s=e/o<<1;var L=s>>>1,Y=L>>>1,ze=Y>>>1;for(l=0;l<e;l+=s)for(var Bt=0,Ir=0;Bt<=ze;Bt+=2,Ir+=o){var Wr=l+Bt,yi=Wr+Y,Bn=yi+Y,vi=Bn+Y,wo=t[Wr],ia=t[Wr+1],gl=t[yi],ml=t[yi+1],il=t[Bn],sl=t[Bn+1],ol=t[vi],_l=t[vi+1],rh=wo,wh=ia,Fh=C[Ir],Mh=y*C[Ir+1],vp=gl*Fh-ml*Mh,gp=gl*Mh+ml*Fh,Jh=C[2*Ir],Lp=y*C[2*Ir+1],Ip=il*Jh-sl*Lp,$p=il*Lp+sl*Jh,Xp=C[3*Ir],Cp=y*C[3*Ir+1],Gp=ol*Xp-_l*Cp,Rp=ol*Cp+_l*Xp,od=rh+Ip,Wp=wh+$p,Ld=rh-Ip,ed=wh-$p,Gd=vp+Gp,Kp=gp+Rp,Ad=y*(vp-Gp),Id=y*(gp-Rp),Yh=od+Gd,Ap=Wp+Kp,kd=Ld+Id,cd=ed-Ad;if(t[Wr]=Yh,t[Wr+1]=Ap,t[yi]=kd,t[yi+1]=cd,Bt===0){var id=od-Gd,fp=Wp-Kp;t[Bn]=id,t[Bn+1]=fp;continue}if(Bt!==ze){var Cd=Ld,Fd=-ed,yd=od,kp=-Wp,Uf=-y*Id,$f=-y*Ad,up=-y*Kp,ud=-y*Gd,xd=Cd+Uf,Ed=Fd+$f,Vd=yd+ud,Ep=kp-up,Yp=l+Y-Bt,nd=l+L-Bt;t[Yp]=xd,t[Yp+1]=Ed,t[nd]=Vd,t[nd+1]=Ep}}}};FFT.prototype._singleRealTransform2=function n(t,e,r){const o=this._out,s=this._data,l=s[e],a=s[e+r],h=l+a,y=l-a;o[t]=h,o[t+1]=0,o[t+2]=y,o[t+3]=0};FFT.prototype._singleRealTransform4=function n(t,e,r){const o=this._out,s=this._data,l=this._inv?-1:1,a=r*2,h=r*3,y=s[e],C=s[e+r],L=s[e+a],Y=s[e+h],ze=y+L,Bt=y-L,Ir=C+Y,Wr=l*(C-Y),yi=ze+Ir,Bn=Bt,vi=-Wr,wo=ze-Ir,ia=Bt,gl=Wr;o[t]=yi,o[t+1]=0,o[t+2]=Bn,o[t+3]=vi,o[t+4]=wo,o[t+5]=0,o[t+6]=ia,o[t+7]=gl};function convolutionSeparable(n,t,e,r){const o=new Array(n.length);let s,l,a,h;h=t[1],a=(h.length-1)/2,l=new Array(e+h.length-1),s=new Array(e);for(let y=0;y<r;y++){for(let C=0;C<e;C++)s[C]=n[y*e+C];directConvolution(s,h,l);for(let C=0;C<e;C++)o[y*e+C]=l[a+C]}h=t[0],a=(h.length-1)/2,l=new Array(r+h.length-1),s=new Array(r);for(let y=0;y<e;y++){for(let C=0;C<r;C++)s[C]=o[C*e+y];directConvolution(s,h,l);for(let C=0;C<r;C++)o[C*e+y]=l[a+C]}return o}const toString$1=Object.prototype.toString;function isAnyArray(n){const t=toString$1.call(n);return t.endsWith("Array]")&&!t.includes("Big")}function max$1(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(n))throw new TypeError("input must be an array");if(n.length===0)throw new TypeError("input must not be empty");var e=t.fromIndex,r=e===void 0?0:e,o=t.toIndex,s=o===void 0?n.length:o;if(r<0||r>=n.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=r||s>n.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var l=n[r],a=r+1;a<s;a++)n[a]>l&&(l=n[a]);return l}function min$1(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(n))throw new TypeError("input must be an array");if(n.length===0)throw new TypeError("input must not be empty");var e=t.fromIndex,r=e===void 0?0:e,o=t.toIndex,s=o===void 0?n.length:o;if(r<0||r>=n.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=r||s>n.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var l=n[r],a=r+1;a<s;a++)n[a]<l&&(l=n[a]);return l}function rescale(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(isAnyArray(n)){if(n.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var e;if(t.output!==void 0){if(!isAnyArray(t.output))throw new TypeError("output option must be an array if specified");e=t.output}else e=new Array(n.length);var r=min$1(n),o=max$1(n);if(r===o)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var s=t.min,l=s===void 0?t.autoMinMax?r:0:s,a=t.max,h=a===void 0?t.autoMinMax?o:1:a;if(l>=h)throw new RangeError("min option must be smaller than max option");for(var y=(h-l)/(o-r),C=0;C<n.length;C++)e[C]=(n[C]-r)*y+l;return e}const indent=" ".repeat(2),indentData=" ".repeat(4);function inspectMatrix(){return inspectMatrixWithOptions(this)}function inspectMatrixWithOptions(n,t={}){const{maxRows:e=15,maxColumns:r=10,maxNumSize:o=8,padMinus:s="auto"}=t;return`${n.constructor.name} {
${indent}[
${indentData}${inspectData(n,e,r,o,s)}
${indent}]
${indent}rows: ${n.rows}
${indent}columns: ${n.columns}
}`}function inspectData(n,t,e,r,o){const{rows:s,columns:l}=n,a=Math.min(s,t),h=Math.min(l,e),y=[];if(o==="auto"){o=!1;e:for(let C=0;C<a;C++)for(let L=0;L<h;L++)if(n.get(C,L)<0){o=!0;break e}}for(let C=0;C<a;C++){let L=[];for(let Y=0;Y<h;Y++)L.push(formatNumber(n.get(C,Y),r,o));y.push(`${L.join(" ")}`)}return h!==l&&(y[y.length-1]+=` ... ${l-e} more columns`),a!==s&&y.push(`... ${s-t} more rows`),y.join(`
${indentData}`)}function formatNumber(n,t,e){return(n>=0&&e?` ${formatNumber2(n,t-1)}`:formatNumber2(n,t)).padEnd(t)}function formatNumber2(n,t){let e=n.toString();if(e.length<=t)return e;let r=n.toFixed(t);if(r.length>t&&(r=n.toFixed(Math.max(0,t-(r.length-t)))),r.length<=t&&!r.startsWith("0.000")&&!r.startsWith("-0.000"))return r;let o=n.toExponential(t);return o.length>t&&(o=n.toExponential(Math.max(0,t-(o.length-t)))),o.slice(0)}function installMathOperations(n,t){n.prototype.add=function(r){return typeof r=="number"?this.addS(r):this.addM(r)},n.prototype.addS=function(r){for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)+r);return this},n.prototype.addM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)+r.get(o,s));return this},n.add=function(r,o){return new t(r).add(o)},n.prototype.sub=function(r){return typeof r=="number"?this.subS(r):this.subM(r)},n.prototype.subS=function(r){for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)-r);return this},n.prototype.subM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)-r.get(o,s));return this},n.sub=function(r,o){return new t(r).sub(o)},n.prototype.subtract=n.prototype.sub,n.prototype.subtractS=n.prototype.subS,n.prototype.subtractM=n.prototype.subM,n.subtract=n.sub,n.prototype.mul=function(r){return typeof r=="number"?this.mulS(r):this.mulM(r)},n.prototype.mulS=function(r){for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)*r);return this},n.prototype.mulM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)*r.get(o,s));return this},n.mul=function(r,o){return new t(r).mul(o)},n.prototype.multiply=n.prototype.mul,n.prototype.multiplyS=n.prototype.mulS,n.prototype.multiplyM=n.prototype.mulM,n.multiply=n.mul,n.prototype.div=function(r){return typeof r=="number"?this.divS(r):this.divM(r)},n.prototype.divS=function(r){for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)/r);return this},n.prototype.divM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)/r.get(o,s));return this},n.div=function(r,o){return new t(r).div(o)},n.prototype.divide=n.prototype.div,n.prototype.divideS=n.prototype.divS,n.prototype.divideM=n.prototype.divM,n.divide=n.div,n.prototype.mod=function(r){return typeof r=="number"?this.modS(r):this.modM(r)},n.prototype.modS=function(r){for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)%r);return this},n.prototype.modM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)%r.get(o,s));return this},n.mod=function(r,o){return new t(r).mod(o)},n.prototype.modulus=n.prototype.mod,n.prototype.modulusS=n.prototype.modS,n.prototype.modulusM=n.prototype.modM,n.modulus=n.mod,n.prototype.and=function(r){return typeof r=="number"?this.andS(r):this.andM(r)},n.prototype.andS=function(r){for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)&r);return this},n.prototype.andM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)&r.get(o,s));return this},n.and=function(r,o){return new t(r).and(o)},n.prototype.or=function(r){return typeof r=="number"?this.orS(r):this.orM(r)},n.prototype.orS=function(r){for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)|r);return this},n.prototype.orM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)|r.get(o,s));return this},n.or=function(r,o){return new t(r).or(o)},n.prototype.xor=function(r){return typeof r=="number"?this.xorS(r):this.xorM(r)},n.prototype.xorS=function(r){for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)^r);return this},n.prototype.xorM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)^r.get(o,s));return this},n.xor=function(r,o){return new t(r).xor(o)},n.prototype.leftShift=function(r){return typeof r=="number"?this.leftShiftS(r):this.leftShiftM(r)},n.prototype.leftShiftS=function(r){for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)<<r);return this},n.prototype.leftShiftM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)<<r.get(o,s));return this},n.leftShift=function(r,o){return new t(r).leftShift(o)},n.prototype.signPropagatingRightShift=function(r){return typeof r=="number"?this.signPropagatingRightShiftS(r):this.signPropagatingRightShiftM(r)},n.prototype.signPropagatingRightShiftS=function(r){for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)>>r);return this},n.prototype.signPropagatingRightShiftM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)>>r.get(o,s));return this},n.signPropagatingRightShift=function(r,o){return new t(r).signPropagatingRightShift(o)},n.prototype.rightShift=function(r){return typeof r=="number"?this.rightShiftS(r):this.rightShiftM(r)},n.prototype.rightShiftS=function(r){for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)>>>r);return this},n.prototype.rightShiftM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)>>>r.get(o,s));return this},n.rightShift=function(r,o){return new t(r).rightShift(o)},n.prototype.zeroFillRightShift=n.prototype.rightShift,n.prototype.zeroFillRightShiftS=n.prototype.rightShiftS,n.prototype.zeroFillRightShiftM=n.prototype.rightShiftM,n.zeroFillRightShift=n.rightShift,n.prototype.not=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,~this.get(r,o));return this},n.not=function(r){return new t(r).not()},n.prototype.abs=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.abs(this.get(r,o)));return this},n.abs=function(r){return new t(r).abs()},n.prototype.acos=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.acos(this.get(r,o)));return this},n.acos=function(r){return new t(r).acos()},n.prototype.acosh=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.acosh(this.get(r,o)));return this},n.acosh=function(r){return new t(r).acosh()},n.prototype.asin=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.asin(this.get(r,o)));return this},n.asin=function(r){return new t(r).asin()},n.prototype.asinh=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.asinh(this.get(r,o)));return this},n.asinh=function(r){return new t(r).asinh()},n.prototype.atan=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.atan(this.get(r,o)));return this},n.atan=function(r){return new t(r).atan()},n.prototype.atanh=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.atanh(this.get(r,o)));return this},n.atanh=function(r){return new t(r).atanh()},n.prototype.cbrt=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.cbrt(this.get(r,o)));return this},n.cbrt=function(r){return new t(r).cbrt()},n.prototype.ceil=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.ceil(this.get(r,o)));return this},n.ceil=function(r){return new t(r).ceil()},n.prototype.clz32=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.clz32(this.get(r,o)));return this},n.clz32=function(r){return new t(r).clz32()},n.prototype.cos=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.cos(this.get(r,o)));return this},n.cos=function(r){return new t(r).cos()},n.prototype.cosh=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.cosh(this.get(r,o)));return this},n.cosh=function(r){return new t(r).cosh()},n.prototype.exp=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.exp(this.get(r,o)));return this},n.exp=function(r){return new t(r).exp()},n.prototype.expm1=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.expm1(this.get(r,o)));return this},n.expm1=function(r){return new t(r).expm1()},n.prototype.floor=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.floor(this.get(r,o)));return this},n.floor=function(r){return new t(r).floor()},n.prototype.fround=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.fround(this.get(r,o)));return this},n.fround=function(r){return new t(r).fround()},n.prototype.log=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.log(this.get(r,o)));return this},n.log=function(r){return new t(r).log()},n.prototype.log1p=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.log1p(this.get(r,o)));return this},n.log1p=function(r){return new t(r).log1p()},n.prototype.log10=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.log10(this.get(r,o)));return this},n.log10=function(r){return new t(r).log10()},n.prototype.log2=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.log2(this.get(r,o)));return this},n.log2=function(r){return new t(r).log2()},n.prototype.round=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.round(this.get(r,o)));return this},n.round=function(r){return new t(r).round()},n.prototype.sign=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.sign(this.get(r,o)));return this},n.sign=function(r){return new t(r).sign()},n.prototype.sin=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.sin(this.get(r,o)));return this},n.sin=function(r){return new t(r).sin()},n.prototype.sinh=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.sinh(this.get(r,o)));return this},n.sinh=function(r){return new t(r).sinh()},n.prototype.sqrt=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.sqrt(this.get(r,o)));return this},n.sqrt=function(r){return new t(r).sqrt()},n.prototype.tan=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.tan(this.get(r,o)));return this},n.tan=function(r){return new t(r).tan()},n.prototype.tanh=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.tanh(this.get(r,o)));return this},n.tanh=function(r){return new t(r).tanh()},n.prototype.trunc=function(){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.trunc(this.get(r,o)));return this},n.trunc=function(r){return new t(r).trunc()},n.pow=function(r,o){return new t(r).pow(o)},n.prototype.pow=function(r){return typeof r=="number"?this.powS(r):this.powM(r)},n.prototype.powS=function(r){for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,Math.pow(this.get(o,s),r));return this},n.prototype.powM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,Math.pow(this.get(o,s),r.get(o,s)));return this}}function checkRowIndex(n,t,e){let r=e?n.rows:n.rows-1;if(t<0||t>r)throw new RangeError("Row index out of range")}function checkColumnIndex(n,t,e){let r=e?n.columns:n.columns-1;if(t<0||t>r)throw new RangeError("Column index out of range")}function checkRowVector(n,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==n.columns)throw new RangeError("vector size must be the same as the number of columns");return t}function checkColumnVector(n,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==n.rows)throw new RangeError("vector size must be the same as the number of rows");return t}function checkRowIndices(n,t){if(!isAnyArray(t))throw new TypeError("row indices must be an array");for(let e=0;e<t.length;e++)if(t[e]<0||t[e]>=n.rows)throw new RangeError("row indices are out of range")}function checkColumnIndices(n,t){if(!isAnyArray(t))throw new TypeError("column indices must be an array");for(let e=0;e<t.length;e++)if(t[e]<0||t[e]>=n.columns)throw new RangeError("column indices are out of range")}function checkRange(n,t,e,r,o){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(checkNumber("startRow",t),checkNumber("endRow",e),checkNumber("startColumn",r),checkNumber("endColumn",o),t>e||r>o||t<0||t>=n.rows||e<0||e>=n.rows||r<0||r>=n.columns||o<0||o>=n.columns)throw new RangeError("Submatrix indices are out of range")}function newArray$2(n,t=0){let e=[];for(let r=0;r<n;r++)e.push(t);return e}function checkNumber(n,t){if(typeof t!="number")throw new TypeError(`${n} must be a number`)}function checkNonEmpty(n){if(n.isEmpty())throw new Error("Empty matrix has no elements to index")}function sumByRow(n){let t=newArray$2(n.rows);for(let e=0;e<n.rows;++e)for(let r=0;r<n.columns;++r)t[e]+=n.get(e,r);return t}function sumByColumn(n){let t=newArray$2(n.columns);for(let e=0;e<n.rows;++e)for(let r=0;r<n.columns;++r)t[r]+=n.get(e,r);return t}function sumAll(n){let t=0;for(let e=0;e<n.rows;e++)for(let r=0;r<n.columns;r++)t+=n.get(e,r);return t}function productByRow(n){let t=newArray$2(n.rows,1);for(let e=0;e<n.rows;++e)for(let r=0;r<n.columns;++r)t[e]*=n.get(e,r);return t}function productByColumn(n){let t=newArray$2(n.columns,1);for(let e=0;e<n.rows;++e)for(let r=0;r<n.columns;++r)t[r]*=n.get(e,r);return t}function productAll(n){let t=1;for(let e=0;e<n.rows;e++)for(let r=0;r<n.columns;r++)t*=n.get(e,r);return t}function varianceByRow(n,t,e){const r=n.rows,o=n.columns,s=[];for(let l=0;l<r;l++){let a=0,h=0,y=0;for(let C=0;C<o;C++)y=n.get(l,C)-e[l],a+=y,h+=y*y;t?s.push((h-a*a/o)/(o-1)):s.push((h-a*a/o)/o)}return s}function varianceByColumn(n,t,e){const r=n.rows,o=n.columns,s=[];for(let l=0;l<o;l++){let a=0,h=0,y=0;for(let C=0;C<r;C++)y=n.get(C,l)-e[l],a+=y,h+=y*y;t?s.push((h-a*a/r)/(r-1)):s.push((h-a*a/r)/r)}return s}function varianceAll(n,t,e){const r=n.rows,o=n.columns,s=r*o;let l=0,a=0,h=0;for(let y=0;y<r;y++)for(let C=0;C<o;C++)h=n.get(y,C)-e,l+=h,a+=h*h;return t?(a-l*l/s)/(s-1):(a-l*l/s)/s}function centerByRow(n,t){for(let e=0;e<n.rows;e++)for(let r=0;r<n.columns;r++)n.set(e,r,n.get(e,r)-t[e])}function centerByColumn(n,t){for(let e=0;e<n.rows;e++)for(let r=0;r<n.columns;r++)n.set(e,r,n.get(e,r)-t[r])}function centerAll(n,t){for(let e=0;e<n.rows;e++)for(let r=0;r<n.columns;r++)n.set(e,r,n.get(e,r)-t)}function getScaleByRow(n){const t=[];for(let e=0;e<n.rows;e++){let r=0;for(let o=0;o<n.columns;o++)r+=Math.pow(n.get(e,o),2)/(n.columns-1);t.push(Math.sqrt(r))}return t}function scaleByRow(n,t){for(let e=0;e<n.rows;e++)for(let r=0;r<n.columns;r++)n.set(e,r,n.get(e,r)/t[e])}function getScaleByColumn(n){const t=[];for(let e=0;e<n.columns;e++){let r=0;for(let o=0;o<n.rows;o++)r+=Math.pow(n.get(o,e),2)/(n.rows-1);t.push(Math.sqrt(r))}return t}function scaleByColumn(n,t){for(let e=0;e<n.rows;e++)for(let r=0;r<n.columns;r++)n.set(e,r,n.get(e,r)/t[r])}function getScaleAll(n){const t=n.size-1;let e=0;for(let r=0;r<n.columns;r++)for(let o=0;o<n.rows;o++)e+=Math.pow(n.get(o,r),2)/t;return Math.sqrt(e)}function scaleAll(n,t){for(let e=0;e<n.rows;e++)for(let r=0;r<n.columns;r++)n.set(e,r,n.get(e,r)/t)}class AbstractMatrix{static from1DArray(t,e,r){if(t*e!==r.length)throw new RangeError("data length does not match given dimensions");let s=new Matrix$2(t,e);for(let l=0;l<t;l++)for(let a=0;a<e;a++)s.set(l,a,r[l*e+a]);return s}static rowVector(t){let e=new Matrix$2(1,t.length);for(let r=0;r<t.length;r++)e.set(0,r,t[r]);return e}static columnVector(t){let e=new Matrix$2(t.length,1);for(let r=0;r<t.length;r++)e.set(r,0,t[r]);return e}static zeros(t,e){return new Matrix$2(t,e)}static ones(t,e){return new Matrix$2(t,e).fill(1)}static rand(t,e,r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{random:o=Math.random}=r;let s=new Matrix$2(t,e);for(let l=0;l<t;l++)for(let a=0;a<e;a++)s.set(l,a,o());return s}static randInt(t,e,r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{min:o=0,max:s=1e3,random:l=Math.random}=r;if(!Number.isInteger(o))throw new TypeError("min must be an integer");if(!Number.isInteger(s))throw new TypeError("max must be an integer");if(o>=s)throw new RangeError("min must be smaller than max");let a=s-o,h=new Matrix$2(t,e);for(let y=0;y<t;y++)for(let C=0;C<e;C++){let L=o+Math.round(l()*a);h.set(y,C,L)}return h}static eye(t,e,r){e===void 0&&(e=t),r===void 0&&(r=1);let o=Math.min(t,e),s=this.zeros(t,e);for(let l=0;l<o;l++)s.set(l,l,r);return s}static diag(t,e,r){let o=t.length;e===void 0&&(e=o),r===void 0&&(r=e);let s=Math.min(o,e,r),l=this.zeros(e,r);for(let a=0;a<s;a++)l.set(a,a,t[a]);return l}static min(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,o=t.columns,s=new Matrix$2(r,o);for(let l=0;l<r;l++)for(let a=0;a<o;a++)s.set(l,a,Math.min(t.get(l,a),e.get(l,a)));return s}static max(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,o=t.columns,s=new this(r,o);for(let l=0;l<r;l++)for(let a=0;a<o;a++)s.set(l,a,Math.max(t.get(l,a),e.get(l,a)));return s}static checkMatrix(t){return AbstractMatrix.isMatrix(t)?t:new Matrix$2(t)}static isMatrix(t){return t!=null&&t.klass==="Matrix"}get size(){return this.rows*this.columns}apply(t){if(typeof t!="function")throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.call(this,e,r);return this}to1DArray(){let t=[];for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.push(this.get(e,r));return t}to2DArray(){let t=[];for(let e=0;e<this.rows;e++){t.push([]);for(let r=0;r<this.columns;r++)t[e].push(this.get(e,r))}return t}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let e=0;e<=t;e++)if(this.get(t,e)!==this.get(e,t))return!1;return!0}return!1}isEchelonForm(){let t=0,e=0,r=-1,o=!0,s=!1;for(;t<this.rows&&o;){for(e=0,s=!1;e<this.columns&&s===!1;)this.get(t,e)===0?e++:this.get(t,e)===1&&e>r?(s=!0,r=e):(o=!1,s=!0);t++}return o}isReducedEchelonForm(){let t=0,e=0,r=-1,o=!0,s=!1;for(;t<this.rows&&o;){for(e=0,s=!1;e<this.columns&&s===!1;)this.get(t,e)===0?e++:this.get(t,e)===1&&e>r?(s=!0,r=e):(o=!1,s=!0);for(let l=e+1;l<this.rows;l++)this.get(t,l)!==0&&(o=!1);t++}return o}echelonForm(){let t=this.clone(),e=0,r=0;for(;e<t.rows&&r<t.columns;){let o=e;for(let s=e;s<t.rows;s++)t.get(s,r)>t.get(o,r)&&(o=s);if(t.get(o,r)===0)r++;else{t.swapRows(e,o);let s=t.get(e,r);for(let l=r;l<t.columns;l++)t.set(e,l,t.get(e,l)/s);for(let l=e+1;l<t.rows;l++){let a=t.get(l,r)/t.get(e,r);t.set(l,r,0);for(let h=r+1;h<t.columns;h++)t.set(l,h,t.get(l,h)-t.get(e,h)*a)}e++,r++}}return t}reducedEchelonForm(){let t=this.echelonForm(),e=t.columns,r=t.rows,o=r-1;for(;o>=0;)if(t.maxRow(o)===0)o--;else{let s=0,l=!1;for(;s<r&&l===!1;)t.get(o,s)===1?l=!0:s++;for(let a=0;a<o;a++){let h=t.get(a,s);for(let y=s;y<e;y++){let C=t.get(a,y)-h*t.get(o,y);t.set(a,y,C)}}o--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{rows:e=1,columns:r=1}=t;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(r)||r<=0)throw new TypeError("columns must be a positive integer");let o=new Matrix$2(this.rows*e,this.columns*r);for(let s=0;s<e;s++)for(let l=0;l<r;l++)o.setSubMatrix(this,this.rows*s,this.columns*l);return o}fill(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,t);return this}neg(){return this.mulS(-1)}getRow(t){checkRowIndex(this,t);let e=[];for(let r=0;r<this.columns;r++)e.push(this.get(t,r));return e}getRowVector(t){return Matrix$2.rowVector(this.getRow(t))}setRow(t,e){checkRowIndex(this,t),e=checkRowVector(this,e);for(let r=0;r<this.columns;r++)this.set(t,r,e[r]);return this}swapRows(t,e){checkRowIndex(this,t),checkRowIndex(this,e);for(let r=0;r<this.columns;r++){let o=this.get(t,r);this.set(t,r,this.get(e,r)),this.set(e,r,o)}return this}getColumn(t){checkColumnIndex(this,t);let e=[];for(let r=0;r<this.rows;r++)e.push(this.get(r,t));return e}getColumnVector(t){return Matrix$2.columnVector(this.getColumn(t))}setColumn(t,e){checkColumnIndex(this,t),e=checkColumnVector(this,e);for(let r=0;r<this.rows;r++)this.set(r,t,e[r]);return this}swapColumns(t,e){checkColumnIndex(this,t),checkColumnIndex(this,e);for(let r=0;r<this.rows;r++){let o=this.get(r,t);this.set(r,t,this.get(r,e)),this.set(r,e,o)}return this}addRowVector(t){t=checkRowVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[r]);return this}subRowVector(t){t=checkRowVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[r]);return this}mulRowVector(t){t=checkRowVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[r]);return this}divRowVector(t){t=checkRowVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[r]);return this}addColumnVector(t){t=checkColumnVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[e]);return this}subColumnVector(t){t=checkColumnVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[e]);return this}mulColumnVector(t){t=checkColumnVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[e]);return this}divColumnVector(t){t=checkColumnVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[e]);return this}mulRow(t,e){checkRowIndex(this,t);for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)*e);return this}mulColumn(t,e){checkColumnIndex(this,t);for(let r=0;r<this.rows;r++)this.set(r,t,this.get(r,t)*e);return this}max(t){if(this.isEmpty())return NaN;switch(t){case"row":{const e=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.get(r,o)>e[r]&&(e[r]=this.get(r,o));return e}case"column":{const e=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.get(r,o)>e[o]&&(e[o]=this.get(r,o));return e}case void 0:{let e=this.get(0,0);for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.get(r,o)>e&&(e=this.get(r,o));return e}default:throw new Error(`invalid option: ${t}`)}}maxIndex(){checkNonEmpty(this);let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.get(r,o)>t&&(t=this.get(r,o),e[0]=r,e[1]=o);return e}min(t){if(this.isEmpty())return NaN;switch(t){case"row":{const e=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.get(r,o)<e[r]&&(e[r]=this.get(r,o));return e}case"column":{const e=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.get(r,o)<e[o]&&(e[o]=this.get(r,o));return e}case void 0:{let e=this.get(0,0);for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.get(r,o)<e&&(e=this.get(r,o));return e}default:throw new Error(`invalid option: ${t}`)}}minIndex(){checkNonEmpty(this);let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.get(r,o)<t&&(t=this.get(r,o),e[0]=r,e[1]=o);return e}maxRow(t){if(checkRowIndex(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)>e&&(e=this.get(t,r));return e}maxRowIndex(t){checkRowIndex(this,t),checkNonEmpty(this);let e=this.get(t,0),r=[t,0];for(let o=1;o<this.columns;o++)this.get(t,o)>e&&(e=this.get(t,o),r[1]=o);return r}minRow(t){if(checkRowIndex(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)<e&&(e=this.get(t,r));return e}minRowIndex(t){checkRowIndex(this,t),checkNonEmpty(this);let e=this.get(t,0),r=[t,0];for(let o=1;o<this.columns;o++)this.get(t,o)<e&&(e=this.get(t,o),r[1]=o);return r}maxColumn(t){if(checkColumnIndex(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)>e&&(e=this.get(r,t));return e}maxColumnIndex(t){checkColumnIndex(this,t),checkNonEmpty(this);let e=this.get(0,t),r=[0,t];for(let o=1;o<this.rows;o++)this.get(o,t)>e&&(e=this.get(o,t),r[0]=o);return r}minColumn(t){if(checkColumnIndex(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)<e&&(e=this.get(r,t));return e}minColumnIndex(t){checkColumnIndex(this,t),checkNonEmpty(this);let e=this.get(0,t),r=[0,t];for(let o=1;o<this.rows;o++)this.get(o,t)<e&&(e=this.get(o,t),r[0]=o);return r}diag(){let t=Math.min(this.rows,this.columns),e=[];for(let r=0;r<t;r++)e.push(this.get(r,r));return e}norm(t="frobenius"){let e=0;if(t==="max")return this.max();if(t==="frobenius"){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)e=e+this.get(r,o)*this.get(r,o);return Math.sqrt(e)}else throw new RangeError(`unknown norm type: ${t}`)}cumulativeSum(){let t=0;for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t+=this.get(e,r),this.set(e,r,t);return this}dot(t){AbstractMatrix.isMatrix(t)&&(t=t.to1DArray());let e=this.to1DArray();if(e.length!==t.length)throw new RangeError("vectors do not have the same size");let r=0;for(let o=0;o<e.length;o++)r+=e[o]*t[o];return r}mmul(t){t=Matrix$2.checkMatrix(t);let e=this.rows,r=this.columns,o=t.columns,s=new Matrix$2(e,o),l=new Float64Array(r);for(let a=0;a<o;a++){for(let h=0;h<r;h++)l[h]=t.get(h,a);for(let h=0;h<e;h++){let y=0;for(let C=0;C<r;C++)y+=this.get(h,C)*l[C];s.set(h,a,y)}}return s}strassen2x2(t){t=Matrix$2.checkMatrix(t);let e=new Matrix$2(2,2);const r=this.get(0,0),o=t.get(0,0),s=this.get(0,1),l=t.get(0,1),a=this.get(1,0),h=t.get(1,0),y=this.get(1,1),C=t.get(1,1),L=(r+y)*(o+C),Y=(a+y)*o,ze=r*(l-C),Bt=y*(h-o),Ir=(r+s)*C,Wr=(a-r)*(o+l),yi=(s-y)*(h+C),Bn=L+Bt-Ir+yi,vi=ze+Ir,wo=Y+Bt,ia=L-Y+ze+Wr;return e.set(0,0,Bn),e.set(0,1,vi),e.set(1,0,wo),e.set(1,1,ia),e}strassen3x3(t){t=Matrix$2.checkMatrix(t);let e=new Matrix$2(3,3);const r=this.get(0,0),o=this.get(0,1),s=this.get(0,2),l=this.get(1,0),a=this.get(1,1),h=this.get(1,2),y=this.get(2,0),C=this.get(2,1),L=this.get(2,2),Y=t.get(0,0),ze=t.get(0,1),Bt=t.get(0,2),Ir=t.get(1,0),Wr=t.get(1,1),yi=t.get(1,2),Bn=t.get(2,0),vi=t.get(2,1),wo=t.get(2,2),ia=(r+o+s-l-a-C-L)*Wr,gl=(r-l)*(-ze+Wr),ml=a*(-Y+ze+Ir-Wr-yi-Bn+wo),il=(-r+l+a)*(Y-ze+Wr),sl=(l+a)*(-Y+ze),ol=r*Y,_l=(-r+y+C)*(Y-Bt+yi),rh=(-r+y)*(Bt-yi),wh=(y+C)*(-Y+Bt),Fh=(r+o+s-a-h-y-C)*yi,Mh=C*(-Y+Bt+Ir-Wr-yi-Bn+vi),vp=(-s+C+L)*(Wr+Bn-vi),gp=(s-L)*(Wr-vi),Jh=s*Bn,Lp=(C+L)*(-Bn+vi),Ip=(-s+a+h)*(yi+Bn-wo),$p=(s-h)*(yi-wo),Xp=(a+h)*(-Bn+wo),Cp=o*Ir,Gp=h*vi,Rp=l*Bt,od=y*ze,Wp=L*wo,Ld=ol+Jh+Cp,ed=ia+il+sl+ol+vp+Jh+Lp,Gd=ol+_l+wh+Fh+Jh+Ip+Xp,Kp=gl+ml+il+ol+Jh+Ip+$p,Ad=gl+il+sl+ol+Gp,Id=Jh+Ip+$p+Xp+Rp,Yh=ol+_l+rh+Mh+vp+gp+Jh,Ap=vp+gp+Jh+Lp+od,kd=ol+_l+rh+wh+Wp;return e.set(0,0,Ld),e.set(0,1,ed),e.set(0,2,Gd),e.set(1,0,Kp),e.set(1,1,Ad),e.set(1,2,Id),e.set(2,0,Yh),e.set(2,1,Ap),e.set(2,2,kd),e}mmulStrassen(t){t=Matrix$2.checkMatrix(t);let e=this.clone(),r=e.rows,o=e.columns,s=t.rows,l=t.columns;o!==s&&console.warn(`Multiplying ${r} x ${o} and ${s} x ${l} matrix: dimensions do not match.`);function a(L,Y,ze){let Bt=L.rows,Ir=L.columns;if(Bt===Y&&Ir===ze)return L;{let Wr=AbstractMatrix.zeros(Y,ze);return Wr=Wr.setSubMatrix(L,0,0),Wr}}let h=Math.max(r,s),y=Math.max(o,l);e=a(e,h,y),t=a(t,h,y);function C(L,Y,ze,Bt){if(ze<=512||Bt<=512)return L.mmul(Y);ze%2===1&&Bt%2===1?(L=a(L,ze+1,Bt+1),Y=a(Y,ze+1,Bt+1)):ze%2===1?(L=a(L,ze+1,Bt),Y=a(Y,ze+1,Bt)):Bt%2===1&&(L=a(L,ze,Bt+1),Y=a(Y,ze,Bt+1));let Ir=parseInt(L.rows/2,10),Wr=parseInt(L.columns/2,10),yi=L.subMatrix(0,Ir-1,0,Wr-1),Bn=Y.subMatrix(0,Ir-1,0,Wr-1),vi=L.subMatrix(0,Ir-1,Wr,L.columns-1),wo=Y.subMatrix(0,Ir-1,Wr,Y.columns-1),ia=L.subMatrix(Ir,L.rows-1,0,Wr-1),gl=Y.subMatrix(Ir,Y.rows-1,0,Wr-1),ml=L.subMatrix(Ir,L.rows-1,Wr,L.columns-1),il=Y.subMatrix(Ir,Y.rows-1,Wr,Y.columns-1),sl=C(AbstractMatrix.add(yi,ml),AbstractMatrix.add(Bn,il),Ir,Wr),ol=C(AbstractMatrix.add(ia,ml),Bn,Ir,Wr),_l=C(yi,AbstractMatrix.sub(wo,il),Ir,Wr),rh=C(ml,AbstractMatrix.sub(gl,Bn),Ir,Wr),wh=C(AbstractMatrix.add(yi,vi),il,Ir,Wr),Fh=C(AbstractMatrix.sub(ia,yi),AbstractMatrix.add(Bn,wo),Ir,Wr),Mh=C(AbstractMatrix.sub(vi,ml),AbstractMatrix.add(gl,il),Ir,Wr),vp=AbstractMatrix.add(sl,rh);vp.sub(wh),vp.add(Mh);let gp=AbstractMatrix.add(_l,wh),Jh=AbstractMatrix.add(ol,rh),Lp=AbstractMatrix.sub(sl,ol);Lp.add(_l),Lp.add(Fh);let Ip=AbstractMatrix.zeros(2*vp.rows,2*vp.columns);return Ip=Ip.setSubMatrix(vp,0,0),Ip=Ip.setSubMatrix(gp,vp.rows,0),Ip=Ip.setSubMatrix(Jh,0,vp.columns),Ip=Ip.setSubMatrix(Lp,vp.rows,vp.columns),Ip.subMatrix(0,ze-1,0,Bt-1)}return C(e,t,h,y)}scaleRows(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let o=new Matrix$2(this.rows,this.columns);for(let s=0;s<this.rows;s++){const l=this.getRow(s);l.length>0&&rescale(l,{min:e,max:r,output:l}),o.setRow(s,l)}return o}scaleColumns(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let o=new Matrix$2(this.rows,this.columns);for(let s=0;s<this.columns;s++){const l=this.getColumn(s);l.length&&rescale(l,{min:e,max:r,output:l}),o.setColumn(s,l)}return o}flipRows(){const t=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let r=0;r<t;r++){let o=this.get(e,r),s=this.get(e,this.columns-1-r);this.set(e,r,s),this.set(e,this.columns-1-r,o)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let r=0;r<t;r++){let o=this.get(r,e),s=this.get(this.rows-1-r,e);this.set(r,e,s),this.set(this.rows-1-r,e,o)}return this}kroneckerProduct(t){t=Matrix$2.checkMatrix(t);let e=this.rows,r=this.columns,o=t.rows,s=t.columns,l=new Matrix$2(e*o,r*s);for(let a=0;a<e;a++)for(let h=0;h<r;h++)for(let y=0;y<o;y++)for(let C=0;C<s;C++)l.set(o*a+y,s*h+C,this.get(a,h)*t.get(y,C));return l}kroneckerSum(t){if(t=Matrix$2.checkMatrix(t),!this.isSquare()||!t.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let e=this.rows,r=t.rows,o=this.kroneckerProduct(Matrix$2.eye(r,r)),s=Matrix$2.eye(e,e).kroneckerProduct(t);return o.add(s)}transpose(){let t=new Matrix$2(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.set(r,e,this.get(e,r));return t}sortRows(t=compareNumbers){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(t));return this}sortColumns(t=compareNumbers){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(t));return this}subMatrix(t,e,r,o){checkRange(this,t,e,r,o);let s=new Matrix$2(e-t+1,o-r+1);for(let l=t;l<=e;l++)for(let a=r;a<=o;a++)s.set(l-t,a-r,this.get(l,a));return s}subMatrixRow(t,e,r){if(e===void 0&&(e=0),r===void 0&&(r=this.columns-1),e>r||e<0||e>=this.columns||r<0||r>=this.columns)throw new RangeError("Argument out of range");let o=new Matrix$2(t.length,r-e+1);for(let s=0;s<t.length;s++)for(let l=e;l<=r;l++){if(t[s]<0||t[s]>=this.rows)throw new RangeError(`Row index out of range: ${t[s]}`);o.set(s,l-e,this.get(t[s],l))}return o}subMatrixColumn(t,e,r){if(e===void 0&&(e=0),r===void 0&&(r=this.rows-1),e>r||e<0||e>=this.rows||r<0||r>=this.rows)throw new RangeError("Argument out of range");let o=new Matrix$2(r-e+1,t.length);for(let s=0;s<t.length;s++)for(let l=e;l<=r;l++){if(t[s]<0||t[s]>=this.columns)throw new RangeError(`Column index out of range: ${t[s]}`);o.set(l-e,s,this.get(l,t[s]))}return o}setSubMatrix(t,e,r){if(t=Matrix$2.checkMatrix(t),t.isEmpty())return this;let o=e+t.rows-1,s=r+t.columns-1;checkRange(this,e,o,r,s);for(let l=0;l<t.rows;l++)for(let a=0;a<t.columns;a++)this.set(e+l,r+a,t.get(l,a));return this}selection(t,e){checkRowIndices(this,t),checkColumnIndices(this,e);let r=new Matrix$2(t.length,e.length);for(let o=0;o<t.length;o++){let s=t[o];for(let l=0;l<e.length;l++){let a=e[l];r.set(o,l,this.get(s,a))}}return r}trace(){let t=Math.min(this.rows,this.columns),e=0;for(let r=0;r<t;r++)e+=this.get(r,r);return e}clone(){let t=new Matrix$2(this.rows,this.columns);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.set(e,r,this.get(e,r));return t}sum(t){switch(t){case"row":return sumByRow(this);case"column":return sumByColumn(this);case void 0:return sumAll(this);default:throw new Error(`invalid option: ${t}`)}}product(t){switch(t){case"row":return productByRow(this);case"column":return productByColumn(this);case void 0:return productAll(this);default:throw new Error(`invalid option: ${t}`)}}mean(t){const e=this.sum(t);switch(t){case"row":{for(let r=0;r<this.rows;r++)e[r]/=this.columns;return e}case"column":{for(let r=0;r<this.columns;r++)e[r]/=this.rows;return e}case void 0:return e/this.size;default:throw new Error(`invalid option: ${t}`)}}variance(t,e={}){if(typeof t=="object"&&(e=t,t=void 0),typeof e!="object")throw new TypeError("options must be an object");const{unbiased:r=!0,mean:o=this.mean(t)}=e;if(typeof r!="boolean")throw new TypeError("unbiased must be a boolean");switch(t){case"row":{if(!isAnyArray(o))throw new TypeError("mean must be an array");return varianceByRow(this,r,o)}case"column":{if(!isAnyArray(o))throw new TypeError("mean must be an array");return varianceByColumn(this,r,o)}case void 0:{if(typeof o!="number")throw new TypeError("mean must be a number");return varianceAll(this,r,o)}default:throw new Error(`invalid option: ${t}`)}}standardDeviation(t,e){typeof t=="object"&&(e=t,t=void 0);const r=this.variance(t,e);if(t===void 0)return Math.sqrt(r);for(let o=0;o<r.length;o++)r[o]=Math.sqrt(r[o]);return r}center(t,e={}){if(typeof t=="object"&&(e=t,t=void 0),typeof e!="object")throw new TypeError("options must be an object");const{center:r=this.mean(t)}=e;switch(t){case"row":{if(!isAnyArray(r))throw new TypeError("center must be an array");return centerByRow(this,r),this}case"column":{if(!isAnyArray(r))throw new TypeError("center must be an array");return centerByColumn(this,r),this}case void 0:{if(typeof r!="number")throw new TypeError("center must be a number");return centerAll(this,r),this}default:throw new Error(`invalid option: ${t}`)}}scale(t,e={}){if(typeof t=="object"&&(e=t,t=void 0),typeof e!="object")throw new TypeError("options must be an object");let r=e.scale;switch(t){case"row":{if(r===void 0)r=getScaleByRow(this);else if(!isAnyArray(r))throw new TypeError("scale must be an array");return scaleByRow(this,r),this}case"column":{if(r===void 0)r=getScaleByColumn(this);else if(!isAnyArray(r))throw new TypeError("scale must be an array");return scaleByColumn(this,r),this}case void 0:{if(r===void 0)r=getScaleAll(this);else if(typeof r!="number")throw new TypeError("scale must be a number");return scaleAll(this,r),this}default:throw new Error(`invalid option: ${t}`)}}toString(t){return inspectMatrixWithOptions(this,t)}}AbstractMatrix.prototype.klass="Matrix";typeof Symbol<"u"&&(AbstractMatrix.prototype[Symbol.for("nodejs.util.inspect.custom")]=inspectMatrix);function compareNumbers(n,t){return n-t}function isArrayOfNumbers(n){return n.every(t=>typeof t=="number")}AbstractMatrix.random=AbstractMatrix.rand;AbstractMatrix.randomInt=AbstractMatrix.randInt;AbstractMatrix.diagonal=AbstractMatrix.diag;AbstractMatrix.prototype.diagonal=AbstractMatrix.prototype.diag;AbstractMatrix.identity=AbstractMatrix.eye;AbstractMatrix.prototype.negate=AbstractMatrix.prototype.neg;AbstractMatrix.prototype.tensorProduct=AbstractMatrix.prototype.kroneckerProduct;let Matrix$2=class QS extends AbstractMatrix{constructor(t,e){if(super(),QS.isMatrix(t))return t.clone();if(Number.isInteger(t)&&t>=0)if(this.data=[],Number.isInteger(e)&&e>=0)for(let r=0;r<t;r++)this.data.push(new Float64Array(e));else throw new TypeError("nColumns must be a positive integer");else if(isAnyArray(t)){const r=t;if(t=r.length,e=t?r[0].length:0,typeof e!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let o=0;o<t;o++){if(r[o].length!==e)throw new RangeError("Inconsistent array dimensions");if(!isArrayOfNumbers(r[o]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(r[o]))}}else throw new TypeError("First argument must be a positive number or an array");this.rows=t,this.columns=e}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}removeRow(t){return checkRowIndex(this,t),this.data.splice(t,1),this.rows-=1,this}addRow(t,e){return e===void 0&&(e=t,t=this.rows),checkRowIndex(this,t,!0),e=Float64Array.from(checkRowVector(this,e)),this.data.splice(t,0,e),this.rows+=1,this}removeColumn(t){checkColumnIndex(this,t);for(let e=0;e<this.rows;e++){const r=new Float64Array(this.columns-1);for(let o=0;o<t;o++)r[o]=this.data[e][o];for(let o=t+1;o<this.columns;o++)r[o-1]=this.data[e][o];this.data[e]=r}return this.columns-=1,this}addColumn(t,e){typeof e>"u"&&(e=t,t=this.columns),checkColumnIndex(this,t,!0),e=checkColumnVector(this,e);for(let r=0;r<this.rows;r++){const o=new Float64Array(this.columns+1);let s=0;for(;s<t;s++)o[s]=this.data[r][s];for(o[s++]=e[r];s<this.columns+1;s++)o[s]=this.data[r][s-1];this.data[r]=o}return this.columns+=1,this}};installMathOperations(AbstractMatrix,Matrix$2);class BaseView extends AbstractMatrix{constructor(t,e,r){super(),this.matrix=t,this.rows=e,this.columns=r}}class MatrixColumnView extends BaseView{constructor(t,e){checkColumnIndex(t,e),super(t,t.rows,1),this.column=e}set(t,e,r){return this.matrix.set(t,this.column,r),this}get(t){return this.matrix.get(t,this.column)}}class MatrixColumnSelectionView extends BaseView{constructor(t,e){checkColumnIndices(t,e),super(t,t.rows,e.length),this.columnIndices=e}set(t,e,r){return this.matrix.set(t,this.columnIndices[e],r),this}get(t,e){return this.matrix.get(t,this.columnIndices[e])}}class MatrixFlipColumnView extends BaseView{constructor(t){super(t,t.rows,t.columns)}set(t,e,r){return this.matrix.set(t,this.columns-e-1,r),this}get(t,e){return this.matrix.get(t,this.columns-e-1)}}class MatrixFlipRowView extends BaseView{constructor(t){super(t,t.rows,t.columns)}set(t,e,r){return this.matrix.set(this.rows-t-1,e,r),this}get(t,e){return this.matrix.get(this.rows-t-1,e)}}class MatrixRowView extends BaseView{constructor(t,e){checkRowIndex(t,e),super(t,1,t.columns),this.row=e}set(t,e,r){return this.matrix.set(this.row,e,r),this}get(t,e){return this.matrix.get(this.row,e)}}class MatrixRowSelectionView extends BaseView{constructor(t,e){checkRowIndices(t,e),super(t,e.length,t.columns),this.rowIndices=e}set(t,e,r){return this.matrix.set(this.rowIndices[t],e,r),this}get(t,e){return this.matrix.get(this.rowIndices[t],e)}}class MatrixSelectionView extends BaseView{constructor(t,e,r){checkRowIndices(t,e),checkColumnIndices(t,r),super(t,e.length,r.length),this.rowIndices=e,this.columnIndices=r}set(t,e,r){return this.matrix.set(this.rowIndices[t],this.columnIndices[e],r),this}get(t,e){return this.matrix.get(this.rowIndices[t],this.columnIndices[e])}}class MatrixSubView extends BaseView{constructor(t,e,r,o,s){checkRange(t,e,r,o,s),super(t,r-e+1,s-o+1),this.startRow=e,this.startColumn=o}set(t,e,r){return this.matrix.set(this.startRow+t,this.startColumn+e,r),this}get(t,e){return this.matrix.get(this.startRow+t,this.startColumn+e)}}let MatrixTransposeView$1=class extends BaseView{constructor(t){super(t,t.columns,t.rows)}set(t,e,r){return this.matrix.set(e,t,r),this}get(t,e){return this.matrix.get(e,t)}};class WrapperMatrix1D extends AbstractMatrix{constructor(t,e={}){const{rows:r=1}=e;if(t.length%r!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=r,this.columns=t.length/r,this.data=t}set(t,e,r){let o=this._calculateIndex(t,e);return this.data[o]=r,this}get(t,e){let r=this._calculateIndex(t,e);return this.data[r]}_calculateIndex(t,e){return t*this.columns+e}}class WrapperMatrix2D extends AbstractMatrix{constructor(t){super(),this.data=t,this.rows=t.length,this.columns=t[0].length}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}}function wrap(n,t){if(isAnyArray(n))return n[0]&&isAnyArray(n[0])?new WrapperMatrix2D(n):new WrapperMatrix1D(n,t);throw new Error("the argument is not an array")}class LuDecomposition{constructor(t){t=WrapperMatrix2D.checkMatrix(t);let e=t.clone(),r=e.rows,o=e.columns,s=new Float64Array(r),l=1,a,h,y,C,L,Y,ze,Bt,Ir;for(a=0;a<r;a++)s[a]=a;for(Bt=new Float64Array(r),h=0;h<o;h++){for(a=0;a<r;a++)Bt[a]=e.get(a,h);for(a=0;a<r;a++){for(Ir=Math.min(a,h),L=0,y=0;y<Ir;y++)L+=e.get(a,y)*Bt[y];Bt[a]-=L,e.set(a,h,Bt[a])}for(C=h,a=h+1;a<r;a++)Math.abs(Bt[a])>Math.abs(Bt[C])&&(C=a);if(C!==h){for(y=0;y<o;y++)Y=e.get(C,y),e.set(C,y,e.get(h,y)),e.set(h,y,Y);ze=s[C],s[C]=s[h],s[h]=ze,l=-l}if(h<r&&e.get(h,h)!==0)for(a=h+1;a<r;a++)e.set(a,h,e.get(a,h)/e.get(h,h))}this.LU=e,this.pivotVector=s,this.pivotSign=l}isSingular(){let t=this.LU,e=t.columns;for(let r=0;r<e;r++)if(t.get(r,r)===0)return!0;return!1}solve(t){t=Matrix$2.checkMatrix(t);let e=this.LU;if(e.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let o=t.columns,s=t.subMatrixRow(this.pivotVector,0,o-1),l=e.columns,a,h,y;for(y=0;y<l;y++)for(a=y+1;a<l;a++)for(h=0;h<o;h++)s.set(a,h,s.get(a,h)-s.get(y,h)*e.get(a,y));for(y=l-1;y>=0;y--){for(h=0;h<o;h++)s.set(y,h,s.get(y,h)/e.get(y,y));for(a=0;a<y;a++)for(h=0;h<o;h++)s.set(a,h,s.get(a,h)-s.get(y,h)*e.get(a,y))}return s}get determinant(){let t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,r=t.columns;for(let o=0;o<r;o++)e*=t.get(o,o);return e}get lowerTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,o=new Matrix$2(e,r);for(let s=0;s<e;s++)for(let l=0;l<r;l++)s>l?o.set(s,l,t.get(s,l)):s===l?o.set(s,l,1):o.set(s,l,0);return o}get upperTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,o=new Matrix$2(e,r);for(let s=0;s<e;s++)for(let l=0;l<r;l++)s<=l?o.set(s,l,t.get(s,l)):o.set(s,l,0);return o}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function hypotenuse$1(n,t){let e=0;return Math.abs(n)>Math.abs(t)?(e=t/n,Math.abs(n)*Math.sqrt(1+e*e)):t!==0?(e=n/t,Math.abs(t)*Math.sqrt(1+e*e)):0}class QrDecomposition{constructor(t){t=WrapperMatrix2D.checkMatrix(t);let e=t.clone(),r=t.rows,o=t.columns,s=new Float64Array(o),l,a,h,y;for(h=0;h<o;h++){let C=0;for(l=h;l<r;l++)C=hypotenuse$1(C,e.get(l,h));if(C!==0){for(e.get(h,h)<0&&(C=-C),l=h;l<r;l++)e.set(l,h,e.get(l,h)/C);for(e.set(h,h,e.get(h,h)+1),a=h+1;a<o;a++){for(y=0,l=h;l<r;l++)y+=e.get(l,h)*e.get(l,a);for(y=-y/e.get(h,h),l=h;l<r;l++)e.set(l,a,e.get(l,a)+y*e.get(l,h))}}s[h]=-C}this.QR=e,this.Rdiag=s}solve(t){t=Matrix$2.checkMatrix(t);let e=this.QR,r=e.rows;if(t.rows!==r)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let o=t.columns,s=t.clone(),l=e.columns,a,h,y,C;for(y=0;y<l;y++)for(h=0;h<o;h++){for(C=0,a=y;a<r;a++)C+=e.get(a,y)*s.get(a,h);for(C=-C/e.get(y,y),a=y;a<r;a++)s.set(a,h,s.get(a,h)+C*e.get(a,y))}for(y=l-1;y>=0;y--){for(h=0;h<o;h++)s.set(y,h,s.get(y,h)/this.Rdiag[y]);for(a=0;a<y;a++)for(h=0;h<o;h++)s.set(a,h,s.get(a,h)-s.get(y,h)*e.get(a,y))}return s.subMatrix(0,l-1,0,o-1)}isFullRank(){let t=this.QR.columns;for(let e=0;e<t;e++)if(this.Rdiag[e]===0)return!1;return!0}get upperTriangularMatrix(){let t=this.QR,e=t.columns,r=new Matrix$2(e,e),o,s;for(o=0;o<e;o++)for(s=0;s<e;s++)o<s?r.set(o,s,t.get(o,s)):o===s?r.set(o,s,this.Rdiag[o]):r.set(o,s,0);return r}get orthogonalMatrix(){let t=this.QR,e=t.rows,r=t.columns,o=new Matrix$2(e,r),s,l,a,h;for(a=r-1;a>=0;a--){for(s=0;s<e;s++)o.set(s,a,0);for(o.set(a,a,1),l=a;l<r;l++)if(t.get(a,a)!==0){for(h=0,s=a;s<e;s++)h+=t.get(s,a)*o.get(s,l);for(h=-h/t.get(a,a),s=a;s<e;s++)o.set(s,l,o.get(s,l)+h*t.get(s,a))}}return o}}class SingularValueDecomposition{constructor(t,e={}){if(t=WrapperMatrix2D.checkMatrix(t),t.isEmpty())throw new Error("Matrix must be non-empty");let r=t.rows,o=t.columns;const{computeLeftSingularVectors:s=!0,computeRightSingularVectors:l=!0,autoTranspose:a=!1}=e;let h=!!s,y=!!l,C=!1,L;if(r<o)if(!a)L=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{L=t.transpose(),r=L.rows,o=L.columns,C=!0;let ol=h;h=y,y=ol}else L=t.clone();let Y=Math.min(r,o),ze=Math.min(r+1,o),Bt=new Float64Array(ze),Ir=new Matrix$2(r,Y),Wr=new Matrix$2(o,o),yi=new Float64Array(o),Bn=new Float64Array(r),vi=new Float64Array(ze);for(let ol=0;ol<ze;ol++)vi[ol]=ol;let wo=Math.min(r-1,o),ia=Math.max(0,Math.min(o-2,r)),gl=Math.max(wo,ia);for(let ol=0;ol<gl;ol++){if(ol<wo){Bt[ol]=0;for(let _l=ol;_l<r;_l++)Bt[ol]=hypotenuse$1(Bt[ol],L.get(_l,ol));if(Bt[ol]!==0){L.get(ol,ol)<0&&(Bt[ol]=-Bt[ol]);for(let _l=ol;_l<r;_l++)L.set(_l,ol,L.get(_l,ol)/Bt[ol]);L.set(ol,ol,L.get(ol,ol)+1)}Bt[ol]=-Bt[ol]}for(let _l=ol+1;_l<o;_l++){if(ol<wo&&Bt[ol]!==0){let rh=0;for(let wh=ol;wh<r;wh++)rh+=L.get(wh,ol)*L.get(wh,_l);rh=-rh/L.get(ol,ol);for(let wh=ol;wh<r;wh++)L.set(wh,_l,L.get(wh,_l)+rh*L.get(wh,ol))}yi[_l]=L.get(ol,_l)}if(h&&ol<wo)for(let _l=ol;_l<r;_l++)Ir.set(_l,ol,L.get(_l,ol));if(ol<ia){yi[ol]=0;for(let _l=ol+1;_l<o;_l++)yi[ol]=hypotenuse$1(yi[ol],yi[_l]);if(yi[ol]!==0){yi[ol+1]<0&&(yi[ol]=0-yi[ol]);for(let _l=ol+1;_l<o;_l++)yi[_l]/=yi[ol];yi[ol+1]+=1}if(yi[ol]=-yi[ol],ol+1<r&&yi[ol]!==0){for(let _l=ol+1;_l<r;_l++)Bn[_l]=0;for(let _l=ol+1;_l<r;_l++)for(let rh=ol+1;rh<o;rh++)Bn[_l]+=yi[rh]*L.get(_l,rh);for(let _l=ol+1;_l<o;_l++){let rh=-yi[_l]/yi[ol+1];for(let wh=ol+1;wh<r;wh++)L.set(wh,_l,L.get(wh,_l)+rh*Bn[wh])}}if(y)for(let _l=ol+1;_l<o;_l++)Wr.set(_l,ol,yi[_l])}}let ml=Math.min(o,r+1);if(wo<o&&(Bt[wo]=L.get(wo,wo)),r<ml&&(Bt[ml-1]=0),ia+1<ml&&(yi[ia]=L.get(ia,ml-1)),yi[ml-1]=0,h){for(let ol=wo;ol<Y;ol++){for(let _l=0;_l<r;_l++)Ir.set(_l,ol,0);Ir.set(ol,ol,1)}for(let ol=wo-1;ol>=0;ol--)if(Bt[ol]!==0){for(let _l=ol+1;_l<Y;_l++){let rh=0;for(let wh=ol;wh<r;wh++)rh+=Ir.get(wh,ol)*Ir.get(wh,_l);rh=-rh/Ir.get(ol,ol);for(let wh=ol;wh<r;wh++)Ir.set(wh,_l,Ir.get(wh,_l)+rh*Ir.get(wh,ol))}for(let _l=ol;_l<r;_l++)Ir.set(_l,ol,-Ir.get(_l,ol));Ir.set(ol,ol,1+Ir.get(ol,ol));for(let _l=0;_l<ol-1;_l++)Ir.set(_l,ol,0)}else{for(let _l=0;_l<r;_l++)Ir.set(_l,ol,0);Ir.set(ol,ol,1)}}if(y)for(let ol=o-1;ol>=0;ol--){if(ol<ia&&yi[ol]!==0)for(let _l=ol+1;_l<o;_l++){let rh=0;for(let wh=ol+1;wh<o;wh++)rh+=Wr.get(wh,ol)*Wr.get(wh,_l);rh=-rh/Wr.get(ol+1,ol);for(let wh=ol+1;wh<o;wh++)Wr.set(wh,_l,Wr.get(wh,_l)+rh*Wr.get(wh,ol))}for(let _l=0;_l<o;_l++)Wr.set(_l,ol,0);Wr.set(ol,ol,1)}let il=ml-1,sl=Number.EPSILON;for(;ml>0;){let ol,_l;for(ol=ml-2;ol>=-1&&ol!==-1;ol--){const rh=Number.MIN_VALUE+sl*Math.abs(Bt[ol]+Math.abs(Bt[ol+1]));if(Math.abs(yi[ol])<=rh||Number.isNaN(yi[ol])){yi[ol]=0;break}}if(ol===ml-2)_l=4;else{let rh;for(rh=ml-1;rh>=ol&&rh!==ol;rh--){let wh=(rh!==ml?Math.abs(yi[rh]):0)+(rh!==ol+1?Math.abs(yi[rh-1]):0);if(Math.abs(Bt[rh])<=sl*wh){Bt[rh]=0;break}}rh===ol?_l=3:rh===ml-1?_l=1:(_l=2,ol=rh)}switch(ol++,_l){case 1:{let rh=yi[ml-2];yi[ml-2]=0;for(let wh=ml-2;wh>=ol;wh--){let Fh=hypotenuse$1(Bt[wh],rh),Mh=Bt[wh]/Fh,vp=rh/Fh;if(Bt[wh]=Fh,wh!==ol&&(rh=-vp*yi[wh-1],yi[wh-1]=Mh*yi[wh-1]),y)for(let gp=0;gp<o;gp++)Fh=Mh*Wr.get(gp,wh)+vp*Wr.get(gp,ml-1),Wr.set(gp,ml-1,-vp*Wr.get(gp,wh)+Mh*Wr.get(gp,ml-1)),Wr.set(gp,wh,Fh)}break}case 2:{let rh=yi[ol-1];yi[ol-1]=0;for(let wh=ol;wh<ml;wh++){let Fh=hypotenuse$1(Bt[wh],rh),Mh=Bt[wh]/Fh,vp=rh/Fh;if(Bt[wh]=Fh,rh=-vp*yi[wh],yi[wh]=Mh*yi[wh],h)for(let gp=0;gp<r;gp++)Fh=Mh*Ir.get(gp,wh)+vp*Ir.get(gp,ol-1),Ir.set(gp,ol-1,-vp*Ir.get(gp,wh)+Mh*Ir.get(gp,ol-1)),Ir.set(gp,wh,Fh)}break}case 3:{const rh=Math.max(Math.abs(Bt[ml-1]),Math.abs(Bt[ml-2]),Math.abs(yi[ml-2]),Math.abs(Bt[ol]),Math.abs(yi[ol])),wh=Bt[ml-1]/rh,Fh=Bt[ml-2]/rh,Mh=yi[ml-2]/rh,vp=Bt[ol]/rh,gp=yi[ol]/rh,Jh=((Fh+wh)*(Fh-wh)+Mh*Mh)/2,Lp=wh*Mh*(wh*Mh);let Ip=0;(Jh!==0||Lp!==0)&&(Jh<0?Ip=0-Math.sqrt(Jh*Jh+Lp):Ip=Math.sqrt(Jh*Jh+Lp),Ip=Lp/(Jh+Ip));let $p=(vp+wh)*(vp-wh)+Ip,Xp=vp*gp;for(let Cp=ol;Cp<ml-1;Cp++){let Gp=hypotenuse$1($p,Xp);Gp===0&&(Gp=Number.MIN_VALUE);let Rp=$p/Gp,od=Xp/Gp;if(Cp!==ol&&(yi[Cp-1]=Gp),$p=Rp*Bt[Cp]+od*yi[Cp],yi[Cp]=Rp*yi[Cp]-od*Bt[Cp],Xp=od*Bt[Cp+1],Bt[Cp+1]=Rp*Bt[Cp+1],y)for(let Wp=0;Wp<o;Wp++)Gp=Rp*Wr.get(Wp,Cp)+od*Wr.get(Wp,Cp+1),Wr.set(Wp,Cp+1,-od*Wr.get(Wp,Cp)+Rp*Wr.get(Wp,Cp+1)),Wr.set(Wp,Cp,Gp);if(Gp=hypotenuse$1($p,Xp),Gp===0&&(Gp=Number.MIN_VALUE),Rp=$p/Gp,od=Xp/Gp,Bt[Cp]=Gp,$p=Rp*yi[Cp]+od*Bt[Cp+1],Bt[Cp+1]=-od*yi[Cp]+Rp*Bt[Cp+1],Xp=od*yi[Cp+1],yi[Cp+1]=Rp*yi[Cp+1],h&&Cp<r-1)for(let Wp=0;Wp<r;Wp++)Gp=Rp*Ir.get(Wp,Cp)+od*Ir.get(Wp,Cp+1),Ir.set(Wp,Cp+1,-od*Ir.get(Wp,Cp)+Rp*Ir.get(Wp,Cp+1)),Ir.set(Wp,Cp,Gp)}yi[ml-2]=$p;break}case 4:{if(Bt[ol]<=0&&(Bt[ol]=Bt[ol]<0?-Bt[ol]:0,y))for(let rh=0;rh<=il;rh++)Wr.set(rh,ol,-Wr.get(rh,ol));for(;ol<il&&!(Bt[ol]>=Bt[ol+1]);){let rh=Bt[ol];if(Bt[ol]=Bt[ol+1],Bt[ol+1]=rh,y&&ol<o-1)for(let wh=0;wh<o;wh++)rh=Wr.get(wh,ol+1),Wr.set(wh,ol+1,Wr.get(wh,ol)),Wr.set(wh,ol,rh);if(h&&ol<r-1)for(let wh=0;wh<r;wh++)rh=Ir.get(wh,ol+1),Ir.set(wh,ol+1,Ir.get(wh,ol)),Ir.set(wh,ol,rh);ol++}ml--;break}}}if(C){let ol=Wr;Wr=Ir,Ir=ol}this.m=r,this.n=o,this.s=Bt,this.U=Ir,this.V=Wr}solve(t){let e=t,r=this.threshold,o=this.s.length,s=Matrix$2.zeros(o,o);for(let Y=0;Y<o;Y++)Math.abs(this.s[Y])<=r?s.set(Y,Y,0):s.set(Y,Y,1/this.s[Y]);let l=this.U,a=this.rightSingularVectors,h=a.mmul(s),y=a.rows,C=l.rows,L=Matrix$2.zeros(y,C);for(let Y=0;Y<y;Y++)for(let ze=0;ze<C;ze++){let Bt=0;for(let Ir=0;Ir<o;Ir++)Bt+=h.get(Y,Ir)*l.get(ze,Ir);L.set(Y,ze,Bt)}return L.mmul(e)}solveForDiagonal(t){return this.solve(Matrix$2.diag(t))}inverse(){let t=this.V,e=this.threshold,r=t.rows,o=t.columns,s=new Matrix$2(r,this.s.length);for(let C=0;C<r;C++)for(let L=0;L<o;L++)Math.abs(this.s[L])>e&&s.set(C,L,t.get(C,L)/this.s[L]);let l=this.U,a=l.rows,h=l.columns,y=new Matrix$2(r,a);for(let C=0;C<r;C++)for(let L=0;L<a;L++){let Y=0;for(let ze=0;ze<h;ze++)Y+=s.get(C,ze)*l.get(L,ze);y.set(C,L,Y)}return y}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let t=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,r=this.s;for(let o=0,s=r.length;o<s;o++)r[o]>t&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return Matrix$2.diag(this.s)}}function inverse(n,t=!1){return n=WrapperMatrix2D.checkMatrix(n),t?new SingularValueDecomposition(n).inverse():solve(n,Matrix$2.eye(n.rows))}function solve(n,t,e=!1){return n=WrapperMatrix2D.checkMatrix(n),t=WrapperMatrix2D.checkMatrix(t),e?new SingularValueDecomposition(n).solve(t):n.isSquare()?new LuDecomposition(n).solve(t):new QrDecomposition(n).solve(t)}function determinant(n){if(n=Matrix$2.checkMatrix(n),n.isSquare()){if(n.columns===0)return 1;let t,e,r,o;if(n.columns===2)return t=n.get(0,0),e=n.get(0,1),r=n.get(1,0),o=n.get(1,1),t*o-e*r;if(n.columns===3){let s,l,a;return s=new MatrixSelectionView(n,[1,2],[1,2]),l=new MatrixSelectionView(n,[1,2],[0,2]),a=new MatrixSelectionView(n,[1,2],[0,1]),t=n.get(0,0),e=n.get(0,1),r=n.get(0,2),t*determinant(s)-e*determinant(l)+r*determinant(a)}else return new LuDecomposition(n).determinant}else throw Error("determinant can only be calculated for a square matrix")}function xrange(n,t){let e=[];for(let r=0;r<n;r++)r!==t&&e.push(r);return e}function dependenciesOneRow(n,t,e,r=1e-9,o=1e-9){if(n>o)return new Array(t.rows+1).fill(0);{let s=t.addRow(e,[0]);for(let l=0;l<s.rows;l++)Math.abs(s.get(l,0))<r&&s.set(l,0,0);return s.to1DArray()}}function linearDependencies(n,t={}){const{thresholdValue:e=1e-9,thresholdError:r=1e-9}=t;n=Matrix$2.checkMatrix(n);let o=n.rows,s=new Matrix$2(o,o);for(let l=0;l<o;l++){let a=Matrix$2.columnVector(n.getRow(l)),h=n.subMatrixRow(xrange(o,l)).transpose(),C=new SingularValueDecomposition(h).solve(a),L=Matrix$2.sub(a,h.mmul(C)).abs().max();s.setRow(l,dependenciesOneRow(L,C,l,e,r))}return s}function pseudoInverse(n,t=Number.EPSILON){if(n=Matrix$2.checkMatrix(n),n.isEmpty())return n.transpose();let e=new SingularValueDecomposition(n,{autoTranspose:!0}),r=e.leftSingularVectors,o=e.rightSingularVectors,s=e.diagonal;for(let l=0;l<s.length;l++)Math.abs(s[l])>t?s[l]=1/s[l]:s[l]=0;return o.mmul(Matrix$2.diag(s).mmul(r.transpose()))}function covariance(n,t=n,e={}){n=new Matrix$2(n);let r=!1;if(typeof t=="object"&&!Matrix$2.isMatrix(t)&&!isAnyArray(t)?(e=t,t=n,r=!0):t=new Matrix$2(t),n.rows!==t.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:o=!0}=e;o&&(n=n.center("column"),r||(t=t.center("column")));const s=n.transpose().mmul(t);for(let l=0;l<s.rows;l++)for(let a=0;a<s.columns;a++)s.set(l,a,s.get(l,a)*(1/(n.rows-1)));return s}function correlation(n,t=n,e={}){n=new Matrix$2(n);let r=!1;if(typeof t=="object"&&!Matrix$2.isMatrix(t)&&!isAnyArray(t)?(e=t,t=n,r=!0):t=new Matrix$2(t),n.rows!==t.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:o=!0,scale:s=!0}=e;o&&(n.center("column"),r||t.center("column")),s&&(n.scale("column"),r||t.scale("column"));const l=n.standardDeviation("column",{unbiased:!0}),a=r?l:t.standardDeviation("column",{unbiased:!0}),h=n.transpose().mmul(t);for(let y=0;y<h.rows;y++)for(let C=0;C<h.columns;C++)h.set(y,C,h.get(y,C)*(1/(l[y]*a[C]))*(1/(n.rows-1)));return h}class EigenvalueDecomposition{constructor(t,e={}){const{assumeSymmetric:r=!1}=e;if(t=WrapperMatrix2D.checkMatrix(t),!t.isSquare())throw new Error("Matrix is not a square matrix");if(t.isEmpty())throw new Error("Matrix must be non-empty");let o=t.columns,s=new Matrix$2(o,o),l=new Float64Array(o),a=new Float64Array(o),h=t,y,C,L=!1;if(r?L=!0:L=t.isSymmetric(),L){for(y=0;y<o;y++)for(C=0;C<o;C++)s.set(y,C,h.get(y,C));tred2(o,a,l,s),tql2(o,a,l,s)}else{let Y=new Matrix$2(o,o),ze=new Float64Array(o);for(C=0;C<o;C++)for(y=0;y<o;y++)Y.set(y,C,h.get(y,C));orthes(o,Y,ze,s),hqr2(o,a,l,s,Y)}this.n=o,this.e=a,this.d=l,this.V=s}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let t=this.n,e=this.e,r=this.d,o=new Matrix$2(t,t),s,l;for(s=0;s<t;s++){for(l=0;l<t;l++)o.set(s,l,0);o.set(s,s,r[s]),e[s]>0?o.set(s,s+1,e[s]):e[s]<0&&o.set(s,s-1,e[s])}return o}}function tred2(n,t,e,r){let o,s,l,a,h,y,C,L;for(h=0;h<n;h++)e[h]=r.get(n-1,h);for(a=n-1;a>0;a--){for(L=0,l=0,y=0;y<a;y++)L=L+Math.abs(e[y]);if(L===0)for(t[a]=e[a-1],h=0;h<a;h++)e[h]=r.get(a-1,h),r.set(a,h,0),r.set(h,a,0);else{for(y=0;y<a;y++)e[y]/=L,l+=e[y]*e[y];for(o=e[a-1],s=Math.sqrt(l),o>0&&(s=-s),t[a]=L*s,l=l-o*s,e[a-1]=o-s,h=0;h<a;h++)t[h]=0;for(h=0;h<a;h++){for(o=e[h],r.set(h,a,o),s=t[h]+r.get(h,h)*o,y=h+1;y<=a-1;y++)s+=r.get(y,h)*e[y],t[y]+=r.get(y,h)*o;t[h]=s}for(o=0,h=0;h<a;h++)t[h]/=l,o+=t[h]*e[h];for(C=o/(l+l),h=0;h<a;h++)t[h]-=C*e[h];for(h=0;h<a;h++){for(o=e[h],s=t[h],y=h;y<=a-1;y++)r.set(y,h,r.get(y,h)-(o*t[y]+s*e[y]));e[h]=r.get(a-1,h),r.set(a,h,0)}}e[a]=l}for(a=0;a<n-1;a++){if(r.set(n-1,a,r.get(a,a)),r.set(a,a,1),l=e[a+1],l!==0){for(y=0;y<=a;y++)e[y]=r.get(y,a+1)/l;for(h=0;h<=a;h++){for(s=0,y=0;y<=a;y++)s+=r.get(y,a+1)*r.get(y,h);for(y=0;y<=a;y++)r.set(y,h,r.get(y,h)-s*e[y])}}for(y=0;y<=a;y++)r.set(y,a+1,0)}for(h=0;h<n;h++)e[h]=r.get(n-1,h),r.set(n-1,h,0);r.set(n-1,n-1,1),t[0]=0}function tql2(n,t,e,r){let o,s,l,a,h,y,C,L,Y,ze,Bt,Ir,Wr,yi,Bn,vi;for(l=1;l<n;l++)t[l-1]=t[l];t[n-1]=0;let wo=0,ia=0,gl=Number.EPSILON;for(y=0;y<n;y++){for(ia=Math.max(ia,Math.abs(e[y])+Math.abs(t[y])),C=y;C<n&&!(Math.abs(t[C])<=gl*ia);)C++;if(C>y)do{for(o=e[y],L=(e[y+1]-o)/(2*t[y]),Y=hypotenuse$1(L,1),L<0&&(Y=-Y),e[y]=t[y]/(L+Y),e[y+1]=t[y]*(L+Y),ze=e[y+1],s=o-e[y],l=y+2;l<n;l++)e[l]-=s;for(wo=wo+s,L=e[C],Bt=1,Ir=Bt,Wr=Bt,yi=t[y+1],Bn=0,vi=0,l=C-1;l>=y;l--)for(Wr=Ir,Ir=Bt,vi=Bn,o=Bt*t[l],s=Bt*L,Y=hypotenuse$1(L,t[l]),t[l+1]=Bn*Y,Bn=t[l]/Y,Bt=L/Y,L=Bt*e[l]-Bn*o,e[l+1]=s+Bn*(Bt*o+Bn*e[l]),h=0;h<n;h++)s=r.get(h,l+1),r.set(h,l+1,Bn*r.get(h,l)+Bt*s),r.set(h,l,Bt*r.get(h,l)-Bn*s);L=-Bn*vi*Wr*yi*t[y]/ze,t[y]=Bn*L,e[y]=Bt*L}while(Math.abs(t[y])>gl*ia);e[y]=e[y]+wo,t[y]=0}for(l=0;l<n-1;l++){for(h=l,L=e[l],a=l+1;a<n;a++)e[a]<L&&(h=a,L=e[a]);if(h!==l)for(e[h]=e[l],e[l]=L,a=0;a<n;a++)L=r.get(a,l),r.set(a,l,r.get(a,h)),r.set(a,h,L)}}function orthes(n,t,e,r){let o=0,s=n-1,l,a,h,y,C,L,Y;for(L=o+1;L<=s-1;L++){for(Y=0,y=L;y<=s;y++)Y=Y+Math.abs(t.get(y,L-1));if(Y!==0){for(h=0,y=s;y>=L;y--)e[y]=t.get(y,L-1)/Y,h+=e[y]*e[y];for(a=Math.sqrt(h),e[L]>0&&(a=-a),h=h-e[L]*a,e[L]=e[L]-a,C=L;C<n;C++){for(l=0,y=s;y>=L;y--)l+=e[y]*t.get(y,C);for(l=l/h,y=L;y<=s;y++)t.set(y,C,t.get(y,C)-l*e[y])}for(y=0;y<=s;y++){for(l=0,C=s;C>=L;C--)l+=e[C]*t.get(y,C);for(l=l/h,C=L;C<=s;C++)t.set(y,C,t.get(y,C)-l*e[C])}e[L]=Y*e[L],t.set(L,L-1,Y*a)}}for(y=0;y<n;y++)for(C=0;C<n;C++)r.set(y,C,y===C?1:0);for(L=s-1;L>=o+1;L--)if(t.get(L,L-1)!==0){for(y=L+1;y<=s;y++)e[y]=t.get(y,L-1);for(C=L;C<=s;C++){for(a=0,y=L;y<=s;y++)a+=e[y]*r.get(y,C);for(a=a/e[L]/t.get(L,L-1),y=L;y<=s;y++)r.set(y,C,r.get(y,C)+a*e[y])}}}function hqr2(n,t,e,r,o){let s=n-1,l=0,a=n-1,h=Number.EPSILON,y=0,C=0,L=0,Y=0,ze=0,Bt=0,Ir=0,Wr=0,yi,Bn,vi,wo,ia,gl,ml,il,sl,ol,_l,rh,wh,Fh,Mh;for(yi=0;yi<n;yi++)for((yi<l||yi>a)&&(e[yi]=o.get(yi,yi),t[yi]=0),Bn=Math.max(yi-1,0);Bn<n;Bn++)C=C+Math.abs(o.get(yi,Bn));for(;s>=l;){for(wo=s;wo>l&&(Bt=Math.abs(o.get(wo-1,wo-1))+Math.abs(o.get(wo,wo)),Bt===0&&(Bt=C),!(Math.abs(o.get(wo,wo-1))<h*Bt));)wo--;if(wo===s)o.set(s,s,o.get(s,s)+y),e[s]=o.get(s,s),t[s]=0,s--,Wr=0;else if(wo===s-1){if(ml=o.get(s,s-1)*o.get(s-1,s),L=(o.get(s-1,s-1)-o.get(s,s))/2,Y=L*L+ml,Ir=Math.sqrt(Math.abs(Y)),o.set(s,s,o.get(s,s)+y),o.set(s-1,s-1,o.get(s-1,s-1)+y),il=o.get(s,s),Y>=0){for(Ir=L>=0?L+Ir:L-Ir,e[s-1]=il+Ir,e[s]=e[s-1],Ir!==0&&(e[s]=il-ml/Ir),t[s-1]=0,t[s]=0,il=o.get(s,s-1),Bt=Math.abs(il)+Math.abs(Ir),L=il/Bt,Y=Ir/Bt,ze=Math.sqrt(L*L+Y*Y),L=L/ze,Y=Y/ze,Bn=s-1;Bn<n;Bn++)Ir=o.get(s-1,Bn),o.set(s-1,Bn,Y*Ir+L*o.get(s,Bn)),o.set(s,Bn,Y*o.get(s,Bn)-L*Ir);for(yi=0;yi<=s;yi++)Ir=o.get(yi,s-1),o.set(yi,s-1,Y*Ir+L*o.get(yi,s)),o.set(yi,s,Y*o.get(yi,s)-L*Ir);for(yi=l;yi<=a;yi++)Ir=r.get(yi,s-1),r.set(yi,s-1,Y*Ir+L*r.get(yi,s)),r.set(yi,s,Y*r.get(yi,s)-L*Ir)}else e[s-1]=il+L,e[s]=il+L,t[s-1]=Ir,t[s]=-Ir;s=s-2,Wr=0}else{if(il=o.get(s,s),sl=0,ml=0,wo<s&&(sl=o.get(s-1,s-1),ml=o.get(s,s-1)*o.get(s-1,s)),Wr===10){for(y+=il,yi=l;yi<=s;yi++)o.set(yi,yi,o.get(yi,yi)-il);Bt=Math.abs(o.get(s,s-1))+Math.abs(o.get(s-1,s-2)),il=sl=.75*Bt,ml=-.4375*Bt*Bt}if(Wr===30&&(Bt=(sl-il)/2,Bt=Bt*Bt+ml,Bt>0)){for(Bt=Math.sqrt(Bt),sl<il&&(Bt=-Bt),Bt=il-ml/((sl-il)/2+Bt),yi=l;yi<=s;yi++)o.set(yi,yi,o.get(yi,yi)-Bt);y+=Bt,il=sl=ml=.964}for(Wr=Wr+1,ia=s-2;ia>=wo&&(Ir=o.get(ia,ia),ze=il-Ir,Bt=sl-Ir,L=(ze*Bt-ml)/o.get(ia+1,ia)+o.get(ia,ia+1),Y=o.get(ia+1,ia+1)-Ir-ze-Bt,ze=o.get(ia+2,ia+1),Bt=Math.abs(L)+Math.abs(Y)+Math.abs(ze),L=L/Bt,Y=Y/Bt,ze=ze/Bt,!(ia===wo||Math.abs(o.get(ia,ia-1))*(Math.abs(Y)+Math.abs(ze))<h*(Math.abs(L)*(Math.abs(o.get(ia-1,ia-1))+Math.abs(Ir)+Math.abs(o.get(ia+1,ia+1))))));)ia--;for(yi=ia+2;yi<=s;yi++)o.set(yi,yi-2,0),yi>ia+2&&o.set(yi,yi-3,0);for(vi=ia;vi<=s-1&&(Fh=vi!==s-1,vi!==ia&&(L=o.get(vi,vi-1),Y=o.get(vi+1,vi-1),ze=Fh?o.get(vi+2,vi-1):0,il=Math.abs(L)+Math.abs(Y)+Math.abs(ze),il!==0&&(L=L/il,Y=Y/il,ze=ze/il)),il!==0);vi++)if(Bt=Math.sqrt(L*L+Y*Y+ze*ze),L<0&&(Bt=-Bt),Bt!==0){for(vi!==ia?o.set(vi,vi-1,-Bt*il):wo!==ia&&o.set(vi,vi-1,-o.get(vi,vi-1)),L=L+Bt,il=L/Bt,sl=Y/Bt,Ir=ze/Bt,Y=Y/L,ze=ze/L,Bn=vi;Bn<n;Bn++)L=o.get(vi,Bn)+Y*o.get(vi+1,Bn),Fh&&(L=L+ze*o.get(vi+2,Bn),o.set(vi+2,Bn,o.get(vi+2,Bn)-L*Ir)),o.set(vi,Bn,o.get(vi,Bn)-L*il),o.set(vi+1,Bn,o.get(vi+1,Bn)-L*sl);for(yi=0;yi<=Math.min(s,vi+3);yi++)L=il*o.get(yi,vi)+sl*o.get(yi,vi+1),Fh&&(L=L+Ir*o.get(yi,vi+2),o.set(yi,vi+2,o.get(yi,vi+2)-L*ze)),o.set(yi,vi,o.get(yi,vi)-L),o.set(yi,vi+1,o.get(yi,vi+1)-L*Y);for(yi=l;yi<=a;yi++)L=il*r.get(yi,vi)+sl*r.get(yi,vi+1),Fh&&(L=L+Ir*r.get(yi,vi+2),r.set(yi,vi+2,r.get(yi,vi+2)-L*ze)),r.set(yi,vi,r.get(yi,vi)-L),r.set(yi,vi+1,r.get(yi,vi+1)-L*Y)}}}if(C!==0){for(s=n-1;s>=0;s--)if(L=e[s],Y=t[s],Y===0)for(wo=s,o.set(s,s,1),yi=s-1;yi>=0;yi--){for(ml=o.get(yi,yi)-L,ze=0,Bn=wo;Bn<=s;Bn++)ze=ze+o.get(yi,Bn)*o.get(Bn,s);if(t[yi]<0)Ir=ml,Bt=ze;else if(wo=yi,t[yi]===0?o.set(yi,s,ml!==0?-ze/ml:-ze/(h*C)):(il=o.get(yi,yi+1),sl=o.get(yi+1,yi),Y=(e[yi]-L)*(e[yi]-L)+t[yi]*t[yi],gl=(il*Bt-Ir*ze)/Y,o.set(yi,s,gl),o.set(yi+1,s,Math.abs(il)>Math.abs(Ir)?(-ze-ml*gl)/il:(-Bt-sl*gl)/Ir)),gl=Math.abs(o.get(yi,s)),h*gl*gl>1)for(Bn=yi;Bn<=s;Bn++)o.set(Bn,s,o.get(Bn,s)/gl)}else if(Y<0)for(wo=s-1,Math.abs(o.get(s,s-1))>Math.abs(o.get(s-1,s))?(o.set(s-1,s-1,Y/o.get(s,s-1)),o.set(s-1,s,-(o.get(s,s)-L)/o.get(s,s-1))):(Mh=cdiv(0,-o.get(s-1,s),o.get(s-1,s-1)-L,Y),o.set(s-1,s-1,Mh[0]),o.set(s-1,s,Mh[1])),o.set(s,s-1,0),o.set(s,s,1),yi=s-2;yi>=0;yi--){for(ol=0,_l=0,Bn=wo;Bn<=s;Bn++)ol=ol+o.get(yi,Bn)*o.get(Bn,s-1),_l=_l+o.get(yi,Bn)*o.get(Bn,s);if(ml=o.get(yi,yi)-L,t[yi]<0)Ir=ml,ze=ol,Bt=_l;else if(wo=yi,t[yi]===0?(Mh=cdiv(-ol,-_l,ml,Y),o.set(yi,s-1,Mh[0]),o.set(yi,s,Mh[1])):(il=o.get(yi,yi+1),sl=o.get(yi+1,yi),rh=(e[yi]-L)*(e[yi]-L)+t[yi]*t[yi]-Y*Y,wh=(e[yi]-L)*2*Y,rh===0&&wh===0&&(rh=h*C*(Math.abs(ml)+Math.abs(Y)+Math.abs(il)+Math.abs(sl)+Math.abs(Ir))),Mh=cdiv(il*ze-Ir*ol+Y*_l,il*Bt-Ir*_l-Y*ol,rh,wh),o.set(yi,s-1,Mh[0]),o.set(yi,s,Mh[1]),Math.abs(il)>Math.abs(Ir)+Math.abs(Y)?(o.set(yi+1,s-1,(-ol-ml*o.get(yi,s-1)+Y*o.get(yi,s))/il),o.set(yi+1,s,(-_l-ml*o.get(yi,s)-Y*o.get(yi,s-1))/il)):(Mh=cdiv(-ze-sl*o.get(yi,s-1),-Bt-sl*o.get(yi,s),Ir,Y),o.set(yi+1,s-1,Mh[0]),o.set(yi+1,s,Mh[1]))),gl=Math.max(Math.abs(o.get(yi,s-1)),Math.abs(o.get(yi,s))),h*gl*gl>1)for(Bn=yi;Bn<=s;Bn++)o.set(Bn,s-1,o.get(Bn,s-1)/gl),o.set(Bn,s,o.get(Bn,s)/gl)}for(yi=0;yi<n;yi++)if(yi<l||yi>a)for(Bn=yi;Bn<n;Bn++)r.set(yi,Bn,o.get(yi,Bn));for(Bn=n-1;Bn>=l;Bn--)for(yi=l;yi<=a;yi++){for(Ir=0,vi=l;vi<=Math.min(Bn,a);vi++)Ir=Ir+r.get(yi,vi)*o.get(vi,Bn);r.set(yi,Bn,Ir)}}}function cdiv(n,t,e,r){let o,s;return Math.abs(e)>Math.abs(r)?(o=r/e,s=e+o*r,[(n+o*t)/s,(t-o*n)/s]):(o=e/r,s=r+o*e,[(o*n+t)/s,(o*t-n)/s])}class CholeskyDecomposition{constructor(t){if(t=WrapperMatrix2D.checkMatrix(t),!t.isSymmetric())throw new Error("Matrix is not symmetric");let e=t,r=e.rows,o=new Matrix$2(r,r),s=!0,l,a,h;for(a=0;a<r;a++){let y=0;for(h=0;h<a;h++){let C=0;for(l=0;l<h;l++)C+=o.get(h,l)*o.get(a,l);C=(e.get(a,h)-C)/o.get(h,h),o.set(a,h,C),y=y+C*C}for(y=e.get(a,a)-y,s&=y>0,o.set(a,a,Math.sqrt(Math.max(y,0))),h=a+1;h<r;h++)o.set(a,h,0)}this.L=o,this.positiveDefinite=!!s}isPositiveDefinite(){return this.positiveDefinite}solve(t){t=WrapperMatrix2D.checkMatrix(t);let e=this.L,r=e.rows;if(t.rows!==r)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let o=t.columns,s=t.clone(),l,a,h;for(h=0;h<r;h++)for(a=0;a<o;a++){for(l=0;l<h;l++)s.set(h,a,s.get(h,a)-s.get(l,a)*e.get(h,l));s.set(h,a,s.get(h,a)/e.get(h,h))}for(h=r-1;h>=0;h--)for(a=0;a<o;a++){for(l=h+1;l<r;l++)s.set(h,a,s.get(h,a)-s.get(l,a)*e.get(l,h));s.set(h,a,s.get(h,a)/e.get(h,h))}return s}get lowerTriangularMatrix(){return this.L}}class nipals{constructor(t,e={}){t=WrapperMatrix2D.checkMatrix(t);let{Y:r}=e;const{scaleScores:o=!1,maxIterations:s=1e3,terminationCriteria:l=1e-10}=e;let a;if(r){if(isAnyArray(r)&&typeof r[0]=="number"?r=Matrix$2.columnVector(r):r=WrapperMatrix2D.checkMatrix(r),r.rows!==t.rows)throw new Error("Y should have the same number of rows as X");a=r.getColumnVector(0)}else a=t.getColumnVector(0);let h=1,y,C,L,Y;for(let ze=0;ze<s&&h>l;ze++)L=t.transpose().mmul(a).div(a.transpose().mmul(a).get(0,0)),L=L.div(L.norm()),y=t.mmul(L).div(L.transpose().mmul(L).get(0,0)),ze>0&&(h=y.clone().sub(Y).pow(2).sum()),Y=y.clone(),r?(C=r.transpose().mmul(y).div(y.transpose().mmul(y).get(0,0)),C=C.div(C.norm()),a=r.mmul(C).div(C.transpose().mmul(C).get(0,0))):a=y;if(r){let ze=t.transpose().mmul(y).div(y.transpose().mmul(y).get(0,0));ze=ze.div(ze.norm());let Bt=t.clone().sub(y.clone().mmul(ze.transpose())),Ir=a.transpose().mmul(y).div(y.transpose().mmul(y).get(0,0)),Wr=r.clone().sub(y.clone().mulS(Ir.get(0,0)).mmul(C.transpose()));this.t=y,this.p=ze.transpose(),this.w=L.transpose(),this.q=C,this.u=a,this.s=y.transpose().mmul(y),this.xResidual=Bt,this.yResidual=Wr,this.betas=Ir}else this.w=L.transpose(),this.s=y.transpose().mmul(y).sqrt(),o?this.t=y.clone().div(this.s.get(0,0)):this.t=y,this.xResidual=t.sub(y.mmul(L.transpose()))}}const src$1=Object.freeze(Object.defineProperty({__proto__:null,AbstractMatrix,CHO:CholeskyDecomposition,CholeskyDecomposition,EVD:EigenvalueDecomposition,EigenvalueDecomposition,LU:LuDecomposition,LuDecomposition,Matrix:Matrix$2,MatrixColumnSelectionView,MatrixColumnView,MatrixFlipColumnView,MatrixFlipRowView,MatrixRowSelectionView,MatrixRowView,MatrixSelectionView,MatrixSubView,MatrixTransposeView:MatrixTransposeView$1,NIPALS:nipals,Nipals:nipals,QR:QrDecomposition,QrDecomposition,SVD:SingularValueDecomposition,SingularValueDecomposition,WrapperMatrix1D,WrapperMatrix2D,correlation,covariance,default:Matrix$2,determinant,inverse,linearDependencies,pseudoInverse,solve,wrap},Symbol.toStringTag,{value:"Module"}));function getSeparatedKernel(n){const t=new SingularValueDecomposition(n,{autoTranspose:!0});if(t.rank!==1)return null;const e=Math.sqrt(t.s[0]),r=t.U.to2DArray().map(s=>s[0]*e),o=t.V.to2DArray().map(s=>s[0]*e);return[r,o]}function convolution(n,t={}){let{channels:e,bitDepth:r,normalize:o=!1,divisor:s=1,border:l="copy",algorithm:a="auto"}=t,h={};r&&(h.bitDepth=r);let y=Image$1.createFrom(this,h);if(e=validateArrayOfChannels(this,e),a!=="separable")({kernel:n}=validateKernel(n));else if(!Array.isArray(n)||n.length!==2)throw new RangeError("separable convolution requires two arrays of numbers to represent the kernel");if(a==="auto"){let wo=getSeparatedKernel(n);wo!==null?(a="separable",n=wo):(n.length>9||n[0].length>9)&&this.width<=4096&&this.height<=4096?a="fft":a="direct"}let C,L;a==="separable"?(C=Math.floor(n[0].length/2),L=Math.floor(n[1].length/2)):(C=Math.floor(n.length/2),L=Math.floor(n[0].length/2));let Y=y.isClamped,ze=new Array(this.height*this.width),Bt,Ir,Wr,yi,Bn,vi;for(yi=0;yi<e.length;yi++){for(Bn=e[yi],Wr=0;Wr<this.height;Wr++)for(Ir=0;Ir<this.width;Ir++)Bt=Wr*this.width+Ir,ze[Bt]=this.data[Bt*this.channels+Bn];if(a==="direct")vi=src$2.direct(ze,n,{rows:this.height,cols:this.width,normalize:o,divisor:s});else if(a==="separable"){if(vi=convolutionSeparable(ze,n,this.width,this.height),o){s=0;for(let wo=0;wo<n[0].length;wo++)for(let ia=0;ia<n[1].length;ia++)s+=n[0][wo]*n[1][ia]}if(s!==1)for(let wo=0;wo<vi.length;wo++)vi[wo]/=s}else vi=src$2.fft(ze,n,{rows:this.height,cols:this.width,normalize:o,divisor:s});for(Wr=0;Wr<this.height;Wr++)for(Ir=0;Ir<this.width;Ir++)Bt=Wr*this.width+Ir,Y?y.data[Bt*this.channels+Bn]=clamp(vi[Bt],y):y.data[Bt*this.channels+Bn]=vi[Bt]}if(this.alpha&&!e.includes(this.channels))for(Ir=this.components;Ir<this.data.length;Ir=Ir+this.channels)y.data[Ir]=this.data[Ir];return l!=="periodic"&&y.setBorder({size:[L,C],algorithm:l}),y}function gradientFilter(n={}){let{direction:t="xy",border:e="copy",kernelX:r,kernelY:o,channels:s,bitDepth:l=this.bitDepth}=n;switch(this.checkProcessable("gradientFilter",{bitDepth:[8,16]}),t){case"x":if(!r)throw new Error("kernelX option is missing");return convolution.call(this,r,{channels:s,border:e,bitDepth:l});case"y":if(!o)throw new Error("kernelY option is missing");return convolution.call(this,o,{channels:s,border:e,bitDepth:l});case"xy":{if(!r)throw new Error("kernelX option is missing");if(!o)throw new Error("kernelY option is missing");const a=convolution.call(this,r,{channels:s,border:e,bitDepth:32}),h=convolution.call(this,o,{channels:s,border:e,bitDepth:32});return a.hypotenuse(h,{bitDepth:l,channels:s})}default:throw new Error(`Unknown parameter direction: ${t}`)}}function sobelFilter(n){return gradientFilter.call(this,Object.assign({},n,{kernelX:SOBEL_X,kernelY:SOBEL_Y}))}function scharrFilter(n){return gradientFilter.call(this,Object.assign({},n,{kernelX:SCHARR_X,kernelY:SCHARR_Y}))}var newArray_1=newArray;function newArray(n,t){n=n||0;for(var e=new Array(n),r=0;r<n;r++)e[r]=t;return e}const newArray$1=getDefaultExportFromCjs(newArray_1);function level(n={}){let{algorithm:t="range",channels:e,min:r=this.min,max:o=this.max}=n;switch(this.checkProcessable("level",{bitDepth:[8,16,32]}),e=validateArrayOfChannels(this,{channels:e}),e.length!==this.channel&&(Array.isArray(r)&&r.length===this.channels&&(r=r.filter((s,l)=>e.includes(l))),Array.isArray(o)&&o.length===this.channels&&(o=o.filter((s,l)=>e.includes(l)))),t){case"range":r<0&&(r=0),o>this.maxValue&&(o=this.maxValue),Array.isArray(r)||(r=newArray$1(e.length,r)),Array.isArray(o)||(o=newArray$1(e.length,o)),processImage(this,r,o,e);break;default:throw new Error(`level: algorithm not implement: ${t}`)}return this}function processImage(n,t,e,r){let o=1e-5,s=new Array(r.length);for(let l=0;l<r.length;l++)t[l]===0&&e[l]===n.maxValue||e[l]===t[l]?s[l]=0:s[l]=(n.maxValue+1-o)/(e[l]-t[l]),t[l]+=(.5-o/2)/s[l];for(let l=0;l<r.length;l++){let a=r[l];if(s[l]!==0)for(let h=0;h<n.data.length;h+=n.channels)n.data[h+a]=Math.min(Math.max(0,(n.data[h+a]-t[l])*s[l]+.5|0),n.maxValue)}}var toString=Object.prototype.toString,isArrayType=function n(t){return toString.call(t).substr(-6,5)==="Array"};const isArray=getDefaultExportFromCjs(isArrayType);function checkNumberArray(n){if(isNaN(n)){if(n instanceof Image$1)return n.data;if(!isArray(n))throw new Error("checkNumberArray: the value should be either a number, array or Image");return n}else{if(n<=0)throw new Error("checkNumberArray: the value must be greater than 0");return n}}function add(n,t={}){let{channels:e}=t;if(this.checkProcessable("add",{bitDepth:[8,16]}),e=validateArrayOfChannels(this,{channels:e}),n=checkNumberArray(n),isNaN(n)){if(this.data.length!==n.length)throw new Error("add: the data size is different");for(let r=0;r<e.length;r++){let o=e[r];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+o]=Math.max(0,Math.min(this.maxValue,this.data[s+o]+n[s+o]>>0))}}else for(let r=0;r<e.length;r++){let o=e[r];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+o]=Math.min(this.maxValue,this.data[s+o]+n>>0)}return this}function subtract(n,t={}){let{channels:e}=t;if(this.checkProcessable("subtract",{bitDepth:[8,16]}),e=validateArrayOfChannels(this,{channels:e}),n=checkNumberArray(n),isNaN(n)){if(this.data.length!==n.length)throw new Error("subtract: the data size is different");for(let r=0;r<e.length;r++){let o=e[r];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+o]=Math.max(0,Math.min(this.maxValue,this.data[s+o]-n[s+o]>>0))}}else for(let r=0;r<e.length;r++){let o=e[r];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+o]=Math.max(0,this.data[s+o]-n>>0)}return this}function subtractImage(n,t={}){let{channels:e,absolute:r=!1}=t;if(this.checkProcessable("subtractImage",{bitDepth:[8,16]}),this.width!==n.width||this.height!==n.height)throw new Error("subtractImage: both images must have the same size");if(this.alpha!==n.alpha||this.bitDepth!==n.bitDepth)throw new Error("subtractImage: both images must have the same alpha and bitDepth");if(this.channels!==n.channels)throw new Error("subtractImage: both images must have the same number of channels");let o=this.clone();e=validateArrayOfChannels(this,{channels:e});for(let s=0;s<e.length;s++){let l=e[s];for(let a=l;a<this.data.length;a+=this.channels){let h=this.data[a]-n.data[a];r?o.data[a]=Math.abs(h):o.data[a]=Math.max(h,0)}}return o}function hypotenuse(n,t={}){let{bitDepth:e=this.bitDepth,channels:r}=t;if(this.checkProcessable("hypotenuse",{bitDepth:[8,16,32]}),this.width!==n.width||this.height!==n.height)throw new Error("hypotenuse: both images must have the same size");if(this.alpha!==n.alpha||this.bitDepth!==n.bitDepth)throw new Error("hypotenuse: both images must have the same alpha and bitDepth");if(this.channels!==n.channels)throw new Error("hypotenuse: both images must have the same number of channels");let o=Image$1.createFrom(this,{bitDepth:e});r=validateArrayOfChannels(this,{channels:r});let s=o.isClamped;for(let l=0;l<r.length;l++){let a=r[l];for(let h=a;h<this.data.length;h+=this.channels){let y=Math.hypot(this.data[h],n.data[h]);s?o.data[h]=Math.min(Math.max(Math.round(y),0),o.maxValue):o.data[h]=y}}return o}function multiply(n,t={}){let{channels:e}=t;if(this.checkProcessable("multiply",{bitDepth:[8,16]}),n<=0)throw new Error("multiply: the value must be greater than 0");if(e=validateArrayOfChannels(this,{channels:e}),n=checkNumberArray(n),isNaN(n)){if(this.data.length!==n.length)throw new Error("multiply: the data size is different");for(let r=0;r<e.length;r++){let o=e[r];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+o]=Math.max(0,Math.min(this.maxValue,this.data[s+o]*n[s+o]>>0))}}else for(let r=0;r<e.length;r++){let o=e[r];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+o]=Math.min(this.maxValue,this.data[s+o]*n>>0)}return this}function divide(n,t={}){let{channels:e}=t;if(this.checkProcessable("divide",{bitDepth:[8,16]}),e=validateArrayOfChannels(this,{channels:e}),n=checkNumberArray(n),isNaN(n)){if(this.data.length!==n.length)throw new Error("divide: the: the data size is different");for(let r=0;r<e.length;r++){let o=e[r];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+o]=Math.max(0,Math.min(this.maxValue,this.data[s+o]/n[s+o]>>0))}}else for(let r=0;r<e.length;r++){let o=e[r];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+o]=Math.min(this.maxValue,this.data[s+o]/n>>0)}return this}class BaseRegression{constructor(){if(new.target===BaseRegression)throw new Error("BaseRegression must be subclassed")}predict(t){if(typeof t=="number")return this._predict(t);if(isAnyArray(t)){const e=[];for(let r=0;r<t.length;r++)e.push(this._predict(t[r]));return e}else throw new TypeError("x must be a number or array")}_predict(){throw new Error("_predict must be implemented")}train(){}toString(){return""}toLaTeX(){return""}score(t,e){if(!isAnyArray(t)||!isAnyArray(e)||t.length!==e.length)throw new Error("x and y must be arrays of the same length");const r=t.length,o=new Array(r);for(let ze=0;ze<r;ze++)o[ze]=this._predict(t[ze]);let s=0,l=0,a=0,h=0,y=0,C=0,L=0;for(let ze=0;ze<r;ze++)s+=o[ze],l+=e[ze],y+=o[ze]*o[ze],C+=e[ze]*e[ze],L+=o[ze]*e[ze],e[ze]!==0&&(a+=(e[ze]-o[ze])*(e[ze]-o[ze])/e[ze]),h+=(e[ze]-o[ze])*(e[ze]-o[ze]);const Y=(r*L-s*l)/Math.sqrt((r*y-s*s)*(r*C-l*l));return{r:Y,r2:Y*Y,chi2:a,rmsd:Math.sqrt(h/r)}}}const require$$0$1=getAugmentedNamespace(src$1);function squaredEuclidean$4(n,t){let e=0;for(let r=0;r<n.length;r++)e+=(n[r]-t[r])*(n[r]-t[r]);return e}function euclidean$2(n,t){return Math.sqrt(squaredEuclidean$4(n,t))}const euclidean$3=Object.freeze(Object.defineProperty({__proto__:null,euclidean:euclidean$2,squaredEuclidean:squaredEuclidean$4},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(euclidean$3),{squaredEuclidean:squaredEuclidean$3}=require$$0,defaultOptions$b={sigma:1};let GaussianKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$b,t),this.sigma=t.sigma,this.divisor=2*t.sigma*t.sigma}compute(t,e){const r=squaredEuclidean$3(t,e);return Math.exp(-r/this.divisor)}};var gaussianKernel=GaussianKernel$1;const defaultOptions$a={degree:1,constant:1,scale:1};let PolynomialKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$a,t),this.degree=t.degree,this.constant=t.constant,this.scale=t.scale}compute(t,e){for(var r=0,o=0;o<t.length;o++)r+=t[o]*e[o];return Math.pow(this.scale*r+this.constant,this.degree)}};var polynomialKernel=PolynomialKernel$1;const defaultOptions$9={alpha:.01,constant:-Math.E};let SigmoidKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$9,t),this.alpha=t.alpha,this.constant=t.constant}compute(t,e){for(var r=0,o=0;o<t.length;o++)r+=t[o]*e[o];return Math.tanh(this.alpha*r+this.constant)}};var sigmoidKernel=SigmoidKernel$1;const defaultOptions$8={sigma:1,degree:1};let ANOVAKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$8,t),this.sigma=t.sigma,this.degree=t.degree}compute(t,e){for(var r=0,o=Math.min(t.length,e.length),s=1;s<=o;++s)r+=Math.pow(Math.exp(-this.sigma*Math.pow(Math.pow(t[s-1],s)-Math.pow(e[s-1],s),2)),this.degree);return r}};var anovaKernel=ANOVAKernel$1;const{squaredEuclidean:squaredEuclidean$2}=require$$0,defaultOptions$7={sigma:1};let CauchyKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$7,t),this.sigma=t.sigma}compute(t,e){return 1/(1+squaredEuclidean$2(t,e)/(this.sigma*this.sigma))}};var cauchyKernel=CauchyKernel$1;const{euclidean:euclidean$1}=require$$0,defaultOptions$6={sigma:1};let ExponentialKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$6,t),this.sigma=t.sigma,this.divisor=2*t.sigma*t.sigma}compute(t,e){const r=euclidean$1(t,e);return Math.exp(-r/this.divisor)}};var exponentialKernel=ExponentialKernel$1;class HistogramIntersectionKernel{compute(t,e){for(var r=Math.min(t.length,e.length),o=0,s=0;s<r;++s)o+=Math.min(t[s],e[s]);return o}}var histogramIntersectionKernel=HistogramIntersectionKernel;const{euclidean}=require$$0,defaultOptions$5={sigma:1};let LaplacianKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$5,t),this.sigma=t.sigma}compute(t,e){const r=euclidean(t,e);return Math.exp(-r/this.sigma)}};var laplacianKernel=LaplacianKernel$1;const{squaredEuclidean:squaredEuclidean$1}=require$$0,defaultOptions$4={constant:1};let MultiquadraticKernel$1=class{constructor(t){t=Object.assign({},defaultOptions$4,t),this.constant=t.constant}compute(t,e){return Math.sqrt(squaredEuclidean$1(t,e)+this.constant*this.constant)}};var multiquadraticKernel=MultiquadraticKernel$1;const{squaredEuclidean}=require$$0,defaultOptions$3={constant:1};class RationalQuadraticKernel{constructor(t){t=Object.assign({},defaultOptions$3,t),this.constant=t.constant}compute(t,e){const r=squaredEuclidean(t,e);return 1-r/(r+this.constant)}}var rationalQuadraticKernel=RationalQuadraticKernel;const{Matrix:Matrix$1,MatrixTransposeView}=require$$0$1,GaussianKernel=gaussianKernel,PolynomialKernel=polynomialKernel,SigmoidKernel=sigmoidKernel,ANOVAKernel=anovaKernel,CauchyKernel=cauchyKernel,ExponentialKernel=exponentialKernel,HistogramKernel=histogramIntersectionKernel,LaplacianKernel=laplacianKernel,MultiquadraticKernel=multiquadraticKernel,RationalKernel=rationalQuadraticKernel,kernelType={gaussian:GaussianKernel,rbf:GaussianKernel,polynomial:PolynomialKernel,poly:PolynomialKernel,anova:ANOVAKernel,cauchy:CauchyKernel,exponential:ExponentialKernel,histogram:HistogramKernel,min:HistogramKernel,laplacian:LaplacianKernel,multiquadratic:MultiquadraticKernel,rational:RationalKernel,sigmoid:SigmoidKernel,mlp:SigmoidKernel};class Kernel{constructor(t,e){if(this.kernelType=t,t!=="linear")if(typeof t=="string"){t=t.toLowerCase();var r=kernelType[t];if(r)this.kernelFunction=new r(e);else throw new Error(`unsupported kernel type: ${t}`)}else if(typeof t=="object"&&typeof t.compute=="function")this.kernelFunction=t;else throw new TypeError("first argument must be a valid kernel type or instance")}compute(t,e){if(t=Matrix$1.checkMatrix(t),e===void 0?e=t:e=Matrix$1.checkMatrix(e),this.kernelType==="linear")return t.mmul(new MatrixTransposeView(e));const r=new Matrix$1(t.rows,e.rows);if(t===e)for(let o=0;o<t.rows;o++)for(let s=o;s<t.rows;s++){const l=this.kernelFunction.compute(t.getRow(o),t.getRow(s));r.set(o,s,l),r.set(s,o,l)}else for(let o=0;o<t.rows;o++)for(let s=0;s<e.rows;s++)r.set(o,s,this.kernelFunction.compute(t.getRow(o),e.getRow(s)));return r}}var kernel=Kernel;const Kernel$1=getDefaultExportFromCjs(kernel),defaultOptions$2={lambda:.1,kernelType:"gaussian",kernelOptions:{},computeCoefficient:!1};class KernelRidgeRegression extends BaseRegression{constructor(t,e,r){if(super(),t===!0)this.alpha=e.alpha,this.inputs=e.inputs,this.kernelType=e.kernelType,this.kernelOptions=e.kernelOptions,this.kernel=new Kernel$1(e.kernelType,e.kernelOptions);else{t=Matrix$2.checkMatrix(t),r=Object.assign({},defaultOptions$2,r);const o=new Kernel$1(r.kernelType,r.kernelOptions),s=o.compute(t),l=t.rows;s.add(Matrix$2.eye(l,l).mul(r.lambda)),this.alpha=solve(s,e),this.inputs=t,this.kernelType=r.kernelType,this.kernelOptions=r.kernelOptions,this.kernel=o}}_predict(t){return this.kernel.compute([t],this.inputs).mmul(this.alpha).getRow(0)}toJSON(){return{name:"kernelRidgeRegression",alpha:this.alpha,inputs:this.inputs,kernelType:this.kernelType,kernelOptions:this.kernelOptions}}static load(t){if(t.name!=="kernelRidgeRegression")throw new TypeError("not a KRR model");return new KernelRidgeRegression(!0,t)}}function background$1(n,t,e){const r=new KernelRidgeRegression(n,t,e),o=new Array(this.size);for(let a=0;a<this.width;a++)for(let h=0;h<this.height;h++)o[h*this.width+a]=[a,h];const s=r.predict(o),l=Image$1.createFrom(this);for(let a=0;a<this.size;a++)l.data[a]=Math.min(this.maxValue,Math.max(0,s[a][0]));return l}function dilate(n={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:e=1}=n;if(this.checkProcessable("dilate",{bitDepth:[1,8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("dilate: The number of rows and columns of the kernel must be odd");let r=!0;e:for(const s of t)for(const l of s)if(l!==1){r=!1;break e}let o=this;for(let s=0;s<e;s++)if(this.bitDepth===1)if(r){const l=o.clone();o=dilateOnceBinaryOnlyOnes(o,l,t.length,t[0].length)}else{const l=Image$1.createFrom(o);o=dilateOnceBinary(o,l,t)}else if(r){const l=Image$1.createFrom(o);o=dilateOnceGreyOnlyOnes(o,l,t.length,t[0].length)}else{const l=Image$1.createFrom(o);o=dilateOnceGrey(o,l,t)}return o}function dilateOnceGrey(n,t,e){const r=e.length,o=e[0].length;let s=(r-1)/2,l=(o-1)/2;for(let a=0;a<n.height;a++)for(let h=0;h<n.width;h++){let y=0;for(let C=0;C<o;C++)for(let L=0;L<r;L++){if(e[L][C]!==1)continue;let Y=L-s+h,ze=C-l+a;if(Y<0||ze<0||Y>=n.width||ze>=n.height)continue;const Bt=n.getValueXY(Y,ze,0);Bt>y&&(y=Bt)}t.setValueXY(h,a,0,y)}return t}function dilateOnceGreyOnlyOnes(n,t,e,r){const o=(e-1)/2,s=(r-1)/2,l=[];for(let a=0;a<n.width;a++)l.push(0);for(let a=0;a<n.height;a++){for(let h=0;h<n.width;h++){let y=0;for(let C=Math.max(0,a-s);C<Math.min(n.height,a+s+1);C++){const L=n.getValueXY(h,C,0);L>y&&(y=L)}l[h]=y}for(let h=0;h<n.width;h++){let y=0;for(let C=Math.max(0,h-o);C<Math.min(n.width,h+o+1);C++)l[C]>y&&(y=l[C]);t.setValueXY(h,a,0,y)}}return t}function dilateOnceBinary(n,t,e){const r=e.length,o=e[0].length;let s=(r-1)/2,l=(o-1)/2;for(let a=0;a<n.height;a++)for(let h=0;h<n.width;h++){let y=0;e:for(let C=0;C<o;C++)for(let L=0;L<r;L++){if(e[L][C]!==1)continue;let Y=L-s+h,ze=C-l+a;if(ze<0||Y<0||Y>=n.width||ze>=n.height)continue;if(n.getBitXY(Y,ze)===1){y=1;break e}}y===1&&t.setBitXY(h,a)}return t}function dilateOnceBinaryOnlyOnes(n,t,e,r){const o=(e-1)/2,s=(r-1)/2,l=[];for(let a=0;a<n.width;a++)l.push(1);for(let a=0;a<n.height;a++){for(let h=0;h<n.width;h++){l[h]=0;for(let y=Math.max(0,a-s);y<Math.min(n.height,a+s+1);y++)if(n.getBitXY(h,y)===1){l[h]=1;break}}for(let h=0;h<n.width;h++)if(t.getBitXY(h,a)!==1){for(let y=Math.max(0,h-o);y<Math.min(n.width,h+o+1);y++)if(l[y]===1){t.setBitXY(h,a);break}}}return t}function erode(n={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:e=1}=n;if(this.checkProcessable("erode",{bitDepth:[1,8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("erode: The number of rows and columns of the kernel must be odd");let r=!0;e:for(const s of t)for(const l of s)if(l!==1){r=!1;break e}let o=this;for(let s=0;s<e;s++)if(this.bitDepth===1)if(r){const l=o.clone();o=erodeOnceBinaryOnlyOnes(o,l,t.length,t[0].length)}else{const l=Image$1.createFrom(o);o=erodeOnceBinary(o,l,t)}else if(r){const l=Image$1.createFrom(o);o=erodeOnceGreyOnlyOnes(o,l,t.length,t[0].length)}else{const l=Image$1.createFrom(o);o=erodeOnceGrey(o,l,t)}return o}function erodeOnceGrey(n,t,e){const r=e.length,o=e[0].length;let s=(r-1)/2,l=(o-1)/2;for(let a=0;a<n.height;a++)for(let h=0;h<n.width;h++){let y=n.maxValue;for(let C=0;C<o;C++)for(let L=0;L<r;L++){if(e[L][C]!==1)continue;let Y=L-s+h,ze=C-l+a;if(Y<0||ze<0||Y>=n.width||ze>=n.height)continue;const Bt=n.getValueXY(Y,ze,0);Bt<y&&(y=Bt)}t.setValueXY(h,a,0,y)}return t}function erodeOnceGreyOnlyOnes(n,t,e,r){const o=(e-1)/2,s=(r-1)/2,l=[];for(let a=0;a<n.width;a++)l.push(0);for(let a=0;a<n.height;a++){for(let h=0;h<n.width;h++){let y=n.maxValue;for(let C=Math.max(0,a-s);C<Math.min(n.height,a+s+1);C++){const L=n.getValueXY(h,C,0);L<y&&(y=L)}l[h]=y}for(let h=0;h<n.width;h++){let y=n.maxValue;for(let C=Math.max(0,h-o);C<Math.min(n.width,h+o+1);C++)l[C]<y&&(y=l[C]);t.setValueXY(h,a,0,y)}}return t}function erodeOnceBinary(n,t,e){const r=e.length,o=e[0].length;let s=(r-1)/2,l=(o-1)/2;for(let a=0;a<n.height;a++)for(let h=0;h<n.width;h++){let y=1;e:for(let C=0;C<o;C++)for(let L=0;L<r;L++){if(e[L][C]!==1)continue;let Y=L-s+h,ze=C-l+a;if(ze<0||Y<0||Y>=n.width||ze>=n.height)continue;if(n.getBitXY(Y,ze)===0){y=0;break e}}y===1&&t.setBitXY(h,a)}return t}function erodeOnceBinaryOnlyOnes(n,t,e,r){const o=(e-1)/2,s=(r-1)/2,l=[];for(let a=0;a<n.width;a++)l.push(0);for(let a=0;a<n.height;a++){for(let h=0;h<n.width;h++){l[h]=1;for(let y=Math.max(0,a-s);y<Math.min(n.height,a+s+1);y++)if(n.getBitXY(h,y)===0){l[h]=0;break}}for(let h=0;h<n.width;h++)if(t.getBitXY(h,a)!==0){for(let y=Math.max(0,h-o);y<Math.min(n.width,h+o+1);y++)if(l[y]===0){t.clearBitXY(h,a);break}}}return t}function open$1(n={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:e=1}=n;if(this.checkProcessable("open",{bitDepth:[8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("open: The number of rows and columns of the kernel must be odd");let r=this;for(let o=0;o<e;o++)r=r.erode({kernel:t}),r=r.dilate({kernel:t});return r}function close(n={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:e=1}=n;if(this.checkProcessable("close",{bitDepth:[1,8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("close: The number of rows and columns of the kernel must be odd");let r=this;for(let o=0;o<e;o++)r=r.dilate({kernel:t}).erode({kernel:t});return r}function topHat(n={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:e=1}=n;if(this.checkProcessable("topHat",{bitDepth:[8,16],components:1,alpha:0}),t.length%2===0||t[0].length%2===0)throw new TypeError("topHat: The number of rows and columns of the kernel must be odd");let r=this;for(let o=0;o<e;o++)r=r.open({kernel:t}).subtractImage(r,{absolute:!0});return r}function blackHat(n={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:e=1}=n;if(this.checkProcessable("blackHat",{bitDepth:[8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("blackHat: The number of rows and columns of the kernel must be odd");let r=this;for(let o=0;o<e;o++)r=r.close({kernel:t}).subtractImage(r,{absolute:!0});return r}function morphologicalGradient(n={}){let{kernel:t=[[1,1,1],[1,1,1],[1,1,1]],iterations:e=1}=n;if(this.checkProcessable("morphologicalGradient",{bitDepth:[8,16],components:1,alpha:0}),t.columns%2===0||t.rows%2===0)throw new TypeError("morphologicalGradient: The number of rows and columns of the kernel must be odd");let r=this;for(let o=0;o<e;o++){let s=r.dilate({kernel:t}),l=r.erode({kernel:t});r=s.subtractImage(l,{absolute:!0})}return r}function order4Points(n){let t=0,e=0,r=0,o=0,s=n[0][0],l=0;for(let y=1;y<n.length;y++)n[y][0]<s&&(s=n[y][0],l=y);let a=n[(l+1)%n.length][0],h=(l+1)%n.length;for(let y=1;y<n.length;y++)n[y][0]<a&&y!==l&&(a=n[y][0],h=y);return n[h][1]<n[l][1]?(t=n[h],o=n[l],l!==(h+1)%4?(e=n[(h+1)%4],r=n[(h+2)%4]):(e=n[(h+2)%4],r=n[(h+3)%4])):(o=n[h],t=n[l],h!==(l+1)%4?(e=n[(l+1)%4],r=n[(l+2)%4]):(e=n[(l+2)%4],r=n[(l+3)%4])),[t,e,r,o]}function distance2Points(n,t){return Math.sqrt(Math.pow(n[0]-t[0],2)+Math.pow(n[1]-t[1],2))}function crossVect(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function dotVect(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function computeWidthAndHeigth(n,t,e,r,o,s){let l=Math.max(distance2Points(n,t),distance2Points(r,e)),a=Math.max(distance2Points(n,r),distance2Points(t,e)),h=0,y=0,C=Math.ceil(o/2),L=Math.ceil(s/2),Y=l/a,ze=[n[0],n[1],1],Bt=[t[0],t[1],1],Ir=[r[0],r[1],1],Wr=[e[0],e[1],1],yi=dotVect(crossVect(ze,Wr),Ir)/dotVect(crossVect(Bt,Wr),Ir),Bn=dotVect(crossVect(ze,Wr),Bt)/dotVect(crossVect(Ir,Wr),Bt),vi=[yi*Bt[0]-ze[0],yi*Bt[1]-ze[1],yi*Bt[2]-ze[2]],wo=[Bn*Ir[0]-ze[0],Bn*Ir[1]-ze[1],Bn*Ir[2]-ze[2]],ia=vi[0],gl=vi[1],ml=vi[2],il=wo[0],sl=wo[1],ol=wo[2],_l=1/(ml*ol)*(ia*il-(ia*ol+ml*il)*C+ml*ol*C*C+(gl*sl-(gl*ol+ml*sl)*L+ml*ol*L*L));_l>=0?_l=Math.sqrt(_l):_l=Math.sqrt(-_l);let rh=new Matrix$2([[_l,0,C],[0,_l,L],[0,0,1]]),wh=rh.transpose(),Fh=inverse(wh),Mh=inverse(rh),vp=Matrix$2.rowVector(vi),gp=Matrix$2.rowVector(wo),Jh=Math.sqrt(dotVect(vp.mmul(Fh).mmul(Mh).to1DArray(),vi)/dotVect(gp.mmul(Fh).mmul(Mh).to1DArray(),wo));return Jh===0||Y===0?(h=Math.ceil(l),y=Math.ceil(a)):Jh<Y?(h=Math.ceil(l),y=Math.ceil(h/Jh)):(y=Math.ceil(a),h=Math.ceil(Jh*y)),[h,y]}function projectionPoint(n,t,e,r,o,s,l,a,h,y,C,L){let[Y,ze]=[(e*n+r*t+o)/(h*n+y*t+1),(s*n+l*t+a)/(h*n+y*t+1)];return C.getValueXY(Math.floor(Y),Math.floor(ze),L)}function warpingFourPoints(n,t={}){let{calculateRatio:e=!0}=t;if(n.length!==4)throw new Error(`The array pts must have four elements, which are the four corners. Currently, pts have ${n.length} elements`);let[r,o,s,l]=n,a=[r,o,s,l],[h,y,C,L]=order4Points(a),Y,ze;e?[Y,ze]=computeWidthAndHeigth(h,y,C,L,this.width,this.height):(Y=Math.ceil(Math.max(distance2Points(h,y),distance2Points(L,C))),ze=Math.ceil(Math.max(distance2Points(h,L),distance2Points(y,C))));let Bt=Image$1.createFrom(this,{width:Y,height:ze}),[Ir,Wr]=h,[yi,Bn]=y,[vi,wo]=C,[ia,gl]=L,[ml,il]=[0,0],[sl,ol]=[0,Y-1],[_l,rh]=[ze-1,Y-1],[wh,Fh]=[ze-1,0],Mh=new Matrix$2([[ml,il,1,0,0,0,-ml*Ir,-il*Ir],[sl,ol,1,0,0,0,-sl*yi,-ol*yi],[_l,rh,1,0,0,0,-_l*vi,-il*vi],[wh,Fh,1,0,0,0,-wh*ia,-Fh*ia],[0,0,0,ml,il,1,-ml*Wr,-il*Wr],[0,0,0,sl,ol,1,-sl*Bn,-ol*Bn],[0,0,0,_l,rh,1,-_l*wo,-rh*wo],[0,0,0,wh,Fh,1,-wh*gl,-Fh*gl]]),vp=Matrix$2.columnVector([Ir,yi,vi,ia,Wr,Bn,wo,gl]),Jh=new SingularValueDecomposition(Mh).solve(vp),[Lp,Ip,$p,Xp,Cp,Gp,Rp,od]=Jh.to1DArray(),Wp=new Matrix$2(ze,Y);for(let Ld=0;Ld<this.channels;Ld++){for(let ed=0;ed<ze;ed++)for(let Gd=0;Gd<Y;Gd++)Wp.set(ed,Gd,projectionPoint(ed,Gd,Lp,Ip,$p,Xp,Cp,Gp,Rp,od,this,Ld));Bt.setMatrix(Wp,{channel:Ld})}return Bt}function crop(n={}){let{x:t=0,y:e=0,width:r=this.width-t,height:o=this.height-e}=n;if(this.checkProcessable("crop",{bitDepth:[1,8,16]}),t=Math.round(t),e=Math.round(e),r=Math.round(r),o=Math.round(o),t>this.width-1||e>this.height-1)throw new RangeError(`crop: origin (x:${t}, y:${e}) out of range (${this.width-1}; ${this.height-1})`);if(r<=0||o<=0)throw new RangeError(`crop: width and height (width:${r}; height:${o}) must be positive numbers`);if(t<0||e<0)throw new RangeError(`crop: x and y (x:${t}, y:${e}) must be positive numbers`);if(r>this.width-t||o>this.height-e)throw new RangeError(`crop: (x: ${t}, y:${e}, width:${r}, height:${o}) size is out of range`);let s=this;if(this.bitDepth===1){const l=new Image$1(r,o,{kind:"BINARY",parent:this});s=cropBinary(this,l,t,e,r,o)}else{const l=Image$1.createFrom(this,{width:r,height:o,position:[t,e]});s=cropDefault(this,l,t,e,r,o)}return s}function cropDefault(n,t,e,r,o,s){let l=o*n.channels,a=r+s,h=0,y=e*n.channels;for(let C=r;C<a;C++){let L=C*n.width*n.channels+y,Y=L+l;for(;L<Y;L++)t.data[h++]=n.data[L]}return t}function cropBinary(n,t,e,r,o,s){let l=o*n.channels,a=r+s,h=0,y=e*n.channels;for(let C=r;C<a;C++){let L=C*n.width*n.channels+y,Y=L+l;for(;L<Y;L++)n.getBit(L)&&t.setBit(h),++h}return t}function cropAlpha(n={}){this.checkProcessable("cropAlpha",{alpha:1});const{threshold:t=this.maxValue}=n;let e=findLeft(this,t,this.components);if(e===-1)throw new Error("Could not find new dimensions. Threshold may be too high.");let r=findTop(this,t,this.components,e),o=findBottom(this,t,this.components,e),s=findRight(this,t,this.components,e,r,o);return this.crop({x:e,y:r,width:s-e+1,height:o-r+1})}function findLeft(n,t,e){for(let r=0;r<n.width;r++)for(let o=0;o<n.height;o++)if(n.getValueXY(r,o,e)>=t)return r;return-1}function findTop(n,t,e,r){for(let o=0;o<n.height;o++)for(let s=r;s<n.width;s++)if(n.getValueXY(s,o,e)>=t)return o;return-1}function findBottom(n,t,e,r){for(let o=n.height-1;o>=0;o--)for(let s=r;s<n.width;s++)if(n.getValueXY(s,o,e)>=t)return o;return-1}function findRight(n,t,e,r,o,s){for(let l=n.width-1;l>=r;l--)for(let a=o;a<=s;a++)if(n.getValueXY(l,a,e)>=t)return l;return-1}function getFactor(n){if(typeof n=="string"){const t=n[n.length-1];n=parseFloat(n),t==="%"&&(n/=100)}return n}function getThreshold$1(n,t){if(!t)throw Error("getThreshold : the maxValue should be specified");if(typeof n=="string"){if(n[n.length-1]!=="%")throw Error("getThreshold : if the value is a string it must finish by %");return parseFloat(n)/100*t}else{if(typeof n=="number")return n<1?n*t:n;throw Error("getThreshold : the value is not valid")}}function factorDimensions(n,t,e){n=getFactor(n);let r=Math.round(n*t),o=Math.round(n*e);return r<=0&&(r=1),o<=0&&(o=1),{width:r,height:o}}function checkRow(n,t){if(t<0||t>=n.height)throw new RangeError(`row must be included between 0 and ${n.height-1}. Current value: ${t}`)}function checkColumn(n,t){if(t<0||t>=n.width)throw new RangeError(`column must be included between 0 and ${n.width-1}. Current value: ${t}`)}function checkChannel(n,t){if(t<0||t>=n.channels)throw new RangeError(`channel must be included between 0 and ${n.channels-1}. Current value: ${t}`)}const validInterpolations={nearestneighbor:"nearestNeighbor",nearestneighbour:"nearestNeighbor",bilinear:"bilinear"};function checkInterpolation(n){if(typeof n!="string")throw new TypeError("interpolation must be a string");if(n=n.toLowerCase(),!validInterpolations[n])throw new RangeError(`invalid interpolation algorithm: ${n}`);return validInterpolations[n]}function nearestNeighbor(n,t,e){const r=this.width/t,o=this.height/e;if(this.bitDepth>1)for(let s=0;s<t;s++){const l=Math.floor((s+.5)*r);for(let a=0;a<e;a++){const h=Math.floor((a+.5)*o);for(let y=0;y<this.channels;y++)n.setValueXY(s,a,y,this.getValueXY(l,h,y))}}else for(let s=0;s<t;s++){const l=Math.floor((s+.5)*r);for(let a=0;a<e;a++){const h=Math.floor((a+.5)*o);this.getBitXY(l,h)&&n.setBitXY(s,a)}}}function resize(n={}){const{factor:t=1,interpolation:e=validInterpolations.nearestneighbor,preserveAspectRatio:r=!0}=n,o=checkInterpolation(e);let s=n.width,l=n.height;if(s||(l&&r?s=Math.round(l*(this.width/this.height)):s=this.width),l||(r?l=Math.round(s*(this.height/this.width)):l=this.height),{width:s,height:l}=factorDimensions(t,s,l),s===this.width&&l===this.height){const C=this.clone();return C.position=[0,0],C}let a=Math.round((this.width-s)/2),h=Math.round((this.height-l)/2);const y=Image$1.createFrom(this,{width:s,height:l,position:[a,h]});switch(o){case validInterpolations.nearestneighbor:nearestNeighbor.call(this,y,s,l);break;default:throw new Error(`unsupported resize interpolation: ${o}`)}return y}function hsv(){this.checkProcessable("hsv",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let n=Image$1.createFrom(this,{colorModel:HSV}),t=0,e=this.data;for(let r=0;r<e.length;r+=this.channels){let o=e[r],s=e[r+1],l=e[r+2],a=Math.min(o,s,l),h=Math.max(o,s,l),y=h-a,C=0,L=h===0?0:y/h,Y=h;if(h!==a){switch(h){case o:C=(s-l)/y+(s<l?6:0);break;case s:C=(l-o)/y+2;break;case l:C=(o-s)/y+4;break;default:throw new Error("unreachable")}C/=6}n.data[t++]=C*this.maxValue,n.data[t++]=L*this.maxValue,n.data[t++]=Y,this.alpha&&(n.data[t++]=e[r+3])}return n}function hsl$1(){this.checkProcessable("hsl",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let n=Image$1.createFrom(this,{colorModel:HSL}),t=Math.floor(this.maxValue/2),e=0,r=this.data;for(let o=0;o<r.length;o+=this.channels){let s=r[o],l=r[o+1],a=r[o+2],h=Math.max(s,l,a),y=Math.min(s,l,a),C=0,L=0,Y=(h+y)/2;if(h!==y){let ze=h-y;switch(L=Y>t?ze/(2-h-y):ze/(h+y),h){case s:C=(l-a)/ze+(l<a?6:0);break;case l:C=(a-s)/ze+2;break;case a:C=(s-l)/ze+4;break;default:throw new Error("unreachable")}C/=6}n.data[e++]=C*this.maxValue,n.data[e++]=L*this.maxValue,n.data[e++]=Y,this.alpha&&(n.data[e++]=r[o+3])}return n}function cmyk(){this.checkProcessable("cmyk",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let n=Image$1.createFrom(this,{components:4,colorModel:CMYK$1}),t=0,e=this.data;for(let r=0;r<e.length;r+=this.channels){let o=e[r],s=e[r+1],l=e[r+2],a=Math.min(this.maxValue-o,this.maxValue-s,this.maxValue-l),h=(this.maxValue-o-a)/(1-a/this.maxValue),y=(this.maxValue-s-a)/(1-a/this.maxValue),C=(this.maxValue-l-a)/(1-a/this.maxValue);n.data[t++]=Math.round(h),n.data[t++]=Math.round(y),n.data[t++]=Math.round(C),n.data[t++]=Math.round(a),this.alpha&&(n.data[t++]=e[r+3])}return n}function rgba8(){return new Image$1(this.width,this.height,this.getRGBAData(),{kind:"RGBA",parent:this})}const methods$1={luma709(n,t,e){return n*6966+t*23436+e*2366>>15},luma601(n,t,e){return n*9798+t*19235+e*3735>>15},maximum(n,t,e){return Math.max(n,t,e)},minimum(n,t,e){return Math.min(n,t,e)},average(n,t,e){return(n+t+e)/3>>0},minmax(n,t,e){return(Math.max(n,t,e)+Math.min(n,t,e))/2},red(n){return n},green(n,t){return t},blue(n,t,e){return e},cyan(n,t,e,r){let o=methods$1.black(n,t,e,r);return(r.maxValue-n-o)/(1-o/r.maxValue)>>0},magenta(n,t,e,r){let o=methods$1.black(n,t,e,r);return(r.maxValue-t-o)/(1-o/r.maxValue)>>0},yellow(n,t,e,r){let o=methods$1.black(n,t,e,r);return(r.maxValue-e-o)/(1-o/r.maxValue)>>0},black(n,t,e,r){return Math.min(r.maxValue-n,r.maxValue-t,r.maxValue-e)},hue(n,t,e,r){let o=methods$1.min(n,t,e),s=methods$1.max(n,t,e);if(s===o)return 0;let l=0,a=s-o;switch(s){case n:l=(t-e)/a+(t<e?6:0);break;case t:l=(e-n)/a+2;break;case e:l=(n-t)/a+4;break;default:throw new Error("unreachable")}return l/6*r.maxValue>>0},saturation(n,t,e,r){let o=methods$1.min(n,t,e),s=methods$1.max(n,t,e),l=s-o;return s===0?0:l/s*r.maxValue},lightness(n,t,e){let r=methods$1.min(n,t,e);return(methods$1.max(n,t,e)+r)/2}};Object.defineProperty(methods$1,"luminosity",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"luminance",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"min",{enumerable:!1,value:methods$1.minimum});Object.defineProperty(methods$1,"max",{enumerable:!1,value:methods$1.maximum});Object.defineProperty(methods$1,"brightness",{enumerable:!1,value:methods$1.maximum});Object.keys(methods$1).forEach(n=>{});function grey(n={}){let{algorithm:t="luma709",keepAlpha:e=!1,mergeAlpha:r=!0}=n;if(typeof t!="string"&&typeof t!="function")throw new TypeError("algorithm must be a string or a function");this.checkProcessable("grey",{bitDepth:[8,16],alpha:[0,1]}),this.components===1&&(t="red"),e&=this.alpha,r&=this.alpha,e&&(r=!1);let o=getOutputImage(this,n,{components:1,alpha:e,colorModel:GREY$1}),s;if(typeof t=="function")s=t;else if(s=methods$1[t.toLowerCase()],!s)throw new Error(`unsupported grey algorithm: ${t}`);let l=0;for(let a=0;a<this.data.length;a+=this.channels)r?o.data[l++]=clamp(s(this.data[a],this.data[a+1],this.data[a+2],this)*this.data[a+this.components]/this.maxValue,this):(o.data[l++]=clamp(s(this.data[a],this.data[a+1],this.data[a+2],this),this),o.alpha&&(o.data[l++]=this.data[a+this.components]));return o}function huang(n){let t=0;for(let C=0;C<n.length;C++)if(n[C]!==0){t=C;break}let e=n.length-1;for(let C=n.length-1;C>=t;C--)if(n[C]!==0){e=C;break}let r=1/(e-t),o=new Array(n.length),s=0,l=0;for(let C=t;C<n.length;C++)s+=C*n[C],l+=n[C],o[C]=s/l;let a=new Array(n.length);s=l=0;for(let C=e;C>0;C--)s+=C*n[C],l+=n[C],a[C-1]=s/l;let h=-1,y=Number.MAX_VALUE;for(let C=0;C<n.length;C++){let L=0,Y;for(let ze=0;ze<=C;ze++)Y=1/(1+r*Math.abs(ze-o[C])),Y<1e-6||Y>.999999||(L+=n[ze]*(-Y*Math.log(Y)-(1-Y)*Math.log(1-Y)));for(let ze=C+1;ze<n.length;ze++)Y=1/(1+r*Math.abs(ze-a[C])),Y<1e-6||Y>.999999||(L+=n[ze]*(-Y*Math.log(Y)-(1-Y)*Math.log(1-Y)));L<y&&(y=L,h=C)}return h}function intermodes(n){let t=n.slice(),e=0;for(;!bimodalTest$1(t);){let o=0,s=0,l=t[0];for(let a=0;a<n.length-1;a++)o=s,s=l,l=t[a+1],t[a]=(o+s+l)/3;if(t[n.length-1]=(s+l)/3,e++,e>1e4)throw new Error("Intermodes Threshold not found after 10000 iterations")}let r=0;for(let o=1;o<n.length-1;o++)t[o-1]<t[o]&&t[o+1]<t[o]&&(r+=o);return Math.floor(r/2)}function bimodalTest$1(n){let t=!1,e=0;for(let r=1;r<n.length-1;r++)if(n[r-1]<n[r]&&n[r+1]<n[r]&&(e++,e>2))return!1;return e===2&&(t=!0),t}function isodata(n){let t,e,r,o,s=0;for(let l=1;l<n.length;l++)if(n[l]>0){s=l+1;break}for(;;){t=0,r=0;for(let l=0;l<s;l++)r=r+n[l],t=t+n[l]*l;o=0,e=0;for(let l=s+1;l<n.length;l++)e+=n[l],o+=n[l]*l;if(r>0&&e>0&&(t/=r,o/=e,s===Math.round((t+o)/2)))break;if(s++,s>n.length-2)throw new Error("Threshold not found")}return s}function li(n,t){let e,r,o,s,l,a,h,y,C,L,Y,ze;Y=.5,L=0;for(let Bt=0;Bt<n.length;Bt++)L+=Bt*n[Bt];L/=t,h=L;do{a=h,e=a+.5|0,r=0,s=0;for(let Bt=0;Bt<=e;Bt++)r+=Bt*n[Bt],s+=n[Bt];y=s===0?0:r/s,o=0,l=0;for(let Bt=e+1;Bt<n.length;Bt++)o+=Bt*n[Bt],l+=n[Bt];C=l===0?0:o/l,ze=(y-C)/(Math.log(y)-Math.log(C)),ze<-Number.EPSILON?h=ze-.5|0:h=ze+.5|0}while(Math.abs(h-a)>Y);return e}function maxEntropy(n,t){let e=new Array(n.length);for(let Y=0;Y<n.length;Y++)e[Y]=n[Y]/t;let r=new Array(n.length),o=new Array(n.length);r[0]=e[0],o[0]=1-r[0];for(let Y=1;Y<n.length;Y++)r[Y]=r[Y-1]+e[Y],o[Y]=1-r[Y];let s=0;for(let Y=0;Y<n.length;Y++)if(Math.abs(r[Y])>=Number.EPSILON){s=Y;break}let l=n.length-1;for(let Y=n.length-1;Y>=s;Y--)if(Math.abs(o[Y])>=Number.EPSILON){l=Y;break}let a=-1,h,y=Number.MIN_VALUE,C,L;for(let Y=s;Y<=l;Y++){C=0;for(let ze=0;ze<=Y;ze++)n[ze]!==0&&(C-=e[ze]/r[Y]*Math.log(e[ze]/r[Y]));L=0;for(let ze=Y+1;ze<n.length;ze++)n[ze]!==0&&(L-=e[ze]/o[Y]*Math.log(e[ze]/o[Y]));h=C+L,y<h&&(y=h,a=Y)}return a}function mean$1(n,t){let e=0;for(let r=0;r<n.length;r++)e+=r*n[r];return Math.floor(e/t)}function minError(n,t){let e,r=-2,o,s,l,a,h,y,C,L,Y,ze,Bt,Ir=0;for(let Wr=0;Wr<n.length;Wr++)Ir+=Wr*n[Wr];for(Ir/=t,e=Ir;e!==r;){let Wr=sumA(n,e),yi=sumA(n,n.length-1),Bn=sumB(n,e),vi=sumB(n,n.length-1),wo=sumC(n,e),ia=sumC(n,n.length-1);if(o=Bn/Wr,s=(vi-Bn)/(yi-Wr),l=Wr/yi,a=(yi-Wr)/yi,h=wo/Wr-o*o,y=(ia-wo)/(yi-Wr)-s*s,C=1/h-1/y,L=o/h-s/y,Y=o*o/h-s*s/y+Math.log10(h*(a*a)/(y*(l*l))),ze=L*L-C*Y,ze<0)return e;r=e,Bt=(L+Math.sqrt(ze))/C,isNaN(Bt)?e=r:e=Math.floor(Bt)}return e}function sumA(n,t){let e=0;for(let r=0;r<=t;r++)e+=n[r];return e}function sumB(n,t){let e=0;for(let r=0;r<=t;r++)e+=r*n[r];return e}function sumC(n,t){let e=0;for(let r=0;r<=t;r++)e+=r*r*n[r];return e}function minimum(n){if(n.length<2)return 0;let t=0,e=-1,r=-1,o=new Array(n.length);for(let s=0;s<n.length;s++)o[s]=n[s],n[s]>0&&(r=s);for(;!bimodalTest(o);)if(o=smoothed(o),t++,t>1e4)return e;return e=minimumBetweenPeeks(o,r),e}function smoothed(n){let t=new Array(n.length);for(let e=1;e<n.length-1;e++)t[e]=(n[e-1]+n[e]+n[e+1])/3;return t[0]=(n[0]+n[1])/3,t[n.length-1]=(n[n.length-2]+n[n.length-1])/3,t}function minimumBetweenPeeks(n,t){let e;for(let r=1;r<t;r++)if(n[r-1]>n[r]&&n[r+1]>=n[r]){e=r;break}return e}function bimodalTest(n){let t=n.length,e=!1,r=0;for(let o=1;o<t-1;o++)if(n[o-1]<n[o]&&n[o+1]<n[o]&&(r++,r>2))return!1;return r===2&&(e=!0),e}function moments(n,t){let e=1,r=0,o=0,s=0,l=0,a,h,y,C,L,Y,ze=-1,Bt=n.length,Ir=new Array(Bt);for(let Wr=0;Wr<Bt;Wr++)Ir[Wr]=n[Wr]/t;for(let Wr=0;Wr<Bt;Wr++)r+=Wr*Ir[Wr],o+=Wr*Wr*Ir[Wr],s+=Wr*Wr*Wr*Ir[Wr];h=e*o-r*r,y=(-o*o+r*s)/h,C=(e*-s+o*r)/h,L=.5*(-C-Math.sqrt(C*C-4*y)),Y=.5*(-C+Math.sqrt(C*C-4*y)),a=(Y-r)/(Y-L);for(let Wr=0;Wr<Bt;Wr++)if(l+=Ir[Wr],l>a){ze=Wr;break}return ze}function otsu(n,t){let e=0,r=0,o=0,s=0,l=0;for(let a=0;a<n.length;a++)l+=a*n[a];for(let a=0;a<n.length;a++){r=r+n[a];const h=t-r;if(r===0||h===0)continue;e=e+a*n[a];const y=(l-e)/h,C=r*h*(e/r-y)*(e/r-y);C>=o&&(s=a,o=C)}return s}function percentile(n){let t=-1,e=.5,r=new Array(n.length),o=partialSum(n,n.length-1),s=1;for(let l=0;l<n.length;l++)r[l]=Math.abs(partialSum(n,l)/o-e),r[l]<s&&(s=r[l],t=l);return t}function partialSum(n,t){let e=0;for(let r=0;r<=t;r++)e+=n[r];return e}function renyiEntropy(n,t){let e,r,o,s=new Array(n.length),l=new Array(n.length),a=new Array(n.length),h=0,y=0,C=0,L=0,Y=0,ze=0,Ir=1/(1-.5),yi=1/(1-2);for(let ia=0;ia<n.length;ia++)s[ia]=n[ia]/t;l[0]=s[0],a[0]=1-l[0];for(let ia=1;ia<n.length;ia++)l[ia]=l[ia-1]+s[ia],a[ia]=1-l[ia];r=0;for(let ia=0;ia<n.length;ia++)if(Math.abs(l[ia])>=Number.EPSILON){r=ia;break}o=n.length-1;for(let ia=n.length-1;ia>=r;ia--)if(Math.abs(a[ia])>=Number.EPSILON){o=ia;break}for(let ia=r;ia<=o;ia++){let gl=0,ml=0,il=0;for(let Mh=0;Mh<=ia;Mh++)n[Mh]!==0&&(gl-=s[Mh]/l[ia]*Math.log(s[Mh]/l[ia])),ml+=Math.sqrt(s[Mh]/l[ia]),il+=s[Mh]*s[Mh]/(l[ia]*l[ia]);let sl=0,ol=0,_l=0;for(let Mh=ia+1;Mh<n.length;Mh++)n[Mh]!==0&&(sl-=s[Mh]/a[ia]*Math.log(s[Mh]/a[ia])),ol+=Math.sqrt(s[Mh]/a[ia]),_l+=s[Mh]*s[Mh]/(a[ia]*a[ia]);let rh=gl+sl,wh=Ir*(ml*ol>0?Math.log(ml*ol):0),Fh=yi*(il*_l>0?Math.log(il*_l):0);rh>L&&(L=rh,h=ia),wh>Y&&(Y=wh,y=ia),Fh>ze&&(ze=Fh,C=ia)}let Bn=[h,y,C];Bn.sort((ia,gl)=>ia-gl);let vi;Math.abs(Bn[0]-Bn[1])<=5?Math.abs(Bn[1]-Bn[2])<=5?vi=[1,2,1]:vi=[0,1,3]:Math.abs(Bn[1]-Bn[2])<=5?vi=[3,1,0]:vi=[1,2,1];let wo=l[Bn[2]]-l[Bn[0]];return e=Math.round(Bn[0]*(l[Bn[0]]+.25*wo*vi[0])+.25*Bn[1]*wo*vi[1]+Bn[2]*(a[Bn[2]]+.25*wo*vi[2])),e}function shanbhag(n,t){let e=new Array(n.length);for(let ze=0;ze<n.length;ze++)e[ze]=n[ze]/t;let r=new Array(n.length),o=new Array(n.length);r[0]=e[0],o[0]=1-r[0];for(let ze=1;ze<n.length;ze++)r[ze]=r[ze-1]+e[ze],o[ze]=1-r[ze];let s=0;for(let ze=0;ze<n.length;ze++)if(Math.abs(r[ze])>=Number.EPSILON){s=ze;break}let l=n.length-1;for(let ze=n.length-1;ze>=s;ze--)if(Math.abs(o[ze])>=Number.EPSILON){l=ze;break}let a=-1,h=Number.MAX_VALUE,y,C,L,Y;for(let ze=s;ze<=l;ze++){L=0,y=.5/r[ze];for(let Bt=1;Bt<=ze;Bt++)L-=e[Bt]*Math.log(1-y*r[Bt-1]);L*=y,Y=0,y=.5/o[ze];for(let Bt=ze+1;Bt<n.length;Bt++)Y-=e[Bt]*Math.log(1-y*o[Bt]);Y*=y,C=Math.abs(L-Y),C<h&&(h=C,a=ze)}return a}function triangle$1(n){let t=0,e=0,r=0,o=0;for(let L=0;L<n.length;L++)if(n[L]>0){t=L;break}t>0&&t--;for(let L=n.length-1;L>0;L--)if(n[L]>0){o=L;break}o<n.length-1&&o++;for(let L=0;L<n.length;L++)n[L]>e&&(r=L,e=n[L]);let s=!1;if(r-t<o-r){s=!0;let L=0,Y=n.length-1;for(;L<Y;){let ze=n[L];n[L]=n[Y],n[Y]=ze,L++,Y--}t=n.length-1-o,r=n.length-1-r}if(t===r)return t;let l,a,h;l=n[r],a=t-r,h=Math.sqrt(l*l+a*a),l/=h,a/=h,h=l*t+a*n[t];let y=t,C=0;for(let L=t+1;L<=r;L++){let Y=l*L+a*n[L]-h;Y>C&&(y=L,C=Y)}if(y--,s){let L=0,Y=n.length-1;for(;L<Y;){let ze=n[L];n[L]=n[Y],n[Y]=ze,L++,Y--}return n.length-1-y}else return y}function yen(n,t){let e=new Array(n.length);for(let y=0;y<n.length;y++)e[y]=n[y]/t;let r=new Array(n.length);r[0]=e[0];for(let y=1;y<n.length;y++)r[y]=r[y-1]+e[y];let o=new Array(n.length);o[0]=e[0]*e[0];for(let y=1;y<n.length;y++)o[y]=o[y-1]+e[y]*e[y];let s=new Array(n.length);s[n.length-1]=0;for(let y=n.length-2;y>=0;y--)s[y]=s[y+1]+e[y+1]*e[y+1];let l=-1,a=Number.MIN_VALUE,h;for(let y=0;y<n.length;y++)h=-1*(o[y]*s[y]>0?Math.log(o[y]*s[y]):0)+2*(r[y]*(1-r[y])>0?Math.log(r[y]*(1-r[y])):0),h>a&&(a=h,l=y);return l}const methods={huang,intermodes,isodata,li,maxentropy:maxEntropy,mean:mean$1,minerror:minError,minimum,moments,otsu,percentile,renyientropy:renyiEntropy,shanbhag,triangle:triangle$1,yen},names={};Object.keys(methods).forEach(n=>{names[n]=n});function getThreshold(n={}){let{algorithm:t=names.otsu}=n;this.checkProcessable("getThreshold",{components:1,bitDepth:[8,16]});let e=methods[t.toLowerCase()];if(e){let r=this.getHistogram();return e(r,this.size)}else throw new Error(`unknown thresholding algorithm: ${t}`)}const THRESHOLD="threshold";function mask(n={}){let{algorithm:t=THRESHOLD,threshold:e=.5,useAlpha:r=!0,invert:o=!1}=n;this.checkProcessable("mask",{components:1,bitDepth:[8,16]}),t===THRESHOLD?e=getThreshold$1(e,this.maxValue):e=getThreshold.call(this,n);let s=new Image$1(this.width,this.height,{kind:"BINARY",parent:this}),l=0;if(this.alpha&&r)for(let a=0;a<this.data.length;a+=this.channels){let h=this.data[a]+(this.maxValue-this.data[a])*(this.maxValue-this.data[a+1])/this.maxValue;(o&&h<=e||!o&&h>=e)&&s.setBit(l),l++}else for(let a=0;a<this.data.length;a+=this.channels)(o&&this.data[a]<=e||!o&&this.data[a]>=e)&&s.setBit(l),l++;return s}function copyImage(n,t,e,r){let o=n.width,s=n.height,l=t.width,a=n.channels;for(let h=0;h<o;h++)for(let y=0;y<s;y++)for(let C=0;C<a;C++){let L=(y*o+h)*a+C,Y=((r+y)*l+e+h)*a+C;t.data[Y]=n.data[L]}}function pad(n={}){let{size:t=0,algorithm:e="copy",color:r}=n;if(this.checkProcessable("pad",{bitDepth:[8,16]}),e==="set"){if(r.length!==this.channels)throw new Error(`pad: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let h=0;h<r.length;h++)r[h]===0&&(r[h]=.001)}else r=newArray$1(this.channels,null);Array.isArray(t)||(t=[t,t]);let o=this.width+t[0]*2,s=this.height+t[1]*2,l=this.channels,a=Image$1.createFrom(this,{width:o,height:s});copyImage(this,a,t[0],t[1]);for(let h=t[0];h<o-t[0];h++)for(let y=0;y<l;y++){let C=r[y]||a.data[(t[1]*o+h)*l+y];for(let L=0;L<t[1];L++)a.data[(L*o+h)*l+y]=C;C=r[y]||a.data[((s-t[1]-1)*o+h)*l+y];for(let L=s-t[1];L<s;L++)a.data[(L*o+h)*l+y]=C}for(let h=0;h<s;h++)for(let y=0;y<l;y++){let C=r[y]||a.data[(h*o+t[0])*l+y];for(let L=0;L<t[0];L++)a.data[(h*o+L)*l+y]=C;C=r[y]||a.data[(h*o+o-t[0]-1)*l+y];for(let L=o-t[0];L<o;L++)a.data[(h*o+L)*l+y]=C}return a}function colorDepth(n=8){if(this.checkProcessable("colorDepth",{bitDepth:[1,8,16]}),![8,16].includes(n))throw Error("You need to specify the new colorDepth as 8 or 16");if(this.bitDepth===n)return this.clone();let t=Image$1.createFrom(this,{bitDepth:n});switch(n){case 8:if(this.bitDepth===1)for(let e=0;e<this.size;e++)this.getBit(e)&&(t.data[e]=255);else for(let e=0;e<this.data.length;e++)t.data[e]=this.data[e]>>8;break;case 16:if(this.bitDepth===1)for(let e=0;e<this.size;e++)this.getBit(e)&&(t.data[e]=65535);else for(let e=0;e<this.data.length;e++)t.data[e]=this.data[e]<<8|this.data[e];break;default:throw new Error("colorDepth conversion unexpected case")}return t}function rotateFree(n,t={}){const{interpolation:e=validInterpolations.nearestneighbor,width:r=this.width,height:o=this.height}=t;if(typeof n!="number")throw new TypeError("degrees must be a number");const s=checkInterpolation(e),l=n*Math.PI/180,a=Math.floor(Math.abs(r*Math.cos(l))+Math.abs(o*Math.sin(l))),h=Math.floor(Math.abs(o*Math.cos(l))+Math.abs(r*Math.sin(l))),y=Math.cos(-l),C=Math.sin(-l);let L=a/2,Y=h/2;a%2===0?(L=L-.5,h%2===0?Y=Y-.5:Y=Math.floor(Y)):(L=Math.floor(L),h%2===0?Y=Y-.5:Y=Math.floor(Y));const ze=Math.floor(r/2-L),Bt=Math.floor(o/2-Y);if(this.bitDepth===1){const Ir=new Image$1(a,h,{kind:"BINARY",parent:this});switch(s){case validInterpolations.nearestneighbor:return rotateBinaryNearestNeighbor(this,Ir,ze,Bt,L,Y,y,C);case validInterpolations.bilinear:return rotateBinaryBilinear(this,Ir,ze,Bt,L,Y,y,C);default:throw new Error(`unsupported rotate interpolation: ${s}`)}}else{const Ir=Image$1.createFrom(this,{width:a,height:h});switch(s){case validInterpolations.nearestneighbor:return rotateNearestNeighbor(this,Ir,ze,Bt,L,Y,y,C);case validInterpolations.bilinear:return rotateBilinear(this,Ir,ze,Bt,L,Y,y,C);default:throw new Error(`unsupported rotate interpolation: ${s}`)}}}function rotateNearestNeighbor(n,t,e,r,o,s,l,a){for(let h=0;h<t.width;h+=1)for(let y=0;y<t.height;y+=1)for(let C=0;C<n.channels;C++){let L=Math.round((h-o)*l-(y-s)*a+o)+e,Y=Math.round((y-s)*l+(h-o)*a+s)+r;L<0||L>=n.width||Y<0||Y>=n.height?n.alpha===1&&C===n.channels-1?t.setValueXY(h,y,C,0):t.setValueXY(h,y,C,n.maxValue):t.setValueXY(h,y,C,n.getValueXY(L,Y,C))}return t}function rotateBinaryNearestNeighbor(n,t,e,r,o,s,l,a){for(let h=0;h<t.width;h+=1)for(let y=0;y<t.height;y+=1){let C=Math.round((h-o)*l-(y-s)*a+o)+e,L=Math.round((y-s)*l+(h-o)*a+s)+r;(C<0||C>=n.width||L<0||L>=n.height||n.getBitXY(C,L))&&t.setBitXY(h,y)}return t}function rotateBilinear(n,t,e,r,o,s,l,a){let h=n.width*n.channels;for(let y=0;y<t.height;y++)for(let C=0;C<t.width;C++){let L=(C-o)*l-(y-s)*a+o+e,Y=(y-s)*l+(C-o)*a+s+r,ze=L|0,Bt=Y|0,Ir=L-ze,Wr=Y-Bt;for(let yi=0;yi<n.channels;yi++)if(L<0||L>=n.width||Y<0||Y>=n.height)n.alpha===1&&yi===n.channels-1?t.setValueXY(C,y,yi,0):t.setValueXY(C,y,yi,n.maxValue);else{let Bn=(Bt*n.width+ze)*n.channels+yi,vi=n.data[Bn],wo=n.data[Bn+n.channels],ia=n.data[Bn+h],gl=n.data[Bn+h+n.channels],ml=vi+Ir*(wo-vi)+Wr*(ia-vi)+Ir*Wr*(vi-wo-ia+gl)|0;t.setValueXY(C,y,yi,ml)}}return t}function rotateBinaryBilinear(n,t,e,r,o,s,l,a){let h=n.width;for(let y=0;y<t.height;y++)for(let C=0;C<t.width;C++){let L=(C-o)*l-(y-s)*a+o+e,Y=(y-s)*l+(C-o)*a+s+r,ze=L|0,Bt=Y|0,Ir=L-ze,Wr=Y-Bt;if(L<0||L>=n.width||Y<0||Y>=n.height)t.setBitXY(C,y);else{let yi=Bt*n.width+ze,Bn=n.getBit(yi),vi=n.getBit(yi+1),wo=n.getBit(yi+h),ia=n.getBit(yi+1+h);(Bn|Ir&vi-Bn|Wr&wo-Bn|Ir&Wr&Bn-vi-wo+ia)>0&&t.setBitXY(C,y)}}return t}function rotate$1(n,t){if(this.checkProcessable("rotate",{bitDepth:[1,8,16]}),typeof n!="number")throw new TypeError("angle must be a number");switch(n<0&&(n=Math.ceil(-n/360)*360+n),n%360){case 0:return this.clone();case 90:return rotateRight.call(this);case 180:return rotate180.call(this);case 270:return rotateLeft.call(this);default:return rotateFree.call(this,n,t)}}function rotateLeft(){if(this.bitDepth===1){const n=new Image$1(this.height,this.width,{kind:"BINARY",parent:this}),t=n.height-1;for(let e=0;e<this.height;e++)for(let r=0;r<this.width;r++)this.getBitXY(r,e)&&n.setBitXY(e,t-r);return n}else{const n=Image$1.createFrom(this,{width:this.height,height:this.width}),t=n.height-1;for(let e=0;e<this.height;e++)for(let r=0;r<this.width;r++)for(let o=0;o<this.channels;o++)n.setValueXY(e,t-r,o,this.getValueXY(r,e,o));return n}}function rotateRight(){if(this.bitDepth===1){const n=new Image$1(this.height,this.width,{kind:"BINARY",parent:this}),t=n.width-1;for(let e=0;e<this.height;e++)for(let r=0;r<this.width;r++)this.getBitXY(r,e)&&n.setBitXY(t-e,r);return n}else{const n=Image$1.createFrom(this,{width:this.height,height:this.width}),t=n.width-1;for(let e=0;e<this.height;e++)for(let r=0;r<this.width;r++)for(let o=0;o<this.channels;o++)n.setValueXY(t-e,r,o,this.getValueXY(r,e,o));return n}}function rotate180(){if(this.bitDepth===1){const n=new Image$1(this.width,this.height,{kind:"BINARY",parent:this}),t=n.width-1,e=n.height-1;for(let r=0;r<this.height;r++)for(let o=0;o<this.width;o++)this.getBitXY(o,r)&&n.setBitXY(t-o,e-r);return n}else{const n=Image$1.createFrom(this),t=n.width-1,e=n.height-1;for(let r=0;r<this.height;r++)for(let o=0;o<this.width;o++)for(let s=0;s<this.channels;s++)n.setValueXY(t-o,e-r,s,this.getValueXY(o,r,s));return n}}function insert(n,t={}){const e=getImageParameters(n);this.checkProcessable("insert",e);let{x:r=0,y:o=0}=t;const s=getOutputImageOrInPlace(this,t,{copy:!0}),l=Math.min(s.height,o+n.height),a=Math.min(s.width,r+n.width);if(s.bitDepth===1)for(let h=o;h<l;h++)for(let y=r;y<a;y++)n.getBitXY(y-r,h-o)?s.setBitXY(y,h):s.clearBitXY(y,h);else for(let h=o;h<l;h++)for(let y=r;y<a;y++)s.setPixelXY(y,h,n.getPixelXY(y-r,h-o));return s}function setBorder(n={}){let{size:t=0,algorithm:e="copy",color:r}=n;if(this.checkProcessable("setBorder",{bitDepth:[8,16,32,64]}),e==="set"){if(r.length!==this.channels)throw new Error(`setBorder: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let a=0;a<r.length;a++)r[a]===0&&(r[a]=.001)}else r=newArray$1(this.channels,null);Array.isArray(t)||(t=[t,t]);let o=t[0],s=t[1],l=this.channels;for(let a=o;a<this.width-o;a++)for(let h=0;h<l;h++){let y=r[h]||this.data[(a+this.width*s)*l+h];for(let C=0;C<s;C++)this.data[(C*this.width+a)*l+h]=y;y=r[h]||this.data[(a+this.width*(this.height-s-1))*l+h];for(let C=this.height-s;C<this.height;C++)this.data[(C*this.width+a)*l+h]=y}for(let a=0;a<this.height;a++)for(let h=0;h<l;h++){let y=r[h]||this.data[(a*this.width+o)*l+h];for(let C=0;C<o;C++)this.data[(a*this.width+C)*l+h]=y;y=r[h]||this.data[(a*this.width+this.width-o-1)*l+h];for(let C=this.width-o;C<this.width;C++)this.data[(a*this.width+C)*l+h]=y}return this}function split(n={}){let{preserveAlpha:t=!0}=n;if(this.checkProcessable("split",{bitDepth:[8,16]}),this.components===1)return new Stack([this.clone()]);let e=new Stack,r=this.data;if(this.alpha&&t)for(let o=0;o<this.components;o++){let s=Image$1.createFrom(this,{components:1,alpha:!0,colorModel:GREY$1}),l=0;for(let a=0;a<r.length;a+=this.channels)s.data[l++]=r[a+o],s.data[l++]=r[a+this.components];e.push(s)}else for(let o=0;o<this.channels;o++){let s=Image$1.createFrom(this,{components:1,alpha:!1,colorModel:GREY$1}),l=0;for(let a=0;a<r.length;a+=this.channels)s.data[l++]=r[a+o];e.push(s)}return e}function getChannel(n,t={}){let{keepAlpha:e=!1,mergeAlpha:r=!1}=t;e&=this.alpha,r&=this.alpha,this.checkProcessable("getChannel",{bitDepth:[8,16]}),n=validateChannel(this,n);let o=Image$1.createFrom(this,{components:1,alpha:e,colorModel:GREY$1}),s=0;for(let l=0;l<this.data.length;l+=this.channels)r?o.data[s++]=this.data[l+n]*this.data[l+this.components]/this.maxValue:(o.data[s++]=this.data[l+n],e&&(o.data[s++]=this.data[l+this.components]));return o}function combineChannels(n=defaultCombineMethod,t={}){let{mergeAlpha:e=!1,keepAlpha:r=!1}=t;e&=this.alpha,r&=this.alpha,this.checkProcessable("combineChannels",{bitDepth:[8,16]});let o=Image$1.createFrom(this,{components:1,alpha:r,colorModel:GREY$1}),s=0;for(let l=0;l<this.size;l++){let a=n(this.getPixel(l));e?o.data[s++]=a*this.data[l*this.channels+this.components]/this.maxValue:(o.data[s++]=a,r&&(o.data[s++]=this.data[l*this.channels+this.components]))}return o}function defaultCombineMethod(n){return(n[0]+n[1]+n[2])/3}function setChannel(n,t){if(this.checkProcessable("setChannel",{bitDepth:[8,16]}),t.checkProcessable("setChannel (image parameter check)",{bitDepth:[this.bitDepth],alpha:[0],components:[1]}),t.width!==this.width||t.height!==this.height)throw new Error("Images must have exactly the same width and height");n=validateChannel(this,n);let e=n;for(let r=0;r<t.data.length;r++)this.data[e]=t.data[r],e+=this.channels;return this}function getSimilarity(n,t={}){let{shift:e=[0,0],average:r,channels:o,defaultAlpha:s,normalize:l,border:a=[0,0]}=t;if(this.checkProcessable("getSimilarity",{bitDepth:[8,16]}),Array.isArray(a)||(a=[a,a]),o=validateArrayOfChannels(this,{channels:o,defaultAlpha:s}),this.bitDepth!==n.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==n.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==n.colorModel)throw new Error("Both images must have the same colorModel");typeof r>"u"&&(r=!0);let h=Math.max(a[0],-e[0]),y=Math.min(this.width-a[0],this.width-e[0]),C=Math.max(a[1],-e[1]),L=Math.min(this.height-a[1],this.height-e[1]),Y=newArray$1(o.length,0);for(let ze=0;ze<o.length;ze++){let Bt=o[ze],Ir=l?this.sum[Bt]:Math.max(this.sum[Bt],n.sum[Bt]),Wr=l?n.sum[Bt]:Math.max(this.sum[Bt],n.sum[Bt]);if(Ir!==0&&Wr!==0)for(let yi=h;yi<y;yi++)for(let Bn=C;Bn<L;Bn++){let vi=yi*this.multiplierX+Bn*this.multiplierY+Bt,wo=vi+e[0]*this.multiplierX+e[1]*this.multiplierY;Y[ze]+=Math.min(this.data[vi]/Ir,n.data[wo]/Wr)}}return r?Y.reduce((ze,Bt)=>ze+Bt)/Y.length:Y}function getPixelsGrid(n={}){let{sampling:t=[10,10],painted:e=!1,mask:r}=n;this.checkProcessable("getPixelsGrid",{bitDepth:[8,16],channels:1}),Array.isArray(t)||(t=[t,t]);const o=t[0],s=t[1],l=[],a=[],h=this.width/o,y=this.height/s;let C=Math.floor(h/2);for(let Y=0;Y<o;Y++){let ze=Math.floor(y/2);for(let Bt=0;Bt<s;Bt++){let Ir=Math.round(C),Wr=Math.round(ze);(!r||r.getBitXY(Ir,Wr))&&(l.push([Ir,Wr]),a.push(this.getPixelXY(Ir,Wr))),ze+=y}C+=h}const L={xyS:l,zS:a};return e&&(L.painted=this.rgba8().paintPoints(l)),L}function Matrix(n,t,e){const r=new Array(n);for(let o=0;o<n;o++)r[o]=new Array(t);if(e)for(let o=0;o<n;o++)for(let s=0;s<t;s++)r[o][s]=e;return r.width=n,r.height=t,Object.setPrototypeOf(r,Matrix.prototype),r}Matrix.prototype.localMin=function(n,t){let e=this[n][t],r=[n,t];for(let o=Math.max(0,n-1);o<Math.min(this.length,n+2);o++)for(let s=Math.max(0,t-1);s<Math.min(this[0].length,t+2);s++)this[o][s]<e&&(e=this[o][s],r=[o,s]);return{position:r,value:e}};Matrix.prototype.localMax=function(n,t){let e=this[n][t],r=[n,t];for(let o=Math.max(0,n-1);o<Math.min(this.length,n+2);o++)for(let s=Math.max(0,t-1);s<Math.min(this[0].length,t+2);s++)this[o][s]>e&&(e=this[o][s],r=[o,s]);return{position:r,value:e}};Matrix.prototype.localSearch=function(n,t,e){let r=[];for(let o=Math.max(0,n-1);o<Math.min(this.length,n+2);o++)for(let s=Math.max(0,t-1);s<Math.min(this[0].length,t+2);s++)this[o][s]===e&&r.push([o,s]);return r};function getBestMatch(n,t={}){let{border:e}=t;if(this.checkProcessable("getChannel",{bitDepth:[8,16]}),this.bitDepth!==n.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==n.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==n.colorModel)throw new Error("Both images must have the same colorModel");let r=new Matrix(n.width,n.height,-1/0),o=Math.floor(n.width/2),s=Math.floor(n.height/2),l=o,a=s,h=!1;for(;!h;){let y=r.localSearch(o,s,-1/0);for(let L=0;L<y.length;L++){let Y=y[L],ze=this.getSimilarity(n,{border:e,shift:[l-Y[0],a-Y[1]]});r[Y[0]][Y[1]]=ze}let C=r.localMax(o,s);C.position[0]!==o||C.position[1]!==s?(o=C.position[0],s=C.position[1]):h=!0}return[o-l,s-a]}function getRow(n,t=0){this.checkProcessable("getRow",{bitDepth:[8,16]}),checkRow(this,n),checkChannel(this,t);let e=new Array(this.width),r=0,o=n*this.width*this.channels+t,s=o+this.width*this.channels;for(let l=o;l<s;l+=this.channels)e[r++]=this.data[l];return e}function getColumn(n,t=0){this.checkProcessable("getColumn",{bitDepth:[8,16]}),checkColumn(this,n),checkChannel(this,t);let e=new Array(this.height),r=0,o=this.width*this.channels;for(let s=t+n*this.channels;s<this.data.length;s+=o)e[r++]=this.data[s];return e}function getMatrix(n={}){let{channel:t}=n;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),t===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");t=0}let e=new Matrix$2(this.height,this.width);for(let r=0;r<this.height;r++)for(let o=0;o<this.width;o++)e.set(r,o,this.getValueXY(o,r,t));return e}function setMatrix(n,t={}){n=new Matrix$2(n);let{channel:e}=t;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),e===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");e=0}if(this.width!==n.columns||this.height!==n.rows)throw new RangeError("The size of the matrix must be equal to the size of the image");for(let r=0;r<this.height;r++)for(let o=0;o<this.width;o++)this.setValueXY(o,r,e,n.get(r,o));return this}function getPixelsArray(){this.checkProcessable("getPixelsArray",{bitDepth:[8,16,32]});let n=new Array(this.size),t=0;for(let e=0;e<this.data.length;e+=this.channels){let r=new Array(this.components);for(let o=0;o<this.components;o++)r[o]=this.data[e+o];n[t++]=r}return n}function getIntersection(n){let t=this,e=t.getClosestCommonParent(n),r=t.getRelativePosition(e,{defaultFurther:!0}),o=getRelativePositionForAllPixels(t,r),s=n.getRelativePosition(e,{defaultFurther:!0}),l=getRelativePositionForAllPixels(n,s),a=getCommonSurface(o,l),h={whitePixelsMask1:[],whitePixelsMask2:[],commonWhitePixels:[]};for(let y=0;y<a.length;y++){let C=a[y],L=[C[0]-r[0],C[1]-r[1]],Y=[C[0]-s[0],C[1]-s[1]],ze=t.getBitXY(L[0],L[1]),Bt=n.getBitXY(Y[0],Y[1]);ze===1&&Bt===1&&h.commonWhitePixels.push(C)}for(let y=0;y<o.length;y++){let C,L;y!==0&&(C=Math.floor(y/t.width),L=y%t.width),t.getBitXY(C,L)===1&&h.whitePixelsMask1.push(o[y])}for(let y=0;y<l.length;y++){let C=0,L=0;y!==0&&(C=Math.floor(y/n.width),L=y%n.width),n.getBitXY(C,L)===1&&h.whitePixelsMask2.push(l[y])}return h}function getRelativePositionForAllPixels(n,t){let e=[];for(let r=0;r<n.height;r++)for(let o=0;o<n.width;o++){let s=[r,o];e.push([s[0]+t[0],s[1]+t[1]])}return e}function getCommonSurface(n,t){let e=0,r=0,o=[];for(;e<n.length&&r<t.length;)n[e][0]===t[r][0]&&n[e][1]===t[r][1]?(o.push(n[e]),e++,r++):n[e][0]<t[r][0]||n[e][0]===t[r][0]&&n[e][1]<t[r][1]?e++:r++;return o}function getClosestCommonParent(n){let t=getDepth(this),e=getDepth(n),r;if(t>=e?r=getFurthestParent(this,t):r=getFurthestParent(n,e),t===0||e===0)return r;let o=this,s=n;for(;t!==e;)if(t>e){if(o=o.parent,o===null)return r;t=t-1}else{if(s=s.parent,s===null)return r;e=e-1}for(;o!==s&&o!==null&&s!==null;)if(o=o.parent,s=s.parent,o===null||s===null)return r;return o!==s?r:o}function getDepth(n){let t=0,e=n;for(;e.parent!=null;)e=e.parent,t++;return t}function getFurthestParent(n,t){let e=n;for(;t>0;)e=e.parent,t=t-1;return e}const defaultOptions$1={lowThreshold:10,highThreshold:30,gaussianBlur:1.1},Gx=[[-1,0,1],[-2,0,2],[-1,0,1]],Gy=[[-1,-2,-1],[0,0,0],[1,2,1]],convOptions={bitDepth:32,mode:"periodic"};function cannyEdgeDetector(n,t){n.checkProcessable("Canny edge detector",{bitDepth:8,channels:1,components:1}),t=Object.assign({},defaultOptions$1,t);const e=n.width,r=n.height,o=n.maxValue,s={sigma:t.gaussianBlur,radius:3},l=n.gaussianFilter(s),a=l.convolution(Gy,convOptions),h=l.convolution(Gx,convOptions),y=h.hypotenuse(a),C=n.constructor,L=new C(e,r,{kind:"GREY",bitDepth:32}),Y=new C(e,r,{kind:"GREY",bitDepth:32}),ze=new C(e,r,{kind:"GREY"});for(var Bt=1;Bt<e-1;Bt++)for(var Ir=1;Ir<r-1;Ir++){var Wr=(Math.round(Math.atan2(h.getValueXY(Bt,Ir,0),a.getValueXY(Bt,Ir,0))*(5/Math.PI))+5)%5;Wr===0&&(y.getValueXY(Bt,Ir,0)<=y.getValueXY(Bt,Ir-1,0)||y.getValueXY(Bt,Ir,0)<=y.getValueXY(Bt,Ir+1,0))||Wr===1&&(y.getValueXY(Bt,Ir,0)<=y.getValueXY(Bt-1,Ir+1,0)||y.getValueXY(Bt,Ir,0)<=y.getValueXY(Bt+1,Ir-1,0))||Wr===2&&(y.getValueXY(Bt,Ir,0)<=y.getValueXY(Bt-1,Ir,0)||y.getValueXY(Bt,Ir,0)<=y.getValueXY(Bt+1,Ir,0))||Wr===3&&(y.getValueXY(Bt,Ir,0)<=y.getValueXY(Bt-1,Ir-1,0)||y.getValueXY(Bt,Ir,0)<=y.getValueXY(Bt+1,Ir+1,0))||L.setValueXY(Bt,Ir,0,y.getValueXY(Bt,Ir,0))}for(Bt=0;Bt<e*r;++Bt){var yi=L.data[Bt],Bn=0;yi>t.highThreshold&&(Bn++,ze.data[Bt]=o),yi>t.lowThreshold&&Bn++,Y.data[Bt]=Bn}var vi=[];for(Bt=1;Bt<e-1;++Bt)for(Ir=1;Ir<r-1;++Ir)if(Y.getValueXY(Bt,Ir,0)===1){e:for(var wo=Bt-1;wo<Bt+2;++wo)for(var ia=Ir-1;ia<Ir+2;++ia)if(Y.getValueXY(wo,ia,0)===2){vi.push([Bt,Ir]),ze.setValueXY(Bt,Ir,0,o);break e}}for(;vi.length>0;){var gl=[];for(Bt=0;Bt<vi.length;++Bt)for(Ir=-1;Ir<2;++Ir)for(wo=-1;wo<2;++wo)if(!(Ir===0&&wo===0)){var ml=vi[Bt][0]+Ir,il=vi[Bt][1]+wo;Y.getValueXY(ml,il,0)===1&&ze.getValueXY(ml,il,0)===0&&(gl.push([ml,il]),ze.setValueXY(ml,il,0,o))}vi=gl}return ze}function cannyEdge(n){return cannyEdgeDetector(this,n)}function extract(n,t={}){let{position:e}=t;if(this.checkProcessable("extract",{bitDepth:[1,8,16]}),!e&&(e=n.getRelativePosition(this),!e))throw new Error("extract : can not extract an image because the relative position can not be determined, try to specify manually the position as an array of 2 elements [x,y].");if(this.bitDepth>1){let r=Image$1.createFrom(this,{width:n.width,height:n.height,alpha:1,position:e,parent:this});for(let o=0;o<n.width;o++)for(let s=0;s<n.height;s++){for(let l=0;l<this.channels;l++){let a=this.getValueXY(o+e[0],s+e[1],l);r.setValueXY(o,s,l,a)}n.getBitXY(o,s)||r.setValueXY(o,s,this.components,0)}return r}else{let r=Image$1.createFrom(this,{width:n.width,height:n.height,position:e,parent:this});for(let o=0;o<n.height;o++)for(let s=0;s<n.width;s++)n.getBitXY(s,o)&&this.getBitXY(s+e[0],o+e[1])&&r.setBitXY(s,o);return r}}var fastList={exports:{}};(function(n,t){(function(){function e(o,s,l){this.next=l,l&&(l.prev=this),this.prev=s,s&&(s.next=this),this.data=o}function r(){if(!(this instanceof r))return new r;this._head=null,this._tail=null,this.length=0}r.prototype={push:function(o){this._tail=new e(o,this._tail,null),this._head||(this._head=this._tail),this.length++},pop:function(){if(this.length!==0){var o=this._tail;return this._tail=o.prev,o.prev&&(o.prev=this._tail.next=null),this.length--,this.length===1?this._head=this._tail:this.length===0&&(this._head=this._tail=null),o.data}},unshift:function(o){this._head=new e(o,null,this._head),this._tail||(this._tail=this._head),this.length++},shift:function(){if(this.length!==0){var o=this._head;return this._head=o.next,o.next&&(o.next=this._head.prev=null),this.length--,this.length===1?this._tail=this._head:this.length===0&&(this._head=this._tail=null),o.data}},item:function(o){o<0&&(o=this.length+o);for(var s=this._head;o-- >0&&s;)s=s.next;return s?s.data:void 0},slice:function(o,s){if(o||(o=0),s||(s=this.length),s<0&&(s=this.length+s),o<0&&(o=this.length+o),s===o)return[];if(s<o)throw new Error("invalid offset: "+o+","+s+" (length="+this.length+")");for(var l=s-o,a=new Array(l),h=0,y=this._head;o-- >0&&y;)y=y.next;for(;h<l&&y;)a[h++]=y.data,y=y.next;return a},drop:function(){r.call(this)},forEach:function(o,s){for(var l=this._head,a=0,h=this.length;a<h&&l;)o.call(s||this,l.data,a,this),l=l.next,a++},map:function(o,s){var l=new r;return this.forEach(function(a,h,y){l.push(o.call(s||y,a,h,y))}),l},filter:function(o,s){var l=new r;return this.forEach(function(a,h,y){o.call(s||y,a,h,y)&&l.push(a)}),l},reduce:function(o,s,l){var a=0,h=this._head,y=this.length;for(s||(a=1,s=h&&h.data,h=h&&h.next);a<y&&h;)s=o.call(l||this,s,h.data,this),a++,h=h.next;return s}},n.exports=r})()})(fastList);var fastListExports=fastList.exports;const LinkedList=getDefaultExportFromCjs(fastListExports);function floodFill(n={}){const{x:t=0,y:e=0,inPlace:r=!0}=n,o=r?this:Image$1.createFrom(this);if(this.checkProcessable("floodFill",{bitDepth:1}),this.getBitXY(t,e))return o;const l=new LinkedList;for(l.push(new Node$1(t,e));l.length>0;){const a=l.shift();o.setBitXY(a.x,a.y);for(let h=a.x+1;h<this.width&&(!o.getBitXY(h,a.y)&&!this.getBitXY(h,a.y));h++)o.setBitXY(h,a.y),a.y+1<this.height&&!this.getBitXY(h,a.y+1)&&l.push(new Node$1(h,a.y+1)),a.y-1>=0&&!this.getBitXY(h,a.y-1)&&l.push(new Node$1(h,a.y-1));for(let h=a.x-1;h>=0&&(!o.getBitXY(h,a.y)&&!this.getBitXY(h,a.y));h++)o.setBitXY(h,a.y),a.y+1<this.height&&!this.getBitXY(h,a.y+1)&&l.push(new Node$1(h,a.y+1)),a.y-1>=0&&!this.getBitXY(h,a.y-1)&&l.push(new Node$1(h,a.y-1))}return o}function Node$1(n,t){this.x=n,this.y=t}function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r])}return n},_extends.apply(this,arguments)}function hsv2rgb(n,t,e){t=t/100,e=e/100;var r=[],o=e*t,s=n/60,l=o*(1-Math.abs(s%2-1)),a=e-o;return s>=0&&s<1?r=[o,l,0]:s>=1&&s<2?r=[l,o,0]:s>=2&&s<3?r=[0,o,l]:n>=3&&s<4?r=[0,l,o]:n>=4&&s<5?r=[l,0,o]:n>=5&&s<=6?r=[o,0,l]:r=[0,0,0],{r:Math.round(255*(r[0]+a)),g:Math.round(255*(r[1]+a)),b:Math.round(255*(r[2]+a))}}function hsl2hsv(n,t,e){return t*=(e<50?e:100-e)/100,{h:n,s:2*t/(e+t)*100,v:e+t}}function hsl2rgb$1(n,t,e){var r=hsl2hsv(n,t,e);return hsv2rgb(r.h,r.s,r.v)}var colors={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]};function parse(n){return named(n)||hex3(n)||hex6(n)||rgb(n)||rgba$1(n)||hsl(n)||hsla(n)}function named(n){var t=colors[n.toLowerCase()];if(t)return{r:t[0],g:t[1],b:t[2],a:100}}function rgb(n){var t=n.match(/rgb\(([^)]+)\)/);if(t){var e=t[1].split(/ *, */).map(Number);return{r:e[0],g:e[1],b:e[2],a:100}}}function rgba$1(n){var t=n.match(/rgba\(([^)]+)\)/);if(t){var e=t[1].split(/ *, */).map(Number);return{r:e[0],g:e[1],b:e[2],a:e[3]*100}}}function hex6(n){if(n[0]==="#"&&n.length===7)return{r:parseInt(n.slice(1,3),16),g:parseInt(n.slice(3,5),16),b:parseInt(n.slice(5,7),16),a:100}}function hex3(n){if(n[0]==="#"&&n.length===4)return{r:parseInt(n[1]+n[1],16),g:parseInt(n[2]+n[2],16),b:parseInt(n[3]+n[3],16),a:100}}function hsl(n){var t=n.match(/hsl\(([^)]+)\)/);if(t){var e=t[1].split(/ *, */),r=parseInt(e[0],10),o=parseInt(e[1],10),s=parseInt(e[2],10),l=hsl2rgb$1(r,o,s);return _extends({},l,{a:100})}}function hsla(n){var t=n.match(/hsla\(([^)]+)\)/);if(t){var e=t[1].split(/ *, */),r=parseInt(e[0],10),o=parseInt(e[1],10),s=parseInt(e[2],10),l=parseInt(parseFloat(e[3])*100,10),a=hsl2rgb$1(r,o,s);return _extends({},a,{a:l})}}function css2array(n){let t=parse(n);return[t.r,t.g,t.b,Math.round(t.a*255/100)]}function hue2rgb(n,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?n+(t-n)*6*e:e<1/2?t:e<2/3?n+(t-n)*(2/3-e)*6:n}function hsl2rgb(n,t,e){let r,o,s,l,a,h;return t/=100,e/=100,t===0?l=a=h=e*255:(e<=.5?o=e*(t+1):o=e+t-e*t,r=e*2-o,s=n/360,l=hue2rgb(r,o,s+1/3),a=hue2rgb(r,o,s),h=hue2rgb(r,o,s-1/3)),{r:l,g:a,b:h}}function getDistinctColors(n){let t=new Array(n),e=0;for(let r=0;r<360;r+=360/n){e++;let o=hsl2rgb(r,100,30+e%4*15);t[e-1]=[Math.round(o.r*255),Math.round(o.g*255),Math.round(o.b*255)]}return t}function getRandomColor(){return[Math.floor(Math.random()*256),Math.floor(Math.random()*256),Math.floor(Math.random()*256)]}function getColors(n){let{color:t,colors:e,randomColors:r,numberColors:o=50}=n;if(t&&!Array.isArray(t)&&(t=css2array(t)),t)return[t];if(e)return e=e.map(function(s){return Array.isArray(s)?s:css2array(s)}),e;if(r){e=new Array(o);for(let s=0;s<o;s++)e[s]=getRandomColor()}return getDistinctColors(o)}function paintLabels(n,t,e={}){let{color:r="blue",colors:o,font:s="12px Helvetica",rotate:l=0}=e;if(this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1}),!Array.isArray(n))throw Error("paintLabels: labels must be an array");if(!Array.isArray(t))throw Error("paintLabels: positions must be an array");if(r&&!Array.isArray(r)&&(r=css2array(r)),o?o=o.map(function(y){return Array.isArray(y)?y:css2array(y)}):o=[r],n.length!==t.length)throw Error("paintLabels: positions and labels must be arrays from the same size");Array.isArray(s)||(s=[s]),Array.isArray(l)||(l=[l]);let h=this.getCanvas().getContext("2d");for(let y=0;y<n.length;y++){h.save();let C=o[y%o.length];h.fillStyle=`rgba(${C[0]},${C[1]},${C[2]},${C[3]/this.maxValue})`,h.font=s[y%s.length];let L=t[y];h.translate(L[0],L[1]),h.rotate(l[y%l.length]/180*Math.PI),h.fillText(n[y],0,0),h.restore()}return this.data=Uint8Array.from(h.getImageData(0,0,this.width,this.height).data),this}function paintMasks(n,t={}){let{alpha:e=255,labels:r=[],labelsPosition:o=[],labelColor:s="blue",labelFont:l="12px Helvetica"}=t;this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1});let a=getColors(Object.assign({},t,{numberColors:n.length}));Array.isArray(n)||(n=[n]);for(let h=0;h<n.length;h++){let y=n[h],C=a[h%a.length];for(let L=0;L<y.width;L++)for(let Y=0;Y<y.height;Y++)if(y.getBitXY(L,Y))for(let ze=0;ze<Math.min(this.components,C.length);ze++)if(e===255)this.setValueXY(L+y.position[0],Y+y.position[1],ze,C[ze]);else{let Bt=this.getValueXY(L+y.position[0],Y+y.position[1],ze);Bt=Math.round((Bt*(255-e)+C[ze]*e)/255),this.setValueXY(L+y.position[0],Y+y.position[1],ze,Bt)}}if(Array.isArray(r)&&r.length>0){let y=this.getCanvas().getContext("2d");y.fillStyle=s,y.font=l;for(let C=0;C<Math.min(n.length,r.length);C++){let L=o[C]?o[C]:n[C].position;y.fillText(r[C],L[0],L[1])}this.data=Uint8Array.from(y.getImageData(0,0,this.width,this.height).data)}return this}function zerosMatrix(n,t){let e=new Array(n);for(let r=0;r<n;r++)e[r]=new Array(t).fill(0);return e}const cross=[[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]],smallCross=[[0,1,0],[1,1,1],[0,1,0]];class Shape{constructor(t={}){let{kind:e="cross",shape:r,size:o,width:s,height:l,filled:a=!0}=t;if(o&&(s=o,l=o),r)switch(r.toLowerCase()){case"square":case"rectangle":this.matrix=rectangle(s,l,{filled:a});break;case"circle":case"ellipse":this.matrix=ellipse(s,l,{filled:a});break;case"triangle":this.matrix=triangle(s,l,{filled:a});break;default:throw new Error(`Shape: unexpected shape: ${r}`)}else if(e)switch(e.toLowerCase()){case"cross":this.matrix=cross;break;case"smallcross":this.matrix=smallCross;break;default:throw new Error(`Shape: unexpected kind: ${e}`)}else throw new Error("Shape: expected a kind or a shape option");this.height=this.matrix.length,this.width=this.matrix[0].length,this.halfHeight=this.height/2>>0,this.halfWidth=this.width/2>>0}getPoints(){let t=this.matrix,e=[];for(let r=0;r<t.length;r++)for(let o=0;o<t[0].length;o++)t[r][o]&&e.push([o-this.halfWidth,r-this.halfHeight]);return e}getMask(){let t=new Image$1(this.width,this.height,{kind:BINARY});for(let e=0;e<this.matrix.length;e++)for(let r=0;r<this.matrix[0].length;r++)this.matrix[e][r]&&t.setBitXY(r,e);return t}}function rectangle(n,t,e){const r=zerosMatrix(t,n);if(e.filled)for(let o=0;o<t;o++)for(let s=0;s<n;s++)r[o][s]=1;else{for(let o of[0,t-1])for(let s=0;s<n;s++)r[o][s]=1;for(let o=0;o<t;o++)for(let s of[0,n-1])r[o][s]=1}return r}function ellipse(n,t,e){const r=zerosMatrix(t,n);let o=1-t%2,s=1-n%2,l=Math.floor((n-1)/2),a=Math.floor((t-1)/2),h=l*l,y=a*a;if(e.filled)for(let C=0;C<=a;C++){let L=Math.floor(Math.sqrt(h-h*C*C/y));for(let Y=l-L;Y<=l;Y++)r[a-C][Y]=1,r[a+C+o][Y]=1,r[a-C][n-Y-1]=1,r[a+C+o][n-Y-1]=1}else{for(let C=0;C<=a;C++){let L=Math.floor(Math.sqrt(h-h*C*C/y)),Y=l-L;r[a-C][Y]=1,r[a+C+o][Y]=1,r[a-C][n-Y-1]=1,r[a+C+o][n-Y-1]=1}for(let C=0;C<=l;C++){let L=Math.floor(Math.sqrt(y-y*C*C/h)),Y=a-L;r[Y][l-C]=1,r[Y][l+C+s]=1,r[t-Y-1][l-C]=1,r[t-Y-1][l+C+s]=1}}return r}function triangle(n,t,e){if(!e.filled)throw new Error("Non filled triangle is not implemented");const r=zerosMatrix(t,n);for(let o=0;o<t;o++){let s=Math.floor((1-o/t)*n/2);for(let l=s;l<n-s;l++)r[o][l]=1}return r}function paintPoints(n,t={}){let{shape:e}=t;this.checkProcessable("paintPoints",{bitDepth:[8,16]});let r=getColors(Object.assign({},t,{numberColors:n.length})),o=new Shape(e).getPoints(),s=Math.min(this.channels,r[0].length);for(let l=0;l<n.length;l++){let a=r[l%r.length],h=n[l][0],y=n[l][1];for(let C=0;C<o.length;C++){let L=o[C][0],Y=o[C][1];if(h+L>=0&&y+Y>=0&&h+L<this.width&&y+Y<this.height){let ze=(h+L+(y+Y)*this.width)*this.channels;for(let Bt=0;Bt<s;Bt++)this.data[ze+Bt]=a[Bt]}}}return this}function paintPolyline(n,t={}){let{color:e=[this.maxValue,0,0],closed:r=!1}=t;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]});let o=Math.min(this.channels,e.length);for(let s=0;s<n.length-1+r;s++){let l=n[s],a=n[(s+1)%n.length],h=a[0]-l[0],y=a[1]-l[1],C=Math.max(Math.abs(h),Math.abs(y)),L=h/C,Y=y/C,ze=l[0],Bt=l[1];for(let Ir=0;Ir<=C;Ir++){let Wr=Math.round(ze),yi=Math.round(Bt);if(Wr>=0&&yi>=0&&Wr<this.width&&yi<this.height)if(this.bitDepth===1)this.setBitXY(Wr,yi);else{let Bn=(Wr+yi*this.width)*this.channels;for(let vi=0;vi<o;vi++)this.data[Bn+vi]=e[vi]}ze=ze+L,Bt=Bt+Y}}return this}function paintPolylines(n,t={}){let e=Object.assign({},t);this.checkProcessable("paintPolylines",{bitDepth:[8,16]});let r=getColors(Object.assign({},t,{numberColors:n.length}));for(let o=0;o<n.length;o++)e.color=r[o%r.length],this.paintPolyline(n[o],e);return this}function paintPolygon(n,t={}){let{color:e=[this.maxValue,0,0],filled:r=!1}=t;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]}),t.closed=!0;let o=deleteDouble(n);if(r===!1)return this.paintPolyline(n,t);{let s=Array(this.height);for(let l=0;l<this.height;l++){s[l]=[];for(let a=0;a<this.width;a++)s[l].push(0)}for(let l=0;l<o.length;l++){const a=lineBetweenTwoPoints(o[l],o[(l+1)%o.length]);for(let h=0;h<this.height;h++)for(let y=0;y<this.width;y++)isAtTheRightOfTheLine(y,h,a,this.height)&&(s[h][y]=s[h][y]===0?1:0)}for(let l=0;l<this.height;l++)for(let a=0;a<this.width;a++)if(s[l][a]===1)if(this.bitDepth===1)this.setBitXY(a,l);else{let h=Math.min(this.channels,e.length),y=(a+l*this.width)*this.channels;for(let C=0;C<h;C++)this.data[y+C]=e[C]}return this.paintPolyline(n,t)}}function deleteDouble(n){let t=[];for(let e=0;e<n.length;e++)if(!(n[e][0]===n[(e+1)%n.length][0]&&n[e][1]===n[(e+1)%n.length][1])){if(n[e][0]===n[(e-1+n.length)%n.length][0]&&n[e][1]===n[(e-1+n.length)%n.length][1])continue;if(n[(e+1)%n.length][0]===n[(e-1+n.length)%n.length][0]&&n[(e-1+n.length)%n.length][1]===n[(e+1)%n.length][1])continue;t.push(n[e])}return t}function lineBetweenTwoPoints(n,t){if(n[0]===t[0])return{a:0,b:n[0],vertical:!0};{const e=(t[1]-n[1])/(t[0]-n[0]),r=n[1]-e*n[0];return{a:e,b:r,vertical:!1}}}function isAtTheRightOfTheLine(n,t,e,r){if(e.vertical===!0)return e.b<=n;if(e.a===0)return!1;{const o=(t-e.b)/e.a;return o<n&&o>=0&&o<=r}}function paintPolygons(n,t={}){let e=Object.assign({},t);this.checkProcessable("paintPolygons",{bitDepth:[8,16]});let r=getColors(Object.assign({},t,{numberColors:n.length}));for(let o=0;o<n.length;o++)e.color=r[o%r.length],this.paintPolygon(n[o],e);return this}function getHistogram(n={}){let{maxSlots:t=256,channel:e,useAlpha:r=!0}=n;if(this.checkProcessable("getHistogram",{bitDepth:[1,8,16]}),e===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");e=0}return getChannelHistogram.call(this,e,{useAlpha:r,maxSlots:t})}function getHistograms(n={}){const{maxSlots:t=256,useAlpha:e=!0}=n;this.checkProcessable("getHistograms",{bitDepth:[8,16]});let r=new Array(e?this.components:this.channels);for(let o=0;o<r.length;o++)r[o]=getChannelHistogram.call(this,o,{useAlpha:e,maxSlots:t});return r}function getChannelHistogram(n,t){let{useAlpha:e,maxSlots:r}=t;if(this.bitDepth===1){let h=[0,0];for(let y=0;y<this.height;y++)for(let C=0;C<this.width;C++){let L=this.getBitXY(y,C);L===0?h[0]+=1:L===1&&(h[1]+=1)}return h}let o=Math.log2(r);if(!isInteger$1(o))throw new RangeError("maxSlots must be a power of 2, for example: 64, 256, 1024");let s=0;this.bitDepth>o&&(s=this.bitDepth-o);let l=this.data,a=newArray$1(Math.pow(2,Math.min(this.bitDepth,o)),0);if(e&&this.alpha){let h=this.channels-n-1;for(let y=n;y<l.length;y+=this.channels)a[l[y]>>s]+=l[y+h]/this.maxValue}else for(let h=n;h<l.length;h+=this.channels)a[l[h]>>s]++;return a}function getColorHistogram(n={}){let{useAlpha:t=!0,nbSlots:e=512}=n;this.checkProcessable("getColorHistogram",{bitDepth:[8,16],components:[3]});let r=Math.log(e)/Math.log(8);if(r!==Math.floor(r))throw new RangeError("nbSlots must be a power of 8. Usually 8, 64, 512 or 4096");let o=this.bitDepth-r,s=this.data,l=newArray$1(Math.pow(8,r),0),a=Math.pow(2,r*2),h=Math.pow(2,r);for(let y=0;y<s.length;y+=this.channels){let C=(s[y]>>o)*a+(s[y+1]>>o)*h+(s[y+2]>>o);t&&this.alpha?l[C]+=s[y+this.channels-1]/this.maxValue:l[C]++}return l}function min(){this.checkProcessable("min",{bitDepth:[8,16,32]});let n=newArray$1(this.channels,1/0);for(let t=0;t<this.data.length;t+=this.channels)for(let e=0;e<this.channels;e++)this.data[t+e]<n[e]&&(n[e]=this.data[t+e]);return n}function max(){this.checkProcessable("max",{bitDepth:[8,16,32]});let n=newArray$1(this.channels,-1/0);for(let t=0;t<this.data.length;t+=this.channels)for(let e=0;e<this.channels;e++)this.data[t+e]>n[e]&&(n[e]=this.data[t+e]);return n}function sum(){this.checkProcessable("sum",{bitDepth:[8,16]});let n=newArray$1(this.channels,0);for(let t=0;t<this.data.length;t+=this.channels)for(let e=0;e<this.channels;e++)n[e]+=this.data[t+e];return n}function getMoment(n=0,t=0){this.checkProcessable("getMoment",{bitDepth:[1]});let e=0;for(let r=0;r<this.width;r++)for(let o=0;o<this.height;o++)this.getBitXY(r,o)===1&&(e+=r**n*o**t);return e}function localMaxima(n={}){let{mask:t,region:e=3,removeClosePoints:r=0,invert:o=!1,maxEquals:s=2}=n,l=this;this.checkProcessable("localMaxima",{bitDepth:[8,16],components:1}),e*=4;let a=o?0:1,h=[1,0,-1,0,1,1,-1,-1,2,0,-2,0,2,2,-2,-2],y=[0,1,0,-1,1,-1,1,-1,0,2,0,-2,2,-2,2,-2],C=e<=8?1:2,L=[];for(let Y=C;Y<l.height-C;Y++)for(let ze=C;ze<l.width-C;ze++){if(t&&t.getBitXY(ze,Y)!==a)continue;let Bt=0,Ir=0,Wr=l.data[ze+Y*l.width];for(let yi=0;yi<e;yi++)o?l.data[ze+h[yi]+(Y+y[yi])*l.width]>Wr&&Bt++:l.data[ze+h[yi]+(Y+y[yi])*l.width]<Wr&&Bt++,l.data[ze+h[yi]+(Y+y[yi])*l.width]===Wr&&Ir++;Bt+Ir===e&&Ir<=s&&L.push([ze,Y])}if(r>0)for(let Y=0;Y<L.length;Y++)for(let ze=Y+1;ze<L.length;ze++)Math.sqrt(Math.pow(L[Y][0]-L[ze][0],2)+Math.pow(L[Y][1]-L[ze][1],2))<r&&(L[Y][0]=L[Y][0]+L[ze][0]>>1,L[Y][1]=L[Y][1]+L[ze][1]>>1,L.splice(ze,1),ze--);return L}function mean(){let n=this.getHistograms({maxSlots:this.maxValue+1}),t=new Array(n.length);for(let e=0;e<n.length;e++){let r=n[e];t[e]=mean$2(r)}return t}function median(){let n=this.getHistograms({maxSlots:this.maxValue+1}),t=new Array(n.length);for(let e=0;e<n.length;e++){let r=n[e];t[e]=median$2(r)}return t}function points(){this.checkProcessable("points",{bitDepth:[1]});const n=[];for(let t=0;t<this.width;t++)for(let e=0;e<this.height;e++)this.getBitXY(t,e)===1&&n.push([t,e]);return n}function extendedPoints(){this.checkProcessable("extendedPoints",{bitDepth:[1]});const n=[];for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++)if(this.getBitXY(e,t)===1)for(n.push([e,t]),this.getBitXY(e+1,t)!==1?(n.push([e+1,t]),n.push([e+1,t+1]),this.getBitXY(e,t+1)!==1&&n.push([e,t+1])):this.getBitXY(e,t+1)!==1&&(n.push([e,t+1]),n.push([e+1,t+1]));e<this.width-2&&this.getBitXY(e+1,t)===1&&this.getBitXY(e+2,t)===1;)e++;return n}function getRelativePosition(n,t={}){if(this===n)return[0,0];let e=[0,0],r=this;for(;r;){if(r===n)return e;r.position&&(e[0]+=r.position[0],e[1]+=r.position[1]),r=r.parent}return t.defaultFurther?e:!1}function countAlphaPixels(n={}){let{alpha:t=1}=n;this.checkProcessable("countAlphaPixels",{bitDepth:[8,16],alpha:1});let e=0;if(t!==void 0){for(let r=this.components;r<this.data.length;r+=this.channels)this.data[r]===t&&e++;return e}else return this.size}function monotoneChainConvexHull$1(n,t={}){const{sorted:e}=t;e||(n=n.slice().sort(byXThenY));const r=n.length,o=new Array(r*2);let s=0;for(let a=0;a<r;a++){const h=n[a];for(;s>=2&&cw(o[s-2],o[s-1],h)<=0;)s--;o[s++]=h}const l=s+1;for(let a=r-2;a>=0;a--){const h=n[a];for(;s>=l&&cw(o[s-2],o[s-1],h)<=0;)s--;o[s++]=h}return o.slice(0,s-1)}function cw(n,t,e){return(t[1]-n[1])*(e[0]-n[0])-(t[0]-n[0])*(e[1]-n[1])}function byXThenY(n,t){return n[0]===t[0]?n[1]-t[1]:n[0]-t[0]}function monotoneChainConvexHull(){return monotoneChainConvexHull$1(this.extendedPoints,{sorted:!1})}function round(n){for(let t=0;t<n.length;t++)n[t][0]=Math.round(n[t][0]),n[t][1]=Math.round(n[t][1]);return n}function difference(n,t){return[n[0]-t[0],n[1]-t[1]]}function normalize(n){let t=Math.sqrt(n[0]**2+n[1]**2);return[n[0]/t,n[1]/t]}function rotate(n,t,e){e===void 0&&(e=new Array(t.length));let r=Math.cos(n),o=Math.sin(n);for(let s=0;s<e.length;++s)e[s]=[r*t[s][0]-o*t[s][1],o*t[s][0]+r*t[s][1]];return e}function perimeter(n){let t=0;for(let e=0;e<n.length;e++){let r=n[e][0],o=n[e][1],s=n[e===n.length-1?0:e+1][0],l=n[e===n.length-1?0:e+1][1];t+=Math.sqrt((s-r)**2+(l-o)**2)}return t}function surface(n){let t=0;for(let e=0;e<n.length;e++){let r=n[e][0],o=n[e===n.length-1?0:e+1][1],s=n[e===n.length-1?0:e+1][0],l=n[e][1];t+=r*o*.5,t-=s*l*.5}return Math.abs(t)}function minMax(n){let t=1/0,e=1/0,r=-1/0,o=-1/0;for(let s=0;s<n.length;s++)n[s][0]<t&&(t=n[s][0]),n[s][0]>r&&(r=n[s][0]),n[s][1]<e&&(e=n[s][1]),n[s][1]>o&&(o=n[s][1]);return[[t,e],[r,o]]}function moveToZeroZero(n,t){t===void 0&&(t=new Array(n.length).fill(0).map(()=>[]));let e=minMax(n),r=e[0][0],o=e[0][1];for(let s=0;s<n.length;s++)t[s][0]=n[s][0]-r,t[s][1]=n[s][1]-o;return t}function minimalBoundingRectangle(n={}){const{originalPoints:t=monotoneChainConvexHull.call(this)}=n;if(t.length===0)return[];if(t.length===1)return[t[0],t[0],t[0],t[0]];const e=new Array(t.length);let r=1/0,o=0,s;for(let l=0;l<e.length;l++){let a=getAngle$1(t[l],t[(l+1)%e.length]);rotate(-a,t,e);let h=e[l][0],y=e[l][1],C=e[(l+1)%e.length][0],L=e[(l+1)%e.length][1],Y=!0,ze=0,Bt=0,Ir=0;for(let vi=0;vi<e.length;vi++){let wo=e[vi][0],ia=e[vi][1],gl=(wo-h)/(C-h);Y===!0?(Y=!1,ze=gl,Bt=gl):(gl<ze&&(ze=gl),gl>Bt&&(Bt=gl));let ml=(-(C-h)*ia+C*y-L*h)/(C-h);Math.abs(ml)>Math.abs(Ir)&&(Ir=ml)}let Wr=[h+ze*(C-h),y],yi=[h+Bt*(C-h),y],Bn=Math.abs(Ir*(ze-Bt)*(C-h));Bn<r&&(o=a,r=Bn,s=[Wr,yi,[yi[0],yi[1]-Ir],[Wr[0],Wr[1]-Ir]])}return rotate(o,s,s),s}function getAngle$1(n,t){let e=difference(t,n),r=normalize(e),o=Math.acos(r[0]);return r[1]<0?-o:o}function extend$1(n){let t={inPlace:!0};n.extendMethod("invert",invert),n.extendMethod("abs",abs),n.extendMethod("level",level,t),n.extendMethod("add",add,t),n.extendMethod("subtract",subtract,t),n.extendMethod("subtractImage",subtractImage),n.extendMethod("multiply",multiply,t),n.extendMethod("divide",divide,t),n.extendMethod("hypotenuse",hypotenuse),n.extendMethod("background",background$1),n.extendMethod("flipX",flipX),n.extendMethod("flipY",flipY),n.extendMethod("blurFilter",blurFilter),n.extendMethod("medianFilter",medianFilter),n.extendMethod("gaussianFilter",gaussianFilter),n.extendMethod("sobelFilter",sobelFilter),n.extendMethod("gradientFilter",gradientFilter),n.extendMethod("scharrFilter",scharrFilter),n.extendMethod("dilate",dilate),n.extendMethod("erode",erode),n.extendMethod("open",open$1),n.extendMethod("close",close),n.extendMethod("topHat",topHat),n.extendMethod("blackHat",blackHat),n.extendMethod("morphologicalGradient",morphologicalGradient),n.extendMethod("warpingFourPoints",warpingFourPoints),n.extendMethod("crop",crop),n.extendMethod("cropAlpha",cropAlpha),n.extendMethod("resize",resize).extendMethod("scale",resize),n.extendMethod("hsv",hsv),n.extendMethod("hsl",hsl$1),n.extendMethod("cmyk",cmyk),n.extendMethod("rgba8",rgba8),n.extendMethod("grey",grey).extendMethod("gray",grey),n.extendMethod("mask",mask),n.extendMethod("pad",pad),n.extendMethod("colorDepth",colorDepth),n.extendMethod("setBorder",setBorder,t),n.extendMethod("rotate",rotate$1),n.extendMethod("rotateLeft",rotateLeft),n.extendMethod("rotateRight",rotateRight),n.extendMethod("insert",insert),n.extendMethod("getRow",getRow),n.extendMethod("getColumn",getColumn),n.extendMethod("getMatrix",getMatrix),n.extendMethod("setMatrix",setMatrix),n.extendMethod("getPixelsArray",getPixelsArray),n.extendMethod("getIntersection",getIntersection),n.extendMethod("getClosestCommonParent",getClosestCommonParent),n.extendMethod("getThreshold",getThreshold),n.extendMethod("split",split),n.extendMethod("getChannel",getChannel),n.extendMethod("combineChannels",combineChannels),n.extendMethod("setChannel",setChannel),n.extendMethod("getSimilarity",getSimilarity),n.extendMethod("getPixelsGrid",getPixelsGrid),n.extendMethod("getBestMatch",getBestMatch),n.extendMethod("cannyEdge",cannyEdge),n.extendMethod("convolution",convolution),n.extendMethod("extract",extract),n.extendMethod("floodFill",floodFill),n.extendMethod("paintLabels",paintLabels,t),n.extendMethod("paintMasks",paintMasks,t),n.extendMethod("paintPoints",paintPoints,t),n.extendMethod("paintPolyline",paintPolyline,t),n.extendMethod("paintPolylines",paintPolylines,t),n.extendMethod("paintPolygon",paintPolygon,t),n.extendMethod("paintPolygons",paintPolygons,t),n.extendMethod("countAlphaPixels",countAlphaPixels),n.extendMethod("monotoneChainConvexHull",monotoneChainConvexHull),n.extendMethod("minimalBoundingRectangle",minimalBoundingRectangle),n.extendMethod("getHistogram",getHistogram).extendProperty("histogram",getHistogram),n.extendMethod("getHistograms",getHistograms).extendProperty("histograms",getHistograms),n.extendMethod("getColorHistogram",getColorHistogram).extendProperty("colorHistogram",getColorHistogram),n.extendMethod("getMin",min).extendProperty("min",min),n.extendMethod("getMax",max).extendProperty("max",max),n.extendMethod("getSum",sum).extendProperty("sum",sum),n.extendMethod("getMoment",getMoment).extendProperty("moment",getMoment),n.extendMethod("getLocalMaxima",localMaxima),n.extendMethod("getMedian",median).extendProperty("median",median),n.extendMethod("getMean",mean).extendProperty("mean",mean),n.extendMethod("getPoints",points).extendProperty("points",points),n.extendMethod("getExtendedPoints",extendedPoints).extendProperty("extendedPoints",extendedPoints),n.extendMethod("getRelativePosition",getRelativePosition)}var quantities={exports:{}};(function(n,t){(function(e,r){n.exports=r()})(commonjsGlobal,function(){function e(di){return typeof di=="string"||di instanceof String}var r=Number.isFinite||window.isFinite;function o(di){return r(di)}function s(di){return di}function l(di){var fs={};return di.filter(function(cl){return fs.hasOwnProperty(cl)?!1:fs[cl]=!0})}function a(di,fs){if(fs.length!==di.length)return!1;for(var cl=0;cl<di.length;cl++)if(fs[cl].compareArray&&!fs[cl].compareArray(di[cl])||fs[cl]!==di[cl])return!1;return!0}function h(di,fs){Object.keys(fs).forEach(function(cl){di[cl]=fs[cl]})}function y(){for(var di=1,fs=0,cl=0;cl<arguments.length;cl++){var ih=arguments[cl];fs=fs+Y(ih),di*=ih}return fs!==0?L(di,fs):di}function C(di,fs){if(fs===0)throw new Error("Divide by zero");var cl=Math.pow(10,Y(fs)),ih=cl/(cl*fs);return y(di,ih)}function L(di,fs){return Math.round(di*Math.pow(10,fs))/Math.pow(10,fs)}function Y(di){if(!isFinite(di))return 0;for(var fs=0;di%1!==0;)di*=10,fs++;return fs}function ze(){var di;if(!this)return di=Object.create(ze.prototype),ze.apply(di,arguments),di;di=Error.apply(this,arguments),this.name="QtyError",this.message=di.message,this.stack=di.stack}ze.prototype=Object.create(Error.prototype,{constructor:{value:ze}});function Bt(di,fs){throw new ze("Incompatible units: "+di+" and "+fs)}var Ir={"<googol>":[["googol"],1e100,"prefix"],"<kibi>":[["Ki","Kibi","kibi"],Math.pow(2,10),"prefix"],"<mebi>":[["Mi","Mebi","mebi"],Math.pow(2,20),"prefix"],"<gibi>":[["Gi","Gibi","gibi"],Math.pow(2,30),"prefix"],"<tebi>":[["Ti","Tebi","tebi"],Math.pow(2,40),"prefix"],"<pebi>":[["Pi","Pebi","pebi"],Math.pow(2,50),"prefix"],"<exi>":[["Ei","Exi","exi"],Math.pow(2,60),"prefix"],"<zebi>":[["Zi","Zebi","zebi"],Math.pow(2,70),"prefix"],"<yebi>":[["Yi","Yebi","yebi"],Math.pow(2,80),"prefix"],"<yotta>":[["Y","Yotta","yotta"],1e24,"prefix"],"<zetta>":[["Z","Zetta","zetta"],1e21,"prefix"],"<exa>":[["E","Exa","exa"],1e18,"prefix"],"<peta>":[["P","Peta","peta"],1e15,"prefix"],"<tera>":[["T","Tera","tera"],1e12,"prefix"],"<giga>":[["G","Giga","giga"],1e9,"prefix"],"<mega>":[["M","Mega","mega"],1e6,"prefix"],"<kilo>":[["k","kilo"],1e3,"prefix"],"<hecto>":[["h","Hecto","hecto"],100,"prefix"],"<deca>":[["da","Deca","deca","deka"],10,"prefix"],"<deci>":[["d","Deci","deci"],.1,"prefix"],"<centi>":[["c","Centi","centi"],.01,"prefix"],"<milli>":[["m","Milli","milli"],.001,"prefix"],"<micro>":[["u","μ","µ","Micro","mc","micro"],1e-6,"prefix"],"<nano>":[["n","Nano","nano"],1e-9,"prefix"],"<pico>":[["p","Pico","pico"],1e-12,"prefix"],"<femto>":[["f","Femto","femto"],1e-15,"prefix"],"<atto>":[["a","Atto","atto"],1e-18,"prefix"],"<zepto>":[["z","Zepto","zepto"],1e-21,"prefix"],"<yocto>":[["y","Yocto","yocto"],1e-24,"prefix"],"<1>":[["1","<1>"],1,""],"<meter>":[["m","meter","meters","metre","metres"],1,"length",["<meter>"]],"<inch>":[["in","inch","inches",'"'],.0254,"length",["<meter>"]],"<foot>":[["ft","foot","feet","'"],.3048,"length",["<meter>"]],"<yard>":[["yd","yard","yards"],.9144,"length",["<meter>"]],"<mile>":[["mi","mile","miles"],1609.344,"length",["<meter>"]],"<naut-mile>":[["nmi","naut-mile"],1852,"length",["<meter>"]],"<league>":[["league","leagues"],4828,"length",["<meter>"]],"<furlong>":[["furlong","furlongs"],201.2,"length",["<meter>"]],"<rod>":[["rd","rod","rods"],5.029,"length",["<meter>"]],"<mil>":[["mil","mils"],254e-7,"length",["<meter>"]],"<angstrom>":[["ang","angstrom","angstroms"],1e-10,"length",["<meter>"]],"<fathom>":[["fathom","fathoms"],1.829,"length",["<meter>"]],"<pica>":[["pica","picas"],.00423333333,"length",["<meter>"]],"<point>":[["pt","point","points"],.000352777778,"length",["<meter>"]],"<redshift>":[["z","red-shift","redshift"],1302773e20,"length",["<meter>"]],"<AU>":[["AU","astronomical-unit"],1495979e5,"length",["<meter>"]],"<light-second>":[["ls","light-second"],299792500,"length",["<meter>"]],"<light-minute>":[["lmin","light-minute"],1798755e4,"length",["<meter>"]],"<light-year>":[["ly","light-year"],9460528e9,"length",["<meter>"]],"<parsec>":[["pc","parsec","parsecs"],3085678e10,"length",["<meter>"]],"<datamile>":[["DM","datamile"],1828.8,"length",["<meter>"]],"<kilogram>":[["kg","kilogram","kilograms"],1,"mass",["<kilogram>"]],"<AMU>":[["u","AMU","amu"],1660538921e-36,"mass",["<kilogram>"]],"<dalton>":[["Da","Dalton","Daltons","dalton","daltons"],1660538921e-36,"mass",["<kilogram>"]],"<slug>":[["slug","slugs"],14.5939029,"mass",["<kilogram>"]],"<short-ton>":[["tn","ton","short-ton"],907.18474,"mass",["<kilogram>"]],"<metric-ton>":[["tonne","metric-ton"],1e3,"mass",["<kilogram>"]],"<carat>":[["ct","carat","carats"],2e-4,"mass",["<kilogram>"]],"<pound>":[["lbs","lb","pound","pounds","#"],.45359237,"mass",["<kilogram>"]],"<ounce>":[["oz","ounce","ounces"],.0283495231,"mass",["<kilogram>"]],"<gram>":[["g","gram","grams","gramme","grammes"],.001,"mass",["<kilogram>"]],"<grain>":[["grain","grains","gr"],6479891e-11,"mass",["<kilogram>"]],"<dram>":[["dram","drams","dr"],.0017718452,"mass",["<kilogram>"]],"<stone>":[["stone","stones","st"],6.35029318,"mass",["<kilogram>"]],"<hectare>":[["hectare"],1e4,"area",["<meter>","<meter>"]],"<acre>":[["acre","acres"],4046.85642,"area",["<meter>","<meter>"]],"<sqft>":[["sqft"],1,"area",["<foot>","<foot>"]],"<liter>":[["l","L","liter","liters","litre","litres"],.001,"volume",["<meter>","<meter>","<meter>"]],"<gallon>":[["gal","gallon","gallons"],.0037854118,"volume",["<meter>","<meter>","<meter>"]],"<gallon-imp>":[["galimp","gallon-imp","gallons-imp"],.00454609,"volume",["<meter>","<meter>","<meter>"]],"<quart>":[["qt","quart","quarts"],.00094635295,"volume",["<meter>","<meter>","<meter>"]],"<pint>":[["pt","pint","pints"],.000473176475,"volume",["<meter>","<meter>","<meter>"]],"<pint-imp>":[["ptimp","pint-imp","pints-imp"],.00056826125,"volume",["<meter>","<meter>","<meter>"]],"<cup>":[["cu","cup","cups"],.000236588238,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce>":[["floz","fluid-ounce","fluid-ounces"],295735297e-13,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce-imp>":[["flozimp","floz-imp","fluid-ounce-imp","fluid-ounces-imp"],284130625e-13,"volume",["<meter>","<meter>","<meter>"]],"<tablespoon>":[["tb","tbsp","tbs","tablespoon","tablespoons"],147867648e-13,"volume",["<meter>","<meter>","<meter>"]],"<teaspoon>":[["tsp","teaspoon","teaspoons"],492892161e-14,"volume",["<meter>","<meter>","<meter>"]],"<bushel>":[["bu","bsh","bushel","bushels"],.035239072,"volume",["<meter>","<meter>","<meter>"]],"<oilbarrel>":[["bbl","oilbarrel","oilbarrels","oil-barrel","oil-barrels"],.158987294928,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel>":[["bl","bl-us","beerbarrel","beerbarrels","beer-barrel","beer-barrels"],.1173477658,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel-imp>":[["blimp","bl-imp","beerbarrel-imp","beerbarrels-imp","beer-barrel-imp","beer-barrels-imp"],.16365924,"volume",["<meter>","<meter>","<meter>"]],"<kph>":[["kph"],.277777778,"speed",["<meter>"],["<second>"]],"<mph>":[["mph"],.44704,"speed",["<meter>"],["<second>"]],"<knot>":[["kt","kn","kts","knot","knots"],.514444444,"speed",["<meter>"],["<second>"]],"<fps>":[["fps"],.3048,"speed",["<meter>"],["<second>"]],"<gee>":[["gee"],9.80665,"acceleration",["<meter>"],["<second>","<second>"]],"<Gal>":[["Gal"],.01,"acceleration",["<meter>"],["<second>","<second>"]],"<kelvin>":[["degK","kelvin"],1,"temperature",["<kelvin>"]],"<celsius>":[["degC","celsius","celsius","centigrade"],1,"temperature",["<kelvin>"]],"<fahrenheit>":[["degF","fahrenheit"],5/9,"temperature",["<kelvin>"]],"<rankine>":[["degR","rankine"],5/9,"temperature",["<kelvin>"]],"<temp-K>":[["tempK","temp-K"],1,"temperature",["<temp-K>"]],"<temp-C>":[["tempC","temp-C"],1,"temperature",["<temp-K>"]],"<temp-F>":[["tempF","temp-F"],5/9,"temperature",["<temp-K>"]],"<temp-R>":[["tempR","temp-R"],5/9,"temperature",["<temp-K>"]],"<second>":[["s","sec","secs","second","seconds"],1,"time",["<second>"]],"<minute>":[["min","mins","minute","minutes"],60,"time",["<second>"]],"<hour>":[["h","hr","hrs","hour","hours"],3600,"time",["<second>"]],"<day>":[["d","day","days"],3600*24,"time",["<second>"]],"<week>":[["wk","week","weeks"],7*3600*24,"time",["<second>"]],"<fortnight>":[["fortnight","fortnights"],1209600,"time",["<second>"]],"<year>":[["y","yr","year","years","annum"],31556926,"time",["<second>"]],"<decade>":[["decade","decades"],315569260,"time",["<second>"]],"<century>":[["century","centuries"],3155692600,"time",["<second>"]],"<pascal>":[["Pa","pascal","Pascal"],1,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<bar>":[["bar","bars"],1e5,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<mmHg>":[["mmHg"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inHg>":[["inHg"],3386.3881472,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<torr>":[["torr"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<atm>":[["atm","ATM","atmosphere","atmospheres"],101325,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<psi>":[["psi"],6894.76,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<cmh2o>":[["cmH2O","cmh2o"],98.0638,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inh2o>":[["inH2O","inh2o"],249.082052,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<poise>":[["P","poise"],.1,"viscosity",["<kilogram>"],["<meter>","<second>"]],"<stokes>":[["St","stokes"],1e-4,"viscosity",["<meter>","<meter>"],["<second>"]],"<mole>":[["mol","mole"],1,"substance",["<mole>"]],"<molar>":[["M","molar"],1e3,"concentration",["<mole>"],["<meter>","<meter>","<meter>"]],"<wtpercent>":[["wt%","wtpercent"],10,"concentration",["<kilogram>"],["<meter>","<meter>","<meter>"]],"<katal>":[["kat","katal","Katal"],1,"activity",["<mole>"],["<second>"]],"<unit>":[["U","enzUnit","unit"],16667e-19,"activity",["<mole>"],["<second>"]],"<farad>":[["F","farad","Farad"],1,"capacitance",["<second>","<second>","<second>","<second>","<ampere>","<ampere>"],["<meter>","<meter>","<kilogram>"]],"<coulomb>":[["C","coulomb","Coulomb"],1,"charge",["<ampere>","<second>"]],"<Ah>":[["Ah"],3600,"charge",["<ampere>","<second>"]],"<ampere>":[["A","Ampere","ampere","amp","amps"],1,"current",["<ampere>"]],"<siemens>":[["S","Siemens","siemens"],1,"conductance",["<second>","<second>","<second>","<ampere>","<ampere>"],["<kilogram>","<meter>","<meter>"]],"<henry>":[["H","Henry","henry"],1,"inductance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>","<ampere>"]],"<volt>":[["V","Volt","volt","volts"],1,"potential",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>"]],"<ohm>":[["Ohm","ohm","Ω","Ω"],1,"resistance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>","<ampere>"]],"<weber>":[["Wb","weber","webers"],1,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<tesla>":[["T","tesla","teslas"],1,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<gauss>":[["G","gauss"],1e-4,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<maxwell>":[["Mx","maxwell","maxwells"],1e-8,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<oersted>":[["Oe","oersted","oersteds"],250/Math.PI,"magnetism",["<ampere>"],["<meter>"]],"<joule>":[["J","joule","Joule","joules"],1,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<erg>":[["erg","ergs"],1e-7,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<btu>":[["BTU","btu","BTUs"],1055.056,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<calorie>":[["cal","calorie","calories"],4.184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Calorie>":[["Cal","Calorie","Calories"],4184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<therm-US>":[["th","therm","therms","Therm","therm-US"],105480400,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Wh>":[["Wh"],3600,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<newton>":[["N","Newton","newton"],1,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<dyne>":[["dyn","dyne"],1e-5,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<pound-force>":[["lbf","pound-force"],4.448222,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<hertz>":[["Hz","hertz","Hertz"],1,"frequency",["<1>"],["<second>"]],"<radian>":[["rad","radian","radians"],1,"angle",["<radian>"]],"<degree>":[["deg","degree","degrees"],Math.PI/180,"angle",["<radian>"]],"<gradian>":[["gon","grad","gradian","grads"],Math.PI/200,"angle",["<radian>"]],"<steradian>":[["sr","steradian","steradians"],1,"solid_angle",["<steradian>"]],"<rotation>":[["rotation"],2*Math.PI,"angle",["<radian>"]],"<rpm>":[["rpm"],2*Math.PI/60,"angular_velocity",["<radian>"],["<second>"]],"<byte>":[["B","byte","bytes"],1,"information",["<byte>"]],"<bit>":[["b","bit","bits"],.125,"information",["<byte>"]],"<Bps>":[["Bps"],1,"information_rate",["<byte>"],["<second>"]],"<bps>":[["bps"],.125,"information_rate",["<byte>"],["<second>"]],"<dollar>":[["USD","dollar"],1,"currency",["<dollar>"]],"<cents>":[["cents"],.01,"currency",["<dollar>"]],"<candela>":[["cd","candela"],1,"luminosity",["<candela>"]],"<lumen>":[["lm","lumen"],1,"luminous_power",["<candela>","<steradian>"]],"<lux>":[["lux"],1,"illuminance",["<candela>","<steradian>"],["<meter>","<meter>"]],"<watt>":[["W","watt","watts"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere>":[["VA","volt-ampere"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere-reactive>":[["var","Var","VAr","VAR","volt-ampere-reactive"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<horsepower>":[["hp","horsepower"],745.699872,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<gray>":[["Gy","gray","grays"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<roentgen>":[["R","roentgen"],.00933,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<sievert>":[["Sv","sievert","sieverts"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<becquerel>":[["Bq","becquerel","becquerels"],1,"radiation",["<1>"],["<second>"]],"<curie>":[["Ci","curie","curies"],37e9,"radiation",["<1>"],["<second>"]],"<cpm>":[["cpm"],1/60,"rate",["<count>"],["<second>"]],"<dpm>":[["dpm"],1/60,"rate",["<count>"],["<second>"]],"<bpm>":[["bpm"],1/60,"rate",["<count>"],["<second>"]],"<dot>":[["dot","dots"],1,"resolution",["<each>"]],"<pixel>":[["pixel","px"],1,"resolution",["<each>"]],"<ppi>":[["ppi"],1,"resolution",["<pixel>"],["<inch>"]],"<dpi>":[["dpi"],1,"typography",["<dot>"],["<inch>"]],"<cell>":[["cells","cell"],1,"counting",["<each>"]],"<each>":[["each"],1,"counting",["<each>"]],"<count>":[["count"],1,"counting",["<each>"]],"<base-pair>":[["bp","base-pair"],1,"counting",["<each>"]],"<nucleotide>":[["nt","nucleotide"],1,"counting",["<each>"]],"<molecule>":[["molecule","molecules"],1,"counting",["<1>"]],"<dozen>":[["doz","dz","dozen"],12,"prefix_only",["<each>"]],"<percent>":[["%","percent"],.01,"prefix_only",["<1>"]],"<ppm>":[["ppm"],1e-6,"prefix_only",["<1>"]],"<ppt>":[["ppt"],1e-9,"prefix_only",["<1>"]],"<gross>":[["gr","gross"],144,"prefix_only",["<dozen>","<dozen>"]],"<decibel>":[["dB","decibel","decibels"],1,"logarithmic",["<decibel>"]]},Wr=["<meter>","<kilogram>","<second>","<mole>","<ampere>","<radian>","<kelvin>","<temp-K>","<byte>","<dollar>","<candela>","<each>","<steradian>","<decibel>"],yi="<1>",Bn=[yi];function vi(di,fs){var cl=fs[1],ih=fs[3]||[],uh=fs[4]||[];if(!o(cl))throw new ze(di+": Invalid unit definition. 'scalar' must be a number");ih.forEach(function(vh){if(Ir[vh]===void 0)throw new ze(di+": Invalid unit definition. Unit "+vh+" in 'numerator' is not recognized")}),uh.forEach(function(vh){if(Ir[vh]===void 0)throw new ze(di+": Invalid unit definition. Unit "+vh+" in 'denominator' is not recognized")})}var wo={},ia={},gl={},ml={},il={};for(var sl in Ir)if(Ir.hasOwnProperty(sl)){var ol=Ir[sl];if(ol[2]==="prefix"){wo[sl]=ol[1];for(var _l=0;_l<ol[0].length;_l++)ia[ol[0][_l]]=sl}else{vi(sl,ol),gl[sl]={scalar:ol[1],numerator:ol[3],denominator:ol[4]};for(var rh=0;rh<ol[0].length;rh++)ml[ol[0][rh]]=sl}il[sl]=ol[0][0]}function wh(di){var fs,cl=[],ih=Object.keys(Ir);if(typeof di>"u")for(fs=0;fs<ih.length;fs++)["","prefix"].indexOf(Ir[ih[fs]][2])===-1&&cl.push(ih[fs].substr(1,ih[fs].length-2));else{if(this.getKinds().indexOf(di)===-1)throw new ze("Kind not recognized");for(fs=0;fs<ih.length;fs++)Ir[ih[fs]][2]===di&&cl.push(ih[fs].substr(1,ih[fs].length-2))}return cl.sort(function(uh,vh){return uh.toLowerCase()<vh.toLowerCase()?-1:uh.toLowerCase()>vh.toLowerCase()?1:0})}function Fh(di){if(!ml[di])throw new ze("Unit not recognized");return Ir[ml[di]][0]}var Mh=["length","time","temperature","mass","current","substance","luminosity","currency","information","angle"];function vp(){if(this.signature)return this.signature;for(var di=gp.call(this),fs=0;fs<di.length;fs++)di[fs]*=Math.pow(20,fs);return di.reduce(function(cl,ih){return cl+ih},0)}function gp(){if(!this.isBase())return gp.call(this.toBase());for(var di=new Array(Mh.length),fs=0;fs<di.length;fs++)di[fs]=0;for(var cl,ih,uh=0;uh<this.numerator.length;uh++)(cl=Ir[this.numerator[uh]])&&(ih=Mh.indexOf(cl[2]),ih>=0&&(di[ih]=di[ih]+1));for(var vh=0;vh<this.denominator.length;vh++)(cl=Ir[this.denominator[vh]])&&(ih=Mh.indexOf(cl[2]),ih>=0&&(di[ih]=di[ih]-1));return di}var Jh="[+-]",Lp="\\d+",Ip=Jh+"?"+Lp,$p="\\."+Lp,Xp="(?:"+Lp+"(?:"+$p+")?)|(?:"+$p+")",Cp="[Ee]"+Ip,Gp="(?:"+Xp+")(?:"+Cp+")?",Rp=Jh+"?\\s*"+Gp,od="("+Rp+")?\\s*([^/]*)(?:/(.+))?",Wp=new RegExp("^"+od+"$"),Ld="\\^|\\*{2}",ed="[01234]",Gd=new RegExp("([^ \\*\\d]+?)(?:"+Ld+")?(-?"+ed+"(?![a-zA-Z]))"),Kp=new RegExp("([^ \\*\\d]+?)(?:"+Ld+")?("+ed+"(?![a-zA-Z]))");function Ad(di){e(di)||(di=di.toString()),di=di.trim();var fs=Wp.exec(di);if(!fs)throw new ze(di+": Quantity not recognized");var cl=fs[1];cl?(cl=cl.replace(/\s/g,""),this.scalar=parseFloat(cl)):this.scalar=1;for(var ih=fs[2],uh=fs[3],vh,Th,kh;fs=Gd.exec(ih);){if(vh=parseFloat(fs[2]),isNaN(vh))throw new ze("Unit exponent is not a number");if(vh===0&&!cd.test(fs[1]))throw new ze("Unit not recognized");Th=fs[1]+" ",kh="";for(var ep=0;ep<Math.abs(vh);ep++)kh+=Th;vh>=0?ih=ih.replace(fs[0],kh):(uh=uh?uh+kh:kh,ih=ih.replace(fs[0],""))}for(;fs=Kp.exec(uh);){if(vh=parseFloat(fs[2]),isNaN(vh))throw new ze("Unit exponent is not a number");if(vh===0&&!cd.test(fs[1]))throw new ze("Unit not recognized");Th=fs[1]+" ",kh="";for(var ip=0;ip<vh;ip++)kh+=Th;uh=uh.replace(fs[0],kh)}ih&&(this.numerator=Cd(ih.trim())),uh&&(this.denominator=Cd(uh.trim()))}var Id=Object.keys(ia).sort(function(di,fs){return fs.length-di.length}).join("|"),Yh=Object.keys(ml).sort(function(di,fs){return fs.length-di.length}).join("|"),Ap="\\b|$",kd="("+Id+")??("+Yh+")(?:"+Ap+")",cd=new RegExp("^\\s*("+kd+"[\\s\\*]*)+$"),id=new RegExp(kd,"g"),fp={};function Cd(di){var fs=fp[di];if(fs)return fs;var cl,ih=[];if(!cd.test(di))throw new ze("Unit not recognized");for(;cl=id.exec(di);)ih.push(cl.slice(1));return ih=ih.map(function(uh){return ia[uh[0]]?[ia[uh[0]],ml[uh[1]]]:[ml[uh[1]]]}),ih=ih.reduce(function(uh,vh){return uh.concat(vh)},[]),ih=ih.filter(function(uh){return uh}),fp[di]=ih,ih}function Fd(di){if(!e(di))throw new ze("Argument should be a string");try{return this(di)}catch{return null}}function yd(di){return di instanceof kp}function kp(di,fs){if(Uf.apply(null,arguments),!yd(this))return new kp(di,fs);if(this.scalar=null,this.baseScalar=null,this.signature=null,this._conversionCache={},this.numerator=Bn,this.denominator=Bn,$f(di)?(this.scalar=di.scalar,this.numerator=di.numerator&&di.numerator.length!==0?di.numerator:Bn,this.denominator=di.denominator&&di.denominator.length!==0?di.denominator:Bn):fs?(Ad.call(this,fs),this.scalar=di):Ad.call(this,di),this.denominator.join("*").indexOf("temp")>=0)throw new ze("Cannot divide with temperatures");if(this.numerator.join("*").indexOf("temp")>=0){if(this.numerator.length>1)throw new ze("Cannot multiply by temperatures");if(!a(this.denominator,Bn))throw new ze("Cannot divide with temperatures")}if(this.initValue=di,up.call(this),this.isTemperature()&&this.baseScalar<0)throw new ze("Temperatures must not be less than absolute zero")}kp.prototype={constructor:kp};function Uf(di,fs){if(fs){if(!(o(di)&&e(fs)))throw new ze("Only number accepted as initialization value when units are explicitly provided")}else if(!(e(di)||o(di)||yd(di)||$f(di)))throw new ze("Only string, number or quantity accepted as single initialization value")}function $f(di){return di&&typeof di=="object"&&di.hasOwnProperty("scalar")}function up(){if(this.baseScalar)return this.baseScalar;if(this.isBase())this.baseScalar=this.scalar,this.signature=vp.call(this);else{var di=this.toBase();this.baseScalar=di.scalar,this.signature=di.signature}}var ud={"-312078":"elastance","-312058":"resistance","-312038":"inductance","-152058":"potential","-152040":"magnetism","-152038":"magnetism","-7997":"specific_volume","-79":"snap","-59":"jolt","-39":"acceleration","-38":"radiation","-20":"frequency","-19":"speed","-18":"viscosity","-17":"volumetric_flow","-1":"wavenumber",0:"unitless",1:"length",2:"area",3:"volume",20:"time",400:"temperature",7941:"yank",7942:"power",7959:"pressure",7961:"force",7962:"energy",7979:"viscosity",7981:"momentum",7982:"angular_momentum",7997:"density",7998:"area_density",8e3:"mass",152020:"radiation_exposure",159999:"magnetism",16e4:"current",160020:"charge",312058:"conductance",312078:"capacitance",3199980:"activity",3199997:"molar_concentration",32e5:"substance",63999998:"illuminance",64e6:"luminous_power",128e7:"currency","25599999980":"information_rate","25600000000":"information","511999999980":"angular_velocity","512000000000":"angle"};function xd(){return l(Object.keys(ud).map(function(di){return ud[di]}))}kp.prototype.kind=function(){return ud[this.signature.toString()]},h(kp.prototype,{isDegrees:function(){return(this.signature===null||this.signature===400)&&this.numerator.length===1&&a(this.denominator,Bn)&&(this.numerator[0].match(/<temp-[CFRK]>/)||this.numerator[0].match(/<(kelvin|celsius|rankine|fahrenheit)>/))},isTemperature:function(){return this.isDegrees()&&this.numerator[0].match(/<temp-[CFRK]>/)}});function Ed(di,fs){var cl=di.units(),ih=fs.to(cl),uh=kp(Yp(cl));return kp({scalar:di.scalar-ih.scalar,numerator:uh.numerator,denominator:uh.denominator})}function Vd(di,fs){var cl=fs.to(Yp(di.units()));return kp({scalar:di.scalar-cl.scalar,numerator:di.numerator,denominator:di.denominator})}function Ep(di,fs){var cl=fs.to(Yp(di.units()));return kp({scalar:di.scalar+cl.scalar,numerator:di.numerator,denominator:di.denominator})}function Yp(di){if(di==="tempK")return"degK";if(di==="tempC")return"degC";if(di==="tempF")return"degF";if(di==="tempR")return"degR";throw new ze("Unknown type for temp conversion from: "+di)}function nd(di,fs){var cl=$d(di),ih=fs.units(),uh;if(ih==="degK")uh=cl.scalar;else if(ih==="degC")uh=cl.scalar;else if(ih==="degF")uh=cl.scalar*9/5;else if(ih==="degR")uh=cl.scalar*9/5;else throw new ze("Unknown type for degree conversion to: "+ih);return kp({scalar:uh,numerator:fs.numerator,denominator:fs.denominator})}function $d(di){var fs=di.units(),cl;if(fs.match(/(deg)[CFRK]/))cl=di.baseScalar;else if(fs==="tempK")cl=di.scalar;else if(fs==="tempC")cl=di.scalar;else if(fs==="tempF")cl=di.scalar*5/9;else if(fs==="tempR")cl=di.scalar*5/9;else throw new ze("Unknown type for temp conversion from: "+fs);return kp({scalar:cl,numerator:["<kelvin>"],denominator:Bn})}function Qd(di,fs){var cl=fs.units(),ih;if(cl==="tempK")ih=di.baseScalar;else if(cl==="tempC")ih=di.baseScalar-273.15;else if(cl==="tempF")ih=di.baseScalar*9/5-459.67;else if(cl==="tempR")ih=di.baseScalar*9/5;else throw new ze("Unknown type for temp conversion to: "+cl);return kp({scalar:ih,numerator:fs.numerator,denominator:fs.denominator})}function Rd(di){var fs=di.units(),cl;if(fs.match(/(deg)[CFRK]/))cl=di.baseScalar;else if(fs==="tempK")cl=di.scalar;else if(fs==="tempC")cl=di.scalar+273.15;else if(fs==="tempF")cl=(di.scalar+459.67)*5/9;else if(fs==="tempR")cl=di.scalar*5/9;else throw new ze("Unknown type for temp conversion from: "+fs);return kp({scalar:cl,numerator:["<temp-K>"],denominator:Bn})}h(kp.prototype,{to:function(di){var fs,cl;if(di==null)return this;if(!e(di))return this.to(di.units());if(fs=this._conversionCache[di],fs)return fs;if(cl=kp(di),cl.units()===this.units())return this;if(!this.isCompatible(cl))this.isInverse(cl)?cl=this.inverse().to(di):Bt(this.units(),cl.units());else if(cl.isTemperature())cl=Qd(this,cl);else if(cl.isDegrees())cl=nd(this,cl);else{var ih=C(this.baseScalar,cl.baseScalar);cl=kp({scalar:ih,numerator:cl.numerator,denominator:cl.denominator})}return this._conversionCache[di]=cl,cl},toBase:function(){if(this.isBase())return this;if(this.isTemperature())return Rd(this);var di=bg[this.units()];return di||(di=Ih(this.numerator,this.denominator),bg[this.units()]=di),di.mul(this.scalar)},toFloat:function(){if(this.isUnitless())return this.scalar;throw new ze("Can't convert to Float unless unitless.  Use Unit#scalar")},toPrec:function(di){if(e(di)&&(di=kp(di)),o(di)&&(di=kp(di+" "+this.units())),this.isUnitless()?di.isUnitless()||Bt(this.units(),di.units()):di=di.to(this.units()),di.scalar===0)throw new ze("Divide by zero");var fs=y(Math.round(this.scalar/di.scalar),di.scalar);return kp(fs+this.units())}});function ng(di,fs){var cl=kp(di),ih=kp(fs);if(cl.eq(ih))return s;var uh;return cl.isTemperature()?uh=function(vh){return cl.mul(vh).to(ih).scalar}:uh=function(vh){return vh*cl.baseScalar/ih.baseScalar},function(Th){var kh,ep,ip;if(Array.isArray(Th)){for(ep=Th.length,ip=[],kh=0;kh<ep;kh++)ip.push(uh(Th[kh]));return ip}else return uh(Th)}}var bg={};function Ih(di,fs){for(var cl=[],ih=[],uh=1,vh,Th=0;Th<di.length;Th++)vh=di[Th],wo[vh]?uh=y(uh,wo[vh]):gl[vh]&&(uh*=gl[vh].scalar,gl[vh].numerator&&cl.push(gl[vh].numerator),gl[vh].denominator&&ih.push(gl[vh].denominator));for(var kh=0;kh<fs.length;kh++)vh=fs[kh],wo[vh]?uh/=wo[vh]:gl[vh]&&(uh/=gl[vh].scalar,gl[vh].numerator&&ih.push(gl[vh].numerator),gl[vh].denominator&&cl.push(gl[vh].denominator));return cl=cl.reduce(function(ep,ip){return ep.concat(ip)},[]),ih=ih.reduce(function(ep,ip){return ep.concat(ip)},[]),kp({scalar:uh,numerator:cl,denominator:ih})}kp.parse=Fd,kp.getUnits=wh,kp.getAliases=Fh,kp.mulSafe=y,kp.divSafe=C,kp.getKinds=xd,kp.swiftConverter=ng,kp.Error=ze,h(kp.prototype,{add:function(di){if(e(di)&&(di=kp(di)),this.isCompatible(di)||Bt(this.units(),di.units()),this.isTemperature()&&di.isTemperature())throw new ze("Cannot add two temperatures");return this.isTemperature()?Ep(this,di):di.isTemperature()?Ep(di,this):kp({scalar:this.scalar+di.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},sub:function(di){if(e(di)&&(di=kp(di)),this.isCompatible(di)||Bt(this.units(),di.units()),this.isTemperature()&&di.isTemperature())return Ed(this,di);if(this.isTemperature())return Vd(this,di);if(di.isTemperature())throw new ze("Cannot subtract a temperature from a differential degree unit");return kp({scalar:this.scalar-di.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},mul:function(di){if(o(di))return kp({scalar:y(this.scalar,di),numerator:this.numerator,denominator:this.denominator});if(e(di)&&(di=kp(di)),(this.isTemperature()||di.isTemperature())&&!(this.isUnitless()||di.isUnitless()))throw new ze("Cannot multiply by temperatures");var fs=this,cl=di;fs.isCompatible(cl)&&fs.signature!==400&&(cl=cl.to(fs));var ih=nh(fs.numerator,fs.denominator,cl.numerator,cl.denominator);return kp({scalar:y(fs.scalar,cl.scalar,ih[2]),numerator:ih[0],denominator:ih[1]})},div:function(di){if(o(di)){if(di===0)throw new ze("Divide by zero");return kp({scalar:this.scalar/di,numerator:this.numerator,denominator:this.denominator})}else e(di)&&(di=kp(di));if(di.scalar===0)throw new ze("Divide by zero");if(di.isTemperature())throw new ze("Cannot divide with temperatures");if(this.isTemperature()&&!di.isUnitless())throw new ze("Cannot divide with temperatures");var fs=this,cl=di;fs.isCompatible(cl)&&fs.signature!==400&&(cl=cl.to(fs));var ih=nh(fs.numerator,fs.denominator,cl.denominator,cl.numerator);return kp({scalar:y(fs.scalar,ih[2])/cl.scalar,numerator:ih[0],denominator:ih[1]})},inverse:function(){if(this.isTemperature())throw new ze("Cannot divide with temperatures");if(this.scalar===0)throw new ze("Divide by zero");return kp({scalar:1/this.scalar,numerator:this.denominator,denominator:this.numerator})}});function nh(di,fs,cl,ih){function uh(qp){return qp!==yi}di=di.filter(uh),cl=cl.filter(uh),fs=fs.filter(uh),ih=ih.filter(uh);var vh={};function Th(qp,wd){for(var dd,Wd,Vf,Wf=0;Wf<qp.length;Wf++)if(wo[qp[Wf]]?(dd=qp[Wf+1],Wd=qp[Wf],Vf=wo[Wd],Wf++):(dd=qp[Wf],Wd=null,Vf=1),dd&&dd!==yi)if(vh[dd]){vh[dd][0]+=wd;var pg=vh[dd][2]?wo[vh[dd][2]]:1;vh[dd][wd===1?3:4]*=C(Vf,pg)}else vh[dd]=[wd,dd,Wd,1,1]}Th(di,1),Th(fs,-1),Th(cl,1),Th(ih,-1);var kh=[],ep=[],ip=1;for(var _p in vh)if(vh.hasOwnProperty(_p)){var rd=vh[_p],Dd;if(rd[0]>0)for(Dd=0;Dd<rd[0];Dd++)kh.push(rd[2]===null?rd[1]:[rd[2],rd[1]]);else if(rd[0]<0)for(Dd=0;Dd<-rd[0];Dd++)ep.push(rd[2]===null?rd[1]:[rd[2],rd[1]]);ip*=C(rd[3],rd[4])}return kh.length===0&&(kh=Bn),ep.length===0&&(ep=Bn),kh=kh.reduce(function(qp,wd){return qp.concat(wd)},[]),ep=ep.reduce(function(qp,wd){return qp.concat(wd)},[]),[kh,ep,ip]}h(kp.prototype,{eq:function(di){return this.compareTo(di)===0},lt:function(di){return this.compareTo(di)===-1},lte:function(di){return this.eq(di)||this.lt(di)},gt:function(di){return this.compareTo(di)===1},gte:function(di){return this.eq(di)||this.gt(di)},compareTo:function(di){if(e(di))return this.compareTo(kp(di));if(this.isCompatible(di)||Bt(this.units(),di.units()),this.baseScalar<di.baseScalar)return-1;if(this.baseScalar===di.baseScalar)return 0;if(this.baseScalar>di.baseScalar)return 1},same:function(di){return this.scalar===di.scalar&&this.units()===di.units()}}),h(kp.prototype,{isUnitless:function(){return[this.numerator,this.denominator].every(function(di){return a(di,Bn)})},isCompatible:function(di){return e(di)?this.isCompatible(kp(di)):yd(di)&&di.signature!==void 0?this.signature===di.signature:!1},isInverse:function(di){return this.inverse().isCompatible(di)},isBase:function(){return this._isBase!==void 0?this._isBase:this.isDegrees()&&this.numerator[0].match(/<(kelvin|temp-K)>/)?(this._isBase=!0,this._isBase):(this.numerator.concat(this.denominator).forEach(function(di){di!==yi&&Wr.indexOf(di)===-1&&(this._isBase=!1)},this),this._isBase===!1?this._isBase:(this._isBase=!0,this._isBase))}});function sh(){}sh.prototype.get=function(di){return arguments.length>1&&(di=Array.apply(null,arguments)),di.reduce(function(fs,cl,ih){if(fs){var uh=fs[cl];return ih===di.length-1?uh?uh.data:void 0:uh}},this)},sh.prototype.set=function(di,fs){return arguments.length>2&&(di=Array.prototype.slice.call(arguments,0,-1),fs=arguments[arguments.length-1]),di.reduce(function(cl,ih,uh){var vh=cl[ih];return vh===void 0&&(vh=cl[ih]={}),uh===di.length-1?(vh.data=fs,fs):vh},this)};function oh(di,fs){return(di+" "+fs).trim()}kp.formatter=oh,h(kp.prototype,{units:function(){if(this._units!==void 0)return this._units;var di=a(this.numerator,Bn),fs=a(this.denominator,Bn);if(di&&fs)return this._units="",this._units;var cl=Uh(this.numerator),ih=Uh(this.denominator);return this._units=cl+(fs?"":"/"+ih),this._units},toString:function(di,fs){var cl;if(o(di))cl=this.units(),fs=di;else if(e(di))cl=di;else if(yd(di))return this.toPrec(di).toString(fs);var ih=this.to(cl),uh=fs!==void 0?L(ih.scalar,fs):ih.scalar;return ih=(uh+" "+ih.units()).trim(),ih},format:function(di,fs){arguments.length===1&&typeof di=="function"&&(fs=di,di=void 0),fs=fs||kp.formatter;var cl=this.to(di);return fs.call(this,cl.scalar,cl.units())}});var Oh=new sh;function Uh(di){var fs=Oh.get(di);if(fs)return fs;var cl=a(di,Bn);return cl?fs="1":fs=gs(vl(di)).join("*"),Oh.set(di,fs),fs}function vl(di){for(var fs=[],cl,ih,uh=0;uh<di.length;uh++)cl=di[uh],ih=di[uh+1],wo[cl]?(fs.push(il[cl]+il[ih]),uh++):fs.push(il[cl]);return fs}function gs(di){var fs=di.reduce(function(cl,ih){var uh=cl[ih];return uh||cl.push(uh=cl[ih]=[ih,0]),uh[1]++,cl},[]);return fs.map(function(cl){return cl[0]+(cl[1]>1?cl[1]:"")})}return kp.version="1.7.6",kp})})(quantities);var quantitiesExports=quantities.exports;const Qty=getDefaultExportFromCjs(quantitiesExports);function deepValue(n,t=""){let e=t.split(".");for(let r of e){if(n[r]===void 0)return;n=n[r]}return n}var orientation={exports:{}},twoProduct_1=twoProduct$1,SPLITTER=+(Math.pow(2,27)+1);function twoProduct$1(n,t,e){var r=n*t,o=SPLITTER*n,s=o-n,l=o-s,a=n-l,h=SPLITTER*t,y=h-t,C=h-y,L=t-C,Y=r-l*C,ze=Y-a*C,Bt=ze-l*L,Ir=a*L-Bt;return e?(e[0]=Ir,e[1]=r,e):[Ir,r]}var robustSum=linearExpansionSum;function scalarScalar$1(n,t){var e=n+t,r=e-n,o=e-r,s=t-r,l=n-o,a=l+s;return a?[a,e]:[e]}function linearExpansionSum(n,t){var e=n.length|0,r=t.length|0;if(e===1&&r===1)return scalarScalar$1(n[0],t[0]);var o=e+r,s=new Array(o),l=0,a=0,h=0,y=Math.abs,C=n[a],L=y(C),Y=t[h],ze=y(Y),Bt,Ir;L<ze?(Ir=C,a+=1,a<e&&(C=n[a],L=y(C))):(Ir=Y,h+=1,h<r&&(Y=t[h],ze=y(Y))),a<e&&L<ze||h>=r?(Bt=C,a+=1,a<e&&(C=n[a],L=y(C))):(Bt=Y,h+=1,h<r&&(Y=t[h],ze=y(Y)));for(var Wr=Bt+Ir,yi=Wr-Bt,Bn=Ir-yi,vi=Bn,wo=Wr,ia,gl,ml,il,sl;a<e&&h<r;)L<ze?(Bt=C,a+=1,a<e&&(C=n[a],L=y(C))):(Bt=Y,h+=1,h<r&&(Y=t[h],ze=y(Y))),Ir=vi,Wr=Bt+Ir,yi=Wr-Bt,Bn=Ir-yi,Bn&&(s[l++]=Bn),ia=wo+Wr,gl=ia-wo,ml=ia-gl,il=Wr-gl,sl=wo-ml,vi=sl+il,wo=ia;for(;a<e;)Bt=C,Ir=vi,Wr=Bt+Ir,yi=Wr-Bt,Bn=Ir-yi,Bn&&(s[l++]=Bn),ia=wo+Wr,gl=ia-wo,ml=ia-gl,il=Wr-gl,sl=wo-ml,vi=sl+il,wo=ia,a+=1,a<e&&(C=n[a]);for(;h<r;)Bt=Y,Ir=vi,Wr=Bt+Ir,yi=Wr-Bt,Bn=Ir-yi,Bn&&(s[l++]=Bn),ia=wo+Wr,gl=ia-wo,ml=ia-gl,il=Wr-gl,sl=wo-ml,vi=sl+il,wo=ia,h+=1,h<r&&(Y=t[h]);return vi&&(s[l++]=vi),wo&&(s[l++]=wo),l||(s[l++]=0),s.length=l,s}var twoSum$1=fastTwoSum;function fastTwoSum(n,t,e){var r=n+t,o=r-n,s=r-o,l=t-o,a=n-s;return e?(e[0]=a+l,e[1]=r,e):[a+l,r]}var twoProduct=twoProduct_1,twoSum=twoSum$1,robustScale=scaleLinearExpansion;function scaleLinearExpansion(n,t){var e=n.length;if(e===1){var r=twoProduct(n[0],t);return r[0]?r:[r[1]]}var o=new Array(2*e),s=[.1,.1],l=[.1,.1],a=0;twoProduct(n[0],t,s),s[0]&&(o[a++]=s[0]);for(var h=1;h<e;++h){twoProduct(n[h],t,l);var y=s[1];twoSum(y,l[0],s),s[0]&&(o[a++]=s[0]);var C=l[1],L=s[1],Y=C+L,ze=Y-C,Bt=L-ze;s[1]=Y,Bt&&(o[a++]=Bt)}return s[1]&&(o[a++]=s[1]),a===0&&(o[a++]=0),o.length=a,o}var robustDiff=robustSubtract;function scalarScalar(n,t){var e=n+t,r=e-n,o=e-r,s=t-r,l=n-o,a=l+s;return a?[a,e]:[e]}function robustSubtract(n,t){var e=n.length|0,r=t.length|0;if(e===1&&r===1)return scalarScalar(n[0],-t[0]);var o=e+r,s=new Array(o),l=0,a=0,h=0,y=Math.abs,C=n[a],L=y(C),Y=-t[h],ze=y(Y),Bt,Ir;L<ze?(Ir=C,a+=1,a<e&&(C=n[a],L=y(C))):(Ir=Y,h+=1,h<r&&(Y=-t[h],ze=y(Y))),a<e&&L<ze||h>=r?(Bt=C,a+=1,a<e&&(C=n[a],L=y(C))):(Bt=Y,h+=1,h<r&&(Y=-t[h],ze=y(Y)));for(var Wr=Bt+Ir,yi=Wr-Bt,Bn=Ir-yi,vi=Bn,wo=Wr,ia,gl,ml,il,sl;a<e&&h<r;)L<ze?(Bt=C,a+=1,a<e&&(C=n[a],L=y(C))):(Bt=Y,h+=1,h<r&&(Y=-t[h],ze=y(Y))),Ir=vi,Wr=Bt+Ir,yi=Wr-Bt,Bn=Ir-yi,Bn&&(s[l++]=Bn),ia=wo+Wr,gl=ia-wo,ml=ia-gl,il=Wr-gl,sl=wo-ml,vi=sl+il,wo=ia;for(;a<e;)Bt=C,Ir=vi,Wr=Bt+Ir,yi=Wr-Bt,Bn=Ir-yi,Bn&&(s[l++]=Bn),ia=wo+Wr,gl=ia-wo,ml=ia-gl,il=Wr-gl,sl=wo-ml,vi=sl+il,wo=ia,a+=1,a<e&&(C=n[a]);for(;h<r;)Bt=Y,Ir=vi,Wr=Bt+Ir,yi=Wr-Bt,Bn=Ir-yi,Bn&&(s[l++]=Bn),ia=wo+Wr,gl=ia-wo,ml=ia-gl,il=Wr-gl,sl=wo-ml,vi=sl+il,wo=ia,h+=1,h<r&&(Y=-t[h]);return vi&&(s[l++]=vi),wo&&(s[l++]=wo),l||(s[l++]=0),s.length=l,s}(function(n){var t=twoProduct_1,e=robustSum,r=robustScale,o=robustDiff,s=5,l=11102230246251565e-32,a=(3+16*l)*l,h=(7+56*l)*l;function y(vi,wo,ia,gl){return function(il,sl,ol){var _l=vi(vi(wo(sl[1],ol[0]),wo(-ol[1],sl[0])),vi(wo(il[1],sl[0]),wo(-sl[1],il[0]))),rh=vi(wo(il[1],ol[0]),wo(-ol[1],il[0])),wh=gl(_l,rh);return wh[wh.length-1]}}function C(vi,wo,ia,gl){return function(il,sl,ol,_l){var rh=vi(vi(ia(vi(wo(ol[1],_l[0]),wo(-_l[1],ol[0])),sl[2]),vi(ia(vi(wo(sl[1],_l[0]),wo(-_l[1],sl[0])),-ol[2]),ia(vi(wo(sl[1],ol[0]),wo(-ol[1],sl[0])),_l[2]))),vi(ia(vi(wo(sl[1],_l[0]),wo(-_l[1],sl[0])),il[2]),vi(ia(vi(wo(il[1],_l[0]),wo(-_l[1],il[0])),-sl[2]),ia(vi(wo(il[1],sl[0]),wo(-sl[1],il[0])),_l[2])))),wh=vi(vi(ia(vi(wo(ol[1],_l[0]),wo(-_l[1],ol[0])),il[2]),vi(ia(vi(wo(il[1],_l[0]),wo(-_l[1],il[0])),-ol[2]),ia(vi(wo(il[1],ol[0]),wo(-ol[1],il[0])),_l[2]))),vi(ia(vi(wo(sl[1],ol[0]),wo(-ol[1],sl[0])),il[2]),vi(ia(vi(wo(il[1],ol[0]),wo(-ol[1],il[0])),-sl[2]),ia(vi(wo(il[1],sl[0]),wo(-sl[1],il[0])),ol[2])))),Fh=gl(rh,wh);return Fh[Fh.length-1]}}function L(vi,wo,ia,gl){return function(il,sl,ol,_l,rh){var wh=vi(vi(vi(ia(vi(ia(vi(wo(_l[1],rh[0]),wo(-rh[1],_l[0])),ol[2]),vi(ia(vi(wo(ol[1],rh[0]),wo(-rh[1],ol[0])),-_l[2]),ia(vi(wo(ol[1],_l[0]),wo(-_l[1],ol[0])),rh[2]))),sl[3]),vi(ia(vi(ia(vi(wo(_l[1],rh[0]),wo(-rh[1],_l[0])),sl[2]),vi(ia(vi(wo(sl[1],rh[0]),wo(-rh[1],sl[0])),-_l[2]),ia(vi(wo(sl[1],_l[0]),wo(-_l[1],sl[0])),rh[2]))),-ol[3]),ia(vi(ia(vi(wo(ol[1],rh[0]),wo(-rh[1],ol[0])),sl[2]),vi(ia(vi(wo(sl[1],rh[0]),wo(-rh[1],sl[0])),-ol[2]),ia(vi(wo(sl[1],ol[0]),wo(-ol[1],sl[0])),rh[2]))),_l[3]))),vi(ia(vi(ia(vi(wo(ol[1],_l[0]),wo(-_l[1],ol[0])),sl[2]),vi(ia(vi(wo(sl[1],_l[0]),wo(-_l[1],sl[0])),-ol[2]),ia(vi(wo(sl[1],ol[0]),wo(-ol[1],sl[0])),_l[2]))),-rh[3]),vi(ia(vi(ia(vi(wo(_l[1],rh[0]),wo(-rh[1],_l[0])),sl[2]),vi(ia(vi(wo(sl[1],rh[0]),wo(-rh[1],sl[0])),-_l[2]),ia(vi(wo(sl[1],_l[0]),wo(-_l[1],sl[0])),rh[2]))),il[3]),ia(vi(ia(vi(wo(_l[1],rh[0]),wo(-rh[1],_l[0])),il[2]),vi(ia(vi(wo(il[1],rh[0]),wo(-rh[1],il[0])),-_l[2]),ia(vi(wo(il[1],_l[0]),wo(-_l[1],il[0])),rh[2]))),-sl[3])))),vi(vi(ia(vi(ia(vi(wo(sl[1],rh[0]),wo(-rh[1],sl[0])),il[2]),vi(ia(vi(wo(il[1],rh[0]),wo(-rh[1],il[0])),-sl[2]),ia(vi(wo(il[1],sl[0]),wo(-sl[1],il[0])),rh[2]))),_l[3]),vi(ia(vi(ia(vi(wo(sl[1],_l[0]),wo(-_l[1],sl[0])),il[2]),vi(ia(vi(wo(il[1],_l[0]),wo(-_l[1],il[0])),-sl[2]),ia(vi(wo(il[1],sl[0]),wo(-sl[1],il[0])),_l[2]))),-rh[3]),ia(vi(ia(vi(wo(ol[1],_l[0]),wo(-_l[1],ol[0])),sl[2]),vi(ia(vi(wo(sl[1],_l[0]),wo(-_l[1],sl[0])),-ol[2]),ia(vi(wo(sl[1],ol[0]),wo(-ol[1],sl[0])),_l[2]))),il[3]))),vi(ia(vi(ia(vi(wo(ol[1],_l[0]),wo(-_l[1],ol[0])),il[2]),vi(ia(vi(wo(il[1],_l[0]),wo(-_l[1],il[0])),-ol[2]),ia(vi(wo(il[1],ol[0]),wo(-ol[1],il[0])),_l[2]))),-sl[3]),vi(ia(vi(ia(vi(wo(sl[1],_l[0]),wo(-_l[1],sl[0])),il[2]),vi(ia(vi(wo(il[1],_l[0]),wo(-_l[1],il[0])),-sl[2]),ia(vi(wo(il[1],sl[0]),wo(-sl[1],il[0])),_l[2]))),ol[3]),ia(vi(ia(vi(wo(sl[1],ol[0]),wo(-ol[1],sl[0])),il[2]),vi(ia(vi(wo(il[1],ol[0]),wo(-ol[1],il[0])),-sl[2]),ia(vi(wo(il[1],sl[0]),wo(-sl[1],il[0])),ol[2]))),-_l[3]))))),Fh=vi(vi(vi(ia(vi(ia(vi(wo(_l[1],rh[0]),wo(-rh[1],_l[0])),ol[2]),vi(ia(vi(wo(ol[1],rh[0]),wo(-rh[1],ol[0])),-_l[2]),ia(vi(wo(ol[1],_l[0]),wo(-_l[1],ol[0])),rh[2]))),il[3]),ia(vi(ia(vi(wo(_l[1],rh[0]),wo(-rh[1],_l[0])),il[2]),vi(ia(vi(wo(il[1],rh[0]),wo(-rh[1],il[0])),-_l[2]),ia(vi(wo(il[1],_l[0]),wo(-_l[1],il[0])),rh[2]))),-ol[3])),vi(ia(vi(ia(vi(wo(ol[1],rh[0]),wo(-rh[1],ol[0])),il[2]),vi(ia(vi(wo(il[1],rh[0]),wo(-rh[1],il[0])),-ol[2]),ia(vi(wo(il[1],ol[0]),wo(-ol[1],il[0])),rh[2]))),_l[3]),ia(vi(ia(vi(wo(ol[1],_l[0]),wo(-_l[1],ol[0])),il[2]),vi(ia(vi(wo(il[1],_l[0]),wo(-_l[1],il[0])),-ol[2]),ia(vi(wo(il[1],ol[0]),wo(-ol[1],il[0])),_l[2]))),-rh[3]))),vi(vi(ia(vi(ia(vi(wo(ol[1],rh[0]),wo(-rh[1],ol[0])),sl[2]),vi(ia(vi(wo(sl[1],rh[0]),wo(-rh[1],sl[0])),-ol[2]),ia(vi(wo(sl[1],ol[0]),wo(-ol[1],sl[0])),rh[2]))),il[3]),ia(vi(ia(vi(wo(ol[1],rh[0]),wo(-rh[1],ol[0])),il[2]),vi(ia(vi(wo(il[1],rh[0]),wo(-rh[1],il[0])),-ol[2]),ia(vi(wo(il[1],ol[0]),wo(-ol[1],il[0])),rh[2]))),-sl[3])),vi(ia(vi(ia(vi(wo(sl[1],rh[0]),wo(-rh[1],sl[0])),il[2]),vi(ia(vi(wo(il[1],rh[0]),wo(-rh[1],il[0])),-sl[2]),ia(vi(wo(il[1],sl[0]),wo(-sl[1],il[0])),rh[2]))),ol[3]),ia(vi(ia(vi(wo(sl[1],ol[0]),wo(-ol[1],sl[0])),il[2]),vi(ia(vi(wo(il[1],ol[0]),wo(-ol[1],il[0])),-sl[2]),ia(vi(wo(il[1],sl[0]),wo(-sl[1],il[0])),ol[2]))),-rh[3])))),Mh=gl(wh,Fh);return Mh[Mh.length-1]}}function Y(vi){var wo=vi===3?y:vi===4?C:L;return wo(e,t,r,o)}var ze=Y(3),Bt=Y(4),Ir=[function(){return 0},function(){return 0},function(wo,ia){return ia[0]-wo[0]},function(wo,ia,gl){var ml=(wo[1]-gl[1])*(ia[0]-gl[0]),il=(wo[0]-gl[0])*(ia[1]-gl[1]),sl=ml-il,ol;if(ml>0){if(il<=0)return sl;ol=ml+il}else if(ml<0){if(il>=0)return sl;ol=-(ml+il)}else return sl;var _l=a*ol;return sl>=_l||sl<=-_l?sl:ze(wo,ia,gl)},function(wo,ia,gl,ml){var il=wo[0]-ml[0],sl=ia[0]-ml[0],ol=gl[0]-ml[0],_l=wo[1]-ml[1],rh=ia[1]-ml[1],wh=gl[1]-ml[1],Fh=wo[2]-ml[2],Mh=ia[2]-ml[2],vp=gl[2]-ml[2],gp=sl*wh,Jh=ol*rh,Lp=ol*_l,Ip=il*wh,$p=il*rh,Xp=sl*_l,Cp=Fh*(gp-Jh)+Mh*(Lp-Ip)+vp*($p-Xp),Gp=(Math.abs(gp)+Math.abs(Jh))*Math.abs(Fh)+(Math.abs(Lp)+Math.abs(Ip))*Math.abs(Mh)+(Math.abs($p)+Math.abs(Xp))*Math.abs(vp),Rp=h*Gp;return Cp>Rp||-Cp>Rp?Cp:Bt(wo,ia,gl,ml)}];function Wr(vi){var wo=Ir[vi.length];return wo||(wo=Ir[vi.length]=Y(vi.length)),wo.apply(void 0,vi)}function yi(vi,wo,ia,gl,ml,il,sl){return function(_l,rh,wh,Fh,Mh){switch(arguments.length){case 0:case 1:return 0;case 2:return gl(_l,rh);case 3:return ml(_l,rh,wh);case 4:return il(_l,rh,wh,Fh);case 5:return sl(_l,rh,wh,Fh,Mh)}for(var vp=new Array(arguments.length),gp=0;gp<arguments.length;++gp)vp[gp]=arguments[gp];return vi(vp)}}function Bn(){for(;Ir.length<=s;)Ir.push(Y(Ir.length));n.exports=yi.apply(void 0,[Wr].concat(Ir));for(var vi=0;vi<=s;++vi)n.exports[vi]=Ir[vi]}Bn()})(orientation);var orientationExports=orientation.exports,robustPnp=robustPointInPolygon,orient=orientationExports;function robustPointInPolygon(n,t){for(var e=t[0],r=t[1],o=n.length,s=1,l=o,a=0,h=o-1;a<l;h=a++){var y=n[a],C=n[h],L=y[1],Y=C[1];if(Y<L){if(Y<r&&r<L){var ze=orient(y,C,t);if(ze===0)return 0;s^=0<ze|0}else if(r===L){var Bt=n[(a+1)%o],Ir=Bt[1];if(L<Ir){var ze=orient(y,C,t);if(ze===0)return 0;s^=0<ze|0}}}else if(L<Y){if(L<r&&r<Y){var ze=orient(y,C,t);if(ze===0)return 0;s^=ze<0|0}else if(r===L){var Bt=n[(a+1)%o],Ir=Bt[1];if(Ir<L){var ze=orient(y,C,t);if(ze===0)return 0;s^=ze<0|0}}}else if(r===L){var Wr=Math.min(y[0],C[0]),yi=Math.max(y[0],C[0]);if(a===0){for(;h>0;){var Bn=(h+o-1)%o,vi=n[Bn];if(vi[1]!==r)break;var wo=vi[0];Wr=Math.min(Wr,wo),yi=Math.max(yi,wo),h=Bn}if(h===0)return Wr<=e&&e<=yi?0:1;l=h+1}for(var ia=n[(h+o-1)%o][1];a+1<l;){var vi=n[a+1];if(vi[1]!==r)break;var wo=vi[0];Wr=Math.min(Wr,wo),yi=Math.max(yi,wo),a+=1}if(Wr<=e&&e<=yi)return 0;var gl=n[(a+1)%o][1];e<Wr&&ia<r!=gl<r&&(s^=1)}}return 2*s-1}const robustPointInPolygon$1=getDefaultExportFromCjs(robustPnp);function feretDiameters(n={}){const{originalPoints:t=monotoneChainConvexHull.call(this)}=n;if(t.length===0)return{min:0,max:0,minLine:[],maxLine:[],aspectRatio:1};if(t.length===1)return{min:1,max:1,minLine:[t[0],t[0]],maxLine:[t[0],t[0]],aspectRatio:1};const e=new Array(t.length);let r=1/0,o=0,s=[];for(let y=0;y<t.length;y++){let C=getAngle(t[y],t[(y+1)%t.length]);rotate(-C,t,e);let L=0,Y=[];for(let ze=0;ze<t.length;ze++){let Bt=Math.abs(e[y][1]-e[ze][1]);Bt>L&&(L=Bt,Y=[],Y.push([e[ze][0],e[y][1]],[e[ze][0],e[ze][1]]))}L<r&&(r=L,o=C,s=Y)}rotate(o,s,s);let l=0,a=[],h=0;for(let y=0;y<t.length-1;y++)for(let C=y+1;C<t.length;C++){let L=(t[y][0]-t[C][0])**2+(t[y][1]-t[C][1])**2;L>h&&(h=L,l=Math.sqrt(L),a=[t[y],t[C]])}return{min:r,minLine:s,max:l,maxLine:a,aspectRatio:r/l}}function getAngle(n,t){let e=difference(t,n),r=normalize(e),o=Math.acos(r[0]);return r[1]<0?-o:o}class Roi{constructor(t,e){this.map=t,this.id=e,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY,this.meanX=0,this.meanY=0,this.surface=0,this.computed={}}getMask(t={}){const{scale:e=1,kind:r=""}=t;let o;switch(r){case"contour":o=this.contourMask;break;case"box":o=this.boxMask;break;case"filled":o=this.filledMask;break;case"center":o=this.centerMask;break;case"mbr":o=this.mbrFilledMask;break;case"hull":o=this.convexHullFilledMask;break;case"hullContour":o=this.convexHullMask;break;case"mbrContour":o=this.mbrMask;break;case"feret":o=this.feretMask;break;default:o=this.mask}return e<1&&(o=o.resize({factor:e}),o.parent=this.mask.parent,o.position[0]+=this.minX,o.position[1]+=this.minY),o}get mean(){throw new Error("Roi mean not implemented yet")}get center(){return this.computed.center||(this.computed.center=[this.width/2>>0,this.height/2>>0]),this.computed.center}get ratio(){return this.width/this.height}get width(){return this.maxX-this.minX+1}get height(){return this.maxY-this.minY+1}_computExternalIDs(){let t=this.borderIDs,e=this.borderLengths;this.computed.externalIDs=[],this.computed.externalLengths=[];let r=this.internalIDs;for(let o=0;o<t.length;o++)r.includes(t[o])||(this.computed.externalIDs.push(t[o]),this.computed.externalLengths.push(e[o]))}get externalIDs(){return this.computed.externalIDs?this.computed.externalIDs:(this._computExternalIDs(),this.computed.externalIDs)}get externalLengths(){return this.computed.externalLengths?this.computed.externalLengths:(this._computExternalIDs(),this.computed.externalLengths)}_computeBorderIDs(){let t=getBorders(this);this.computed.borderIDs=t.ids,this.computed.borderLengths=t.lengths}get borderIDs(){return this.computed.borderIDs?this.computed.borderIDs:(this._computeBorderIDs(),this.computed.borderIDs)}get borderLengths(){return this.computed.borderLengths?this.computed.borderLengths:(this._computeBorderIDs(),this.computed.borderLengths)}get boxIDs(){return this.computed.boxIDs||(this.computed.boxIDs=getBoxIDs(this)),this.computed.boxIDs}get internalIDs(){return this.computed.internalIDs||(this.computed.internalIDs=getInternalIDs(this)),this.computed.internalIDs}get box(){return this.computed.box||(this.computed.box=getBox(this)),this.computed.box}get external(){return this.computed.external||(this.computed.external=getExternal(this)),this.computed.external}get holesInfo(){return this.computed.holesInfo||(this.computed.holesInfo=getHolesInfo(this)),this.computed.holesInfo}get border(){return this.computed.border||(this.computed.border=getBorder(this)),this.computed.border}get contourMask(){if(!this.computed.contourMask){let t=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let e=0;e<this.width;e++)for(let r=0;r<this.height;r++)this.map.data[e+this.minX+(r+this.minY)*this.map.width]===this.id&&(e>0&&e<this.width-1&&r>0&&r<this.height-1?(this.map.data[e-1+this.minX+(r+this.minY)*this.map.width]!==this.id||this.map.data[e+1+this.minX+(r+this.minY)*this.map.width]!==this.id||this.map.data[e+this.minX+(r-1+this.minY)*this.map.width]!==this.id||this.map.data[e+this.minX+(r+1+this.minY)*this.map.width]!==this.id)&&t.setBitXY(e,r):t.setBitXY(e,r));this.computed.contourMask=t}return this.computed.contourMask}get boxMask(){if(!this.computed.boxMask){let t=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let e=0;e<this.width;e++)t.setBitXY(e,0),t.setBitXY(e,this.height-1);for(let e=0;e<this.height;e++)t.setBitXY(0,e),t.setBitXY(this.width-1,e);this.computed.boxMask=t}return this.computed.boxMask}get mask(){if(!this.computed.mask){let t=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let e=0;e<this.width;e++)for(let r=0;r<this.height;r++)this.map.data[e+this.minX+(r+this.minY)*this.map.width]===this.id&&t.setBitXY(e,r);this.computed.mask=t}return this.computed.mask}get filledMask(){if(!this.computed.filledMask){let t=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let e=0;e<this.width;e++)for(let r=0;r<this.height;r++){let o=e+this.minX+(r+this.minY)*this.map.width;this.internalIDs.includes(this.map.data[o])&&t.setBitXY(e,r)}this.computed.filledMask=t}return this.computed.filledMask}get centerMask(){if(!this.computed.centerMask){let t=new Shape({kind:"smallCross"}).getMask();t.parent=this.map.parent,t.position=[this.minX+this.center[0]-1,this.minY+this.center[1]-1],this.computed.centerMask=t}return this.computed.centerMask}get convexHull(){if(!this.computed.convexHull){const t=[];for(let r=0;r<this.width;r++)for(let o=0;o<this.height;o++)this.map.data[r+this.minX+(o+this.minY)*this.map.width]===this.id&&(r>0&&r<this.width-1&&o>0&&o<this.height-1?(this.map.data[r-1+this.minX+(o+this.minY)*this.map.width]!==this.id||this.map.data[r+1+this.minX+(o+this.minY)*this.map.width]!==this.id||this.map.data[r+this.minX+(o-1+this.minY)*this.map.width]!==this.id||this.map.data[r+this.minX+(o+1+this.minY)*this.map.width]!==this.id)&&(t.push([r,o]),t.push([r+1,o]),t.push([r,o+1]),t.push([r+1,o+1])):(t.push([r,o]),t.push([r+1,o]),t.push([r,o+1]),t.push([r+1,o+1])));const e=monotoneChainConvexHull$1(t);this.computed.convexHull={polyline:e,surface:surface(e),perimeter:perimeter(e)}}return this.computed.convexHull}get convexHullMask(){if(!this.computed.convexHullMask){const t=this.convexHull,e=new Image$1(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});e.paintPolyline(t.polyline,{closed:!0}),this.computed.convexHullMask=e}return this.computed.convexHullMask}get convexHullFilledMask(){if(!this.computed.convexHullFilledMask){const t=this.convexHull,e=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let r=0;r<this.width;r++)for(let o=0;o<this.height;o++)robustPointInPolygon$1(t.polyline,[r,o])!==1&&e.setBitXY(r,o);this.computed.convexHullFilledMask=e}return this.computed.convexHullFilledMask}get mbr(){if(!this.computed.mbr){let t=minimalBoundingRectangle({originalPoints:this.convexHull.polyline});if(t.length===0)this.computed.mbr={width:0,height:0,surface:0,perimeter:0,rectangle:t};else{let e=t[0],r=t[1],o=t[2],s=Math.sqrt((e[0]-r[0])**2+(e[1]-r[1])**2),l=Math.sqrt((o[0]-r[0])**2+(o[1]-r[1])**2);this.computed.mbr={width:s,height:l,elongation:1-s/l,aspectRatio:s/l,surface:s*l,perimeter:(s+l)*2,rectangle:t}}}return this.computed.mbr}get fillRatio(){return this.surface/(this.surface+this.holesInfo.surface)}get feretDiameters(){return this.computed.feretDiameters||(this.computed.feretDiameters=feretDiameters({originalPoints:this.convexHull.polyline})),this.computed.feretDiameters}get eqpc(){return this.computed.eqpc||(this.computed.eqpc=2*Math.sqrt(this.surface/Math.PI)),this.computed.eqpc}get perimeterInfo(){return this.computed.perimeterInfo||(this.computed.perimeterInfo=getPerimeterInfo(this)),this.computed.perimeterInfo}get perimeter(){let t=this.perimeterInfo,e=2-Math.sqrt(2);return t.one+t.two*2+t.three*3+t.four*4-e*(t.two+t.three*2+t.four)}get ped(){return this.computed.ped||(this.computed.ped=this.perimeter/Math.PI),this.computed.ped}get feretMask(){if(!this.computed.feretMask){const t=new Image$1(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});t.paintPolyline(this.feretDiameters.minLine),t.paintPolyline(this.feretDiameters.maxLine),this.computed.feretMask=t}return this.computed.feretMask}get mbrMask(){if(!this.computed.mbrMask){let t=round(this.mbr.rectangle);if(t.length>0){const e=minMax(t),r=new Image$1(e[1][0]-e[0][0]+1,e[1][1]-e[0][1]+1,{kind:BINARY,position:[this.minX+e[0][0],this.minY+e[0][1]],parent:this.map.parent});t=moveToZeroZero(t),r.paintPolyline(t,{closed:!0}),this.computed.mbrMask=r}else this.computed.mbrMask=new Image$1(1,1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent})}return this.computed.mbrMask}get mbrFilledMask(){if(!this.computed.mbrFilledMask){const t=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent}),e=this.mask.minimalBoundingRectangle();for(let r=0;r<this.width;r++)for(let o=0;o<this.height;o++)robustPointInPolygon$1(e,[r,o])!==1&&t.setBitXY(r,o);this.computed.mbrFilledMask=t}return this.computed.mbrFilledMask}get points(){if(!this.computed.points){let t=[];for(let e=0;e<this.height;e++)for(let r=0;r<this.width;r++){let o=(e+this.minY)*this.map.width+r+this.minX;this.map.data[o]===this.id&&t.push([r,e])}this.computed.points=t}return this.computed.points}get maxLengthPoints(){if(!this.computed.maxLengthPoints){let t=0,e;const r=this.points;for(let o=0;o<r.length;o++)for(let s=o+1;s<r.length;s++){let l=Math.pow(r[o][0]-r[s][0],2)+Math.pow(r[o][1]-r[s][1],2);l>=t&&(t=l,e=[r[o],r[s]])}this.computed.maxLengthPoints=e}return this.computed.maxLengthPoints}get maxLength(){if(!this.computed.maxLength){let t=Math.sqrt(Math.pow(this.maxLengthPoints[0][0]-this.maxLengthPoints[1][0],2)+Math.pow(this.maxLengthPoints[0][1]-this.maxLengthPoints[1][1],2));this.computed.maxLength=t}return this.computed.maxLength}get roundness(){return 4*this.surface/(Math.PI*this.feretDiameters.max**2)}get sphericity(){return 2*Math.sqrt(this.surface*Math.PI)/this.perimeter}get solidity(){return this.surface/this.convexHull.surface}get angle(){if(!this.computed.angle){let t=this.maxLengthPoints,e=-Math.atan2(t[0][1]-t[1][1],t[0][0]-t[1][0])*180/Math.PI;this.computed.angle=e}return this.computed.angle}toJSON(){return{id:this.id,minX:this.minX,maxX:this.maxX,minY:this.minY,maxY:this.maxY,meanX:this.meanX,meanY:this.meanY,height:this.height,width:this.width,surface:this.surface,mbrWidth:this.mbr.width,mbrHeight:this.mbr.height,mbrSurface:this.mbr.surface,eqpc:this.eqpc,ped:this.ped,feretDiameterMin:this.feretDiameters.min,feretDiameterMax:this.feretDiameters.max,aspectRatio:this.feretDiameters.aspectRatio,fillRatio:this.fillRatio,sphericity:this.sphericity,roundness:this.roundness,solidity:this.solidity,perimeter:this.perimeter}}}function getBorders(n){let t=n.map,e=t.data,r=new Set,o=new Map,s=new Set,l=[1,0,-1,0],a=[0,1,0,-1];for(let C=n.minX;C<=n.maxX;C++)for(let L=n.minY;L<=n.maxY;L++){let Y=C+L*t.width;if(e[Y]===n.id)for(let ze=0;ze<4;ze++){let Bt=C+l[ze],Ir=L+a[ze];if(Bt>=0&&Ir>=0&&Bt<t.width&&Ir<t.height){let Wr=Bt+Ir*t.width;if(e[Wr]!==n.id&&!s.has(Wr)){s.add(Wr),r.add(e[Wr]);let yi=o.get(e[Wr]);yi?o.set(e[Wr],++yi):o.set(e[Wr],1)}}}}let h=Array.from(r),y=h.map(function(C){return o.get(C)});return{ids:h,lengths:y}}function getBoxIDs(n){let t=new Set,e=n.map,r=e.data;for(let o of[0,n.height-1])for(let s=0;s<n.width;s++){let l=(o+n.minY)*e.width+s+n.minX;if(s-n.minX>0&&r[l]===n.id&&r[l-1]!==n.id){let a=r[l-1];t.add(a)}if(e.width-s-n.minX>1&&r[l]===n.id&&r[l+1]!==n.id){let a=r[l+1];t.add(a)}}for(let o of[0,n.width-1])for(let s=0;s<n.height;s++){let l=(s+n.minY)*e.width+o+n.minX;if(s-n.minY>0&&r[l]===n.id&&r[l-e.width]!==n.id){let a=r[l-e.width];t.add(a)}if(e.height-s-n.minY>1&&r[l]===n.id&&r[l+e.width]!==n.id){let a=r[l+e.width];t.add(a)}}return Array.from(t)}function getBox(n){let t=0,e=n.map,r=e.data,o=[0];n.height>1&&(o[1]=n.height-1);for(let l of o)for(let a=1;a<n.width-1;a++){let h=(l+n.minY)*e.width+a+n.minX;r[h]===n.id&&t++}let s=[0];n.width>1&&(s[1]=n.width-1);for(let l of s)for(let a=0;a<n.height;a++){let h=(a+n.minY)*e.width+l+n.minX;r[h]===n.id&&t++}return t}function getBorder(n){let t=0,e=n.map,r=e.data;for(let o=1;o<n.width-1;o++)for(let s=1;s<n.height-1;s++){let l=(s+n.minY)*e.width+o+n.minX;r[l]===n.id&&(r[l-1]!==n.id||r[l+1]!==n.id||r[l-e.width]!==n.id||r[l+e.width]!==n.id)&&t++}return t+n.box}function getPerimeterInfo(n){let t=n.map,e=t.data,r=0,o=0,s=0,l=0;for(let a=0;a<n.width;a++)for(let h=0;h<n.height;h++){let y=(h+n.minY)*t.width+a+n.minX;if(e[y]===n.id){let C=0;switch((a===0||n.externalIDs.includes(e[y-1]))&&C++,(a===n.width-1||n.externalIDs.includes(e[y+1]))&&C++,(h===0||n.externalIDs.includes(e[y-t.width]))&&C++,(h===n.height-1||n.externalIDs.includes(e[y+t.width]))&&C++,C){case 1:r++;break;case 2:o++;break;case 3:s++;break;case 4:l++;break}}}return{one:r,two:o,three:s,four:l}}function getExternal(n){let t=0,e=n.map,r=e.data;for(let o=1;o<n.width-1;o++)for(let s=1;s<n.height-1;s++){let l=(s+n.minY)*e.width+o+n.minX;r[l]===n.id&&(n.externalIDs.includes(r[l-1])||n.externalIDs.includes(r[l+1])||n.externalIDs.includes(r[l-e.width])||n.externalIDs.includes(r[l+e.width]))&&t++}return t+n.box}function getHolesInfo(n){let t=0,e=n.map.width,r=n.map.data;for(let o=1;o<n.width-1;o++)for(let s=1;s<n.height-1;s++){let l=(s+n.minY)*e+o+n.minX;n.internalIDs.includes(r[l])&&r[l]!==n.id&&t++}return{number:n.internalIDs.length-1,surface:t}}function getInternalIDs(n){let t=[n.id],e=n.map,r=e.data;if(n.height>2)for(let s=0;s<n.width;s++){let l=n.minY*e.width+s+n.minX;if(t.includes(r[l])){let a=r[l+e.width];!t.includes(a)&&!n.boxIDs.includes(a)&&t.push(a)}}let o=new Array(4);for(let s=1;s<n.width-1;s++)for(let l=1;l<n.height-1;l++){let a=(l+n.minY)*e.width+s+n.minX;if(t.includes(r[a])){o[0]=r[a-1],o[1]=r[a+1],o[2]=r[a-e.width],o[3]=r[a+e.width];for(let h=0;h<4;h++){let y=o[h];!t.includes(y)&&!n.boxIDs.includes(y)&&t.push(y)}}}return t}class RoiLayer{constructor(t,e){this.roiMap=t,this.options=e,this.roi=this.createRoi()}createRoi(){let t=this.roiMap.data,e={};this.roiMap.positive=0,this.roiMap.negative=0;for(let a=0;a<t.length;a++)t[a]&&!e[t[a]]&&(e[t[a]]=!0,t[a]>0?this.roiMap.positive++:this.roiMap.negative++);let r={};for(let a in e)r[a]=new Roi(this.roiMap,a*1);let o=this.roiMap.width,s=this.roiMap.height;for(let a=0;a<s;a++)for(let h=0;h<o;h++){let y=a*o+h;if(t[y]!==0){const C=t[y],L=r[C];h<L.minX&&(L.minX=h),h>L.maxX&&(L.maxX=h),a<L.minY&&(L.minY=a),a>L.maxY&&(L.maxY=a),L.meanX+=h,L.meanY+=a,L.surface++}}let l=[];for(let a in e)r[a].meanX/=r[a].surface,r[a].meanY/=r[a].surface,l.push(r[a]);return l}}function commonBorderLength(n){let t=n.data,e=[1,0,-1,0],r=[0,1,0,-1],o=n.minMax,s=-o.min,l=o.max+s,a=[];for(let y=0;y<=l;y++)a.push(Object.create(null));for(let y=0;y<n.width;y++)for(let C=0;C<n.height;C++){let L=y+C*n.width,Y=t[L];if(Y!==0){let ze=Object.create(null),Bt=!1;for(let Ir=0;Ir<4;Ir++){let Wr=y+e[Ir],yi=C+r[Ir];if(Wr>=0&&yi>=0&&Wr<n.width&&yi<n.height){let Bn=t[Wr+yi*n.width];Y!==Bn&&(Bt=!0,Bn!==0&&ze[Bn]===void 0&&(ze[Bn]=!0,a[Bn+s][Y]?a[Bn+s][Y]++:a[Bn+s][Y]=1))}else Bt=!0}Bt&&(a[Y+s][Y]?a[Y+s][Y]++:a[Y+s][Y]=1)}}let h={};for(let y=0;y<a.length;y++)Object.keys(a[y]).length>0&&(h[y-s]=a[y]);return h}function mergeRoi(n={}){const{algorithm:t="commonBorderLength",minCommonBorderLength:e=5,maxCommonBorderLength:r=100,minCommonBorderRatio:o=.3,maxCommonBorderRatio:s=1}=n;let l=function(Wr,yi,Bn){return Wr[Bn]>=e&&Wr[Bn]<=r};typeof t=="function"&&(l=t),t.toLowerCase()==="commonborderratio"&&(l=function(Wr,yi,Bn){let vi=Math.min(Wr[Bn]/Wr[yi],1);return vi>=o&&vi<=s});const a=this,h=a.commonBorderLength;let y={},C={};for(let Wr of Object.keys(h)){let yi=h[Wr],Bn=Object.keys(yi);for(let vi of Bn)if(vi!==Wr&&l(yi,Wr,vi)){let wo=vi;C[vi]&&(wo=C[vi]);let ia=Wr;if(C[Wr]&&(ia=C[Wr]),Number(wo)!==ia){let gl=Math.min(wo,ia),ml=Math.max(wo,ia);if(y[gl]||(y[gl]={}),y[gl][ml]=!0,C[ml]=gl,y[ml]){for(let il of Object.keys(y[ml]))y[gl][il]=!0,C[il]=gl;delete y[ml]}}}}let L=a.minMax,Y=-L.min,ze=L.max+Y,Bt=new Array(ze+1).fill(0);for(let Wr of Object.keys(C))Bt[Number(Wr)+Y]=C[Wr];let Ir=a.data;for(let Wr=0;Wr<Ir.length;Wr++){let yi=Ir[Wr];if(yi!==0){let Bn=Bt[yi+Y];Bn!==0&&(Ir[Wr]=Bn)}}return a.computed={},a}class RoiMap{constructor(t,e){this.parent=t,this.width=t.width,this.height=t.height,this.data=e,this.negative=0,this.positive=0}get total(){return this.negative+this.positive}get minMax(){let t=Number.MAX_SAFE_INTEGER,e=Number.MIN_SAFE_INTEGER;for(let r=0;r<this.data.length;r++)this.data[r]<t&&(t=this.data[r]),this.data[r]>e&&(e=this.data[r]);return{min:t,max:e}}get commonBorderLength(){return commonBorderLength(this)}mergeRoi(t={}){return mergeRoi.call(this,t)}mergeRois(t){const e=t[0],r=t.slice(1);for(let o=0;o<this.data.length;o++)r.includes(this.data[o])&&(this.data[o]=e)}rowsInfo(){let t=new Array(this.height),e=0;for(let r=0;r<this.data.length;r+=this.width){let o={row:e,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};t[e++]=o;let s={},l={},a=[],h=this.data[r],y=0;for(let C=r;C<r+this.width;C++){let L=this.data[C];h!==L&&(h=L,a.push(y),y=0),y++,L>0?(o.positivePixel++,s[L]||(s[L]=!0)):L<0?(o.negativePixel++,l[L]||(l[L]=!0)):o.zeroPixel++}a.push(y),o.medianChange=a.sort((C,L)=>C-L)[Math.floor(a.length/2)],o.positiveRoiIDs=Object.keys(s),o.negativeRoiIDs=Object.keys(l),o.positiveRoi=o.positiveRoiIDs.length,o.negativeRoi=o.negativeRoiIDs.length}return t}colsInfo(){let t=new Array(this.width),e=0;for(let r=0;r<this.width;r++){let o={col:e,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};t[e++]=o;let s={},l={},a=[],h=this.data[r],y=0;for(let C=r;C<r+this.data.length;C+=this.width){let L=this.data[C];h!==L&&(h=L,a.push(y),y=0),y++,L>0?(o.positivePixel++,s[L]||(s[L]=!0)):L<0?(o.negativePixel++,l[L]||(l[L]=!0)):o.zeroPixel++}a.push(y),o.medianChange=a.sort((C,L)=>C-L)[Math.floor(a.length/2)],o.positiveRoiIDs=Object.keys(s),o.negativeRoiIDs=Object.keys(l),o.positiveRoi=o.positiveRoiIDs.length,o.negativeRoi=o.negativeRoiIDs.length}return t}}function fromMask(n,t={}){const{allowCorners:e=!1}=t,r=65535;let o=new Int16Array(n.size),s=0,l=0,a=new Uint16Array(r+1),h=new Uint16Array(r+1);for(let C=0;C<n.width;C++)for(let L=0;L<n.height;L++)o[L*n.width+C]===0&&y(C,L);function y(C,L){let Y=0,ze=0,Bt=n.getBitXY(C,L),Ir=Bt?++s:--l;if(s>32767||l<-32768)throw new Error("Too many regions of interest");for(a[0]=C,h[0]=L;Y<=ze;){let Wr=a[Y&r],yi=h[Y&r];if(o[yi*n.width+Wr]=Ir,Wr>0&&o[yi*n.width+Wr-1]===0&&n.getBitXY(Wr-1,yi)===Bt&&(ze++,a[ze&r]=Wr-1,h[ze&r]=yi,o[yi*n.width+Wr-1]=-32768),yi>0&&o[(yi-1)*n.width+Wr]===0&&n.getBitXY(Wr,yi-1)===Bt&&(ze++,a[ze&r]=Wr,h[ze&r]=yi-1,o[(yi-1)*n.width+Wr]=-32768),Wr<n.width-1&&o[yi*n.width+Wr+1]===0&&n.getBitXY(Wr+1,yi)===Bt&&(ze++,a[ze&r]=Wr+1,h[ze&r]=yi,o[yi*n.width+Wr+1]=-32768),yi<n.height-1&&o[(yi+1)*n.width+Wr]===0&&n.getBitXY(Wr,yi+1)===Bt&&(ze++,a[ze&r]=Wr,h[ze&r]=yi+1,o[(yi+1)*n.width+Wr]=-32768),e&&(Wr>0&&yi>0&&o[(yi-1)*n.width+Wr-1]===0&&n.getBitXY(Wr-1,yi-1)===Bt&&(ze++,a[ze&r]=Wr-1,h[ze&r]=yi-1,o[(yi-1)*n.width+Wr-1]=-32768),Wr<n.width-1&&yi>0&&o[(yi-1)*n.width+Wr+1]===0&&n.getBitXY(Wr+1,yi-1)===Bt&&(ze++,a[ze&r]=Wr+1,h[ze&r]=yi-1,o[(yi-1)*n.width+Wr+1]=-32768),Wr>0&&yi<n.height-1&&o[(yi+1)*n.width+Wr-1]===0&&n.getBitXY(Wr-1,yi+1)===Bt&&(ze++,a[ze&r]=Wr-1,h[ze&r]=yi+1,o[(yi+1)*n.width+Wr-1]=-32768),Wr<n.width-1&&yi<n.height-1&&o[(yi+1)*n.width+Wr+1]===0&&n.getBitXY(Wr+1,yi+1)===Bt&&(ze++,a[ze&r]=Wr+1,h[ze&r]=yi+1,o[(yi+1)*n.width+Wr+1]=-32768)),Y++,ze-Y>r)throw new Error("analyseMask can not finish, the array to manage internal data is not big enough.You could improve mask by changing MAX_ARRAY")}}return new RoiMap(n,o)}class DisjointSet{constructor(){this.nodes=new Map}add(t){var e=this.nodes.get(t);return e||(e=new DisjointSetNode(t),this.nodes.set(t,e)),e}union(t,e){const r=this.find(t),o=this.find(e);r!==o&&(r.rank<o.rank?r.parent=o:r.rank>o.rank?o.parent=r:(o.parent=r,r.rank++))}find(t){for(var e=t;e.parent!==null;)e=e.parent;for(var r=t;r.parent!==null;){var o=r;r=r.parent,o.parent=e}return e}connected(t,e){return this.find(t)===this.find(e)}}var DisjointSet_1=DisjointSet;function DisjointSetNode(n){this.value=n,this.parent=null,this.rank=0}const DisjointSet$1=getDefaultExportFromCjs(DisjointSet_1),direction4X=[-1,0],direction4Y=[0,-1],neighbours4=[null,null],direction8X=[-1,-1,0,1],direction8Y=[0,-1,-1,-1],neighbours8=[null,null,null,null];function fromMaskConnectedComponentLabelingAlgorithm(n,t={}){const{allowCorners:e=!1}=t;let r=4;e&&(r=8);let o,s,l;if(r===8)o=direction8X,s=direction8Y,l=neighbours8;else if(r===4)o=direction4X,s=direction4Y,l=neighbours4;else throw new RangeError(`unsupported neighbours count: ${r}`);const a=n.size,h=n.width,y=n.height,C=new Array(a),L=new Uint32Array(a),Y=new DisjointSet$1;let ze=1;for(let Bt=0;Bt<y;Bt++)for(let Ir=0;Ir<h;Ir++){const Wr=Ir+Bt*h;if(n.getBit(Wr)){let yi=null;for(let Bn=0;Bn<l.length;Bn++){const vi=Ir+o[Bn],wo=Bt+s[Bn];if(vi>=0&&wo>=0&&vi<h&&wo<y){const ia=vi+wo*h;let gl=C[ia];gl?(l[Bn]=gl,(!yi||l[Bn].value<yi.value)&&(yi=l[Bn])):l[Bn]=null}}if(!yi)C[Wr]=Y.add(ze++);else{C[Wr]=yi;for(let Bn=0;Bn<l.length;Bn++)l[Bn]&&l[Bn]!==yi&&Y.union(yi,l[Bn])}}}for(let Bt=0;Bt<y;Bt++)for(let Ir=0;Ir<h;Ir++){const Wr=Ir+Bt*h;n.getBit(Wr)&&(L[Wr]=Y.find(C[Wr]).value)}return new RoiMap(n,L)}function fromMaxima(n={}){let{allowCorner:t=!0,onlyTop:e=!1,invert:r=!1}=n,o=this;o.checkProcessable("fromMaxima",{components:[1]});const s=1,l=2;let a=0,h=0,y=new Int16Array(o.size),C=new Int8Array(o.size),L=new Float32Array(o.size),Y=1048575,ze=new Uint16Array(Y+1),Bt=new Uint16Array(Y+1),Ir=0,Wr=0,yi=new Uint16Array(Y+1),Bn=new Uint16Array(Y+1),vi=0,wo=0;for(ia(o);Ir<Wr;){let il=ze[Ir&Y],sl=Bt[Ir&Y];ml(il,sl,l),Ir++}return new RoiMap(o,y);function ia({maxima:il=!0}){for(let sl=1;sl<o.height-1;sl++)for(let ol=1;ol<o.width-1;ol++){let _l=ol+sl*o.width;if(C[_l]===0){let rh=il?o.data[_l]:-o.data[ol+sl*o.width];if(o.data[sl*o.width+ol-1]>rh||o.data[sl*o.width+ol+1]>rh||o.data[(sl-1)*o.width+ol]>rh||o.data[(sl+1)*o.width+ol]>rh||t&&(o.data[(sl-1)*o.width+ol-1]>rh||o.data[(sl-1)*o.width+ol+1]>rh||o.data[(sl+1)*o.width+ol-1]>rh||o.data[(sl+1)*o.width+ol+1]>rh))continue;y[_l]=il?++a:--h,gl(ol,sl)||(il?--a:++h)}}}function gl(il,sl){let ol=Wr;vi=0,wo=1,yi[0]=il,Bn[0]=sl;let _l=!0;for(;vi<wo;){let rh=yi[vi&Y],wh=Bn[vi&Y];_l&=ml(rh,wh,s),vi++}if(!_l){for(let rh=0;rh<wo;rh++){let wh=yi[rh&Y],Mh=Bn[rh&Y]*o.width+wh;y[Mh]=0}Wr=ol}return _l}function ml(il,sl,ol){let _l=y[sl*o.width+il],rh=o.data[sl*o.width+il];for(let wh=sl-1;wh<=sl+1;wh++)for(let Fh=il-1;Fh<=il+1;Fh++){let Mh=wh*o.width+Fh;if(C[Mh]===0)switch(C[Mh]=1,L[Mh]=o.data[Mh]-rh,ol){case s:if(L[Mh]===0){if(Fh===0||wh===0||Fh===o.width-1||wh===o.height-1)return!1;y[Mh]=_l,yi[wo&Y]=Fh,Bn[wo&Y]=wh,wo++}else{if(L[Mh]>0)return!1;e||(y[Mh]=_l,ze[Wr&Y]=Fh,Bt[Wr&Y]=wh,Wr++)}break;case l:L[Mh]<=0&&(y[Mh]=_l,ze[Wr&Y]=Fh,Bt[Wr&Y]=wh,Wr++);break;default:throw new Error("unreachable")}}return!0}}function fromPoints(n,t={}){let e=new Shape(t),r=new Int16Array(this.size),o=0,s=e.getPoints();for(let l=0;l<n.length;l++){o++;let a=n[l][0],h=n[l][1];for(let y=0;y<s.length;y++){let C=s[y][0],L=s[y][1];a+C>=0&&h+L>=0&&a+C<this.width&&h+L<this.height&&(r[a+C+(h+L)*this.width]=o)}}return new RoiMap(this,r)}function commonjsRequire(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var priorityQueue={exports:{}};(function(n,t){(function(e){n.exports=e()})(function(){return function e(r,o,s){function l(y,C){if(!o[y]){if(!r[y]){var L=typeof commonjsRequire=="function"&&commonjsRequire;if(!C&&L)return L(y,!0);if(a)return a(y,!0);var Y=new Error("Cannot find module '"+y+"'");throw Y.code="MODULE_NOT_FOUND",Y}var ze=o[y]={exports:{}};r[y][0].call(ze.exports,function(Bt){var Ir=r[y][1][Bt];return l(Ir||Bt)},ze,ze.exports,e,r,o,s)}return o[y].exports}for(var a=typeof commonjsRequire=="function"&&commonjsRequire,h=0;h<s.length;h++)l(s[h]);return l}({1:[function(e,r,o){var s,l,a,h,y,C=function(Y,ze){for(var Bt in ze)L.call(ze,Bt)&&(Y[Bt]=ze[Bt]);function Ir(){this.constructor=Y}return Ir.prototype=ze.prototype,Y.prototype=new Ir,Y.__super__=ze.prototype,Y},L={}.hasOwnProperty;s=e("./PriorityQueue/AbstractPriorityQueue"),l=e("./PriorityQueue/ArrayStrategy"),h=e("./PriorityQueue/BinaryHeapStrategy"),a=e("./PriorityQueue/BHeapStrategy"),y=function(Y){C(ze,Y);function ze(Bt){Bt||(Bt={}),Bt.strategy||(Bt.strategy=h),Bt.comparator||(Bt.comparator=function(Ir,Wr){return(Ir||0)-(Wr||0)}),ze.__super__.constructor.call(this,Bt)}return ze}(s),y.ArrayStrategy=l,y.BinaryHeapStrategy=h,y.BHeapStrategy=a,r.exports=y},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(e,r,o){r.exports=function(){function s(l){var a;if((l!=null?l.strategy:void 0)==null)throw"Must pass options.strategy, a strategy";if((l!=null?l.comparator:void 0)==null)throw"Must pass options.comparator, a comparator";this.priv=new l.strategy(l),this.length=(l!=null&&(a=l.initialValues)!=null?a.length:void 0)||0}return s.prototype.queue=function(l){this.length++,this.priv.queue(l)},s.prototype.dequeue=function(l){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},s.prototype.peek=function(l){if(!this.length)throw"Empty queue";return this.priv.peek()},s.prototype.clear=function(){return this.length=0,this.priv.clear()},s}()},{}],3:[function(e,r,o){var s;s=function(l,a,h){var y,C,L;for(C=0,y=l.length;C<y;)L=C+y>>>1,h(l[L],a)>=0?C=L+1:y=L;return C},r.exports=function(){function l(a){var h;this.options=a,this.comparator=this.options.comparator,this.data=((h=this.options.initialValues)!=null?h.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return l.prototype.queue=function(a){var h;h=s(this.data,a,this.comparator),this.data.splice(h,0,a)},l.prototype.dequeue=function(){return this.data.pop()},l.prototype.peek=function(){return this.data[this.data.length-1]},l.prototype.clear=function(){this.data.length=0},l}()},{}],4:[function(e,r,o){r.exports=function(){function s(l){var a,h,y,C,L,Y,ze,Bt;for(this.comparator=(l!=null?l.comparator:void 0)||function(Ir,Wr){return Ir-Wr},this.pageSize=(l!=null?l.pageSize:void 0)||512,this.length=0,ze=0;1<<ze<this.pageSize;)ze+=1;if(1<<ze!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=ze,this._emptyMemoryPageTemplate=a=[],h=0,L=this.pageSize;0<=L?h<L:h>L;0<=L?++h:--h)a.push(null);if(this._memory=[],this._mask=this.pageSize-1,l.initialValues)for(Y=l.initialValues,y=0,C=Y.length;y<C;y++)Bt=Y[y],this.queue(Bt)}return s.prototype.queue=function(l){this.length+=1,this._write(this.length,l),this._bubbleUp(this.length,l)},s.prototype.dequeue=function(){var l,a;return l=this._read(1),a=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,a),this._bubbleDown(1,a)),l},s.prototype.peek=function(){return this._read(1)},s.prototype.clear=function(){this.length=0,this._memory.length=0},s.prototype._write=function(l,a){var h;for(h=l>>this._shift;h>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[h][l&this._mask]=a},s.prototype._read=function(l){return this._memory[l>>this._shift][l&this._mask]},s.prototype._bubbleUp=function(l,a){var h,y,C,L;for(h=this.comparator;l>1&&(y=l&this._mask,l<this.pageSize||y>3?C=l&~this._mask|y>>1:y<2?(C=l-this.pageSize>>this._shift,C+=C&~(this._mask>>1),C|=this.pageSize>>1):C=l-2,L=this._read(C),!(h(L,a)<0));)this._write(C,a),this._write(l,L),l=C},s.prototype._bubbleDown=function(l,a){var h,y,C,L,Y;for(Y=this.comparator;l<this.length;)if(l>this._mask&&!(l&this._mask-1)?h=y=l+2:l&this.pageSize>>1?(h=(l&~this._mask)>>1,h|=l&this._mask>>1,h=h+1<<this._shift,y=h+1):(h=l+(l&this._mask),y=h+1),h!==y&&y<=this.length)if(C=this._read(h),L=this._read(y),Y(C,a)<0&&Y(C,L)<=0)this._write(h,a),this._write(l,C),l=h;else if(Y(L,a)<0)this._write(y,a),this._write(l,L),l=y;else break;else if(h<=this.length)if(C=this._read(h),Y(C,a)<0)this._write(h,a),this._write(l,C),l=h;else break;else break},s}()},{}],5:[function(e,r,o){r.exports=function(){function s(l){var a;this.comparator=(l!=null?l.comparator:void 0)||function(h,y){return h-y},this.length=0,this.data=((a=l.initialValues)!=null?a.slice(0):void 0)||[],this._heapify()}return s.prototype._heapify=function(){var l,a,h;if(this.data.length>0)for(l=a=1,h=this.data.length;1<=h?a<h:a>h;l=1<=h?++a:--a)this._bubbleUp(l)},s.prototype.queue=function(l){this.data.push(l),this._bubbleUp(this.data.length-1)},s.prototype.dequeue=function(){var l,a;return a=this.data[0],l=this.data.pop(),this.data.length>0&&(this.data[0]=l,this._bubbleDown(0)),a},s.prototype.peek=function(){return this.data[0]},s.prototype.clear=function(){this.length=0,this.data.length=0},s.prototype._bubbleUp=function(l){for(var a,h;l>0&&(a=l-1>>>1,this.comparator(this.data[l],this.data[a])<0);)h=this.data[a],this.data[a]=this.data[l],this.data[l]=h,l=a},s.prototype._bubbleDown=function(l){var a,h,y,C,L;for(a=this.data.length-1;h=(l<<1)+1,C=h+1,y=l,h<=a&&this.comparator(this.data[h],this.data[y])<0&&(y=h),C<=a&&this.comparator(this.data[C],this.data[y])<0&&(y=C),y!==l;)L=this.data[y],this.data[y]=this.data[l],this.data[l]=L,l=y},s}()},{}]},{},[1])(1)})})(priorityQueue);var priorityQueueExports=priorityQueue.exports;const PriorityQueue=getDefaultExportFromCjs(priorityQueueExports),dxs=[1,0,-1,0,1,1,-1,-1],dys=[0,1,0,-1,1,-1,1,-1];function fromWaterShed(n={}){let{points:t,mask:e,image:r,fillMaxValue:o=this.maxValue,invert:s=!1}=n,l=r||this;l.checkProcessable("fromWaterShed",{bitDepth:[8,16],components:1}),s=!s,t||(t=l.getLocalMaxima({invert:s,mask:e}));let a=s?0:1,h=new Int16Array(l.size),y=l.width,C=l.height,L=new PriorityQueue({comparator:(Y,ze)=>Y[2]-ze[2],strategy:PriorityQueue.BinaryHeapStrategy});for(let Y=0;Y<t.length;Y++){let ze=t[Y][0]+t[Y][1]*y;h[ze]=Y+1;let Bt=l.data[ze];(s&&Bt<=o||!s&&Bt>=o)&&L.queue([t[Y][0],t[Y][1],Bt])}for(;L.length>0;){let Y=L.dequeue(),ze=Y[0]+Y[1]*y;for(let Bt=0;Bt<4;Bt++){let Ir=Y[0]+dxs[Bt],Wr=Y[1]+dys[Bt];if(Ir>=0&&Wr>=0&&Ir<y&&Wr<C){let yi=Ir+Wr*y;if(!e||e.getBit(yi)===a){let Bn=l.data[yi];(s&&Bn<=o||!s&&Bn>=o)&&h[yi]===0&&(h[yi]=h[ze],L.queue([Y[0]+dxs[Bt],Y[1]+dys[Bt],Bn]))}}}}return new RoiMap(l,h)}class RoiManager{constructor(t,e={}){this._image=t,this._options=e,this._options.label||(this._options.label="default"),this._layers={},this._painted=null}fromMaxima(t={}){let e=Object.assign({},this._options,t),r=fromMaxima.call(this._image,t);this._layers[e.label]=new RoiLayer(r,e)}fromPoints(t,e={}){let r=Object.assign({},this._options,e),o=fromPoints.call(this._image,t,e);return this._layers[r.label]=new RoiLayer(o,r),this}putMap(t,e={}){let r=new RoiMap(this._image,t),o=Object.assign({},this._options,e);return this._layers[o.label]=new RoiLayer(r,o),this}fromWaterShed(t={}){let e=Object.assign({},this._options,t),r=fromWaterShed.call(this._image,t);this._layers[e.label]=new RoiLayer(r,e)}fromMask(t,e={}){let r=Object.assign({},this._options,e),o=fromMask.call(this._image,t,e);return this._layers[r.label]=new RoiLayer(o,r),this}fromMaskConnectedComponentLabelingAlgorithm(t,e={}){let r=Object.assign({},this._options,e),o=fromMaskConnectedComponentLabelingAlgorithm.call(this._image,t,e);return this._layers[r.label]=new RoiLayer(o,r),this}getMap(t={}){let e=Object.assign({},this._options,t);return this._assertLayerWithLabel(e.label),this._layers[e.label].roiMap}rowsInfo(t={}){return this.getMap(t).rowsInfo()}colsInfo(t={}){return this.getMap(t).rowsInfo()}getRoiIds(t={}){let e=this.getRois(t);if(e){let r=new Array(e.length);for(let o=0;o<e.length;o++)r[o]=e[o].id;return r}throw new Error("ROIs not found")}getRois(t={}){let{label:e=this._options.label,positive:r=!0,negative:o=!0,minSurface:s=0,maxSurface:l=Number.POSITIVE_INFINITY,minWidth:a=0,maxWidth:h=Number.POSITIVE_INFINITY,minHeight:y=0,maxHeight:C=Number.POSITIVE_INFINITY,minRatio:L=0,maxRatio:Y=Number.POSITIVE_INFINITY}=t;if(!this._layers[e])throw new Error(`this Roi layer (${e}) does not exist`);const ze=this._layers[e].roi,Bt=[];for(const Ir of ze)(Ir.id<0&&o||Ir.id>0&&r)&&Ir.surface>=s&&Ir.surface<=l&&Ir.width>=a&&Ir.width<=h&&Ir.height>=y&&Ir.height<=C&&Ir.ratio>=L&&Ir.ratio<=Y&&Bt.push(Ir);return Bt}getRoi(t,e={}){const{label:r=this._options.label}=e;if(!this._layers[r])throw new Error(`this Roi layer (${r}) does not exist`);const o=this._layers[r].roi.find(s=>s.id===t);if(!o)throw new Error(`found no Roi with id ${t}`);return o}getMasks(t={}){let e=this.getRois(t),r=new Array(e.length);for(let o=0;o<e.length;o++)r[o]=e[o].getMask(t);return r}getAnalysisMasks(t={}){const{analysisProperty:e}=t;let r=`${e}Mask`,o=this.getRois(t);return o.length===0||!o[0][r]?[]:o.map(s=>s[r])}getData(t={}){let e=Object.assign({},this._options,t);return this._assertLayerWithLabel(e.label),this._layers[e.label].roiMap.data}paint(t={}){let{labelProperty:e,analysisProperty:r}=t;this._painted||(this._painted=this._image.rgba8());let o=this.getMasks(t);if(e){const s=this.getRois(t);t.labels=s.map(y=>deepValue(y,e));const l=Math.max(...t.labels);let a=!1,h=!1;if(e.includes("surface")?a=!0:/(?:perimeter|min|max|external|width|height|length)/.test(e)&&(h=!0),isFinite(l)){let y="";if(t.unit!=="pixel"&&t.pixelSize&&(h||a)){y=a?`${t.unit}^2`:t.unit;let C=a?"m^2":"m",L=a?t.pixelSize**2:t.pixelSize;const Y=Qty.swiftConverter(C,y);t.labels=t.labels.map(ze=>Y(L*ze))}l>50?t.labels=t.labels.map(C=>Math.round(C)+y):l>10?t.labels=t.labels.map(C=>C.toFixed(1)+y):t.labels=t.labels.map(C=>C.toFixed(2)+y)}t.labelsPosition=s.map(y=>[y.meanX,y.meanY])}if(this._painted.paintMasks(o,t),r){let s=this.getAnalysisMasks(t);this._painted.paintMasks(s,{color:t.analysisColor,alpha:t.analysisAlpha})}return this._painted}getMask(t={}){let e=new Image$1(this._image.width,this._image.height,{kind:"BINARY"}),r=this.getMasks(t);for(let o=0;o<r.length;o++){let s=r[o];for(let l=0;l<s.width;l++)for(let a=0;a<s.height;a++)s.getBitXY(l,a)&&e.setBitXY(l+s.position[0],a+s.position[1])}return e}resetPainted(t={}){const{image:e}=t;e?this._painted=this.image.rgba8():this._painted=this._image.rgba8()}mergeRoi(t={}){const e=this.getMap(t);return e.mergeRoi(t),this.putMap(e.data,t),this}mergeRois(t,e={}){if(!Array.isArray(t)||t.some(o=>!Number.isInteger(o)))throw new Error("Roi ids must be an array of integers");if(t.length<2)throw new Error("Roi ids must have at least two elements");if(new Set(t).size!==t.length)throw new Error("Roi ids must be all different");t.forEach(o=>this.getRoi(o));const r=this.getMap(e);return r.mergeRois(t),this.putMap(r.data,e),this}findCorrespondingRoi(t,e={}){let r=this.getRois(e),o=[];for(let s=0;s<r.length;s++){let l=r[s],a=l.minX,h=l.minY,y=l.points,C=Math.sign(l.id),L=correspondingRoisInformation(a,h,y,t,C);o.push(L)}return o}_assertLayerWithLabel(t){if(!this._layers[t])throw new Error(`no layer with label ${t}`)}}function correspondingRoisInformation(n,t,e,r,o){let s={id:[],surface:[],roiSurfaceCovered:[],same:0,opposite:0,total:0};for(let l=0;l<e.length;l++){let a=e[l],h=a[0],y=a[1],C=h+n+(y+t)*r.width,L=r.data[C];(L>0||L<0)&&(s.id.includes(L)?s.surface[s.id.indexOf(L)]+=1:(s.id.push(L),s.surface.push(1)))}for(let l=0;l<s.id.length;l++)Math.sign(s.id[l])===o?s.same+=s.surface[l]:s.opposite+=s.surface[l],s.roiSurfaceCovered[l]=s.surface[l]/e.length;return s.total=s.opposite+s.same,s}const objectToString=Object.prototype.toString;let Image$1=class KC{constructor(t,e,r,o){if(arguments.length===1?(o=t,{width:t,height:e,data:r}=o):r&&!r.length&&(o=r,{data:r}=o),t===void 0&&(t=1),e===void 0&&(e=1),o===void 0&&(o={}),typeof o!="object"||o===null)throw new TypeError("options must be an object");if(!Number.isInteger(t)||t<=0)throw new RangeError("width must be a positive integer");if(!Number.isInteger(e)||e<=0)throw new RangeError("height must be a positive integer");const{kind:s=RGBA}=o;if(typeof s!="string")throw new TypeError("kind must be a string");const l=getKind(s),a=Object.assign({},o);for(const Ir in l)a[Ir]===void 0&&(a[Ir]=l[Ir]);verifyKindDefinition(a);const{components:h,bitDepth:y,colorModel:C}=a,L=a.alpha+0,Y=t*e,ze=h+L,Bt=y===32?Number.MAX_VALUE:2**y-1;if(r===void 0)r=createPixelArray(Y,h,L,ze,y,Bt);else{const Ir=getTheoreticalPixelArraySize(Y,ze,y);if(r.length!==Ir)throw new RangeError(`incorrect data size: ${r.length}. Should be ${Ir}`)}this.width=t,this.height=e,this.data=r,this.size=Y,this.components=h,this.alpha=L,this.bitDepth=y,this.maxValue=Bt,this.colorModel=C,this.channels=ze,this.meta=o.meta||{},Object.defineProperty(this,"parent",{enumerable:!1,writable:!0,configurable:!0,value:o.parent||null}),this.position=o.position||[0,0],this.computed=null,this.sizes=[this.width,this.height],this.multiplierX=this.channels,this.multiplierY=this.channels*this.width,this.isClamped=this.bitDepth<32,this.borderSizes=[0,0]}get[Symbol.toStringTag](){return"IJSImage"}static isImage(t){return objectToString.call(t)==="[object IJSImage]"}static fromCanvas(t){const r=t.getContext("2d").getImageData(0,0,t.width,t.height);return new KC(r.width,r.height,r.data)}static createFrom(t,e){const r=getImageParameters(t);return Object.assign(r,{parent:t,position:[0,0]},e),new KC(r)}getRoiManager(t){return new RoiManager(this,t)}clone(){const t=this.data.slice();return new KC(this.width,this.height,t,this)}apply(t){for(let e=0;e<this.height;e++)for(let r=0;r<this.width;r++){let o=(e*this.width+r)*this.channels;t.call(this,o)}}};setValueMethods(Image$1);setBitMethods(Image$1);setExportMethods(Image$1);Image$1.prototype.checkProcessable=checkProcessable;Image$1.prototype.getRGBAData=getRGBAData;Image$1.load=load;Image$1.extendMethod=extendMethod;Image$1.extendProperty=extendProperty;extend$1(Image$1);var workerTemplate$1={},worker$1=function(){self.window=self;function n(){this._listeners={}}n.prototype.on=function(e,r){if(this._listeners[e])throw new RangeError("there is already a listener for "+e);if(typeof r!="function")throw new TypeError("callback argument must be a function");this._listeners[e]=r},n.prototype._send=function(e,r,o){o===void 0?o=[]:Array.isArray(o)||(o=[o]),self.postMessage({id:e,data:r},o)},n.prototype._trigger=function(e,r){if(!this._listeners[e])throw new Error("event "+e+" is not defined");this._listeners[e].apply(null,r)};var t=new n;self.onmessage=function(e){switch(e.data.action){case"exec":e.data.args.unshift(function(r,o){t._send(e.data.id,r,o)}),t._trigger(e.data.event,e.data.args);break;case"ping":t._send(e.data.id,"pong");break;default:throw new Error("unexpected action: "+e.data.action)}}},workerStr=worker$1.toString().split('"CODE";');workerTemplate$1.newWorkerURL=function n(t,e){var r=new Blob(["(",workerStr[0],"importScripts.apply(self, "+JSON.stringify(e)+`);
`,"(",t,")();",workerStr[1],")();"],{type:"application/javascript"});return URL.createObjectURL(r)};var workerTemplate=workerTemplate$1,CORES=navigator.hardwareConcurrency||1;function WorkerManager(n,t){if(typeof n!="string"&&typeof n!="function")throw new TypeError("func argument must be a function");if(t===void 0&&(t={}),typeof t!="object"||t===null)throw new TypeError("options argument must be an object");this._workerCode=n.toString(),t.maxWorkers===void 0||t.maxWorkers==="auto"?this._numWorkers=Math.min(CORES-1,1):t.maxWorkers>0?this._numWorkers=Math.min(t.maxWorkers,CORES):this._numWorkers=CORES,this._workers=new Map,this._timeout=t.timeout||0,this._terminateOnError=!!t.terminateOnError;var e=t.deps;typeof e=="string"&&(e=[e]),Array.isArray(e)||(e=void 0),this._id=0,this._terminated=!1,this._working=0,this._waiting=[],this._init(e)}WorkerManager.prototype._init=function(n){for(var t=workerTemplate.newWorkerURL(this._workerCode,n),e=0;e<this._numWorkers;e++){var r=new Worker(t);r.onmessage=this._onmessage.bind(this,r),r.onerror=this._onerror.bind(this,r),r.running=!1,r.id=e,this._workers.set(r,null)}URL.revokeObjectURL(t)};WorkerManager.prototype._onerror=function(n,t){if(!this._terminated){this._working--,n.running=!1;var e=this._workers.get(n);e&&e[1](t.message),this._workers.set(n,null),this._terminateOnError?this.terminate():this._exec()}};WorkerManager.prototype._onmessage=function(n,t){if(!this._terminated){this._working--,n.running=!1;var e=this._workers.get(n);e&&e[0](t.data.data),this._workers.set(n,null),this._exec()}};WorkerManager.prototype._exec=function(){for(var n of this._workers.keys()){if(this._working===this._numWorkers||this._waiting.length===0)return;if(!n.running)for(var t=0;t<this._waiting.length;t++){var e=this._waiting[t];if(!(typeof e[4]=="number"&&e[4]!==n.id)){this._waiting.splice(t,1),n.postMessage({action:"exec",event:e[0],args:e[1]},e[2]),n.running=!0,n.time=Date.now(),this._workers.set(n,e[3]),this._working++;break}}}};WorkerManager.prototype.terminate=function(){if(!this._terminated){for(var n of this._workers)n[0].terminate(),n[1]&&n[1][1](new Error("Terminated"));this._workers.clear(),this._waiting=[],this._working=0,this._terminated=!0}};WorkerManager.prototype.postAll=function(n,t){if(this._terminated)throw new Error("Cannot post (terminated)");var e=[];for(var r of this._workers.keys())e.push(this.post(n,t,[],r.id));return Promise.all(e)};WorkerManager.prototype.post=function(n,t,e,r){t===void 0&&(t=[]),e===void 0&&(e=[]),Array.isArray(t)||(t=[t]),Array.isArray(e)||(e=[e]);var o=this;return new Promise(function(s,l){if(o._terminated)throw new Error("Cannot post (terminated)");o._waiting.push([n,t,e,[s,l],r]),o._exec()})};var src=WorkerManager;const WorkerManager$1=getDefaultExportFromCjs(src),defaultOptions={regression:{kernelType:"polynomial",kernelOptions:{degree:2,constant:1}},threshold:.02,roi:{minSurface:100,positive:!1},sampling:20,include:[]};function run(n,t,e){t=Object.assign({},defaultOptions,t);const r=this.manager;return Array.isArray(n)?Promise.all(n.map(function(o){const s=runOnce(r,o,t);return typeof e=="function"&&s.then(e),s})):runOnce(r,n,t)}function runOnce(n,t,e){return n.post("data",[t,e]).then(function(r){for(let o in r)r[o]=new Image$1(r[o]);return r})}function work(){worker.on("data",function(n,t,e){t=new IJS(t);const r={},o=[],s=t.grey(),l=s.sobelFilter();ze("sobel",l);const a=l.level().mask({threshold:e.threshold});ze("mask",a);const h=l.getRoiManager();h.fromMask(a);const y=h.getMask(e.roi);ze("realMask",y);const C=s.getPixelsGrid({sampling:e.sampling,mask:y}),L=t.getBackground(C.xyS,C.zS,e.regression);ze("background",L);const Y=t.subtract(L);r.result=Y,o.push(Y.data.buffer),n(r,o);function ze(Bt,Ir){e.include.includes(Bt)&&(r[Bt]=Ir,o.push(Ir.data.buffer))}})}const background={run,work};function extend(n){n.extendMethod("background",background)}let Worker$1=class eT{constructor(){this._url=null,this._deps=[null]}checkUrl(){if(this._url===null)throw new Error("image worker must be initialized with an URL")}get url(){return this._url}set url(t){if(typeof t!="string")throw new TypeError("worker URL must be a string");this._url=t,this._deps[0]=t}static extendMethod(t,e){let r,o,s={};function l(...a){return r||(this.checkUrl(),o=this.url,r=new WorkerManager$1(e.work,{deps:o}),s.manager=r),e.run.call(s,...a)}l.reset=function(){r&&(r.terminate(),r=new WorkerManager$1(e.work,{deps:o}),s.manager=r)},eT.prototype[t]=l}};extend(Worker$1);await __vitePreload(()=>import("https://cdn.jsdelivr.net/npm/gdal3.js@2.4.0/dist/package/gdal3.js"),[]);let Gdal=await initGdalJs({path:"https://cdn.jsdelivr.net/npm/gdal3.js@2.4.0/dist/package",useWorker:!1});async function manipulateImage(n,t,e,r,o,s,l){let a="32767",h="65535",y="0",C="bilinear",L=[],Y,ze=await Image$1.load(n);return r===!0&&(ze=await ze.flipX()),o===!0&&(ze=await ze.flipY()),t>0&&(ze=await ze.blurFilter(t)),Y=await ze.toBuffer(),s!=="0"&&s!=="1081"?l===!0&&(e===!0?L=["-ot","UInt16","-of","PNG","-scale",y,h,a,h,"-outsize",s,s,"-r",C]:L=["-ot","UInt16","-of","PNG","-outsize",s,s,"-r",C],Y=await processGdal(Y,"heightmap.png",L,"png")):e===!0&&(L=["-ot","UInt16","-of","PNG","-scale",y,h,a,h,"-r",C],Y=await processGdal(Y,"heightmap.png",L,"png")),Y}async function loadImageFromArray(n,t={}){try{return await Image$1.load(n,t)}catch(e){console.log(e)}}function convertImage(n,t,e,r,o){return new Image$1(n,t,e,{kind:o,bitDepth:r})}async function processGdal(n,t,e,r){let o=new Blob([n],{type:"image/"+r});const s=new File([o],t),a=(await Gdal.open(s)).datasets[0];console.log("gdal translate");const h=await Gdal.gdal_translate(a,e),y=await Gdal.getFileBytes(h);return Gdal.close(a),y}const imageUtils={manipulateImage,loadImageFromArray,convertImage};var tilesInBbox={};function lonToX(n,t){var e=Math.pow(2,t),r=Math.floor((n+180)/360*e);return r}function latToY(n,t){var e=n*Math.PI/180,r=Math.pow(2,t),o=Math.floor((1-Math.log(Math.tan(e)+1/Math.cos(e))/Math.PI)/2*r);return o}tilesInBbox.tilesInBbox=function(n,t){for(var e=[],r=lonToX(n.left,t),o=lonToX(n.right,t),s=latToY(n.top,t),l=latToY(n.bottom,t),a=r;a<=o;){for(var h=s;h<=l;)e.push({x:a,y:h,z:t}),h++;a++}return e};var vectorTile={},pointGeometry=Point$1;function Point$1(n,t){this.x=n,this.y=t}Point$1.prototype={clone:function(){return new Point$1(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,t){return this.clone()._rotateAround(n,t)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var t=n.x-this.x,e=n.y-this.y;return t*t+e*e},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult:function(n){var t=n[0]*this.x+n[1]*this.y,e=n[2]*this.x+n[3]*this.y;return this.x=t,this.y=e,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var t=Math.cos(n),e=Math.sin(n),r=t*this.x-e*this.y,o=e*this.x+t*this.y;return this.x=r,this.y=o,this},_rotateAround:function(n,t){var e=Math.cos(n),r=Math.sin(n),o=t.x+e*(this.x-t.x)-r*(this.y-t.y),s=t.y+r*(this.x-t.x)+e*(this.y-t.y);return this.x=o,this.y=s,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}};Point$1.convert=function(n){return n instanceof Point$1?n:Array.isArray(n)?new Point$1(n[0],n[1]):n};var Point=pointGeometry,vectortilefeature=VectorTileFeature$1;function VectorTileFeature$1(n,t,e,r,o){this.properties={},this.extent=e,this.type=0,this._pbf=n,this._geometry=-1,this._keys=r,this._values=o,n.readFields(readFeature,this,t)}function readFeature(n,t,e){n==1?t.id=e.readVarint():n==2?readTag(e,t):n==3?t.type=e.readVarint():n==4&&(t._geometry=e.pos)}function readTag(n,t){for(var e=n.readVarint()+n.pos;n.pos<e;){var r=t._keys[n.readVarint()],o=t._values[n.readVarint()];t.properties[r]=o}}VectorTileFeature$1.types=["Unknown","Point","LineString","Polygon"];VectorTileFeature$1.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var t=n.readVarint()+n.pos,e=1,r=0,o=0,s=0,l=[],a;n.pos<t;){if(r<=0){var h=n.readVarint();e=h&7,r=h>>3}if(r--,e===1||e===2)o+=n.readSVarint(),s+=n.readSVarint(),e===1&&(a&&l.push(a),a=[]),a.push(new Point(o,s));else if(e===7)a&&a.push(a[0].clone());else throw new Error("unknown command "+e)}return a&&l.push(a),l};VectorTileFeature$1.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var t=n.readVarint()+n.pos,e=1,r=0,o=0,s=0,l=1/0,a=-1/0,h=1/0,y=-1/0;n.pos<t;){if(r<=0){var C=n.readVarint();e=C&7,r=C>>3}if(r--,e===1||e===2)o+=n.readSVarint(),s+=n.readSVarint(),o<l&&(l=o),o>a&&(a=o),s<h&&(h=s),s>y&&(y=s);else if(e!==7)throw new Error("unknown command "+e)}return[l,h,a,y]};VectorTileFeature$1.prototype.toGeoJSON=function(n,t,e){var r=this.extent*Math.pow(2,e),o=this.extent*n,s=this.extent*t,l=this.loadGeometry(),a=VectorTileFeature$1.types[this.type],h,y;function C(ze){for(var Bt=0;Bt<ze.length;Bt++){var Ir=ze[Bt],Wr=180-(Ir.y+s)*360/r;ze[Bt]=[(Ir.x+o)*360/r-180,360/Math.PI*Math.atan(Math.exp(Wr*Math.PI/180))-90]}}switch(this.type){case 1:var L=[];for(h=0;h<l.length;h++)L[h]=l[h][0];l=L,C(l);break;case 2:for(h=0;h<l.length;h++)C(l[h]);break;case 3:for(l=classifyRings(l),h=0;h<l.length;h++)for(y=0;y<l[h].length;y++)C(l[h][y]);break}l.length===1?l=l[0]:a="Multi"+a;var Y={type:"Feature",geometry:{type:a,coordinates:l},properties:this.properties};return"id"in this&&(Y.id=this.id),Y};function classifyRings(n){var t=n.length;if(t<=1)return[n];for(var e=[],r,o,s=0;s<t;s++){var l=signedArea(n[s]);l!==0&&(o===void 0&&(o=l<0),o===l<0?(r&&e.push(r),r=[n[s]]):r.push(n[s]))}return r&&e.push(r),e}function signedArea(n){for(var t=0,e=0,r=n.length,o=r-1,s,l;e<r;o=e++)s=n[e],l=n[o],t+=(l.x-s.x)*(s.y+l.y);return t}var VectorTileFeature=vectortilefeature,vectortilelayer=VectorTileLayer$1;function VectorTileLayer$1(n,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(readLayer,this,t),this.length=this._features.length}function readLayer(n,t,e){n===15?t.version=e.readVarint():n===1?t.name=e.readString():n===5?t.extent=e.readVarint():n===2?t._features.push(e.pos):n===3?t._keys.push(e.readString()):n===4&&t._values.push(readValueMessage(e))}function readValueMessage(n){for(var t=null,e=n.readVarint()+n.pos;n.pos<e;){var r=n.readVarint()>>3;t=r===1?n.readString():r===2?n.readFloat():r===3?n.readDouble():r===4?n.readVarint64():r===5?n.readVarint():r===6?n.readSVarint():r===7?n.readBoolean():null}return t}VectorTileLayer$1.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var t=this._pbf.readVarint()+this._pbf.pos;return new VectorTileFeature(this._pbf,t,this.extent,this._keys,this._values)};var VectorTileLayer=vectortilelayer,vectortile=VectorTile;function VectorTile(n,t){this.layers=n.readFields(readTile,{},t)}function readTile(n,t,e){if(n===3){var r=new VectorTileLayer(e,e.readVarint()+e.pos);r.length&&(t[r.name]=r)}}vectorTile.VectorTile=vectortile;vectorTile.VectorTileFeature=vectortilefeature;vectorTile.VectorTileLayer=vectortilelayer;var ieee754$1={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ieee754$1.read=function(n,t,e,r,o){var s,l,a=o*8-r-1,h=(1<<a)-1,y=h>>1,C=-7,L=e?o-1:0,Y=e?-1:1,ze=n[t+L];for(L+=Y,s=ze&(1<<-C)-1,ze>>=-C,C+=a;C>0;s=s*256+n[t+L],L+=Y,C-=8);for(l=s&(1<<-C)-1,s>>=-C,C+=r;C>0;l=l*256+n[t+L],L+=Y,C-=8);if(s===0)s=1-y;else{if(s===h)return l?NaN:(ze?-1:1)*(1/0);l=l+Math.pow(2,r),s=s-y}return(ze?-1:1)*l*Math.pow(2,s-r)};ieee754$1.write=function(n,t,e,r,o,s){var l,a,h,y=s*8-o-1,C=(1<<y)-1,L=C>>1,Y=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,ze=r?0:s-1,Bt=r?1:-1,Ir=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,l=C):(l=Math.floor(Math.log(t)/Math.LN2),t*(h=Math.pow(2,-l))<1&&(l--,h*=2),l+L>=1?t+=Y/h:t+=Y*Math.pow(2,1-L),t*h>=2&&(l++,h/=2),l+L>=C?(a=0,l=C):l+L>=1?(a=(t*h-1)*Math.pow(2,o),l=l+L):(a=t*Math.pow(2,L-1)*Math.pow(2,o),l=0));o>=8;n[e+ze]=a&255,ze+=Bt,a/=256,o-=8);for(l=l<<o|a,y+=o;y>0;n[e+ze]=l&255,ze+=Bt,l/=256,y-=8);n[e+ze-Bt]|=Ir*128};var pbf=Pbf,ieee754=ieee754$1;function Pbf(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}Pbf.Varint=0;Pbf.Fixed64=1;Pbf.Bytes=2;Pbf.Fixed32=5;var SHIFT_LEFT_32=65536*65536,SHIFT_RIGHT_32=1/SHIFT_LEFT_32,TEXT_DECODER_MIN_LENGTH=12,utf8TextDecoder=typeof TextDecoder>"u"?null:new TextDecoder("utf8");Pbf.prototype={destroy:function(){this.buf=null},readFields:function(n,t,e){for(e=e||this.length;this.pos<e;){var r=this.readVarint(),o=r>>3,s=this.pos;this.type=r&7,n(o,t,this),this.pos===s&&this.skip(r)}return t},readMessage:function(n,t){return this.readFields(n,t,this.readVarint()+this.pos)},readFixed32:function(){var n=readUInt32(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=readInt32(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=readUInt32(this.buf,this.pos)+readUInt32(this.buf,this.pos+4)*SHIFT_LEFT_32;return this.pos+=8,n},readSFixed64:function(){var n=readUInt32(this.buf,this.pos)+readInt32(this.buf,this.pos+4)*SHIFT_LEFT_32;return this.pos+=8,n},readFloat:function(){var n=ieee754.read(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=ieee754.read(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var t=this.buf,e,r;return r=t[this.pos++],e=r&127,r<128||(r=t[this.pos++],e|=(r&127)<<7,r<128)||(r=t[this.pos++],e|=(r&127)<<14,r<128)||(r=t[this.pos++],e|=(r&127)<<21,r<128)?e:(r=t[this.pos],e|=(r&15)<<28,readVarintRemainder(e,n,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2===1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,t=this.pos;return this.pos=n,n-t>=TEXT_DECODER_MIN_LENGTH&&utf8TextDecoder?readUtf8TextDecoder(this.buf,t,n):readUtf8(this.buf,t,n)},readBytes:function(){var n=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,n);return this.pos=n,t},readPackedVarint:function(n,t){if(this.type!==Pbf.Bytes)return n.push(this.readVarint(t));var e=readPackedEnd(this);for(n=n||[];this.pos<e;)n.push(this.readVarint(t));return n},readPackedSVarint:function(n){if(this.type!==Pbf.Bytes)return n.push(this.readSVarint());var t=readPackedEnd(this);for(n=n||[];this.pos<t;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==Pbf.Bytes)return n.push(this.readBoolean());var t=readPackedEnd(this);for(n=n||[];this.pos<t;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==Pbf.Bytes)return n.push(this.readFloat());var t=readPackedEnd(this);for(n=n||[];this.pos<t;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==Pbf.Bytes)return n.push(this.readDouble());var t=readPackedEnd(this);for(n=n||[];this.pos<t;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==Pbf.Bytes)return n.push(this.readFixed32());var t=readPackedEnd(this);for(n=n||[];this.pos<t;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==Pbf.Bytes)return n.push(this.readSFixed32());var t=readPackedEnd(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==Pbf.Bytes)return n.push(this.readFixed64());var t=readPackedEnd(this);for(n=n||[];this.pos<t;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==Pbf.Bytes)return n.push(this.readSFixed64());var t=readPackedEnd(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed64());return n},skip:function(n){var t=n&7;if(t===Pbf.Varint)for(;this.buf[this.pos++]>127;);else if(t===Pbf.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Pbf.Fixed32)this.pos+=4;else if(t===Pbf.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+t)},writeTag:function(n,t){this.writeVarint(n<<3|t)},realloc:function(n){for(var t=this.length||16;t<this.pos+n;)t*=2;if(t!==this.length){var e=new Uint8Array(t);e.set(this.buf),this.buf=e,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),writeInt32(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),writeInt32(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),writeInt32(this.buf,n&-1,this.pos),writeInt32(this.buf,Math.floor(n*SHIFT_RIGHT_32),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),writeInt32(this.buf,n&-1,this.pos),writeInt32(this.buf,Math.floor(n*SHIFT_RIGHT_32),this.pos+4),this.pos+=8},writeVarint:function(n){if(n=+n||0,n>268435455||n<0){writeBigVarint(n,this);return}this.realloc(4),this.buf[this.pos++]=n&127|(n>127?128:0),!(n<=127)&&(this.buf[this.pos++]=(n>>>=7)&127|(n>127?128:0),!(n<=127)&&(this.buf[this.pos++]=(n>>>=7)&127|(n>127?128:0),!(n<=127)&&(this.buf[this.pos++]=n>>>7&127)))},writeSVarint:function(n){this.writeVarint(n<0?-n*2-1:n*2)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(n.length*4),this.pos++;var t=this.pos;this.pos=writeUtf8(this.buf,n,this.pos);var e=this.pos-t;e>=128&&makeRoomForExtraLength(t,e,this),this.pos=t-1,this.writeVarint(e),this.pos+=e},writeFloat:function(n){this.realloc(4),ieee754.write(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),ieee754.write(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var t=n.length;this.writeVarint(t),this.realloc(t);for(var e=0;e<t;e++)this.buf[this.pos++]=n[e]},writeRawMessage:function(n,t){this.pos++;var e=this.pos;n(t,this);var r=this.pos-e;r>=128&&makeRoomForExtraLength(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeMessage:function(n,t,e){this.writeTag(n,Pbf.Bytes),this.writeRawMessage(t,e)},writePackedVarint:function(n,t){t.length&&this.writeMessage(n,writePackedVarint,t)},writePackedSVarint:function(n,t){t.length&&this.writeMessage(n,writePackedSVarint,t)},writePackedBoolean:function(n,t){t.length&&this.writeMessage(n,writePackedBoolean,t)},writePackedFloat:function(n,t){t.length&&this.writeMessage(n,writePackedFloat,t)},writePackedDouble:function(n,t){t.length&&this.writeMessage(n,writePackedDouble,t)},writePackedFixed32:function(n,t){t.length&&this.writeMessage(n,writePackedFixed32,t)},writePackedSFixed32:function(n,t){t.length&&this.writeMessage(n,writePackedSFixed32,t)},writePackedFixed64:function(n,t){t.length&&this.writeMessage(n,writePackedFixed64,t)},writePackedSFixed64:function(n,t){t.length&&this.writeMessage(n,writePackedSFixed64,t)},writeBytesField:function(n,t){this.writeTag(n,Pbf.Bytes),this.writeBytes(t)},writeFixed32Field:function(n,t){this.writeTag(n,Pbf.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(n,t){this.writeTag(n,Pbf.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(n,t){this.writeTag(n,Pbf.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(n,t){this.writeTag(n,Pbf.Fixed64),this.writeSFixed64(t)},writeVarintField:function(n,t){this.writeTag(n,Pbf.Varint),this.writeVarint(t)},writeSVarintField:function(n,t){this.writeTag(n,Pbf.Varint),this.writeSVarint(t)},writeStringField:function(n,t){this.writeTag(n,Pbf.Bytes),this.writeString(t)},writeFloatField:function(n,t){this.writeTag(n,Pbf.Fixed32),this.writeFloat(t)},writeDoubleField:function(n,t){this.writeTag(n,Pbf.Fixed64),this.writeDouble(t)},writeBooleanField:function(n,t){this.writeVarintField(n,!!t)}};function readVarintRemainder(n,t,e){var r=e.buf,o,s;if(s=r[e.pos++],o=(s&112)>>4,s<128||(s=r[e.pos++],o|=(s&127)<<3,s<128)||(s=r[e.pos++],o|=(s&127)<<10,s<128)||(s=r[e.pos++],o|=(s&127)<<17,s<128)||(s=r[e.pos++],o|=(s&127)<<24,s<128)||(s=r[e.pos++],o|=(s&1)<<31,s<128))return toNum(n,o,t);throw new Error("Expected varint not more than 10 bytes")}function readPackedEnd(n){return n.type===Pbf.Bytes?n.readVarint()+n.pos:n.pos+1}function toNum(n,t,e){return e?t*4294967296+(n>>>0):(t>>>0)*4294967296+(n>>>0)}function writeBigVarint(n,t){var e,r;if(n>=0?(e=n%4294967296|0,r=n/4294967296|0):(e=~(-n%4294967296),r=~(-n/4294967296),e^4294967295?e=e+1|0:(e=0,r=r+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),writeBigVarintLow(e,r,t),writeBigVarintHigh(r,t)}function writeBigVarintLow(n,t,e){e.buf[e.pos++]=n&127|128,n>>>=7,e.buf[e.pos++]=n&127|128,n>>>=7,e.buf[e.pos++]=n&127|128,n>>>=7,e.buf[e.pos++]=n&127|128,n>>>=7,e.buf[e.pos]=n&127}function writeBigVarintHigh(n,t){var e=(n&7)<<4;t.buf[t.pos++]|=e|((n>>>=3)?128:0),n&&(t.buf[t.pos++]=n&127|((n>>>=7)?128:0),n&&(t.buf[t.pos++]=n&127|((n>>>=7)?128:0),n&&(t.buf[t.pos++]=n&127|((n>>>=7)?128:0),n&&(t.buf[t.pos++]=n&127|((n>>>=7)?128:0),n&&(t.buf[t.pos++]=n&127)))))}function makeRoomForExtraLength(n,t,e){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(Math.LN2*7));e.realloc(r);for(var o=e.pos-1;o>=n;o--)e.buf[o+r]=e.buf[o]}function writePackedVarint(n,t){for(var e=0;e<n.length;e++)t.writeVarint(n[e])}function writePackedSVarint(n,t){for(var e=0;e<n.length;e++)t.writeSVarint(n[e])}function writePackedFloat(n,t){for(var e=0;e<n.length;e++)t.writeFloat(n[e])}function writePackedDouble(n,t){for(var e=0;e<n.length;e++)t.writeDouble(n[e])}function writePackedBoolean(n,t){for(var e=0;e<n.length;e++)t.writeBoolean(n[e])}function writePackedFixed32(n,t){for(var e=0;e<n.length;e++)t.writeFixed32(n[e])}function writePackedSFixed32(n,t){for(var e=0;e<n.length;e++)t.writeSFixed32(n[e])}function writePackedFixed64(n,t){for(var e=0;e<n.length;e++)t.writeFixed64(n[e])}function writePackedSFixed64(n,t){for(var e=0;e<n.length;e++)t.writeSFixed64(n[e])}function readUInt32(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+n[t+3]*16777216}function writeInt32(n,t,e){n[e]=t,n[e+1]=t>>>8,n[e+2]=t>>>16,n[e+3]=t>>>24}function readInt32(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+(n[t+3]<<24)}function readUtf8(n,t,e){for(var r="",o=t;o<e;){var s=n[o],l=null,a=s>239?4:s>223?3:s>191?2:1;if(o+a>e)break;var h,y,C;a===1?s<128&&(l=s):a===2?(h=n[o+1],(h&192)===128&&(l=(s&31)<<6|h&63,l<=127&&(l=null))):a===3?(h=n[o+1],y=n[o+2],(h&192)===128&&(y&192)===128&&(l=(s&15)<<12|(h&63)<<6|y&63,(l<=2047||l>=55296&&l<=57343)&&(l=null))):a===4&&(h=n[o+1],y=n[o+2],C=n[o+3],(h&192)===128&&(y&192)===128&&(C&192)===128&&(l=(s&15)<<18|(h&63)<<12|(y&63)<<6|C&63,(l<=65535||l>=1114112)&&(l=null))),l===null?(l=65533,a=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|l&1023),r+=String.fromCharCode(l),o+=a}return r}function readUtf8TextDecoder(n,t,e){return utf8TextDecoder.decode(n.subarray(t,e))}function writeUtf8(n,t,e){for(var r=0,o,s;r<t.length;r++){if(o=t.charCodeAt(r),o>55295&&o<57344)if(s)if(o<56320){n[e++]=239,n[e++]=191,n[e++]=189,s=o;continue}else o=s-55296<<10|o-56320|65536,s=null;else{o>56319||r+1===t.length?(n[e++]=239,n[e++]=191,n[e++]=189):s=o;continue}else s&&(n[e++]=239,n[e++]=191,n[e++]=189,s=null);o<128?n[e++]=o:(o<2048?n[e++]=o>>6|192:(o<65536?n[e++]=o>>12|224:(n[e++]=o>>18|240,n[e++]=o>>12&63|128),n[e++]=o>>6&63|128),n[e++]=o&63|128)}return e}const Protobuf=getDefaultExportFromCjs(pbf);let vectTile=await vectorTile.VectorTile,cache$1;caches.open("tiles").then(n=>cache$1=n);function getTileInfo(n,t,e,r,o,s,l){}function getFeaturesFromBB(n,t,e){const r=new mapboxgl.LngLatBounds(t);let o=r.getSouthWest(),s=r.getNorthEast(),l=n.project(o),a=n.project(s),h=n.queryRenderedFeatures([l,a]);return e===!0&&(h=getUniqueFeatures(h)),h}function getUniqueFeatures(n){const t=new Set,e=[];for(const r of n){const o=r.properties.name,s=r.geometry.type;let l=o+"-"+s;t.has(l)||(t.add(l),e.push(r))}return e}async function unrealRemoteControl(n,t){let e,r={},o="";const s={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)};try{e=await fetch(t,s)}catch(l){o=l}return r.response=e,r.error=o,r}async function downloadToTile(n,t,e=0,r=0,o=!1){let s={},l;const a=await caches.match(t);if(a&&a.ok){console.log("tile: load from cache");let h=await a.arrayBuffer();return n===!0?(l=await imageUtils.loadImageFromArray(h),l):(o===!0?s.buffer=new Uint8Array(h):s.buffer=h,s.x=e,s.y=r,s)}else{console.log("tile: load by fetch, cache downloaded file");try{const h=await fetch(t);if(h.ok){let y=h.clone(),C=await h.arrayBuffer();return cache$1.put(t,y),n===!0?(l=await imageUtils.loadImageFromArray(C),l):(o===!0?s.buffer=new Uint8Array(C):s.buffer=C,s.x=e,s.y=r,s)}else throw new Error("download tileerror:",h.status)}catch(h){console.log(h.message)}}}function toWatermap(n,t){let e=n.length,r=document.getElementById("wMap-canvas");const o=r.getContext("2d",{willReadFrequently:!0});r.width=t,r.height=t;let s=t/(e*4096);o.fillStyle="#FFFFFF",o.fillRect(0,0,t,t),o.fillStyle="#000000",o.beginPath(),console.log(n);for(let h=0;h<e;h++)for(let y=0;y<e;y++)if(typeof n[h][y]!="boolean"&&n[h][y].layers.water){let C=n[h][y].layers.water.feature(0).loadGeometry();for(let L=0;L<C.length;L++){o.moveTo(Math.round(C[L][0].x*s+y*t/e),Math.round(C[L][0].y*s+h*t/e));for(let Y=1;Y<C[L].length;Y++)o.lineTo(Math.round(C[L][Y].x*s+y*t/e),Math.round(C[L][Y].y*s+h*t/e))}}if(o.closePath(),o.fill(),document.getElementById("drawStrm").checked){o.strokeStyle="#000000",o.lineWidth=1,o.beginPath();for(let h=0;h<e;h++)for(let y=0;y<e;y++)if(typeof n[h][y]!="boolean"&&n[h][y].layers.waterway){let C=n[h][y].layers.waterway.feature(0).loadGeometry();for(let L=0;L<C.length;L++){o.moveTo(Math.round(C[L][0].x*s+y*t/e),Math.round(C[L][0].y*s+h*t/e));for(let Y=1;Y<C[L].length;Y++)o.lineTo(Math.round(C[L][Y].x*s+y*t/e),Math.round(C[L][Y].y*s+h*t/e))}}o.stroke()}let l=Create2DArray(t,1),a=o.getImageData(0,0,t,t);for(let h=0;h<t;h++)for(let y=0;y<t;y++){let C=h*t*4+y*4;l[h][y]=a.data[C]/255}return l}function sanatizeMap(n,t,e){let o=Create2DArray(1081,0),s=1e5;for(let l=e;l<e+1081;l++)for(let a=t;a<t+1081;a++){let h=n[l][a];h>=0&&h<s&&(s=h),o[l-e][a-t]=h}for(let l=0;l<1081;l++)for(let a=0;a<1081;a++)o[l][a]<0&&(o[l][a]=s);return o}function sanatizeWatermap(n,t,e){let o=Create2DArray(1081,0);for(let s=e;s<e+1081;s++)for(let l=t;l<e+1081;l++){let a=n[s][l];o[s-e][l-t]=a}return o}async function downloadPbfToTile(n){const t=await caches.match(n);if(t&&t.ok){console.log("pbf: load from cache");let e=await t.arrayBuffer();return new vectTile(new Protobuf(new Uint8Array(e)))}else{console.log("pbf: load by fetch, cache downloaded file");try{const e=await fetch(n);if(e.ok){let r=e.clone(),o=await e.arrayBuffer(),s=new vectTile(new Protobuf(new Uint8Array(o)));return cache$1.put(n,r),s}else throw new Error("download Pbf error:",e.status)}catch(e){return console.log(e.message),!0}}}function long2tile(n,t){return Math.floor((n+180)/360*Math.pow(2,t))}function lat2tile(n,t){return Math.floor((1-Math.log(Math.tan(n*Math.PI/180)+1/Math.cos(n*Math.PI/180))/Math.PI)/2*Math.pow(2,t))}function tile2long(n,t){return n/Math.pow(2,t)*360-180}function tile2lat(n,t){let e=Math.PI-2*Math.PI*n/Math.pow(2,t);return 180/Math.PI*Math.atan(.5*(Math.exp(e)-Math.exp(-e)))}function toHeightmap(n,t,e){let r=n.length,o=Create2DArray(r*512,0),s=Create2DArray(Math.ceil(1080*(t/e)),0),l=o.length,a=s.length,h=(a-1)/(l-1);for(let C=0;C<r;C++)for(let L=0;L<r;L++){let Y=n[C][L].getRGBAData();for(let ze=0;ze<512;ze++)for(let Bt=0;Bt<512;Bt++){let Ir=ze*512*4+Bt*4;o[C*512+ze][L*512+Bt]=-1e5+(Y[Ir]*256*256+Y[Ir+1]*256+Y[Ir+2])}}let y=Array(a);for(let C=0;C<a;C++)y[C]=C/h;for(let C=0;C<a-1;C++)for(let L=0;L<a-1;L++){let Y=Math.floor(y[C]),ze=Math.floor(y[L]),Bt=Y+1,Ir=ze+1,Wr=y[C]-Y,yi=y[L]-ze;s[C][L]=Math.round((1-yi)*(1-Wr)*o[Y][ze]+yi*(1-Wr)*o[Y][Ir]+(1-yi)*Wr*o[Bt][ze]+yi*Wr*o[Bt][Ir])}for(let C=0;C<a;C++)s[C][a-1]=o[C][a-1];for(let C=0;C<a;C++)s[a-1][C]=o[a-1][C];return s}function calcMinMaxHeight(n){const t=n.length,e=n[0].length,r={min:1e5,max:-1e5};for(let o=0;o<t;o++)for(let s=0;s<e;s++){let l=n[o][s];l>r.max&&(r.max=l),l<r.min&&(r.min=l)}return r.min=r.min/10,r.max=r.max/10,r}function getTileCount(n,t){let e={bottom:t.bottomright[1],left:t.topleft[0],top:t.topleft[1],right:t.bottomright[0]};return tilesInBbox.tilesInBbox(e,n)}function getTileCountAdjusted(n,t,e=!1){let r={},o=long2tile(t.topleft[0],n),s=lat2tile(t.topleft[1],n),l=long2tile(t.bottomright[0],n),a=lat2tile(t.bottomright[1],n),h=Math.max(l-o+1,a-s+1);if(e===!1&&h>6){let y=n,C,L,Y,ze,Bt;do y--,C=long2tile(t.topleft[0],y),L=lat2tile(t.topleft[1],y),Y=long2tile(t.bottomright[0],y),ze=lat2tile(t.bottomright[1],y),Bt=Math.max(Y-C+1,ze-L+1);while(Bt>6);o=C,s=L,n=y,h=Bt}return r.tileCnt=h,r.zoom=n,r.x=o,r.y=s,r}function deleteCaches(){confirm(`Delete the caches.
Is that okay?`)&&caches.delete("tiles").then(()=>{caches.open("tiles").then(n=>cache$1=n)})}function convertMapboxMaptilerStyles(n,t){return[{mapbox:"streets-v11",maptiler:"STREETS",maptiler_map:"streets-v2",diff:!1},{mapbox:"dark-v10",maptiler:"STREETS.DARK",maptilerAltName:"Streets v2 Dark",maptiler_map:"streets-v2",diff:!1},{mapbox:"light-v10",maptiler:"STREETS.LIGHT",maptilerAltName:"Streets v2 Light",maptiler_map:"streets-v2",diff:!1},{mapbox:"outdoors-v11",maptiler:"OUTDOOR",maptiler_map:"outdoor-v2",diff:!1},{mapbox:"satellite-v9",maptiler:"SATELLITE",maptiler_map:"satellite",diff:!0},{mapbox:"weightmap"}].filter(o=>o[n]===t)}function Create2DArray(n,t=null){let e=new Array(n);for(let r=0;r<n;r++)e[r]=new Array(n).fill(t);return e}const mapUtils={getTileInfo,getFeaturesFromBB,unrealRemoteControl,downloadToTile,tile2lat,tile2long,lat2tile,long2tile,toHeightmap,calcMinMaxHeight,getTileCount,getTileCountAdjusted,deleteCaches,convertMapboxMaptilerStyles,Create2DArray,downloadPbfToTile,toWatermap,sanatizeMap,sanatizeWatermap};var clearIntervalAsync$1={},setIntervalAsyncTimer={};Object.defineProperty(setIntervalAsyncTimer,"__esModule",{value:!0});setIntervalAsyncTimer.SetIntervalAsyncTimer=void 0;const MIN_INTERVAL_MS=10,MAX_INTERVAL_MS=2147483647;var i1,vw,$b,Ub,UE,ZC,tT;const jE=class jE{constructor(){j1(this,Ub);j1(this,ZC);j1(this,i1,void 0);j1(this,vw,void 0);j1(this,$b,!1)}static startTimer(t,e,r,...o){var l;r=Math.min(Math.max(Math.trunc(r),MIN_INTERVAL_MS),MAX_INTERVAL_MS);const s=new jE;return WC(l=s,Ub,UE).call(l,t,e,r,r,...o),s}static async stopTimer(t){H1(t,$b,!0),r1(t,i1)&&clearTimeout(r1(t,i1)),r1(t,vw)&&await r1(t,vw)}};i1=new WeakMap,vw=new WeakMap,$b=new WeakMap,Ub=new WeakSet,UE=function(t,e,r,o,...s){H1(this,i1,setTimeout(async()=>{H1(this,i1,void 0),H1(this,vw,WC(this,ZC,tT).call(this,t,e,r,...s)),await r1(this,vw),H1(this,vw,void 0)},o))},ZC=new WeakSet,tT=async function(t,e,r,...o){const s=new Date().getTime();try{await e(...o)}finally{if(!r1(this,$b)){const l=new Date().getTime()-s,a=t==="dynamic"?r>l?r-l:0:r;WC(this,Ub,UE).call(this,t,e,r,a,...o)}}};let SetIntervalAsyncTimer=jE;setIntervalAsyncTimer.SetIntervalAsyncTimer=SetIntervalAsyncTimer;Object.defineProperty(clearIntervalAsync$1,"__esModule",{value:!0});var clearIntervalAsync_2=clearIntervalAsync$1.clearIntervalAsync=void 0;const set_interval_async_timer_cjs_1=setIntervalAsyncTimer;async function clearIntervalAsync(n){if(!(n instanceof set_interval_async_timer_cjs_1.SetIntervalAsyncTimer))throw new TypeError("First argument is not an instance of SetIntervalAsyncTimer");await set_interval_async_timer_cjs_1.SetIntervalAsyncTimer.stopTimer(n)}clearIntervalAsync_2=clearIntervalAsync$1.clearIntervalAsync=clearIntervalAsync;var setIntervalAsync={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.setIntervalAsync=n.clearIntervalAsync=void 0;const t=clearIntervalAsync$1;Object.defineProperty(n,"clearIntervalAsync",{enumerable:!0,get:function(){return t.clearIntervalAsync}});const e=setIntervalAsyncTimer;function r(o,s,...l){if(typeof o!="function")throw new TypeError("First argument is not a function");if(typeof s!="number")throw new TypeError("Second argument is not a number");return e.SetIntervalAsyncTimer.startTimer("dynamic",o,s,...l)}n.setIntervalAsync=r})(setIntervalAsync);const myWorker=new Worker(new URL("/assets/worker-5b95cea1.js",self.location),{type:"module"}),defaultWaterdepth=40,meanKernel=[[1,1,1],[1,1,1],[1,1,1]],sharpenKernel=[[-.00391,-.01563,-.02344,-.01563,-.00391],[-.01563,-.0625,-.09375,-.0625,-.01563],[-.02344,-.09375,1.8598,-.09375,-.02344],[-.01563,-.0625,-.09375,-.0625,-.01563],[-.00391,-.01563,-.02344,-.01563,-.00391]],pbElement=document.getElementById("progress"),previewImage=document.getElementById("previewImage"),progressMsg=document.getElementById("progressMsg"),progressArea=document.getElementById("progressArea"),eGridDiv=document.querySelector("#myGrid"),modal=document.getElementById("modal"),modalMsg=document.getElementById("modalMsg"),zoom=document.getElementById("zoom"),worldpart=document.getElementById("worldpart").checked,worldpartiongridsize=document.getElementById("worldpartiongridsize").value,landscapename=document.getElementById("landscapename").value,processCount=document.getElementById("processCount"),processStatus=document.getElementById("processStatus"),togglePassword=document.querySelector("#togglePassword"),apiKey=document.querySelector("#apiKey");let cache;togglePassword.addEventListener("click",function(n){const t=apiKey.getAttribute("type")==="password"?"text":"password";apiKey.setAttribute("type",t),this.classList.toggle("fa-eye-slash")});let distance,urlKey,urlType,map,geocoder,heightmapFileName,subDirName,vectorType,promiseArray=[],mapSize=50,vmapSize=mapSize*1.05,tileSize=mapSize/9,timer,ticks=0,mapCanvas,panels=document.getElementsByClassName("panel"),icons=document.getElementsByClassName("icon"),iconClass=[],weightmapGrid=null,event_source,rows=[{name:"Forest",color:[201,28,19]},{name:"Water",color:[[78,112,155],[103,178,178],[85,155,200],[90,163,195],[64,90,104],[82,122,183],[95,141,175],[91,142,184],[100,141,167],[111,140,146],[46,116,81],[62,129,142],[58,126,131],[55,121,118],[68,135,169],[65,132,155],[83,142,208],[83,142,199],[19,36,52],[26,48,70],[21,39,56],[12,21,31],[14,26,37],[28,52,76],[37,68,100],[43,78,114],[41,74,108],[65,119,172],[68,124,180],[91,141,182],[26,39,49],[64,112,158],[15,28,40],[24,43,63],[39,71,104],[21,39,57],[18,32,47],[58,107,156],[39,72,105],[12,23,33],[37,69,100],[45,83,121],[53,97,141],[28,51,74],[19,35,52],[43,78,113],[25,45,66],[65,118,172],[48,87,127],[23,41,60],[41,75,109],[16,30,44],[35,65,94],[71,130,188],[68,124,181],[14,25,37],[62,113,164],[31,56,82],[73,134,194],[50,92,133],[74,137,198],[77,140,204],[56,103,149],[55,100,146],[57,104,151],[56,103,149],[78,143,208],[42,77,112],[50,92,133],[62,113,165],[75,133,180],[56,104,148],[62,113,165],[78,143,207],[50,92,133],[36,65,94],[69,122,175],[28,50,73],[21,38,55],[33,61,88],[15,27,39],[66,131,154],[89,119,144],[73,129,175],[66,131,154],[99,141,169],[65,168,154],[75,165,173],[62,134,142],[111,140,147]]},{name:"Scrub",color:[[143,253,139],[142,253,138]]},{name:"Trees",color:[34,106,32]},{name:"Rock",color:[101,100,93]},{name:"Sand",color:[243,234,129]},{name:"Grass",color:[[33,226,29],[33,225,29]]},{name:"Glacier",color:[[255,255,255],[254,254,254]]},{name:"Landcover",color:[0,0,0]},{name:"Hillshade",color:[[241,110,218],[242,110,219],[242,110,220]]},{name:"Land",color:[154,136,66]},{name:"Farmland",color:[[140,17,155],[140,17,156]]}],userSettings,grid;init();async function init(){checkFileApiSupport()===!1?toggleModal("open","This browser does not support File System Access API.  Try Edge or Chrome."):(userSettings=await loadUserSettings(),grid=await loadSettings(),initMap())}function checkFileApiSupport(){return fileUtils.checkFileApiSupport()}let gridOptions={columnDefs:[{headerName:"Name",field:"name",editable:!0},{headerName:"Color",field:"color",editable:!0}],defaultColDef:{flex:1,minWidth:100,resizable:!0,headerCheckboxSelection:isFirstColumn,checkboxSelection:isFirstColumn},suppressRowClickSelection:!0,rowSelection:"multiple",rowData:rows};function isFirstColumn(n){return n.columnApi.getAllDisplayedColumns()[0]===n.column}for(let n=0;n<panels.length;n++)iconClass.push(icons[n].className);function initWeightmapGrid(){weightmapGrid===null&&(weightmapGrid=new Grid(eGridDiv,gridOptions))}function initMap(){try{caches.open("tiles").then(t=>cache=t),console.log("init");let n=document.getElementsByClassName("mapboxgl-ctrl-geocoder");if(scope.apiKey.length>0){if(scope.serverType==="mapbox"){mapboxgl.accessToken=scope.apiKey,urlKey="access_token=",urlType="@2x.png",vectorType=".vector.pbf",map=new mapboxgl.Map({container:"map",style:scope.stylesUrl+"outdoors-v11",center:[grid.lng,grid.lat],zoom:grid.zoom,preserveDrawingBuffer:!0});const t=function(e){const r=e.match(/^[ ]*(?:Lat: )?(-?\d+\.?\d*)[, ]+(?:Lng: )?(-?\d+\.?\d*)[ ]*$/i);if(!r)return null;function o(h,y){return{center:[h,y],geometry:{type:"Point",coordinates:[h,y]},place_name:"Lat: "+y+" Lng: "+h,place_type:["coordinate"],properties:{},type:"Feature"}}const s=Number(r[1].trim()),l=Number(r[2].trim()),a=[];return(s<-90||s>90)&&a.push(o(s,l)),(l<-90||l>90)&&a.push(o(l,s)),a.length===0&&(a.push(o(s,l)),a.push(o(l,s))),a};geocoder=new MapboxGeocoder$1({accessToken:mapboxgl.accessToken,mapboxgl,marker:!1,localGeocoder:t,placeholder:"Try: Lng , Lat or Name",reverseGeocode:!0}),n.length===0&&(console.log("mapbox geocoder"),document.getElementById("geocoder").appendChild(geocoder.onAdd(map)))}else config.apiKey=scope.apiKey,urlKey="key=",urlType=".webp",vectorType=".pbf",map=new Map$1({container:"map",style:MapStyle.OUTDOOR,center:[grid.lng,grid.lat],zoom:grid.zoom,preserveDrawingBuffer:!0,navigationControl:!1,geolocateControl:!1}),geocoder=new zf({apiKey:config.apiKey,class:"geocoder",showResultsWhileTyping:!0,placeholder:"Try: Lng , Lat or Name",enableReverse:!0}),document.getElementById("outdoors-v11").check=!0,n.length===0&&(console.log("maptiler geocoder"),document.getElementById("geocoder").appendChild(geocoder.onAdd(map)));map.on("zoomend",()=>{let t=Math.round(map.getZoom());zoom.innerHTML=t.toString()}),map.on("error",function(t){toggleModal("open",`Mapbox error: ${t.error.message} Please check your api key and other map settings in the settings panel`),console.log(t),togglePanel(4)}),map.on("load",function(){console.log("load"),mapCanvas=map.getCanvasContainer(),zoom.innerHTML=Math.round(grid.zoom).toString(),map.getCanvas().addEventListener("wheel",t=>{const e=t.deltaY<0?1:-1;if(t.preventDefault(),t.shiftKey){map.scrollZoom.disable();let r=scope.mapSize;if(e===1?r+=1:r-=1,r>=4&&r<=1e3){scope.mapSize=r;let o=document.getElementById("mapSize");changeMapsize(o)}}else map.scrollZoom.enable()}),scope.mapSize=mapSize,scope.baseLevel=0,scope.heightScale=100}),map.on("style.load",function(t){addSource(),addLayer(),setMouse()}),map.on("click",function(t){grid.lng=t.lngLat.lng,grid.lat=t.lngLat.lat,setGrid(grid.lng,grid.lat,vmapSize),map.panTo(new mapboxgl.LngLat(grid.lng,grid.lat)),saveSettings(),zoom.innerHTML=Math.round(grid.zoom).toString(),updateInfopanel()}),map.on("idle",function(){scope.waterDepth=parseInt(grid.waterDepth)||50,scope.landscapeSize=parseInt(grid.landscapeSize)||2017,scope.worldpartlandscapeSize=parseInt(grid.worldpartlandscapeSize)||2041,scope.exportType=parseInt(grid.exportType)||"unrealHeightmap",saveSettings()}),scope.serverType==="mapbox"&&geocoder.on("result",function(t){grid.lng=t.result.center[0],grid.lat=t.result.center[1],setGrid(grid.lng,grid.lat,vmapSize),map.panTo(new mapboxgl.LngLat(grid.lng,grid.lat)),saveSettings(),updateInfopanel()})}else toggleModal("open","Please check your api key and other map settings in the settings panel"),togglePanel(4)}catch(n){toggleModal("open",`${n.message} Could be missing api key in the settings panel`),console.log(n)}}function onMove(n){grid.lng=n.lngLat.lng,grid.lat=n.lngLat.lat,setGrid(n.lngLat.lng,n.lngLat.lat,vmapSize)}function onUp(n){grid.lng=n.lngLat.lng,grid.lat=n.lngLat.lat,setGrid(n.lngLat.lng,n.lngLat.lat,vmapSize),map.off("mousemove",onMove),map.off("touchmove",onMove),updateInfopanel()}function addSource(){map.addSource("grid",{type:"geojson",data:getGrid(grid.lng,grid.lat,vmapSize)}),map.addSource("start",{type:"geojson",data:getGrid(grid.lng,grid.lat,vmapSize/9)})}function addLayer(){map.addLayer({id:"grid",type:"fill",source:"grid",paint:{"fill-color":"blue","fill-outline-color":"blue","fill-opacity":.25}}),map.addLayer({id:"startsquare",type:"fill",source:"start",paint:{"fill-color":"blue","fill-outline-color":"blue","fill-opacity":.3}})}function setMouse(){map.on("mouseenter","startsquare",function(){mapCanvas.style.cursor="move"}),map.on("mouseleave","startsquare",function(){mapCanvas.style.cursor="",saveSettings()}),map.on("mousedown","startsquare",function(n){n.preventDefault(),mapCanvas.style.cursor="grab",map.on("mousemove",onMove),map.once("mouseup",onUp)}),map.on("touchstart","startsquare",function(n){n.points.length===1&&(n.preventDefault(),map.on("touchmove",onMove),map.once("touchend",onUp))})}function setLngLat(n){let t=document.getElementById("lngInput"),e=document.getElementById("latInput");switch(n){case"current_position":t.value=grid.lng,e.value=grid.lat;break;case"clear":t.value="",e.value="";break;case"apply":t.value&&e.value&&(grid.lng=parseFloat(t.value),grid.lat=parseFloat(e.value),setGrid(grid.lng,grid.lat,vmapSize),map.panTo(new mapboxgl.LngLat(grid.lng,grid.lat)),saveSettings(),updateInfopanel());break}}function setGrid(n,t,e){map.getSource("grid").setData(getGrid(n,t,e)),map.getSource("start").setData(getGrid(n,t,e/9)),grid.zoom=map.getZoom()}function getExtent(n,t,e=vmapSize){let r=Math.sqrt(2*Math.pow(e/2,2)),o=point([n,t]),s=destination(o,r,-45,{units:"kilometers"}).geometry.coordinates,l=destination(o,r,135,{units:"kilometers"}).geometry.coordinates;return{topleft:s,bottomright:l}}function getGrid(n,t,e){let r=getExtent(n,t,e);return squareGrid([r.topleft[0],r.topleft[1],r.bottomright[0],r.bottomright[1]],tileSize,{units:"kilometers"})}async function loadUserSettings(){let n=await idbKeyval.get("userSettings")||{};if(n.dirHandle?scope.downloadDirectory=n.dirHandle.name:scope.downloadDirectory="",scope.serverType||(scope.serverType=n.serverType||"mapbox"),scope.serverType==="mapbox"){scope.apiKey=n.mapboxApiKey||"",scope.terrianUrl=n.mapboxTerrianUrl||"https://api.mapbox.com/v4/mapbox.terrain-rgb/",scope.stylesUrl=n.mapboxStylesUrl||"mapbox://styles/mapbox/",scope.vectorUrl=n.mapboxVectorUrl||"https://api.mapbox.com/v4/mapbox.mapbox-streets-v8/",scope.weightMapUrl=n.mapboxWeightMapUrl||"",scope.satelliteMapUrl=n.mapboxSatelliteMapUrl||"https://api.mapbox.com/v4/mapbox.satellite/",scope.mapUrl=n.mapboxMapUrl||"https://api.mapbox.com/styles/v1/";let t=n.weightmapColors||[];t.length===0?n.weightmapColors=rows:rows=t}else scope.serverType==="maptiler"&&(scope.apiKey=n.maptilerApiKey||"",scope.terrianUrl=n.maptilerTerrianUrl||"https://api.maptiler.com/tiles/terrain-rgb-v2/",scope.stylesUrl=n.maptilerStylesUrl||"https://api.maptiler.com/maps/outdoor/style.json",scope.vectorUrl=n.maptilerVectorUrl||"https://api.maptiler.com/tiles/v3/",scope.weightMapUrl=n.maptilerWeightMapUrl||"",scope.satelliteMapUrl=n.maptilerSatelliteMapUrl||"https://api.maptiler.com/tiles/satellite-v2/",scope.mapUrl=n.maptilerMapUrl||"https://api.maptiler.com/maps/");return scope.desktopServerUrl=n.desktopServerUrl||"http://localhost:5000/",scope.desktopDownloadDirectory=n.desktopDownloadDirectory||"",n}async function saveUserSettings(){userSettings.serverType=scope.serverType,scope.serverType==="mapbox"?(userSettings.mapboxApiKey=scope.apiKey,userSettings.mapboxTerrianUrl=scope.terrianUrl,userSettings.mapboxStylesUrl=scope.stylesUrl,userSettings.mapboxWeightMapUrl=scope.weightMapUrl,userSettings.mapboxSatelliteMapUrl=scope.satelliteMapUrl,userSettings.mapboxMapUrl=scope.mapUrl,userSettings.mapboxVectorUrl=scope.vectorUrl,userSettings.weightmapColors=gridOptions.rowData):(userSettings.maptilerApiKey=scope.apiKey,userSettings.maptilerTerrianUrl=scope.terrianUrl,userSettings.maptilerStylesUrl=scope.stylesUrl,userSettings.maptilerWeightMapUrl=scope.weightMapUrl,userSettings.maptilerSatelliteMapUrl=scope.satelliteMapUrl,userSettings.maptilerMapUrl=scope.mapUrl,userSettings.maptilerVectorUrl=scope.vectorUrl),userSettings.desktopServerUrl=scope.desktopServerUrl,userSettings.desktopDownloadDirectory=scope.desktopDownloadDirectory,idbKeyval.set("userSettings",userSettings),await loadUserSettings(),map&&map.remove(),location.reload()}async function loadSettings(){let n=await idbKeyval.get("grid")||{};return n.lng=parseFloat(n.lng)||-121.75954,n.lat=parseFloat(n.lat)||46.85255,n.zoom=parseFloat(n.zoom)||11,n.minHeight=parseFloat(n.minHeight)||0,n.maxHeight=parseFloat(n.maxHeight)||0,document.getElementById("waterDepth").value=parseInt(n.waterDepth)||defaultWaterdepth,document.getElementById("drawStrm").checked=n.drawStreams||!1,document.getElementById("blurPasses").value=parseInt(n.blurPasses)||0,document.getElementById("blurPostPasses").value=parseInt(n.blurPostPasses)||0,document.getElementById("plainsHeight").value=parseInt(n.plainsHeight)||0,document.getElementById("streamDepth").value=parseInt(n.streamDepth)||0,n}function saveSettings(){grid.zoom=map.getZoom(),grid.waterDepth=parseInt(document.getElementById("waterDepth").value),grid.landscapeSize=scope.landscapeSize,grid.worldpartlandscapeSize=scope.worldpartlandscapeSize,grid.exportType=scope.exportType,grid.drawStreams=document.getElementById("drawStrm").checked,grid.plainsHeight=parseInt(document.getElementById("plainsHeight").value),grid.blurPasses=parseInt(document.getElementById("blurPasses").value),grid.blurPostPasses=parseInt(document.getElementById("blurPostPasses").value),grid.streamDepth=parseInt(document.getElementById("streamDepth").value),idbKeyval.set("grid",grid)}function togglePanel(n){let t=[];for(let e=0;e<panels.length;e++)t.push(panels[e].classList.contains("slide-in"));for(let e=0;e<panels.length;e++)t[e]&&e!=n&&(panels[e].setAttribute("class","panel slide-out"),icons[e].setAttribute("class",iconClass[e]));switch(panels[n].setAttribute("class",t[n]?"panel slide-out":"panel slide-in"),icons[n].setAttribute("class",t[n]?iconClass[n]:"icon fas fa-angle-left"),n){case 0:break;case 1:break;case 2:if(!t[2]){let e,r;scope.serverType==="mapbox"?e=map.getStyle().metadata["mapbox:origin"]:(e=map.getStyle().name,r=mapUtils.convertMapboxMaptilerStyles("maptiler",e.toUpperCase()),r.length===0&&(r=mapUtils.convertMapboxMaptilerStyles("maptilerAltName",e)),r.length>0&&(e=r[0].mapbox,document.getElementById(e).checked=!0))}break;case 3:break;case 4:break;case 5:initWeightmapGrid();break}}function updateInfopanel(){document.getElementById("lng").innerHTML=grid.lng.toFixed(5),document.getElementById("lat").innerHTML=grid.lat.toFixed(5),document.getElementById("minh").innerHTML=grid.minHeight,document.getElementById("maxh").innerHTML=grid.maxHeight}function zoomIn(){map.zoomIn()}function zoomOut(){map.zoomOut()}function changeMapsize(n){n.value<4&&(n.value=4),mapSize=n.value/1,vmapSize=mapSize*1.05,tileSize=mapSize/9,setGrid(grid.lng,grid.lat,vmapSize),grid.minHeight=null,grid.maxHeight=null,updateInfopanel()}async function setBaseLevel(){grid.minHeight===null&&await getHeightmap(),scope.baseLevel=grid.minHeight,saveSettings()}async function setHeightScale(){grid.maxHeight===null&&await getHeightmap(),scope.heightScale=Math.min(250,Math.floor((1024-scope.waterDepth)/(grid.maxHeight-scope.baseLevel)*100)),saveSettings()}function incPb(n,t=1){let e=n.value+t;n.value===n.max?n.value=0:n.value=e}function setMapStyle(n){const t=n.id;if(scope.serverType==="mapbox")t==="weightmap"?map.setStyle("mapbox://styles/"+scope.weightMapUrl):map.setStyle(scope.stylesUrl+t);else{let e=mapUtils.convertMapboxMaptilerStyles("mapbox",t);if(e.length>0){const r=e[0].maptiler.split(".");let o;r.length===2?o=MapStyle[r[0]][r[1]]:o=MapStyle[r[0]],map.setStyle(o,{diff:e[0].diff})}}}function startTimer(n=!1){overlayOn(),progressArea.style.display="block",timer=setIntervalAsync.setIntervalAsync(async()=>{ticks++,incPb(pbElement),n===!0&&(processCount.innerHTML=`Time: ${ticks}`)},10)}function stopTimer(){clearIntervalAsync_2(timer),pbElement.value=0,console.log("complete in ",ticks*10," ms"),ticks=0,progressMsg.innerHTML="",progressArea.style.display="none",processCount.innerHTML="",processStatus.innerHTML="",overlayOff()}async function getHeightmap(n=14,t=!1){return new Promise(async(e,r)=>{let o=await downloadTiles(scope.terrianUrl,!0,n,t);o.heightmap=mapUtils.toHeightmap(o.tiles,o.distance,mapSize),o.xOffset=Math.round(o.leftDistance/o.distance*o.heightmap.length),o.yOffset=Math.round(o.topDistance/o.distance*o.heightmap.length),o.sanatizedMap=mapUtils.sanatizeMap(o.heightmap,o.xOffset,o.yOffset);let s=mapUtils.calcMinMaxHeight(o.heightmap);grid.minHeight=s.min,grid.maxHeight=s.max,document.getElementById("lng").innerHTML,document.getElementById("lat").innerHTML,o?e(o):r("timout")})}async function downloadTiles(n,t=!0,e=14,r=!1){return new Promise(async(o,s)=>{let l=getExtent(grid.lng,grid.lat,mapSize/1080*1081),a=mapUtils.getTileCountAdjusted(e,l,r),h=a.x,y=a.y,C=a.zoom,L=a.tileCnt,Y={};document.getElementById("satZoomVal").value=C,document.getElementById("zoomlevel").innerHTML=C,document.getElementById("satZoomTileCount").innerHTML=mapUtils.getTileCount(C,l).length.toString(),document.getElementById("heightmapZoomTileCount").innerHTML=mapUtils.getTileCount(C,l).length.toString(),document.getElementById("heightmapZoomVal").value=C;let ze=mapUtils.tile2long(h,C),Bt=mapUtils.tile2lat(y,C),Ir=mapUtils.tile2long(h+L,C),Wr=mapUtils.tile2lat(y+L,C),yi,Bn;distance=distance$1(point([ze,Bt]),point([Ir,Wr]),{units:"kilometers"})/Math.SQRT2;let vi=distance$1(point([ze,Bt]),point([ze,l.topleft[1]]),{units:"kilometers"}),wo=distance$1(point([ze,Bt]),point([l.topleft[0],Bt]),{units:"kilometers"});t===!0?yi=mapUtils.Create2DArray(L):yi=[],promiseArray=[];let ia=1,gl=L*L;progressCount(ia,gl,"downloading");for(let ml=0;ml<L;ml++)for(let il=0;il<L;il++){let sl=n+C+"/"+(h+il)+"/"+(y+ml)+urlType+"?"+urlKey+scope.apiKey;t===!0?promiseArray.push(mapUtils.downloadToTile(!0,sl).then(ol=>{yi[ml][il]=ol,progressCount(ia++,gl,"downloading")})):promiseArray.push(mapUtils.downloadToTile(!1,sl,h+il,y+ml).then(ol=>{yi.push(ol),progressCount(ia++,gl,"downloading")}))}if(await Promise.all(promiseArray),t===!0){promiseArray=[],Bn=mapUtils.Create2DArray(L),n=scope.vectorUrl;for(let ml=0;ml<L;ml++)for(let il=0;il<L;il++){let sl=n+C+"/"+(h+il)+"/"+(y+ml)+vectorType+"?"+urlKey+scope.apiKey;promiseArray.push(mapUtils.downloadPbfToTile(sl).then(ol=>{Bn[ml][il]=ol,progressCount(ia++,gl,"downloading vector tiles")}))}}await Promise.all(promiseArray),Y.tiles=yi,Y.vTiles=Bn,Y.distance=distance,Y.topDistance=vi,Y.leftDistance=wo,Y.zoom=a.zoom,Y.x=h,Y.y=y,Y.zoom=C,Y.tileCnt=a.tileCnt,Y?o(Y):s("timout")})}function progressCount(n,t,e){processCount.innerHTML=`${e}  ${n} of ${t}`}function setUrlInfo(n){scope.serverType==="mapbox"?(n==="height"&&(urlType="@2x.png"),n==="style"&&(urlType="")):scope.serverType==="maptiler"&&(n==="height"?urlType=".webp":n==="jpg"?urlType=".jpg":n==="png"&&(urlType=".png"))}function convertHeightmap(n,t){let r=new Uint8ClampedArray(2337122),o=mapUtils.Create2DArray(1081,0),s=Math.round(scope.waterDepth/parseFloat(scope.heightScale)*100*10)/10;for(let ze=0;ze<1081;ze++)for(let Bt=0;Bt<1081;Bt++){let Wr=(n[ze][Bt]-scope.baseLevel*10+Math.round(s*10*t[ze][Bt]))/10;o[ze][Bt]=Math.max(0,Wr)}let l=parseInt(document.getElementById("levelCorrection").value);o=levelMap(o,grid.minHeight+s,grid.maxHeight,l);let a=parseInt(document.getElementById("blurPasses").value),h=parseInt(document.getElementById("blurPostPasses").value),y=parseInt(document.getElementById("plainsHeight").value);for(let ze=0;ze<a;ze++)o=filterMap(o,0,y+s,meanKernel);for(let ze=0;ze<h;ze++)o=filterMap(o,y+s,grid.maxHeight,sharpenKernel);let C=parseInt(document.getElementById("streamDepth").value),L=0;if(document.getElementById("drawStrm").checked)for(let ze=0;ze<1081;ze++)for(let Bt=0;Bt<1081;Bt++){let Ir=o[ze][Bt];Ir>L&&(L=Ir),Ir>C&&(o[ze][Bt]=Ir-(1-t[ze][Bt])*C)}for(let ze=0;ze<h;ze++)o=filterMap(o,0,L,meanKernel);for(let ze=0;ze<1081;ze++)for(let Bt=0;Bt<1081;Bt++){let Ir=Math.round(o[ze][Bt]/100*parseFloat(scope.heightScale)/.015625);Ir>65535&&(Ir=65535);let Wr=ze*1081*2+Bt*2;r[Wr+0]=Ir>>8,r[Wr+1]=Ir&255}let Y=getExtent(grid.lng,grid.lat,mapSize);return console.log(Y.topleft[0],Y.topleft[1],Y.bottomright[0],Y.bottomright[1]),r}function interpolateArray(n,t){let e=function(s,l,a){return s+(l-s)*a},r=new Array,o=new Number((n.length-1)/(t-1));r[0]=n[0];for(let s=1;s<t-1;s++){let l=s*o,a=new Number(Math.floor(l)).toFixed(),h=new Number(Math.ceil(l)).toFixed(),y=l-a;r[s]=e(n[a],n[h],y)}return r[t-1]=n[n.length-1],r}function levelMap(n,t,e,r){let o;switch(r){case 1:o=[.1,1,1.9];break;case 2:o=[.15,.45,.75,1.1,1.4,1.7,1.9,1.9];break;case 3:o=[.1,.2,1,1.1,1.2,1.3,1.4,1.5,1.6];break;case 9:o=[.1,.2,.5,1,1.3,1.7,2.5];break;default:return console.log("no map leveling"),n}const s=interpolateArray(o,256),l=n.length,a=n[0].length,h=Math.round((e-t)/s.length);let y=[t],C=t;for(let Bt=0;Bt<s.length;Bt++)y.push(Math.round((C+h*s[Bt])*10)/10),C=y[Bt+1];const L=mapUtils.Create2DArray(l,0);let Y=0;for(let Bt=0;Bt<l;Bt++)for(let Ir=0;Ir<a;Ir++){let Wr=n[Bt][Ir];if(Wr-t>0){let yi=Math.min(s.length-1,Math.floor((Wr-t)/h));Wr=y[yi]+(Wr-y[yi])*s[yi],Wr=Math.round(Wr*10)/10}L[Bt][Ir]=Wr,Wr>Y&&(Y=Wr)}console.log(`min ${t} max ${e} highest high ${Y}`);let ze=10;if(Y>e){ze=Math.floor((e-t)/Y*100)/10;for(let Bt=0;Bt<l;Bt++)for(let Ir=0;Ir<a;Ir++){let Wr=L[Bt][Ir];Wr-t>0&&(L[Bt][Ir]=Math.round(Wr*ze)/10)}}return console.log(`leveled map with style ${r}, rescale ${ze/10}`),L}function filterMap(n,t,e,r){const o=n.length,s=n[0].length,l=parseInt((r.length-1)/2),a=mapUtils.Create2DArray(o,0);for(let h=0;h<o;h++)for(let y=0;y<s;y++){let C=n[h][y];if(C>=t&&C<t+e){let L=0,Y=0;for(let ze=-l;ze<=l;ze++)for(let Bt=-l;Bt<=l;Bt++)h+ze>=0&&h+ze<o&&y+Bt>=0&&y+Bt<s&&(Y+=r[ze+l][Bt+l],L+=n[h+ze][y+Bt]*r[ze+l][Bt+l]);Y&&(C=L/Y)}a[h][y]=C}return a}async function previewHeightmap(){progressMsg.innerHTML="Processing heightmap",startTimer();let n,t,e;setUrlInfo("height");let r=document.getElementById("autoCalcBaseHeight").checked,o=await getHeightmap(),s=mapUtils.sanatizeWatermap(mapUtils.toWatermap(o.vTiles,o.heightmap.length),o.xOffset,o.yOffset);r===!0&&await autoCalculateBaseHeight(),n=convertHeightmap(o.sanatizedMap,s),t=UPNG.encodeLL([n],1081,1081,1,0,16),e=download("testheightmap.png",t,!0),previewImage.src=e,updateInfopanel(),stopTimer()}async function workerProcess(n){return new Promise(async(t,e)=>{myWorker.postMessage(n),myWorker.onmessage=function(r){let o=r.data;o.process==="worker"&&o.msg==="complete"?(stopTimer(),t(!0)):o.process==="weightMap"&&o.msg==="update"?processStatus.innerHTML=`Converting ${o.name}  `:o.process==="combineTilesJimp"&&o.msg==="update"&&progressCount(o.count,o.totalCount,"")}})}async function setupEventSource(){event_source===void 0&&(event_source=new EventSource(userSettings.desktopServerUrl+"subscribe"),event_source.onmessage=function(n){let t=JSON.parse(n.data);if(t.event==="stitch_tiles"&&t.count){let e;t.total_count?e=t.total_count:e="unknown",progressCount(t.count,e,t.process)}else t.event==="stitch_tiles"&&(processCount.innerHTML=t.process)})}async function exportMap(){let n=await userSettings.dirHandle,t=document.getElementById("satZoomVal").value,e=document.getElementById("overrideSatZoom").checked,r=document.getElementById("heightmapZoomVal").value,o=document.getElementById("overrideHeightmapZoom").checked,s=document.getElementById("heightmap").checked,l=document.getElementById("satellite").checked,a,h=!1;if(t>14||r>14)if(a=await isServerRunning(),a===!1){toggleModal("open","To use a zoom level of greater than 14 please download the desktop version, download link in help file.  Cannot connect to desktop server");return}else await setupEventSource(),h=!0;try{if(await fileUtils.verifyPermission(n,!0)===!1){console.error(`User did not grant permission to '${n.name}'`);return}}catch(gp){toggleModal("open","Please choose a download directory in the settings panel"),togglePanel(4),console.log(gp);return}let y,C,L=document.getElementById("autoCalcBaseHeight").checked,Y=document.getElementById("mapimage").checked,ze=document.getElementById("weightmapdl").checked,Bt=document.getElementById("geojson").checked,Ir=document.getElementById("sealevel").checked,Wr=document.getElementById("flipx").checked,yi=document.getElementById("flipy").checked,Bn=document.getElementById("useworldpart").checked,vi=document.getElementById("blurradius").value,wo=document.getElementById("weightmapblurradius").value,ia="";Bn===!0?ia=scope.worldpartlandscapeSize.toString():ia=scope.landscapeSize.toString();let gl,ml;ml=grid.lng.toFixed(5),gl=grid.lat.toFixed(5);let il=512,sl=getExtent(grid.lng,grid.lat,mapSize/1080*1081),ol=[sl.topleft[0],sl.bottomright[1],sl.bottomright[0],sl.topleft[1]],_l=[sl.topleft[0],sl.topleft[1],sl.bottomright[0],sl.bottomright[1]],rh,wh;t.length===0?rh=14:rh=t,r.length===0?wh=14:wh=r;let Fh="["+ol+"]",Mh={};subDirName="",subDirName=`tile_lat_${gl}_lng_${ml}`;const vp=await n.getDirectoryHandle(subDirName,{create:!0});if(scope.exportType==="unrealSend"&&s!==!0){toggleModal("open","Send to Unreal requires image download type heightmap to be checked");return}if(s===!0||l===!0||Y===!0||ze===!0||Bt===!0){if(s===!0){heightmapFileName=`heightmap_landscape_size_${ia}.png`,progressMsg.innerHTML="Processing heightmap",console.log("heightmap"),startTimer(),setUrlInfo("height");let gp=mapUtils.getTileCountAdjusted(wh,sl,o);if(Mh={},Mh.function="heightmap",Mh.heightmapblurradius=vi,Mh.sealevel=Ir,Mh.flipx=Wr,Mh.flipy=yi,Mh.landscapeSize=ia,Mh.dirHandle=vp,Mh.filename=heightmapFileName,Mh.bbox=_l,Mh.zoom=parseInt(gp.zoom),Mh.access_token=urlType+"?"+urlKey+scope.apiKey,Mh.api_url=scope.terrianUrl,Mh.base_dir=scope.desktopDownloadDirectory,Mh.sub_dir=subDirName,Mh.is_heightmap=!0,h===!0)console.log("send backend"),await processFromBackend(Mh),stopTimer();else{let Jh=await getHeightmap(wh,o),Lp=mapUtils.sanatizeWatermap(mapUtils.toWatermap(Jh.vTiles,Jh.heightmap.length),Jh.xOffset,Jh.yOffset);L===!0&&await autoCalculateBaseHeight(),y=convertHeightmap(Jh.sanatizedMap,Lp),C=UPNG.encodeLL([y],1081,1081,1,0,16),console.log("finished convert heightmap"),updateInfopanel(),stopTimer(),console.log("start manipulating image"),progressMsg.innerHTML="Manipulating and resizing image",startTimer(!0),Mh.png=C,Mh.function="manipulateImage",Mh.isHeightmap=!0,await workerProcess(Mh),stopTimer()}}if(l===!0){console.log("Processing satellite"),progressMsg.innerHTML="Processing satellite",startTimer(),setUrlInfo("jpg");let gp=mapUtils.getTileCountAdjusted(rh,sl,e),Jh=`satellite_zoom_${gp.zoom}.png`;if(Mh={},Mh.function="satellite",Mh.dirHandle=vp,Mh.heightmapblurradius=vi,Mh.sealevel=Ir,Mh.flipx=Wr,Mh.flipy=yi,Mh.landscapeSize=ia,Mh.filename=Jh,Mh.bbox=_l,Mh.zoom=parseInt(gp.zoom),Mh.access_token=urlType+"?"+urlKey+scope.apiKey,Mh.api_url=scope.satelliteMapUrl,Mh.base_dir=scope.desktopDownloadDirectory,Mh.sub_dir=subDirName,Mh.is_heightmap=!1,h===!0)console.log("send backend"),await processFromBackend(Mh),stopTimer();else{let Lp=await downloadTiles(scope.satelliteMapUrl,!1,rh,e);console.log("Combining images"),progressMsg.innerHTML="Combining images",startTimer(),Mh.function="combineImages",Mh.objTiles=Lp,Mh.tileSize=il,Mh.dirHandle=vp,Mh.lng=ml,Mh.lat=gl,Mh.zoom=Lp.zoom,Mh.filename=Jh,await workerProcess(Mh),stopTimer()}}if(Y===!0){console.log("Processing map image"),progressMsg.innerHTML="Processing map image",startTimer();let gp,Jh,Lp,Ip;if(scope.serverType==="mapbox"){gp=map.getStyle().metadata["mapbox:origin"],gp===void 0?(Lp=scope.mapUrl+scope.weightMapUrl+"/static/",console.log("weight")):(Jh=mapUtils.convertMapboxMaptilerStyles("mapbox",gp),Lp=scope.mapUrl+"mapbox/"+Jh[0].mapbox+"/static/");let $p=1280,Xp=1280;Lp=Lp+Fh+`/${Xp}x${$p}?access_token=${scope.apiKey}&attribution=false&logo=false`,Ip=`map_image_width_${$p}_height_${Xp}.png`;let Cp=await mapUtils.downloadToTile(!1,Lp);await saveImage(vp,Cp.buffer,Ip,"png"),stopTimer()}else if(scope.serverType==="maptiler"){setUrlInfo("png"),gp=map.getStyle().name,Jh=mapUtils.convertMapboxMaptilerStyles("maptiler",gp.toUpperCase()),Lp=scope.mapUrl+Jh[0].maptiler_map+"/";let $p=await downloadTiles(Lp,!1,zoom,!1);stopTimer(),Ip="map_image.png",console.log("Combining images"),progressMsg.innerHTML="Combining images",startTimer(),Mh={},Mh.function="combineImages",Mh.objTiles=$p,Mh.tileSize=il,Mh.dirHandle=vp,Mh.lng=ml,Mh.lat=gl,Mh.zoom=$p.zoom,Mh.filename=Ip,await workerProcess(Mh),stopTimer()}}if(ze===!0){if(scope.serverType==="mapbox"){console.log("Processing weightmap image"),progressMsg.innerHTML="Processing weightmap image",startTimer(!0);let gp=scope.mapUrl+scope.weightMapUrl+"/static/",Jh=1280,Lp=1280;gp=gp+Fh+`/${Lp}x${Jh}?access_token=${scope.apiKey}&attribution=false&logo=false`;let Ip=`weightmap_image_width_${Jh}_height_${Lp}.png`,$p=await mapUtils.downloadToTile(!1,gp);await saveImage(vp,$p.buffer,Ip,"png"),Mh={},Mh.function="weightMap",Mh.weight_data=userSettings.weightmapColors,Mh.weightMapUrl=scope.weightMapUrl,Mh.dirHandle=vp,Mh.objTile=$p,Mh.lng=grid.lng,Mh.lat=grid.lat,Mh.weightmapblurradius=wo,Mh.landscapeSize=ia,await workerProcess(Mh),stopTimer()}else console.log("Weightmaps are not available for Maptiler");stopTimer()}if(Bt===!0){console.log("Processing geojson"),progressMsg.innerHTML="Processing geojson",startTimer();let gp=mapUtils.getFeaturesFromBB(map,ol,!0),Jh=JSON.stringify(gp),Lp=`features_lat_${gl}_lng_${ml}.json`;await fileUtils.writeFileToDisk(vp,Lp,Jh),stopTimer()}scope.exportType==="unrealSend"&&await sendToUnreal()}else toggleModal("open","Please select at least one image type to download")}async function isServerRunning(){try{return(await(await fetch(userSettings.desktopServerUrl,{method:"GET"})).json()).msg==="server is running"}catch(n){return console.log(n),stopTimer(),!1}}async function processFromBackend(n){try{let t=JSON.stringify(n),r=await(await fetch(userSettings.desktopServerUrl+"process_tiles",{method:"POST",headers:{"Content-Type":"application/json"},body:t})).json()}catch(t){console.log(t),stopTimer()}}async function autoCalculateBaseHeight(){await setBaseLevel(),await setHeightScale()}function download(n,t,e=!1){let r=window.document.createElement("a");if(e)return window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"}));r.href=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"})),r.download=n,document.body.appendChild(r),r.click(),document.body.removeChild(r)}function overlayOn(){document.getElementById("overlay").style.display="block"}function overlayOff(){document.getElementById("overlay").style.display="none"}function exportTypeChange(n){scope.exportType=n.value}function landscapeSizeChange(n){scope.landscapeSize=n.value}function worldpartlandscapeSizeChange(n){scope.worldpartlandscapeSize=n.value}async function serverTypeChange(n){scope.serverType=n.value,await loadUserSettings()}async function openDirectory(){try{userSettings.dirHandle=await fileUtils.getDirHandle()}catch(n){if(n.name==="AbortError")return;console.error("An error occured trying to open the file.",n)}userSettings.dirHandle?(scope.downloadDirectory=userSettings.dirHandle.name,idbKeyval.set("userSettings",userSettings)):console.log("error dirhandle")}function toggleModal(n,t){n==="open"?(modalMsg.innerHTML=t,modal.classList.add("show-modal")):n==="close"&&(modalMsg.innerHTML="",modal.classList.remove("show-modal"))}function getTilesResolutionSize(n){let t=n[0],e=n[n.length-1],r=[t.x,e.x],o=[t.y,e.y],s=r[1]-r[0],l=o[1]-o[0];s=Math.max(1,s),l=Math.max(1,l);let a=512,h=512,y=a*s,C=h*l,L={};return L.totalHeight=C,L.totalWidth=y,L}function overrideSatZoomChange(n){let t=getExtent(grid.lng,grid.lat,mapSize/1080*1081),e=mapUtils.getTileCount(n,t),r=getTilesResolutionSize(e),o=e.length;document.getElementById("satZoomTileCount").innerHTML=o.toString(),n>14&&(document.getElementById("satresolution").innerHTML=`Expected sat resolution if zoom > 14 Height: ${r.totalHeight} Width: ${r.totalWidth}`)}function overrideHeightmapZoomChange(n){let t=getExtent(grid.lng,grid.lat,mapSize/1080*1081),e=mapUtils.getTileCount(n,t),r=getTilesResolutionSize(e),o=e.length;document.getElementById("heightmapZoomTileCount").innerHTML=o.toString(),n>14&&(document.getElementById("heightresolution").innerHTML=`Expected height resolution if zoom > 14 Height: ${r.totalHeight} Width: ${r.totalWidth}`)}async function saveImage(n,t,e,r){let o=new Blob([t],{type:"image/"+r});await fileUtils.writeFileToDisk(n,e,o)}async function saveWeightmapGrid(){gridOptions.api.stopEditing(),await saveUserSettings()}async function deleteWeightmapGrid(){gridOptions.api.stopEditing();let n=gridOptions.api.getSelectedNodes(),t=gridOptions.rowData;for(let e=0;e<n.length;e++)for(let r=0;r<t.length;r++)t[r]===n[e].data&&t.splice(r,1);gridOptions.api.setRowData(t),await saveUserSettings()}function addWeightmapGrid(){gridOptions.rowData.push({name:"New Value",color:"1,1,1"}),gridOptions.api.setRowData(gridOptions.rowData)}function help(){open("help.html","help",`scrollbars=yes,resizable=no,status=no,location=no,toolbar=no,menubar=no,
width=900,height=600,left=500,top=100`)}async function sendToUnreal(){startTimer("Sending to Unreal"),console.log("sendtounreal");let n="http://localhost:30010/",t="remote/object/call",e={},r,o,s,l="Mapbox_BP";if(e={objectPath:"/Script/UnrealEd.Default__EditorActorSubsystem",functionName:"GetAllLevelActors"},r=await mapUtils.unrealRemoteControl(e,n+t),r.error)r.error.message==="Failed to fetch"?toggleModal("open","Cannot connect to Unreal server. Please make sure your project is open and Mapbox_BP is in the scene.  Also make sure you launched the Map using the Select Map button as this starts the Unreal Web Server"):toggleModal("open",r.error.message);else{let a=await r.response.json();for(let h of a.ReturnValue)if(o=h.includes(l),o===!0){s=h;break}else s=null;if(s){let h;worldpart===!0?h=worldpartiongridsize:h=0,e={objectPath:s,functionName:"GenerateMapboxLandscape",parameters:{LandscapeName:landscapename,LandscapeSize:scope.landscapeSize.toString(),TileHeightmapFileName:subDirName+"/"+heightmapFileName,TileGeojsonFileName:"",TileInfoFileName:"",MapMiddleLngX:"",MapMiddleLatY:"",MapBtmRLng:"",MapBtmLLng:"",MapTopLLat:"",MapBtmLLat:"",RunFunction:"Unreal Heightmap",SlippyMapTileString:"",HeightMapTexturesPath:"/Game/ImportedHeightMaps/",AlphaBrushName:"",AlphaBrushDestinationPath:"",AlphaBrushTemplatePath:"",AlphaBrushTexturesPath:"",HeightmapProperty:"HeightMap",WorldPartitionGridSize:h.toString()}},r=await mapUtils.unrealRemoteControl(e,n+t),r.error?(console.log(r.error),toggleModal("open",r.error.message)):console.log(await r.response.json())}else toggleModal("open","Could not find Mapbox_BP in scene")}stopTimer()}window.toggleModal=toggleModal;window.togglePanel=togglePanel;window.openDirectory=openDirectory;window.saveUserSettings=saveUserSettings;window.serverTypeChange=serverTypeChange;window.landscapeSizeChange=landscapeSizeChange;window.exportMap=exportMap;window.previewHeightmap=previewHeightmap;window.setMapStyle=setMapStyle;window.setLngLat=setLngLat;window.zoomIn=zoomIn;window.zoomOut=zoomOut;window.exportTypeChange=exportTypeChange;window.changeMapsize=changeMapsize;window.overrideSatZoomChange=overrideSatZoomChange;window.overrideHeightmapZoomChange=overrideHeightmapZoomChange;window.saveWeightmapGrid=saveWeightmapGrid;window.deleteWeightmapGrid=deleteWeightmapGrid;window.addWeightmapGrid=addWeightmapGrid;window.worldpartlandscapeSizeChange=worldpartlandscapeSizeChange;window.help=help;
